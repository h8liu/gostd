<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html" class="current">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3822131">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3822186">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3822240">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3822291">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3822350">package</span>&nbsp;<span class="ident" id="3822358">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3822363">import</span>&nbsp;<span class="op" id="3822370">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3822373">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3822392">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3822402">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3822409">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3822417">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3822427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3822430">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="3822489">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3822541">type</span>&nbsp;<span class="ident" id="3822546">Rat</span>&nbsp;<span class="keyword" id="3822550">struct</span>&nbsp;<span class="op" id="3822557">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3822560">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3822617">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3822671">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3822731">a</span><span class="op" id="3822732">,</span>&nbsp;<span class="ident" id="3822734">b</span>&nbsp;<span class="ident" id="3822736">Int</span><br>
<span class="lineno"></span><span class="op" id="3822740">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3822743">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3822807">func</span>&nbsp;<span class="ident" id="3822812">NewRat</span><span class="op" id="3822818">(</span><span class="ident" id="3822819">a</span><span class="op" id="3822820">,</span>&nbsp;<span class="ident" id="3822822">b</span>&nbsp;<span class="ident" id="3822824">int64</span><span class="op" id="3822829">)</span>&nbsp;<span class="op" id="3822831">*</span><span class="ident" id="3822832">Rat</span>&nbsp;<span class="op" id="3822836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3822839">return</span>&nbsp;<span class="builtinfunc" id="3822846">new</span><span class="op" id="3822849">(</span><span class="ident" id="3822850">Rat</span><span class="op" id="3822853">)</span><span class="op" id="3822854">.</span><span class="ident" id="3822855">SetFrac64</span><span class="op" id="3822864">(</span><span class="ident" id="3822865">a</span><span class="op" id="3822866">,</span>&nbsp;<span class="ident" id="3822868">b</span><span class="op" id="3822869">)</span><br>
<span class="lineno"></span><span class="op" id="3822871">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3822874">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3822923">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3822968">func</span>&nbsp;<span class="op" id="3822973">(</span><span class="ident" id="3822974">z</span>&nbsp;<span class="op" id="3822976">*</span><span class="ident" id="3822977">Rat</span><span class="op" id="3822980">)</span>&nbsp;<span class="ident" id="3822982">SetFloat64</span><span class="op" id="3822992">(</span><span class="ident" id="3822993">f</span>&nbsp;<span class="builtintype" id="3822995">float64</span><span class="op" id="3823002">)</span>&nbsp;<span class="op" id="3823004">*</span><span class="ident" id="3823005">Rat</span>&nbsp;<span class="op" id="3823009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3823012">const</span>&nbsp;<span class="ident" id="3823018">expMask</span>&nbsp;<span class="op" id="3823026">=</span>&nbsp;<span class="num" id="3823028">1</span><span class="op" id="3823029">&lt;&lt;</span><span class="num" id="3823031">11</span>&nbsp;<span class="op" id="3823034">-</span>&nbsp;<span class="num" id="3823036">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823039">bits</span>&nbsp;<span class="op" id="3823044">:=</span>&nbsp;<span class="ident" id="3823047">math</span><span class="op" id="3823051">.</span><span class="ident" id="3823052">Float64bits</span><span class="op" id="3823063">(</span><span class="ident" id="3823064">f</span><span class="op" id="3823065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823068">mantissa</span>&nbsp;<span class="op" id="3823077">:=</span>&nbsp;<span class="ident" id="3823080">bits</span>&nbsp;<span class="op" id="3823085">&amp;</span>&nbsp;<span class="op" id="3823087">(</span><span class="num" id="3823088">1</span><span class="op" id="3823089">&lt;&lt;</span><span class="num" id="3823091">52</span>&nbsp;<span class="op" id="3823094">-</span>&nbsp;<span class="num" id="3823096">1</span><span class="op" id="3823097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823100">exp</span>&nbsp;<span class="op" id="3823104">:=</span>&nbsp;<span class="builtintype" id="3823107">int</span><span class="op" id="3823110">(</span><span class="op" id="3823111">(</span><span class="ident" id="3823112">bits</span>&nbsp;<span class="op" id="3823117">&gt;&gt;</span>&nbsp;<span class="num" id="3823120">52</span><span class="op" id="3823122">)</span>&nbsp;<span class="op" id="3823124">&amp;</span>&nbsp;<span class="ident" id="3823126">expMask</span><span class="op" id="3823133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3823136">switch</span>&nbsp;<span class="ident" id="3823143">exp</span>&nbsp;<span class="op" id="3823147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3823150">case</span>&nbsp;<span class="ident" id="3823155">expMask</span><span class="op" id="3823162">:</span>&nbsp;<span class="comment" id="3823164">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3823180">return</span>&nbsp;<span class="ident" id="3823187">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3823192">case</span>&nbsp;<span class="num" id="3823197">0</span><span class="op" id="3823198">:</span>&nbsp;<span class="comment" id="3823200">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823214">exp</span>&nbsp;<span class="op" id="3823218">-=</span>&nbsp;<span class="num" id="3823221">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3823227">default</span><span class="op" id="3823234">:</span>&nbsp;<span class="comment" id="3823236">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823248">mantissa</span>&nbsp;<span class="op" id="3823257">|=</span>&nbsp;<span class="num" id="3823260">1</span>&nbsp;<span class="op" id="3823262">&lt;&lt;</span>&nbsp;<span class="num" id="3823265">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823270">exp</span>&nbsp;<span class="op" id="3823274">-=</span>&nbsp;<span class="num" id="3823277">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3823283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823287">shift</span>&nbsp;<span class="op" id="3823293">:=</span>&nbsp;<span class="num" id="3823296">52</span>&nbsp;<span class="op" id="3823299">-</span>&nbsp;<span class="ident" id="3823301">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3823307">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3823354">for</span>&nbsp;<span class="ident" id="3823358">mantissa</span><span class="op" id="3823366">&amp;</span><span class="num" id="3823367">1</span>&nbsp;<span class="op" id="3823369">==</span>&nbsp;<span class="num" id="3823372">0</span>&nbsp;<span class="op" id="3823374">&amp;&amp;</span>&nbsp;<span class="ident" id="3823377">shift</span>&nbsp;<span class="op" id="3823383">&gt;</span>&nbsp;<span class="num" id="3823385">0</span>&nbsp;<span class="op" id="3823387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823391">mantissa</span>&nbsp;<span class="op" id="3823400">&gt;&gt;=</span>&nbsp;<span class="num" id="3823404">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823408">shift</span><span class="op" id="3823413">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3823417">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823421">z</span><span class="op" id="3823422">.</span><span class="ident" id="3823423">a</span><span class="op" id="3823424">.</span><span class="ident" id="3823425">SetUint64</span><span class="op" id="3823434">(</span><span class="ident" id="3823435">mantissa</span><span class="op" id="3823443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823446">z</span><span class="op" id="3823447">.</span><span class="ident" id="3823448">a</span><span class="op" id="3823449">.</span><span class="ident" id="3823450">neg</span>&nbsp;<span class="op" id="3823454">=</span>&nbsp;<span class="ident" id="3823456">f</span>&nbsp;<span class="op" id="3823458">&lt;</span>&nbsp;<span class="num" id="3823460">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823463">z</span><span class="op" id="3823464">.</span><span class="ident" id="3823465">b</span><span class="op" id="3823466">.</span><span class="ident" id="3823467">Set</span><span class="op" id="3823470">(</span><span class="ident" id="3823471">intOne</span><span class="op" id="3823477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3823480">if</span>&nbsp;<span class="ident" id="3823483">shift</span>&nbsp;<span class="op" id="3823489">&gt;</span>&nbsp;<span class="num" id="3823491">0</span>&nbsp;<span class="op" id="3823493">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823497">z</span><span class="op" id="3823498">.</span><span class="ident" id="3823499">b</span><span class="op" id="3823500">.</span><span class="ident" id="3823501">Lsh</span><span class="op" id="3823504">(</span><span class="op" id="3823505">&amp;</span><span class="ident" id="3823506">z</span><span class="op" id="3823507">.</span><span class="ident" id="3823508">b</span><span class="op" id="3823509">,</span>&nbsp;<span class="builtintype" id="3823511">uint</span><span class="op" id="3823515">(</span><span class="ident" id="3823516">shift</span><span class="op" id="3823521">)</span><span class="op" id="3823522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3823525">}</span>&nbsp;<span class="keyword" id="3823527">else</span>&nbsp;<span class="op" id="3823532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823536">z</span><span class="op" id="3823537">.</span><span class="ident" id="3823538">a</span><span class="op" id="3823539">.</span><span class="ident" id="3823540">Lsh</span><span class="op" id="3823543">(</span><span class="op" id="3823544">&amp;</span><span class="ident" id="3823545">z</span><span class="op" id="3823546">.</span><span class="ident" id="3823547">a</span><span class="op" id="3823548">,</span>&nbsp;<span class="builtintype" id="3823550">uint</span><span class="op" id="3823554">(</span><span class="op" id="3823555">-</span><span class="ident" id="3823556">shift</span><span class="op" id="3823561">)</span><span class="op" id="3823562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3823565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3823568">return</span>&nbsp;<span class="ident" id="3823575">z</span><span class="op" id="3823576">.</span><span class="ident" id="3823577">norm</span><span class="op" id="3823581">(</span><span class="op" id="3823582">)</span><br>
<span class="lineno">65</span><span class="op" id="3823584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3823587">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3823643">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3823698">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="3823751">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3823816">func</span>&nbsp;<span class="ident" id="3823821">quotToFloat32</span><span class="op" id="3823834">(</span><span class="ident" id="3823835">a</span><span class="op" id="3823836">,</span>&nbsp;<span class="ident" id="3823838">b</span>&nbsp;<span class="ident" id="3823840">nat</span><span class="op" id="3823843">)</span>&nbsp;<span class="op" id="3823845">(</span><span class="ident" id="3823846">f</span>&nbsp;<span class="builtintype" id="3823848">float32</span><span class="op" id="3823855">,</span>&nbsp;<span class="ident" id="3823857">exact</span>&nbsp;<span class="builtintype" id="3823863">bool</span><span class="op" id="3823867">)</span>&nbsp;<span class="op" id="3823869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3823872">const</span>&nbsp;<span class="op" id="3823878">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3823882">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823906">Fsize</span>&nbsp;<span class="op" id="3823912">=</span>&nbsp;<span class="num" id="3823914">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3823920">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823934">Msize</span>&nbsp;&nbsp;<span class="op" id="3823941">=</span>&nbsp;<span class="num" id="3823943">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823948">Msize1</span>&nbsp;<span class="op" id="3823955">=</span>&nbsp;<span class="ident" id="3823957">Msize</span>&nbsp;<span class="op" id="3823963">+</span>&nbsp;<span class="num" id="3823965">1</span>&nbsp;<span class="comment" id="3823967">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3823989">Msize2</span>&nbsp;<span class="op" id="3823996">=</span>&nbsp;<span class="ident" id="3823998">Msize1</span>&nbsp;<span class="op" id="3824005">+</span>&nbsp;<span class="num" id="3824007">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3824012">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3824026">Esize</span>&nbsp;<span class="op" id="3824032">=</span>&nbsp;<span class="ident" id="3824034">Fsize</span>&nbsp;<span class="op" id="3824040">-</span>&nbsp;<span class="ident" id="3824042">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3824051">Ebias</span>&nbsp;<span class="op" id="3824057">=</span>&nbsp;<span class="num" id="3824059">1</span><span class="op" id="3824060">&lt;&lt;</span><span class="op" id="3824062">(</span><span class="ident" id="3824063">Esize</span><span class="op" id="3824068">-</span><span class="num" id="3824069">1</span><span class="op" id="3824070">)</span>&nbsp;<span class="op" id="3824072">-</span>&nbsp;<span class="num" id="3824074">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3824078">Emin</span>&nbsp;&nbsp;<span class="op" id="3824084">=</span>&nbsp;<span class="num" id="3824086">1</span>&nbsp;<span class="op" id="3824088">-</span>&nbsp;<span class="ident" id="3824090">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3824098">Emax</span>&nbsp;&nbsp;<span class="op" id="3824104">=</span>&nbsp;<span class="ident" id="3824106">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3824113">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3824117">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3824188">alen</span>&nbsp;<span class="op" id="3824193">:=</span>&nbsp;<span class="ident" id="3824196">a</span><span class="op" id="3824197">.</span><span class="ident" id="3824198">bitLen</span><span class="op" id="3824204">(</span><span class="op" id="3824205">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3824208">if</span>&nbsp;<span class="ident" id="3824211">alen</span>&nbsp;<span class="op" id="3824216">==</span>&nbsp;<span class="num" id="3824219">0</span>&nbsp;<span class="op" id="3824221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3824225">return</span>&nbsp;<span class="num" id="3824232">0</span><span class="op" id="3824233">,</span>&nbsp;<span class="builtintype" id="3824235">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3824241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3824244">blen</span>&nbsp;<span class="op" id="3824249">:=</span>&nbsp;<span class="ident" id="3824252">b</span><span class="op" id="3824253">.</span><span class="ident" id="3824254">bitLen</span><span class="op" id="3824260">(</span><span class="op" id="3824261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3824264">if</span>&nbsp;<span class="ident" id="3824267">blen</span>&nbsp;<span class="op" id="3824272">==</span>&nbsp;<span class="num" id="3824275">0</span>&nbsp;<span class="op" id="3824277">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3824281">panic</span><span class="op" id="3824286">(</span><span class="string" id="3824287">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3824305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3824308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3824312">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3824392">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3824472">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3824544">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3824606">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3824668">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3824735">exp</span>&nbsp;<span class="op" id="3824739">:=</span>&nbsp;<span class="ident" id="3824742">alen</span>&nbsp;<span class="op" id="3824747">-</span>&nbsp;<span class="ident" id="3824749">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3824755">var</span>&nbsp;<span class="ident" id="3824759">a2</span><span class="op" id="3824761">,</span>&nbsp;<span class="ident" id="3824763">b2</span>&nbsp;<span class="ident" id="3824766">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3824771">a2</span>&nbsp;<span class="op" id="3824774">=</span>&nbsp;<span class="ident" id="3824776">a2</span><span class="op" id="3824778">.</span><span class="ident" id="3824779">set</span><span class="op" id="3824782">(</span><span class="ident" id="3824783">a</span><span class="op" id="3824784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3824787">b2</span>&nbsp;<span class="op" id="3824790">=</span>&nbsp;<span class="ident" id="3824792">b2</span><span class="op" id="3824794">.</span><span class="ident" id="3824795">set</span><span class="op" id="3824798">(</span><span class="ident" id="3824799">b</span><span class="op" id="3824800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3824803">if</span>&nbsp;<span class="ident" id="3824806">shift</span>&nbsp;<span class="op" id="3824812">:=</span>&nbsp;<span class="ident" id="3824815">Msize2</span>&nbsp;<span class="op" id="3824822">-</span>&nbsp;<span class="ident" id="3824824">exp</span><span class="op" id="3824827">;</span>&nbsp;<span class="ident" id="3824829">shift</span>&nbsp;<span class="op" id="3824835">&gt;</span>&nbsp;<span class="num" id="3824837">0</span>&nbsp;<span class="op" id="3824839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3824843">a2</span>&nbsp;<span class="op" id="3824846">=</span>&nbsp;<span class="ident" id="3824848">a2</span><span class="op" id="3824850">.</span><span class="ident" id="3824851">shl</span><span class="op" id="3824854">(</span><span class="ident" id="3824855">a2</span><span class="op" id="3824857">,</span>&nbsp;<span class="builtintype" id="3824859">uint</span><span class="op" id="3824863">(</span><span class="ident" id="3824864">shift</span><span class="op" id="3824869">)</span><span class="op" id="3824870">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3824873">}</span>&nbsp;<span class="keyword" id="3824875">else</span>&nbsp;<span class="keyword" id="3824880">if</span>&nbsp;<span class="ident" id="3824883">shift</span>&nbsp;<span class="op" id="3824889">&lt;</span>&nbsp;<span class="num" id="3824891">0</span>&nbsp;<span class="op" id="3824893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3824897">b2</span>&nbsp;<span class="op" id="3824900">=</span>&nbsp;<span class="ident" id="3824902">b2</span><span class="op" id="3824904">.</span><span class="ident" id="3824905">shl</span><span class="op" id="3824908">(</span><span class="ident" id="3824909">b2</span><span class="op" id="3824911">,</span>&nbsp;<span class="builtintype" id="3824913">uint</span><span class="op" id="3824917">(</span><span class="op" id="3824918">-</span><span class="ident" id="3824919">shift</span><span class="op" id="3824924">)</span><span class="op" id="3824925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3824928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3824932">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3824994">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3825051">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3825076">var</span>&nbsp;<span class="ident" id="3825080">q</span>&nbsp;<span class="ident" id="3825082">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825087">q</span><span class="op" id="3825088">,</span>&nbsp;<span class="ident" id="3825090">r</span>&nbsp;<span class="op" id="3825092">:=</span>&nbsp;<span class="ident" id="3825095">q</span><span class="op" id="3825096">.</span><span class="ident" id="3825097">div</span><span class="op" id="3825100">(</span><span class="ident" id="3825101">a2</span><span class="op" id="3825103">,</span>&nbsp;<span class="ident" id="3825105">a2</span><span class="op" id="3825107">,</span>&nbsp;<span class="ident" id="3825109">b2</span><span class="op" id="3825111">)</span>&nbsp;<span class="comment" id="3825113">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825130">mantissa</span>&nbsp;<span class="op" id="3825139">:=</span>&nbsp;<span class="ident" id="3825142">low32</span><span class="op" id="3825147">(</span><span class="ident" id="3825148">q</span><span class="op" id="3825149">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825152">haveRem</span>&nbsp;<span class="op" id="3825160">:=</span>&nbsp;<span class="builtinfunc" id="3825163">len</span><span class="op" id="3825166">(</span><span class="ident" id="3825167">r</span><span class="op" id="3825168">)</span>&nbsp;<span class="op" id="3825170">&gt;</span>&nbsp;<span class="num" id="3825172">0</span>&nbsp;<span class="comment" id="3825174">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3825231">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3825300">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3825352">if</span>&nbsp;<span class="ident" id="3825355">mantissa</span><span class="op" id="3825363">&gt;&gt;</span><span class="ident" id="3825365">Msize2</span>&nbsp;<span class="op" id="3825372">==</span>&nbsp;<span class="num" id="3825375">1</span>&nbsp;<span class="op" id="3825377">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3825381">if</span>&nbsp;<span class="ident" id="3825384">mantissa</span><span class="op" id="3825392">&amp;</span><span class="num" id="3825393">1</span>&nbsp;<span class="op" id="3825395">==</span>&nbsp;<span class="num" id="3825398">1</span>&nbsp;<span class="op" id="3825400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825405">haveRem</span>&nbsp;<span class="op" id="3825413">=</span>&nbsp;<span class="builtintype" id="3825415">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3825422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825426">mantissa</span>&nbsp;<span class="op" id="3825435">&gt;&gt;=</span>&nbsp;<span class="num" id="3825439">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825443">exp</span><span class="op" id="3825446">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3825450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3825453">if</span>&nbsp;<span class="ident" id="3825456">mantissa</span><span class="op" id="3825464">&gt;&gt;</span><span class="ident" id="3825466">Msize1</span>&nbsp;<span class="op" id="3825473">!=</span>&nbsp;<span class="num" id="3825476">1</span>&nbsp;<span class="op" id="3825478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3825482">panic</span><span class="op" id="3825487">(</span><span class="ident" id="3825488">fmt</span><span class="op" id="3825491">.</span><span class="ident" id="3825492">Sprintf</span><span class="op" id="3825499">(</span><span class="string" id="3825500">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3825536">,</span>&nbsp;<span class="ident" id="3825538">Msize2</span><span class="op" id="3825544">)</span><span class="op" id="3825545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3825548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3825552">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3825569">if</span>&nbsp;<span class="ident" id="3825572">Emin</span><span class="op" id="3825576">-</span><span class="ident" id="3825577">Msize</span>&nbsp;<span class="op" id="3825583">&lt;=</span>&nbsp;<span class="ident" id="3825586">exp</span>&nbsp;<span class="op" id="3825590">&amp;&amp;</span>&nbsp;<span class="ident" id="3825593">exp</span>&nbsp;<span class="op" id="3825597">&lt;=</span>&nbsp;<span class="ident" id="3825600">Emin</span>&nbsp;<span class="op" id="3825605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3825609">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825661">shift</span>&nbsp;<span class="op" id="3825667">:=</span>&nbsp;<span class="builtintype" id="3825670">uint</span><span class="op" id="3825674">(</span><span class="ident" id="3825675">Emin</span>&nbsp;<span class="op" id="3825680">-</span>&nbsp;<span class="op" id="3825682">(</span><span class="ident" id="3825683">exp</span>&nbsp;<span class="op" id="3825687">-</span>&nbsp;<span class="num" id="3825689">1</span><span class="op" id="3825690">)</span><span class="op" id="3825691">)</span>&nbsp;<span class="comment" id="3825693">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825710">lostbits</span>&nbsp;<span class="op" id="3825719">:=</span>&nbsp;<span class="ident" id="3825722">mantissa</span>&nbsp;<span class="op" id="3825731">&amp;</span>&nbsp;<span class="op" id="3825733">(</span><span class="num" id="3825734">1</span><span class="op" id="3825735">&lt;&lt;</span><span class="ident" id="3825737">shift</span>&nbsp;<span class="op" id="3825743">-</span>&nbsp;<span class="num" id="3825745">1</span><span class="op" id="3825746">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825750">haveRem</span>&nbsp;<span class="op" id="3825758">=</span>&nbsp;<span class="ident" id="3825760">haveRem</span>&nbsp;<span class="op" id="3825768">||</span>&nbsp;<span class="ident" id="3825771">lostbits</span>&nbsp;<span class="op" id="3825780">!=</span>&nbsp;<span class="num" id="3825783">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825787">mantissa</span>&nbsp;<span class="op" id="3825796">&gt;&gt;=</span>&nbsp;<span class="ident" id="3825800">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825808">exp</span>&nbsp;<span class="op" id="3825812">=</span>&nbsp;<span class="num" id="3825814">2</span>&nbsp;<span class="op" id="3825816">-</span>&nbsp;<span class="ident" id="3825818">Ebias</span>&nbsp;<span class="comment" id="3825824">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3825843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3825846">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825884">exact</span>&nbsp;<span class="op" id="3825890">=</span>&nbsp;<span class="op" id="3825892">!</span><span class="ident" id="3825893">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3825902">if</span>&nbsp;<span class="ident" id="3825905">mantissa</span><span class="op" id="3825913">&amp;</span><span class="num" id="3825914">1</span>&nbsp;<span class="op" id="3825916">!=</span>&nbsp;<span class="num" id="3825919">0</span>&nbsp;<span class="op" id="3825921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3825925">exact</span>&nbsp;<span class="op" id="3825931">=</span>&nbsp;<span class="builtintype" id="3825933">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3825941">if</span>&nbsp;<span class="ident" id="3825944">haveRem</span>&nbsp;<span class="op" id="3825952">||</span>&nbsp;<span class="ident" id="3825955">mantissa</span><span class="op" id="3825963">&amp;</span><span class="num" id="3825964">2</span>&nbsp;<span class="op" id="3825966">!=</span>&nbsp;<span class="num" id="3825969">0</span>&nbsp;<span class="op" id="3825971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3825976">if</span>&nbsp;<span class="ident" id="3825979">mantissa</span><span class="op" id="3825987">++</span><span class="op" id="3825989">;</span>&nbsp;<span class="ident" id="3825991">mantissa</span>&nbsp;<span class="op" id="3826000">&gt;=</span>&nbsp;<span class="num" id="3826003">1</span><span class="op" id="3826004">&lt;&lt;</span><span class="ident" id="3826006">Msize2</span>&nbsp;<span class="op" id="3826013">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3826019">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826080">mantissa</span>&nbsp;<span class="op" id="3826089">&gt;&gt;=</span>&nbsp;<span class="num" id="3826093">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826099">exp</span><span class="op" id="3826102">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3826108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3826112">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3826115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826118">mantissa</span>&nbsp;<span class="op" id="3826127">&gt;&gt;=</span>&nbsp;<span class="num" id="3826131">1</span>&nbsp;<span class="comment" id="3826133">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826195">f</span>&nbsp;<span class="op" id="3826197">=</span>&nbsp;<span class="builtintype" id="3826199">float32</span><span class="op" id="3826206">(</span><span class="ident" id="3826207">math</span><span class="op" id="3826211">.</span><span class="ident" id="3826212">Ldexp</span><span class="op" id="3826217">(</span><span class="builtintype" id="3826218">float64</span><span class="op" id="3826225">(</span><span class="ident" id="3826226">mantissa</span><span class="op" id="3826234">)</span><span class="op" id="3826235">,</span>&nbsp;<span class="ident" id="3826237">exp</span><span class="op" id="3826240">-</span><span class="ident" id="3826241">Msize1</span><span class="op" id="3826247">)</span><span class="op" id="3826248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3826251">if</span>&nbsp;<span class="ident" id="3826254">math</span><span class="op" id="3826258">.</span><span class="ident" id="3826259">IsInf</span><span class="op" id="3826264">(</span><span class="builtintype" id="3826265">float64</span><span class="op" id="3826272">(</span><span class="ident" id="3826273">f</span><span class="op" id="3826274">)</span><span class="op" id="3826275">,</span>&nbsp;<span class="num" id="3826277">0</span><span class="op" id="3826278">)</span>&nbsp;<span class="op" id="3826280">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826284">exact</span>&nbsp;<span class="op" id="3826290">=</span>&nbsp;<span class="builtintype" id="3826292">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3826299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3826302">return</span><br>
<span class="lineno"></span><span class="op" id="3826309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3826312">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3826368">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3826423">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="3826476">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3826541">func</span>&nbsp;<span class="ident" id="3826546">quotToFloat64</span><span class="op" id="3826559">(</span><span class="ident" id="3826560">a</span><span class="op" id="3826561">,</span>&nbsp;<span class="ident" id="3826563">b</span>&nbsp;<span class="ident" id="3826565">nat</span><span class="op" id="3826568">)</span>&nbsp;<span class="op" id="3826570">(</span><span class="ident" id="3826571">f</span>&nbsp;<span class="builtintype" id="3826573">float64</span><span class="op" id="3826580">,</span>&nbsp;<span class="ident" id="3826582">exact</span>&nbsp;<span class="builtintype" id="3826588">bool</span><span class="op" id="3826592">)</span>&nbsp;<span class="op" id="3826594">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3826597">const</span>&nbsp;<span class="op" id="3826603">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3826607">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826631">Fsize</span>&nbsp;<span class="op" id="3826637">=</span>&nbsp;<span class="num" id="3826639">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3826645">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826659">Msize</span>&nbsp;&nbsp;<span class="op" id="3826666">=</span>&nbsp;<span class="num" id="3826668">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826673">Msize1</span>&nbsp;<span class="op" id="3826680">=</span>&nbsp;<span class="ident" id="3826682">Msize</span>&nbsp;<span class="op" id="3826688">+</span>&nbsp;<span class="num" id="3826690">1</span>&nbsp;<span class="comment" id="3826692">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826714">Msize2</span>&nbsp;<span class="op" id="3826721">=</span>&nbsp;<span class="ident" id="3826723">Msize1</span>&nbsp;<span class="op" id="3826730">+</span>&nbsp;<span class="num" id="3826732">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3826737">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826751">Esize</span>&nbsp;<span class="op" id="3826757">=</span>&nbsp;<span class="ident" id="3826759">Fsize</span>&nbsp;<span class="op" id="3826765">-</span>&nbsp;<span class="ident" id="3826767">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826776">Ebias</span>&nbsp;<span class="op" id="3826782">=</span>&nbsp;<span class="num" id="3826784">1</span><span class="op" id="3826785">&lt;&lt;</span><span class="op" id="3826787">(</span><span class="ident" id="3826788">Esize</span><span class="op" id="3826793">-</span><span class="num" id="3826794">1</span><span class="op" id="3826795">)</span>&nbsp;<span class="op" id="3826797">-</span>&nbsp;<span class="num" id="3826799">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826803">Emin</span>&nbsp;&nbsp;<span class="op" id="3826809">=</span>&nbsp;<span class="num" id="3826811">1</span>&nbsp;<span class="op" id="3826813">-</span>&nbsp;<span class="ident" id="3826815">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826823">Emax</span>&nbsp;&nbsp;<span class="op" id="3826829">=</span>&nbsp;<span class="ident" id="3826831">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3826838">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3826842">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826913">alen</span>&nbsp;<span class="op" id="3826918">:=</span>&nbsp;<span class="ident" id="3826921">a</span><span class="op" id="3826922">.</span><span class="ident" id="3826923">bitLen</span><span class="op" id="3826929">(</span><span class="op" id="3826930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3826933">if</span>&nbsp;<span class="ident" id="3826936">alen</span>&nbsp;<span class="op" id="3826941">==</span>&nbsp;<span class="num" id="3826944">0</span>&nbsp;<span class="op" id="3826946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3826950">return</span>&nbsp;<span class="num" id="3826957">0</span><span class="op" id="3826958">,</span>&nbsp;<span class="builtintype" id="3826960">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3826966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3826969">blen</span>&nbsp;<span class="op" id="3826974">:=</span>&nbsp;<span class="ident" id="3826977">b</span><span class="op" id="3826978">.</span><span class="ident" id="3826979">bitLen</span><span class="op" id="3826985">(</span><span class="op" id="3826986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3826989">if</span>&nbsp;<span class="ident" id="3826992">blen</span>&nbsp;<span class="op" id="3826997">==</span>&nbsp;<span class="num" id="3827000">0</span>&nbsp;<span class="op" id="3827002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3827006">panic</span><span class="op" id="3827011">(</span><span class="string" id="3827012">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3827030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3827033">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3827037">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3827117">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3827197">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3827269">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3827331">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3827393">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3827460">exp</span>&nbsp;<span class="op" id="3827464">:=</span>&nbsp;<span class="ident" id="3827467">alen</span>&nbsp;<span class="op" id="3827472">-</span>&nbsp;<span class="ident" id="3827474">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3827480">var</span>&nbsp;<span class="ident" id="3827484">a2</span><span class="op" id="3827486">,</span>&nbsp;<span class="ident" id="3827488">b2</span>&nbsp;<span class="ident" id="3827491">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3827496">a2</span>&nbsp;<span class="op" id="3827499">=</span>&nbsp;<span class="ident" id="3827501">a2</span><span class="op" id="3827503">.</span><span class="ident" id="3827504">set</span><span class="op" id="3827507">(</span><span class="ident" id="3827508">a</span><span class="op" id="3827509">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3827512">b2</span>&nbsp;<span class="op" id="3827515">=</span>&nbsp;<span class="ident" id="3827517">b2</span><span class="op" id="3827519">.</span><span class="ident" id="3827520">set</span><span class="op" id="3827523">(</span><span class="ident" id="3827524">b</span><span class="op" id="3827525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3827528">if</span>&nbsp;<span class="ident" id="3827531">shift</span>&nbsp;<span class="op" id="3827537">:=</span>&nbsp;<span class="ident" id="3827540">Msize2</span>&nbsp;<span class="op" id="3827547">-</span>&nbsp;<span class="ident" id="3827549">exp</span><span class="op" id="3827552">;</span>&nbsp;<span class="ident" id="3827554">shift</span>&nbsp;<span class="op" id="3827560">&gt;</span>&nbsp;<span class="num" id="3827562">0</span>&nbsp;<span class="op" id="3827564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3827568">a2</span>&nbsp;<span class="op" id="3827571">=</span>&nbsp;<span class="ident" id="3827573">a2</span><span class="op" id="3827575">.</span><span class="ident" id="3827576">shl</span><span class="op" id="3827579">(</span><span class="ident" id="3827580">a2</span><span class="op" id="3827582">,</span>&nbsp;<span class="builtintype" id="3827584">uint</span><span class="op" id="3827588">(</span><span class="ident" id="3827589">shift</span><span class="op" id="3827594">)</span><span class="op" id="3827595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3827598">}</span>&nbsp;<span class="keyword" id="3827600">else</span>&nbsp;<span class="keyword" id="3827605">if</span>&nbsp;<span class="ident" id="3827608">shift</span>&nbsp;<span class="op" id="3827614">&lt;</span>&nbsp;<span class="num" id="3827616">0</span>&nbsp;<span class="op" id="3827618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3827622">b2</span>&nbsp;<span class="op" id="3827625">=</span>&nbsp;<span class="ident" id="3827627">b2</span><span class="op" id="3827629">.</span><span class="ident" id="3827630">shl</span><span class="op" id="3827633">(</span><span class="ident" id="3827634">b2</span><span class="op" id="3827636">,</span>&nbsp;<span class="builtintype" id="3827638">uint</span><span class="op" id="3827642">(</span><span class="op" id="3827643">-</span><span class="ident" id="3827644">shift</span><span class="op" id="3827649">)</span><span class="op" id="3827650">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3827653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3827657">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3827719">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3827776">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3827801">var</span>&nbsp;<span class="ident" id="3827805">q</span>&nbsp;<span class="ident" id="3827807">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3827812">q</span><span class="op" id="3827813">,</span>&nbsp;<span class="ident" id="3827815">r</span>&nbsp;<span class="op" id="3827817">:=</span>&nbsp;<span class="ident" id="3827820">q</span><span class="op" id="3827821">.</span><span class="ident" id="3827822">div</span><span class="op" id="3827825">(</span><span class="ident" id="3827826">a2</span><span class="op" id="3827828">,</span>&nbsp;<span class="ident" id="3827830">a2</span><span class="op" id="3827832">,</span>&nbsp;<span class="ident" id="3827834">b2</span><span class="op" id="3827836">)</span>&nbsp;<span class="comment" id="3827838">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3827855">mantissa</span>&nbsp;<span class="op" id="3827864">:=</span>&nbsp;<span class="ident" id="3827867">low64</span><span class="op" id="3827872">(</span><span class="ident" id="3827873">q</span><span class="op" id="3827874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3827877">haveRem</span>&nbsp;<span class="op" id="3827885">:=</span>&nbsp;<span class="builtinfunc" id="3827888">len</span><span class="op" id="3827891">(</span><span class="ident" id="3827892">r</span><span class="op" id="3827893">)</span>&nbsp;<span class="op" id="3827895">&gt;</span>&nbsp;<span class="num" id="3827897">0</span>&nbsp;<span class="comment" id="3827899">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3827956">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3828025">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3828077">if</span>&nbsp;<span class="ident" id="3828080">mantissa</span><span class="op" id="3828088">&gt;&gt;</span><span class="ident" id="3828090">Msize2</span>&nbsp;<span class="op" id="3828097">==</span>&nbsp;<span class="num" id="3828100">1</span>&nbsp;<span class="op" id="3828102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3828106">if</span>&nbsp;<span class="ident" id="3828109">mantissa</span><span class="op" id="3828117">&amp;</span><span class="num" id="3828118">1</span>&nbsp;<span class="op" id="3828120">==</span>&nbsp;<span class="num" id="3828123">1</span>&nbsp;<span class="op" id="3828125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828130">haveRem</span>&nbsp;<span class="op" id="3828138">=</span>&nbsp;<span class="builtintype" id="3828140">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3828147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828151">mantissa</span>&nbsp;<span class="op" id="3828160">&gt;&gt;=</span>&nbsp;<span class="num" id="3828164">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828168">exp</span><span class="op" id="3828171">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3828175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3828178">if</span>&nbsp;<span class="ident" id="3828181">mantissa</span><span class="op" id="3828189">&gt;&gt;</span><span class="ident" id="3828191">Msize1</span>&nbsp;<span class="op" id="3828198">!=</span>&nbsp;<span class="num" id="3828201">1</span>&nbsp;<span class="op" id="3828203">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3828207">panic</span><span class="op" id="3828212">(</span><span class="ident" id="3828213">fmt</span><span class="op" id="3828216">.</span><span class="ident" id="3828217">Sprintf</span><span class="op" id="3828224">(</span><span class="string" id="3828225">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3828261">,</span>&nbsp;<span class="ident" id="3828263">Msize2</span><span class="op" id="3828269">)</span><span class="op" id="3828270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3828273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3828277">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3828294">if</span>&nbsp;<span class="ident" id="3828297">Emin</span><span class="op" id="3828301">-</span><span class="ident" id="3828302">Msize</span>&nbsp;<span class="op" id="3828308">&lt;=</span>&nbsp;<span class="ident" id="3828311">exp</span>&nbsp;<span class="op" id="3828315">&amp;&amp;</span>&nbsp;<span class="ident" id="3828318">exp</span>&nbsp;<span class="op" id="3828322">&lt;=</span>&nbsp;<span class="ident" id="3828325">Emin</span>&nbsp;<span class="op" id="3828330">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3828334">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828386">shift</span>&nbsp;<span class="op" id="3828392">:=</span>&nbsp;<span class="builtintype" id="3828395">uint</span><span class="op" id="3828399">(</span><span class="ident" id="3828400">Emin</span>&nbsp;<span class="op" id="3828405">-</span>&nbsp;<span class="op" id="3828407">(</span><span class="ident" id="3828408">exp</span>&nbsp;<span class="op" id="3828412">-</span>&nbsp;<span class="num" id="3828414">1</span><span class="op" id="3828415">)</span><span class="op" id="3828416">)</span>&nbsp;<span class="comment" id="3828418">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828435">lostbits</span>&nbsp;<span class="op" id="3828444">:=</span>&nbsp;<span class="ident" id="3828447">mantissa</span>&nbsp;<span class="op" id="3828456">&amp;</span>&nbsp;<span class="op" id="3828458">(</span><span class="num" id="3828459">1</span><span class="op" id="3828460">&lt;&lt;</span><span class="ident" id="3828462">shift</span>&nbsp;<span class="op" id="3828468">-</span>&nbsp;<span class="num" id="3828470">1</span><span class="op" id="3828471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828475">haveRem</span>&nbsp;<span class="op" id="3828483">=</span>&nbsp;<span class="ident" id="3828485">haveRem</span>&nbsp;<span class="op" id="3828493">||</span>&nbsp;<span class="ident" id="3828496">lostbits</span>&nbsp;<span class="op" id="3828505">!=</span>&nbsp;<span class="num" id="3828508">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828512">mantissa</span>&nbsp;<span class="op" id="3828521">&gt;&gt;=</span>&nbsp;<span class="ident" id="3828525">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828533">exp</span>&nbsp;<span class="op" id="3828537">=</span>&nbsp;<span class="num" id="3828539">2</span>&nbsp;<span class="op" id="3828541">-</span>&nbsp;<span class="ident" id="3828543">Ebias</span>&nbsp;<span class="comment" id="3828549">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3828568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3828571">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828609">exact</span>&nbsp;<span class="op" id="3828615">=</span>&nbsp;<span class="op" id="3828617">!</span><span class="ident" id="3828618">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3828627">if</span>&nbsp;<span class="ident" id="3828630">mantissa</span><span class="op" id="3828638">&amp;</span><span class="num" id="3828639">1</span>&nbsp;<span class="op" id="3828641">!=</span>&nbsp;<span class="num" id="3828644">0</span>&nbsp;<span class="op" id="3828646">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828650">exact</span>&nbsp;<span class="op" id="3828656">=</span>&nbsp;<span class="builtintype" id="3828658">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3828666">if</span>&nbsp;<span class="ident" id="3828669">haveRem</span>&nbsp;<span class="op" id="3828677">||</span>&nbsp;<span class="ident" id="3828680">mantissa</span><span class="op" id="3828688">&amp;</span><span class="num" id="3828689">2</span>&nbsp;<span class="op" id="3828691">!=</span>&nbsp;<span class="num" id="3828694">0</span>&nbsp;<span class="op" id="3828696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3828701">if</span>&nbsp;<span class="ident" id="3828704">mantissa</span><span class="op" id="3828712">++</span><span class="op" id="3828714">;</span>&nbsp;<span class="ident" id="3828716">mantissa</span>&nbsp;<span class="op" id="3828725">&gt;=</span>&nbsp;<span class="num" id="3828728">1</span><span class="op" id="3828729">&lt;&lt;</span><span class="ident" id="3828731">Msize2</span>&nbsp;<span class="op" id="3828738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3828744">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828805">mantissa</span>&nbsp;<span class="op" id="3828814">&gt;&gt;=</span>&nbsp;<span class="num" id="3828818">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828824">exp</span><span class="op" id="3828827">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3828833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3828837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3828840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828843">mantissa</span>&nbsp;<span class="op" id="3828852">&gt;&gt;=</span>&nbsp;<span class="num" id="3828856">1</span>&nbsp;<span class="comment" id="3828858">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828920">f</span>&nbsp;<span class="op" id="3828922">=</span>&nbsp;<span class="ident" id="3828924">math</span><span class="op" id="3828928">.</span><span class="ident" id="3828929">Ldexp</span><span class="op" id="3828934">(</span><span class="builtintype" id="3828935">float64</span><span class="op" id="3828942">(</span><span class="ident" id="3828943">mantissa</span><span class="op" id="3828951">)</span><span class="op" id="3828952">,</span>&nbsp;<span class="ident" id="3828954">exp</span><span class="op" id="3828957">-</span><span class="ident" id="3828958">Msize1</span><span class="op" id="3828964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3828967">if</span>&nbsp;<span class="ident" id="3828970">math</span><span class="op" id="3828974">.</span><span class="ident" id="3828975">IsInf</span><span class="op" id="3828980">(</span><span class="ident" id="3828981">f</span><span class="op" id="3828982">,</span>&nbsp;<span class="num" id="3828984">0</span><span class="op" id="3828985">)</span>&nbsp;<span class="op" id="3828987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3828991">exact</span>&nbsp;<span class="op" id="3828997">=</span>&nbsp;<span class="builtintype" id="3828999">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3829006">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3829009">return</span><br>
<span class="lineno"></span><span class="op" id="3829016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3829019">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3829092">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="3829165">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3829234">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3829297">func</span>&nbsp;<span class="op" id="3829302">(</span><span class="ident" id="3829303">x</span>&nbsp;<span class="op" id="3829305">*</span><span class="ident" id="3829306">Rat</span><span class="op" id="3829309">)</span>&nbsp;<span class="ident" id="3829311">Float32</span><span class="op" id="3829318">(</span><span class="op" id="3829319">)</span>&nbsp;<span class="op" id="3829321">(</span><span class="ident" id="3829322">f</span>&nbsp;<span class="builtintype" id="3829324">float32</span><span class="op" id="3829331">,</span>&nbsp;<span class="ident" id="3829333">exact</span>&nbsp;<span class="builtintype" id="3829339">bool</span><span class="op" id="3829343">)</span>&nbsp;<span class="op" id="3829345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3829348">b</span>&nbsp;<span class="op" id="3829350">:=</span>&nbsp;<span class="ident" id="3829353">x</span><span class="op" id="3829354">.</span><span class="ident" id="3829355">b</span><span class="op" id="3829356">.</span><span class="ident" id="3829357">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3829362">if</span>&nbsp;<span class="builtinfunc" id="3829365">len</span><span class="op" id="3829368">(</span><span class="ident" id="3829369">b</span><span class="op" id="3829370">)</span>&nbsp;<span class="op" id="3829372">==</span>&nbsp;<span class="num" id="3829375">0</span>&nbsp;<span class="op" id="3829377">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3829381">b</span>&nbsp;<span class="op" id="3829383">=</span>&nbsp;<span class="ident" id="3829385">b</span><span class="op" id="3829386">.</span><span class="ident" id="3829387">set</span><span class="op" id="3829390">(</span><span class="ident" id="3829391">natOne</span><span class="op" id="3829397">)</span>&nbsp;<span class="comment" id="3829399">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3829427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3829430">f</span><span class="op" id="3829431">,</span>&nbsp;<span class="ident" id="3829433">exact</span>&nbsp;<span class="op" id="3829439">=</span>&nbsp;<span class="ident" id="3829441">quotToFloat32</span><span class="op" id="3829454">(</span><span class="ident" id="3829455">x</span><span class="op" id="3829456">.</span><span class="ident" id="3829457">a</span><span class="op" id="3829458">.</span><span class="ident" id="3829459">abs</span><span class="op" id="3829462">,</span>&nbsp;<span class="ident" id="3829464">b</span><span class="op" id="3829465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3829468">if</span>&nbsp;<span class="ident" id="3829471">x</span><span class="op" id="3829472">.</span><span class="ident" id="3829473">a</span><span class="op" id="3829474">.</span><span class="ident" id="3829475">neg</span>&nbsp;<span class="op" id="3829479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3829483">f</span>&nbsp;<span class="op" id="3829485">=</span>&nbsp;<span class="op" id="3829487">-</span><span class="ident" id="3829488">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3829491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3829494">return</span><br>
<span class="lineno"></span><span class="op" id="3829501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3829504">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="3829577">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3829650">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3829719">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3829782">func</span>&nbsp;<span class="op" id="3829787">(</span><span class="ident" id="3829788">x</span>&nbsp;<span class="op" id="3829790">*</span><span class="ident" id="3829791">Rat</span><span class="op" id="3829794">)</span>&nbsp;<span class="ident" id="3829796">Float64</span><span class="op" id="3829803">(</span><span class="op" id="3829804">)</span>&nbsp;<span class="op" id="3829806">(</span><span class="ident" id="3829807">f</span>&nbsp;<span class="builtintype" id="3829809">float64</span><span class="op" id="3829816">,</span>&nbsp;<span class="ident" id="3829818">exact</span>&nbsp;<span class="builtintype" id="3829824">bool</span><span class="op" id="3829828">)</span>&nbsp;<span class="op" id="3829830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3829833">b</span>&nbsp;<span class="op" id="3829835">:=</span>&nbsp;<span class="ident" id="3829838">x</span><span class="op" id="3829839">.</span><span class="ident" id="3829840">b</span><span class="op" id="3829841">.</span><span class="ident" id="3829842">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3829847">if</span>&nbsp;<span class="builtinfunc" id="3829850">len</span><span class="op" id="3829853">(</span><span class="ident" id="3829854">b</span><span class="op" id="3829855">)</span>&nbsp;<span class="op" id="3829857">==</span>&nbsp;<span class="num" id="3829860">0</span>&nbsp;<span class="op" id="3829862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3829866">b</span>&nbsp;<span class="op" id="3829868">=</span>&nbsp;<span class="ident" id="3829870">b</span><span class="op" id="3829871">.</span><span class="ident" id="3829872">set</span><span class="op" id="3829875">(</span><span class="ident" id="3829876">natOne</span><span class="op" id="3829882">)</span>&nbsp;<span class="comment" id="3829884">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3829912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3829915">f</span><span class="op" id="3829916">,</span>&nbsp;<span class="ident" id="3829918">exact</span>&nbsp;<span class="op" id="3829924">=</span>&nbsp;<span class="ident" id="3829926">quotToFloat64</span><span class="op" id="3829939">(</span><span class="ident" id="3829940">x</span><span class="op" id="3829941">.</span><span class="ident" id="3829942">a</span><span class="op" id="3829943">.</span><span class="ident" id="3829944">abs</span><span class="op" id="3829947">,</span>&nbsp;<span class="ident" id="3829949">b</span><span class="op" id="3829950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3829953">if</span>&nbsp;<span class="ident" id="3829956">x</span><span class="op" id="3829957">.</span><span class="ident" id="3829958">a</span><span class="op" id="3829959">.</span><span class="ident" id="3829960">neg</span>&nbsp;<span class="op" id="3829964">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3829968">f</span>&nbsp;<span class="op" id="3829970">=</span>&nbsp;<span class="op" id="3829972">-</span><span class="ident" id="3829973">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3829976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3829979">return</span><br>
<span class="lineno"></span><span class="op" id="3829986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="3829989">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3830029">func</span>&nbsp;<span class="op" id="3830034">(</span><span class="ident" id="3830035">z</span>&nbsp;<span class="op" id="3830037">*</span><span class="ident" id="3830038">Rat</span><span class="op" id="3830041">)</span>&nbsp;<span class="ident" id="3830043">SetFrac</span><span class="op" id="3830050">(</span><span class="ident" id="3830051">a</span><span class="op" id="3830052">,</span>&nbsp;<span class="ident" id="3830054">b</span>&nbsp;<span class="op" id="3830056">*</span><span class="ident" id="3830057">Int</span><span class="op" id="3830060">)</span>&nbsp;<span class="op" id="3830062">*</span><span class="ident" id="3830063">Rat</span>&nbsp;<span class="op" id="3830067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830070">z</span><span class="op" id="3830071">.</span><span class="ident" id="3830072">a</span><span class="op" id="3830073">.</span><span class="ident" id="3830074">neg</span>&nbsp;<span class="op" id="3830078">=</span>&nbsp;<span class="ident" id="3830080">a</span><span class="op" id="3830081">.</span><span class="ident" id="3830082">neg</span>&nbsp;<span class="op" id="3830086">!=</span>&nbsp;<span class="ident" id="3830089">b</span><span class="op" id="3830090">.</span><span class="ident" id="3830091">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830096">babs</span>&nbsp;<span class="op" id="3830101">:=</span>&nbsp;<span class="ident" id="3830104">b</span><span class="op" id="3830105">.</span><span class="ident" id="3830106">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3830111">if</span>&nbsp;<span class="builtinfunc" id="3830114">len</span><span class="op" id="3830117">(</span><span class="ident" id="3830118">babs</span><span class="op" id="3830122">)</span>&nbsp;<span class="op" id="3830124">==</span>&nbsp;<span class="num" id="3830127">0</span>&nbsp;<span class="op" id="3830129">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3830133">panic</span><span class="op" id="3830138">(</span><span class="string" id="3830139">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3830157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3830160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3830163">if</span>&nbsp;<span class="op" id="3830166">&amp;</span><span class="ident" id="3830167">z</span><span class="op" id="3830168">.</span><span class="ident" id="3830169">a</span>&nbsp;<span class="op" id="3830171">==</span>&nbsp;<span class="ident" id="3830174">b</span>&nbsp;<span class="op" id="3830176">||</span>&nbsp;<span class="ident" id="3830179">alias</span><span class="op" id="3830184">(</span><span class="ident" id="3830185">z</span><span class="op" id="3830186">.</span><span class="ident" id="3830187">a</span><span class="op" id="3830188">.</span><span class="ident" id="3830189">abs</span><span class="op" id="3830192">,</span>&nbsp;<span class="ident" id="3830194">babs</span><span class="op" id="3830198">)</span>&nbsp;<span class="op" id="3830200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830204">babs</span>&nbsp;<span class="op" id="3830209">=</span>&nbsp;<span class="ident" id="3830211">nat</span><span class="op" id="3830214">(</span><span class="ident" id="3830215">nil</span><span class="op" id="3830218">)</span><span class="op" id="3830219">.</span><span class="ident" id="3830220">set</span><span class="op" id="3830223">(</span><span class="ident" id="3830224">babs</span><span class="op" id="3830228">)</span>&nbsp;<span class="comment" id="3830230">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3830246">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830249">z</span><span class="op" id="3830250">.</span><span class="ident" id="3830251">a</span><span class="op" id="3830252">.</span><span class="ident" id="3830253">abs</span>&nbsp;<span class="op" id="3830257">=</span>&nbsp;<span class="ident" id="3830259">z</span><span class="op" id="3830260">.</span><span class="ident" id="3830261">a</span><span class="op" id="3830262">.</span><span class="ident" id="3830263">abs</span><span class="op" id="3830266">.</span><span class="ident" id="3830267">set</span><span class="op" id="3830270">(</span><span class="ident" id="3830271">a</span><span class="op" id="3830272">.</span><span class="ident" id="3830273">abs</span><span class="op" id="3830276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830279">z</span><span class="op" id="3830280">.</span><span class="ident" id="3830281">b</span><span class="op" id="3830282">.</span><span class="ident" id="3830283">abs</span>&nbsp;<span class="op" id="3830287">=</span>&nbsp;<span class="ident" id="3830289">z</span><span class="op" id="3830290">.</span><span class="ident" id="3830291">b</span><span class="op" id="3830292">.</span><span class="ident" id="3830293">abs</span><span class="op" id="3830296">.</span><span class="ident" id="3830297">set</span><span class="op" id="3830300">(</span><span class="ident" id="3830301">babs</span><span class="op" id="3830305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3830308">return</span>&nbsp;<span class="ident" id="3830315">z</span><span class="op" id="3830316">.</span><span class="ident" id="3830317">norm</span><span class="op" id="3830321">(</span><span class="op" id="3830322">)</span><br>
<span class="lineno"></span><span class="op" id="3830324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="3830327">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3830369">func</span>&nbsp;<span class="op" id="3830374">(</span><span class="ident" id="3830375">z</span>&nbsp;<span class="op" id="3830377">*</span><span class="ident" id="3830378">Rat</span><span class="op" id="3830381">)</span>&nbsp;<span class="ident" id="3830383">SetFrac64</span><span class="op" id="3830392">(</span><span class="ident" id="3830393">a</span><span class="op" id="3830394">,</span>&nbsp;<span class="ident" id="3830396">b</span>&nbsp;<span class="ident" id="3830398">int64</span><span class="op" id="3830403">)</span>&nbsp;<span class="op" id="3830405">*</span><span class="ident" id="3830406">Rat</span>&nbsp;<span class="op" id="3830410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830413">z</span><span class="op" id="3830414">.</span><span class="ident" id="3830415">a</span><span class="op" id="3830416">.</span><span class="ident" id="3830417">SetInt64</span><span class="op" id="3830425">(</span><span class="ident" id="3830426">a</span><span class="op" id="3830427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3830430">if</span>&nbsp;<span class="ident" id="3830433">b</span>&nbsp;<span class="op" id="3830435">==</span>&nbsp;<span class="num" id="3830438">0</span>&nbsp;<span class="op" id="3830440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3830444">panic</span><span class="op" id="3830449">(</span><span class="string" id="3830450">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3830468">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3830471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3830474">if</span>&nbsp;<span class="ident" id="3830477">b</span>&nbsp;<span class="op" id="3830479">&lt;</span>&nbsp;<span class="num" id="3830481">0</span>&nbsp;<span class="op" id="3830483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830487">b</span>&nbsp;<span class="op" id="3830489">=</span>&nbsp;<span class="op" id="3830491">-</span><span class="ident" id="3830492">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830496">z</span><span class="op" id="3830497">.</span><span class="ident" id="3830498">a</span><span class="op" id="3830499">.</span><span class="ident" id="3830500">neg</span>&nbsp;<span class="op" id="3830504">=</span>&nbsp;<span class="op" id="3830506">!</span><span class="ident" id="3830507">z</span><span class="op" id="3830508">.</span><span class="ident" id="3830509">a</span><span class="op" id="3830510">.</span><span class="ident" id="3830511">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3830516">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830519">z</span><span class="op" id="3830520">.</span><span class="ident" id="3830521">b</span><span class="op" id="3830522">.</span><span class="ident" id="3830523">abs</span>&nbsp;<span class="op" id="3830527">=</span>&nbsp;<span class="ident" id="3830529">z</span><span class="op" id="3830530">.</span><span class="ident" id="3830531">b</span><span class="op" id="3830532">.</span><span class="ident" id="3830533">abs</span><span class="op" id="3830536">.</span><span class="ident" id="3830537">setUint64</span><span class="op" id="3830546">(</span><span class="ident" id="3830547">uint64</span><span class="op" id="3830553">(</span><span class="ident" id="3830554">b</span><span class="op" id="3830555">)</span><span class="op" id="3830556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3830559">return</span>&nbsp;<span class="ident" id="3830566">z</span><span class="op" id="3830567">.</span><span class="ident" id="3830568">norm</span><span class="op" id="3830572">(</span><span class="op" id="3830573">)</span><br>
<span class="lineno"></span><span class="op" id="3830575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3830578">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="3830639">func</span>&nbsp;<span class="op" id="3830644">(</span><span class="ident" id="3830645">z</span>&nbsp;<span class="op" id="3830647">*</span><span class="ident" id="3830648">Rat</span><span class="op" id="3830651">)</span>&nbsp;<span class="ident" id="3830653">SetInt</span><span class="op" id="3830659">(</span><span class="ident" id="3830660">x</span>&nbsp;<span class="op" id="3830662">*</span><span class="ident" id="3830663">Int</span><span class="op" id="3830666">)</span>&nbsp;<span class="op" id="3830668">*</span><span class="ident" id="3830669">Rat</span>&nbsp;<span class="op" id="3830673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830676">z</span><span class="op" id="3830677">.</span><span class="ident" id="3830678">a</span><span class="op" id="3830679">.</span><span class="ident" id="3830680">Set</span><span class="op" id="3830683">(</span><span class="ident" id="3830684">x</span><span class="op" id="3830685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830688">z</span><span class="op" id="3830689">.</span><span class="ident" id="3830690">b</span><span class="op" id="3830691">.</span><span class="ident" id="3830692">abs</span>&nbsp;<span class="op" id="3830696">=</span>&nbsp;<span class="ident" id="3830698">z</span><span class="op" id="3830699">.</span><span class="ident" id="3830700">b</span><span class="op" id="3830701">.</span><span class="ident" id="3830702">abs</span><span class="op" id="3830705">.</span><span class="builtinfunc" id="3830706">make</span><span class="op" id="3830710">(</span><span class="num" id="3830711">0</span><span class="op" id="3830712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3830715">return</span>&nbsp;<span class="ident" id="3830722">z</span><br>
<span class="lineno"></span><span class="op" id="3830724">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3830727">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3830766">func</span>&nbsp;<span class="op" id="3830771">(</span><span class="ident" id="3830772">z</span>&nbsp;<span class="op" id="3830774">*</span><span class="ident" id="3830775">Rat</span><span class="op" id="3830778">)</span>&nbsp;<span class="ident" id="3830780">SetInt64</span><span class="op" id="3830788">(</span><span class="ident" id="3830789">x</span>&nbsp;<span class="ident" id="3830791">int64</span><span class="op" id="3830796">)</span>&nbsp;<span class="op" id="3830798">*</span><span class="ident" id="3830799">Rat</span>&nbsp;<span class="op" id="3830803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830806">z</span><span class="op" id="3830807">.</span><span class="ident" id="3830808">a</span><span class="op" id="3830809">.</span><span class="ident" id="3830810">SetInt64</span><span class="op" id="3830818">(</span><span class="ident" id="3830819">x</span><span class="op" id="3830820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830823">z</span><span class="op" id="3830824">.</span><span class="ident" id="3830825">b</span><span class="op" id="3830826">.</span><span class="ident" id="3830827">abs</span>&nbsp;<span class="op" id="3830831">=</span>&nbsp;<span class="ident" id="3830833">z</span><span class="op" id="3830834">.</span><span class="ident" id="3830835">b</span><span class="op" id="3830836">.</span><span class="ident" id="3830837">abs</span><span class="op" id="3830840">.</span><span class="builtinfunc" id="3830841">make</span><span class="op" id="3830845">(</span><span class="num" id="3830846">0</span><span class="op" id="3830847">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3830850">return</span>&nbsp;<span class="ident" id="3830857">z</span><br>
<span class="lineno"></span><span class="op" id="3830859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3830862">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3830920">func</span>&nbsp;<span class="op" id="3830925">(</span><span class="ident" id="3830926">z</span>&nbsp;<span class="op" id="3830928">*</span><span class="ident" id="3830929">Rat</span><span class="op" id="3830932">)</span>&nbsp;<span class="ident" id="3830934">Set</span><span class="op" id="3830937">(</span><span class="ident" id="3830938">x</span>&nbsp;<span class="op" id="3830940">*</span><span class="ident" id="3830941">Rat</span><span class="op" id="3830944">)</span>&nbsp;<span class="op" id="3830946">*</span><span class="ident" id="3830947">Rat</span>&nbsp;<span class="op" id="3830951">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3830954">if</span>&nbsp;<span class="ident" id="3830957">z</span>&nbsp;<span class="op" id="3830959">!=</span>&nbsp;<span class="ident" id="3830962">x</span>&nbsp;<span class="op" id="3830964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830968">z</span><span class="op" id="3830969">.</span><span class="ident" id="3830970">a</span><span class="op" id="3830971">.</span><span class="ident" id="3830972">Set</span><span class="op" id="3830975">(</span><span class="op" id="3830976">&amp;</span><span class="ident" id="3830977">x</span><span class="op" id="3830978">.</span><span class="ident" id="3830979">a</span><span class="op" id="3830980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3830984">z</span><span class="op" id="3830985">.</span><span class="ident" id="3830986">b</span><span class="op" id="3830987">.</span><span class="ident" id="3830988">Set</span><span class="op" id="3830991">(</span><span class="op" id="3830992">&amp;</span><span class="ident" id="3830993">x</span><span class="op" id="3830994">.</span><span class="ident" id="3830995">b</span><span class="op" id="3830996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3830999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3831002">return</span>&nbsp;<span class="ident" id="3831009">z</span><br>
<span class="lineno">345</span><span class="op" id="3831011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3831014">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3831076">func</span>&nbsp;<span class="op" id="3831081">(</span><span class="ident" id="3831082">z</span>&nbsp;<span class="op" id="3831084">*</span><span class="ident" id="3831085">Rat</span><span class="op" id="3831088">)</span>&nbsp;<span class="ident" id="3831090">Abs</span><span class="op" id="3831093">(</span><span class="ident" id="3831094">x</span>&nbsp;<span class="op" id="3831096">*</span><span class="ident" id="3831097">Rat</span><span class="op" id="3831100">)</span>&nbsp;<span class="op" id="3831102">*</span><span class="ident" id="3831103">Rat</span>&nbsp;<span class="op" id="3831107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3831110">z</span><span class="op" id="3831111">.</span><span class="ident" id="3831112">Set</span><span class="op" id="3831115">(</span><span class="ident" id="3831116">x</span><span class="op" id="3831117">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3831120">z</span><span class="op" id="3831121">.</span><span class="ident" id="3831122">a</span><span class="op" id="3831123">.</span><span class="ident" id="3831124">neg</span>&nbsp;<span class="op" id="3831128">=</span>&nbsp;<span class="builtintype" id="3831130">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3831137">return</span>&nbsp;<span class="ident" id="3831144">z</span><br>
<span class="lineno"></span><span class="op" id="3831146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3831149">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="3831184">func</span>&nbsp;<span class="op" id="3831189">(</span><span class="ident" id="3831190">z</span>&nbsp;<span class="op" id="3831192">*</span><span class="ident" id="3831193">Rat</span><span class="op" id="3831196">)</span>&nbsp;<span class="ident" id="3831198">Neg</span><span class="op" id="3831201">(</span><span class="ident" id="3831202">x</span>&nbsp;<span class="op" id="3831204">*</span><span class="ident" id="3831205">Rat</span><span class="op" id="3831208">)</span>&nbsp;<span class="op" id="3831210">*</span><span class="ident" id="3831211">Rat</span>&nbsp;<span class="op" id="3831215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3831218">z</span><span class="op" id="3831219">.</span><span class="ident" id="3831220">Set</span><span class="op" id="3831223">(</span><span class="ident" id="3831224">x</span><span class="op" id="3831225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3831228">z</span><span class="op" id="3831229">.</span><span class="ident" id="3831230">a</span><span class="op" id="3831231">.</span><span class="ident" id="3831232">neg</span>&nbsp;<span class="op" id="3831236">=</span>&nbsp;<span class="builtinfunc" id="3831238">len</span><span class="op" id="3831241">(</span><span class="ident" id="3831242">z</span><span class="op" id="3831243">.</span><span class="ident" id="3831244">a</span><span class="op" id="3831245">.</span><span class="ident" id="3831246">abs</span><span class="op" id="3831249">)</span>&nbsp;<span class="op" id="3831251">&gt;</span>&nbsp;<span class="num" id="3831253">0</span>&nbsp;<span class="op" id="3831255">&amp;&amp;</span>&nbsp;<span class="op" id="3831258">!</span><span class="ident" id="3831259">z</span><span class="op" id="3831260">.</span><span class="ident" id="3831261">a</span><span class="op" id="3831262">.</span><span class="ident" id="3831263">neg</span>&nbsp;<span class="comment" id="3831267">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3831285">return</span>&nbsp;<span class="ident" id="3831292">z</span><br>
<span class="lineno"></span><span class="op" id="3831294">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="3831297">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3831333">func</span>&nbsp;<span class="op" id="3831338">(</span><span class="ident" id="3831339">z</span>&nbsp;<span class="op" id="3831341">*</span><span class="ident" id="3831342">Rat</span><span class="op" id="3831345">)</span>&nbsp;<span class="ident" id="3831347">Inv</span><span class="op" id="3831350">(</span><span class="ident" id="3831351">x</span>&nbsp;<span class="op" id="3831353">*</span><span class="ident" id="3831354">Rat</span><span class="op" id="3831357">)</span>&nbsp;<span class="op" id="3831359">*</span><span class="ident" id="3831360">Rat</span>&nbsp;<span class="op" id="3831364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3831367">if</span>&nbsp;<span class="builtinfunc" id="3831370">len</span><span class="op" id="3831373">(</span><span class="ident" id="3831374">x</span><span class="op" id="3831375">.</span><span class="ident" id="3831376">a</span><span class="op" id="3831377">.</span><span class="ident" id="3831378">abs</span><span class="op" id="3831381">)</span>&nbsp;<span class="op" id="3831383">==</span>&nbsp;<span class="num" id="3831386">0</span>&nbsp;<span class="op" id="3831388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3831392">panic</span><span class="op" id="3831397">(</span><span class="string" id="3831398">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3831416">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3831419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3831422">z</span><span class="op" id="3831423">.</span><span class="ident" id="3831424">Set</span><span class="op" id="3831427">(</span><span class="ident" id="3831428">x</span><span class="op" id="3831429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3831432">a</span>&nbsp;<span class="op" id="3831434">:=</span>&nbsp;<span class="ident" id="3831437">z</span><span class="op" id="3831438">.</span><span class="ident" id="3831439">b</span><span class="op" id="3831440">.</span><span class="ident" id="3831441">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3831446">if</span>&nbsp;<span class="builtinfunc" id="3831449">len</span><span class="op" id="3831452">(</span><span class="ident" id="3831453">a</span><span class="op" id="3831454">)</span>&nbsp;<span class="op" id="3831456">==</span>&nbsp;<span class="num" id="3831459">0</span>&nbsp;<span class="op" id="3831461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3831465">a</span>&nbsp;<span class="op" id="3831467">=</span>&nbsp;<span class="ident" id="3831469">a</span><span class="op" id="3831470">.</span><span class="ident" id="3831471">set</span><span class="op" id="3831474">(</span><span class="ident" id="3831475">natOne</span><span class="op" id="3831481">)</span>&nbsp;<span class="comment" id="3831483">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3831509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3831512">b</span>&nbsp;<span class="op" id="3831514">:=</span>&nbsp;<span class="ident" id="3831517">z</span><span class="op" id="3831518">.</span><span class="ident" id="3831519">a</span><span class="op" id="3831520">.</span><span class="ident" id="3831521">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3831526">if</span>&nbsp;<span class="ident" id="3831529">b</span><span class="op" id="3831530">.</span><span class="ident" id="3831531">cmp</span><span class="op" id="3831534">(</span><span class="ident" id="3831535">natOne</span><span class="op" id="3831541">)</span>&nbsp;<span class="op" id="3831543">==</span>&nbsp;<span class="num" id="3831546">0</span>&nbsp;<span class="op" id="3831548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3831552">b</span>&nbsp;<span class="op" id="3831554">=</span>&nbsp;<span class="ident" id="3831556">b</span><span class="op" id="3831557">.</span><span class="builtinfunc" id="3831558">make</span><span class="op" id="3831562">(</span><span class="num" id="3831563">0</span><span class="op" id="3831564">)</span>&nbsp;<span class="comment" id="3831566">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3831592">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3831595">z</span><span class="op" id="3831596">.</span><span class="ident" id="3831597">a</span><span class="op" id="3831598">.</span><span class="ident" id="3831599">abs</span><span class="op" id="3831602">,</span>&nbsp;<span class="ident" id="3831604">z</span><span class="op" id="3831605">.</span><span class="ident" id="3831606">b</span><span class="op" id="3831607">.</span><span class="ident" id="3831608">abs</span>&nbsp;<span class="op" id="3831612">=</span>&nbsp;<span class="ident" id="3831614">a</span><span class="op" id="3831615">,</span>&nbsp;<span class="ident" id="3831617">b</span>&nbsp;<span class="comment" id="3831619">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3831643">return</span>&nbsp;<span class="ident" id="3831650">z</span><br>
<span class="lineno"></span><span class="op" id="3831652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3831655">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="3831672">//</span><br>
<span class="lineno"></span><span class="comment" id="3831675">//&nbsp;&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3831691">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3831707">//&nbsp;&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3831723">//</span><br>
<span class="lineno">385</span><span class="keyword" id="3831726">func</span>&nbsp;<span class="op" id="3831731">(</span><span class="ident" id="3831732">x</span>&nbsp;<span class="op" id="3831734">*</span><span class="ident" id="3831735">Rat</span><span class="op" id="3831738">)</span>&nbsp;<span class="ident" id="3831740">Sign</span><span class="op" id="3831744">(</span><span class="op" id="3831745">)</span>&nbsp;<span class="builtintype" id="3831747">int</span>&nbsp;<span class="op" id="3831751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3831754">return</span>&nbsp;<span class="ident" id="3831761">x</span><span class="op" id="3831762">.</span><span class="ident" id="3831763">a</span><span class="op" id="3831764">.</span><span class="ident" id="3831765">Sign</span><span class="op" id="3831769">(</span><span class="op" id="3831770">)</span><br>
<span class="lineno"></span><span class="op" id="3831772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3831775">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="3831827">func</span>&nbsp;<span class="op" id="3831832">(</span><span class="ident" id="3831833">x</span>&nbsp;<span class="op" id="3831835">*</span><span class="ident" id="3831836">Rat</span><span class="op" id="3831839">)</span>&nbsp;<span class="ident" id="3831841">IsInt</span><span class="op" id="3831846">(</span><span class="op" id="3831847">)</span>&nbsp;<span class="builtintype" id="3831849">bool</span>&nbsp;<span class="op" id="3831854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3831857">return</span>&nbsp;<span class="builtinfunc" id="3831864">len</span><span class="op" id="3831867">(</span><span class="ident" id="3831868">x</span><span class="op" id="3831869">.</span><span class="ident" id="3831870">b</span><span class="op" id="3831871">.</span><span class="ident" id="3831872">abs</span><span class="op" id="3831875">)</span>&nbsp;<span class="op" id="3831877">==</span>&nbsp;<span class="num" id="3831880">0</span>&nbsp;<span class="op" id="3831882">||</span>&nbsp;<span class="ident" id="3831885">x</span><span class="op" id="3831886">.</span><span class="ident" id="3831887">b</span><span class="op" id="3831888">.</span><span class="ident" id="3831889">abs</span><span class="op" id="3831892">.</span><span class="ident" id="3831893">cmp</span><span class="op" id="3831896">(</span><span class="ident" id="3831897">natOne</span><span class="op" id="3831903">)</span>&nbsp;<span class="op" id="3831905">==</span>&nbsp;<span class="num" id="3831908">0</span><br>
<span class="lineno"></span><span class="op" id="3831910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3831913">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="3831964">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3832014">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="3832077">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3832136">func</span>&nbsp;<span class="op" id="3832141">(</span><span class="ident" id="3832142">x</span>&nbsp;<span class="op" id="3832144">*</span><span class="ident" id="3832145">Rat</span><span class="op" id="3832148">)</span>&nbsp;<span class="ident" id="3832150">Num</span><span class="op" id="3832153">(</span><span class="op" id="3832154">)</span>&nbsp;<span class="op" id="3832156">*</span><span class="ident" id="3832157">Int</span>&nbsp;<span class="op" id="3832161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3832164">return</span>&nbsp;<span class="op" id="3832171">&amp;</span><span class="ident" id="3832172">x</span><span class="op" id="3832173">.</span><span class="ident" id="3832174">a</span><br>
<span class="lineno">400</span><span class="op" id="3832176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3832179">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3832236">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3832288">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="3832351">func</span>&nbsp;<span class="op" id="3832356">(</span><span class="ident" id="3832357">x</span>&nbsp;<span class="op" id="3832359">*</span><span class="ident" id="3832360">Rat</span><span class="op" id="3832363">)</span>&nbsp;<span class="ident" id="3832365">Denom</span><span class="op" id="3832370">(</span><span class="op" id="3832371">)</span>&nbsp;<span class="op" id="3832373">*</span><span class="ident" id="3832374">Int</span>&nbsp;<span class="op" id="3832378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3832381">x</span><span class="op" id="3832382">.</span><span class="ident" id="3832383">b</span><span class="op" id="3832384">.</span><span class="ident" id="3832385">neg</span>&nbsp;<span class="op" id="3832389">=</span>&nbsp;<span class="builtintype" id="3832391">false</span>&nbsp;<span class="comment" id="3832397">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3832427">if</span>&nbsp;<span class="builtinfunc" id="3832430">len</span><span class="op" id="3832433">(</span><span class="ident" id="3832434">x</span><span class="op" id="3832435">.</span><span class="ident" id="3832436">b</span><span class="op" id="3832437">.</span><span class="ident" id="3832438">abs</span><span class="op" id="3832441">)</span>&nbsp;<span class="op" id="3832443">==</span>&nbsp;<span class="num" id="3832446">0</span>&nbsp;<span class="op" id="3832448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3832452">x</span><span class="op" id="3832453">.</span><span class="ident" id="3832454">b</span><span class="op" id="3832455">.</span><span class="ident" id="3832456">abs</span>&nbsp;<span class="op" id="3832460">=</span>&nbsp;<span class="ident" id="3832462">x</span><span class="op" id="3832463">.</span><span class="ident" id="3832464">b</span><span class="op" id="3832465">.</span><span class="ident" id="3832466">abs</span><span class="op" id="3832469">.</span><span class="ident" id="3832470">set</span><span class="op" id="3832473">(</span><span class="ident" id="3832474">natOne</span><span class="op" id="3832480">)</span>&nbsp;<span class="comment" id="3832482">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3832510">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3832513">return</span>&nbsp;<span class="op" id="3832520">&amp;</span><span class="ident" id="3832521">x</span><span class="op" id="3832522">.</span><span class="ident" id="3832523">b</span><br>
<span class="lineno"></span><span class="op" id="3832525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3832528">func</span>&nbsp;<span class="op" id="3832533">(</span><span class="ident" id="3832534">z</span>&nbsp;<span class="op" id="3832536">*</span><span class="ident" id="3832537">Rat</span><span class="op" id="3832540">)</span>&nbsp;<span class="ident" id="3832542">norm</span><span class="op" id="3832546">(</span><span class="op" id="3832547">)</span>&nbsp;<span class="op" id="3832549">*</span><span class="ident" id="3832550">Rat</span>&nbsp;<span class="op" id="3832554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3832557">switch</span>&nbsp;<span class="op" id="3832564">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3832567">case</span>&nbsp;<span class="builtinfunc" id="3832572">len</span><span class="op" id="3832575">(</span><span class="ident" id="3832576">z</span><span class="op" id="3832577">.</span><span class="ident" id="3832578">a</span><span class="op" id="3832579">.</span><span class="ident" id="3832580">abs</span><span class="op" id="3832583">)</span>&nbsp;<span class="op" id="3832585">==</span>&nbsp;<span class="num" id="3832588">0</span><span class="op" id="3832589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3832593">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3832638">z</span><span class="op" id="3832639">.</span><span class="ident" id="3832640">a</span><span class="op" id="3832641">.</span><span class="ident" id="3832642">neg</span>&nbsp;<span class="op" id="3832646">=</span>&nbsp;<span class="builtintype" id="3832648">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3832656">z</span><span class="op" id="3832657">.</span><span class="ident" id="3832658">b</span><span class="op" id="3832659">.</span><span class="ident" id="3832660">abs</span>&nbsp;<span class="op" id="3832664">=</span>&nbsp;<span class="ident" id="3832666">z</span><span class="op" id="3832667">.</span><span class="ident" id="3832668">b</span><span class="op" id="3832669">.</span><span class="ident" id="3832670">abs</span><span class="op" id="3832673">.</span><span class="builtinfunc" id="3832674">make</span><span class="op" id="3832678">(</span><span class="num" id="3832679">0</span><span class="op" id="3832680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3832683">case</span>&nbsp;<span class="builtinfunc" id="3832688">len</span><span class="op" id="3832691">(</span><span class="ident" id="3832692">z</span><span class="op" id="3832693">.</span><span class="ident" id="3832694">b</span><span class="op" id="3832695">.</span><span class="ident" id="3832696">abs</span><span class="op" id="3832699">)</span>&nbsp;<span class="op" id="3832701">==</span>&nbsp;<span class="num" id="3832704">0</span><span class="op" id="3832705">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3832709">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3832749">case</span>&nbsp;<span class="ident" id="3832754">z</span><span class="op" id="3832755">.</span><span class="ident" id="3832756">b</span><span class="op" id="3832757">.</span><span class="ident" id="3832758">abs</span><span class="op" id="3832761">.</span><span class="ident" id="3832762">cmp</span><span class="op" id="3832765">(</span><span class="ident" id="3832766">natOne</span><span class="op" id="3832772">)</span>&nbsp;<span class="op" id="3832774">==</span>&nbsp;<span class="num" id="3832777">0</span><span class="op" id="3832778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3832782">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3832820">z</span><span class="op" id="3832821">.</span><span class="ident" id="3832822">b</span><span class="op" id="3832823">.</span><span class="ident" id="3832824">abs</span>&nbsp;<span class="op" id="3832828">=</span>&nbsp;<span class="ident" id="3832830">z</span><span class="op" id="3832831">.</span><span class="ident" id="3832832">b</span><span class="op" id="3832833">.</span><span class="ident" id="3832834">abs</span><span class="op" id="3832837">.</span><span class="builtinfunc" id="3832838">make</span><span class="op" id="3832842">(</span><span class="num" id="3832843">0</span><span class="op" id="3832844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3832847">default</span><span class="op" id="3832854">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3832858">neg</span>&nbsp;<span class="op" id="3832862">:=</span>&nbsp;<span class="ident" id="3832865">z</span><span class="op" id="3832866">.</span><span class="ident" id="3832867">a</span><span class="op" id="3832868">.</span><span class="ident" id="3832869">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3832875">z</span><span class="op" id="3832876">.</span><span class="ident" id="3832877">a</span><span class="op" id="3832878">.</span><span class="ident" id="3832879">neg</span>&nbsp;<span class="op" id="3832883">=</span>&nbsp;<span class="builtintype" id="3832885">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3832893">z</span><span class="op" id="3832894">.</span><span class="ident" id="3832895">b</span><span class="op" id="3832896">.</span><span class="ident" id="3832897">neg</span>&nbsp;<span class="op" id="3832901">=</span>&nbsp;<span class="builtintype" id="3832903">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3832911">if</span>&nbsp;<span class="ident" id="3832914">f</span>&nbsp;<span class="op" id="3832916">:=</span>&nbsp;<span class="ident" id="3832919">NewInt</span><span class="op" id="3832925">(</span><span class="num" id="3832926">0</span><span class="op" id="3832927">)</span><span class="op" id="3832928">.</span><span class="ident" id="3832929">binaryGCD</span><span class="op" id="3832938">(</span><span class="op" id="3832939">&amp;</span><span class="ident" id="3832940">z</span><span class="op" id="3832941">.</span><span class="ident" id="3832942">a</span><span class="op" id="3832943">,</span>&nbsp;<span class="op" id="3832945">&amp;</span><span class="ident" id="3832946">z</span><span class="op" id="3832947">.</span><span class="ident" id="3832948">b</span><span class="op" id="3832949">)</span><span class="op" id="3832950">;</span>&nbsp;<span class="ident" id="3832952">f</span><span class="op" id="3832953">.</span><span class="ident" id="3832954">Cmp</span><span class="op" id="3832957">(</span><span class="ident" id="3832958">intOne</span><span class="op" id="3832964">)</span>&nbsp;<span class="op" id="3832966">!=</span>&nbsp;<span class="num" id="3832969">0</span>&nbsp;<span class="op" id="3832971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3832976">z</span><span class="op" id="3832977">.</span><span class="ident" id="3832978">a</span><span class="op" id="3832979">.</span><span class="ident" id="3832980">abs</span><span class="op" id="3832983">,</span>&nbsp;<span class="ident" id="3832985">_</span>&nbsp;<span class="op" id="3832987">=</span>&nbsp;<span class="ident" id="3832989">z</span><span class="op" id="3832990">.</span><span class="ident" id="3832991">a</span><span class="op" id="3832992">.</span><span class="ident" id="3832993">abs</span><span class="op" id="3832996">.</span><span class="ident" id="3832997">div</span><span class="op" id="3833000">(</span><span class="ident" id="3833001">nil</span><span class="op" id="3833004">,</span>&nbsp;<span class="ident" id="3833006">z</span><span class="op" id="3833007">.</span><span class="ident" id="3833008">a</span><span class="op" id="3833009">.</span><span class="ident" id="3833010">abs</span><span class="op" id="3833013">,</span>&nbsp;<span class="ident" id="3833015">f</span><span class="op" id="3833016">.</span><span class="ident" id="3833017">abs</span><span class="op" id="3833020">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3833025">z</span><span class="op" id="3833026">.</span><span class="ident" id="3833027">b</span><span class="op" id="3833028">.</span><span class="ident" id="3833029">abs</span><span class="op" id="3833032">,</span>&nbsp;<span class="ident" id="3833034">_</span>&nbsp;<span class="op" id="3833036">=</span>&nbsp;<span class="ident" id="3833038">z</span><span class="op" id="3833039">.</span><span class="ident" id="3833040">b</span><span class="op" id="3833041">.</span><span class="ident" id="3833042">abs</span><span class="op" id="3833045">.</span><span class="ident" id="3833046">div</span><span class="op" id="3833049">(</span><span class="ident" id="3833050">nil</span><span class="op" id="3833053">,</span>&nbsp;<span class="ident" id="3833055">z</span><span class="op" id="3833056">.</span><span class="ident" id="3833057">b</span><span class="op" id="3833058">.</span><span class="ident" id="3833059">abs</span><span class="op" id="3833062">,</span>&nbsp;<span class="ident" id="3833064">f</span><span class="op" id="3833065">.</span><span class="ident" id="3833066">abs</span><span class="op" id="3833069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833074">if</span>&nbsp;<span class="ident" id="3833077">z</span><span class="op" id="3833078">.</span><span class="ident" id="3833079">b</span><span class="op" id="3833080">.</span><span class="ident" id="3833081">abs</span><span class="op" id="3833084">.</span><span class="ident" id="3833085">cmp</span><span class="op" id="3833088">(</span><span class="ident" id="3833089">natOne</span><span class="op" id="3833095">)</span>&nbsp;<span class="op" id="3833097">==</span>&nbsp;<span class="num" id="3833100">0</span>&nbsp;<span class="op" id="3833102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3833108">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3833148">z</span><span class="op" id="3833149">.</span><span class="ident" id="3833150">b</span><span class="op" id="3833151">.</span><span class="ident" id="3833152">abs</span>&nbsp;<span class="op" id="3833156">=</span>&nbsp;<span class="ident" id="3833158">z</span><span class="op" id="3833159">.</span><span class="ident" id="3833160">b</span><span class="op" id="3833161">.</span><span class="ident" id="3833162">abs</span><span class="op" id="3833165">.</span><span class="builtinfunc" id="3833166">make</span><span class="op" id="3833170">(</span><span class="num" id="3833171">0</span><span class="op" id="3833172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3833177">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3833181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3833185">z</span><span class="op" id="3833186">.</span><span class="ident" id="3833187">a</span><span class="op" id="3833188">.</span><span class="ident" id="3833189">neg</span>&nbsp;<span class="op" id="3833193">=</span>&nbsp;<span class="ident" id="3833195">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3833200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833203">return</span>&nbsp;<span class="ident" id="3833210">z</span><br>
<span class="lineno"></span><span class="op" id="3833212">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="3833215">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3833281">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3833347">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3833361">func</span>&nbsp;<span class="ident" id="3833366">mulDenom</span><span class="op" id="3833374">(</span><span class="ident" id="3833375">z</span><span class="op" id="3833376">,</span>&nbsp;<span class="ident" id="3833378">x</span><span class="op" id="3833379">,</span>&nbsp;<span class="ident" id="3833381">y</span>&nbsp;<span class="ident" id="3833383">nat</span><span class="op" id="3833386">)</span>&nbsp;<span class="ident" id="3833388">nat</span>&nbsp;<span class="op" id="3833392">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833395">switch</span>&nbsp;<span class="op" id="3833402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833405">case</span>&nbsp;<span class="builtinfunc" id="3833410">len</span><span class="op" id="3833413">(</span><span class="ident" id="3833414">x</span><span class="op" id="3833415">)</span>&nbsp;<span class="op" id="3833417">==</span>&nbsp;<span class="num" id="3833420">0</span><span class="op" id="3833421">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833425">return</span>&nbsp;<span class="ident" id="3833432">z</span><span class="op" id="3833433">.</span><span class="ident" id="3833434">set</span><span class="op" id="3833437">(</span><span class="ident" id="3833438">y</span><span class="op" id="3833439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833442">case</span>&nbsp;<span class="builtinfunc" id="3833447">len</span><span class="op" id="3833450">(</span><span class="ident" id="3833451">y</span><span class="op" id="3833452">)</span>&nbsp;<span class="op" id="3833454">==</span>&nbsp;<span class="num" id="3833457">0</span><span class="op" id="3833458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833462">return</span>&nbsp;<span class="ident" id="3833469">z</span><span class="op" id="3833470">.</span><span class="ident" id="3833471">set</span><span class="op" id="3833474">(</span><span class="ident" id="3833475">x</span><span class="op" id="3833476">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3833479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833482">return</span>&nbsp;<span class="ident" id="3833489">z</span><span class="op" id="3833490">.</span><span class="ident" id="3833491">mul</span><span class="op" id="3833494">(</span><span class="ident" id="3833495">x</span><span class="op" id="3833496">,</span>&nbsp;<span class="ident" id="3833498">y</span><span class="op" id="3833499">)</span><br>
<span class="lineno"></span><span class="op" id="3833501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3833504">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="3833532">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3833603">func</span>&nbsp;<span class="ident" id="3833608">scaleDenom</span><span class="op" id="3833618">(</span><span class="ident" id="3833619">x</span>&nbsp;<span class="op" id="3833621">*</span><span class="ident" id="3833622">Int</span><span class="op" id="3833625">,</span>&nbsp;<span class="ident" id="3833627">f</span>&nbsp;<span class="ident" id="3833629">nat</span><span class="op" id="3833632">)</span>&nbsp;<span class="op" id="3833634">*</span><span class="ident" id="3833635">Int</span>&nbsp;<span class="op" id="3833639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833642">var</span>&nbsp;<span class="ident" id="3833646">z</span>&nbsp;<span class="ident" id="3833648">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833653">if</span>&nbsp;<span class="builtinfunc" id="3833656">len</span><span class="op" id="3833659">(</span><span class="ident" id="3833660">f</span><span class="op" id="3833661">)</span>&nbsp;<span class="op" id="3833663">==</span>&nbsp;<span class="num" id="3833666">0</span>&nbsp;<span class="op" id="3833668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833672">return</span>&nbsp;<span class="ident" id="3833679">z</span><span class="op" id="3833680">.</span><span class="ident" id="3833681">Set</span><span class="op" id="3833684">(</span><span class="ident" id="3833685">x</span><span class="op" id="3833686">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3833689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3833692">z</span><span class="op" id="3833693">.</span><span class="ident" id="3833694">abs</span>&nbsp;<span class="op" id="3833698">=</span>&nbsp;<span class="ident" id="3833700">z</span><span class="op" id="3833701">.</span><span class="ident" id="3833702">abs</span><span class="op" id="3833705">.</span><span class="ident" id="3833706">mul</span><span class="op" id="3833709">(</span><span class="ident" id="3833710">x</span><span class="op" id="3833711">.</span><span class="ident" id="3833712">abs</span><span class="op" id="3833715">,</span>&nbsp;<span class="ident" id="3833717">f</span><span class="op" id="3833718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3833721">z</span><span class="op" id="3833722">.</span><span class="ident" id="3833723">neg</span>&nbsp;<span class="op" id="3833727">=</span>&nbsp;<span class="ident" id="3833729">x</span><span class="op" id="3833730">.</span><span class="ident" id="3833731">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833736">return</span>&nbsp;<span class="op" id="3833743">&amp;</span><span class="ident" id="3833744">z</span><br>
<span class="lineno"></span><span class="op" id="3833746">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="3833749">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="3833786">//</span><br>
<span class="lineno"></span><span class="comment" id="3833789">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3833807">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="3833825">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3833843">//</span><br>
<span class="lineno"></span><span class="keyword" id="3833846">func</span>&nbsp;<span class="op" id="3833851">(</span><span class="ident" id="3833852">x</span>&nbsp;<span class="op" id="3833854">*</span><span class="ident" id="3833855">Rat</span><span class="op" id="3833858">)</span>&nbsp;<span class="ident" id="3833860">Cmp</span><span class="op" id="3833863">(</span><span class="ident" id="3833864">y</span>&nbsp;<span class="op" id="3833866">*</span><span class="ident" id="3833867">Rat</span><span class="op" id="3833870">)</span>&nbsp;<span class="builtintype" id="3833872">int</span>&nbsp;<span class="op" id="3833876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3833879">return</span>&nbsp;<span class="ident" id="3833886">scaleDenom</span><span class="op" id="3833896">(</span><span class="op" id="3833897">&amp;</span><span class="ident" id="3833898">x</span><span class="op" id="3833899">.</span><span class="ident" id="3833900">a</span><span class="op" id="3833901">,</span>&nbsp;<span class="ident" id="3833903">y</span><span class="op" id="3833904">.</span><span class="ident" id="3833905">b</span><span class="op" id="3833906">.</span><span class="ident" id="3833907">abs</span><span class="op" id="3833910">)</span><span class="op" id="3833911">.</span><span class="ident" id="3833912">Cmp</span><span class="op" id="3833915">(</span><span class="ident" id="3833916">scaleDenom</span><span class="op" id="3833926">(</span><span class="op" id="3833927">&amp;</span><span class="ident" id="3833928">y</span><span class="op" id="3833929">.</span><span class="ident" id="3833930">a</span><span class="op" id="3833931">,</span>&nbsp;<span class="ident" id="3833933">x</span><span class="op" id="3833934">.</span><span class="ident" id="3833935">b</span><span class="op" id="3833936">.</span><span class="ident" id="3833937">abs</span><span class="op" id="3833940">)</span><span class="op" id="3833941">)</span><br>
<span class="lineno"></span><span class="op" id="3833943">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="3833946">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3833990">func</span>&nbsp;<span class="op" id="3833995">(</span><span class="ident" id="3833996">z</span>&nbsp;<span class="op" id="3833998">*</span><span class="ident" id="3833999">Rat</span><span class="op" id="3834002">)</span>&nbsp;<span class="ident" id="3834004">Add</span><span class="op" id="3834007">(</span><span class="ident" id="3834008">x</span><span class="op" id="3834009">,</span>&nbsp;<span class="ident" id="3834011">y</span>&nbsp;<span class="op" id="3834013">*</span><span class="ident" id="3834014">Rat</span><span class="op" id="3834017">)</span>&nbsp;<span class="op" id="3834019">*</span><span class="ident" id="3834020">Rat</span>&nbsp;<span class="op" id="3834024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834027">a1</span>&nbsp;<span class="op" id="3834030">:=</span>&nbsp;<span class="ident" id="3834033">scaleDenom</span><span class="op" id="3834043">(</span><span class="op" id="3834044">&amp;</span><span class="ident" id="3834045">x</span><span class="op" id="3834046">.</span><span class="ident" id="3834047">a</span><span class="op" id="3834048">,</span>&nbsp;<span class="ident" id="3834050">y</span><span class="op" id="3834051">.</span><span class="ident" id="3834052">b</span><span class="op" id="3834053">.</span><span class="ident" id="3834054">abs</span><span class="op" id="3834057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834060">a2</span>&nbsp;<span class="op" id="3834063">:=</span>&nbsp;<span class="ident" id="3834066">scaleDenom</span><span class="op" id="3834076">(</span><span class="op" id="3834077">&amp;</span><span class="ident" id="3834078">y</span><span class="op" id="3834079">.</span><span class="ident" id="3834080">a</span><span class="op" id="3834081">,</span>&nbsp;<span class="ident" id="3834083">x</span><span class="op" id="3834084">.</span><span class="ident" id="3834085">b</span><span class="op" id="3834086">.</span><span class="ident" id="3834087">abs</span><span class="op" id="3834090">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834093">z</span><span class="op" id="3834094">.</span><span class="ident" id="3834095">a</span><span class="op" id="3834096">.</span><span class="ident" id="3834097">Add</span><span class="op" id="3834100">(</span><span class="ident" id="3834101">a1</span><span class="op" id="3834103">,</span>&nbsp;<span class="ident" id="3834105">a2</span><span class="op" id="3834107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834110">z</span><span class="op" id="3834111">.</span><span class="ident" id="3834112">b</span><span class="op" id="3834113">.</span><span class="ident" id="3834114">abs</span>&nbsp;<span class="op" id="3834118">=</span>&nbsp;<span class="ident" id="3834120">mulDenom</span><span class="op" id="3834128">(</span><span class="ident" id="3834129">z</span><span class="op" id="3834130">.</span><span class="ident" id="3834131">b</span><span class="op" id="3834132">.</span><span class="ident" id="3834133">abs</span><span class="op" id="3834136">,</span>&nbsp;<span class="ident" id="3834138">x</span><span class="op" id="3834139">.</span><span class="ident" id="3834140">b</span><span class="op" id="3834141">.</span><span class="ident" id="3834142">abs</span><span class="op" id="3834145">,</span>&nbsp;<span class="ident" id="3834147">y</span><span class="op" id="3834148">.</span><span class="ident" id="3834149">b</span><span class="op" id="3834150">.</span><span class="ident" id="3834151">abs</span><span class="op" id="3834154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3834157">return</span>&nbsp;<span class="ident" id="3834164">z</span><span class="op" id="3834165">.</span><span class="ident" id="3834166">norm</span><span class="op" id="3834170">(</span><span class="op" id="3834171">)</span><br>
<span class="lineno"></span><span class="op" id="3834173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="3834176">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3834227">func</span>&nbsp;<span class="op" id="3834232">(</span><span class="ident" id="3834233">z</span>&nbsp;<span class="op" id="3834235">*</span><span class="ident" id="3834236">Rat</span><span class="op" id="3834239">)</span>&nbsp;<span class="ident" id="3834241">Sub</span><span class="op" id="3834244">(</span><span class="ident" id="3834245">x</span><span class="op" id="3834246">,</span>&nbsp;<span class="ident" id="3834248">y</span>&nbsp;<span class="op" id="3834250">*</span><span class="ident" id="3834251">Rat</span><span class="op" id="3834254">)</span>&nbsp;<span class="op" id="3834256">*</span><span class="ident" id="3834257">Rat</span>&nbsp;<span class="op" id="3834261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834264">a1</span>&nbsp;<span class="op" id="3834267">:=</span>&nbsp;<span class="ident" id="3834270">scaleDenom</span><span class="op" id="3834280">(</span><span class="op" id="3834281">&amp;</span><span class="ident" id="3834282">x</span><span class="op" id="3834283">.</span><span class="ident" id="3834284">a</span><span class="op" id="3834285">,</span>&nbsp;<span class="ident" id="3834287">y</span><span class="op" id="3834288">.</span><span class="ident" id="3834289">b</span><span class="op" id="3834290">.</span><span class="ident" id="3834291">abs</span><span class="op" id="3834294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834297">a2</span>&nbsp;<span class="op" id="3834300">:=</span>&nbsp;<span class="ident" id="3834303">scaleDenom</span><span class="op" id="3834313">(</span><span class="op" id="3834314">&amp;</span><span class="ident" id="3834315">y</span><span class="op" id="3834316">.</span><span class="ident" id="3834317">a</span><span class="op" id="3834318">,</span>&nbsp;<span class="ident" id="3834320">x</span><span class="op" id="3834321">.</span><span class="ident" id="3834322">b</span><span class="op" id="3834323">.</span><span class="ident" id="3834324">abs</span><span class="op" id="3834327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834330">z</span><span class="op" id="3834331">.</span><span class="ident" id="3834332">a</span><span class="op" id="3834333">.</span><span class="ident" id="3834334">Sub</span><span class="op" id="3834337">(</span><span class="ident" id="3834338">a1</span><span class="op" id="3834340">,</span>&nbsp;<span class="ident" id="3834342">a2</span><span class="op" id="3834344">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834347">z</span><span class="op" id="3834348">.</span><span class="ident" id="3834349">b</span><span class="op" id="3834350">.</span><span class="ident" id="3834351">abs</span>&nbsp;<span class="op" id="3834355">=</span>&nbsp;<span class="ident" id="3834357">mulDenom</span><span class="op" id="3834365">(</span><span class="ident" id="3834366">z</span><span class="op" id="3834367">.</span><span class="ident" id="3834368">b</span><span class="op" id="3834369">.</span><span class="ident" id="3834370">abs</span><span class="op" id="3834373">,</span>&nbsp;<span class="ident" id="3834375">x</span><span class="op" id="3834376">.</span><span class="ident" id="3834377">b</span><span class="op" id="3834378">.</span><span class="ident" id="3834379">abs</span><span class="op" id="3834382">,</span>&nbsp;<span class="ident" id="3834384">y</span><span class="op" id="3834385">.</span><span class="ident" id="3834386">b</span><span class="op" id="3834387">.</span><span class="ident" id="3834388">abs</span><span class="op" id="3834391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3834394">return</span>&nbsp;<span class="ident" id="3834401">z</span><span class="op" id="3834402">.</span><span class="ident" id="3834403">norm</span><span class="op" id="3834407">(</span><span class="op" id="3834408">)</span><br>
<span class="lineno"></span><span class="op" id="3834410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3834413">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="3834461">func</span>&nbsp;<span class="op" id="3834466">(</span><span class="ident" id="3834467">z</span>&nbsp;<span class="op" id="3834469">*</span><span class="ident" id="3834470">Rat</span><span class="op" id="3834473">)</span>&nbsp;<span class="ident" id="3834475">Mul</span><span class="op" id="3834478">(</span><span class="ident" id="3834479">x</span><span class="op" id="3834480">,</span>&nbsp;<span class="ident" id="3834482">y</span>&nbsp;<span class="op" id="3834484">*</span><span class="ident" id="3834485">Rat</span><span class="op" id="3834488">)</span>&nbsp;<span class="op" id="3834490">*</span><span class="ident" id="3834491">Rat</span>&nbsp;<span class="op" id="3834495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834498">z</span><span class="op" id="3834499">.</span><span class="ident" id="3834500">a</span><span class="op" id="3834501">.</span><span class="ident" id="3834502">Mul</span><span class="op" id="3834505">(</span><span class="op" id="3834506">&amp;</span><span class="ident" id="3834507">x</span><span class="op" id="3834508">.</span><span class="ident" id="3834509">a</span><span class="op" id="3834510">,</span>&nbsp;<span class="op" id="3834512">&amp;</span><span class="ident" id="3834513">y</span><span class="op" id="3834514">.</span><span class="ident" id="3834515">a</span><span class="op" id="3834516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834519">z</span><span class="op" id="3834520">.</span><span class="ident" id="3834521">b</span><span class="op" id="3834522">.</span><span class="ident" id="3834523">abs</span>&nbsp;<span class="op" id="3834527">=</span>&nbsp;<span class="ident" id="3834529">mulDenom</span><span class="op" id="3834537">(</span><span class="ident" id="3834538">z</span><span class="op" id="3834539">.</span><span class="ident" id="3834540">b</span><span class="op" id="3834541">.</span><span class="ident" id="3834542">abs</span><span class="op" id="3834545">,</span>&nbsp;<span class="ident" id="3834547">x</span><span class="op" id="3834548">.</span><span class="ident" id="3834549">b</span><span class="op" id="3834550">.</span><span class="ident" id="3834551">abs</span><span class="op" id="3834554">,</span>&nbsp;<span class="ident" id="3834556">y</span><span class="op" id="3834557">.</span><span class="ident" id="3834558">b</span><span class="op" id="3834559">.</span><span class="ident" id="3834560">abs</span><span class="op" id="3834563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3834566">return</span>&nbsp;<span class="ident" id="3834573">z</span><span class="op" id="3834574">.</span><span class="ident" id="3834575">norm</span><span class="op" id="3834579">(</span><span class="op" id="3834580">)</span><br>
<span class="lineno"></span><span class="op" id="3834582">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="3834585">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3834634">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="3834690">func</span>&nbsp;<span class="op" id="3834695">(</span><span class="ident" id="3834696">z</span>&nbsp;<span class="op" id="3834698">*</span><span class="ident" id="3834699">Rat</span><span class="op" id="3834702">)</span>&nbsp;<span class="ident" id="3834704">Quo</span><span class="op" id="3834707">(</span><span class="ident" id="3834708">x</span><span class="op" id="3834709">,</span>&nbsp;<span class="ident" id="3834711">y</span>&nbsp;<span class="op" id="3834713">*</span><span class="ident" id="3834714">Rat</span><span class="op" id="3834717">)</span>&nbsp;<span class="op" id="3834719">*</span><span class="ident" id="3834720">Rat</span>&nbsp;<span class="op" id="3834724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3834727">if</span>&nbsp;<span class="builtinfunc" id="3834730">len</span><span class="op" id="3834733">(</span><span class="ident" id="3834734">y</span><span class="op" id="3834735">.</span><span class="ident" id="3834736">a</span><span class="op" id="3834737">.</span><span class="ident" id="3834738">abs</span><span class="op" id="3834741">)</span>&nbsp;<span class="op" id="3834743">==</span>&nbsp;<span class="num" id="3834746">0</span>&nbsp;<span class="op" id="3834748">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3834752">panic</span><span class="op" id="3834757">(</span><span class="string" id="3834758">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3834776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3834779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834782">a</span>&nbsp;<span class="op" id="3834784">:=</span>&nbsp;<span class="ident" id="3834787">scaleDenom</span><span class="op" id="3834797">(</span><span class="op" id="3834798">&amp;</span><span class="ident" id="3834799">x</span><span class="op" id="3834800">.</span><span class="ident" id="3834801">a</span><span class="op" id="3834802">,</span>&nbsp;<span class="ident" id="3834804">y</span><span class="op" id="3834805">.</span><span class="ident" id="3834806">b</span><span class="op" id="3834807">.</span><span class="ident" id="3834808">abs</span><span class="op" id="3834811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834814">b</span>&nbsp;<span class="op" id="3834816">:=</span>&nbsp;<span class="ident" id="3834819">scaleDenom</span><span class="op" id="3834829">(</span><span class="op" id="3834830">&amp;</span><span class="ident" id="3834831">y</span><span class="op" id="3834832">.</span><span class="ident" id="3834833">a</span><span class="op" id="3834834">,</span>&nbsp;<span class="ident" id="3834836">x</span><span class="op" id="3834837">.</span><span class="ident" id="3834838">b</span><span class="op" id="3834839">.</span><span class="ident" id="3834840">abs</span><span class="op" id="3834843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834846">z</span><span class="op" id="3834847">.</span><span class="ident" id="3834848">a</span><span class="op" id="3834849">.</span><span class="ident" id="3834850">abs</span>&nbsp;<span class="op" id="3834854">=</span>&nbsp;<span class="ident" id="3834856">a</span><span class="op" id="3834857">.</span><span class="ident" id="3834858">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834863">z</span><span class="op" id="3834864">.</span><span class="ident" id="3834865">b</span><span class="op" id="3834866">.</span><span class="ident" id="3834867">abs</span>&nbsp;<span class="op" id="3834871">=</span>&nbsp;<span class="ident" id="3834873">b</span><span class="op" id="3834874">.</span><span class="ident" id="3834875">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3834880">z</span><span class="op" id="3834881">.</span><span class="ident" id="3834882">a</span><span class="op" id="3834883">.</span><span class="ident" id="3834884">neg</span>&nbsp;<span class="op" id="3834888">=</span>&nbsp;<span class="ident" id="3834890">a</span><span class="op" id="3834891">.</span><span class="ident" id="3834892">neg</span>&nbsp;<span class="op" id="3834896">!=</span>&nbsp;<span class="ident" id="3834899">b</span><span class="op" id="3834900">.</span><span class="ident" id="3834901">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3834906">return</span>&nbsp;<span class="ident" id="3834913">z</span><span class="op" id="3834914">.</span><span class="ident" id="3834915">norm</span><span class="op" id="3834919">(</span><span class="op" id="3834920">)</span><br>
<span class="lineno"></span><span class="op" id="3834922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="3834925">func</span>&nbsp;<span class="ident" id="3834930">ratTok</span><span class="op" id="3834936">(</span><span class="ident" id="3834937">ch</span>&nbsp;<span class="builtintype" id="3834940">rune</span><span class="op" id="3834944">)</span>&nbsp;<span class="builtintype" id="3834946">bool</span>&nbsp;<span class="op" id="3834951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3834954">return</span>&nbsp;<span class="ident" id="3834961">strings</span><span class="op" id="3834968">.</span><span class="ident" id="3834969">IndexRune</span><span class="op" id="3834978">(</span><span class="string" id="3834979">&#34;+-/0123456789.eE&#34;</span><span class="op" id="3834997">,</span>&nbsp;<span class="ident" id="3834999">ch</span><span class="op" id="3835001">)</span>&nbsp;<span class="op" id="3835003">&gt;=</span>&nbsp;<span class="num" id="3835006">0</span><br>
<span class="lineno"></span><span class="op" id="3835008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3835011">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="3835080">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="3835150">func</span>&nbsp;<span class="op" id="3835155">(</span><span class="ident" id="3835156">z</span>&nbsp;<span class="op" id="3835158">*</span><span class="ident" id="3835159">Rat</span><span class="op" id="3835162">)</span>&nbsp;<span class="ident" id="3835164">Scan</span><span class="op" id="3835168">(</span><span class="ident" id="3835169">s</span>&nbsp;<span class="ident" id="3835171">fmt</span><span class="op" id="3835174">.</span><span class="ident" id="3835175">ScanState</span><span class="op" id="3835184">,</span>&nbsp;<span class="ident" id="3835186">ch</span>&nbsp;<span class="builtintype" id="3835189">rune</span><span class="op" id="3835193">)</span>&nbsp;<span class="builtintype" id="3835195">error</span>&nbsp;<span class="op" id="3835201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3835204">tok</span><span class="op" id="3835207">,</span>&nbsp;<span class="ident" id="3835209">err</span>&nbsp;<span class="op" id="3835213">:=</span>&nbsp;<span class="ident" id="3835216">s</span><span class="op" id="3835217">.</span><span class="ident" id="3835218">Token</span><span class="op" id="3835223">(</span><span class="builtintype" id="3835224">true</span><span class="op" id="3835228">,</span>&nbsp;<span class="ident" id="3835230">ratTok</span><span class="op" id="3835236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835239">if</span>&nbsp;<span class="ident" id="3835242">err</span>&nbsp;<span class="op" id="3835246">!=</span>&nbsp;<span class="ident" id="3835249">nil</span>&nbsp;<span class="op" id="3835253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835257">return</span>&nbsp;<span class="ident" id="3835264">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3835269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835272">if</span>&nbsp;<span class="ident" id="3835275">strings</span><span class="op" id="3835282">.</span><span class="ident" id="3835283">IndexRune</span><span class="op" id="3835292">(</span><span class="string" id="3835293">&#34;efgEFGv&#34;</span><span class="op" id="3835302">,</span>&nbsp;<span class="ident" id="3835304">ch</span><span class="op" id="3835306">)</span>&nbsp;<span class="op" id="3835308">&lt;</span>&nbsp;<span class="num" id="3835310">0</span>&nbsp;<span class="op" id="3835312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835316">return</span>&nbsp;<span class="ident" id="3835323">errors</span><span class="op" id="3835329">.</span><span class="ident" id="3835330">New</span><span class="op" id="3835333">(</span><span class="string" id="3835334">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="3835358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3835361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835364">if</span>&nbsp;<span class="ident" id="3835367">_</span><span class="op" id="3835368">,</span>&nbsp;<span class="ident" id="3835370">ok</span>&nbsp;<span class="op" id="3835373">:=</span>&nbsp;<span class="ident" id="3835376">z</span><span class="op" id="3835377">.</span><span class="ident" id="3835378">SetString</span><span class="op" id="3835387">(</span><span class="builtintype" id="3835388">string</span><span class="op" id="3835394">(</span><span class="ident" id="3835395">tok</span><span class="op" id="3835398">)</span><span class="op" id="3835399">)</span><span class="op" id="3835400">;</span>&nbsp;<span class="op" id="3835402">!</span><span class="ident" id="3835403">ok</span>&nbsp;<span class="op" id="3835406">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835410">return</span>&nbsp;<span class="ident" id="3835417">errors</span><span class="op" id="3835423">.</span><span class="ident" id="3835424">New</span><span class="op" id="3835427">(</span><span class="string" id="3835428">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="3835454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3835457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835460">return</span>&nbsp;<span class="ident" id="3835467">nil</span><br>
<span class="lineno"></span><span class="op" id="3835471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3835474">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3835551">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3835628">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3835705">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3835754">func</span>&nbsp;<span class="op" id="3835759">(</span><span class="ident" id="3835760">z</span>&nbsp;<span class="op" id="3835762">*</span><span class="ident" id="3835763">Rat</span><span class="op" id="3835766">)</span>&nbsp;<span class="ident" id="3835768">SetString</span><span class="op" id="3835777">(</span><span class="ident" id="3835778">s</span>&nbsp;<span class="builtintype" id="3835780">string</span><span class="op" id="3835786">)</span>&nbsp;<span class="op" id="3835788">(</span><span class="op" id="3835789">*</span><span class="ident" id="3835790">Rat</span><span class="op" id="3835793">,</span>&nbsp;<span class="builtintype" id="3835795">bool</span><span class="op" id="3835799">)</span>&nbsp;<span class="op" id="3835801">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835804">if</span>&nbsp;<span class="builtinfunc" id="3835807">len</span><span class="op" id="3835810">(</span><span class="ident" id="3835811">s</span><span class="op" id="3835812">)</span>&nbsp;<span class="op" id="3835814">==</span>&nbsp;<span class="num" id="3835817">0</span>&nbsp;<span class="op" id="3835819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835823">return</span>&nbsp;<span class="ident" id="3835830">nil</span><span class="op" id="3835833">,</span>&nbsp;<span class="builtintype" id="3835835">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3835842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835846">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3835871">sep</span>&nbsp;<span class="op" id="3835875">:=</span>&nbsp;<span class="ident" id="3835878">strings</span><span class="op" id="3835885">.</span><span class="ident" id="3835886">Index</span><span class="op" id="3835891">(</span><span class="ident" id="3835892">s</span><span class="op" id="3835893">,</span>&nbsp;<span class="string" id="3835895">&#34;/&#34;</span><span class="op" id="3835898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835901">if</span>&nbsp;<span class="ident" id="3835904">sep</span>&nbsp;<span class="op" id="3835908">&gt;=</span>&nbsp;<span class="num" id="3835911">0</span>&nbsp;<span class="op" id="3835913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835917">if</span>&nbsp;<span class="ident" id="3835920">_</span><span class="op" id="3835921">,</span>&nbsp;<span class="ident" id="3835923">ok</span>&nbsp;<span class="op" id="3835926">:=</span>&nbsp;<span class="ident" id="3835929">z</span><span class="op" id="3835930">.</span><span class="ident" id="3835931">a</span><span class="op" id="3835932">.</span><span class="ident" id="3835933">SetString</span><span class="op" id="3835942">(</span><span class="ident" id="3835943">s</span><span class="op" id="3835944">[</span><span class="num" id="3835945">0</span><span class="op" id="3835946">:</span><span class="ident" id="3835947">sep</span><span class="op" id="3835950">]</span><span class="op" id="3835951">,</span>&nbsp;<span class="num" id="3835953">10</span><span class="op" id="3835955">)</span><span class="op" id="3835956">;</span>&nbsp;<span class="op" id="3835958">!</span><span class="ident" id="3835959">ok</span>&nbsp;<span class="op" id="3835962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3835967">return</span>&nbsp;<span class="ident" id="3835974">nil</span><span class="op" id="3835977">,</span>&nbsp;<span class="builtintype" id="3835979">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3835987">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3835991">s</span>&nbsp;<span class="op" id="3835993">=</span>&nbsp;<span class="ident" id="3835995">s</span><span class="op" id="3835996">[</span><span class="ident" id="3835997">sep</span><span class="op" id="3836000">+</span><span class="num" id="3836001">1</span><span class="op" id="3836002">:</span><span class="op" id="3836003">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836007">var</span>&nbsp;<span class="ident" id="3836011">err</span>&nbsp;<span class="builtintype" id="3836015">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836023">if</span>&nbsp;<span class="ident" id="3836026">z</span><span class="op" id="3836027">.</span><span class="ident" id="3836028">b</span><span class="op" id="3836029">.</span><span class="ident" id="3836030">abs</span><span class="op" id="3836033">,</span>&nbsp;<span class="ident" id="3836035">_</span><span class="op" id="3836036">,</span>&nbsp;<span class="ident" id="3836038">err</span>&nbsp;<span class="op" id="3836042">=</span>&nbsp;<span class="ident" id="3836044">z</span><span class="op" id="3836045">.</span><span class="ident" id="3836046">b</span><span class="op" id="3836047">.</span><span class="ident" id="3836048">abs</span><span class="op" id="3836051">.</span><span class="ident" id="3836052">scan</span><span class="op" id="3836056">(</span><span class="ident" id="3836057">strings</span><span class="op" id="3836064">.</span><span class="ident" id="3836065">NewReader</span><span class="op" id="3836074">(</span><span class="ident" id="3836075">s</span><span class="op" id="3836076">)</span><span class="op" id="3836077">,</span>&nbsp;<span class="num" id="3836079">10</span><span class="op" id="3836081">)</span><span class="op" id="3836082">;</span>&nbsp;<span class="ident" id="3836084">err</span>&nbsp;<span class="op" id="3836088">!=</span>&nbsp;<span class="ident" id="3836091">nil</span>&nbsp;<span class="op" id="3836095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836100">return</span>&nbsp;<span class="ident" id="3836107">nil</span><span class="op" id="3836110">,</span>&nbsp;<span class="builtintype" id="3836112">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836120">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836124">if</span>&nbsp;<span class="builtinfunc" id="3836127">len</span><span class="op" id="3836130">(</span><span class="ident" id="3836131">z</span><span class="op" id="3836132">.</span><span class="ident" id="3836133">b</span><span class="op" id="3836134">.</span><span class="ident" id="3836135">abs</span><span class="op" id="3836138">)</span>&nbsp;<span class="op" id="3836140">==</span>&nbsp;<span class="num" id="3836143">0</span>&nbsp;<span class="op" id="3836145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836150">return</span>&nbsp;<span class="ident" id="3836157">nil</span><span class="op" id="3836160">,</span>&nbsp;<span class="builtintype" id="3836162">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836174">return</span>&nbsp;<span class="ident" id="3836181">z</span><span class="op" id="3836182">.</span><span class="ident" id="3836183">norm</span><span class="op" id="3836187">(</span><span class="op" id="3836188">)</span><span class="op" id="3836189">,</span>&nbsp;<span class="builtintype" id="3836191">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836197">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3836201">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836231">sep</span>&nbsp;<span class="op" id="3836235">=</span>&nbsp;<span class="ident" id="3836237">strings</span><span class="op" id="3836244">.</span><span class="ident" id="3836245">Index</span><span class="op" id="3836250">(</span><span class="ident" id="3836251">s</span><span class="op" id="3836252">,</span>&nbsp;<span class="string" id="3836254">&#34;.&#34;</span><span class="op" id="3836257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3836260">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836286">e</span>&nbsp;<span class="op" id="3836288">:=</span>&nbsp;<span class="ident" id="3836291">strings</span><span class="op" id="3836298">.</span><span class="ident" id="3836299">IndexAny</span><span class="op" id="3836307">(</span><span class="ident" id="3836308">s</span><span class="op" id="3836309">,</span>&nbsp;<span class="string" id="3836311">&#34;eE&#34;</span><span class="op" id="3836315">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836318">var</span>&nbsp;<span class="ident" id="3836322">exp</span>&nbsp;<span class="ident" id="3836326">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836331">if</span>&nbsp;<span class="ident" id="3836334">e</span>&nbsp;<span class="op" id="3836336">&gt;=</span>&nbsp;<span class="num" id="3836339">0</span>&nbsp;<span class="op" id="3836341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836345">if</span>&nbsp;<span class="ident" id="3836348">e</span>&nbsp;<span class="op" id="3836350">&lt;</span>&nbsp;<span class="ident" id="3836352">sep</span>&nbsp;<span class="op" id="3836356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3836361">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836408">return</span>&nbsp;<span class="ident" id="3836415">nil</span><span class="op" id="3836418">,</span>&nbsp;<span class="builtintype" id="3836420">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836432">if</span>&nbsp;<span class="ident" id="3836435">_</span><span class="op" id="3836436">,</span>&nbsp;<span class="ident" id="3836438">ok</span>&nbsp;<span class="op" id="3836441">:=</span>&nbsp;<span class="ident" id="3836444">exp</span><span class="op" id="3836447">.</span><span class="ident" id="3836448">SetString</span><span class="op" id="3836457">(</span><span class="ident" id="3836458">s</span><span class="op" id="3836459">[</span><span class="ident" id="3836460">e</span><span class="op" id="3836461">+</span><span class="num" id="3836462">1</span><span class="op" id="3836463">:</span><span class="op" id="3836464">]</span><span class="op" id="3836465">,</span>&nbsp;<span class="num" id="3836467">10</span><span class="op" id="3836469">)</span><span class="op" id="3836470">;</span>&nbsp;<span class="op" id="3836472">!</span><span class="ident" id="3836473">ok</span>&nbsp;<span class="op" id="3836476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836481">return</span>&nbsp;<span class="ident" id="3836488">nil</span><span class="op" id="3836491">,</span>&nbsp;<span class="builtintype" id="3836493">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836505">s</span>&nbsp;<span class="op" id="3836507">=</span>&nbsp;<span class="ident" id="3836509">s</span><span class="op" id="3836510">[</span><span class="num" id="3836511">0</span><span class="op" id="3836512">:</span><span class="ident" id="3836513">e</span><span class="op" id="3836514">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836520">if</span>&nbsp;<span class="ident" id="3836523">sep</span>&nbsp;<span class="op" id="3836527">&gt;=</span>&nbsp;<span class="num" id="3836530">0</span>&nbsp;<span class="op" id="3836532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836536">s</span>&nbsp;<span class="op" id="3836538">=</span>&nbsp;<span class="ident" id="3836540">s</span><span class="op" id="3836541">[</span><span class="num" id="3836542">0</span><span class="op" id="3836543">:</span><span class="ident" id="3836544">sep</span><span class="op" id="3836547">]</span>&nbsp;<span class="op" id="3836549">+</span>&nbsp;<span class="ident" id="3836551">s</span><span class="op" id="3836552">[</span><span class="ident" id="3836553">sep</span><span class="op" id="3836556">+</span><span class="num" id="3836557">1</span><span class="op" id="3836558">:</span><span class="op" id="3836559">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836563">exp</span><span class="op" id="3836566">.</span><span class="ident" id="3836567">Sub</span><span class="op" id="3836570">(</span><span class="op" id="3836571">&amp;</span><span class="ident" id="3836572">exp</span><span class="op" id="3836575">,</span>&nbsp;<span class="ident" id="3836577">NewInt</span><span class="op" id="3836583">(</span><span class="ident" id="3836584">int64</span><span class="op" id="3836589">(</span><span class="builtinfunc" id="3836590">len</span><span class="op" id="3836593">(</span><span class="ident" id="3836594">s</span><span class="op" id="3836595">)</span><span class="op" id="3836596">-</span><span class="ident" id="3836597">sep</span><span class="op" id="3836600">)</span><span class="op" id="3836601">)</span><span class="op" id="3836602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836605">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836609">if</span>&nbsp;<span class="ident" id="3836612">_</span><span class="op" id="3836613">,</span>&nbsp;<span class="ident" id="3836615">ok</span>&nbsp;<span class="op" id="3836618">:=</span>&nbsp;<span class="ident" id="3836621">z</span><span class="op" id="3836622">.</span><span class="ident" id="3836623">a</span><span class="op" id="3836624">.</span><span class="ident" id="3836625">SetString</span><span class="op" id="3836634">(</span><span class="ident" id="3836635">s</span><span class="op" id="3836636">,</span>&nbsp;<span class="num" id="3836638">10</span><span class="op" id="3836640">)</span><span class="op" id="3836641">;</span>&nbsp;<span class="op" id="3836643">!</span><span class="ident" id="3836644">ok</span>&nbsp;<span class="op" id="3836647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836651">return</span>&nbsp;<span class="ident" id="3836658">nil</span><span class="op" id="3836661">,</span>&nbsp;<span class="builtintype" id="3836663">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836673">powTen</span>&nbsp;<span class="op" id="3836680">:=</span>&nbsp;<span class="ident" id="3836683">nat</span><span class="op" id="3836686">(</span><span class="ident" id="3836687">nil</span><span class="op" id="3836690">)</span><span class="op" id="3836691">.</span><span class="ident" id="3836692">expNN</span><span class="op" id="3836697">(</span><span class="ident" id="3836698">natTen</span><span class="op" id="3836704">,</span>&nbsp;<span class="ident" id="3836706">exp</span><span class="op" id="3836709">.</span><span class="ident" id="3836710">abs</span><span class="op" id="3836713">,</span>&nbsp;<span class="ident" id="3836715">nil</span><span class="op" id="3836718">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836721">if</span>&nbsp;<span class="ident" id="3836724">exp</span><span class="op" id="3836727">.</span><span class="ident" id="3836728">neg</span>&nbsp;<span class="op" id="3836732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836736">z</span><span class="op" id="3836737">.</span><span class="ident" id="3836738">b</span><span class="op" id="3836739">.</span><span class="ident" id="3836740">abs</span>&nbsp;<span class="op" id="3836744">=</span>&nbsp;<span class="ident" id="3836746">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836755">z</span><span class="op" id="3836756">.</span><span class="ident" id="3836757">norm</span><span class="op" id="3836761">(</span><span class="op" id="3836762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836765">}</span>&nbsp;<span class="keyword" id="3836767">else</span>&nbsp;<span class="op" id="3836772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836776">z</span><span class="op" id="3836777">.</span><span class="ident" id="3836778">a</span><span class="op" id="3836779">.</span><span class="ident" id="3836780">abs</span>&nbsp;<span class="op" id="3836784">=</span>&nbsp;<span class="ident" id="3836786">z</span><span class="op" id="3836787">.</span><span class="ident" id="3836788">a</span><span class="op" id="3836789">.</span><span class="ident" id="3836790">abs</span><span class="op" id="3836793">.</span><span class="ident" id="3836794">mul</span><span class="op" id="3836797">(</span><span class="ident" id="3836798">z</span><span class="op" id="3836799">.</span><span class="ident" id="3836800">a</span><span class="op" id="3836801">.</span><span class="ident" id="3836802">abs</span><span class="op" id="3836805">,</span>&nbsp;<span class="ident" id="3836807">powTen</span><span class="op" id="3836813">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836817">z</span><span class="op" id="3836818">.</span><span class="ident" id="3836819">b</span><span class="op" id="3836820">.</span><span class="ident" id="3836821">abs</span>&nbsp;<span class="op" id="3836825">=</span>&nbsp;<span class="ident" id="3836827">z</span><span class="op" id="3836828">.</span><span class="ident" id="3836829">b</span><span class="op" id="3836830">.</span><span class="ident" id="3836831">abs</span><span class="op" id="3836834">.</span><span class="builtinfunc" id="3836835">make</span><span class="op" id="3836839">(</span><span class="num" id="3836840">0</span><span class="op" id="3836841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836848">return</span>&nbsp;<span class="ident" id="3836855">z</span><span class="op" id="3836856">,</span>&nbsp;<span class="builtintype" id="3836858">true</span><br>
<span class="lineno"></span><span class="op" id="3836863">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="3836866">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="3836949">func</span>&nbsp;<span class="op" id="3836954">(</span><span class="ident" id="3836955">x</span>&nbsp;<span class="op" id="3836957">*</span><span class="ident" id="3836958">Rat</span><span class="op" id="3836961">)</span>&nbsp;<span class="ident" id="3836963">String</span><span class="op" id="3836969">(</span><span class="op" id="3836970">)</span>&nbsp;<span class="builtintype" id="3836972">string</span>&nbsp;<span class="op" id="3836979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836982">s</span>&nbsp;<span class="op" id="3836984">:=</span>&nbsp;<span class="string" id="3836987">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836993">if</span>&nbsp;<span class="builtinfunc" id="3836996">len</span><span class="op" id="3836999">(</span><span class="ident" id="3837000">x</span><span class="op" id="3837001">.</span><span class="ident" id="3837002">b</span><span class="op" id="3837003">.</span><span class="ident" id="3837004">abs</span><span class="op" id="3837007">)</span>&nbsp;<span class="op" id="3837009">!=</span>&nbsp;<span class="num" id="3837012">0</span>&nbsp;<span class="op" id="3837014">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837018">s</span>&nbsp;<span class="op" id="3837020">=</span>&nbsp;<span class="string" id="3837022">&#34;/&#34;</span>&nbsp;<span class="op" id="3837026">+</span>&nbsp;<span class="ident" id="3837028">x</span><span class="op" id="3837029">.</span><span class="ident" id="3837030">b</span><span class="op" id="3837031">.</span><span class="ident" id="3837032">abs</span><span class="op" id="3837035">.</span><span class="ident" id="3837036">decimalString</span><span class="op" id="3837049">(</span><span class="op" id="3837050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3837053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837056">return</span>&nbsp;<span class="ident" id="3837063">x</span><span class="op" id="3837064">.</span><span class="ident" id="3837065">a</span><span class="op" id="3837066">.</span><span class="ident" id="3837067">String</span><span class="op" id="3837073">(</span><span class="op" id="3837074">)</span>&nbsp;<span class="op" id="3837076">+</span>&nbsp;<span class="ident" id="3837078">s</span><br>
<span class="lineno"></span><span class="op" id="3837080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="3837083">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="3837162">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3837196">func</span>&nbsp;<span class="op" id="3837201">(</span><span class="ident" id="3837202">x</span>&nbsp;<span class="op" id="3837204">*</span><span class="ident" id="3837205">Rat</span><span class="op" id="3837208">)</span>&nbsp;<span class="ident" id="3837210">RatString</span><span class="op" id="3837219">(</span><span class="op" id="3837220">)</span>&nbsp;<span class="builtintype" id="3837222">string</span>&nbsp;<span class="op" id="3837229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837232">if</span>&nbsp;<span class="ident" id="3837235">x</span><span class="op" id="3837236">.</span><span class="ident" id="3837237">IsInt</span><span class="op" id="3837242">(</span><span class="op" id="3837243">)</span>&nbsp;<span class="op" id="3837245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837249">return</span>&nbsp;<span class="ident" id="3837256">x</span><span class="op" id="3837257">.</span><span class="ident" id="3837258">a</span><span class="op" id="3837259">.</span><span class="ident" id="3837260">String</span><span class="op" id="3837266">(</span><span class="op" id="3837267">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3837270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837273">return</span>&nbsp;<span class="ident" id="3837280">x</span><span class="op" id="3837281">.</span><span class="ident" id="3837282">String</span><span class="op" id="3837288">(</span><span class="op" id="3837289">)</span><br>
<span class="lineno"></span><span class="op" id="3837291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3837294">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="3837372">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="3837447">func</span>&nbsp;<span class="op" id="3837452">(</span><span class="ident" id="3837453">x</span>&nbsp;<span class="op" id="3837455">*</span><span class="ident" id="3837456">Rat</span><span class="op" id="3837459">)</span>&nbsp;<span class="ident" id="3837461">FloatString</span><span class="op" id="3837472">(</span><span class="ident" id="3837473">prec</span>&nbsp;<span class="builtintype" id="3837478">int</span><span class="op" id="3837481">)</span>&nbsp;<span class="builtintype" id="3837483">string</span>&nbsp;<span class="op" id="3837490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837493">if</span>&nbsp;<span class="ident" id="3837496">x</span><span class="op" id="3837497">.</span><span class="ident" id="3837498">IsInt</span><span class="op" id="3837503">(</span><span class="op" id="3837504">)</span>&nbsp;<span class="op" id="3837506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837510">s</span>&nbsp;<span class="op" id="3837512">:=</span>&nbsp;<span class="ident" id="3837515">x</span><span class="op" id="3837516">.</span><span class="ident" id="3837517">a</span><span class="op" id="3837518">.</span><span class="ident" id="3837519">String</span><span class="op" id="3837525">(</span><span class="op" id="3837526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837530">if</span>&nbsp;<span class="ident" id="3837533">prec</span>&nbsp;<span class="op" id="3837538">&gt;</span>&nbsp;<span class="num" id="3837540">0</span>&nbsp;<span class="op" id="3837542">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837547">s</span>&nbsp;<span class="op" id="3837549">+=</span>&nbsp;<span class="string" id="3837552">&#34;.&#34;</span>&nbsp;<span class="op" id="3837556">+</span>&nbsp;<span class="ident" id="3837558">strings</span><span class="op" id="3837565">.</span><span class="ident" id="3837566">Repeat</span><span class="op" id="3837572">(</span><span class="string" id="3837573">&#34;0&#34;</span><span class="op" id="3837576">,</span>&nbsp;<span class="ident" id="3837578">prec</span><span class="op" id="3837582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3837586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837590">return</span>&nbsp;<span class="ident" id="3837597">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3837600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3837603">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837621">q</span><span class="op" id="3837622">,</span>&nbsp;<span class="ident" id="3837624">r</span>&nbsp;<span class="op" id="3837626">:=</span>&nbsp;<span class="ident" id="3837629">nat</span><span class="op" id="3837632">(</span><span class="ident" id="3837633">nil</span><span class="op" id="3837636">)</span><span class="op" id="3837637">.</span><span class="ident" id="3837638">div</span><span class="op" id="3837641">(</span><span class="ident" id="3837642">nat</span><span class="op" id="3837645">(</span><span class="ident" id="3837646">nil</span><span class="op" id="3837649">)</span><span class="op" id="3837650">,</span>&nbsp;<span class="ident" id="3837652">x</span><span class="op" id="3837653">.</span><span class="ident" id="3837654">a</span><span class="op" id="3837655">.</span><span class="ident" id="3837656">abs</span><span class="op" id="3837659">,</span>&nbsp;<span class="ident" id="3837661">x</span><span class="op" id="3837662">.</span><span class="ident" id="3837663">b</span><span class="op" id="3837664">.</span><span class="ident" id="3837665">abs</span><span class="op" id="3837668">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837672">p</span>&nbsp;<span class="op" id="3837674">:=</span>&nbsp;<span class="ident" id="3837677">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837685">if</span>&nbsp;<span class="ident" id="3837688">prec</span>&nbsp;<span class="op" id="3837693">&gt;</span>&nbsp;<span class="num" id="3837695">0</span>&nbsp;<span class="op" id="3837697">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837701">p</span>&nbsp;<span class="op" id="3837703">=</span>&nbsp;<span class="ident" id="3837705">nat</span><span class="op" id="3837708">(</span><span class="ident" id="3837709">nil</span><span class="op" id="3837712">)</span><span class="op" id="3837713">.</span><span class="ident" id="3837714">expNN</span><span class="op" id="3837719">(</span><span class="ident" id="3837720">natTen</span><span class="op" id="3837726">,</span>&nbsp;<span class="ident" id="3837728">nat</span><span class="op" id="3837731">(</span><span class="ident" id="3837732">nil</span><span class="op" id="3837735">)</span><span class="op" id="3837736">.</span><span class="ident" id="3837737">setUint64</span><span class="op" id="3837746">(</span><span class="ident" id="3837747">uint64</span><span class="op" id="3837753">(</span><span class="ident" id="3837754">prec</span><span class="op" id="3837758">)</span><span class="op" id="3837759">)</span><span class="op" id="3837760">,</span>&nbsp;<span class="ident" id="3837762">nil</span><span class="op" id="3837765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3837768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837772">r</span>&nbsp;<span class="op" id="3837774">=</span>&nbsp;<span class="ident" id="3837776">r</span><span class="op" id="3837777">.</span><span class="ident" id="3837778">mul</span><span class="op" id="3837781">(</span><span class="ident" id="3837782">r</span><span class="op" id="3837783">,</span>&nbsp;<span class="ident" id="3837785">p</span><span class="op" id="3837786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837789">r</span><span class="op" id="3837790">,</span>&nbsp;<span class="ident" id="3837792">r2</span>&nbsp;<span class="op" id="3837795">:=</span>&nbsp;<span class="ident" id="3837798">r</span><span class="op" id="3837799">.</span><span class="ident" id="3837800">div</span><span class="op" id="3837803">(</span><span class="ident" id="3837804">nat</span><span class="op" id="3837807">(</span><span class="ident" id="3837808">nil</span><span class="op" id="3837811">)</span><span class="op" id="3837812">,</span>&nbsp;<span class="ident" id="3837814">r</span><span class="op" id="3837815">,</span>&nbsp;<span class="ident" id="3837817">x</span><span class="op" id="3837818">.</span><span class="ident" id="3837819">b</span><span class="op" id="3837820">.</span><span class="ident" id="3837821">abs</span><span class="op" id="3837824">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3837828">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837859">r2</span>&nbsp;<span class="op" id="3837862">=</span>&nbsp;<span class="ident" id="3837864">r2</span><span class="op" id="3837866">.</span><span class="ident" id="3837867">add</span><span class="op" id="3837870">(</span><span class="ident" id="3837871">r2</span><span class="op" id="3837873">,</span>&nbsp;<span class="ident" id="3837875">r2</span><span class="op" id="3837877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837880">if</span>&nbsp;<span class="ident" id="3837883">x</span><span class="op" id="3837884">.</span><span class="ident" id="3837885">b</span><span class="op" id="3837886">.</span><span class="ident" id="3837887">abs</span><span class="op" id="3837890">.</span><span class="ident" id="3837891">cmp</span><span class="op" id="3837894">(</span><span class="ident" id="3837895">r2</span><span class="op" id="3837897">)</span>&nbsp;<span class="op" id="3837899">&lt;=</span>&nbsp;<span class="num" id="3837902">0</span>&nbsp;<span class="op" id="3837904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837908">r</span>&nbsp;<span class="op" id="3837910">=</span>&nbsp;<span class="ident" id="3837912">r</span><span class="op" id="3837913">.</span><span class="ident" id="3837914">add</span><span class="op" id="3837917">(</span><span class="ident" id="3837918">r</span><span class="op" id="3837919">,</span>&nbsp;<span class="ident" id="3837921">natOne</span><span class="op" id="3837927">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837931">if</span>&nbsp;<span class="ident" id="3837934">r</span><span class="op" id="3837935">.</span><span class="ident" id="3837936">cmp</span><span class="op" id="3837939">(</span><span class="ident" id="3837940">p</span><span class="op" id="3837941">)</span>&nbsp;<span class="op" id="3837943">&gt;=</span>&nbsp;<span class="num" id="3837946">0</span>&nbsp;<span class="op" id="3837948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837953">q</span>&nbsp;<span class="op" id="3837955">=</span>&nbsp;<span class="ident" id="3837957">nat</span><span class="op" id="3837960">(</span><span class="ident" id="3837961">nil</span><span class="op" id="3837964">)</span><span class="op" id="3837965">.</span><span class="ident" id="3837966">add</span><span class="op" id="3837969">(</span><span class="ident" id="3837970">q</span><span class="op" id="3837971">,</span>&nbsp;<span class="ident" id="3837973">natOne</span><span class="op" id="3837979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837984">r</span>&nbsp;<span class="op" id="3837986">=</span>&nbsp;<span class="ident" id="3837988">nat</span><span class="op" id="3837991">(</span><span class="ident" id="3837992">nil</span><span class="op" id="3837995">)</span><span class="op" id="3837996">.</span><span class="ident" id="3837997">sub</span><span class="op" id="3838000">(</span><span class="ident" id="3838001">r</span><span class="op" id="3838002">,</span>&nbsp;<span class="ident" id="3838004">p</span><span class="op" id="3838005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3838009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3838012">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838016">s</span>&nbsp;<span class="op" id="3838018">:=</span>&nbsp;<span class="ident" id="3838021">q</span><span class="op" id="3838022">.</span><span class="ident" id="3838023">decimalString</span><span class="op" id="3838036">(</span><span class="op" id="3838037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838040">if</span>&nbsp;<span class="ident" id="3838043">x</span><span class="op" id="3838044">.</span><span class="ident" id="3838045">a</span><span class="op" id="3838046">.</span><span class="ident" id="3838047">neg</span>&nbsp;<span class="op" id="3838051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838055">s</span>&nbsp;<span class="op" id="3838057">=</span>&nbsp;<span class="string" id="3838059">&#34;-&#34;</span>&nbsp;<span class="op" id="3838063">+</span>&nbsp;<span class="ident" id="3838065">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3838068">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838072">if</span>&nbsp;<span class="ident" id="3838075">prec</span>&nbsp;<span class="op" id="3838080">&gt;</span>&nbsp;<span class="num" id="3838082">0</span>&nbsp;<span class="op" id="3838084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838088">rs</span>&nbsp;<span class="op" id="3838091">:=</span>&nbsp;<span class="ident" id="3838094">r</span><span class="op" id="3838095">.</span><span class="ident" id="3838096">decimalString</span><span class="op" id="3838109">(</span><span class="op" id="3838110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838114">leadingZeros</span>&nbsp;<span class="op" id="3838127">:=</span>&nbsp;<span class="ident" id="3838130">prec</span>&nbsp;<span class="op" id="3838135">-</span>&nbsp;<span class="builtinfunc" id="3838137">len</span><span class="op" id="3838140">(</span><span class="ident" id="3838141">rs</span><span class="op" id="3838143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838147">s</span>&nbsp;<span class="op" id="3838149">+=</span>&nbsp;<span class="string" id="3838152">&#34;.&#34;</span>&nbsp;<span class="op" id="3838156">+</span>&nbsp;<span class="ident" id="3838158">strings</span><span class="op" id="3838165">.</span><span class="ident" id="3838166">Repeat</span><span class="op" id="3838172">(</span><span class="string" id="3838173">&#34;0&#34;</span><span class="op" id="3838176">,</span>&nbsp;<span class="ident" id="3838178">leadingZeros</span><span class="op" id="3838190">)</span>&nbsp;<span class="op" id="3838192">+</span>&nbsp;<span class="ident" id="3838194">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3838198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838202">return</span>&nbsp;<span class="ident" id="3838209">s</span><br>
<span class="lineno"></span><span class="op" id="3838211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="3838214">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3838289">const</span>&nbsp;<span class="ident" id="3838295">ratGobVersion</span>&nbsp;<span class="builtintype" id="3838309">byte</span>&nbsp;<span class="op" id="3838314">=</span>&nbsp;<span class="num" id="3838316">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3838319">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3838373">func</span>&nbsp;<span class="op" id="3838378">(</span><span class="ident" id="3838379">x</span>&nbsp;<span class="op" id="3838381">*</span><span class="ident" id="3838382">Rat</span><span class="op" id="3838385">)</span>&nbsp;<span class="ident" id="3838387">GobEncode</span><span class="op" id="3838396">(</span><span class="op" id="3838397">)</span>&nbsp;<span class="op" id="3838399">(</span><span class="op" id="3838400">[</span><span class="op" id="3838401">]</span><span class="builtintype" id="3838402">byte</span><span class="op" id="3838406">,</span>&nbsp;<span class="builtintype" id="3838408">error</span><span class="op" id="3838413">)</span>&nbsp;<span class="op" id="3838415">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838418">if</span>&nbsp;<span class="ident" id="3838421">x</span>&nbsp;<span class="op" id="3838423">==</span>&nbsp;<span class="ident" id="3838426">nil</span>&nbsp;<span class="op" id="3838430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838434">return</span>&nbsp;<span class="ident" id="3838441">nil</span><span class="op" id="3838444">,</span>&nbsp;<span class="ident" id="3838446">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3838451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838454">buf</span>&nbsp;<span class="op" id="3838458">:=</span>&nbsp;<span class="builtinfunc" id="3838461">make</span><span class="op" id="3838465">(</span><span class="op" id="3838466">[</span><span class="op" id="3838467">]</span><span class="builtintype" id="3838468">byte</span><span class="op" id="3838472">,</span>&nbsp;<span class="num" id="3838474">1</span><span class="op" id="3838475">+</span><span class="num" id="3838476">4</span><span class="op" id="3838477">+</span><span class="op" id="3838478">(</span><span class="builtinfunc" id="3838479">len</span><span class="op" id="3838482">(</span><span class="ident" id="3838483">x</span><span class="op" id="3838484">.</span><span class="ident" id="3838485">a</span><span class="op" id="3838486">.</span><span class="ident" id="3838487">abs</span><span class="op" id="3838490">)</span><span class="op" id="3838491">+</span><span class="builtinfunc" id="3838492">len</span><span class="op" id="3838495">(</span><span class="ident" id="3838496">x</span><span class="op" id="3838497">.</span><span class="ident" id="3838498">b</span><span class="op" id="3838499">.</span><span class="ident" id="3838500">abs</span><span class="op" id="3838503">)</span><span class="op" id="3838504">)</span><span class="op" id="3838505">*</span><span class="ident" id="3838506">_S</span><span class="op" id="3838508">)</span>&nbsp;<span class="comment" id="3838510">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838581">i</span>&nbsp;<span class="op" id="3838583">:=</span>&nbsp;<span class="ident" id="3838586">x</span><span class="op" id="3838587">.</span><span class="ident" id="3838588">b</span><span class="op" id="3838589">.</span><span class="ident" id="3838590">abs</span><span class="op" id="3838593">.</span><span class="ident" id="3838594">bytes</span><span class="op" id="3838599">(</span><span class="ident" id="3838600">buf</span><span class="op" id="3838603">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838606">j</span>&nbsp;<span class="op" id="3838608">:=</span>&nbsp;<span class="ident" id="3838611">x</span><span class="op" id="3838612">.</span><span class="ident" id="3838613">a</span><span class="op" id="3838614">.</span><span class="ident" id="3838615">abs</span><span class="op" id="3838618">.</span><span class="ident" id="3838619">bytes</span><span class="op" id="3838624">(</span><span class="ident" id="3838625">buf</span><span class="op" id="3838628">[</span><span class="num" id="3838629">0</span><span class="op" id="3838630">:</span><span class="ident" id="3838631">i</span><span class="op" id="3838632">]</span><span class="op" id="3838633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838636">n</span>&nbsp;<span class="op" id="3838638">:=</span>&nbsp;<span class="ident" id="3838641">i</span>&nbsp;<span class="op" id="3838643">-</span>&nbsp;<span class="ident" id="3838645">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838648">if</span>&nbsp;<span class="builtintype" id="3838651">int</span><span class="op" id="3838654">(</span><span class="builtintype" id="3838655">uint32</span><span class="op" id="3838661">(</span><span class="ident" id="3838662">n</span><span class="op" id="3838663">)</span><span class="op" id="3838664">)</span>&nbsp;<span class="op" id="3838666">!=</span>&nbsp;<span class="ident" id="3838669">n</span>&nbsp;<span class="op" id="3838671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3838675">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838705">return</span>&nbsp;<span class="ident" id="3838712">nil</span><span class="op" id="3838715">,</span>&nbsp;<span class="ident" id="3838717">errors</span><span class="op" id="3838723">.</span><span class="ident" id="3838724">New</span><span class="op" id="3838727">(</span><span class="string" id="3838728">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="3838764">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3838767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838770">binary</span><span class="op" id="3838776">.</span><span class="ident" id="3838777">BigEndian</span><span class="op" id="3838786">.</span><span class="ident" id="3838787">PutUint32</span><span class="op" id="3838796">(</span><span class="ident" id="3838797">buf</span><span class="op" id="3838800">[</span><span class="ident" id="3838801">j</span><span class="op" id="3838802">-</span><span class="num" id="3838803">4</span><span class="op" id="3838804">:</span><span class="ident" id="3838805">j</span><span class="op" id="3838806">]</span><span class="op" id="3838807">,</span>&nbsp;<span class="builtintype" id="3838809">uint32</span><span class="op" id="3838815">(</span><span class="ident" id="3838816">n</span><span class="op" id="3838817">)</span><span class="op" id="3838818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838821">j</span>&nbsp;<span class="op" id="3838823">-=</span>&nbsp;<span class="num" id="3838826">1</span>&nbsp;<span class="op" id="3838828">+</span>&nbsp;<span class="num" id="3838830">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838833">b</span>&nbsp;<span class="op" id="3838835">:=</span>&nbsp;<span class="ident" id="3838838">ratGobVersion</span>&nbsp;<span class="op" id="3838852">&lt;&lt;</span>&nbsp;<span class="num" id="3838855">1</span>&nbsp;<span class="comment" id="3838857">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838885">if</span>&nbsp;<span class="ident" id="3838888">x</span><span class="op" id="3838889">.</span><span class="ident" id="3838890">a</span><span class="op" id="3838891">.</span><span class="ident" id="3838892">neg</span>&nbsp;<span class="op" id="3838896">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838900">b</span>&nbsp;<span class="op" id="3838902">|=</span>&nbsp;<span class="num" id="3838905">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3838908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838911">buf</span><span class="op" id="3838914">[</span><span class="ident" id="3838915">j</span><span class="op" id="3838916">]</span>&nbsp;<span class="op" id="3838918">=</span>&nbsp;<span class="ident" id="3838920">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838923">return</span>&nbsp;<span class="ident" id="3838930">buf</span><span class="op" id="3838933">[</span><span class="ident" id="3838934">j</span><span class="op" id="3838935">:</span><span class="op" id="3838936">]</span><span class="op" id="3838937">,</span>&nbsp;<span class="ident" id="3838939">nil</span><br>
<span class="lineno"></span><span class="op" id="3838943">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3838946">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3839000">func</span>&nbsp;<span class="op" id="3839005">(</span><span class="ident" id="3839006">z</span>&nbsp;<span class="op" id="3839008">*</span><span class="ident" id="3839009">Rat</span><span class="op" id="3839012">)</span>&nbsp;<span class="ident" id="3839014">GobDecode</span><span class="op" id="3839023">(</span><span class="ident" id="3839024">buf</span>&nbsp;<span class="op" id="3839028">[</span><span class="op" id="3839029">]</span><span class="builtintype" id="3839030">byte</span><span class="op" id="3839034">)</span>&nbsp;<span class="builtintype" id="3839036">error</span>&nbsp;<span class="op" id="3839042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839045">if</span>&nbsp;<span class="builtinfunc" id="3839048">len</span><span class="op" id="3839051">(</span><span class="ident" id="3839052">buf</span><span class="op" id="3839055">)</span>&nbsp;<span class="op" id="3839057">==</span>&nbsp;<span class="num" id="3839060">0</span>&nbsp;<span class="op" id="3839062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3839066">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839111">*</span><span class="ident" id="3839112">z</span>&nbsp;<span class="op" id="3839114">=</span>&nbsp;<span class="ident" id="3839116">Rat</span><span class="op" id="3839119">{</span><span class="op" id="3839120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839124">return</span>&nbsp;<span class="ident" id="3839131">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839139">b</span>&nbsp;<span class="op" id="3839141">:=</span>&nbsp;<span class="ident" id="3839144">buf</span><span class="op" id="3839147">[</span><span class="num" id="3839148">0</span><span class="op" id="3839149">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839152">if</span>&nbsp;<span class="ident" id="3839155">b</span><span class="op" id="3839156">&gt;&gt;</span><span class="num" id="3839158">1</span>&nbsp;<span class="op" id="3839160">!=</span>&nbsp;<span class="ident" id="3839163">ratGobVersion</span>&nbsp;<span class="op" id="3839177">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839181">return</span>&nbsp;<span class="ident" id="3839188">errors</span><span class="op" id="3839194">.</span><span class="ident" id="3839195">New</span><span class="op" id="3839198">(</span><span class="ident" id="3839199">fmt</span><span class="op" id="3839202">.</span><span class="ident" id="3839203">Sprintf</span><span class="op" id="3839210">(</span><span class="string" id="3839211">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3839261">,</span>&nbsp;<span class="ident" id="3839263">b</span><span class="op" id="3839264">&gt;&gt;</span><span class="num" id="3839266">1</span><span class="op" id="3839267">)</span><span class="op" id="3839268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839274">const</span>&nbsp;<span class="ident" id="3839280">j</span>&nbsp;<span class="op" id="3839282">=</span>&nbsp;<span class="num" id="3839284">1</span>&nbsp;<span class="op" id="3839286">+</span>&nbsp;<span class="num" id="3839288">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839291">i</span>&nbsp;<span class="op" id="3839293">:=</span>&nbsp;<span class="ident" id="3839296">j</span>&nbsp;<span class="op" id="3839298">+</span>&nbsp;<span class="ident" id="3839300">binary</span><span class="op" id="3839306">.</span><span class="ident" id="3839307">BigEndian</span><span class="op" id="3839316">.</span><span class="ident" id="3839317">Uint32</span><span class="op" id="3839323">(</span><span class="ident" id="3839324">buf</span><span class="op" id="3839327">[</span><span class="ident" id="3839328">j</span><span class="op" id="3839329">-</span><span class="num" id="3839330">4</span><span class="op" id="3839331">:</span><span class="ident" id="3839332">j</span><span class="op" id="3839333">]</span><span class="op" id="3839334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839337">z</span><span class="op" id="3839338">.</span><span class="ident" id="3839339">a</span><span class="op" id="3839340">.</span><span class="ident" id="3839341">neg</span>&nbsp;<span class="op" id="3839345">=</span>&nbsp;<span class="ident" id="3839347">b</span><span class="op" id="3839348">&amp;</span><span class="num" id="3839349">1</span>&nbsp;<span class="op" id="3839351">!=</span>&nbsp;<span class="num" id="3839354">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839357">z</span><span class="op" id="3839358">.</span><span class="ident" id="3839359">a</span><span class="op" id="3839360">.</span><span class="ident" id="3839361">abs</span>&nbsp;<span class="op" id="3839365">=</span>&nbsp;<span class="ident" id="3839367">z</span><span class="op" id="3839368">.</span><span class="ident" id="3839369">a</span><span class="op" id="3839370">.</span><span class="ident" id="3839371">abs</span><span class="op" id="3839374">.</span><span class="ident" id="3839375">setBytes</span><span class="op" id="3839383">(</span><span class="ident" id="3839384">buf</span><span class="op" id="3839387">[</span><span class="ident" id="3839388">j</span><span class="op" id="3839389">:</span><span class="ident" id="3839390">i</span><span class="op" id="3839391">]</span><span class="op" id="3839392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839395">z</span><span class="op" id="3839396">.</span><span class="ident" id="3839397">b</span><span class="op" id="3839398">.</span><span class="ident" id="3839399">abs</span>&nbsp;<span class="op" id="3839403">=</span>&nbsp;<span class="ident" id="3839405">z</span><span class="op" id="3839406">.</span><span class="ident" id="3839407">b</span><span class="op" id="3839408">.</span><span class="ident" id="3839409">abs</span><span class="op" id="3839412">.</span><span class="ident" id="3839413">setBytes</span><span class="op" id="3839421">(</span><span class="ident" id="3839422">buf</span><span class="op" id="3839425">[</span><span class="ident" id="3839426">i</span><span class="op" id="3839427">:</span><span class="op" id="3839428">]</span><span class="op" id="3839429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839432">return</span>&nbsp;<span class="ident" id="3839439">nil</span><br>
<span class="lineno"></span><span class="op" id="3839443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="3839446">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3839510">func</span>&nbsp;<span class="op" id="3839515">(</span><span class="ident" id="3839516">r</span>&nbsp;<span class="op" id="3839518">*</span><span class="ident" id="3839519">Rat</span><span class="op" id="3839522">)</span>&nbsp;<span class="ident" id="3839524">MarshalText</span><span class="op" id="3839535">(</span><span class="op" id="3839536">)</span>&nbsp;<span class="op" id="3839538">(</span><span class="ident" id="3839539">text</span>&nbsp;<span class="op" id="3839544">[</span><span class="op" id="3839545">]</span><span class="builtintype" id="3839546">byte</span><span class="op" id="3839550">,</span>&nbsp;<span class="ident" id="3839552">err</span>&nbsp;<span class="builtintype" id="3839556">error</span><span class="op" id="3839561">)</span>&nbsp;<span class="op" id="3839563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839566">return</span>&nbsp;<span class="op" id="3839573">[</span><span class="op" id="3839574">]</span><span class="builtintype" id="3839575">byte</span><span class="op" id="3839579">(</span><span class="ident" id="3839580">r</span><span class="op" id="3839581">.</span><span class="ident" id="3839582">RatString</span><span class="op" id="3839591">(</span><span class="op" id="3839592">)</span><span class="op" id="3839593">)</span><span class="op" id="3839594">,</span>&nbsp;<span class="ident" id="3839596">nil</span><br>
<span class="lineno"></span><span class="op" id="3839600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="3839603">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3839671">func</span>&nbsp;<span class="op" id="3839676">(</span><span class="ident" id="3839677">r</span>&nbsp;<span class="op" id="3839679">*</span><span class="ident" id="3839680">Rat</span><span class="op" id="3839683">)</span>&nbsp;<span class="ident" id="3839685">UnmarshalText</span><span class="op" id="3839698">(</span><span class="ident" id="3839699">text</span>&nbsp;<span class="op" id="3839704">[</span><span class="op" id="3839705">]</span><span class="builtintype" id="3839706">byte</span><span class="op" id="3839710">)</span>&nbsp;<span class="builtintype" id="3839712">error</span>&nbsp;<span class="op" id="3839718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839721">if</span>&nbsp;<span class="ident" id="3839724">_</span><span class="op" id="3839725">,</span>&nbsp;<span class="ident" id="3839727">ok</span>&nbsp;<span class="op" id="3839730">:=</span>&nbsp;<span class="ident" id="3839733">r</span><span class="op" id="3839734">.</span><span class="ident" id="3839735">SetString</span><span class="op" id="3839744">(</span><span class="builtintype" id="3839745">string</span><span class="op" id="3839751">(</span><span class="ident" id="3839752">text</span><span class="op" id="3839756">)</span><span class="op" id="3839757">)</span><span class="op" id="3839758">;</span>&nbsp;<span class="op" id="3839760">!</span><span class="ident" id="3839761">ok</span>&nbsp;<span class="op" id="3839764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839768">return</span>&nbsp;<span class="ident" id="3839775">fmt</span><span class="op" id="3839778">.</span><span class="ident" id="3839779">Errorf</span><span class="op" id="3839785">(</span><span class="string" id="3839786">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="3839833">,</span>&nbsp;<span class="ident" id="3839835">text</span><span class="op" id="3839839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839842">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839845">return</span>&nbsp;<span class="ident" id="3839852">nil</span><br>
<span class="lineno"></span><span class="op" id="3839856">}</span>
</div>
</body>
</html>
