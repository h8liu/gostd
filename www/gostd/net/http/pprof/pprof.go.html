<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/pprof</h2>
<ul>
<li><a href="/gostd/net/http/pprof/pprof.go.html" class="current">pprof.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6385720">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6385776">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6385830">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6385881">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6385948">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="6386007">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="6386048">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="6386095">//</span><br>
<span class="lineno">10</span><span class="comment" id="6386098">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6386163">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="6386197">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="6386248">//</span><br>
<span class="lineno"></span><span class="comment" id="6386251">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="6386305">//&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6386334">//</span><br>
<span class="lineno"></span><span class="comment" id="6386337">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="6386403">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6386471">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="6386516">//</span><br>
<span class="lineno"></span><span class="comment" id="6386519">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6386535">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="6386596">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}()</span><br>
<span class="lineno"></span><span class="comment" id="6386604">//</span><br>
<span class="lineno">25</span><span class="comment" id="6386607">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="6386663">//</span><br>
<span class="lineno"></span><span class="comment" id="6386666">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="6386722">//</span><br>
<span class="lineno"></span><span class="comment" id="6386725">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="6386767">//</span><br>
<span class="lineno"></span><span class="comment" id="6386770">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="6386829">//</span><br>
<span class="lineno"></span><span class="comment" id="6386832">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="6386881">//</span><br>
<span class="lineno">35</span><span class="comment" id="6386884">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="6386941">//</span><br>
<span class="lineno"></span><span class="comment" id="6386944">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="6387019">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="6387039">//</span><br>
<span class="lineno">40</span><span class="comment" id="6387042">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="6387090">//</span><br>
<span class="lineno"></span><span class="comment" id="6387093">//&nbsp;&nbsp;&nbsp;&nbsp;http://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="6387154">//</span><br>
<span class="lineno"></span><span class="keyword" id="6387157">package</span>&nbsp;<span class="ident" id="6387165">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6387172">import</span>&nbsp;<span class="op" id="6387179">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387182">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387191">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387200">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387207">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387224">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387230">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387237">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387249">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387255">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387266">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387283">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387294">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6387305">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="6387312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6387315">func</span>&nbsp;<span class="ident" id="6387320">init</span><span class="op" id="6387324">(</span><span class="op" id="6387325">)</span>&nbsp;<span class="op" id="6387327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387330">http</span><span class="op" id="6387334">.</span><span class="ident" id="6387335">Handle</span><span class="op" id="6387341">(</span><span class="string" id="6387342">&#34;/debug/pprof/&#34;</span><span class="op" id="6387357">,</span>&nbsp;<span class="ident" id="6387359">http</span><span class="op" id="6387363">.</span><span class="ident" id="6387364">HandlerFunc</span><span class="op" id="6387375">(</span><span class="ident" id="6387376">Index</span><span class="op" id="6387381">)</span><span class="op" id="6387382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387385">http</span><span class="op" id="6387389">.</span><span class="ident" id="6387390">Handle</span><span class="op" id="6387396">(</span><span class="string" id="6387397">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="6387419">,</span>&nbsp;<span class="ident" id="6387421">http</span><span class="op" id="6387425">.</span><span class="ident" id="6387426">HandlerFunc</span><span class="op" id="6387437">(</span><span class="ident" id="6387438">Cmdline</span><span class="op" id="6387445">)</span><span class="op" id="6387446">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387449">http</span><span class="op" id="6387453">.</span><span class="ident" id="6387454">Handle</span><span class="op" id="6387460">(</span><span class="string" id="6387461">&#34;/debug/pprof/profile&#34;</span><span class="op" id="6387483">,</span>&nbsp;<span class="ident" id="6387485">http</span><span class="op" id="6387489">.</span><span class="ident" id="6387490">HandlerFunc</span><span class="op" id="6387501">(</span><span class="ident" id="6387502">Profile</span><span class="op" id="6387509">)</span><span class="op" id="6387510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387513">http</span><span class="op" id="6387517">.</span><span class="ident" id="6387518">Handle</span><span class="op" id="6387524">(</span><span class="string" id="6387525">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="6387546">,</span>&nbsp;<span class="ident" id="6387548">http</span><span class="op" id="6387552">.</span><span class="ident" id="6387553">HandlerFunc</span><span class="op" id="6387564">(</span><span class="ident" id="6387565">Symbol</span><span class="op" id="6387571">)</span><span class="op" id="6387572">)</span><br>
<span class="lineno"></span><span class="op" id="6387574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6387577">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="6387624">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="6387680">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="6387748">func</span>&nbsp;<span class="ident" id="6387753">Cmdline</span><span class="op" id="6387760">(</span><span class="ident" id="6387761">w</span>&nbsp;<span class="ident" id="6387763">http</span><span class="op" id="6387767">.</span><span class="ident" id="6387768">ResponseWriter</span><span class="op" id="6387782">,</span>&nbsp;<span class="ident" id="6387784">r</span>&nbsp;<span class="op" id="6387786">*</span><span class="ident" id="6387787">http</span><span class="op" id="6387791">.</span><span class="ident" id="6387792">Request</span><span class="op" id="6387799">)</span>&nbsp;<span class="op" id="6387801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387804">w</span><span class="op" id="6387805">.</span><span class="ident" id="6387806">Header</span><span class="op" id="6387812">(</span><span class="op" id="6387813">)</span><span class="op" id="6387814">.</span><span class="ident" id="6387815">Set</span><span class="op" id="6387818">(</span><span class="string" id="6387819">&#34;Content-Type&#34;</span><span class="op" id="6387833">,</span>&nbsp;<span class="string" id="6387835">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6387862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387865">fmt</span><span class="op" id="6387868">.</span><span class="ident" id="6387869">Fprintf</span><span class="op" id="6387876">(</span><span class="ident" id="6387877">w</span><span class="op" id="6387878">,</span>&nbsp;<span class="ident" id="6387880">strings</span><span class="op" id="6387887">.</span><span class="ident" id="6387888">Join</span><span class="op" id="6387892">(</span><span class="ident" id="6387893">os</span><span class="op" id="6387895">.</span><span class="ident" id="6387896">Args</span><span class="op" id="6387900">,</span>&nbsp;<span class="string" id="6387902">&#34;\x00&#34;</span><span class="op" id="6387908">)</span><span class="op" id="6387909">)</span><br>
<span class="lineno">75</span><span class="op" id="6387911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6387914">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="6387972">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="6388040">func</span>&nbsp;<span class="ident" id="6388045">Profile</span><span class="op" id="6388052">(</span><span class="ident" id="6388053">w</span>&nbsp;<span class="ident" id="6388055">http</span><span class="op" id="6388059">.</span><span class="ident" id="6388060">ResponseWriter</span><span class="op" id="6388074">,</span>&nbsp;<span class="ident" id="6388076">r</span>&nbsp;<span class="op" id="6388078">*</span><span class="ident" id="6388079">http</span><span class="op" id="6388083">.</span><span class="ident" id="6388084">Request</span><span class="op" id="6388091">)</span>&nbsp;<span class="op" id="6388093">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388096">sec</span><span class="op" id="6388099">,</span>&nbsp;<span class="ident" id="6388101">_</span>&nbsp;<span class="op" id="6388103">:=</span>&nbsp;<span class="ident" id="6388106">strconv</span><span class="op" id="6388113">.</span><span class="ident" id="6388114">ParseInt</span><span class="op" id="6388122">(</span><span class="ident" id="6388123">r</span><span class="op" id="6388124">.</span><span class="ident" id="6388125">FormValue</span><span class="op" id="6388134">(</span><span class="string" id="6388135">&#34;seconds&#34;</span><span class="op" id="6388144">)</span><span class="op" id="6388145">,</span>&nbsp;<span class="num" id="6388147">10</span><span class="op" id="6388149">,</span>&nbsp;<span class="num" id="6388151">64</span><span class="op" id="6388153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6388156">if</span>&nbsp;<span class="ident" id="6388159">sec</span>&nbsp;<span class="op" id="6388163">==</span>&nbsp;<span class="num" id="6388166">0</span>&nbsp;<span class="op" id="6388168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388172">sec</span>&nbsp;<span class="op" id="6388176">=</span>&nbsp;<span class="num" id="6388178">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6388182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6388186">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6388243">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388285">w</span><span class="op" id="6388286">.</span><span class="ident" id="6388287">Header</span><span class="op" id="6388293">(</span><span class="op" id="6388294">)</span><span class="op" id="6388295">.</span><span class="ident" id="6388296">Set</span><span class="op" id="6388299">(</span><span class="string" id="6388300">&#34;Content-Type&#34;</span><span class="op" id="6388314">,</span>&nbsp;<span class="string" id="6388316">&#34;application/octet-stream&#34;</span><span class="op" id="6388342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6388345">if</span>&nbsp;<span class="ident" id="6388348">err</span>&nbsp;<span class="op" id="6388352">:=</span>&nbsp;<span class="ident" id="6388355">pprof</span><span class="op" id="6388360">.</span><span class="ident" id="6388361">StartCPUProfile</span><span class="op" id="6388376">(</span><span class="ident" id="6388377">w</span><span class="op" id="6388378">)</span><span class="op" id="6388379">;</span>&nbsp;<span class="ident" id="6388381">err</span>&nbsp;<span class="op" id="6388385">!=</span>&nbsp;<span class="ident" id="6388388">nil</span>&nbsp;<span class="op" id="6388392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6388396">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6388443">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6388487">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388513">w</span><span class="op" id="6388514">.</span><span class="ident" id="6388515">Header</span><span class="op" id="6388521">(</span><span class="op" id="6388522">)</span><span class="op" id="6388523">.</span><span class="ident" id="6388524">Set</span><span class="op" id="6388527">(</span><span class="string" id="6388528">&#34;Content-Type&#34;</span><span class="op" id="6388542">,</span>&nbsp;<span class="string" id="6388544">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6388571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388575">w</span><span class="op" id="6388576">.</span><span class="ident" id="6388577">WriteHeader</span><span class="op" id="6388588">(</span><span class="ident" id="6388589">http</span><span class="op" id="6388593">.</span><span class="ident" id="6388594">StatusInternalServerError</span><span class="op" id="6388619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388623">fmt</span><span class="op" id="6388626">.</span><span class="ident" id="6388627">Fprintf</span><span class="op" id="6388634">(</span><span class="ident" id="6388635">w</span><span class="op" id="6388636">,</span>&nbsp;<span class="string" id="6388638">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="6388676">,</span>&nbsp;<span class="ident" id="6388678">err</span><span class="op" id="6388681">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6388685">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6388693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388696">time</span><span class="op" id="6388700">.</span><span class="ident" id="6388701">Sleep</span><span class="op" id="6388706">(</span><span class="ident" id="6388707">time</span><span class="op" id="6388711">.</span><span class="ident" id="6388712">Duration</span><span class="op" id="6388720">(</span><span class="ident" id="6388721">sec</span><span class="op" id="6388724">)</span>&nbsp;<span class="op" id="6388726">*</span>&nbsp;<span class="ident" id="6388728">time</span><span class="op" id="6388732">.</span><span class="ident" id="6388733">Second</span><span class="op" id="6388739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388742">pprof</span><span class="op" id="6388747">.</span><span class="ident" id="6388748">StopCPUProfile</span><span class="op" id="6388762">(</span><span class="op" id="6388763">)</span><br>
<span class="lineno"></span><span class="op" id="6388765">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="6388768">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="6388831">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="6388902">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="6388969">func</span>&nbsp;<span class="ident" id="6388974">Symbol</span><span class="op" id="6388980">(</span><span class="ident" id="6388981">w</span>&nbsp;<span class="ident" id="6388983">http</span><span class="op" id="6388987">.</span><span class="ident" id="6388988">ResponseWriter</span><span class="op" id="6389002">,</span>&nbsp;<span class="ident" id="6389004">r</span>&nbsp;<span class="op" id="6389006">*</span><span class="ident" id="6389007">http</span><span class="op" id="6389011">.</span><span class="ident" id="6389012">Request</span><span class="op" id="6389019">)</span>&nbsp;<span class="op" id="6389021">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389024">w</span><span class="op" id="6389025">.</span><span class="ident" id="6389026">Header</span><span class="op" id="6389032">(</span><span class="op" id="6389033">)</span><span class="op" id="6389034">.</span><span class="ident" id="6389035">Set</span><span class="op" id="6389038">(</span><span class="string" id="6389039">&#34;Content-Type&#34;</span><span class="op" id="6389053">,</span>&nbsp;<span class="string" id="6389055">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6389082">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6389086">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6389133">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389182">var</span>&nbsp;<span class="ident" id="6389186">buf</span>&nbsp;<span class="ident" id="6389190">bytes</span><span class="op" id="6389195">.</span><span class="ident" id="6389196">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6389205">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6389256">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6389314">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389366">fmt</span><span class="op" id="6389369">.</span><span class="ident" id="6389370">Fprintf</span><span class="op" id="6389377">(</span><span class="op" id="6389378">&amp;</span><span class="ident" id="6389379">buf</span><span class="op" id="6389382">,</span>&nbsp;<span class="string" id="6389384">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="6389402">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389406">var</span>&nbsp;<span class="ident" id="6389410">b</span>&nbsp;<span class="op" id="6389412">*</span><span class="ident" id="6389413">bufio</span><span class="op" id="6389418">.</span><span class="ident" id="6389419">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389427">if</span>&nbsp;<span class="ident" id="6389430">r</span><span class="op" id="6389431">.</span><span class="ident" id="6389432">Method</span>&nbsp;<span class="op" id="6389439">==</span>&nbsp;<span class="string" id="6389442">&#34;POST&#34;</span>&nbsp;<span class="op" id="6389449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389453">b</span>&nbsp;<span class="op" id="6389455">=</span>&nbsp;<span class="ident" id="6389457">bufio</span><span class="op" id="6389462">.</span><span class="ident" id="6389463">NewReader</span><span class="op" id="6389472">(</span><span class="ident" id="6389473">r</span><span class="op" id="6389474">.</span><span class="ident" id="6389475">Body</span><span class="op" id="6389479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6389482">}</span>&nbsp;<span class="keyword" id="6389484">else</span>&nbsp;<span class="op" id="6389489">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389493">b</span>&nbsp;<span class="op" id="6389495">=</span>&nbsp;<span class="ident" id="6389497">bufio</span><span class="op" id="6389502">.</span><span class="ident" id="6389503">NewReader</span><span class="op" id="6389512">(</span><span class="ident" id="6389513">strings</span><span class="op" id="6389520">.</span><span class="ident" id="6389521">NewReader</span><span class="op" id="6389530">(</span><span class="ident" id="6389531">r</span><span class="op" id="6389532">.</span><span class="ident" id="6389533">URL</span><span class="op" id="6389536">.</span><span class="ident" id="6389537">RawQuery</span><span class="op" id="6389545">)</span><span class="op" id="6389546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6389549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389553">for</span>&nbsp;<span class="op" id="6389557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389561">word</span><span class="op" id="6389565">,</span>&nbsp;<span class="ident" id="6389567">err</span>&nbsp;<span class="op" id="6389571">:=</span>&nbsp;<span class="ident" id="6389574">b</span><span class="op" id="6389575">.</span><span class="ident" id="6389576">ReadSlice</span><span class="op" id="6389585">(</span><span class="string" id="6389586">&#39;+&#39;</span><span class="op" id="6389589">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389593">if</span>&nbsp;<span class="ident" id="6389596">err</span>&nbsp;<span class="op" id="6389600">==</span>&nbsp;<span class="ident" id="6389603">nil</span>&nbsp;<span class="op" id="6389607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389612">word</span>&nbsp;<span class="op" id="6389617">=</span>&nbsp;<span class="ident" id="6389619">word</span><span class="op" id="6389623">[</span><span class="num" id="6389624">0</span>&nbsp;<span class="op" id="6389626">:</span>&nbsp;<span class="builtinfunc" id="6389628">len</span><span class="op" id="6389631">(</span><span class="ident" id="6389632">word</span><span class="op" id="6389636">)</span><span class="op" id="6389637">-</span><span class="num" id="6389638">1</span><span class="op" id="6389639">]</span>&nbsp;<span class="comment" id="6389641">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6389653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389657">pc</span><span class="op" id="6389659">,</span>&nbsp;<span class="ident" id="6389661">_</span>&nbsp;<span class="op" id="6389663">:=</span>&nbsp;<span class="ident" id="6389666">strconv</span><span class="op" id="6389673">.</span><span class="ident" id="6389674">ParseUint</span><span class="op" id="6389683">(</span><span class="builtintype" id="6389684">string</span><span class="op" id="6389690">(</span><span class="ident" id="6389691">word</span><span class="op" id="6389695">)</span><span class="op" id="6389696">,</span>&nbsp;<span class="num" id="6389698">0</span><span class="op" id="6389699">,</span>&nbsp;<span class="num" id="6389701">64</span><span class="op" id="6389703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389707">if</span>&nbsp;<span class="ident" id="6389710">pc</span>&nbsp;<span class="op" id="6389713">!=</span>&nbsp;<span class="num" id="6389716">0</span>&nbsp;<span class="op" id="6389718">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389723">f</span>&nbsp;<span class="op" id="6389725">:=</span>&nbsp;<span class="ident" id="6389728">runtime</span><span class="op" id="6389735">.</span><span class="ident" id="6389736">FuncForPC</span><span class="op" id="6389745">(</span><span class="builtintype" id="6389746">uintptr</span><span class="op" id="6389753">(</span><span class="ident" id="6389754">pc</span><span class="op" id="6389756">)</span><span class="op" id="6389757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389762">if</span>&nbsp;<span class="ident" id="6389765">f</span>&nbsp;<span class="op" id="6389767">!=</span>&nbsp;<span class="ident" id="6389770">nil</span>&nbsp;<span class="op" id="6389774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389780">fmt</span><span class="op" id="6389783">.</span><span class="ident" id="6389784">Fprintf</span><span class="op" id="6389791">(</span><span class="op" id="6389792">&amp;</span><span class="ident" id="6389793">buf</span><span class="op" id="6389796">,</span>&nbsp;<span class="string" id="6389798">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="6389808">,</span>&nbsp;<span class="ident" id="6389810">pc</span><span class="op" id="6389812">,</span>&nbsp;<span class="ident" id="6389814">f</span><span class="op" id="6389815">.</span><span class="ident" id="6389816">Name</span><span class="op" id="6389820">(</span><span class="op" id="6389821">)</span><span class="op" id="6389822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6389827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6389831">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6389836">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6389884">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389942">if</span>&nbsp;<span class="ident" id="6389945">err</span>&nbsp;<span class="op" id="6389949">!=</span>&nbsp;<span class="ident" id="6389952">nil</span>&nbsp;<span class="op" id="6389956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389961">if</span>&nbsp;<span class="ident" id="6389964">err</span>&nbsp;<span class="op" id="6389968">!=</span>&nbsp;<span class="ident" id="6389971">io</span><span class="op" id="6389973">.</span><span class="ident" id="6389974">EOF</span>&nbsp;<span class="op" id="6389978">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389984">fmt</span><span class="op" id="6389987">.</span><span class="ident" id="6389988">Fprintf</span><span class="op" id="6389995">(</span><span class="op" id="6389996">&amp;</span><span class="ident" id="6389997">buf</span><span class="op" id="6390000">,</span>&nbsp;<span class="string" id="6390002">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="6390025">,</span>&nbsp;<span class="ident" id="6390027">err</span><span class="op" id="6390030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6390035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390040">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6390048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6390051">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390055">w</span><span class="op" id="6390056">.</span><span class="ident" id="6390057">Write</span><span class="op" id="6390062">(</span><span class="ident" id="6390063">buf</span><span class="op" id="6390066">.</span><span class="ident" id="6390067">Bytes</span><span class="op" id="6390072">(</span><span class="op" id="6390073">)</span><span class="op" id="6390074">)</span><br>
<span class="lineno"></span><span class="op" id="6390076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6390079">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="6390145">func</span>&nbsp;<span class="ident" id="6390150">Handler</span><span class="op" id="6390157">(</span><span class="ident" id="6390158">name</span>&nbsp;<span class="builtintype" id="6390163">string</span><span class="op" id="6390169">)</span>&nbsp;<span class="ident" id="6390171">http</span><span class="op" id="6390175">.</span><span class="ident" id="6390176">Handler</span>&nbsp;<span class="op" id="6390184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390187">return</span>&nbsp;<span class="ident" id="6390194">handler</span><span class="op" id="6390201">(</span><span class="ident" id="6390202">name</span><span class="op" id="6390206">)</span><br>
<span class="lineno"></span><span class="op" id="6390208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6390211">type</span>&nbsp;<span class="ident" id="6390216">handler</span>&nbsp;<span class="builtintype" id="6390224">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6390232">func</span>&nbsp;<span class="op" id="6390237">(</span><span class="ident" id="6390238">name</span>&nbsp;<span class="ident" id="6390243">handler</span><span class="op" id="6390250">)</span>&nbsp;<span class="ident" id="6390252">ServeHTTP</span><span class="op" id="6390261">(</span><span class="ident" id="6390262">w</span>&nbsp;<span class="ident" id="6390264">http</span><span class="op" id="6390268">.</span><span class="ident" id="6390269">ResponseWriter</span><span class="op" id="6390283">,</span>&nbsp;<span class="ident" id="6390285">r</span>&nbsp;<span class="op" id="6390287">*</span><span class="ident" id="6390288">http</span><span class="op" id="6390292">.</span><span class="ident" id="6390293">Request</span><span class="op" id="6390300">)</span>&nbsp;<span class="op" id="6390302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390305">w</span><span class="op" id="6390306">.</span><span class="ident" id="6390307">Header</span><span class="op" id="6390313">(</span><span class="op" id="6390314">)</span><span class="op" id="6390315">.</span><span class="ident" id="6390316">Set</span><span class="op" id="6390319">(</span><span class="string" id="6390320">&#34;Content-Type&#34;</span><span class="op" id="6390334">,</span>&nbsp;<span class="string" id="6390336">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="6390363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390366">debug</span><span class="op" id="6390371">,</span>&nbsp;<span class="ident" id="6390373">_</span>&nbsp;<span class="op" id="6390375">:=</span>&nbsp;<span class="ident" id="6390378">strconv</span><span class="op" id="6390385">.</span><span class="ident" id="6390386">Atoi</span><span class="op" id="6390390">(</span><span class="ident" id="6390391">r</span><span class="op" id="6390392">.</span><span class="ident" id="6390393">FormValue</span><span class="op" id="6390402">(</span><span class="string" id="6390403">&#34;debug&#34;</span><span class="op" id="6390410">)</span><span class="op" id="6390411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390414">p</span>&nbsp;<span class="op" id="6390416">:=</span>&nbsp;<span class="ident" id="6390419">pprof</span><span class="op" id="6390424">.</span><span class="ident" id="6390425">Lookup</span><span class="op" id="6390431">(</span><span class="builtintype" id="6390432">string</span><span class="op" id="6390438">(</span><span class="ident" id="6390439">name</span><span class="op" id="6390443">)</span><span class="op" id="6390444">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390447">if</span>&nbsp;<span class="ident" id="6390450">p</span>&nbsp;<span class="op" id="6390452">==</span>&nbsp;<span class="ident" id="6390455">nil</span>&nbsp;<span class="op" id="6390459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390463">w</span><span class="op" id="6390464">.</span><span class="ident" id="6390465">WriteHeader</span><span class="op" id="6390476">(</span><span class="num" id="6390477">404</span><span class="op" id="6390480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390484">fmt</span><span class="op" id="6390487">.</span><span class="ident" id="6390488">Fprintf</span><span class="op" id="6390495">(</span><span class="ident" id="6390496">w</span><span class="op" id="6390497">,</span>&nbsp;<span class="string" id="6390499">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="6390522">,</span>&nbsp;<span class="ident" id="6390524">name</span><span class="op" id="6390528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390532">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6390540">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390543">gc</span><span class="op" id="6390545">,</span>&nbsp;<span class="ident" id="6390547">_</span>&nbsp;<span class="op" id="6390549">:=</span>&nbsp;<span class="ident" id="6390552">strconv</span><span class="op" id="6390559">.</span><span class="ident" id="6390560">Atoi</span><span class="op" id="6390564">(</span><span class="ident" id="6390565">r</span><span class="op" id="6390566">.</span><span class="ident" id="6390567">FormValue</span><span class="op" id="6390576">(</span><span class="string" id="6390577">&#34;gc&#34;</span><span class="op" id="6390581">)</span><span class="op" id="6390582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390585">if</span>&nbsp;<span class="ident" id="6390588">name</span>&nbsp;<span class="op" id="6390593">==</span>&nbsp;<span class="string" id="6390596">&#34;heap&#34;</span>&nbsp;<span class="op" id="6390603">&amp;&amp;</span>&nbsp;<span class="ident" id="6390606">gc</span>&nbsp;<span class="op" id="6390609">&gt;</span>&nbsp;<span class="num" id="6390611">0</span>&nbsp;<span class="op" id="6390613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390617">runtime</span><span class="op" id="6390624">.</span><span class="ident" id="6390625">GC</span><span class="op" id="6390627">(</span><span class="op" id="6390628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6390631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390634">p</span><span class="op" id="6390635">.</span><span class="ident" id="6390636">WriteTo</span><span class="op" id="6390643">(</span><span class="ident" id="6390644">w</span><span class="op" id="6390645">,</span>&nbsp;<span class="ident" id="6390647">debug</span><span class="op" id="6390652">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390655">return</span><br>
<span class="lineno"></span><span class="op" id="6390662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6390665">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="6390738">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="6390801">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="6390870">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="6390905">func</span>&nbsp;<span class="ident" id="6390910">Index</span><span class="op" id="6390915">(</span><span class="ident" id="6390916">w</span>&nbsp;<span class="ident" id="6390918">http</span><span class="op" id="6390922">.</span><span class="ident" id="6390923">ResponseWriter</span><span class="op" id="6390937">,</span>&nbsp;<span class="ident" id="6390939">r</span>&nbsp;<span class="op" id="6390941">*</span><span class="ident" id="6390942">http</span><span class="op" id="6390946">.</span><span class="ident" id="6390947">Request</span><span class="op" id="6390954">)</span>&nbsp;<span class="op" id="6390956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390959">if</span>&nbsp;<span class="ident" id="6390962">strings</span><span class="op" id="6390969">.</span><span class="ident" id="6390970">HasPrefix</span><span class="op" id="6390979">(</span><span class="ident" id="6390980">r</span><span class="op" id="6390981">.</span><span class="ident" id="6390982">URL</span><span class="op" id="6390985">.</span><span class="ident" id="6390986">Path</span><span class="op" id="6390990">,</span>&nbsp;<span class="string" id="6390992">&#34;/debug/pprof/&#34;</span><span class="op" id="6391007">)</span>&nbsp;<span class="op" id="6391009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391013">name</span>&nbsp;<span class="op" id="6391018">:=</span>&nbsp;<span class="ident" id="6391021">strings</span><span class="op" id="6391028">.</span><span class="ident" id="6391029">TrimPrefix</span><span class="op" id="6391039">(</span><span class="ident" id="6391040">r</span><span class="op" id="6391041">.</span><span class="ident" id="6391042">URL</span><span class="op" id="6391045">.</span><span class="ident" id="6391046">Path</span><span class="op" id="6391050">,</span>&nbsp;<span class="string" id="6391052">&#34;/debug/pprof/&#34;</span><span class="op" id="6391067">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391071">if</span>&nbsp;<span class="ident" id="6391074">name</span>&nbsp;<span class="op" id="6391079">!=</span>&nbsp;<span class="string" id="6391082">&#34;&#34;</span>&nbsp;<span class="op" id="6391085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391090">handler</span><span class="op" id="6391097">(</span><span class="ident" id="6391098">name</span><span class="op" id="6391102">)</span><span class="op" id="6391103">.</span><span class="ident" id="6391104">ServeHTTP</span><span class="op" id="6391113">(</span><span class="ident" id="6391114">w</span><span class="op" id="6391115">,</span>&nbsp;<span class="ident" id="6391117">r</span><span class="op" id="6391118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391123">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391135">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391139">profiles</span>&nbsp;<span class="op" id="6391148">:=</span>&nbsp;<span class="ident" id="6391151">pprof</span><span class="op" id="6391156">.</span><span class="ident" id="6391157">Profiles</span><span class="op" id="6391165">(</span><span class="op" id="6391166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6391169">if</span>&nbsp;<span class="ident" id="6391172">err</span>&nbsp;<span class="op" id="6391176">:=</span>&nbsp;<span class="ident" id="6391179">indexTmpl</span><span class="op" id="6391188">.</span><span class="ident" id="6391189">Execute</span><span class="op" id="6391196">(</span><span class="ident" id="6391197">w</span><span class="op" id="6391198">,</span>&nbsp;<span class="ident" id="6391200">profiles</span><span class="op" id="6391208">)</span><span class="op" id="6391209">;</span>&nbsp;<span class="ident" id="6391211">err</span>&nbsp;<span class="op" id="6391215">!=</span>&nbsp;<span class="ident" id="6391218">nil</span>&nbsp;<span class="op" id="6391222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391226">log</span><span class="op" id="6391229">.</span><span class="ident" id="6391230">Print</span><span class="op" id="6391235">(</span><span class="ident" id="6391236">err</span><span class="op" id="6391239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391242">}</span><br>
<span class="lineno">190</span><span class="op" id="6391244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6391247">var</span>&nbsp;<span class="ident" id="6391251">indexTmpl</span>&nbsp;<span class="op" id="6391261">=</span>&nbsp;<span class="ident" id="6391263">template</span><span class="op" id="6391271">.</span><span class="ident" id="6391272">Must</span><span class="op" id="6391276">(</span><span class="ident" id="6391277">template</span><span class="op" id="6391285">.</span><span class="ident" id="6391286">New</span><span class="op" id="6391289">(</span><span class="string" id="6391290">&#34;index&#34;</span><span class="op" id="6391297">)</span><span class="op" id="6391298">.</span><span class="ident" id="6391299">Parse</span><span class="op" id="6391304">(</span><span class="string" id="6391305">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="6391624">)</span><span class="op" id="6391625">)</span>
</div>
</body>
</html>
