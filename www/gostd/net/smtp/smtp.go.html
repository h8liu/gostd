<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6164334">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6164389">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6164443">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6164494">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="6164579">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="6164627">//&nbsp;&nbsp;&nbsp;&nbsp8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="6164649">//&nbsp;&nbsp;&nbsp;&nbspAUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="6164671">//&nbsp;&nbsp;&nbsp;&nbspSTARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="6164693">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="6164745">package</span>&nbsp;<span class="ident" id="6164753">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6164759">import</span>&nbsp;<span class="op" id="6164766">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6164769">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6164783">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6164802">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6164812">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6164818">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6164825">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6164842">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6164852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6164855">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6164917">type</span>&nbsp;<span class="ident" id="6164922">Client</span>&nbsp;<span class="keyword" id="6164929">struct</span>&nbsp;<span class="op" id="6164936">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6164939">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6165018">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165049">Text</span>&nbsp;<span class="op" id="6165054">*</span><span class="ident" id="6165055">textproto</span><span class="op" id="6165064">.</span><span class="ident" id="6165065">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6165071">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6165144">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165165">conn</span>&nbsp;<span class="ident" id="6165170">net</span><span class="op" id="6165173">.</span><span class="ident" id="6165174">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6165180">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165216">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6165227">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165233">serverName</span>&nbsp;<span class="builtintype" id="6165244">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6165252">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165284">ext</span>&nbsp;<span class="keyword" id="6165288">map</span><span class="op" id="6165291">[</span><span class="builtintype" id="6165292">string</span><span class="op" id="6165298">]</span><span class="builtintype" id="6165299">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6165307">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165337">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6165348">[</span><span class="op" id="6165349">]</span><span class="builtintype" id="6165350">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165358">localName</span>&nbsp;&nbsp;<span class="builtintype" id="6165369">string</span>&nbsp;<span class="comment" id="6165376">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165409">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6165420">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6165427">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165460">helloError</span>&nbsp;<span class="builtintype" id="6165471">error</span>&nbsp;&nbsp;<span class="comment" id="6165478">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="6165506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6165509">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="6165575">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="6165615">func</span>&nbsp;<span class="ident" id="6165620">Dial</span><span class="op" id="6165624">(</span><span class="ident" id="6165625">addr</span>&nbsp;<span class="builtintype" id="6165630">string</span><span class="op" id="6165636">)</span>&nbsp;<span class="op" id="6165638">(</span><span class="op" id="6165639">*</span><span class="ident" id="6165640">Client</span><span class="op" id="6165646">,</span>&nbsp;<span class="builtintype" id="6165648">error</span><span class="op" id="6165653">)</span>&nbsp;<span class="op" id="6165655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165658">conn</span><span class="op" id="6165662">,</span>&nbsp;<span class="ident" id="6165664">err</span>&nbsp;<span class="op" id="6165668">:=</span>&nbsp;<span class="ident" id="6165671">net</span><span class="op" id="6165674">.</span><span class="ident" id="6165675">Dial</span><span class="op" id="6165679">(</span><span class="string" id="6165680">&#34;tcp&#34;</span><span class="op" id="6165685">,</span>&nbsp;<span class="ident" id="6165687">addr</span><span class="op" id="6165691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6165694">if</span>&nbsp;<span class="ident" id="6165697">err</span>&nbsp;<span class="op" id="6165701">!=</span>&nbsp;<span class="ident" id="6165704">nil</span>&nbsp;<span class="op" id="6165708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6165712">return</span>&nbsp;<span class="ident" id="6165719">nil</span><span class="op" id="6165722">,</span>&nbsp;<span class="ident" id="6165724">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6165729">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165732">host</span><span class="op" id="6165736">,</span>&nbsp;<span class="ident" id="6165738">_</span><span class="op" id="6165739">,</span>&nbsp;<span class="ident" id="6165741">_</span>&nbsp;<span class="op" id="6165743">:=</span>&nbsp;<span class="ident" id="6165746">net</span><span class="op" id="6165749">.</span><span class="ident" id="6165750">SplitHostPort</span><span class="op" id="6165763">(</span><span class="ident" id="6165764">addr</span><span class="op" id="6165768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6165771">return</span>&nbsp;<span class="ident" id="6165778">NewClient</span><span class="op" id="6165787">(</span><span class="ident" id="6165788">conn</span><span class="op" id="6165792">,</span>&nbsp;<span class="ident" id="6165794">host</span><span class="op" id="6165798">)</span><br>
<span class="lineno"></span><span class="op" id="6165800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6165803">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="6165880">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="6165927">func</span>&nbsp;<span class="ident" id="6165932">NewClient</span><span class="op" id="6165941">(</span><span class="ident" id="6165942">conn</span>&nbsp;<span class="ident" id="6165947">net</span><span class="op" id="6165950">.</span><span class="ident" id="6165951">Conn</span><span class="op" id="6165955">,</span>&nbsp;<span class="ident" id="6165957">host</span>&nbsp;<span class="builtintype" id="6165962">string</span><span class="op" id="6165968">)</span>&nbsp;<span class="op" id="6165970">(</span><span class="op" id="6165971">*</span><span class="ident" id="6165972">Client</span><span class="op" id="6165978">,</span>&nbsp;<span class="builtintype" id="6165980">error</span><span class="op" id="6165985">)</span>&nbsp;<span class="op" id="6165987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6165990">text</span>&nbsp;<span class="op" id="6165995">:=</span>&nbsp;<span class="ident" id="6165998">textproto</span><span class="op" id="6166007">.</span><span class="ident" id="6166008">NewConn</span><span class="op" id="6166015">(</span><span class="ident" id="6166016">conn</span><span class="op" id="6166020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166023">_</span><span class="op" id="6166024">,</span>&nbsp;<span class="ident" id="6166026">_</span><span class="op" id="6166027">,</span>&nbsp;<span class="ident" id="6166029">err</span>&nbsp;<span class="op" id="6166033">:=</span>&nbsp;<span class="ident" id="6166036">text</span><span class="op" id="6166040">.</span><span class="ident" id="6166041">ReadResponse</span><span class="op" id="6166053">(</span><span class="num" id="6166054">220</span><span class="op" id="6166057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166060">if</span>&nbsp;<span class="ident" id="6166063">err</span>&nbsp;<span class="op" id="6166067">!=</span>&nbsp;<span class="ident" id="6166070">nil</span>&nbsp;<span class="op" id="6166074">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166078">text</span><span class="op" id="6166082">.</span><span class="ident" id="6166083">Close</span><span class="op" id="6166088">(</span><span class="op" id="6166089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166093">return</span>&nbsp;<span class="ident" id="6166100">nil</span><span class="op" id="6166103">,</span>&nbsp;<span class="ident" id="6166105">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166113">c</span>&nbsp;<span class="op" id="6166115">:=</span>&nbsp;<span class="op" id="6166118">&amp;</span><span class="ident" id="6166119">Client</span><span class="op" id="6166125">{</span><span class="ident" id="6166126">Text</span><span class="op" id="6166130">:</span>&nbsp;<span class="ident" id="6166132">text</span><span class="op" id="6166136">,</span>&nbsp;<span class="ident" id="6166138">conn</span><span class="op" id="6166142">:</span>&nbsp;<span class="ident" id="6166144">conn</span><span class="op" id="6166148">,</span>&nbsp;<span class="ident" id="6166150">serverName</span><span class="op" id="6166160">:</span>&nbsp;<span class="ident" id="6166162">host</span><span class="op" id="6166166">,</span>&nbsp;<span class="ident" id="6166168">localName</span><span class="op" id="6166177">:</span>&nbsp;<span class="string" id="6166179">&#34;localhost&#34;</span><span class="op" id="6166190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166193">return</span>&nbsp;<span class="ident" id="6166200">c</span><span class="op" id="6166201">,</span>&nbsp;<span class="ident" id="6166203">nil</span><br>
<span class="lineno">65</span><span class="op" id="6166207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6166210">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6166242">func</span>&nbsp;<span class="op" id="6166247">(</span><span class="ident" id="6166248">c</span>&nbsp;<span class="op" id="6166250">*</span><span class="ident" id="6166251">Client</span><span class="op" id="6166257">)</span>&nbsp;<span class="ident" id="6166259">Close</span><span class="op" id="6166264">(</span><span class="op" id="6166265">)</span>&nbsp;<span class="builtintype" id="6166267">error</span>&nbsp;<span class="op" id="6166273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166276">return</span>&nbsp;<span class="ident" id="6166283">c</span><span class="op" id="6166284">.</span><span class="ident" id="6166285">Text</span><span class="op" id="6166289">.</span><span class="ident" id="6166290">Close</span><span class="op" id="6166295">(</span><span class="op" id="6166296">)</span><br>
<span class="lineno">70</span><span class="op" id="6166298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6166301">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="6166343">func</span>&nbsp;<span class="op" id="6166348">(</span><span class="ident" id="6166349">c</span>&nbsp;<span class="op" id="6166351">*</span><span class="ident" id="6166352">Client</span><span class="op" id="6166358">)</span>&nbsp;<span class="ident" id="6166360">hello</span><span class="op" id="6166365">(</span><span class="op" id="6166366">)</span>&nbsp;<span class="builtintype" id="6166368">error</span>&nbsp;<span class="op" id="6166374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166377">if</span>&nbsp;<span class="op" id="6166380">!</span><span class="ident" id="6166381">c</span><span class="op" id="6166382">.</span><span class="ident" id="6166383">didHello</span>&nbsp;<span class="op" id="6166392">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166396">c</span><span class="op" id="6166397">.</span><span class="ident" id="6166398">didHello</span>&nbsp;<span class="op" id="6166407">=</span>&nbsp;<span class="builtintype" id="6166409">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166416">err</span>&nbsp;<span class="op" id="6166420">:=</span>&nbsp;<span class="ident" id="6166423">c</span><span class="op" id="6166424">.</span><span class="ident" id="6166425">ehlo</span><span class="op" id="6166429">(</span><span class="op" id="6166430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166434">if</span>&nbsp;<span class="ident" id="6166437">err</span>&nbsp;<span class="op" id="6166441">!=</span>&nbsp;<span class="ident" id="6166444">nil</span>&nbsp;<span class="op" id="6166448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166453">c</span><span class="op" id="6166454">.</span><span class="ident" id="6166455">helloError</span>&nbsp;<span class="op" id="6166466">=</span>&nbsp;<span class="ident" id="6166468">c</span><span class="op" id="6166469">.</span><span class="ident" id="6166470">helo</span><span class="op" id="6166474">(</span><span class="op" id="6166475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166479">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166485">return</span>&nbsp;<span class="ident" id="6166492">c</span><span class="op" id="6166493">.</span><span class="ident" id="6166494">helloError</span><br>
<span class="lineno"></span><span class="op" id="6166505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6166508">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="6166576">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="6166645">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6166722">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="6166796">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6166825">func</span>&nbsp;<span class="op" id="6166830">(</span><span class="ident" id="6166831">c</span>&nbsp;<span class="op" id="6166833">*</span><span class="ident" id="6166834">Client</span><span class="op" id="6166840">)</span>&nbsp;<span class="ident" id="6166842">Hello</span><span class="op" id="6166847">(</span><span class="ident" id="6166848">localName</span>&nbsp;<span class="builtintype" id="6166858">string</span><span class="op" id="6166864">)</span>&nbsp;<span class="builtintype" id="6166866">error</span>&nbsp;<span class="op" id="6166872">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166875">if</span>&nbsp;<span class="ident" id="6166878">c</span><span class="op" id="6166879">.</span><span class="ident" id="6166880">didHello</span>&nbsp;<span class="op" id="6166889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166893">return</span>&nbsp;<span class="ident" id="6166900">errors</span><span class="op" id="6166906">.</span><span class="ident" id="6166907">New</span><span class="op" id="6166910">(</span><span class="string" id="6166911">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="6166951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6166954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6166957">c</span><span class="op" id="6166958">.</span><span class="ident" id="6166959">localName</span>&nbsp;<span class="op" id="6166969">=</span>&nbsp;<span class="ident" id="6166971">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6166982">return</span>&nbsp;<span class="ident" id="6166989">c</span><span class="op" id="6166990">.</span><span class="ident" id="6166991">hello</span><span class="op" id="6166996">(</span><span class="op" id="6166997">)</span><br>
<span class="lineno">95</span><span class="op" id="6166999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6167002">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="6167081">func</span>&nbsp;<span class="op" id="6167086">(</span><span class="ident" id="6167087">c</span>&nbsp;<span class="op" id="6167089">*</span><span class="ident" id="6167090">Client</span><span class="op" id="6167096">)</span>&nbsp;<span class="ident" id="6167098">cmd</span><span class="op" id="6167101">(</span><span class="ident" id="6167102">expectCode</span>&nbsp;<span class="builtintype" id="6167113">int</span><span class="op" id="6167116">,</span>&nbsp;<span class="ident" id="6167118">format</span>&nbsp;<span class="builtintype" id="6167125">string</span><span class="op" id="6167131">,</span>&nbsp;<span class="ident" id="6167133">args</span>&nbsp;<span class="op" id="6167138">...</span><span class="keyword" id="6167141">interface</span><span class="op" id="6167150">{</span><span class="op" id="6167151">}</span><span class="op" id="6167152">)</span>&nbsp;<span class="op" id="6167154">(</span><span class="builtintype" id="6167155">int</span><span class="op" id="6167158">,</span>&nbsp;<span class="builtintype" id="6167160">string</span><span class="op" id="6167166">,</span>&nbsp;<span class="builtintype" id="6167168">error</span><span class="op" id="6167173">)</span>&nbsp;<span class="op" id="6167175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167178">id</span><span class="op" id="6167180">,</span>&nbsp;<span class="ident" id="6167182">err</span>&nbsp;<span class="op" id="6167186">:=</span>&nbsp;<span class="ident" id="6167189">c</span><span class="op" id="6167190">.</span><span class="ident" id="6167191">Text</span><span class="op" id="6167195">.</span><span class="ident" id="6167196">Cmd</span><span class="op" id="6167199">(</span><span class="ident" id="6167200">format</span><span class="op" id="6167206">,</span>&nbsp;<span class="ident" id="6167208">args</span><span class="op" id="6167212">...</span><span class="op" id="6167215">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167218">if</span>&nbsp;<span class="ident" id="6167221">err</span>&nbsp;<span class="op" id="6167225">!=</span>&nbsp;<span class="ident" id="6167228">nil</span>&nbsp;<span class="op" id="6167232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167236">return</span>&nbsp;<span class="num" id="6167243">0</span><span class="op" id="6167244">,</span>&nbsp;<span class="string" id="6167246">&#34;&#34;</span><span class="op" id="6167248">,</span>&nbsp;<span class="ident" id="6167250">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6167255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167258">c</span><span class="op" id="6167259">.</span><span class="ident" id="6167260">Text</span><span class="op" id="6167264">.</span><span class="ident" id="6167265">StartResponse</span><span class="op" id="6167278">(</span><span class="ident" id="6167279">id</span><span class="op" id="6167281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167284">defer</span>&nbsp;<span class="ident" id="6167290">c</span><span class="op" id="6167291">.</span><span class="ident" id="6167292">Text</span><span class="op" id="6167296">.</span><span class="ident" id="6167297">EndResponse</span><span class="op" id="6167308">(</span><span class="ident" id="6167309">id</span><span class="op" id="6167311">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167314">code</span><span class="op" id="6167318">,</span>&nbsp;<span class="ident" id="6167320">msg</span><span class="op" id="6167323">,</span>&nbsp;<span class="ident" id="6167325">err</span>&nbsp;<span class="op" id="6167329">:=</span>&nbsp;<span class="ident" id="6167332">c</span><span class="op" id="6167333">.</span><span class="ident" id="6167334">Text</span><span class="op" id="6167338">.</span><span class="ident" id="6167339">ReadResponse</span><span class="op" id="6167351">(</span><span class="ident" id="6167352">expectCode</span><span class="op" id="6167362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167365">return</span>&nbsp;<span class="ident" id="6167372">code</span><span class="op" id="6167376">,</span>&nbsp;<span class="ident" id="6167378">msg</span><span class="op" id="6167381">,</span>&nbsp;<span class="ident" id="6167383">err</span><br>
<span class="lineno"></span><span class="op" id="6167387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6167390">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="6167469">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="6167502">func</span>&nbsp;<span class="op" id="6167507">(</span><span class="ident" id="6167508">c</span>&nbsp;<span class="op" id="6167510">*</span><span class="ident" id="6167511">Client</span><span class="op" id="6167517">)</span>&nbsp;<span class="ident" id="6167519">helo</span><span class="op" id="6167523">(</span><span class="op" id="6167524">)</span>&nbsp;<span class="builtintype" id="6167526">error</span>&nbsp;<span class="op" id="6167532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167535">c</span><span class="op" id="6167536">.</span><span class="ident" id="6167537">ext</span>&nbsp;<span class="op" id="6167541">=</span>&nbsp;<span class="ident" id="6167543">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167548">_</span><span class="op" id="6167549">,</span>&nbsp;<span class="ident" id="6167551">_</span><span class="op" id="6167552">,</span>&nbsp;<span class="ident" id="6167554">err</span>&nbsp;<span class="op" id="6167558">:=</span>&nbsp;<span class="ident" id="6167561">c</span><span class="op" id="6167562">.</span><span class="ident" id="6167563">cmd</span><span class="op" id="6167566">(</span><span class="num" id="6167567">250</span><span class="op" id="6167570">,</span>&nbsp;<span class="string" id="6167572">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="6167581">,</span>&nbsp;<span class="ident" id="6167583">c</span><span class="op" id="6167584">.</span><span class="ident" id="6167585">localName</span><span class="op" id="6167594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167597">return</span>&nbsp;<span class="ident" id="6167604">err</span><br>
<span class="lineno">115</span><span class="op" id="6167608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6167611">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="6167678">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="6167743">func</span>&nbsp;<span class="op" id="6167748">(</span><span class="ident" id="6167749">c</span>&nbsp;<span class="op" id="6167751">*</span><span class="ident" id="6167752">Client</span><span class="op" id="6167758">)</span>&nbsp;<span class="ident" id="6167760">ehlo</span><span class="op" id="6167764">(</span><span class="op" id="6167765">)</span>&nbsp;<span class="builtintype" id="6167767">error</span>&nbsp;<span class="op" id="6167773">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167776">_</span><span class="op" id="6167777">,</span>&nbsp;<span class="ident" id="6167779">msg</span><span class="op" id="6167782">,</span>&nbsp;<span class="ident" id="6167784">err</span>&nbsp;<span class="op" id="6167788">:=</span>&nbsp;<span class="ident" id="6167791">c</span><span class="op" id="6167792">.</span><span class="ident" id="6167793">cmd</span><span class="op" id="6167796">(</span><span class="num" id="6167797">250</span><span class="op" id="6167800">,</span>&nbsp;<span class="string" id="6167802">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="6167811">,</span>&nbsp;<span class="ident" id="6167813">c</span><span class="op" id="6167814">.</span><span class="ident" id="6167815">localName</span><span class="op" id="6167824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167827">if</span>&nbsp;<span class="ident" id="6167830">err</span>&nbsp;<span class="op" id="6167834">!=</span>&nbsp;<span class="ident" id="6167837">nil</span>&nbsp;<span class="op" id="6167841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167845">return</span>&nbsp;<span class="ident" id="6167852">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6167857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167860">ext</span>&nbsp;<span class="op" id="6167864">:=</span>&nbsp;<span class="builtinfunc" id="6167867">make</span><span class="op" id="6167871">(</span><span class="keyword" id="6167872">map</span><span class="op" id="6167875">[</span><span class="builtintype" id="6167876">string</span><span class="op" id="6167882">]</span><span class="builtintype" id="6167883">string</span><span class="op" id="6167889">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167892">extList</span>&nbsp;<span class="op" id="6167900">:=</span>&nbsp;<span class="ident" id="6167903">strings</span><span class="op" id="6167910">.</span><span class="ident" id="6167911">Split</span><span class="op" id="6167916">(</span><span class="ident" id="6167917">msg</span><span class="op" id="6167920">,</span>&nbsp;<span class="string" id="6167922">&#34;\n&#34;</span><span class="op" id="6167926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167929">if</span>&nbsp;<span class="builtinfunc" id="6167932">len</span><span class="op" id="6167935">(</span><span class="ident" id="6167936">extList</span><span class="op" id="6167943">)</span>&nbsp;<span class="op" id="6167945">&gt;</span>&nbsp;<span class="num" id="6167947">1</span>&nbsp;<span class="op" id="6167949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6167953">extList</span>&nbsp;<span class="op" id="6167961">=</span>&nbsp;<span class="ident" id="6167963">extList</span><span class="op" id="6167970">[</span><span class="num" id="6167971">1</span><span class="op" id="6167972">:</span><span class="op" id="6167973">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6167977">for</span>&nbsp;<span class="ident" id="6167981">_</span><span class="op" id="6167982">,</span>&nbsp;<span class="ident" id="6167984">line</span>&nbsp;<span class="op" id="6167989">:=</span>&nbsp;<span class="keyword" id="6167992">range</span>&nbsp;<span class="ident" id="6167998">extList</span>&nbsp;<span class="op" id="6168006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168011">args</span>&nbsp;<span class="op" id="6168016">:=</span>&nbsp;<span class="ident" id="6168019">strings</span><span class="op" id="6168026">.</span><span class="ident" id="6168027">SplitN</span><span class="op" id="6168033">(</span><span class="ident" id="6168034">line</span><span class="op" id="6168038">,</span>&nbsp;<span class="string" id="6168040">&#34;&nbsp;&#34;</span><span class="op" id="6168043">,</span>&nbsp;<span class="num" id="6168045">2</span><span class="op" id="6168046">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168051">if</span>&nbsp;<span class="builtinfunc" id="6168054">len</span><span class="op" id="6168057">(</span><span class="ident" id="6168058">args</span><span class="op" id="6168062">)</span>&nbsp;<span class="op" id="6168064">&gt;</span>&nbsp;<span class="num" id="6168066">1</span>&nbsp;<span class="op" id="6168068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168074">ext</span><span class="op" id="6168077">[</span><span class="ident" id="6168078">args</span><span class="op" id="6168082">[</span><span class="num" id="6168083">0</span><span class="op" id="6168084">]</span><span class="op" id="6168085">]</span>&nbsp;<span class="op" id="6168087">=</span>&nbsp;<span class="ident" id="6168089">args</span><span class="op" id="6168093">[</span><span class="num" id="6168094">1</span><span class="op" id="6168095">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168100">}</span>&nbsp;<span class="keyword" id="6168102">else</span>&nbsp;<span class="op" id="6168107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168113">ext</span><span class="op" id="6168116">[</span><span class="ident" id="6168117">args</span><span class="op" id="6168121">[</span><span class="num" id="6168122">0</span><span class="op" id="6168123">]</span><span class="op" id="6168124">]</span>&nbsp;<span class="op" id="6168126">=</span>&nbsp;<span class="string" id="6168128">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168134">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168144">if</span>&nbsp;<span class="ident" id="6168147">mechs</span><span class="op" id="6168152">,</span>&nbsp;<span class="ident" id="6168154">ok</span>&nbsp;<span class="op" id="6168157">:=</span>&nbsp;<span class="ident" id="6168160">ext</span><span class="op" id="6168163">[</span><span class="string" id="6168164">&#34;AUTH&#34;</span><span class="op" id="6168170">]</span><span class="op" id="6168171">;</span>&nbsp;<span class="ident" id="6168173">ok</span>&nbsp;<span class="op" id="6168176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168180">c</span><span class="op" id="6168181">.</span><span class="ident" id="6168182">auth</span>&nbsp;<span class="op" id="6168187">=</span>&nbsp;<span class="ident" id="6168189">strings</span><span class="op" id="6168196">.</span><span class="ident" id="6168197">Split</span><span class="op" id="6168202">(</span><span class="ident" id="6168203">mechs</span><span class="op" id="6168208">,</span>&nbsp;<span class="string" id="6168210">&#34;&nbsp;&#34;</span><span class="op" id="6168213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168216">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168219">c</span><span class="op" id="6168220">.</span><span class="ident" id="6168221">ext</span>&nbsp;<span class="op" id="6168225">=</span>&nbsp;<span class="ident" id="6168227">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168232">return</span>&nbsp;<span class="ident" id="6168239">err</span><br>
<span class="lineno"></span><span class="op" id="6168243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6168246">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="6168325">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6168402">func</span>&nbsp;<span class="op" id="6168407">(</span><span class="ident" id="6168408">c</span>&nbsp;<span class="op" id="6168410">*</span><span class="ident" id="6168411">Client</span><span class="op" id="6168417">)</span>&nbsp;<span class="ident" id="6168419">StartTLS</span><span class="op" id="6168427">(</span><span class="ident" id="6168428">config</span>&nbsp;<span class="op" id="6168435">*</span><span class="ident" id="6168436">tls</span><span class="op" id="6168439">.</span><span class="ident" id="6168440">Config</span><span class="op" id="6168446">)</span>&nbsp;<span class="builtintype" id="6168448">error</span>&nbsp;<span class="op" id="6168454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168457">if</span>&nbsp;<span class="ident" id="6168460">err</span>&nbsp;<span class="op" id="6168464">:=</span>&nbsp;<span class="ident" id="6168467">c</span><span class="op" id="6168468">.</span><span class="ident" id="6168469">hello</span><span class="op" id="6168474">(</span><span class="op" id="6168475">)</span><span class="op" id="6168476">;</span>&nbsp;<span class="ident" id="6168478">err</span>&nbsp;<span class="op" id="6168482">!=</span>&nbsp;<span class="ident" id="6168485">nil</span>&nbsp;<span class="op" id="6168489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168493">return</span>&nbsp;<span class="ident" id="6168500">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168505">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168508">_</span><span class="op" id="6168509">,</span>&nbsp;<span class="ident" id="6168511">_</span><span class="op" id="6168512">,</span>&nbsp;<span class="ident" id="6168514">err</span>&nbsp;<span class="op" id="6168518">:=</span>&nbsp;<span class="ident" id="6168521">c</span><span class="op" id="6168522">.</span><span class="ident" id="6168523">cmd</span><span class="op" id="6168526">(</span><span class="num" id="6168527">220</span><span class="op" id="6168530">,</span>&nbsp;<span class="string" id="6168532">&#34;STARTTLS&#34;</span><span class="op" id="6168542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168545">if</span>&nbsp;<span class="ident" id="6168548">err</span>&nbsp;<span class="op" id="6168552">!=</span>&nbsp;<span class="ident" id="6168555">nil</span>&nbsp;<span class="op" id="6168559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168563">return</span>&nbsp;<span class="ident" id="6168570">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6168575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168578">c</span><span class="op" id="6168579">.</span><span class="ident" id="6168580">conn</span>&nbsp;<span class="op" id="6168585">=</span>&nbsp;<span class="ident" id="6168587">tls</span><span class="op" id="6168590">.</span><span class="ident" id="6168591">Client</span><span class="op" id="6168597">(</span><span class="ident" id="6168598">c</span><span class="op" id="6168599">.</span><span class="ident" id="6168600">conn</span><span class="op" id="6168604">,</span>&nbsp;<span class="ident" id="6168606">config</span><span class="op" id="6168612">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168615">c</span><span class="op" id="6168616">.</span><span class="ident" id="6168617">Text</span>&nbsp;<span class="op" id="6168622">=</span>&nbsp;<span class="ident" id="6168624">textproto</span><span class="op" id="6168633">.</span><span class="ident" id="6168634">NewConn</span><span class="op" id="6168641">(</span><span class="ident" id="6168642">c</span><span class="op" id="6168643">.</span><span class="ident" id="6168644">conn</span><span class="op" id="6168648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6168651">c</span><span class="op" id="6168652">.</span><span class="ident" id="6168653">tls</span>&nbsp;<span class="op" id="6168657">=</span>&nbsp;<span class="builtintype" id="6168659">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168665">return</span>&nbsp;<span class="ident" id="6168672">c</span><span class="op" id="6168673">.</span><span class="ident" id="6168674">ehlo</span><span class="op" id="6168678">(</span><span class="op" id="6168679">)</span><br>
<span class="lineno"></span><span class="op" id="6168681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6168684">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6168749">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="6168814">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="6168880">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="6168931">func</span>&nbsp;<span class="op" id="6168936">(</span><span class="ident" id="6168937">c</span>&nbsp;<span class="op" id="6168939">*</span><span class="ident" id="6168940">Client</span><span class="op" id="6168946">)</span>&nbsp;<span class="ident" id="6168948">Verify</span><span class="op" id="6168954">(</span><span class="ident" id="6168955">addr</span>&nbsp;<span class="builtintype" id="6168960">string</span><span class="op" id="6168966">)</span>&nbsp;<span class="builtintype" id="6168968">error</span>&nbsp;<span class="op" id="6168974">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6168977">if</span>&nbsp;<span class="ident" id="6168980">err</span>&nbsp;<span class="op" id="6168984">:=</span>&nbsp;<span class="ident" id="6168987">c</span><span class="op" id="6168988">.</span><span class="ident" id="6168989">hello</span><span class="op" id="6168994">(</span><span class="op" id="6168995">)</span><span class="op" id="6168996">;</span>&nbsp;<span class="ident" id="6168998">err</span>&nbsp;<span class="op" id="6169002">!=</span>&nbsp;<span class="ident" id="6169005">nil</span>&nbsp;<span class="op" id="6169009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169013">return</span>&nbsp;<span class="ident" id="6169020">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6169025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169028">_</span><span class="op" id="6169029">,</span>&nbsp;<span class="ident" id="6169031">_</span><span class="op" id="6169032">,</span>&nbsp;<span class="ident" id="6169034">err</span>&nbsp;<span class="op" id="6169038">:=</span>&nbsp;<span class="ident" id="6169041">c</span><span class="op" id="6169042">.</span><span class="ident" id="6169043">cmd</span><span class="op" id="6169046">(</span><span class="num" id="6169047">250</span><span class="op" id="6169050">,</span>&nbsp;<span class="string" id="6169052">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="6169061">,</span>&nbsp;<span class="ident" id="6169063">addr</span><span class="op" id="6169067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169070">return</span>&nbsp;<span class="ident" id="6169077">err</span><br>
<span class="lineno">170</span><span class="op" id="6169081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6169084">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="6169160">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="6169210">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="6169283">func</span>&nbsp;<span class="op" id="6169288">(</span><span class="ident" id="6169289">c</span>&nbsp;<span class="op" id="6169291">*</span><span class="ident" id="6169292">Client</span><span class="op" id="6169298">)</span>&nbsp;<span class="ident" id="6169300">Auth</span><span class="op" id="6169304">(</span><span class="ident" id="6169305">a</span>&nbsp;<span class="ident" id="6169307">Auth</span><span class="op" id="6169311">)</span>&nbsp;<span class="builtintype" id="6169313">error</span>&nbsp;<span class="op" id="6169319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169322">if</span>&nbsp;<span class="ident" id="6169325">err</span>&nbsp;<span class="op" id="6169329">:=</span>&nbsp;<span class="ident" id="6169332">c</span><span class="op" id="6169333">.</span><span class="ident" id="6169334">hello</span><span class="op" id="6169339">(</span><span class="op" id="6169340">)</span><span class="op" id="6169341">;</span>&nbsp;<span class="ident" id="6169343">err</span>&nbsp;<span class="op" id="6169347">!=</span>&nbsp;<span class="ident" id="6169350">nil</span>&nbsp;<span class="op" id="6169354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169358">return</span>&nbsp;<span class="ident" id="6169365">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6169370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169373">encoding</span>&nbsp;<span class="op" id="6169382">:=</span>&nbsp;<span class="ident" id="6169385">base64</span><span class="op" id="6169391">.</span><span class="ident" id="6169392">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169405">mech</span><span class="op" id="6169409">,</span>&nbsp;<span class="ident" id="6169411">resp</span><span class="op" id="6169415">,</span>&nbsp;<span class="ident" id="6169417">err</span>&nbsp;<span class="op" id="6169421">:=</span>&nbsp;<span class="ident" id="6169424">a</span><span class="op" id="6169425">.</span><span class="ident" id="6169426">Start</span><span class="op" id="6169431">(</span><span class="op" id="6169432">&amp;</span><span class="ident" id="6169433">ServerInfo</span><span class="op" id="6169443">{</span><span class="ident" id="6169444">c</span><span class="op" id="6169445">.</span><span class="ident" id="6169446">serverName</span><span class="op" id="6169456">,</span>&nbsp;<span class="ident" id="6169458">c</span><span class="op" id="6169459">.</span><span class="ident" id="6169460">tls</span><span class="op" id="6169463">,</span>&nbsp;<span class="ident" id="6169465">c</span><span class="op" id="6169466">.</span><span class="ident" id="6169467">auth</span><span class="op" id="6169471">}</span><span class="op" id="6169472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169475">if</span>&nbsp;<span class="ident" id="6169478">err</span>&nbsp;<span class="op" id="6169482">!=</span>&nbsp;<span class="ident" id="6169485">nil</span>&nbsp;<span class="op" id="6169489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169493">c</span><span class="op" id="6169494">.</span><span class="ident" id="6169495">Quit</span><span class="op" id="6169499">(</span><span class="op" id="6169500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169504">return</span>&nbsp;<span class="ident" id="6169511">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6169516">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169519">resp64</span>&nbsp;<span class="op" id="6169526">:=</span>&nbsp;<span class="builtinfunc" id="6169529">make</span><span class="op" id="6169533">(</span><span class="op" id="6169534">[</span><span class="op" id="6169535">]</span><span class="builtintype" id="6169536">byte</span><span class="op" id="6169540">,</span>&nbsp;<span class="ident" id="6169542">encoding</span><span class="op" id="6169550">.</span><span class="ident" id="6169551">EncodedLen</span><span class="op" id="6169561">(</span><span class="builtinfunc" id="6169562">len</span><span class="op" id="6169565">(</span><span class="ident" id="6169566">resp</span><span class="op" id="6169570">)</span><span class="op" id="6169571">)</span><span class="op" id="6169572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169575">encoding</span><span class="op" id="6169583">.</span><span class="ident" id="6169584">Encode</span><span class="op" id="6169590">(</span><span class="ident" id="6169591">resp64</span><span class="op" id="6169597">,</span>&nbsp;<span class="ident" id="6169599">resp</span><span class="op" id="6169603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169606">code</span><span class="op" id="6169610">,</span>&nbsp;<span class="ident" id="6169612">msg64</span><span class="op" id="6169617">,</span>&nbsp;<span class="ident" id="6169619">err</span>&nbsp;<span class="op" id="6169623">:=</span>&nbsp;<span class="ident" id="6169626">c</span><span class="op" id="6169627">.</span><span class="ident" id="6169628">cmd</span><span class="op" id="6169631">(</span><span class="num" id="6169632">0</span><span class="op" id="6169633">,</span>&nbsp;<span class="string" id="6169635">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="6169647">,</span>&nbsp;<span class="ident" id="6169649">mech</span><span class="op" id="6169653">,</span>&nbsp;<span class="ident" id="6169655">resp64</span><span class="op" id="6169661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169664">for</span>&nbsp;<span class="ident" id="6169668">err</span>&nbsp;<span class="op" id="6169672">==</span>&nbsp;<span class="ident" id="6169675">nil</span>&nbsp;<span class="op" id="6169679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169683">var</span>&nbsp;<span class="ident" id="6169687">msg</span>&nbsp;<span class="op" id="6169691">[</span><span class="op" id="6169692">]</span><span class="builtintype" id="6169693">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169700">switch</span>&nbsp;<span class="ident" id="6169707">code</span>&nbsp;<span class="op" id="6169712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169716">case</span>&nbsp;<span class="num" id="6169721">334</span><span class="op" id="6169724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169729">msg</span><span class="op" id="6169732">,</span>&nbsp;<span class="ident" id="6169734">err</span>&nbsp;<span class="op" id="6169738">=</span>&nbsp;<span class="ident" id="6169740">encoding</span><span class="op" id="6169748">.</span><span class="ident" id="6169749">DecodeString</span><span class="op" id="6169761">(</span><span class="ident" id="6169762">msg64</span><span class="op" id="6169767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169771">case</span>&nbsp;<span class="num" id="6169776">235</span><span class="op" id="6169779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169784">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169849">msg</span>&nbsp;<span class="op" id="6169853">=</span>&nbsp;<span class="op" id="6169855">[</span><span class="op" id="6169856">]</span><span class="builtintype" id="6169857">byte</span><span class="op" id="6169861">(</span><span class="ident" id="6169862">msg64</span><span class="op" id="6169867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169871">default</span><span class="op" id="6169878">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169883">err</span>&nbsp;<span class="op" id="6169887">=</span>&nbsp;<span class="op" id="6169889">&amp;</span><span class="ident" id="6169890">textproto</span><span class="op" id="6169899">.</span><span class="ident" id="6169900">Error</span><span class="op" id="6169905">{</span><span class="ident" id="6169906">Code</span><span class="op" id="6169910">:</span>&nbsp;<span class="ident" id="6169912">code</span><span class="op" id="6169916">,</span>&nbsp;<span class="ident" id="6169918">Msg</span><span class="op" id="6169921">:</span>&nbsp;<span class="ident" id="6169923">msg64</span><span class="op" id="6169928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6169932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169936">if</span>&nbsp;<span class="ident" id="6169939">err</span>&nbsp;<span class="op" id="6169943">==</span>&nbsp;<span class="ident" id="6169946">nil</span>&nbsp;<span class="op" id="6169950">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169955">resp</span><span class="op" id="6169959">,</span>&nbsp;<span class="ident" id="6169961">err</span>&nbsp;<span class="op" id="6169965">=</span>&nbsp;<span class="ident" id="6169967">a</span><span class="op" id="6169968">.</span><span class="ident" id="6169969">Next</span><span class="op" id="6169973">(</span><span class="ident" id="6169974">msg</span><span class="op" id="6169977">,</span>&nbsp;<span class="ident" id="6169979">code</span>&nbsp;<span class="op" id="6169984">==</span>&nbsp;<span class="num" id="6169987">334</span><span class="op" id="6169990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6169994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6169998">if</span>&nbsp;<span class="ident" id="6170001">err</span>&nbsp;<span class="op" id="6170005">!=</span>&nbsp;<span class="ident" id="6170008">nil</span>&nbsp;<span class="op" id="6170012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6170017">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170038">c</span><span class="op" id="6170039">.</span><span class="ident" id="6170040">cmd</span><span class="op" id="6170043">(</span><span class="num" id="6170044">501</span><span class="op" id="6170047">,</span>&nbsp;<span class="string" id="6170049">&#34;*&#34;</span><span class="op" id="6170052">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170057">c</span><span class="op" id="6170058">.</span><span class="ident" id="6170059">Quit</span><span class="op" id="6170063">(</span><span class="op" id="6170064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170069">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6170077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170081">if</span>&nbsp;<span class="ident" id="6170084">resp</span>&nbsp;<span class="op" id="6170089">==</span>&nbsp;<span class="ident" id="6170092">nil</span>&nbsp;<span class="op" id="6170096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170101">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6170109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170113">resp64</span>&nbsp;<span class="op" id="6170120">=</span>&nbsp;<span class="builtinfunc" id="6170122">make</span><span class="op" id="6170126">(</span><span class="op" id="6170127">[</span><span class="op" id="6170128">]</span><span class="builtintype" id="6170129">byte</span><span class="op" id="6170133">,</span>&nbsp;<span class="ident" id="6170135">encoding</span><span class="op" id="6170143">.</span><span class="ident" id="6170144">EncodedLen</span><span class="op" id="6170154">(</span><span class="builtinfunc" id="6170155">len</span><span class="op" id="6170158">(</span><span class="ident" id="6170159">resp</span><span class="op" id="6170163">)</span><span class="op" id="6170164">)</span><span class="op" id="6170165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170169">encoding</span><span class="op" id="6170177">.</span><span class="ident" id="6170178">Encode</span><span class="op" id="6170184">(</span><span class="ident" id="6170185">resp64</span><span class="op" id="6170191">,</span>&nbsp;<span class="ident" id="6170193">resp</span><span class="op" id="6170197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170201">code</span><span class="op" id="6170205">,</span>&nbsp;<span class="ident" id="6170207">msg64</span><span class="op" id="6170212">,</span>&nbsp;<span class="ident" id="6170214">err</span>&nbsp;<span class="op" id="6170218">=</span>&nbsp;<span class="ident" id="6170220">c</span><span class="op" id="6170221">.</span><span class="ident" id="6170222">cmd</span><span class="op" id="6170225">(</span><span class="num" id="6170226">0</span><span class="op" id="6170227">,</span>&nbsp;<span class="builtintype" id="6170229">string</span><span class="op" id="6170235">(</span><span class="ident" id="6170236">resp64</span><span class="op" id="6170242">)</span><span class="op" id="6170243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6170246">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170249">return</span>&nbsp;<span class="ident" id="6170256">err</span><br>
<span class="lineno"></span><span class="op" id="6170260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6170263">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6170341">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="6170419">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6170433">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="6170513">func</span>&nbsp;<span class="op" id="6170518">(</span><span class="ident" id="6170519">c</span>&nbsp;<span class="op" id="6170521">*</span><span class="ident" id="6170522">Client</span><span class="op" id="6170528">)</span>&nbsp;<span class="ident" id="6170530">Mail</span><span class="op" id="6170534">(</span><span class="ident" id="6170535">from</span>&nbsp;<span class="builtintype" id="6170540">string</span><span class="op" id="6170546">)</span>&nbsp;<span class="builtintype" id="6170548">error</span>&nbsp;<span class="op" id="6170554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170557">if</span>&nbsp;<span class="ident" id="6170560">err</span>&nbsp;<span class="op" id="6170564">:=</span>&nbsp;<span class="ident" id="6170567">c</span><span class="op" id="6170568">.</span><span class="ident" id="6170569">hello</span><span class="op" id="6170574">(</span><span class="op" id="6170575">)</span><span class="op" id="6170576">;</span>&nbsp;<span class="ident" id="6170578">err</span>&nbsp;<span class="op" id="6170582">!=</span>&nbsp;<span class="ident" id="6170585">nil</span>&nbsp;<span class="op" id="6170589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170593">return</span>&nbsp;<span class="ident" id="6170600">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6170605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170608">cmdStr</span>&nbsp;<span class="op" id="6170615">:=</span>&nbsp;<span class="string" id="6170618">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170636">if</span>&nbsp;<span class="ident" id="6170639">c</span><span class="op" id="6170640">.</span><span class="ident" id="6170641">ext</span>&nbsp;<span class="op" id="6170645">!=</span>&nbsp;<span class="ident" id="6170648">nil</span>&nbsp;<span class="op" id="6170652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170656">if</span>&nbsp;<span class="ident" id="6170659">_</span><span class="op" id="6170660">,</span>&nbsp;<span class="ident" id="6170662">ok</span>&nbsp;<span class="op" id="6170665">:=</span>&nbsp;<span class="ident" id="6170668">c</span><span class="op" id="6170669">.</span><span class="ident" id="6170670">ext</span><span class="op" id="6170673">[</span><span class="string" id="6170674">&#34;8BITMIME&#34;</span><span class="op" id="6170684">]</span><span class="op" id="6170685">;</span>&nbsp;<span class="ident" id="6170687">ok</span>&nbsp;<span class="op" id="6170690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170695">cmdStr</span>&nbsp;<span class="op" id="6170702">+=</span>&nbsp;<span class="string" id="6170705">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6170724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6170727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170730">_</span><span class="op" id="6170731">,</span>&nbsp;<span class="ident" id="6170733">_</span><span class="op" id="6170734">,</span>&nbsp;<span class="ident" id="6170736">err</span>&nbsp;<span class="op" id="6170740">:=</span>&nbsp;<span class="ident" id="6170743">c</span><span class="op" id="6170744">.</span><span class="ident" id="6170745">cmd</span><span class="op" id="6170748">(</span><span class="num" id="6170749">250</span><span class="op" id="6170752">,</span>&nbsp;<span class="ident" id="6170754">cmdStr</span><span class="op" id="6170760">,</span>&nbsp;<span class="ident" id="6170762">from</span><span class="op" id="6170766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170769">return</span>&nbsp;<span class="ident" id="6170776">err</span><br>
<span class="lineno"></span><span class="op" id="6170780">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6170783">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6170861">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6170937">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="6170974">func</span>&nbsp;<span class="op" id="6170979">(</span><span class="ident" id="6170980">c</span>&nbsp;<span class="op" id="6170982">*</span><span class="ident" id="6170983">Client</span><span class="op" id="6170989">)</span>&nbsp;<span class="ident" id="6170991">Rcpt</span><span class="op" id="6170995">(</span><span class="ident" id="6170996">to</span>&nbsp;<span class="builtintype" id="6170999">string</span><span class="op" id="6171005">)</span>&nbsp;<span class="builtintype" id="6171007">error</span>&nbsp;<span class="op" id="6171013">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171016">_</span><span class="op" id="6171017">,</span>&nbsp;<span class="ident" id="6171019">_</span><span class="op" id="6171020">,</span>&nbsp;<span class="ident" id="6171022">err</span>&nbsp;<span class="op" id="6171026">:=</span>&nbsp;<span class="ident" id="6171029">c</span><span class="op" id="6171030">.</span><span class="ident" id="6171031">cmd</span><span class="op" id="6171034">(</span><span class="num" id="6171035">25</span><span class="op" id="6171037">,</span>&nbsp;<span class="string" id="6171039">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="6171053">,</span>&nbsp;<span class="ident" id="6171055">to</span><span class="op" id="6171057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171060">return</span>&nbsp;<span class="ident" id="6171067">err</span><br>
<span class="lineno"></span><span class="op" id="6171071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6171074">type</span>&nbsp;<span class="ident" id="6171079">dataCloser</span>&nbsp;<span class="keyword" id="6171090">struct</span>&nbsp;<span class="op" id="6171097">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171100">c</span>&nbsp;<span class="op" id="6171102">*</span><span class="ident" id="6171103">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171111">io</span><span class="op" id="6171113">.</span><span class="ident" id="6171114">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="6171126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6171129">func</span>&nbsp;<span class="op" id="6171134">(</span><span class="ident" id="6171135">d</span>&nbsp;<span class="op" id="6171137">*</span><span class="ident" id="6171138">dataCloser</span><span class="op" id="6171148">)</span>&nbsp;<span class="ident" id="6171150">Close</span><span class="op" id="6171155">(</span><span class="op" id="6171156">)</span>&nbsp;<span class="builtintype" id="6171158">error</span>&nbsp;<span class="op" id="6171164">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171167">d</span><span class="op" id="6171168">.</span><span class="ident" id="6171169">WriteCloser</span><span class="op" id="6171180">.</span><span class="ident" id="6171181">Close</span><span class="op" id="6171186">(</span><span class="op" id="6171187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171190">_</span><span class="op" id="6171191">,</span>&nbsp;<span class="ident" id="6171193">_</span><span class="op" id="6171194">,</span>&nbsp;<span class="ident" id="6171196">err</span>&nbsp;<span class="op" id="6171200">:=</span>&nbsp;<span class="ident" id="6171203">d</span><span class="op" id="6171204">.</span><span class="ident" id="6171205">c</span><span class="op" id="6171206">.</span><span class="ident" id="6171207">Text</span><span class="op" id="6171211">.</span><span class="ident" id="6171212">ReadResponse</span><span class="op" id="6171224">(</span><span class="num" id="6171225">250</span><span class="op" id="6171228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171231">return</span>&nbsp;<span class="ident" id="6171238">err</span><br>
<span class="lineno"></span><span class="op" id="6171242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6171245">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6171315">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="6171384">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6171425">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="6171490">func</span>&nbsp;<span class="op" id="6171495">(</span><span class="ident" id="6171496">c</span>&nbsp;<span class="op" id="6171498">*</span><span class="ident" id="6171499">Client</span><span class="op" id="6171505">)</span>&nbsp;<span class="ident" id="6171507">Data</span><span class="op" id="6171511">(</span><span class="op" id="6171512">)</span>&nbsp;<span class="op" id="6171514">(</span><span class="ident" id="6171515">io</span><span class="op" id="6171517">.</span><span class="ident" id="6171518">WriteCloser</span><span class="op" id="6171529">,</span>&nbsp;<span class="builtintype" id="6171531">error</span><span class="op" id="6171536">)</span>&nbsp;<span class="op" id="6171538">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171541">_</span><span class="op" id="6171542">,</span>&nbsp;<span class="ident" id="6171544">_</span><span class="op" id="6171545">,</span>&nbsp;<span class="ident" id="6171547">err</span>&nbsp;<span class="op" id="6171551">:=</span>&nbsp;<span class="ident" id="6171554">c</span><span class="op" id="6171555">.</span><span class="ident" id="6171556">cmd</span><span class="op" id="6171559">(</span><span class="num" id="6171560">354</span><span class="op" id="6171563">,</span>&nbsp;<span class="string" id="6171565">&#34;DATA&#34;</span><span class="op" id="6171571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171574">if</span>&nbsp;<span class="ident" id="6171577">err</span>&nbsp;<span class="op" id="6171581">!=</span>&nbsp;<span class="ident" id="6171584">nil</span>&nbsp;<span class="op" id="6171588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171592">return</span>&nbsp;<span class="ident" id="6171599">nil</span><span class="op" id="6171602">,</span>&nbsp;<span class="ident" id="6171604">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6171609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171612">return</span>&nbsp;<span class="op" id="6171619">&amp;</span><span class="ident" id="6171620">dataCloser</span><span class="op" id="6171630">{</span><span class="ident" id="6171631">c</span><span class="op" id="6171632">,</span>&nbsp;<span class="ident" id="6171634">c</span><span class="op" id="6171635">.</span><span class="ident" id="6171636">Text</span><span class="op" id="6171640">.</span><span class="ident" id="6171641">DotWriter</span><span class="op" id="6171650">(</span><span class="op" id="6171651">)</span><span class="op" id="6171652">}</span><span class="op" id="6171653">,</span>&nbsp;<span class="ident" id="6171655">nil</span><br>
<span class="lineno">265</span><span class="op" id="6171659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6171662">var</span>&nbsp;<span class="ident" id="6171666">testHookStartTLS</span>&nbsp;<span class="keyword" id="6171683">func</span><span class="op" id="6171687">(</span><span class="op" id="6171688">*</span><span class="ident" id="6171689">tls</span><span class="op" id="6171692">.</span><span class="ident" id="6171693">Config</span><span class="op" id="6171699">)</span>&nbsp;<span class="comment" id="6171701">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6171727">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="6171790">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="6171860">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6171928">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="6171944">func</span>&nbsp;<span class="ident" id="6171949">SendMail</span><span class="op" id="6171957">(</span><span class="ident" id="6171958">addr</span>&nbsp;<span class="builtintype" id="6171963">string</span><span class="op" id="6171969">,</span>&nbsp;<span class="ident" id="6171971">a</span>&nbsp;<span class="ident" id="6171973">Auth</span><span class="op" id="6171977">,</span>&nbsp;<span class="ident" id="6171979">from</span>&nbsp;<span class="builtintype" id="6171984">string</span><span class="op" id="6171990">,</span>&nbsp;<span class="ident" id="6171992">to</span>&nbsp;<span class="op" id="6171995">[</span><span class="op" id="6171996">]</span><span class="builtintype" id="6171997">string</span><span class="op" id="6172003">,</span>&nbsp;<span class="ident" id="6172005">msg</span>&nbsp;<span class="op" id="6172009">[</span><span class="op" id="6172010">]</span><span class="builtintype" id="6172011">byte</span><span class="op" id="6172015">)</span>&nbsp;<span class="builtintype" id="6172017">error</span>&nbsp;<span class="op" id="6172023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172026">c</span><span class="op" id="6172027">,</span>&nbsp;<span class="ident" id="6172029">err</span>&nbsp;<span class="op" id="6172033">:=</span>&nbsp;<span class="ident" id="6172036">Dial</span><span class="op" id="6172040">(</span><span class="ident" id="6172041">addr</span><span class="op" id="6172045">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172048">if</span>&nbsp;<span class="ident" id="6172051">err</span>&nbsp;<span class="op" id="6172055">!=</span>&nbsp;<span class="ident" id="6172058">nil</span>&nbsp;<span class="op" id="6172062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172066">return</span>&nbsp;<span class="ident" id="6172073">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172081">defer</span>&nbsp;<span class="ident" id="6172087">c</span><span class="op" id="6172088">.</span><span class="ident" id="6172089">Close</span><span class="op" id="6172094">(</span><span class="op" id="6172095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172098">if</span>&nbsp;<span class="ident" id="6172101">err</span>&nbsp;<span class="op" id="6172105">=</span>&nbsp;<span class="ident" id="6172107">c</span><span class="op" id="6172108">.</span><span class="ident" id="6172109">hello</span><span class="op" id="6172114">(</span><span class="op" id="6172115">)</span><span class="op" id="6172116">;</span>&nbsp;<span class="ident" id="6172118">err</span>&nbsp;<span class="op" id="6172122">!=</span>&nbsp;<span class="ident" id="6172125">nil</span>&nbsp;<span class="op" id="6172129">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172133">return</span>&nbsp;<span class="ident" id="6172140">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172148">if</span>&nbsp;<span class="ident" id="6172151">ok</span><span class="op" id="6172153">,</span>&nbsp;<span class="ident" id="6172155">_</span>&nbsp;<span class="op" id="6172157">:=</span>&nbsp;<span class="ident" id="6172160">c</span><span class="op" id="6172161">.</span><span class="ident" id="6172162">Extension</span><span class="op" id="6172171">(</span><span class="string" id="6172172">&#34;STARTTLS&#34;</span><span class="op" id="6172182">)</span><span class="op" id="6172183">;</span>&nbsp;<span class="ident" id="6172185">ok</span>&nbsp;<span class="op" id="6172188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172192">config</span>&nbsp;<span class="op" id="6172199">:=</span>&nbsp;<span class="op" id="6172202">&amp;</span><span class="ident" id="6172203">tls</span><span class="op" id="6172206">.</span><span class="ident" id="6172207">Config</span><span class="op" id="6172213">{</span><span class="ident" id="6172214">ServerName</span><span class="op" id="6172224">:</span>&nbsp;<span class="ident" id="6172226">c</span><span class="op" id="6172227">.</span><span class="ident" id="6172228">serverName</span><span class="op" id="6172238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172242">if</span>&nbsp;<span class="ident" id="6172245">testHookStartTLS</span>&nbsp;<span class="op" id="6172262">!=</span>&nbsp;<span class="ident" id="6172265">nil</span>&nbsp;<span class="op" id="6172269">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172274">testHookStartTLS</span><span class="op" id="6172290">(</span><span class="ident" id="6172291">config</span><span class="op" id="6172297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172305">if</span>&nbsp;<span class="ident" id="6172308">err</span>&nbsp;<span class="op" id="6172312">=</span>&nbsp;<span class="ident" id="6172314">c</span><span class="op" id="6172315">.</span><span class="ident" id="6172316">StartTLS</span><span class="op" id="6172324">(</span><span class="ident" id="6172325">config</span><span class="op" id="6172331">)</span><span class="op" id="6172332">;</span>&nbsp;<span class="ident" id="6172334">err</span>&nbsp;<span class="op" id="6172338">!=</span>&nbsp;<span class="ident" id="6172341">nil</span>&nbsp;<span class="op" id="6172345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172350">return</span>&nbsp;<span class="ident" id="6172357">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172363">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172369">if</span>&nbsp;<span class="ident" id="6172372">a</span>&nbsp;<span class="op" id="6172374">!=</span>&nbsp;<span class="ident" id="6172377">nil</span>&nbsp;<span class="op" id="6172381">&amp;&amp;</span>&nbsp;<span class="ident" id="6172384">c</span><span class="op" id="6172385">.</span><span class="ident" id="6172386">ext</span>&nbsp;<span class="op" id="6172390">!=</span>&nbsp;<span class="ident" id="6172393">nil</span>&nbsp;<span class="op" id="6172397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172401">if</span>&nbsp;<span class="ident" id="6172404">_</span><span class="op" id="6172405">,</span>&nbsp;<span class="ident" id="6172407">ok</span>&nbsp;<span class="op" id="6172410">:=</span>&nbsp;<span class="ident" id="6172413">c</span><span class="op" id="6172414">.</span><span class="ident" id="6172415">ext</span><span class="op" id="6172418">[</span><span class="string" id="6172419">&#34;AUTH&#34;</span><span class="op" id="6172425">]</span><span class="op" id="6172426">;</span>&nbsp;<span class="ident" id="6172428">ok</span>&nbsp;<span class="op" id="6172431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172436">if</span>&nbsp;<span class="ident" id="6172439">err</span>&nbsp;<span class="op" id="6172443">=</span>&nbsp;<span class="ident" id="6172445">c</span><span class="op" id="6172446">.</span><span class="ident" id="6172447">Auth</span><span class="op" id="6172451">(</span><span class="ident" id="6172452">a</span><span class="op" id="6172453">)</span><span class="op" id="6172454">;</span>&nbsp;<span class="ident" id="6172456">err</span>&nbsp;<span class="op" id="6172460">!=</span>&nbsp;<span class="ident" id="6172463">nil</span>&nbsp;<span class="op" id="6172467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172473">return</span>&nbsp;<span class="ident" id="6172480">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172497">if</span>&nbsp;<span class="ident" id="6172500">err</span>&nbsp;<span class="op" id="6172504">=</span>&nbsp;<span class="ident" id="6172506">c</span><span class="op" id="6172507">.</span><span class="ident" id="6172508">Mail</span><span class="op" id="6172512">(</span><span class="ident" id="6172513">from</span><span class="op" id="6172517">)</span><span class="op" id="6172518">;</span>&nbsp;<span class="ident" id="6172520">err</span>&nbsp;<span class="op" id="6172524">!=</span>&nbsp;<span class="ident" id="6172527">nil</span>&nbsp;<span class="op" id="6172531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172535">return</span>&nbsp;<span class="ident" id="6172542">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172550">for</span>&nbsp;<span class="ident" id="6172554">_</span><span class="op" id="6172555">,</span>&nbsp;<span class="ident" id="6172557">addr</span>&nbsp;<span class="op" id="6172562">:=</span>&nbsp;<span class="keyword" id="6172565">range</span>&nbsp;<span class="ident" id="6172571">to</span>&nbsp;<span class="op" id="6172574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172578">if</span>&nbsp;<span class="ident" id="6172581">err</span>&nbsp;<span class="op" id="6172585">=</span>&nbsp;<span class="ident" id="6172587">c</span><span class="op" id="6172588">.</span><span class="ident" id="6172589">Rcpt</span><span class="op" id="6172593">(</span><span class="ident" id="6172594">addr</span><span class="op" id="6172598">)</span><span class="op" id="6172599">;</span>&nbsp;<span class="ident" id="6172601">err</span>&nbsp;<span class="op" id="6172605">!=</span>&nbsp;<span class="ident" id="6172608">nil</span>&nbsp;<span class="op" id="6172612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172617">return</span>&nbsp;<span class="ident" id="6172624">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172630">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172636">w</span><span class="op" id="6172637">,</span>&nbsp;<span class="ident" id="6172639">err</span>&nbsp;<span class="op" id="6172643">:=</span>&nbsp;<span class="ident" id="6172646">c</span><span class="op" id="6172647">.</span><span class="ident" id="6172648">Data</span><span class="op" id="6172652">(</span><span class="op" id="6172653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172656">if</span>&nbsp;<span class="ident" id="6172659">err</span>&nbsp;<span class="op" id="6172663">!=</span>&nbsp;<span class="ident" id="6172666">nil</span>&nbsp;<span class="op" id="6172670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172674">return</span>&nbsp;<span class="ident" id="6172681">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172686">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172689">_</span><span class="op" id="6172690">,</span>&nbsp;<span class="ident" id="6172692">err</span>&nbsp;<span class="op" id="6172696">=</span>&nbsp;<span class="ident" id="6172698">w</span><span class="op" id="6172699">.</span><span class="ident" id="6172700">Write</span><span class="op" id="6172705">(</span><span class="ident" id="6172706">msg</span><span class="op" id="6172709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172712">if</span>&nbsp;<span class="ident" id="6172715">err</span>&nbsp;<span class="op" id="6172719">!=</span>&nbsp;<span class="ident" id="6172722">nil</span>&nbsp;<span class="op" id="6172726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172730">return</span>&nbsp;<span class="ident" id="6172737">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172745">err</span>&nbsp;<span class="op" id="6172749">=</span>&nbsp;<span class="ident" id="6172751">w</span><span class="op" id="6172752">.</span><span class="ident" id="6172753">Close</span><span class="op" id="6172758">(</span><span class="op" id="6172759">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172762">if</span>&nbsp;<span class="ident" id="6172765">err</span>&nbsp;<span class="op" id="6172769">!=</span>&nbsp;<span class="ident" id="6172772">nil</span>&nbsp;<span class="op" id="6172776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172780">return</span>&nbsp;<span class="ident" id="6172787">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172795">return</span>&nbsp;<span class="ident" id="6172802">c</span><span class="op" id="6172803">.</span><span class="ident" id="6172804">Quit</span><span class="op" id="6172808">(</span><span class="op" id="6172809">)</span><br>
<span class="lineno"></span><span class="op" id="6172811">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="6172814">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6172882">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="6172956">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6173024">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="6173063">func</span>&nbsp;<span class="op" id="6173068">(</span><span class="ident" id="6173069">c</span>&nbsp;<span class="op" id="6173071">*</span><span class="ident" id="6173072">Client</span><span class="op" id="6173078">)</span>&nbsp;<span class="ident" id="6173080">Extension</span><span class="op" id="6173089">(</span><span class="ident" id="6173090">ext</span>&nbsp;<span class="builtintype" id="6173094">string</span><span class="op" id="6173100">)</span>&nbsp;<span class="op" id="6173102">(</span><span class="builtintype" id="6173103">bool</span><span class="op" id="6173107">,</span>&nbsp;<span class="builtintype" id="6173109">string</span><span class="op" id="6173115">)</span>&nbsp;<span class="op" id="6173117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173120">if</span>&nbsp;<span class="ident" id="6173123">err</span>&nbsp;<span class="op" id="6173127">:=</span>&nbsp;<span class="ident" id="6173130">c</span><span class="op" id="6173131">.</span><span class="ident" id="6173132">hello</span><span class="op" id="6173137">(</span><span class="op" id="6173138">)</span><span class="op" id="6173139">;</span>&nbsp;<span class="ident" id="6173141">err</span>&nbsp;<span class="op" id="6173145">!=</span>&nbsp;<span class="ident" id="6173148">nil</span>&nbsp;<span class="op" id="6173152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173156">return</span>&nbsp;<span class="builtintype" id="6173163">false</span><span class="op" id="6173168">,</span>&nbsp;<span class="string" id="6173170">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6173174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173177">if</span>&nbsp;<span class="ident" id="6173180">c</span><span class="op" id="6173181">.</span><span class="ident" id="6173182">ext</span>&nbsp;<span class="op" id="6173186">==</span>&nbsp;<span class="ident" id="6173189">nil</span>&nbsp;<span class="op" id="6173193">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173197">return</span>&nbsp;<span class="builtintype" id="6173204">false</span><span class="op" id="6173209">,</span>&nbsp;<span class="string" id="6173211">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6173215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6173218">ext</span>&nbsp;<span class="op" id="6173222">=</span>&nbsp;<span class="ident" id="6173224">strings</span><span class="op" id="6173231">.</span><span class="ident" id="6173232">ToUpper</span><span class="op" id="6173239">(</span><span class="ident" id="6173240">ext</span><span class="op" id="6173243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6173246">param</span><span class="op" id="6173251">,</span>&nbsp;<span class="ident" id="6173253">ok</span>&nbsp;<span class="op" id="6173256">:=</span>&nbsp;<span class="ident" id="6173259">c</span><span class="op" id="6173260">.</span><span class="ident" id="6173261">ext</span><span class="op" id="6173264">[</span><span class="ident" id="6173265">ext</span><span class="op" id="6173268">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173271">return</span>&nbsp;<span class="ident" id="6173278">ok</span><span class="op" id="6173280">,</span>&nbsp;<span class="ident" id="6173282">param</span><br>
<span class="lineno">335</span><span class="op" id="6173288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6173291">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="6173364">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="6173380">func</span>&nbsp;<span class="op" id="6173385">(</span><span class="ident" id="6173386">c</span>&nbsp;<span class="op" id="6173388">*</span><span class="ident" id="6173389">Client</span><span class="op" id="6173395">)</span>&nbsp;<span class="ident" id="6173397">Reset</span><span class="op" id="6173402">(</span><span class="op" id="6173403">)</span>&nbsp;<span class="builtintype" id="6173405">error</span>&nbsp;<span class="op" id="6173411">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173414">if</span>&nbsp;<span class="ident" id="6173417">err</span>&nbsp;<span class="op" id="6173421">:=</span>&nbsp;<span class="ident" id="6173424">c</span><span class="op" id="6173425">.</span><span class="ident" id="6173426">hello</span><span class="op" id="6173431">(</span><span class="op" id="6173432">)</span><span class="op" id="6173433">;</span>&nbsp;<span class="ident" id="6173435">err</span>&nbsp;<span class="op" id="6173439">!=</span>&nbsp;<span class="ident" id="6173442">nil</span>&nbsp;<span class="op" id="6173446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173450">return</span>&nbsp;<span class="ident" id="6173457">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6173462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6173465">_</span><span class="op" id="6173466">,</span>&nbsp;<span class="ident" id="6173468">_</span><span class="op" id="6173469">,</span>&nbsp;<span class="ident" id="6173471">err</span>&nbsp;<span class="op" id="6173475">:=</span>&nbsp;<span class="ident" id="6173478">c</span><span class="op" id="6173479">.</span><span class="ident" id="6173480">cmd</span><span class="op" id="6173483">(</span><span class="num" id="6173484">250</span><span class="op" id="6173487">,</span>&nbsp;<span class="string" id="6173489">&#34;RSET&#34;</span><span class="op" id="6173495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173498">return</span>&nbsp;<span class="ident" id="6173505">err</span><br>
<span class="lineno">345</span><span class="op" id="6173509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6173512">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6173584">func</span>&nbsp;<span class="op" id="6173589">(</span><span class="ident" id="6173590">c</span>&nbsp;<span class="op" id="6173592">*</span><span class="ident" id="6173593">Client</span><span class="op" id="6173599">)</span>&nbsp;<span class="ident" id="6173601">Quit</span><span class="op" id="6173605">(</span><span class="op" id="6173606">)</span>&nbsp;<span class="builtintype" id="6173608">error</span>&nbsp;<span class="op" id="6173614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173617">if</span>&nbsp;<span class="ident" id="6173620">err</span>&nbsp;<span class="op" id="6173624">:=</span>&nbsp;<span class="ident" id="6173627">c</span><span class="op" id="6173628">.</span><span class="ident" id="6173629">hello</span><span class="op" id="6173634">(</span><span class="op" id="6173635">)</span><span class="op" id="6173636">;</span>&nbsp;<span class="ident" id="6173638">err</span>&nbsp;<span class="op" id="6173642">!=</span>&nbsp;<span class="ident" id="6173645">nil</span>&nbsp;<span class="op" id="6173649">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173653">return</span>&nbsp;<span class="ident" id="6173660">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6173665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6173668">_</span><span class="op" id="6173669">,</span>&nbsp;<span class="ident" id="6173671">_</span><span class="op" id="6173672">,</span>&nbsp;<span class="ident" id="6173674">err</span>&nbsp;<span class="op" id="6173678">:=</span>&nbsp;<span class="ident" id="6173681">c</span><span class="op" id="6173682">.</span><span class="ident" id="6173683">cmd</span><span class="op" id="6173686">(</span><span class="num" id="6173687">221</span><span class="op" id="6173690">,</span>&nbsp;<span class="string" id="6173692">&#34;QUIT&#34;</span><span class="op" id="6173698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173701">if</span>&nbsp;<span class="ident" id="6173704">err</span>&nbsp;<span class="op" id="6173708">!=</span>&nbsp;<span class="ident" id="6173711">nil</span>&nbsp;<span class="op" id="6173715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173719">return</span>&nbsp;<span class="ident" id="6173726">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6173731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173734">return</span>&nbsp;<span class="ident" id="6173741">c</span><span class="op" id="6173742">.</span><span class="ident" id="6173743">Text</span><span class="op" id="6173747">.</span><span class="ident" id="6173748">Close</span><span class="op" id="6173753">(</span><span class="op" id="6173754">)</span><br>
<span class="lineno"></span><span class="op" id="6173756">}</span>
</div>
</body>
</html>
