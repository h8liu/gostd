<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html" class="current">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1971878">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1971933">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1971987">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1972038">package</span>&nbsp;<span class="ident" id="1972046">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1972053">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1972097">import</span>&nbsp;<span class="op" id="1972104">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1972107">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1972117">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1972123">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1972138">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1972141">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="1972218">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="1972280">type</span>&nbsp;<span class="ident" id="1972285">Buffer</span>&nbsp;<span class="keyword" id="1972292">struct</span>&nbsp;<span class="op" id="1972299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1972302">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1972312">[</span><span class="op" id="1972313">]</span><span class="builtintype" id="1972314">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1972330">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1972377">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1972387">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1972405">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1972452">runeBytes</span>&nbsp;<span class="op" id="1972462">[</span><span class="ident" id="1972463">utf8</span><span class="op" id="1972467">.</span><span class="ident" id="1972468">UTFMax</span><span class="op" id="1972474">]</span><span class="builtintype" id="1972475">byte</span>&nbsp;<span class="comment" id="1972480">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1972536">bootstrap</span>&nbsp;<span class="op" id="1972546">[</span><span class="num" id="1972547">64</span><span class="op" id="1972549">]</span><span class="builtintype" id="1972550">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1972564">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1972643">lastRead</span>&nbsp;&nbsp;<span class="ident" id="1972653">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1972671">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="1972731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1972734">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1972796">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="1972849">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="1972877">type</span>&nbsp;<span class="ident" id="1972882">readOp</span>&nbsp;<span class="builtintype" id="1972889">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="1972894">const</span>&nbsp;<span class="op" id="1972900">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1972903">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="1972914">readOp</span>&nbsp;<span class="op" id="1972921">=</span>&nbsp;<span class="ident" id="1972923">iota</span>&nbsp;<span class="comment" id="1972928">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1972952">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1972977">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1972992">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1973017">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="1973046">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1973049">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1973140">var</span>&nbsp;<span class="ident" id="1973144">ErrTooLarge</span>&nbsp;<span class="op" id="1973156">=</span>&nbsp;<span class="ident" id="1973158">errors</span><span class="op" id="1973164">.</span><span class="ident" id="1973165">New</span><span class="op" id="1973168">(</span><span class="string" id="1973169">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="1973194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1973197">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="1973275">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1973348">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="1973421">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1973471">func</span>&nbsp;<span class="op" id="1973476">(</span><span class="ident" id="1973477">b</span>&nbsp;<span class="op" id="1973479">*</span><span class="ident" id="1973480">Buffer</span><span class="op" id="1973486">)</span>&nbsp;<span class="ident" id="1973488">Bytes</span><span class="op" id="1973493">(</span><span class="op" id="1973494">)</span>&nbsp;<span class="op" id="1973496">[</span><span class="op" id="1973497">]</span><span class="builtintype" id="1973498">byte</span>&nbsp;<span class="op" id="1973503">{</span>&nbsp;<span class="keyword" id="1973505">return</span>&nbsp;<span class="ident" id="1973512">b</span><span class="op" id="1973513">.</span><span class="ident" id="1973514">buf</span><span class="op" id="1973517">[</span><span class="ident" id="1973518">b</span><span class="op" id="1973519">.</span><span class="ident" id="1973520">off</span><span class="op" id="1973523">:</span><span class="op" id="1973524">]</span>&nbsp;<span class="op" id="1973526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="1973529">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1973596">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="1973665">func</span>&nbsp;<span class="op" id="1973670">(</span><span class="ident" id="1973671">b</span>&nbsp;<span class="op" id="1973673">*</span><span class="ident" id="1973674">Buffer</span><span class="op" id="1973680">)</span>&nbsp;<span class="ident" id="1973682">String</span><span class="op" id="1973688">(</span><span class="op" id="1973689">)</span>&nbsp;<span class="builtintype" id="1973691">string</span>&nbsp;<span class="op" id="1973698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1973701">if</span>&nbsp;<span class="ident" id="1973704">b</span>&nbsp;<span class="op" id="1973706">==</span>&nbsp;<span class="builtintype" id="1973709">nil</span>&nbsp;<span class="op" id="1973713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1973717">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1973757">return</span>&nbsp;<span class="string" id="1973764">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1973773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1973776">return</span>&nbsp;<span class="builtintype" id="1973783">string</span><span class="op" id="1973789">(</span><span class="ident" id="1973790">b</span><span class="op" id="1973791">.</span><span class="ident" id="1973792">buf</span><span class="op" id="1973795">[</span><span class="ident" id="1973796">b</span><span class="op" id="1973797">.</span><span class="ident" id="1973798">off</span><span class="op" id="1973801">:</span><span class="op" id="1973802">]</span><span class="op" id="1973803">)</span><br>
<span class="lineno"></span><span class="op" id="1973805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1973808">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="1973880">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="1973910">func</span>&nbsp;<span class="op" id="1973915">(</span><span class="ident" id="1973916">b</span>&nbsp;<span class="op" id="1973918">*</span><span class="ident" id="1973919">Buffer</span><span class="op" id="1973925">)</span>&nbsp;<span class="ident" id="1973927">Len</span><span class="op" id="1973930">(</span><span class="op" id="1973931">)</span>&nbsp;<span class="builtintype" id="1973933">int</span>&nbsp;<span class="op" id="1973937">{</span>&nbsp;<span class="keyword" id="1973939">return</span>&nbsp;<span class="builtinfunc" id="1973946">len</span><span class="op" id="1973949">(</span><span class="ident" id="1973950">b</span><span class="op" id="1973951">.</span><span class="ident" id="1973952">buf</span><span class="op" id="1973955">)</span>&nbsp;<span class="op" id="1973957">-</span>&nbsp;<span class="ident" id="1973959">b</span><span class="op" id="1973960">.</span><span class="ident" id="1973961">off</span>&nbsp;<span class="op" id="1973965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1973968">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="1974039">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1974111">func</span>&nbsp;<span class="op" id="1974116">(</span><span class="ident" id="1974117">b</span>&nbsp;<span class="op" id="1974119">*</span><span class="ident" id="1974120">Buffer</span><span class="op" id="1974126">)</span>&nbsp;<span class="ident" id="1974128">Truncate</span><span class="op" id="1974136">(</span><span class="ident" id="1974137">n</span>&nbsp;<span class="builtintype" id="1974139">int</span><span class="op" id="1974142">)</span>&nbsp;<span class="op" id="1974144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1974147">b</span><span class="op" id="1974148">.</span><span class="ident" id="1974149">lastRead</span>&nbsp;<span class="op" id="1974158">=</span>&nbsp;<span class="ident" id="1974160">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1974171">switch</span>&nbsp;<span class="op" id="1974178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1974181">case</span>&nbsp;<span class="ident" id="1974186">n</span>&nbsp;<span class="op" id="1974188">&lt;</span>&nbsp;<span class="num" id="1974190">0</span>&nbsp;<span class="op" id="1974192">||</span>&nbsp;<span class="ident" id="1974195">n</span>&nbsp;<span class="op" id="1974197">&gt;</span>&nbsp;<span class="ident" id="1974199">b</span><span class="op" id="1974200">.</span><span class="ident" id="1974201">Len</span><span class="op" id="1974204">(</span><span class="op" id="1974205">)</span><span class="op" id="1974206">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1974210">panic</span><span class="op" id="1974215">(</span><span class="string" id="1974216">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1974255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1974258">case</span>&nbsp;<span class="ident" id="1974263">n</span>&nbsp;<span class="op" id="1974265">==</span>&nbsp;<span class="num" id="1974268">0</span><span class="op" id="1974269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1974273">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1974298">b</span><span class="op" id="1974299">.</span><span class="ident" id="1974300">off</span>&nbsp;<span class="op" id="1974304">=</span>&nbsp;<span class="num" id="1974306">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1974309">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1974312">b</span><span class="op" id="1974313">.</span><span class="ident" id="1974314">buf</span>&nbsp;<span class="op" id="1974318">=</span>&nbsp;<span class="ident" id="1974320">b</span><span class="op" id="1974321">.</span><span class="ident" id="1974322">buf</span><span class="op" id="1974325">[</span><span class="num" id="1974326">0</span>&nbsp;<span class="op" id="1974328">:</span>&nbsp;<span class="ident" id="1974330">b</span><span class="op" id="1974331">.</span><span class="ident" id="1974332">off</span><span class="op" id="1974335">+</span><span class="ident" id="1974336">n</span><span class="op" id="1974337">]</span><br>
<span class="lineno"></span><span class="op" id="1974339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1974342">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="1974391">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="1974434">func</span>&nbsp;<span class="op" id="1974439">(</span><span class="ident" id="1974440">b</span>&nbsp;<span class="op" id="1974442">*</span><span class="ident" id="1974443">Buffer</span><span class="op" id="1974449">)</span>&nbsp;<span class="ident" id="1974451">Reset</span><span class="op" id="1974456">(</span><span class="op" id="1974457">)</span>&nbsp;<span class="op" id="1974459">{</span>&nbsp;<span class="ident" id="1974461">b</span><span class="op" id="1974462">.</span><span class="ident" id="1974463">Truncate</span><span class="op" id="1974471">(</span><span class="num" id="1974472">0</span><span class="op" id="1974473">)</span>&nbsp;<span class="op" id="1974475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1974478">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1974540">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="1974595">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="1974655">func</span>&nbsp;<span class="op" id="1974660">(</span><span class="ident" id="1974661">b</span>&nbsp;<span class="op" id="1974663">*</span><span class="ident" id="1974664">Buffer</span><span class="op" id="1974670">)</span>&nbsp;<span class="ident" id="1974672">grow</span><span class="op" id="1974676">(</span><span class="ident" id="1974677">n</span>&nbsp;<span class="builtintype" id="1974679">int</span><span class="op" id="1974682">)</span>&nbsp;<span class="builtintype" id="1974684">int</span>&nbsp;<span class="op" id="1974688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1974691">m</span>&nbsp;<span class="op" id="1974693">:=</span>&nbsp;<span class="ident" id="1974696">b</span><span class="op" id="1974697">.</span><span class="ident" id="1974698">Len</span><span class="op" id="1974701">(</span><span class="op" id="1974702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1974705">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1974753">if</span>&nbsp;<span class="ident" id="1974756">m</span>&nbsp;<span class="op" id="1974758">==</span>&nbsp;<span class="num" id="1974761">0</span>&nbsp;<span class="op" id="1974763">&amp;&amp;</span>&nbsp;<span class="ident" id="1974766">b</span><span class="op" id="1974767">.</span><span class="ident" id="1974768">off</span>&nbsp;<span class="op" id="1974772">!=</span>&nbsp;<span class="num" id="1974775">0</span>&nbsp;<span class="op" id="1974777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1974781">b</span><span class="op" id="1974782">.</span><span class="ident" id="1974783">Truncate</span><span class="op" id="1974791">(</span><span class="num" id="1974792">0</span><span class="op" id="1974793">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1974796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1974799">if</span>&nbsp;<span class="builtinfunc" id="1974802">len</span><span class="op" id="1974805">(</span><span class="ident" id="1974806">b</span><span class="op" id="1974807">.</span><span class="ident" id="1974808">buf</span><span class="op" id="1974811">)</span><span class="op" id="1974812">+</span><span class="ident" id="1974813">n</span>&nbsp;<span class="op" id="1974815">&gt;</span>&nbsp;<span class="builtinfunc" id="1974817">cap</span><span class="op" id="1974820">(</span><span class="ident" id="1974821">b</span><span class="op" id="1974822">.</span><span class="ident" id="1974823">buf</span><span class="op" id="1974826">)</span>&nbsp;<span class="op" id="1974828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1974832">var</span>&nbsp;<span class="ident" id="1974836">buf</span>&nbsp;<span class="op" id="1974840">[</span><span class="op" id="1974841">]</span><span class="builtintype" id="1974842">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1974849">if</span>&nbsp;<span class="ident" id="1974852">b</span><span class="op" id="1974853">.</span><span class="ident" id="1974854">buf</span>&nbsp;<span class="op" id="1974858">==</span>&nbsp;<span class="builtintype" id="1974861">nil</span>&nbsp;<span class="op" id="1974865">&amp;&amp;</span>&nbsp;<span class="ident" id="1974868">n</span>&nbsp;<span class="op" id="1974870">&lt;=</span>&nbsp;<span class="builtinfunc" id="1974873">len</span><span class="op" id="1974876">(</span><span class="ident" id="1974877">b</span><span class="op" id="1974878">.</span><span class="ident" id="1974879">bootstrap</span><span class="op" id="1974888">)</span>&nbsp;<span class="op" id="1974890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1974895">buf</span>&nbsp;<span class="op" id="1974899">=</span>&nbsp;<span class="ident" id="1974901">b</span><span class="op" id="1974902">.</span><span class="ident" id="1974903">bootstrap</span><span class="op" id="1974912">[</span><span class="num" id="1974913">0</span><span class="op" id="1974914">:</span><span class="op" id="1974915">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1974919">}</span>&nbsp;<span class="keyword" id="1974921">else</span>&nbsp;<span class="keyword" id="1974926">if</span>&nbsp;<span class="ident" id="1974929">m</span><span class="op" id="1974930">+</span><span class="ident" id="1974931">n</span>&nbsp;<span class="op" id="1974933">&lt;=</span>&nbsp;<span class="builtinfunc" id="1974936">cap</span><span class="op" id="1974939">(</span><span class="ident" id="1974940">b</span><span class="op" id="1974941">.</span><span class="ident" id="1974942">buf</span><span class="op" id="1974945">)</span><span class="op" id="1974946">/</span><span class="num" id="1974947">2</span>&nbsp;<span class="op" id="1974949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1974954">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1975013">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1975071">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1975126">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1975166">copy</span><span class="op" id="1975170">(</span><span class="ident" id="1975171">b</span><span class="op" id="1975172">.</span><span class="ident" id="1975173">buf</span><span class="op" id="1975176">[</span><span class="op" id="1975177">:</span><span class="op" id="1975178">]</span><span class="op" id="1975179">,</span>&nbsp;<span class="ident" id="1975181">b</span><span class="op" id="1975182">.</span><span class="ident" id="1975183">buf</span><span class="op" id="1975186">[</span><span class="ident" id="1975187">b</span><span class="op" id="1975188">.</span><span class="ident" id="1975189">off</span><span class="op" id="1975192">:</span><span class="op" id="1975193">]</span><span class="op" id="1975194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1975199">buf</span>&nbsp;<span class="op" id="1975203">=</span>&nbsp;<span class="ident" id="1975205">b</span><span class="op" id="1975206">.</span><span class="ident" id="1975207">buf</span><span class="op" id="1975210">[</span><span class="op" id="1975211">:</span><span class="ident" id="1975212">m</span><span class="op" id="1975213">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1975217">}</span>&nbsp;<span class="keyword" id="1975219">else</span>&nbsp;<span class="op" id="1975224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1975229">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1975261">buf</span>&nbsp;<span class="op" id="1975265">=</span>&nbsp;<span class="ident" id="1975267">makeSlice</span><span class="op" id="1975276">(</span><span class="num" id="1975277">2</span><span class="op" id="1975278">*</span><span class="builtinfunc" id="1975279">cap</span><span class="op" id="1975282">(</span><span class="ident" id="1975283">b</span><span class="op" id="1975284">.</span><span class="ident" id="1975285">buf</span><span class="op" id="1975288">)</span>&nbsp;<span class="op" id="1975290">+</span>&nbsp;<span class="ident" id="1975292">n</span><span class="op" id="1975293">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1975298">copy</span><span class="op" id="1975302">(</span><span class="ident" id="1975303">buf</span><span class="op" id="1975306">,</span>&nbsp;<span class="ident" id="1975308">b</span><span class="op" id="1975309">.</span><span class="ident" id="1975310">buf</span><span class="op" id="1975313">[</span><span class="ident" id="1975314">b</span><span class="op" id="1975315">.</span><span class="ident" id="1975316">off</span><span class="op" id="1975319">:</span><span class="op" id="1975320">]</span><span class="op" id="1975321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1975325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1975329">b</span><span class="op" id="1975330">.</span><span class="ident" id="1975331">buf</span>&nbsp;<span class="op" id="1975335">=</span>&nbsp;<span class="ident" id="1975337">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1975343">b</span><span class="op" id="1975344">.</span><span class="ident" id="1975345">off</span>&nbsp;<span class="op" id="1975349">=</span>&nbsp;<span class="num" id="1975351">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1975354">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1975357">b</span><span class="op" id="1975358">.</span><span class="ident" id="1975359">buf</span>&nbsp;<span class="op" id="1975363">=</span>&nbsp;<span class="ident" id="1975365">b</span><span class="op" id="1975366">.</span><span class="ident" id="1975367">buf</span><span class="op" id="1975370">[</span><span class="num" id="1975371">0</span>&nbsp;<span class="op" id="1975373">:</span>&nbsp;<span class="ident" id="1975375">b</span><span class="op" id="1975376">.</span><span class="ident" id="1975377">off</span><span class="op" id="1975380">+</span><span class="ident" id="1975381">m</span><span class="op" id="1975382">+</span><span class="ident" id="1975383">n</span><span class="op" id="1975384">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1975387">return</span>&nbsp;<span class="ident" id="1975394">b</span><span class="op" id="1975395">.</span><span class="ident" id="1975396">off</span>&nbsp;<span class="op" id="1975400">+</span>&nbsp;<span class="ident" id="1975402">m</span><br>
<span class="lineno"></span><span class="op" id="1975404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1975407">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="1975481">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1975555">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="1975593">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="1975631">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1975691">func</span>&nbsp;<span class="op" id="1975696">(</span><span class="ident" id="1975697">b</span>&nbsp;<span class="op" id="1975699">*</span><span class="ident" id="1975700">Buffer</span><span class="op" id="1975706">)</span>&nbsp;<span class="ident" id="1975708">Grow</span><span class="op" id="1975712">(</span><span class="ident" id="1975713">n</span>&nbsp;<span class="builtintype" id="1975715">int</span><span class="op" id="1975718">)</span>&nbsp;<span class="op" id="1975720">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1975723">if</span>&nbsp;<span class="ident" id="1975726">n</span>&nbsp;<span class="op" id="1975728">&lt;</span>&nbsp;<span class="num" id="1975730">0</span>&nbsp;<span class="op" id="1975732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1975736">panic</span><span class="op" id="1975741">(</span><span class="string" id="1975742">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="1975777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1975780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1975783">m</span>&nbsp;<span class="op" id="1975785">:=</span>&nbsp;<span class="ident" id="1975788">b</span><span class="op" id="1975789">.</span><span class="ident" id="1975790">grow</span><span class="op" id="1975794">(</span><span class="ident" id="1975795">n</span><span class="op" id="1975796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1975799">b</span><span class="op" id="1975800">.</span><span class="ident" id="1975801">buf</span>&nbsp;<span class="op" id="1975805">=</span>&nbsp;<span class="ident" id="1975807">b</span><span class="op" id="1975808">.</span><span class="ident" id="1975809">buf</span><span class="op" id="1975812">[</span><span class="num" id="1975813">0</span><span class="op" id="1975814">:</span><span class="ident" id="1975815">m</span><span class="op" id="1975816">]</span><br>
<span class="lineno">120</span><span class="op" id="1975818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1975821">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1975893">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1975969">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="1976033">func</span>&nbsp;<span class="op" id="1976038">(</span><span class="ident" id="1976039">b</span>&nbsp;<span class="op" id="1976041">*</span><span class="ident" id="1976042">Buffer</span><span class="op" id="1976048">)</span>&nbsp;<span class="ident" id="1976050">Write</span><span class="op" id="1976055">(</span><span class="ident" id="1976056">p</span>&nbsp;<span class="op" id="1976058">[</span><span class="op" id="1976059">]</span><span class="builtintype" id="1976060">byte</span><span class="op" id="1976064">)</span>&nbsp;<span class="op" id="1976066">(</span><span class="ident" id="1976067">n</span>&nbsp;<span class="builtintype" id="1976069">int</span><span class="op" id="1976072">,</span>&nbsp;<span class="ident" id="1976074">err</span>&nbsp;<span class="builtintype" id="1976078">error</span><span class="op" id="1976083">)</span>&nbsp;<span class="op" id="1976085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1976088">b</span><span class="op" id="1976089">.</span><span class="ident" id="1976090">lastRead</span>&nbsp;<span class="op" id="1976099">=</span>&nbsp;<span class="ident" id="1976101">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1976112">m</span>&nbsp;<span class="op" id="1976114">:=</span>&nbsp;<span class="ident" id="1976117">b</span><span class="op" id="1976118">.</span><span class="ident" id="1976119">grow</span><span class="op" id="1976123">(</span><span class="builtinfunc" id="1976124">len</span><span class="op" id="1976127">(</span><span class="ident" id="1976128">p</span><span class="op" id="1976129">)</span><span class="op" id="1976130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1976133">return</span>&nbsp;<span class="builtinfunc" id="1976140">copy</span><span class="op" id="1976144">(</span><span class="ident" id="1976145">b</span><span class="op" id="1976146">.</span><span class="ident" id="1976147">buf</span><span class="op" id="1976150">[</span><span class="ident" id="1976151">m</span><span class="op" id="1976152">:</span><span class="op" id="1976153">]</span><span class="op" id="1976154">,</span>&nbsp;<span class="ident" id="1976156">p</span><span class="op" id="1976157">)</span><span class="op" id="1976158">,</span>&nbsp;<span class="builtintype" id="1976160">nil</span><br>
<span class="lineno"></span><span class="op" id="1976164">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1976167">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1976245">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1976321">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1976391">func</span>&nbsp;<span class="op" id="1976396">(</span><span class="ident" id="1976397">b</span>&nbsp;<span class="op" id="1976399">*</span><span class="ident" id="1976400">Buffer</span><span class="op" id="1976406">)</span>&nbsp;<span class="ident" id="1976408">WriteString</span><span class="op" id="1976419">(</span><span class="ident" id="1976420">s</span>&nbsp;<span class="builtintype" id="1976422">string</span><span class="op" id="1976428">)</span>&nbsp;<span class="op" id="1976430">(</span><span class="ident" id="1976431">n</span>&nbsp;<span class="builtintype" id="1976433">int</span><span class="op" id="1976436">,</span>&nbsp;<span class="ident" id="1976438">err</span>&nbsp;<span class="builtintype" id="1976442">error</span><span class="op" id="1976447">)</span>&nbsp;<span class="op" id="1976449">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1976452">b</span><span class="op" id="1976453">.</span><span class="ident" id="1976454">lastRead</span>&nbsp;<span class="op" id="1976463">=</span>&nbsp;<span class="ident" id="1976465">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1976476">m</span>&nbsp;<span class="op" id="1976478">:=</span>&nbsp;<span class="ident" id="1976481">b</span><span class="op" id="1976482">.</span><span class="ident" id="1976483">grow</span><span class="op" id="1976487">(</span><span class="builtinfunc" id="1976488">len</span><span class="op" id="1976491">(</span><span class="ident" id="1976492">s</span><span class="op" id="1976493">)</span><span class="op" id="1976494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1976497">return</span>&nbsp;<span class="builtinfunc" id="1976504">copy</span><span class="op" id="1976508">(</span><span class="ident" id="1976509">b</span><span class="op" id="1976510">.</span><span class="ident" id="1976511">buf</span><span class="op" id="1976514">[</span><span class="ident" id="1976515">m</span><span class="op" id="1976516">:</span><span class="op" id="1976517">]</span><span class="op" id="1976518">,</span>&nbsp;<span class="ident" id="1976520">s</span><span class="op" id="1976521">)</span><span class="op" id="1976522">,</span>&nbsp;<span class="builtintype" id="1976524">nil</span><br>
<span class="lineno"></span><span class="op" id="1976528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1976531">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1976593">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="1976670">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1976744">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1976766">const</span>&nbsp;<span class="ident" id="1976772">MinRead</span>&nbsp;<span class="op" id="1976780">=</span>&nbsp;<span class="num" id="1976782">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1976787">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="1976865">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="1976942">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1977018">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="1977085">func</span>&nbsp;<span class="op" id="1977090">(</span><span class="ident" id="1977091">b</span>&nbsp;<span class="op" id="1977093">*</span><span class="ident" id="1977094">Buffer</span><span class="op" id="1977100">)</span>&nbsp;<span class="ident" id="1977102">ReadFrom</span><span class="op" id="1977110">(</span><span class="ident" id="1977111">r</span>&nbsp;<span class="ident" id="1977113">io</span><span class="op" id="1977115">.</span><span class="ident" id="1977116">Reader</span><span class="op" id="1977122">)</span>&nbsp;<span class="op" id="1977124">(</span><span class="ident" id="1977125">n</span>&nbsp;<span class="ident" id="1977127">int64</span><span class="op" id="1977132">,</span>&nbsp;<span class="ident" id="1977134">err</span>&nbsp;<span class="builtintype" id="1977138">error</span><span class="op" id="1977143">)</span>&nbsp;<span class="op" id="1977145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1977148">b</span><span class="op" id="1977149">.</span><span class="ident" id="1977150">lastRead</span>&nbsp;<span class="op" id="1977159">=</span>&nbsp;<span class="ident" id="1977161">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1977172">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1977220">if</span>&nbsp;<span class="ident" id="1977223">b</span><span class="op" id="1977224">.</span><span class="ident" id="1977225">off</span>&nbsp;<span class="op" id="1977229">&gt;=</span>&nbsp;<span class="builtinfunc" id="1977232">len</span><span class="op" id="1977235">(</span><span class="ident" id="1977236">b</span><span class="op" id="1977237">.</span><span class="ident" id="1977238">buf</span><span class="op" id="1977241">)</span>&nbsp;<span class="op" id="1977243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1977247">b</span><span class="op" id="1977248">.</span><span class="ident" id="1977249">Truncate</span><span class="op" id="1977257">(</span><span class="num" id="1977258">0</span><span class="op" id="1977259">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1977262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1977265">for</span>&nbsp;<span class="op" id="1977269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1977273">if</span>&nbsp;<span class="ident" id="1977276">free</span>&nbsp;<span class="op" id="1977281">:=</span>&nbsp;<span class="builtinfunc" id="1977284">cap</span><span class="op" id="1977287">(</span><span class="ident" id="1977288">b</span><span class="op" id="1977289">.</span><span class="ident" id="1977290">buf</span><span class="op" id="1977293">)</span>&nbsp;<span class="op" id="1977295">-</span>&nbsp;<span class="builtinfunc" id="1977297">len</span><span class="op" id="1977300">(</span><span class="ident" id="1977301">b</span><span class="op" id="1977302">.</span><span class="ident" id="1977303">buf</span><span class="op" id="1977306">)</span><span class="op" id="1977307">;</span>&nbsp;<span class="ident" id="1977309">free</span>&nbsp;<span class="op" id="1977314">&lt;</span>&nbsp;<span class="ident" id="1977316">MinRead</span>&nbsp;<span class="op" id="1977324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1977329">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1977359">newBuf</span>&nbsp;<span class="op" id="1977366">:=</span>&nbsp;<span class="ident" id="1977369">b</span><span class="op" id="1977370">.</span><span class="ident" id="1977371">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1977378">if</span>&nbsp;<span class="ident" id="1977381">b</span><span class="op" id="1977382">.</span><span class="ident" id="1977383">off</span><span class="op" id="1977386">+</span><span class="ident" id="1977387">free</span>&nbsp;<span class="op" id="1977392">&lt;</span>&nbsp;<span class="ident" id="1977394">MinRead</span>&nbsp;<span class="op" id="1977402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1977408">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1977459">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1977489">newBuf</span>&nbsp;<span class="op" id="1977496">=</span>&nbsp;<span class="ident" id="1977498">makeSlice</span><span class="op" id="1977507">(</span><span class="num" id="1977508">2</span><span class="op" id="1977509">*</span><span class="builtinfunc" id="1977510">cap</span><span class="op" id="1977513">(</span><span class="ident" id="1977514">b</span><span class="op" id="1977515">.</span><span class="ident" id="1977516">buf</span><span class="op" id="1977519">)</span>&nbsp;<span class="op" id="1977521">+</span>&nbsp;<span class="ident" id="1977523">MinRead</span><span class="op" id="1977530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1977535">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1977540">copy</span><span class="op" id="1977544">(</span><span class="ident" id="1977545">newBuf</span><span class="op" id="1977551">,</span>&nbsp;<span class="ident" id="1977553">b</span><span class="op" id="1977554">.</span><span class="ident" id="1977555">buf</span><span class="op" id="1977558">[</span><span class="ident" id="1977559">b</span><span class="op" id="1977560">.</span><span class="ident" id="1977561">off</span><span class="op" id="1977564">:</span><span class="op" id="1977565">]</span><span class="op" id="1977566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1977571">b</span><span class="op" id="1977572">.</span><span class="ident" id="1977573">buf</span>&nbsp;<span class="op" id="1977577">=</span>&nbsp;<span class="ident" id="1977579">newBuf</span><span class="op" id="1977585">[</span><span class="op" id="1977586">:</span><span class="builtinfunc" id="1977587">len</span><span class="op" id="1977590">(</span><span class="ident" id="1977591">b</span><span class="op" id="1977592">.</span><span class="ident" id="1977593">buf</span><span class="op" id="1977596">)</span><span class="op" id="1977597">-</span><span class="ident" id="1977598">b</span><span class="op" id="1977599">.</span><span class="ident" id="1977600">off</span><span class="op" id="1977603">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1977608">b</span><span class="op" id="1977609">.</span><span class="ident" id="1977610">off</span>&nbsp;<span class="op" id="1977614">=</span>&nbsp;<span class="num" id="1977616">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1977620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1977624">m</span><span class="op" id="1977625">,</span>&nbsp;<span class="ident" id="1977627">e</span>&nbsp;<span class="op" id="1977629">:=</span>&nbsp;<span class="ident" id="1977632">r</span><span class="op" id="1977633">.</span><span class="ident" id="1977634">Read</span><span class="op" id="1977638">(</span><span class="ident" id="1977639">b</span><span class="op" id="1977640">.</span><span class="ident" id="1977641">buf</span><span class="op" id="1977644">[</span><span class="builtinfunc" id="1977645">len</span><span class="op" id="1977648">(</span><span class="ident" id="1977649">b</span><span class="op" id="1977650">.</span><span class="ident" id="1977651">buf</span><span class="op" id="1977654">)</span><span class="op" id="1977655">:</span><span class="builtinfunc" id="1977656">cap</span><span class="op" id="1977659">(</span><span class="ident" id="1977660">b</span><span class="op" id="1977661">.</span><span class="ident" id="1977662">buf</span><span class="op" id="1977665">)</span><span class="op" id="1977666">]</span><span class="op" id="1977667">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1977671">b</span><span class="op" id="1977672">.</span><span class="ident" id="1977673">buf</span>&nbsp;<span class="op" id="1977677">=</span>&nbsp;<span class="ident" id="1977679">b</span><span class="op" id="1977680">.</span><span class="ident" id="1977681">buf</span><span class="op" id="1977684">[</span><span class="num" id="1977685">0</span>&nbsp;<span class="op" id="1977687">:</span>&nbsp;<span class="builtinfunc" id="1977689">len</span><span class="op" id="1977692">(</span><span class="ident" id="1977693">b</span><span class="op" id="1977694">.</span><span class="ident" id="1977695">buf</span><span class="op" id="1977698">)</span><span class="op" id="1977699">+</span><span class="ident" id="1977700">m</span><span class="op" id="1977701">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1977705">n</span>&nbsp;<span class="op" id="1977707">+=</span>&nbsp;<span class="ident" id="1977710">int64</span><span class="op" id="1977715">(</span><span class="ident" id="1977716">m</span><span class="op" id="1977717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1977721">if</span>&nbsp;<span class="ident" id="1977724">e</span>&nbsp;<span class="op" id="1977726">==</span>&nbsp;<span class="ident" id="1977729">io</span><span class="op" id="1977731">.</span><span class="ident" id="1977732">EOF</span>&nbsp;<span class="op" id="1977736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1977741">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1977749">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1977753">if</span>&nbsp;<span class="ident" id="1977756">e</span>&nbsp;<span class="op" id="1977758">!=</span>&nbsp;<span class="builtintype" id="1977761">nil</span>&nbsp;<span class="op" id="1977765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1977770">return</span>&nbsp;<span class="ident" id="1977777">n</span><span class="op" id="1977778">,</span>&nbsp;<span class="ident" id="1977780">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1977784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1977787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1977790">return</span>&nbsp;<span class="ident" id="1977797">n</span><span class="op" id="1977798">,</span>&nbsp;<span class="builtintype" id="1977800">nil</span>&nbsp;<span class="comment" id="1977804">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="1977844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1977847">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="1977924">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1977945">func</span>&nbsp;<span class="ident" id="1977950">makeSlice</span><span class="op" id="1977959">(</span><span class="ident" id="1977960">n</span>&nbsp;<span class="builtintype" id="1977962">int</span><span class="op" id="1977965">)</span>&nbsp;<span class="op" id="1977967">[</span><span class="op" id="1977968">]</span><span class="builtintype" id="1977969">byte</span>&nbsp;<span class="op" id="1977974">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1977977">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1978020">defer</span>&nbsp;<span class="keyword" id="1978026">func</span><span class="op" id="1978030">(</span><span class="op" id="1978031">)</span>&nbsp;<span class="op" id="1978033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1978037">if</span>&nbsp;<span class="builtinfunc" id="1978040">recover</span><span class="op" id="1978047">(</span><span class="op" id="1978048">)</span>&nbsp;<span class="op" id="1978050">!=</span>&nbsp;<span class="builtintype" id="1978053">nil</span>&nbsp;<span class="op" id="1978057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1978062">panic</span><span class="op" id="1978067">(</span><span class="ident" id="1978068">ErrTooLarge</span><span class="op" id="1978079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1978083">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1978086">}</span><span class="op" id="1978087">(</span><span class="op" id="1978088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1978091">return</span>&nbsp;<span class="builtinfunc" id="1978098">make</span><span class="op" id="1978102">(</span><span class="op" id="1978103">[</span><span class="op" id="1978104">]</span><span class="builtintype" id="1978105">byte</span><span class="op" id="1978109">,</span>&nbsp;<span class="ident" id="1978111">n</span><span class="op" id="1978112">)</span><br>
<span class="lineno"></span><span class="op" id="1978114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1978117">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="1978193">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="1978270">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="1978340">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="1978390">func</span>&nbsp;<span class="op" id="1978395">(</span><span class="ident" id="1978396">b</span>&nbsp;<span class="op" id="1978398">*</span><span class="ident" id="1978399">Buffer</span><span class="op" id="1978405">)</span>&nbsp;<span class="ident" id="1978407">WriteTo</span><span class="op" id="1978414">(</span><span class="ident" id="1978415">w</span>&nbsp;<span class="ident" id="1978417">io</span><span class="op" id="1978419">.</span><span class="ident" id="1978420">Writer</span><span class="op" id="1978426">)</span>&nbsp;<span class="op" id="1978428">(</span><span class="ident" id="1978429">n</span>&nbsp;<span class="ident" id="1978431">int64</span><span class="op" id="1978436">,</span>&nbsp;<span class="ident" id="1978438">err</span>&nbsp;<span class="builtintype" id="1978442">error</span><span class="op" id="1978447">)</span>&nbsp;<span class="op" id="1978449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1978452">b</span><span class="op" id="1978453">.</span><span class="ident" id="1978454">lastRead</span>&nbsp;<span class="op" id="1978463">=</span>&nbsp;<span class="ident" id="1978465">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1978476">if</span>&nbsp;<span class="ident" id="1978479">b</span><span class="op" id="1978480">.</span><span class="ident" id="1978481">off</span>&nbsp;<span class="op" id="1978485">&lt;</span>&nbsp;<span class="builtinfunc" id="1978487">len</span><span class="op" id="1978490">(</span><span class="ident" id="1978491">b</span><span class="op" id="1978492">.</span><span class="ident" id="1978493">buf</span><span class="op" id="1978496">)</span>&nbsp;<span class="op" id="1978498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1978502">nBytes</span>&nbsp;<span class="op" id="1978509">:=</span>&nbsp;<span class="ident" id="1978512">b</span><span class="op" id="1978513">.</span><span class="ident" id="1978514">Len</span><span class="op" id="1978517">(</span><span class="op" id="1978518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1978522">m</span><span class="op" id="1978523">,</span>&nbsp;<span class="ident" id="1978525">e</span>&nbsp;<span class="op" id="1978527">:=</span>&nbsp;<span class="ident" id="1978530">w</span><span class="op" id="1978531">.</span><span class="ident" id="1978532">Write</span><span class="op" id="1978537">(</span><span class="ident" id="1978538">b</span><span class="op" id="1978539">.</span><span class="ident" id="1978540">buf</span><span class="op" id="1978543">[</span><span class="ident" id="1978544">b</span><span class="op" id="1978545">.</span><span class="ident" id="1978546">off</span><span class="op" id="1978549">:</span><span class="op" id="1978550">]</span><span class="op" id="1978551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1978555">if</span>&nbsp;<span class="ident" id="1978558">m</span>&nbsp;<span class="op" id="1978560">&gt;</span>&nbsp;<span class="ident" id="1978562">nBytes</span>&nbsp;<span class="op" id="1978569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1978574">panic</span><span class="op" id="1978579">(</span><span class="string" id="1978580">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="1978623">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1978627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1978631">b</span><span class="op" id="1978632">.</span><span class="ident" id="1978633">off</span>&nbsp;<span class="op" id="1978637">+=</span>&nbsp;<span class="ident" id="1978640">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1978644">n</span>&nbsp;<span class="op" id="1978646">=</span>&nbsp;<span class="ident" id="1978648">int64</span><span class="op" id="1978653">(</span><span class="ident" id="1978654">m</span><span class="op" id="1978655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1978659">if</span>&nbsp;<span class="ident" id="1978662">e</span>&nbsp;<span class="op" id="1978664">!=</span>&nbsp;<span class="builtintype" id="1978667">nil</span>&nbsp;<span class="op" id="1978671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1978676">return</span>&nbsp;<span class="ident" id="1978683">n</span><span class="op" id="1978684">,</span>&nbsp;<span class="ident" id="1978686">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1978690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1978694">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1978752">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1978783">if</span>&nbsp;<span class="ident" id="1978786">m</span>&nbsp;<span class="op" id="1978788">!=</span>&nbsp;<span class="ident" id="1978791">nBytes</span>&nbsp;<span class="op" id="1978798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1978803">return</span>&nbsp;<span class="ident" id="1978810">n</span><span class="op" id="1978811">,</span>&nbsp;<span class="ident" id="1978813">io</span><span class="op" id="1978815">.</span><span class="ident" id="1978816">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1978832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1978835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1978838">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1978870">b</span><span class="op" id="1978871">.</span><span class="ident" id="1978872">Truncate</span><span class="op" id="1978880">(</span><span class="num" id="1978881">0</span><span class="op" id="1978882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1978885">return</span><br>
<span class="lineno">220</span><span class="op" id="1978892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1978895">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="1978972">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1979049">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="1979122">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1979138">func</span>&nbsp;<span class="op" id="1979143">(</span><span class="ident" id="1979144">b</span>&nbsp;<span class="op" id="1979146">*</span><span class="ident" id="1979147">Buffer</span><span class="op" id="1979153">)</span>&nbsp;<span class="ident" id="1979155">WriteByte</span><span class="op" id="1979164">(</span><span class="ident" id="1979165">c</span>&nbsp;<span class="builtintype" id="1979167">byte</span><span class="op" id="1979171">)</span>&nbsp;<span class="builtintype" id="1979173">error</span>&nbsp;<span class="op" id="1979179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1979182">b</span><span class="op" id="1979183">.</span><span class="ident" id="1979184">lastRead</span>&nbsp;<span class="op" id="1979193">=</span>&nbsp;<span class="ident" id="1979195">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1979206">m</span>&nbsp;<span class="op" id="1979208">:=</span>&nbsp;<span class="ident" id="1979211">b</span><span class="op" id="1979212">.</span><span class="ident" id="1979213">grow</span><span class="op" id="1979217">(</span><span class="num" id="1979218">1</span><span class="op" id="1979219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1979222">b</span><span class="op" id="1979223">.</span><span class="ident" id="1979224">buf</span><span class="op" id="1979227">[</span><span class="ident" id="1979228">m</span><span class="op" id="1979229">]</span>&nbsp;<span class="op" id="1979231">=</span>&nbsp;<span class="ident" id="1979233">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1979236">return</span>&nbsp;<span class="builtintype" id="1979243">nil</span><br>
<span class="lineno"></span><span class="op" id="1979247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1979250">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1979321">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="1979394">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="1979472">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1979539">func</span>&nbsp;<span class="op" id="1979544">(</span><span class="ident" id="1979545">b</span>&nbsp;<span class="op" id="1979547">*</span><span class="ident" id="1979548">Buffer</span><span class="op" id="1979554">)</span>&nbsp;<span class="ident" id="1979556">WriteRune</span><span class="op" id="1979565">(</span><span class="ident" id="1979566">r</span>&nbsp;<span class="builtintype" id="1979568">rune</span><span class="op" id="1979572">)</span>&nbsp;<span class="op" id="1979574">(</span><span class="ident" id="1979575">n</span>&nbsp;<span class="builtintype" id="1979577">int</span><span class="op" id="1979580">,</span>&nbsp;<span class="ident" id="1979582">err</span>&nbsp;<span class="builtintype" id="1979586">error</span><span class="op" id="1979591">)</span>&nbsp;<span class="op" id="1979593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1979596">if</span>&nbsp;<span class="ident" id="1979599">r</span>&nbsp;<span class="op" id="1979601">&lt;</span>&nbsp;<span class="ident" id="1979603">utf8</span><span class="op" id="1979607">.</span><span class="ident" id="1979608">RuneSelf</span>&nbsp;<span class="op" id="1979617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1979621">b</span><span class="op" id="1979622">.</span><span class="ident" id="1979623">WriteByte</span><span class="op" id="1979632">(</span><span class="builtintype" id="1979633">byte</span><span class="op" id="1979637">(</span><span class="ident" id="1979638">r</span><span class="op" id="1979639">)</span><span class="op" id="1979640">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1979644">return</span>&nbsp;<span class="num" id="1979651">1</span><span class="op" id="1979652">,</span>&nbsp;<span class="builtintype" id="1979654">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1979659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1979662">n</span>&nbsp;<span class="op" id="1979664">=</span>&nbsp;<span class="ident" id="1979666">utf8</span><span class="op" id="1979670">.</span><span class="ident" id="1979671">EncodeRune</span><span class="op" id="1979681">(</span><span class="ident" id="1979682">b</span><span class="op" id="1979683">.</span><span class="ident" id="1979684">runeBytes</span><span class="op" id="1979693">[</span><span class="num" id="1979694">0</span><span class="op" id="1979695">:</span><span class="op" id="1979696">]</span><span class="op" id="1979697">,</span>&nbsp;<span class="ident" id="1979699">r</span><span class="op" id="1979700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1979703">b</span><span class="op" id="1979704">.</span><span class="ident" id="1979705">Write</span><span class="op" id="1979710">(</span><span class="ident" id="1979711">b</span><span class="op" id="1979712">.</span><span class="ident" id="1979713">runeBytes</span><span class="op" id="1979722">[</span><span class="num" id="1979723">0</span><span class="op" id="1979724">:</span><span class="ident" id="1979725">n</span><span class="op" id="1979726">]</span><span class="op" id="1979727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1979730">return</span>&nbsp;<span class="ident" id="1979737">n</span><span class="op" id="1979738">,</span>&nbsp;<span class="builtintype" id="1979740">nil</span><br>
<span class="lineno">245</span><span class="op" id="1979744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1979747">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1979819">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1979891">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="1979963">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="1979987">func</span>&nbsp;<span class="op" id="1979992">(</span><span class="ident" id="1979993">b</span>&nbsp;<span class="op" id="1979995">*</span><span class="ident" id="1979996">Buffer</span><span class="op" id="1980002">)</span>&nbsp;<span class="ident" id="1980004">Read</span><span class="op" id="1980008">(</span><span class="ident" id="1980009">p</span>&nbsp;<span class="op" id="1980011">[</span><span class="op" id="1980012">]</span><span class="builtintype" id="1980013">byte</span><span class="op" id="1980017">)</span>&nbsp;<span class="op" id="1980019">(</span><span class="ident" id="1980020">n</span>&nbsp;<span class="builtintype" id="1980022">int</span><span class="op" id="1980025">,</span>&nbsp;<span class="ident" id="1980027">err</span>&nbsp;<span class="builtintype" id="1980031">error</span><span class="op" id="1980036">)</span>&nbsp;<span class="op" id="1980038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980041">b</span><span class="op" id="1980042">.</span><span class="ident" id="1980043">lastRead</span>&nbsp;<span class="op" id="1980052">=</span>&nbsp;<span class="ident" id="1980054">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1980065">if</span>&nbsp;<span class="ident" id="1980068">b</span><span class="op" id="1980069">.</span><span class="ident" id="1980070">off</span>&nbsp;<span class="op" id="1980074">&gt;=</span>&nbsp;<span class="builtinfunc" id="1980077">len</span><span class="op" id="1980080">(</span><span class="ident" id="1980081">b</span><span class="op" id="1980082">.</span><span class="ident" id="1980083">buf</span><span class="op" id="1980086">)</span>&nbsp;<span class="op" id="1980088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1980092">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980138">b</span><span class="op" id="1980139">.</span><span class="ident" id="1980140">Truncate</span><span class="op" id="1980148">(</span><span class="num" id="1980149">0</span><span class="op" id="1980150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1980154">if</span>&nbsp;<span class="builtinfunc" id="1980157">len</span><span class="op" id="1980160">(</span><span class="ident" id="1980161">p</span><span class="op" id="1980162">)</span>&nbsp;<span class="op" id="1980164">==</span>&nbsp;<span class="num" id="1980167">0</span>&nbsp;<span class="op" id="1980169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1980174">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1980183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1980187">return</span>&nbsp;<span class="num" id="1980194">0</span><span class="op" id="1980195">,</span>&nbsp;<span class="ident" id="1980197">io</span><span class="op" id="1980199">.</span><span class="ident" id="1980200">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1980205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980208">n</span>&nbsp;<span class="op" id="1980210">=</span>&nbsp;<span class="builtinfunc" id="1980212">copy</span><span class="op" id="1980216">(</span><span class="ident" id="1980217">p</span><span class="op" id="1980218">,</span>&nbsp;<span class="ident" id="1980220">b</span><span class="op" id="1980221">.</span><span class="ident" id="1980222">buf</span><span class="op" id="1980225">[</span><span class="ident" id="1980226">b</span><span class="op" id="1980227">.</span><span class="ident" id="1980228">off</span><span class="op" id="1980231">:</span><span class="op" id="1980232">]</span><span class="op" id="1980233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980236">b</span><span class="op" id="1980237">.</span><span class="ident" id="1980238">off</span>&nbsp;<span class="op" id="1980242">+=</span>&nbsp;<span class="ident" id="1980245">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1980248">if</span>&nbsp;<span class="ident" id="1980251">n</span>&nbsp;<span class="op" id="1980253">&gt;</span>&nbsp;<span class="num" id="1980255">0</span>&nbsp;<span class="op" id="1980257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980261">b</span><span class="op" id="1980262">.</span><span class="ident" id="1980263">lastRead</span>&nbsp;<span class="op" id="1980272">=</span>&nbsp;<span class="ident" id="1980274">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1980282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1980285">return</span><br>
<span class="lineno"></span><span class="op" id="1980292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1980295">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="1980364">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="1980431">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1980513">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="1980587">func</span>&nbsp;<span class="op" id="1980592">(</span><span class="ident" id="1980593">b</span>&nbsp;<span class="op" id="1980595">*</span><span class="ident" id="1980596">Buffer</span><span class="op" id="1980602">)</span>&nbsp;<span class="ident" id="1980604">Next</span><span class="op" id="1980608">(</span><span class="ident" id="1980609">n</span>&nbsp;<span class="builtintype" id="1980611">int</span><span class="op" id="1980614">)</span>&nbsp;<span class="op" id="1980616">[</span><span class="op" id="1980617">]</span><span class="builtintype" id="1980618">byte</span>&nbsp;<span class="op" id="1980623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980626">b</span><span class="op" id="1980627">.</span><span class="ident" id="1980628">lastRead</span>&nbsp;<span class="op" id="1980637">=</span>&nbsp;<span class="ident" id="1980639">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980650">m</span>&nbsp;<span class="op" id="1980652">:=</span>&nbsp;<span class="ident" id="1980655">b</span><span class="op" id="1980656">.</span><span class="ident" id="1980657">Len</span><span class="op" id="1980660">(</span><span class="op" id="1980661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1980664">if</span>&nbsp;<span class="ident" id="1980667">n</span>&nbsp;<span class="op" id="1980669">&gt;</span>&nbsp;<span class="ident" id="1980671">m</span>&nbsp;<span class="op" id="1980673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980677">n</span>&nbsp;<span class="op" id="1980679">=</span>&nbsp;<span class="ident" id="1980681">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1980684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980687">data</span>&nbsp;<span class="op" id="1980692">:=</span>&nbsp;<span class="ident" id="1980695">b</span><span class="op" id="1980696">.</span><span class="ident" id="1980697">buf</span><span class="op" id="1980700">[</span><span class="ident" id="1980701">b</span><span class="op" id="1980702">.</span><span class="ident" id="1980703">off</span>&nbsp;<span class="op" id="1980707">:</span>&nbsp;<span class="ident" id="1980709">b</span><span class="op" id="1980710">.</span><span class="ident" id="1980711">off</span><span class="op" id="1980714">+</span><span class="ident" id="1980715">n</span><span class="op" id="1980716">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980719">b</span><span class="op" id="1980720">.</span><span class="ident" id="1980721">off</span>&nbsp;<span class="op" id="1980725">+=</span>&nbsp;<span class="ident" id="1980728">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1980731">if</span>&nbsp;<span class="ident" id="1980734">n</span>&nbsp;<span class="op" id="1980736">&gt;</span>&nbsp;<span class="num" id="1980738">0</span>&nbsp;<span class="op" id="1980740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980744">b</span><span class="op" id="1980745">.</span><span class="ident" id="1980746">lastRead</span>&nbsp;<span class="op" id="1980755">=</span>&nbsp;<span class="ident" id="1980757">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1980765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1980768">return</span>&nbsp;<span class="ident" id="1980775">data</span><br>
<span class="lineno">285</span><span class="op" id="1980780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1980783">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1980844">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1980897">func</span>&nbsp;<span class="op" id="1980902">(</span><span class="ident" id="1980903">b</span>&nbsp;<span class="op" id="1980905">*</span><span class="ident" id="1980906">Buffer</span><span class="op" id="1980912">)</span>&nbsp;<span class="ident" id="1980914">ReadByte</span><span class="op" id="1980922">(</span><span class="op" id="1980923">)</span>&nbsp;<span class="op" id="1980925">(</span><span class="ident" id="1980926">c</span>&nbsp;<span class="builtintype" id="1980928">byte</span><span class="op" id="1980932">,</span>&nbsp;<span class="ident" id="1980934">err</span>&nbsp;<span class="builtintype" id="1980938">error</span><span class="op" id="1980943">)</span>&nbsp;<span class="op" id="1980945">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1980948">b</span><span class="op" id="1980949">.</span><span class="ident" id="1980950">lastRead</span>&nbsp;<span class="op" id="1980959">=</span>&nbsp;<span class="ident" id="1980961">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1980972">if</span>&nbsp;<span class="ident" id="1980975">b</span><span class="op" id="1980976">.</span><span class="ident" id="1980977">off</span>&nbsp;<span class="op" id="1980981">&gt;=</span>&nbsp;<span class="builtinfunc" id="1980984">len</span><span class="op" id="1980987">(</span><span class="ident" id="1980988">b</span><span class="op" id="1980989">.</span><span class="ident" id="1980990">buf</span><span class="op" id="1980993">)</span>&nbsp;<span class="op" id="1980995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1980999">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1981045">b</span><span class="op" id="1981046">.</span><span class="ident" id="1981047">Truncate</span><span class="op" id="1981055">(</span><span class="num" id="1981056">0</span><span class="op" id="1981057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1981061">return</span>&nbsp;<span class="num" id="1981068">0</span><span class="op" id="1981069">,</span>&nbsp;<span class="ident" id="1981071">io</span><span class="op" id="1981073">.</span><span class="ident" id="1981074">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1981079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1981082">c</span>&nbsp;<span class="op" id="1981084">=</span>&nbsp;<span class="ident" id="1981086">b</span><span class="op" id="1981087">.</span><span class="ident" id="1981088">buf</span><span class="op" id="1981091">[</span><span class="ident" id="1981092">b</span><span class="op" id="1981093">.</span><span class="ident" id="1981094">off</span><span class="op" id="1981097">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1981100">b</span><span class="op" id="1981101">.</span><span class="ident" id="1981102">off</span><span class="op" id="1981105">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1981109">b</span><span class="op" id="1981110">.</span><span class="ident" id="1981111">lastRead</span>&nbsp;<span class="op" id="1981120">=</span>&nbsp;<span class="ident" id="1981122">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1981130">return</span>&nbsp;<span class="ident" id="1981137">c</span><span class="op" id="1981138">,</span>&nbsp;<span class="builtintype" id="1981140">nil</span><br>
<span class="lineno">300</span><span class="op" id="1981144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1981147">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="1981200">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1981239">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="1981299">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1981351">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="1981395">func</span>&nbsp;<span class="op" id="1981400">(</span><span class="ident" id="1981401">b</span>&nbsp;<span class="op" id="1981403">*</span><span class="ident" id="1981404">Buffer</span><span class="op" id="1981410">)</span>&nbsp;<span class="ident" id="1981412">ReadRune</span><span class="op" id="1981420">(</span><span class="op" id="1981421">)</span>&nbsp;<span class="op" id="1981423">(</span><span class="ident" id="1981424">r</span>&nbsp;<span class="builtintype" id="1981426">rune</span><span class="op" id="1981430">,</span>&nbsp;<span class="ident" id="1981432">size</span>&nbsp;<span class="builtintype" id="1981437">int</span><span class="op" id="1981440">,</span>&nbsp;<span class="ident" id="1981442">err</span>&nbsp;<span class="builtintype" id="1981446">error</span><span class="op" id="1981451">)</span>&nbsp;<span class="op" id="1981453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1981456">b</span><span class="op" id="1981457">.</span><span class="ident" id="1981458">lastRead</span>&nbsp;<span class="op" id="1981467">=</span>&nbsp;<span class="ident" id="1981469">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1981480">if</span>&nbsp;<span class="ident" id="1981483">b</span><span class="op" id="1981484">.</span><span class="ident" id="1981485">off</span>&nbsp;<span class="op" id="1981489">&gt;=</span>&nbsp;<span class="builtinfunc" id="1981492">len</span><span class="op" id="1981495">(</span><span class="ident" id="1981496">b</span><span class="op" id="1981497">.</span><span class="ident" id="1981498">buf</span><span class="op" id="1981501">)</span>&nbsp;<span class="op" id="1981503">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1981507">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1981553">b</span><span class="op" id="1981554">.</span><span class="ident" id="1981555">Truncate</span><span class="op" id="1981563">(</span><span class="num" id="1981564">0</span><span class="op" id="1981565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1981569">return</span>&nbsp;<span class="num" id="1981576">0</span><span class="op" id="1981577">,</span>&nbsp;<span class="num" id="1981579">0</span><span class="op" id="1981580">,</span>&nbsp;<span class="ident" id="1981582">io</span><span class="op" id="1981584">.</span><span class="ident" id="1981585">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1981590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1981593">b</span><span class="op" id="1981594">.</span><span class="ident" id="1981595">lastRead</span>&nbsp;<span class="op" id="1981604">=</span>&nbsp;<span class="ident" id="1981606">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1981618">c</span>&nbsp;<span class="op" id="1981620">:=</span>&nbsp;<span class="ident" id="1981623">b</span><span class="op" id="1981624">.</span><span class="ident" id="1981625">buf</span><span class="op" id="1981628">[</span><span class="ident" id="1981629">b</span><span class="op" id="1981630">.</span><span class="ident" id="1981631">off</span><span class="op" id="1981634">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1981637">if</span>&nbsp;<span class="ident" id="1981640">c</span>&nbsp;<span class="op" id="1981642">&lt;</span>&nbsp;<span class="ident" id="1981644">utf8</span><span class="op" id="1981648">.</span><span class="ident" id="1981649">RuneSelf</span>&nbsp;<span class="op" id="1981658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1981662">b</span><span class="op" id="1981663">.</span><span class="ident" id="1981664">off</span><span class="op" id="1981667">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1981672">return</span>&nbsp;<span class="builtintype" id="1981679">rune</span><span class="op" id="1981683">(</span><span class="ident" id="1981684">c</span><span class="op" id="1981685">)</span><span class="op" id="1981686">,</span>&nbsp;<span class="num" id="1981688">1</span><span class="op" id="1981689">,</span>&nbsp;<span class="builtintype" id="1981691">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1981696">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1981699">r</span><span class="op" id="1981700">,</span>&nbsp;<span class="ident" id="1981702">n</span>&nbsp;<span class="op" id="1981704">:=</span>&nbsp;<span class="ident" id="1981707">utf8</span><span class="op" id="1981711">.</span><span class="ident" id="1981712">DecodeRune</span><span class="op" id="1981722">(</span><span class="ident" id="1981723">b</span><span class="op" id="1981724">.</span><span class="ident" id="1981725">buf</span><span class="op" id="1981728">[</span><span class="ident" id="1981729">b</span><span class="op" id="1981730">.</span><span class="ident" id="1981731">off</span><span class="op" id="1981734">:</span><span class="op" id="1981735">]</span><span class="op" id="1981736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1981739">b</span><span class="op" id="1981740">.</span><span class="ident" id="1981741">off</span>&nbsp;<span class="op" id="1981745">+=</span>&nbsp;<span class="ident" id="1981748">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1981751">return</span>&nbsp;<span class="ident" id="1981758">r</span><span class="op" id="1981759">,</span>&nbsp;<span class="ident" id="1981761">n</span><span class="op" id="1981762">,</span>&nbsp;<span class="builtintype" id="1981764">nil</span><br>
<span class="lineno"></span><span class="op" id="1981768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="1981771">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="1981829">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="1981893">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="1981958">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="1982025">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="1982054">func</span>&nbsp;<span class="op" id="1982059">(</span><span class="ident" id="1982060">b</span>&nbsp;<span class="op" id="1982062">*</span><span class="ident" id="1982063">Buffer</span><span class="op" id="1982069">)</span>&nbsp;<span class="ident" id="1982071">UnreadRune</span><span class="op" id="1982081">(</span><span class="op" id="1982082">)</span>&nbsp;<span class="builtintype" id="1982084">error</span>&nbsp;<span class="op" id="1982090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1982093">if</span>&nbsp;<span class="ident" id="1982096">b</span><span class="op" id="1982097">.</span><span class="ident" id="1982098">lastRead</span>&nbsp;<span class="op" id="1982107">!=</span>&nbsp;<span class="ident" id="1982110">opReadRune</span>&nbsp;<span class="op" id="1982121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1982125">return</span>&nbsp;<span class="ident" id="1982132">errors</span><span class="op" id="1982138">.</span><span class="ident" id="1982139">New</span><span class="op" id="1982142">(</span><span class="string" id="1982143">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="1982206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1982209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1982212">b</span><span class="op" id="1982213">.</span><span class="ident" id="1982214">lastRead</span>&nbsp;<span class="op" id="1982223">=</span>&nbsp;<span class="ident" id="1982225">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1982236">if</span>&nbsp;<span class="ident" id="1982239">b</span><span class="op" id="1982240">.</span><span class="ident" id="1982241">off</span>&nbsp;<span class="op" id="1982245">&gt;</span>&nbsp;<span class="num" id="1982247">0</span>&nbsp;<span class="op" id="1982249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1982253">_</span><span class="op" id="1982254">,</span>&nbsp;<span class="ident" id="1982256">n</span>&nbsp;<span class="op" id="1982258">:=</span>&nbsp;<span class="ident" id="1982261">utf8</span><span class="op" id="1982265">.</span><span class="ident" id="1982266">DecodeLastRune</span><span class="op" id="1982280">(</span><span class="ident" id="1982281">b</span><span class="op" id="1982282">.</span><span class="ident" id="1982283">buf</span><span class="op" id="1982286">[</span><span class="num" id="1982287">0</span><span class="op" id="1982288">:</span><span class="ident" id="1982289">b</span><span class="op" id="1982290">.</span><span class="ident" id="1982291">off</span><span class="op" id="1982294">]</span><span class="op" id="1982295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1982299">b</span><span class="op" id="1982300">.</span><span class="ident" id="1982301">off</span>&nbsp;<span class="op" id="1982305">-=</span>&nbsp;<span class="ident" id="1982308">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1982311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1982314">return</span>&nbsp;<span class="builtintype" id="1982321">nil</span><br>
<span class="lineno">340</span><span class="op" id="1982325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1982328">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="1982392">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="1982466">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="1982487">func</span>&nbsp;<span class="op" id="1982492">(</span><span class="ident" id="1982493">b</span>&nbsp;<span class="op" id="1982495">*</span><span class="ident" id="1982496">Buffer</span><span class="op" id="1982502">)</span>&nbsp;<span class="ident" id="1982504">UnreadByte</span><span class="op" id="1982514">(</span><span class="op" id="1982515">)</span>&nbsp;<span class="builtintype" id="1982517">error</span>&nbsp;<span class="op" id="1982523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1982526">if</span>&nbsp;<span class="ident" id="1982529">b</span><span class="op" id="1982530">.</span><span class="ident" id="1982531">lastRead</span>&nbsp;<span class="op" id="1982540">!=</span>&nbsp;<span class="ident" id="1982543">opReadRune</span>&nbsp;<span class="op" id="1982554">&amp;&amp;</span>&nbsp;<span class="ident" id="1982557">b</span><span class="op" id="1982558">.</span><span class="ident" id="1982559">lastRead</span>&nbsp;<span class="op" id="1982568">!=</span>&nbsp;<span class="ident" id="1982571">opRead</span>&nbsp;<span class="op" id="1982578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1982582">return</span>&nbsp;<span class="ident" id="1982589">errors</span><span class="op" id="1982595">.</span><span class="ident" id="1982596">New</span><span class="op" id="1982599">(</span><span class="string" id="1982600">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="1982661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1982664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1982667">b</span><span class="op" id="1982668">.</span><span class="ident" id="1982669">lastRead</span>&nbsp;<span class="op" id="1982678">=</span>&nbsp;<span class="ident" id="1982680">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1982691">if</span>&nbsp;<span class="ident" id="1982694">b</span><span class="op" id="1982695">.</span><span class="ident" id="1982696">off</span>&nbsp;<span class="op" id="1982700">&gt;</span>&nbsp;<span class="num" id="1982702">0</span>&nbsp;<span class="op" id="1982704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1982708">b</span><span class="op" id="1982709">.</span><span class="ident" id="1982710">off</span><span class="op" id="1982713">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1982717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1982720">return</span>&nbsp;<span class="builtintype" id="1982727">nil</span><br>
<span class="lineno"></span><span class="op" id="1982731">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="1982734">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="1982803">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1982879">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1982943">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="1983025">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1983106">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="1983116">func</span>&nbsp;<span class="op" id="1983121">(</span><span class="ident" id="1983122">b</span>&nbsp;<span class="op" id="1983124">*</span><span class="ident" id="1983125">Buffer</span><span class="op" id="1983131">)</span>&nbsp;<span class="ident" id="1983133">ReadBytes</span><span class="op" id="1983142">(</span><span class="ident" id="1983143">delim</span>&nbsp;<span class="builtintype" id="1983149">byte</span><span class="op" id="1983153">)</span>&nbsp;<span class="op" id="1983155">(</span><span class="ident" id="1983156">line</span>&nbsp;<span class="op" id="1983161">[</span><span class="op" id="1983162">]</span><span class="builtintype" id="1983163">byte</span><span class="op" id="1983167">,</span>&nbsp;<span class="ident" id="1983169">err</span>&nbsp;<span class="builtintype" id="1983173">error</span><span class="op" id="1983178">)</span>&nbsp;<span class="op" id="1983180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1983183">slice</span><span class="op" id="1983188">,</span>&nbsp;<span class="ident" id="1983190">err</span>&nbsp;<span class="op" id="1983194">:=</span>&nbsp;<span class="ident" id="1983197">b</span><span class="op" id="1983198">.</span><span class="ident" id="1983199">readSlice</span><span class="op" id="1983208">(</span><span class="ident" id="1983209">delim</span><span class="op" id="1983214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1983217">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1983276">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1983311">line</span>&nbsp;<span class="op" id="1983316">=</span>&nbsp;<span class="builtinfunc" id="1983318">append</span><span class="op" id="1983324">(</span><span class="ident" id="1983325">line</span><span class="op" id="1983329">,</span>&nbsp;<span class="ident" id="1983331">slice</span><span class="op" id="1983336">...</span><span class="op" id="1983339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1983342">return</span><br>
<span class="lineno"></span><span class="op" id="1983349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="1983352">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1983432">func</span>&nbsp;<span class="op" id="1983437">(</span><span class="ident" id="1983438">b</span>&nbsp;<span class="op" id="1983440">*</span><span class="ident" id="1983441">Buffer</span><span class="op" id="1983447">)</span>&nbsp;<span class="ident" id="1983449">readSlice</span><span class="op" id="1983458">(</span><span class="ident" id="1983459">delim</span>&nbsp;<span class="builtintype" id="1983465">byte</span><span class="op" id="1983469">)</span>&nbsp;<span class="op" id="1983471">(</span><span class="ident" id="1983472">line</span>&nbsp;<span class="op" id="1983477">[</span><span class="op" id="1983478">]</span><span class="builtintype" id="1983479">byte</span><span class="op" id="1983483">,</span>&nbsp;<span class="ident" id="1983485">err</span>&nbsp;<span class="builtintype" id="1983489">error</span><span class="op" id="1983494">)</span>&nbsp;<span class="op" id="1983496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1983499">i</span>&nbsp;<span class="op" id="1983501">:=</span>&nbsp;<span class="ident" id="1983504">IndexByte</span><span class="op" id="1983513">(</span><span class="ident" id="1983514">b</span><span class="op" id="1983515">.</span><span class="ident" id="1983516">buf</span><span class="op" id="1983519">[</span><span class="ident" id="1983520">b</span><span class="op" id="1983521">.</span><span class="ident" id="1983522">off</span><span class="op" id="1983525">:</span><span class="op" id="1983526">]</span><span class="op" id="1983527">,</span>&nbsp;<span class="ident" id="1983529">delim</span><span class="op" id="1983534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1983537">end</span>&nbsp;<span class="op" id="1983541">:=</span>&nbsp;<span class="ident" id="1983544">b</span><span class="op" id="1983545">.</span><span class="ident" id="1983546">off</span>&nbsp;<span class="op" id="1983550">+</span>&nbsp;<span class="ident" id="1983552">i</span>&nbsp;<span class="op" id="1983554">+</span>&nbsp;<span class="num" id="1983556">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1983559">if</span>&nbsp;<span class="ident" id="1983562">i</span>&nbsp;<span class="op" id="1983564">&lt;</span>&nbsp;<span class="num" id="1983566">0</span>&nbsp;<span class="op" id="1983568">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1983572">end</span>&nbsp;<span class="op" id="1983576">=</span>&nbsp;<span class="builtinfunc" id="1983578">len</span><span class="op" id="1983581">(</span><span class="ident" id="1983582">b</span><span class="op" id="1983583">.</span><span class="ident" id="1983584">buf</span><span class="op" id="1983587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1983591">err</span>&nbsp;<span class="op" id="1983595">=</span>&nbsp;<span class="ident" id="1983597">io</span><span class="op" id="1983599">.</span><span class="ident" id="1983600">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1983605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1983608">line</span>&nbsp;<span class="op" id="1983613">=</span>&nbsp;<span class="ident" id="1983615">b</span><span class="op" id="1983616">.</span><span class="ident" id="1983617">buf</span><span class="op" id="1983620">[</span><span class="ident" id="1983621">b</span><span class="op" id="1983622">.</span><span class="ident" id="1983623">off</span><span class="op" id="1983626">:</span><span class="ident" id="1983627">end</span><span class="op" id="1983630">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1983633">b</span><span class="op" id="1983634">.</span><span class="ident" id="1983635">off</span>&nbsp;<span class="op" id="1983639">=</span>&nbsp;<span class="ident" id="1983641">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1983646">b</span><span class="op" id="1983647">.</span><span class="ident" id="1983648">lastRead</span>&nbsp;<span class="op" id="1983657">=</span>&nbsp;<span class="ident" id="1983659">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1983667">return</span>&nbsp;<span class="ident" id="1983674">line</span><span class="op" id="1983678">,</span>&nbsp;<span class="ident" id="1983680">err</span><br>
<span class="lineno"></span><span class="op" id="1983684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1983687">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="1983757">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1983834">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1983899">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="1983981">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="1984060">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="1984073">func</span>&nbsp;<span class="op" id="1984078">(</span><span class="ident" id="1984079">b</span>&nbsp;<span class="op" id="1984081">*</span><span class="ident" id="1984082">Buffer</span><span class="op" id="1984088">)</span>&nbsp;<span class="ident" id="1984090">ReadString</span><span class="op" id="1984100">(</span><span class="ident" id="1984101">delim</span>&nbsp;<span class="builtintype" id="1984107">byte</span><span class="op" id="1984111">)</span>&nbsp;<span class="op" id="1984113">(</span><span class="ident" id="1984114">line</span>&nbsp;<span class="builtintype" id="1984119">string</span><span class="op" id="1984125">,</span>&nbsp;<span class="ident" id="1984127">err</span>&nbsp;<span class="builtintype" id="1984131">error</span><span class="op" id="1984136">)</span>&nbsp;<span class="op" id="1984138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1984141">slice</span><span class="op" id="1984146">,</span>&nbsp;<span class="ident" id="1984148">err</span>&nbsp;<span class="op" id="1984152">:=</span>&nbsp;<span class="ident" id="1984155">b</span><span class="op" id="1984156">.</span><span class="ident" id="1984157">readSlice</span><span class="op" id="1984166">(</span><span class="ident" id="1984167">delim</span><span class="op" id="1984172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1984175">return</span>&nbsp;<span class="builtintype" id="1984182">string</span><span class="op" id="1984188">(</span><span class="ident" id="1984189">slice</span><span class="op" id="1984194">)</span><span class="op" id="1984195">,</span>&nbsp;<span class="ident" id="1984197">err</span><br>
<span class="lineno"></span><span class="op" id="1984201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="1984204">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="1984279">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="1984355">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="1984428">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1984490">//</span><br>
<span class="lineno">400</span><span class="comment" id="1984493">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1984564">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1984602">func</span>&nbsp;<span class="ident" id="1984607">NewBuffer</span><span class="op" id="1984616">(</span><span class="ident" id="1984617">buf</span>&nbsp;<span class="op" id="1984621">[</span><span class="op" id="1984622">]</span><span class="builtintype" id="1984623">byte</span><span class="op" id="1984627">)</span>&nbsp;<span class="op" id="1984629">*</span><span class="ident" id="1984630">Buffer</span>&nbsp;<span class="op" id="1984637">{</span>&nbsp;<span class="keyword" id="1984639">return</span>&nbsp;<span class="op" id="1984646">&amp;</span><span class="ident" id="1984647">Buffer</span><span class="op" id="1984653">{</span><span class="ident" id="1984654">buf</span><span class="op" id="1984657">:</span>&nbsp;<span class="ident" id="1984659">buf</span><span class="op" id="1984662">}</span>&nbsp;<span class="op" id="1984664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1984667">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="1984745">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="1984821">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1984832">//</span><br>
<span class="lineno"></span><span class="comment" id="1984835">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1984906">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="1984944">func</span>&nbsp;<span class="ident" id="1984949">NewBufferString</span><span class="op" id="1984964">(</span><span class="ident" id="1984965">s</span>&nbsp;<span class="builtintype" id="1984967">string</span><span class="op" id="1984973">)</span>&nbsp;<span class="op" id="1984975">*</span><span class="ident" id="1984976">Buffer</span>&nbsp;<span class="op" id="1984983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1984986">return</span>&nbsp;<span class="op" id="1984993">&amp;</span><span class="ident" id="1984994">Buffer</span><span class="op" id="1985000">{</span><span class="ident" id="1985001">buf</span><span class="op" id="1985004">:</span>&nbsp;<span class="op" id="1985006">[</span><span class="op" id="1985007">]</span><span class="builtintype" id="1985008">byte</span><span class="op" id="1985012">(</span><span class="ident" id="1985013">s</span><span class="op" id="1985014">)</span><span class="op" id="1985015">}</span><br>
<span class="lineno"></span><span class="op" id="1985017">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
