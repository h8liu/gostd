<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7130812">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7130867">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7130921">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7130972">package</span>&nbsp;<span class="ident" id="7130980">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7130987">import</span>&nbsp;<span class="op" id="7130994">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7130997">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7131006">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7131022">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7131029">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7131039">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7131042">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="7131102">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="7131163">func</span>&nbsp;<span class="ident" id="7131168">equal</span><span class="op" id="7131173">(</span><span class="ident" id="7131174">p</span><span class="op" id="7131175">,</span>&nbsp;<span class="ident" id="7131177">q</span>&nbsp;<span class="op" id="7131179">*</span><span class="ident" id="7131180">FileSet</span><span class="op" id="7131187">)</span>&nbsp;<span class="builtintype" id="7131189">error</span>&nbsp;<span class="op" id="7131195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131198">if</span>&nbsp;<span class="ident" id="7131201">p</span>&nbsp;<span class="op" id="7131203">==</span>&nbsp;<span class="ident" id="7131206">q</span>&nbsp;<span class="op" id="7131208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7131212">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131242">return</span>&nbsp;<span class="ident" id="7131249">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7131258">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131295">p</span><span class="op" id="7131296">.</span><span class="ident" id="7131297">mutex</span><span class="op" id="7131302">.</span><span class="ident" id="7131303">Lock</span><span class="op" id="7131307">(</span><span class="op" id="7131308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131311">q</span><span class="op" id="7131312">.</span><span class="ident" id="7131313">mutex</span><span class="op" id="7131318">.</span><span class="ident" id="7131319">Lock</span><span class="op" id="7131323">(</span><span class="op" id="7131324">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131327">defer</span>&nbsp;<span class="ident" id="7131333">q</span><span class="op" id="7131334">.</span><span class="ident" id="7131335">mutex</span><span class="op" id="7131340">.</span><span class="ident" id="7131341">Unlock</span><span class="op" id="7131347">(</span><span class="op" id="7131348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131351">defer</span>&nbsp;<span class="ident" id="7131357">p</span><span class="op" id="7131358">.</span><span class="ident" id="7131359">mutex</span><span class="op" id="7131364">.</span><span class="ident" id="7131365">Unlock</span><span class="op" id="7131371">(</span><span class="op" id="7131372">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131376">if</span>&nbsp;<span class="ident" id="7131379">p</span><span class="op" id="7131380">.</span><span class="ident" id="7131381">base</span>&nbsp;<span class="op" id="7131386">!=</span>&nbsp;<span class="ident" id="7131389">q</span><span class="op" id="7131390">.</span><span class="ident" id="7131391">base</span>&nbsp;<span class="op" id="7131396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131400">return</span>&nbsp;<span class="ident" id="7131407">fmt</span><span class="op" id="7131410">.</span><span class="ident" id="7131411">Errorf</span><span class="op" id="7131417">(</span><span class="string" id="7131418">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7131445">,</span>&nbsp;<span class="ident" id="7131447">p</span><span class="op" id="7131448">.</span><span class="ident" id="7131449">base</span><span class="op" id="7131453">,</span>&nbsp;<span class="ident" id="7131455">q</span><span class="op" id="7131456">.</span><span class="ident" id="7131457">base</span><span class="op" id="7131461">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131468">if</span>&nbsp;<span class="builtinfunc" id="7131471">len</span><span class="op" id="7131474">(</span><span class="ident" id="7131475">p</span><span class="op" id="7131476">.</span><span class="ident" id="7131477">files</span><span class="op" id="7131482">)</span>&nbsp;<span class="op" id="7131484">!=</span>&nbsp;<span class="builtinfunc" id="7131487">len</span><span class="op" id="7131490">(</span><span class="ident" id="7131491">q</span><span class="op" id="7131492">.</span><span class="ident" id="7131493">files</span><span class="op" id="7131498">)</span>&nbsp;<span class="op" id="7131500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131504">return</span>&nbsp;<span class="ident" id="7131511">fmt</span><span class="op" id="7131514">.</span><span class="ident" id="7131515">Errorf</span><span class="op" id="7131521">(</span><span class="string" id="7131522">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7131559">,</span>&nbsp;<span class="builtinfunc" id="7131561">len</span><span class="op" id="7131564">(</span><span class="ident" id="7131565">p</span><span class="op" id="7131566">.</span><span class="ident" id="7131567">files</span><span class="op" id="7131572">)</span><span class="op" id="7131573">,</span>&nbsp;<span class="builtinfunc" id="7131575">len</span><span class="op" id="7131578">(</span><span class="ident" id="7131579">q</span><span class="op" id="7131580">.</span><span class="ident" id="7131581">files</span><span class="op" id="7131586">)</span><span class="op" id="7131587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131590">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131594">for</span>&nbsp;<span class="ident" id="7131598">i</span><span class="op" id="7131599">,</span>&nbsp;<span class="ident" id="7131601">f</span>&nbsp;<span class="op" id="7131603">:=</span>&nbsp;<span class="keyword" id="7131606">range</span>&nbsp;<span class="ident" id="7131612">p</span><span class="op" id="7131613">.</span><span class="ident" id="7131614">files</span>&nbsp;<span class="op" id="7131620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131624">g</span>&nbsp;<span class="op" id="7131626">:=</span>&nbsp;<span class="ident" id="7131629">q</span><span class="op" id="7131630">.</span><span class="ident" id="7131631">files</span><span class="op" id="7131636">[</span><span class="ident" id="7131637">i</span><span class="op" id="7131638">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131642">if</span>&nbsp;<span class="ident" id="7131645">f</span><span class="op" id="7131646">.</span><span class="ident" id="7131647">set</span>&nbsp;<span class="op" id="7131651">!=</span>&nbsp;<span class="ident" id="7131654">p</span>&nbsp;<span class="op" id="7131656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131661">return</span>&nbsp;<span class="ident" id="7131668">fmt</span><span class="op" id="7131671">.</span><span class="ident" id="7131672">Errorf</span><span class="op" id="7131678">(</span><span class="string" id="7131679">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7131701">,</span>&nbsp;<span class="ident" id="7131703">f</span><span class="op" id="7131704">.</span><span class="ident" id="7131705">name</span><span class="op" id="7131709">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131717">if</span>&nbsp;<span class="ident" id="7131720">g</span><span class="op" id="7131721">.</span><span class="ident" id="7131722">set</span>&nbsp;<span class="op" id="7131726">!=</span>&nbsp;<span class="ident" id="7131729">q</span>&nbsp;<span class="op" id="7131731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131736">return</span>&nbsp;<span class="ident" id="7131743">fmt</span><span class="op" id="7131746">.</span><span class="ident" id="7131747">Errorf</span><span class="op" id="7131753">(</span><span class="string" id="7131754">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7131776">,</span>&nbsp;<span class="ident" id="7131778">g</span><span class="op" id="7131779">.</span><span class="ident" id="7131780">name</span><span class="op" id="7131784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131792">if</span>&nbsp;<span class="ident" id="7131795">f</span><span class="op" id="7131796">.</span><span class="ident" id="7131797">name</span>&nbsp;<span class="op" id="7131802">!=</span>&nbsp;<span class="ident" id="7131805">g</span><span class="op" id="7131806">.</span><span class="ident" id="7131807">name</span>&nbsp;<span class="op" id="7131812">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131817">return</span>&nbsp;<span class="ident" id="7131824">fmt</span><span class="op" id="7131827">.</span><span class="ident" id="7131828">Errorf</span><span class="op" id="7131834">(</span><span class="string" id="7131835">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="7131866">,</span>&nbsp;<span class="ident" id="7131868">f</span><span class="op" id="7131869">.</span><span class="ident" id="7131870">name</span><span class="op" id="7131874">,</span>&nbsp;<span class="ident" id="7131876">g</span><span class="op" id="7131877">.</span><span class="ident" id="7131878">name</span><span class="op" id="7131882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131890">if</span>&nbsp;<span class="ident" id="7131893">f</span><span class="op" id="7131894">.</span><span class="ident" id="7131895">base</span>&nbsp;<span class="op" id="7131900">!=</span>&nbsp;<span class="ident" id="7131903">g</span><span class="op" id="7131904">.</span><span class="ident" id="7131905">base</span>&nbsp;<span class="op" id="7131910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131915">return</span>&nbsp;<span class="ident" id="7131922">fmt</span><span class="op" id="7131925">.</span><span class="ident" id="7131926">Errorf</span><span class="op" id="7131932">(</span><span class="string" id="7131933">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7131966">,</span>&nbsp;<span class="ident" id="7131968">f</span><span class="op" id="7131969">.</span><span class="ident" id="7131970">name</span><span class="op" id="7131974">,</span>&nbsp;<span class="ident" id="7131976">f</span><span class="op" id="7131977">.</span><span class="ident" id="7131978">base</span><span class="op" id="7131982">,</span>&nbsp;<span class="ident" id="7131984">g</span><span class="op" id="7131985">.</span><span class="ident" id="7131986">base</span><span class="op" id="7131990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131994">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131998">if</span>&nbsp;<span class="ident" id="7132001">f</span><span class="op" id="7132002">.</span><span class="ident" id="7132003">size</span>&nbsp;<span class="op" id="7132008">!=</span>&nbsp;<span class="ident" id="7132011">g</span><span class="op" id="7132012">.</span><span class="ident" id="7132013">size</span>&nbsp;<span class="op" id="7132018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132023">return</span>&nbsp;<span class="ident" id="7132030">fmt</span><span class="op" id="7132033">.</span><span class="ident" id="7132034">Errorf</span><span class="op" id="7132040">(</span><span class="string" id="7132041">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7132074">,</span>&nbsp;<span class="ident" id="7132076">f</span><span class="op" id="7132077">.</span><span class="ident" id="7132078">name</span><span class="op" id="7132082">,</span>&nbsp;<span class="ident" id="7132084">f</span><span class="op" id="7132085">.</span><span class="ident" id="7132086">size</span><span class="op" id="7132090">,</span>&nbsp;<span class="ident" id="7132092">g</span><span class="op" id="7132093">.</span><span class="ident" id="7132094">size</span><span class="op" id="7132098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132106">for</span>&nbsp;<span class="ident" id="7132110">j</span><span class="op" id="7132111">,</span>&nbsp;<span class="ident" id="7132113">l</span>&nbsp;<span class="op" id="7132115">:=</span>&nbsp;<span class="keyword" id="7132118">range</span>&nbsp;<span class="ident" id="7132124">f</span><span class="op" id="7132125">.</span><span class="ident" id="7132126">lines</span>&nbsp;<span class="op" id="7132132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132137">m</span>&nbsp;<span class="op" id="7132139">:=</span>&nbsp;<span class="ident" id="7132142">g</span><span class="op" id="7132143">.</span><span class="ident" id="7132144">lines</span><span class="op" id="7132149">[</span><span class="ident" id="7132150">j</span><span class="op" id="7132151">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132156">if</span>&nbsp;<span class="ident" id="7132159">l</span>&nbsp;<span class="op" id="7132161">!=</span>&nbsp;<span class="ident" id="7132164">m</span>&nbsp;<span class="op" id="7132166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132172">return</span>&nbsp;<span class="ident" id="7132179">fmt</span><span class="op" id="7132182">.</span><span class="ident" id="7132183">Errorf</span><span class="op" id="7132189">(</span><span class="string" id="7132190">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7132216">,</span>&nbsp;<span class="ident" id="7132218">f</span><span class="op" id="7132219">.</span><span class="ident" id="7132220">name</span><span class="op" id="7132224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132237">for</span>&nbsp;<span class="ident" id="7132241">j</span><span class="op" id="7132242">,</span>&nbsp;<span class="ident" id="7132244">l</span>&nbsp;<span class="op" id="7132246">:=</span>&nbsp;<span class="keyword" id="7132249">range</span>&nbsp;<span class="ident" id="7132255">f</span><span class="op" id="7132256">.</span><span class="ident" id="7132257">infos</span>&nbsp;<span class="op" id="7132263">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132268">m</span>&nbsp;<span class="op" id="7132270">:=</span>&nbsp;<span class="ident" id="7132273">g</span><span class="op" id="7132274">.</span><span class="ident" id="7132275">infos</span><span class="op" id="7132280">[</span><span class="ident" id="7132281">j</span><span class="op" id="7132282">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132287">if</span>&nbsp;<span class="ident" id="7132290">l</span><span class="op" id="7132291">.</span><span class="ident" id="7132292">Offset</span>&nbsp;<span class="op" id="7132299">!=</span>&nbsp;<span class="ident" id="7132302">m</span><span class="op" id="7132303">.</span><span class="ident" id="7132304">Offset</span>&nbsp;<span class="op" id="7132311">||</span>&nbsp;<span class="ident" id="7132314">l</span><span class="op" id="7132315">.</span><span class="ident" id="7132316">Filename</span>&nbsp;<span class="op" id="7132325">!=</span>&nbsp;<span class="ident" id="7132328">m</span><span class="op" id="7132329">.</span><span class="ident" id="7132330">Filename</span>&nbsp;<span class="op" id="7132339">||</span>&nbsp;<span class="ident" id="7132342">l</span><span class="op" id="7132343">.</span><span class="ident" id="7132344">Line</span>&nbsp;<span class="op" id="7132349">!=</span>&nbsp;<span class="ident" id="7132352">m</span><span class="op" id="7132353">.</span><span class="ident" id="7132354">Line</span>&nbsp;<span class="op" id="7132359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132365">return</span>&nbsp;<span class="ident" id="7132372">fmt</span><span class="op" id="7132375">.</span><span class="ident" id="7132376">Errorf</span><span class="op" id="7132382">(</span><span class="string" id="7132383">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7132407">,</span>&nbsp;<span class="ident" id="7132409">f</span><span class="op" id="7132410">.</span><span class="ident" id="7132411">name</span><span class="op" id="7132415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132424">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7132431">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132481">return</span>&nbsp;<span class="ident" id="7132488">nil</span><br>
<span class="lineno"></span><span class="op" id="7132492">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7132495">func</span>&nbsp;<span class="ident" id="7132500">checkSerialize</span><span class="op" id="7132514">(</span><span class="ident" id="7132515">t</span>&nbsp;<span class="op" id="7132517">*</span><span class="ident" id="7132518">testing</span><span class="op" id="7132525">.</span><span class="ident" id="7132526">T</span><span class="op" id="7132527">,</span>&nbsp;<span class="ident" id="7132529">p</span>&nbsp;<span class="op" id="7132531">*</span><span class="ident" id="7132532">FileSet</span><span class="op" id="7132539">)</span>&nbsp;<span class="op" id="7132541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132544">var</span>&nbsp;<span class="ident" id="7132548">buf</span>&nbsp;<span class="ident" id="7132552">bytes</span><span class="op" id="7132557">.</span><span class="ident" id="7132558">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132566">encode</span>&nbsp;<span class="op" id="7132573">:=</span>&nbsp;<span class="keyword" id="7132576">func</span><span class="op" id="7132580">(</span><span class="ident" id="7132581">x</span>&nbsp;<span class="keyword" id="7132583">interface</span><span class="op" id="7132592">{</span><span class="op" id="7132593">}</span><span class="op" id="7132594">)</span>&nbsp;<span class="builtintype" id="7132596">error</span>&nbsp;<span class="op" id="7132602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132606">return</span>&nbsp;<span class="ident" id="7132613">gob</span><span class="op" id="7132616">.</span><span class="ident" id="7132617">NewEncoder</span><span class="op" id="7132627">(</span><span class="op" id="7132628">&amp;</span><span class="ident" id="7132629">buf</span><span class="op" id="7132632">)</span><span class="op" id="7132633">.</span><span class="ident" id="7132634">Encode</span><span class="op" id="7132640">(</span><span class="ident" id="7132641">x</span><span class="op" id="7132642">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132648">if</span>&nbsp;<span class="ident" id="7132651">err</span>&nbsp;<span class="op" id="7132655">:=</span>&nbsp;<span class="ident" id="7132658">p</span><span class="op" id="7132659">.</span><span class="ident" id="7132660">Write</span><span class="op" id="7132665">(</span><span class="ident" id="7132666">encode</span><span class="op" id="7132672">)</span><span class="op" id="7132673">;</span>&nbsp;<span class="ident" id="7132675">err</span>&nbsp;<span class="op" id="7132679">!=</span>&nbsp;<span class="ident" id="7132682">nil</span>&nbsp;<span class="op" id="7132686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132690">t</span><span class="op" id="7132691">.</span><span class="ident" id="7132692">Errorf</span><span class="op" id="7132698">(</span><span class="string" id="7132699">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7132727">,</span>&nbsp;<span class="ident" id="7132729">err</span><span class="op" id="7132732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132736">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132744">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132747">q</span>&nbsp;<span class="op" id="7132749">:=</span>&nbsp;<span class="ident" id="7132752">NewFileSet</span><span class="op" id="7132762">(</span><span class="op" id="7132763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132766">decode</span>&nbsp;<span class="op" id="7132773">:=</span>&nbsp;<span class="keyword" id="7132776">func</span><span class="op" id="7132780">(</span><span class="ident" id="7132781">x</span>&nbsp;<span class="keyword" id="7132783">interface</span><span class="op" id="7132792">{</span><span class="op" id="7132793">}</span><span class="op" id="7132794">)</span>&nbsp;<span class="builtintype" id="7132796">error</span>&nbsp;<span class="op" id="7132802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132806">return</span>&nbsp;<span class="ident" id="7132813">gob</span><span class="op" id="7132816">.</span><span class="ident" id="7132817">NewDecoder</span><span class="op" id="7132827">(</span><span class="op" id="7132828">&amp;</span><span class="ident" id="7132829">buf</span><span class="op" id="7132832">)</span><span class="op" id="7132833">.</span><span class="ident" id="7132834">Decode</span><span class="op" id="7132840">(</span><span class="ident" id="7132841">x</span><span class="op" id="7132842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132848">if</span>&nbsp;<span class="ident" id="7132851">err</span>&nbsp;<span class="op" id="7132855">:=</span>&nbsp;<span class="ident" id="7132858">q</span><span class="op" id="7132859">.</span><span class="ident" id="7132860">Read</span><span class="op" id="7132864">(</span><span class="ident" id="7132865">decode</span><span class="op" id="7132871">)</span><span class="op" id="7132872">;</span>&nbsp;<span class="ident" id="7132874">err</span>&nbsp;<span class="op" id="7132878">!=</span>&nbsp;<span class="ident" id="7132881">nil</span>&nbsp;<span class="op" id="7132885">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132889">t</span><span class="op" id="7132890">.</span><span class="ident" id="7132891">Errorf</span><span class="op" id="7132897">(</span><span class="string" id="7132898">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7132926">,</span>&nbsp;<span class="ident" id="7132928">err</span><span class="op" id="7132931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132935">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132946">if</span>&nbsp;<span class="ident" id="7132949">err</span>&nbsp;<span class="op" id="7132953">:=</span>&nbsp;<span class="ident" id="7132956">equal</span><span class="op" id="7132961">(</span><span class="ident" id="7132962">p</span><span class="op" id="7132963">,</span>&nbsp;<span class="ident" id="7132965">q</span><span class="op" id="7132966">)</span><span class="op" id="7132967">;</span>&nbsp;<span class="ident" id="7132969">err</span>&nbsp;<span class="op" id="7132973">!=</span>&nbsp;<span class="ident" id="7132976">nil</span>&nbsp;<span class="op" id="7132980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132984">t</span><span class="op" id="7132985">.</span><span class="ident" id="7132986">Errorf</span><span class="op" id="7132992">(</span><span class="string" id="7132993">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="7133021">,</span>&nbsp;<span class="ident" id="7133023">err</span><span class="op" id="7133026">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133029">}</span><br>
<span class="lineno"></span><span class="op" id="7133031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7133034">func</span>&nbsp;<span class="ident" id="7133039">TestSerialization</span><span class="op" id="7133056">(</span><span class="ident" id="7133057">t</span>&nbsp;<span class="op" id="7133059">*</span><span class="ident" id="7133060">testing</span><span class="op" id="7133067">.</span><span class="ident" id="7133068">T</span><span class="op" id="7133069">)</span>&nbsp;<span class="op" id="7133071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133074">p</span>&nbsp;<span class="op" id="7133076">:=</span>&nbsp;<span class="ident" id="7133079">NewFileSet</span><span class="op" id="7133089">(</span><span class="op" id="7133090">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133093">checkSerialize</span><span class="op" id="7133107">(</span><span class="ident" id="7133108">t</span><span class="op" id="7133109">,</span>&nbsp;<span class="ident" id="7133111">p</span><span class="op" id="7133112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7133115">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133134">for</span>&nbsp;<span class="ident" id="7133138">i</span>&nbsp;<span class="op" id="7133140">:=</span>&nbsp;<span class="num" id="7133143">0</span><span class="op" id="7133144">;</span>&nbsp;<span class="ident" id="7133146">i</span>&nbsp;<span class="op" id="7133148">&lt;</span>&nbsp;<span class="num" id="7133150">10</span><span class="op" id="7133152">;</span>&nbsp;<span class="ident" id="7133154">i</span><span class="op" id="7133155">++</span>&nbsp;<span class="op" id="7133158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133162">f</span>&nbsp;<span class="op" id="7133164">:=</span>&nbsp;<span class="ident" id="7133167">p</span><span class="op" id="7133168">.</span><span class="ident" id="7133169">AddFile</span><span class="op" id="7133176">(</span><span class="ident" id="7133177">fmt</span><span class="op" id="7133180">.</span><span class="ident" id="7133181">Sprintf</span><span class="op" id="7133188">(</span><span class="string" id="7133189">&#34;file%d&#34;</span><span class="op" id="7133197">,</span>&nbsp;<span class="ident" id="7133199">i</span><span class="op" id="7133200">)</span><span class="op" id="7133201">,</span>&nbsp;<span class="ident" id="7133203">p</span><span class="op" id="7133204">.</span><span class="ident" id="7133205">Base</span><span class="op" id="7133209">(</span><span class="op" id="7133210">)</span><span class="op" id="7133211">+</span><span class="ident" id="7133212">i</span><span class="op" id="7133213">,</span>&nbsp;<span class="ident" id="7133215">i</span><span class="op" id="7133216">*</span><span class="num" id="7133217">100</span><span class="op" id="7133220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133224">checkSerialize</span><span class="op" id="7133238">(</span><span class="ident" id="7133239">t</span><span class="op" id="7133240">,</span>&nbsp;<span class="ident" id="7133242">p</span><span class="op" id="7133243">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7133247">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133294">line</span>&nbsp;<span class="op" id="7133299">:=</span>&nbsp;<span class="num" id="7133302">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133309">for</span>&nbsp;<span class="ident" id="7133313">offs</span>&nbsp;<span class="op" id="7133318">:=</span>&nbsp;<span class="num" id="7133321">0</span><span class="op" id="7133322">;</span>&nbsp;<span class="ident" id="7133324">offs</span>&nbsp;<span class="op" id="7133329">&lt;</span>&nbsp;<span class="ident" id="7133331">f</span><span class="op" id="7133332">.</span><span class="ident" id="7133333">Size</span><span class="op" id="7133337">(</span><span class="op" id="7133338">)</span><span class="op" id="7133339">;</span>&nbsp;<span class="ident" id="7133341">offs</span>&nbsp;<span class="op" id="7133346">+=</span>&nbsp;<span class="num" id="7133349">40</span>&nbsp;<span class="op" id="7133352">+</span>&nbsp;<span class="ident" id="7133354">i</span>&nbsp;<span class="op" id="7133356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133361">f</span><span class="op" id="7133362">.</span><span class="ident" id="7133363">AddLine</span><span class="op" id="7133370">(</span><span class="ident" id="7133371">offs</span><span class="op" id="7133375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133380">if</span>&nbsp;<span class="ident" id="7133383">offs</span><span class="op" id="7133387">%</span><span class="num" id="7133388">7</span>&nbsp;<span class="op" id="7133390">==</span>&nbsp;<span class="num" id="7133393">0</span>&nbsp;<span class="op" id="7133395">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133401">f</span><span class="op" id="7133402">.</span><span class="ident" id="7133403">AddLineInfo</span><span class="op" id="7133414">(</span><span class="ident" id="7133415">offs</span><span class="op" id="7133419">,</span>&nbsp;<span class="ident" id="7133421">fmt</span><span class="op" id="7133424">.</span><span class="ident" id="7133425">Sprintf</span><span class="op" id="7133432">(</span><span class="string" id="7133433">&#34;file%d&#34;</span><span class="op" id="7133441">,</span>&nbsp;<span class="ident" id="7133443">offs</span><span class="op" id="7133447">)</span><span class="op" id="7133448">,</span>&nbsp;<span class="ident" id="7133450">line</span><span class="op" id="7133454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133460">line</span>&nbsp;<span class="op" id="7133465">+=</span>&nbsp;<span class="num" id="7133468">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133482">checkSerialize</span><span class="op" id="7133496">(</span><span class="ident" id="7133497">t</span><span class="op" id="7133498">,</span>&nbsp;<span class="ident" id="7133500">p</span><span class="op" id="7133501">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133504">}</span><br>
<span class="lineno"></span><span class="op" id="7133506">}</span>
</div>
</body>
</html>
