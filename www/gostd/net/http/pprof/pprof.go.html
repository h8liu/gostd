<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5530203">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5530259">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5530313">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5530364">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5530431">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="5530490">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5530531">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="5530578">//</span><br>
<span class="lineno">10</span><span class="comment" id="5530581">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5530646">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="5530680">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="5530731">//</span><br>
<span class="lineno"></span><span class="comment" id="5530734">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="5530788">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5530817">//</span><br>
<span class="lineno"></span><span class="comment" id="5530820">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="5530886">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5530954">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="5530999">//</span><br>
<span class="lineno"></span><span class="comment" id="5531002">//&nbsp;&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5531018">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="5531079">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp}()</span><br>
<span class="lineno"></span><span class="comment" id="5531087">//</span><br>
<span class="lineno">25</span><span class="comment" id="5531090">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="5531146">//</span><br>
<span class="lineno"></span><span class="comment" id="5531149">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="5531205">//</span><br>
<span class="lineno"></span><span class="comment" id="5531208">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="5531250">//</span><br>
<span class="lineno"></span><span class="comment" id="5531253">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="5531312">//</span><br>
<span class="lineno"></span><span class="comment" id="5531315">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="5531364">//</span><br>
<span class="lineno">35</span><span class="comment" id="5531367">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="5531424">//</span><br>
<span class="lineno"></span><span class="comment" id="5531427">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="5531502">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="5531522">//</span><br>
<span class="lineno">40</span><span class="comment" id="5531525">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="5531573">//</span><br>
<span class="lineno"></span><span class="comment" id="5531576">//&nbsp;&nbsp;&nbsp;&nbsphttp://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="5531637">//</span><br>
<span class="lineno"></span><span class="keyword" id="5531640">package</span>&nbsp;<span class="ident" id="5531648">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5531655">import</span>&nbsp;<span class="op" id="5531662">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531665">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531674">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531683">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531690">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531707">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531713">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531720">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531732">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531738">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531749">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531766">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531777">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5531788">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="5531795">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5531798">func</span>&nbsp;<span class="ident" id="5531803">init</span><span class="op" id="5531807">(</span><span class="op" id="5531808">)</span>&nbsp;<span class="op" id="5531810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531813">http</span><span class="op" id="5531817">.</span><span class="ident" id="5531818">Handle</span><span class="op" id="5531824">(</span><span class="string" id="5531825">&#34;/debug/pprof/&#34;</span><span class="op" id="5531840">,</span>&nbsp;<span class="ident" id="5531842">http</span><span class="op" id="5531846">.</span><span class="ident" id="5531847">HandlerFunc</span><span class="op" id="5531858">(</span><span class="ident" id="5531859">Index</span><span class="op" id="5531864">)</span><span class="op" id="5531865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531868">http</span><span class="op" id="5531872">.</span><span class="ident" id="5531873">Handle</span><span class="op" id="5531879">(</span><span class="string" id="5531880">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="5531902">,</span>&nbsp;<span class="ident" id="5531904">http</span><span class="op" id="5531908">.</span><span class="ident" id="5531909">HandlerFunc</span><span class="op" id="5531920">(</span><span class="ident" id="5531921">Cmdline</span><span class="op" id="5531928">)</span><span class="op" id="5531929">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531932">http</span><span class="op" id="5531936">.</span><span class="ident" id="5531937">Handle</span><span class="op" id="5531943">(</span><span class="string" id="5531944">&#34;/debug/pprof/profile&#34;</span><span class="op" id="5531966">,</span>&nbsp;<span class="ident" id="5531968">http</span><span class="op" id="5531972">.</span><span class="ident" id="5531973">HandlerFunc</span><span class="op" id="5531984">(</span><span class="ident" id="5531985">Profile</span><span class="op" id="5531992">)</span><span class="op" id="5531993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531996">http</span><span class="op" id="5532000">.</span><span class="ident" id="5532001">Handle</span><span class="op" id="5532007">(</span><span class="string" id="5532008">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="5532029">,</span>&nbsp;<span class="ident" id="5532031">http</span><span class="op" id="5532035">.</span><span class="ident" id="5532036">HandlerFunc</span><span class="op" id="5532047">(</span><span class="ident" id="5532048">Symbol</span><span class="op" id="5532054">)</span><span class="op" id="5532055">)</span><br>
<span class="lineno"></span><span class="op" id="5532057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5532060">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="5532107">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="5532163">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="5532231">func</span>&nbsp;<span class="ident" id="5532236">Cmdline</span><span class="op" id="5532243">(</span><span class="ident" id="5532244">w</span>&nbsp;<span class="ident" id="5532246">http</span><span class="op" id="5532250">.</span><span class="ident" id="5532251">ResponseWriter</span><span class="op" id="5532265">,</span>&nbsp;<span class="ident" id="5532267">r</span>&nbsp;<span class="op" id="5532269">*</span><span class="ident" id="5532270">http</span><span class="op" id="5532274">.</span><span class="ident" id="5532275">Request</span><span class="op" id="5532282">)</span>&nbsp;<span class="op" id="5532284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532287">w</span><span class="op" id="5532288">.</span><span class="ident" id="5532289">Header</span><span class="op" id="5532295">(</span><span class="op" id="5532296">)</span><span class="op" id="5532297">.</span><span class="ident" id="5532298">Set</span><span class="op" id="5532301">(</span><span class="string" id="5532302">&#34;Content-Type&#34;</span><span class="op" id="5532316">,</span>&nbsp;<span class="string" id="5532318">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5532345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532348">fmt</span><span class="op" id="5532351">.</span><span class="ident" id="5532352">Fprintf</span><span class="op" id="5532359">(</span><span class="ident" id="5532360">w</span><span class="op" id="5532361">,</span>&nbsp;<span class="ident" id="5532363">strings</span><span class="op" id="5532370">.</span><span class="ident" id="5532371">Join</span><span class="op" id="5532375">(</span><span class="ident" id="5532376">os</span><span class="op" id="5532378">.</span><span class="ident" id="5532379">Args</span><span class="op" id="5532383">,</span>&nbsp;<span class="string" id="5532385">&#34;\x00&#34;</span><span class="op" id="5532391">)</span><span class="op" id="5532392">)</span><br>
<span class="lineno">75</span><span class="op" id="5532394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5532397">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="5532455">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="5532523">func</span>&nbsp;<span class="ident" id="5532528">Profile</span><span class="op" id="5532535">(</span><span class="ident" id="5532536">w</span>&nbsp;<span class="ident" id="5532538">http</span><span class="op" id="5532542">.</span><span class="ident" id="5532543">ResponseWriter</span><span class="op" id="5532557">,</span>&nbsp;<span class="ident" id="5532559">r</span>&nbsp;<span class="op" id="5532561">*</span><span class="ident" id="5532562">http</span><span class="op" id="5532566">.</span><span class="ident" id="5532567">Request</span><span class="op" id="5532574">)</span>&nbsp;<span class="op" id="5532576">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532579">sec</span><span class="op" id="5532582">,</span>&nbsp;<span class="ident" id="5532584">_</span>&nbsp;<span class="op" id="5532586">:=</span>&nbsp;<span class="ident" id="5532589">strconv</span><span class="op" id="5532596">.</span><span class="ident" id="5532597">ParseInt</span><span class="op" id="5532605">(</span><span class="ident" id="5532606">r</span><span class="op" id="5532607">.</span><span class="ident" id="5532608">FormValue</span><span class="op" id="5532617">(</span><span class="string" id="5532618">&#34;seconds&#34;</span><span class="op" id="5532627">)</span><span class="op" id="5532628">,</span>&nbsp;<span class="num" id="5532630">10</span><span class="op" id="5532632">,</span>&nbsp;<span class="num" id="5532634">64</span><span class="op" id="5532636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532639">if</span>&nbsp;<span class="ident" id="5532642">sec</span>&nbsp;<span class="op" id="5532646">==</span>&nbsp;<span class="num" id="5532649">0</span>&nbsp;<span class="op" id="5532651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532655">sec</span>&nbsp;<span class="op" id="5532659">=</span>&nbsp;<span class="num" id="5532661">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532669">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532726">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532768">w</span><span class="op" id="5532769">.</span><span class="ident" id="5532770">Header</span><span class="op" id="5532776">(</span><span class="op" id="5532777">)</span><span class="op" id="5532778">.</span><span class="ident" id="5532779">Set</span><span class="op" id="5532782">(</span><span class="string" id="5532783">&#34;Content-Type&#34;</span><span class="op" id="5532797">,</span>&nbsp;<span class="string" id="5532799">&#34;application/octet-stream&#34;</span><span class="op" id="5532825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532828">if</span>&nbsp;<span class="ident" id="5532831">err</span>&nbsp;<span class="op" id="5532835">:=</span>&nbsp;<span class="ident" id="5532838">pprof</span><span class="op" id="5532843">.</span><span class="ident" id="5532844">StartCPUProfile</span><span class="op" id="5532859">(</span><span class="ident" id="5532860">w</span><span class="op" id="5532861">)</span><span class="op" id="5532862">;</span>&nbsp;<span class="ident" id="5532864">err</span>&nbsp;<span class="op" id="5532868">!=</span>&nbsp;<span class="ident" id="5532871">nil</span>&nbsp;<span class="op" id="5532875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532879">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532926">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532970">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532996">w</span><span class="op" id="5532997">.</span><span class="ident" id="5532998">Header</span><span class="op" id="5533004">(</span><span class="op" id="5533005">)</span><span class="op" id="5533006">.</span><span class="ident" id="5533007">Set</span><span class="op" id="5533010">(</span><span class="string" id="5533011">&#34;Content-Type&#34;</span><span class="op" id="5533025">,</span>&nbsp;<span class="string" id="5533027">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5533054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533058">w</span><span class="op" id="5533059">.</span><span class="ident" id="5533060">WriteHeader</span><span class="op" id="5533071">(</span><span class="ident" id="5533072">http</span><span class="op" id="5533076">.</span><span class="ident" id="5533077">StatusInternalServerError</span><span class="op" id="5533102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533106">fmt</span><span class="op" id="5533109">.</span><span class="ident" id="5533110">Fprintf</span><span class="op" id="5533117">(</span><span class="ident" id="5533118">w</span><span class="op" id="5533119">,</span>&nbsp;<span class="string" id="5533121">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="5533159">,</span>&nbsp;<span class="ident" id="5533161">err</span><span class="op" id="5533164">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533168">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533179">time</span><span class="op" id="5533183">.</span><span class="ident" id="5533184">Sleep</span><span class="op" id="5533189">(</span><span class="ident" id="5533190">time</span><span class="op" id="5533194">.</span><span class="ident" id="5533195">Duration</span><span class="op" id="5533203">(</span><span class="ident" id="5533204">sec</span><span class="op" id="5533207">)</span>&nbsp;<span class="op" id="5533209">*</span>&nbsp;<span class="ident" id="5533211">time</span><span class="op" id="5533215">.</span><span class="ident" id="5533216">Second</span><span class="op" id="5533222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533225">pprof</span><span class="op" id="5533230">.</span><span class="ident" id="5533231">StopCPUProfile</span><span class="op" id="5533245">(</span><span class="op" id="5533246">)</span><br>
<span class="lineno"></span><span class="op" id="5533248">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="5533251">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="5533314">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="5533385">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5533452">func</span>&nbsp;<span class="ident" id="5533457">Symbol</span><span class="op" id="5533463">(</span><span class="ident" id="5533464">w</span>&nbsp;<span class="ident" id="5533466">http</span><span class="op" id="5533470">.</span><span class="ident" id="5533471">ResponseWriter</span><span class="op" id="5533485">,</span>&nbsp;<span class="ident" id="5533487">r</span>&nbsp;<span class="op" id="5533489">*</span><span class="ident" id="5533490">http</span><span class="op" id="5533494">.</span><span class="ident" id="5533495">Request</span><span class="op" id="5533502">)</span>&nbsp;<span class="op" id="5533504">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533507">w</span><span class="op" id="5533508">.</span><span class="ident" id="5533509">Header</span><span class="op" id="5533515">(</span><span class="op" id="5533516">)</span><span class="op" id="5533517">.</span><span class="ident" id="5533518">Set</span><span class="op" id="5533521">(</span><span class="string" id="5533522">&#34;Content-Type&#34;</span><span class="op" id="5533536">,</span>&nbsp;<span class="string" id="5533538">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5533565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5533569">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5533616">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533665">var</span>&nbsp;<span class="ident" id="5533669">buf</span>&nbsp;<span class="ident" id="5533673">bytes</span><span class="op" id="5533678">.</span><span class="ident" id="5533679">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5533688">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5533739">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5533797">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533849">fmt</span><span class="op" id="5533852">.</span><span class="ident" id="5533853">Fprintf</span><span class="op" id="5533860">(</span><span class="op" id="5533861">&amp;</span><span class="ident" id="5533862">buf</span><span class="op" id="5533865">,</span>&nbsp;<span class="string" id="5533867">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="5533885">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533889">var</span>&nbsp;<span class="ident" id="5533893">b</span>&nbsp;<span class="op" id="5533895">*</span><span class="ident" id="5533896">bufio</span><span class="op" id="5533901">.</span><span class="ident" id="5533902">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533910">if</span>&nbsp;<span class="ident" id="5533913">r</span><span class="op" id="5533914">.</span><span class="ident" id="5533915">Method</span>&nbsp;<span class="op" id="5533922">==</span>&nbsp;<span class="string" id="5533925">&#34;POST&#34;</span>&nbsp;<span class="op" id="5533932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533936">b</span>&nbsp;<span class="op" id="5533938">=</span>&nbsp;<span class="ident" id="5533940">bufio</span><span class="op" id="5533945">.</span><span class="ident" id="5533946">NewReader</span><span class="op" id="5533955">(</span><span class="ident" id="5533956">r</span><span class="op" id="5533957">.</span><span class="ident" id="5533958">Body</span><span class="op" id="5533962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533965">}</span>&nbsp;<span class="keyword" id="5533967">else</span>&nbsp;<span class="op" id="5533972">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533976">b</span>&nbsp;<span class="op" id="5533978">=</span>&nbsp;<span class="ident" id="5533980">bufio</span><span class="op" id="5533985">.</span><span class="ident" id="5533986">NewReader</span><span class="op" id="5533995">(</span><span class="ident" id="5533996">strings</span><span class="op" id="5534003">.</span><span class="ident" id="5534004">NewReader</span><span class="op" id="5534013">(</span><span class="ident" id="5534014">r</span><span class="op" id="5534015">.</span><span class="ident" id="5534016">URL</span><span class="op" id="5534019">.</span><span class="ident" id="5534020">RawQuery</span><span class="op" id="5534028">)</span><span class="op" id="5534029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534036">for</span>&nbsp;<span class="op" id="5534040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534044">word</span><span class="op" id="5534048">,</span>&nbsp;<span class="ident" id="5534050">err</span>&nbsp;<span class="op" id="5534054">:=</span>&nbsp;<span class="ident" id="5534057">b</span><span class="op" id="5534058">.</span><span class="ident" id="5534059">ReadSlice</span><span class="op" id="5534068">(</span><span class="string" id="5534069">&#39;+&#39;</span><span class="op" id="5534072">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534076">if</span>&nbsp;<span class="ident" id="5534079">err</span>&nbsp;<span class="op" id="5534083">==</span>&nbsp;<span class="ident" id="5534086">nil</span>&nbsp;<span class="op" id="5534090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534095">word</span>&nbsp;<span class="op" id="5534100">=</span>&nbsp;<span class="ident" id="5534102">word</span><span class="op" id="5534106">[</span><span class="num" id="5534107">0</span>&nbsp;<span class="op" id="5534109">:</span>&nbsp;<span class="builtinfunc" id="5534111">len</span><span class="op" id="5534114">(</span><span class="ident" id="5534115">word</span><span class="op" id="5534119">)</span><span class="op" id="5534120">-</span><span class="num" id="5534121">1</span><span class="op" id="5534122">]</span>&nbsp;<span class="comment" id="5534124">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534140">pc</span><span class="op" id="5534142">,</span>&nbsp;<span class="ident" id="5534144">_</span>&nbsp;<span class="op" id="5534146">:=</span>&nbsp;<span class="ident" id="5534149">strconv</span><span class="op" id="5534156">.</span><span class="ident" id="5534157">ParseUint</span><span class="op" id="5534166">(</span><span class="builtintype" id="5534167">string</span><span class="op" id="5534173">(</span><span class="ident" id="5534174">word</span><span class="op" id="5534178">)</span><span class="op" id="5534179">,</span>&nbsp;<span class="num" id="5534181">0</span><span class="op" id="5534182">,</span>&nbsp;<span class="num" id="5534184">64</span><span class="op" id="5534186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534190">if</span>&nbsp;<span class="ident" id="5534193">pc</span>&nbsp;<span class="op" id="5534196">!=</span>&nbsp;<span class="num" id="5534199">0</span>&nbsp;<span class="op" id="5534201">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534206">f</span>&nbsp;<span class="op" id="5534208">:=</span>&nbsp;<span class="ident" id="5534211">runtime</span><span class="op" id="5534218">.</span><span class="ident" id="5534219">FuncForPC</span><span class="op" id="5534228">(</span><span class="builtintype" id="5534229">uintptr</span><span class="op" id="5534236">(</span><span class="ident" id="5534237">pc</span><span class="op" id="5534239">)</span><span class="op" id="5534240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534245">if</span>&nbsp;<span class="ident" id="5534248">f</span>&nbsp;<span class="op" id="5534250">!=</span>&nbsp;<span class="ident" id="5534253">nil</span>&nbsp;<span class="op" id="5534257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534263">fmt</span><span class="op" id="5534266">.</span><span class="ident" id="5534267">Fprintf</span><span class="op" id="5534274">(</span><span class="op" id="5534275">&amp;</span><span class="ident" id="5534276">buf</span><span class="op" id="5534279">,</span>&nbsp;<span class="string" id="5534281">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="5534291">,</span>&nbsp;<span class="ident" id="5534293">pc</span><span class="op" id="5534295">,</span>&nbsp;<span class="ident" id="5534297">f</span><span class="op" id="5534298">.</span><span class="ident" id="5534299">Name</span><span class="op" id="5534303">(</span><span class="op" id="5534304">)</span><span class="op" id="5534305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534314">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534319">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534367">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534425">if</span>&nbsp;<span class="ident" id="5534428">err</span>&nbsp;<span class="op" id="5534432">!=</span>&nbsp;<span class="ident" id="5534435">nil</span>&nbsp;<span class="op" id="5534439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534444">if</span>&nbsp;<span class="ident" id="5534447">err</span>&nbsp;<span class="op" id="5534451">!=</span>&nbsp;<span class="ident" id="5534454">io</span><span class="op" id="5534456">.</span><span class="ident" id="5534457">EOF</span>&nbsp;<span class="op" id="5534461">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534467">fmt</span><span class="op" id="5534470">.</span><span class="ident" id="5534471">Fprintf</span><span class="op" id="5534478">(</span><span class="op" id="5534479">&amp;</span><span class="ident" id="5534480">buf</span><span class="op" id="5534483">,</span>&nbsp;<span class="string" id="5534485">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="5534508">,</span>&nbsp;<span class="ident" id="5534510">err</span><span class="op" id="5534513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534523">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534534">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534538">w</span><span class="op" id="5534539">.</span><span class="ident" id="5534540">Write</span><span class="op" id="5534545">(</span><span class="ident" id="5534546">buf</span><span class="op" id="5534549">.</span><span class="ident" id="5534550">Bytes</span><span class="op" id="5534555">(</span><span class="op" id="5534556">)</span><span class="op" id="5534557">)</span><br>
<span class="lineno"></span><span class="op" id="5534559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5534562">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="5534628">func</span>&nbsp;<span class="ident" id="5534633">Handler</span><span class="op" id="5534640">(</span><span class="ident" id="5534641">name</span>&nbsp;<span class="builtintype" id="5534646">string</span><span class="op" id="5534652">)</span>&nbsp;<span class="ident" id="5534654">http</span><span class="op" id="5534658">.</span><span class="ident" id="5534659">Handler</span>&nbsp;<span class="op" id="5534667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534670">return</span>&nbsp;<span class="ident" id="5534677">handler</span><span class="op" id="5534684">(</span><span class="ident" id="5534685">name</span><span class="op" id="5534689">)</span><br>
<span class="lineno"></span><span class="op" id="5534691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5534694">type</span>&nbsp;<span class="ident" id="5534699">handler</span>&nbsp;<span class="builtintype" id="5534707">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5534715">func</span>&nbsp;<span class="op" id="5534720">(</span><span class="ident" id="5534721">name</span>&nbsp;<span class="ident" id="5534726">handler</span><span class="op" id="5534733">)</span>&nbsp;<span class="ident" id="5534735">ServeHTTP</span><span class="op" id="5534744">(</span><span class="ident" id="5534745">w</span>&nbsp;<span class="ident" id="5534747">http</span><span class="op" id="5534751">.</span><span class="ident" id="5534752">ResponseWriter</span><span class="op" id="5534766">,</span>&nbsp;<span class="ident" id="5534768">r</span>&nbsp;<span class="op" id="5534770">*</span><span class="ident" id="5534771">http</span><span class="op" id="5534775">.</span><span class="ident" id="5534776">Request</span><span class="op" id="5534783">)</span>&nbsp;<span class="op" id="5534785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534788">w</span><span class="op" id="5534789">.</span><span class="ident" id="5534790">Header</span><span class="op" id="5534796">(</span><span class="op" id="5534797">)</span><span class="op" id="5534798">.</span><span class="ident" id="5534799">Set</span><span class="op" id="5534802">(</span><span class="string" id="5534803">&#34;Content-Type&#34;</span><span class="op" id="5534817">,</span>&nbsp;<span class="string" id="5534819">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5534846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534849">debug</span><span class="op" id="5534854">,</span>&nbsp;<span class="ident" id="5534856">_</span>&nbsp;<span class="op" id="5534858">:=</span>&nbsp;<span class="ident" id="5534861">strconv</span><span class="op" id="5534868">.</span><span class="ident" id="5534869">Atoi</span><span class="op" id="5534873">(</span><span class="ident" id="5534874">r</span><span class="op" id="5534875">.</span><span class="ident" id="5534876">FormValue</span><span class="op" id="5534885">(</span><span class="string" id="5534886">&#34;debug&#34;</span><span class="op" id="5534893">)</span><span class="op" id="5534894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534897">p</span>&nbsp;<span class="op" id="5534899">:=</span>&nbsp;<span class="ident" id="5534902">pprof</span><span class="op" id="5534907">.</span><span class="ident" id="5534908">Lookup</span><span class="op" id="5534914">(</span><span class="builtintype" id="5534915">string</span><span class="op" id="5534921">(</span><span class="ident" id="5534922">name</span><span class="op" id="5534926">)</span><span class="op" id="5534927">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534930">if</span>&nbsp;<span class="ident" id="5534933">p</span>&nbsp;<span class="op" id="5534935">==</span>&nbsp;<span class="ident" id="5534938">nil</span>&nbsp;<span class="op" id="5534942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534946">w</span><span class="op" id="5534947">.</span><span class="ident" id="5534948">WriteHeader</span><span class="op" id="5534959">(</span><span class="num" id="5534960">404</span><span class="op" id="5534963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534967">fmt</span><span class="op" id="5534970">.</span><span class="ident" id="5534971">Fprintf</span><span class="op" id="5534978">(</span><span class="ident" id="5534979">w</span><span class="op" id="5534980">,</span>&nbsp;<span class="string" id="5534982">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="5535005">,</span>&nbsp;<span class="ident" id="5535007">name</span><span class="op" id="5535011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535015">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535023">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535026">gc</span><span class="op" id="5535028">,</span>&nbsp;<span class="ident" id="5535030">_</span>&nbsp;<span class="op" id="5535032">:=</span>&nbsp;<span class="ident" id="5535035">strconv</span><span class="op" id="5535042">.</span><span class="ident" id="5535043">Atoi</span><span class="op" id="5535047">(</span><span class="ident" id="5535048">r</span><span class="op" id="5535049">.</span><span class="ident" id="5535050">FormValue</span><span class="op" id="5535059">(</span><span class="string" id="5535060">&#34;gc&#34;</span><span class="op" id="5535064">)</span><span class="op" id="5535065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535068">if</span>&nbsp;<span class="ident" id="5535071">name</span>&nbsp;<span class="op" id="5535076">==</span>&nbsp;<span class="string" id="5535079">&#34;heap&#34;</span>&nbsp;<span class="op" id="5535086">&amp;&amp;</span>&nbsp;<span class="ident" id="5535089">gc</span>&nbsp;<span class="op" id="5535092">&gt;</span>&nbsp;<span class="num" id="5535094">0</span>&nbsp;<span class="op" id="5535096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535100">runtime</span><span class="op" id="5535107">.</span><span class="ident" id="5535108">GC</span><span class="op" id="5535110">(</span><span class="op" id="5535111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535117">p</span><span class="op" id="5535118">.</span><span class="ident" id="5535119">WriteTo</span><span class="op" id="5535126">(</span><span class="ident" id="5535127">w</span><span class="op" id="5535128">,</span>&nbsp;<span class="ident" id="5535130">debug</span><span class="op" id="5535135">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535138">return</span><br>
<span class="lineno"></span><span class="op" id="5535145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5535148">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5535221">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="5535284">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="5535353">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="5535388">func</span>&nbsp;<span class="ident" id="5535393">Index</span><span class="op" id="5535398">(</span><span class="ident" id="5535399">w</span>&nbsp;<span class="ident" id="5535401">http</span><span class="op" id="5535405">.</span><span class="ident" id="5535406">ResponseWriter</span><span class="op" id="5535420">,</span>&nbsp;<span class="ident" id="5535422">r</span>&nbsp;<span class="op" id="5535424">*</span><span class="ident" id="5535425">http</span><span class="op" id="5535429">.</span><span class="ident" id="5535430">Request</span><span class="op" id="5535437">)</span>&nbsp;<span class="op" id="5535439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535442">if</span>&nbsp;<span class="ident" id="5535445">strings</span><span class="op" id="5535452">.</span><span class="ident" id="5535453">HasPrefix</span><span class="op" id="5535462">(</span><span class="ident" id="5535463">r</span><span class="op" id="5535464">.</span><span class="ident" id="5535465">URL</span><span class="op" id="5535468">.</span><span class="ident" id="5535469">Path</span><span class="op" id="5535473">,</span>&nbsp;<span class="string" id="5535475">&#34;/debug/pprof/&#34;</span><span class="op" id="5535490">)</span>&nbsp;<span class="op" id="5535492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535496">name</span>&nbsp;<span class="op" id="5535501">:=</span>&nbsp;<span class="ident" id="5535504">strings</span><span class="op" id="5535511">.</span><span class="ident" id="5535512">TrimPrefix</span><span class="op" id="5535522">(</span><span class="ident" id="5535523">r</span><span class="op" id="5535524">.</span><span class="ident" id="5535525">URL</span><span class="op" id="5535528">.</span><span class="ident" id="5535529">Path</span><span class="op" id="5535533">,</span>&nbsp;<span class="string" id="5535535">&#34;/debug/pprof/&#34;</span><span class="op" id="5535550">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535554">if</span>&nbsp;<span class="ident" id="5535557">name</span>&nbsp;<span class="op" id="5535562">!=</span>&nbsp;<span class="string" id="5535565">&#34;&#34;</span>&nbsp;<span class="op" id="5535568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535573">handler</span><span class="op" id="5535580">(</span><span class="ident" id="5535581">name</span><span class="op" id="5535585">)</span><span class="op" id="5535586">.</span><span class="ident" id="5535587">ServeHTTP</span><span class="op" id="5535596">(</span><span class="ident" id="5535597">w</span><span class="op" id="5535598">,</span>&nbsp;<span class="ident" id="5535600">r</span><span class="op" id="5535601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535606">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535618">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535622">profiles</span>&nbsp;<span class="op" id="5535631">:=</span>&nbsp;<span class="ident" id="5535634">pprof</span><span class="op" id="5535639">.</span><span class="ident" id="5535640">Profiles</span><span class="op" id="5535648">(</span><span class="op" id="5535649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535652">if</span>&nbsp;<span class="ident" id="5535655">err</span>&nbsp;<span class="op" id="5535659">:=</span>&nbsp;<span class="ident" id="5535662">indexTmpl</span><span class="op" id="5535671">.</span><span class="ident" id="5535672">Execute</span><span class="op" id="5535679">(</span><span class="ident" id="5535680">w</span><span class="op" id="5535681">,</span>&nbsp;<span class="ident" id="5535683">profiles</span><span class="op" id="5535691">)</span><span class="op" id="5535692">;</span>&nbsp;<span class="ident" id="5535694">err</span>&nbsp;<span class="op" id="5535698">!=</span>&nbsp;<span class="ident" id="5535701">nil</span>&nbsp;<span class="op" id="5535705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535709">log</span><span class="op" id="5535712">.</span><span class="ident" id="5535713">Print</span><span class="op" id="5535718">(</span><span class="ident" id="5535719">err</span><span class="op" id="5535722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535725">}</span><br>
<span class="lineno">190</span><span class="op" id="5535727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5535730">var</span>&nbsp;<span class="ident" id="5535734">indexTmpl</span>&nbsp;<span class="op" id="5535744">=</span>&nbsp;<span class="ident" id="5535746">template</span><span class="op" id="5535754">.</span><span class="ident" id="5535755">Must</span><span class="op" id="5535759">(</span><span class="ident" id="5535760">template</span><span class="op" id="5535768">.</span><span class="ident" id="5535769">New</span><span class="op" id="5535772">(</span><span class="string" id="5535773">&#34;index&#34;</span><span class="op" id="5535780">)</span><span class="op" id="5535781">.</span><span class="ident" id="5535782">Parse</span><span class="op" id="5535787">(</span><span class="string" id="5535788">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="5536107">)</span><span class="op" id="5536108">)</span>
</div>
</body>
</html>
