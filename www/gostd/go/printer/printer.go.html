<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html" class="current">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5180749">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5180804">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5180858">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5180909">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="5180962">package</span>&nbsp;<span class="ident" id="5180970">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5180979">import</span>&nbsp;<span class="op" id="5180986">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5180989">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5180996">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5181006">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5181018">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5181024">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5181030">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5181041">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5181052">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5181070">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5181080">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5181083">const</span>&nbsp;<span class="op" id="5181089">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181092">maxNewlines</span>&nbsp;<span class="op" id="5181104">=</span>&nbsp;<span class="num" id="5181106">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181112">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181160">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5181172">=</span>&nbsp;<span class="builtintype" id="5181174">false</span>&nbsp;<span class="comment" id="5181180">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181205">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5181217">=</span>&nbsp;<span class="num" id="5181219">1</span>&nbsp;<span class="op" id="5181221">&lt;&lt;</span>&nbsp;<span class="num" id="5181224">30</span><br>
<span class="lineno"></span><span class="op" id="5181227">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5181230">type</span>&nbsp;<span class="ident" id="5181235">whiteSpace</span>&nbsp;<span class="builtintype" id="5181246">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5181252">const</span>&nbsp;<span class="op" id="5181258">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181261">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5181270">=</span>&nbsp;<span class="ident" id="5181272">whiteSpace</span><span class="op" id="5181282">(</span><span class="num" id="5181283">0</span><span class="op" id="5181284">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181287">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5181296">=</span>&nbsp;<span class="ident" id="5181298">whiteSpace</span><span class="op" id="5181308">(</span><span class="string" id="5181309">&#39;&nbsp;&#39;</span><span class="op" id="5181312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181315">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5181324">=</span>&nbsp;<span class="ident" id="5181326">whiteSpace</span><span class="op" id="5181336">(</span><span class="string" id="5181337">&#39;\v&#39;</span><span class="op" id="5181341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181344">newline</span>&nbsp;&nbsp;<span class="op" id="5181353">=</span>&nbsp;<span class="ident" id="5181355">whiteSpace</span><span class="op" id="5181365">(</span><span class="string" id="5181366">&#39;\n&#39;</span><span class="op" id="5181370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181373">formfeed</span>&nbsp;<span class="op" id="5181382">=</span>&nbsp;<span class="ident" id="5181384">whiteSpace</span><span class="op" id="5181394">(</span><span class="string" id="5181395">&#39;\f&#39;</span><span class="op" id="5181399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181402">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5181411">=</span>&nbsp;<span class="ident" id="5181413">whiteSpace</span><span class="op" id="5181423">(</span><span class="string" id="5181424">&#39;&gt;&#39;</span><span class="op" id="5181427">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181430">unindent</span>&nbsp;<span class="op" id="5181439">=</span>&nbsp;<span class="ident" id="5181441">whiteSpace</span><span class="op" id="5181451">(</span><span class="string" id="5181452">&#39;&lt;&#39;</span><span class="op" id="5181455">)</span><br>
<span class="lineno"></span><span class="op" id="5181457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5181460">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="5181514">type</span>&nbsp;<span class="ident" id="5181519">pmode</span>&nbsp;<span class="builtintype" id="5181525">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5181530">const</span>&nbsp;<span class="op" id="5181536">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181539">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5181556">pmode</span>&nbsp;<span class="op" id="5181562">=</span>&nbsp;<span class="num" id="5181564">1</span>&nbsp;<span class="op" id="5181566">&lt;&lt;</span>&nbsp;<span class="ident" id="5181569">iota</span>&nbsp;<span class="comment" id="5181574">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181622">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181657">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="5181709">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5181712">type</span>&nbsp;<span class="ident" id="5181717">commentInfo</span>&nbsp;<span class="keyword" id="5181729">struct</span>&nbsp;<span class="op" id="5181736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181739">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5181754">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181772">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181798">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5181813">*</span><span class="ident" id="5181814">ast</span><span class="op" id="5181817">.</span><span class="ident" id="5181818">CommentGroup</span>&nbsp;<span class="comment" id="5181831">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181870">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="5181885">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181903">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181984">commentNewline</span>&nbsp;<span class="builtintype" id="5181999">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5182017">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="5182064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5182067">type</span>&nbsp;<span class="ident" id="5182072">printer</span>&nbsp;<span class="keyword" id="5182080">struct</span>&nbsp;<span class="op" id="5182087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5182090">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182147">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182155">fset</span>&nbsp;<span class="op" id="5182160">*</span><span class="ident" id="5182161">token</span><span class="op" id="5182166">.</span><span class="ident" id="5182167">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5182177">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182195">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5182207">[</span><span class="op" id="5182208">]</span><span class="builtintype" id="5182209">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5182220">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182243">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182255">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5182268">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182292">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5182304">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5182317">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182342">impliedSemi</span>&nbsp;<span class="builtintype" id="5182354">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5182367">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182411">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5182423">token</span><span class="op" id="5182428">.</span><span class="ident" id="5182429">Token</span>&nbsp;&nbsp;<span class="comment" id="5182436">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182494">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5182506">token</span><span class="op" id="5182511">.</span><span class="ident" id="5182512">Token</span>&nbsp;&nbsp;<span class="comment" id="5182519">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182578">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5182590">[</span><span class="op" id="5182591">]</span><span class="ident" id="5182592">whiteSpace</span>&nbsp;<span class="comment" id="5182603">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5182628">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5182642">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5182709">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5182777">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5182843">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5182909">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182953">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5182961">token</span><span class="op" id="5182966">.</span><span class="ident" id="5182967">Position</span>&nbsp;<span class="comment" id="5182976">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183019">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5183027">token</span><span class="op" id="5183032">.</span><span class="ident" id="5183033">Position</span>&nbsp;<span class="comment" id="5183042">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183079">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5183087">token</span><span class="op" id="5183092">.</span><span class="ident" id="5183093">Position</span>&nbsp;<span class="comment" id="5183102">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183145">linePtr</span>&nbsp;<span class="op" id="5183153">*</span><span class="builtintype" id="5183154">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5183168">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183228">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183289">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5183305">[</span><span class="op" id="5183306">]</span><span class="op" id="5183307">*</span><span class="ident" id="5183308">ast</span><span class="op" id="5183311">.</span><span class="ident" id="5183312">CommentGroup</span>&nbsp;<span class="comment" id="5183325">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183340">useNodeComments</span>&nbsp;<span class="builtintype" id="5183356">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5183376">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183432">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183499">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183513">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183555">nodeSizes</span>&nbsp;<span class="keyword" id="5183565">map</span><span class="op" id="5183568">[</span><span class="ident" id="5183569">ast</span><span class="op" id="5183572">.</span><span class="ident" id="5183573">Node</span><span class="op" id="5183577">]</span><span class="builtintype" id="5183578">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183584">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183635">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="5183646">token</span><span class="op" id="5183651">.</span><span class="ident" id="5183652">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183657">cachedLine</span>&nbsp;<span class="builtintype" id="5183668">int</span>&nbsp;<span class="comment" id="5183672">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="5183707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5183710">func</span>&nbsp;<span class="op" id="5183715">(</span><span class="ident" id="5183716">p</span>&nbsp;<span class="op" id="5183718">*</span><span class="ident" id="5183719">printer</span><span class="op" id="5183726">)</span>&nbsp;<span class="ident" id="5183728">init</span><span class="op" id="5183732">(</span><span class="ident" id="5183733">cfg</span>&nbsp;<span class="op" id="5183737">*</span><span class="ident" id="5183738">Config</span><span class="op" id="5183744">,</span>&nbsp;<span class="ident" id="5183746">fset</span>&nbsp;<span class="op" id="5183751">*</span><span class="ident" id="5183752">token</span><span class="op" id="5183757">.</span><span class="ident" id="5183758">FileSet</span><span class="op" id="5183765">,</span>&nbsp;<span class="ident" id="5183767">nodeSizes</span>&nbsp;<span class="keyword" id="5183777">map</span><span class="op" id="5183780">[</span><span class="ident" id="5183781">ast</span><span class="op" id="5183784">.</span><span class="ident" id="5183785">Node</span><span class="op" id="5183789">]</span><span class="builtintype" id="5183790">int</span><span class="op" id="5183793">)</span>&nbsp;<span class="op" id="5183795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183798">p</span><span class="op" id="5183799">.</span><span class="ident" id="5183800">Config</span>&nbsp;<span class="op" id="5183807">=</span>&nbsp;<span class="op" id="5183809">*</span><span class="ident" id="5183810">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183815">p</span><span class="op" id="5183816">.</span><span class="ident" id="5183817">fset</span>&nbsp;<span class="op" id="5183822">=</span>&nbsp;<span class="ident" id="5183824">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183830">p</span><span class="op" id="5183831">.</span><span class="ident" id="5183832">pos</span>&nbsp;<span class="op" id="5183836">=</span>&nbsp;<span class="ident" id="5183838">token</span><span class="op" id="5183843">.</span><span class="ident" id="5183844">Position</span><span class="op" id="5183852">{</span><span class="ident" id="5183853">Line</span><span class="op" id="5183857">:</span>&nbsp;<span class="num" id="5183859">1</span><span class="op" id="5183860">,</span>&nbsp;<span class="ident" id="5183862">Column</span><span class="op" id="5183868">:</span>&nbsp;<span class="num" id="5183870">1</span><span class="op" id="5183871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183874">p</span><span class="op" id="5183875">.</span><span class="ident" id="5183876">out</span>&nbsp;<span class="op" id="5183880">=</span>&nbsp;<span class="ident" id="5183882">token</span><span class="op" id="5183887">.</span><span class="ident" id="5183888">Position</span><span class="op" id="5183896">{</span><span class="ident" id="5183897">Line</span><span class="op" id="5183901">:</span>&nbsp;<span class="num" id="5183903">1</span><span class="op" id="5183904">,</span>&nbsp;<span class="ident" id="5183906">Column</span><span class="op" id="5183912">:</span>&nbsp;<span class="num" id="5183914">1</span><span class="op" id="5183915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183918">p</span><span class="op" id="5183919">.</span><span class="ident" id="5183920">wsbuf</span>&nbsp;<span class="op" id="5183926">=</span>&nbsp;<span class="builtinfunc" id="5183928">make</span><span class="op" id="5183932">(</span><span class="op" id="5183933">[</span><span class="op" id="5183934">]</span><span class="ident" id="5183935">whiteSpace</span><span class="op" id="5183945">,</span>&nbsp;<span class="num" id="5183947">0</span><span class="op" id="5183948">,</span>&nbsp;<span class="num" id="5183950">16</span><span class="op" id="5183952">)</span>&nbsp;<span class="comment" id="5183954">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183989">p</span><span class="op" id="5183990">.</span><span class="ident" id="5183991">nodeSizes</span>&nbsp;<span class="op" id="5184001">=</span>&nbsp;<span class="ident" id="5184003">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184014">p</span><span class="op" id="5184015">.</span><span class="ident" id="5184016">cachedPos</span>&nbsp;<span class="op" id="5184026">=</span>&nbsp;<span class="op" id="5184028">-</span><span class="num" id="5184029">1</span><br>
<span class="lineno"></span><span class="op" id="5184031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5184034">func</span>&nbsp;<span class="op" id="5184039">(</span><span class="ident" id="5184040">p</span>&nbsp;<span class="op" id="5184042">*</span><span class="ident" id="5184043">printer</span><span class="op" id="5184050">)</span>&nbsp;<span class="ident" id="5184052">internalError</span><span class="op" id="5184065">(</span><span class="ident" id="5184066">msg</span>&nbsp;<span class="op" id="5184070">...</span><span class="keyword" id="5184073">interface</span><span class="op" id="5184082">{</span><span class="op" id="5184083">}</span><span class="op" id="5184084">)</span>&nbsp;<span class="op" id="5184086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184089">if</span>&nbsp;<span class="ident" id="5184092">debug</span>&nbsp;<span class="op" id="5184098">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184102">fmt</span><span class="op" id="5184105">.</span><span class="ident" id="5184106">Print</span><span class="op" id="5184111">(</span><span class="ident" id="5184112">p</span><span class="op" id="5184113">.</span><span class="ident" id="5184114">pos</span><span class="op" id="5184117">.</span><span class="ident" id="5184118">String</span><span class="op" id="5184124">(</span><span class="op" id="5184125">)</span>&nbsp;<span class="op" id="5184127">+</span>&nbsp;<span class="string" id="5184129">&#34;:&nbsp;&#34;</span><span class="op" id="5184133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184137">fmt</span><span class="op" id="5184140">.</span><span class="ident" id="5184141">Println</span><span class="op" id="5184148">(</span><span class="ident" id="5184149">msg</span><span class="op" id="5184152">...</span><span class="op" id="5184155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5184159">panic</span><span class="op" id="5184164">(</span><span class="string" id="5184165">&#34;go/printer&#34;</span><span class="op" id="5184177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184180">}</span><br>
<span class="lineno"></span><span class="op" id="5184182">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5184185">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5184256">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5184332">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5184405">func</span>&nbsp;<span class="op" id="5184410">(</span><span class="ident" id="5184411">p</span>&nbsp;<span class="op" id="5184413">*</span><span class="ident" id="5184414">printer</span><span class="op" id="5184421">)</span>&nbsp;<span class="ident" id="5184423">commentsHaveNewline</span><span class="op" id="5184442">(</span><span class="ident" id="5184443">list</span>&nbsp;<span class="op" id="5184448">[</span><span class="op" id="5184449">]</span><span class="op" id="5184450">*</span><span class="ident" id="5184451">ast</span><span class="op" id="5184454">.</span><span class="ident" id="5184455">Comment</span><span class="op" id="5184462">)</span>&nbsp;<span class="builtintype" id="5184464">bool</span>&nbsp;<span class="op" id="5184469">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5184472">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184490">line</span>&nbsp;<span class="op" id="5184495">:=</span>&nbsp;<span class="ident" id="5184498">p</span><span class="op" id="5184499">.</span><span class="ident" id="5184500">lineFor</span><span class="op" id="5184507">(</span><span class="ident" id="5184508">list</span><span class="op" id="5184512">[</span><span class="num" id="5184513">0</span><span class="op" id="5184514">]</span><span class="op" id="5184515">.</span><span class="ident" id="5184516">Pos</span><span class="op" id="5184519">(</span><span class="op" id="5184520">)</span><span class="op" id="5184521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184524">for</span>&nbsp;<span class="ident" id="5184528">i</span><span class="op" id="5184529">,</span>&nbsp;<span class="ident" id="5184531">c</span>&nbsp;<span class="op" id="5184533">:=</span>&nbsp;<span class="keyword" id="5184536">range</span>&nbsp;<span class="ident" id="5184542">list</span>&nbsp;<span class="op" id="5184547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184551">if</span>&nbsp;<span class="ident" id="5184554">i</span>&nbsp;<span class="op" id="5184556">&gt;</span>&nbsp;<span class="num" id="5184558">0</span>&nbsp;<span class="op" id="5184560">&amp;&amp;</span>&nbsp;<span class="ident" id="5184563">p</span><span class="op" id="5184564">.</span><span class="ident" id="5184565">lineFor</span><span class="op" id="5184572">(</span><span class="ident" id="5184573">list</span><span class="op" id="5184577">[</span><span class="ident" id="5184578">i</span><span class="op" id="5184579">]</span><span class="op" id="5184580">.</span><span class="ident" id="5184581">Pos</span><span class="op" id="5184584">(</span><span class="op" id="5184585">)</span><span class="op" id="5184586">)</span>&nbsp;<span class="op" id="5184588">!=</span>&nbsp;<span class="ident" id="5184591">line</span>&nbsp;<span class="op" id="5184596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5184601">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184641">return</span>&nbsp;<span class="builtintype" id="5184648">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184659">if</span>&nbsp;<span class="ident" id="5184662">t</span>&nbsp;<span class="op" id="5184664">:=</span>&nbsp;<span class="ident" id="5184667">c</span><span class="op" id="5184668">.</span><span class="ident" id="5184669">Text</span><span class="op" id="5184673">;</span>&nbsp;<span class="builtinfunc" id="5184675">len</span><span class="op" id="5184678">(</span><span class="ident" id="5184679">t</span><span class="op" id="5184680">)</span>&nbsp;<span class="op" id="5184682">&gt;=</span>&nbsp;<span class="num" id="5184685">2</span>&nbsp;<span class="op" id="5184687">&amp;&amp;</span>&nbsp;<span class="op" id="5184690">(</span><span class="ident" id="5184691">t</span><span class="op" id="5184692">[</span><span class="num" id="5184693">1</span><span class="op" id="5184694">]</span>&nbsp;<span class="op" id="5184696">==</span>&nbsp;<span class="string" id="5184699">&#39;/&#39;</span>&nbsp;<span class="op" id="5184703">||</span>&nbsp;<span class="ident" id="5184706">strings</span><span class="op" id="5184713">.</span><span class="ident" id="5184714">Contains</span><span class="op" id="5184722">(</span><span class="ident" id="5184723">t</span><span class="op" id="5184724">,</span>&nbsp;<span class="string" id="5184726">&#34;\n&#34;</span><span class="op" id="5184730">)</span><span class="op" id="5184731">)</span>&nbsp;<span class="op" id="5184733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184738">return</span>&nbsp;<span class="builtintype" id="5184745">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184752">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184758">_</span>&nbsp;<span class="op" id="5184760">=</span>&nbsp;<span class="ident" id="5184762">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184768">return</span>&nbsp;<span class="builtintype" id="5184775">false</span><br>
<span class="lineno"></span><span class="op" id="5184781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5184784">func</span>&nbsp;<span class="op" id="5184789">(</span><span class="ident" id="5184790">p</span>&nbsp;<span class="op" id="5184792">*</span><span class="ident" id="5184793">printer</span><span class="op" id="5184800">)</span>&nbsp;<span class="ident" id="5184802">nextComment</span><span class="op" id="5184813">(</span><span class="op" id="5184814">)</span>&nbsp;<span class="op" id="5184816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184819">for</span>&nbsp;<span class="ident" id="5184823">p</span><span class="op" id="5184824">.</span><span class="ident" id="5184825">cindex</span>&nbsp;<span class="op" id="5184832">&lt;</span>&nbsp;<span class="builtinfunc" id="5184834">len</span><span class="op" id="5184837">(</span><span class="ident" id="5184838">p</span><span class="op" id="5184839">.</span><span class="ident" id="5184840">comments</span><span class="op" id="5184848">)</span>&nbsp;<span class="op" id="5184850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184854">c</span>&nbsp;<span class="op" id="5184856">:=</span>&nbsp;<span class="ident" id="5184859">p</span><span class="op" id="5184860">.</span><span class="ident" id="5184861">comments</span><span class="op" id="5184869">[</span><span class="ident" id="5184870">p</span><span class="op" id="5184871">.</span><span class="ident" id="5184872">cindex</span><span class="op" id="5184878">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184882">p</span><span class="op" id="5184883">.</span><span class="ident" id="5184884">cindex</span><span class="op" id="5184890">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184895">if</span>&nbsp;<span class="ident" id="5184898">list</span>&nbsp;<span class="op" id="5184903">:=</span>&nbsp;<span class="ident" id="5184906">c</span><span class="op" id="5184907">.</span><span class="ident" id="5184908">List</span><span class="op" id="5184912">;</span>&nbsp;<span class="builtinfunc" id="5184914">len</span><span class="op" id="5184917">(</span><span class="ident" id="5184918">list</span><span class="op" id="5184922">)</span>&nbsp;<span class="op" id="5184924">&gt;</span>&nbsp;<span class="num" id="5184926">0</span>&nbsp;<span class="op" id="5184928">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184933">p</span><span class="op" id="5184934">.</span><span class="ident" id="5184935">comment</span>&nbsp;<span class="op" id="5184943">=</span>&nbsp;<span class="ident" id="5184945">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184950">p</span><span class="op" id="5184951">.</span><span class="ident" id="5184952">commentOffset</span>&nbsp;<span class="op" id="5184966">=</span>&nbsp;<span class="ident" id="5184968">p</span><span class="op" id="5184969">.</span><span class="ident" id="5184970">posFor</span><span class="op" id="5184976">(</span><span class="ident" id="5184977">list</span><span class="op" id="5184981">[</span><span class="num" id="5184982">0</span><span class="op" id="5184983">]</span><span class="op" id="5184984">.</span><span class="ident" id="5184985">Pos</span><span class="op" id="5184988">(</span><span class="op" id="5184989">)</span><span class="op" id="5184990">)</span><span class="op" id="5184991">.</span><span class="ident" id="5184992">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185002">p</span><span class="op" id="5185003">.</span><span class="ident" id="5185004">commentNewline</span>&nbsp;<span class="op" id="5185019">=</span>&nbsp;<span class="ident" id="5185021">p</span><span class="op" id="5185022">.</span><span class="ident" id="5185023">commentsHaveNewline</span><span class="op" id="5185042">(</span><span class="ident" id="5185043">list</span><span class="op" id="5185047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185052">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5185061">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185065">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185126">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5185189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185192">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185213">p</span><span class="op" id="5185214">.</span><span class="ident" id="5185215">commentOffset</span>&nbsp;<span class="op" id="5185229">=</span>&nbsp;<span class="ident" id="5185231">infinity</span><br>
<span class="lineno">145</span><span class="op" id="5185240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5185243">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="5185310">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5185378">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="5185416">//</span><br>
<span class="lineno"></span><span class="keyword" id="5185419">func</span>&nbsp;<span class="op" id="5185424">(</span><span class="ident" id="5185425">p</span>&nbsp;<span class="op" id="5185427">*</span><span class="ident" id="5185428">printer</span><span class="op" id="5185435">)</span>&nbsp;<span class="ident" id="5185437">commentBefore</span><span class="op" id="5185450">(</span><span class="ident" id="5185451">next</span>&nbsp;<span class="ident" id="5185456">token</span><span class="op" id="5185461">.</span><span class="ident" id="5185462">Position</span><span class="op" id="5185470">)</span>&nbsp;<span class="builtintype" id="5185472">bool</span>&nbsp;<span class="op" id="5185477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185480">return</span>&nbsp;<span class="ident" id="5185487">p</span><span class="op" id="5185488">.</span><span class="ident" id="5185489">commentOffset</span>&nbsp;<span class="op" id="5185503">&lt;</span>&nbsp;<span class="ident" id="5185505">next</span><span class="op" id="5185509">.</span><span class="ident" id="5185510">Offset</span>&nbsp;<span class="op" id="5185517">&amp;&amp;</span>&nbsp;<span class="op" id="5185520">(</span><span class="op" id="5185521">!</span><span class="ident" id="5185522">p</span><span class="op" id="5185523">.</span><span class="ident" id="5185524">impliedSemi</span>&nbsp;<span class="op" id="5185536">||</span>&nbsp;<span class="op" id="5185539">!</span><span class="ident" id="5185540">p</span><span class="op" id="5185541">.</span><span class="ident" id="5185542">commentNewline</span><span class="op" id="5185556">)</span><br>
<span class="lineno"></span><span class="op" id="5185558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="5185561">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5185616">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5185671">//</span><br>
<span class="lineno"></span><span class="keyword" id="5185674">func</span>&nbsp;<span class="op" id="5185679">(</span><span class="ident" id="5185680">p</span>&nbsp;<span class="op" id="5185682">*</span><span class="ident" id="5185683">printer</span><span class="op" id="5185690">)</span>&nbsp;<span class="ident" id="5185692">commentSizeBefore</span><span class="op" id="5185709">(</span><span class="ident" id="5185710">next</span>&nbsp;<span class="ident" id="5185715">token</span><span class="op" id="5185720">.</span><span class="ident" id="5185721">Position</span><span class="op" id="5185729">)</span>&nbsp;<span class="builtintype" id="5185731">int</span>&nbsp;<span class="op" id="5185735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185738">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185807">defer</span>&nbsp;<span class="keyword" id="5185813">func</span><span class="op" id="5185817">(</span><span class="ident" id="5185818">info</span>&nbsp;<span class="ident" id="5185823">commentInfo</span><span class="op" id="5185834">)</span>&nbsp;<span class="op" id="5185836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185840">p</span><span class="op" id="5185841">.</span><span class="ident" id="5185842">commentInfo</span>&nbsp;<span class="op" id="5185854">=</span>&nbsp;<span class="ident" id="5185856">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5185862">}</span><span class="op" id="5185863">(</span><span class="ident" id="5185864">p</span><span class="op" id="5185865">.</span><span class="ident" id="5185866">commentInfo</span><span class="op" id="5185877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185881">size</span>&nbsp;<span class="op" id="5185886">:=</span>&nbsp;<span class="num" id="5185889">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185892">for</span>&nbsp;<span class="ident" id="5185896">p</span><span class="op" id="5185897">.</span><span class="ident" id="5185898">commentBefore</span><span class="op" id="5185911">(</span><span class="ident" id="5185912">next</span><span class="op" id="5185916">)</span>&nbsp;<span class="op" id="5185918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185922">for</span>&nbsp;<span class="ident" id="5185926">_</span><span class="op" id="5185927">,</span>&nbsp;<span class="ident" id="5185929">c</span>&nbsp;<span class="op" id="5185931">:=</span>&nbsp;<span class="keyword" id="5185934">range</span>&nbsp;<span class="ident" id="5185940">p</span><span class="op" id="5185941">.</span><span class="ident" id="5185942">comment</span><span class="op" id="5185949">.</span><span class="ident" id="5185950">List</span>&nbsp;<span class="op" id="5185955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185960">size</span>&nbsp;<span class="op" id="5185965">+=</span>&nbsp;<span class="builtinfunc" id="5185968">len</span><span class="op" id="5185971">(</span><span class="ident" id="5185972">c</span><span class="op" id="5185973">.</span><span class="ident" id="5185974">Text</span><span class="op" id="5185978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5185982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185986">p</span><span class="op" id="5185987">.</span><span class="ident" id="5185988">nextComment</span><span class="op" id="5185999">(</span><span class="op" id="5186000">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5186003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5186006">return</span>&nbsp;<span class="ident" id="5186013">size</span><br>
<span class="lineno"></span><span class="op" id="5186018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5186021">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="5186094">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5186168">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5186244">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5186260">//</span><br>
<span class="lineno"></span><span class="keyword" id="5186263">func</span>&nbsp;<span class="op" id="5186268">(</span><span class="ident" id="5186269">p</span>&nbsp;<span class="op" id="5186271">*</span><span class="ident" id="5186272">printer</span><span class="op" id="5186279">)</span>&nbsp;<span class="ident" id="5186281">recordLine</span><span class="op" id="5186291">(</span><span class="ident" id="5186292">linePtr</span>&nbsp;<span class="op" id="5186300">*</span><span class="builtintype" id="5186301">int</span><span class="op" id="5186304">)</span>&nbsp;<span class="op" id="5186306">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5186309">p</span><span class="op" id="5186310">.</span><span class="ident" id="5186311">linePtr</span>&nbsp;<span class="op" id="5186319">=</span>&nbsp;<span class="ident" id="5186321">linePtr</span><br>
<span class="lineno"></span><span class="op" id="5186329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5186332">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="5186400">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="5186468">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="5186538">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="5186594">//</span><br>
<span class="lineno"></span><span class="keyword" id="5186597">func</span>&nbsp;<span class="op" id="5186602">(</span><span class="ident" id="5186603">p</span>&nbsp;<span class="op" id="5186605">*</span><span class="ident" id="5186606">printer</span><span class="op" id="5186613">)</span>&nbsp;<span class="ident" id="5186615">linesFrom</span><span class="op" id="5186624">(</span><span class="ident" id="5186625">line</span>&nbsp;<span class="builtintype" id="5186630">int</span><span class="op" id="5186633">)</span>&nbsp;<span class="builtintype" id="5186635">int</span>&nbsp;<span class="op" id="5186639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5186642">return</span>&nbsp;<span class="ident" id="5186649">p</span><span class="op" id="5186650">.</span><span class="ident" id="5186651">out</span><span class="op" id="5186654">.</span><span class="ident" id="5186655">Line</span>&nbsp;<span class="op" id="5186660">-</span>&nbsp;<span class="ident" id="5186662">line</span><br>
<span class="lineno">190</span><span class="op" id="5186667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5186670">func</span>&nbsp;<span class="op" id="5186675">(</span><span class="ident" id="5186676">p</span>&nbsp;<span class="op" id="5186678">*</span><span class="ident" id="5186679">printer</span><span class="op" id="5186686">)</span>&nbsp;<span class="ident" id="5186688">posFor</span><span class="op" id="5186694">(</span><span class="ident" id="5186695">pos</span>&nbsp;<span class="ident" id="5186699">token</span><span class="op" id="5186704">.</span><span class="ident" id="5186705">Pos</span><span class="op" id="5186708">)</span>&nbsp;<span class="ident" id="5186710">token</span><span class="op" id="5186715">.</span><span class="ident" id="5186716">Position</span>&nbsp;<span class="op" id="5186725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5186728">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5186790">return</span>&nbsp;<span class="ident" id="5186797">p</span><span class="op" id="5186798">.</span><span class="ident" id="5186799">fset</span><span class="op" id="5186803">.</span><span class="ident" id="5186804">Position</span><span class="op" id="5186812">(</span><span class="ident" id="5186813">pos</span><span class="op" id="5186816">)</span><br>
<span class="lineno">195</span><span class="op" id="5186818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5186821">func</span>&nbsp;<span class="op" id="5186826">(</span><span class="ident" id="5186827">p</span>&nbsp;<span class="op" id="5186829">*</span><span class="ident" id="5186830">printer</span><span class="op" id="5186837">)</span>&nbsp;<span class="ident" id="5186839">lineFor</span><span class="op" id="5186846">(</span><span class="ident" id="5186847">pos</span>&nbsp;<span class="ident" id="5186851">token</span><span class="op" id="5186856">.</span><span class="ident" id="5186857">Pos</span><span class="op" id="5186860">)</span>&nbsp;<span class="builtintype" id="5186862">int</span>&nbsp;<span class="op" id="5186866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5186869">if</span>&nbsp;<span class="ident" id="5186872">pos</span>&nbsp;<span class="op" id="5186876">!=</span>&nbsp;<span class="ident" id="5186879">p</span><span class="op" id="5186880">.</span><span class="ident" id="5186881">cachedPos</span>&nbsp;<span class="op" id="5186891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5186895">p</span><span class="op" id="5186896">.</span><span class="ident" id="5186897">cachedPos</span>&nbsp;<span class="op" id="5186907">=</span>&nbsp;<span class="ident" id="5186909">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5186915">p</span><span class="op" id="5186916">.</span><span class="ident" id="5186917">cachedLine</span>&nbsp;<span class="op" id="5186928">=</span>&nbsp;<span class="ident" id="5186930">p</span><span class="op" id="5186931">.</span><span class="ident" id="5186932">fset</span><span class="op" id="5186936">.</span><span class="ident" id="5186937">Position</span><span class="op" id="5186945">(</span><span class="ident" id="5186946">pos</span><span class="op" id="5186949">)</span><span class="op" id="5186950">.</span><span class="ident" id="5186951">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5186957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5186960">return</span>&nbsp;<span class="ident" id="5186967">p</span><span class="op" id="5186968">.</span><span class="ident" id="5186969">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="5186980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5186983">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="5187058">func</span>&nbsp;<span class="op" id="5187063">(</span><span class="ident" id="5187064">p</span>&nbsp;<span class="op" id="5187066">*</span><span class="ident" id="5187067">printer</span><span class="op" id="5187074">)</span>&nbsp;<span class="ident" id="5187076">atLineBegin</span><span class="op" id="5187087">(</span><span class="ident" id="5187088">pos</span>&nbsp;<span class="ident" id="5187092">token</span><span class="op" id="5187097">.</span><span class="ident" id="5187098">Position</span><span class="op" id="5187106">)</span>&nbsp;<span class="op" id="5187108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187111">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5187151">if</span>&nbsp;<span class="ident" id="5187154">p</span><span class="op" id="5187155">.</span><span class="ident" id="5187156">Config</span><span class="op" id="5187162">.</span><span class="ident" id="5187163">Mode</span><span class="op" id="5187167">&amp;</span><span class="ident" id="5187168">SourcePos</span>&nbsp;<span class="op" id="5187178">!=</span>&nbsp;<span class="num" id="5187181">0</span>&nbsp;<span class="op" id="5187183">&amp;&amp;</span>&nbsp;<span class="ident" id="5187186">pos</span><span class="op" id="5187189">.</span><span class="ident" id="5187190">IsValid</span><span class="op" id="5187197">(</span><span class="op" id="5187198">)</span>&nbsp;<span class="op" id="5187200">&amp;&amp;</span>&nbsp;<span class="op" id="5187203">(</span><span class="ident" id="5187204">p</span><span class="op" id="5187205">.</span><span class="ident" id="5187206">out</span><span class="op" id="5187209">.</span><span class="ident" id="5187210">Line</span>&nbsp;<span class="op" id="5187215">!=</span>&nbsp;<span class="ident" id="5187218">pos</span><span class="op" id="5187221">.</span><span class="ident" id="5187222">Line</span>&nbsp;<span class="op" id="5187227">||</span>&nbsp;<span class="ident" id="5187230">p</span><span class="op" id="5187231">.</span><span class="ident" id="5187232">out</span><span class="op" id="5187235">.</span><span class="ident" id="5187236">Filename</span>&nbsp;<span class="op" id="5187245">!=</span>&nbsp;<span class="ident" id="5187248">pos</span><span class="op" id="5187251">.</span><span class="ident" id="5187252">Filename</span><span class="op" id="5187260">)</span>&nbsp;<span class="op" id="5187262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187266">p</span><span class="op" id="5187267">.</span><span class="ident" id="5187268">output</span>&nbsp;<span class="op" id="5187275">=</span>&nbsp;<span class="builtinfunc" id="5187277">append</span><span class="op" id="5187283">(</span><span class="ident" id="5187284">p</span><span class="op" id="5187285">.</span><span class="ident" id="5187286">output</span><span class="op" id="5187292">,</span>&nbsp;<span class="ident" id="5187294">tabwriter</span><span class="op" id="5187303">.</span><span class="ident" id="5187304">Escape</span><span class="op" id="5187310">)</span>&nbsp;<span class="comment" id="5187312">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187370">p</span><span class="op" id="5187371">.</span><span class="ident" id="5187372">output</span>&nbsp;<span class="op" id="5187379">=</span>&nbsp;<span class="builtinfunc" id="5187381">append</span><span class="op" id="5187387">(</span><span class="ident" id="5187388">p</span><span class="op" id="5187389">.</span><span class="ident" id="5187390">output</span><span class="op" id="5187396">,</span>&nbsp;<span class="ident" id="5187398">fmt</span><span class="op" id="5187401">.</span><span class="ident" id="5187402">Sprintf</span><span class="op" id="5187409">(</span><span class="string" id="5187410">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="5187426">,</span>&nbsp;<span class="ident" id="5187428">pos</span><span class="op" id="5187431">.</span><span class="ident" id="5187432">Filename</span><span class="op" id="5187440">,</span>&nbsp;<span class="ident" id="5187442">pos</span><span class="op" id="5187445">.</span><span class="ident" id="5187446">Line</span><span class="op" id="5187450">)</span><span class="op" id="5187451">...</span><span class="op" id="5187454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187458">p</span><span class="op" id="5187459">.</span><span class="ident" id="5187460">output</span>&nbsp;<span class="op" id="5187467">=</span>&nbsp;<span class="builtinfunc" id="5187469">append</span><span class="op" id="5187475">(</span><span class="ident" id="5187476">p</span><span class="op" id="5187477">.</span><span class="ident" id="5187478">output</span><span class="op" id="5187484">,</span>&nbsp;<span class="ident" id="5187486">tabwriter</span><span class="op" id="5187495">.</span><span class="ident" id="5187496">Escape</span><span class="op" id="5187502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187506">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187547">p</span><span class="op" id="5187548">.</span><span class="ident" id="5187549">out</span><span class="op" id="5187552">.</span><span class="ident" id="5187553">Filename</span>&nbsp;<span class="op" id="5187562">=</span>&nbsp;<span class="ident" id="5187564">pos</span><span class="op" id="5187567">.</span><span class="ident" id="5187568">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187579">p</span><span class="op" id="5187580">.</span><span class="ident" id="5187581">out</span><span class="op" id="5187584">.</span><span class="ident" id="5187585">Line</span>&nbsp;<span class="op" id="5187590">=</span>&nbsp;<span class="ident" id="5187592">pos</span><span class="op" id="5187595">.</span><span class="ident" id="5187596">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5187602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187606">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187628">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187671">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187714">n</span>&nbsp;<span class="op" id="5187716">:=</span>&nbsp;<span class="ident" id="5187719">p</span><span class="op" id="5187720">.</span><span class="ident" id="5187721">Config</span><span class="op" id="5187727">.</span><span class="ident" id="5187728">Indent</span>&nbsp;<span class="op" id="5187735">+</span>&nbsp;<span class="ident" id="5187737">p</span><span class="op" id="5187738">.</span><span class="ident" id="5187739">indent</span>&nbsp;<span class="comment" id="5187746">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5187775">for</span>&nbsp;<span class="ident" id="5187779">i</span>&nbsp;<span class="op" id="5187781">:=</span>&nbsp;<span class="num" id="5187784">0</span><span class="op" id="5187785">;</span>&nbsp;<span class="ident" id="5187787">i</span>&nbsp;<span class="op" id="5187789">&lt;</span>&nbsp;<span class="ident" id="5187791">n</span><span class="op" id="5187792">;</span>&nbsp;<span class="ident" id="5187794">i</span><span class="op" id="5187795">++</span>&nbsp;<span class="op" id="5187798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187802">p</span><span class="op" id="5187803">.</span><span class="ident" id="5187804">output</span>&nbsp;<span class="op" id="5187811">=</span>&nbsp;<span class="builtinfunc" id="5187813">append</span><span class="op" id="5187819">(</span><span class="ident" id="5187820">p</span><span class="op" id="5187821">.</span><span class="ident" id="5187822">output</span><span class="op" id="5187828">,</span>&nbsp;<span class="string" id="5187830">&#39;\t&#39;</span><span class="op" id="5187834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5187837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5187841">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187862">p</span><span class="op" id="5187863">.</span><span class="ident" id="5187864">pos</span><span class="op" id="5187867">.</span><span class="ident" id="5187868">Offset</span>&nbsp;<span class="op" id="5187875">+=</span>&nbsp;<span class="ident" id="5187878">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187881">p</span><span class="op" id="5187882">.</span><span class="ident" id="5187883">pos</span><span class="op" id="5187886">.</span><span class="ident" id="5187887">Column</span>&nbsp;<span class="op" id="5187894">+=</span>&nbsp;<span class="ident" id="5187897">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5187900">p</span><span class="op" id="5187901">.</span><span class="ident" id="5187902">out</span><span class="op" id="5187905">.</span><span class="ident" id="5187906">Column</span>&nbsp;<span class="op" id="5187913">+=</span>&nbsp;<span class="ident" id="5187916">n</span><br>
<span class="lineno"></span><span class="op" id="5187918">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5187921">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="5187983">func</span>&nbsp;<span class="op" id="5187988">(</span><span class="ident" id="5187989">p</span>&nbsp;<span class="op" id="5187991">*</span><span class="ident" id="5187992">printer</span><span class="op" id="5187999">)</span>&nbsp;<span class="ident" id="5188001">writeByte</span><span class="op" id="5188010">(</span><span class="ident" id="5188011">ch</span>&nbsp;<span class="builtintype" id="5188014">byte</span><span class="op" id="5188018">,</span>&nbsp;<span class="ident" id="5188020">n</span>&nbsp;<span class="builtintype" id="5188022">int</span><span class="op" id="5188025">)</span>&nbsp;<span class="op" id="5188027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5188030">if</span>&nbsp;<span class="ident" id="5188033">p</span><span class="op" id="5188034">.</span><span class="ident" id="5188035">out</span><span class="op" id="5188038">.</span><span class="ident" id="5188039">Column</span>&nbsp;<span class="op" id="5188046">==</span>&nbsp;<span class="num" id="5188049">1</span>&nbsp;<span class="op" id="5188051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188055">p</span><span class="op" id="5188056">.</span><span class="ident" id="5188057">atLineBegin</span><span class="op" id="5188068">(</span><span class="ident" id="5188069">p</span><span class="op" id="5188070">.</span><span class="ident" id="5188071">pos</span><span class="op" id="5188074">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5188077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5188081">for</span>&nbsp;<span class="ident" id="5188085">i</span>&nbsp;<span class="op" id="5188087">:=</span>&nbsp;<span class="num" id="5188090">0</span><span class="op" id="5188091">;</span>&nbsp;<span class="ident" id="5188093">i</span>&nbsp;<span class="op" id="5188095">&lt;</span>&nbsp;<span class="ident" id="5188097">n</span><span class="op" id="5188098">;</span>&nbsp;<span class="ident" id="5188100">i</span><span class="op" id="5188101">++</span>&nbsp;<span class="op" id="5188104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188108">p</span><span class="op" id="5188109">.</span><span class="ident" id="5188110">output</span>&nbsp;<span class="op" id="5188117">=</span>&nbsp;<span class="builtinfunc" id="5188119">append</span><span class="op" id="5188125">(</span><span class="ident" id="5188126">p</span><span class="op" id="5188127">.</span><span class="ident" id="5188128">output</span><span class="op" id="5188134">,</span>&nbsp;<span class="ident" id="5188136">ch</span><span class="op" id="5188138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5188141">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5188145">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188166">p</span><span class="op" id="5188167">.</span><span class="ident" id="5188168">pos</span><span class="op" id="5188171">.</span><span class="ident" id="5188172">Offset</span>&nbsp;<span class="op" id="5188179">+=</span>&nbsp;<span class="ident" id="5188182">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5188185">if</span>&nbsp;<span class="ident" id="5188188">ch</span>&nbsp;<span class="op" id="5188191">==</span>&nbsp;<span class="string" id="5188194">&#39;\n&#39;</span>&nbsp;<span class="op" id="5188199">||</span>&nbsp;<span class="ident" id="5188202">ch</span>&nbsp;<span class="op" id="5188205">==</span>&nbsp;<span class="string" id="5188208">&#39;\f&#39;</span>&nbsp;<span class="op" id="5188213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188217">p</span><span class="op" id="5188218">.</span><span class="ident" id="5188219">pos</span><span class="op" id="5188222">.</span><span class="ident" id="5188223">Line</span>&nbsp;<span class="op" id="5188228">+=</span>&nbsp;<span class="ident" id="5188231">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188235">p</span><span class="op" id="5188236">.</span><span class="ident" id="5188237">out</span><span class="op" id="5188240">.</span><span class="ident" id="5188241">Line</span>&nbsp;<span class="op" id="5188246">+=</span>&nbsp;<span class="ident" id="5188249">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188253">p</span><span class="op" id="5188254">.</span><span class="ident" id="5188255">pos</span><span class="op" id="5188258">.</span><span class="ident" id="5188259">Column</span>&nbsp;<span class="op" id="5188266">=</span>&nbsp;<span class="num" id="5188268">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188272">p</span><span class="op" id="5188273">.</span><span class="ident" id="5188274">out</span><span class="op" id="5188277">.</span><span class="ident" id="5188278">Column</span>&nbsp;<span class="op" id="5188285">=</span>&nbsp;<span class="num" id="5188287">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5188291">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5188299">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188302">p</span><span class="op" id="5188303">.</span><span class="ident" id="5188304">pos</span><span class="op" id="5188307">.</span><span class="ident" id="5188308">Column</span>&nbsp;<span class="op" id="5188315">+=</span>&nbsp;<span class="ident" id="5188318">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5188321">p</span><span class="op" id="5188322">.</span><span class="ident" id="5188323">out</span><span class="op" id="5188326">.</span><span class="ident" id="5188327">Column</span>&nbsp;<span class="op" id="5188334">+=</span>&nbsp;<span class="ident" id="5188337">n</span><br>
<span class="lineno"></span><span class="op" id="5188339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5188342">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="5188415">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="5188491">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="5188548">//</span><br>
<span class="lineno"></span><span class="comment" id="5188551">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5188619">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="5188692">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5188764">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="5188840">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5188913">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="5188948">//</span><br>
<span class="lineno">265</span><span class="keyword" id="5188951">func</span>&nbsp;<span class="op" id="5188956">(</span><span class="ident" id="5188957">p</span>&nbsp;<span class="op" id="5188959">*</span><span class="ident" id="5188960">printer</span><span class="op" id="5188967">)</span>&nbsp;<span class="ident" id="5188969">writeString</span><span class="op" id="5188980">(</span><span class="ident" id="5188981">pos</span>&nbsp;<span class="ident" id="5188985">token</span><span class="op" id="5188990">.</span><span class="ident" id="5188991">Position</span><span class="op" id="5188999">,</span>&nbsp;<span class="ident" id="5189001">s</span>&nbsp;<span class="builtintype" id="5189003">string</span><span class="op" id="5189009">,</span>&nbsp;<span class="ident" id="5189011">isLit</span>&nbsp;<span class="builtintype" id="5189017">bool</span><span class="op" id="5189021">)</span>&nbsp;<span class="op" id="5189023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189026">if</span>&nbsp;<span class="ident" id="5189029">p</span><span class="op" id="5189030">.</span><span class="ident" id="5189031">out</span><span class="op" id="5189034">.</span><span class="ident" id="5189035">Column</span>&nbsp;<span class="op" id="5189042">==</span>&nbsp;<span class="num" id="5189045">1</span>&nbsp;<span class="op" id="5189047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189051">p</span><span class="op" id="5189052">.</span><span class="ident" id="5189053">atLineBegin</span><span class="op" id="5189064">(</span><span class="ident" id="5189065">pos</span><span class="op" id="5189068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5189071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189075">if</span>&nbsp;<span class="ident" id="5189078">pos</span><span class="op" id="5189081">.</span><span class="ident" id="5189082">IsValid</span><span class="op" id="5189089">(</span><span class="op" id="5189090">)</span>&nbsp;<span class="op" id="5189092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189096">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189164">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189227">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189292">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189319">p</span><span class="op" id="5189320">.</span><span class="ident" id="5189321">pos</span>&nbsp;<span class="op" id="5189325">=</span>&nbsp;<span class="ident" id="5189327">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5189332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189336">if</span>&nbsp;<span class="ident" id="5189339">isLit</span>&nbsp;<span class="op" id="5189345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189349">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189406">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189465">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189527">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189549">p</span><span class="op" id="5189550">.</span><span class="ident" id="5189551">output</span>&nbsp;<span class="op" id="5189558">=</span>&nbsp;<span class="builtinfunc" id="5189560">append</span><span class="op" id="5189566">(</span><span class="ident" id="5189567">p</span><span class="op" id="5189568">.</span><span class="ident" id="5189569">output</span><span class="op" id="5189575">,</span>&nbsp;<span class="ident" id="5189577">tabwriter</span><span class="op" id="5189586">.</span><span class="ident" id="5189587">Escape</span><span class="op" id="5189593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5189596">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189600">if</span>&nbsp;<span class="ident" id="5189603">debug</span>&nbsp;<span class="op" id="5189609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189613">p</span><span class="op" id="5189614">.</span><span class="ident" id="5189615">output</span>&nbsp;<span class="op" id="5189622">=</span>&nbsp;<span class="builtinfunc" id="5189624">append</span><span class="op" id="5189630">(</span><span class="ident" id="5189631">p</span><span class="op" id="5189632">.</span><span class="ident" id="5189633">output</span><span class="op" id="5189639">,</span>&nbsp;<span class="ident" id="5189641">fmt</span><span class="op" id="5189644">.</span><span class="ident" id="5189645">Sprintf</span><span class="op" id="5189652">(</span><span class="string" id="5189653">&#34;/*%s*/&#34;</span><span class="op" id="5189661">,</span>&nbsp;<span class="ident" id="5189663">pos</span><span class="op" id="5189666">)</span><span class="op" id="5189667">...</span><span class="op" id="5189670">)</span>&nbsp;<span class="comment" id="5189672">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5189697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189700">p</span><span class="op" id="5189701">.</span><span class="ident" id="5189702">output</span>&nbsp;<span class="op" id="5189709">=</span>&nbsp;<span class="builtinfunc" id="5189711">append</span><span class="op" id="5189717">(</span><span class="ident" id="5189718">p</span><span class="op" id="5189719">.</span><span class="ident" id="5189720">output</span><span class="op" id="5189726">,</span>&nbsp;<span class="ident" id="5189728">s</span><span class="op" id="5189729">...</span><span class="op" id="5189732">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189736">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189757">nlines</span>&nbsp;<span class="op" id="5189764">:=</span>&nbsp;<span class="num" id="5189767">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189770">var</span>&nbsp;<span class="ident" id="5189774">li</span>&nbsp;<span class="builtintype" id="5189777">int</span>&nbsp;<span class="comment" id="5189781">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189828">for</span>&nbsp;<span class="ident" id="5189832">i</span>&nbsp;<span class="op" id="5189834">:=</span>&nbsp;<span class="num" id="5189837">0</span><span class="op" id="5189838">;</span>&nbsp;<span class="ident" id="5189840">i</span>&nbsp;<span class="op" id="5189842">&lt;</span>&nbsp;<span class="builtinfunc" id="5189844">len</span><span class="op" id="5189847">(</span><span class="ident" id="5189848">s</span><span class="op" id="5189849">)</span><span class="op" id="5189850">;</span>&nbsp;<span class="ident" id="5189852">i</span><span class="op" id="5189853">++</span>&nbsp;<span class="op" id="5189856">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5189860">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189920">if</span>&nbsp;<span class="ident" id="5189923">s</span><span class="op" id="5189924">[</span><span class="ident" id="5189925">i</span><span class="op" id="5189926">]</span>&nbsp;<span class="op" id="5189928">==</span>&nbsp;<span class="string" id="5189931">&#39;\n&#39;</span>&nbsp;<span class="op" id="5189936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189941">nlines</span><span class="op" id="5189947">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189953">li</span>&nbsp;<span class="op" id="5189956">=</span>&nbsp;<span class="ident" id="5189958">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5189962">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5189965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5189968">p</span><span class="op" id="5189969">.</span><span class="ident" id="5189970">pos</span><span class="op" id="5189973">.</span><span class="ident" id="5189974">Offset</span>&nbsp;<span class="op" id="5189981">+=</span>&nbsp;<span class="builtinfunc" id="5189984">len</span><span class="op" id="5189987">(</span><span class="ident" id="5189988">s</span><span class="op" id="5189989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5189992">if</span>&nbsp;<span class="ident" id="5189995">nlines</span>&nbsp;<span class="op" id="5190002">&gt;</span>&nbsp;<span class="num" id="5190004">0</span>&nbsp;<span class="op" id="5190006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190010">p</span><span class="op" id="5190011">.</span><span class="ident" id="5190012">pos</span><span class="op" id="5190015">.</span><span class="ident" id="5190016">Line</span>&nbsp;<span class="op" id="5190021">+=</span>&nbsp;<span class="ident" id="5190024">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190033">p</span><span class="op" id="5190034">.</span><span class="ident" id="5190035">out</span><span class="op" id="5190038">.</span><span class="ident" id="5190039">Line</span>&nbsp;<span class="op" id="5190044">+=</span>&nbsp;<span class="ident" id="5190047">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190056">c</span>&nbsp;<span class="op" id="5190058">:=</span>&nbsp;<span class="builtinfunc" id="5190061">len</span><span class="op" id="5190064">(</span><span class="ident" id="5190065">s</span><span class="op" id="5190066">)</span>&nbsp;<span class="op" id="5190068">-</span>&nbsp;<span class="ident" id="5190070">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190075">p</span><span class="op" id="5190076">.</span><span class="ident" id="5190077">pos</span><span class="op" id="5190080">.</span><span class="ident" id="5190081">Column</span>&nbsp;<span class="op" id="5190088">=</span>&nbsp;<span class="ident" id="5190090">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190094">p</span><span class="op" id="5190095">.</span><span class="ident" id="5190096">out</span><span class="op" id="5190099">.</span><span class="ident" id="5190100">Column</span>&nbsp;<span class="op" id="5190107">=</span>&nbsp;<span class="ident" id="5190109">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5190112">}</span>&nbsp;<span class="keyword" id="5190114">else</span>&nbsp;<span class="op" id="5190119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190123">p</span><span class="op" id="5190124">.</span><span class="ident" id="5190125">pos</span><span class="op" id="5190128">.</span><span class="ident" id="5190129">Column</span>&nbsp;<span class="op" id="5190136">+=</span>&nbsp;<span class="builtinfunc" id="5190139">len</span><span class="op" id="5190142">(</span><span class="ident" id="5190143">s</span><span class="op" id="5190144">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190148">p</span><span class="op" id="5190149">.</span><span class="ident" id="5190150">out</span><span class="op" id="5190153">.</span><span class="ident" id="5190154">Column</span>&nbsp;<span class="op" id="5190161">+=</span>&nbsp;<span class="builtinfunc" id="5190164">len</span><span class="op" id="5190167">(</span><span class="ident" id="5190168">s</span><span class="op" id="5190169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5190172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5190176">if</span>&nbsp;<span class="ident" id="5190179">isLit</span>&nbsp;<span class="op" id="5190185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190189">p</span><span class="op" id="5190190">.</span><span class="ident" id="5190191">output</span>&nbsp;<span class="op" id="5190198">=</span>&nbsp;<span class="builtinfunc" id="5190200">append</span><span class="op" id="5190206">(</span><span class="ident" id="5190207">p</span><span class="op" id="5190208">.</span><span class="ident" id="5190209">output</span><span class="op" id="5190215">,</span>&nbsp;<span class="ident" id="5190217">tabwriter</span><span class="op" id="5190226">.</span><span class="ident" id="5190227">Escape</span><span class="op" id="5190233">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5190236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190240">p</span><span class="op" id="5190241">.</span><span class="ident" id="5190242">last</span>&nbsp;<span class="op" id="5190247">=</span>&nbsp;<span class="ident" id="5190249">p</span><span class="op" id="5190250">.</span><span class="ident" id="5190251">pos</span><br>
<span class="lineno"></span><span class="op" id="5190255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="5190258">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5190320">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5190382">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="5190438">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="5190500">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="5190563">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5190623">//</span><br>
<span class="lineno"></span><span class="keyword" id="5190626">func</span>&nbsp;<span class="op" id="5190631">(</span><span class="ident" id="5190632">p</span>&nbsp;<span class="op" id="5190634">*</span><span class="ident" id="5190635">printer</span><span class="op" id="5190642">)</span>&nbsp;<span class="ident" id="5190644">writeCommentPrefix</span><span class="op" id="5190662">(</span><span class="ident" id="5190663">pos</span><span class="op" id="5190666">,</span>&nbsp;<span class="ident" id="5190668">next</span>&nbsp;<span class="ident" id="5190673">token</span><span class="op" id="5190678">.</span><span class="ident" id="5190679">Position</span><span class="op" id="5190687">,</span>&nbsp;<span class="ident" id="5190689">prev</span><span class="op" id="5190693">,</span>&nbsp;<span class="ident" id="5190695">comment</span>&nbsp;<span class="op" id="5190703">*</span><span class="ident" id="5190704">ast</span><span class="op" id="5190707">.</span><span class="ident" id="5190708">Comment</span><span class="op" id="5190715">,</span>&nbsp;<span class="ident" id="5190717">tok</span>&nbsp;<span class="ident" id="5190721">token</span><span class="op" id="5190726">.</span><span class="ident" id="5190727">Token</span><span class="op" id="5190732">)</span>&nbsp;<span class="op" id="5190734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5190737">if</span>&nbsp;<span class="builtinfunc" id="5190740">len</span><span class="op" id="5190743">(</span><span class="ident" id="5190744">p</span><span class="op" id="5190745">.</span><span class="ident" id="5190746">output</span><span class="op" id="5190752">)</span>&nbsp;<span class="op" id="5190754">==</span>&nbsp;<span class="num" id="5190757">0</span>&nbsp;<span class="op" id="5190759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5190763">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5190841">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5190849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5190853">if</span>&nbsp;<span class="ident" id="5190856">pos</span><span class="op" id="5190859">.</span><span class="ident" id="5190860">IsValid</span><span class="op" id="5190867">(</span><span class="op" id="5190868">)</span>&nbsp;<span class="op" id="5190870">&amp;&amp;</span>&nbsp;<span class="ident" id="5190873">pos</span><span class="op" id="5190876">.</span><span class="ident" id="5190877">Filename</span>&nbsp;<span class="op" id="5190886">!=</span>&nbsp;<span class="ident" id="5190889">p</span><span class="op" id="5190890">.</span><span class="ident" id="5190891">last</span><span class="op" id="5190895">.</span><span class="ident" id="5190896">Filename</span>&nbsp;<span class="op" id="5190905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5190909">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5190967">p</span><span class="op" id="5190968">.</span><span class="ident" id="5190969">writeByte</span><span class="op" id="5190978">(</span><span class="string" id="5190979">&#39;\f&#39;</span><span class="op" id="5190983">,</span>&nbsp;<span class="ident" id="5190985">maxNewlines</span><span class="op" id="5190996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191000">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5191008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191012">if</span>&nbsp;<span class="ident" id="5191015">pos</span><span class="op" id="5191018">.</span><span class="ident" id="5191019">Line</span>&nbsp;<span class="op" id="5191024">==</span>&nbsp;<span class="ident" id="5191027">p</span><span class="op" id="5191028">.</span><span class="ident" id="5191029">last</span><span class="op" id="5191033">.</span><span class="ident" id="5191034">Line</span>&nbsp;<span class="op" id="5191039">&amp;&amp;</span>&nbsp;<span class="op" id="5191042">(</span><span class="ident" id="5191043">prev</span>&nbsp;<span class="op" id="5191048">==</span>&nbsp;<span class="ident" id="5191051">nil</span>&nbsp;<span class="op" id="5191055">||</span>&nbsp;<span class="ident" id="5191058">prev</span><span class="op" id="5191062">.</span><span class="ident" id="5191063">Text</span><span class="op" id="5191067">[</span><span class="num" id="5191068">1</span><span class="op" id="5191069">]</span>&nbsp;<span class="op" id="5191071">!=</span>&nbsp;<span class="string" id="5191074">&#39;/&#39;</span><span class="op" id="5191077">)</span>&nbsp;<span class="op" id="5191079">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191083">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191127">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191169">hasSep</span>&nbsp;<span class="op" id="5191176">:=</span>&nbsp;<span class="builtintype" id="5191179">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191187">if</span>&nbsp;<span class="ident" id="5191190">prev</span>&nbsp;<span class="op" id="5191195">==</span>&nbsp;<span class="ident" id="5191198">nil</span>&nbsp;<span class="op" id="5191202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191207">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191246">j</span>&nbsp;<span class="op" id="5191248">:=</span>&nbsp;<span class="num" id="5191251">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191256">for</span>&nbsp;<span class="ident" id="5191260">i</span><span class="op" id="5191261">,</span>&nbsp;<span class="ident" id="5191263">ch</span>&nbsp;<span class="op" id="5191266">:=</span>&nbsp;<span class="keyword" id="5191269">range</span>&nbsp;<span class="ident" id="5191275">p</span><span class="op" id="5191276">.</span><span class="ident" id="5191277">wsbuf</span>&nbsp;<span class="op" id="5191283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191289">switch</span>&nbsp;<span class="ident" id="5191296">ch</span>&nbsp;<span class="op" id="5191299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191305">case</span>&nbsp;<span class="ident" id="5191310">blank</span><span class="op" id="5191315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191322">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191365">p</span><span class="op" id="5191366">.</span><span class="ident" id="5191367">wsbuf</span><span class="op" id="5191372">[</span><span class="ident" id="5191373">i</span><span class="op" id="5191374">]</span>&nbsp;<span class="op" id="5191376">=</span>&nbsp;<span class="ident" id="5191378">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191390">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191403">case</span>&nbsp;<span class="ident" id="5191408">vtab</span><span class="op" id="5191412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191419">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191461">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191512">hasSep</span>&nbsp;<span class="op" id="5191519">=</span>&nbsp;<span class="builtintype" id="5191521">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191531">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191544">case</span>&nbsp;<span class="ident" id="5191549">indent</span><span class="op" id="5191555">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191562">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191596">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5191609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191615">j</span>&nbsp;<span class="op" id="5191617">=</span>&nbsp;<span class="ident" id="5191619">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191625">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5191634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191639">p</span><span class="op" id="5191640">.</span><span class="ident" id="5191641">writeWhitespace</span><span class="op" id="5191656">(</span><span class="ident" id="5191657">j</span><span class="op" id="5191658">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5191662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191666">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191713">if</span>&nbsp;<span class="op" id="5191716">!</span><span class="ident" id="5191717">hasSep</span>&nbsp;<span class="op" id="5191724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191729">sep</span>&nbsp;<span class="op" id="5191733">:=</span>&nbsp;<span class="builtintype" id="5191736">byte</span><span class="op" id="5191740">(</span><span class="string" id="5191741">&#39;\t&#39;</span><span class="op" id="5191745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5191750">if</span>&nbsp;<span class="ident" id="5191753">pos</span><span class="op" id="5191756">.</span><span class="ident" id="5191757">Line</span>&nbsp;<span class="op" id="5191762">==</span>&nbsp;<span class="ident" id="5191765">next</span><span class="op" id="5191769">.</span><span class="ident" id="5191770">Line</span>&nbsp;<span class="op" id="5191775">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191781">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191833">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191885">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191922">sep</span>&nbsp;<span class="op" id="5191926">=</span>&nbsp;<span class="string" id="5191928">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5191935">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5191940">p</span><span class="op" id="5191941">.</span><span class="ident" id="5191942">writeByte</span><span class="op" id="5191951">(</span><span class="ident" id="5191952">sep</span><span class="op" id="5191955">,</span>&nbsp;<span class="num" id="5191957">1</span><span class="op" id="5191958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5191962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5191966">}</span>&nbsp;<span class="keyword" id="5191968">else</span>&nbsp;<span class="op" id="5191973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5191977">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192011">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192054">droppedLinebreak</span>&nbsp;<span class="op" id="5192071">:=</span>&nbsp;<span class="builtintype" id="5192074">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192082">j</span>&nbsp;<span class="op" id="5192084">:=</span>&nbsp;<span class="num" id="5192087">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192091">for</span>&nbsp;<span class="ident" id="5192095">i</span><span class="op" id="5192096">,</span>&nbsp;<span class="ident" id="5192098">ch</span>&nbsp;<span class="op" id="5192101">:=</span>&nbsp;<span class="keyword" id="5192104">range</span>&nbsp;<span class="ident" id="5192110">p</span><span class="op" id="5192111">.</span><span class="ident" id="5192112">wsbuf</span>&nbsp;<span class="op" id="5192118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192123">switch</span>&nbsp;<span class="ident" id="5192130">ch</span>&nbsp;<span class="op" id="5192133">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192138">case</span>&nbsp;<span class="ident" id="5192143">blank</span><span class="op" id="5192148">,</span>&nbsp;<span class="ident" id="5192150">vtab</span><span class="op" id="5192154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192160">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5192219">p</span><span class="op" id="5192220">.</span><span class="ident" id="5192221">wsbuf</span><span class="op" id="5192226">[</span><span class="ident" id="5192227">i</span><span class="op" id="5192228">]</span>&nbsp;<span class="op" id="5192230">=</span>&nbsp;<span class="ident" id="5192232">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192243">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192255">case</span>&nbsp;<span class="ident" id="5192260">indent</span><span class="op" id="5192266">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192272">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192305">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192317">case</span>&nbsp;<span class="ident" id="5192322">unindent</span><span class="op" id="5192330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192336">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192386">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192433">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192487">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192529">if</span>&nbsp;<span class="ident" id="5192532">i</span><span class="op" id="5192533">+</span><span class="num" id="5192534">1</span>&nbsp;<span class="op" id="5192536">&lt;</span>&nbsp;<span class="builtinfunc" id="5192538">len</span><span class="op" id="5192541">(</span><span class="ident" id="5192542">p</span><span class="op" id="5192543">.</span><span class="ident" id="5192544">wsbuf</span><span class="op" id="5192549">)</span>&nbsp;<span class="op" id="5192551">&amp;&amp;</span>&nbsp;<span class="ident" id="5192554">p</span><span class="op" id="5192555">.</span><span class="ident" id="5192556">wsbuf</span><span class="op" id="5192561">[</span><span class="ident" id="5192562">i</span><span class="op" id="5192563">+</span><span class="num" id="5192564">1</span><span class="op" id="5192565">]</span>&nbsp;<span class="op" id="5192567">==</span>&nbsp;<span class="ident" id="5192570">unindent</span>&nbsp;<span class="op" id="5192579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192586">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5192599">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192605">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192669">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192727">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192784">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192842">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5192897">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5192955">if</span>&nbsp;<span class="ident" id="5192958">tok</span>&nbsp;<span class="op" id="5192962">!=</span>&nbsp;<span class="ident" id="5192965">token</span><span class="op" id="5192970">.</span><span class="ident" id="5192971">RBRACE</span>&nbsp;<span class="op" id="5192978">&amp;&amp;</span>&nbsp;<span class="ident" id="5192981">pos</span><span class="op" id="5192984">.</span><span class="ident" id="5192985">Column</span>&nbsp;<span class="op" id="5192992">==</span>&nbsp;<span class="ident" id="5192995">next</span><span class="op" id="5192999">.</span><span class="ident" id="5193000">Column</span>&nbsp;<span class="op" id="5193007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193014">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5193027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193032">case</span>&nbsp;<span class="ident" id="5193037">newline</span><span class="op" id="5193044">,</span>&nbsp;<span class="ident" id="5193046">formfeed</span><span class="op" id="5193054">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193060">p</span><span class="op" id="5193061">.</span><span class="ident" id="5193062">wsbuf</span><span class="op" id="5193067">[</span><span class="ident" id="5193068">i</span><span class="op" id="5193069">]</span>&nbsp;<span class="op" id="5193071">=</span>&nbsp;<span class="ident" id="5193073">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193084">droppedLinebreak</span>&nbsp;<span class="op" id="5193101">=</span>&nbsp;<span class="ident" id="5193103">prev</span>&nbsp;<span class="op" id="5193108">==</span>&nbsp;<span class="ident" id="5193111">nil</span>&nbsp;<span class="comment" id="5193115">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5193161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193166">j</span>&nbsp;<span class="op" id="5193168">=</span>&nbsp;<span class="ident" id="5193170">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193175">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5193183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193187">p</span><span class="op" id="5193188">.</span><span class="ident" id="5193189">writeWhitespace</span><span class="op" id="5193204">(</span><span class="ident" id="5193205">j</span><span class="op" id="5193206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5193211">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193266">n</span>&nbsp;<span class="op" id="5193268">:=</span>&nbsp;<span class="num" id="5193271">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193275">if</span>&nbsp;<span class="ident" id="5193278">pos</span><span class="op" id="5193281">.</span><span class="ident" id="5193282">IsValid</span><span class="op" id="5193289">(</span><span class="op" id="5193290">)</span>&nbsp;<span class="op" id="5193292">&amp;&amp;</span>&nbsp;<span class="ident" id="5193295">p</span><span class="op" id="5193296">.</span><span class="ident" id="5193297">last</span><span class="op" id="5193301">.</span><span class="ident" id="5193302">IsValid</span><span class="op" id="5193309">(</span><span class="op" id="5193310">)</span>&nbsp;<span class="op" id="5193312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193317">n</span>&nbsp;<span class="op" id="5193319">=</span>&nbsp;<span class="ident" id="5193321">pos</span><span class="op" id="5193324">.</span><span class="ident" id="5193325">Line</span>&nbsp;<span class="op" id="5193330">-</span>&nbsp;<span class="ident" id="5193332">p</span><span class="op" id="5193333">.</span><span class="ident" id="5193334">last</span><span class="op" id="5193338">.</span><span class="ident" id="5193339">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193347">if</span>&nbsp;<span class="ident" id="5193350">n</span>&nbsp;<span class="op" id="5193352">&lt;</span>&nbsp;<span class="num" id="5193354">0</span>&nbsp;<span class="op" id="5193356">{</span>&nbsp;<span class="comment" id="5193358">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193385">n</span>&nbsp;<span class="op" id="5193387">=</span>&nbsp;<span class="num" id="5193389">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5193394">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5193398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5193403">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5193457">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5193509">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5193563">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193617">if</span>&nbsp;<span class="ident" id="5193620">p</span><span class="op" id="5193621">.</span><span class="ident" id="5193622">indent</span>&nbsp;<span class="op" id="5193629">==</span>&nbsp;<span class="num" id="5193632">0</span>&nbsp;<span class="op" id="5193634">&amp;&amp;</span>&nbsp;<span class="ident" id="5193637">droppedLinebreak</span>&nbsp;<span class="op" id="5193654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193659">n</span><span class="op" id="5193660">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5193665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5193670">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5193718">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193766">if</span>&nbsp;<span class="ident" id="5193769">n</span>&nbsp;<span class="op" id="5193771">==</span>&nbsp;<span class="num" id="5193774">0</span>&nbsp;<span class="op" id="5193776">&amp;&amp;</span>&nbsp;<span class="ident" id="5193779">prev</span>&nbsp;<span class="op" id="5193784">!=</span>&nbsp;<span class="ident" id="5193787">nil</span>&nbsp;<span class="op" id="5193791">&amp;&amp;</span>&nbsp;<span class="ident" id="5193794">prev</span><span class="op" id="5193798">.</span><span class="ident" id="5193799">Text</span><span class="op" id="5193803">[</span><span class="num" id="5193804">1</span><span class="op" id="5193805">]</span>&nbsp;<span class="op" id="5193807">==</span>&nbsp;<span class="string" id="5193810">&#39;/&#39;</span>&nbsp;<span class="op" id="5193814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5193819">n</span>&nbsp;<span class="op" id="5193821">=</span>&nbsp;<span class="num" id="5193823">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5193827">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5193832">if</span>&nbsp;<span class="ident" id="5193835">n</span>&nbsp;<span class="op" id="5193837">&gt;</span>&nbsp;<span class="num" id="5193839">0</span>&nbsp;<span class="op" id="5193841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5193846">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5193901">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5193956">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194000">p</span><span class="op" id="5194001">.</span><span class="ident" id="5194002">writeByte</span><span class="op" id="5194011">(</span><span class="string" id="5194012">&#39;\f&#39;</span><span class="op" id="5194016">,</span>&nbsp;<span class="ident" id="5194018">nlimit</span><span class="op" id="5194024">(</span><span class="ident" id="5194025">n</span><span class="op" id="5194026">)</span><span class="op" id="5194027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5194031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5194034">}</span><br>
<span class="lineno"></span><span class="op" id="5194036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="5194039">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="5194086">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="5194149">//</span><br>
<span class="lineno"></span><span class="keyword" id="5194152">func</span>&nbsp;<span class="ident" id="5194157">isBlank</span><span class="op" id="5194164">(</span><span class="ident" id="5194165">s</span>&nbsp;<span class="builtintype" id="5194167">string</span><span class="op" id="5194173">)</span>&nbsp;<span class="builtintype" id="5194175">bool</span>&nbsp;<span class="op" id="5194180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194183">for</span>&nbsp;<span class="ident" id="5194187">i</span>&nbsp;<span class="op" id="5194189">:=</span>&nbsp;<span class="num" id="5194192">0</span><span class="op" id="5194193">;</span>&nbsp;<span class="ident" id="5194195">i</span>&nbsp;<span class="op" id="5194197">&lt;</span>&nbsp;<span class="builtinfunc" id="5194199">len</span><span class="op" id="5194202">(</span><span class="ident" id="5194203">s</span><span class="op" id="5194204">)</span><span class="op" id="5194205">;</span>&nbsp;<span class="ident" id="5194207">i</span><span class="op" id="5194208">++</span>&nbsp;<span class="op" id="5194211">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194215">if</span>&nbsp;<span class="ident" id="5194218">s</span><span class="op" id="5194219">[</span><span class="ident" id="5194220">i</span><span class="op" id="5194221">]</span>&nbsp;<span class="op" id="5194223">&gt;</span>&nbsp;<span class="string" id="5194225">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5194229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194234">return</span>&nbsp;<span class="builtintype" id="5194241">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5194249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5194252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194255">return</span>&nbsp;<span class="builtintype" id="5194262">true</span><br>
<span class="lineno">460</span><span class="op" id="5194267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5194270">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5194324">func</span>&nbsp;<span class="ident" id="5194329">commonPrefix</span><span class="op" id="5194341">(</span><span class="ident" id="5194342">a</span><span class="op" id="5194343">,</span>&nbsp;<span class="ident" id="5194345">b</span>&nbsp;<span class="builtintype" id="5194347">string</span><span class="op" id="5194353">)</span>&nbsp;<span class="builtintype" id="5194355">string</span>&nbsp;<span class="op" id="5194362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194365">i</span>&nbsp;<span class="op" id="5194367">:=</span>&nbsp;<span class="num" id="5194370">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194373">for</span>&nbsp;<span class="ident" id="5194377">i</span>&nbsp;<span class="op" id="5194379">&lt;</span>&nbsp;<span class="builtinfunc" id="5194381">len</span><span class="op" id="5194384">(</span><span class="ident" id="5194385">a</span><span class="op" id="5194386">)</span>&nbsp;<span class="op" id="5194388">&amp;&amp;</span>&nbsp;<span class="ident" id="5194391">i</span>&nbsp;<span class="op" id="5194393">&lt;</span>&nbsp;<span class="builtinfunc" id="5194395">len</span><span class="op" id="5194398">(</span><span class="ident" id="5194399">b</span><span class="op" id="5194400">)</span>&nbsp;<span class="op" id="5194402">&amp;&amp;</span>&nbsp;<span class="ident" id="5194405">a</span><span class="op" id="5194406">[</span><span class="ident" id="5194407">i</span><span class="op" id="5194408">]</span>&nbsp;<span class="op" id="5194410">==</span>&nbsp;<span class="ident" id="5194413">b</span><span class="op" id="5194414">[</span><span class="ident" id="5194415">i</span><span class="op" id="5194416">]</span>&nbsp;<span class="op" id="5194418">&amp;&amp;</span>&nbsp;<span class="op" id="5194421">(</span><span class="ident" id="5194422">a</span><span class="op" id="5194423">[</span><span class="ident" id="5194424">i</span><span class="op" id="5194425">]</span>&nbsp;<span class="op" id="5194427">&lt;=</span>&nbsp;<span class="string" id="5194430">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5194434">||</span>&nbsp;<span class="ident" id="5194437">a</span><span class="op" id="5194438">[</span><span class="ident" id="5194439">i</span><span class="op" id="5194440">]</span>&nbsp;<span class="op" id="5194442">==</span>&nbsp;<span class="string" id="5194445">&#39;*&#39;</span><span class="op" id="5194448">)</span>&nbsp;<span class="op" id="5194450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5194454">i</span><span class="op" id="5194455">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5194459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194462">return</span>&nbsp;<span class="ident" id="5194469">a</span><span class="op" id="5194470">[</span><span class="num" id="5194471">0</span><span class="op" id="5194472">:</span><span class="ident" id="5194473">i</span><span class="op" id="5194474">]</span><br>
<span class="lineno"></span><span class="op" id="5194476">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5194479">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="5194536">func</span>&nbsp;<span class="ident" id="5194541">trimRight</span><span class="op" id="5194550">(</span><span class="ident" id="5194551">s</span>&nbsp;<span class="builtintype" id="5194553">string</span><span class="op" id="5194559">)</span>&nbsp;<span class="builtintype" id="5194561">string</span>&nbsp;<span class="op" id="5194568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5194571">return</span>&nbsp;<span class="ident" id="5194578">strings</span><span class="op" id="5194585">.</span><span class="ident" id="5194586">TrimRightFunc</span><span class="op" id="5194599">(</span><span class="ident" id="5194600">s</span><span class="op" id="5194601">,</span>&nbsp;<span class="ident" id="5194603">unicode</span><span class="op" id="5194610">.</span><span class="ident" id="5194611">IsSpace</span><span class="op" id="5194618">)</span><br>
<span class="lineno"></span><span class="op" id="5194620">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="5194623">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5194707">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="5194792">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5194872">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="5194952">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="5194976">//</span><br>
<span class="lineno"></span><span class="keyword" id="5194979">func</span>&nbsp;<span class="ident" id="5194984">stripCommonPrefix</span><span class="op" id="5195001">(</span><span class="ident" id="5195002">lines</span>&nbsp;<span class="op" id="5195008">[</span><span class="op" id="5195009">]</span><span class="builtintype" id="5195010">string</span><span class="op" id="5195016">)</span>&nbsp;<span class="op" id="5195018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5195021">if</span>&nbsp;<span class="builtinfunc" id="5195024">len</span><span class="op" id="5195027">(</span><span class="ident" id="5195028">lines</span><span class="op" id="5195033">)</span>&nbsp;<span class="op" id="5195035">&lt;=</span>&nbsp;<span class="num" id="5195038">1</span>&nbsp;<span class="op" id="5195040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5195044">return</span>&nbsp;<span class="comment" id="5195051">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5195088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195091">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195111">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195168">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195225">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195279">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195337">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195395">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195453">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195494">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195556">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195618">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195679">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195740">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195800">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195814">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195818">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195878">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5195938">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5195992">var</span>&nbsp;<span class="ident" id="5195996">prefix</span>&nbsp;<span class="builtintype" id="5196003">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5196011">if</span>&nbsp;<span class="builtinfunc" id="5196014">len</span><span class="op" id="5196017">(</span><span class="ident" id="5196018">lines</span><span class="op" id="5196023">)</span>&nbsp;<span class="op" id="5196025">&gt;</span>&nbsp;<span class="num" id="5196027">2</span>&nbsp;<span class="op" id="5196029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196033">first</span>&nbsp;<span class="op" id="5196039">:=</span>&nbsp;<span class="builtintype" id="5196042">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5196049">for</span>&nbsp;<span class="ident" id="5196053">i</span><span class="op" id="5196054">,</span>&nbsp;<span class="ident" id="5196056">line</span>&nbsp;<span class="op" id="5196061">:=</span>&nbsp;<span class="keyword" id="5196064">range</span>&nbsp;<span class="ident" id="5196070">lines</span><span class="op" id="5196075">[</span><span class="num" id="5196076">1</span>&nbsp;<span class="op" id="5196078">:</span>&nbsp;<span class="builtinfunc" id="5196080">len</span><span class="op" id="5196083">(</span><span class="ident" id="5196084">lines</span><span class="op" id="5196089">)</span><span class="op" id="5196090">-</span><span class="num" id="5196091">1</span><span class="op" id="5196092">]</span>&nbsp;<span class="op" id="5196094">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5196099">switch</span>&nbsp;<span class="op" id="5196106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5196111">case</span>&nbsp;<span class="ident" id="5196116">isBlank</span><span class="op" id="5196123">(</span><span class="ident" id="5196124">line</span><span class="op" id="5196128">)</span><span class="op" id="5196129">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196135">lines</span><span class="op" id="5196140">[</span><span class="num" id="5196141">1</span><span class="op" id="5196142">+</span><span class="ident" id="5196143">i</span><span class="op" id="5196144">]</span>&nbsp;<span class="op" id="5196146">=</span>&nbsp;<span class="string" id="5196148">&#34;&#34;</span>&nbsp;<span class="comment" id="5196151">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5196184">case</span>&nbsp;<span class="ident" id="5196189">first</span><span class="op" id="5196194">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196200">prefix</span>&nbsp;<span class="op" id="5196207">=</span>&nbsp;<span class="ident" id="5196209">commonPrefix</span><span class="op" id="5196221">(</span><span class="ident" id="5196222">line</span><span class="op" id="5196226">,</span>&nbsp;<span class="ident" id="5196228">line</span><span class="op" id="5196232">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196238">first</span>&nbsp;<span class="op" id="5196244">=</span>&nbsp;<span class="builtintype" id="5196246">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5196255">default</span><span class="op" id="5196262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196268">prefix</span>&nbsp;<span class="op" id="5196275">=</span>&nbsp;<span class="ident" id="5196277">commonPrefix</span><span class="op" id="5196289">(</span><span class="ident" id="5196290">prefix</span><span class="op" id="5196296">,</span>&nbsp;<span class="ident" id="5196298">line</span><span class="op" id="5196302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5196307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5196311">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5196314">}</span>&nbsp;<span class="keyword" id="5196316">else</span>&nbsp;<span class="op" id="5196321">{</span>&nbsp;<span class="comment" id="5196323">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196387">line</span>&nbsp;<span class="op" id="5196392">:=</span>&nbsp;<span class="ident" id="5196395">lines</span><span class="op" id="5196400">[</span><span class="num" id="5196401">1</span><span class="op" id="5196402">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196406">prefix</span>&nbsp;<span class="op" id="5196413">=</span>&nbsp;<span class="ident" id="5196415">commonPrefix</span><span class="op" id="5196427">(</span><span class="ident" id="5196428">line</span><span class="op" id="5196432">,</span>&nbsp;<span class="ident" id="5196434">line</span><span class="op" id="5196438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5196441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5196445">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196525">lineOfStars</span>&nbsp;<span class="op" id="5196537">:=</span>&nbsp;<span class="builtintype" id="5196540">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5196547">if</span>&nbsp;<span class="ident" id="5196550">i</span>&nbsp;<span class="op" id="5196552">:=</span>&nbsp;<span class="ident" id="5196555">strings</span><span class="op" id="5196562">.</span><span class="ident" id="5196563">Index</span><span class="op" id="5196568">(</span><span class="ident" id="5196569">prefix</span><span class="op" id="5196575">,</span>&nbsp;<span class="string" id="5196577">&#34;*&#34;</span><span class="op" id="5196580">)</span><span class="op" id="5196581">;</span>&nbsp;<span class="ident" id="5196583">i</span>&nbsp;<span class="op" id="5196585">&gt;=</span>&nbsp;<span class="num" id="5196588">0</span>&nbsp;<span class="op" id="5196590">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5196594">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5196622">if</span>&nbsp;<span class="ident" id="5196625">i</span>&nbsp;<span class="op" id="5196627">&gt;</span>&nbsp;<span class="num" id="5196629">0</span>&nbsp;<span class="op" id="5196631">&amp;&amp;</span>&nbsp;<span class="ident" id="5196634">prefix</span><span class="op" id="5196640">[</span><span class="ident" id="5196641">i</span><span class="op" id="5196642">-</span><span class="num" id="5196643">1</span><span class="op" id="5196644">]</span>&nbsp;<span class="op" id="5196646">==</span>&nbsp;<span class="string" id="5196649">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5196653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196658">i</span><span class="op" id="5196659">--</span>&nbsp;<span class="comment" id="5196662">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5196725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196729">prefix</span>&nbsp;<span class="op" id="5196736">=</span>&nbsp;<span class="ident" id="5196738">prefix</span><span class="op" id="5196744">[</span><span class="num" id="5196745">0</span><span class="op" id="5196746">:</span><span class="ident" id="5196747">i</span><span class="op" id="5196748">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5196752">lineOfStars</span>&nbsp;<span class="op" id="5196764">=</span>&nbsp;<span class="builtintype" id="5196766">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5196772">}</span>&nbsp;<span class="keyword" id="5196774">else</span>&nbsp;<span class="op" id="5196779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5196783">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5196814">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5196876">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5196938">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5197001">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5197062">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5197124">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197185">first</span>&nbsp;<span class="op" id="5197191">:=</span>&nbsp;<span class="ident" id="5197194">lines</span><span class="op" id="5197199">[</span><span class="num" id="5197200">0</span><span class="op" id="5197201">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197205">if</span>&nbsp;<span class="ident" id="5197208">isBlank</span><span class="op" id="5197215">(</span><span class="ident" id="5197216">first</span><span class="op" id="5197221">[</span><span class="num" id="5197222">2</span><span class="op" id="5197223">:</span><span class="op" id="5197224">]</span><span class="op" id="5197225">)</span>&nbsp;<span class="op" id="5197227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5197232">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5197273">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5197320">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5197372">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5197425">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197450">i</span>&nbsp;<span class="op" id="5197452">:=</span>&nbsp;<span class="builtinfunc" id="5197455">len</span><span class="op" id="5197458">(</span><span class="ident" id="5197459">prefix</span><span class="op" id="5197465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197470">for</span>&nbsp;<span class="ident" id="5197474">n</span>&nbsp;<span class="op" id="5197476">:=</span>&nbsp;<span class="num" id="5197479">0</span><span class="op" id="5197480">;</span>&nbsp;<span class="ident" id="5197482">n</span>&nbsp;<span class="op" id="5197484">&lt;</span>&nbsp;<span class="num" id="5197486">3</span>&nbsp;<span class="op" id="5197488">&amp;&amp;</span>&nbsp;<span class="ident" id="5197491">i</span>&nbsp;<span class="op" id="5197493">&gt;</span>&nbsp;<span class="num" id="5197495">0</span>&nbsp;<span class="op" id="5197497">&amp;&amp;</span>&nbsp;<span class="ident" id="5197500">prefix</span><span class="op" id="5197506">[</span><span class="ident" id="5197507">i</span><span class="op" id="5197508">-</span><span class="num" id="5197509">1</span><span class="op" id="5197510">]</span>&nbsp;<span class="op" id="5197512">==</span>&nbsp;<span class="string" id="5197515">&#39;&nbsp;&#39;</span><span class="op" id="5197518">;</span>&nbsp;<span class="ident" id="5197520">n</span><span class="op" id="5197521">++</span>&nbsp;<span class="op" id="5197524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197530">i</span><span class="op" id="5197531">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5197537">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197542">if</span>&nbsp;<span class="ident" id="5197545">i</span>&nbsp;<span class="op" id="5197547">==</span>&nbsp;<span class="builtinfunc" id="5197550">len</span><span class="op" id="5197553">(</span><span class="ident" id="5197554">prefix</span><span class="op" id="5197560">)</span>&nbsp;<span class="op" id="5197562">&amp;&amp;</span>&nbsp;<span class="ident" id="5197565">i</span>&nbsp;<span class="op" id="5197567">&gt;</span>&nbsp;<span class="num" id="5197569">0</span>&nbsp;<span class="op" id="5197571">&amp;&amp;</span>&nbsp;<span class="ident" id="5197574">prefix</span><span class="op" id="5197580">[</span><span class="ident" id="5197581">i</span><span class="op" id="5197582">-</span><span class="num" id="5197583">1</span><span class="op" id="5197584">]</span>&nbsp;<span class="op" id="5197586">==</span>&nbsp;<span class="string" id="5197589">&#39;\t&#39;</span>&nbsp;<span class="op" id="5197594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197600">i</span><span class="op" id="5197601">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5197607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197612">prefix</span>&nbsp;<span class="op" id="5197619">=</span>&nbsp;<span class="ident" id="5197621">prefix</span><span class="op" id="5197627">[</span><span class="num" id="5197628">0</span><span class="op" id="5197629">:</span><span class="ident" id="5197630">i</span><span class="op" id="5197631">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5197635">}</span>&nbsp;<span class="keyword" id="5197637">else</span>&nbsp;<span class="op" id="5197642">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5197647">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197684">suffix</span>&nbsp;<span class="op" id="5197691">:=</span>&nbsp;<span class="builtinfunc" id="5197694">make</span><span class="op" id="5197698">(</span><span class="op" id="5197699">[</span><span class="op" id="5197700">]</span><span class="builtintype" id="5197701">byte</span><span class="op" id="5197705">,</span>&nbsp;<span class="builtinfunc" id="5197707">len</span><span class="op" id="5197710">(</span><span class="ident" id="5197711">first</span><span class="op" id="5197716">)</span><span class="op" id="5197717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197722">n</span>&nbsp;<span class="op" id="5197724">:=</span>&nbsp;<span class="num" id="5197727">2</span>&nbsp;<span class="comment" id="5197729">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197758">for</span>&nbsp;<span class="ident" id="5197762">n</span>&nbsp;<span class="op" id="5197764">&lt;</span>&nbsp;<span class="builtinfunc" id="5197766">len</span><span class="op" id="5197769">(</span><span class="ident" id="5197770">first</span><span class="op" id="5197775">)</span>&nbsp;<span class="op" id="5197777">&amp;&amp;</span>&nbsp;<span class="ident" id="5197780">first</span><span class="op" id="5197785">[</span><span class="ident" id="5197786">n</span><span class="op" id="5197787">]</span>&nbsp;<span class="op" id="5197789">&lt;=</span>&nbsp;<span class="string" id="5197792">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5197796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197802">suffix</span><span class="op" id="5197808">[</span><span class="ident" id="5197809">n</span><span class="op" id="5197810">]</span>&nbsp;<span class="op" id="5197812">=</span>&nbsp;<span class="ident" id="5197814">first</span><span class="op" id="5197819">[</span><span class="ident" id="5197820">n</span><span class="op" id="5197821">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197827">n</span><span class="op" id="5197828">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5197834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5197839">if</span>&nbsp;<span class="ident" id="5197842">n</span>&nbsp;<span class="op" id="5197844">&gt;</span>&nbsp;<span class="num" id="5197846">2</span>&nbsp;<span class="op" id="5197848">&amp;&amp;</span>&nbsp;<span class="ident" id="5197851">suffix</span><span class="op" id="5197857">[</span><span class="num" id="5197858">2</span><span class="op" id="5197859">]</span>&nbsp;<span class="op" id="5197861">==</span>&nbsp;<span class="string" id="5197864">&#39;\t&#39;</span>&nbsp;<span class="op" id="5197869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5197875">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197921">suffix</span>&nbsp;<span class="op" id="5197928">=</span>&nbsp;<span class="ident" id="5197930">suffix</span><span class="op" id="5197936">[</span><span class="num" id="5197937">2</span><span class="op" id="5197938">:</span><span class="ident" id="5197939">n</span><span class="op" id="5197940">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5197945">}</span>&nbsp;<span class="keyword" id="5197947">else</span>&nbsp;<span class="op" id="5197952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5197958">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5197993">suffix</span><span class="op" id="5197999">[</span><span class="num" id="5198000">0</span><span class="op" id="5198001">]</span><span class="op" id="5198002">,</span>&nbsp;<span class="ident" id="5198004">suffix</span><span class="op" id="5198010">[</span><span class="num" id="5198011">1</span><span class="op" id="5198012">]</span>&nbsp;<span class="op" id="5198014">=</span>&nbsp;<span class="string" id="5198016">&#39;&nbsp;&#39;</span><span class="op" id="5198019">,</span>&nbsp;<span class="string" id="5198021">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198029">suffix</span>&nbsp;<span class="op" id="5198036">=</span>&nbsp;<span class="ident" id="5198038">suffix</span><span class="op" id="5198044">[</span><span class="num" id="5198045">0</span><span class="op" id="5198046">:</span><span class="ident" id="5198047">n</span><span class="op" id="5198048">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198053">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5198058">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5198116">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198170">prefix</span>&nbsp;<span class="op" id="5198177">=</span>&nbsp;<span class="ident" id="5198179">strings</span><span class="op" id="5198186">.</span><span class="ident" id="5198187">TrimSuffix</span><span class="op" id="5198197">(</span><span class="ident" id="5198198">prefix</span><span class="op" id="5198204">,</span>&nbsp;<span class="builtintype" id="5198206">string</span><span class="op" id="5198212">(</span><span class="ident" id="5198213">suffix</span><span class="op" id="5198219">)</span><span class="op" id="5198220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198227">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5198231">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5198296">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5198361">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198372">last</span>&nbsp;<span class="op" id="5198377">:=</span>&nbsp;<span class="ident" id="5198380">lines</span><span class="op" id="5198385">[</span><span class="builtinfunc" id="5198386">len</span><span class="op" id="5198389">(</span><span class="ident" id="5198390">lines</span><span class="op" id="5198395">)</span><span class="op" id="5198396">-</span><span class="num" id="5198397">1</span><span class="op" id="5198398">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198401">closing</span>&nbsp;<span class="op" id="5198409">:=</span>&nbsp;<span class="string" id="5198412">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198418">i</span>&nbsp;<span class="op" id="5198420">:=</span>&nbsp;<span class="ident" id="5198423">strings</span><span class="op" id="5198430">.</span><span class="ident" id="5198431">Index</span><span class="op" id="5198436">(</span><span class="ident" id="5198437">last</span><span class="op" id="5198441">,</span>&nbsp;<span class="ident" id="5198443">closing</span><span class="op" id="5198450">)</span>&nbsp;<span class="comment" id="5198452">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198491">if</span>&nbsp;<span class="ident" id="5198494">isBlank</span><span class="op" id="5198501">(</span><span class="ident" id="5198502">last</span><span class="op" id="5198506">[</span><span class="num" id="5198507">0</span><span class="op" id="5198508">:</span><span class="ident" id="5198509">i</span><span class="op" id="5198510">]</span><span class="op" id="5198511">)</span>&nbsp;<span class="op" id="5198513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5198517">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198557">if</span>&nbsp;<span class="ident" id="5198560">lineOfStars</span>&nbsp;<span class="op" id="5198572">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198577">closing</span>&nbsp;<span class="op" id="5198585">=</span>&nbsp;<span class="string" id="5198587">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="5198593">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198632">lines</span><span class="op" id="5198637">[</span><span class="builtinfunc" id="5198638">len</span><span class="op" id="5198641">(</span><span class="ident" id="5198642">lines</span><span class="op" id="5198647">)</span><span class="op" id="5198648">-</span><span class="num" id="5198649">1</span><span class="op" id="5198650">]</span>&nbsp;<span class="op" id="5198652">=</span>&nbsp;<span class="ident" id="5198654">prefix</span>&nbsp;<span class="op" id="5198661">+</span>&nbsp;<span class="ident" id="5198663">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198672">}</span>&nbsp;<span class="keyword" id="5198674">else</span>&nbsp;<span class="op" id="5198679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5198683">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5198734">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5198786">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198813">prefix</span>&nbsp;<span class="op" id="5198820">=</span>&nbsp;<span class="ident" id="5198822">commonPrefix</span><span class="op" id="5198834">(</span><span class="ident" id="5198835">prefix</span><span class="op" id="5198841">,</span>&nbsp;<span class="ident" id="5198843">last</span><span class="op" id="5198847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5198850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5198854">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198923">for</span>&nbsp;<span class="ident" id="5198927">i</span><span class="op" id="5198928">,</span>&nbsp;<span class="ident" id="5198930">line</span>&nbsp;<span class="op" id="5198935">:=</span>&nbsp;<span class="keyword" id="5198938">range</span>&nbsp;<span class="ident" id="5198944">lines</span>&nbsp;<span class="op" id="5198950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5198954">if</span>&nbsp;<span class="ident" id="5198957">i</span>&nbsp;<span class="op" id="5198959">&gt;</span>&nbsp;<span class="num" id="5198961">0</span>&nbsp;<span class="op" id="5198963">&amp;&amp;</span>&nbsp;<span class="ident" id="5198966">line</span>&nbsp;<span class="op" id="5198971">!=</span>&nbsp;<span class="string" id="5198974">&#34;&#34;</span>&nbsp;<span class="op" id="5198977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198982">lines</span><span class="op" id="5198987">[</span><span class="ident" id="5198988">i</span><span class="op" id="5198989">]</span>&nbsp;<span class="op" id="5198991">=</span>&nbsp;<span class="ident" id="5198993">line</span><span class="op" id="5198997">[</span><span class="builtinfunc" id="5198998">len</span><span class="op" id="5199001">(</span><span class="ident" id="5199002">prefix</span><span class="op" id="5199008">)</span><span class="op" id="5199009">:</span><span class="op" id="5199010">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199014">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199017">}</span><br>
<span class="lineno"></span><span class="op" id="5199019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5199022">func</span>&nbsp;<span class="op" id="5199027">(</span><span class="ident" id="5199028">p</span>&nbsp;<span class="op" id="5199030">*</span><span class="ident" id="5199031">printer</span><span class="op" id="5199038">)</span>&nbsp;<span class="ident" id="5199040">writeComment</span><span class="op" id="5199052">(</span><span class="ident" id="5199053">comment</span>&nbsp;<span class="op" id="5199061">*</span><span class="ident" id="5199062">ast</span><span class="op" id="5199065">.</span><span class="ident" id="5199066">Comment</span><span class="op" id="5199073">)</span>&nbsp;<span class="op" id="5199075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199078">text</span>&nbsp;<span class="op" id="5199083">:=</span>&nbsp;<span class="ident" id="5199086">comment</span><span class="op" id="5199093">.</span><span class="ident" id="5199094">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199100">pos</span>&nbsp;<span class="op" id="5199104">:=</span>&nbsp;<span class="ident" id="5199107">p</span><span class="op" id="5199108">.</span><span class="ident" id="5199109">posFor</span><span class="op" id="5199115">(</span><span class="ident" id="5199116">comment</span><span class="op" id="5199123">.</span><span class="ident" id="5199124">Pos</span><span class="op" id="5199127">(</span><span class="op" id="5199128">)</span><span class="op" id="5199129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199133">const</span>&nbsp;<span class="ident" id="5199139">linePrefix</span>&nbsp;<span class="op" id="5199150">=</span>&nbsp;<span class="string" id="5199152">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199163">if</span>&nbsp;<span class="ident" id="5199166">strings</span><span class="op" id="5199173">.</span><span class="ident" id="5199174">HasPrefix</span><span class="op" id="5199183">(</span><span class="ident" id="5199184">text</span><span class="op" id="5199188">,</span>&nbsp;<span class="ident" id="5199190">linePrefix</span><span class="op" id="5199200">)</span>&nbsp;<span class="op" id="5199202">&amp;&amp;</span>&nbsp;<span class="op" id="5199205">(</span><span class="op" id="5199206">!</span><span class="ident" id="5199207">pos</span><span class="op" id="5199210">.</span><span class="ident" id="5199211">IsValid</span><span class="op" id="5199218">(</span><span class="op" id="5199219">)</span>&nbsp;<span class="op" id="5199221">||</span>&nbsp;<span class="ident" id="5199224">pos</span><span class="op" id="5199227">.</span><span class="ident" id="5199228">Column</span>&nbsp;<span class="op" id="5199235">==</span>&nbsp;<span class="num" id="5199238">1</span><span class="op" id="5199239">)</span>&nbsp;<span class="op" id="5199241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5199245">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199276">ldir</span>&nbsp;<span class="op" id="5199281">:=</span>&nbsp;<span class="ident" id="5199284">strings</span><span class="op" id="5199291">.</span><span class="ident" id="5199292">TrimSpace</span><span class="op" id="5199301">(</span><span class="ident" id="5199302">text</span><span class="op" id="5199306">[</span><span class="builtinfunc" id="5199307">len</span><span class="op" id="5199310">(</span><span class="ident" id="5199311">linePrefix</span><span class="op" id="5199321">)</span><span class="op" id="5199322">:</span><span class="op" id="5199323">]</span><span class="op" id="5199324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199328">if</span>&nbsp;<span class="ident" id="5199331">i</span>&nbsp;<span class="op" id="5199333">:=</span>&nbsp;<span class="ident" id="5199336">strings</span><span class="op" id="5199343">.</span><span class="ident" id="5199344">LastIndex</span><span class="op" id="5199353">(</span><span class="ident" id="5199354">ldir</span><span class="op" id="5199358">,</span>&nbsp;<span class="string" id="5199360">&#34;:&#34;</span><span class="op" id="5199363">)</span><span class="op" id="5199364">;</span>&nbsp;<span class="ident" id="5199366">i</span>&nbsp;<span class="op" id="5199368">&gt;=</span>&nbsp;<span class="num" id="5199371">0</span>&nbsp;<span class="op" id="5199373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199378">if</span>&nbsp;<span class="ident" id="5199381">line</span><span class="op" id="5199385">,</span>&nbsp;<span class="ident" id="5199387">err</span>&nbsp;<span class="op" id="5199391">:=</span>&nbsp;<span class="ident" id="5199394">strconv</span><span class="op" id="5199401">.</span><span class="ident" id="5199402">Atoi</span><span class="op" id="5199406">(</span><span class="ident" id="5199407">ldir</span><span class="op" id="5199411">[</span><span class="ident" id="5199412">i</span><span class="op" id="5199413">+</span><span class="num" id="5199414">1</span><span class="op" id="5199415">:</span><span class="op" id="5199416">]</span><span class="op" id="5199417">)</span><span class="op" id="5199418">;</span>&nbsp;<span class="ident" id="5199420">err</span>&nbsp;<span class="op" id="5199424">==</span>&nbsp;<span class="ident" id="5199427">nil</span>&nbsp;<span class="op" id="5199431">&amp;&amp;</span>&nbsp;<span class="ident" id="5199434">line</span>&nbsp;<span class="op" id="5199439">&gt;</span>&nbsp;<span class="num" id="5199441">0</span>&nbsp;<span class="op" id="5199443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5199449">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5199505">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5199561">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5199617">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199673">indent</span>&nbsp;<span class="op" id="5199680">:=</span>&nbsp;<span class="ident" id="5199683">p</span><span class="op" id="5199684">.</span><span class="ident" id="5199685">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199696">p</span><span class="op" id="5199697">.</span><span class="ident" id="5199698">indent</span>&nbsp;<span class="op" id="5199705">=</span>&nbsp;<span class="num" id="5199707">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199713">defer</span>&nbsp;<span class="keyword" id="5199719">func</span><span class="op" id="5199723">(</span><span class="op" id="5199724">)</span>&nbsp;<span class="op" id="5199726">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199733">p</span><span class="op" id="5199734">.</span><span class="ident" id="5199735">pos</span><span class="op" id="5199738">.</span><span class="ident" id="5199739">Filename</span>&nbsp;<span class="op" id="5199748">=</span>&nbsp;<span class="ident" id="5199750">ldir</span><span class="op" id="5199754">[</span><span class="op" id="5199755">:</span><span class="ident" id="5199756">i</span><span class="op" id="5199757">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199764">p</span><span class="op" id="5199765">.</span><span class="ident" id="5199766">pos</span><span class="op" id="5199769">.</span><span class="ident" id="5199770">Line</span>&nbsp;<span class="op" id="5199775">=</span>&nbsp;<span class="ident" id="5199777">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199787">p</span><span class="op" id="5199788">.</span><span class="ident" id="5199789">pos</span><span class="op" id="5199792">.</span><span class="ident" id="5199793">Column</span>&nbsp;<span class="op" id="5199800">=</span>&nbsp;<span class="num" id="5199802">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199809">p</span><span class="op" id="5199810">.</span><span class="ident" id="5199811">indent</span>&nbsp;<span class="op" id="5199818">=</span>&nbsp;<span class="ident" id="5199820">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199831">}</span><span class="op" id="5199832">(</span><span class="op" id="5199833">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5199849">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199895">if</span>&nbsp;<span class="ident" id="5199898">text</span><span class="op" id="5199902">[</span><span class="num" id="5199903">1</span><span class="op" id="5199904">]</span>&nbsp;<span class="op" id="5199906">==</span>&nbsp;<span class="string" id="5199909">&#39;/&#39;</span>&nbsp;<span class="op" id="5199913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199917">p</span><span class="op" id="5199918">.</span><span class="ident" id="5199919">writeString</span><span class="op" id="5199930">(</span><span class="ident" id="5199931">pos</span><span class="op" id="5199934">,</span>&nbsp;<span class="ident" id="5199936">trimRight</span><span class="op" id="5199945">(</span><span class="ident" id="5199946">text</span><span class="op" id="5199950">)</span><span class="op" id="5199951">,</span>&nbsp;<span class="builtintype" id="5199953">true</span><span class="op" id="5199957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199961">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5199973">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200031">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200086">lines</span>&nbsp;<span class="op" id="5200092">:=</span>&nbsp;<span class="ident" id="5200095">strings</span><span class="op" id="5200102">.</span><span class="ident" id="5200103">Split</span><span class="op" id="5200108">(</span><span class="ident" id="5200109">text</span><span class="op" id="5200113">,</span>&nbsp;<span class="string" id="5200115">&#34;\n&#34;</span><span class="op" id="5200119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200123">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200180">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200242">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200303">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200366">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200426">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200456">if</span>&nbsp;<span class="ident" id="5200459">pos</span><span class="op" id="5200462">.</span><span class="ident" id="5200463">IsValid</span><span class="op" id="5200470">(</span><span class="op" id="5200471">)</span>&nbsp;<span class="op" id="5200473">&amp;&amp;</span>&nbsp;<span class="ident" id="5200476">pos</span><span class="op" id="5200479">.</span><span class="ident" id="5200480">Column</span>&nbsp;<span class="op" id="5200487">==</span>&nbsp;<span class="num" id="5200490">1</span>&nbsp;<span class="op" id="5200492">&amp;&amp;</span>&nbsp;<span class="ident" id="5200495">p</span><span class="op" id="5200496">.</span><span class="ident" id="5200497">indent</span>&nbsp;<span class="op" id="5200504">&gt;</span>&nbsp;<span class="num" id="5200506">0</span>&nbsp;<span class="op" id="5200508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200512">for</span>&nbsp;<span class="ident" id="5200516">i</span><span class="op" id="5200517">,</span>&nbsp;<span class="ident" id="5200519">line</span>&nbsp;<span class="op" id="5200524">:=</span>&nbsp;<span class="keyword" id="5200527">range</span>&nbsp;<span class="ident" id="5200533">lines</span><span class="op" id="5200538">[</span><span class="num" id="5200539">1</span><span class="op" id="5200540">:</span><span class="op" id="5200541">]</span>&nbsp;<span class="op" id="5200543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200548">lines</span><span class="op" id="5200553">[</span><span class="num" id="5200554">1</span><span class="op" id="5200555">+</span><span class="ident" id="5200556">i</span><span class="op" id="5200557">]</span>&nbsp;<span class="op" id="5200559">=</span>&nbsp;<span class="string" id="5200561">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="5200567">+</span>&nbsp;<span class="ident" id="5200569">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200579">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200583">stripCommonPrefix</span><span class="op" id="5200600">(</span><span class="ident" id="5200601">lines</span><span class="op" id="5200606">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200610">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200658">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200703">for</span>&nbsp;<span class="ident" id="5200707">i</span><span class="op" id="5200708">,</span>&nbsp;<span class="ident" id="5200710">line</span>&nbsp;<span class="op" id="5200715">:=</span>&nbsp;<span class="keyword" id="5200718">range</span>&nbsp;<span class="ident" id="5200724">lines</span>&nbsp;<span class="op" id="5200730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200734">if</span>&nbsp;<span class="ident" id="5200737">i</span>&nbsp;<span class="op" id="5200739">&gt;</span>&nbsp;<span class="num" id="5200741">0</span>&nbsp;<span class="op" id="5200743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200748">p</span><span class="op" id="5200749">.</span><span class="ident" id="5200750">writeByte</span><span class="op" id="5200759">(</span><span class="string" id="5200760">&#39;\f&#39;</span><span class="op" id="5200764">,</span>&nbsp;<span class="num" id="5200766">1</span><span class="op" id="5200767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200772">pos</span>&nbsp;<span class="op" id="5200776">=</span>&nbsp;<span class="ident" id="5200778">p</span><span class="op" id="5200779">.</span><span class="ident" id="5200780">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200786">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200790">if</span>&nbsp;<span class="builtinfunc" id="5200793">len</span><span class="op" id="5200796">(</span><span class="ident" id="5200797">line</span><span class="op" id="5200801">)</span>&nbsp;<span class="op" id="5200803">&gt;</span>&nbsp;<span class="num" id="5200805">0</span>&nbsp;<span class="op" id="5200807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200812">p</span><span class="op" id="5200813">.</span><span class="ident" id="5200814">writeString</span><span class="op" id="5200825">(</span><span class="ident" id="5200826">pos</span><span class="op" id="5200829">,</span>&nbsp;<span class="ident" id="5200831">trimRight</span><span class="op" id="5200840">(</span><span class="ident" id="5200841">line</span><span class="op" id="5200845">)</span><span class="op" id="5200846">,</span>&nbsp;<span class="builtintype" id="5200848">true</span><span class="op" id="5200852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200859">}</span><br>
<span class="lineno"></span><span class="op" id="5200861">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5200864">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="5200935">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="5201006">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5201075">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="5201143">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5201215">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5201226">//</span><br>
<span class="lineno"></span><span class="keyword" id="5201229">func</span>&nbsp;<span class="op" id="5201234">(</span><span class="ident" id="5201235">p</span>&nbsp;<span class="op" id="5201237">*</span><span class="ident" id="5201238">printer</span><span class="op" id="5201245">)</span>&nbsp;<span class="ident" id="5201247">writeCommentSuffix</span><span class="op" id="5201265">(</span><span class="ident" id="5201266">needsLinebreak</span>&nbsp;<span class="builtintype" id="5201281">bool</span><span class="op" id="5201285">)</span>&nbsp;<span class="op" id="5201287">(</span><span class="ident" id="5201288">wroteNewline</span><span class="op" id="5201300">,</span>&nbsp;<span class="ident" id="5201302">droppedFF</span>&nbsp;<span class="builtintype" id="5201312">bool</span><span class="op" id="5201316">)</span>&nbsp;<span class="op" id="5201318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201321">for</span>&nbsp;<span class="ident" id="5201325">i</span><span class="op" id="5201326">,</span>&nbsp;<span class="ident" id="5201328">ch</span>&nbsp;<span class="op" id="5201331">:=</span>&nbsp;<span class="keyword" id="5201334">range</span>&nbsp;<span class="ident" id="5201340">p</span><span class="op" id="5201341">.</span><span class="ident" id="5201342">wsbuf</span>&nbsp;<span class="op" id="5201348">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201352">switch</span>&nbsp;<span class="ident" id="5201359">ch</span>&nbsp;<span class="op" id="5201362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201366">case</span>&nbsp;<span class="ident" id="5201371">blank</span><span class="op" id="5201376">,</span>&nbsp;<span class="ident" id="5201378">vtab</span><span class="op" id="5201382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5201387">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201420">p</span><span class="op" id="5201421">.</span><span class="ident" id="5201422">wsbuf</span><span class="op" id="5201427">[</span><span class="ident" id="5201428">i</span><span class="op" id="5201429">]</span>&nbsp;<span class="op" id="5201431">=</span>&nbsp;<span class="ident" id="5201433">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201442">case</span>&nbsp;<span class="ident" id="5201447">indent</span><span class="op" id="5201453">,</span>&nbsp;<span class="ident" id="5201455">unindent</span><span class="op" id="5201463">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5201468">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201508">case</span>&nbsp;<span class="ident" id="5201513">newline</span><span class="op" id="5201520">,</span>&nbsp;<span class="ident" id="5201522">formfeed</span><span class="op" id="5201530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5201535">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5201583">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201630">if</span>&nbsp;<span class="ident" id="5201633">needsLinebreak</span>&nbsp;<span class="op" id="5201648">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201654">needsLinebreak</span>&nbsp;<span class="op" id="5201669">=</span>&nbsp;<span class="builtintype" id="5201671">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201681">wroteNewline</span>&nbsp;<span class="op" id="5201694">=</span>&nbsp;<span class="builtintype" id="5201696">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201704">}</span>&nbsp;<span class="keyword" id="5201706">else</span>&nbsp;<span class="op" id="5201711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201717">if</span>&nbsp;<span class="ident" id="5201720">ch</span>&nbsp;<span class="op" id="5201723">==</span>&nbsp;<span class="ident" id="5201726">formfeed</span>&nbsp;<span class="op" id="5201735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201742">droppedFF</span>&nbsp;<span class="op" id="5201752">=</span>&nbsp;<span class="builtintype" id="5201754">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201769">p</span><span class="op" id="5201770">.</span><span class="ident" id="5201771">wsbuf</span><span class="op" id="5201776">[</span><span class="ident" id="5201777">i</span><span class="op" id="5201778">]</span>&nbsp;<span class="op" id="5201780">=</span>&nbsp;<span class="ident" id="5201782">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201799">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201802">p</span><span class="op" id="5201803">.</span><span class="ident" id="5201804">writeWhitespace</span><span class="op" id="5201819">(</span><span class="builtinfunc" id="5201820">len</span><span class="op" id="5201823">(</span><span class="ident" id="5201824">p</span><span class="op" id="5201825">.</span><span class="ident" id="5201826">wsbuf</span><span class="op" id="5201831">)</span><span class="op" id="5201832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5201836">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201871">if</span>&nbsp;<span class="ident" id="5201874">needsLinebreak</span>&nbsp;<span class="op" id="5201889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201893">p</span><span class="op" id="5201894">.</span><span class="ident" id="5201895">writeByte</span><span class="op" id="5201904">(</span><span class="string" id="5201905">&#39;\n&#39;</span><span class="op" id="5201909">,</span>&nbsp;<span class="num" id="5201911">1</span><span class="op" id="5201912">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201916">wroteNewline</span>&nbsp;<span class="op" id="5201929">=</span>&nbsp;<span class="builtintype" id="5201931">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201941">return</span><br>
<span class="lineno"></span><span class="op" id="5201948">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="5201951">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="5202030">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5202111">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="5202190">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="5202268">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5202348">//</span><br>
<span class="lineno"></span><span class="keyword" id="5202351">func</span>&nbsp;<span class="op" id="5202356">(</span><span class="ident" id="5202357">p</span>&nbsp;<span class="op" id="5202359">*</span><span class="ident" id="5202360">printer</span><span class="op" id="5202367">)</span>&nbsp;<span class="ident" id="5202369">intersperseComments</span><span class="op" id="5202388">(</span><span class="ident" id="5202389">next</span>&nbsp;<span class="ident" id="5202394">token</span><span class="op" id="5202399">.</span><span class="ident" id="5202400">Position</span><span class="op" id="5202408">,</span>&nbsp;<span class="ident" id="5202410">tok</span>&nbsp;<span class="ident" id="5202414">token</span><span class="op" id="5202419">.</span><span class="ident" id="5202420">Token</span><span class="op" id="5202425">)</span>&nbsp;<span class="op" id="5202427">(</span><span class="ident" id="5202428">wroteNewline</span><span class="op" id="5202440">,</span>&nbsp;<span class="ident" id="5202442">droppedFF</span>&nbsp;<span class="builtintype" id="5202452">bool</span><span class="op" id="5202456">)</span>&nbsp;<span class="op" id="5202458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202461">var</span>&nbsp;<span class="ident" id="5202465">last</span>&nbsp;<span class="op" id="5202470">*</span><span class="ident" id="5202471">ast</span><span class="op" id="5202474">.</span><span class="ident" id="5202475">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202484">for</span>&nbsp;<span class="ident" id="5202488">p</span><span class="op" id="5202489">.</span><span class="ident" id="5202490">commentBefore</span><span class="op" id="5202503">(</span><span class="ident" id="5202504">next</span><span class="op" id="5202508">)</span>&nbsp;<span class="op" id="5202510">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202514">for</span>&nbsp;<span class="ident" id="5202518">_</span><span class="op" id="5202519">,</span>&nbsp;<span class="ident" id="5202521">c</span>&nbsp;<span class="op" id="5202523">:=</span>&nbsp;<span class="keyword" id="5202526">range</span>&nbsp;<span class="ident" id="5202532">p</span><span class="op" id="5202533">.</span><span class="ident" id="5202534">comment</span><span class="op" id="5202541">.</span><span class="ident" id="5202542">List</span>&nbsp;<span class="op" id="5202547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202552">p</span><span class="op" id="5202553">.</span><span class="ident" id="5202554">writeCommentPrefix</span><span class="op" id="5202572">(</span><span class="ident" id="5202573">p</span><span class="op" id="5202574">.</span><span class="ident" id="5202575">posFor</span><span class="op" id="5202581">(</span><span class="ident" id="5202582">c</span><span class="op" id="5202583">.</span><span class="ident" id="5202584">Pos</span><span class="op" id="5202587">(</span><span class="op" id="5202588">)</span><span class="op" id="5202589">)</span><span class="op" id="5202590">,</span>&nbsp;<span class="ident" id="5202592">next</span><span class="op" id="5202596">,</span>&nbsp;<span class="ident" id="5202598">last</span><span class="op" id="5202602">,</span>&nbsp;<span class="ident" id="5202604">c</span><span class="op" id="5202605">,</span>&nbsp;<span class="ident" id="5202607">tok</span><span class="op" id="5202610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202615">p</span><span class="op" id="5202616">.</span><span class="ident" id="5202617">writeComment</span><span class="op" id="5202629">(</span><span class="ident" id="5202630">c</span><span class="op" id="5202631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202636">last</span>&nbsp;<span class="op" id="5202641">=</span>&nbsp;<span class="ident" id="5202643">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202647">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202651">p</span><span class="op" id="5202652">.</span><span class="ident" id="5202653">nextComment</span><span class="op" id="5202664">(</span><span class="op" id="5202665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202672">if</span>&nbsp;<span class="ident" id="5202675">last</span>&nbsp;<span class="op" id="5202680">!=</span>&nbsp;<span class="ident" id="5202683">nil</span>&nbsp;<span class="op" id="5202687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5202691">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5202756">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5202826">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5202894">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202960">if</span>&nbsp;<span class="ident" id="5202963">p</span><span class="op" id="5202964">.</span><span class="ident" id="5202965">mode</span><span class="op" id="5202969">&amp;</span><span class="ident" id="5202970">noExtraBlank</span>&nbsp;<span class="op" id="5202983">==</span>&nbsp;<span class="num" id="5202986">0</span>&nbsp;<span class="op" id="5202988">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202994">last</span><span class="op" id="5202998">.</span><span class="ident" id="5202999">Text</span><span class="op" id="5203003">[</span><span class="num" id="5203004">1</span><span class="op" id="5203005">]</span>&nbsp;<span class="op" id="5203007">==</span>&nbsp;<span class="string" id="5203010">&#39;*&#39;</span>&nbsp;<span class="op" id="5203014">&amp;&amp;</span>&nbsp;<span class="ident" id="5203017">p</span><span class="op" id="5203018">.</span><span class="ident" id="5203019">lineFor</span><span class="op" id="5203026">(</span><span class="ident" id="5203027">last</span><span class="op" id="5203031">.</span><span class="ident" id="5203032">Pos</span><span class="op" id="5203035">(</span><span class="op" id="5203036">)</span><span class="op" id="5203037">)</span>&nbsp;<span class="op" id="5203039">==</span>&nbsp;<span class="ident" id="5203042">next</span><span class="op" id="5203046">.</span><span class="ident" id="5203047">Line</span>&nbsp;<span class="op" id="5203052">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203058">tok</span>&nbsp;<span class="op" id="5203062">!=</span>&nbsp;<span class="ident" id="5203065">token</span><span class="op" id="5203070">.</span><span class="ident" id="5203071">COMMA</span>&nbsp;<span class="op" id="5203077">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203083">(</span><span class="ident" id="5203084">tok</span>&nbsp;<span class="op" id="5203088">!=</span>&nbsp;<span class="ident" id="5203091">token</span><span class="op" id="5203096">.</span><span class="ident" id="5203097">RPAREN</span>&nbsp;<span class="op" id="5203104">||</span>&nbsp;<span class="ident" id="5203107">p</span><span class="op" id="5203108">.</span><span class="ident" id="5203109">prevOpen</span>&nbsp;<span class="op" id="5203118">==</span>&nbsp;<span class="ident" id="5203121">token</span><span class="op" id="5203126">.</span><span class="ident" id="5203127">LPAREN</span><span class="op" id="5203133">)</span>&nbsp;<span class="op" id="5203135">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203141">(</span><span class="ident" id="5203142">tok</span>&nbsp;<span class="op" id="5203146">!=</span>&nbsp;<span class="ident" id="5203149">token</span><span class="op" id="5203154">.</span><span class="ident" id="5203155">RBRACK</span>&nbsp;<span class="op" id="5203162">||</span>&nbsp;<span class="ident" id="5203165">p</span><span class="op" id="5203166">.</span><span class="ident" id="5203167">prevOpen</span>&nbsp;<span class="op" id="5203176">==</span>&nbsp;<span class="ident" id="5203179">token</span><span class="op" id="5203184">.</span><span class="ident" id="5203185">LBRACK</span><span class="op" id="5203191">)</span>&nbsp;<span class="op" id="5203193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203198">p</span><span class="op" id="5203199">.</span><span class="ident" id="5203200">writeByte</span><span class="op" id="5203209">(</span><span class="string" id="5203210">&#39;&nbsp;&#39;</span><span class="op" id="5203213">,</span>&nbsp;<span class="num" id="5203215">1</span><span class="op" id="5203216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203220">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203224">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203289">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203353">needsLinebreak</span>&nbsp;<span class="op" id="5203368">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203374">last</span><span class="op" id="5203378">.</span><span class="ident" id="5203379">Text</span><span class="op" id="5203383">[</span><span class="num" id="5203384">1</span><span class="op" id="5203385">]</span>&nbsp;<span class="op" id="5203387">==</span>&nbsp;<span class="string" id="5203390">&#39;/&#39;</span>&nbsp;<span class="op" id="5203394">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203401">tok</span>&nbsp;<span class="op" id="5203405">==</span>&nbsp;<span class="ident" id="5203408">token</span><span class="op" id="5203413">.</span><span class="ident" id="5203414">RBRACE</span>&nbsp;<span class="op" id="5203421">&amp;&amp;</span>&nbsp;<span class="ident" id="5203424">p</span><span class="op" id="5203425">.</span><span class="ident" id="5203426">mode</span><span class="op" id="5203430">&amp;</span><span class="ident" id="5203431">noExtraLinebreak</span>&nbsp;<span class="op" id="5203448">==</span>&nbsp;<span class="num" id="5203451">0</span>&nbsp;<span class="op" id="5203453">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203460">tok</span>&nbsp;<span class="op" id="5203464">==</span>&nbsp;<span class="ident" id="5203467">token</span><span class="op" id="5203472">.</span><span class="ident" id="5203473">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203479">return</span>&nbsp;<span class="ident" id="5203486">p</span><span class="op" id="5203487">.</span><span class="ident" id="5203488">writeCommentSuffix</span><span class="op" id="5203506">(</span><span class="ident" id="5203507">needsLinebreak</span><span class="op" id="5203521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203528">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203590">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203648">p</span><span class="op" id="5203649">.</span><span class="ident" id="5203650">internalError</span><span class="op" id="5203663">(</span><span class="string" id="5203664">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="5203717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203720">return</span><br>
<span class="lineno"></span><span class="op" id="5203727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5203730">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="5203788">func</span>&nbsp;<span class="op" id="5203793">(</span><span class="ident" id="5203794">p</span>&nbsp;<span class="op" id="5203796">*</span><span class="ident" id="5203797">printer</span><span class="op" id="5203804">)</span>&nbsp;<span class="ident" id="5203806">writeWhitespace</span><span class="op" id="5203821">(</span><span class="ident" id="5203822">n</span>&nbsp;<span class="builtintype" id="5203824">int</span><span class="op" id="5203827">)</span>&nbsp;<span class="op" id="5203829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203832">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203850">for</span>&nbsp;<span class="ident" id="5203854">i</span>&nbsp;<span class="op" id="5203856">:=</span>&nbsp;<span class="num" id="5203859">0</span><span class="op" id="5203860">;</span>&nbsp;<span class="ident" id="5203862">i</span>&nbsp;<span class="op" id="5203864">&lt;</span>&nbsp;<span class="ident" id="5203866">n</span><span class="op" id="5203867">;</span>&nbsp;<span class="ident" id="5203869">i</span><span class="op" id="5203870">++</span>&nbsp;<span class="op" id="5203873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203877">switch</span>&nbsp;<span class="ident" id="5203884">ch</span>&nbsp;<span class="op" id="5203887">:=</span>&nbsp;<span class="ident" id="5203890">p</span><span class="op" id="5203891">.</span><span class="ident" id="5203892">wsbuf</span><span class="op" id="5203897">[</span><span class="ident" id="5203898">i</span><span class="op" id="5203899">]</span><span class="op" id="5203900">;</span>&nbsp;<span class="ident" id="5203902">ch</span>&nbsp;<span class="op" id="5203905">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203909">case</span>&nbsp;<span class="ident" id="5203914">ignore</span><span class="op" id="5203920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203925">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203938">case</span>&nbsp;<span class="ident" id="5203943">indent</span><span class="op" id="5203949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203954">p</span><span class="op" id="5203955">.</span><span class="ident" id="5203956">indent</span><span class="op" id="5203962">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203967">case</span>&nbsp;<span class="ident" id="5203972">unindent</span><span class="op" id="5203980">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203985">p</span><span class="op" id="5203986">.</span><span class="ident" id="5203987">indent</span><span class="op" id="5203993">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203999">if</span>&nbsp;<span class="ident" id="5204002">p</span><span class="op" id="5204003">.</span><span class="ident" id="5204004">indent</span>&nbsp;<span class="op" id="5204011">&lt;</span>&nbsp;<span class="num" id="5204013">0</span>&nbsp;<span class="op" id="5204015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204021">p</span><span class="op" id="5204022">.</span><span class="ident" id="5204023">internalError</span><span class="op" id="5204036">(</span><span class="string" id="5204037">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="5204060">,</span>&nbsp;<span class="ident" id="5204062">p</span><span class="op" id="5204063">.</span><span class="ident" id="5204064">indent</span><span class="op" id="5204070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204076">p</span><span class="op" id="5204077">.</span><span class="ident" id="5204078">indent</span>&nbsp;<span class="op" id="5204085">=</span>&nbsp;<span class="num" id="5204087">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204092">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204096">case</span>&nbsp;<span class="ident" id="5204101">newline</span><span class="op" id="5204108">,</span>&nbsp;<span class="ident" id="5204110">formfeed</span><span class="op" id="5204118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204123">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204181">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204240">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204296">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204352">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204412">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204457">if</span>&nbsp;<span class="ident" id="5204460">i</span><span class="op" id="5204461">+</span><span class="num" id="5204462">1</span>&nbsp;<span class="op" id="5204464">&lt;</span>&nbsp;<span class="ident" id="5204466">n</span>&nbsp;<span class="op" id="5204468">&amp;&amp;</span>&nbsp;<span class="ident" id="5204471">p</span><span class="op" id="5204472">.</span><span class="ident" id="5204473">wsbuf</span><span class="op" id="5204478">[</span><span class="ident" id="5204479">i</span><span class="op" id="5204480">+</span><span class="num" id="5204481">1</span><span class="op" id="5204482">]</span>&nbsp;<span class="op" id="5204484">==</span>&nbsp;<span class="ident" id="5204487">unindent</span>&nbsp;<span class="op" id="5204496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204502">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204558">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204619">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204679">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204742">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204762">p</span><span class="op" id="5204763">.</span><span class="ident" id="5204764">wsbuf</span><span class="op" id="5204769">[</span><span class="ident" id="5204770">i</span><span class="op" id="5204771">]</span><span class="op" id="5204772">,</span>&nbsp;<span class="ident" id="5204774">p</span><span class="op" id="5204775">.</span><span class="ident" id="5204776">wsbuf</span><span class="op" id="5204781">[</span><span class="ident" id="5204782">i</span><span class="op" id="5204783">+</span><span class="num" id="5204784">1</span><span class="op" id="5204785">]</span>&nbsp;<span class="op" id="5204787">=</span>&nbsp;<span class="ident" id="5204789">unindent</span><span class="op" id="5204797">,</span>&nbsp;<span class="ident" id="5204799">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204812">i</span><span class="op" id="5204813">--</span>&nbsp;<span class="comment" id="5204816">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204835">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204852">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204866">default</span><span class="op" id="5204873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204878">p</span><span class="op" id="5204879">.</span><span class="ident" id="5204880">writeByte</span><span class="op" id="5204889">(</span><span class="builtintype" id="5204890">byte</span><span class="op" id="5204894">(</span><span class="ident" id="5204895">ch</span><span class="op" id="5204897">)</span><span class="op" id="5204898">,</span>&nbsp;<span class="num" id="5204900">1</span><span class="op" id="5204901">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204912">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204945">l</span>&nbsp;<span class="op" id="5204947">:=</span>&nbsp;<span class="builtinfunc" id="5204950">copy</span><span class="op" id="5204954">(</span><span class="ident" id="5204955">p</span><span class="op" id="5204956">.</span><span class="ident" id="5204957">wsbuf</span><span class="op" id="5204962">,</span>&nbsp;<span class="ident" id="5204964">p</span><span class="op" id="5204965">.</span><span class="ident" id="5204966">wsbuf</span><span class="op" id="5204971">[</span><span class="ident" id="5204972">n</span><span class="op" id="5204973">:</span><span class="op" id="5204974">]</span><span class="op" id="5204975">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204978">p</span><span class="op" id="5204979">.</span><span class="ident" id="5204980">wsbuf</span>&nbsp;<span class="op" id="5204986">=</span>&nbsp;<span class="ident" id="5204988">p</span><span class="op" id="5204989">.</span><span class="ident" id="5204990">wsbuf</span><span class="op" id="5204995">[</span><span class="op" id="5204996">:</span><span class="ident" id="5204997">l</span><span class="op" id="5204998">]</span><br>
<span class="lineno"></span><span class="op" id="5205000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5205003">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5205083">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5205106">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="5205141">func</span>&nbsp;<span class="ident" id="5205146">nlimit</span><span class="op" id="5205152">(</span><span class="ident" id="5205153">n</span>&nbsp;<span class="builtintype" id="5205155">int</span><span class="op" id="5205158">)</span>&nbsp;<span class="builtintype" id="5205160">int</span>&nbsp;<span class="op" id="5205164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205167">if</span>&nbsp;<span class="ident" id="5205170">n</span>&nbsp;<span class="op" id="5205172">&gt;</span>&nbsp;<span class="ident" id="5205174">maxNewlines</span>&nbsp;<span class="op" id="5205186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205190">n</span>&nbsp;<span class="op" id="5205192">=</span>&nbsp;<span class="ident" id="5205194">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205210">return</span>&nbsp;<span class="ident" id="5205217">n</span><br>
<span class="lineno"></span><span class="op" id="5205219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5205222">func</span>&nbsp;<span class="ident" id="5205227">mayCombine</span><span class="op" id="5205237">(</span><span class="ident" id="5205238">prev</span>&nbsp;<span class="ident" id="5205243">token</span><span class="op" id="5205248">.</span><span class="ident" id="5205249">Token</span><span class="op" id="5205254">,</span>&nbsp;<span class="ident" id="5205256">next</span>&nbsp;<span class="builtintype" id="5205261">byte</span><span class="op" id="5205265">)</span>&nbsp;<span class="op" id="5205267">(</span><span class="ident" id="5205268">b</span>&nbsp;<span class="builtintype" id="5205270">bool</span><span class="op" id="5205274">)</span>&nbsp;<span class="op" id="5205276">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205279">switch</span>&nbsp;<span class="ident" id="5205286">prev</span>&nbsp;<span class="op" id="5205291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205294">case</span>&nbsp;<span class="ident" id="5205299">token</span><span class="op" id="5205304">.</span><span class="ident" id="5205305">INT</span><span class="op" id="5205308">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205312">b</span>&nbsp;<span class="op" id="5205314">=</span>&nbsp;<span class="ident" id="5205316">next</span>&nbsp;<span class="op" id="5205321">==</span>&nbsp;<span class="string" id="5205324">&#39;.&#39;</span>&nbsp;<span class="comment" id="5205328">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205335">case</span>&nbsp;<span class="ident" id="5205340">token</span><span class="op" id="5205345">.</span><span class="ident" id="5205346">ADD</span><span class="op" id="5205349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205353">b</span>&nbsp;<span class="op" id="5205355">=</span>&nbsp;<span class="ident" id="5205357">next</span>&nbsp;<span class="op" id="5205362">==</span>&nbsp;<span class="string" id="5205365">&#39;+&#39;</span>&nbsp;<span class="comment" id="5205369">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205376">case</span>&nbsp;<span class="ident" id="5205381">token</span><span class="op" id="5205386">.</span><span class="ident" id="5205387">SUB</span><span class="op" id="5205390">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205394">b</span>&nbsp;<span class="op" id="5205396">=</span>&nbsp;<span class="ident" id="5205398">next</span>&nbsp;<span class="op" id="5205403">==</span>&nbsp;<span class="string" id="5205406">&#39;-&#39;</span>&nbsp;<span class="comment" id="5205410">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205417">case</span>&nbsp;<span class="ident" id="5205422">token</span><span class="op" id="5205427">.</span><span class="ident" id="5205428">QUO</span><span class="op" id="5205431">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205435">b</span>&nbsp;<span class="op" id="5205437">=</span>&nbsp;<span class="ident" id="5205439">next</span>&nbsp;<span class="op" id="5205444">==</span>&nbsp;<span class="string" id="5205447">&#39;*&#39;</span>&nbsp;<span class="comment" id="5205451">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205458">case</span>&nbsp;<span class="ident" id="5205463">token</span><span class="op" id="5205468">.</span><span class="ident" id="5205469">LSS</span><span class="op" id="5205472">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205476">b</span>&nbsp;<span class="op" id="5205478">=</span>&nbsp;<span class="ident" id="5205480">next</span>&nbsp;<span class="op" id="5205485">==</span>&nbsp;<span class="string" id="5205488">&#39;-&#39;</span>&nbsp;<span class="op" id="5205492">||</span>&nbsp;<span class="ident" id="5205495">next</span>&nbsp;<span class="op" id="5205500">==</span>&nbsp;<span class="string" id="5205503">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="5205507">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205520">case</span>&nbsp;<span class="ident" id="5205525">token</span><span class="op" id="5205530">.</span><span class="ident" id="5205531">AND</span><span class="op" id="5205534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205538">b</span>&nbsp;<span class="op" id="5205540">=</span>&nbsp;<span class="ident" id="5205542">next</span>&nbsp;<span class="op" id="5205547">==</span>&nbsp;<span class="string" id="5205550">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5205554">||</span>&nbsp;<span class="ident" id="5205557">next</span>&nbsp;<span class="op" id="5205562">==</span>&nbsp;<span class="string" id="5205565">&#39;^&#39;</span>&nbsp;<span class="comment" id="5205569">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205585">return</span><br>
<span class="lineno">825</span><span class="op" id="5205592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5205595">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="5205665">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="5205735">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="5205804">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="5205854">//</span><br>
<span class="lineno"></span><span class="comment" id="5205857">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5205928">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="5205997">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="5206067">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5206137">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5206179">//</span><br>
<span class="lineno"></span><span class="keyword" id="5206182">func</span>&nbsp;<span class="op" id="5206187">(</span><span class="ident" id="5206188">p</span>&nbsp;<span class="op" id="5206190">*</span><span class="ident" id="5206191">printer</span><span class="op" id="5206198">)</span>&nbsp;<span class="builtinfunc" id="5206200">print</span><span class="op" id="5206205">(</span><span class="ident" id="5206206">args</span>&nbsp;<span class="op" id="5206211">...</span><span class="keyword" id="5206214">interface</span><span class="op" id="5206223">{</span><span class="op" id="5206224">}</span><span class="op" id="5206225">)</span>&nbsp;<span class="op" id="5206227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206230">for</span>&nbsp;<span class="ident" id="5206234">_</span><span class="op" id="5206235">,</span>&nbsp;<span class="ident" id="5206237">arg</span>&nbsp;<span class="op" id="5206241">:=</span>&nbsp;<span class="keyword" id="5206244">range</span>&nbsp;<span class="ident" id="5206250">args</span>&nbsp;<span class="op" id="5206255">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206259">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206298">var</span>&nbsp;<span class="ident" id="5206302">data</span>&nbsp;<span class="builtintype" id="5206307">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206316">var</span>&nbsp;<span class="ident" id="5206320">isLit</span>&nbsp;<span class="builtintype" id="5206326">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206333">var</span>&nbsp;<span class="ident" id="5206337">impliedSemi</span>&nbsp;<span class="builtintype" id="5206349">bool</span>&nbsp;<span class="comment" id="5206354">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206399">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206442">switch</span>&nbsp;<span class="ident" id="5206449">p</span><span class="op" id="5206450">.</span><span class="ident" id="5206451">lastTok</span>&nbsp;<span class="op" id="5206459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206463">case</span>&nbsp;<span class="ident" id="5206468">token</span><span class="op" id="5206473">.</span><span class="ident" id="5206474">ILLEGAL</span><span class="op" id="5206481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206486">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206512">case</span>&nbsp;<span class="ident" id="5206517">token</span><span class="op" id="5206522">.</span><span class="ident" id="5206523">LPAREN</span><span class="op" id="5206529">,</span>&nbsp;<span class="ident" id="5206531">token</span><span class="op" id="5206536">.</span><span class="ident" id="5206537">LBRACK</span><span class="op" id="5206543">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206548">p</span><span class="op" id="5206549">.</span><span class="ident" id="5206550">prevOpen</span>&nbsp;<span class="op" id="5206559">=</span>&nbsp;<span class="ident" id="5206561">p</span><span class="op" id="5206562">.</span><span class="ident" id="5206563">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206573">default</span><span class="op" id="5206580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206585">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206631">p</span><span class="op" id="5206632">.</span><span class="ident" id="5206633">prevOpen</span>&nbsp;<span class="op" id="5206642">=</span>&nbsp;<span class="ident" id="5206644">token</span><span class="op" id="5206649">.</span><span class="ident" id="5206650">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206660">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206665">switch</span>&nbsp;<span class="ident" id="5206672">x</span>&nbsp;<span class="op" id="5206674">:=</span>&nbsp;<span class="ident" id="5206677">arg</span><span class="op" id="5206680">.</span><span class="op" id="5206681">(</span><span class="keyword" id="5206682">type</span><span class="op" id="5206686">)</span>&nbsp;<span class="op" id="5206688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206692">case</span>&nbsp;<span class="ident" id="5206697">pmode</span><span class="op" id="5206702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206707">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206733">p</span><span class="op" id="5206734">.</span><span class="ident" id="5206735">mode</span>&nbsp;<span class="op" id="5206740">^=</span>&nbsp;<span class="ident" id="5206743">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206748">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206760">case</span>&nbsp;<span class="ident" id="5206765">whiteSpace</span><span class="op" id="5206775">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206780">if</span>&nbsp;<span class="ident" id="5206783">x</span>&nbsp;<span class="op" id="5206785">==</span>&nbsp;<span class="ident" id="5206788">ignore</span>&nbsp;<span class="op" id="5206795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206801">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206847">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206895">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206915">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206932">i</span>&nbsp;<span class="op" id="5206934">:=</span>&nbsp;<span class="builtinfunc" id="5206937">len</span><span class="op" id="5206940">(</span><span class="ident" id="5206941">p</span><span class="op" id="5206942">.</span><span class="ident" id="5206943">wsbuf</span><span class="op" id="5206948">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206953">if</span>&nbsp;<span class="ident" id="5206956">i</span>&nbsp;<span class="op" id="5206958">==</span>&nbsp;<span class="builtinfunc" id="5206961">cap</span><span class="op" id="5206964">(</span><span class="ident" id="5206965">p</span><span class="op" id="5206966">.</span><span class="ident" id="5206967">wsbuf</span><span class="op" id="5206972">)</span>&nbsp;<span class="op" id="5206974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206980">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207038">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207096">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207145">p</span><span class="op" id="5207146">.</span><span class="ident" id="5207147">writeWhitespace</span><span class="op" id="5207162">(</span><span class="ident" id="5207163">i</span><span class="op" id="5207164">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207170">i</span>&nbsp;<span class="op" id="5207172">=</span>&nbsp;<span class="num" id="5207174">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207184">p</span><span class="op" id="5207185">.</span><span class="ident" id="5207186">wsbuf</span>&nbsp;<span class="op" id="5207192">=</span>&nbsp;<span class="ident" id="5207194">p</span><span class="op" id="5207195">.</span><span class="ident" id="5207196">wsbuf</span><span class="op" id="5207201">[</span><span class="num" id="5207202">0</span>&nbsp;<span class="op" id="5207204">:</span>&nbsp;<span class="ident" id="5207206">i</span><span class="op" id="5207207">+</span><span class="num" id="5207208">1</span><span class="op" id="5207209">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207214">p</span><span class="op" id="5207215">.</span><span class="ident" id="5207216">wsbuf</span><span class="op" id="5207221">[</span><span class="ident" id="5207222">i</span><span class="op" id="5207223">]</span>&nbsp;<span class="op" id="5207225">=</span>&nbsp;<span class="ident" id="5207227">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207232">if</span>&nbsp;<span class="ident" id="5207235">x</span>&nbsp;<span class="op" id="5207237">==</span>&nbsp;<span class="ident" id="5207240">newline</span>&nbsp;<span class="op" id="5207248">||</span>&nbsp;<span class="ident" id="5207251">x</span>&nbsp;<span class="op" id="5207253">==</span>&nbsp;<span class="ident" id="5207256">formfeed</span>&nbsp;<span class="op" id="5207265">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207271">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207328">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207386">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207445">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207465">p</span><span class="op" id="5207466">.</span><span class="ident" id="5207467">impliedSemi</span>&nbsp;<span class="op" id="5207479">=</span>&nbsp;<span class="builtintype" id="5207481">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207495">p</span><span class="op" id="5207496">.</span><span class="ident" id="5207497">lastTok</span>&nbsp;<span class="op" id="5207505">=</span>&nbsp;<span class="ident" id="5207507">token</span><span class="op" id="5207512">.</span><span class="ident" id="5207513">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207524">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207536">case</span>&nbsp;<span class="op" id="5207541">*</span><span class="ident" id="5207542">ast</span><span class="op" id="5207545">.</span><span class="ident" id="5207546">Ident</span><span class="op" id="5207551">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207556">data</span>&nbsp;<span class="op" id="5207561">=</span>&nbsp;<span class="ident" id="5207563">x</span><span class="op" id="5207564">.</span><span class="ident" id="5207565">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207573">impliedSemi</span>&nbsp;<span class="op" id="5207585">=</span>&nbsp;<span class="builtintype" id="5207587">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207595">p</span><span class="op" id="5207596">.</span><span class="ident" id="5207597">lastTok</span>&nbsp;<span class="op" id="5207605">=</span>&nbsp;<span class="ident" id="5207607">token</span><span class="op" id="5207612">.</span><span class="ident" id="5207613">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207622">case</span>&nbsp;<span class="op" id="5207627">*</span><span class="ident" id="5207628">ast</span><span class="op" id="5207631">.</span><span class="ident" id="5207632">BasicLit</span><span class="op" id="5207640">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207645">data</span>&nbsp;<span class="op" id="5207650">=</span>&nbsp;<span class="ident" id="5207652">x</span><span class="op" id="5207653">.</span><span class="ident" id="5207654">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207663">isLit</span>&nbsp;<span class="op" id="5207669">=</span>&nbsp;<span class="builtintype" id="5207671">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207679">impliedSemi</span>&nbsp;<span class="op" id="5207691">=</span>&nbsp;<span class="builtintype" id="5207693">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207701">p</span><span class="op" id="5207702">.</span><span class="ident" id="5207703">lastTok</span>&nbsp;<span class="op" id="5207711">=</span>&nbsp;<span class="ident" id="5207713">x</span><span class="op" id="5207714">.</span><span class="ident" id="5207715">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207723">case</span>&nbsp;<span class="ident" id="5207728">token</span><span class="op" id="5207733">.</span><span class="ident" id="5207734">Token</span><span class="op" id="5207739">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207744">s</span>&nbsp;<span class="op" id="5207746">:=</span>&nbsp;<span class="ident" id="5207749">x</span><span class="op" id="5207750">.</span><span class="ident" id="5207751">String</span><span class="op" id="5207757">(</span><span class="op" id="5207758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207763">if</span>&nbsp;<span class="ident" id="5207766">mayCombine</span><span class="op" id="5207776">(</span><span class="ident" id="5207777">p</span><span class="op" id="5207778">.</span><span class="ident" id="5207779">lastTok</span><span class="op" id="5207786">,</span>&nbsp;<span class="ident" id="5207788">s</span><span class="op" id="5207789">[</span><span class="num" id="5207790">0</span><span class="op" id="5207791">]</span><span class="op" id="5207792">)</span>&nbsp;<span class="op" id="5207794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207800">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207850">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207901">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207950">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208002">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208054">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208098">if</span>&nbsp;<span class="builtinfunc" id="5208101">len</span><span class="op" id="5208104">(</span><span class="ident" id="5208105">p</span><span class="op" id="5208106">.</span><span class="ident" id="5208107">wsbuf</span><span class="op" id="5208112">)</span>&nbsp;<span class="op" id="5208114">!=</span>&nbsp;<span class="num" id="5208117">0</span>&nbsp;<span class="op" id="5208119">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208126">p</span><span class="op" id="5208127">.</span><span class="ident" id="5208128">internalError</span><span class="op" id="5208141">(</span><span class="string" id="5208142">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="5208171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5208177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208183">p</span><span class="op" id="5208184">.</span><span class="ident" id="5208185">wsbuf</span>&nbsp;<span class="op" id="5208191">=</span>&nbsp;<span class="ident" id="5208193">p</span><span class="op" id="5208194">.</span><span class="ident" id="5208195">wsbuf</span><span class="op" id="5208200">[</span><span class="num" id="5208201">0</span><span class="op" id="5208202">:</span><span class="num" id="5208203">1</span><span class="op" id="5208204">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208210">p</span><span class="op" id="5208211">.</span><span class="ident" id="5208212">wsbuf</span><span class="op" id="5208217">[</span><span class="num" id="5208218">0</span><span class="op" id="5208219">]</span>&nbsp;<span class="op" id="5208221">=</span>&nbsp;<span class="string" id="5208223">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5208230">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208235">data</span>&nbsp;<span class="op" id="5208240">=</span>&nbsp;<span class="ident" id="5208242">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208247">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208307">switch</span>&nbsp;<span class="ident" id="5208314">x</span>&nbsp;<span class="op" id="5208316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208321">case</span>&nbsp;<span class="ident" id="5208326">token</span><span class="op" id="5208331">.</span><span class="ident" id="5208332">BREAK</span><span class="op" id="5208337">,</span>&nbsp;<span class="ident" id="5208339">token</span><span class="op" id="5208344">.</span><span class="ident" id="5208345">CONTINUE</span><span class="op" id="5208353">,</span>&nbsp;<span class="ident" id="5208355">token</span><span class="op" id="5208360">.</span><span class="ident" id="5208361">FALLTHROUGH</span><span class="op" id="5208372">,</span>&nbsp;<span class="ident" id="5208374">token</span><span class="op" id="5208379">.</span><span class="ident" id="5208380">RETURN</span><span class="op" id="5208386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208392">token</span><span class="op" id="5208397">.</span><span class="ident" id="5208398">INC</span><span class="op" id="5208401">,</span>&nbsp;<span class="ident" id="5208403">token</span><span class="op" id="5208408">.</span><span class="ident" id="5208409">DEC</span><span class="op" id="5208412">,</span>&nbsp;<span class="ident" id="5208414">token</span><span class="op" id="5208419">.</span><span class="ident" id="5208420">RPAREN</span><span class="op" id="5208426">,</span>&nbsp;<span class="ident" id="5208428">token</span><span class="op" id="5208433">.</span><span class="ident" id="5208434">RBRACK</span><span class="op" id="5208440">,</span>&nbsp;<span class="ident" id="5208442">token</span><span class="op" id="5208447">.</span><span class="ident" id="5208448">RBRACE</span><span class="op" id="5208454">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208460">impliedSemi</span>&nbsp;<span class="op" id="5208472">=</span>&nbsp;<span class="builtintype" id="5208474">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5208482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208487">p</span><span class="op" id="5208488">.</span><span class="ident" id="5208489">lastTok</span>&nbsp;<span class="op" id="5208497">=</span>&nbsp;<span class="ident" id="5208499">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208504">case</span>&nbsp;<span class="ident" id="5208509">token</span><span class="op" id="5208514">.</span><span class="ident" id="5208515">Pos</span><span class="op" id="5208518">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208523">if</span>&nbsp;<span class="ident" id="5208526">x</span><span class="op" id="5208527">.</span><span class="ident" id="5208528">IsValid</span><span class="op" id="5208535">(</span><span class="op" id="5208536">)</span>&nbsp;<span class="op" id="5208538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208544">p</span><span class="op" id="5208545">.</span><span class="ident" id="5208546">pos</span>&nbsp;<span class="op" id="5208550">=</span>&nbsp;<span class="ident" id="5208552">p</span><span class="op" id="5208553">.</span><span class="ident" id="5208554">posFor</span><span class="op" id="5208560">(</span><span class="ident" id="5208561">x</span><span class="op" id="5208562">)</span>&nbsp;<span class="comment" id="5208564">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5208601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208606">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208618">case</span>&nbsp;<span class="builtintype" id="5208623">string</span><span class="op" id="5208629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208634">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208676">data</span>&nbsp;<span class="op" id="5208681">=</span>&nbsp;<span class="ident" id="5208683">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208688">isLit</span>&nbsp;<span class="op" id="5208694">=</span>&nbsp;<span class="builtintype" id="5208696">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208704">impliedSemi</span>&nbsp;<span class="op" id="5208716">=</span>&nbsp;<span class="builtintype" id="5208718">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208726">p</span><span class="op" id="5208727">.</span><span class="ident" id="5208728">lastTok</span>&nbsp;<span class="op" id="5208736">=</span>&nbsp;<span class="ident" id="5208738">token</span><span class="op" id="5208743">.</span><span class="ident" id="5208744">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5208754">default</span><span class="op" id="5208761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208766">fmt</span><span class="op" id="5208769">.</span><span class="ident" id="5208770">Fprintf</span><span class="op" id="5208777">(</span><span class="ident" id="5208778">os</span><span class="op" id="5208780">.</span><span class="ident" id="5208781">Stderr</span><span class="op" id="5208787">,</span>&nbsp;<span class="string" id="5208789">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="5208828">,</span>&nbsp;<span class="ident" id="5208830">arg</span><span class="op" id="5208833">,</span>&nbsp;<span class="ident" id="5208835">arg</span><span class="op" id="5208838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5208843">panic</span><span class="op" id="5208848">(</span><span class="string" id="5208849">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="5208866">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5208870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208874">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208891">next</span>&nbsp;<span class="op" id="5208896">:=</span>&nbsp;<span class="ident" id="5208899">p</span><span class="op" id="5208900">.</span><span class="ident" id="5208901">pos</span>&nbsp;<span class="comment" id="5208905">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5208951">wroteNewline</span><span class="op" id="5208963">,</span>&nbsp;<span class="ident" id="5208965">droppedFF</span>&nbsp;<span class="op" id="5208975">:=</span>&nbsp;<span class="ident" id="5208978">p</span><span class="op" id="5208979">.</span><span class="ident" id="5208980">flush</span><span class="op" id="5208985">(</span><span class="ident" id="5208986">next</span><span class="op" id="5208990">,</span>&nbsp;<span class="ident" id="5208992">p</span><span class="op" id="5208993">.</span><span class="ident" id="5208994">lastTok</span><span class="op" id="5209001">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5209006">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5209067">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5209127">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209192">if</span>&nbsp;<span class="op" id="5209195">!</span><span class="ident" id="5209196">p</span><span class="op" id="5209197">.</span><span class="ident" id="5209198">impliedSemi</span>&nbsp;<span class="op" id="5209210">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209215">n</span>&nbsp;<span class="op" id="5209217">:=</span>&nbsp;<span class="ident" id="5209220">nlimit</span><span class="op" id="5209226">(</span><span class="ident" id="5209227">next</span><span class="op" id="5209231">.</span><span class="ident" id="5209232">Line</span>&nbsp;<span class="op" id="5209237">-</span>&nbsp;<span class="ident" id="5209239">p</span><span class="op" id="5209240">.</span><span class="ident" id="5209241">pos</span><span class="op" id="5209244">.</span><span class="ident" id="5209245">Line</span><span class="op" id="5209249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5209254">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209309">if</span>&nbsp;<span class="ident" id="5209312">wroteNewline</span>&nbsp;<span class="op" id="5209325">&amp;&amp;</span>&nbsp;<span class="ident" id="5209328">n</span>&nbsp;<span class="op" id="5209330">==</span>&nbsp;<span class="ident" id="5209333">maxNewlines</span>&nbsp;<span class="op" id="5209345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209351">n</span>&nbsp;<span class="op" id="5209353">=</span>&nbsp;<span class="ident" id="5209355">maxNewlines</span>&nbsp;<span class="op" id="5209367">-</span>&nbsp;<span class="num" id="5209369">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209374">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209379">if</span>&nbsp;<span class="ident" id="5209382">n</span>&nbsp;<span class="op" id="5209384">&gt;</span>&nbsp;<span class="num" id="5209386">0</span>&nbsp;<span class="op" id="5209388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209394">ch</span>&nbsp;<span class="op" id="5209397">:=</span>&nbsp;<span class="builtintype" id="5209400">byte</span><span class="op" id="5209404">(</span><span class="string" id="5209405">&#39;\n&#39;</span><span class="op" id="5209409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209415">if</span>&nbsp;<span class="ident" id="5209418">droppedFF</span>&nbsp;<span class="op" id="5209428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209435">ch</span>&nbsp;<span class="op" id="5209438">=</span>&nbsp;<span class="string" id="5209440">&#39;\f&#39;</span>&nbsp;<span class="comment" id="5209445">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209493">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209499">p</span><span class="op" id="5209500">.</span><span class="ident" id="5209501">writeByte</span><span class="op" id="5209510">(</span><span class="ident" id="5209511">ch</span><span class="op" id="5209513">,</span>&nbsp;<span class="ident" id="5209515">n</span><span class="op" id="5209516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209522">impliedSemi</span>&nbsp;<span class="op" id="5209534">=</span>&nbsp;<span class="builtintype" id="5209536">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5209554">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209623">if</span>&nbsp;<span class="ident" id="5209626">p</span><span class="op" id="5209627">.</span><span class="ident" id="5209628">linePtr</span>&nbsp;<span class="op" id="5209636">!=</span>&nbsp;<span class="ident" id="5209639">nil</span>&nbsp;<span class="op" id="5209643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209648">*</span><span class="ident" id="5209649">p</span><span class="op" id="5209650">.</span><span class="ident" id="5209651">linePtr</span>&nbsp;<span class="op" id="5209659">=</span>&nbsp;<span class="ident" id="5209661">p</span><span class="op" id="5209662">.</span><span class="ident" id="5209663">out</span><span class="op" id="5209666">.</span><span class="ident" id="5209667">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209675">p</span><span class="op" id="5209676">.</span><span class="ident" id="5209677">linePtr</span>&nbsp;<span class="op" id="5209685">=</span>&nbsp;<span class="ident" id="5209687">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209693">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209698">p</span><span class="op" id="5209699">.</span><span class="ident" id="5209700">writeString</span><span class="op" id="5209711">(</span><span class="ident" id="5209712">next</span><span class="op" id="5209716">,</span>&nbsp;<span class="ident" id="5209718">data</span><span class="op" id="5209722">,</span>&nbsp;<span class="ident" id="5209724">isLit</span><span class="op" id="5209729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209733">p</span><span class="op" id="5209734">.</span><span class="ident" id="5209735">impliedSemi</span>&nbsp;<span class="op" id="5209747">=</span>&nbsp;<span class="ident" id="5209749">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209762">}</span><br>
<span class="lineno"></span><span class="op" id="5209764">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="5209767">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="5209839">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="5209912">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5209989">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="5210000">//</span><br>
<span class="lineno"></span><span class="keyword" id="5210003">func</span>&nbsp;<span class="op" id="5210008">(</span><span class="ident" id="5210009">p</span>&nbsp;<span class="op" id="5210011">*</span><span class="ident" id="5210012">printer</span><span class="op" id="5210019">)</span>&nbsp;<span class="ident" id="5210021">flush</span><span class="op" id="5210026">(</span><span class="ident" id="5210027">next</span>&nbsp;<span class="ident" id="5210032">token</span><span class="op" id="5210037">.</span><span class="ident" id="5210038">Position</span><span class="op" id="5210046">,</span>&nbsp;<span class="ident" id="5210048">tok</span>&nbsp;<span class="ident" id="5210052">token</span><span class="op" id="5210057">.</span><span class="ident" id="5210058">Token</span><span class="op" id="5210063">)</span>&nbsp;<span class="op" id="5210065">(</span><span class="ident" id="5210066">wroteNewline</span><span class="op" id="5210078">,</span>&nbsp;<span class="ident" id="5210080">droppedFF</span>&nbsp;<span class="builtintype" id="5210090">bool</span><span class="op" id="5210094">)</span>&nbsp;<span class="op" id="5210096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210099">if</span>&nbsp;<span class="ident" id="5210102">p</span><span class="op" id="5210103">.</span><span class="ident" id="5210104">commentBefore</span><span class="op" id="5210117">(</span><span class="ident" id="5210118">next</span><span class="op" id="5210122">)</span>&nbsp;<span class="op" id="5210124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5210128">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210194">wroteNewline</span><span class="op" id="5210206">,</span>&nbsp;<span class="ident" id="5210208">droppedFF</span>&nbsp;<span class="op" id="5210218">=</span>&nbsp;<span class="ident" id="5210220">p</span><span class="op" id="5210221">.</span><span class="ident" id="5210222">intersperseComments</span><span class="op" id="5210241">(</span><span class="ident" id="5210242">next</span><span class="op" id="5210246">,</span>&nbsp;<span class="ident" id="5210248">tok</span><span class="op" id="5210251">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210254">}</span>&nbsp;<span class="keyword" id="5210256">else</span>&nbsp;<span class="op" id="5210261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5210265">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210311">p</span><span class="op" id="5210312">.</span><span class="ident" id="5210313">writeWhitespace</span><span class="op" id="5210328">(</span><span class="builtinfunc" id="5210329">len</span><span class="op" id="5210332">(</span><span class="ident" id="5210333">p</span><span class="op" id="5210334">.</span><span class="ident" id="5210335">wsbuf</span><span class="op" id="5210340">)</span><span class="op" id="5210341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210347">return</span><br>
<span class="lineno">990</span><span class="op" id="5210354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5210357">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="5210424">func</span>&nbsp;<span class="ident" id="5210429">getDoc</span><span class="op" id="5210435">(</span><span class="ident" id="5210436">n</span>&nbsp;<span class="ident" id="5210438">ast</span><span class="op" id="5210441">.</span><span class="ident" id="5210442">Node</span><span class="op" id="5210446">)</span>&nbsp;<span class="op" id="5210448">*</span><span class="ident" id="5210449">ast</span><span class="op" id="5210452">.</span><span class="ident" id="5210453">CommentGroup</span>&nbsp;<span class="op" id="5210466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210469">switch</span>&nbsp;<span class="ident" id="5210476">n</span>&nbsp;<span class="op" id="5210478">:=</span>&nbsp;<span class="ident" id="5210481">n</span><span class="op" id="5210482">.</span><span class="op" id="5210483">(</span><span class="keyword" id="5210484">type</span><span class="op" id="5210488">)</span>&nbsp;<span class="op" id="5210490">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210493">case</span>&nbsp;<span class="op" id="5210498">*</span><span class="ident" id="5210499">ast</span><span class="op" id="5210502">.</span><span class="ident" id="5210503">Field</span><span class="op" id="5210508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210512">return</span>&nbsp;<span class="ident" id="5210519">n</span><span class="op" id="5210520">.</span><span class="ident" id="5210521">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210526">case</span>&nbsp;<span class="op" id="5210531">*</span><span class="ident" id="5210532">ast</span><span class="op" id="5210535">.</span><span class="ident" id="5210536">ImportSpec</span><span class="op" id="5210546">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210550">return</span>&nbsp;<span class="ident" id="5210557">n</span><span class="op" id="5210558">.</span><span class="ident" id="5210559">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210564">case</span>&nbsp;<span class="op" id="5210569">*</span><span class="ident" id="5210570">ast</span><span class="op" id="5210573">.</span><span class="ident" id="5210574">ValueSpec</span><span class="op" id="5210583">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210587">return</span>&nbsp;<span class="ident" id="5210594">n</span><span class="op" id="5210595">.</span><span class="ident" id="5210596">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210601">case</span>&nbsp;<span class="op" id="5210606">*</span><span class="ident" id="5210607">ast</span><span class="op" id="5210610">.</span><span class="ident" id="5210611">TypeSpec</span><span class="op" id="5210619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210623">return</span>&nbsp;<span class="ident" id="5210630">n</span><span class="op" id="5210631">.</span><span class="ident" id="5210632">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210637">case</span>&nbsp;<span class="op" id="5210642">*</span><span class="ident" id="5210643">ast</span><span class="op" id="5210646">.</span><span class="ident" id="5210647">GenDecl</span><span class="op" id="5210654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210658">return</span>&nbsp;<span class="ident" id="5210665">n</span><span class="op" id="5210666">.</span><span class="ident" id="5210667">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210672">case</span>&nbsp;<span class="op" id="5210677">*</span><span class="ident" id="5210678">ast</span><span class="op" id="5210681">.</span><span class="ident" id="5210682">FuncDecl</span><span class="op" id="5210690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210694">return</span>&nbsp;<span class="ident" id="5210701">n</span><span class="op" id="5210702">.</span><span class="ident" id="5210703">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210708">case</span>&nbsp;<span class="op" id="5210713">*</span><span class="ident" id="5210714">ast</span><span class="op" id="5210717">.</span><span class="ident" id="5210718">File</span><span class="op" id="5210722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210726">return</span>&nbsp;<span class="ident" id="5210733">n</span><span class="op" id="5210734">.</span><span class="ident" id="5210735">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210740">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210743">return</span>&nbsp;<span class="ident" id="5210750">nil</span><br>
<span class="lineno"></span><span class="op" id="5210754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5210757">func</span>&nbsp;<span class="op" id="5210762">(</span><span class="ident" id="5210763">p</span>&nbsp;<span class="op" id="5210765">*</span><span class="ident" id="5210766">printer</span><span class="op" id="5210773">)</span>&nbsp;<span class="ident" id="5210775">printNode</span><span class="op" id="5210784">(</span><span class="ident" id="5210785">node</span>&nbsp;<span class="keyword" id="5210790">interface</span><span class="op" id="5210799">{</span><span class="op" id="5210800">}</span><span class="op" id="5210801">)</span>&nbsp;<span class="builtintype" id="5210803">error</span>&nbsp;<span class="op" id="5210809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5210812">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210846">var</span>&nbsp;<span class="ident" id="5210850">comments</span>&nbsp;<span class="op" id="5210859">[</span><span class="op" id="5210860">]</span><span class="op" id="5210861">*</span><span class="ident" id="5210862">ast</span><span class="op" id="5210865">.</span><span class="ident" id="5210866">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210880">if</span>&nbsp;<span class="ident" id="5210883">cnode</span><span class="op" id="5210888">,</span>&nbsp;<span class="ident" id="5210890">ok</span>&nbsp;<span class="op" id="5210893">:=</span>&nbsp;<span class="ident" id="5210896">node</span><span class="op" id="5210900">.</span><span class="op" id="5210901">(</span><span class="op" id="5210902">*</span><span class="ident" id="5210903">CommentedNode</span><span class="op" id="5210916">)</span><span class="op" id="5210917">;</span>&nbsp;<span class="ident" id="5210919">ok</span>&nbsp;<span class="op" id="5210922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210926">node</span>&nbsp;<span class="op" id="5210931">=</span>&nbsp;<span class="ident" id="5210933">cnode</span><span class="op" id="5210938">.</span><span class="ident" id="5210939">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210946">comments</span>&nbsp;<span class="op" id="5210955">=</span>&nbsp;<span class="ident" id="5210957">cnode</span><span class="op" id="5210962">.</span><span class="ident" id="5210963">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210973">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210977">if</span>&nbsp;<span class="ident" id="5210980">comments</span>&nbsp;<span class="op" id="5210989">!=</span>&nbsp;<span class="ident" id="5210992">nil</span>&nbsp;<span class="op" id="5210996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211000">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211062">n</span><span class="op" id="5211063">,</span>&nbsp;<span class="ident" id="5211065">ok</span>&nbsp;<span class="op" id="5211068">:=</span>&nbsp;<span class="ident" id="5211071">node</span><span class="op" id="5211075">.</span><span class="op" id="5211076">(</span><span class="ident" id="5211077">ast</span><span class="op" id="5211080">.</span><span class="ident" id="5211081">Node</span><span class="op" id="5211085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211089">if</span>&nbsp;<span class="op" id="5211092">!</span><span class="ident" id="5211093">ok</span>&nbsp;<span class="op" id="5211096">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211101">goto</span>&nbsp;<span class="ident" id="5211106">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5211120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211124">beg</span>&nbsp;<span class="op" id="5211128">:=</span>&nbsp;<span class="ident" id="5211131">n</span><span class="op" id="5211132">.</span><span class="ident" id="5211133">Pos</span><span class="op" id="5211136">(</span><span class="op" id="5211137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211141">end</span>&nbsp;<span class="op" id="5211145">:=</span>&nbsp;<span class="ident" id="5211148">n</span><span class="op" id="5211149">.</span><span class="ident" id="5211150">End</span><span class="op" id="5211153">(</span><span class="op" id="5211154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211158">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211205">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211249">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211295">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211346">if</span>&nbsp;<span class="ident" id="5211349">doc</span>&nbsp;<span class="op" id="5211353">:=</span>&nbsp;<span class="ident" id="5211356">getDoc</span><span class="op" id="5211362">(</span><span class="ident" id="5211363">n</span><span class="op" id="5211364">)</span><span class="op" id="5211365">;</span>&nbsp;<span class="ident" id="5211367">doc</span>&nbsp;<span class="op" id="5211371">!=</span>&nbsp;<span class="ident" id="5211374">nil</span>&nbsp;<span class="op" id="5211378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211383">beg</span>&nbsp;<span class="op" id="5211387">=</span>&nbsp;<span class="ident" id="5211389">doc</span><span class="op" id="5211392">.</span><span class="ident" id="5211393">Pos</span><span class="op" id="5211396">(</span><span class="op" id="5211397">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5211401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211405">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211454">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211481">i</span>&nbsp;<span class="op" id="5211483">:=</span>&nbsp;<span class="num" id="5211486">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211490">for</span>&nbsp;<span class="ident" id="5211494">i</span>&nbsp;<span class="op" id="5211496">&lt;</span>&nbsp;<span class="builtinfunc" id="5211498">len</span><span class="op" id="5211501">(</span><span class="ident" id="5211502">comments</span><span class="op" id="5211510">)</span>&nbsp;<span class="op" id="5211512">&amp;&amp;</span>&nbsp;<span class="ident" id="5211515">comments</span><span class="op" id="5211523">[</span><span class="ident" id="5211524">i</span><span class="op" id="5211525">]</span><span class="op" id="5211526">.</span><span class="ident" id="5211527">End</span><span class="op" id="5211530">(</span><span class="op" id="5211531">)</span>&nbsp;<span class="op" id="5211533">&lt;</span>&nbsp;<span class="ident" id="5211535">beg</span>&nbsp;<span class="op" id="5211539">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211544">i</span><span class="op" id="5211545">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5211550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211554">j</span>&nbsp;<span class="op" id="5211556">:=</span>&nbsp;<span class="ident" id="5211559">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211563">for</span>&nbsp;<span class="ident" id="5211567">j</span>&nbsp;<span class="op" id="5211569">&lt;</span>&nbsp;<span class="builtinfunc" id="5211571">len</span><span class="op" id="5211574">(</span><span class="ident" id="5211575">comments</span><span class="op" id="5211583">)</span>&nbsp;<span class="op" id="5211585">&amp;&amp;</span>&nbsp;<span class="ident" id="5211588">comments</span><span class="op" id="5211596">[</span><span class="ident" id="5211597">j</span><span class="op" id="5211598">]</span><span class="op" id="5211599">.</span><span class="ident" id="5211600">Pos</span><span class="op" id="5211603">(</span><span class="op" id="5211604">)</span>&nbsp;<span class="op" id="5211606">&lt;</span>&nbsp;<span class="ident" id="5211608">end</span>&nbsp;<span class="op" id="5211612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211617">j</span><span class="op" id="5211618">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5211623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211627">if</span>&nbsp;<span class="ident" id="5211630">i</span>&nbsp;<span class="op" id="5211632">&lt;</span>&nbsp;<span class="ident" id="5211634">j</span>&nbsp;<span class="op" id="5211636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211641">p</span><span class="op" id="5211642">.</span><span class="ident" id="5211643">comments</span>&nbsp;<span class="op" id="5211652">=</span>&nbsp;<span class="ident" id="5211654">comments</span><span class="op" id="5211662">[</span><span class="ident" id="5211663">i</span><span class="op" id="5211664">:</span><span class="ident" id="5211665">j</span><span class="op" id="5211666">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5211670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5211673">}</span>&nbsp;<span class="keyword" id="5211675">else</span>&nbsp;<span class="keyword" id="5211680">if</span>&nbsp;<span class="ident" id="5211683">n</span><span class="op" id="5211684">,</span>&nbsp;<span class="ident" id="5211686">ok</span>&nbsp;<span class="op" id="5211689">:=</span>&nbsp;<span class="ident" id="5211692">node</span><span class="op" id="5211696">.</span><span class="op" id="5211697">(</span><span class="op" id="5211698">*</span><span class="ident" id="5211699">ast</span><span class="op" id="5211702">.</span><span class="ident" id="5211703">File</span><span class="op" id="5211707">)</span><span class="op" id="5211708">;</span>&nbsp;<span class="ident" id="5211710">ok</span>&nbsp;<span class="op" id="5211713">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211717">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211752">p</span><span class="op" id="5211753">.</span><span class="ident" id="5211754">comments</span>&nbsp;<span class="op" id="5211763">=</span>&nbsp;<span class="ident" id="5211765">n</span><span class="op" id="5211766">.</span><span class="ident" id="5211767">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5211777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211781">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211829">p</span><span class="op" id="5211830">.</span><span class="ident" id="5211831">useNodeComments</span>&nbsp;<span class="op" id="5211847">=</span>&nbsp;<span class="ident" id="5211849">p</span><span class="op" id="5211850">.</span><span class="ident" id="5211851">comments</span>&nbsp;<span class="op" id="5211860">==</span>&nbsp;<span class="ident" id="5211863">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211869">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211900">p</span><span class="op" id="5211901">.</span><span class="ident" id="5211902">nextComment</span><span class="op" id="5211913">(</span><span class="op" id="5211914">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211918">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211934">switch</span>&nbsp;<span class="ident" id="5211941">n</span>&nbsp;<span class="op" id="5211943">:=</span>&nbsp;<span class="ident" id="5211946">node</span><span class="op" id="5211950">.</span><span class="op" id="5211951">(</span><span class="keyword" id="5211952">type</span><span class="op" id="5211956">)</span>&nbsp;<span class="op" id="5211958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211961">case</span>&nbsp;<span class="ident" id="5211966">ast</span><span class="op" id="5211969">.</span><span class="ident" id="5211970">Expr</span><span class="op" id="5211974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5211978">p</span><span class="op" id="5211979">.</span><span class="ident" id="5211980">expr</span><span class="op" id="5211984">(</span><span class="ident" id="5211985">n</span><span class="op" id="5211986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211989">case</span>&nbsp;<span class="ident" id="5211994">ast</span><span class="op" id="5211997">.</span><span class="ident" id="5211998">Stmt</span><span class="op" id="5212002">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5212006">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5212069">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212128">if</span>&nbsp;<span class="ident" id="5212131">_</span><span class="op" id="5212132">,</span>&nbsp;<span class="ident" id="5212134">ok</span>&nbsp;<span class="op" id="5212137">:=</span>&nbsp;<span class="ident" id="5212140">n</span><span class="op" id="5212141">.</span><span class="op" id="5212142">(</span><span class="op" id="5212143">*</span><span class="ident" id="5212144">ast</span><span class="op" id="5212147">.</span><span class="ident" id="5212148">LabeledStmt</span><span class="op" id="5212159">)</span><span class="op" id="5212160">;</span>&nbsp;<span class="ident" id="5212162">ok</span>&nbsp;<span class="op" id="5212165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212170">p</span><span class="op" id="5212171">.</span><span class="ident" id="5212172">indent</span>&nbsp;<span class="op" id="5212179">=</span>&nbsp;<span class="num" id="5212181">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212185">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212189">p</span><span class="op" id="5212190">.</span><span class="ident" id="5212191">stmt</span><span class="op" id="5212195">(</span><span class="ident" id="5212196">n</span><span class="op" id="5212197">,</span>&nbsp;<span class="builtintype" id="5212199">false</span><span class="op" id="5212204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212207">case</span>&nbsp;<span class="ident" id="5212212">ast</span><span class="op" id="5212215">.</span><span class="ident" id="5212216">Decl</span><span class="op" id="5212220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212224">p</span><span class="op" id="5212225">.</span><span class="ident" id="5212226">decl</span><span class="op" id="5212230">(</span><span class="ident" id="5212231">n</span><span class="op" id="5212232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212235">case</span>&nbsp;<span class="ident" id="5212240">ast</span><span class="op" id="5212243">.</span><span class="ident" id="5212244">Spec</span><span class="op" id="5212248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212252">p</span><span class="op" id="5212253">.</span><span class="ident" id="5212254">spec</span><span class="op" id="5212258">(</span><span class="ident" id="5212259">n</span><span class="op" id="5212260">,</span>&nbsp;<span class="num" id="5212262">1</span><span class="op" id="5212263">,</span>&nbsp;<span class="builtintype" id="5212265">false</span><span class="op" id="5212270">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212273">case</span>&nbsp;<span class="op" id="5212278">[</span><span class="op" id="5212279">]</span><span class="ident" id="5212280">ast</span><span class="op" id="5212283">.</span><span class="ident" id="5212284">Stmt</span><span class="op" id="5212288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5212292">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5212355">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212414">for</span>&nbsp;<span class="ident" id="5212418">_</span><span class="op" id="5212419">,</span>&nbsp;<span class="ident" id="5212421">s</span>&nbsp;<span class="op" id="5212423">:=</span>&nbsp;<span class="keyword" id="5212426">range</span>&nbsp;<span class="ident" id="5212432">n</span>&nbsp;<span class="op" id="5212434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212439">if</span>&nbsp;<span class="ident" id="5212442">_</span><span class="op" id="5212443">,</span>&nbsp;<span class="ident" id="5212445">ok</span>&nbsp;<span class="op" id="5212448">:=</span>&nbsp;<span class="ident" id="5212451">s</span><span class="op" id="5212452">.</span><span class="op" id="5212453">(</span><span class="op" id="5212454">*</span><span class="ident" id="5212455">ast</span><span class="op" id="5212458">.</span><span class="ident" id="5212459">LabeledStmt</span><span class="op" id="5212470">)</span><span class="op" id="5212471">;</span>&nbsp;<span class="ident" id="5212473">ok</span>&nbsp;<span class="op" id="5212476">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212482">p</span><span class="op" id="5212483">.</span><span class="ident" id="5212484">indent</span>&nbsp;<span class="op" id="5212491">=</span>&nbsp;<span class="num" id="5212493">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212506">p</span><span class="op" id="5212507">.</span><span class="ident" id="5212508">stmtList</span><span class="op" id="5212516">(</span><span class="ident" id="5212517">n</span><span class="op" id="5212518">,</span>&nbsp;<span class="num" id="5212520">0</span><span class="op" id="5212521">,</span>&nbsp;<span class="builtintype" id="5212523">false</span><span class="op" id="5212528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212531">case</span>&nbsp;<span class="op" id="5212536">[</span><span class="op" id="5212537">]</span><span class="ident" id="5212538">ast</span><span class="op" id="5212541">.</span><span class="ident" id="5212542">Decl</span><span class="op" id="5212546">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212550">p</span><span class="op" id="5212551">.</span><span class="ident" id="5212552">declList</span><span class="op" id="5212560">(</span><span class="ident" id="5212561">n</span><span class="op" id="5212562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212565">case</span>&nbsp;<span class="op" id="5212570">*</span><span class="ident" id="5212571">ast</span><span class="op" id="5212574">.</span><span class="ident" id="5212575">File</span><span class="op" id="5212579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212583">p</span><span class="op" id="5212584">.</span><span class="ident" id="5212585">file</span><span class="op" id="5212589">(</span><span class="ident" id="5212590">n</span><span class="op" id="5212591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212594">default</span><span class="op" id="5212601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212605">goto</span>&nbsp;<span class="ident" id="5212610">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212627">return</span>&nbsp;<span class="ident" id="5212634">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="5212639">unsupported</span><span class="op" id="5212650">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212653">return</span>&nbsp;<span class="ident" id="5212660">fmt</span><span class="op" id="5212663">.</span><span class="ident" id="5212664">Errorf</span><span class="op" id="5212670">(</span><span class="string" id="5212671">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="5212709">,</span>&nbsp;<span class="ident" id="5212711">node</span><span class="op" id="5212715">)</span><br>
<span class="lineno"></span><span class="op" id="5212717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5212720">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5212800">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="5212812">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="5212879">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="5212948">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="5213017">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="5213086">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="5213108">//</span><br>
<span class="lineno"></span><span class="keyword" id="5213111">type</span>&nbsp;<span class="ident" id="5213116">trimmer</span>&nbsp;<span class="keyword" id="5213124">struct</span>&nbsp;<span class="op" id="5213131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213134">output</span>&nbsp;<span class="ident" id="5213141">io</span><span class="op" id="5213143">.</span><span class="ident" id="5213144">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213152">state</span>&nbsp;&nbsp;<span class="builtintype" id="5213159">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213164">space</span>&nbsp;&nbsp;<span class="op" id="5213171">[</span><span class="op" id="5213172">]</span><span class="builtintype" id="5213173">byte</span><br>
<span class="lineno"></span><span class="op" id="5213178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5213181">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="5213227">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="5213272">const</span>&nbsp;<span class="op" id="5213278">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213281">inSpace</span>&nbsp;&nbsp;<span class="op" id="5213290">=</span>&nbsp;<span class="ident" id="5213292">iota</span>&nbsp;<span class="comment" id="5213297">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213314">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5213330">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213377">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5213393">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="5213408">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="5213411">func</span>&nbsp;<span class="op" id="5213416">(</span><span class="ident" id="5213417">p</span>&nbsp;<span class="op" id="5213419">*</span><span class="ident" id="5213420">trimmer</span><span class="op" id="5213427">)</span>&nbsp;<span class="ident" id="5213429">resetSpace</span><span class="op" id="5213439">(</span><span class="op" id="5213440">)</span>&nbsp;<span class="op" id="5213442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213445">p</span><span class="op" id="5213446">.</span><span class="ident" id="5213447">state</span>&nbsp;<span class="op" id="5213453">=</span>&nbsp;<span class="ident" id="5213455">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5213464">p</span><span class="op" id="5213465">.</span><span class="ident" id="5213466">space</span>&nbsp;<span class="op" id="5213472">=</span>&nbsp;<span class="ident" id="5213474">p</span><span class="op" id="5213475">.</span><span class="ident" id="5213476">space</span><span class="op" id="5213481">[</span><span class="num" id="5213482">0</span><span class="op" id="5213483">:</span><span class="num" id="5213484">0</span><span class="op" id="5213485">]</span><br>
<span class="lineno"></span><span class="op" id="5213487">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="5213490">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5213560">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="5213630">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5213698">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="5213765">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5213797">var</span>&nbsp;<span class="ident" id="5213801">aNewline</span>&nbsp;<span class="op" id="5213810">=</span>&nbsp;<span class="op" id="5213812">[</span><span class="op" id="5213813">]</span><span class="builtintype" id="5213814">byte</span><span class="op" id="5213818">(</span><span class="string" id="5213819">&#34;\n&#34;</span><span class="op" id="5213823">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5213826">func</span>&nbsp;<span class="op" id="5213831">(</span><span class="ident" id="5213832">p</span>&nbsp;<span class="op" id="5213834">*</span><span class="ident" id="5213835">trimmer</span><span class="op" id="5213842">)</span>&nbsp;<span class="ident" id="5213844">Write</span><span class="op" id="5213849">(</span><span class="ident" id="5213850">data</span>&nbsp;<span class="op" id="5213855">[</span><span class="op" id="5213856">]</span><span class="builtintype" id="5213857">byte</span><span class="op" id="5213861">)</span>&nbsp;<span class="op" id="5213863">(</span><span class="ident" id="5213864">n</span>&nbsp;<span class="builtintype" id="5213866">int</span><span class="op" id="5213869">,</span>&nbsp;<span class="ident" id="5213871">err</span>&nbsp;<span class="builtintype" id="5213875">error</span><span class="op" id="5213880">)</span>&nbsp;<span class="op" id="5213882">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5213885">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5213901">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5213925">//&nbsp;&nbsp;&nbsp;&nbspp.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5213950">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5213983">//&nbsp;&nbsp;&nbsp;&nbspdata[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214010">m</span>&nbsp;<span class="op" id="5214012">:=</span>&nbsp;<span class="num" id="5214015">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214018">var</span>&nbsp;<span class="ident" id="5214022">b</span>&nbsp;<span class="builtintype" id="5214024">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214030">for</span>&nbsp;<span class="ident" id="5214034">n</span><span class="op" id="5214035">,</span>&nbsp;<span class="ident" id="5214037">b</span>&nbsp;<span class="op" id="5214039">=</span>&nbsp;<span class="keyword" id="5214041">range</span>&nbsp;<span class="ident" id="5214047">data</span>&nbsp;<span class="op" id="5214052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214056">if</span>&nbsp;<span class="ident" id="5214059">b</span>&nbsp;<span class="op" id="5214061">==</span>&nbsp;<span class="string" id="5214064">&#39;\v&#39;</span>&nbsp;<span class="op" id="5214069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214074">b</span>&nbsp;<span class="op" id="5214076">=</span>&nbsp;<span class="string" id="5214078">&#39;\t&#39;</span>&nbsp;<span class="comment" id="5214083">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5214104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214108">switch</span>&nbsp;<span class="ident" id="5214115">p</span><span class="op" id="5214116">.</span><span class="ident" id="5214117">state</span>&nbsp;<span class="op" id="5214123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214127">case</span>&nbsp;<span class="ident" id="5214132">inSpace</span><span class="op" id="5214139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214144">switch</span>&nbsp;<span class="ident" id="5214151">b</span>&nbsp;<span class="op" id="5214153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214158">case</span>&nbsp;<span class="string" id="5214163">&#39;\t&#39;</span><span class="op" id="5214167">,</span>&nbsp;<span class="string" id="5214169">&#39;&nbsp;&#39;</span><span class="op" id="5214172">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214178">p</span><span class="op" id="5214179">.</span><span class="ident" id="5214180">space</span>&nbsp;<span class="op" id="5214186">=</span>&nbsp;<span class="builtinfunc" id="5214188">append</span><span class="op" id="5214194">(</span><span class="ident" id="5214195">p</span><span class="op" id="5214196">.</span><span class="ident" id="5214197">space</span><span class="op" id="5214202">,</span>&nbsp;<span class="ident" id="5214204">b</span><span class="op" id="5214205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214210">case</span>&nbsp;<span class="string" id="5214215">&#39;\n&#39;</span><span class="op" id="5214219">,</span>&nbsp;<span class="string" id="5214221">&#39;\f&#39;</span><span class="op" id="5214225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214231">p</span><span class="op" id="5214232">.</span><span class="ident" id="5214233">resetSpace</span><span class="op" id="5214243">(</span><span class="op" id="5214244">)</span>&nbsp;<span class="comment" id="5214246">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214276">_</span><span class="op" id="5214277">,</span>&nbsp;<span class="ident" id="5214279">err</span>&nbsp;<span class="op" id="5214283">=</span>&nbsp;<span class="ident" id="5214285">p</span><span class="op" id="5214286">.</span><span class="ident" id="5214287">output</span><span class="op" id="5214293">.</span><span class="ident" id="5214294">Write</span><span class="op" id="5214299">(</span><span class="ident" id="5214300">aNewline</span><span class="op" id="5214308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214313">case</span>&nbsp;<span class="ident" id="5214318">tabwriter</span><span class="op" id="5214327">.</span><span class="ident" id="5214328">Escape</span><span class="op" id="5214334">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214340">_</span><span class="op" id="5214341">,</span>&nbsp;<span class="ident" id="5214343">err</span>&nbsp;<span class="op" id="5214347">=</span>&nbsp;<span class="ident" id="5214349">p</span><span class="op" id="5214350">.</span><span class="ident" id="5214351">output</span><span class="op" id="5214357">.</span><span class="ident" id="5214358">Write</span><span class="op" id="5214363">(</span><span class="ident" id="5214364">p</span><span class="op" id="5214365">.</span><span class="ident" id="5214366">space</span><span class="op" id="5214371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214377">p</span><span class="op" id="5214378">.</span><span class="ident" id="5214379">state</span>&nbsp;<span class="op" id="5214385">=</span>&nbsp;<span class="ident" id="5214387">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214400">m</span>&nbsp;<span class="op" id="5214402">=</span>&nbsp;<span class="ident" id="5214404">n</span>&nbsp;<span class="op" id="5214406">+</span>&nbsp;<span class="num" id="5214408">1</span>&nbsp;<span class="comment" id="5214410">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214442">default</span><span class="op" id="5214449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214455">_</span><span class="op" id="5214456">,</span>&nbsp;<span class="ident" id="5214458">err</span>&nbsp;<span class="op" id="5214462">=</span>&nbsp;<span class="ident" id="5214464">p</span><span class="op" id="5214465">.</span><span class="ident" id="5214466">output</span><span class="op" id="5214472">.</span><span class="ident" id="5214473">Write</span><span class="op" id="5214478">(</span><span class="ident" id="5214479">p</span><span class="op" id="5214480">.</span><span class="ident" id="5214481">space</span><span class="op" id="5214486">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214492">p</span><span class="op" id="5214493">.</span><span class="ident" id="5214494">state</span>&nbsp;<span class="op" id="5214500">=</span>&nbsp;<span class="ident" id="5214502">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214513">m</span>&nbsp;<span class="op" id="5214515">=</span>&nbsp;<span class="ident" id="5214517">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5214522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214526">case</span>&nbsp;<span class="ident" id="5214531">inEscape</span><span class="op" id="5214539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214544">if</span>&nbsp;<span class="ident" id="5214547">b</span>&nbsp;<span class="op" id="5214549">==</span>&nbsp;<span class="ident" id="5214552">tabwriter</span><span class="op" id="5214561">.</span><span class="ident" id="5214562">Escape</span>&nbsp;<span class="op" id="5214569">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214575">_</span><span class="op" id="5214576">,</span>&nbsp;<span class="ident" id="5214578">err</span>&nbsp;<span class="op" id="5214582">=</span>&nbsp;<span class="ident" id="5214584">p</span><span class="op" id="5214585">.</span><span class="ident" id="5214586">output</span><span class="op" id="5214592">.</span><span class="ident" id="5214593">Write</span><span class="op" id="5214598">(</span><span class="ident" id="5214599">data</span><span class="op" id="5214603">[</span><span class="ident" id="5214604">m</span><span class="op" id="5214605">:</span><span class="ident" id="5214606">n</span><span class="op" id="5214607">]</span><span class="op" id="5214608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214614">p</span><span class="op" id="5214615">.</span><span class="ident" id="5214616">resetSpace</span><span class="op" id="5214626">(</span><span class="op" id="5214627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5214632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214636">case</span>&nbsp;<span class="ident" id="5214641">inText</span><span class="op" id="5214647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214652">switch</span>&nbsp;<span class="ident" id="5214659">b</span>&nbsp;<span class="op" id="5214661">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214666">case</span>&nbsp;<span class="string" id="5214671">&#39;\t&#39;</span><span class="op" id="5214675">,</span>&nbsp;<span class="string" id="5214677">&#39;&nbsp;&#39;</span><span class="op" id="5214680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214686">_</span><span class="op" id="5214687">,</span>&nbsp;<span class="ident" id="5214689">err</span>&nbsp;<span class="op" id="5214693">=</span>&nbsp;<span class="ident" id="5214695">p</span><span class="op" id="5214696">.</span><span class="ident" id="5214697">output</span><span class="op" id="5214703">.</span><span class="ident" id="5214704">Write</span><span class="op" id="5214709">(</span><span class="ident" id="5214710">data</span><span class="op" id="5214714">[</span><span class="ident" id="5214715">m</span><span class="op" id="5214716">:</span><span class="ident" id="5214717">n</span><span class="op" id="5214718">]</span><span class="op" id="5214719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214725">p</span><span class="op" id="5214726">.</span><span class="ident" id="5214727">resetSpace</span><span class="op" id="5214737">(</span><span class="op" id="5214738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214744">p</span><span class="op" id="5214745">.</span><span class="ident" id="5214746">space</span>&nbsp;<span class="op" id="5214752">=</span>&nbsp;<span class="builtinfunc" id="5214754">append</span><span class="op" id="5214760">(</span><span class="ident" id="5214761">p</span><span class="op" id="5214762">.</span><span class="ident" id="5214763">space</span><span class="op" id="5214768">,</span>&nbsp;<span class="ident" id="5214770">b</span><span class="op" id="5214771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214776">case</span>&nbsp;<span class="string" id="5214781">&#39;\n&#39;</span><span class="op" id="5214785">,</span>&nbsp;<span class="string" id="5214787">&#39;\f&#39;</span><span class="op" id="5214791">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214797">_</span><span class="op" id="5214798">,</span>&nbsp;<span class="ident" id="5214800">err</span>&nbsp;<span class="op" id="5214804">=</span>&nbsp;<span class="ident" id="5214806">p</span><span class="op" id="5214807">.</span><span class="ident" id="5214808">output</span><span class="op" id="5214814">.</span><span class="ident" id="5214815">Write</span><span class="op" id="5214820">(</span><span class="ident" id="5214821">data</span><span class="op" id="5214825">[</span><span class="ident" id="5214826">m</span><span class="op" id="5214827">:</span><span class="ident" id="5214828">n</span><span class="op" id="5214829">]</span><span class="op" id="5214830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214836">p</span><span class="op" id="5214837">.</span><span class="ident" id="5214838">resetSpace</span><span class="op" id="5214848">(</span><span class="op" id="5214849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214855">_</span><span class="op" id="5214856">,</span>&nbsp;<span class="ident" id="5214858">err</span>&nbsp;<span class="op" id="5214862">=</span>&nbsp;<span class="ident" id="5214864">p</span><span class="op" id="5214865">.</span><span class="ident" id="5214866">output</span><span class="op" id="5214872">.</span><span class="ident" id="5214873">Write</span><span class="op" id="5214878">(</span><span class="ident" id="5214879">aNewline</span><span class="op" id="5214887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5214892">case</span>&nbsp;<span class="ident" id="5214897">tabwriter</span><span class="op" id="5214906">.</span><span class="ident" id="5214907">Escape</span><span class="op" id="5214913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214919">_</span><span class="op" id="5214920">,</span>&nbsp;<span class="ident" id="5214922">err</span>&nbsp;<span class="op" id="5214926">=</span>&nbsp;<span class="ident" id="5214928">p</span><span class="op" id="5214929">.</span><span class="ident" id="5214930">output</span><span class="op" id="5214936">.</span><span class="ident" id="5214937">Write</span><span class="op" id="5214942">(</span><span class="ident" id="5214943">data</span><span class="op" id="5214947">[</span><span class="ident" id="5214948">m</span><span class="op" id="5214949">:</span><span class="ident" id="5214950">n</span><span class="op" id="5214951">]</span><span class="op" id="5214952">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214958">p</span><span class="op" id="5214959">.</span><span class="ident" id="5214960">state</span>&nbsp;<span class="op" id="5214966">=</span>&nbsp;<span class="ident" id="5214968">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5214981">m</span>&nbsp;<span class="op" id="5214983">=</span>&nbsp;<span class="ident" id="5214985">n</span>&nbsp;<span class="op" id="5214987">+</span>&nbsp;<span class="num" id="5214989">1</span>&nbsp;<span class="comment" id="5214991">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5215023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5215027">default</span><span class="op" id="5215034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5215039">panic</span><span class="op" id="5215044">(</span><span class="string" id="5215045">&#34;unreachable&#34;</span><span class="op" id="5215058">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5215062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5215066">if</span>&nbsp;<span class="ident" id="5215069">err</span>&nbsp;<span class="op" id="5215073">!=</span>&nbsp;<span class="ident" id="5215076">nil</span>&nbsp;<span class="op" id="5215080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5215085">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5215094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5215097">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215100">n</span>&nbsp;<span class="op" id="5215102">=</span>&nbsp;<span class="builtinfunc" id="5215104">len</span><span class="op" id="5215107">(</span><span class="ident" id="5215108">data</span><span class="op" id="5215112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5215116">switch</span>&nbsp;<span class="ident" id="5215123">p</span><span class="op" id="5215124">.</span><span class="ident" id="5215125">state</span>&nbsp;<span class="op" id="5215131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5215134">case</span>&nbsp;<span class="ident" id="5215139">inEscape</span><span class="op" id="5215147">,</span>&nbsp;<span class="ident" id="5215149">inText</span><span class="op" id="5215155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215159">_</span><span class="op" id="5215160">,</span>&nbsp;<span class="ident" id="5215162">err</span>&nbsp;<span class="op" id="5215166">=</span>&nbsp;<span class="ident" id="5215168">p</span><span class="op" id="5215169">.</span><span class="ident" id="5215170">output</span><span class="op" id="5215176">.</span><span class="ident" id="5215177">Write</span><span class="op" id="5215182">(</span><span class="ident" id="5215183">data</span><span class="op" id="5215187">[</span><span class="ident" id="5215188">m</span><span class="op" id="5215189">:</span><span class="ident" id="5215190">n</span><span class="op" id="5215191">]</span><span class="op" id="5215192">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215196">p</span><span class="op" id="5215197">.</span><span class="ident" id="5215198">resetSpace</span><span class="op" id="5215208">(</span><span class="op" id="5215209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5215212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5215216">return</span><br>
<span class="lineno"></span><span class="op" id="5215223">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="5215226">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5215306">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5215327">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="5215392">type</span>&nbsp;<span class="ident" id="5215397">Mode</span>&nbsp;<span class="builtintype" id="5215402">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5215408">const</span>&nbsp;<span class="op" id="5215414">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215417">RawFormat</span>&nbsp;<span class="ident" id="5215427">Mode</span>&nbsp;<span class="op" id="5215432">=</span>&nbsp;<span class="num" id="5215434">1</span>&nbsp;<span class="op" id="5215436">&lt;&lt;</span>&nbsp;<span class="ident" id="5215439">iota</span>&nbsp;<span class="comment" id="5215444">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215501">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215528">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215582">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215609">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215654">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215681">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="5215743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5215746">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5215794">type</span>&nbsp;<span class="ident" id="5215799">Config</span>&nbsp;<span class="keyword" id="5215806">struct</span>&nbsp;<span class="op" id="5215813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215816">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215825">Mode</span>&nbsp;<span class="comment" id="5215830">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215845">Tabwidth</span>&nbsp;<span class="builtintype" id="5215854">int</span>&nbsp;&nbsp;<span class="comment" id="5215859">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5215874">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5215883">int</span>&nbsp;&nbsp;<span class="comment" id="5215888">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="5215947">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="5215950">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5216039">func</span>&nbsp;<span class="op" id="5216044">(</span><span class="ident" id="5216045">cfg</span>&nbsp;<span class="op" id="5216049">*</span><span class="ident" id="5216050">Config</span><span class="op" id="5216056">)</span>&nbsp;<span class="ident" id="5216058">fprint</span><span class="op" id="5216064">(</span><span class="ident" id="5216065">output</span>&nbsp;<span class="ident" id="5216072">io</span><span class="op" id="5216074">.</span><span class="ident" id="5216075">Writer</span><span class="op" id="5216081">,</span>&nbsp;<span class="ident" id="5216083">fset</span>&nbsp;<span class="op" id="5216088">*</span><span class="ident" id="5216089">token</span><span class="op" id="5216094">.</span><span class="ident" id="5216095">FileSet</span><span class="op" id="5216102">,</span>&nbsp;<span class="ident" id="5216104">node</span>&nbsp;<span class="keyword" id="5216109">interface</span><span class="op" id="5216118">{</span><span class="op" id="5216119">}</span><span class="op" id="5216120">,</span>&nbsp;<span class="ident" id="5216122">nodeSizes</span>&nbsp;<span class="keyword" id="5216132">map</span><span class="op" id="5216135">[</span><span class="ident" id="5216136">ast</span><span class="op" id="5216139">.</span><span class="ident" id="5216140">Node</span><span class="op" id="5216144">]</span><span class="builtintype" id="5216145">int</span><span class="op" id="5216148">)</span>&nbsp;<span class="op" id="5216150">(</span><span class="ident" id="5216151">err</span>&nbsp;<span class="builtintype" id="5216155">error</span><span class="op" id="5216160">)</span>&nbsp;<span class="op" id="5216162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216165">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216180">var</span>&nbsp;<span class="ident" id="5216184">p</span>&nbsp;<span class="ident" id="5216186">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216195">p</span><span class="op" id="5216196">.</span><span class="ident" id="5216197">init</span><span class="op" id="5216201">(</span><span class="ident" id="5216202">cfg</span><span class="op" id="5216205">,</span>&nbsp;<span class="ident" id="5216207">fset</span><span class="op" id="5216211">,</span>&nbsp;<span class="ident" id="5216213">nodeSizes</span><span class="op" id="5216222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216225">if</span>&nbsp;<span class="ident" id="5216228">err</span>&nbsp;<span class="op" id="5216232">=</span>&nbsp;<span class="ident" id="5216234">p</span><span class="op" id="5216235">.</span><span class="ident" id="5216236">printNode</span><span class="op" id="5216245">(</span><span class="ident" id="5216246">node</span><span class="op" id="5216250">)</span><span class="op" id="5216251">;</span>&nbsp;<span class="ident" id="5216253">err</span>&nbsp;<span class="op" id="5216257">!=</span>&nbsp;<span class="ident" id="5216260">nil</span>&nbsp;<span class="op" id="5216264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216268">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5216276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216279">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216310">p</span><span class="op" id="5216311">.</span><span class="ident" id="5216312">impliedSemi</span>&nbsp;<span class="op" id="5216324">=</span>&nbsp;<span class="builtintype" id="5216326">false</span>&nbsp;<span class="comment" id="5216332">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216360">p</span><span class="op" id="5216361">.</span><span class="ident" id="5216362">flush</span><span class="op" id="5216367">(</span><span class="ident" id="5216368">token</span><span class="op" id="5216373">.</span><span class="ident" id="5216374">Position</span><span class="op" id="5216382">{</span><span class="ident" id="5216383">Offset</span><span class="op" id="5216389">:</span>&nbsp;<span class="ident" id="5216391">infinity</span><span class="op" id="5216399">,</span>&nbsp;<span class="ident" id="5216401">Line</span><span class="op" id="5216405">:</span>&nbsp;<span class="ident" id="5216407">infinity</span><span class="op" id="5216415">}</span><span class="op" id="5216416">,</span>&nbsp;<span class="ident" id="5216418">token</span><span class="op" id="5216423">.</span><span class="ident" id="5216424">EOF</span><span class="op" id="5216427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216431">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216502">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216574">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216639">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216706">output</span>&nbsp;<span class="op" id="5216713">=</span>&nbsp;<span class="op" id="5216715">&amp;</span><span class="ident" id="5216716">trimmer</span><span class="op" id="5216723">{</span><span class="ident" id="5216724">output</span><span class="op" id="5216730">:</span>&nbsp;<span class="ident" id="5216732">output</span><span class="op" id="5216738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5216742">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216795">if</span>&nbsp;<span class="ident" id="5216798">cfg</span><span class="op" id="5216801">.</span><span class="ident" id="5216802">Mode</span><span class="op" id="5216806">&amp;</span><span class="ident" id="5216807">RawFormat</span>&nbsp;<span class="op" id="5216817">==</span>&nbsp;<span class="num" id="5216820">0</span>&nbsp;<span class="op" id="5216822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216826">minwidth</span>&nbsp;<span class="op" id="5216835">:=</span>&nbsp;<span class="ident" id="5216838">cfg</span><span class="op" id="5216841">.</span><span class="ident" id="5216842">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216854">padchar</span>&nbsp;<span class="op" id="5216862">:=</span>&nbsp;<span class="builtintype" id="5216865">byte</span><span class="op" id="5216869">(</span><span class="string" id="5216870">&#39;\t&#39;</span><span class="op" id="5216874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216878">if</span>&nbsp;<span class="ident" id="5216881">cfg</span><span class="op" id="5216884">.</span><span class="ident" id="5216885">Mode</span><span class="op" id="5216889">&amp;</span><span class="ident" id="5216890">UseSpaces</span>&nbsp;<span class="op" id="5216900">!=</span>&nbsp;<span class="num" id="5216903">0</span>&nbsp;<span class="op" id="5216905">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216910">padchar</span>&nbsp;<span class="op" id="5216918">=</span>&nbsp;<span class="string" id="5216920">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5216926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5216931">twmode</span>&nbsp;<span class="op" id="5216938">:=</span>&nbsp;<span class="ident" id="5216941">tabwriter</span><span class="op" id="5216950">.</span><span class="ident" id="5216951">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5216973">if</span>&nbsp;<span class="ident" id="5216976">cfg</span><span class="op" id="5216979">.</span><span class="ident" id="5216980">Mode</span><span class="op" id="5216984">&amp;</span><span class="ident" id="5216985">TabIndent</span>&nbsp;<span class="op" id="5216995">!=</span>&nbsp;<span class="num" id="5216998">0</span>&nbsp;<span class="op" id="5217000">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217005">minwidth</span>&nbsp;<span class="op" id="5217014">=</span>&nbsp;<span class="num" id="5217016">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217021">twmode</span>&nbsp;<span class="op" id="5217028">|=</span>&nbsp;<span class="ident" id="5217031">tabwriter</span><span class="op" id="5217040">.</span><span class="ident" id="5217041">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217058">output</span>&nbsp;<span class="op" id="5217065">=</span>&nbsp;<span class="ident" id="5217067">tabwriter</span><span class="op" id="5217076">.</span><span class="ident" id="5217077">NewWriter</span><span class="op" id="5217086">(</span><span class="ident" id="5217087">output</span><span class="op" id="5217093">,</span>&nbsp;<span class="ident" id="5217095">minwidth</span><span class="op" id="5217103">,</span>&nbsp;<span class="ident" id="5217105">cfg</span><span class="op" id="5217108">.</span><span class="ident" id="5217109">Tabwidth</span><span class="op" id="5217117">,</span>&nbsp;<span class="num" id="5217119">1</span><span class="op" id="5217120">,</span>&nbsp;<span class="ident" id="5217122">padchar</span><span class="op" id="5217129">,</span>&nbsp;<span class="ident" id="5217131">twmode</span><span class="op" id="5217137">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5217144">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217201">if</span>&nbsp;<span class="ident" id="5217204">_</span><span class="op" id="5217205">,</span>&nbsp;<span class="ident" id="5217207">err</span>&nbsp;<span class="op" id="5217211">=</span>&nbsp;<span class="ident" id="5217213">output</span><span class="op" id="5217219">.</span><span class="ident" id="5217220">Write</span><span class="op" id="5217225">(</span><span class="ident" id="5217226">p</span><span class="op" id="5217227">.</span><span class="ident" id="5217228">output</span><span class="op" id="5217234">)</span><span class="op" id="5217235">;</span>&nbsp;<span class="ident" id="5217237">err</span>&nbsp;<span class="op" id="5217241">!=</span>&nbsp;<span class="ident" id="5217244">nil</span>&nbsp;<span class="op" id="5217248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217252">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5217264">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217292">if</span>&nbsp;<span class="ident" id="5217295">tw</span><span class="op" id="5217297">,</span>&nbsp;<span class="ident" id="5217299">_</span>&nbsp;<span class="op" id="5217301">:=</span>&nbsp;<span class="ident" id="5217304">output</span><span class="op" id="5217310">.</span><span class="op" id="5217311">(</span><span class="op" id="5217312">*</span><span class="ident" id="5217313">tabwriter</span><span class="op" id="5217322">.</span><span class="ident" id="5217323">Writer</span><span class="op" id="5217329">)</span><span class="op" id="5217330">;</span>&nbsp;<span class="ident" id="5217332">tw</span>&nbsp;<span class="op" id="5217335">!=</span>&nbsp;<span class="ident" id="5217338">nil</span>&nbsp;<span class="op" id="5217342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217346">err</span>&nbsp;<span class="op" id="5217350">=</span>&nbsp;<span class="ident" id="5217352">tw</span><span class="op" id="5217354">.</span><span class="ident" id="5217355">Flush</span><span class="op" id="5217360">(</span><span class="op" id="5217361">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5217364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5217368">return</span><br>
<span class="lineno"></span><span class="op" id="5217375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="5217378">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5217445">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5217511">//</span><br>
<span class="lineno"></span><span class="keyword" id="5217514">type</span>&nbsp;<span class="ident" id="5217519">CommentedNode</span>&nbsp;<span class="keyword" id="5217533">struct</span>&nbsp;<span class="op" id="5217540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217543">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217552">interface</span><span class="op" id="5217561">{</span><span class="op" id="5217562">}</span>&nbsp;<span class="comment" id="5217564">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5217624">Comments</span>&nbsp;<span class="op" id="5217633">[</span><span class="op" id="5217634">]</span><span class="op" id="5217635">*</span><span class="ident" id="5217636">ast</span><span class="op" id="5217639">.</span><span class="ident" id="5217640">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="5217653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5217656">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="5217735">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="5217805">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="5217881">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="5217955">//</span><br>
<span class="lineno"></span><span class="keyword" id="5217958">func</span>&nbsp;<span class="op" id="5217963">(</span><span class="ident" id="5217964">cfg</span>&nbsp;<span class="op" id="5217968">*</span><span class="ident" id="5217969">Config</span><span class="op" id="5217975">)</span>&nbsp;<span class="ident" id="5217977">Fprint</span><span class="op" id="5217983">(</span><span class="ident" id="5217984">output</span>&nbsp;<span class="ident" id="5217991">io</span><span class="op" id="5217993">.</span><span class="ident" id="5217994">Writer</span><span class="op" id="5218000">,</span>&nbsp;<span class="ident" id="5218002">fset</span>&nbsp;<span class="op" id="5218007">*</span><span class="ident" id="5218008">token</span><span class="op" id="5218013">.</span><span class="ident" id="5218014">FileSet</span><span class="op" id="5218021">,</span>&nbsp;<span class="ident" id="5218023">node</span>&nbsp;<span class="keyword" id="5218028">interface</span><span class="op" id="5218037">{</span><span class="op" id="5218038">}</span><span class="op" id="5218039">)</span>&nbsp;<span class="builtintype" id="5218041">error</span>&nbsp;<span class="op" id="5218047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218050">return</span>&nbsp;<span class="ident" id="5218057">cfg</span><span class="op" id="5218060">.</span><span class="ident" id="5218061">fprint</span><span class="op" id="5218067">(</span><span class="ident" id="5218068">output</span><span class="op" id="5218074">,</span>&nbsp;<span class="ident" id="5218076">fset</span><span class="op" id="5218080">,</span>&nbsp;<span class="ident" id="5218082">node</span><span class="op" id="5218086">,</span>&nbsp;<span class="builtinfunc" id="5218088">make</span><span class="op" id="5218092">(</span><span class="keyword" id="5218093">map</span><span class="op" id="5218096">[</span><span class="ident" id="5218097">ast</span><span class="op" id="5218100">.</span><span class="ident" id="5218101">Node</span><span class="op" id="5218105">]</span><span class="builtintype" id="5218106">int</span><span class="op" id="5218109">)</span><span class="op" id="5218110">)</span><br>
<span class="lineno">1285</span><span class="op" id="5218112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5218115">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5218164">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="5218213">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="5218216">func</span>&nbsp;<span class="ident" id="5218221">Fprint</span><span class="op" id="5218227">(</span><span class="ident" id="5218228">output</span>&nbsp;<span class="ident" id="5218235">io</span><span class="op" id="5218237">.</span><span class="ident" id="5218238">Writer</span><span class="op" id="5218244">,</span>&nbsp;<span class="ident" id="5218246">fset</span>&nbsp;<span class="op" id="5218251">*</span><span class="ident" id="5218252">token</span><span class="op" id="5218257">.</span><span class="ident" id="5218258">FileSet</span><span class="op" id="5218265">,</span>&nbsp;<span class="ident" id="5218267">node</span>&nbsp;<span class="keyword" id="5218272">interface</span><span class="op" id="5218281">{</span><span class="op" id="5218282">}</span><span class="op" id="5218283">)</span>&nbsp;<span class="builtintype" id="5218285">error</span>&nbsp;<span class="op" id="5218291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5218294">return</span>&nbsp;<span class="op" id="5218301">(</span><span class="op" id="5218302">&amp;</span><span class="ident" id="5218303">Config</span><span class="op" id="5218309">{</span><span class="ident" id="5218310">Tabwidth</span><span class="op" id="5218318">:</span>&nbsp;<span class="num" id="5218320">8</span><span class="op" id="5218321">}</span><span class="op" id="5218322">)</span><span class="op" id="5218323">.</span><span class="ident" id="5218324">Fprint</span><span class="op" id="5218330">(</span><span class="ident" id="5218331">output</span><span class="op" id="5218337">,</span>&nbsp;<span class="ident" id="5218339">fset</span><span class="op" id="5218343">,</span>&nbsp;<span class="ident" id="5218345">node</span><span class="op" id="5218349">)</span><br>
<span class="lineno"></span><span class="op" id="5218351">}</span>
</div>
</body>
</html>
