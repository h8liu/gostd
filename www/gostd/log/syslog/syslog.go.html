<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2925136">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2925191">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2925245">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2925296">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2925329">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="2925393">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="2925458">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="2925489">//</span><br>
<span class="lineno"></span><span class="comment" id="2925492">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="2925550">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="2925611">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="2925631">package</span>&nbsp;<span class="ident" id="2925639">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="2925647">import</span>&nbsp;<span class="op" id="2925654">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2925657">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2925667">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2925674">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2925681">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2925688">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2925694">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2925705">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2925713">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="2925720">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2925723">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2925783">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="2925853">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="2925922">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="2925959">type</span>&nbsp;<span class="ident" id="2925964">Priority</span>&nbsp;<span class="builtintype" id="2925973">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2925978">const</span>&nbsp;<span class="ident" id="2925984">severityMask</span>&nbsp;<span class="op" id="2925997">=</span>&nbsp;<span class="num" id="2925999">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="2926004">const</span>&nbsp;<span class="ident" id="2926010">facilityMask</span>&nbsp;<span class="op" id="2926023">=</span>&nbsp;<span class="num" id="2926025">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2926031">const</span>&nbsp;<span class="op" id="2926037">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2926040">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2926055">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2926091">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926139">LOG_EMERG</span>&nbsp;<span class="ident" id="2926149">Priority</span>&nbsp;<span class="op" id="2926158">=</span>&nbsp;<span class="ident" id="2926160">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926166">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926177">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926187">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926196">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926209">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926221">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926231">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="2926241">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="2926244">const</span>&nbsp;<span class="op" id="2926250">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2926253">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2926268">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2926304">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926366">LOG_KERN</span>&nbsp;<span class="ident" id="2926375">Priority</span>&nbsp;<span class="op" id="2926384">=</span>&nbsp;<span class="ident" id="2926386">iota</span>&nbsp;<span class="op" id="2926391">&lt;&lt;</span>&nbsp;<span class="num" id="2926394">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926397">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926407">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926417">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926429">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926439">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926451">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926460">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926470">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926480">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926490">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926504">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926513">_</span>&nbsp;<span class="comment" id="2926515">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926526">_</span>&nbsp;<span class="comment" id="2926528">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926539">_</span>&nbsp;<span class="comment" id="2926541">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926552">_</span>&nbsp;<span class="comment" id="2926554">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926565">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926577">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926589">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926601">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926613">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926625">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926637">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926649">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="2926660">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2926663">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="2926711">type</span>&nbsp;<span class="ident" id="2926716">Writer</span>&nbsp;<span class="keyword" id="2926723">struct</span>&nbsp;<span class="op" id="2926730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926733">priority</span>&nbsp;<span class="ident" id="2926742">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926752">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2926761">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926769">hostname</span>&nbsp;<span class="builtintype" id="2926778">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926786">network</span>&nbsp;&nbsp;<span class="builtintype" id="2926795">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926803">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2926812">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926821">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2926826">sync</span><span class="op" id="2926830">.</span><span class="ident" id="2926831">Mutex</span>&nbsp;<span class="comment" id="2926837">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2926853">conn</span>&nbsp;<span class="ident" id="2926858">serverConn</span><br>
<span class="lineno"></span><span class="op" id="2926869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2926872">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="2926937">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="2927005">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="2927070">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2927141">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="2927211">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="2927239">type</span>&nbsp;<span class="ident" id="2927244">serverConn</span>&nbsp;<span class="keyword" id="2927255">interface</span>&nbsp;<span class="op" id="2927265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927268">writeString</span><span class="op" id="2927279">(</span><span class="ident" id="2927280">p</span>&nbsp;<span class="ident" id="2927282">Priority</span><span class="op" id="2927290">,</span>&nbsp;<span class="ident" id="2927292">hostname</span><span class="op" id="2927300">,</span>&nbsp;<span class="ident" id="2927302">tag</span><span class="op" id="2927305">,</span>&nbsp;<span class="ident" id="2927307">s</span><span class="op" id="2927308">,</span>&nbsp;<span class="ident" id="2927310">nl</span>&nbsp;<span class="builtintype" id="2927313">string</span><span class="op" id="2927319">)</span>&nbsp;<span class="builtintype" id="2927321">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2927328">close</span><span class="op" id="2927333">(</span><span class="op" id="2927334">)</span>&nbsp;<span class="builtintype" id="2927336">error</span><br>
<span class="lineno"></span><span class="op" id="2927342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="2927345">type</span>&nbsp;<span class="ident" id="2927350">netConn</span>&nbsp;<span class="keyword" id="2927358">struct</span>&nbsp;<span class="op" id="2927365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927368">local</span>&nbsp;<span class="builtintype" id="2927374">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2927380">conn</span>&nbsp;&nbsp;<span class="ident" id="2927386">net</span><span class="op" id="2927389">.</span><span class="ident" id="2927390">Conn</span><br>
<span class="lineno"></span><span class="op" id="2927395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="2927398">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="2927466">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="2927533">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="2927557">func</span>&nbsp;<span class="ident" id="2927562">New</span><span class="op" id="2927565">(</span><span class="ident" id="2927566">priority</span>&nbsp;<span class="ident" id="2927575">Priority</span><span class="op" id="2927583">,</span>&nbsp;<span class="ident" id="2927585">tag</span>&nbsp;<span class="builtintype" id="2927589">string</span><span class="op" id="2927595">)</span>&nbsp;<span class="op" id="2927597">(</span><span class="ident" id="2927598">w</span>&nbsp;<span class="op" id="2927600">*</span><span class="ident" id="2927601">Writer</span><span class="op" id="2927607">,</span>&nbsp;<span class="ident" id="2927609">err</span>&nbsp;<span class="builtintype" id="2927613">error</span><span class="op" id="2927618">)</span>&nbsp;<span class="op" id="2927620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2927623">return</span>&nbsp;<span class="ident" id="2927630">Dial</span><span class="op" id="2927634">(</span><span class="string" id="2927635">&#34;&#34;</span><span class="op" id="2927637">,</span>&nbsp;<span class="string" id="2927639">&#34;&#34;</span><span class="op" id="2927641">,</span>&nbsp;<span class="ident" id="2927643">priority</span><span class="op" id="2927651">,</span>&nbsp;<span class="ident" id="2927653">tag</span><span class="op" id="2927656">)</span><br>
<span class="lineno">115</span><span class="op" id="2927658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2927661">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2927727">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="2927798">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="2927866">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="2927874">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="2927944">func</span>&nbsp;<span class="ident" id="2927949">Dial</span><span class="op" id="2927953">(</span><span class="ident" id="2927954">network</span><span class="op" id="2927961">,</span>&nbsp;<span class="ident" id="2927963">raddr</span>&nbsp;<span class="builtintype" id="2927969">string</span><span class="op" id="2927975">,</span>&nbsp;<span class="ident" id="2927977">priority</span>&nbsp;<span class="ident" id="2927986">Priority</span><span class="op" id="2927994">,</span>&nbsp;<span class="ident" id="2927996">tag</span>&nbsp;<span class="builtintype" id="2928000">string</span><span class="op" id="2928006">)</span>&nbsp;<span class="op" id="2928008">(</span><span class="op" id="2928009">*</span><span class="ident" id="2928010">Writer</span><span class="op" id="2928016">,</span>&nbsp;<span class="builtintype" id="2928018">error</span><span class="op" id="2928023">)</span>&nbsp;<span class="op" id="2928025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928028">if</span>&nbsp;<span class="ident" id="2928031">priority</span>&nbsp;<span class="op" id="2928040">&lt;</span>&nbsp;<span class="num" id="2928042">0</span>&nbsp;<span class="op" id="2928044">||</span>&nbsp;<span class="ident" id="2928047">priority</span>&nbsp;<span class="op" id="2928056">&gt;</span>&nbsp;<span class="ident" id="2928058">LOG_LOCAL7</span><span class="op" id="2928068">|</span><span class="ident" id="2928069">LOG_DEBUG</span>&nbsp;<span class="op" id="2928079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928083">return</span>&nbsp;<span class="ident" id="2928090">nil</span><span class="op" id="2928093">,</span>&nbsp;<span class="ident" id="2928095">errors</span><span class="op" id="2928101">.</span><span class="ident" id="2928102">New</span><span class="op" id="2928105">(</span><span class="string" id="2928106">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="2928136">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928143">if</span>&nbsp;<span class="ident" id="2928146">tag</span>&nbsp;<span class="op" id="2928150">==</span>&nbsp;<span class="string" id="2928153">&#34;&#34;</span>&nbsp;<span class="op" id="2928156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928160">tag</span>&nbsp;<span class="op" id="2928164">=</span>&nbsp;<span class="ident" id="2928166">os</span><span class="op" id="2928168">.</span><span class="ident" id="2928169">Args</span><span class="op" id="2928173">[</span><span class="num" id="2928174">0</span><span class="op" id="2928175">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928178">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928181">hostname</span><span class="op" id="2928189">,</span>&nbsp;<span class="ident" id="2928191">_</span>&nbsp;<span class="op" id="2928193">:=</span>&nbsp;<span class="ident" id="2928196">os</span><span class="op" id="2928198">.</span><span class="ident" id="2928199">Hostname</span><span class="op" id="2928207">(</span><span class="op" id="2928208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928212">w</span>&nbsp;<span class="op" id="2928214">:=</span>&nbsp;<span class="op" id="2928217">&amp;</span><span class="ident" id="2928218">Writer</span><span class="op" id="2928224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928228">priority</span><span class="op" id="2928236">:</span>&nbsp;<span class="ident" id="2928238">priority</span><span class="op" id="2928246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928250">tag</span><span class="op" id="2928253">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2928260">tag</span><span class="op" id="2928263">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928267">hostname</span><span class="op" id="2928275">:</span>&nbsp;<span class="ident" id="2928277">hostname</span><span class="op" id="2928285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928289">network</span><span class="op" id="2928296">:</span>&nbsp;&nbsp;<span class="ident" id="2928299">network</span><span class="op" id="2928306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928310">raddr</span><span class="op" id="2928315">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2928320">raddr</span><span class="op" id="2928325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928332">w</span><span class="op" id="2928333">.</span><span class="ident" id="2928334">mu</span><span class="op" id="2928336">.</span><span class="ident" id="2928337">Lock</span><span class="op" id="2928341">(</span><span class="op" id="2928342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928345">defer</span>&nbsp;<span class="ident" id="2928351">w</span><span class="op" id="2928352">.</span><span class="ident" id="2928353">mu</span><span class="op" id="2928355">.</span><span class="ident" id="2928356">Unlock</span><span class="op" id="2928362">(</span><span class="op" id="2928363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928367">err</span>&nbsp;<span class="op" id="2928371">:=</span>&nbsp;<span class="ident" id="2928374">w</span><span class="op" id="2928375">.</span><span class="ident" id="2928376">connect</span><span class="op" id="2928383">(</span><span class="op" id="2928384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928387">if</span>&nbsp;<span class="ident" id="2928390">err</span>&nbsp;<span class="op" id="2928394">!=</span>&nbsp;<span class="ident" id="2928397">nil</span>&nbsp;<span class="op" id="2928401">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928405">return</span>&nbsp;<span class="ident" id="2928412">nil</span><span class="op" id="2928415">,</span>&nbsp;<span class="ident" id="2928417">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928425">return</span>&nbsp;<span class="ident" id="2928432">w</span><span class="op" id="2928433">,</span>&nbsp;<span class="ident" id="2928435">err</span><br>
<span class="lineno"></span><span class="op" id="2928439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="2928442">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="2928494">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="2928531">func</span>&nbsp;<span class="op" id="2928536">(</span><span class="ident" id="2928537">w</span>&nbsp;<span class="op" id="2928539">*</span><span class="ident" id="2928540">Writer</span><span class="op" id="2928546">)</span>&nbsp;<span class="ident" id="2928548">connect</span><span class="op" id="2928555">(</span><span class="op" id="2928556">)</span>&nbsp;<span class="op" id="2928558">(</span><span class="ident" id="2928559">err</span>&nbsp;<span class="builtintype" id="2928563">error</span><span class="op" id="2928568">)</span>&nbsp;<span class="op" id="2928570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928573">if</span>&nbsp;<span class="ident" id="2928576">w</span><span class="op" id="2928577">.</span><span class="ident" id="2928578">conn</span>&nbsp;<span class="op" id="2928583">!=</span>&nbsp;<span class="ident" id="2928586">nil</span>&nbsp;<span class="op" id="2928590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928594">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928656">w</span><span class="op" id="2928657">.</span><span class="ident" id="2928658">conn</span><span class="op" id="2928662">.</span><span class="builtinfunc" id="2928663">close</span><span class="op" id="2928668">(</span><span class="op" id="2928669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928673">w</span><span class="op" id="2928674">.</span><span class="ident" id="2928675">conn</span>&nbsp;<span class="op" id="2928680">=</span>&nbsp;<span class="ident" id="2928682">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928691">if</span>&nbsp;<span class="ident" id="2928694">w</span><span class="op" id="2928695">.</span><span class="ident" id="2928696">network</span>&nbsp;<span class="op" id="2928704">==</span>&nbsp;<span class="string" id="2928707">&#34;&#34;</span>&nbsp;<span class="op" id="2928710">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928714">w</span><span class="op" id="2928715">.</span><span class="ident" id="2928716">conn</span><span class="op" id="2928720">,</span>&nbsp;<span class="ident" id="2928722">err</span>&nbsp;<span class="op" id="2928726">=</span>&nbsp;<span class="ident" id="2928728">unixSyslog</span><span class="op" id="2928738">(</span><span class="op" id="2928739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928743">if</span>&nbsp;<span class="ident" id="2928746">w</span><span class="op" id="2928747">.</span><span class="ident" id="2928748">hostname</span>&nbsp;<span class="op" id="2928757">==</span>&nbsp;<span class="string" id="2928760">&#34;&#34;</span>&nbsp;<span class="op" id="2928763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928768">w</span><span class="op" id="2928769">.</span><span class="ident" id="2928770">hostname</span>&nbsp;<span class="op" id="2928779">=</span>&nbsp;<span class="string" id="2928781">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928798">}</span>&nbsp;<span class="keyword" id="2928800">else</span>&nbsp;<span class="op" id="2928805">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928809">var</span>&nbsp;<span class="ident" id="2928813">c</span>&nbsp;<span class="ident" id="2928815">net</span><span class="op" id="2928818">.</span><span class="ident" id="2928819">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928826">c</span><span class="op" id="2928827">,</span>&nbsp;<span class="ident" id="2928829">err</span>&nbsp;<span class="op" id="2928833">=</span>&nbsp;<span class="ident" id="2928835">net</span><span class="op" id="2928838">.</span><span class="ident" id="2928839">Dial</span><span class="op" id="2928843">(</span><span class="ident" id="2928844">w</span><span class="op" id="2928845">.</span><span class="ident" id="2928846">network</span><span class="op" id="2928853">,</span>&nbsp;<span class="ident" id="2928855">w</span><span class="op" id="2928856">.</span><span class="ident" id="2928857">raddr</span><span class="op" id="2928862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928866">if</span>&nbsp;<span class="ident" id="2928869">err</span>&nbsp;<span class="op" id="2928873">==</span>&nbsp;<span class="ident" id="2928876">nil</span>&nbsp;<span class="op" id="2928880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928885">w</span><span class="op" id="2928886">.</span><span class="ident" id="2928887">conn</span>&nbsp;<span class="op" id="2928892">=</span>&nbsp;<span class="op" id="2928894">&amp;</span><span class="ident" id="2928895">netConn</span><span class="op" id="2928902">{</span><span class="ident" id="2928903">conn</span><span class="op" id="2928907">:</span>&nbsp;<span class="ident" id="2928909">c</span><span class="op" id="2928910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928915">if</span>&nbsp;<span class="ident" id="2928918">w</span><span class="op" id="2928919">.</span><span class="ident" id="2928920">hostname</span>&nbsp;<span class="op" id="2928929">==</span>&nbsp;<span class="string" id="2928932">&#34;&#34;</span>&nbsp;<span class="op" id="2928935">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928941">w</span><span class="op" id="2928942">.</span><span class="ident" id="2928943">hostname</span>&nbsp;<span class="op" id="2928952">=</span>&nbsp;<span class="ident" id="2928954">c</span><span class="op" id="2928955">.</span><span class="ident" id="2928956">LocalAddr</span><span class="op" id="2928965">(</span><span class="op" id="2928966">)</span><span class="op" id="2928967">.</span><span class="ident" id="2928968">String</span><span class="op" id="2928974">(</span><span class="op" id="2928975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2928987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2928990">return</span><br>
<span class="lineno">175</span><span class="op" id="2928997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2929000">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="2929051">func</span>&nbsp;<span class="op" id="2929056">(</span><span class="ident" id="2929057">w</span>&nbsp;<span class="op" id="2929059">*</span><span class="ident" id="2929060">Writer</span><span class="op" id="2929066">)</span>&nbsp;<span class="ident" id="2929068">Write</span><span class="op" id="2929073">(</span><span class="ident" id="2929074">b</span>&nbsp;<span class="op" id="2929076">[</span><span class="op" id="2929077">]</span><span class="builtintype" id="2929078">byte</span><span class="op" id="2929082">)</span>&nbsp;<span class="op" id="2929084">(</span><span class="builtintype" id="2929085">int</span><span class="op" id="2929088">,</span>&nbsp;<span class="builtintype" id="2929090">error</span><span class="op" id="2929095">)</span>&nbsp;<span class="op" id="2929097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929100">return</span>&nbsp;<span class="ident" id="2929107">w</span><span class="op" id="2929108">.</span><span class="ident" id="2929109">writeAndRetry</span><span class="op" id="2929122">(</span><span class="ident" id="2929123">w</span><span class="op" id="2929124">.</span><span class="ident" id="2929125">priority</span><span class="op" id="2929133">,</span>&nbsp;<span class="builtintype" id="2929135">string</span><span class="op" id="2929141">(</span><span class="ident" id="2929142">b</span><span class="op" id="2929143">)</span><span class="op" id="2929144">)</span><br>
<span class="lineno">180</span><span class="op" id="2929146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2929149">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="2929200">func</span>&nbsp;<span class="op" id="2929205">(</span><span class="ident" id="2929206">w</span>&nbsp;<span class="op" id="2929208">*</span><span class="ident" id="2929209">Writer</span><span class="op" id="2929215">)</span>&nbsp;<span class="ident" id="2929217">Close</span><span class="op" id="2929222">(</span><span class="op" id="2929223">)</span>&nbsp;<span class="builtintype" id="2929225">error</span>&nbsp;<span class="op" id="2929231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929234">w</span><span class="op" id="2929235">.</span><span class="ident" id="2929236">mu</span><span class="op" id="2929238">.</span><span class="ident" id="2929239">Lock</span><span class="op" id="2929243">(</span><span class="op" id="2929244">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929247">defer</span>&nbsp;<span class="ident" id="2929253">w</span><span class="op" id="2929254">.</span><span class="ident" id="2929255">mu</span><span class="op" id="2929257">.</span><span class="ident" id="2929258">Unlock</span><span class="op" id="2929264">(</span><span class="op" id="2929265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929269">if</span>&nbsp;<span class="ident" id="2929272">w</span><span class="op" id="2929273">.</span><span class="ident" id="2929274">conn</span>&nbsp;<span class="op" id="2929279">!=</span>&nbsp;<span class="ident" id="2929282">nil</span>&nbsp;<span class="op" id="2929286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929290">err</span>&nbsp;<span class="op" id="2929294">:=</span>&nbsp;<span class="ident" id="2929297">w</span><span class="op" id="2929298">.</span><span class="ident" id="2929299">conn</span><span class="op" id="2929303">.</span><span class="builtinfunc" id="2929304">close</span><span class="op" id="2929309">(</span><span class="op" id="2929310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929314">w</span><span class="op" id="2929315">.</span><span class="ident" id="2929316">conn</span>&nbsp;<span class="op" id="2929321">=</span>&nbsp;<span class="ident" id="2929323">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929329">return</span>&nbsp;<span class="ident" id="2929336">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929344">return</span>&nbsp;<span class="ident" id="2929351">nil</span><br>
<span class="lineno"></span><span class="op" id="2929355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="2929358">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="2929429">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="2929447">func</span>&nbsp;<span class="op" id="2929452">(</span><span class="ident" id="2929453">w</span>&nbsp;<span class="op" id="2929455">*</span><span class="ident" id="2929456">Writer</span><span class="op" id="2929462">)</span>&nbsp;<span class="ident" id="2929464">Emerg</span><span class="op" id="2929469">(</span><span class="ident" id="2929470">m</span>&nbsp;<span class="builtintype" id="2929472">string</span><span class="op" id="2929478">)</span>&nbsp;<span class="op" id="2929480">(</span><span class="ident" id="2929481">err</span>&nbsp;<span class="builtintype" id="2929485">error</span><span class="op" id="2929490">)</span>&nbsp;<span class="op" id="2929492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929495">_</span><span class="op" id="2929496">,</span>&nbsp;<span class="ident" id="2929498">err</span>&nbsp;<span class="op" id="2929502">=</span>&nbsp;<span class="ident" id="2929504">w</span><span class="op" id="2929505">.</span><span class="ident" id="2929506">writeAndRetry</span><span class="op" id="2929519">(</span><span class="ident" id="2929520">LOG_EMERG</span><span class="op" id="2929529">,</span>&nbsp;<span class="ident" id="2929531">m</span><span class="op" id="2929532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929535">return</span>&nbsp;<span class="ident" id="2929542">err</span><br>
<span class="lineno">200</span><span class="op" id="2929546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2929549">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="2929620">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="2929638">func</span>&nbsp;<span class="op" id="2929643">(</span><span class="ident" id="2929644">w</span>&nbsp;<span class="op" id="2929646">*</span><span class="ident" id="2929647">Writer</span><span class="op" id="2929653">)</span>&nbsp;<span class="ident" id="2929655">Alert</span><span class="op" id="2929660">(</span><span class="ident" id="2929661">m</span>&nbsp;<span class="builtintype" id="2929663">string</span><span class="op" id="2929669">)</span>&nbsp;<span class="op" id="2929671">(</span><span class="ident" id="2929672">err</span>&nbsp;<span class="builtintype" id="2929676">error</span><span class="op" id="2929681">)</span>&nbsp;<span class="op" id="2929683">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929686">_</span><span class="op" id="2929687">,</span>&nbsp;<span class="ident" id="2929689">err</span>&nbsp;<span class="op" id="2929693">=</span>&nbsp;<span class="ident" id="2929695">w</span><span class="op" id="2929696">.</span><span class="ident" id="2929697">writeAndRetry</span><span class="op" id="2929710">(</span><span class="ident" id="2929711">LOG_ALERT</span><span class="op" id="2929720">,</span>&nbsp;<span class="ident" id="2929722">m</span><span class="op" id="2929723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929726">return</span>&nbsp;<span class="ident" id="2929733">err</span><br>
<span class="lineno"></span><span class="op" id="2929737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2929740">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="2929809">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="2929827">func</span>&nbsp;<span class="op" id="2929832">(</span><span class="ident" id="2929833">w</span>&nbsp;<span class="op" id="2929835">*</span><span class="ident" id="2929836">Writer</span><span class="op" id="2929842">)</span>&nbsp;<span class="ident" id="2929844">Crit</span><span class="op" id="2929848">(</span><span class="ident" id="2929849">m</span>&nbsp;<span class="builtintype" id="2929851">string</span><span class="op" id="2929857">)</span>&nbsp;<span class="op" id="2929859">(</span><span class="ident" id="2929860">err</span>&nbsp;<span class="builtintype" id="2929864">error</span><span class="op" id="2929869">)</span>&nbsp;<span class="op" id="2929871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929874">_</span><span class="op" id="2929875">,</span>&nbsp;<span class="ident" id="2929877">err</span>&nbsp;<span class="op" id="2929881">=</span>&nbsp;<span class="ident" id="2929883">w</span><span class="op" id="2929884">.</span><span class="ident" id="2929885">writeAndRetry</span><span class="op" id="2929898">(</span><span class="ident" id="2929899">LOG_CRIT</span><span class="op" id="2929907">,</span>&nbsp;<span class="ident" id="2929909">m</span><span class="op" id="2929910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929913">return</span>&nbsp;<span class="ident" id="2929920">err</span><br>
<span class="lineno"></span><span class="op" id="2929924">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="2929927">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="2929994">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="2930012">func</span>&nbsp;<span class="op" id="2930017">(</span><span class="ident" id="2930018">w</span>&nbsp;<span class="op" id="2930020">*</span><span class="ident" id="2930021">Writer</span><span class="op" id="2930027">)</span>&nbsp;<span class="ident" id="2930029">Err</span><span class="op" id="2930032">(</span><span class="ident" id="2930033">m</span>&nbsp;<span class="builtintype" id="2930035">string</span><span class="op" id="2930041">)</span>&nbsp;<span class="op" id="2930043">(</span><span class="ident" id="2930044">err</span>&nbsp;<span class="builtintype" id="2930048">error</span><span class="op" id="2930053">)</span>&nbsp;<span class="op" id="2930055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930058">_</span><span class="op" id="2930059">,</span>&nbsp;<span class="ident" id="2930061">err</span>&nbsp;<span class="op" id="2930065">=</span>&nbsp;<span class="ident" id="2930067">w</span><span class="op" id="2930068">.</span><span class="ident" id="2930069">writeAndRetry</span><span class="op" id="2930082">(</span><span class="ident" id="2930083">LOG_ERR</span><span class="op" id="2930090">,</span>&nbsp;<span class="ident" id="2930092">m</span><span class="op" id="2930093">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930096">return</span>&nbsp;<span class="ident" id="2930103">err</span><br>
<span class="lineno"></span><span class="op" id="2930107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2930110">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2930176">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="2930203">func</span>&nbsp;<span class="op" id="2930208">(</span><span class="ident" id="2930209">w</span>&nbsp;<span class="op" id="2930211">*</span><span class="ident" id="2930212">Writer</span><span class="op" id="2930218">)</span>&nbsp;<span class="ident" id="2930220">Warning</span><span class="op" id="2930227">(</span><span class="ident" id="2930228">m</span>&nbsp;<span class="builtintype" id="2930230">string</span><span class="op" id="2930236">)</span>&nbsp;<span class="op" id="2930238">(</span><span class="ident" id="2930239">err</span>&nbsp;<span class="builtintype" id="2930243">error</span><span class="op" id="2930248">)</span>&nbsp;<span class="op" id="2930250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930253">_</span><span class="op" id="2930254">,</span>&nbsp;<span class="ident" id="2930256">err</span>&nbsp;<span class="op" id="2930260">=</span>&nbsp;<span class="ident" id="2930262">w</span><span class="op" id="2930263">.</span><span class="ident" id="2930264">writeAndRetry</span><span class="op" id="2930277">(</span><span class="ident" id="2930278">LOG_WARNING</span><span class="op" id="2930289">,</span>&nbsp;<span class="ident" id="2930291">m</span><span class="op" id="2930292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930295">return</span>&nbsp;<span class="ident" id="2930302">err</span><br>
<span class="lineno"></span><span class="op" id="2930306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="2930309">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2930373">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="2930400">func</span>&nbsp;<span class="op" id="2930405">(</span><span class="ident" id="2930406">w</span>&nbsp;<span class="op" id="2930408">*</span><span class="ident" id="2930409">Writer</span><span class="op" id="2930415">)</span>&nbsp;<span class="ident" id="2930417">Notice</span><span class="op" id="2930423">(</span><span class="ident" id="2930424">m</span>&nbsp;<span class="builtintype" id="2930426">string</span><span class="op" id="2930432">)</span>&nbsp;<span class="op" id="2930434">(</span><span class="ident" id="2930435">err</span>&nbsp;<span class="builtintype" id="2930439">error</span><span class="op" id="2930444">)</span>&nbsp;<span class="op" id="2930446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930449">_</span><span class="op" id="2930450">,</span>&nbsp;<span class="ident" id="2930452">err</span>&nbsp;<span class="op" id="2930456">=</span>&nbsp;<span class="ident" id="2930458">w</span><span class="op" id="2930459">.</span><span class="ident" id="2930460">writeAndRetry</span><span class="op" id="2930473">(</span><span class="ident" id="2930474">LOG_NOTICE</span><span class="op" id="2930484">,</span>&nbsp;<span class="ident" id="2930486">m</span><span class="op" id="2930487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930490">return</span>&nbsp;<span class="ident" id="2930497">err</span><br>
<span class="lineno">235</span><span class="op" id="2930501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2930504">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="2930573">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="2930591">func</span>&nbsp;<span class="op" id="2930596">(</span><span class="ident" id="2930597">w</span>&nbsp;<span class="op" id="2930599">*</span><span class="ident" id="2930600">Writer</span><span class="op" id="2930606">)</span>&nbsp;<span class="ident" id="2930608">Info</span><span class="op" id="2930612">(</span><span class="ident" id="2930613">m</span>&nbsp;<span class="builtintype" id="2930615">string</span><span class="op" id="2930621">)</span>&nbsp;<span class="op" id="2930623">(</span><span class="ident" id="2930624">err</span>&nbsp;<span class="builtintype" id="2930628">error</span><span class="op" id="2930633">)</span>&nbsp;<span class="op" id="2930635">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930638">_</span><span class="op" id="2930639">,</span>&nbsp;<span class="ident" id="2930641">err</span>&nbsp;<span class="op" id="2930645">=</span>&nbsp;<span class="ident" id="2930647">w</span><span class="op" id="2930648">.</span><span class="ident" id="2930649">writeAndRetry</span><span class="op" id="2930662">(</span><span class="ident" id="2930663">LOG_INFO</span><span class="op" id="2930671">,</span>&nbsp;<span class="ident" id="2930673">m</span><span class="op" id="2930674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930677">return</span>&nbsp;<span class="ident" id="2930684">err</span><br>
<span class="lineno"></span><span class="op" id="2930688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2930691">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="2930762">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="2930780">func</span>&nbsp;<span class="op" id="2930785">(</span><span class="ident" id="2930786">w</span>&nbsp;<span class="op" id="2930788">*</span><span class="ident" id="2930789">Writer</span><span class="op" id="2930795">)</span>&nbsp;<span class="ident" id="2930797">Debug</span><span class="op" id="2930802">(</span><span class="ident" id="2930803">m</span>&nbsp;<span class="builtintype" id="2930805">string</span><span class="op" id="2930811">)</span>&nbsp;<span class="op" id="2930813">(</span><span class="ident" id="2930814">err</span>&nbsp;<span class="builtintype" id="2930818">error</span><span class="op" id="2930823">)</span>&nbsp;<span class="op" id="2930825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930828">_</span><span class="op" id="2930829">,</span>&nbsp;<span class="ident" id="2930831">err</span>&nbsp;<span class="op" id="2930835">=</span>&nbsp;<span class="ident" id="2930837">w</span><span class="op" id="2930838">.</span><span class="ident" id="2930839">writeAndRetry</span><span class="op" id="2930852">(</span><span class="ident" id="2930853">LOG_DEBUG</span><span class="op" id="2930862">,</span>&nbsp;<span class="ident" id="2930864">m</span><span class="op" id="2930865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930868">return</span>&nbsp;<span class="ident" id="2930875">err</span><br>
<span class="lineno"></span><span class="op" id="2930879">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="2930882">func</span>&nbsp;<span class="op" id="2930887">(</span><span class="ident" id="2930888">w</span>&nbsp;<span class="op" id="2930890">*</span><span class="ident" id="2930891">Writer</span><span class="op" id="2930897">)</span>&nbsp;<span class="ident" id="2930899">writeAndRetry</span><span class="op" id="2930912">(</span><span class="ident" id="2930913">p</span>&nbsp;<span class="ident" id="2930915">Priority</span><span class="op" id="2930923">,</span>&nbsp;<span class="ident" id="2930925">s</span>&nbsp;<span class="builtintype" id="2930927">string</span><span class="op" id="2930933">)</span>&nbsp;<span class="op" id="2930935">(</span><span class="builtintype" id="2930936">int</span><span class="op" id="2930939">,</span>&nbsp;<span class="builtintype" id="2930941">error</span><span class="op" id="2930946">)</span>&nbsp;<span class="op" id="2930948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930951">pr</span>&nbsp;<span class="op" id="2930954">:=</span>&nbsp;<span class="op" id="2930957">(</span><span class="ident" id="2930958">w</span><span class="op" id="2930959">.</span><span class="ident" id="2930960">priority</span>&nbsp;<span class="op" id="2930969">&amp;</span>&nbsp;<span class="ident" id="2930971">facilityMask</span><span class="op" id="2930983">)</span>&nbsp;<span class="op" id="2930985">|</span>&nbsp;<span class="op" id="2930987">(</span><span class="ident" id="2930988">p</span>&nbsp;<span class="op" id="2930990">&amp;</span>&nbsp;<span class="ident" id="2930992">severityMask</span><span class="op" id="2931004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931008">w</span><span class="op" id="2931009">.</span><span class="ident" id="2931010">mu</span><span class="op" id="2931012">.</span><span class="ident" id="2931013">Lock</span><span class="op" id="2931017">(</span><span class="op" id="2931018">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931021">defer</span>&nbsp;<span class="ident" id="2931027">w</span><span class="op" id="2931028">.</span><span class="ident" id="2931029">mu</span><span class="op" id="2931031">.</span><span class="ident" id="2931032">Unlock</span><span class="op" id="2931038">(</span><span class="op" id="2931039">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931043">if</span>&nbsp;<span class="ident" id="2931046">w</span><span class="op" id="2931047">.</span><span class="ident" id="2931048">conn</span>&nbsp;<span class="op" id="2931053">!=</span>&nbsp;<span class="ident" id="2931056">nil</span>&nbsp;<span class="op" id="2931060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931064">if</span>&nbsp;<span class="ident" id="2931067">n</span><span class="op" id="2931068">,</span>&nbsp;<span class="ident" id="2931070">err</span>&nbsp;<span class="op" id="2931074">:=</span>&nbsp;<span class="ident" id="2931077">w</span><span class="op" id="2931078">.</span><span class="ident" id="2931079">write</span><span class="op" id="2931084">(</span><span class="ident" id="2931085">pr</span><span class="op" id="2931087">,</span>&nbsp;<span class="ident" id="2931089">s</span><span class="op" id="2931090">)</span><span class="op" id="2931091">;</span>&nbsp;<span class="ident" id="2931093">err</span>&nbsp;<span class="op" id="2931097">==</span>&nbsp;<span class="ident" id="2931100">nil</span>&nbsp;<span class="op" id="2931104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931109">return</span>&nbsp;<span class="ident" id="2931116">n</span><span class="op" id="2931117">,</span>&nbsp;<span class="ident" id="2931119">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931131">if</span>&nbsp;<span class="ident" id="2931134">err</span>&nbsp;<span class="op" id="2931138">:=</span>&nbsp;<span class="ident" id="2931141">w</span><span class="op" id="2931142">.</span><span class="ident" id="2931143">connect</span><span class="op" id="2931150">(</span><span class="op" id="2931151">)</span><span class="op" id="2931152">;</span>&nbsp;<span class="ident" id="2931154">err</span>&nbsp;<span class="op" id="2931158">!=</span>&nbsp;<span class="ident" id="2931161">nil</span>&nbsp;<span class="op" id="2931165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931169">return</span>&nbsp;<span class="num" id="2931176">0</span><span class="op" id="2931177">,</span>&nbsp;<span class="ident" id="2931179">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931184">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931187">return</span>&nbsp;<span class="ident" id="2931194">w</span><span class="op" id="2931195">.</span><span class="ident" id="2931196">write</span><span class="op" id="2931201">(</span><span class="ident" id="2931202">pr</span><span class="op" id="2931204">,</span>&nbsp;<span class="ident" id="2931206">s</span><span class="op" id="2931207">)</span><br>
<span class="lineno"></span><span class="op" id="2931209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2931212">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="2931273">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="2931336">func</span>&nbsp;<span class="op" id="2931341">(</span><span class="ident" id="2931342">w</span>&nbsp;<span class="op" id="2931344">*</span><span class="ident" id="2931345">Writer</span><span class="op" id="2931351">)</span>&nbsp;<span class="ident" id="2931353">write</span><span class="op" id="2931358">(</span><span class="ident" id="2931359">p</span>&nbsp;<span class="ident" id="2931361">Priority</span><span class="op" id="2931369">,</span>&nbsp;<span class="ident" id="2931371">msg</span>&nbsp;<span class="builtintype" id="2931375">string</span><span class="op" id="2931381">)</span>&nbsp;<span class="op" id="2931383">(</span><span class="builtintype" id="2931384">int</span><span class="op" id="2931387">,</span>&nbsp;<span class="builtintype" id="2931389">error</span><span class="op" id="2931394">)</span>&nbsp;<span class="op" id="2931396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931399">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931426">nl</span>&nbsp;<span class="op" id="2931429">:=</span>&nbsp;<span class="string" id="2931432">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931436">if</span>&nbsp;<span class="op" id="2931439">!</span><span class="ident" id="2931440">strings</span><span class="op" id="2931447">.</span><span class="ident" id="2931448">HasSuffix</span><span class="op" id="2931457">(</span><span class="ident" id="2931458">msg</span><span class="op" id="2931461">,</span>&nbsp;<span class="string" id="2931463">&#34;\n&#34;</span><span class="op" id="2931467">)</span>&nbsp;<span class="op" id="2931469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931473">nl</span>&nbsp;<span class="op" id="2931476">=</span>&nbsp;<span class="string" id="2931478">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931488">err</span>&nbsp;<span class="op" id="2931492">:=</span>&nbsp;<span class="ident" id="2931495">w</span><span class="op" id="2931496">.</span><span class="ident" id="2931497">conn</span><span class="op" id="2931501">.</span><span class="ident" id="2931502">writeString</span><span class="op" id="2931513">(</span><span class="ident" id="2931514">p</span><span class="op" id="2931515">,</span>&nbsp;<span class="ident" id="2931517">w</span><span class="op" id="2931518">.</span><span class="ident" id="2931519">hostname</span><span class="op" id="2931527">,</span>&nbsp;<span class="ident" id="2931529">w</span><span class="op" id="2931530">.</span><span class="ident" id="2931531">tag</span><span class="op" id="2931534">,</span>&nbsp;<span class="ident" id="2931536">msg</span><span class="op" id="2931539">,</span>&nbsp;<span class="ident" id="2931541">nl</span><span class="op" id="2931543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931546">if</span>&nbsp;<span class="ident" id="2931549">err</span>&nbsp;<span class="op" id="2931553">!=</span>&nbsp;<span class="ident" id="2931556">nil</span>&nbsp;<span class="op" id="2931560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931564">return</span>&nbsp;<span class="num" id="2931571">0</span><span class="op" id="2931572">,</span>&nbsp;<span class="ident" id="2931574">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931582">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931642">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931702">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931720">return</span>&nbsp;<span class="builtinfunc" id="2931727">len</span><span class="op" id="2931730">(</span><span class="ident" id="2931731">msg</span><span class="op" id="2931734">)</span><span class="op" id="2931735">,</span>&nbsp;<span class="ident" id="2931737">nil</span><br>
<span class="lineno">285</span><span class="op" id="2931741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2931744">func</span>&nbsp;<span class="op" id="2931749">(</span><span class="ident" id="2931750">n</span>&nbsp;<span class="op" id="2931752">*</span><span class="ident" id="2931753">netConn</span><span class="op" id="2931760">)</span>&nbsp;<span class="ident" id="2931762">writeString</span><span class="op" id="2931773">(</span><span class="ident" id="2931774">p</span>&nbsp;<span class="ident" id="2931776">Priority</span><span class="op" id="2931784">,</span>&nbsp;<span class="ident" id="2931786">hostname</span><span class="op" id="2931794">,</span>&nbsp;<span class="ident" id="2931796">tag</span><span class="op" id="2931799">,</span>&nbsp;<span class="ident" id="2931801">msg</span><span class="op" id="2931804">,</span>&nbsp;<span class="ident" id="2931806">nl</span>&nbsp;<span class="builtintype" id="2931809">string</span><span class="op" id="2931815">)</span>&nbsp;<span class="builtintype" id="2931817">error</span>&nbsp;<span class="op" id="2931823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931826">if</span>&nbsp;<span class="ident" id="2931829">n</span><span class="op" id="2931830">.</span><span class="ident" id="2931831">local</span>&nbsp;<span class="op" id="2931837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931841">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931899">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931947">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931997">timestamp</span>&nbsp;<span class="op" id="2932007">:=</span>&nbsp;<span class="ident" id="2932010">time</span><span class="op" id="2932014">.</span><span class="ident" id="2932015">Now</span><span class="op" id="2932018">(</span><span class="op" id="2932019">)</span><span class="op" id="2932020">.</span><span class="ident" id="2932021">Format</span><span class="op" id="2932027">(</span><span class="ident" id="2932028">time</span><span class="op" id="2932032">.</span><span class="ident" id="2932033">Stamp</span><span class="op" id="2932038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932042">_</span><span class="op" id="2932043">,</span>&nbsp;<span class="ident" id="2932045">err</span>&nbsp;<span class="op" id="2932049">:=</span>&nbsp;<span class="ident" id="2932052">fmt</span><span class="op" id="2932055">.</span><span class="ident" id="2932056">Fprintf</span><span class="op" id="2932063">(</span><span class="ident" id="2932064">n</span><span class="op" id="2932065">.</span><span class="ident" id="2932066">conn</span><span class="op" id="2932070">,</span>&nbsp;<span class="string" id="2932072">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="2932093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932098">p</span><span class="op" id="2932099">,</span>&nbsp;<span class="ident" id="2932101">timestamp</span><span class="op" id="2932110">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932115">tag</span><span class="op" id="2932118">,</span>&nbsp;<span class="ident" id="2932120">os</span><span class="op" id="2932122">.</span><span class="ident" id="2932123">Getpid</span><span class="op" id="2932129">(</span><span class="op" id="2932130">)</span><span class="op" id="2932131">,</span>&nbsp;<span class="ident" id="2932133">msg</span><span class="op" id="2932136">,</span>&nbsp;<span class="ident" id="2932138">nl</span><span class="op" id="2932140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932144">return</span>&nbsp;<span class="ident" id="2932151">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932159">timestamp</span>&nbsp;<span class="op" id="2932169">:=</span>&nbsp;<span class="ident" id="2932172">time</span><span class="op" id="2932176">.</span><span class="ident" id="2932177">Now</span><span class="op" id="2932180">(</span><span class="op" id="2932181">)</span><span class="op" id="2932182">.</span><span class="ident" id="2932183">Format</span><span class="op" id="2932189">(</span><span class="ident" id="2932190">time</span><span class="op" id="2932194">.</span><span class="ident" id="2932195">RFC3339</span><span class="op" id="2932202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932205">_</span><span class="op" id="2932206">,</span>&nbsp;<span class="ident" id="2932208">err</span>&nbsp;<span class="op" id="2932212">:=</span>&nbsp;<span class="ident" id="2932215">fmt</span><span class="op" id="2932218">.</span><span class="ident" id="2932219">Fprintf</span><span class="op" id="2932226">(</span><span class="ident" id="2932227">n</span><span class="op" id="2932228">.</span><span class="ident" id="2932229">conn</span><span class="op" id="2932233">,</span>&nbsp;<span class="string" id="2932235">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="2932259">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932263">p</span><span class="op" id="2932264">,</span>&nbsp;<span class="ident" id="2932266">timestamp</span><span class="op" id="2932275">,</span>&nbsp;<span class="ident" id="2932277">hostname</span><span class="op" id="2932285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932289">tag</span><span class="op" id="2932292">,</span>&nbsp;<span class="ident" id="2932294">os</span><span class="op" id="2932296">.</span><span class="ident" id="2932297">Getpid</span><span class="op" id="2932303">(</span><span class="op" id="2932304">)</span><span class="op" id="2932305">,</span>&nbsp;<span class="ident" id="2932307">msg</span><span class="op" id="2932310">,</span>&nbsp;<span class="ident" id="2932312">nl</span><span class="op" id="2932314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932317">return</span>&nbsp;<span class="ident" id="2932324">err</span><br>
<span class="lineno"></span><span class="op" id="2932328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="2932331">func</span>&nbsp;<span class="op" id="2932336">(</span><span class="ident" id="2932337">n</span>&nbsp;<span class="op" id="2932339">*</span><span class="ident" id="2932340">netConn</span><span class="op" id="2932347">)</span>&nbsp;<span class="builtinfunc" id="2932349">close</span><span class="op" id="2932354">(</span><span class="op" id="2932355">)</span>&nbsp;<span class="builtintype" id="2932357">error</span>&nbsp;<span class="op" id="2932363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932366">return</span>&nbsp;<span class="ident" id="2932373">n</span><span class="op" id="2932374">.</span><span class="ident" id="2932375">conn</span><span class="op" id="2932379">.</span><span class="ident" id="2932380">Close</span><span class="op" id="2932385">(</span><span class="op" id="2932386">)</span><br>
<span class="lineno"></span><span class="op" id="2932388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2932391">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="2932452">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="2932519">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="2932583">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="2932598">func</span>&nbsp;<span class="ident" id="2932603">NewLogger</span><span class="op" id="2932612">(</span><span class="ident" id="2932613">p</span>&nbsp;<span class="ident" id="2932615">Priority</span><span class="op" id="2932623">,</span>&nbsp;<span class="ident" id="2932625">logFlag</span>&nbsp;<span class="builtintype" id="2932633">int</span><span class="op" id="2932636">)</span>&nbsp;<span class="op" id="2932638">(</span><span class="op" id="2932639">*</span><span class="ident" id="2932640">log</span><span class="op" id="2932643">.</span><span class="ident" id="2932644">Logger</span><span class="op" id="2932650">,</span>&nbsp;<span class="builtintype" id="2932652">error</span><span class="op" id="2932657">)</span>&nbsp;<span class="op" id="2932659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932662">s</span><span class="op" id="2932663">,</span>&nbsp;<span class="ident" id="2932665">err</span>&nbsp;<span class="op" id="2932669">:=</span>&nbsp;<span class="ident" id="2932672">New</span><span class="op" id="2932675">(</span><span class="ident" id="2932676">p</span><span class="op" id="2932677">,</span>&nbsp;<span class="string" id="2932679">&#34;&#34;</span><span class="op" id="2932681">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932684">if</span>&nbsp;<span class="ident" id="2932687">err</span>&nbsp;<span class="op" id="2932691">!=</span>&nbsp;<span class="ident" id="2932694">nil</span>&nbsp;<span class="op" id="2932698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932702">return</span>&nbsp;<span class="ident" id="2932709">nil</span><span class="op" id="2932712">,</span>&nbsp;<span class="ident" id="2932714">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932722">return</span>&nbsp;<span class="ident" id="2932729">log</span><span class="op" id="2932732">.</span><span class="ident" id="2932733">New</span><span class="op" id="2932736">(</span><span class="ident" id="2932737">s</span><span class="op" id="2932738">,</span>&nbsp;<span class="string" id="2932740">&#34;&#34;</span><span class="op" id="2932742">,</span>&nbsp;<span class="ident" id="2932744">logFlag</span><span class="op" id="2932751">)</span><span class="op" id="2932752">,</span>&nbsp;<span class="ident" id="2932754">nil</span><br>
<span class="lineno"></span><span class="op" id="2932758">}</span>
</div>
</body>
</html>
