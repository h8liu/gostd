<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6072729">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6072784">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6072838">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6072889">package</span>&nbsp;<span class="ident" id="6072897">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6072903">import</span>&nbsp;<span class="op" id="6072910">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6072913">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6072922">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6072932">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6072941">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6072956">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6072961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6072964">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="6073008">func</span>&nbsp;<span class="ident" id="6073013">min</span><span class="op" id="6073016">(</span><span class="ident" id="6073017">x</span><span class="op" id="6073018">,</span>&nbsp;<span class="ident" id="6073020">y</span>&nbsp;<span class="builtintype" id="6073022">int</span><span class="op" id="6073025">)</span>&nbsp;<span class="builtintype" id="6073027">int</span>&nbsp;<span class="op" id="6073031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073034">if</span>&nbsp;<span class="ident" id="6073037">x</span>&nbsp;<span class="op" id="6073039">&lt;</span>&nbsp;<span class="ident" id="6073041">y</span>&nbsp;<span class="op" id="6073043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073047">return</span>&nbsp;<span class="ident" id="6073054">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073057">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073060">return</span>&nbsp;<span class="ident" id="6073067">y</span><br>
<span class="lineno"></span><span class="op" id="6073069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6073072">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="6073151">func</span>&nbsp;<span class="ident" id="6073156">div</span><span class="op" id="6073159">(</span><span class="ident" id="6073160">a</span><span class="op" id="6073161">,</span>&nbsp;<span class="ident" id="6073163">b</span>&nbsp;<span class="builtintype" id="6073165">int32</span><span class="op" id="6073170">)</span>&nbsp;<span class="builtintype" id="6073172">int32</span>&nbsp;<span class="op" id="6073178">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073181">if</span>&nbsp;<span class="ident" id="6073184">a</span>&nbsp;<span class="op" id="6073186">&gt;=</span>&nbsp;<span class="num" id="6073189">0</span>&nbsp;<span class="op" id="6073191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073195">return</span>&nbsp;<span class="op" id="6073202">(</span><span class="ident" id="6073203">a</span>&nbsp;<span class="op" id="6073205">+</span>&nbsp;<span class="op" id="6073207">(</span><span class="ident" id="6073208">b</span>&nbsp;<span class="op" id="6073210">&gt;&gt;</span>&nbsp;<span class="num" id="6073213">1</span><span class="op" id="6073214">)</span><span class="op" id="6073215">)</span>&nbsp;<span class="op" id="6073217">/</span>&nbsp;<span class="ident" id="6073219">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073225">return</span>&nbsp;<span class="op" id="6073232">-</span><span class="op" id="6073233">(</span><span class="op" id="6073234">(</span><span class="op" id="6073235">-</span><span class="ident" id="6073236">a</span>&nbsp;<span class="op" id="6073238">+</span>&nbsp;<span class="op" id="6073240">(</span><span class="ident" id="6073241">b</span>&nbsp;<span class="op" id="6073243">&gt;&gt;</span>&nbsp;<span class="num" id="6073246">1</span><span class="op" id="6073247">)</span><span class="op" id="6073248">)</span>&nbsp;<span class="op" id="6073250">/</span>&nbsp;<span class="ident" id="6073252">b</span><span class="op" id="6073253">)</span><br>
<span class="lineno"></span><span class="op" id="6073255">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="6073258">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="6073323">var</span>&nbsp;<span class="ident" id="6073327">bitCount</span>&nbsp;<span class="op" id="6073336">=</span>&nbsp;<span class="op" id="6073338">[</span><span class="num" id="6073339">256</span><span class="op" id="6073342">]</span><span class="builtintype" id="6073343">byte</span><span class="op" id="6073347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073350">0</span><span class="op" id="6073351">,</span>&nbsp;<span class="num" id="6073353">1</span><span class="op" id="6073354">,</span>&nbsp;<span class="num" id="6073356">2</span><span class="op" id="6073357">,</span>&nbsp;<span class="num" id="6073359">2</span><span class="op" id="6073360">,</span>&nbsp;<span class="num" id="6073362">3</span><span class="op" id="6073363">,</span>&nbsp;<span class="num" id="6073365">3</span><span class="op" id="6073366">,</span>&nbsp;<span class="num" id="6073368">3</span><span class="op" id="6073369">,</span>&nbsp;<span class="num" id="6073371">3</span><span class="op" id="6073372">,</span>&nbsp;<span class="num" id="6073374">4</span><span class="op" id="6073375">,</span>&nbsp;<span class="num" id="6073377">4</span><span class="op" id="6073378">,</span>&nbsp;<span class="num" id="6073380">4</span><span class="op" id="6073381">,</span>&nbsp;<span class="num" id="6073383">4</span><span class="op" id="6073384">,</span>&nbsp;<span class="num" id="6073386">4</span><span class="op" id="6073387">,</span>&nbsp;<span class="num" id="6073389">4</span><span class="op" id="6073390">,</span>&nbsp;<span class="num" id="6073392">4</span><span class="op" id="6073393">,</span>&nbsp;<span class="num" id="6073395">4</span><span class="op" id="6073396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073399">5</span><span class="op" id="6073400">,</span>&nbsp;<span class="num" id="6073402">5</span><span class="op" id="6073403">,</span>&nbsp;<span class="num" id="6073405">5</span><span class="op" id="6073406">,</span>&nbsp;<span class="num" id="6073408">5</span><span class="op" id="6073409">,</span>&nbsp;<span class="num" id="6073411">5</span><span class="op" id="6073412">,</span>&nbsp;<span class="num" id="6073414">5</span><span class="op" id="6073415">,</span>&nbsp;<span class="num" id="6073417">5</span><span class="op" id="6073418">,</span>&nbsp;<span class="num" id="6073420">5</span><span class="op" id="6073421">,</span>&nbsp;<span class="num" id="6073423">5</span><span class="op" id="6073424">,</span>&nbsp;<span class="num" id="6073426">5</span><span class="op" id="6073427">,</span>&nbsp;<span class="num" id="6073429">5</span><span class="op" id="6073430">,</span>&nbsp;<span class="num" id="6073432">5</span><span class="op" id="6073433">,</span>&nbsp;<span class="num" id="6073435">5</span><span class="op" id="6073436">,</span>&nbsp;<span class="num" id="6073438">5</span><span class="op" id="6073439">,</span>&nbsp;<span class="num" id="6073441">5</span><span class="op" id="6073442">,</span>&nbsp;<span class="num" id="6073444">5</span><span class="op" id="6073445">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073448">6</span><span class="op" id="6073449">,</span>&nbsp;<span class="num" id="6073451">6</span><span class="op" id="6073452">,</span>&nbsp;<span class="num" id="6073454">6</span><span class="op" id="6073455">,</span>&nbsp;<span class="num" id="6073457">6</span><span class="op" id="6073458">,</span>&nbsp;<span class="num" id="6073460">6</span><span class="op" id="6073461">,</span>&nbsp;<span class="num" id="6073463">6</span><span class="op" id="6073464">,</span>&nbsp;<span class="num" id="6073466">6</span><span class="op" id="6073467">,</span>&nbsp;<span class="num" id="6073469">6</span><span class="op" id="6073470">,</span>&nbsp;<span class="num" id="6073472">6</span><span class="op" id="6073473">,</span>&nbsp;<span class="num" id="6073475">6</span><span class="op" id="6073476">,</span>&nbsp;<span class="num" id="6073478">6</span><span class="op" id="6073479">,</span>&nbsp;<span class="num" id="6073481">6</span><span class="op" id="6073482">,</span>&nbsp;<span class="num" id="6073484">6</span><span class="op" id="6073485">,</span>&nbsp;<span class="num" id="6073487">6</span><span class="op" id="6073488">,</span>&nbsp;<span class="num" id="6073490">6</span><span class="op" id="6073491">,</span>&nbsp;<span class="num" id="6073493">6</span><span class="op" id="6073494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073497">6</span><span class="op" id="6073498">,</span>&nbsp;<span class="num" id="6073500">6</span><span class="op" id="6073501">,</span>&nbsp;<span class="num" id="6073503">6</span><span class="op" id="6073504">,</span>&nbsp;<span class="num" id="6073506">6</span><span class="op" id="6073507">,</span>&nbsp;<span class="num" id="6073509">6</span><span class="op" id="6073510">,</span>&nbsp;<span class="num" id="6073512">6</span><span class="op" id="6073513">,</span>&nbsp;<span class="num" id="6073515">6</span><span class="op" id="6073516">,</span>&nbsp;<span class="num" id="6073518">6</span><span class="op" id="6073519">,</span>&nbsp;<span class="num" id="6073521">6</span><span class="op" id="6073522">,</span>&nbsp;<span class="num" id="6073524">6</span><span class="op" id="6073525">,</span>&nbsp;<span class="num" id="6073527">6</span><span class="op" id="6073528">,</span>&nbsp;<span class="num" id="6073530">6</span><span class="op" id="6073531">,</span>&nbsp;<span class="num" id="6073533">6</span><span class="op" id="6073534">,</span>&nbsp;<span class="num" id="6073536">6</span><span class="op" id="6073537">,</span>&nbsp;<span class="num" id="6073539">6</span><span class="op" id="6073540">,</span>&nbsp;<span class="num" id="6073542">6</span><span class="op" id="6073543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073546">7</span><span class="op" id="6073547">,</span>&nbsp;<span class="num" id="6073549">7</span><span class="op" id="6073550">,</span>&nbsp;<span class="num" id="6073552">7</span><span class="op" id="6073553">,</span>&nbsp;<span class="num" id="6073555">7</span><span class="op" id="6073556">,</span>&nbsp;<span class="num" id="6073558">7</span><span class="op" id="6073559">,</span>&nbsp;<span class="num" id="6073561">7</span><span class="op" id="6073562">,</span>&nbsp;<span class="num" id="6073564">7</span><span class="op" id="6073565">,</span>&nbsp;<span class="num" id="6073567">7</span><span class="op" id="6073568">,</span>&nbsp;<span class="num" id="6073570">7</span><span class="op" id="6073571">,</span>&nbsp;<span class="num" id="6073573">7</span><span class="op" id="6073574">,</span>&nbsp;<span class="num" id="6073576">7</span><span class="op" id="6073577">,</span>&nbsp;<span class="num" id="6073579">7</span><span class="op" id="6073580">,</span>&nbsp;<span class="num" id="6073582">7</span><span class="op" id="6073583">,</span>&nbsp;<span class="num" id="6073585">7</span><span class="op" id="6073586">,</span>&nbsp;<span class="num" id="6073588">7</span><span class="op" id="6073589">,</span>&nbsp;<span class="num" id="6073591">7</span><span class="op" id="6073592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073595">7</span><span class="op" id="6073596">,</span>&nbsp;<span class="num" id="6073598">7</span><span class="op" id="6073599">,</span>&nbsp;<span class="num" id="6073601">7</span><span class="op" id="6073602">,</span>&nbsp;<span class="num" id="6073604">7</span><span class="op" id="6073605">,</span>&nbsp;<span class="num" id="6073607">7</span><span class="op" id="6073608">,</span>&nbsp;<span class="num" id="6073610">7</span><span class="op" id="6073611">,</span>&nbsp;<span class="num" id="6073613">7</span><span class="op" id="6073614">,</span>&nbsp;<span class="num" id="6073616">7</span><span class="op" id="6073617">,</span>&nbsp;<span class="num" id="6073619">7</span><span class="op" id="6073620">,</span>&nbsp;<span class="num" id="6073622">7</span><span class="op" id="6073623">,</span>&nbsp;<span class="num" id="6073625">7</span><span class="op" id="6073626">,</span>&nbsp;<span class="num" id="6073628">7</span><span class="op" id="6073629">,</span>&nbsp;<span class="num" id="6073631">7</span><span class="op" id="6073632">,</span>&nbsp;<span class="num" id="6073634">7</span><span class="op" id="6073635">,</span>&nbsp;<span class="num" id="6073637">7</span><span class="op" id="6073638">,</span>&nbsp;<span class="num" id="6073640">7</span><span class="op" id="6073641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073644">7</span><span class="op" id="6073645">,</span>&nbsp;<span class="num" id="6073647">7</span><span class="op" id="6073648">,</span>&nbsp;<span class="num" id="6073650">7</span><span class="op" id="6073651">,</span>&nbsp;<span class="num" id="6073653">7</span><span class="op" id="6073654">,</span>&nbsp;<span class="num" id="6073656">7</span><span class="op" id="6073657">,</span>&nbsp;<span class="num" id="6073659">7</span><span class="op" id="6073660">,</span>&nbsp;<span class="num" id="6073662">7</span><span class="op" id="6073663">,</span>&nbsp;<span class="num" id="6073665">7</span><span class="op" id="6073666">,</span>&nbsp;<span class="num" id="6073668">7</span><span class="op" id="6073669">,</span>&nbsp;<span class="num" id="6073671">7</span><span class="op" id="6073672">,</span>&nbsp;<span class="num" id="6073674">7</span><span class="op" id="6073675">,</span>&nbsp;<span class="num" id="6073677">7</span><span class="op" id="6073678">,</span>&nbsp;<span class="num" id="6073680">7</span><span class="op" id="6073681">,</span>&nbsp;<span class="num" id="6073683">7</span><span class="op" id="6073684">,</span>&nbsp;<span class="num" id="6073686">7</span><span class="op" id="6073687">,</span>&nbsp;<span class="num" id="6073689">7</span><span class="op" id="6073690">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073693">7</span><span class="op" id="6073694">,</span>&nbsp;<span class="num" id="6073696">7</span><span class="op" id="6073697">,</span>&nbsp;<span class="num" id="6073699">7</span><span class="op" id="6073700">,</span>&nbsp;<span class="num" id="6073702">7</span><span class="op" id="6073703">,</span>&nbsp;<span class="num" id="6073705">7</span><span class="op" id="6073706">,</span>&nbsp;<span class="num" id="6073708">7</span><span class="op" id="6073709">,</span>&nbsp;<span class="num" id="6073711">7</span><span class="op" id="6073712">,</span>&nbsp;<span class="num" id="6073714">7</span><span class="op" id="6073715">,</span>&nbsp;<span class="num" id="6073717">7</span><span class="op" id="6073718">,</span>&nbsp;<span class="num" id="6073720">7</span><span class="op" id="6073721">,</span>&nbsp;<span class="num" id="6073723">7</span><span class="op" id="6073724">,</span>&nbsp;<span class="num" id="6073726">7</span><span class="op" id="6073727">,</span>&nbsp;<span class="num" id="6073729">7</span><span class="op" id="6073730">,</span>&nbsp;<span class="num" id="6073732">7</span><span class="op" id="6073733">,</span>&nbsp;<span class="num" id="6073735">7</span><span class="op" id="6073736">,</span>&nbsp;<span class="num" id="6073738">7</span><span class="op" id="6073739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073742">8</span><span class="op" id="6073743">,</span>&nbsp;<span class="num" id="6073745">8</span><span class="op" id="6073746">,</span>&nbsp;<span class="num" id="6073748">8</span><span class="op" id="6073749">,</span>&nbsp;<span class="num" id="6073751">8</span><span class="op" id="6073752">,</span>&nbsp;<span class="num" id="6073754">8</span><span class="op" id="6073755">,</span>&nbsp;<span class="num" id="6073757">8</span><span class="op" id="6073758">,</span>&nbsp;<span class="num" id="6073760">8</span><span class="op" id="6073761">,</span>&nbsp;<span class="num" id="6073763">8</span><span class="op" id="6073764">,</span>&nbsp;<span class="num" id="6073766">8</span><span class="op" id="6073767">,</span>&nbsp;<span class="num" id="6073769">8</span><span class="op" id="6073770">,</span>&nbsp;<span class="num" id="6073772">8</span><span class="op" id="6073773">,</span>&nbsp;<span class="num" id="6073775">8</span><span class="op" id="6073776">,</span>&nbsp;<span class="num" id="6073778">8</span><span class="op" id="6073779">,</span>&nbsp;<span class="num" id="6073781">8</span><span class="op" id="6073782">,</span>&nbsp;<span class="num" id="6073784">8</span><span class="op" id="6073785">,</span>&nbsp;<span class="num" id="6073787">8</span><span class="op" id="6073788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073791">8</span><span class="op" id="6073792">,</span>&nbsp;<span class="num" id="6073794">8</span><span class="op" id="6073795">,</span>&nbsp;<span class="num" id="6073797">8</span><span class="op" id="6073798">,</span>&nbsp;<span class="num" id="6073800">8</span><span class="op" id="6073801">,</span>&nbsp;<span class="num" id="6073803">8</span><span class="op" id="6073804">,</span>&nbsp;<span class="num" id="6073806">8</span><span class="op" id="6073807">,</span>&nbsp;<span class="num" id="6073809">8</span><span class="op" id="6073810">,</span>&nbsp;<span class="num" id="6073812">8</span><span class="op" id="6073813">,</span>&nbsp;<span class="num" id="6073815">8</span><span class="op" id="6073816">,</span>&nbsp;<span class="num" id="6073818">8</span><span class="op" id="6073819">,</span>&nbsp;<span class="num" id="6073821">8</span><span class="op" id="6073822">,</span>&nbsp;<span class="num" id="6073824">8</span><span class="op" id="6073825">,</span>&nbsp;<span class="num" id="6073827">8</span><span class="op" id="6073828">,</span>&nbsp;<span class="num" id="6073830">8</span><span class="op" id="6073831">,</span>&nbsp;<span class="num" id="6073833">8</span><span class="op" id="6073834">,</span>&nbsp;<span class="num" id="6073836">8</span><span class="op" id="6073837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073840">8</span><span class="op" id="6073841">,</span>&nbsp;<span class="num" id="6073843">8</span><span class="op" id="6073844">,</span>&nbsp;<span class="num" id="6073846">8</span><span class="op" id="6073847">,</span>&nbsp;<span class="num" id="6073849">8</span><span class="op" id="6073850">,</span>&nbsp;<span class="num" id="6073852">8</span><span class="op" id="6073853">,</span>&nbsp;<span class="num" id="6073855">8</span><span class="op" id="6073856">,</span>&nbsp;<span class="num" id="6073858">8</span><span class="op" id="6073859">,</span>&nbsp;<span class="num" id="6073861">8</span><span class="op" id="6073862">,</span>&nbsp;<span class="num" id="6073864">8</span><span class="op" id="6073865">,</span>&nbsp;<span class="num" id="6073867">8</span><span class="op" id="6073868">,</span>&nbsp;<span class="num" id="6073870">8</span><span class="op" id="6073871">,</span>&nbsp;<span class="num" id="6073873">8</span><span class="op" id="6073874">,</span>&nbsp;<span class="num" id="6073876">8</span><span class="op" id="6073877">,</span>&nbsp;<span class="num" id="6073879">8</span><span class="op" id="6073880">,</span>&nbsp;<span class="num" id="6073882">8</span><span class="op" id="6073883">,</span>&nbsp;<span class="num" id="6073885">8</span><span class="op" id="6073886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073889">8</span><span class="op" id="6073890">,</span>&nbsp;<span class="num" id="6073892">8</span><span class="op" id="6073893">,</span>&nbsp;<span class="num" id="6073895">8</span><span class="op" id="6073896">,</span>&nbsp;<span class="num" id="6073898">8</span><span class="op" id="6073899">,</span>&nbsp;<span class="num" id="6073901">8</span><span class="op" id="6073902">,</span>&nbsp;<span class="num" id="6073904">8</span><span class="op" id="6073905">,</span>&nbsp;<span class="num" id="6073907">8</span><span class="op" id="6073908">,</span>&nbsp;<span class="num" id="6073910">8</span><span class="op" id="6073911">,</span>&nbsp;<span class="num" id="6073913">8</span><span class="op" id="6073914">,</span>&nbsp;<span class="num" id="6073916">8</span><span class="op" id="6073917">,</span>&nbsp;<span class="num" id="6073919">8</span><span class="op" id="6073920">,</span>&nbsp;<span class="num" id="6073922">8</span><span class="op" id="6073923">,</span>&nbsp;<span class="num" id="6073925">8</span><span class="op" id="6073926">,</span>&nbsp;<span class="num" id="6073928">8</span><span class="op" id="6073929">,</span>&nbsp;<span class="num" id="6073931">8</span><span class="op" id="6073932">,</span>&nbsp;<span class="num" id="6073934">8</span><span class="op" id="6073935">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073938">8</span><span class="op" id="6073939">,</span>&nbsp;<span class="num" id="6073941">8</span><span class="op" id="6073942">,</span>&nbsp;<span class="num" id="6073944">8</span><span class="op" id="6073945">,</span>&nbsp;<span class="num" id="6073947">8</span><span class="op" id="6073948">,</span>&nbsp;<span class="num" id="6073950">8</span><span class="op" id="6073951">,</span>&nbsp;<span class="num" id="6073953">8</span><span class="op" id="6073954">,</span>&nbsp;<span class="num" id="6073956">8</span><span class="op" id="6073957">,</span>&nbsp;<span class="num" id="6073959">8</span><span class="op" id="6073960">,</span>&nbsp;<span class="num" id="6073962">8</span><span class="op" id="6073963">,</span>&nbsp;<span class="num" id="6073965">8</span><span class="op" id="6073966">,</span>&nbsp;<span class="num" id="6073968">8</span><span class="op" id="6073969">,</span>&nbsp;<span class="num" id="6073971">8</span><span class="op" id="6073972">,</span>&nbsp;<span class="num" id="6073974">8</span><span class="op" id="6073975">,</span>&nbsp;<span class="num" id="6073977">8</span><span class="op" id="6073978">,</span>&nbsp;<span class="num" id="6073980">8</span><span class="op" id="6073981">,</span>&nbsp;<span class="num" id="6073983">8</span><span class="op" id="6073984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6073987">8</span><span class="op" id="6073988">,</span>&nbsp;<span class="num" id="6073990">8</span><span class="op" id="6073991">,</span>&nbsp;<span class="num" id="6073993">8</span><span class="op" id="6073994">,</span>&nbsp;<span class="num" id="6073996">8</span><span class="op" id="6073997">,</span>&nbsp;<span class="num" id="6073999">8</span><span class="op" id="6074000">,</span>&nbsp;<span class="num" id="6074002">8</span><span class="op" id="6074003">,</span>&nbsp;<span class="num" id="6074005">8</span><span class="op" id="6074006">,</span>&nbsp;<span class="num" id="6074008">8</span><span class="op" id="6074009">,</span>&nbsp;<span class="num" id="6074011">8</span><span class="op" id="6074012">,</span>&nbsp;<span class="num" id="6074014">8</span><span class="op" id="6074015">,</span>&nbsp;<span class="num" id="6074017">8</span><span class="op" id="6074018">,</span>&nbsp;<span class="num" id="6074020">8</span><span class="op" id="6074021">,</span>&nbsp;<span class="num" id="6074023">8</span><span class="op" id="6074024">,</span>&nbsp;<span class="num" id="6074026">8</span><span class="op" id="6074027">,</span>&nbsp;<span class="num" id="6074029">8</span><span class="op" id="6074030">,</span>&nbsp;<span class="num" id="6074032">8</span><span class="op" id="6074033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074036">8</span><span class="op" id="6074037">,</span>&nbsp;<span class="num" id="6074039">8</span><span class="op" id="6074040">,</span>&nbsp;<span class="num" id="6074042">8</span><span class="op" id="6074043">,</span>&nbsp;<span class="num" id="6074045">8</span><span class="op" id="6074046">,</span>&nbsp;<span class="num" id="6074048">8</span><span class="op" id="6074049">,</span>&nbsp;<span class="num" id="6074051">8</span><span class="op" id="6074052">,</span>&nbsp;<span class="num" id="6074054">8</span><span class="op" id="6074055">,</span>&nbsp;<span class="num" id="6074057">8</span><span class="op" id="6074058">,</span>&nbsp;<span class="num" id="6074060">8</span><span class="op" id="6074061">,</span>&nbsp;<span class="num" id="6074063">8</span><span class="op" id="6074064">,</span>&nbsp;<span class="num" id="6074066">8</span><span class="op" id="6074067">,</span>&nbsp;<span class="num" id="6074069">8</span><span class="op" id="6074070">,</span>&nbsp;<span class="num" id="6074072">8</span><span class="op" id="6074073">,</span>&nbsp;<span class="num" id="6074075">8</span><span class="op" id="6074076">,</span>&nbsp;<span class="num" id="6074078">8</span><span class="op" id="6074079">,</span>&nbsp;<span class="num" id="6074081">8</span><span class="op" id="6074082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074085">8</span><span class="op" id="6074086">,</span>&nbsp;<span class="num" id="6074088">8</span><span class="op" id="6074089">,</span>&nbsp;<span class="num" id="6074091">8</span><span class="op" id="6074092">,</span>&nbsp;<span class="num" id="6074094">8</span><span class="op" id="6074095">,</span>&nbsp;<span class="num" id="6074097">8</span><span class="op" id="6074098">,</span>&nbsp;<span class="num" id="6074100">8</span><span class="op" id="6074101">,</span>&nbsp;<span class="num" id="6074103">8</span><span class="op" id="6074104">,</span>&nbsp;<span class="num" id="6074106">8</span><span class="op" id="6074107">,</span>&nbsp;<span class="num" id="6074109">8</span><span class="op" id="6074110">,</span>&nbsp;<span class="num" id="6074112">8</span><span class="op" id="6074113">,</span>&nbsp;<span class="num" id="6074115">8</span><span class="op" id="6074116">,</span>&nbsp;<span class="num" id="6074118">8</span><span class="op" id="6074119">,</span>&nbsp;<span class="num" id="6074121">8</span><span class="op" id="6074122">,</span>&nbsp;<span class="num" id="6074124">8</span><span class="op" id="6074125">,</span>&nbsp;<span class="num" id="6074127">8</span><span class="op" id="6074128">,</span>&nbsp;<span class="num" id="6074130">8</span><span class="op" id="6074131">,</span><br>
<span class="lineno"></span><span class="op" id="6074133">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6074136">type</span>&nbsp;<span class="ident" id="6074141">quantIndex</span>&nbsp;<span class="builtintype" id="6074152">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6074157">const</span>&nbsp;<span class="op" id="6074163">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074166">quantIndexLuminance</span>&nbsp;<span class="ident" id="6074186">quantIndex</span>&nbsp;<span class="op" id="6074197">=</span>&nbsp;<span class="ident" id="6074199">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074205">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074228">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="6074240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6074243">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="6074320">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6074396">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6074472">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="6074490">var</span>&nbsp;<span class="ident" id="6074494">unscaledQuant</span>&nbsp;<span class="op" id="6074508">=</span>&nbsp;<span class="op" id="6074510">[</span><span class="ident" id="6074511">nQuantIndex</span><span class="op" id="6074522">]</span><span class="op" id="6074523">[</span><span class="ident" id="6074524">blockSize</span><span class="op" id="6074533">]</span><span class="builtintype" id="6074534">byte</span><span class="op" id="6074538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6074541">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074560">16</span><span class="op" id="6074562">,</span>&nbsp;<span class="num" id="6074564">11</span><span class="op" id="6074566">,</span>&nbsp;<span class="num" id="6074568">12</span><span class="op" id="6074570">,</span>&nbsp;<span class="num" id="6074572">14</span><span class="op" id="6074574">,</span>&nbsp;<span class="num" id="6074576">12</span><span class="op" id="6074578">,</span>&nbsp;<span class="num" id="6074580">10</span><span class="op" id="6074582">,</span>&nbsp;<span class="num" id="6074584">16</span><span class="op" id="6074586">,</span>&nbsp;<span class="num" id="6074588">14</span><span class="op" id="6074590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074594">13</span><span class="op" id="6074596">,</span>&nbsp;<span class="num" id="6074598">14</span><span class="op" id="6074600">,</span>&nbsp;<span class="num" id="6074602">18</span><span class="op" id="6074604">,</span>&nbsp;<span class="num" id="6074606">17</span><span class="op" id="6074608">,</span>&nbsp;<span class="num" id="6074610">16</span><span class="op" id="6074612">,</span>&nbsp;<span class="num" id="6074614">19</span><span class="op" id="6074616">,</span>&nbsp;<span class="num" id="6074618">24</span><span class="op" id="6074620">,</span>&nbsp;<span class="num" id="6074622">40</span><span class="op" id="6074624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074628">26</span><span class="op" id="6074630">,</span>&nbsp;<span class="num" id="6074632">24</span><span class="op" id="6074634">,</span>&nbsp;<span class="num" id="6074636">22</span><span class="op" id="6074638">,</span>&nbsp;<span class="num" id="6074640">22</span><span class="op" id="6074642">,</span>&nbsp;<span class="num" id="6074644">24</span><span class="op" id="6074646">,</span>&nbsp;<span class="num" id="6074648">49</span><span class="op" id="6074650">,</span>&nbsp;<span class="num" id="6074652">35</span><span class="op" id="6074654">,</span>&nbsp;<span class="num" id="6074656">37</span><span class="op" id="6074658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074662">29</span><span class="op" id="6074664">,</span>&nbsp;<span class="num" id="6074666">40</span><span class="op" id="6074668">,</span>&nbsp;<span class="num" id="6074670">58</span><span class="op" id="6074672">,</span>&nbsp;<span class="num" id="6074674">51</span><span class="op" id="6074676">,</span>&nbsp;<span class="num" id="6074678">61</span><span class="op" id="6074680">,</span>&nbsp;<span class="num" id="6074682">60</span><span class="op" id="6074684">,</span>&nbsp;<span class="num" id="6074686">57</span><span class="op" id="6074688">,</span>&nbsp;<span class="num" id="6074690">51</span><span class="op" id="6074692">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074696">56</span><span class="op" id="6074698">,</span>&nbsp;<span class="num" id="6074700">55</span><span class="op" id="6074702">,</span>&nbsp;<span class="num" id="6074704">64</span><span class="op" id="6074706">,</span>&nbsp;<span class="num" id="6074708">72</span><span class="op" id="6074710">,</span>&nbsp;<span class="num" id="6074712">92</span><span class="op" id="6074714">,</span>&nbsp;<span class="num" id="6074716">78</span><span class="op" id="6074718">,</span>&nbsp;<span class="num" id="6074720">64</span><span class="op" id="6074722">,</span>&nbsp;<span class="num" id="6074724">68</span><span class="op" id="6074726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074730">87</span><span class="op" id="6074732">,</span>&nbsp;<span class="num" id="6074734">69</span><span class="op" id="6074736">,</span>&nbsp;<span class="num" id="6074738">55</span><span class="op" id="6074740">,</span>&nbsp;<span class="num" id="6074742">56</span><span class="op" id="6074744">,</span>&nbsp;<span class="num" id="6074746">80</span><span class="op" id="6074748">,</span>&nbsp;<span class="num" id="6074750">109</span><span class="op" id="6074753">,</span>&nbsp;<span class="num" id="6074755">81</span><span class="op" id="6074757">,</span>&nbsp;<span class="num" id="6074759">87</span><span class="op" id="6074761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074765">95</span><span class="op" id="6074767">,</span>&nbsp;<span class="num" id="6074769">98</span><span class="op" id="6074771">,</span>&nbsp;<span class="num" id="6074773">103</span><span class="op" id="6074776">,</span>&nbsp;<span class="num" id="6074778">104</span><span class="op" id="6074781">,</span>&nbsp;<span class="num" id="6074783">103</span><span class="op" id="6074786">,</span>&nbsp;<span class="num" id="6074788">62</span><span class="op" id="6074790">,</span>&nbsp;<span class="num" id="6074792">77</span><span class="op" id="6074794">,</span>&nbsp;<span class="num" id="6074796">113</span><span class="op" id="6074799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074803">121</span><span class="op" id="6074806">,</span>&nbsp;<span class="num" id="6074808">112</span><span class="op" id="6074811">,</span>&nbsp;<span class="num" id="6074813">100</span><span class="op" id="6074816">,</span>&nbsp;<span class="num" id="6074818">120</span><span class="op" id="6074821">,</span>&nbsp;<span class="num" id="6074823">92</span><span class="op" id="6074825">,</span>&nbsp;<span class="num" id="6074827">101</span><span class="op" id="6074830">,</span>&nbsp;<span class="num" id="6074832">103</span><span class="op" id="6074835">,</span>&nbsp;<span class="num" id="6074837">99</span><span class="op" id="6074839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074842">}</span><span class="op" id="6074843">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6074846">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074867">17</span><span class="op" id="6074869">,</span>&nbsp;<span class="num" id="6074871">18</span><span class="op" id="6074873">,</span>&nbsp;<span class="num" id="6074875">18</span><span class="op" id="6074877">,</span>&nbsp;<span class="num" id="6074879">24</span><span class="op" id="6074881">,</span>&nbsp;<span class="num" id="6074883">21</span><span class="op" id="6074885">,</span>&nbsp;<span class="num" id="6074887">24</span><span class="op" id="6074889">,</span>&nbsp;<span class="num" id="6074891">47</span><span class="op" id="6074893">,</span>&nbsp;<span class="num" id="6074895">26</span><span class="op" id="6074897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074901">26</span><span class="op" id="6074903">,</span>&nbsp;<span class="num" id="6074905">47</span><span class="op" id="6074907">,</span>&nbsp;<span class="num" id="6074909">99</span><span class="op" id="6074911">,</span>&nbsp;<span class="num" id="6074913">66</span><span class="op" id="6074915">,</span>&nbsp;<span class="num" id="6074917">56</span><span class="op" id="6074919">,</span>&nbsp;<span class="num" id="6074921">66</span><span class="op" id="6074923">,</span>&nbsp;<span class="num" id="6074925">99</span><span class="op" id="6074927">,</span>&nbsp;<span class="num" id="6074929">99</span><span class="op" id="6074931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074935">99</span><span class="op" id="6074937">,</span>&nbsp;<span class="num" id="6074939">99</span><span class="op" id="6074941">,</span>&nbsp;<span class="num" id="6074943">99</span><span class="op" id="6074945">,</span>&nbsp;<span class="num" id="6074947">99</span><span class="op" id="6074949">,</span>&nbsp;<span class="num" id="6074951">99</span><span class="op" id="6074953">,</span>&nbsp;<span class="num" id="6074955">99</span><span class="op" id="6074957">,</span>&nbsp;<span class="num" id="6074959">99</span><span class="op" id="6074961">,</span>&nbsp;<span class="num" id="6074963">99</span><span class="op" id="6074965">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6074969">99</span><span class="op" id="6074971">,</span>&nbsp;<span class="num" id="6074973">99</span><span class="op" id="6074975">,</span>&nbsp;<span class="num" id="6074977">99</span><span class="op" id="6074979">,</span>&nbsp;<span class="num" id="6074981">99</span><span class="op" id="6074983">,</span>&nbsp;<span class="num" id="6074985">99</span><span class="op" id="6074987">,</span>&nbsp;<span class="num" id="6074989">99</span><span class="op" id="6074991">,</span>&nbsp;<span class="num" id="6074993">99</span><span class="op" id="6074995">,</span>&nbsp;<span class="num" id="6074997">99</span><span class="op" id="6074999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6075003">99</span><span class="op" id="6075005">,</span>&nbsp;<span class="num" id="6075007">99</span><span class="op" id="6075009">,</span>&nbsp;<span class="num" id="6075011">99</span><span class="op" id="6075013">,</span>&nbsp;<span class="num" id="6075015">99</span><span class="op" id="6075017">,</span>&nbsp;<span class="num" id="6075019">99</span><span class="op" id="6075021">,</span>&nbsp;<span class="num" id="6075023">99</span><span class="op" id="6075025">,</span>&nbsp;<span class="num" id="6075027">99</span><span class="op" id="6075029">,</span>&nbsp;<span class="num" id="6075031">99</span><span class="op" id="6075033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6075037">99</span><span class="op" id="6075039">,</span>&nbsp;<span class="num" id="6075041">99</span><span class="op" id="6075043">,</span>&nbsp;<span class="num" id="6075045">99</span><span class="op" id="6075047">,</span>&nbsp;<span class="num" id="6075049">99</span><span class="op" id="6075051">,</span>&nbsp;<span class="num" id="6075053">99</span><span class="op" id="6075055">,</span>&nbsp;<span class="num" id="6075057">99</span><span class="op" id="6075059">,</span>&nbsp;<span class="num" id="6075061">99</span><span class="op" id="6075063">,</span>&nbsp;<span class="num" id="6075065">99</span><span class="op" id="6075067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6075071">99</span><span class="op" id="6075073">,</span>&nbsp;<span class="num" id="6075075">99</span><span class="op" id="6075077">,</span>&nbsp;<span class="num" id="6075079">99</span><span class="op" id="6075081">,</span>&nbsp;<span class="num" id="6075083">99</span><span class="op" id="6075085">,</span>&nbsp;<span class="num" id="6075087">99</span><span class="op" id="6075089">,</span>&nbsp;<span class="num" id="6075091">99</span><span class="op" id="6075093">,</span>&nbsp;<span class="num" id="6075095">99</span><span class="op" id="6075097">,</span>&nbsp;<span class="num" id="6075099">99</span><span class="op" id="6075101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6075105">99</span><span class="op" id="6075107">,</span>&nbsp;<span class="num" id="6075109">99</span><span class="op" id="6075111">,</span>&nbsp;<span class="num" id="6075113">99</span><span class="op" id="6075115">,</span>&nbsp;<span class="num" id="6075117">99</span><span class="op" id="6075119">,</span>&nbsp;<span class="num" id="6075121">99</span><span class="op" id="6075123">,</span>&nbsp;<span class="num" id="6075125">99</span><span class="op" id="6075127">,</span>&nbsp;<span class="num" id="6075129">99</span><span class="op" id="6075131">,</span>&nbsp;<span class="num" id="6075133">99</span><span class="op" id="6075135">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075138">}</span><span class="op" id="6075139">,</span><br>
<span class="lineno"></span><span class="op" id="6075141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6075144">type</span>&nbsp;<span class="ident" id="6075149">huffIndex</span>&nbsp;<span class="builtintype" id="6075159">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6075164">const</span>&nbsp;<span class="op" id="6075170">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075173">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="6075194">huffIndex</span>&nbsp;<span class="op" id="6075204">=</span>&nbsp;<span class="ident" id="6075206">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075212">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075234">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075258">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075282">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="6075293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6075296">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="6075341">type</span>&nbsp;<span class="ident" id="6075346">huffmanSpec</span>&nbsp;<span class="keyword" id="6075358">struct</span>&nbsp;<span class="op" id="6075365">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6075368">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075422">count</span>&nbsp;<span class="op" id="6075428">[</span><span class="num" id="6075429">16</span><span class="op" id="6075431">]</span><span class="builtintype" id="6075432">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6075438">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075494">value</span>&nbsp;<span class="op" id="6075500">[</span><span class="op" id="6075501">]</span><span class="builtintype" id="6075502">byte</span><br>
<span class="lineno"></span><span class="op" id="6075507">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6075510">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="6075568">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="6075631">var</span>&nbsp;<span class="ident" id="6075635">theHuffmanSpec</span>&nbsp;<span class="op" id="6075650">=</span>&nbsp;<span class="op" id="6075652">[</span><span class="ident" id="6075653">nHuffIndex</span><span class="op" id="6075663">]</span><span class="ident" id="6075664">huffmanSpec</span><span class="op" id="6075675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6075678">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075700">[</span><span class="num" id="6075701">16</span><span class="op" id="6075703">]</span><span class="builtintype" id="6075704">byte</span><span class="op" id="6075708">{</span><span class="num" id="6075709">0</span><span class="op" id="6075710">,</span>&nbsp;<span class="num" id="6075712">1</span><span class="op" id="6075713">,</span>&nbsp;<span class="num" id="6075715">5</span><span class="op" id="6075716">,</span>&nbsp;<span class="num" id="6075718">1</span><span class="op" id="6075719">,</span>&nbsp;<span class="num" id="6075721">1</span><span class="op" id="6075722">,</span>&nbsp;<span class="num" id="6075724">1</span><span class="op" id="6075725">,</span>&nbsp;<span class="num" id="6075727">1</span><span class="op" id="6075728">,</span>&nbsp;<span class="num" id="6075730">1</span><span class="op" id="6075731">,</span>&nbsp;<span class="num" id="6075733">1</span><span class="op" id="6075734">,</span>&nbsp;<span class="num" id="6075736">0</span><span class="op" id="6075737">,</span>&nbsp;<span class="num" id="6075739">0</span><span class="op" id="6075740">,</span>&nbsp;<span class="num" id="6075742">0</span><span class="op" id="6075743">,</span>&nbsp;<span class="num" id="6075745">0</span><span class="op" id="6075746">,</span>&nbsp;<span class="num" id="6075748">0</span><span class="op" id="6075749">,</span>&nbsp;<span class="num" id="6075751">0</span><span class="op" id="6075752">,</span>&nbsp;<span class="num" id="6075754">0</span><span class="op" id="6075755">}</span><span class="op" id="6075756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075760">[</span><span class="op" id="6075761">]</span><span class="builtintype" id="6075762">byte</span><span class="op" id="6075766">{</span><span class="num" id="6075767">0</span><span class="op" id="6075768">,</span>&nbsp;<span class="num" id="6075770">1</span><span class="op" id="6075771">,</span>&nbsp;<span class="num" id="6075773">2</span><span class="op" id="6075774">,</span>&nbsp;<span class="num" id="6075776">3</span><span class="op" id="6075777">,</span>&nbsp;<span class="num" id="6075779">4</span><span class="op" id="6075780">,</span>&nbsp;<span class="num" id="6075782">5</span><span class="op" id="6075783">,</span>&nbsp;<span class="num" id="6075785">6</span><span class="op" id="6075786">,</span>&nbsp;<span class="num" id="6075788">7</span><span class="op" id="6075789">,</span>&nbsp;<span class="num" id="6075791">8</span><span class="op" id="6075792">,</span>&nbsp;<span class="num" id="6075794">9</span><span class="op" id="6075795">,</span>&nbsp;<span class="num" id="6075797">10</span><span class="op" id="6075799">,</span>&nbsp;<span class="num" id="6075801">11</span><span class="op" id="6075803">}</span><span class="op" id="6075804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075807">}</span><span class="op" id="6075808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6075811">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075833">[</span><span class="num" id="6075834">16</span><span class="op" id="6075836">]</span><span class="builtintype" id="6075837">byte</span><span class="op" id="6075841">{</span><span class="num" id="6075842">0</span><span class="op" id="6075843">,</span>&nbsp;<span class="num" id="6075845">2</span><span class="op" id="6075846">,</span>&nbsp;<span class="num" id="6075848">1</span><span class="op" id="6075849">,</span>&nbsp;<span class="num" id="6075851">3</span><span class="op" id="6075852">,</span>&nbsp;<span class="num" id="6075854">3</span><span class="op" id="6075855">,</span>&nbsp;<span class="num" id="6075857">2</span><span class="op" id="6075858">,</span>&nbsp;<span class="num" id="6075860">4</span><span class="op" id="6075861">,</span>&nbsp;<span class="num" id="6075863">3</span><span class="op" id="6075864">,</span>&nbsp;<span class="num" id="6075866">5</span><span class="op" id="6075867">,</span>&nbsp;<span class="num" id="6075869">5</span><span class="op" id="6075870">,</span>&nbsp;<span class="num" id="6075872">4</span><span class="op" id="6075873">,</span>&nbsp;<span class="num" id="6075875">4</span><span class="op" id="6075876">,</span>&nbsp;<span class="num" id="6075878">0</span><span class="op" id="6075879">,</span>&nbsp;<span class="num" id="6075881">0</span><span class="op" id="6075882">,</span>&nbsp;<span class="num" id="6075884">1</span><span class="op" id="6075885">,</span>&nbsp;<span class="num" id="6075887">125</span><span class="op" id="6075890">}</span><span class="op" id="6075891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075895">[</span><span class="op" id="6075896">]</span><span class="builtintype" id="6075897">byte</span><span class="op" id="6075901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6075906">0x01</span><span class="op" id="6075910">,</span>&nbsp;<span class="num" id="6075912">0x02</span><span class="op" id="6075916">,</span>&nbsp;<span class="num" id="6075918">0x03</span><span class="op" id="6075922">,</span>&nbsp;<span class="num" id="6075924">0x00</span><span class="op" id="6075928">,</span>&nbsp;<span class="num" id="6075930">0x04</span><span class="op" id="6075934">,</span>&nbsp;<span class="num" id="6075936">0x11</span><span class="op" id="6075940">,</span>&nbsp;<span class="num" id="6075942">0x05</span><span class="op" id="6075946">,</span>&nbsp;<span class="num" id="6075948">0x12</span><span class="op" id="6075952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6075957">0x21</span><span class="op" id="6075961">,</span>&nbsp;<span class="num" id="6075963">0x31</span><span class="op" id="6075967">,</span>&nbsp;<span class="num" id="6075969">0x41</span><span class="op" id="6075973">,</span>&nbsp;<span class="num" id="6075975">0x06</span><span class="op" id="6075979">,</span>&nbsp;<span class="num" id="6075981">0x13</span><span class="op" id="6075985">,</span>&nbsp;<span class="num" id="6075987">0x51</span><span class="op" id="6075991">,</span>&nbsp;<span class="num" id="6075993">0x61</span><span class="op" id="6075997">,</span>&nbsp;<span class="num" id="6075999">0x07</span><span class="op" id="6076003">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076008">0x22</span><span class="op" id="6076012">,</span>&nbsp;<span class="num" id="6076014">0x71</span><span class="op" id="6076018">,</span>&nbsp;<span class="num" id="6076020">0x14</span><span class="op" id="6076024">,</span>&nbsp;<span class="num" id="6076026">0x32</span><span class="op" id="6076030">,</span>&nbsp;<span class="num" id="6076032">0x81</span><span class="op" id="6076036">,</span>&nbsp;<span class="num" id="6076038">0x91</span><span class="op" id="6076042">,</span>&nbsp;<span class="num" id="6076044">0xa1</span><span class="op" id="6076048">,</span>&nbsp;<span class="num" id="6076050">0x08</span><span class="op" id="6076054">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076059">0x23</span><span class="op" id="6076063">,</span>&nbsp;<span class="num" id="6076065">0x42</span><span class="op" id="6076069">,</span>&nbsp;<span class="num" id="6076071">0xb1</span><span class="op" id="6076075">,</span>&nbsp;<span class="num" id="6076077">0xc1</span><span class="op" id="6076081">,</span>&nbsp;<span class="num" id="6076083">0x15</span><span class="op" id="6076087">,</span>&nbsp;<span class="num" id="6076089">0x52</span><span class="op" id="6076093">,</span>&nbsp;<span class="num" id="6076095">0xd1</span><span class="op" id="6076099">,</span>&nbsp;<span class="num" id="6076101">0xf0</span><span class="op" id="6076105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076110">0x24</span><span class="op" id="6076114">,</span>&nbsp;<span class="num" id="6076116">0x33</span><span class="op" id="6076120">,</span>&nbsp;<span class="num" id="6076122">0x62</span><span class="op" id="6076126">,</span>&nbsp;<span class="num" id="6076128">0x72</span><span class="op" id="6076132">,</span>&nbsp;<span class="num" id="6076134">0x82</span><span class="op" id="6076138">,</span>&nbsp;<span class="num" id="6076140">0x09</span><span class="op" id="6076144">,</span>&nbsp;<span class="num" id="6076146">0x0a</span><span class="op" id="6076150">,</span>&nbsp;<span class="num" id="6076152">0x16</span><span class="op" id="6076156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076161">0x17</span><span class="op" id="6076165">,</span>&nbsp;<span class="num" id="6076167">0x18</span><span class="op" id="6076171">,</span>&nbsp;<span class="num" id="6076173">0x19</span><span class="op" id="6076177">,</span>&nbsp;<span class="num" id="6076179">0x1a</span><span class="op" id="6076183">,</span>&nbsp;<span class="num" id="6076185">0x25</span><span class="op" id="6076189">,</span>&nbsp;<span class="num" id="6076191">0x26</span><span class="op" id="6076195">,</span>&nbsp;<span class="num" id="6076197">0x27</span><span class="op" id="6076201">,</span>&nbsp;<span class="num" id="6076203">0x28</span><span class="op" id="6076207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076212">0x29</span><span class="op" id="6076216">,</span>&nbsp;<span class="num" id="6076218">0x2a</span><span class="op" id="6076222">,</span>&nbsp;<span class="num" id="6076224">0x34</span><span class="op" id="6076228">,</span>&nbsp;<span class="num" id="6076230">0x35</span><span class="op" id="6076234">,</span>&nbsp;<span class="num" id="6076236">0x36</span><span class="op" id="6076240">,</span>&nbsp;<span class="num" id="6076242">0x37</span><span class="op" id="6076246">,</span>&nbsp;<span class="num" id="6076248">0x38</span><span class="op" id="6076252">,</span>&nbsp;<span class="num" id="6076254">0x39</span><span class="op" id="6076258">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076263">0x3a</span><span class="op" id="6076267">,</span>&nbsp;<span class="num" id="6076269">0x43</span><span class="op" id="6076273">,</span>&nbsp;<span class="num" id="6076275">0x44</span><span class="op" id="6076279">,</span>&nbsp;<span class="num" id="6076281">0x45</span><span class="op" id="6076285">,</span>&nbsp;<span class="num" id="6076287">0x46</span><span class="op" id="6076291">,</span>&nbsp;<span class="num" id="6076293">0x47</span><span class="op" id="6076297">,</span>&nbsp;<span class="num" id="6076299">0x48</span><span class="op" id="6076303">,</span>&nbsp;<span class="num" id="6076305">0x49</span><span class="op" id="6076309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076314">0x4a</span><span class="op" id="6076318">,</span>&nbsp;<span class="num" id="6076320">0x53</span><span class="op" id="6076324">,</span>&nbsp;<span class="num" id="6076326">0x54</span><span class="op" id="6076330">,</span>&nbsp;<span class="num" id="6076332">0x55</span><span class="op" id="6076336">,</span>&nbsp;<span class="num" id="6076338">0x56</span><span class="op" id="6076342">,</span>&nbsp;<span class="num" id="6076344">0x57</span><span class="op" id="6076348">,</span>&nbsp;<span class="num" id="6076350">0x58</span><span class="op" id="6076354">,</span>&nbsp;<span class="num" id="6076356">0x59</span><span class="op" id="6076360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076365">0x5a</span><span class="op" id="6076369">,</span>&nbsp;<span class="num" id="6076371">0x63</span><span class="op" id="6076375">,</span>&nbsp;<span class="num" id="6076377">0x64</span><span class="op" id="6076381">,</span>&nbsp;<span class="num" id="6076383">0x65</span><span class="op" id="6076387">,</span>&nbsp;<span class="num" id="6076389">0x66</span><span class="op" id="6076393">,</span>&nbsp;<span class="num" id="6076395">0x67</span><span class="op" id="6076399">,</span>&nbsp;<span class="num" id="6076401">0x68</span><span class="op" id="6076405">,</span>&nbsp;<span class="num" id="6076407">0x69</span><span class="op" id="6076411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076416">0x6a</span><span class="op" id="6076420">,</span>&nbsp;<span class="num" id="6076422">0x73</span><span class="op" id="6076426">,</span>&nbsp;<span class="num" id="6076428">0x74</span><span class="op" id="6076432">,</span>&nbsp;<span class="num" id="6076434">0x75</span><span class="op" id="6076438">,</span>&nbsp;<span class="num" id="6076440">0x76</span><span class="op" id="6076444">,</span>&nbsp;<span class="num" id="6076446">0x77</span><span class="op" id="6076450">,</span>&nbsp;<span class="num" id="6076452">0x78</span><span class="op" id="6076456">,</span>&nbsp;<span class="num" id="6076458">0x79</span><span class="op" id="6076462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076467">0x7a</span><span class="op" id="6076471">,</span>&nbsp;<span class="num" id="6076473">0x83</span><span class="op" id="6076477">,</span>&nbsp;<span class="num" id="6076479">0x84</span><span class="op" id="6076483">,</span>&nbsp;<span class="num" id="6076485">0x85</span><span class="op" id="6076489">,</span>&nbsp;<span class="num" id="6076491">0x86</span><span class="op" id="6076495">,</span>&nbsp;<span class="num" id="6076497">0x87</span><span class="op" id="6076501">,</span>&nbsp;<span class="num" id="6076503">0x88</span><span class="op" id="6076507">,</span>&nbsp;<span class="num" id="6076509">0x89</span><span class="op" id="6076513">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076518">0x8a</span><span class="op" id="6076522">,</span>&nbsp;<span class="num" id="6076524">0x92</span><span class="op" id="6076528">,</span>&nbsp;<span class="num" id="6076530">0x93</span><span class="op" id="6076534">,</span>&nbsp;<span class="num" id="6076536">0x94</span><span class="op" id="6076540">,</span>&nbsp;<span class="num" id="6076542">0x95</span><span class="op" id="6076546">,</span>&nbsp;<span class="num" id="6076548">0x96</span><span class="op" id="6076552">,</span>&nbsp;<span class="num" id="6076554">0x97</span><span class="op" id="6076558">,</span>&nbsp;<span class="num" id="6076560">0x98</span><span class="op" id="6076564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076569">0x99</span><span class="op" id="6076573">,</span>&nbsp;<span class="num" id="6076575">0x9a</span><span class="op" id="6076579">,</span>&nbsp;<span class="num" id="6076581">0xa2</span><span class="op" id="6076585">,</span>&nbsp;<span class="num" id="6076587">0xa3</span><span class="op" id="6076591">,</span>&nbsp;<span class="num" id="6076593">0xa4</span><span class="op" id="6076597">,</span>&nbsp;<span class="num" id="6076599">0xa5</span><span class="op" id="6076603">,</span>&nbsp;<span class="num" id="6076605">0xa6</span><span class="op" id="6076609">,</span>&nbsp;<span class="num" id="6076611">0xa7</span><span class="op" id="6076615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076620">0xa8</span><span class="op" id="6076624">,</span>&nbsp;<span class="num" id="6076626">0xa9</span><span class="op" id="6076630">,</span>&nbsp;<span class="num" id="6076632">0xaa</span><span class="op" id="6076636">,</span>&nbsp;<span class="num" id="6076638">0xb2</span><span class="op" id="6076642">,</span>&nbsp;<span class="num" id="6076644">0xb3</span><span class="op" id="6076648">,</span>&nbsp;<span class="num" id="6076650">0xb4</span><span class="op" id="6076654">,</span>&nbsp;<span class="num" id="6076656">0xb5</span><span class="op" id="6076660">,</span>&nbsp;<span class="num" id="6076662">0xb6</span><span class="op" id="6076666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076671">0xb7</span><span class="op" id="6076675">,</span>&nbsp;<span class="num" id="6076677">0xb8</span><span class="op" id="6076681">,</span>&nbsp;<span class="num" id="6076683">0xb9</span><span class="op" id="6076687">,</span>&nbsp;<span class="num" id="6076689">0xba</span><span class="op" id="6076693">,</span>&nbsp;<span class="num" id="6076695">0xc2</span><span class="op" id="6076699">,</span>&nbsp;<span class="num" id="6076701">0xc3</span><span class="op" id="6076705">,</span>&nbsp;<span class="num" id="6076707">0xc4</span><span class="op" id="6076711">,</span>&nbsp;<span class="num" id="6076713">0xc5</span><span class="op" id="6076717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076722">0xc6</span><span class="op" id="6076726">,</span>&nbsp;<span class="num" id="6076728">0xc7</span><span class="op" id="6076732">,</span>&nbsp;<span class="num" id="6076734">0xc8</span><span class="op" id="6076738">,</span>&nbsp;<span class="num" id="6076740">0xc9</span><span class="op" id="6076744">,</span>&nbsp;<span class="num" id="6076746">0xca</span><span class="op" id="6076750">,</span>&nbsp;<span class="num" id="6076752">0xd2</span><span class="op" id="6076756">,</span>&nbsp;<span class="num" id="6076758">0xd3</span><span class="op" id="6076762">,</span>&nbsp;<span class="num" id="6076764">0xd4</span><span class="op" id="6076768">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076773">0xd5</span><span class="op" id="6076777">,</span>&nbsp;<span class="num" id="6076779">0xd6</span><span class="op" id="6076783">,</span>&nbsp;<span class="num" id="6076785">0xd7</span><span class="op" id="6076789">,</span>&nbsp;<span class="num" id="6076791">0xd8</span><span class="op" id="6076795">,</span>&nbsp;<span class="num" id="6076797">0xd9</span><span class="op" id="6076801">,</span>&nbsp;<span class="num" id="6076803">0xda</span><span class="op" id="6076807">,</span>&nbsp;<span class="num" id="6076809">0xe1</span><span class="op" id="6076813">,</span>&nbsp;<span class="num" id="6076815">0xe2</span><span class="op" id="6076819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076824">0xe3</span><span class="op" id="6076828">,</span>&nbsp;<span class="num" id="6076830">0xe4</span><span class="op" id="6076834">,</span>&nbsp;<span class="num" id="6076836">0xe5</span><span class="op" id="6076840">,</span>&nbsp;<span class="num" id="6076842">0xe6</span><span class="op" id="6076846">,</span>&nbsp;<span class="num" id="6076848">0xe7</span><span class="op" id="6076852">,</span>&nbsp;<span class="num" id="6076854">0xe8</span><span class="op" id="6076858">,</span>&nbsp;<span class="num" id="6076860">0xe9</span><span class="op" id="6076864">,</span>&nbsp;<span class="num" id="6076866">0xea</span><span class="op" id="6076870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076875">0xf1</span><span class="op" id="6076879">,</span>&nbsp;<span class="num" id="6076881">0xf2</span><span class="op" id="6076885">,</span>&nbsp;<span class="num" id="6076887">0xf3</span><span class="op" id="6076891">,</span>&nbsp;<span class="num" id="6076893">0xf4</span><span class="op" id="6076897">,</span>&nbsp;<span class="num" id="6076899">0xf5</span><span class="op" id="6076903">,</span>&nbsp;<span class="num" id="6076905">0xf6</span><span class="op" id="6076909">,</span>&nbsp;<span class="num" id="6076911">0xf7</span><span class="op" id="6076915">,</span>&nbsp;<span class="num" id="6076917">0xf8</span><span class="op" id="6076921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6076926">0xf9</span><span class="op" id="6076930">,</span>&nbsp;<span class="num" id="6076932">0xfa</span><span class="op" id="6076936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076940">}</span><span class="op" id="6076941">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076944">}</span><span class="op" id="6076945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6076948">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076972">[</span><span class="num" id="6076973">16</span><span class="op" id="6076975">]</span><span class="builtintype" id="6076976">byte</span><span class="op" id="6076980">{</span><span class="num" id="6076981">0</span><span class="op" id="6076982">,</span>&nbsp;<span class="num" id="6076984">3</span><span class="op" id="6076985">,</span>&nbsp;<span class="num" id="6076987">1</span><span class="op" id="6076988">,</span>&nbsp;<span class="num" id="6076990">1</span><span class="op" id="6076991">,</span>&nbsp;<span class="num" id="6076993">1</span><span class="op" id="6076994">,</span>&nbsp;<span class="num" id="6076996">1</span><span class="op" id="6076997">,</span>&nbsp;<span class="num" id="6076999">1</span><span class="op" id="6077000">,</span>&nbsp;<span class="num" id="6077002">1</span><span class="op" id="6077003">,</span>&nbsp;<span class="num" id="6077005">1</span><span class="op" id="6077006">,</span>&nbsp;<span class="num" id="6077008">1</span><span class="op" id="6077009">,</span>&nbsp;<span class="num" id="6077011">1</span><span class="op" id="6077012">,</span>&nbsp;<span class="num" id="6077014">0</span><span class="op" id="6077015">,</span>&nbsp;<span class="num" id="6077017">0</span><span class="op" id="6077018">,</span>&nbsp;<span class="num" id="6077020">0</span><span class="op" id="6077021">,</span>&nbsp;<span class="num" id="6077023">0</span><span class="op" id="6077024">,</span>&nbsp;<span class="num" id="6077026">0</span><span class="op" id="6077027">}</span><span class="op" id="6077028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077032">[</span><span class="op" id="6077033">]</span><span class="builtintype" id="6077034">byte</span><span class="op" id="6077038">{</span><span class="num" id="6077039">0</span><span class="op" id="6077040">,</span>&nbsp;<span class="num" id="6077042">1</span><span class="op" id="6077043">,</span>&nbsp;<span class="num" id="6077045">2</span><span class="op" id="6077046">,</span>&nbsp;<span class="num" id="6077048">3</span><span class="op" id="6077049">,</span>&nbsp;<span class="num" id="6077051">4</span><span class="op" id="6077052">,</span>&nbsp;<span class="num" id="6077054">5</span><span class="op" id="6077055">,</span>&nbsp;<span class="num" id="6077057">6</span><span class="op" id="6077058">,</span>&nbsp;<span class="num" id="6077060">7</span><span class="op" id="6077061">,</span>&nbsp;<span class="num" id="6077063">8</span><span class="op" id="6077064">,</span>&nbsp;<span class="num" id="6077066">9</span><span class="op" id="6077067">,</span>&nbsp;<span class="num" id="6077069">10</span><span class="op" id="6077071">,</span>&nbsp;<span class="num" id="6077073">11</span><span class="op" id="6077075">}</span><span class="op" id="6077076">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077079">}</span><span class="op" id="6077080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077083">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077107">[</span><span class="num" id="6077108">16</span><span class="op" id="6077110">]</span><span class="builtintype" id="6077111">byte</span><span class="op" id="6077115">{</span><span class="num" id="6077116">0</span><span class="op" id="6077117">,</span>&nbsp;<span class="num" id="6077119">2</span><span class="op" id="6077120">,</span>&nbsp;<span class="num" id="6077122">1</span><span class="op" id="6077123">,</span>&nbsp;<span class="num" id="6077125">2</span><span class="op" id="6077126">,</span>&nbsp;<span class="num" id="6077128">4</span><span class="op" id="6077129">,</span>&nbsp;<span class="num" id="6077131">4</span><span class="op" id="6077132">,</span>&nbsp;<span class="num" id="6077134">3</span><span class="op" id="6077135">,</span>&nbsp;<span class="num" id="6077137">4</span><span class="op" id="6077138">,</span>&nbsp;<span class="num" id="6077140">7</span><span class="op" id="6077141">,</span>&nbsp;<span class="num" id="6077143">5</span><span class="op" id="6077144">,</span>&nbsp;<span class="num" id="6077146">4</span><span class="op" id="6077147">,</span>&nbsp;<span class="num" id="6077149">4</span><span class="op" id="6077150">,</span>&nbsp;<span class="num" id="6077152">0</span><span class="op" id="6077153">,</span>&nbsp;<span class="num" id="6077155">1</span><span class="op" id="6077156">,</span>&nbsp;<span class="num" id="6077158">2</span><span class="op" id="6077159">,</span>&nbsp;<span class="num" id="6077161">119</span><span class="op" id="6077164">}</span><span class="op" id="6077165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077169">[</span><span class="op" id="6077170">]</span><span class="builtintype" id="6077171">byte</span><span class="op" id="6077175">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077180">0x00</span><span class="op" id="6077184">,</span>&nbsp;<span class="num" id="6077186">0x01</span><span class="op" id="6077190">,</span>&nbsp;<span class="num" id="6077192">0x02</span><span class="op" id="6077196">,</span>&nbsp;<span class="num" id="6077198">0x03</span><span class="op" id="6077202">,</span>&nbsp;<span class="num" id="6077204">0x11</span><span class="op" id="6077208">,</span>&nbsp;<span class="num" id="6077210">0x04</span><span class="op" id="6077214">,</span>&nbsp;<span class="num" id="6077216">0x05</span><span class="op" id="6077220">,</span>&nbsp;<span class="num" id="6077222">0x21</span><span class="op" id="6077226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077231">0x31</span><span class="op" id="6077235">,</span>&nbsp;<span class="num" id="6077237">0x06</span><span class="op" id="6077241">,</span>&nbsp;<span class="num" id="6077243">0x12</span><span class="op" id="6077247">,</span>&nbsp;<span class="num" id="6077249">0x41</span><span class="op" id="6077253">,</span>&nbsp;<span class="num" id="6077255">0x51</span><span class="op" id="6077259">,</span>&nbsp;<span class="num" id="6077261">0x07</span><span class="op" id="6077265">,</span>&nbsp;<span class="num" id="6077267">0x61</span><span class="op" id="6077271">,</span>&nbsp;<span class="num" id="6077273">0x71</span><span class="op" id="6077277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077282">0x13</span><span class="op" id="6077286">,</span>&nbsp;<span class="num" id="6077288">0x22</span><span class="op" id="6077292">,</span>&nbsp;<span class="num" id="6077294">0x32</span><span class="op" id="6077298">,</span>&nbsp;<span class="num" id="6077300">0x81</span><span class="op" id="6077304">,</span>&nbsp;<span class="num" id="6077306">0x08</span><span class="op" id="6077310">,</span>&nbsp;<span class="num" id="6077312">0x14</span><span class="op" id="6077316">,</span>&nbsp;<span class="num" id="6077318">0x42</span><span class="op" id="6077322">,</span>&nbsp;<span class="num" id="6077324">0x91</span><span class="op" id="6077328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077333">0xa1</span><span class="op" id="6077337">,</span>&nbsp;<span class="num" id="6077339">0xb1</span><span class="op" id="6077343">,</span>&nbsp;<span class="num" id="6077345">0xc1</span><span class="op" id="6077349">,</span>&nbsp;<span class="num" id="6077351">0x09</span><span class="op" id="6077355">,</span>&nbsp;<span class="num" id="6077357">0x23</span><span class="op" id="6077361">,</span>&nbsp;<span class="num" id="6077363">0x33</span><span class="op" id="6077367">,</span>&nbsp;<span class="num" id="6077369">0x52</span><span class="op" id="6077373">,</span>&nbsp;<span class="num" id="6077375">0xf0</span><span class="op" id="6077379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077384">0x15</span><span class="op" id="6077388">,</span>&nbsp;<span class="num" id="6077390">0x62</span><span class="op" id="6077394">,</span>&nbsp;<span class="num" id="6077396">0x72</span><span class="op" id="6077400">,</span>&nbsp;<span class="num" id="6077402">0xd1</span><span class="op" id="6077406">,</span>&nbsp;<span class="num" id="6077408">0x0a</span><span class="op" id="6077412">,</span>&nbsp;<span class="num" id="6077414">0x16</span><span class="op" id="6077418">,</span>&nbsp;<span class="num" id="6077420">0x24</span><span class="op" id="6077424">,</span>&nbsp;<span class="num" id="6077426">0x34</span><span class="op" id="6077430">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077435">0xe1</span><span class="op" id="6077439">,</span>&nbsp;<span class="num" id="6077441">0x25</span><span class="op" id="6077445">,</span>&nbsp;<span class="num" id="6077447">0xf1</span><span class="op" id="6077451">,</span>&nbsp;<span class="num" id="6077453">0x17</span><span class="op" id="6077457">,</span>&nbsp;<span class="num" id="6077459">0x18</span><span class="op" id="6077463">,</span>&nbsp;<span class="num" id="6077465">0x19</span><span class="op" id="6077469">,</span>&nbsp;<span class="num" id="6077471">0x1a</span><span class="op" id="6077475">,</span>&nbsp;<span class="num" id="6077477">0x26</span><span class="op" id="6077481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077486">0x27</span><span class="op" id="6077490">,</span>&nbsp;<span class="num" id="6077492">0x28</span><span class="op" id="6077496">,</span>&nbsp;<span class="num" id="6077498">0x29</span><span class="op" id="6077502">,</span>&nbsp;<span class="num" id="6077504">0x2a</span><span class="op" id="6077508">,</span>&nbsp;<span class="num" id="6077510">0x35</span><span class="op" id="6077514">,</span>&nbsp;<span class="num" id="6077516">0x36</span><span class="op" id="6077520">,</span>&nbsp;<span class="num" id="6077522">0x37</span><span class="op" id="6077526">,</span>&nbsp;<span class="num" id="6077528">0x38</span><span class="op" id="6077532">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077537">0x39</span><span class="op" id="6077541">,</span>&nbsp;<span class="num" id="6077543">0x3a</span><span class="op" id="6077547">,</span>&nbsp;<span class="num" id="6077549">0x43</span><span class="op" id="6077553">,</span>&nbsp;<span class="num" id="6077555">0x44</span><span class="op" id="6077559">,</span>&nbsp;<span class="num" id="6077561">0x45</span><span class="op" id="6077565">,</span>&nbsp;<span class="num" id="6077567">0x46</span><span class="op" id="6077571">,</span>&nbsp;<span class="num" id="6077573">0x47</span><span class="op" id="6077577">,</span>&nbsp;<span class="num" id="6077579">0x48</span><span class="op" id="6077583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077588">0x49</span><span class="op" id="6077592">,</span>&nbsp;<span class="num" id="6077594">0x4a</span><span class="op" id="6077598">,</span>&nbsp;<span class="num" id="6077600">0x53</span><span class="op" id="6077604">,</span>&nbsp;<span class="num" id="6077606">0x54</span><span class="op" id="6077610">,</span>&nbsp;<span class="num" id="6077612">0x55</span><span class="op" id="6077616">,</span>&nbsp;<span class="num" id="6077618">0x56</span><span class="op" id="6077622">,</span>&nbsp;<span class="num" id="6077624">0x57</span><span class="op" id="6077628">,</span>&nbsp;<span class="num" id="6077630">0x58</span><span class="op" id="6077634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077639">0x59</span><span class="op" id="6077643">,</span>&nbsp;<span class="num" id="6077645">0x5a</span><span class="op" id="6077649">,</span>&nbsp;<span class="num" id="6077651">0x63</span><span class="op" id="6077655">,</span>&nbsp;<span class="num" id="6077657">0x64</span><span class="op" id="6077661">,</span>&nbsp;<span class="num" id="6077663">0x65</span><span class="op" id="6077667">,</span>&nbsp;<span class="num" id="6077669">0x66</span><span class="op" id="6077673">,</span>&nbsp;<span class="num" id="6077675">0x67</span><span class="op" id="6077679">,</span>&nbsp;<span class="num" id="6077681">0x68</span><span class="op" id="6077685">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077690">0x69</span><span class="op" id="6077694">,</span>&nbsp;<span class="num" id="6077696">0x6a</span><span class="op" id="6077700">,</span>&nbsp;<span class="num" id="6077702">0x73</span><span class="op" id="6077706">,</span>&nbsp;<span class="num" id="6077708">0x74</span><span class="op" id="6077712">,</span>&nbsp;<span class="num" id="6077714">0x75</span><span class="op" id="6077718">,</span>&nbsp;<span class="num" id="6077720">0x76</span><span class="op" id="6077724">,</span>&nbsp;<span class="num" id="6077726">0x77</span><span class="op" id="6077730">,</span>&nbsp;<span class="num" id="6077732">0x78</span><span class="op" id="6077736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077741">0x79</span><span class="op" id="6077745">,</span>&nbsp;<span class="num" id="6077747">0x7a</span><span class="op" id="6077751">,</span>&nbsp;<span class="num" id="6077753">0x82</span><span class="op" id="6077757">,</span>&nbsp;<span class="num" id="6077759">0x83</span><span class="op" id="6077763">,</span>&nbsp;<span class="num" id="6077765">0x84</span><span class="op" id="6077769">,</span>&nbsp;<span class="num" id="6077771">0x85</span><span class="op" id="6077775">,</span>&nbsp;<span class="num" id="6077777">0x86</span><span class="op" id="6077781">,</span>&nbsp;<span class="num" id="6077783">0x87</span><span class="op" id="6077787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077792">0x88</span><span class="op" id="6077796">,</span>&nbsp;<span class="num" id="6077798">0x89</span><span class="op" id="6077802">,</span>&nbsp;<span class="num" id="6077804">0x8a</span><span class="op" id="6077808">,</span>&nbsp;<span class="num" id="6077810">0x92</span><span class="op" id="6077814">,</span>&nbsp;<span class="num" id="6077816">0x93</span><span class="op" id="6077820">,</span>&nbsp;<span class="num" id="6077822">0x94</span><span class="op" id="6077826">,</span>&nbsp;<span class="num" id="6077828">0x95</span><span class="op" id="6077832">,</span>&nbsp;<span class="num" id="6077834">0x96</span><span class="op" id="6077838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077843">0x97</span><span class="op" id="6077847">,</span>&nbsp;<span class="num" id="6077849">0x98</span><span class="op" id="6077853">,</span>&nbsp;<span class="num" id="6077855">0x99</span><span class="op" id="6077859">,</span>&nbsp;<span class="num" id="6077861">0x9a</span><span class="op" id="6077865">,</span>&nbsp;<span class="num" id="6077867">0xa2</span><span class="op" id="6077871">,</span>&nbsp;<span class="num" id="6077873">0xa3</span><span class="op" id="6077877">,</span>&nbsp;<span class="num" id="6077879">0xa4</span><span class="op" id="6077883">,</span>&nbsp;<span class="num" id="6077885">0xa5</span><span class="op" id="6077889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077894">0xa6</span><span class="op" id="6077898">,</span>&nbsp;<span class="num" id="6077900">0xa7</span><span class="op" id="6077904">,</span>&nbsp;<span class="num" id="6077906">0xa8</span><span class="op" id="6077910">,</span>&nbsp;<span class="num" id="6077912">0xa9</span><span class="op" id="6077916">,</span>&nbsp;<span class="num" id="6077918">0xaa</span><span class="op" id="6077922">,</span>&nbsp;<span class="num" id="6077924">0xb2</span><span class="op" id="6077928">,</span>&nbsp;<span class="num" id="6077930">0xb3</span><span class="op" id="6077934">,</span>&nbsp;<span class="num" id="6077936">0xb4</span><span class="op" id="6077940">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077945">0xb5</span><span class="op" id="6077949">,</span>&nbsp;<span class="num" id="6077951">0xb6</span><span class="op" id="6077955">,</span>&nbsp;<span class="num" id="6077957">0xb7</span><span class="op" id="6077961">,</span>&nbsp;<span class="num" id="6077963">0xb8</span><span class="op" id="6077967">,</span>&nbsp;<span class="num" id="6077969">0xb9</span><span class="op" id="6077973">,</span>&nbsp;<span class="num" id="6077975">0xba</span><span class="op" id="6077979">,</span>&nbsp;<span class="num" id="6077981">0xc2</span><span class="op" id="6077985">,</span>&nbsp;<span class="num" id="6077987">0xc3</span><span class="op" id="6077991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6077996">0xc4</span><span class="op" id="6078000">,</span>&nbsp;<span class="num" id="6078002">0xc5</span><span class="op" id="6078006">,</span>&nbsp;<span class="num" id="6078008">0xc6</span><span class="op" id="6078012">,</span>&nbsp;<span class="num" id="6078014">0xc7</span><span class="op" id="6078018">,</span>&nbsp;<span class="num" id="6078020">0xc8</span><span class="op" id="6078024">,</span>&nbsp;<span class="num" id="6078026">0xc9</span><span class="op" id="6078030">,</span>&nbsp;<span class="num" id="6078032">0xca</span><span class="op" id="6078036">,</span>&nbsp;<span class="num" id="6078038">0xd2</span><span class="op" id="6078042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078047">0xd3</span><span class="op" id="6078051">,</span>&nbsp;<span class="num" id="6078053">0xd4</span><span class="op" id="6078057">,</span>&nbsp;<span class="num" id="6078059">0xd5</span><span class="op" id="6078063">,</span>&nbsp;<span class="num" id="6078065">0xd6</span><span class="op" id="6078069">,</span>&nbsp;<span class="num" id="6078071">0xd7</span><span class="op" id="6078075">,</span>&nbsp;<span class="num" id="6078077">0xd8</span><span class="op" id="6078081">,</span>&nbsp;<span class="num" id="6078083">0xd9</span><span class="op" id="6078087">,</span>&nbsp;<span class="num" id="6078089">0xda</span><span class="op" id="6078093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078098">0xe2</span><span class="op" id="6078102">,</span>&nbsp;<span class="num" id="6078104">0xe3</span><span class="op" id="6078108">,</span>&nbsp;<span class="num" id="6078110">0xe4</span><span class="op" id="6078114">,</span>&nbsp;<span class="num" id="6078116">0xe5</span><span class="op" id="6078120">,</span>&nbsp;<span class="num" id="6078122">0xe6</span><span class="op" id="6078126">,</span>&nbsp;<span class="num" id="6078128">0xe7</span><span class="op" id="6078132">,</span>&nbsp;<span class="num" id="6078134">0xe8</span><span class="op" id="6078138">,</span>&nbsp;<span class="num" id="6078140">0xe9</span><span class="op" id="6078144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078149">0xea</span><span class="op" id="6078153">,</span>&nbsp;<span class="num" id="6078155">0xf2</span><span class="op" id="6078159">,</span>&nbsp;<span class="num" id="6078161">0xf3</span><span class="op" id="6078165">,</span>&nbsp;<span class="num" id="6078167">0xf4</span><span class="op" id="6078171">,</span>&nbsp;<span class="num" id="6078173">0xf5</span><span class="op" id="6078177">,</span>&nbsp;<span class="num" id="6078179">0xf6</span><span class="op" id="6078183">,</span>&nbsp;<span class="num" id="6078185">0xf7</span><span class="op" id="6078189">,</span>&nbsp;<span class="num" id="6078191">0xf8</span><span class="op" id="6078195">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6078200">0xf9</span><span class="op" id="6078204">,</span>&nbsp;<span class="num" id="6078206">0xfa</span><span class="op" id="6078210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078214">}</span><span class="op" id="6078215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078218">}</span><span class="op" id="6078219">,</span><br>
<span class="lineno"></span><span class="op" id="6078221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6078224">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="6078299">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6078376">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="6078454">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="6078495">type</span>&nbsp;<span class="ident" id="6078500">huffmanLUT</span>&nbsp;<span class="op" id="6078511">[</span><span class="op" id="6078512">]</span><span class="builtintype" id="6078513">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="6078521">func</span>&nbsp;<span class="op" id="6078526">(</span><span class="ident" id="6078527">h</span>&nbsp;<span class="op" id="6078529">*</span><span class="ident" id="6078530">huffmanLUT</span><span class="op" id="6078540">)</span>&nbsp;<span class="ident" id="6078542">init</span><span class="op" id="6078546">(</span><span class="ident" id="6078547">s</span>&nbsp;<span class="ident" id="6078549">huffmanSpec</span><span class="op" id="6078560">)</span>&nbsp;<span class="op" id="6078562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078565">maxValue</span>&nbsp;<span class="op" id="6078574">:=</span>&nbsp;<span class="num" id="6078577">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078580">for</span>&nbsp;<span class="ident" id="6078584">_</span><span class="op" id="6078585">,</span>&nbsp;<span class="ident" id="6078587">v</span>&nbsp;<span class="op" id="6078589">:=</span>&nbsp;<span class="keyword" id="6078592">range</span>&nbsp;<span class="ident" id="6078598">s</span><span class="op" id="6078599">.</span><span class="ident" id="6078600">value</span>&nbsp;<span class="op" id="6078606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078610">if</span>&nbsp;<span class="builtintype" id="6078613">int</span><span class="op" id="6078616">(</span><span class="ident" id="6078617">v</span><span class="op" id="6078618">)</span>&nbsp;<span class="op" id="6078620">&gt;</span>&nbsp;<span class="ident" id="6078622">maxValue</span>&nbsp;<span class="op" id="6078631">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078636">maxValue</span>&nbsp;<span class="op" id="6078645">=</span>&nbsp;<span class="builtintype" id="6078647">int</span><span class="op" id="6078650">(</span><span class="ident" id="6078651">v</span><span class="op" id="6078652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078662">*</span><span class="ident" id="6078663">h</span>&nbsp;<span class="op" id="6078665">=</span>&nbsp;<span class="builtinfunc" id="6078667">make</span><span class="op" id="6078671">(</span><span class="op" id="6078672">[</span><span class="op" id="6078673">]</span><span class="builtintype" id="6078674">uint32</span><span class="op" id="6078680">,</span>&nbsp;<span class="ident" id="6078682">maxValue</span><span class="op" id="6078690">+</span><span class="num" id="6078691">1</span><span class="op" id="6078692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078695">code</span><span class="op" id="6078699">,</span>&nbsp;<span class="ident" id="6078701">k</span>&nbsp;<span class="op" id="6078703">:=</span>&nbsp;<span class="builtintype" id="6078706">uint32</span><span class="op" id="6078712">(</span><span class="num" id="6078713">0</span><span class="op" id="6078714">)</span><span class="op" id="6078715">,</span>&nbsp;<span class="num" id="6078717">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078720">for</span>&nbsp;<span class="ident" id="6078724">i</span>&nbsp;<span class="op" id="6078726">:=</span>&nbsp;<span class="num" id="6078729">0</span><span class="op" id="6078730">;</span>&nbsp;<span class="ident" id="6078732">i</span>&nbsp;<span class="op" id="6078734">&lt;</span>&nbsp;<span class="builtinfunc" id="6078736">len</span><span class="op" id="6078739">(</span><span class="ident" id="6078740">s</span><span class="op" id="6078741">.</span><span class="ident" id="6078742">count</span><span class="op" id="6078747">)</span><span class="op" id="6078748">;</span>&nbsp;<span class="ident" id="6078750">i</span><span class="op" id="6078751">++</span>&nbsp;<span class="op" id="6078754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078758">nBits</span>&nbsp;<span class="op" id="6078764">:=</span>&nbsp;<span class="builtintype" id="6078767">uint32</span><span class="op" id="6078773">(</span><span class="ident" id="6078774">i</span><span class="op" id="6078775">+</span><span class="num" id="6078776">1</span><span class="op" id="6078777">)</span>&nbsp;<span class="op" id="6078779">&lt;&lt;</span>&nbsp;<span class="num" id="6078782">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078787">for</span>&nbsp;<span class="ident" id="6078791">j</span>&nbsp;<span class="op" id="6078793">:=</span>&nbsp;<span class="builtintype" id="6078796">uint8</span><span class="op" id="6078801">(</span><span class="num" id="6078802">0</span><span class="op" id="6078803">)</span><span class="op" id="6078804">;</span>&nbsp;<span class="ident" id="6078806">j</span>&nbsp;<span class="op" id="6078808">&lt;</span>&nbsp;<span class="ident" id="6078810">s</span><span class="op" id="6078811">.</span><span class="ident" id="6078812">count</span><span class="op" id="6078817">[</span><span class="ident" id="6078818">i</span><span class="op" id="6078819">]</span><span class="op" id="6078820">;</span>&nbsp;<span class="ident" id="6078822">j</span><span class="op" id="6078823">++</span>&nbsp;<span class="op" id="6078826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078831">(</span><span class="op" id="6078832">*</span><span class="ident" id="6078833">h</span><span class="op" id="6078834">)</span><span class="op" id="6078835">[</span><span class="ident" id="6078836">s</span><span class="op" id="6078837">.</span><span class="ident" id="6078838">value</span><span class="op" id="6078843">[</span><span class="ident" id="6078844">k</span><span class="op" id="6078845">]</span><span class="op" id="6078846">]</span>&nbsp;<span class="op" id="6078848">=</span>&nbsp;<span class="ident" id="6078850">nBits</span>&nbsp;<span class="op" id="6078856">|</span>&nbsp;<span class="ident" id="6078858">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078866">code</span><span class="op" id="6078870">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078876">k</span><span class="op" id="6078877">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078886">code</span>&nbsp;<span class="op" id="6078891">&lt;&lt;=</span>&nbsp;<span class="num" id="6078895">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078898">}</span><br>
<span class="lineno"></span><span class="op" id="6078900">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="6078903">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="6078968">var</span>&nbsp;<span class="ident" id="6078972">theHuffmanLUT</span>&nbsp;<span class="op" id="6078986">[</span><span class="num" id="6078987">4</span><span class="op" id="6078988">]</span><span class="ident" id="6078989">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6079001">func</span>&nbsp;<span class="ident" id="6079006">init</span><span class="op" id="6079010">(</span><span class="op" id="6079011">)</span>&nbsp;<span class="op" id="6079013">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6079016">for</span>&nbsp;<span class="ident" id="6079020">i</span><span class="op" id="6079021">,</span>&nbsp;<span class="ident" id="6079023">s</span>&nbsp;<span class="op" id="6079025">:=</span>&nbsp;<span class="keyword" id="6079028">range</span>&nbsp;<span class="ident" id="6079034">theHuffmanSpec</span>&nbsp;<span class="op" id="6079049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079053">theHuffmanLUT</span><span class="op" id="6079066">[</span><span class="ident" id="6079067">i</span><span class="op" id="6079068">]</span><span class="op" id="6079069">.</span><span class="ident" id="6079070">init</span><span class="op" id="6079074">(</span><span class="ident" id="6079075">s</span><span class="op" id="6079076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079079">}</span><br>
<span class="lineno"></span><span class="op" id="6079081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="6079084">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6079116">type</span>&nbsp;<span class="ident" id="6079121">writer</span>&nbsp;<span class="keyword" id="6079128">interface</span>&nbsp;<span class="op" id="6079138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079141">Flush</span><span class="op" id="6079146">(</span><span class="op" id="6079147">)</span>&nbsp;<span class="builtintype" id="6079149">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079156">io</span><span class="op" id="6079158">.</span><span class="ident" id="6079159">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079167">io</span><span class="op" id="6079169">.</span><span class="ident" id="6079170">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="6079181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6079184">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6079232">type</span>&nbsp;<span class="ident" id="6079237">encoder</span>&nbsp;<span class="keyword" id="6079245">struct</span>&nbsp;<span class="op" id="6079252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079255">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079330">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079401">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6079405">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079413">err</span>&nbsp;<span class="builtintype" id="6079417">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079424">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079453">buf</span>&nbsp;<span class="op" id="6079457">[</span><span class="num" id="6079458">16</span><span class="op" id="6079460">]</span><span class="builtintype" id="6079461">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079467">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079522">bits</span><span class="op" id="6079526">,</span>&nbsp;<span class="ident" id="6079528">nBits</span>&nbsp;<span class="builtintype" id="6079534">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079542">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079605">quant</span>&nbsp;<span class="op" id="6079611">[</span><span class="ident" id="6079612">nQuantIndex</span><span class="op" id="6079623">]</span><span class="op" id="6079624">[</span><span class="ident" id="6079625">blockSize</span><span class="op" id="6079634">]</span><span class="builtintype" id="6079635">byte</span><br>
<span class="lineno"></span><span class="op" id="6079640">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="6079643">func</span>&nbsp;<span class="op" id="6079648">(</span><span class="ident" id="6079649">e</span>&nbsp;<span class="op" id="6079651">*</span><span class="ident" id="6079652">encoder</span><span class="op" id="6079659">)</span>&nbsp;<span class="ident" id="6079661">flush</span><span class="op" id="6079666">(</span><span class="op" id="6079667">)</span>&nbsp;<span class="op" id="6079669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6079672">if</span>&nbsp;<span class="ident" id="6079675">e</span><span class="op" id="6079676">.</span><span class="ident" id="6079677">err</span>&nbsp;<span class="op" id="6079681">!=</span>&nbsp;<span class="ident" id="6079684">nil</span>&nbsp;<span class="op" id="6079688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6079692">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079700">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079703">e</span><span class="op" id="6079704">.</span><span class="ident" id="6079705">err</span>&nbsp;<span class="op" id="6079709">=</span>&nbsp;<span class="ident" id="6079711">e</span><span class="op" id="6079712">.</span><span class="ident" id="6079713">w</span><span class="op" id="6079714">.</span><span class="ident" id="6079715">Flush</span><span class="op" id="6079720">(</span><span class="op" id="6079721">)</span><br>
<span class="lineno"></span><span class="op" id="6079723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6079726">func</span>&nbsp;<span class="op" id="6079731">(</span><span class="ident" id="6079732">e</span>&nbsp;<span class="op" id="6079734">*</span><span class="ident" id="6079735">encoder</span><span class="op" id="6079742">)</span>&nbsp;<span class="ident" id="6079744">write</span><span class="op" id="6079749">(</span><span class="ident" id="6079750">p</span>&nbsp;<span class="op" id="6079752">[</span><span class="op" id="6079753">]</span><span class="builtintype" id="6079754">byte</span><span class="op" id="6079758">)</span>&nbsp;<span class="op" id="6079760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6079763">if</span>&nbsp;<span class="ident" id="6079766">e</span><span class="op" id="6079767">.</span><span class="ident" id="6079768">err</span>&nbsp;<span class="op" id="6079772">!=</span>&nbsp;<span class="ident" id="6079775">nil</span>&nbsp;<span class="op" id="6079779">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6079783">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079794">_</span><span class="op" id="6079795">,</span>&nbsp;<span class="ident" id="6079797">e</span><span class="op" id="6079798">.</span><span class="ident" id="6079799">err</span>&nbsp;<span class="op" id="6079803">=</span>&nbsp;<span class="ident" id="6079805">e</span><span class="op" id="6079806">.</span><span class="ident" id="6079807">w</span><span class="op" id="6079808">.</span><span class="ident" id="6079809">Write</span><span class="op" id="6079814">(</span><span class="ident" id="6079815">p</span><span class="op" id="6079816">)</span><br>
<span class="lineno"></span><span class="op" id="6079818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="6079821">func</span>&nbsp;<span class="op" id="6079826">(</span><span class="ident" id="6079827">e</span>&nbsp;<span class="op" id="6079829">*</span><span class="ident" id="6079830">encoder</span><span class="op" id="6079837">)</span>&nbsp;<span class="ident" id="6079839">writeByte</span><span class="op" id="6079848">(</span><span class="ident" id="6079849">b</span>&nbsp;<span class="builtintype" id="6079851">byte</span><span class="op" id="6079855">)</span>&nbsp;<span class="op" id="6079857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6079860">if</span>&nbsp;<span class="ident" id="6079863">e</span><span class="op" id="6079864">.</span><span class="ident" id="6079865">err</span>&nbsp;<span class="op" id="6079869">!=</span>&nbsp;<span class="ident" id="6079872">nil</span>&nbsp;<span class="op" id="6079876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6079880">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079891">e</span><span class="op" id="6079892">.</span><span class="ident" id="6079893">err</span>&nbsp;<span class="op" id="6079897">=</span>&nbsp;<span class="ident" id="6079899">e</span><span class="op" id="6079900">.</span><span class="ident" id="6079901">w</span><span class="op" id="6079902">.</span><span class="ident" id="6079903">WriteByte</span><span class="op" id="6079912">(</span><span class="ident" id="6079913">b</span><span class="op" id="6079914">)</span><br>
<span class="lineno">250</span><span class="op" id="6079916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6079919">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="6079993">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="6080048">func</span>&nbsp;<span class="op" id="6080053">(</span><span class="ident" id="6080054">e</span>&nbsp;<span class="op" id="6080056">*</span><span class="ident" id="6080057">encoder</span><span class="op" id="6080064">)</span>&nbsp;<span class="ident" id="6080066">emit</span><span class="op" id="6080070">(</span><span class="ident" id="6080071">bits</span><span class="op" id="6080075">,</span>&nbsp;<span class="ident" id="6080077">nBits</span>&nbsp;<span class="builtintype" id="6080083">uint32</span><span class="op" id="6080089">)</span>&nbsp;<span class="op" id="6080091">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080094">nBits</span>&nbsp;<span class="op" id="6080100">+=</span>&nbsp;<span class="ident" id="6080103">e</span><span class="op" id="6080104">.</span><span class="ident" id="6080105">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080112">bits</span>&nbsp;<span class="op" id="6080117">&lt;&lt;=</span>&nbsp;<span class="num" id="6080121">32</span>&nbsp;<span class="op" id="6080124">-</span>&nbsp;<span class="ident" id="6080126">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080133">bits</span>&nbsp;<span class="op" id="6080138">|=</span>&nbsp;<span class="ident" id="6080141">e</span><span class="op" id="6080142">.</span><span class="ident" id="6080143">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6080149">for</span>&nbsp;<span class="ident" id="6080153">nBits</span>&nbsp;<span class="op" id="6080159">&gt;=</span>&nbsp;<span class="num" id="6080162">8</span>&nbsp;<span class="op" id="6080164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080168">b</span>&nbsp;<span class="op" id="6080170">:=</span>&nbsp;<span class="builtintype" id="6080173">uint8</span><span class="op" id="6080178">(</span><span class="ident" id="6080179">bits</span>&nbsp;<span class="op" id="6080184">&gt;&gt;</span>&nbsp;<span class="num" id="6080187">24</span><span class="op" id="6080189">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080193">e</span><span class="op" id="6080194">.</span><span class="ident" id="6080195">writeByte</span><span class="op" id="6080204">(</span><span class="ident" id="6080205">b</span><span class="op" id="6080206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6080210">if</span>&nbsp;<span class="ident" id="6080213">b</span>&nbsp;<span class="op" id="6080215">==</span>&nbsp;<span class="num" id="6080218">0xff</span>&nbsp;<span class="op" id="6080223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080228">e</span><span class="op" id="6080229">.</span><span class="ident" id="6080230">writeByte</span><span class="op" id="6080239">(</span><span class="num" id="6080240">0x00</span><span class="op" id="6080244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6080248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080252">bits</span>&nbsp;<span class="op" id="6080257">&lt;&lt;=</span>&nbsp;<span class="num" id="6080261">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080265">nBits</span>&nbsp;<span class="op" id="6080271">-=</span>&nbsp;<span class="num" id="6080274">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6080277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080280">e</span><span class="op" id="6080281">.</span><span class="ident" id="6080282">bits</span><span class="op" id="6080286">,</span>&nbsp;<span class="ident" id="6080288">e</span><span class="op" id="6080289">.</span><span class="ident" id="6080290">nBits</span>&nbsp;<span class="op" id="6080296">=</span>&nbsp;<span class="ident" id="6080298">bits</span><span class="op" id="6080302">,</span>&nbsp;<span class="ident" id="6080304">nBits</span><br>
<span class="lineno"></span><span class="op" id="6080310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6080313">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6080379">func</span>&nbsp;<span class="op" id="6080384">(</span><span class="ident" id="6080385">e</span>&nbsp;<span class="op" id="6080387">*</span><span class="ident" id="6080388">encoder</span><span class="op" id="6080395">)</span>&nbsp;<span class="ident" id="6080397">emitHuff</span><span class="op" id="6080405">(</span><span class="ident" id="6080406">h</span>&nbsp;<span class="ident" id="6080408">huffIndex</span><span class="op" id="6080417">,</span>&nbsp;<span class="ident" id="6080419">value</span>&nbsp;<span class="builtintype" id="6080425">int32</span><span class="op" id="6080430">)</span>&nbsp;<span class="op" id="6080432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080435">x</span>&nbsp;<span class="op" id="6080437">:=</span>&nbsp;<span class="ident" id="6080440">theHuffmanLUT</span><span class="op" id="6080453">[</span><span class="ident" id="6080454">h</span><span class="op" id="6080455">]</span><span class="op" id="6080456">[</span><span class="ident" id="6080457">value</span><span class="op" id="6080462">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080465">e</span><span class="op" id="6080466">.</span><span class="ident" id="6080467">emit</span><span class="op" id="6080471">(</span><span class="ident" id="6080472">x</span><span class="op" id="6080473">&amp;</span><span class="op" id="6080474">(</span><span class="num" id="6080475">1</span><span class="op" id="6080476">&lt;&lt;</span><span class="num" id="6080478">24</span><span class="op" id="6080480">-</span><span class="num" id="6080481">1</span><span class="op" id="6080482">)</span><span class="op" id="6080483">,</span>&nbsp;<span class="ident" id="6080485">x</span><span class="op" id="6080486">&gt;&gt;</span><span class="num" id="6080488">24</span><span class="op" id="6080490">)</span><br>
<span class="lineno"></span><span class="op" id="6080492">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6080495">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6080574">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6080594">func</span>&nbsp;<span class="op" id="6080599">(</span><span class="ident" id="6080600">e</span>&nbsp;<span class="op" id="6080602">*</span><span class="ident" id="6080603">encoder</span><span class="op" id="6080610">)</span>&nbsp;<span class="ident" id="6080612">emitHuffRLE</span><span class="op" id="6080623">(</span><span class="ident" id="6080624">h</span>&nbsp;<span class="ident" id="6080626">huffIndex</span><span class="op" id="6080635">,</span>&nbsp;<span class="ident" id="6080637">runLength</span><span class="op" id="6080646">,</span>&nbsp;<span class="ident" id="6080648">value</span>&nbsp;<span class="builtintype" id="6080654">int32</span><span class="op" id="6080659">)</span>&nbsp;<span class="op" id="6080661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080664">a</span><span class="op" id="6080665">,</span>&nbsp;<span class="ident" id="6080667">b</span>&nbsp;<span class="op" id="6080669">:=</span>&nbsp;<span class="ident" id="6080672">value</span><span class="op" id="6080677">,</span>&nbsp;<span class="ident" id="6080679">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6080686">if</span>&nbsp;<span class="ident" id="6080689">a</span>&nbsp;<span class="op" id="6080691">&lt;</span>&nbsp;<span class="num" id="6080693">0</span>&nbsp;<span class="op" id="6080695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080699">a</span><span class="op" id="6080700">,</span>&nbsp;<span class="ident" id="6080702">b</span>&nbsp;<span class="op" id="6080704">=</span>&nbsp;<span class="op" id="6080706">-</span><span class="ident" id="6080707">value</span><span class="op" id="6080712">,</span>&nbsp;<span class="ident" id="6080714">value</span><span class="op" id="6080719">-</span><span class="num" id="6080720">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6080723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6080726">var</span>&nbsp;<span class="ident" id="6080730">nBits</span>&nbsp;<span class="builtintype" id="6080736">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6080744">if</span>&nbsp;<span class="ident" id="6080747">a</span>&nbsp;<span class="op" id="6080749">&lt;</span>&nbsp;<span class="num" id="6080751">0x100</span>&nbsp;<span class="op" id="6080757">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080761">nBits</span>&nbsp;<span class="op" id="6080767">=</span>&nbsp;<span class="builtintype" id="6080769">uint32</span><span class="op" id="6080775">(</span><span class="ident" id="6080776">bitCount</span><span class="op" id="6080784">[</span><span class="ident" id="6080785">a</span><span class="op" id="6080786">]</span><span class="op" id="6080787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6080790">}</span>&nbsp;<span class="keyword" id="6080792">else</span>&nbsp;<span class="op" id="6080797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080801">nBits</span>&nbsp;<span class="op" id="6080807">=</span>&nbsp;<span class="num" id="6080809">8</span>&nbsp;<span class="op" id="6080811">+</span>&nbsp;<span class="builtintype" id="6080813">uint32</span><span class="op" id="6080819">(</span><span class="ident" id="6080820">bitCount</span><span class="op" id="6080828">[</span><span class="ident" id="6080829">a</span><span class="op" id="6080830">&gt;&gt;</span><span class="num" id="6080832">8</span><span class="op" id="6080833">]</span><span class="op" id="6080834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6080837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080840">e</span><span class="op" id="6080841">.</span><span class="ident" id="6080842">emitHuff</span><span class="op" id="6080850">(</span><span class="ident" id="6080851">h</span><span class="op" id="6080852">,</span>&nbsp;<span class="ident" id="6080854">runLength</span><span class="op" id="6080863">&lt;&lt;</span><span class="num" id="6080865">4</span><span class="op" id="6080866">|</span><span class="builtintype" id="6080867">int32</span><span class="op" id="6080872">(</span><span class="ident" id="6080873">nBits</span><span class="op" id="6080878">)</span><span class="op" id="6080879">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6080882">if</span>&nbsp;<span class="ident" id="6080885">nBits</span>&nbsp;<span class="op" id="6080891">&gt;</span>&nbsp;<span class="num" id="6080893">0</span>&nbsp;<span class="op" id="6080895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080899">e</span><span class="op" id="6080900">.</span><span class="ident" id="6080901">emit</span><span class="op" id="6080905">(</span><span class="builtintype" id="6080906">uint32</span><span class="op" id="6080912">(</span><span class="ident" id="6080913">b</span><span class="op" id="6080914">)</span><span class="op" id="6080915">&amp;</span><span class="op" id="6080916">(</span><span class="num" id="6080917">1</span><span class="op" id="6080918">&lt;&lt;</span><span class="ident" id="6080920">nBits</span><span class="op" id="6080925">-</span><span class="num" id="6080926">1</span><span class="op" id="6080927">)</span><span class="op" id="6080928">,</span>&nbsp;<span class="ident" id="6080930">nBits</span><span class="op" id="6080935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6080938">}</span><br>
<span class="lineno"></span><span class="op" id="6080940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="6080943">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6081018">func</span>&nbsp;<span class="op" id="6081023">(</span><span class="ident" id="6081024">e</span>&nbsp;<span class="op" id="6081026">*</span><span class="ident" id="6081027">encoder</span><span class="op" id="6081034">)</span>&nbsp;<span class="ident" id="6081036">writeMarkerHeader</span><span class="op" id="6081053">(</span><span class="ident" id="6081054">marker</span>&nbsp;<span class="builtintype" id="6081061">uint8</span><span class="op" id="6081066">,</span>&nbsp;<span class="ident" id="6081068">markerlen</span>&nbsp;<span class="builtintype" id="6081078">int</span><span class="op" id="6081081">)</span>&nbsp;<span class="op" id="6081083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081086">e</span><span class="op" id="6081087">.</span><span class="ident" id="6081088">buf</span><span class="op" id="6081091">[</span><span class="num" id="6081092">0</span><span class="op" id="6081093">]</span>&nbsp;<span class="op" id="6081095">=</span>&nbsp;<span class="num" id="6081097">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081103">e</span><span class="op" id="6081104">.</span><span class="ident" id="6081105">buf</span><span class="op" id="6081108">[</span><span class="num" id="6081109">1</span><span class="op" id="6081110">]</span>&nbsp;<span class="op" id="6081112">=</span>&nbsp;<span class="ident" id="6081114">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081122">e</span><span class="op" id="6081123">.</span><span class="ident" id="6081124">buf</span><span class="op" id="6081127">[</span><span class="num" id="6081128">2</span><span class="op" id="6081129">]</span>&nbsp;<span class="op" id="6081131">=</span>&nbsp;<span class="builtintype" id="6081133">uint8</span><span class="op" id="6081138">(</span><span class="ident" id="6081139">markerlen</span>&nbsp;<span class="op" id="6081149">&gt;&gt;</span>&nbsp;<span class="num" id="6081152">8</span><span class="op" id="6081153">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081156">e</span><span class="op" id="6081157">.</span><span class="ident" id="6081158">buf</span><span class="op" id="6081161">[</span><span class="num" id="6081162">3</span><span class="op" id="6081163">]</span>&nbsp;<span class="op" id="6081165">=</span>&nbsp;<span class="builtintype" id="6081167">uint8</span><span class="op" id="6081172">(</span><span class="ident" id="6081173">markerlen</span>&nbsp;<span class="op" id="6081183">&amp;</span>&nbsp;<span class="num" id="6081185">0xff</span><span class="op" id="6081189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081192">e</span><span class="op" id="6081193">.</span><span class="ident" id="6081194">write</span><span class="op" id="6081199">(</span><span class="ident" id="6081200">e</span><span class="op" id="6081201">.</span><span class="ident" id="6081202">buf</span><span class="op" id="6081205">[</span><span class="op" id="6081206">:</span><span class="num" id="6081207">4</span><span class="op" id="6081208">]</span><span class="op" id="6081209">)</span><br>
<span class="lineno"></span><span class="op" id="6081211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6081214">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="6081271">func</span>&nbsp;<span class="op" id="6081276">(</span><span class="ident" id="6081277">e</span>&nbsp;<span class="op" id="6081279">*</span><span class="ident" id="6081280">encoder</span><span class="op" id="6081287">)</span>&nbsp;<span class="ident" id="6081289">writeDQT</span><span class="op" id="6081297">(</span><span class="op" id="6081298">)</span>&nbsp;<span class="op" id="6081300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081303">const</span>&nbsp;<span class="ident" id="6081309">markerlen</span>&nbsp;<span class="op" id="6081319">=</span>&nbsp;<span class="num" id="6081321">2</span>&nbsp;<span class="op" id="6081323">+</span>&nbsp;<span class="builtintype" id="6081325">int</span><span class="op" id="6081328">(</span><span class="ident" id="6081329">nQuantIndex</span><span class="op" id="6081340">)</span><span class="op" id="6081341">*</span><span class="op" id="6081342">(</span><span class="num" id="6081343">1</span><span class="op" id="6081344">+</span><span class="ident" id="6081345">blockSize</span><span class="op" id="6081354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081357">e</span><span class="op" id="6081358">.</span><span class="ident" id="6081359">writeMarkerHeader</span><span class="op" id="6081376">(</span><span class="ident" id="6081377">dqtMarker</span><span class="op" id="6081386">,</span>&nbsp;<span class="ident" id="6081388">markerlen</span><span class="op" id="6081397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081400">for</span>&nbsp;<span class="ident" id="6081404">i</span>&nbsp;<span class="op" id="6081406">:=</span>&nbsp;<span class="keyword" id="6081409">range</span>&nbsp;<span class="ident" id="6081415">e</span><span class="op" id="6081416">.</span><span class="ident" id="6081417">quant</span>&nbsp;<span class="op" id="6081423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081427">e</span><span class="op" id="6081428">.</span><span class="ident" id="6081429">writeByte</span><span class="op" id="6081438">(</span><span class="builtintype" id="6081439">uint8</span><span class="op" id="6081444">(</span><span class="ident" id="6081445">i</span><span class="op" id="6081446">)</span><span class="op" id="6081447">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081451">e</span><span class="op" id="6081452">.</span><span class="ident" id="6081453">write</span><span class="op" id="6081458">(</span><span class="ident" id="6081459">e</span><span class="op" id="6081460">.</span><span class="ident" id="6081461">quant</span><span class="op" id="6081466">[</span><span class="ident" id="6081467">i</span><span class="op" id="6081468">]</span><span class="op" id="6081469">[</span><span class="op" id="6081470">:</span><span class="op" id="6081471">]</span><span class="op" id="6081472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081475">}</span><br>
<span class="lineno"></span><span class="op" id="6081477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6081480">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="6081538">func</span>&nbsp;<span class="op" id="6081543">(</span><span class="ident" id="6081544">e</span>&nbsp;<span class="op" id="6081546">*</span><span class="ident" id="6081547">encoder</span><span class="op" id="6081554">)</span>&nbsp;<span class="ident" id="6081556">writeSOF0</span><span class="op" id="6081565">(</span><span class="ident" id="6081566">size</span>&nbsp;<span class="ident" id="6081571">image</span><span class="op" id="6081576">.</span><span class="ident" id="6081577">Point</span><span class="op" id="6081582">,</span>&nbsp;<span class="ident" id="6081584">nComponent</span>&nbsp;<span class="builtintype" id="6081595">int</span><span class="op" id="6081598">)</span>&nbsp;<span class="op" id="6081600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081603">markerlen</span>&nbsp;<span class="op" id="6081613">:=</span>&nbsp;<span class="num" id="6081616">8</span>&nbsp;<span class="op" id="6081618">+</span>&nbsp;<span class="num" id="6081620">3</span><span class="op" id="6081621">*</span><span class="ident" id="6081622">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081634">e</span><span class="op" id="6081635">.</span><span class="ident" id="6081636">writeMarkerHeader</span><span class="op" id="6081653">(</span><span class="ident" id="6081654">sof0Marker</span><span class="op" id="6081664">,</span>&nbsp;<span class="ident" id="6081666">markerlen</span><span class="op" id="6081675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081678">e</span><span class="op" id="6081679">.</span><span class="ident" id="6081680">buf</span><span class="op" id="6081683">[</span><span class="num" id="6081684">0</span><span class="op" id="6081685">]</span>&nbsp;<span class="op" id="6081687">=</span>&nbsp;<span class="num" id="6081689">8</span>&nbsp;<span class="comment" id="6081691">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081708">e</span><span class="op" id="6081709">.</span><span class="ident" id="6081710">buf</span><span class="op" id="6081713">[</span><span class="num" id="6081714">1</span><span class="op" id="6081715">]</span>&nbsp;<span class="op" id="6081717">=</span>&nbsp;<span class="builtintype" id="6081719">uint8</span><span class="op" id="6081724">(</span><span class="ident" id="6081725">size</span><span class="op" id="6081729">.</span><span class="ident" id="6081730">Y</span>&nbsp;<span class="op" id="6081732">&gt;&gt;</span>&nbsp;<span class="num" id="6081735">8</span><span class="op" id="6081736">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081739">e</span><span class="op" id="6081740">.</span><span class="ident" id="6081741">buf</span><span class="op" id="6081744">[</span><span class="num" id="6081745">2</span><span class="op" id="6081746">]</span>&nbsp;<span class="op" id="6081748">=</span>&nbsp;<span class="builtintype" id="6081750">uint8</span><span class="op" id="6081755">(</span><span class="ident" id="6081756">size</span><span class="op" id="6081760">.</span><span class="ident" id="6081761">Y</span>&nbsp;<span class="op" id="6081763">&amp;</span>&nbsp;<span class="num" id="6081765">0xff</span><span class="op" id="6081769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081772">e</span><span class="op" id="6081773">.</span><span class="ident" id="6081774">buf</span><span class="op" id="6081777">[</span><span class="num" id="6081778">3</span><span class="op" id="6081779">]</span>&nbsp;<span class="op" id="6081781">=</span>&nbsp;<span class="builtintype" id="6081783">uint8</span><span class="op" id="6081788">(</span><span class="ident" id="6081789">size</span><span class="op" id="6081793">.</span><span class="ident" id="6081794">X</span>&nbsp;<span class="op" id="6081796">&gt;&gt;</span>&nbsp;<span class="num" id="6081799">8</span><span class="op" id="6081800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081803">e</span><span class="op" id="6081804">.</span><span class="ident" id="6081805">buf</span><span class="op" id="6081808">[</span><span class="num" id="6081809">4</span><span class="op" id="6081810">]</span>&nbsp;<span class="op" id="6081812">=</span>&nbsp;<span class="builtintype" id="6081814">uint8</span><span class="op" id="6081819">(</span><span class="ident" id="6081820">size</span><span class="op" id="6081824">.</span><span class="ident" id="6081825">X</span>&nbsp;<span class="op" id="6081827">&amp;</span>&nbsp;<span class="num" id="6081829">0xff</span><span class="op" id="6081833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081836">e</span><span class="op" id="6081837">.</span><span class="ident" id="6081838">buf</span><span class="op" id="6081841">[</span><span class="num" id="6081842">5</span><span class="op" id="6081843">]</span>&nbsp;<span class="op" id="6081845">=</span>&nbsp;<span class="builtintype" id="6081847">uint8</span><span class="op" id="6081852">(</span><span class="ident" id="6081853">nComponent</span><span class="op" id="6081863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081866">if</span>&nbsp;<span class="ident" id="6081869">nComponent</span>&nbsp;<span class="op" id="6081880">==</span>&nbsp;<span class="num" id="6081883">1</span>&nbsp;<span class="op" id="6081885">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081889">e</span><span class="op" id="6081890">.</span><span class="ident" id="6081891">buf</span><span class="op" id="6081894">[</span><span class="num" id="6081895">6</span><span class="op" id="6081896">]</span>&nbsp;<span class="op" id="6081898">=</span>&nbsp;<span class="num" id="6081900">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6081904">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081945">e</span><span class="op" id="6081946">.</span><span class="ident" id="6081947">buf</span><span class="op" id="6081950">[</span><span class="num" id="6081951">7</span><span class="op" id="6081952">]</span>&nbsp;<span class="op" id="6081954">=</span>&nbsp;<span class="num" id="6081956">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081963">e</span><span class="op" id="6081964">.</span><span class="ident" id="6081965">buf</span><span class="op" id="6081968">[</span><span class="num" id="6081969">8</span><span class="op" id="6081970">]</span>&nbsp;<span class="op" id="6081972">=</span>&nbsp;<span class="num" id="6081974">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081980">}</span>&nbsp;<span class="keyword" id="6081982">else</span>&nbsp;<span class="op" id="6081987">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081991">for</span>&nbsp;<span class="ident" id="6081995">i</span>&nbsp;<span class="op" id="6081997">:=</span>&nbsp;<span class="num" id="6082000">0</span><span class="op" id="6082001">;</span>&nbsp;<span class="ident" id="6082003">i</span>&nbsp;<span class="op" id="6082005">&lt;</span>&nbsp;<span class="ident" id="6082007">nComponent</span><span class="op" id="6082017">;</span>&nbsp;<span class="ident" id="6082019">i</span><span class="op" id="6082020">++</span>&nbsp;<span class="op" id="6082023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082028">e</span><span class="op" id="6082029">.</span><span class="ident" id="6082030">buf</span><span class="op" id="6082033">[</span><span class="num" id="6082034">3</span><span class="op" id="6082035">*</span><span class="ident" id="6082036">i</span><span class="op" id="6082037">+</span><span class="num" id="6082038">6</span><span class="op" id="6082039">]</span>&nbsp;<span class="op" id="6082041">=</span>&nbsp;<span class="builtintype" id="6082043">uint8</span><span class="op" id="6082048">(</span><span class="ident" id="6082049">i</span>&nbsp;<span class="op" id="6082051">+</span>&nbsp;<span class="num" id="6082053">1</span><span class="op" id="6082054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082059">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082098">e</span><span class="op" id="6082099">.</span><span class="ident" id="6082100">buf</span><span class="op" id="6082103">[</span><span class="num" id="6082104">3</span><span class="op" id="6082105">*</span><span class="ident" id="6082106">i</span><span class="op" id="6082107">+</span><span class="num" id="6082108">7</span><span class="op" id="6082109">]</span>&nbsp;<span class="op" id="6082111">=</span>&nbsp;<span class="string" id="6082113">&#34;\x22\x11\x11&#34;</span><span class="op" id="6082127">[</span><span class="ident" id="6082128">i</span><span class="op" id="6082129">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082134">e</span><span class="op" id="6082135">.</span><span class="ident" id="6082136">buf</span><span class="op" id="6082139">[</span><span class="num" id="6082140">3</span><span class="op" id="6082141">*</span><span class="ident" id="6082142">i</span><span class="op" id="6082143">+</span><span class="num" id="6082144">8</span><span class="op" id="6082145">]</span>&nbsp;<span class="op" id="6082147">=</span>&nbsp;<span class="string" id="6082149">&#34;\x00\x01\x01&#34;</span><span class="op" id="6082163">[</span><span class="ident" id="6082164">i</span><span class="op" id="6082165">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082175">e</span><span class="op" id="6082176">.</span><span class="ident" id="6082177">write</span><span class="op" id="6082182">(</span><span class="ident" id="6082183">e</span><span class="op" id="6082184">.</span><span class="ident" id="6082185">buf</span><span class="op" id="6082188">[</span><span class="op" id="6082189">:</span><span class="num" id="6082190">3</span><span class="op" id="6082191">*</span><span class="op" id="6082192">(</span><span class="ident" id="6082193">nComponent</span><span class="op" id="6082203">-</span><span class="num" id="6082204">1</span><span class="op" id="6082205">)</span><span class="op" id="6082206">+</span><span class="num" id="6082207">9</span><span class="op" id="6082208">]</span><span class="op" id="6082209">)</span><br>
<span class="lineno"></span><span class="op" id="6082211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="6082214">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="6082266">func</span>&nbsp;<span class="op" id="6082271">(</span><span class="ident" id="6082272">e</span>&nbsp;<span class="op" id="6082274">*</span><span class="ident" id="6082275">encoder</span><span class="op" id="6082282">)</span>&nbsp;<span class="ident" id="6082284">writeDHT</span><span class="op" id="6082292">(</span><span class="ident" id="6082293">nComponent</span>&nbsp;<span class="builtintype" id="6082304">int</span><span class="op" id="6082307">)</span>&nbsp;<span class="op" id="6082309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082312">markerlen</span>&nbsp;<span class="op" id="6082322">:=</span>&nbsp;<span class="num" id="6082325">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082328">specs</span>&nbsp;<span class="op" id="6082334">:=</span>&nbsp;<span class="ident" id="6082337">theHuffmanSpec</span><span class="op" id="6082351">[</span><span class="op" id="6082352">:</span><span class="op" id="6082353">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082356">if</span>&nbsp;<span class="ident" id="6082359">nComponent</span>&nbsp;<span class="op" id="6082370">==</span>&nbsp;<span class="num" id="6082373">1</span>&nbsp;<span class="op" id="6082375">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082379">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082413">specs</span>&nbsp;<span class="op" id="6082419">=</span>&nbsp;<span class="ident" id="6082421">specs</span><span class="op" id="6082426">[</span><span class="op" id="6082427">:</span><span class="num" id="6082428">2</span><span class="op" id="6082429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082435">for</span>&nbsp;<span class="ident" id="6082439">_</span><span class="op" id="6082440">,</span>&nbsp;<span class="ident" id="6082442">s</span>&nbsp;<span class="op" id="6082444">:=</span>&nbsp;<span class="keyword" id="6082447">range</span>&nbsp;<span class="ident" id="6082453">specs</span>&nbsp;<span class="op" id="6082459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082463">markerlen</span>&nbsp;<span class="op" id="6082473">+=</span>&nbsp;<span class="num" id="6082476">1</span>&nbsp;<span class="op" id="6082478">+</span>&nbsp;<span class="num" id="6082480">16</span>&nbsp;<span class="op" id="6082483">+</span>&nbsp;<span class="builtinfunc" id="6082485">len</span><span class="op" id="6082488">(</span><span class="ident" id="6082489">s</span><span class="op" id="6082490">.</span><span class="ident" id="6082491">value</span><span class="op" id="6082496">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082502">e</span><span class="op" id="6082503">.</span><span class="ident" id="6082504">writeMarkerHeader</span><span class="op" id="6082521">(</span><span class="ident" id="6082522">dhtMarker</span><span class="op" id="6082531">,</span>&nbsp;<span class="ident" id="6082533">markerlen</span><span class="op" id="6082542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082545">for</span>&nbsp;<span class="ident" id="6082549">i</span><span class="op" id="6082550">,</span>&nbsp;<span class="ident" id="6082552">s</span>&nbsp;<span class="op" id="6082554">:=</span>&nbsp;<span class="keyword" id="6082557">range</span>&nbsp;<span class="ident" id="6082563">specs</span>&nbsp;<span class="op" id="6082569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082573">e</span><span class="op" id="6082574">.</span><span class="ident" id="6082575">writeByte</span><span class="op" id="6082584">(</span><span class="string" id="6082585">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="6082603">[</span><span class="ident" id="6082604">i</span><span class="op" id="6082605">]</span><span class="op" id="6082606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082610">e</span><span class="op" id="6082611">.</span><span class="ident" id="6082612">write</span><span class="op" id="6082617">(</span><span class="ident" id="6082618">s</span><span class="op" id="6082619">.</span><span class="ident" id="6082620">count</span><span class="op" id="6082625">[</span><span class="op" id="6082626">:</span><span class="op" id="6082627">]</span><span class="op" id="6082628">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082632">e</span><span class="op" id="6082633">.</span><span class="ident" id="6082634">write</span><span class="op" id="6082639">(</span><span class="ident" id="6082640">s</span><span class="op" id="6082641">.</span><span class="ident" id="6082642">value</span><span class="op" id="6082647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082650">}</span><br>
<span class="lineno"></span><span class="op" id="6082652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6082655">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="6082734">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6082813">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="6082845">func</span>&nbsp;<span class="op" id="6082850">(</span><span class="ident" id="6082851">e</span>&nbsp;<span class="op" id="6082853">*</span><span class="ident" id="6082854">encoder</span><span class="op" id="6082861">)</span>&nbsp;<span class="ident" id="6082863">writeBlock</span><span class="op" id="6082873">(</span><span class="ident" id="6082874">b</span>&nbsp;<span class="op" id="6082876">*</span><span class="ident" id="6082877">block</span><span class="op" id="6082882">,</span>&nbsp;<span class="ident" id="6082884">q</span>&nbsp;<span class="ident" id="6082886">quantIndex</span><span class="op" id="6082896">,</span>&nbsp;<span class="ident" id="6082898">prevDC</span>&nbsp;<span class="builtintype" id="6082905">int32</span><span class="op" id="6082910">)</span>&nbsp;<span class="builtintype" id="6082912">int32</span>&nbsp;<span class="op" id="6082918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082921">fdct</span><span class="op" id="6082925">(</span><span class="ident" id="6082926">b</span><span class="op" id="6082927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6082930">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082953">dc</span>&nbsp;<span class="op" id="6082956">:=</span>&nbsp;<span class="ident" id="6082959">div</span><span class="op" id="6082962">(</span><span class="ident" id="6082963">b</span><span class="op" id="6082964">[</span><span class="num" id="6082965">0</span><span class="op" id="6082966">]</span><span class="op" id="6082967">,</span>&nbsp;<span class="num" id="6082969">8</span><span class="op" id="6082970">*</span><span class="builtintype" id="6082971">int32</span><span class="op" id="6082976">(</span><span class="ident" id="6082977">e</span><span class="op" id="6082978">.</span><span class="ident" id="6082979">quant</span><span class="op" id="6082984">[</span><span class="ident" id="6082985">q</span><span class="op" id="6082986">]</span><span class="op" id="6082987">[</span><span class="num" id="6082988">0</span><span class="op" id="6082989">]</span><span class="op" id="6082990">)</span><span class="op" id="6082991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082994">e</span><span class="op" id="6082995">.</span><span class="ident" id="6082996">emitHuffRLE</span><span class="op" id="6083007">(</span><span class="ident" id="6083008">huffIndex</span><span class="op" id="6083017">(</span><span class="num" id="6083018">2</span><span class="op" id="6083019">*</span><span class="ident" id="6083020">q</span><span class="op" id="6083021">+</span><span class="num" id="6083022">0</span><span class="op" id="6083023">)</span><span class="op" id="6083024">,</span>&nbsp;<span class="num" id="6083026">0</span><span class="op" id="6083027">,</span>&nbsp;<span class="ident" id="6083029">dc</span><span class="op" id="6083031">-</span><span class="ident" id="6083032">prevDC</span><span class="op" id="6083038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083041">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083069">h</span><span class="op" id="6083070">,</span>&nbsp;<span class="ident" id="6083072">runLength</span>&nbsp;<span class="op" id="6083082">:=</span>&nbsp;<span class="ident" id="6083085">huffIndex</span><span class="op" id="6083094">(</span><span class="num" id="6083095">2</span><span class="op" id="6083096">*</span><span class="ident" id="6083097">q</span><span class="op" id="6083098">+</span><span class="num" id="6083099">1</span><span class="op" id="6083100">)</span><span class="op" id="6083101">,</span>&nbsp;<span class="builtintype" id="6083103">int32</span><span class="op" id="6083108">(</span><span class="num" id="6083109">0</span><span class="op" id="6083110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083113">for</span>&nbsp;<span class="ident" id="6083117">zig</span>&nbsp;<span class="op" id="6083121">:=</span>&nbsp;<span class="num" id="6083124">1</span><span class="op" id="6083125">;</span>&nbsp;<span class="ident" id="6083127">zig</span>&nbsp;<span class="op" id="6083131">&lt;</span>&nbsp;<span class="ident" id="6083133">blockSize</span><span class="op" id="6083142">;</span>&nbsp;<span class="ident" id="6083144">zig</span><span class="op" id="6083147">++</span>&nbsp;<span class="op" id="6083150">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083154">ac</span>&nbsp;<span class="op" id="6083157">:=</span>&nbsp;<span class="ident" id="6083160">div</span><span class="op" id="6083163">(</span><span class="ident" id="6083164">b</span><span class="op" id="6083165">[</span><span class="ident" id="6083166">unzig</span><span class="op" id="6083171">[</span><span class="ident" id="6083172">zig</span><span class="op" id="6083175">]</span><span class="op" id="6083176">]</span><span class="op" id="6083177">,</span>&nbsp;<span class="num" id="6083179">8</span><span class="op" id="6083180">*</span><span class="builtintype" id="6083181">int32</span><span class="op" id="6083186">(</span><span class="ident" id="6083187">e</span><span class="op" id="6083188">.</span><span class="ident" id="6083189">quant</span><span class="op" id="6083194">[</span><span class="ident" id="6083195">q</span><span class="op" id="6083196">]</span><span class="op" id="6083197">[</span><span class="ident" id="6083198">zig</span><span class="op" id="6083201">]</span><span class="op" id="6083202">)</span><span class="op" id="6083203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083207">if</span>&nbsp;<span class="ident" id="6083210">ac</span>&nbsp;<span class="op" id="6083213">==</span>&nbsp;<span class="num" id="6083216">0</span>&nbsp;<span class="op" id="6083218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083223">runLength</span><span class="op" id="6083232">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083237">}</span>&nbsp;<span class="keyword" id="6083239">else</span>&nbsp;<span class="op" id="6083244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083249">for</span>&nbsp;<span class="ident" id="6083253">runLength</span>&nbsp;<span class="op" id="6083263">&gt;</span>&nbsp;<span class="num" id="6083265">15</span>&nbsp;<span class="op" id="6083268">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083274">e</span><span class="op" id="6083275">.</span><span class="ident" id="6083276">emitHuff</span><span class="op" id="6083284">(</span><span class="ident" id="6083285">h</span><span class="op" id="6083286">,</span>&nbsp;<span class="num" id="6083288">0xf0</span><span class="op" id="6083292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083298">runLength</span>&nbsp;<span class="op" id="6083308">-=</span>&nbsp;<span class="num" id="6083311">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083322">e</span><span class="op" id="6083323">.</span><span class="ident" id="6083324">emitHuffRLE</span><span class="op" id="6083335">(</span><span class="ident" id="6083336">h</span><span class="op" id="6083337">,</span>&nbsp;<span class="ident" id="6083339">runLength</span><span class="op" id="6083348">,</span>&nbsp;<span class="ident" id="6083350">ac</span><span class="op" id="6083352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083357">runLength</span>&nbsp;<span class="op" id="6083367">=</span>&nbsp;<span class="num" id="6083369">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083379">if</span>&nbsp;<span class="ident" id="6083382">runLength</span>&nbsp;<span class="op" id="6083392">&gt;</span>&nbsp;<span class="num" id="6083394">0</span>&nbsp;<span class="op" id="6083396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083400">e</span><span class="op" id="6083401">.</span><span class="ident" id="6083402">emitHuff</span><span class="op" id="6083410">(</span><span class="ident" id="6083411">h</span><span class="op" id="6083412">,</span>&nbsp;<span class="num" id="6083414">0x00</span><span class="op" id="6083418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083421">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083424">return</span>&nbsp;<span class="ident" id="6083431">dc</span><br>
<span class="lineno"></span><span class="op" id="6083434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6083437">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6083511">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="6083528">func</span>&nbsp;<span class="ident" id="6083533">toYCbCr</span><span class="op" id="6083540">(</span><span class="ident" id="6083541">m</span>&nbsp;<span class="ident" id="6083543">image</span><span class="op" id="6083548">.</span><span class="ident" id="6083549">Image</span><span class="op" id="6083554">,</span>&nbsp;<span class="ident" id="6083556">p</span>&nbsp;<span class="ident" id="6083558">image</span><span class="op" id="6083563">.</span><span class="ident" id="6083564">Point</span><span class="op" id="6083569">,</span>&nbsp;<span class="ident" id="6083571">yBlock</span><span class="op" id="6083577">,</span>&nbsp;<span class="ident" id="6083579">cbBlock</span><span class="op" id="6083586">,</span>&nbsp;<span class="ident" id="6083588">crBlock</span>&nbsp;<span class="op" id="6083596">*</span><span class="ident" id="6083597">block</span><span class="op" id="6083602">)</span>&nbsp;<span class="op" id="6083604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083607">b</span>&nbsp;<span class="op" id="6083609">:=</span>&nbsp;<span class="ident" id="6083612">m</span><span class="op" id="6083613">.</span><span class="ident" id="6083614">Bounds</span><span class="op" id="6083620">(</span><span class="op" id="6083621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083624">xmax</span>&nbsp;<span class="op" id="6083629">:=</span>&nbsp;<span class="ident" id="6083632">b</span><span class="op" id="6083633">.</span><span class="ident" id="6083634">Max</span><span class="op" id="6083637">.</span><span class="ident" id="6083638">X</span>&nbsp;<span class="op" id="6083640">-</span>&nbsp;<span class="num" id="6083642">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083645">ymax</span>&nbsp;<span class="op" id="6083650">:=</span>&nbsp;<span class="ident" id="6083653">b</span><span class="op" id="6083654">.</span><span class="ident" id="6083655">Max</span><span class="op" id="6083658">.</span><span class="ident" id="6083659">Y</span>&nbsp;<span class="op" id="6083661">-</span>&nbsp;<span class="num" id="6083663">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083666">for</span>&nbsp;<span class="ident" id="6083670">j</span>&nbsp;<span class="op" id="6083672">:=</span>&nbsp;<span class="num" id="6083675">0</span><span class="op" id="6083676">;</span>&nbsp;<span class="ident" id="6083678">j</span>&nbsp;<span class="op" id="6083680">&lt;</span>&nbsp;<span class="num" id="6083682">8</span><span class="op" id="6083683">;</span>&nbsp;<span class="ident" id="6083685">j</span><span class="op" id="6083686">++</span>&nbsp;<span class="op" id="6083689">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083693">for</span>&nbsp;<span class="ident" id="6083697">i</span>&nbsp;<span class="op" id="6083699">:=</span>&nbsp;<span class="num" id="6083702">0</span><span class="op" id="6083703">;</span>&nbsp;<span class="ident" id="6083705">i</span>&nbsp;<span class="op" id="6083707">&lt;</span>&nbsp;<span class="num" id="6083709">8</span><span class="op" id="6083710">;</span>&nbsp;<span class="ident" id="6083712">i</span><span class="op" id="6083713">++</span>&nbsp;<span class="op" id="6083716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083721">r</span><span class="op" id="6083722">,</span>&nbsp;<span class="ident" id="6083724">g</span><span class="op" id="6083725">,</span>&nbsp;<span class="ident" id="6083727">b</span><span class="op" id="6083728">,</span>&nbsp;<span class="ident" id="6083730">_</span>&nbsp;<span class="op" id="6083732">:=</span>&nbsp;<span class="ident" id="6083735">m</span><span class="op" id="6083736">.</span><span class="ident" id="6083737">At</span><span class="op" id="6083739">(</span><span class="ident" id="6083740">min</span><span class="op" id="6083743">(</span><span class="ident" id="6083744">p</span><span class="op" id="6083745">.</span><span class="ident" id="6083746">X</span><span class="op" id="6083747">+</span><span class="ident" id="6083748">i</span><span class="op" id="6083749">,</span>&nbsp;<span class="ident" id="6083751">xmax</span><span class="op" id="6083755">)</span><span class="op" id="6083756">,</span>&nbsp;<span class="ident" id="6083758">min</span><span class="op" id="6083761">(</span><span class="ident" id="6083762">p</span><span class="op" id="6083763">.</span><span class="ident" id="6083764">Y</span><span class="op" id="6083765">+</span><span class="ident" id="6083766">j</span><span class="op" id="6083767">,</span>&nbsp;<span class="ident" id="6083769">ymax</span><span class="op" id="6083773">)</span><span class="op" id="6083774">)</span><span class="op" id="6083775">.</span><span class="ident" id="6083776">RGBA</span><span class="op" id="6083780">(</span><span class="op" id="6083781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083786">yy</span><span class="op" id="6083788">,</span>&nbsp;<span class="ident" id="6083790">cb</span><span class="op" id="6083792">,</span>&nbsp;<span class="ident" id="6083794">cr</span>&nbsp;<span class="op" id="6083797">:=</span>&nbsp;<span class="ident" id="6083800">color</span><span class="op" id="6083805">.</span><span class="ident" id="6083806">RGBToYCbCr</span><span class="op" id="6083816">(</span><span class="builtintype" id="6083817">uint8</span><span class="op" id="6083822">(</span><span class="ident" id="6083823">r</span><span class="op" id="6083824">&gt;&gt;</span><span class="num" id="6083826">8</span><span class="op" id="6083827">)</span><span class="op" id="6083828">,</span>&nbsp;<span class="builtintype" id="6083830">uint8</span><span class="op" id="6083835">(</span><span class="ident" id="6083836">g</span><span class="op" id="6083837">&gt;&gt;</span><span class="num" id="6083839">8</span><span class="op" id="6083840">)</span><span class="op" id="6083841">,</span>&nbsp;<span class="builtintype" id="6083843">uint8</span><span class="op" id="6083848">(</span><span class="ident" id="6083849">b</span><span class="op" id="6083850">&gt;&gt;</span><span class="num" id="6083852">8</span><span class="op" id="6083853">)</span><span class="op" id="6083854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083859">yBlock</span><span class="op" id="6083865">[</span><span class="num" id="6083866">8</span><span class="op" id="6083867">*</span><span class="ident" id="6083868">j</span><span class="op" id="6083869">+</span><span class="ident" id="6083870">i</span><span class="op" id="6083871">]</span>&nbsp;<span class="op" id="6083873">=</span>&nbsp;<span class="builtintype" id="6083875">int32</span><span class="op" id="6083880">(</span><span class="ident" id="6083881">yy</span><span class="op" id="6083883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083888">cbBlock</span><span class="op" id="6083895">[</span><span class="num" id="6083896">8</span><span class="op" id="6083897">*</span><span class="ident" id="6083898">j</span><span class="op" id="6083899">+</span><span class="ident" id="6083900">i</span><span class="op" id="6083901">]</span>&nbsp;<span class="op" id="6083903">=</span>&nbsp;<span class="builtintype" id="6083905">int32</span><span class="op" id="6083910">(</span><span class="ident" id="6083911">cb</span><span class="op" id="6083913">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083918">crBlock</span><span class="op" id="6083925">[</span><span class="num" id="6083926">8</span><span class="op" id="6083927">*</span><span class="ident" id="6083928">j</span><span class="op" id="6083929">+</span><span class="ident" id="6083930">i</span><span class="op" id="6083931">]</span>&nbsp;<span class="op" id="6083933">=</span>&nbsp;<span class="builtintype" id="6083935">int32</span><span class="op" id="6083940">(</span><span class="ident" id="6083941">cr</span><span class="op" id="6083943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083950">}</span><br>
<span class="lineno"></span><span class="op" id="6083952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="6083955">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="6084031">func</span>&nbsp;<span class="ident" id="6084036">grayToY</span><span class="op" id="6084043">(</span><span class="ident" id="6084044">m</span>&nbsp;<span class="op" id="6084046">*</span><span class="ident" id="6084047">image</span><span class="op" id="6084052">.</span><span class="ident" id="6084053">Gray</span><span class="op" id="6084057">,</span>&nbsp;<span class="ident" id="6084059">p</span>&nbsp;<span class="ident" id="6084061">image</span><span class="op" id="6084066">.</span><span class="ident" id="6084067">Point</span><span class="op" id="6084072">,</span>&nbsp;<span class="ident" id="6084074">yBlock</span>&nbsp;<span class="op" id="6084081">*</span><span class="ident" id="6084082">block</span><span class="op" id="6084087">)</span>&nbsp;<span class="op" id="6084089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084092">b</span>&nbsp;<span class="op" id="6084094">:=</span>&nbsp;<span class="ident" id="6084097">m</span><span class="op" id="6084098">.</span><span class="ident" id="6084099">Bounds</span><span class="op" id="6084105">(</span><span class="op" id="6084106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084109">xmax</span>&nbsp;<span class="op" id="6084114">:=</span>&nbsp;<span class="ident" id="6084117">b</span><span class="op" id="6084118">.</span><span class="ident" id="6084119">Max</span><span class="op" id="6084122">.</span><span class="ident" id="6084123">X</span>&nbsp;<span class="op" id="6084125">-</span>&nbsp;<span class="num" id="6084127">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084130">ymax</span>&nbsp;<span class="op" id="6084135">:=</span>&nbsp;<span class="ident" id="6084138">b</span><span class="op" id="6084139">.</span><span class="ident" id="6084140">Max</span><span class="op" id="6084143">.</span><span class="ident" id="6084144">Y</span>&nbsp;<span class="op" id="6084146">-</span>&nbsp;<span class="num" id="6084148">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084151">pix</span>&nbsp;<span class="op" id="6084155">:=</span>&nbsp;<span class="ident" id="6084158">m</span><span class="op" id="6084159">.</span><span class="ident" id="6084160">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084165">for</span>&nbsp;<span class="ident" id="6084169">j</span>&nbsp;<span class="op" id="6084171">:=</span>&nbsp;<span class="num" id="6084174">0</span><span class="op" id="6084175">;</span>&nbsp;<span class="ident" id="6084177">j</span>&nbsp;<span class="op" id="6084179">&lt;</span>&nbsp;<span class="num" id="6084181">8</span><span class="op" id="6084182">;</span>&nbsp;<span class="ident" id="6084184">j</span><span class="op" id="6084185">++</span>&nbsp;<span class="op" id="6084188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084192">for</span>&nbsp;<span class="ident" id="6084196">i</span>&nbsp;<span class="op" id="6084198">:=</span>&nbsp;<span class="num" id="6084201">0</span><span class="op" id="6084202">;</span>&nbsp;<span class="ident" id="6084204">i</span>&nbsp;<span class="op" id="6084206">&lt;</span>&nbsp;<span class="num" id="6084208">8</span><span class="op" id="6084209">;</span>&nbsp;<span class="ident" id="6084211">i</span><span class="op" id="6084212">++</span>&nbsp;<span class="op" id="6084215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084220">idx</span>&nbsp;<span class="op" id="6084224">:=</span>&nbsp;<span class="ident" id="6084227">m</span><span class="op" id="6084228">.</span><span class="ident" id="6084229">PixOffset</span><span class="op" id="6084238">(</span><span class="ident" id="6084239">min</span><span class="op" id="6084242">(</span><span class="ident" id="6084243">p</span><span class="op" id="6084244">.</span><span class="ident" id="6084245">X</span><span class="op" id="6084246">+</span><span class="ident" id="6084247">i</span><span class="op" id="6084248">,</span>&nbsp;<span class="ident" id="6084250">xmax</span><span class="op" id="6084254">)</span><span class="op" id="6084255">,</span>&nbsp;<span class="ident" id="6084257">min</span><span class="op" id="6084260">(</span><span class="ident" id="6084261">p</span><span class="op" id="6084262">.</span><span class="ident" id="6084263">Y</span><span class="op" id="6084264">+</span><span class="ident" id="6084265">j</span><span class="op" id="6084266">,</span>&nbsp;<span class="ident" id="6084268">ymax</span><span class="op" id="6084272">)</span><span class="op" id="6084273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084278">yBlock</span><span class="op" id="6084284">[</span><span class="num" id="6084285">8</span><span class="op" id="6084286">*</span><span class="ident" id="6084287">j</span><span class="op" id="6084288">+</span><span class="ident" id="6084289">i</span><span class="op" id="6084290">]</span>&nbsp;<span class="op" id="6084292">=</span>&nbsp;<span class="builtintype" id="6084294">int32</span><span class="op" id="6084299">(</span><span class="ident" id="6084300">pix</span><span class="op" id="6084303">[</span><span class="ident" id="6084304">idx</span><span class="op" id="6084307">]</span><span class="op" id="6084308">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084315">}</span><br>
<span class="lineno"></span><span class="op" id="6084317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6084320">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="6084394">func</span>&nbsp;<span class="ident" id="6084399">rgbaToYCbCr</span><span class="op" id="6084410">(</span><span class="ident" id="6084411">m</span>&nbsp;<span class="op" id="6084413">*</span><span class="ident" id="6084414">image</span><span class="op" id="6084419">.</span><span class="ident" id="6084420">RGBA</span><span class="op" id="6084424">,</span>&nbsp;<span class="ident" id="6084426">p</span>&nbsp;<span class="ident" id="6084428">image</span><span class="op" id="6084433">.</span><span class="ident" id="6084434">Point</span><span class="op" id="6084439">,</span>&nbsp;<span class="ident" id="6084441">yBlock</span><span class="op" id="6084447">,</span>&nbsp;<span class="ident" id="6084449">cbBlock</span><span class="op" id="6084456">,</span>&nbsp;<span class="ident" id="6084458">crBlock</span>&nbsp;<span class="op" id="6084466">*</span><span class="ident" id="6084467">block</span><span class="op" id="6084472">)</span>&nbsp;<span class="op" id="6084474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084477">b</span>&nbsp;<span class="op" id="6084479">:=</span>&nbsp;<span class="ident" id="6084482">m</span><span class="op" id="6084483">.</span><span class="ident" id="6084484">Bounds</span><span class="op" id="6084490">(</span><span class="op" id="6084491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084494">xmax</span>&nbsp;<span class="op" id="6084499">:=</span>&nbsp;<span class="ident" id="6084502">b</span><span class="op" id="6084503">.</span><span class="ident" id="6084504">Max</span><span class="op" id="6084507">.</span><span class="ident" id="6084508">X</span>&nbsp;<span class="op" id="6084510">-</span>&nbsp;<span class="num" id="6084512">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084515">ymax</span>&nbsp;<span class="op" id="6084520">:=</span>&nbsp;<span class="ident" id="6084523">b</span><span class="op" id="6084524">.</span><span class="ident" id="6084525">Max</span><span class="op" id="6084528">.</span><span class="ident" id="6084529">Y</span>&nbsp;<span class="op" id="6084531">-</span>&nbsp;<span class="num" id="6084533">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084536">for</span>&nbsp;<span class="ident" id="6084540">j</span>&nbsp;<span class="op" id="6084542">:=</span>&nbsp;<span class="num" id="6084545">0</span><span class="op" id="6084546">;</span>&nbsp;<span class="ident" id="6084548">j</span>&nbsp;<span class="op" id="6084550">&lt;</span>&nbsp;<span class="num" id="6084552">8</span><span class="op" id="6084553">;</span>&nbsp;<span class="ident" id="6084555">j</span><span class="op" id="6084556">++</span>&nbsp;<span class="op" id="6084559">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084563">sj</span>&nbsp;<span class="op" id="6084566">:=</span>&nbsp;<span class="ident" id="6084569">p</span><span class="op" id="6084570">.</span><span class="ident" id="6084571">Y</span>&nbsp;<span class="op" id="6084573">+</span>&nbsp;<span class="ident" id="6084575">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084579">if</span>&nbsp;<span class="ident" id="6084582">sj</span>&nbsp;<span class="op" id="6084585">&gt;</span>&nbsp;<span class="ident" id="6084587">ymax</span>&nbsp;<span class="op" id="6084592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084597">sj</span>&nbsp;<span class="op" id="6084600">=</span>&nbsp;<span class="ident" id="6084602">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084613">offset</span>&nbsp;<span class="op" id="6084620">:=</span>&nbsp;<span class="op" id="6084623">(</span><span class="ident" id="6084624">sj</span><span class="op" id="6084626">-</span><span class="ident" id="6084627">b</span><span class="op" id="6084628">.</span><span class="ident" id="6084629">Min</span><span class="op" id="6084632">.</span><span class="ident" id="6084633">Y</span><span class="op" id="6084634">)</span><span class="op" id="6084635">*</span><span class="ident" id="6084636">m</span><span class="op" id="6084637">.</span><span class="ident" id="6084638">Stride</span>&nbsp;<span class="op" id="6084645">-</span>&nbsp;<span class="ident" id="6084647">b</span><span class="op" id="6084648">.</span><span class="ident" id="6084649">Min</span><span class="op" id="6084652">.</span><span class="ident" id="6084653">X</span><span class="op" id="6084654">*</span><span class="num" id="6084655">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084659">for</span>&nbsp;<span class="ident" id="6084663">i</span>&nbsp;<span class="op" id="6084665">:=</span>&nbsp;<span class="num" id="6084668">0</span><span class="op" id="6084669">;</span>&nbsp;<span class="ident" id="6084671">i</span>&nbsp;<span class="op" id="6084673">&lt;</span>&nbsp;<span class="num" id="6084675">8</span><span class="op" id="6084676">;</span>&nbsp;<span class="ident" id="6084678">i</span><span class="op" id="6084679">++</span>&nbsp;<span class="op" id="6084682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084687">sx</span>&nbsp;<span class="op" id="6084690">:=</span>&nbsp;<span class="ident" id="6084693">p</span><span class="op" id="6084694">.</span><span class="ident" id="6084695">X</span>&nbsp;<span class="op" id="6084697">+</span>&nbsp;<span class="ident" id="6084699">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084704">if</span>&nbsp;<span class="ident" id="6084707">sx</span>&nbsp;<span class="op" id="6084710">&gt;</span>&nbsp;<span class="ident" id="6084712">xmax</span>&nbsp;<span class="op" id="6084717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084723">sx</span>&nbsp;<span class="op" id="6084726">=</span>&nbsp;<span class="ident" id="6084728">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084736">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084741">pix</span>&nbsp;<span class="op" id="6084745">:=</span>&nbsp;<span class="ident" id="6084748">m</span><span class="op" id="6084749">.</span><span class="ident" id="6084750">Pix</span><span class="op" id="6084753">[</span><span class="ident" id="6084754">offset</span><span class="op" id="6084760">+</span><span class="ident" id="6084761">sx</span><span class="op" id="6084763">*</span><span class="num" id="6084764">4</span><span class="op" id="6084765">:</span><span class="op" id="6084766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084771">yy</span><span class="op" id="6084773">,</span>&nbsp;<span class="ident" id="6084775">cb</span><span class="op" id="6084777">,</span>&nbsp;<span class="ident" id="6084779">cr</span>&nbsp;<span class="op" id="6084782">:=</span>&nbsp;<span class="ident" id="6084785">color</span><span class="op" id="6084790">.</span><span class="ident" id="6084791">RGBToYCbCr</span><span class="op" id="6084801">(</span><span class="ident" id="6084802">pix</span><span class="op" id="6084805">[</span><span class="num" id="6084806">0</span><span class="op" id="6084807">]</span><span class="op" id="6084808">,</span>&nbsp;<span class="ident" id="6084810">pix</span><span class="op" id="6084813">[</span><span class="num" id="6084814">1</span><span class="op" id="6084815">]</span><span class="op" id="6084816">,</span>&nbsp;<span class="ident" id="6084818">pix</span><span class="op" id="6084821">[</span><span class="num" id="6084822">2</span><span class="op" id="6084823">]</span><span class="op" id="6084824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084829">yBlock</span><span class="op" id="6084835">[</span><span class="num" id="6084836">8</span><span class="op" id="6084837">*</span><span class="ident" id="6084838">j</span><span class="op" id="6084839">+</span><span class="ident" id="6084840">i</span><span class="op" id="6084841">]</span>&nbsp;<span class="op" id="6084843">=</span>&nbsp;<span class="builtintype" id="6084845">int32</span><span class="op" id="6084850">(</span><span class="ident" id="6084851">yy</span><span class="op" id="6084853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084858">cbBlock</span><span class="op" id="6084865">[</span><span class="num" id="6084866">8</span><span class="op" id="6084867">*</span><span class="ident" id="6084868">j</span><span class="op" id="6084869">+</span><span class="ident" id="6084870">i</span><span class="op" id="6084871">]</span>&nbsp;<span class="op" id="6084873">=</span>&nbsp;<span class="builtintype" id="6084875">int32</span><span class="op" id="6084880">(</span><span class="ident" id="6084881">cb</span><span class="op" id="6084883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084888">crBlock</span><span class="op" id="6084895">[</span><span class="num" id="6084896">8</span><span class="op" id="6084897">*</span><span class="ident" id="6084898">j</span><span class="op" id="6084899">+</span><span class="ident" id="6084900">i</span><span class="op" id="6084901">]</span>&nbsp;<span class="op" id="6084903">=</span>&nbsp;<span class="builtintype" id="6084905">int32</span><span class="op" id="6084910">(</span><span class="ident" id="6084911">cr</span><span class="op" id="6084913">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084920">}</span><br>
<span class="lineno"></span><span class="op" id="6084922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6084925">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="6085001">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6085015">func</span>&nbsp;<span class="ident" id="6085020">scale</span><span class="op" id="6085025">(</span><span class="ident" id="6085026">dst</span>&nbsp;<span class="op" id="6085030">*</span><span class="ident" id="6085031">block</span><span class="op" id="6085036">,</span>&nbsp;<span class="ident" id="6085038">src</span>&nbsp;<span class="op" id="6085042">*</span><span class="op" id="6085043">[</span><span class="num" id="6085044">4</span><span class="op" id="6085045">]</span><span class="ident" id="6085046">block</span><span class="op" id="6085051">)</span>&nbsp;<span class="op" id="6085053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085056">for</span>&nbsp;<span class="ident" id="6085060">i</span>&nbsp;<span class="op" id="6085062">:=</span>&nbsp;<span class="num" id="6085065">0</span><span class="op" id="6085066">;</span>&nbsp;<span class="ident" id="6085068">i</span>&nbsp;<span class="op" id="6085070">&lt;</span>&nbsp;<span class="num" id="6085072">4</span><span class="op" id="6085073">;</span>&nbsp;<span class="ident" id="6085075">i</span><span class="op" id="6085076">++</span>&nbsp;<span class="op" id="6085079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085083">dstOff</span>&nbsp;<span class="op" id="6085090">:=</span>&nbsp;<span class="op" id="6085093">(</span><span class="ident" id="6085094">i</span><span class="op" id="6085095">&amp;</span><span class="num" id="6085096">2</span><span class="op" id="6085097">)</span><span class="op" id="6085098">&lt;&lt;</span><span class="num" id="6085100">4</span>&nbsp;<span class="op" id="6085102">|</span>&nbsp;<span class="op" id="6085104">(</span><span class="ident" id="6085105">i</span><span class="op" id="6085106">&amp;</span><span class="num" id="6085107">1</span><span class="op" id="6085108">)</span><span class="op" id="6085109">&lt;&lt;</span><span class="num" id="6085111">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085115">for</span>&nbsp;<span class="ident" id="6085119">y</span>&nbsp;<span class="op" id="6085121">:=</span>&nbsp;<span class="num" id="6085124">0</span><span class="op" id="6085125">;</span>&nbsp;<span class="ident" id="6085127">y</span>&nbsp;<span class="op" id="6085129">&lt;</span>&nbsp;<span class="num" id="6085131">4</span><span class="op" id="6085132">;</span>&nbsp;<span class="ident" id="6085134">y</span><span class="op" id="6085135">++</span>&nbsp;<span class="op" id="6085138">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085143">for</span>&nbsp;<span class="ident" id="6085147">x</span>&nbsp;<span class="op" id="6085149">:=</span>&nbsp;<span class="num" id="6085152">0</span><span class="op" id="6085153">;</span>&nbsp;<span class="ident" id="6085155">x</span>&nbsp;<span class="op" id="6085157">&lt;</span>&nbsp;<span class="num" id="6085159">4</span><span class="op" id="6085160">;</span>&nbsp;<span class="ident" id="6085162">x</span><span class="op" id="6085163">++</span>&nbsp;<span class="op" id="6085166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085172">j</span>&nbsp;<span class="op" id="6085174">:=</span>&nbsp;<span class="num" id="6085177">16</span><span class="op" id="6085179">*</span><span class="ident" id="6085180">y</span>&nbsp;<span class="op" id="6085182">+</span>&nbsp;<span class="num" id="6085184">2</span><span class="op" id="6085185">*</span><span class="ident" id="6085186">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085192">sum</span>&nbsp;<span class="op" id="6085196">:=</span>&nbsp;<span class="ident" id="6085199">src</span><span class="op" id="6085202">[</span><span class="ident" id="6085203">i</span><span class="op" id="6085204">]</span><span class="op" id="6085205">[</span><span class="ident" id="6085206">j</span><span class="op" id="6085207">]</span>&nbsp;<span class="op" id="6085209">+</span>&nbsp;<span class="ident" id="6085211">src</span><span class="op" id="6085214">[</span><span class="ident" id="6085215">i</span><span class="op" id="6085216">]</span><span class="op" id="6085217">[</span><span class="ident" id="6085218">j</span><span class="op" id="6085219">+</span><span class="num" id="6085220">1</span><span class="op" id="6085221">]</span>&nbsp;<span class="op" id="6085223">+</span>&nbsp;<span class="ident" id="6085225">src</span><span class="op" id="6085228">[</span><span class="ident" id="6085229">i</span><span class="op" id="6085230">]</span><span class="op" id="6085231">[</span><span class="ident" id="6085232">j</span><span class="op" id="6085233">+</span><span class="num" id="6085234">8</span><span class="op" id="6085235">]</span>&nbsp;<span class="op" id="6085237">+</span>&nbsp;<span class="ident" id="6085239">src</span><span class="op" id="6085242">[</span><span class="ident" id="6085243">i</span><span class="op" id="6085244">]</span><span class="op" id="6085245">[</span><span class="ident" id="6085246">j</span><span class="op" id="6085247">+</span><span class="num" id="6085248">9</span><span class="op" id="6085249">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085255">dst</span><span class="op" id="6085258">[</span><span class="num" id="6085259">8</span><span class="op" id="6085260">*</span><span class="ident" id="6085261">y</span><span class="op" id="6085262">+</span><span class="ident" id="6085263">x</span><span class="op" id="6085264">+</span><span class="ident" id="6085265">dstOff</span><span class="op" id="6085271">]</span>&nbsp;<span class="op" id="6085273">=</span>&nbsp;<span class="op" id="6085275">(</span><span class="ident" id="6085276">sum</span>&nbsp;<span class="op" id="6085280">+</span>&nbsp;<span class="num" id="6085282">2</span><span class="op" id="6085283">)</span>&nbsp;<span class="op" id="6085285">&gt;&gt;</span>&nbsp;<span class="num" id="6085288">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085293">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085300">}</span><br>
<span class="lineno"></span><span class="op" id="6085302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6085305">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="6085369">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6085404">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6085442">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6085502">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6085573">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="6085648">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="6085691">var</span>&nbsp;<span class="ident" id="6085695">sosHeaderY</span>&nbsp;<span class="op" id="6085706">=</span>&nbsp;<span class="op" id="6085708">[</span><span class="op" id="6085709">]</span><span class="builtintype" id="6085710">byte</span><span class="op" id="6085714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6085717">0xff</span><span class="op" id="6085721">,</span>&nbsp;<span class="num" id="6085723">0xda</span><span class="op" id="6085727">,</span>&nbsp;<span class="num" id="6085729">0x00</span><span class="op" id="6085733">,</span>&nbsp;<span class="num" id="6085735">0x08</span><span class="op" id="6085739">,</span>&nbsp;<span class="num" id="6085741">0x01</span><span class="op" id="6085745">,</span>&nbsp;<span class="num" id="6085747">0x01</span><span class="op" id="6085751">,</span>&nbsp;<span class="num" id="6085753">0x00</span><span class="op" id="6085757">,</span>&nbsp;<span class="num" id="6085759">0x00</span><span class="op" id="6085763">,</span>&nbsp;<span class="num" id="6085765">0x3f</span><span class="op" id="6085769">,</span>&nbsp;<span class="num" id="6085771">0x00</span><span class="op" id="6085775">,</span><br>
<span class="lineno"></span><span class="op" id="6085777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="6085780">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="6085849">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6085884">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6085922">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6085982">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="6086042">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6086102">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6086173">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="6086248">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="6086291">var</span>&nbsp;<span class="ident" id="6086295">sosHeaderYCbCr</span>&nbsp;<span class="op" id="6086310">=</span>&nbsp;<span class="op" id="6086312">[</span><span class="op" id="6086313">]</span><span class="builtintype" id="6086314">byte</span><span class="op" id="6086318">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6086321">0xff</span><span class="op" id="6086325">,</span>&nbsp;<span class="num" id="6086327">0xda</span><span class="op" id="6086331">,</span>&nbsp;<span class="num" id="6086333">0x00</span><span class="op" id="6086337">,</span>&nbsp;<span class="num" id="6086339">0x0c</span><span class="op" id="6086343">,</span>&nbsp;<span class="num" id="6086345">0x03</span><span class="op" id="6086349">,</span>&nbsp;<span class="num" id="6086351">0x01</span><span class="op" id="6086355">,</span>&nbsp;<span class="num" id="6086357">0x00</span><span class="op" id="6086361">,</span>&nbsp;<span class="num" id="6086363">0x02</span><span class="op" id="6086367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6086370">0x11</span><span class="op" id="6086374">,</span>&nbsp;<span class="num" id="6086376">0x03</span><span class="op" id="6086380">,</span>&nbsp;<span class="num" id="6086382">0x11</span><span class="op" id="6086386">,</span>&nbsp;<span class="num" id="6086388">0x00</span><span class="op" id="6086392">,</span>&nbsp;<span class="num" id="6086394">0x3f</span><span class="op" id="6086398">,</span>&nbsp;<span class="num" id="6086400">0x00</span><span class="op" id="6086404">,</span><br>
<span class="lineno"></span><span class="op" id="6086406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6086409">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="6086452">func</span>&nbsp;<span class="op" id="6086457">(</span><span class="ident" id="6086458">e</span>&nbsp;<span class="op" id="6086460">*</span><span class="ident" id="6086461">encoder</span><span class="op" id="6086468">)</span>&nbsp;<span class="ident" id="6086470">writeSOS</span><span class="op" id="6086478">(</span><span class="ident" id="6086479">m</span>&nbsp;<span class="ident" id="6086481">image</span><span class="op" id="6086486">.</span><span class="ident" id="6086487">Image</span><span class="op" id="6086492">)</span>&nbsp;<span class="op" id="6086494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086497">switch</span>&nbsp;<span class="ident" id="6086504">m</span><span class="op" id="6086505">.</span><span class="op" id="6086506">(</span><span class="keyword" id="6086507">type</span><span class="op" id="6086511">)</span>&nbsp;<span class="op" id="6086513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086516">case</span>&nbsp;<span class="op" id="6086521">*</span><span class="ident" id="6086522">image</span><span class="op" id="6086527">.</span><span class="ident" id="6086528">Gray</span><span class="op" id="6086532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086536">e</span><span class="op" id="6086537">.</span><span class="ident" id="6086538">write</span><span class="op" id="6086543">(</span><span class="ident" id="6086544">sosHeaderY</span><span class="op" id="6086554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086557">default</span><span class="op" id="6086564">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086568">e</span><span class="op" id="6086569">.</span><span class="ident" id="6086570">write</span><span class="op" id="6086575">(</span><span class="ident" id="6086576">sosHeaderYCbCr</span><span class="op" id="6086590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086596">var</span>&nbsp;<span class="op" id="6086600">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086604">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086651">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086703">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086710">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086718">cb</span><span class="op" id="6086720">,</span>&nbsp;<span class="ident" id="6086722">cr</span>&nbsp;<span class="op" id="6086725">[</span><span class="num" id="6086726">4</span><span class="op" id="6086727">]</span><span class="ident" id="6086728">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086736">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086774">prevDCY</span><span class="op" id="6086781">,</span>&nbsp;<span class="ident" id="6086783">prevDCCb</span><span class="op" id="6086791">,</span>&nbsp;<span class="ident" id="6086793">prevDCCr</span>&nbsp;<span class="builtintype" id="6086802">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086809">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086812">bounds</span>&nbsp;<span class="op" id="6086819">:=</span>&nbsp;<span class="ident" id="6086822">m</span><span class="op" id="6086823">.</span><span class="ident" id="6086824">Bounds</span><span class="op" id="6086830">(</span><span class="op" id="6086831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086834">switch</span>&nbsp;<span class="ident" id="6086841">m</span>&nbsp;<span class="op" id="6086843">:=</span>&nbsp;<span class="ident" id="6086846">m</span><span class="op" id="6086847">.</span><span class="op" id="6086848">(</span><span class="keyword" id="6086849">type</span><span class="op" id="6086853">)</span>&nbsp;<span class="op" id="6086855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086858">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086920">case</span>&nbsp;<span class="op" id="6086925">*</span><span class="ident" id="6086926">image</span><span class="op" id="6086931">.</span><span class="ident" id="6086932">Gray</span><span class="op" id="6086936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086940">for</span>&nbsp;<span class="ident" id="6086944">y</span>&nbsp;<span class="op" id="6086946">:=</span>&nbsp;<span class="ident" id="6086949">bounds</span><span class="op" id="6086955">.</span><span class="ident" id="6086956">Min</span><span class="op" id="6086959">.</span><span class="ident" id="6086960">Y</span><span class="op" id="6086961">;</span>&nbsp;<span class="ident" id="6086963">y</span>&nbsp;<span class="op" id="6086965">&lt;</span>&nbsp;<span class="ident" id="6086967">bounds</span><span class="op" id="6086973">.</span><span class="ident" id="6086974">Max</span><span class="op" id="6086977">.</span><span class="ident" id="6086978">Y</span><span class="op" id="6086979">;</span>&nbsp;<span class="ident" id="6086981">y</span>&nbsp;<span class="op" id="6086983">+=</span>&nbsp;<span class="num" id="6086986">8</span>&nbsp;<span class="op" id="6086988">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086993">for</span>&nbsp;<span class="ident" id="6086997">x</span>&nbsp;<span class="op" id="6086999">:=</span>&nbsp;<span class="ident" id="6087002">bounds</span><span class="op" id="6087008">.</span><span class="ident" id="6087009">Min</span><span class="op" id="6087012">.</span><span class="ident" id="6087013">X</span><span class="op" id="6087014">;</span>&nbsp;<span class="ident" id="6087016">x</span>&nbsp;<span class="op" id="6087018">&lt;</span>&nbsp;<span class="ident" id="6087020">bounds</span><span class="op" id="6087026">.</span><span class="ident" id="6087027">Max</span><span class="op" id="6087030">.</span><span class="ident" id="6087031">X</span><span class="op" id="6087032">;</span>&nbsp;<span class="ident" id="6087034">x</span>&nbsp;<span class="op" id="6087036">+=</span>&nbsp;<span class="num" id="6087039">8</span>&nbsp;<span class="op" id="6087041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087047">p</span>&nbsp;<span class="op" id="6087049">:=</span>&nbsp;<span class="ident" id="6087052">image</span><span class="op" id="6087057">.</span><span class="ident" id="6087058">Pt</span><span class="op" id="6087060">(</span><span class="ident" id="6087061">x</span><span class="op" id="6087062">,</span>&nbsp;<span class="ident" id="6087064">y</span><span class="op" id="6087065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087071">grayToY</span><span class="op" id="6087078">(</span><span class="ident" id="6087079">m</span><span class="op" id="6087080">,</span>&nbsp;<span class="ident" id="6087082">p</span><span class="op" id="6087083">,</span>&nbsp;<span class="op" id="6087085">&amp;</span><span class="ident" id="6087086">b</span><span class="op" id="6087087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087093">prevDCY</span>&nbsp;<span class="op" id="6087101">=</span>&nbsp;<span class="ident" id="6087103">e</span><span class="op" id="6087104">.</span><span class="ident" id="6087105">writeBlock</span><span class="op" id="6087115">(</span><span class="op" id="6087116">&amp;</span><span class="ident" id="6087117">b</span><span class="op" id="6087118">,</span>&nbsp;<span class="num" id="6087120">0</span><span class="op" id="6087121">,</span>&nbsp;<span class="ident" id="6087123">prevDCY</span><span class="op" id="6087130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087135">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087142">default</span><span class="op" id="6087149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087153">rgba</span><span class="op" id="6087157">,</span>&nbsp;<span class="ident" id="6087159">_</span>&nbsp;<span class="op" id="6087161">:=</span>&nbsp;<span class="ident" id="6087164">m</span><span class="op" id="6087165">.</span><span class="op" id="6087166">(</span><span class="op" id="6087167">*</span><span class="ident" id="6087168">image</span><span class="op" id="6087173">.</span><span class="ident" id="6087174">RGBA</span><span class="op" id="6087178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087182">for</span>&nbsp;<span class="ident" id="6087186">y</span>&nbsp;<span class="op" id="6087188">:=</span>&nbsp;<span class="ident" id="6087191">bounds</span><span class="op" id="6087197">.</span><span class="ident" id="6087198">Min</span><span class="op" id="6087201">.</span><span class="ident" id="6087202">Y</span><span class="op" id="6087203">;</span>&nbsp;<span class="ident" id="6087205">y</span>&nbsp;<span class="op" id="6087207">&lt;</span>&nbsp;<span class="ident" id="6087209">bounds</span><span class="op" id="6087215">.</span><span class="ident" id="6087216">Max</span><span class="op" id="6087219">.</span><span class="ident" id="6087220">Y</span><span class="op" id="6087221">;</span>&nbsp;<span class="ident" id="6087223">y</span>&nbsp;<span class="op" id="6087225">+=</span>&nbsp;<span class="num" id="6087228">16</span>&nbsp;<span class="op" id="6087231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087236">for</span>&nbsp;<span class="ident" id="6087240">x</span>&nbsp;<span class="op" id="6087242">:=</span>&nbsp;<span class="ident" id="6087245">bounds</span><span class="op" id="6087251">.</span><span class="ident" id="6087252">Min</span><span class="op" id="6087255">.</span><span class="ident" id="6087256">X</span><span class="op" id="6087257">;</span>&nbsp;<span class="ident" id="6087259">x</span>&nbsp;<span class="op" id="6087261">&lt;</span>&nbsp;<span class="ident" id="6087263">bounds</span><span class="op" id="6087269">.</span><span class="ident" id="6087270">Max</span><span class="op" id="6087273">.</span><span class="ident" id="6087274">X</span><span class="op" id="6087275">;</span>&nbsp;<span class="ident" id="6087277">x</span>&nbsp;<span class="op" id="6087279">+=</span>&nbsp;<span class="num" id="6087282">16</span>&nbsp;<span class="op" id="6087285">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087291">for</span>&nbsp;<span class="ident" id="6087295">i</span>&nbsp;<span class="op" id="6087297">:=</span>&nbsp;<span class="num" id="6087300">0</span><span class="op" id="6087301">;</span>&nbsp;<span class="ident" id="6087303">i</span>&nbsp;<span class="op" id="6087305">&lt;</span>&nbsp;<span class="num" id="6087307">4</span><span class="op" id="6087308">;</span>&nbsp;<span class="ident" id="6087310">i</span><span class="op" id="6087311">++</span>&nbsp;<span class="op" id="6087314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087321">xOff</span>&nbsp;<span class="op" id="6087326">:=</span>&nbsp;<span class="op" id="6087329">(</span><span class="ident" id="6087330">i</span>&nbsp;<span class="op" id="6087332">&amp;</span>&nbsp;<span class="num" id="6087334">1</span><span class="op" id="6087335">)</span>&nbsp;<span class="op" id="6087337">*</span>&nbsp;<span class="num" id="6087339">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087346">yOff</span>&nbsp;<span class="op" id="6087351">:=</span>&nbsp;<span class="op" id="6087354">(</span><span class="ident" id="6087355">i</span>&nbsp;<span class="op" id="6087357">&amp;</span>&nbsp;<span class="num" id="6087359">2</span><span class="op" id="6087360">)</span>&nbsp;<span class="op" id="6087362">*</span>&nbsp;<span class="num" id="6087364">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087371">p</span>&nbsp;<span class="op" id="6087373">:=</span>&nbsp;<span class="ident" id="6087376">image</span><span class="op" id="6087381">.</span><span class="ident" id="6087382">Pt</span><span class="op" id="6087384">(</span><span class="ident" id="6087385">x</span><span class="op" id="6087386">+</span><span class="ident" id="6087387">xOff</span><span class="op" id="6087391">,</span>&nbsp;<span class="ident" id="6087393">y</span><span class="op" id="6087394">+</span><span class="ident" id="6087395">yOff</span><span class="op" id="6087399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087406">if</span>&nbsp;<span class="ident" id="6087409">rgba</span>&nbsp;<span class="op" id="6087414">!=</span>&nbsp;<span class="ident" id="6087417">nil</span>&nbsp;<span class="op" id="6087421">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087429">rgbaToYCbCr</span><span class="op" id="6087440">(</span><span class="ident" id="6087441">rgba</span><span class="op" id="6087445">,</span>&nbsp;<span class="ident" id="6087447">p</span><span class="op" id="6087448">,</span>&nbsp;<span class="op" id="6087450">&amp;</span><span class="ident" id="6087451">b</span><span class="op" id="6087452">,</span>&nbsp;<span class="op" id="6087454">&amp;</span><span class="ident" id="6087455">cb</span><span class="op" id="6087457">[</span><span class="ident" id="6087458">i</span><span class="op" id="6087459">]</span><span class="op" id="6087460">,</span>&nbsp;<span class="op" id="6087462">&amp;</span><span class="ident" id="6087463">cr</span><span class="op" id="6087465">[</span><span class="ident" id="6087466">i</span><span class="op" id="6087467">]</span><span class="op" id="6087468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087475">}</span>&nbsp;<span class="keyword" id="6087477">else</span>&nbsp;<span class="op" id="6087482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087490">toYCbCr</span><span class="op" id="6087497">(</span><span class="ident" id="6087498">m</span><span class="op" id="6087499">,</span>&nbsp;<span class="ident" id="6087501">p</span><span class="op" id="6087502">,</span>&nbsp;<span class="op" id="6087504">&amp;</span><span class="ident" id="6087505">b</span><span class="op" id="6087506">,</span>&nbsp;<span class="op" id="6087508">&amp;</span><span class="ident" id="6087509">cb</span><span class="op" id="6087511">[</span><span class="ident" id="6087512">i</span><span class="op" id="6087513">]</span><span class="op" id="6087514">,</span>&nbsp;<span class="op" id="6087516">&amp;</span><span class="ident" id="6087517">cr</span><span class="op" id="6087519">[</span><span class="ident" id="6087520">i</span><span class="op" id="6087521">]</span><span class="op" id="6087522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087536">prevDCY</span>&nbsp;<span class="op" id="6087544">=</span>&nbsp;<span class="ident" id="6087546">e</span><span class="op" id="6087547">.</span><span class="ident" id="6087548">writeBlock</span><span class="op" id="6087558">(</span><span class="op" id="6087559">&amp;</span><span class="ident" id="6087560">b</span><span class="op" id="6087561">,</span>&nbsp;<span class="num" id="6087563">0</span><span class="op" id="6087564">,</span>&nbsp;<span class="ident" id="6087566">prevDCY</span><span class="op" id="6087573">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087585">scale</span><span class="op" id="6087590">(</span><span class="op" id="6087591">&amp;</span><span class="ident" id="6087592">b</span><span class="op" id="6087593">,</span>&nbsp;<span class="op" id="6087595">&amp;</span><span class="ident" id="6087596">cb</span><span class="op" id="6087598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087604">prevDCCb</span>&nbsp;<span class="op" id="6087613">=</span>&nbsp;<span class="ident" id="6087615">e</span><span class="op" id="6087616">.</span><span class="ident" id="6087617">writeBlock</span><span class="op" id="6087627">(</span><span class="op" id="6087628">&amp;</span><span class="ident" id="6087629">b</span><span class="op" id="6087630">,</span>&nbsp;<span class="num" id="6087632">1</span><span class="op" id="6087633">,</span>&nbsp;<span class="ident" id="6087635">prevDCCb</span><span class="op" id="6087643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087649">scale</span><span class="op" id="6087654">(</span><span class="op" id="6087655">&amp;</span><span class="ident" id="6087656">b</span><span class="op" id="6087657">,</span>&nbsp;<span class="op" id="6087659">&amp;</span><span class="ident" id="6087660">cr</span><span class="op" id="6087662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087668">prevDCCr</span>&nbsp;<span class="op" id="6087677">=</span>&nbsp;<span class="ident" id="6087679">e</span><span class="op" id="6087680">.</span><span class="ident" id="6087681">writeBlock</span><span class="op" id="6087691">(</span><span class="op" id="6087692">&amp;</span><span class="ident" id="6087693">b</span><span class="op" id="6087694">,</span>&nbsp;<span class="num" id="6087696">1</span><span class="op" id="6087697">,</span>&nbsp;<span class="ident" id="6087699">prevDCCr</span><span class="op" id="6087707">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6087722">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087754">e</span><span class="op" id="6087755">.</span><span class="ident" id="6087756">emit</span><span class="op" id="6087760">(</span><span class="num" id="6087761">0x7f</span><span class="op" id="6087765">,</span>&nbsp;<span class="num" id="6087767">7</span><span class="op" id="6087768">)</span><br>
<span class="lineno">535</span><span class="op" id="6087770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6087773">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="6087834">const</span>&nbsp;<span class="ident" id="6087840">DefaultQuality</span>&nbsp;<span class="op" id="6087855">=</span>&nbsp;<span class="num" id="6087857">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="6087861">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="6087901">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="6087962">type</span>&nbsp;<span class="ident" id="6087967">Options</span>&nbsp;<span class="keyword" id="6087975">struct</span>&nbsp;<span class="op" id="6087982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087985">Quality</span>&nbsp;<span class="builtintype" id="6087993">int</span><br>
<span class="lineno"></span><span class="op" id="6087997">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="6088000">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6088079">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="6088148">func</span>&nbsp;<span class="ident" id="6088153">Encode</span><span class="op" id="6088159">(</span><span class="ident" id="6088160">w</span>&nbsp;<span class="ident" id="6088162">io</span><span class="op" id="6088164">.</span><span class="ident" id="6088165">Writer</span><span class="op" id="6088171">,</span>&nbsp;<span class="ident" id="6088173">m</span>&nbsp;<span class="ident" id="6088175">image</span><span class="op" id="6088180">.</span><span class="ident" id="6088181">Image</span><span class="op" id="6088186">,</span>&nbsp;<span class="ident" id="6088188">o</span>&nbsp;<span class="op" id="6088190">*</span><span class="ident" id="6088191">Options</span><span class="op" id="6088198">)</span>&nbsp;<span class="builtintype" id="6088200">error</span>&nbsp;<span class="op" id="6088206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088209">b</span>&nbsp;<span class="op" id="6088211">:=</span>&nbsp;<span class="ident" id="6088214">m</span><span class="op" id="6088215">.</span><span class="ident" id="6088216">Bounds</span><span class="op" id="6088222">(</span><span class="op" id="6088223">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088226">if</span>&nbsp;<span class="ident" id="6088229">b</span><span class="op" id="6088230">.</span><span class="ident" id="6088231">Dx</span><span class="op" id="6088233">(</span><span class="op" id="6088234">)</span>&nbsp;<span class="op" id="6088236">&gt;=</span>&nbsp;<span class="num" id="6088239">1</span><span class="op" id="6088240">&lt;&lt;</span><span class="num" id="6088242">16</span>&nbsp;<span class="op" id="6088245">||</span>&nbsp;<span class="ident" id="6088248">b</span><span class="op" id="6088249">.</span><span class="ident" id="6088250">Dy</span><span class="op" id="6088252">(</span><span class="op" id="6088253">)</span>&nbsp;<span class="op" id="6088255">&gt;=</span>&nbsp;<span class="num" id="6088258">1</span><span class="op" id="6088259">&lt;&lt;</span><span class="num" id="6088261">16</span>&nbsp;<span class="op" id="6088264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088268">return</span>&nbsp;<span class="ident" id="6088275">errors</span><span class="op" id="6088281">.</span><span class="ident" id="6088282">New</span><span class="op" id="6088285">(</span><span class="string" id="6088286">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6088322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088328">var</span>&nbsp;<span class="ident" id="6088332">e</span>&nbsp;<span class="ident" id="6088334">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088343">if</span>&nbsp;<span class="ident" id="6088346">ww</span><span class="op" id="6088348">,</span>&nbsp;<span class="ident" id="6088350">ok</span>&nbsp;<span class="op" id="6088353">:=</span>&nbsp;<span class="ident" id="6088356">w</span><span class="op" id="6088357">.</span><span class="op" id="6088358">(</span><span class="ident" id="6088359">writer</span><span class="op" id="6088365">)</span><span class="op" id="6088366">;</span>&nbsp;<span class="ident" id="6088368">ok</span>&nbsp;<span class="op" id="6088371">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088375">e</span><span class="op" id="6088376">.</span><span class="ident" id="6088377">w</span>&nbsp;<span class="op" id="6088379">=</span>&nbsp;<span class="ident" id="6088381">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088385">}</span>&nbsp;<span class="keyword" id="6088387">else</span>&nbsp;<span class="op" id="6088392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088396">e</span><span class="op" id="6088397">.</span><span class="ident" id="6088398">w</span>&nbsp;<span class="op" id="6088400">=</span>&nbsp;<span class="ident" id="6088402">bufio</span><span class="op" id="6088407">.</span><span class="ident" id="6088408">NewWriter</span><span class="op" id="6088417">(</span><span class="ident" id="6088418">w</span><span class="op" id="6088419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6088425">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088455">quality</span>&nbsp;<span class="op" id="6088463">:=</span>&nbsp;<span class="ident" id="6088466">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088482">if</span>&nbsp;<span class="ident" id="6088485">o</span>&nbsp;<span class="op" id="6088487">!=</span>&nbsp;<span class="ident" id="6088490">nil</span>&nbsp;<span class="op" id="6088494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088498">quality</span>&nbsp;<span class="op" id="6088506">=</span>&nbsp;<span class="ident" id="6088508">o</span><span class="op" id="6088509">.</span><span class="ident" id="6088510">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088520">if</span>&nbsp;<span class="ident" id="6088523">quality</span>&nbsp;<span class="op" id="6088531">&lt;</span>&nbsp;<span class="num" id="6088533">1</span>&nbsp;<span class="op" id="6088535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088540">quality</span>&nbsp;<span class="op" id="6088548">=</span>&nbsp;<span class="num" id="6088550">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088554">}</span>&nbsp;<span class="keyword" id="6088556">else</span>&nbsp;<span class="keyword" id="6088561">if</span>&nbsp;<span class="ident" id="6088564">quality</span>&nbsp;<span class="op" id="6088572">&gt;</span>&nbsp;<span class="num" id="6088574">100</span>&nbsp;<span class="op" id="6088578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088583">quality</span>&nbsp;<span class="op" id="6088591">=</span>&nbsp;<span class="num" id="6088593">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6088605">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088660">var</span>&nbsp;<span class="ident" id="6088664">scale</span>&nbsp;<span class="builtintype" id="6088670">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088675">if</span>&nbsp;<span class="ident" id="6088678">quality</span>&nbsp;<span class="op" id="6088686">&lt;</span>&nbsp;<span class="num" id="6088688">50</span>&nbsp;<span class="op" id="6088691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088695">scale</span>&nbsp;<span class="op" id="6088701">=</span>&nbsp;<span class="num" id="6088703">5000</span>&nbsp;<span class="op" id="6088708">/</span>&nbsp;<span class="ident" id="6088710">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088719">}</span>&nbsp;<span class="keyword" id="6088721">else</span>&nbsp;<span class="op" id="6088726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088730">scale</span>&nbsp;<span class="op" id="6088736">=</span>&nbsp;<span class="num" id="6088738">200</span>&nbsp;<span class="op" id="6088742">-</span>&nbsp;<span class="ident" id="6088744">quality</span><span class="op" id="6088751">*</span><span class="num" id="6088752">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6088758">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088798">for</span>&nbsp;<span class="ident" id="6088802">i</span>&nbsp;<span class="op" id="6088804">:=</span>&nbsp;<span class="keyword" id="6088807">range</span>&nbsp;<span class="ident" id="6088813">e</span><span class="op" id="6088814">.</span><span class="ident" id="6088815">quant</span>&nbsp;<span class="op" id="6088821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088825">for</span>&nbsp;<span class="ident" id="6088829">j</span>&nbsp;<span class="op" id="6088831">:=</span>&nbsp;<span class="keyword" id="6088834">range</span>&nbsp;<span class="ident" id="6088840">e</span><span class="op" id="6088841">.</span><span class="ident" id="6088842">quant</span><span class="op" id="6088847">[</span><span class="ident" id="6088848">i</span><span class="op" id="6088849">]</span>&nbsp;<span class="op" id="6088851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088856">x</span>&nbsp;<span class="op" id="6088858">:=</span>&nbsp;<span class="builtintype" id="6088861">int</span><span class="op" id="6088864">(</span><span class="ident" id="6088865">unscaledQuant</span><span class="op" id="6088878">[</span><span class="ident" id="6088879">i</span><span class="op" id="6088880">]</span><span class="op" id="6088881">[</span><span class="ident" id="6088882">j</span><span class="op" id="6088883">]</span><span class="op" id="6088884">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088889">x</span>&nbsp;<span class="op" id="6088891">=</span>&nbsp;<span class="op" id="6088893">(</span><span class="ident" id="6088894">x</span><span class="op" id="6088895">*</span><span class="ident" id="6088896">scale</span>&nbsp;<span class="op" id="6088902">+</span>&nbsp;<span class="num" id="6088904">50</span><span class="op" id="6088906">)</span>&nbsp;<span class="op" id="6088908">/</span>&nbsp;<span class="num" id="6088910">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088917">if</span>&nbsp;<span class="ident" id="6088920">x</span>&nbsp;<span class="op" id="6088922">&lt;</span>&nbsp;<span class="num" id="6088924">1</span>&nbsp;<span class="op" id="6088926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088932">x</span>&nbsp;<span class="op" id="6088934">=</span>&nbsp;<span class="num" id="6088936">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088941">}</span>&nbsp;<span class="keyword" id="6088943">else</span>&nbsp;<span class="keyword" id="6088948">if</span>&nbsp;<span class="ident" id="6088951">x</span>&nbsp;<span class="op" id="6088953">&gt;</span>&nbsp;<span class="num" id="6088955">255</span>&nbsp;<span class="op" id="6088959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088965">x</span>&nbsp;<span class="op" id="6088967">=</span>&nbsp;<span class="num" id="6088969">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088981">e</span><span class="op" id="6088982">.</span><span class="ident" id="6088983">quant</span><span class="op" id="6088988">[</span><span class="ident" id="6088989">i</span><span class="op" id="6088990">]</span><span class="op" id="6088991">[</span><span class="ident" id="6088992">j</span><span class="op" id="6088993">]</span>&nbsp;<span class="op" id="6088995">=</span>&nbsp;<span class="builtintype" id="6088997">uint8</span><span class="op" id="6089002">(</span><span class="ident" id="6089003">x</span><span class="op" id="6089004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089014">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089074">nComponent</span>&nbsp;<span class="op" id="6089085">:=</span>&nbsp;<span class="num" id="6089088">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089091">switch</span>&nbsp;<span class="ident" id="6089098">m</span><span class="op" id="6089099">.</span><span class="op" id="6089100">(</span><span class="keyword" id="6089101">type</span><span class="op" id="6089105">)</span>&nbsp;<span class="op" id="6089107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089110">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089172">case</span>&nbsp;<span class="op" id="6089177">*</span><span class="ident" id="6089178">image</span><span class="op" id="6089183">.</span><span class="ident" id="6089184">Gray</span><span class="op" id="6089188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089192">nComponent</span>&nbsp;<span class="op" id="6089203">=</span>&nbsp;<span class="num" id="6089205">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089211">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089248">e</span><span class="op" id="6089249">.</span><span class="ident" id="6089250">buf</span><span class="op" id="6089253">[</span><span class="num" id="6089254">0</span><span class="op" id="6089255">]</span>&nbsp;<span class="op" id="6089257">=</span>&nbsp;<span class="num" id="6089259">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089265">e</span><span class="op" id="6089266">.</span><span class="ident" id="6089267">buf</span><span class="op" id="6089270">[</span><span class="num" id="6089271">1</span><span class="op" id="6089272">]</span>&nbsp;<span class="op" id="6089274">=</span>&nbsp;<span class="num" id="6089276">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089282">e</span><span class="op" id="6089283">.</span><span class="ident" id="6089284">write</span><span class="op" id="6089289">(</span><span class="ident" id="6089290">e</span><span class="op" id="6089291">.</span><span class="ident" id="6089292">buf</span><span class="op" id="6089295">[</span><span class="op" id="6089296">:</span><span class="num" id="6089297">2</span><span class="op" id="6089298">]</span><span class="op" id="6089299">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089302">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089337">e</span><span class="op" id="6089338">.</span><span class="ident" id="6089339">writeDQT</span><span class="op" id="6089347">(</span><span class="op" id="6089348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089351">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089383">e</span><span class="op" id="6089384">.</span><span class="ident" id="6089385">writeSOF0</span><span class="op" id="6089394">(</span><span class="ident" id="6089395">b</span><span class="op" id="6089396">.</span><span class="ident" id="6089397">Size</span><span class="op" id="6089401">(</span><span class="op" id="6089402">)</span><span class="op" id="6089403">,</span>&nbsp;<span class="ident" id="6089405">nComponent</span><span class="op" id="6089415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089418">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089448">e</span><span class="op" id="6089449">.</span><span class="ident" id="6089450">writeDHT</span><span class="op" id="6089458">(</span><span class="ident" id="6089459">nComponent</span><span class="op" id="6089469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089472">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089498">e</span><span class="op" id="6089499">.</span><span class="ident" id="6089500">writeSOS</span><span class="op" id="6089508">(</span><span class="ident" id="6089509">m</span><span class="op" id="6089510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089513">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089548">e</span><span class="op" id="6089549">.</span><span class="ident" id="6089550">buf</span><span class="op" id="6089553">[</span><span class="num" id="6089554">0</span><span class="op" id="6089555">]</span>&nbsp;<span class="op" id="6089557">=</span>&nbsp;<span class="num" id="6089559">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089565">e</span><span class="op" id="6089566">.</span><span class="ident" id="6089567">buf</span><span class="op" id="6089570">[</span><span class="num" id="6089571">1</span><span class="op" id="6089572">]</span>&nbsp;<span class="op" id="6089574">=</span>&nbsp;<span class="num" id="6089576">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089582">e</span><span class="op" id="6089583">.</span><span class="ident" id="6089584">write</span><span class="op" id="6089589">(</span><span class="ident" id="6089590">e</span><span class="op" id="6089591">.</span><span class="ident" id="6089592">buf</span><span class="op" id="6089595">[</span><span class="op" id="6089596">:</span><span class="num" id="6089597">2</span><span class="op" id="6089598">]</span><span class="op" id="6089599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089602">e</span><span class="op" id="6089603">.</span><span class="ident" id="6089604">flush</span><span class="op" id="6089609">(</span><span class="op" id="6089610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089613">return</span>&nbsp;<span class="ident" id="6089620">e</span><span class="op" id="6089621">.</span><span class="ident" id="6089622">err</span><br>
<span class="lineno"></span><span class="op" id="6089626">}</span>
</div>
</body>
</html>
