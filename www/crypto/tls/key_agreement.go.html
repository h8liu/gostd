<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4223451">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4223506">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4223560">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4223611">package</span>&nbsp;<span class="ident" id="4223619">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4223624">import</span>&nbsp;<span class="op" id="4223631">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223634">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223644">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223660">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223679">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223693">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223707">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223722">&#34;crypto/sha256&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223739">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223754">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223771">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223781">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4223787">&#34;math/big&#34;</span><br>
<span class="lineno">20</span><span class="op" id="4223798">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4223801">var</span>&nbsp;<span class="ident" id="4223805">errClientKeyExchange</span>&nbsp;<span class="op" id="4223826">=</span>&nbsp;<span class="ident" id="4223828"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4223834">.</span><span class="ident" id="4223835">New</span><span class="op" id="4223838">(</span><span class="string" id="4223839">&#34;tls:&nbsp;invalid&nbsp;ClientKeyExchange&nbsp;message&#34;</span><span class="op" id="4223879">)</span><br>
<span class="lineno"></span><span class="keyword" id="4223881">var</span>&nbsp;<span class="ident" id="4223885">errServerKeyExchange</span>&nbsp;<span class="op" id="4223906">=</span>&nbsp;<span class="ident" id="4223908"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4223914">.</span><span class="ident" id="4223915">New</span><span class="op" id="4223918">(</span><span class="string" id="4223919">&#34;tls:&nbsp;invalid&nbsp;ServerKeyExchange&nbsp;message&#34;</span><span class="op" id="4223959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4223962">//&nbsp;rsaKeyAgreement&nbsp;implements&nbsp;the&nbsp;standard&nbsp;TLS&nbsp;key&nbsp;agreement&nbsp;where&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span><span class="comment" id="4224040">//&nbsp;encrypts&nbsp;the&nbsp;pre-master&nbsp;secret&nbsp;to&nbsp;the&nbsp;server&#39;s&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4224102">type</span>&nbsp;<span class="ident" id="4224107">rsaKeyAgreement</span>&nbsp;<span class="keyword" id="4224123">struct</span><span class="op" id="4224129">{</span><span class="op" id="4224130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4224133">func</span>&nbsp;<span class="op" id="4224138">(</span><span class="ident" id="4224139">ka</span>&nbsp;<span class="ident" id="4224142"><a href="/crypto/tls/key_agreement.go.html#4224107">rsaKeyAgreement</a></span><span class="op" id="4224157">)</span>&nbsp;<span class="ident" id="4224159">generateServerKeyExchange</span><span class="op" id="4224184">(</span><span class="ident" id="4224185">config</span>&nbsp;<span class="op" id="4224192">*</span><span class="ident" id="4224193"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4224199">,</span>&nbsp;<span class="ident" id="4224201">cert</span>&nbsp;<span class="op" id="4224206">*</span><span class="ident" id="4224207"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="4224218">,</span>&nbsp;<span class="ident" id="4224220">clientHello</span>&nbsp;<span class="op" id="4224232">*</span><span class="ident" id="4224233"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="4224247">,</span>&nbsp;<span class="ident" id="4224249">hello</span>&nbsp;<span class="op" id="4224255">*</span><span class="ident" id="4224256"><a href="/crypto/tls/handshake_messages.go.html#4185078">serverHelloMsg</a></span><span class="op" id="4224270">)</span>&nbsp;<span class="op" id="4224272">(</span><span class="op" id="4224273">*</span><span class="ident" id="4224274"><a href="/crypto/tls/handshake_messages.go.html#4192159">serverKeyExchangeMsg</a></span><span class="op" id="4224294">,</span>&nbsp;<span class="builtintype" id="4224296">error</span><span class="op" id="4224301">)</span>&nbsp;<span class="op" id="4224303">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4224306">return</span>&nbsp;<span class="ident" id="4224313">nil</span><span class="op" id="4224316">,</span>&nbsp;<span class="ident" id="4224318">nil</span><br>
<span class="lineno"></span><span class="op" id="4224322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4224325">func</span>&nbsp;<span class="op" id="4224330">(</span><span class="ident" id="4224331">ka</span>&nbsp;<span class="ident" id="4224334"><a href="/crypto/tls/key_agreement.go.html#4224107">rsaKeyAgreement</a></span><span class="op" id="4224349">)</span>&nbsp;<span class="ident" id="4224351">processClientKeyExchange</span><span class="op" id="4224375">(</span><span class="ident" id="4224376">config</span>&nbsp;<span class="op" id="4224383">*</span><span class="ident" id="4224384"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4224390">,</span>&nbsp;<span class="ident" id="4224392">cert</span>&nbsp;<span class="op" id="4224397">*</span><span class="ident" id="4224398"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="4224409">,</span>&nbsp;<span class="ident" id="4224411">ckx</span>&nbsp;<span class="op" id="4224415">*</span><span class="ident" id="4224416"><a href="/crypto/tls/handshake_messages.go.html#4194449">clientKeyExchangeMsg</a></span><span class="op" id="4224436">,</span>&nbsp;<span class="ident" id="4224438">version</span>&nbsp;<span class="builtintype" id="4224446">uint16</span><span class="op" id="4224452">)</span>&nbsp;<span class="op" id="4224454">(</span><span class="op" id="4224455">[</span><span class="op" id="4224456">]</span><span class="builtintype" id="4224457">byte</span><span class="op" id="4224461">,</span>&nbsp;<span class="builtintype" id="4224463">error</span><span class="op" id="4224468">)</span>&nbsp;<span class="op" id="4224470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224473">preMasterSecret</span>&nbsp;<span class="op" id="4224489">:=</span>&nbsp;<span class="builtinfunc" id="4224492">make</span><span class="op" id="4224496">(</span><span class="op" id="4224497">[</span><span class="op" id="4224498">]</span><span class="builtintype" id="4224499">byte</span><span class="op" id="4224503">,</span>&nbsp;<span class="num" id="4224505">48</span><span class="op" id="4224507">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224510">_</span><span class="op" id="4224511">,</span>&nbsp;<span class="ident" id="4224513">err</span>&nbsp;<span class="op" id="4224517">:=</span>&nbsp;<span class="ident" id="4224520"><a href="/crypto/tls/key_agreement.go.html#4223781">io</a></span><span class="op" id="4224522">.</span><span class="ident" id="4224523">ReadFull</span><span class="op" id="4224531">(</span><span class="ident" id="4224532"><a href="/crypto/tls/key_agreement.go.html#4224376">config</a></span><span class="op" id="4224538">.</span><span class="ident" id="4224539">rand</span><span class="op" id="4224543">(</span><span class="op" id="4224544">)</span><span class="op" id="4224545">,</span>&nbsp;<span class="ident" id="4224547"><a href="/crypto/tls/key_agreement.go.html#4224473">preMasterSecret</a></span><span class="op" id="4224562">[</span><span class="num" id="4224563">2</span><span class="op" id="4224564">:</span><span class="op" id="4224565">]</span><span class="op" id="4224566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4224569">if</span>&nbsp;<span class="ident" id="4224572"><a href="/crypto/tls/key_agreement.go.html#4224513">err</a></span>&nbsp;<span class="op" id="4224576">!=</span>&nbsp;<span class="ident" id="4224579">nil</span>&nbsp;<span class="op" id="4224583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4224587">return</span>&nbsp;<span class="ident" id="4224594">nil</span><span class="op" id="4224597">,</span>&nbsp;<span class="ident" id="4224599"><a href="/crypto/tls/key_agreement.go.html#4224513">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4224604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4224608">if</span>&nbsp;<span class="builtinfunc" id="4224611">len</span><span class="op" id="4224614">(</span><span class="ident" id="4224615"><a href="/crypto/tls/key_agreement.go.html#4224411">ckx</a></span><span class="op" id="4224618">.</span><span class="ident" id="4224619">ciphertext</span><span class="op" id="4224629">)</span>&nbsp;<span class="op" id="4224631">&lt;</span>&nbsp;<span class="num" id="4224633">2</span>&nbsp;<span class="op" id="4224635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4224639">return</span>&nbsp;<span class="ident" id="4224646">nil</span><span class="op" id="4224649">,</span>&nbsp;<span class="ident" id="4224651"><a href="/crypto/tls/key_agreement.go.html#4223805">errClientKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4224673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224677">ciphertext</span>&nbsp;<span class="op" id="4224688">:=</span>&nbsp;<span class="ident" id="4224691"><a href="/crypto/tls/key_agreement.go.html#4224411">ckx</a></span><span class="op" id="4224694">.</span><span class="ident" id="4224695">ciphertext</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4224707">if</span>&nbsp;<span class="ident" id="4224710"><a href="/crypto/tls/key_agreement.go.html#4224438">version</a></span>&nbsp;<span class="op" id="4224718">!=</span>&nbsp;<span class="ident" id="4224721"><a href="/crypto/tls/common.go.html#4108136">VersionSSL30</a></span>&nbsp;<span class="op" id="4224734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224738">ciphertextLen</span>&nbsp;<span class="op" id="4224752">:=</span>&nbsp;<span class="builtintype" id="4224755">int</span><span class="op" id="4224758">(</span><span class="ident" id="4224759"><a href="/crypto/tls/key_agreement.go.html#4224411">ckx</a></span><span class="op" id="4224762">.</span><span class="ident" id="4224763">ciphertext</span><span class="op" id="4224773">[</span><span class="num" id="4224774">0</span><span class="op" id="4224775">]</span><span class="op" id="4224776">)</span><span class="op" id="4224777">&lt;&lt;</span><span class="num" id="4224779">8</span>&nbsp;<span class="op" id="4224781">|</span>&nbsp;<span class="builtintype" id="4224783">int</span><span class="op" id="4224786">(</span><span class="ident" id="4224787"><a href="/crypto/tls/key_agreement.go.html#4224411">ckx</a></span><span class="op" id="4224790">.</span><span class="ident" id="4224791">ciphertext</span><span class="op" id="4224801">[</span><span class="num" id="4224802">1</span><span class="op" id="4224803">]</span><span class="op" id="4224804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4224808">if</span>&nbsp;<span class="ident" id="4224811"><a href="/crypto/tls/key_agreement.go.html#4224738">ciphertextLen</a></span>&nbsp;<span class="op" id="4224825">!=</span>&nbsp;<span class="builtinfunc" id="4224828">len</span><span class="op" id="4224831">(</span><span class="ident" id="4224832"><a href="/crypto/tls/key_agreement.go.html#4224411">ckx</a></span><span class="op" id="4224835">.</span><span class="ident" id="4224836">ciphertext</span><span class="op" id="4224846">)</span><span class="op" id="4224847">-</span><span class="num" id="4224848">2</span>&nbsp;<span class="op" id="4224850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4224855">return</span>&nbsp;<span class="ident" id="4224862">nil</span><span class="op" id="4224865">,</span>&nbsp;<span class="ident" id="4224867"><a href="/crypto/tls/key_agreement.go.html#4223805">errClientKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4224890">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224894"><a href="/crypto/tls/key_agreement.go.html#4224677">ciphertext</a></span>&nbsp;<span class="op" id="4224905">=</span>&nbsp;<span class="ident" id="4224907"><a href="/crypto/tls/key_agreement.go.html#4224411">ckx</a></span><span class="op" id="4224910">.</span><span class="ident" id="4224911">ciphertext</span><span class="op" id="4224921">[</span><span class="num" id="4224922">2</span><span class="op" id="4224923">:</span><span class="op" id="4224924">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4224927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224931"><a href="/crypto/tls/key_agreement.go.html#4224513">err</a></span>&nbsp;<span class="op" id="4224935">=</span>&nbsp;<span class="ident" id="4224937"><a href="/crypto/tls/key_agreement.go.html#4223693">rsa</a></span><span class="op" id="4224940">.</span><span class="ident" id="4224941">DecryptPKCS1v15SessionKey</span><span class="op" id="4224966">(</span><span class="ident" id="4224967"><a href="/crypto/tls/key_agreement.go.html#4224376">config</a></span><span class="op" id="4224973">.</span><span class="ident" id="4224974">rand</span><span class="op" id="4224978">(</span><span class="op" id="4224979">)</span><span class="op" id="4224980">,</span>&nbsp;<span class="ident" id="4224982"><a href="/crypto/tls/key_agreement.go.html#4224392">cert</a></span><span class="op" id="4224986">.</span><span class="ident" id="4224987">PrivateKey</span><span class="op" id="4224997">.</span><span class="op" id="4224998">(</span><span class="op" id="4224999">*</span><span class="ident" id="4225000"><a href="/crypto/tls/key_agreement.go.html#4223693">rsa</a></span><span class="op" id="4225003">.</span><span class="ident" id="4225004">PrivateKey</span><span class="op" id="4225014">)</span><span class="op" id="4225015">,</span>&nbsp;<span class="ident" id="4225017"><a href="/crypto/tls/key_agreement.go.html#4224677">ciphertext</a></span><span class="op" id="4225027">,</span>&nbsp;<span class="ident" id="4225029"><a href="/crypto/tls/key_agreement.go.html#4224473">preMasterSecret</a></span><span class="op" id="4225044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4225047">if</span>&nbsp;<span class="ident" id="4225050"><a href="/crypto/tls/key_agreement.go.html#4224513">err</a></span>&nbsp;<span class="op" id="4225054">!=</span>&nbsp;<span class="ident" id="4225057">nil</span>&nbsp;<span class="op" id="4225061">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4225065">return</span>&nbsp;<span class="ident" id="4225072">nil</span><span class="op" id="4225075">,</span>&nbsp;<span class="ident" id="4225077"><a href="/crypto/tls/key_agreement.go.html#4224513">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4225082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4225085">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;the&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;premaster&nbsp;secret.&nbsp;&nbsp;For&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4225158">//&nbsp;by&nbsp;checking&nbsp;it,&nbsp;we&nbsp;would&nbsp;leak&nbsp;information&nbsp;about&nbsp;the&nbsp;validity&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4225230">//&nbsp;encrypted&nbsp;pre-master&nbsp;secret.&nbsp;Secondly,&nbsp;it&nbsp;provides&nbsp;only&nbsp;a&nbsp;small</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4225298">//&nbsp;benefit&nbsp;against&nbsp;a&nbsp;downgrade&nbsp;attack&nbsp;and&nbsp;some&nbsp;implementations&nbsp;send&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4225371">//&nbsp;wrong&nbsp;version&nbsp;anyway.&nbsp;See&nbsp;the&nbsp;discussion&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4225438">//&nbsp;7.4.7.1&nbsp;of&nbsp;RFC&nbsp;4346.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4225463">return</span>&nbsp;<span class="ident" id="4225470"><a href="/crypto/tls/key_agreement.go.html#4224473">preMasterSecret</a></span><span class="op" id="4225485">,</span>&nbsp;<span class="ident" id="4225487">nil</span><br>
<span class="lineno"></span><span class="op" id="4225491">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="4225494">func</span>&nbsp;<span class="op" id="4225499">(</span><span class="ident" id="4225500">ka</span>&nbsp;<span class="ident" id="4225503"><a href="/crypto/tls/key_agreement.go.html#4224107">rsaKeyAgreement</a></span><span class="op" id="4225518">)</span>&nbsp;<span class="ident" id="4225520">processServerKeyExchange</span><span class="op" id="4225544">(</span><span class="ident" id="4225545">config</span>&nbsp;<span class="op" id="4225552">*</span><span class="ident" id="4225553"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4225559">,</span>&nbsp;<span class="ident" id="4225561">clientHello</span>&nbsp;<span class="op" id="4225573">*</span><span class="ident" id="4225574"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="4225588">,</span>&nbsp;<span class="ident" id="4225590">serverHello</span>&nbsp;<span class="op" id="4225602">*</span><span class="ident" id="4225603"><a href="/crypto/tls/handshake_messages.go.html#4185078">serverHelloMsg</a></span><span class="op" id="4225617">,</span>&nbsp;<span class="ident" id="4225619">cert</span>&nbsp;<span class="op" id="4225624">*</span><span class="ident" id="4225625"><a href="/crypto/tls/key_agreement.go.html#4223739">x509</a></span><span class="op" id="4225629">.</span><span class="ident" id="4225630">Certificate</span><span class="op" id="4225641">,</span>&nbsp;<span class="ident" id="4225643">skx</span>&nbsp;<span class="op" id="4225647">*</span><span class="ident" id="4225648"><a href="/crypto/tls/handshake_messages.go.html#4192159">serverKeyExchangeMsg</a></span><span class="op" id="4225668">)</span>&nbsp;<span class="builtintype" id="4225670">error</span>&nbsp;<span class="op" id="4225676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4225679">return</span>&nbsp;<span class="ident" id="4225686"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4225692">.</span><span class="ident" id="4225693">New</span><span class="op" id="4225696">(</span><span class="string" id="4225697">&#34;tls:&nbsp;unexpected&nbsp;ServerKeyExchange&#34;</span><span class="op" id="4225732">)</span><br>
<span class="lineno"></span><span class="op" id="4225734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4225737">func</span>&nbsp;<span class="op" id="4225742">(</span><span class="ident" id="4225743">ka</span>&nbsp;<span class="ident" id="4225746"><a href="/crypto/tls/key_agreement.go.html#4224107">rsaKeyAgreement</a></span><span class="op" id="4225761">)</span>&nbsp;<span class="ident" id="4225763">generateClientKeyExchange</span><span class="op" id="4225788">(</span><span class="ident" id="4225789">config</span>&nbsp;<span class="op" id="4225796">*</span><span class="ident" id="4225797"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4225803">,</span>&nbsp;<span class="ident" id="4225805">clientHello</span>&nbsp;<span class="op" id="4225817">*</span><span class="ident" id="4225818"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="4225832">,</span>&nbsp;<span class="ident" id="4225834">cert</span>&nbsp;<span class="op" id="4225839">*</span><span class="ident" id="4225840"><a href="/crypto/tls/key_agreement.go.html#4223739">x509</a></span><span class="op" id="4225844">.</span><span class="ident" id="4225845">Certificate</span><span class="op" id="4225856">)</span>&nbsp;<span class="op" id="4225858">(</span><span class="op" id="4225859">[</span><span class="op" id="4225860">]</span><span class="builtintype" id="4225861">byte</span><span class="op" id="4225865">,</span>&nbsp;<span class="op" id="4225867">*</span><span class="ident" id="4225868"><a href="/crypto/tls/handshake_messages.go.html#4194449">clientKeyExchangeMsg</a></span><span class="op" id="4225888">,</span>&nbsp;<span class="builtintype" id="4225890">error</span><span class="op" id="4225895">)</span>&nbsp;<span class="op" id="4225897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4225900">preMasterSecret</span>&nbsp;<span class="op" id="4225916">:=</span>&nbsp;<span class="builtinfunc" id="4225919">make</span><span class="op" id="4225923">(</span><span class="op" id="4225924">[</span><span class="op" id="4225925">]</span><span class="builtintype" id="4225926">byte</span><span class="op" id="4225930">,</span>&nbsp;<span class="num" id="4225932">48</span><span class="op" id="4225934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4225937"><a href="/crypto/tls/key_agreement.go.html#4225900">preMasterSecret</a></span><span class="op" id="4225952">[</span><span class="num" id="4225953">0</span><span class="op" id="4225954">]</span>&nbsp;<span class="op" id="4225956">=</span>&nbsp;<span class="builtintype" id="4225958">byte</span><span class="op" id="4225962">(</span><span class="ident" id="4225963"><a href="/crypto/tls/key_agreement.go.html#4225805">clientHello</a></span><span class="op" id="4225974">.</span><span class="ident" id="4225975">vers</span>&nbsp;<span class="op" id="4225980">&gt;&gt;</span>&nbsp;<span class="num" id="4225983">8</span><span class="op" id="4225984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4225987"><a href="/crypto/tls/key_agreement.go.html#4225900">preMasterSecret</a></span><span class="op" id="4226002">[</span><span class="num" id="4226003">1</span><span class="op" id="4226004">]</span>&nbsp;<span class="op" id="4226006">=</span>&nbsp;<span class="builtintype" id="4226008">byte</span><span class="op" id="4226012">(</span><span class="ident" id="4226013"><a href="/crypto/tls/key_agreement.go.html#4225805">clientHello</a></span><span class="op" id="4226024">.</span><span class="ident" id="4226025">vers</span><span class="op" id="4226029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226032">_</span><span class="op" id="4226033">,</span>&nbsp;<span class="ident" id="4226035">err</span>&nbsp;<span class="op" id="4226039">:=</span>&nbsp;<span class="ident" id="4226042"><a href="/crypto/tls/key_agreement.go.html#4223781">io</a></span><span class="op" id="4226044">.</span><span class="ident" id="4226045">ReadFull</span><span class="op" id="4226053">(</span><span class="ident" id="4226054"><a href="/crypto/tls/key_agreement.go.html#4225789">config</a></span><span class="op" id="4226060">.</span><span class="ident" id="4226061">rand</span><span class="op" id="4226065">(</span><span class="op" id="4226066">)</span><span class="op" id="4226067">,</span>&nbsp;<span class="ident" id="4226069"><a href="/crypto/tls/key_agreement.go.html#4225900">preMasterSecret</a></span><span class="op" id="4226084">[</span><span class="num" id="4226085">2</span><span class="op" id="4226086">:</span><span class="op" id="4226087">]</span><span class="op" id="4226088">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4226091">if</span>&nbsp;<span class="ident" id="4226094"><a href="/crypto/tls/key_agreement.go.html#4226035">err</a></span>&nbsp;<span class="op" id="4226098">!=</span>&nbsp;<span class="ident" id="4226101">nil</span>&nbsp;<span class="op" id="4226105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4226109">return</span>&nbsp;<span class="ident" id="4226116">nil</span><span class="op" id="4226119">,</span>&nbsp;<span class="ident" id="4226121">nil</span><span class="op" id="4226124">,</span>&nbsp;<span class="ident" id="4226126"><a href="/crypto/tls/key_agreement.go.html#4226035">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4226131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226135">encrypted</span><span class="op" id="4226144">,</span>&nbsp;<span class="ident" id="4226146"><a href="/crypto/tls/key_agreement.go.html#4226035">err</a></span>&nbsp;<span class="op" id="4226150">:=</span>&nbsp;<span class="ident" id="4226153"><a href="/crypto/tls/key_agreement.go.html#4223693">rsa</a></span><span class="op" id="4226156">.</span><span class="ident" id="4226157">EncryptPKCS1v15</span><span class="op" id="4226172">(</span><span class="ident" id="4226173"><a href="/crypto/tls/key_agreement.go.html#4225789">config</a></span><span class="op" id="4226179">.</span><span class="ident" id="4226180">rand</span><span class="op" id="4226184">(</span><span class="op" id="4226185">)</span><span class="op" id="4226186">,</span>&nbsp;<span class="ident" id="4226188"><a href="/crypto/tls/key_agreement.go.html#4225834">cert</a></span><span class="op" id="4226192">.</span><span class="ident" id="4226193">PublicKey</span><span class="op" id="4226202">.</span><span class="op" id="4226203">(</span><span class="op" id="4226204">*</span><span class="ident" id="4226205"><a href="/crypto/tls/key_agreement.go.html#4223693">rsa</a></span><span class="op" id="4226208">.</span><span class="ident" id="4226209">PublicKey</span><span class="op" id="4226218">)</span><span class="op" id="4226219">,</span>&nbsp;<span class="ident" id="4226221"><a href="/crypto/tls/key_agreement.go.html#4225900">preMasterSecret</a></span><span class="op" id="4226236">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4226239">if</span>&nbsp;<span class="ident" id="4226242"><a href="/crypto/tls/key_agreement.go.html#4226035">err</a></span>&nbsp;<span class="op" id="4226246">!=</span>&nbsp;<span class="ident" id="4226249">nil</span>&nbsp;<span class="op" id="4226253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4226257">return</span>&nbsp;<span class="ident" id="4226264">nil</span><span class="op" id="4226267">,</span>&nbsp;<span class="ident" id="4226269">nil</span><span class="op" id="4226272">,</span>&nbsp;<span class="ident" id="4226274"><a href="/crypto/tls/key_agreement.go.html#4226035">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4226279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226282">ckx</span>&nbsp;<span class="op" id="4226286">:=</span>&nbsp;<span class="builtinfunc" id="4226289">new</span><span class="op" id="4226292">(</span><span class="ident" id="4226293"><a href="/crypto/tls/handshake_messages.go.html#4194449">clientKeyExchangeMsg</a></span><span class="op" id="4226313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226316"><a href="/crypto/tls/key_agreement.go.html#4226282">ckx</a></span><span class="op" id="4226319">.</span><span class="ident" id="4226320">ciphertext</span>&nbsp;<span class="op" id="4226331">=</span>&nbsp;<span class="builtinfunc" id="4226333">make</span><span class="op" id="4226337">(</span><span class="op" id="4226338">[</span><span class="op" id="4226339">]</span><span class="builtintype" id="4226340">byte</span><span class="op" id="4226344">,</span>&nbsp;<span class="builtinfunc" id="4226346">len</span><span class="op" id="4226349">(</span><span class="ident" id="4226350"><a href="/crypto/tls/key_agreement.go.html#4226135">encrypted</a></span><span class="op" id="4226359">)</span><span class="op" id="4226360">+</span><span class="num" id="4226361">2</span><span class="op" id="4226362">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226365"><a href="/crypto/tls/key_agreement.go.html#4226282">ckx</a></span><span class="op" id="4226368">.</span><span class="ident" id="4226369">ciphertext</span><span class="op" id="4226379">[</span><span class="num" id="4226380">0</span><span class="op" id="4226381">]</span>&nbsp;<span class="op" id="4226383">=</span>&nbsp;<span class="builtintype" id="4226385">byte</span><span class="op" id="4226389">(</span><span class="builtinfunc" id="4226390">len</span><span class="op" id="4226393">(</span><span class="ident" id="4226394"><a href="/crypto/tls/key_agreement.go.html#4226135">encrypted</a></span><span class="op" id="4226403">)</span>&nbsp;<span class="op" id="4226405">&gt;&gt;</span>&nbsp;<span class="num" id="4226408">8</span><span class="op" id="4226409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226412"><a href="/crypto/tls/key_agreement.go.html#4226282">ckx</a></span><span class="op" id="4226415">.</span><span class="ident" id="4226416">ciphertext</span><span class="op" id="4226426">[</span><span class="num" id="4226427">1</span><span class="op" id="4226428">]</span>&nbsp;<span class="op" id="4226430">=</span>&nbsp;<span class="builtintype" id="4226432">byte</span><span class="op" id="4226436">(</span><span class="builtinfunc" id="4226437">len</span><span class="op" id="4226440">(</span><span class="ident" id="4226441"><a href="/crypto/tls/key_agreement.go.html#4226135">encrypted</a></span><span class="op" id="4226450">)</span><span class="op" id="4226451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4226454">copy</span><span class="op" id="4226458">(</span><span class="ident" id="4226459"><a href="/crypto/tls/key_agreement.go.html#4226282">ckx</a></span><span class="op" id="4226462">.</span><span class="ident" id="4226463">ciphertext</span><span class="op" id="4226473">[</span><span class="num" id="4226474">2</span><span class="op" id="4226475">:</span><span class="op" id="4226476">]</span><span class="op" id="4226477">,</span>&nbsp;<span class="ident" id="4226479"><a href="/crypto/tls/key_agreement.go.html#4226135">encrypted</a></span><span class="op" id="4226488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4226491">return</span>&nbsp;<span class="ident" id="4226498"><a href="/crypto/tls/key_agreement.go.html#4225900">preMasterSecret</a></span><span class="op" id="4226513">,</span>&nbsp;<span class="ident" id="4226515"><a href="/crypto/tls/key_agreement.go.html#4226282">ckx</a></span><span class="op" id="4226518">,</span>&nbsp;<span class="ident" id="4226520">nil</span><br>
<span class="lineno"></span><span class="op" id="4226524">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4226527">//&nbsp;sha1Hash&nbsp;calculates&nbsp;a&nbsp;SHA1&nbsp;hash&nbsp;over&nbsp;the&nbsp;given&nbsp;byte&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4226590">func</span>&nbsp;<span class="ident" id="4226595">sha1Hash</span><span class="op" id="4226603">(</span><span class="ident" id="4226604">slices</span>&nbsp;<span class="op" id="4226611">[</span><span class="op" id="4226612">]</span><span class="op" id="4226613">[</span><span class="op" id="4226614">]</span><span class="builtintype" id="4226615">byte</span><span class="op" id="4226619">)</span>&nbsp;<span class="op" id="4226621">[</span><span class="op" id="4226622">]</span><span class="builtintype" id="4226623">byte</span>&nbsp;<span class="op" id="4226628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226631">hsha1</span>&nbsp;<span class="op" id="4226637">:=</span>&nbsp;<span class="ident" id="4226640"><a href="/crypto/tls/key_agreement.go.html#4223707">sha1</a></span><span class="op" id="4226644">.</span><span class="ident" id="4226645">New</span><span class="op" id="4226648">(</span><span class="op" id="4226649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4226652">for</span>&nbsp;<span class="ident" id="4226656">_</span><span class="op" id="4226657">,</span>&nbsp;<span class="ident" id="4226659">slice</span>&nbsp;<span class="op" id="4226665">:=</span>&nbsp;<span class="keyword" id="4226668">range</span>&nbsp;<span class="ident" id="4226674"><a href="/crypto/tls/key_agreement.go.html#4226604">slices</a></span>&nbsp;<span class="op" id="4226681">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226685"><a href="/crypto/tls/key_agreement.go.html#4226631">hsha1</a></span><span class="op" id="4226690">.</span><span class="ident" id="4226691">Write</span><span class="op" id="4226696">(</span><span class="ident" id="4226697"><a href="/crypto/tls/key_agreement.go.html#4226659">slice</a></span><span class="op" id="4226702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4226705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4226708">return</span>&nbsp;<span class="ident" id="4226715"><a href="/crypto/tls/key_agreement.go.html#4226631">hsha1</a></span><span class="op" id="4226720">.</span><span class="ident" id="4226721">Sum</span><span class="op" id="4226724">(</span><span class="ident" id="4226725">nil</span><span class="op" id="4226728">)</span><br>
<span class="lineno"></span><span class="op" id="4226730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="4226733">//&nbsp;md5SHA1Hash&nbsp;implements&nbsp;TLS&nbsp;1.0&#39;s&nbsp;hybrid&nbsp;hash&nbsp;function&nbsp;which&nbsp;consists&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4226812">//&nbsp;concatenation&nbsp;of&nbsp;an&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hash.</span><br>
<span class="lineno"></span><span class="keyword" id="4226854">func</span>&nbsp;<span class="ident" id="4226859">md5SHA1Hash</span><span class="op" id="4226870">(</span><span class="ident" id="4226871">slices</span>&nbsp;<span class="op" id="4226878">[</span><span class="op" id="4226879">]</span><span class="op" id="4226880">[</span><span class="op" id="4226881">]</span><span class="builtintype" id="4226882">byte</span><span class="op" id="4226886">)</span>&nbsp;<span class="op" id="4226888">[</span><span class="op" id="4226889">]</span><span class="builtintype" id="4226890">byte</span>&nbsp;<span class="op" id="4226895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226898">md5sha1</span>&nbsp;<span class="op" id="4226906">:=</span>&nbsp;<span class="builtinfunc" id="4226909">make</span><span class="op" id="4226913">(</span><span class="op" id="4226914">[</span><span class="op" id="4226915">]</span><span class="builtintype" id="4226916">byte</span><span class="op" id="4226920">,</span>&nbsp;<span class="ident" id="4226922"><a href="/crypto/tls/key_agreement.go.html#4223679">md5</a></span><span class="op" id="4226925">.</span><span class="ident" id="4226926">Size</span><span class="op" id="4226930">+</span><span class="ident" id="4226931"><a href="/crypto/tls/key_agreement.go.html#4223707">sha1</a></span><span class="op" id="4226935">.</span><span class="ident" id="4226936">Size</span><span class="op" id="4226940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226943">hmd5</span>&nbsp;<span class="op" id="4226948">:=</span>&nbsp;<span class="ident" id="4226951"><a href="/crypto/tls/key_agreement.go.html#4223679">md5</a></span><span class="op" id="4226954">.</span><span class="ident" id="4226955">New</span><span class="op" id="4226958">(</span><span class="op" id="4226959">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4226962">for</span>&nbsp;<span class="ident" id="4226966">_</span><span class="op" id="4226967">,</span>&nbsp;<span class="ident" id="4226969">slice</span>&nbsp;<span class="op" id="4226975">:=</span>&nbsp;<span class="keyword" id="4226978">range</span>&nbsp;<span class="ident" id="4226984"><a href="/crypto/tls/key_agreement.go.html#4226871">slices</a></span>&nbsp;<span class="op" id="4226991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226995"><a href="/crypto/tls/key_agreement.go.html#4226943">hmd5</a></span><span class="op" id="4226999">.</span><span class="ident" id="4227000">Write</span><span class="op" id="4227005">(</span><span class="ident" id="4227006"><a href="/crypto/tls/key_agreement.go.html#4226969">slice</a></span><span class="op" id="4227011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4227014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4227017">copy</span><span class="op" id="4227021">(</span><span class="ident" id="4227022"><a href="/crypto/tls/key_agreement.go.html#4226898">md5sha1</a></span><span class="op" id="4227029">,</span>&nbsp;<span class="ident" id="4227031"><a href="/crypto/tls/key_agreement.go.html#4226943">hmd5</a></span><span class="op" id="4227035">.</span><span class="ident" id="4227036">Sum</span><span class="op" id="4227039">(</span><span class="ident" id="4227040">nil</span><span class="op" id="4227043">)</span><span class="op" id="4227044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4227047">copy</span><span class="op" id="4227051">(</span><span class="ident" id="4227052"><a href="/crypto/tls/key_agreement.go.html#4226898">md5sha1</a></span><span class="op" id="4227059">[</span><span class="ident" id="4227060"><a href="/crypto/tls/key_agreement.go.html#4223679">md5</a></span><span class="op" id="4227063">.</span><span class="ident" id="4227064">Size</span><span class="op" id="4227068">:</span><span class="op" id="4227069">]</span><span class="op" id="4227070">,</span>&nbsp;<span class="ident" id="4227072"><a href="/crypto/tls/key_agreement.go.html#4226595">sha1Hash</a></span><span class="op" id="4227080">(</span><span class="ident" id="4227081"><a href="/crypto/tls/key_agreement.go.html#4226871">slices</a></span><span class="op" id="4227087">)</span><span class="op" id="4227088">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227091">return</span>&nbsp;<span class="ident" id="4227098"><a href="/crypto/tls/key_agreement.go.html#4226898">md5sha1</a></span><br>
<span class="lineno"></span><span class="op" id="4227106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4227109">//&nbsp;sha256Hash&nbsp;implements&nbsp;TLS&nbsp;1.2&#39;s&nbsp;hash&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="4227159">func</span>&nbsp;<span class="ident" id="4227164">sha256Hash</span><span class="op" id="4227174">(</span><span class="ident" id="4227175">slices</span>&nbsp;<span class="op" id="4227182">[</span><span class="op" id="4227183">]</span><span class="op" id="4227184">[</span><span class="op" id="4227185">]</span><span class="builtintype" id="4227186">byte</span><span class="op" id="4227190">)</span>&nbsp;<span class="op" id="4227192">[</span><span class="op" id="4227193">]</span><span class="builtintype" id="4227194">byte</span>&nbsp;<span class="op" id="4227199">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4227202">h</span>&nbsp;<span class="op" id="4227204">:=</span>&nbsp;<span class="ident" id="4227207"><a href="/crypto/tls/key_agreement.go.html#4223722">sha256</a></span><span class="op" id="4227213">.</span><span class="ident" id="4227214">New</span><span class="op" id="4227217">(</span><span class="op" id="4227218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227221">for</span>&nbsp;<span class="ident" id="4227225">_</span><span class="op" id="4227226">,</span>&nbsp;<span class="ident" id="4227228">slice</span>&nbsp;<span class="op" id="4227234">:=</span>&nbsp;<span class="keyword" id="4227237">range</span>&nbsp;<span class="ident" id="4227243"><a href="/crypto/tls/key_agreement.go.html#4227175">slices</a></span>&nbsp;<span class="op" id="4227250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4227254"><a href="/crypto/tls/key_agreement.go.html#4227202">h</a></span><span class="op" id="4227255">.</span><span class="ident" id="4227256">Write</span><span class="op" id="4227261">(</span><span class="ident" id="4227262"><a href="/crypto/tls/key_agreement.go.html#4227228">slice</a></span><span class="op" id="4227267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4227270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227273">return</span>&nbsp;<span class="ident" id="4227280"><a href="/crypto/tls/key_agreement.go.html#4227202">h</a></span><span class="op" id="4227281">.</span><span class="ident" id="4227282">Sum</span><span class="op" id="4227285">(</span><span class="ident" id="4227286">nil</span><span class="op" id="4227289">)</span><br>
<span class="lineno">120</span><span class="op" id="4227291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4227294">//&nbsp;hashForServerKeyExchange&nbsp;hashes&nbsp;the&nbsp;given&nbsp;slices&nbsp;and&nbsp;returns&nbsp;their&nbsp;digest</span><br>
<span class="lineno"></span><span class="comment" id="4227371">//&nbsp;and&nbsp;the&nbsp;identifier&nbsp;of&nbsp;the&nbsp;hash&nbsp;function&nbsp;used.&nbsp;The&nbsp;hashFunc&nbsp;argument&nbsp;is&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="4227450">//&nbsp;used&nbsp;for&nbsp;&gt;=&nbsp;TLS&nbsp;1.2&nbsp;and&nbsp;precisely&nbsp;identifies&nbsp;the&nbsp;hash&nbsp;function&nbsp;to&nbsp;use.</span><br>
<span class="lineno">125</span><span class="keyword" id="4227524">func</span>&nbsp;<span class="ident" id="4227529">hashForServerKeyExchange</span><span class="op" id="4227553">(</span><span class="ident" id="4227554">sigType</span><span class="op" id="4227561">,</span>&nbsp;<span class="ident" id="4227563">hashFunc</span>&nbsp;<span class="builtintype" id="4227572">uint8</span><span class="op" id="4227577">,</span>&nbsp;<span class="ident" id="4227579">version</span>&nbsp;<span class="builtintype" id="4227587">uint16</span><span class="op" id="4227593">,</span>&nbsp;<span class="ident" id="4227595">slices</span>&nbsp;<span class="op" id="4227602">...</span><span class="op" id="4227605">[</span><span class="op" id="4227606">]</span><span class="builtintype" id="4227607">byte</span><span class="op" id="4227611">)</span>&nbsp;<span class="op" id="4227613">(</span><span class="op" id="4227614">[</span><span class="op" id="4227615">]</span><span class="builtintype" id="4227616">byte</span><span class="op" id="4227620">,</span>&nbsp;<span class="ident" id="4227622"><a href="/crypto/tls/key_agreement.go.html#4223634">crypto</a></span><span class="op" id="4227628">.</span><span class="ident" id="4227629">Hash</span><span class="op" id="4227633">,</span>&nbsp;<span class="builtintype" id="4227635">error</span><span class="op" id="4227640">)</span>&nbsp;<span class="op" id="4227642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227645">if</span>&nbsp;<span class="ident" id="4227648"><a href="/crypto/tls/key_agreement.go.html#4227579">version</a></span>&nbsp;<span class="op" id="4227656">&gt;=</span>&nbsp;<span class="ident" id="4227659"><a href="/crypto/tls/common.go.html#4108205">VersionTLS12</a></span>&nbsp;<span class="op" id="4227672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227676">switch</span>&nbsp;<span class="ident" id="4227683"><a href="/crypto/tls/key_agreement.go.html#4227563">hashFunc</a></span>&nbsp;<span class="op" id="4227692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227696">case</span>&nbsp;<span class="ident" id="4227701"><a href="/crypto/tls/common.go.html#4111189">hashSHA256</a></span><span class="op" id="4227711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227716">return</span>&nbsp;<span class="ident" id="4227723"><a href="/crypto/tls/key_agreement.go.html#4227164">sha256Hash</a></span><span class="op" id="4227733">(</span><span class="ident" id="4227734"><a href="/crypto/tls/key_agreement.go.html#4227595">slices</a></span><span class="op" id="4227740">)</span><span class="op" id="4227741">,</span>&nbsp;<span class="ident" id="4227743"><a href="/crypto/tls/key_agreement.go.html#4223634">crypto</a></span><span class="op" id="4227749">.</span><span class="ident" id="4227750">SHA256</span><span class="op" id="4227756">,</span>&nbsp;<span class="ident" id="4227758">nil</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227764">case</span>&nbsp;<span class="ident" id="4227769"><a href="/crypto/tls/common.go.html#4111167">hashSHA1</a></span><span class="op" id="4227777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227782">return</span>&nbsp;<span class="ident" id="4227789"><a href="/crypto/tls/key_agreement.go.html#4226595">sha1Hash</a></span><span class="op" id="4227797">(</span><span class="ident" id="4227798"><a href="/crypto/tls/key_agreement.go.html#4227595">slices</a></span><span class="op" id="4227804">)</span><span class="op" id="4227805">,</span>&nbsp;<span class="ident" id="4227807"><a href="/crypto/tls/key_agreement.go.html#4223634">crypto</a></span><span class="op" id="4227813">.</span><span class="ident" id="4227814">SHA1</span><span class="op" id="4227818">,</span>&nbsp;<span class="ident" id="4227820">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227826">default</span><span class="op" id="4227833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227838">return</span>&nbsp;<span class="ident" id="4227845">nil</span><span class="op" id="4227848">,</span>&nbsp;<span class="ident" id="4227850"><a href="/crypto/tls/key_agreement.go.html#4223634">crypto</a></span><span class="op" id="4227856">.</span><span class="ident" id="4227857">Hash</span><span class="op" id="4227861">(</span><span class="num" id="4227862">0</span><span class="op" id="4227863">)</span><span class="op" id="4227864">,</span>&nbsp;<span class="ident" id="4227866"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4227872">.</span><span class="ident" id="4227873">New</span><span class="op" id="4227876">(</span><span class="string" id="4227877">&#34;tls:&nbsp;unknown&nbsp;hash&nbsp;function&nbsp;used&nbsp;by&nbsp;peer&#34;</span><span class="op" id="4227918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4227922">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4227925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227928">if</span>&nbsp;<span class="ident" id="4227931"><a href="/crypto/tls/key_agreement.go.html#4227554">sigType</a></span>&nbsp;<span class="op" id="4227939">==</span>&nbsp;<span class="ident" id="4227942"><a href="/crypto/tls/common.go.html#4111314">signatureECDSA</a></span>&nbsp;<span class="op" id="4227957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227961">return</span>&nbsp;<span class="ident" id="4227968"><a href="/crypto/tls/key_agreement.go.html#4226595">sha1Hash</a></span><span class="op" id="4227976">(</span><span class="ident" id="4227977"><a href="/crypto/tls/key_agreement.go.html#4227595">slices</a></span><span class="op" id="4227983">)</span><span class="op" id="4227984">,</span>&nbsp;<span class="ident" id="4227986"><a href="/crypto/tls/key_agreement.go.html#4223634">crypto</a></span><span class="op" id="4227992">.</span><span class="ident" id="4227993">SHA1</span><span class="op" id="4227997">,</span>&nbsp;<span class="ident" id="4227999">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4228004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228007">return</span>&nbsp;<span class="ident" id="4228014"><a href="/crypto/tls/key_agreement.go.html#4226859">md5SHA1Hash</a></span><span class="op" id="4228025">(</span><span class="ident" id="4228026"><a href="/crypto/tls/key_agreement.go.html#4227595">slices</a></span><span class="op" id="4228032">)</span><span class="op" id="4228033">,</span>&nbsp;<span class="ident" id="4228035"><a href="/crypto/tls/key_agreement.go.html#4223634">crypto</a></span><span class="op" id="4228041">.</span><span class="ident" id="4228042">MD5SHA1</span><span class="op" id="4228049">,</span>&nbsp;<span class="ident" id="4228051">nil</span><br>
<span class="lineno">140</span><span class="op" id="4228055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4228058">//&nbsp;pickTLS12HashForSignature&nbsp;returns&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;hash&nbsp;identifier&nbsp;for&nbsp;signing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4228135">//&nbsp;ServerKeyExchange&nbsp;given&nbsp;the&nbsp;signature&nbsp;type&nbsp;being&nbsp;used&nbsp;and&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4228209">//&nbsp;advertised&nbsp;list&nbsp;of&nbsp;supported&nbsp;signature&nbsp;and&nbsp;hash&nbsp;combinations.</span><br>
<span class="lineno">145</span><span class="keyword" id="4228274">func</span>&nbsp;<span class="ident" id="4228279">pickTLS12HashForSignature</span><span class="op" id="4228304">(</span><span class="ident" id="4228305">sigType</span>&nbsp;<span class="builtintype" id="4228313">uint8</span><span class="op" id="4228318">,</span>&nbsp;<span class="ident" id="4228320">clientSignatureAndHashes</span>&nbsp;<span class="op" id="4228345">[</span><span class="op" id="4228346">]</span><span class="ident" id="4228347"><a href="/crypto/tls/common.go.html#4111454">signatureAndHash</a></span><span class="op" id="4228363">)</span>&nbsp;<span class="op" id="4228365">(</span><span class="builtintype" id="4228366">uint8</span><span class="op" id="4228371">,</span>&nbsp;<span class="builtintype" id="4228373">error</span><span class="op" id="4228378">)</span>&nbsp;<span class="op" id="4228380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228383">if</span>&nbsp;<span class="builtinfunc" id="4228386">len</span><span class="op" id="4228389">(</span><span class="ident" id="4228390"><a href="/crypto/tls/key_agreement.go.html#4228320">clientSignatureAndHashes</a></span><span class="op" id="4228414">)</span>&nbsp;<span class="op" id="4228416">==</span>&nbsp;<span class="num" id="4228419">0</span>&nbsp;<span class="op" id="4228421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4228425">//&nbsp;If&nbsp;the&nbsp;client&nbsp;didn&#39;t&nbsp;specify&nbsp;any&nbsp;signature_algorithms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4228484">//&nbsp;extension&nbsp;then&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&nbsp;supports&nbsp;SHA1.&nbsp;See</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4228545">//&nbsp;http://tools.ietf.org/html/rfc5246#section-7.4.1.4.1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228603">return</span>&nbsp;<span class="ident" id="4228610"><a href="/crypto/tls/common.go.html#4111167">hashSHA1</a></span><span class="op" id="4228618">,</span>&nbsp;<span class="ident" id="4228620">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4228625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228629">for</span>&nbsp;<span class="ident" id="4228633">_</span><span class="op" id="4228634">,</span>&nbsp;<span class="ident" id="4228636">sigAndHash</span>&nbsp;<span class="op" id="4228647">:=</span>&nbsp;<span class="keyword" id="4228650">range</span>&nbsp;<span class="ident" id="4228656"><a href="/crypto/tls/key_agreement.go.html#4228320">clientSignatureAndHashes</a></span>&nbsp;<span class="op" id="4228681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228685">if</span>&nbsp;<span class="ident" id="4228688"><a href="/crypto/tls/key_agreement.go.html#4228636">sigAndHash</a></span><span class="op" id="4228698">.</span><span class="ident" id="4228699">signature</span>&nbsp;<span class="op" id="4228709">!=</span>&nbsp;<span class="ident" id="4228712"><a href="/crypto/tls/key_agreement.go.html#4228305">sigType</a></span>&nbsp;<span class="op" id="4228720">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228725">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4228736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228740">switch</span>&nbsp;<span class="ident" id="4228747"><a href="/crypto/tls/key_agreement.go.html#4228636">sigAndHash</a></span><span class="op" id="4228757">.</span><span class="ident" id="4228758">hash</span>&nbsp;<span class="op" id="4228763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228767">case</span>&nbsp;<span class="ident" id="4228772"><a href="/crypto/tls/common.go.html#4111167">hashSHA1</a></span><span class="op" id="4228780">,</span>&nbsp;<span class="ident" id="4228782"><a href="/crypto/tls/common.go.html#4111189">hashSHA256</a></span><span class="op" id="4228792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228797">return</span>&nbsp;<span class="ident" id="4228804"><a href="/crypto/tls/key_agreement.go.html#4228636">sigAndHash</a></span><span class="op" id="4228814">.</span><span class="ident" id="4228815">hash</span><span class="op" id="4228819">,</span>&nbsp;<span class="ident" id="4228821">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4228827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4228830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228834">return</span>&nbsp;<span class="num" id="4228841">0</span><span class="op" id="4228842">,</span>&nbsp;<span class="ident" id="4228844"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4228850">.</span><span class="ident" id="4228851">New</span><span class="op" id="4228854">(</span><span class="string" id="4228855">&#34;tls:&nbsp;client&nbsp;doesn&#39;t&nbsp;support&nbsp;any&nbsp;common&nbsp;hash&nbsp;functions&#34;</span><span class="op" id="4228910">)</span><br>
<span class="lineno"></span><span class="op" id="4228912">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="4228915">func</span>&nbsp;<span class="ident" id="4228920">curveForCurveID</span><span class="op" id="4228935">(</span><span class="ident" id="4228936">id</span>&nbsp;<span class="ident" id="4228939"><a href="/crypto/tls/common.go.html#4110037">CurveID</a></span><span class="op" id="4228946">)</span>&nbsp;<span class="op" id="4228948">(</span><span class="ident" id="4228949"><a href="/crypto/tls/key_agreement.go.html#4223660">elliptic</a></span><span class="op" id="4228957">.</span><span class="ident" id="4228958">Curve</span><span class="op" id="4228963">,</span>&nbsp;<span class="builtintype" id="4228965">bool</span><span class="op" id="4228969">)</span>&nbsp;<span class="op" id="4228971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228974">switch</span>&nbsp;<span class="ident" id="4228981"><a href="/crypto/tls/key_agreement.go.html#4228936">id</a></span>&nbsp;<span class="op" id="4228984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228987">case</span>&nbsp;<span class="ident" id="4228992"><a href="/crypto/tls/common.go.html#4110062">CurveP256</a></span><span class="op" id="4229001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229005">return</span>&nbsp;<span class="ident" id="4229012"><a href="/crypto/tls/key_agreement.go.html#4223660">elliptic</a></span><span class="op" id="4229020">.</span><span class="ident" id="4229021">P256</span><span class="op" id="4229025">(</span><span class="op" id="4229026">)</span><span class="op" id="4229027">,</span>&nbsp;<span class="ident" id="4229029">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229035">case</span>&nbsp;<span class="ident" id="4229040"><a href="/crypto/tls/common.go.html#4110086">CurveP384</a></span><span class="op" id="4229049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229053">return</span>&nbsp;<span class="ident" id="4229060"><a href="/crypto/tls/key_agreement.go.html#4223660">elliptic</a></span><span class="op" id="4229068">.</span><span class="ident" id="4229069">P384</span><span class="op" id="4229073">(</span><span class="op" id="4229074">)</span><span class="op" id="4229075">,</span>&nbsp;<span class="ident" id="4229077">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229083">case</span>&nbsp;<span class="ident" id="4229088"><a href="/crypto/tls/common.go.html#4110110">CurveP521</a></span><span class="op" id="4229097">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229101">return</span>&nbsp;<span class="ident" id="4229108"><a href="/crypto/tls/key_agreement.go.html#4223660">elliptic</a></span><span class="op" id="4229116">.</span><span class="ident" id="4229117">P521</span><span class="op" id="4229121">(</span><span class="op" id="4229122">)</span><span class="op" id="4229123">,</span>&nbsp;<span class="ident" id="4229125">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229131">default</span><span class="op" id="4229138">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229142">return</span>&nbsp;<span class="ident" id="4229149">nil</span><span class="op" id="4229152">,</span>&nbsp;<span class="ident" id="4229154">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4229164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="4229167">//&nbsp;ecdheRSAKeyAgreement&nbsp;implements&nbsp;a&nbsp;TLS&nbsp;key&nbsp;agreement&nbsp;where&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="4229239">//&nbsp;generates&nbsp;a&nbsp;ephemeral&nbsp;EC&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;and&nbsp;signs&nbsp;it.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4229309">//&nbsp;pre-master&nbsp;secret&nbsp;is&nbsp;then&nbsp;calculated&nbsp;using&nbsp;ECDH.&nbsp;The&nbsp;signature&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="4229379">//&nbsp;either&nbsp;be&nbsp;ECDSA&nbsp;or&nbsp;RSA.</span><br>
<span class="lineno"></span><span class="keyword" id="4229406">type</span>&nbsp;<span class="ident" id="4229411">ecdheKeyAgreement</span>&nbsp;<span class="keyword" id="4229429">struct</span>&nbsp;<span class="op" id="4229436">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229439">version</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4229450">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229458">sigType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4229469">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229476">privateKey</span>&nbsp;<span class="op" id="4229487">[</span><span class="op" id="4229488">]</span><span class="builtintype" id="4229489">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229495">curve</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4229506"><a href="/crypto/tls/key_agreement.go.html#4223660">elliptic</a></span><span class="op" id="4229514">.</span><span class="ident" id="4229515">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229522">x</span><span class="op" id="4229523">,</span>&nbsp;<span class="ident" id="4229525">y</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4229533">*</span><span class="ident" id="4229534"><a href="/crypto/tls/key_agreement.go.html#4223787">big</a></span><span class="op" id="4229537">.</span><span class="ident" id="4229538">Int</span><br>
<span class="lineno">190</span><span class="op" id="4229542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4229545">func</span>&nbsp;<span class="op" id="4229550">(</span><span class="ident" id="4229551">ka</span>&nbsp;<span class="op" id="4229554">*</span><span class="ident" id="4229555"><a href="/crypto/tls/key_agreement.go.html#4229411">ecdheKeyAgreement</a></span><span class="op" id="4229572">)</span>&nbsp;<span class="ident" id="4229574">generateServerKeyExchange</span><span class="op" id="4229599">(</span><span class="ident" id="4229600">config</span>&nbsp;<span class="op" id="4229607">*</span><span class="ident" id="4229608"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4229614">,</span>&nbsp;<span class="ident" id="4229616">cert</span>&nbsp;<span class="op" id="4229621">*</span><span class="ident" id="4229622"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="4229633">,</span>&nbsp;<span class="ident" id="4229635">clientHello</span>&nbsp;<span class="op" id="4229647">*</span><span class="ident" id="4229648"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="4229662">,</span>&nbsp;<span class="ident" id="4229664">hello</span>&nbsp;<span class="op" id="4229670">*</span><span class="ident" id="4229671"><a href="/crypto/tls/handshake_messages.go.html#4185078">serverHelloMsg</a></span><span class="op" id="4229685">)</span>&nbsp;<span class="op" id="4229687">(</span><span class="op" id="4229688">*</span><span class="ident" id="4229689"><a href="/crypto/tls/handshake_messages.go.html#4192159">serverKeyExchangeMsg</a></span><span class="op" id="4229709">,</span>&nbsp;<span class="builtintype" id="4229711">error</span><span class="op" id="4229716">)</span>&nbsp;<span class="op" id="4229718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229721">var</span>&nbsp;<span class="ident" id="4229725">curveid</span>&nbsp;<span class="ident" id="4229733"><a href="/crypto/tls/common.go.html#4110037">CurveID</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229742">preferredCurves</span>&nbsp;<span class="op" id="4229758">:=</span>&nbsp;<span class="ident" id="4229761"><a href="/crypto/tls/key_agreement.go.html#4229600">config</a></span><span class="op" id="4229767">.</span><span class="ident" id="4229768">curvePreferences</span><span class="op" id="4229784">(</span><span class="op" id="4229785">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="4229788">NextCandidate</span><span class="op" id="4229801">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229804">for</span>&nbsp;<span class="ident" id="4229808">_</span><span class="op" id="4229809">,</span>&nbsp;<span class="ident" id="4229811">candidate</span>&nbsp;<span class="op" id="4229821">:=</span>&nbsp;<span class="keyword" id="4229824">range</span>&nbsp;<span class="ident" id="4229830"><a href="/crypto/tls/key_agreement.go.html#4229742">preferredCurves</a></span>&nbsp;<span class="op" id="4229846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229850">for</span>&nbsp;<span class="ident" id="4229854">_</span><span class="op" id="4229855">,</span>&nbsp;<span class="ident" id="4229857">c</span>&nbsp;<span class="op" id="4229859">:=</span>&nbsp;<span class="keyword" id="4229862">range</span>&nbsp;<span class="ident" id="4229868"><a href="/crypto/tls/key_agreement.go.html#4229635">clientHello</a></span><span class="op" id="4229879">.</span><span class="ident" id="4229880">supportedCurves</span>&nbsp;<span class="op" id="4229896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229901">if</span>&nbsp;<span class="ident" id="4229904"><a href="/crypto/tls/key_agreement.go.html#4229811">candidate</a></span>&nbsp;<span class="op" id="4229914">==</span>&nbsp;<span class="ident" id="4229917"><a href="/crypto/tls/key_agreement.go.html#4229857">c</a></span>&nbsp;<span class="op" id="4229919">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229925"><a href="/crypto/tls/key_agreement.go.html#4229725">curveid</a></span>&nbsp;<span class="op" id="4229933">=</span>&nbsp;<span class="ident" id="4229935"><a href="/crypto/tls/key_agreement.go.html#4229857">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229941">break</span>&nbsp;<span class="ident" id="4229947">NextCandidate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229971">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229975">if</span>&nbsp;<span class="ident" id="4229978"><a href="/crypto/tls/key_agreement.go.html#4229725">curveid</a></span>&nbsp;<span class="op" id="4229986">==</span>&nbsp;<span class="num" id="4229989">0</span>&nbsp;<span class="op" id="4229991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229995">return</span>&nbsp;<span class="ident" id="4230002">nil</span><span class="op" id="4230005">,</span>&nbsp;<span class="ident" id="4230007"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4230013">.</span><span class="ident" id="4230014">New</span><span class="op" id="4230017">(</span><span class="string" id="4230018">&#34;tls:&nbsp;no&nbsp;supported&nbsp;elliptic&nbsp;curves&nbsp;offered&#34;</span><span class="op" id="4230061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230068">var</span>&nbsp;<span class="ident" id="4230072">ok</span>&nbsp;<span class="builtintype" id="4230075">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230081">if</span>&nbsp;<span class="ident" id="4230084"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4230086">.</span><span class="ident" id="4230087">curve</span><span class="op" id="4230092">,</span>&nbsp;<span class="ident" id="4230094"><a href="/crypto/tls/key_agreement.go.html#4230072">ok</a></span>&nbsp;<span class="op" id="4230097">=</span>&nbsp;<span class="ident" id="4230099"><a href="/crypto/tls/key_agreement.go.html#4228920">curveForCurveID</a></span><span class="op" id="4230114">(</span><span class="ident" id="4230115"><a href="/crypto/tls/key_agreement.go.html#4229725">curveid</a></span><span class="op" id="4230122">)</span><span class="op" id="4230123">;</span>&nbsp;<span class="op" id="4230125">!</span><span class="ident" id="4230126"><a href="/crypto/tls/key_agreement.go.html#4230072">ok</a></span>&nbsp;<span class="op" id="4230129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230133">return</span>&nbsp;<span class="ident" id="4230140">nil</span><span class="op" id="4230143">,</span>&nbsp;<span class="ident" id="4230145"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4230151">.</span><span class="ident" id="4230152">New</span><span class="op" id="4230155">(</span><span class="string" id="4230156">&#34;tls:&nbsp;preferredCurves&nbsp;includes&nbsp;unsupported&nbsp;curve&#34;</span><span class="op" id="4230205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230212">var</span>&nbsp;<span class="ident" id="4230216">x</span><span class="op" id="4230217">,</span>&nbsp;<span class="ident" id="4230219">y</span>&nbsp;<span class="op" id="4230221">*</span><span class="ident" id="4230222"><a href="/crypto/tls/key_agreement.go.html#4223787">big</a></span><span class="op" id="4230225">.</span><span class="ident" id="4230226">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230231">var</span>&nbsp;<span class="ident" id="4230235">err</span>&nbsp;<span class="builtintype" id="4230239">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230246"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4230248">.</span><span class="ident" id="4230249">privateKey</span><span class="op" id="4230259">,</span>&nbsp;<span class="ident" id="4230261"><a href="/crypto/tls/key_agreement.go.html#4230216">x</a></span><span class="op" id="4230262">,</span>&nbsp;<span class="ident" id="4230264"><a href="/crypto/tls/key_agreement.go.html#4230219">y</a></span><span class="op" id="4230265">,</span>&nbsp;<span class="ident" id="4230267"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span>&nbsp;<span class="op" id="4230271">=</span>&nbsp;<span class="ident" id="4230273"><a href="/crypto/tls/key_agreement.go.html#4223660">elliptic</a></span><span class="op" id="4230281">.</span><span class="ident" id="4230282">GenerateKey</span><span class="op" id="4230293">(</span><span class="ident" id="4230294"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4230296">.</span><span class="ident" id="4230297">curve</span><span class="op" id="4230302">,</span>&nbsp;<span class="ident" id="4230304"><a href="/crypto/tls/key_agreement.go.html#4229600">config</a></span><span class="op" id="4230310">.</span><span class="ident" id="4230311">rand</span><span class="op" id="4230315">(</span><span class="op" id="4230316">)</span><span class="op" id="4230317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230320">if</span>&nbsp;<span class="ident" id="4230323"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span>&nbsp;<span class="op" id="4230327">!=</span>&nbsp;<span class="ident" id="4230330">nil</span>&nbsp;<span class="op" id="4230334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230338">return</span>&nbsp;<span class="ident" id="4230345">nil</span><span class="op" id="4230348">,</span>&nbsp;<span class="ident" id="4230350"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230358">ecdhePublic</span>&nbsp;<span class="op" id="4230370">:=</span>&nbsp;<span class="ident" id="4230373"><a href="/crypto/tls/key_agreement.go.html#4223660">elliptic</a></span><span class="op" id="4230381">.</span><span class="ident" id="4230382">Marshal</span><span class="op" id="4230389">(</span><span class="ident" id="4230390"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4230392">.</span><span class="ident" id="4230393">curve</span><span class="op" id="4230398">,</span>&nbsp;<span class="ident" id="4230400"><a href="/crypto/tls/key_agreement.go.html#4230216">x</a></span><span class="op" id="4230401">,</span>&nbsp;<span class="ident" id="4230403"><a href="/crypto/tls/key_agreement.go.html#4230219">y</a></span><span class="op" id="4230404">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4230408">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230459">serverECDHParams</span>&nbsp;<span class="op" id="4230476">:=</span>&nbsp;<span class="builtinfunc" id="4230479">make</span><span class="op" id="4230483">(</span><span class="op" id="4230484">[</span><span class="op" id="4230485">]</span><span class="builtintype" id="4230486">byte</span><span class="op" id="4230490">,</span>&nbsp;<span class="num" id="4230492">1</span><span class="op" id="4230493">+</span><span class="num" id="4230494">2</span><span class="op" id="4230495">+</span><span class="num" id="4230496">1</span><span class="op" id="4230497">+</span><span class="builtinfunc" id="4230498">len</span><span class="op" id="4230501">(</span><span class="ident" id="4230502"><a href="/crypto/tls/key_agreement.go.html#4230358">ecdhePublic</a></span><span class="op" id="4230513">)</span><span class="op" id="4230514">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230517"><a href="/crypto/tls/key_agreement.go.html#4230459">serverECDHParams</a></span><span class="op" id="4230533">[</span><span class="num" id="4230534">0</span><span class="op" id="4230535">]</span>&nbsp;<span class="op" id="4230537">=</span>&nbsp;<span class="num" id="4230539">3</span>&nbsp;<span class="comment" id="4230541">//&nbsp;named&nbsp;curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230557"><a href="/crypto/tls/key_agreement.go.html#4230459">serverECDHParams</a></span><span class="op" id="4230573">[</span><span class="num" id="4230574">1</span><span class="op" id="4230575">]</span>&nbsp;<span class="op" id="4230577">=</span>&nbsp;<span class="builtintype" id="4230579">byte</span><span class="op" id="4230583">(</span><span class="ident" id="4230584"><a href="/crypto/tls/key_agreement.go.html#4229725">curveid</a></span>&nbsp;<span class="op" id="4230592">&gt;&gt;</span>&nbsp;<span class="num" id="4230595">8</span><span class="op" id="4230596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230599"><a href="/crypto/tls/key_agreement.go.html#4230459">serverECDHParams</a></span><span class="op" id="4230615">[</span><span class="num" id="4230616">2</span><span class="op" id="4230617">]</span>&nbsp;<span class="op" id="4230619">=</span>&nbsp;<span class="builtintype" id="4230621">byte</span><span class="op" id="4230625">(</span><span class="ident" id="4230626"><a href="/crypto/tls/key_agreement.go.html#4229725">curveid</a></span><span class="op" id="4230633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230636"><a href="/crypto/tls/key_agreement.go.html#4230459">serverECDHParams</a></span><span class="op" id="4230652">[</span><span class="num" id="4230653">3</span><span class="op" id="4230654">]</span>&nbsp;<span class="op" id="4230656">=</span>&nbsp;<span class="builtintype" id="4230658">byte</span><span class="op" id="4230662">(</span><span class="builtinfunc" id="4230663">len</span><span class="op" id="4230666">(</span><span class="ident" id="4230667"><a href="/crypto/tls/key_agreement.go.html#4230358">ecdhePublic</a></span><span class="op" id="4230678">)</span><span class="op" id="4230679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4230682">copy</span><span class="op" id="4230686">(</span><span class="ident" id="4230687"><a href="/crypto/tls/key_agreement.go.html#4230459">serverECDHParams</a></span><span class="op" id="4230703">[</span><span class="num" id="4230704">4</span><span class="op" id="4230705">:</span><span class="op" id="4230706">]</span><span class="op" id="4230707">,</span>&nbsp;<span class="ident" id="4230709"><a href="/crypto/tls/key_agreement.go.html#4230358">ecdhePublic</a></span><span class="op" id="4230720">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230724">var</span>&nbsp;<span class="ident" id="4230728">tls12HashId</span>&nbsp;<span class="builtintype" id="4230740">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230747">if</span>&nbsp;<span class="ident" id="4230750"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4230752">.</span><span class="ident" id="4230753">version</span>&nbsp;<span class="op" id="4230761">&gt;=</span>&nbsp;<span class="ident" id="4230764"><a href="/crypto/tls/common.go.html#4108205">VersionTLS12</a></span>&nbsp;<span class="op" id="4230777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230781">if</span>&nbsp;<span class="ident" id="4230784"><a href="/crypto/tls/key_agreement.go.html#4230728">tls12HashId</a></span><span class="op" id="4230795">,</span>&nbsp;<span class="ident" id="4230797"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span>&nbsp;<span class="op" id="4230801">=</span>&nbsp;<span class="ident" id="4230803"><a href="/crypto/tls/key_agreement.go.html#4228279">pickTLS12HashForSignature</a></span><span class="op" id="4230828">(</span><span class="ident" id="4230829"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4230831">.</span><span class="ident" id="4230832">sigType</span><span class="op" id="4230839">,</span>&nbsp;<span class="ident" id="4230841"><a href="/crypto/tls/key_agreement.go.html#4229635">clientHello</a></span><span class="op" id="4230852">.</span><span class="ident" id="4230853">signatureAndHashes</span><span class="op" id="4230871">)</span><span class="op" id="4230872">;</span>&nbsp;<span class="ident" id="4230874"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span>&nbsp;<span class="op" id="4230878">!=</span>&nbsp;<span class="ident" id="4230881">nil</span>&nbsp;<span class="op" id="4230885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230890">return</span>&nbsp;<span class="ident" id="4230897">nil</span><span class="op" id="4230900">,</span>&nbsp;<span class="ident" id="4230902"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230915">digest</span><span class="op" id="4230921">,</span>&nbsp;<span class="ident" id="4230923">hashFunc</span><span class="op" id="4230931">,</span>&nbsp;<span class="ident" id="4230933"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span>&nbsp;<span class="op" id="4230937">:=</span>&nbsp;<span class="ident" id="4230940"><a href="/crypto/tls/key_agreement.go.html#4227529">hashForServerKeyExchange</a></span><span class="op" id="4230964">(</span><span class="ident" id="4230965"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4230967">.</span><span class="ident" id="4230968">sigType</span><span class="op" id="4230975">,</span>&nbsp;<span class="ident" id="4230977"><a href="/crypto/tls/key_agreement.go.html#4230728">tls12HashId</a></span><span class="op" id="4230988">,</span>&nbsp;<span class="ident" id="4230990"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4230992">.</span><span class="ident" id="4230993">version</span><span class="op" id="4231000">,</span>&nbsp;<span class="ident" id="4231002"><a href="/crypto/tls/key_agreement.go.html#4229635">clientHello</a></span><span class="op" id="4231013">.</span><span class="ident" id="4231014">random</span><span class="op" id="4231020">,</span>&nbsp;<span class="ident" id="4231022"><a href="/crypto/tls/key_agreement.go.html#4229664">hello</a></span><span class="op" id="4231027">.</span><span class="ident" id="4231028">random</span><span class="op" id="4231034">,</span>&nbsp;<span class="ident" id="4231036"><a href="/crypto/tls/key_agreement.go.html#4230459">serverECDHParams</a></span><span class="op" id="4231052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231055">if</span>&nbsp;<span class="ident" id="4231058"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span>&nbsp;<span class="op" id="4231062">!=</span>&nbsp;<span class="ident" id="4231065">nil</span>&nbsp;<span class="op" id="4231069">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231073">return</span>&nbsp;<span class="ident" id="4231080">nil</span><span class="op" id="4231083">,</span>&nbsp;<span class="ident" id="4231085"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231093">var</span>&nbsp;<span class="ident" id="4231097">sig</span>&nbsp;<span class="op" id="4231101">[</span><span class="op" id="4231102">]</span><span class="builtintype" id="4231103">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231109">switch</span>&nbsp;<span class="ident" id="4231116"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4231118">.</span><span class="ident" id="4231119">sigType</span>&nbsp;<span class="op" id="4231127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231130">case</span>&nbsp;<span class="ident" id="4231135"><a href="/crypto/tls/common.go.html#4111314">signatureECDSA</a></span><span class="op" id="4231149">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231153">privKey</span><span class="op" id="4231160">,</span>&nbsp;<span class="ident" id="4231162">ok</span>&nbsp;<span class="op" id="4231165">:=</span>&nbsp;<span class="ident" id="4231168"><a href="/crypto/tls/key_agreement.go.html#4229616">cert</a></span><span class="op" id="4231172">.</span><span class="ident" id="4231173">PrivateKey</span><span class="op" id="4231183">.</span><span class="op" id="4231184">(</span><span class="op" id="4231185">*</span><span class="ident" id="4231186"><a href="/crypto/tls/key_agreement.go.html#4223644">ecdsa</a></span><span class="op" id="4231191">.</span><span class="ident" id="4231192">PrivateKey</span><span class="op" id="4231202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231206">if</span>&nbsp;<span class="op" id="4231209">!</span><span class="ident" id="4231210"><a href="/crypto/tls/key_agreement.go.html#4231162">ok</a></span>&nbsp;<span class="op" id="4231213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231218">return</span>&nbsp;<span class="ident" id="4231225">nil</span><span class="op" id="4231228">,</span>&nbsp;<span class="ident" id="4231230"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4231236">.</span><span class="ident" id="4231237">New</span><span class="op" id="4231240">(</span><span class="string" id="4231241">&#34;ECDHE&nbsp;ECDSA&nbsp;requires&nbsp;an&nbsp;ECDSA&nbsp;server&nbsp;private&nbsp;key&#34;</span><span class="op" id="4231291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231299">r</span><span class="op" id="4231300">,</span>&nbsp;<span class="ident" id="4231302">s</span><span class="op" id="4231303">,</span>&nbsp;<span class="ident" id="4231305">err</span>&nbsp;<span class="op" id="4231309">:=</span>&nbsp;<span class="ident" id="4231312"><a href="/crypto/tls/key_agreement.go.html#4223644">ecdsa</a></span><span class="op" id="4231317">.</span><span class="ident" id="4231318">Sign</span><span class="op" id="4231322">(</span><span class="ident" id="4231323"><a href="/crypto/tls/key_agreement.go.html#4229600">config</a></span><span class="op" id="4231329">.</span><span class="ident" id="4231330">rand</span><span class="op" id="4231334">(</span><span class="op" id="4231335">)</span><span class="op" id="4231336">,</span>&nbsp;<span class="ident" id="4231338"><a href="/crypto/tls/key_agreement.go.html#4231153">privKey</a></span><span class="op" id="4231345">,</span>&nbsp;<span class="ident" id="4231347"><a href="/crypto/tls/key_agreement.go.html#4230915">digest</a></span><span class="op" id="4231353">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231357">if</span>&nbsp;<span class="ident" id="4231360"><a href="/crypto/tls/key_agreement.go.html#4231305">err</a></span>&nbsp;<span class="op" id="4231364">!=</span>&nbsp;<span class="ident" id="4231367">nil</span>&nbsp;<span class="op" id="4231371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231376">return</span>&nbsp;<span class="ident" id="4231383">nil</span><span class="op" id="4231386">,</span>&nbsp;<span class="ident" id="4231388"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4231394">.</span><span class="ident" id="4231395">New</span><span class="op" id="4231398">(</span><span class="string" id="4231399">&#34;failed&nbsp;to&nbsp;sign&nbsp;ECDHE&nbsp;parameters:&nbsp;&#34;</span>&nbsp;<span class="op" id="4231435">+</span>&nbsp;<span class="ident" id="4231437"><a href="/crypto/tls/key_agreement.go.html#4231305">err</a></span><span class="op" id="4231440">.</span><span class="ident" id="4231441">Error</span><span class="op" id="4231446">(</span><span class="op" id="4231447">)</span><span class="op" id="4231448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231456"><a href="/crypto/tls/key_agreement.go.html#4231097">sig</a></span><span class="op" id="4231459">,</span>&nbsp;<span class="ident" id="4231461"><a href="/crypto/tls/key_agreement.go.html#4231305">err</a></span>&nbsp;<span class="op" id="4231465">=</span>&nbsp;<span class="ident" id="4231467"><a href="/crypto/tls/key_agreement.go.html#4223754">asn1</a></span><span class="op" id="4231471">.</span><span class="ident" id="4231472">Marshal</span><span class="op" id="4231479">(</span><span class="ident" id="4231480"><a href="/crypto/tls/common.go.html#4126536">ecdsaSignature</a></span><span class="op" id="4231494">{</span><span class="ident" id="4231495"><a href="/crypto/tls/key_agreement.go.html#4231299">r</a></span><span class="op" id="4231496">,</span>&nbsp;<span class="ident" id="4231498"><a href="/crypto/tls/key_agreement.go.html#4231302">s</a></span><span class="op" id="4231499">}</span><span class="op" id="4231500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231503">case</span>&nbsp;<span class="ident" id="4231508"><a href="/crypto/tls/common.go.html#4111288">signatureRSA</a></span><span class="op" id="4231520">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231524">privKey</span><span class="op" id="4231531">,</span>&nbsp;<span class="ident" id="4231533">ok</span>&nbsp;<span class="op" id="4231536">:=</span>&nbsp;<span class="ident" id="4231539"><a href="/crypto/tls/key_agreement.go.html#4229616">cert</a></span><span class="op" id="4231543">.</span><span class="ident" id="4231544">PrivateKey</span><span class="op" id="4231554">.</span><span class="op" id="4231555">(</span><span class="op" id="4231556">*</span><span class="ident" id="4231557"><a href="/crypto/tls/key_agreement.go.html#4223693">rsa</a></span><span class="op" id="4231560">.</span><span class="ident" id="4231561">PrivateKey</span><span class="op" id="4231571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231575">if</span>&nbsp;<span class="op" id="4231578">!</span><span class="ident" id="4231579"><a href="/crypto/tls/key_agreement.go.html#4231533">ok</a></span>&nbsp;<span class="op" id="4231582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231587">return</span>&nbsp;<span class="ident" id="4231594">nil</span><span class="op" id="4231597">,</span>&nbsp;<span class="ident" id="4231599"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4231605">.</span><span class="ident" id="4231606">New</span><span class="op" id="4231609">(</span><span class="string" id="4231610">&#34;ECDHE&nbsp;RSA&nbsp;requires&nbsp;a&nbsp;RSA&nbsp;server&nbsp;private&nbsp;key&#34;</span><span class="op" id="4231655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231663"><a href="/crypto/tls/key_agreement.go.html#4231097">sig</a></span><span class="op" id="4231666">,</span>&nbsp;<span class="ident" id="4231668"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span>&nbsp;<span class="op" id="4231672">=</span>&nbsp;<span class="ident" id="4231674"><a href="/crypto/tls/key_agreement.go.html#4223693">rsa</a></span><span class="op" id="4231677">.</span><span class="ident" id="4231678">SignPKCS1v15</span><span class="op" id="4231690">(</span><span class="ident" id="4231691"><a href="/crypto/tls/key_agreement.go.html#4229600">config</a></span><span class="op" id="4231697">.</span><span class="ident" id="4231698">rand</span><span class="op" id="4231702">(</span><span class="op" id="4231703">)</span><span class="op" id="4231704">,</span>&nbsp;<span class="ident" id="4231706"><a href="/crypto/tls/key_agreement.go.html#4231524">privKey</a></span><span class="op" id="4231713">,</span>&nbsp;<span class="ident" id="4231715"><a href="/crypto/tls/key_agreement.go.html#4230923">hashFunc</a></span><span class="op" id="4231723">,</span>&nbsp;<span class="ident" id="4231725"><a href="/crypto/tls/key_agreement.go.html#4230915">digest</a></span><span class="op" id="4231731">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231735">if</span>&nbsp;<span class="ident" id="4231738"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span>&nbsp;<span class="op" id="4231742">!=</span>&nbsp;<span class="ident" id="4231745">nil</span>&nbsp;<span class="op" id="4231749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231754">return</span>&nbsp;<span class="ident" id="4231761">nil</span><span class="op" id="4231764">,</span>&nbsp;<span class="ident" id="4231766"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4231772">.</span><span class="ident" id="4231773">New</span><span class="op" id="4231776">(</span><span class="string" id="4231777">&#34;failed&nbsp;to&nbsp;sign&nbsp;ECDHE&nbsp;parameters:&nbsp;&#34;</span>&nbsp;<span class="op" id="4231813">+</span>&nbsp;<span class="ident" id="4231815"><a href="/crypto/tls/key_agreement.go.html#4230235">err</a></span><span class="op" id="4231818">.</span><span class="ident" id="4231819">Error</span><span class="op" id="4231824">(</span><span class="op" id="4231825">)</span><span class="op" id="4231826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231833">default</span><span class="op" id="4231840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231844">return</span>&nbsp;<span class="ident" id="4231851">nil</span><span class="op" id="4231854">,</span>&nbsp;<span class="ident" id="4231856"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4231862">.</span><span class="ident" id="4231863">New</span><span class="op" id="4231866">(</span><span class="string" id="4231867">&#34;unknown&nbsp;ECDHE&nbsp;signature&nbsp;algorithm&#34;</span><span class="op" id="4231902">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231909">skx</span>&nbsp;<span class="op" id="4231913">:=</span>&nbsp;<span class="builtinfunc" id="4231916">new</span><span class="op" id="4231919">(</span><span class="ident" id="4231920"><a href="/crypto/tls/handshake_messages.go.html#4192159">serverKeyExchangeMsg</a></span><span class="op" id="4231940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231943">sigAndHashLen</span>&nbsp;<span class="op" id="4231957">:=</span>&nbsp;<span class="num" id="4231960">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231963">if</span>&nbsp;<span class="ident" id="4231966"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4231968">.</span><span class="ident" id="4231969">version</span>&nbsp;<span class="op" id="4231977">&gt;=</span>&nbsp;<span class="ident" id="4231980"><a href="/crypto/tls/common.go.html#4108205">VersionTLS12</a></span>&nbsp;<span class="op" id="4231993">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231997"><a href="/crypto/tls/key_agreement.go.html#4231943">sigAndHashLen</a></span>&nbsp;<span class="op" id="4232011">=</span>&nbsp;<span class="num" id="4232013">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4232016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232019"><a href="/crypto/tls/key_agreement.go.html#4231909">skx</a></span><span class="op" id="4232022">.</span><span class="ident" id="4232023">key</span>&nbsp;<span class="op" id="4232027">=</span>&nbsp;<span class="builtinfunc" id="4232029">make</span><span class="op" id="4232033">(</span><span class="op" id="4232034">[</span><span class="op" id="4232035">]</span><span class="builtintype" id="4232036">byte</span><span class="op" id="4232040">,</span>&nbsp;<span class="builtinfunc" id="4232042">len</span><span class="op" id="4232045">(</span><span class="ident" id="4232046"><a href="/crypto/tls/key_agreement.go.html#4230459">serverECDHParams</a></span><span class="op" id="4232062">)</span><span class="op" id="4232063">+</span><span class="ident" id="4232064"><a href="/crypto/tls/key_agreement.go.html#4231943">sigAndHashLen</a></span><span class="op" id="4232077">+</span><span class="num" id="4232078">2</span><span class="op" id="4232079">+</span><span class="builtinfunc" id="4232080">len</span><span class="op" id="4232083">(</span><span class="ident" id="4232084"><a href="/crypto/tls/key_agreement.go.html#4231097">sig</a></span><span class="op" id="4232087">)</span><span class="op" id="4232088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4232091">copy</span><span class="op" id="4232095">(</span><span class="ident" id="4232096"><a href="/crypto/tls/key_agreement.go.html#4231909">skx</a></span><span class="op" id="4232099">.</span><span class="ident" id="4232100">key</span><span class="op" id="4232103">,</span>&nbsp;<span class="ident" id="4232105"><a href="/crypto/tls/key_agreement.go.html#4230459">serverECDHParams</a></span><span class="op" id="4232121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232124">k</span>&nbsp;<span class="op" id="4232126">:=</span>&nbsp;<span class="ident" id="4232129"><a href="/crypto/tls/key_agreement.go.html#4231909">skx</a></span><span class="op" id="4232132">.</span><span class="ident" id="4232133">key</span><span class="op" id="4232136">[</span><span class="builtinfunc" id="4232137">len</span><span class="op" id="4232140">(</span><span class="ident" id="4232141"><a href="/crypto/tls/key_agreement.go.html#4230459">serverECDHParams</a></span><span class="op" id="4232157">)</span><span class="op" id="4232158">:</span><span class="op" id="4232159">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232162">if</span>&nbsp;<span class="ident" id="4232165"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4232167">.</span><span class="ident" id="4232168">version</span>&nbsp;<span class="op" id="4232176">&gt;=</span>&nbsp;<span class="ident" id="4232179"><a href="/crypto/tls/common.go.html#4108205">VersionTLS12</a></span>&nbsp;<span class="op" id="4232192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232196"><a href="/crypto/tls/key_agreement.go.html#4232124">k</a></span><span class="op" id="4232197">[</span><span class="num" id="4232198">0</span><span class="op" id="4232199">]</span>&nbsp;<span class="op" id="4232201">=</span>&nbsp;<span class="ident" id="4232203"><a href="/crypto/tls/key_agreement.go.html#4230728">tls12HashId</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232217"><a href="/crypto/tls/key_agreement.go.html#4232124">k</a></span><span class="op" id="4232218">[</span><span class="num" id="4232219">1</span><span class="op" id="4232220">]</span>&nbsp;<span class="op" id="4232222">=</span>&nbsp;<span class="ident" id="4232224"><a href="/crypto/tls/key_agreement.go.html#4229551">ka</a></span><span class="op" id="4232226">.</span><span class="ident" id="4232227">sigType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232237"><a href="/crypto/tls/key_agreement.go.html#4232124">k</a></span>&nbsp;<span class="op" id="4232239">=</span>&nbsp;<span class="ident" id="4232241"><a href="/crypto/tls/key_agreement.go.html#4232124">k</a></span><span class="op" id="4232242">[</span><span class="num" id="4232243">2</span><span class="op" id="4232244">:</span><span class="op" id="4232245">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4232248">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232251"><a href="/crypto/tls/key_agreement.go.html#4232124">k</a></span><span class="op" id="4232252">[</span><span class="num" id="4232253">0</span><span class="op" id="4232254">]</span>&nbsp;<span class="op" id="4232256">=</span>&nbsp;<span class="builtintype" id="4232258">byte</span><span class="op" id="4232262">(</span><span class="builtinfunc" id="4232263">len</span><span class="op" id="4232266">(</span><span class="ident" id="4232267"><a href="/crypto/tls/key_agreement.go.html#4231097">sig</a></span><span class="op" id="4232270">)</span>&nbsp;<span class="op" id="4232272">&gt;&gt;</span>&nbsp;<span class="num" id="4232275">8</span><span class="op" id="4232276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232279"><a href="/crypto/tls/key_agreement.go.html#4232124">k</a></span><span class="op" id="4232280">[</span><span class="num" id="4232281">1</span><span class="op" id="4232282">]</span>&nbsp;<span class="op" id="4232284">=</span>&nbsp;<span class="builtintype" id="4232286">byte</span><span class="op" id="4232290">(</span><span class="builtinfunc" id="4232291">len</span><span class="op" id="4232294">(</span><span class="ident" id="4232295"><a href="/crypto/tls/key_agreement.go.html#4231097">sig</a></span><span class="op" id="4232298">)</span><span class="op" id="4232299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4232302">copy</span><span class="op" id="4232306">(</span><span class="ident" id="4232307"><a href="/crypto/tls/key_agreement.go.html#4232124">k</a></span><span class="op" id="4232308">[</span><span class="num" id="4232309">2</span><span class="op" id="4232310">:</span><span class="op" id="4232311">]</span><span class="op" id="4232312">,</span>&nbsp;<span class="ident" id="4232314"><a href="/crypto/tls/key_agreement.go.html#4231097">sig</a></span><span class="op" id="4232317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232321">return</span>&nbsp;<span class="ident" id="4232328"><a href="/crypto/tls/key_agreement.go.html#4231909">skx</a></span><span class="op" id="4232331">,</span>&nbsp;<span class="ident" id="4232333">nil</span><br>
<span class="lineno">285</span><span class="op" id="4232337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4232340">func</span>&nbsp;<span class="op" id="4232345">(</span><span class="ident" id="4232346">ka</span>&nbsp;<span class="op" id="4232349">*</span><span class="ident" id="4232350"><a href="/crypto/tls/key_agreement.go.html#4229411">ecdheKeyAgreement</a></span><span class="op" id="4232367">)</span>&nbsp;<span class="ident" id="4232369">processClientKeyExchange</span><span class="op" id="4232393">(</span><span class="ident" id="4232394">config</span>&nbsp;<span class="op" id="4232401">*</span><span class="ident" id="4232402"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4232408">,</span>&nbsp;<span class="ident" id="4232410">cert</span>&nbsp;<span class="op" id="4232415">*</span><span class="ident" id="4232416"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="4232427">,</span>&nbsp;<span class="ident" id="4232429">ckx</span>&nbsp;<span class="op" id="4232433">*</span><span class="ident" id="4232434"><a href="/crypto/tls/handshake_messages.go.html#4194449">clientKeyExchangeMsg</a></span><span class="op" id="4232454">,</span>&nbsp;<span class="ident" id="4232456">version</span>&nbsp;<span class="builtintype" id="4232464">uint16</span><span class="op" id="4232470">)</span>&nbsp;<span class="op" id="4232472">(</span><span class="op" id="4232473">[</span><span class="op" id="4232474">]</span><span class="builtintype" id="4232475">byte</span><span class="op" id="4232479">,</span>&nbsp;<span class="builtintype" id="4232481">error</span><span class="op" id="4232486">)</span>&nbsp;<span class="op" id="4232488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232491">if</span>&nbsp;<span class="builtinfunc" id="4232494">len</span><span class="op" id="4232497">(</span><span class="ident" id="4232498"><a href="/crypto/tls/key_agreement.go.html#4232429">ckx</a></span><span class="op" id="4232501">.</span><span class="ident" id="4232502">ciphertext</span><span class="op" id="4232512">)</span>&nbsp;<span class="op" id="4232514">==</span>&nbsp;<span class="num" id="4232517">0</span>&nbsp;<span class="op" id="4232519">||</span>&nbsp;<span class="builtintype" id="4232522">int</span><span class="op" id="4232525">(</span><span class="ident" id="4232526"><a href="/crypto/tls/key_agreement.go.html#4232429">ckx</a></span><span class="op" id="4232529">.</span><span class="ident" id="4232530">ciphertext</span><span class="op" id="4232540">[</span><span class="num" id="4232541">0</span><span class="op" id="4232542">]</span><span class="op" id="4232543">)</span>&nbsp;<span class="op" id="4232545">!=</span>&nbsp;<span class="builtinfunc" id="4232548">len</span><span class="op" id="4232551">(</span><span class="ident" id="4232552"><a href="/crypto/tls/key_agreement.go.html#4232429">ckx</a></span><span class="op" id="4232555">.</span><span class="ident" id="4232556">ciphertext</span><span class="op" id="4232566">)</span><span class="op" id="4232567">-</span><span class="num" id="4232568">1</span>&nbsp;<span class="op" id="4232570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232574">return</span>&nbsp;<span class="ident" id="4232581">nil</span><span class="op" id="4232584">,</span>&nbsp;<span class="ident" id="4232586"><a href="/crypto/tls/key_agreement.go.html#4223805">errClientKeyExchange</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4232608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232611">x</span><span class="op" id="4232612">,</span>&nbsp;<span class="ident" id="4232614">y</span>&nbsp;<span class="op" id="4232616">:=</span>&nbsp;<span class="ident" id="4232619"><a href="/crypto/tls/key_agreement.go.html#4223660">elliptic</a></span><span class="op" id="4232627">.</span><span class="ident" id="4232628">Unmarshal</span><span class="op" id="4232637">(</span><span class="ident" id="4232638"><a href="/crypto/tls/key_agreement.go.html#4232346">ka</a></span><span class="op" id="4232640">.</span><span class="ident" id="4232641">curve</span><span class="op" id="4232646">,</span>&nbsp;<span class="ident" id="4232648"><a href="/crypto/tls/key_agreement.go.html#4232429">ckx</a></span><span class="op" id="4232651">.</span><span class="ident" id="4232652">ciphertext</span><span class="op" id="4232662">[</span><span class="num" id="4232663">1</span><span class="op" id="4232664">:</span><span class="op" id="4232665">]</span><span class="op" id="4232666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232669">if</span>&nbsp;<span class="ident" id="4232672"><a href="/crypto/tls/key_agreement.go.html#4232611">x</a></span>&nbsp;<span class="op" id="4232674">==</span>&nbsp;<span class="ident" id="4232677">nil</span>&nbsp;<span class="op" id="4232681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232685">return</span>&nbsp;<span class="ident" id="4232692">nil</span><span class="op" id="4232695">,</span>&nbsp;<span class="ident" id="4232697"><a href="/crypto/tls/key_agreement.go.html#4223805">errClientKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4232719">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232722">if</span>&nbsp;<span class="op" id="4232725">!</span><span class="ident" id="4232726"><a href="/crypto/tls/key_agreement.go.html#4232346">ka</a></span><span class="op" id="4232728">.</span><span class="ident" id="4232729">curve</span><span class="op" id="4232734">.</span><span class="ident" id="4232735">IsOnCurve</span><span class="op" id="4232744">(</span><span class="ident" id="4232745"><a href="/crypto/tls/key_agreement.go.html#4232611">x</a></span><span class="op" id="4232746">,</span>&nbsp;<span class="ident" id="4232748"><a href="/crypto/tls/key_agreement.go.html#4232614">y</a></span><span class="op" id="4232749">)</span>&nbsp;<span class="op" id="4232751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232755">return</span>&nbsp;<span class="ident" id="4232762">nil</span><span class="op" id="4232765">,</span>&nbsp;<span class="ident" id="4232767"><a href="/crypto/tls/key_agreement.go.html#4223805">errClientKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4232789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232792"><a href="/crypto/tls/key_agreement.go.html#4232611">x</a></span><span class="op" id="4232793">,</span>&nbsp;<span class="ident" id="4232795">_</span>&nbsp;<span class="op" id="4232797">=</span>&nbsp;<span class="ident" id="4232799"><a href="/crypto/tls/key_agreement.go.html#4232346">ka</a></span><span class="op" id="4232801">.</span><span class="ident" id="4232802">curve</span><span class="op" id="4232807">.</span><span class="ident" id="4232808">ScalarMult</span><span class="op" id="4232818">(</span><span class="ident" id="4232819"><a href="/crypto/tls/key_agreement.go.html#4232611">x</a></span><span class="op" id="4232820">,</span>&nbsp;<span class="ident" id="4232822"><a href="/crypto/tls/key_agreement.go.html#4232614">y</a></span><span class="op" id="4232823">,</span>&nbsp;<span class="ident" id="4232825"><a href="/crypto/tls/key_agreement.go.html#4232346">ka</a></span><span class="op" id="4232827">.</span><span class="ident" id="4232828">privateKey</span><span class="op" id="4232838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232841">preMasterSecret</span>&nbsp;<span class="op" id="4232857">:=</span>&nbsp;<span class="builtinfunc" id="4232860">make</span><span class="op" id="4232864">(</span><span class="op" id="4232865">[</span><span class="op" id="4232866">]</span><span class="builtintype" id="4232867">byte</span><span class="op" id="4232871">,</span>&nbsp;<span class="op" id="4232873">(</span><span class="ident" id="4232874"><a href="/crypto/tls/key_agreement.go.html#4232346">ka</a></span><span class="op" id="4232876">.</span><span class="ident" id="4232877">curve</span><span class="op" id="4232882">.</span><span class="ident" id="4232883">Params</span><span class="op" id="4232889">(</span><span class="op" id="4232890">)</span><span class="op" id="4232891">.</span><span class="ident" id="4232892">BitSize</span><span class="op" id="4232899">+</span><span class="num" id="4232900">7</span><span class="op" id="4232901">)</span><span class="op" id="4232902">&gt;&gt;</span><span class="num" id="4232904">3</span><span class="op" id="4232905">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232908">xBytes</span>&nbsp;<span class="op" id="4232915">:=</span>&nbsp;<span class="ident" id="4232918"><a href="/crypto/tls/key_agreement.go.html#4232611">x</a></span><span class="op" id="4232919">.</span><span class="ident" id="4232920">Bytes</span><span class="op" id="4232925">(</span><span class="op" id="4232926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4232929">copy</span><span class="op" id="4232933">(</span><span class="ident" id="4232934"><a href="/crypto/tls/key_agreement.go.html#4232841">preMasterSecret</a></span><span class="op" id="4232949">[</span><span class="builtinfunc" id="4232950">len</span><span class="op" id="4232953">(</span><span class="ident" id="4232954"><a href="/crypto/tls/key_agreement.go.html#4232841">preMasterSecret</a></span><span class="op" id="4232969">)</span><span class="op" id="4232970">-</span><span class="builtinfunc" id="4232971">len</span><span class="op" id="4232974">(</span><span class="ident" id="4232975"><a href="/crypto/tls/key_agreement.go.html#4232908">xBytes</a></span><span class="op" id="4232981">)</span><span class="op" id="4232982">:</span><span class="op" id="4232983">]</span><span class="op" id="4232984">,</span>&nbsp;<span class="ident" id="4232986"><a href="/crypto/tls/key_agreement.go.html#4232908">xBytes</a></span><span class="op" id="4232992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232996">return</span>&nbsp;<span class="ident" id="4233003"><a href="/crypto/tls/key_agreement.go.html#4232841">preMasterSecret</a></span><span class="op" id="4233018">,</span>&nbsp;<span class="ident" id="4233020">nil</span><br>
<span class="lineno"></span><span class="op" id="4233024">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="4233027">func</span>&nbsp;<span class="op" id="4233032">(</span><span class="ident" id="4233033">ka</span>&nbsp;<span class="op" id="4233036">*</span><span class="ident" id="4233037"><a href="/crypto/tls/key_agreement.go.html#4229411">ecdheKeyAgreement</a></span><span class="op" id="4233054">)</span>&nbsp;<span class="ident" id="4233056">processServerKeyExchange</span><span class="op" id="4233080">(</span><span class="ident" id="4233081">config</span>&nbsp;<span class="op" id="4233088">*</span><span class="ident" id="4233089"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4233095">,</span>&nbsp;<span class="ident" id="4233097">clientHello</span>&nbsp;<span class="op" id="4233109">*</span><span class="ident" id="4233110"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="4233124">,</span>&nbsp;<span class="ident" id="4233126">serverHello</span>&nbsp;<span class="op" id="4233138">*</span><span class="ident" id="4233139"><a href="/crypto/tls/handshake_messages.go.html#4185078">serverHelloMsg</a></span><span class="op" id="4233153">,</span>&nbsp;<span class="ident" id="4233155">cert</span>&nbsp;<span class="op" id="4233160">*</span><span class="ident" id="4233161"><a href="/crypto/tls/key_agreement.go.html#4223739">x509</a></span><span class="op" id="4233165">.</span><span class="ident" id="4233166">Certificate</span><span class="op" id="4233177">,</span>&nbsp;<span class="ident" id="4233179">skx</span>&nbsp;<span class="op" id="4233183">*</span><span class="ident" id="4233184"><a href="/crypto/tls/handshake_messages.go.html#4192159">serverKeyExchangeMsg</a></span><span class="op" id="4233204">)</span>&nbsp;<span class="builtintype" id="4233206">error</span>&nbsp;<span class="op" id="4233212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233215">if</span>&nbsp;<span class="builtinfunc" id="4233218">len</span><span class="op" id="4233221">(</span><span class="ident" id="4233222"><a href="/crypto/tls/key_agreement.go.html#4233179">skx</a></span><span class="op" id="4233225">.</span><span class="ident" id="4233226">key</span><span class="op" id="4233229">)</span>&nbsp;<span class="op" id="4233231">&lt;</span>&nbsp;<span class="num" id="4233233">4</span>&nbsp;<span class="op" id="4233235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233239">return</span>&nbsp;<span class="ident" id="4233246"><a href="/crypto/tls/key_agreement.go.html#4223885">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233268">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233271">if</span>&nbsp;<span class="ident" id="4233274"><a href="/crypto/tls/key_agreement.go.html#4233179">skx</a></span><span class="op" id="4233277">.</span><span class="ident" id="4233278">key</span><span class="op" id="4233281">[</span><span class="num" id="4233282">0</span><span class="op" id="4233283">]</span>&nbsp;<span class="op" id="4233285">!=</span>&nbsp;<span class="num" id="4233288">3</span>&nbsp;<span class="op" id="4233290">{</span>&nbsp;<span class="comment" id="4233292">//&nbsp;named&nbsp;curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233309">return</span>&nbsp;<span class="ident" id="4233316"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4233322">.</span><span class="ident" id="4233323">New</span><span class="op" id="4233326">(</span><span class="string" id="4233327">&#34;tls:&nbsp;server&nbsp;selected&nbsp;unsupported&nbsp;curve&#34;</span><span class="op" id="4233367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233373">curveid</span>&nbsp;<span class="op" id="4233381">:=</span>&nbsp;<span class="ident" id="4233384"><a href="/crypto/tls/common.go.html#4110037">CurveID</a></span><span class="op" id="4233391">(</span><span class="ident" id="4233392"><a href="/crypto/tls/key_agreement.go.html#4233179">skx</a></span><span class="op" id="4233395">.</span><span class="ident" id="4233396">key</span><span class="op" id="4233399">[</span><span class="num" id="4233400">1</span><span class="op" id="4233401">]</span><span class="op" id="4233402">)</span><span class="op" id="4233403">&lt;&lt;</span><span class="num" id="4233405">8</span>&nbsp;<span class="op" id="4233407">|</span>&nbsp;<span class="ident" id="4233409"><a href="/crypto/tls/common.go.html#4110037">CurveID</a></span><span class="op" id="4233416">(</span><span class="ident" id="4233417"><a href="/crypto/tls/key_agreement.go.html#4233179">skx</a></span><span class="op" id="4233420">.</span><span class="ident" id="4233421">key</span><span class="op" id="4233424">[</span><span class="num" id="4233425">2</span><span class="op" id="4233426">]</span><span class="op" id="4233427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233431">var</span>&nbsp;<span class="ident" id="4233435">ok</span>&nbsp;<span class="builtintype" id="4233438">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233444">if</span>&nbsp;<span class="ident" id="4233447"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4233449">.</span><span class="ident" id="4233450">curve</span><span class="op" id="4233455">,</span>&nbsp;<span class="ident" id="4233457"><a href="/crypto/tls/key_agreement.go.html#4233435">ok</a></span>&nbsp;<span class="op" id="4233460">=</span>&nbsp;<span class="ident" id="4233462"><a href="/crypto/tls/key_agreement.go.html#4228920">curveForCurveID</a></span><span class="op" id="4233477">(</span><span class="ident" id="4233478"><a href="/crypto/tls/key_agreement.go.html#4233373">curveid</a></span><span class="op" id="4233485">)</span><span class="op" id="4233486">;</span>&nbsp;<span class="op" id="4233488">!</span><span class="ident" id="4233489"><a href="/crypto/tls/key_agreement.go.html#4233435">ok</a></span>&nbsp;<span class="op" id="4233492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233496">return</span>&nbsp;<span class="ident" id="4233503"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4233509">.</span><span class="ident" id="4233510">New</span><span class="op" id="4233513">(</span><span class="string" id="4233514">&#34;tls:&nbsp;server&nbsp;selected&nbsp;unsupported&nbsp;curve&#34;</span><span class="op" id="4233554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233561">publicLen</span>&nbsp;<span class="op" id="4233571">:=</span>&nbsp;<span class="builtintype" id="4233574">int</span><span class="op" id="4233577">(</span><span class="ident" id="4233578"><a href="/crypto/tls/key_agreement.go.html#4233179">skx</a></span><span class="op" id="4233581">.</span><span class="ident" id="4233582">key</span><span class="op" id="4233585">[</span><span class="num" id="4233586">3</span><span class="op" id="4233587">]</span><span class="op" id="4233588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233591">if</span>&nbsp;<span class="ident" id="4233594"><a href="/crypto/tls/key_agreement.go.html#4233561">publicLen</a></span><span class="op" id="4233603">+</span><span class="num" id="4233604">4</span>&nbsp;<span class="op" id="4233606">&gt;</span>&nbsp;<span class="builtinfunc" id="4233608">len</span><span class="op" id="4233611">(</span><span class="ident" id="4233612"><a href="/crypto/tls/key_agreement.go.html#4233179">skx</a></span><span class="op" id="4233615">.</span><span class="ident" id="4233616">key</span><span class="op" id="4233619">)</span>&nbsp;<span class="op" id="4233621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233625">return</span>&nbsp;<span class="ident" id="4233632"><a href="/crypto/tls/key_agreement.go.html#4223885">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233657"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4233659">.</span><span class="ident" id="4233660">x</span><span class="op" id="4233661">,</span>&nbsp;<span class="ident" id="4233663"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4233665">.</span><span class="ident" id="4233666">y</span>&nbsp;<span class="op" id="4233668">=</span>&nbsp;<span class="ident" id="4233670"><a href="/crypto/tls/key_agreement.go.html#4223660">elliptic</a></span><span class="op" id="4233678">.</span><span class="ident" id="4233679">Unmarshal</span><span class="op" id="4233688">(</span><span class="ident" id="4233689"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4233691">.</span><span class="ident" id="4233692">curve</span><span class="op" id="4233697">,</span>&nbsp;<span class="ident" id="4233699"><a href="/crypto/tls/key_agreement.go.html#4233179">skx</a></span><span class="op" id="4233702">.</span><span class="ident" id="4233703">key</span><span class="op" id="4233706">[</span><span class="num" id="4233707">4</span><span class="op" id="4233708">:</span><span class="num" id="4233709">4</span><span class="op" id="4233710">+</span><span class="ident" id="4233711"><a href="/crypto/tls/key_agreement.go.html#4233561">publicLen</a></span><span class="op" id="4233720">]</span><span class="op" id="4233721">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233724">if</span>&nbsp;<span class="ident" id="4233727"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4233729">.</span><span class="ident" id="4233730">x</span>&nbsp;<span class="op" id="4233732">==</span>&nbsp;<span class="ident" id="4233735">nil</span>&nbsp;<span class="op" id="4233739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233743">return</span>&nbsp;<span class="ident" id="4233750"><a href="/crypto/tls/key_agreement.go.html#4223885">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233775">if</span>&nbsp;<span class="op" id="4233778">!</span><span class="ident" id="4233779"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4233781">.</span><span class="ident" id="4233782">curve</span><span class="op" id="4233787">.</span><span class="ident" id="4233788">IsOnCurve</span><span class="op" id="4233797">(</span><span class="ident" id="4233798"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4233800">.</span><span class="ident" id="4233801">x</span><span class="op" id="4233802">,</span>&nbsp;<span class="ident" id="4233804"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4233806">.</span><span class="ident" id="4233807">y</span><span class="op" id="4233808">)</span>&nbsp;<span class="op" id="4233810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233814">return</span>&nbsp;<span class="ident" id="4233821"><a href="/crypto/tls/key_agreement.go.html#4223885">errServerKeyExchange</a></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233846">serverECDHParams</span>&nbsp;<span class="op" id="4233863">:=</span>&nbsp;<span class="ident" id="4233866"><a href="/crypto/tls/key_agreement.go.html#4233179">skx</a></span><span class="op" id="4233869">.</span><span class="ident" id="4233870">key</span><span class="op" id="4233873">[</span><span class="op" id="4233874">:</span><span class="num" id="4233875">4</span><span class="op" id="4233876">+</span><span class="ident" id="4233877"><a href="/crypto/tls/key_agreement.go.html#4233561">publicLen</a></span><span class="op" id="4233886">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233890">sig</span>&nbsp;<span class="op" id="4233894">:=</span>&nbsp;<span class="ident" id="4233897"><a href="/crypto/tls/key_agreement.go.html#4233179">skx</a></span><span class="op" id="4233900">.</span><span class="ident" id="4233901">key</span><span class="op" id="4233904">[</span><span class="num" id="4233905">4</span><span class="op" id="4233906">+</span><span class="ident" id="4233907"><a href="/crypto/tls/key_agreement.go.html#4233561">publicLen</a></span><span class="op" id="4233916">:</span><span class="op" id="4233917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233920">if</span>&nbsp;<span class="builtinfunc" id="4233923">len</span><span class="op" id="4233926">(</span><span class="ident" id="4233927"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span><span class="op" id="4233930">)</span>&nbsp;<span class="op" id="4233932">&lt;</span>&nbsp;<span class="num" id="4233934">2</span>&nbsp;<span class="op" id="4233936">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233940">return</span>&nbsp;<span class="ident" id="4233947"><a href="/crypto/tls/key_agreement.go.html#4223885">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233973">var</span>&nbsp;<span class="ident" id="4233977">tls12HashId</span>&nbsp;<span class="builtintype" id="4233989">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233996">if</span>&nbsp;<span class="ident" id="4233999"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4234001">.</span><span class="ident" id="4234002">version</span>&nbsp;<span class="op" id="4234010">&gt;=</span>&nbsp;<span class="ident" id="4234013"><a href="/crypto/tls/common.go.html#4108205">VersionTLS12</a></span>&nbsp;<span class="op" id="4234026">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4234030">//&nbsp;handle&nbsp;SignatureAndHashAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234068">var</span>&nbsp;<span class="ident" id="4234072">sigAndHash</span>&nbsp;<span class="op" id="4234083">[</span><span class="op" id="4234084">]</span><span class="builtintype" id="4234085">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234093"><a href="/crypto/tls/key_agreement.go.html#4234072">sigAndHash</a></span><span class="op" id="4234103">,</span>&nbsp;<span class="ident" id="4234105"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span>&nbsp;<span class="op" id="4234109">=</span>&nbsp;<span class="ident" id="4234111"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span><span class="op" id="4234114">[</span><span class="op" id="4234115">:</span><span class="num" id="4234116">2</span><span class="op" id="4234117">]</span><span class="op" id="4234118">,</span>&nbsp;<span class="ident" id="4234120"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span><span class="op" id="4234123">[</span><span class="num" id="4234124">2</span><span class="op" id="4234125">:</span><span class="op" id="4234126">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234130">if</span>&nbsp;<span class="ident" id="4234133"><a href="/crypto/tls/key_agreement.go.html#4234072">sigAndHash</a></span><span class="op" id="4234143">[</span><span class="num" id="4234144">1</span><span class="op" id="4234145">]</span>&nbsp;<span class="op" id="4234147">!=</span>&nbsp;<span class="ident" id="4234150"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4234152">.</span><span class="ident" id="4234153">sigType</span>&nbsp;<span class="op" id="4234161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234166">return</span>&nbsp;<span class="ident" id="4234173"><a href="/crypto/tls/key_agreement.go.html#4223885">errServerKeyExchange</a></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4234196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234200"><a href="/crypto/tls/key_agreement.go.html#4233977">tls12HashId</a></span>&nbsp;<span class="op" id="4234212">=</span>&nbsp;<span class="ident" id="4234214"><a href="/crypto/tls/key_agreement.go.html#4234072">sigAndHash</a></span><span class="op" id="4234224">[</span><span class="num" id="4234225">0</span><span class="op" id="4234226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234230">if</span>&nbsp;<span class="builtinfunc" id="4234233">len</span><span class="op" id="4234236">(</span><span class="ident" id="4234237"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span><span class="op" id="4234240">)</span>&nbsp;<span class="op" id="4234242">&lt;</span>&nbsp;<span class="num" id="4234244">2</span>&nbsp;<span class="op" id="4234246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234251">return</span>&nbsp;<span class="ident" id="4234258"><a href="/crypto/tls/key_agreement.go.html#4223885">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4234281">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4234284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234287">sigLen</span>&nbsp;<span class="op" id="4234294">:=</span>&nbsp;<span class="builtintype" id="4234297">int</span><span class="op" id="4234300">(</span><span class="ident" id="4234301"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span><span class="op" id="4234304">[</span><span class="num" id="4234305">0</span><span class="op" id="4234306">]</span><span class="op" id="4234307">)</span><span class="op" id="4234308">&lt;&lt;</span><span class="num" id="4234310">8</span>&nbsp;<span class="op" id="4234312">|</span>&nbsp;<span class="builtintype" id="4234314">int</span><span class="op" id="4234317">(</span><span class="ident" id="4234318"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span><span class="op" id="4234321">[</span><span class="num" id="4234322">1</span><span class="op" id="4234323">]</span><span class="op" id="4234324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234327">if</span>&nbsp;<span class="ident" id="4234330"><a href="/crypto/tls/key_agreement.go.html#4234287">sigLen</a></span><span class="op" id="4234336">+</span><span class="num" id="4234337">2</span>&nbsp;<span class="op" id="4234339">!=</span>&nbsp;<span class="builtinfunc" id="4234342">len</span><span class="op" id="4234345">(</span><span class="ident" id="4234346"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span><span class="op" id="4234349">)</span>&nbsp;<span class="op" id="4234351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234355">return</span>&nbsp;<span class="ident" id="4234362"><a href="/crypto/tls/key_agreement.go.html#4223885">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4234384">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234387"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span>&nbsp;<span class="op" id="4234391">=</span>&nbsp;<span class="ident" id="4234393"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span><span class="op" id="4234396">[</span><span class="num" id="4234397">2</span><span class="op" id="4234398">:</span><span class="op" id="4234399">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234403">digest</span><span class="op" id="4234409">,</span>&nbsp;<span class="ident" id="4234411">hashFunc</span><span class="op" id="4234419">,</span>&nbsp;<span class="ident" id="4234421">err</span>&nbsp;<span class="op" id="4234425">:=</span>&nbsp;<span class="ident" id="4234428"><a href="/crypto/tls/key_agreement.go.html#4227529">hashForServerKeyExchange</a></span><span class="op" id="4234452">(</span><span class="ident" id="4234453"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4234455">.</span><span class="ident" id="4234456">sigType</span><span class="op" id="4234463">,</span>&nbsp;<span class="ident" id="4234465"><a href="/crypto/tls/key_agreement.go.html#4233977">tls12HashId</a></span><span class="op" id="4234476">,</span>&nbsp;<span class="ident" id="4234478"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4234480">.</span><span class="ident" id="4234481">version</span><span class="op" id="4234488">,</span>&nbsp;<span class="ident" id="4234490"><a href="/crypto/tls/key_agreement.go.html#4233097">clientHello</a></span><span class="op" id="4234501">.</span><span class="ident" id="4234502">random</span><span class="op" id="4234508">,</span>&nbsp;<span class="ident" id="4234510"><a href="/crypto/tls/key_agreement.go.html#4233126">serverHello</a></span><span class="op" id="4234521">.</span><span class="ident" id="4234522">random</span><span class="op" id="4234528">,</span>&nbsp;<span class="ident" id="4234530"><a href="/crypto/tls/key_agreement.go.html#4233846">serverECDHParams</a></span><span class="op" id="4234546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234549">if</span>&nbsp;<span class="ident" id="4234552"><a href="/crypto/tls/key_agreement.go.html#4234421">err</a></span>&nbsp;<span class="op" id="4234556">!=</span>&nbsp;<span class="ident" id="4234559">nil</span>&nbsp;<span class="op" id="4234563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234567">return</span>&nbsp;<span class="ident" id="4234574"><a href="/crypto/tls/key_agreement.go.html#4234421">err</a></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4234579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234582">switch</span>&nbsp;<span class="ident" id="4234589"><a href="/crypto/tls/key_agreement.go.html#4233033">ka</a></span><span class="op" id="4234591">.</span><span class="ident" id="4234592">sigType</span>&nbsp;<span class="op" id="4234600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234603">case</span>&nbsp;<span class="ident" id="4234608"><a href="/crypto/tls/common.go.html#4111314">signatureECDSA</a></span><span class="op" id="4234622">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234626">pubKey</span><span class="op" id="4234632">,</span>&nbsp;<span class="ident" id="4234634">ok</span>&nbsp;<span class="op" id="4234637">:=</span>&nbsp;<span class="ident" id="4234640"><a href="/crypto/tls/key_agreement.go.html#4233155">cert</a></span><span class="op" id="4234644">.</span><span class="ident" id="4234645">PublicKey</span><span class="op" id="4234654">.</span><span class="op" id="4234655">(</span><span class="op" id="4234656">*</span><span class="ident" id="4234657"><a href="/crypto/tls/key_agreement.go.html#4223644">ecdsa</a></span><span class="op" id="4234662">.</span><span class="ident" id="4234663">PublicKey</span><span class="op" id="4234672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234676">if</span>&nbsp;<span class="op" id="4234679">!</span><span class="ident" id="4234680"><a href="/crypto/tls/key_agreement.go.html#4234634">ok</a></span>&nbsp;<span class="op" id="4234683">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234688">return</span>&nbsp;<span class="ident" id="4234695"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4234701">.</span><span class="ident" id="4234702">New</span><span class="op" id="4234705">(</span><span class="string" id="4234706">&#34;ECDHE&nbsp;ECDSA&nbsp;requires&nbsp;a&nbsp;ECDSA&nbsp;server&nbsp;public&nbsp;key&#34;</span><span class="op" id="4234754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4234758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234762">ecdsaSig</span>&nbsp;<span class="op" id="4234771">:=</span>&nbsp;<span class="builtinfunc" id="4234774">new</span><span class="op" id="4234777">(</span><span class="ident" id="4234778"><a href="/crypto/tls/common.go.html#4126536">ecdsaSignature</a></span><span class="op" id="4234792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234796">if</span>&nbsp;<span class="ident" id="4234799">_</span><span class="op" id="4234800">,</span>&nbsp;<span class="ident" id="4234802">err</span>&nbsp;<span class="op" id="4234806">:=</span>&nbsp;<span class="ident" id="4234809"><a href="/crypto/tls/key_agreement.go.html#4223754">asn1</a></span><span class="op" id="4234813">.</span><span class="ident" id="4234814">Unmarshal</span><span class="op" id="4234823">(</span><span class="ident" id="4234824"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span><span class="op" id="4234827">,</span>&nbsp;<span class="ident" id="4234829"><a href="/crypto/tls/key_agreement.go.html#4234762">ecdsaSig</a></span><span class="op" id="4234837">)</span><span class="op" id="4234838">;</span>&nbsp;<span class="ident" id="4234840"><a href="/crypto/tls/key_agreement.go.html#4234802">err</a></span>&nbsp;<span class="op" id="4234844">!=</span>&nbsp;<span class="ident" id="4234847">nil</span>&nbsp;<span class="op" id="4234851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234856">return</span>&nbsp;<span class="ident" id="4234863"><a href="/crypto/tls/key_agreement.go.html#4234802">err</a></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4234869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234873">if</span>&nbsp;<span class="ident" id="4234876"><a href="/crypto/tls/key_agreement.go.html#4234762">ecdsaSig</a></span><span class="op" id="4234884">.</span><span class="ident" id="4234885">R</span><span class="op" id="4234886">.</span><span class="ident" id="4234887">Sign</span><span class="op" id="4234891">(</span><span class="op" id="4234892">)</span>&nbsp;<span class="op" id="4234894">&lt;=</span>&nbsp;<span class="num" id="4234897">0</span>&nbsp;<span class="op" id="4234899">||</span>&nbsp;<span class="ident" id="4234902"><a href="/crypto/tls/key_agreement.go.html#4234762">ecdsaSig</a></span><span class="op" id="4234910">.</span><span class="ident" id="4234911">S</span><span class="op" id="4234912">.</span><span class="ident" id="4234913">Sign</span><span class="op" id="4234917">(</span><span class="op" id="4234918">)</span>&nbsp;<span class="op" id="4234920">&lt;=</span>&nbsp;<span class="num" id="4234923">0</span>&nbsp;<span class="op" id="4234925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234930">return</span>&nbsp;<span class="ident" id="4234937"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4234943">.</span><span class="ident" id="4234944">New</span><span class="op" id="4234947">(</span><span class="string" id="4234948">&#34;ECDSA&nbsp;signature&nbsp;contained&nbsp;zero&nbsp;or&nbsp;negative&nbsp;values&#34;</span><span class="op" id="4234999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4235003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235007">if</span>&nbsp;<span class="op" id="4235010">!</span><span class="ident" id="4235011"><a href="/crypto/tls/key_agreement.go.html#4223644">ecdsa</a></span><span class="op" id="4235016">.</span><span class="ident" id="4235017">Verify</span><span class="op" id="4235023">(</span><span class="ident" id="4235024"><a href="/crypto/tls/key_agreement.go.html#4234626">pubKey</a></span><span class="op" id="4235030">,</span>&nbsp;<span class="ident" id="4235032"><a href="/crypto/tls/key_agreement.go.html#4234403">digest</a></span><span class="op" id="4235038">,</span>&nbsp;<span class="ident" id="4235040"><a href="/crypto/tls/key_agreement.go.html#4234762">ecdsaSig</a></span><span class="op" id="4235048">.</span><span class="ident" id="4235049">R</span><span class="op" id="4235050">,</span>&nbsp;<span class="ident" id="4235052"><a href="/crypto/tls/key_agreement.go.html#4234762">ecdsaSig</a></span><span class="op" id="4235060">.</span><span class="ident" id="4235061">S</span><span class="op" id="4235062">)</span>&nbsp;<span class="op" id="4235064">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235069">return</span>&nbsp;<span class="ident" id="4235076"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4235082">.</span><span class="ident" id="4235083">New</span><span class="op" id="4235086">(</span><span class="string" id="4235087">&#34;ECDSA&nbsp;verification&nbsp;failure&#34;</span><span class="op" id="4235115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4235119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235122">case</span>&nbsp;<span class="ident" id="4235127"><a href="/crypto/tls/common.go.html#4111288">signatureRSA</a></span><span class="op" id="4235139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235143">pubKey</span><span class="op" id="4235149">,</span>&nbsp;<span class="ident" id="4235151">ok</span>&nbsp;<span class="op" id="4235154">:=</span>&nbsp;<span class="ident" id="4235157"><a href="/crypto/tls/key_agreement.go.html#4233155">cert</a></span><span class="op" id="4235161">.</span><span class="ident" id="4235162">PublicKey</span><span class="op" id="4235171">.</span><span class="op" id="4235172">(</span><span class="op" id="4235173">*</span><span class="ident" id="4235174"><a href="/crypto/tls/key_agreement.go.html#4223693">rsa</a></span><span class="op" id="4235177">.</span><span class="ident" id="4235178">PublicKey</span><span class="op" id="4235187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235191">if</span>&nbsp;<span class="op" id="4235194">!</span><span class="ident" id="4235195"><a href="/crypto/tls/key_agreement.go.html#4235151">ok</a></span>&nbsp;<span class="op" id="4235198">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235203">return</span>&nbsp;<span class="ident" id="4235210"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4235216">.</span><span class="ident" id="4235217">New</span><span class="op" id="4235220">(</span><span class="string" id="4235221">&#34;ECDHE&nbsp;RSA&nbsp;requires&nbsp;a&nbsp;RSA&nbsp;server&nbsp;public&nbsp;key&#34;</span><span class="op" id="4235265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4235269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235273">if</span>&nbsp;<span class="ident" id="4235276">err</span>&nbsp;<span class="op" id="4235280">:=</span>&nbsp;<span class="ident" id="4235283"><a href="/crypto/tls/key_agreement.go.html#4223693">rsa</a></span><span class="op" id="4235286">.</span><span class="ident" id="4235287">VerifyPKCS1v15</span><span class="op" id="4235301">(</span><span class="ident" id="4235302"><a href="/crypto/tls/key_agreement.go.html#4235143">pubKey</a></span><span class="op" id="4235308">,</span>&nbsp;<span class="ident" id="4235310"><a href="/crypto/tls/key_agreement.go.html#4234411">hashFunc</a></span><span class="op" id="4235318">,</span>&nbsp;<span class="ident" id="4235320"><a href="/crypto/tls/key_agreement.go.html#4234403">digest</a></span><span class="op" id="4235326">,</span>&nbsp;<span class="ident" id="4235328"><a href="/crypto/tls/key_agreement.go.html#4233890">sig</a></span><span class="op" id="4235331">)</span><span class="op" id="4235332">;</span>&nbsp;<span class="ident" id="4235334"><a href="/crypto/tls/key_agreement.go.html#4235276">err</a></span>&nbsp;<span class="op" id="4235338">!=</span>&nbsp;<span class="ident" id="4235341">nil</span>&nbsp;<span class="op" id="4235345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235350">return</span>&nbsp;<span class="ident" id="4235357"><a href="/crypto/tls/key_agreement.go.html#4235276">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4235363">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235366">default</span><span class="op" id="4235373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235377">return</span>&nbsp;<span class="ident" id="4235384"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4235390">.</span><span class="ident" id="4235391">New</span><span class="op" id="4235394">(</span><span class="string" id="4235395">&#34;unknown&nbsp;ECDHE&nbsp;signature&nbsp;algorithm&#34;</span><span class="op" id="4235430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4235433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235437">return</span>&nbsp;<span class="ident" id="4235444">nil</span><br>
<span class="lineno">390</span><span class="op" id="4235448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4235451">func</span>&nbsp;<span class="op" id="4235456">(</span><span class="ident" id="4235457">ka</span>&nbsp;<span class="op" id="4235460">*</span><span class="ident" id="4235461"><a href="/crypto/tls/key_agreement.go.html#4229411">ecdheKeyAgreement</a></span><span class="op" id="4235478">)</span>&nbsp;<span class="ident" id="4235480">generateClientKeyExchange</span><span class="op" id="4235505">(</span><span class="ident" id="4235506">config</span>&nbsp;<span class="op" id="4235513">*</span><span class="ident" id="4235514"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4235520">,</span>&nbsp;<span class="ident" id="4235522">clientHello</span>&nbsp;<span class="op" id="4235534">*</span><span class="ident" id="4235535"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="4235549">,</span>&nbsp;<span class="ident" id="4235551">cert</span>&nbsp;<span class="op" id="4235556">*</span><span class="ident" id="4235557"><a href="/crypto/tls/key_agreement.go.html#4223739">x509</a></span><span class="op" id="4235561">.</span><span class="ident" id="4235562">Certificate</span><span class="op" id="4235573">)</span>&nbsp;<span class="op" id="4235575">(</span><span class="op" id="4235576">[</span><span class="op" id="4235577">]</span><span class="builtintype" id="4235578">byte</span><span class="op" id="4235582">,</span>&nbsp;<span class="op" id="4235584">*</span><span class="ident" id="4235585"><a href="/crypto/tls/handshake_messages.go.html#4194449">clientKeyExchangeMsg</a></span><span class="op" id="4235605">,</span>&nbsp;<span class="builtintype" id="4235607">error</span><span class="op" id="4235612">)</span>&nbsp;<span class="op" id="4235614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235617">if</span>&nbsp;<span class="ident" id="4235620"><a href="/crypto/tls/key_agreement.go.html#4235457">ka</a></span><span class="op" id="4235622">.</span><span class="ident" id="4235623">curve</span>&nbsp;<span class="op" id="4235629">==</span>&nbsp;<span class="ident" id="4235632">nil</span>&nbsp;<span class="op" id="4235636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235640">return</span>&nbsp;<span class="ident" id="4235647">nil</span><span class="op" id="4235650">,</span>&nbsp;<span class="ident" id="4235652">nil</span><span class="op" id="4235655">,</span>&nbsp;<span class="ident" id="4235657"><a href="/crypto/tls/key_agreement.go.html#4223771">errors</a></span><span class="op" id="4235663">.</span><span class="ident" id="4235664">New</span><span class="op" id="4235667">(</span><span class="string" id="4235668">&#34;missing&nbsp;ServerKeyExchange&nbsp;message&#34;</span><span class="op" id="4235703">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4235706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235709">priv</span><span class="op" id="4235713">,</span>&nbsp;<span class="ident" id="4235715">mx</span><span class="op" id="4235717">,</span>&nbsp;<span class="ident" id="4235719">my</span><span class="op" id="4235721">,</span>&nbsp;<span class="ident" id="4235723">err</span>&nbsp;<span class="op" id="4235727">:=</span>&nbsp;<span class="ident" id="4235730"><a href="/crypto/tls/key_agreement.go.html#4223660">elliptic</a></span><span class="op" id="4235738">.</span><span class="ident" id="4235739">GenerateKey</span><span class="op" id="4235750">(</span><span class="ident" id="4235751"><a href="/crypto/tls/key_agreement.go.html#4235457">ka</a></span><span class="op" id="4235753">.</span><span class="ident" id="4235754">curve</span><span class="op" id="4235759">,</span>&nbsp;<span class="ident" id="4235761"><a href="/crypto/tls/key_agreement.go.html#4235506">config</a></span><span class="op" id="4235767">.</span><span class="ident" id="4235768">rand</span><span class="op" id="4235772">(</span><span class="op" id="4235773">)</span><span class="op" id="4235774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235777">if</span>&nbsp;<span class="ident" id="4235780"><a href="/crypto/tls/key_agreement.go.html#4235723">err</a></span>&nbsp;<span class="op" id="4235784">!=</span>&nbsp;<span class="ident" id="4235787">nil</span>&nbsp;<span class="op" id="4235791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235795">return</span>&nbsp;<span class="ident" id="4235802">nil</span><span class="op" id="4235805">,</span>&nbsp;<span class="ident" id="4235807">nil</span><span class="op" id="4235810">,</span>&nbsp;<span class="ident" id="4235812"><a href="/crypto/tls/key_agreement.go.html#4235723">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4235817">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235820">x</span><span class="op" id="4235821">,</span>&nbsp;<span class="ident" id="4235823">_</span>&nbsp;<span class="op" id="4235825">:=</span>&nbsp;<span class="ident" id="4235828"><a href="/crypto/tls/key_agreement.go.html#4235457">ka</a></span><span class="op" id="4235830">.</span><span class="ident" id="4235831">curve</span><span class="op" id="4235836">.</span><span class="ident" id="4235837">ScalarMult</span><span class="op" id="4235847">(</span><span class="ident" id="4235848"><a href="/crypto/tls/key_agreement.go.html#4235457">ka</a></span><span class="op" id="4235850">.</span><span class="ident" id="4235851">x</span><span class="op" id="4235852">,</span>&nbsp;<span class="ident" id="4235854"><a href="/crypto/tls/key_agreement.go.html#4235457">ka</a></span><span class="op" id="4235856">.</span><span class="ident" id="4235857">y</span><span class="op" id="4235858">,</span>&nbsp;<span class="ident" id="4235860"><a href="/crypto/tls/key_agreement.go.html#4235709">priv</a></span><span class="op" id="4235864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235867">preMasterSecret</span>&nbsp;<span class="op" id="4235883">:=</span>&nbsp;<span class="builtinfunc" id="4235886">make</span><span class="op" id="4235890">(</span><span class="op" id="4235891">[</span><span class="op" id="4235892">]</span><span class="builtintype" id="4235893">byte</span><span class="op" id="4235897">,</span>&nbsp;<span class="op" id="4235899">(</span><span class="ident" id="4235900"><a href="/crypto/tls/key_agreement.go.html#4235457">ka</a></span><span class="op" id="4235902">.</span><span class="ident" id="4235903">curve</span><span class="op" id="4235908">.</span><span class="ident" id="4235909">Params</span><span class="op" id="4235915">(</span><span class="op" id="4235916">)</span><span class="op" id="4235917">.</span><span class="ident" id="4235918">BitSize</span><span class="op" id="4235925">+</span><span class="num" id="4235926">7</span><span class="op" id="4235927">)</span><span class="op" id="4235928">&gt;&gt;</span><span class="num" id="4235930">3</span><span class="op" id="4235931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235934">xBytes</span>&nbsp;<span class="op" id="4235941">:=</span>&nbsp;<span class="ident" id="4235944"><a href="/crypto/tls/key_agreement.go.html#4235820">x</a></span><span class="op" id="4235945">.</span><span class="ident" id="4235946">Bytes</span><span class="op" id="4235951">(</span><span class="op" id="4235952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4235955">copy</span><span class="op" id="4235959">(</span><span class="ident" id="4235960"><a href="/crypto/tls/key_agreement.go.html#4235867">preMasterSecret</a></span><span class="op" id="4235975">[</span><span class="builtinfunc" id="4235976">len</span><span class="op" id="4235979">(</span><span class="ident" id="4235980"><a href="/crypto/tls/key_agreement.go.html#4235867">preMasterSecret</a></span><span class="op" id="4235995">)</span><span class="op" id="4235996">-</span><span class="builtinfunc" id="4235997">len</span><span class="op" id="4236000">(</span><span class="ident" id="4236001"><a href="/crypto/tls/key_agreement.go.html#4235934">xBytes</a></span><span class="op" id="4236007">)</span><span class="op" id="4236008">:</span><span class="op" id="4236009">]</span><span class="op" id="4236010">,</span>&nbsp;<span class="ident" id="4236012"><a href="/crypto/tls/key_agreement.go.html#4235934">xBytes</a></span><span class="op" id="4236018">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236022">serialized</span>&nbsp;<span class="op" id="4236033">:=</span>&nbsp;<span class="ident" id="4236036"><a href="/crypto/tls/key_agreement.go.html#4223660">elliptic</a></span><span class="op" id="4236044">.</span><span class="ident" id="4236045">Marshal</span><span class="op" id="4236052">(</span><span class="ident" id="4236053"><a href="/crypto/tls/key_agreement.go.html#4235457">ka</a></span><span class="op" id="4236055">.</span><span class="ident" id="4236056">curve</span><span class="op" id="4236061">,</span>&nbsp;<span class="ident" id="4236063"><a href="/crypto/tls/key_agreement.go.html#4235715">mx</a></span><span class="op" id="4236065">,</span>&nbsp;<span class="ident" id="4236067"><a href="/crypto/tls/key_agreement.go.html#4235719">my</a></span><span class="op" id="4236069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236073">ckx</span>&nbsp;<span class="op" id="4236077">:=</span>&nbsp;<span class="builtinfunc" id="4236080">new</span><span class="op" id="4236083">(</span><span class="ident" id="4236084"><a href="/crypto/tls/handshake_messages.go.html#4194449">clientKeyExchangeMsg</a></span><span class="op" id="4236104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236107"><a href="/crypto/tls/key_agreement.go.html#4236073">ckx</a></span><span class="op" id="4236110">.</span><span class="ident" id="4236111">ciphertext</span>&nbsp;<span class="op" id="4236122">=</span>&nbsp;<span class="builtinfunc" id="4236124">make</span><span class="op" id="4236128">(</span><span class="op" id="4236129">[</span><span class="op" id="4236130">]</span><span class="builtintype" id="4236131">byte</span><span class="op" id="4236135">,</span>&nbsp;<span class="num" id="4236137">1</span><span class="op" id="4236138">+</span><span class="builtinfunc" id="4236139">len</span><span class="op" id="4236142">(</span><span class="ident" id="4236143"><a href="/crypto/tls/key_agreement.go.html#4236022">serialized</a></span><span class="op" id="4236153">)</span><span class="op" id="4236154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236157"><a href="/crypto/tls/key_agreement.go.html#4236073">ckx</a></span><span class="op" id="4236160">.</span><span class="ident" id="4236161">ciphertext</span><span class="op" id="4236171">[</span><span class="num" id="4236172">0</span><span class="op" id="4236173">]</span>&nbsp;<span class="op" id="4236175">=</span>&nbsp;<span class="builtintype" id="4236177">byte</span><span class="op" id="4236181">(</span><span class="builtinfunc" id="4236182">len</span><span class="op" id="4236185">(</span><span class="ident" id="4236186"><a href="/crypto/tls/key_agreement.go.html#4236022">serialized</a></span><span class="op" id="4236196">)</span><span class="op" id="4236197">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4236200">copy</span><span class="op" id="4236204">(</span><span class="ident" id="4236205"><a href="/crypto/tls/key_agreement.go.html#4236073">ckx</a></span><span class="op" id="4236208">.</span><span class="ident" id="4236209">ciphertext</span><span class="op" id="4236219">[</span><span class="num" id="4236220">1</span><span class="op" id="4236221">:</span><span class="op" id="4236222">]</span><span class="op" id="4236223">,</span>&nbsp;<span class="ident" id="4236225"><a href="/crypto/tls/key_agreement.go.html#4236022">serialized</a></span><span class="op" id="4236235">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236239">return</span>&nbsp;<span class="ident" id="4236246"><a href="/crypto/tls/key_agreement.go.html#4235867">preMasterSecret</a></span><span class="op" id="4236261">,</span>&nbsp;<span class="ident" id="4236263"><a href="/crypto/tls/key_agreement.go.html#4236073">ckx</a></span><span class="op" id="4236266">,</span>&nbsp;<span class="ident" id="4236268">nil</span><br>
<span class="lineno"></span><span class="op" id="4236272">}</span>
</div>
</body>
</html>
