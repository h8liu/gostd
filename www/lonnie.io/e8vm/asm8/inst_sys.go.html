<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="6044933">package</span>&nbsp;<span class="ident" id="6044941">asm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6044947">import</span>&nbsp;<span class="op" id="6044954">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6044957">&#34;lonnie.io/e8vm/lex8&#34;</span><br>
<span class="lineno">5</span><span class="op" id="6044979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6044982">var</span>&nbsp;<span class="op" id="6044986">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6044989">//&nbsp;op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6044996">opSysMap</span>&nbsp;<span class="op" id="6045005">=</span>&nbsp;<span class="keyword" id="6045007">map</span><span class="op" id="6045010">[</span><span class="builtintype" id="6045011">string</span><span class="op" id="6045017">]</span><span class="builtintype" id="6045018">uint32</span><span class="op" id="6045024">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045028">&#34;halt&#34;</span><span class="op" id="6045034">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6045039">64</span><span class="op" id="6045041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045045">&#34;syscall&#34;</span><span class="op" id="6045054">:</span>&nbsp;<span class="num" id="6045056">65</span><span class="op" id="6045058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045062">&#34;usermod&#34;</span><span class="op" id="6045071">:</span>&nbsp;<span class="num" id="6045073">66</span><span class="op" id="6045075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045079">&#34;iret&#34;</span><span class="op" id="6045085">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6045090">68</span><span class="op" id="6045092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6045095">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6045099">//&nbsp;op&nbsp;reg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045110">opSys1Map</span>&nbsp;<span class="op" id="6045120">=</span>&nbsp;<span class="keyword" id="6045122">map</span><span class="op" id="6045125">[</span><span class="builtintype" id="6045126">string</span><span class="op" id="6045132">]</span><span class="builtintype" id="6045133">uint32</span><span class="op" id="6045139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045143">&#34;vtable&#34;</span><span class="op" id="6045151">:</span>&nbsp;<span class="num" id="6045153">67</span><span class="op" id="6045155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045159">&#34;cpuid&#34;</span><span class="op" id="6045166">:</span>&nbsp;&nbsp;<span class="num" id="6045169">69</span><span class="op" id="6045171">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6045174">}</span><br>
<span class="lineno"></span><span class="op" id="6045176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6045179">func</span>&nbsp;<span class="ident" id="6045184">makeInstSys</span><span class="op" id="6045195">(</span><span class="ident" id="6045196">op</span><span class="op" id="6045198">,</span>&nbsp;<span class="ident" id="6045200">reg</span>&nbsp;<span class="builtintype" id="6045204">uint32</span><span class="op" id="6045210">)</span>&nbsp;<span class="op" id="6045212">*</span><span class="ident" id="6045213"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037298">inst</a></span>&nbsp;<span class="op" id="6045218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045221">ret</span>&nbsp;<span class="op" id="6045225">:=</span>&nbsp;<span class="op" id="6045228">(</span><span class="op" id="6045229">(</span><span class="ident" id="6045230"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045196">op</a></span>&nbsp;<span class="op" id="6045233">&amp;</span>&nbsp;<span class="num" id="6045235">0xff</span><span class="op" id="6045239">)</span>&nbsp;<span class="op" id="6045241">&lt;&lt;</span>&nbsp;<span class="num" id="6045244">24</span><span class="op" id="6045246">)</span>&nbsp;<span class="op" id="6045248">|</span>&nbsp;<span class="op" id="6045250">(</span><span class="op" id="6045251">(</span><span class="ident" id="6045252"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045200">reg</a></span>&nbsp;<span class="op" id="6045256">&amp;</span>&nbsp;<span class="num" id="6045258">0x7</span><span class="op" id="6045261">)</span>&nbsp;<span class="op" id="6045263">&lt;&lt;</span>&nbsp;<span class="num" id="6045266">21</span><span class="op" id="6045268">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6045271">return</span>&nbsp;<span class="op" id="6045278">&amp;</span><span class="ident" id="6045279"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037298">inst</a></span><span class="op" id="6045283">{</span><span class="ident" id="6045284">inst</span><span class="op" id="6045288">:</span>&nbsp;<span class="ident" id="6045290"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045221">ret</a></span><span class="op" id="6045293">}</span><br>
<span class="lineno"></span><span class="op" id="6045295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6045298">func</span>&nbsp;<span class="ident" id="6045303">parseInstSys</span><span class="op" id="6045315">(</span><span class="ident" id="6045316">p</span>&nbsp;<span class="op" id="6045318">*</span><span class="ident" id="6045319"><a href="/lonnie.io/e8vm/asm8/parser.go.html#6059818">parser</a></span><span class="op" id="6045325">,</span>&nbsp;<span class="ident" id="6045327">ops</span>&nbsp;<span class="op" id="6045331">[</span><span class="op" id="6045332">]</span><span class="op" id="6045333">*</span><span class="ident" id="6045334"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6044957">lex8</a></span><span class="op" id="6045338">.</span><span class="ident" id="6045339">Token</span><span class="op" id="6045344">)</span>&nbsp;<span class="op" id="6045346">(</span><span class="op" id="6045347">*</span><span class="ident" id="6045348"><a href="/lonnie.io/e8vm/asm8/inst.go.html#6037298">inst</a></span><span class="op" id="6045352">,</span>&nbsp;<span class="builtintype" id="6045354">bool</span><span class="op" id="6045358">)</span>&nbsp;<span class="op" id="6045360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045363">op0</span>&nbsp;<span class="op" id="6045367">:=</span>&nbsp;<span class="ident" id="6045370"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045327">ops</a></span><span class="op" id="6045373">[</span><span class="num" id="6045374">0</span><span class="op" id="6045375">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045378">opName</span>&nbsp;<span class="op" id="6045385">:=</span>&nbsp;<span class="ident" id="6045388"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045363">op0</a></span><span class="op" id="6045391">.</span><span class="ident" id="6045392">Lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045397">args</span>&nbsp;<span class="op" id="6045402">:=</span>&nbsp;<span class="ident" id="6045405"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045327">ops</a></span><span class="op" id="6045408">[</span><span class="num" id="6045409">1</span><span class="op" id="6045410">:</span><span class="op" id="6045411">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6045414">var</span>&nbsp;<span class="ident" id="6045418">op</span><span class="op" id="6045420">,</span>&nbsp;<span class="ident" id="6045422">reg</span>&nbsp;<span class="builtintype" id="6045426">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045435">argCount</span>&nbsp;<span class="op" id="6045444">:=</span>&nbsp;<span class="keyword" id="6045447">func</span><span class="op" id="6045451">(</span><span class="ident" id="6045452">n</span>&nbsp;<span class="builtintype" id="6045454">int</span><span class="op" id="6045457">)</span>&nbsp;<span class="builtintype" id="6045459">bool</span>&nbsp;<span class="op" id="6045464">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6045468">if</span>&nbsp;<span class="op" id="6045471">!</span><span class="ident" id="6045472"><a href="/lonnie.io/e8vm/asm8/parse_arg.go.html#6052672">argCount</a></span><span class="op" id="6045480">(</span><span class="ident" id="6045481"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045316">p</a></span><span class="op" id="6045482">,</span>&nbsp;<span class="ident" id="6045484"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045327">ops</a></span><span class="op" id="6045487">,</span>&nbsp;<span class="ident" id="6045489"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045452">n</a></span><span class="op" id="6045490">)</span>&nbsp;<span class="op" id="6045492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6045497">return</span>&nbsp;<span class="builtintype" id="6045504">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6045512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6045517">if</span>&nbsp;<span class="ident" id="6045520"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045452">n</a></span>&nbsp;<span class="op" id="6045522">&gt;=</span>&nbsp;<span class="num" id="6045525">1</span>&nbsp;<span class="op" id="6045527">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045532"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045422">reg</a></span>&nbsp;<span class="op" id="6045536">=</span>&nbsp;<span class="ident" id="6045538"><a href="/lonnie.io/e8vm/asm8/parse_reg.go.html#6056310">parseReg</a></span><span class="op" id="6045546">(</span><span class="ident" id="6045547"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045316">p</a></span><span class="op" id="6045548">,</span>&nbsp;<span class="ident" id="6045550"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045397">args</a></span><span class="op" id="6045554">[</span><span class="num" id="6045555">0</span><span class="op" id="6045556">]</span><span class="op" id="6045557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6045561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6045565">return</span>&nbsp;<span class="builtintype" id="6045572">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6045578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6045582">var</span>&nbsp;<span class="ident" id="6045586">found</span>&nbsp;<span class="builtintype" id="6045592">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6045598">if</span>&nbsp;<span class="ident" id="6045601"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045418">op</a></span><span class="op" id="6045603">,</span>&nbsp;<span class="ident" id="6045605"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045586">found</a></span>&nbsp;<span class="op" id="6045611">=</span>&nbsp;<span class="ident" id="6045613"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6044996">opSysMap</a></span><span class="op" id="6045621">[</span><span class="ident" id="6045622"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045378">opName</a></span><span class="op" id="6045628">]</span><span class="op" id="6045629">;</span>&nbsp;<span class="ident" id="6045631"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045586">found</a></span>&nbsp;<span class="op" id="6045637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6045641">//&nbsp;op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045649"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045435">argCount</a></span><span class="op" id="6045657">(</span><span class="num" id="6045658">0</span><span class="op" id="6045659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6045662">}</span>&nbsp;<span class="keyword" id="6045664">else</span>&nbsp;<span class="keyword" id="6045669">if</span>&nbsp;<span class="ident" id="6045672"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045418">op</a></span><span class="op" id="6045674">,</span>&nbsp;<span class="ident" id="6045676"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045586">found</a></span>&nbsp;<span class="op" id="6045682">=</span>&nbsp;<span class="ident" id="6045684"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045110">opSys1Map</a></span><span class="op" id="6045693">[</span><span class="ident" id="6045694"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045378">opName</a></span><span class="op" id="6045700">]</span><span class="op" id="6045701">;</span>&nbsp;<span class="ident" id="6045703"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045586">found</a></span>&nbsp;<span class="op" id="6045709">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6045713">//&nbsp;op&nbsp;reg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045725"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045435">argCount</a></span><span class="op" id="6045733">(</span><span class="num" id="6045734">1</span><span class="op" id="6045735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6045738">}</span>&nbsp;<span class="keyword" id="6045740">else</span>&nbsp;<span class="op" id="6045745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6045749">return</span>&nbsp;<span class="ident" id="6045756">nil</span><span class="op" id="6045759">,</span>&nbsp;<span class="builtintype" id="6045761">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6045768">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6045772">return</span>&nbsp;<span class="ident" id="6045779"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045184">makeInstSys</a></span><span class="op" id="6045790">(</span><span class="ident" id="6045791"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045418">op</a></span><span class="op" id="6045793">,</span>&nbsp;<span class="ident" id="6045795"><a href="/lonnie.io/e8vm/asm8/inst_sys.go.html#6045422">reg</a></span><span class="op" id="6045798">)</span><span class="op" id="6045799">,</span>&nbsp;<span class="builtintype" id="6045801">true</span><br>
<span class="lineno"></span><span class="op" id="6045806">}</span>
</div>
</body>
</html>
