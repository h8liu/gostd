<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2433260">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2433315">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2433369">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2433420">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2433490">package</span>&nbsp;<span class="ident" id="2433498">time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2433504">import</span>&nbsp;<span class="op" id="2433511">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2433514">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2433524">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2433534">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2433537">//&nbsp;for&nbsp;testing:&nbsp;whatever&nbsp;interrupts&nbsp;a&nbsp;sleep</span><br>
<span class="lineno">15</span><span class="keyword" id="2433581">func</span>&nbsp;<span class="ident" id="2433586">interrupt</span><span class="op" id="2433595">(</span><span class="op" id="2433596">)</span>&nbsp;<span class="op" id="2433598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433601">syscall</span><span class="op" id="2433608">.</span><span class="ident" id="2433609">Kill</span><span class="op" id="2433613">(</span><span class="ident" id="2433614">syscall</span><span class="op" id="2433621">.</span><span class="ident" id="2433622">Getpid</span><span class="op" id="2433628">(</span><span class="op" id="2433629">)</span><span class="op" id="2433630">,</span>&nbsp;<span class="ident" id="2433632">syscall</span><span class="op" id="2433639">.</span><span class="ident" id="2433640">SIGCHLD</span><span class="op" id="2433647">)</span><br>
<span class="lineno"></span><span class="op" id="2433649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2433652">//&nbsp;readFile&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;content&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">20</span><span class="comment" id="2433713">//&nbsp;It&nbsp;is&nbsp;a&nbsp;trivial&nbsp;implementation&nbsp;of&nbsp;ioutil.ReadFile,&nbsp;reimplemented</span><br>
<span class="lineno"></span><span class="comment" id="2433781">//&nbsp;here&nbsp;to&nbsp;avoid&nbsp;depending&nbsp;on&nbsp;io/ioutil&nbsp;or&nbsp;os.</span><br>
<span class="lineno"></span><span class="keyword" id="2433828">func</span>&nbsp;<span class="ident" id="2433833">readFile</span><span class="op" id="2433841">(</span><span class="ident" id="2433842">name</span>&nbsp;<span class="builtintype" id="2433847">string</span><span class="op" id="2433853">)</span>&nbsp;<span class="op" id="2433855">(</span><span class="op" id="2433856">[</span><span class="op" id="2433857">]</span><span class="builtintype" id="2433858">byte</span><span class="op" id="2433862">,</span>&nbsp;<span class="builtintype" id="2433864">error</span><span class="op" id="2433869">)</span>&nbsp;<span class="op" id="2433871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433874">f</span><span class="op" id="2433875">,</span>&nbsp;<span class="ident" id="2433877">err</span>&nbsp;<span class="op" id="2433881">:=</span>&nbsp;<span class="ident" id="2433884">syscall</span><span class="op" id="2433891">.</span><span class="ident" id="2433892">Open</span><span class="op" id="2433896">(</span><span class="ident" id="2433897">name</span><span class="op" id="2433901">,</span>&nbsp;<span class="ident" id="2433903">syscall</span><span class="op" id="2433910">.</span><span class="ident" id="2433911">O_RDONLY</span><span class="op" id="2433919">,</span>&nbsp;<span class="num" id="2433921">0</span><span class="op" id="2433922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433925">if</span>&nbsp;<span class="ident" id="2433928">err</span>&nbsp;<span class="op" id="2433932">!=</span>&nbsp;<span class="ident" id="2433935">nil</span>&nbsp;<span class="op" id="2433939">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433943">return</span>&nbsp;<span class="ident" id="2433950">nil</span><span class="op" id="2433953">,</span>&nbsp;<span class="ident" id="2433955">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2433960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433963">defer</span>&nbsp;<span class="ident" id="2433969">syscall</span><span class="op" id="2433976">.</span><span class="ident" id="2433977">Close</span><span class="op" id="2433982">(</span><span class="ident" id="2433983">f</span><span class="op" id="2433984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433987">var</span>&nbsp;<span class="op" id="2433991">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433995">buf</span>&nbsp;<span class="op" id="2433999">[</span><span class="num" id="2434000">4096</span><span class="op" id="2434004">]</span><span class="builtintype" id="2434005">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434012">ret</span>&nbsp;<span class="op" id="2434016">[</span><span class="op" id="2434017">]</span><span class="builtintype" id="2434018">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434025">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2434029">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434037">for</span>&nbsp;<span class="op" id="2434041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434045">n</span><span class="op" id="2434046">,</span>&nbsp;<span class="ident" id="2434048">err</span>&nbsp;<span class="op" id="2434052">=</span>&nbsp;<span class="ident" id="2434054">syscall</span><span class="op" id="2434061">.</span><span class="ident" id="2434062">Read</span><span class="op" id="2434066">(</span><span class="ident" id="2434067">f</span><span class="op" id="2434068">,</span>&nbsp;<span class="ident" id="2434070">buf</span><span class="op" id="2434073">[</span><span class="op" id="2434074">:</span><span class="op" id="2434075">]</span><span class="op" id="2434076">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434080">if</span>&nbsp;<span class="ident" id="2434083">n</span>&nbsp;<span class="op" id="2434085">&gt;</span>&nbsp;<span class="num" id="2434087">0</span>&nbsp;<span class="op" id="2434089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434094">ret</span>&nbsp;<span class="op" id="2434098">=</span>&nbsp;<span class="builtinfunc" id="2434100">append</span><span class="op" id="2434106">(</span><span class="ident" id="2434107">ret</span><span class="op" id="2434110">,</span>&nbsp;<span class="ident" id="2434112">buf</span><span class="op" id="2434115">[</span><span class="op" id="2434116">:</span><span class="ident" id="2434117">n</span><span class="op" id="2434118">]</span><span class="op" id="2434119">...</span><span class="op" id="2434122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434130">if</span>&nbsp;<span class="ident" id="2434133">n</span>&nbsp;<span class="op" id="2434135">==</span>&nbsp;<span class="num" id="2434138">0</span>&nbsp;<span class="op" id="2434140">||</span>&nbsp;<span class="ident" id="2434143">err</span>&nbsp;<span class="op" id="2434147">!=</span>&nbsp;<span class="ident" id="2434150">nil</span>&nbsp;<span class="op" id="2434154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434159">break</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434173">return</span>&nbsp;<span class="ident" id="2434180">ret</span><span class="op" id="2434183">,</span>&nbsp;<span class="ident" id="2434185">err</span><br>
<span class="lineno"></span><span class="op" id="2434189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="2434192">func</span>&nbsp;<span class="ident" id="2434197">open</span><span class="op" id="2434201">(</span><span class="ident" id="2434202">name</span>&nbsp;<span class="builtintype" id="2434207">string</span><span class="op" id="2434213">)</span>&nbsp;<span class="op" id="2434215">(</span><span class="builtintype" id="2434216">uintptr</span><span class="op" id="2434223">,</span>&nbsp;<span class="builtintype" id="2434225">error</span><span class="op" id="2434230">)</span>&nbsp;<span class="op" id="2434232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434235">fd</span><span class="op" id="2434237">,</span>&nbsp;<span class="ident" id="2434239">err</span>&nbsp;<span class="op" id="2434243">:=</span>&nbsp;<span class="ident" id="2434246">syscall</span><span class="op" id="2434253">.</span><span class="ident" id="2434254">Open</span><span class="op" id="2434258">(</span><span class="ident" id="2434259">name</span><span class="op" id="2434263">,</span>&nbsp;<span class="ident" id="2434265">syscall</span><span class="op" id="2434272">.</span><span class="ident" id="2434273">O_RDONLY</span><span class="op" id="2434281">,</span>&nbsp;<span class="num" id="2434283">0</span><span class="op" id="2434284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434287">if</span>&nbsp;<span class="ident" id="2434290">err</span>&nbsp;<span class="op" id="2434294">!=</span>&nbsp;<span class="ident" id="2434297">nil</span>&nbsp;<span class="op" id="2434301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434305">return</span>&nbsp;<span class="num" id="2434312">0</span><span class="op" id="2434313">,</span>&nbsp;<span class="ident" id="2434315">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434320">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434323">return</span>&nbsp;<span class="builtintype" id="2434330">uintptr</span><span class="op" id="2434337">(</span><span class="ident" id="2434338">fd</span><span class="op" id="2434340">)</span><span class="op" id="2434341">,</span>&nbsp;<span class="ident" id="2434343">nil</span><br>
<span class="lineno"></span><span class="op" id="2434347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2434350">func</span>&nbsp;<span class="ident" id="2434355">closefd</span><span class="op" id="2434362">(</span><span class="ident" id="2434363">fd</span>&nbsp;<span class="builtintype" id="2434366">uintptr</span><span class="op" id="2434373">)</span>&nbsp;<span class="op" id="2434375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434378">syscall</span><span class="op" id="2434385">.</span><span class="ident" id="2434386">Close</span><span class="op" id="2434391">(</span><span class="builtintype" id="2434392">int</span><span class="op" id="2434395">(</span><span class="ident" id="2434396">fd</span><span class="op" id="2434398">)</span><span class="op" id="2434399">)</span><br>
<span class="lineno">55</span><span class="op" id="2434401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2434404">func</span>&nbsp;<span class="ident" id="2434409">preadn</span><span class="op" id="2434415">(</span><span class="ident" id="2434416">fd</span>&nbsp;<span class="builtintype" id="2434419">uintptr</span><span class="op" id="2434426">,</span>&nbsp;<span class="ident" id="2434428">buf</span>&nbsp;<span class="op" id="2434432">[</span><span class="op" id="2434433">]</span><span class="builtintype" id="2434434">byte</span><span class="op" id="2434438">,</span>&nbsp;<span class="ident" id="2434440">off</span>&nbsp;<span class="builtintype" id="2434444">int</span><span class="op" id="2434447">)</span>&nbsp;<span class="builtintype" id="2434449">error</span>&nbsp;<span class="op" id="2434455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434458">whence</span>&nbsp;<span class="op" id="2434465">:=</span>&nbsp;<span class="num" id="2434468">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434471">if</span>&nbsp;<span class="ident" id="2434474">off</span>&nbsp;<span class="op" id="2434478">&lt;</span>&nbsp;<span class="num" id="2434480">0</span>&nbsp;<span class="op" id="2434482">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434486">whence</span>&nbsp;<span class="op" id="2434493">=</span>&nbsp;<span class="num" id="2434495">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434501">if</span>&nbsp;<span class="ident" id="2434504">_</span><span class="op" id="2434505">,</span>&nbsp;<span class="ident" id="2434507">err</span>&nbsp;<span class="op" id="2434511">:=</span>&nbsp;<span class="ident" id="2434514">syscall</span><span class="op" id="2434521">.</span><span class="ident" id="2434522">Seek</span><span class="op" id="2434526">(</span><span class="builtintype" id="2434527">int</span><span class="op" id="2434530">(</span><span class="ident" id="2434531">fd</span><span class="op" id="2434533">)</span><span class="op" id="2434534">,</span>&nbsp;<span class="ident" id="2434536">int64</span><span class="op" id="2434541">(</span><span class="ident" id="2434542">off</span><span class="op" id="2434545">)</span><span class="op" id="2434546">,</span>&nbsp;<span class="ident" id="2434548">whence</span><span class="op" id="2434554">)</span><span class="op" id="2434555">;</span>&nbsp;<span class="ident" id="2434557">err</span>&nbsp;<span class="op" id="2434561">!=</span>&nbsp;<span class="ident" id="2434564">nil</span>&nbsp;<span class="op" id="2434568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434572">return</span>&nbsp;<span class="ident" id="2434579">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434584">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434587">for</span>&nbsp;<span class="builtinfunc" id="2434591">len</span><span class="op" id="2434594">(</span><span class="ident" id="2434595">buf</span><span class="op" id="2434598">)</span>&nbsp;<span class="op" id="2434600">&gt;</span>&nbsp;<span class="num" id="2434602">0</span>&nbsp;<span class="op" id="2434604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434608">m</span><span class="op" id="2434609">,</span>&nbsp;<span class="ident" id="2434611">err</span>&nbsp;<span class="op" id="2434615">:=</span>&nbsp;<span class="ident" id="2434618">syscall</span><span class="op" id="2434625">.</span><span class="ident" id="2434626">Read</span><span class="op" id="2434630">(</span><span class="builtintype" id="2434631">int</span><span class="op" id="2434634">(</span><span class="ident" id="2434635">fd</span><span class="op" id="2434637">)</span><span class="op" id="2434638">,</span>&nbsp;<span class="ident" id="2434640">buf</span><span class="op" id="2434643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434647">if</span>&nbsp;<span class="ident" id="2434650">m</span>&nbsp;<span class="op" id="2434652">&lt;=</span>&nbsp;<span class="num" id="2434655">0</span>&nbsp;<span class="op" id="2434657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434662">if</span>&nbsp;<span class="ident" id="2434665">err</span>&nbsp;<span class="op" id="2434669">==</span>&nbsp;<span class="ident" id="2434672">nil</span>&nbsp;<span class="op" id="2434676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434682">return</span>&nbsp;<span class="ident" id="2434689">errors</span><span class="op" id="2434695">.</span><span class="ident" id="2434696">New</span><span class="op" id="2434699">(</span><span class="string" id="2434700">&#34;short&nbsp;read&#34;</span><span class="op" id="2434712">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434722">return</span>&nbsp;<span class="ident" id="2434729">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434739">buf</span>&nbsp;<span class="op" id="2434743">=</span>&nbsp;<span class="ident" id="2434745">buf</span><span class="op" id="2434748">[</span><span class="ident" id="2434749">m</span><span class="op" id="2434750">:</span><span class="op" id="2434751">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434754">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434757">return</span>&nbsp;<span class="ident" id="2434764">nil</span><br>
<span class="lineno"></span><span class="op" id="2434768">}</span>
</div>
</body>
</html>
