<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html" class="current">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3439505">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3439560">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3439614">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3439665">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3439736">package</span>&nbsp;<span class="ident" id="3439744">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3439752">import</span>&nbsp;<span class="op" id="3439759">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3439762">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3439771">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3439777">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3439788">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3439798">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3439801">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3439822">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3439890">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3439958">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="3440026">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3440096">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="3440159">type</span>&nbsp;<span class="ident" id="3440164">Encoding</span>&nbsp;<span class="keyword" id="3440173">struct</span>&nbsp;<span class="op" id="3440180">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440183">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3440193">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440201">decodeMap</span>&nbsp;<span class="op" id="3440211">[</span><span class="num" id="3440212">256</span><span class="op" id="3440215">]</span><span class="builtintype" id="3440216">byte</span><br>
<span class="lineno"></span><span class="op" id="3440221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3440224">const</span>&nbsp;<span class="ident" id="3440230">encodeStd</span>&nbsp;<span class="op" id="3440240">=</span>&nbsp;<span class="string" id="3440242">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="3440309">const</span>&nbsp;<span class="ident" id="3440315">encodeURL</span>&nbsp;<span class="op" id="3440325">=</span>&nbsp;<span class="string" id="3440327">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3440395">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="3440464">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3440499">func</span>&nbsp;<span class="ident" id="3440504">NewEncoding</span><span class="op" id="3440515">(</span><span class="ident" id="3440516">encoder</span>&nbsp;<span class="builtintype" id="3440524">string</span><span class="op" id="3440530">)</span>&nbsp;<span class="op" id="3440532">*</span><span class="ident" id="3440533">Encoding</span>&nbsp;<span class="op" id="3440542">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440545">e</span>&nbsp;<span class="op" id="3440547">:=</span>&nbsp;<span class="builtinfunc" id="3440550">new</span><span class="op" id="3440553">(</span><span class="ident" id="3440554">Encoding</span><span class="op" id="3440562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440565">e</span><span class="op" id="3440566">.</span><span class="ident" id="3440567">encode</span>&nbsp;<span class="op" id="3440574">=</span>&nbsp;<span class="ident" id="3440576">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440585">for</span>&nbsp;<span class="ident" id="3440589">i</span>&nbsp;<span class="op" id="3440591">:=</span>&nbsp;<span class="num" id="3440594">0</span><span class="op" id="3440595">;</span>&nbsp;<span class="ident" id="3440597">i</span>&nbsp;<span class="op" id="3440599">&lt;</span>&nbsp;<span class="builtinfunc" id="3440601">len</span><span class="op" id="3440604">(</span><span class="ident" id="3440605">e</span><span class="op" id="3440606">.</span><span class="ident" id="3440607">decodeMap</span><span class="op" id="3440616">)</span><span class="op" id="3440617">;</span>&nbsp;<span class="ident" id="3440619">i</span><span class="op" id="3440620">++</span>&nbsp;<span class="op" id="3440623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440627">e</span><span class="op" id="3440628">.</span><span class="ident" id="3440629">decodeMap</span><span class="op" id="3440638">[</span><span class="ident" id="3440639">i</span><span class="op" id="3440640">]</span>&nbsp;<span class="op" id="3440642">=</span>&nbsp;<span class="num" id="3440644">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3440650">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440653">for</span>&nbsp;<span class="ident" id="3440657">i</span>&nbsp;<span class="op" id="3440659">:=</span>&nbsp;<span class="num" id="3440662">0</span><span class="op" id="3440663">;</span>&nbsp;<span class="ident" id="3440665">i</span>&nbsp;<span class="op" id="3440667">&lt;</span>&nbsp;<span class="builtinfunc" id="3440669">len</span><span class="op" id="3440672">(</span><span class="ident" id="3440673">encoder</span><span class="op" id="3440680">)</span><span class="op" id="3440681">;</span>&nbsp;<span class="ident" id="3440683">i</span><span class="op" id="3440684">++</span>&nbsp;<span class="op" id="3440687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3440691">e</span><span class="op" id="3440692">.</span><span class="ident" id="3440693">decodeMap</span><span class="op" id="3440702">[</span><span class="ident" id="3440703">encoder</span><span class="op" id="3440710">[</span><span class="ident" id="3440711">i</span><span class="op" id="3440712">]</span><span class="op" id="3440713">]</span>&nbsp;<span class="op" id="3440715">=</span>&nbsp;<span class="builtintype" id="3440717">byte</span><span class="op" id="3440721">(</span><span class="ident" id="3440722">i</span><span class="op" id="3440723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3440726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3440729">return</span>&nbsp;<span class="ident" id="3440736">e</span><br>
<span class="lineno"></span><span class="op" id="3440738">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3440741">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3440803">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3440816">var</span>&nbsp;<span class="ident" id="3440820">StdEncoding</span>&nbsp;<span class="op" id="3440832">=</span>&nbsp;<span class="ident" id="3440834">NewEncoding</span><span class="op" id="3440845">(</span><span class="ident" id="3440846">encodeStd</span><span class="op" id="3440855">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3440858">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="3440927">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="3440975">var</span>&nbsp;<span class="ident" id="3440979">URLEncoding</span>&nbsp;<span class="op" id="3440991">=</span>&nbsp;<span class="ident" id="3440993">NewEncoding</span><span class="op" id="3441004">(</span><span class="ident" id="3441005">encodeURL</span><span class="op" id="3441014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3441017">var</span>&nbsp;<span class="ident" id="3441021">removeNewlinesMapper</span>&nbsp;<span class="op" id="3441042">=</span>&nbsp;<span class="keyword" id="3441044">func</span><span class="op" id="3441048">(</span><span class="ident" id="3441049">r</span>&nbsp;<span class="builtintype" id="3441051">rune</span><span class="op" id="3441055">)</span>&nbsp;<span class="builtintype" id="3441057">rune</span>&nbsp;<span class="op" id="3441062">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441065">if</span>&nbsp;<span class="ident" id="3441068">r</span>&nbsp;<span class="op" id="3441070">==</span>&nbsp;<span class="string" id="3441073">&#39;\r&#39;</span>&nbsp;<span class="op" id="3441078">||</span>&nbsp;<span class="ident" id="3441081">r</span>&nbsp;<span class="op" id="3441083">==</span>&nbsp;<span class="string" id="3441086">&#39;\n&#39;</span>&nbsp;<span class="op" id="3441091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441095">return</span>&nbsp;<span class="op" id="3441102">-</span><span class="num" id="3441103">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441109">return</span>&nbsp;<span class="ident" id="3441116">r</span><br>
<span class="lineno"></span><span class="op" id="3441118">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3441121">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3441140">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="3441194">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="3441232">//</span><br>
<span class="lineno"></span><span class="comment" id="3441235">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3441293">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="3441354">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3441408">func</span>&nbsp;<span class="op" id="3441413">(</span><span class="ident" id="3441414">enc</span>&nbsp;<span class="op" id="3441418">*</span><span class="ident" id="3441419">Encoding</span><span class="op" id="3441427">)</span>&nbsp;<span class="ident" id="3441429">Encode</span><span class="op" id="3441435">(</span><span class="ident" id="3441436">dst</span><span class="op" id="3441439">,</span>&nbsp;<span class="ident" id="3441441">src</span>&nbsp;<span class="op" id="3441445">[</span><span class="op" id="3441446">]</span><span class="builtintype" id="3441447">byte</span><span class="op" id="3441451">)</span>&nbsp;<span class="op" id="3441453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441456">if</span>&nbsp;<span class="builtinfunc" id="3441459">len</span><span class="op" id="3441462">(</span><span class="ident" id="3441463">src</span><span class="op" id="3441466">)</span>&nbsp;<span class="op" id="3441468">==</span>&nbsp;<span class="num" id="3441471">0</span>&nbsp;<span class="op" id="3441473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441477">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441485">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441489">for</span>&nbsp;<span class="builtinfunc" id="3441493">len</span><span class="op" id="3441496">(</span><span class="ident" id="3441497">src</span><span class="op" id="3441500">)</span>&nbsp;<span class="op" id="3441502">&gt;</span>&nbsp;<span class="num" id="3441504">0</span>&nbsp;<span class="op" id="3441506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441510">var</span>&nbsp;<span class="ident" id="3441514">b0</span><span class="op" id="3441516">,</span>&nbsp;<span class="ident" id="3441518">b1</span><span class="op" id="3441520">,</span>&nbsp;<span class="ident" id="3441522">b2</span><span class="op" id="3441524">,</span>&nbsp;<span class="ident" id="3441526">b3</span>&nbsp;<span class="builtintype" id="3441529">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3441537">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3441586">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441611">switch</span>&nbsp;<span class="builtinfunc" id="3441618">len</span><span class="op" id="3441621">(</span><span class="ident" id="3441622">src</span><span class="op" id="3441625">)</span>&nbsp;<span class="op" id="3441627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441631">default</span><span class="op" id="3441638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441643">b3</span>&nbsp;<span class="op" id="3441646">=</span>&nbsp;<span class="ident" id="3441648">src</span><span class="op" id="3441651">[</span><span class="num" id="3441652">2</span><span class="op" id="3441653">]</span>&nbsp;<span class="op" id="3441655">&amp;</span>&nbsp;<span class="num" id="3441657">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441665">b2</span>&nbsp;<span class="op" id="3441668">=</span>&nbsp;<span class="ident" id="3441670">src</span><span class="op" id="3441673">[</span><span class="num" id="3441674">2</span><span class="op" id="3441675">]</span>&nbsp;<span class="op" id="3441677">&gt;&gt;</span>&nbsp;<span class="num" id="3441680">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441685">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441699">case</span>&nbsp;<span class="num" id="3441704">2</span><span class="op" id="3441705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441710">b2</span>&nbsp;<span class="op" id="3441713">|=</span>&nbsp;<span class="op" id="3441716">(</span><span class="ident" id="3441717">src</span><span class="op" id="3441720">[</span><span class="num" id="3441721">1</span><span class="op" id="3441722">]</span>&nbsp;<span class="op" id="3441724">&lt;&lt;</span>&nbsp;<span class="num" id="3441727">2</span><span class="op" id="3441728">)</span>&nbsp;<span class="op" id="3441730">&amp;</span>&nbsp;<span class="num" id="3441732">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441740">b1</span>&nbsp;<span class="op" id="3441743">=</span>&nbsp;<span class="ident" id="3441745">src</span><span class="op" id="3441748">[</span><span class="num" id="3441749">1</span><span class="op" id="3441750">]</span>&nbsp;<span class="op" id="3441752">&gt;&gt;</span>&nbsp;<span class="num" id="3441755">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441760">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3441774">case</span>&nbsp;<span class="num" id="3441779">1</span><span class="op" id="3441780">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441785">b1</span>&nbsp;<span class="op" id="3441788">|=</span>&nbsp;<span class="op" id="3441791">(</span><span class="ident" id="3441792">src</span><span class="op" id="3441795">[</span><span class="num" id="3441796">0</span><span class="op" id="3441797">]</span>&nbsp;<span class="op" id="3441799">&lt;&lt;</span>&nbsp;<span class="num" id="3441802">4</span><span class="op" id="3441803">)</span>&nbsp;<span class="op" id="3441805">&amp;</span>&nbsp;<span class="num" id="3441807">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441815">b0</span>&nbsp;<span class="op" id="3441818">=</span>&nbsp;<span class="ident" id="3441820">src</span><span class="op" id="3441823">[</span><span class="num" id="3441824">0</span><span class="op" id="3441825">]</span>&nbsp;<span class="op" id="3441827">&gt;&gt;</span>&nbsp;<span class="num" id="3441830">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3441834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3441839">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441890">dst</span><span class="op" id="3441893">[</span><span class="num" id="3441894">0</span><span class="op" id="3441895">]</span>&nbsp;<span class="op" id="3441897">=</span>&nbsp;<span class="ident" id="3441899">enc</span><span class="op" id="3441902">.</span><span class="ident" id="3441903">encode</span><span class="op" id="3441909">[</span><span class="ident" id="3441910">b0</span><span class="op" id="3441912">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441916">dst</span><span class="op" id="3441919">[</span><span class="num" id="3441920">1</span><span class="op" id="3441921">]</span>&nbsp;<span class="op" id="3441923">=</span>&nbsp;<span class="ident" id="3441925">enc</span><span class="op" id="3441928">.</span><span class="ident" id="3441929">encode</span><span class="op" id="3441935">[</span><span class="ident" id="3441936">b1</span><span class="op" id="3441938">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441942">dst</span><span class="op" id="3441945">[</span><span class="num" id="3441946">2</span><span class="op" id="3441947">]</span>&nbsp;<span class="op" id="3441949">=</span>&nbsp;<span class="ident" id="3441951">enc</span><span class="op" id="3441954">.</span><span class="ident" id="3441955">encode</span><span class="op" id="3441961">[</span><span class="ident" id="3441962">b2</span><span class="op" id="3441964">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3441968">dst</span><span class="op" id="3441971">[</span><span class="num" id="3441972">3</span><span class="op" id="3441973">]</span>&nbsp;<span class="op" id="3441975">=</span>&nbsp;<span class="ident" id="3441977">enc</span><span class="op" id="3441980">.</span><span class="ident" id="3441981">encode</span><span class="op" id="3441987">[</span><span class="ident" id="3441988">b3</span><span class="op" id="3441990">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3441995">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442022">if</span>&nbsp;<span class="builtinfunc" id="3442025">len</span><span class="op" id="3442028">(</span><span class="ident" id="3442029">src</span><span class="op" id="3442032">)</span>&nbsp;<span class="op" id="3442034">&lt;</span>&nbsp;<span class="num" id="3442036">3</span>&nbsp;<span class="op" id="3442038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442043">dst</span><span class="op" id="3442046">[</span><span class="num" id="3442047">3</span><span class="op" id="3442048">]</span>&nbsp;<span class="op" id="3442050">=</span>&nbsp;<span class="string" id="3442052">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442059">if</span>&nbsp;<span class="builtinfunc" id="3442062">len</span><span class="op" id="3442065">(</span><span class="ident" id="3442066">src</span><span class="op" id="3442069">)</span>&nbsp;<span class="op" id="3442071">&lt;</span>&nbsp;<span class="num" id="3442073">2</span>&nbsp;<span class="op" id="3442075">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442081">dst</span><span class="op" id="3442084">[</span><span class="num" id="3442085">2</span><span class="op" id="3442086">]</span>&nbsp;<span class="op" id="3442088">=</span>&nbsp;<span class="string" id="3442090">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3442097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442102">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3442110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442115">src</span>&nbsp;<span class="op" id="3442119">=</span>&nbsp;<span class="ident" id="3442121">src</span><span class="op" id="3442124">[</span><span class="num" id="3442125">3</span><span class="op" id="3442126">:</span><span class="op" id="3442127">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442131">dst</span>&nbsp;<span class="op" id="3442135">=</span>&nbsp;<span class="ident" id="3442137">dst</span><span class="op" id="3442140">[</span><span class="num" id="3442141">4</span><span class="op" id="3442142">:</span><span class="op" id="3442143">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3442146">}</span><br>
<span class="lineno"></span><span class="op" id="3442148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3442151">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="3442205">func</span>&nbsp;<span class="op" id="3442210">(</span><span class="ident" id="3442211">enc</span>&nbsp;<span class="op" id="3442215">*</span><span class="ident" id="3442216">Encoding</span><span class="op" id="3442224">)</span>&nbsp;<span class="ident" id="3442226">EncodeToString</span><span class="op" id="3442240">(</span><span class="ident" id="3442241">src</span>&nbsp;<span class="op" id="3442245">[</span><span class="op" id="3442246">]</span><span class="builtintype" id="3442247">byte</span><span class="op" id="3442251">)</span>&nbsp;<span class="builtintype" id="3442253">string</span>&nbsp;<span class="op" id="3442260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442263">buf</span>&nbsp;<span class="op" id="3442267">:=</span>&nbsp;<span class="builtinfunc" id="3442270">make</span><span class="op" id="3442274">(</span><span class="op" id="3442275">[</span><span class="op" id="3442276">]</span><span class="builtintype" id="3442277">byte</span><span class="op" id="3442281">,</span>&nbsp;<span class="ident" id="3442283">enc</span><span class="op" id="3442286">.</span><span class="ident" id="3442287">EncodedLen</span><span class="op" id="3442297">(</span><span class="builtinfunc" id="3442298">len</span><span class="op" id="3442301">(</span><span class="ident" id="3442302">src</span><span class="op" id="3442305">)</span><span class="op" id="3442306">)</span><span class="op" id="3442307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442310">enc</span><span class="op" id="3442313">.</span><span class="ident" id="3442314">Encode</span><span class="op" id="3442320">(</span><span class="ident" id="3442321">buf</span><span class="op" id="3442324">,</span>&nbsp;<span class="ident" id="3442326">src</span><span class="op" id="3442329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442332">return</span>&nbsp;<span class="builtintype" id="3442339">string</span><span class="op" id="3442345">(</span><span class="ident" id="3442346">buf</span><span class="op" id="3442349">)</span><br>
<span class="lineno">120</span><span class="op" id="3442351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3442354">type</span>&nbsp;<span class="ident" id="3442359">encoder</span>&nbsp;<span class="keyword" id="3442367">struct</span>&nbsp;<span class="op" id="3442374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442377">err</span>&nbsp;&nbsp;<span class="builtintype" id="3442382">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442389">enc</span>&nbsp;&nbsp;<span class="op" id="3442394">*</span><span class="ident" id="3442395">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442405">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442410">io</span><span class="op" id="3442412">.</span><span class="ident" id="3442413">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442421">buf</span>&nbsp;&nbsp;<span class="op" id="3442426">[</span><span class="num" id="3442427">3</span><span class="op" id="3442428">]</span><span class="builtintype" id="3442429">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3442437">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442477">nbuf</span>&nbsp;<span class="builtintype" id="3442482">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3442493">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442520">out</span>&nbsp;&nbsp;<span class="op" id="3442525">[</span><span class="num" id="3442526">1024</span><span class="op" id="3442530">]</span><span class="builtintype" id="3442531">byte</span>&nbsp;<span class="comment" id="3442536">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="3442553">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="3442556">func</span>&nbsp;<span class="op" id="3442561">(</span><span class="ident" id="3442562">e</span>&nbsp;<span class="op" id="3442564">*</span><span class="ident" id="3442565">encoder</span><span class="op" id="3442572">)</span>&nbsp;<span class="ident" id="3442574">Write</span><span class="op" id="3442579">(</span><span class="ident" id="3442580">p</span>&nbsp;<span class="op" id="3442582">[</span><span class="op" id="3442583">]</span><span class="builtintype" id="3442584">byte</span><span class="op" id="3442588">)</span>&nbsp;<span class="op" id="3442590">(</span><span class="ident" id="3442591">n</span>&nbsp;<span class="builtintype" id="3442593">int</span><span class="op" id="3442596">,</span>&nbsp;<span class="ident" id="3442598">err</span>&nbsp;<span class="builtintype" id="3442602">error</span><span class="op" id="3442607">)</span>&nbsp;<span class="op" id="3442609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442612">if</span>&nbsp;<span class="ident" id="3442615">e</span><span class="op" id="3442616">.</span><span class="ident" id="3442617">err</span>&nbsp;<span class="op" id="3442621">!=</span>&nbsp;<span class="builtintype" id="3442624">nil</span>&nbsp;<span class="op" id="3442628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442632">return</span>&nbsp;<span class="num" id="3442639">0</span><span class="op" id="3442640">,</span>&nbsp;<span class="ident" id="3442642">e</span><span class="op" id="3442643">.</span><span class="ident" id="3442644">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3442649">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3442653">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442673">if</span>&nbsp;<span class="ident" id="3442676">e</span><span class="op" id="3442677">.</span><span class="ident" id="3442678">nbuf</span>&nbsp;<span class="op" id="3442683">&gt;</span>&nbsp;<span class="num" id="3442685">0</span>&nbsp;<span class="op" id="3442687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442691">var</span>&nbsp;<span class="ident" id="3442695">i</span>&nbsp;<span class="builtintype" id="3442697">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442703">for</span>&nbsp;<span class="ident" id="3442707">i</span>&nbsp;<span class="op" id="3442709">=</span>&nbsp;<span class="num" id="3442711">0</span><span class="op" id="3442712">;</span>&nbsp;<span class="ident" id="3442714">i</span>&nbsp;<span class="op" id="3442716">&lt;</span>&nbsp;<span class="builtinfunc" id="3442718">len</span><span class="op" id="3442721">(</span><span class="ident" id="3442722">p</span><span class="op" id="3442723">)</span>&nbsp;<span class="op" id="3442725">&amp;&amp;</span>&nbsp;<span class="ident" id="3442728">e</span><span class="op" id="3442729">.</span><span class="ident" id="3442730">nbuf</span>&nbsp;<span class="op" id="3442735">&lt;</span>&nbsp;<span class="num" id="3442737">3</span><span class="op" id="3442738">;</span>&nbsp;<span class="ident" id="3442740">i</span><span class="op" id="3442741">++</span>&nbsp;<span class="op" id="3442744">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442749">e</span><span class="op" id="3442750">.</span><span class="ident" id="3442751">buf</span><span class="op" id="3442754">[</span><span class="ident" id="3442755">e</span><span class="op" id="3442756">.</span><span class="ident" id="3442757">nbuf</span><span class="op" id="3442761">]</span>&nbsp;<span class="op" id="3442763">=</span>&nbsp;<span class="ident" id="3442765">p</span><span class="op" id="3442766">[</span><span class="ident" id="3442767">i</span><span class="op" id="3442768">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442773">e</span><span class="op" id="3442774">.</span><span class="ident" id="3442775">nbuf</span><span class="op" id="3442779">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3442784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442788">n</span>&nbsp;<span class="op" id="3442790">+=</span>&nbsp;<span class="ident" id="3442793">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442797">p</span>&nbsp;<span class="op" id="3442799">=</span>&nbsp;<span class="ident" id="3442801">p</span><span class="op" id="3442802">[</span><span class="ident" id="3442803">i</span><span class="op" id="3442804">:</span><span class="op" id="3442805">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442809">if</span>&nbsp;<span class="ident" id="3442812">e</span><span class="op" id="3442813">.</span><span class="ident" id="3442814">nbuf</span>&nbsp;<span class="op" id="3442819">&lt;</span>&nbsp;<span class="num" id="3442821">3</span>&nbsp;<span class="op" id="3442823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442828">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3442837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442841">e</span><span class="op" id="3442842">.</span><span class="ident" id="3442843">enc</span><span class="op" id="3442846">.</span><span class="ident" id="3442847">Encode</span><span class="op" id="3442853">(</span><span class="ident" id="3442854">e</span><span class="op" id="3442855">.</span><span class="ident" id="3442856">out</span><span class="op" id="3442859">[</span><span class="num" id="3442860">0</span><span class="op" id="3442861">:</span><span class="op" id="3442862">]</span><span class="op" id="3442863">,</span>&nbsp;<span class="ident" id="3442865">e</span><span class="op" id="3442866">.</span><span class="ident" id="3442867">buf</span><span class="op" id="3442870">[</span><span class="num" id="3442871">0</span><span class="op" id="3442872">:</span><span class="op" id="3442873">]</span><span class="op" id="3442874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442878">if</span>&nbsp;<span class="ident" id="3442881">_</span><span class="op" id="3442882">,</span>&nbsp;<span class="ident" id="3442884">e</span><span class="op" id="3442885">.</span><span class="ident" id="3442886">err</span>&nbsp;<span class="op" id="3442890">=</span>&nbsp;<span class="ident" id="3442892">e</span><span class="op" id="3442893">.</span><span class="ident" id="3442894">w</span><span class="op" id="3442895">.</span><span class="ident" id="3442896">Write</span><span class="op" id="3442901">(</span><span class="ident" id="3442902">e</span><span class="op" id="3442903">.</span><span class="ident" id="3442904">out</span><span class="op" id="3442907">[</span><span class="num" id="3442908">0</span><span class="op" id="3442909">:</span><span class="num" id="3442910">4</span><span class="op" id="3442911">]</span><span class="op" id="3442912">)</span><span class="op" id="3442913">;</span>&nbsp;<span class="ident" id="3442915">e</span><span class="op" id="3442916">.</span><span class="ident" id="3442917">err</span>&nbsp;<span class="op" id="3442921">!=</span>&nbsp;<span class="builtintype" id="3442924">nil</span>&nbsp;<span class="op" id="3442928">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442933">return</span>&nbsp;<span class="ident" id="3442940">n</span><span class="op" id="3442941">,</span>&nbsp;<span class="ident" id="3442943">e</span><span class="op" id="3442944">.</span><span class="ident" id="3442945">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3442951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3442955">e</span><span class="op" id="3442956">.</span><span class="ident" id="3442957">nbuf</span>&nbsp;<span class="op" id="3442962">=</span>&nbsp;<span class="num" id="3442964">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3442967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3442971">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3442998">for</span>&nbsp;<span class="builtinfunc" id="3443002">len</span><span class="op" id="3443005">(</span><span class="ident" id="3443006">p</span><span class="op" id="3443007">)</span>&nbsp;<span class="op" id="3443009">&gt;=</span>&nbsp;<span class="num" id="3443012">3</span>&nbsp;<span class="op" id="3443014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443018">nn</span>&nbsp;<span class="op" id="3443021">:=</span>&nbsp;<span class="builtinfunc" id="3443024">len</span><span class="op" id="3443027">(</span><span class="ident" id="3443028">e</span><span class="op" id="3443029">.</span><span class="ident" id="3443030">out</span><span class="op" id="3443033">)</span>&nbsp;<span class="op" id="3443035">/</span>&nbsp;<span class="num" id="3443037">4</span>&nbsp;<span class="op" id="3443039">*</span>&nbsp;<span class="num" id="3443041">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443045">if</span>&nbsp;<span class="ident" id="3443048">nn</span>&nbsp;<span class="op" id="3443051">&gt;</span>&nbsp;<span class="builtinfunc" id="3443053">len</span><span class="op" id="3443056">(</span><span class="ident" id="3443057">p</span><span class="op" id="3443058">)</span>&nbsp;<span class="op" id="3443060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443065">nn</span>&nbsp;<span class="op" id="3443068">=</span>&nbsp;<span class="builtinfunc" id="3443070">len</span><span class="op" id="3443073">(</span><span class="ident" id="3443074">p</span><span class="op" id="3443075">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443080">nn</span>&nbsp;<span class="op" id="3443083">-=</span>&nbsp;<span class="ident" id="3443086">nn</span>&nbsp;<span class="op" id="3443089">%</span>&nbsp;<span class="num" id="3443091">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3443095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443099">e</span><span class="op" id="3443100">.</span><span class="ident" id="3443101">enc</span><span class="op" id="3443104">.</span><span class="ident" id="3443105">Encode</span><span class="op" id="3443111">(</span><span class="ident" id="3443112">e</span><span class="op" id="3443113">.</span><span class="ident" id="3443114">out</span><span class="op" id="3443117">[</span><span class="num" id="3443118">0</span><span class="op" id="3443119">:</span><span class="op" id="3443120">]</span><span class="op" id="3443121">,</span>&nbsp;<span class="ident" id="3443123">p</span><span class="op" id="3443124">[</span><span class="num" id="3443125">0</span><span class="op" id="3443126">:</span><span class="ident" id="3443127">nn</span><span class="op" id="3443129">]</span><span class="op" id="3443130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443134">if</span>&nbsp;<span class="ident" id="3443137">_</span><span class="op" id="3443138">,</span>&nbsp;<span class="ident" id="3443140">e</span><span class="op" id="3443141">.</span><span class="ident" id="3443142">err</span>&nbsp;<span class="op" id="3443146">=</span>&nbsp;<span class="ident" id="3443148">e</span><span class="op" id="3443149">.</span><span class="ident" id="3443150">w</span><span class="op" id="3443151">.</span><span class="ident" id="3443152">Write</span><span class="op" id="3443157">(</span><span class="ident" id="3443158">e</span><span class="op" id="3443159">.</span><span class="ident" id="3443160">out</span><span class="op" id="3443163">[</span><span class="num" id="3443164">0</span>&nbsp;<span class="op" id="3443166">:</span>&nbsp;<span class="ident" id="3443168">nn</span><span class="op" id="3443170">/</span><span class="num" id="3443171">3</span><span class="op" id="3443172">*</span><span class="num" id="3443173">4</span><span class="op" id="3443174">]</span><span class="op" id="3443175">)</span><span class="op" id="3443176">;</span>&nbsp;<span class="ident" id="3443178">e</span><span class="op" id="3443179">.</span><span class="ident" id="3443180">err</span>&nbsp;<span class="op" id="3443184">!=</span>&nbsp;<span class="builtintype" id="3443187">nil</span>&nbsp;<span class="op" id="3443191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443196">return</span>&nbsp;<span class="ident" id="3443203">n</span><span class="op" id="3443204">,</span>&nbsp;<span class="ident" id="3443206">e</span><span class="op" id="3443207">.</span><span class="ident" id="3443208">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3443214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443218">n</span>&nbsp;<span class="op" id="3443220">+=</span>&nbsp;<span class="ident" id="3443223">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443228">p</span>&nbsp;<span class="op" id="3443230">=</span>&nbsp;<span class="ident" id="3443232">p</span><span class="op" id="3443233">[</span><span class="ident" id="3443234">nn</span><span class="op" id="3443236">:</span><span class="op" id="3443237">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3443240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3443244">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443265">for</span>&nbsp;<span class="ident" id="3443269">i</span>&nbsp;<span class="op" id="3443271">:=</span>&nbsp;<span class="num" id="3443274">0</span><span class="op" id="3443275">;</span>&nbsp;<span class="ident" id="3443277">i</span>&nbsp;<span class="op" id="3443279">&lt;</span>&nbsp;<span class="builtinfunc" id="3443281">len</span><span class="op" id="3443284">(</span><span class="ident" id="3443285">p</span><span class="op" id="3443286">)</span><span class="op" id="3443287">;</span>&nbsp;<span class="ident" id="3443289">i</span><span class="op" id="3443290">++</span>&nbsp;<span class="op" id="3443293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443297">e</span><span class="op" id="3443298">.</span><span class="ident" id="3443299">buf</span><span class="op" id="3443302">[</span><span class="ident" id="3443303">i</span><span class="op" id="3443304">]</span>&nbsp;<span class="op" id="3443306">=</span>&nbsp;<span class="ident" id="3443308">p</span><span class="op" id="3443309">[</span><span class="ident" id="3443310">i</span><span class="op" id="3443311">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3443314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443317">e</span><span class="op" id="3443318">.</span><span class="ident" id="3443319">nbuf</span>&nbsp;<span class="op" id="3443324">=</span>&nbsp;<span class="builtinfunc" id="3443326">len</span><span class="op" id="3443329">(</span><span class="ident" id="3443330">p</span><span class="op" id="3443331">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443334">n</span>&nbsp;<span class="op" id="3443336">+=</span>&nbsp;<span class="builtinfunc" id="3443339">len</span><span class="op" id="3443342">(</span><span class="ident" id="3443343">p</span><span class="op" id="3443344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443347">return</span><br>
<span class="lineno"></span><span class="op" id="3443354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3443357">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="3443411">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3443464">func</span>&nbsp;<span class="op" id="3443469">(</span><span class="ident" id="3443470">e</span>&nbsp;<span class="op" id="3443472">*</span><span class="ident" id="3443473">encoder</span><span class="op" id="3443480">)</span>&nbsp;<span class="ident" id="3443482">Close</span><span class="op" id="3443487">(</span><span class="op" id="3443488">)</span>&nbsp;<span class="builtintype" id="3443490">error</span>&nbsp;<span class="op" id="3443496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3443499">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443556">if</span>&nbsp;<span class="ident" id="3443559">e</span><span class="op" id="3443560">.</span><span class="ident" id="3443561">err</span>&nbsp;<span class="op" id="3443565">==</span>&nbsp;<span class="builtintype" id="3443568">nil</span>&nbsp;<span class="op" id="3443572">&amp;&amp;</span>&nbsp;<span class="ident" id="3443575">e</span><span class="op" id="3443576">.</span><span class="ident" id="3443577">nbuf</span>&nbsp;<span class="op" id="3443582">&gt;</span>&nbsp;<span class="num" id="3443584">0</span>&nbsp;<span class="op" id="3443586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443590">e</span><span class="op" id="3443591">.</span><span class="ident" id="3443592">enc</span><span class="op" id="3443595">.</span><span class="ident" id="3443596">Encode</span><span class="op" id="3443602">(</span><span class="ident" id="3443603">e</span><span class="op" id="3443604">.</span><span class="ident" id="3443605">out</span><span class="op" id="3443608">[</span><span class="num" id="3443609">0</span><span class="op" id="3443610">:</span><span class="op" id="3443611">]</span><span class="op" id="3443612">,</span>&nbsp;<span class="ident" id="3443614">e</span><span class="op" id="3443615">.</span><span class="ident" id="3443616">buf</span><span class="op" id="3443619">[</span><span class="num" id="3443620">0</span><span class="op" id="3443621">:</span><span class="ident" id="3443622">e</span><span class="op" id="3443623">.</span><span class="ident" id="3443624">nbuf</span><span class="op" id="3443628">]</span><span class="op" id="3443629">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443633">e</span><span class="op" id="3443634">.</span><span class="ident" id="3443635">nbuf</span>&nbsp;<span class="op" id="3443640">=</span>&nbsp;<span class="num" id="3443642">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3443646">_</span><span class="op" id="3443647">,</span>&nbsp;<span class="ident" id="3443649">e</span><span class="op" id="3443650">.</span><span class="ident" id="3443651">err</span>&nbsp;<span class="op" id="3443655">=</span>&nbsp;<span class="ident" id="3443657">e</span><span class="op" id="3443658">.</span><span class="ident" id="3443659">w</span><span class="op" id="3443660">.</span><span class="ident" id="3443661">Write</span><span class="op" id="3443666">(</span><span class="ident" id="3443667">e</span><span class="op" id="3443668">.</span><span class="ident" id="3443669">out</span><span class="op" id="3443672">[</span><span class="num" id="3443673">0</span><span class="op" id="3443674">:</span><span class="num" id="3443675">4</span><span class="op" id="3443676">]</span><span class="op" id="3443677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3443680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3443683">return</span>&nbsp;<span class="ident" id="3443690">e</span><span class="op" id="3443691">.</span><span class="ident" id="3443692">err</span><br>
<span class="lineno"></span><span class="op" id="3443696">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="3443699">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3443767">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3443839">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="3443899">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="3443967">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3443996">func</span>&nbsp;<span class="ident" id="3444001">NewEncoder</span><span class="op" id="3444011">(</span><span class="ident" id="3444012">enc</span>&nbsp;<span class="op" id="3444016">*</span><span class="ident" id="3444017">Encoding</span><span class="op" id="3444025">,</span>&nbsp;<span class="ident" id="3444027">w</span>&nbsp;<span class="ident" id="3444029">io</span><span class="op" id="3444031">.</span><span class="ident" id="3444032">Writer</span><span class="op" id="3444038">)</span>&nbsp;<span class="ident" id="3444040">io</span><span class="op" id="3444042">.</span><span class="ident" id="3444043">WriteCloser</span>&nbsp;<span class="op" id="3444055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444058">return</span>&nbsp;<span class="op" id="3444065">&amp;</span><span class="ident" id="3444066">encoder</span><span class="op" id="3444073">{</span><span class="ident" id="3444074">enc</span><span class="op" id="3444077">:</span>&nbsp;<span class="ident" id="3444079">enc</span><span class="op" id="3444082">,</span>&nbsp;<span class="ident" id="3444084">w</span><span class="op" id="3444085">:</span>&nbsp;<span class="ident" id="3444087">w</span><span class="op" id="3444088">}</span><br>
<span class="lineno"></span><span class="op" id="3444090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3444093">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="3444158">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="3444193">func</span>&nbsp;<span class="op" id="3444198">(</span><span class="ident" id="3444199">enc</span>&nbsp;<span class="op" id="3444203">*</span><span class="ident" id="3444204">Encoding</span><span class="op" id="3444212">)</span>&nbsp;<span class="ident" id="3444214">EncodedLen</span><span class="op" id="3444224">(</span><span class="ident" id="3444225">n</span>&nbsp;<span class="builtintype" id="3444227">int</span><span class="op" id="3444230">)</span>&nbsp;<span class="builtintype" id="3444232">int</span>&nbsp;<span class="op" id="3444236">{</span>&nbsp;<span class="keyword" id="3444238">return</span>&nbsp;<span class="op" id="3444245">(</span><span class="ident" id="3444246">n</span>&nbsp;<span class="op" id="3444248">+</span>&nbsp;<span class="num" id="3444250">2</span><span class="op" id="3444251">)</span>&nbsp;<span class="op" id="3444253">/</span>&nbsp;<span class="num" id="3444255">3</span>&nbsp;<span class="op" id="3444257">*</span>&nbsp;<span class="num" id="3444259">4</span>&nbsp;<span class="op" id="3444261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3444264">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3444283">type</span>&nbsp;<span class="ident" id="3444288">CorruptInputError</span>&nbsp;<span class="builtintype" id="3444306">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3444313">func</span>&nbsp;<span class="op" id="3444318">(</span><span class="ident" id="3444319">e</span>&nbsp;<span class="ident" id="3444321">CorruptInputError</span><span class="op" id="3444338">)</span>&nbsp;<span class="ident" id="3444340">Error</span><span class="op" id="3444345">(</span><span class="op" id="3444346">)</span>&nbsp;<span class="builtintype" id="3444348">string</span>&nbsp;<span class="op" id="3444355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444358">return</span>&nbsp;<span class="string" id="3444365">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="3444402">+</span>&nbsp;<span class="ident" id="3444404">strconv</span><span class="op" id="3444411">.</span><span class="ident" id="3444412">FormatInt</span><span class="op" id="3444421">(</span><span class="builtintype" id="3444422">int64</span><span class="op" id="3444427">(</span><span class="ident" id="3444428">e</span><span class="op" id="3444429">)</span><span class="op" id="3444430">,</span>&nbsp;<span class="num" id="3444432">10</span><span class="op" id="3444434">)</span><br>
<span class="lineno"></span><span class="op" id="3444436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3444439">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="3444509">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="3444577">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="3444647">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="3444704">func</span>&nbsp;<span class="op" id="3444709">(</span><span class="ident" id="3444710">enc</span>&nbsp;<span class="op" id="3444714">*</span><span class="ident" id="3444715">Encoding</span><span class="op" id="3444723">)</span>&nbsp;<span class="ident" id="3444725">decode</span><span class="op" id="3444731">(</span><span class="ident" id="3444732">dst</span><span class="op" id="3444735">,</span>&nbsp;<span class="ident" id="3444737">src</span>&nbsp;<span class="op" id="3444741">[</span><span class="op" id="3444742">]</span><span class="builtintype" id="3444743">byte</span><span class="op" id="3444747">)</span>&nbsp;<span class="op" id="3444749">(</span><span class="ident" id="3444750">n</span>&nbsp;<span class="builtintype" id="3444752">int</span><span class="op" id="3444755">,</span>&nbsp;<span class="ident" id="3444757">end</span>&nbsp;<span class="builtintype" id="3444761">bool</span><span class="op" id="3444765">,</span>&nbsp;<span class="ident" id="3444767">err</span>&nbsp;<span class="builtintype" id="3444771">error</span><span class="op" id="3444776">)</span>&nbsp;<span class="op" id="3444778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444781">olen</span>&nbsp;<span class="op" id="3444786">:=</span>&nbsp;<span class="builtinfunc" id="3444789">len</span><span class="op" id="3444792">(</span><span class="ident" id="3444793">src</span><span class="op" id="3444796">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444799">for</span>&nbsp;<span class="builtinfunc" id="3444803">len</span><span class="op" id="3444806">(</span><span class="ident" id="3444807">src</span><span class="op" id="3444810">)</span>&nbsp;<span class="op" id="3444812">&gt;</span>&nbsp;<span class="num" id="3444814">0</span>&nbsp;<span class="op" id="3444816">&amp;&amp;</span>&nbsp;<span class="op" id="3444819">!</span><span class="ident" id="3444820">end</span>&nbsp;<span class="op" id="3444824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3444828">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444874">var</span>&nbsp;<span class="ident" id="3444878">dbuf</span>&nbsp;<span class="op" id="3444883">[</span><span class="num" id="3444884">4</span><span class="op" id="3444885">]</span><span class="builtintype" id="3444886">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3444893">dlen</span>&nbsp;<span class="op" id="3444898">:=</span>&nbsp;<span class="num" id="3444901">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444906">for</span>&nbsp;<span class="ident" id="3444910">j</span>&nbsp;<span class="op" id="3444912">:=</span>&nbsp;<span class="keyword" id="3444915">range</span>&nbsp;<span class="ident" id="3444921">dbuf</span>&nbsp;<span class="op" id="3444926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444931">if</span>&nbsp;<span class="builtinfunc" id="3444934">len</span><span class="op" id="3444937">(</span><span class="ident" id="3444938">src</span><span class="op" id="3444941">)</span>&nbsp;<span class="op" id="3444943">==</span>&nbsp;<span class="num" id="3444946">0</span>&nbsp;<span class="op" id="3444948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3444954">return</span>&nbsp;<span class="ident" id="3444961">n</span><span class="op" id="3444962">,</span>&nbsp;<span class="builtintype" id="3444964">false</span><span class="op" id="3444969">,</span>&nbsp;<span class="ident" id="3444971">CorruptInputError</span><span class="op" id="3444988">(</span><span class="ident" id="3444989">olen</span>&nbsp;<span class="op" id="3444994">-</span>&nbsp;<span class="builtinfunc" id="3444996">len</span><span class="op" id="3444999">(</span><span class="ident" id="3445000">src</span><span class="op" id="3445003">)</span>&nbsp;<span class="op" id="3445005">-</span>&nbsp;<span class="ident" id="3445007">j</span><span class="op" id="3445008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3445013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3445018">in</span>&nbsp;<span class="op" id="3445021">:=</span>&nbsp;<span class="ident" id="3445024">src</span><span class="op" id="3445027">[</span><span class="num" id="3445028">0</span><span class="op" id="3445029">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3445034">src</span>&nbsp;<span class="op" id="3445038">=</span>&nbsp;<span class="ident" id="3445040">src</span><span class="op" id="3445043">[</span><span class="num" id="3445044">1</span><span class="op" id="3445045">:</span><span class="op" id="3445046">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445051">if</span>&nbsp;<span class="ident" id="3445054">in</span>&nbsp;<span class="op" id="3445057">==</span>&nbsp;<span class="string" id="3445060">&#39;=&#39;</span>&nbsp;<span class="op" id="3445064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3445070">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445119">switch</span>&nbsp;<span class="ident" id="3445126">j</span>&nbsp;<span class="op" id="3445128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445134">case</span>&nbsp;<span class="num" id="3445139">0</span><span class="op" id="3445140">,</span>&nbsp;<span class="num" id="3445142">1</span><span class="op" id="3445143">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3445150">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445176">return</span>&nbsp;<span class="ident" id="3445183">n</span><span class="op" id="3445184">,</span>&nbsp;<span class="builtintype" id="3445186">false</span><span class="op" id="3445191">,</span>&nbsp;<span class="ident" id="3445193">CorruptInputError</span><span class="op" id="3445210">(</span><span class="ident" id="3445211">olen</span>&nbsp;<span class="op" id="3445216">-</span>&nbsp;<span class="builtinfunc" id="3445218">len</span><span class="op" id="3445221">(</span><span class="ident" id="3445222">src</span><span class="op" id="3445225">)</span>&nbsp;<span class="op" id="3445227">-</span>&nbsp;<span class="num" id="3445229">1</span><span class="op" id="3445230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445236">case</span>&nbsp;<span class="num" id="3445241">2</span><span class="op" id="3445242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3445249">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445310">if</span>&nbsp;<span class="builtinfunc" id="3445313">len</span><span class="op" id="3445316">(</span><span class="ident" id="3445317">src</span><span class="op" id="3445320">)</span>&nbsp;<span class="op" id="3445322">==</span>&nbsp;<span class="num" id="3445325">0</span>&nbsp;<span class="op" id="3445327">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3445335">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445363">return</span>&nbsp;<span class="ident" id="3445370">n</span><span class="op" id="3445371">,</span>&nbsp;<span class="builtintype" id="3445373">false</span><span class="op" id="3445378">,</span>&nbsp;<span class="ident" id="3445380">CorruptInputError</span><span class="op" id="3445397">(</span><span class="ident" id="3445398">olen</span><span class="op" id="3445402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3445409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445416">if</span>&nbsp;<span class="ident" id="3445419">src</span><span class="op" id="3445422">[</span><span class="num" id="3445423">0</span><span class="op" id="3445424">]</span>&nbsp;<span class="op" id="3445426">!=</span>&nbsp;<span class="string" id="3445429">&#39;=&#39;</span>&nbsp;<span class="op" id="3445433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3445441">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445468">return</span>&nbsp;<span class="ident" id="3445475">n</span><span class="op" id="3445476">,</span>&nbsp;<span class="builtintype" id="3445478">false</span><span class="op" id="3445483">,</span>&nbsp;<span class="ident" id="3445485">CorruptInputError</span><span class="op" id="3445502">(</span><span class="ident" id="3445503">olen</span>&nbsp;<span class="op" id="3445508">-</span>&nbsp;<span class="builtinfunc" id="3445510">len</span><span class="op" id="3445513">(</span><span class="ident" id="3445514">src</span><span class="op" id="3445517">)</span>&nbsp;<span class="op" id="3445519">-</span>&nbsp;<span class="num" id="3445521">1</span><span class="op" id="3445522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3445529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3445536">src</span>&nbsp;<span class="op" id="3445540">=</span>&nbsp;<span class="ident" id="3445542">src</span><span class="op" id="3445545">[</span><span class="num" id="3445546">1</span><span class="op" id="3445547">:</span><span class="op" id="3445548">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3445554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445560">if</span>&nbsp;<span class="builtinfunc" id="3445563">len</span><span class="op" id="3445566">(</span><span class="ident" id="3445567">src</span><span class="op" id="3445570">)</span>&nbsp;<span class="op" id="3445572">&gt;</span>&nbsp;<span class="num" id="3445574">0</span>&nbsp;<span class="op" id="3445576">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3445583">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3445608">err</span>&nbsp;<span class="op" id="3445612">=</span>&nbsp;<span class="ident" id="3445614">CorruptInputError</span><span class="op" id="3445631">(</span><span class="ident" id="3445632">olen</span>&nbsp;<span class="op" id="3445637">-</span>&nbsp;<span class="builtinfunc" id="3445639">len</span><span class="op" id="3445642">(</span><span class="ident" id="3445643">src</span><span class="op" id="3445646">)</span><span class="op" id="3445647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3445653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3445659">dlen</span><span class="op" id="3445663">,</span>&nbsp;<span class="ident" id="3445665">end</span>&nbsp;<span class="op" id="3445669">=</span>&nbsp;<span class="ident" id="3445671">j</span><span class="op" id="3445672">,</span>&nbsp;<span class="builtintype" id="3445674">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445683">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3445692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3445697">dbuf</span><span class="op" id="3445701">[</span><span class="ident" id="3445702">j</span><span class="op" id="3445703">]</span>&nbsp;<span class="op" id="3445705">=</span>&nbsp;<span class="ident" id="3445707">enc</span><span class="op" id="3445710">.</span><span class="ident" id="3445711">decodeMap</span><span class="op" id="3445720">[</span><span class="ident" id="3445721">in</span><span class="op" id="3445723">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445728">if</span>&nbsp;<span class="ident" id="3445731">dbuf</span><span class="op" id="3445735">[</span><span class="ident" id="3445736">j</span><span class="op" id="3445737">]</span>&nbsp;<span class="op" id="3445739">==</span>&nbsp;<span class="num" id="3445742">0xFF</span>&nbsp;<span class="op" id="3445747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445753">return</span>&nbsp;<span class="ident" id="3445760">n</span><span class="op" id="3445761">,</span>&nbsp;<span class="builtintype" id="3445763">false</span><span class="op" id="3445768">,</span>&nbsp;<span class="ident" id="3445770">CorruptInputError</span><span class="op" id="3445787">(</span><span class="ident" id="3445788">olen</span>&nbsp;<span class="op" id="3445793">-</span>&nbsp;<span class="builtinfunc" id="3445795">len</span><span class="op" id="3445798">(</span><span class="ident" id="3445799">src</span><span class="op" id="3445802">)</span>&nbsp;<span class="op" id="3445804">-</span>&nbsp;<span class="num" id="3445806">1</span><span class="op" id="3445807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3445812">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3445816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3445821">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3445878">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445891">switch</span>&nbsp;<span class="ident" id="3445898">dlen</span>&nbsp;<span class="op" id="3445903">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445907">case</span>&nbsp;<span class="num" id="3445912">4</span><span class="op" id="3445913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3445918">dst</span><span class="op" id="3445921">[</span><span class="num" id="3445922">2</span><span class="op" id="3445923">]</span>&nbsp;<span class="op" id="3445925">=</span>&nbsp;<span class="ident" id="3445927">dbuf</span><span class="op" id="3445931">[</span><span class="num" id="3445932">2</span><span class="op" id="3445933">]</span><span class="op" id="3445934">&lt;&lt;</span><span class="num" id="3445936">6</span>&nbsp;<span class="op" id="3445938">|</span>&nbsp;<span class="ident" id="3445940">dbuf</span><span class="op" id="3445944">[</span><span class="num" id="3445945">3</span><span class="op" id="3445946">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445951">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3445965">case</span>&nbsp;<span class="num" id="3445970">3</span><span class="op" id="3445971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3445976">dst</span><span class="op" id="3445979">[</span><span class="num" id="3445980">1</span><span class="op" id="3445981">]</span>&nbsp;<span class="op" id="3445983">=</span>&nbsp;<span class="ident" id="3445985">dbuf</span><span class="op" id="3445989">[</span><span class="num" id="3445990">1</span><span class="op" id="3445991">]</span><span class="op" id="3445992">&lt;&lt;</span><span class="num" id="3445994">4</span>&nbsp;<span class="op" id="3445996">|</span>&nbsp;<span class="ident" id="3445998">dbuf</span><span class="op" id="3446002">[</span><span class="num" id="3446003">2</span><span class="op" id="3446004">]</span><span class="op" id="3446005">&gt;&gt;</span><span class="num" id="3446007">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3446012">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3446026">case</span>&nbsp;<span class="num" id="3446031">2</span><span class="op" id="3446032">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446037">dst</span><span class="op" id="3446040">[</span><span class="num" id="3446041">0</span><span class="op" id="3446042">]</span>&nbsp;<span class="op" id="3446044">=</span>&nbsp;<span class="ident" id="3446046">dbuf</span><span class="op" id="3446050">[</span><span class="num" id="3446051">0</span><span class="op" id="3446052">]</span><span class="op" id="3446053">&lt;&lt;</span><span class="num" id="3446055">2</span>&nbsp;<span class="op" id="3446057">|</span>&nbsp;<span class="ident" id="3446059">dbuf</span><span class="op" id="3446063">[</span><span class="num" id="3446064">1</span><span class="op" id="3446065">]</span><span class="op" id="3446066">&gt;&gt;</span><span class="num" id="3446068">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3446072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446076">dst</span>&nbsp;<span class="op" id="3446080">=</span>&nbsp;<span class="ident" id="3446082">dst</span><span class="op" id="3446085">[</span><span class="num" id="3446086">3</span><span class="op" id="3446087">:</span><span class="op" id="3446088">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446092">n</span>&nbsp;<span class="op" id="3446094">+=</span>&nbsp;<span class="ident" id="3446097">dlen</span>&nbsp;<span class="op" id="3446102">-</span>&nbsp;<span class="num" id="3446104">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3446107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3446111">return</span>&nbsp;<span class="ident" id="3446118">n</span><span class="op" id="3446119">,</span>&nbsp;<span class="ident" id="3446121">end</span><span class="op" id="3446124">,</span>&nbsp;<span class="ident" id="3446126">err</span><br>
<span class="lineno"></span><span class="op" id="3446130">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3446133">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="3446198">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="3446267">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3446336">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="3446399">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3446447">func</span>&nbsp;<span class="op" id="3446452">(</span><span class="ident" id="3446453">enc</span>&nbsp;<span class="op" id="3446457">*</span><span class="ident" id="3446458">Encoding</span><span class="op" id="3446466">)</span>&nbsp;<span class="ident" id="3446468">Decode</span><span class="op" id="3446474">(</span><span class="ident" id="3446475">dst</span><span class="op" id="3446478">,</span>&nbsp;<span class="ident" id="3446480">src</span>&nbsp;<span class="op" id="3446484">[</span><span class="op" id="3446485">]</span><span class="builtintype" id="3446486">byte</span><span class="op" id="3446490">)</span>&nbsp;<span class="op" id="3446492">(</span><span class="ident" id="3446493">n</span>&nbsp;<span class="builtintype" id="3446495">int</span><span class="op" id="3446498">,</span>&nbsp;<span class="ident" id="3446500">err</span>&nbsp;<span class="builtintype" id="3446504">error</span><span class="op" id="3446509">)</span>&nbsp;<span class="op" id="3446511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446514">src</span>&nbsp;<span class="op" id="3446518">=</span>&nbsp;<span class="ident" id="3446520">bytes</span><span class="op" id="3446525">.</span><span class="ident" id="3446526">Map</span><span class="op" id="3446529">(</span><span class="ident" id="3446530">removeNewlinesMapper</span><span class="op" id="3446550">,</span>&nbsp;<span class="ident" id="3446552">src</span><span class="op" id="3446555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446558">n</span><span class="op" id="3446559">,</span>&nbsp;<span class="ident" id="3446561">_</span><span class="op" id="3446562">,</span>&nbsp;<span class="ident" id="3446564">err</span>&nbsp;<span class="op" id="3446568">=</span>&nbsp;<span class="ident" id="3446570">enc</span><span class="op" id="3446573">.</span><span class="ident" id="3446574">decode</span><span class="op" id="3446580">(</span><span class="ident" id="3446581">dst</span><span class="op" id="3446584">,</span>&nbsp;<span class="ident" id="3446586">src</span><span class="op" id="3446589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3446592">return</span><br>
<span class="lineno">290</span><span class="op" id="3446599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3446602">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3446672">func</span>&nbsp;<span class="op" id="3446677">(</span><span class="ident" id="3446678">enc</span>&nbsp;<span class="op" id="3446682">*</span><span class="ident" id="3446683">Encoding</span><span class="op" id="3446691">)</span>&nbsp;<span class="ident" id="3446693">DecodeString</span><span class="op" id="3446705">(</span><span class="ident" id="3446706">s</span>&nbsp;<span class="builtintype" id="3446708">string</span><span class="op" id="3446714">)</span>&nbsp;<span class="op" id="3446716">(</span><span class="op" id="3446717">[</span><span class="op" id="3446718">]</span><span class="builtintype" id="3446719">byte</span><span class="op" id="3446723">,</span>&nbsp;<span class="builtintype" id="3446725">error</span><span class="op" id="3446730">)</span>&nbsp;<span class="op" id="3446732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446735">s</span>&nbsp;<span class="op" id="3446737">=</span>&nbsp;<span class="ident" id="3446739">strings</span><span class="op" id="3446746">.</span><span class="ident" id="3446747">Map</span><span class="op" id="3446750">(</span><span class="ident" id="3446751">removeNewlinesMapper</span><span class="op" id="3446771">,</span>&nbsp;<span class="ident" id="3446773">s</span><span class="op" id="3446774">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446777">dbuf</span>&nbsp;<span class="op" id="3446782">:=</span>&nbsp;<span class="builtinfunc" id="3446785">make</span><span class="op" id="3446789">(</span><span class="op" id="3446790">[</span><span class="op" id="3446791">]</span><span class="builtintype" id="3446792">byte</span><span class="op" id="3446796">,</span>&nbsp;<span class="ident" id="3446798">enc</span><span class="op" id="3446801">.</span><span class="ident" id="3446802">DecodedLen</span><span class="op" id="3446812">(</span><span class="builtinfunc" id="3446813">len</span><span class="op" id="3446816">(</span><span class="ident" id="3446817">s</span><span class="op" id="3446818">)</span><span class="op" id="3446819">)</span><span class="op" id="3446820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446823">n</span><span class="op" id="3446824">,</span>&nbsp;<span class="ident" id="3446826">_</span><span class="op" id="3446827">,</span>&nbsp;<span class="ident" id="3446829">err</span>&nbsp;<span class="op" id="3446833">:=</span>&nbsp;<span class="ident" id="3446836">enc</span><span class="op" id="3446839">.</span><span class="ident" id="3446840">decode</span><span class="op" id="3446846">(</span><span class="ident" id="3446847">dbuf</span><span class="op" id="3446851">,</span>&nbsp;<span class="op" id="3446853">[</span><span class="op" id="3446854">]</span><span class="builtintype" id="3446855">byte</span><span class="op" id="3446859">(</span><span class="ident" id="3446860">s</span><span class="op" id="3446861">)</span><span class="op" id="3446862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3446865">return</span>&nbsp;<span class="ident" id="3446872">dbuf</span><span class="op" id="3446876">[</span><span class="op" id="3446877">:</span><span class="ident" id="3446878">n</span><span class="op" id="3446879">]</span><span class="op" id="3446880">,</span>&nbsp;<span class="ident" id="3446882">err</span><br>
<span class="lineno"></span><span class="op" id="3446886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="3446889">type</span>&nbsp;<span class="ident" id="3446894">decoder</span>&nbsp;<span class="keyword" id="3446902">struct</span>&nbsp;<span class="op" id="3446909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446912">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3446919">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446926">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3446933">*</span><span class="ident" id="3446934">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446944">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446951">io</span><span class="op" id="3446953">.</span><span class="ident" id="3446954">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3446962">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3446969">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3446980">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447003">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3447010">[</span><span class="num" id="3447011">1024</span><span class="op" id="3447015">]</span><span class="builtintype" id="3447016">byte</span>&nbsp;<span class="comment" id="3447021">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447040">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3447047">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447052">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3447059">[</span><span class="op" id="3447060">]</span><span class="builtintype" id="3447061">byte</span>&nbsp;<span class="comment" id="3447066">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447094">outbuf</span>&nbsp;<span class="op" id="3447101">[</span><span class="num" id="3447102">1024</span>&nbsp;<span class="op" id="3447107">/</span>&nbsp;<span class="num" id="3447109">4</span>&nbsp;<span class="op" id="3447111">*</span>&nbsp;<span class="num" id="3447113">3</span><span class="op" id="3447114">]</span><span class="builtintype" id="3447115">byte</span><br>
<span class="lineno"></span><span class="op" id="3447120">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="3447123">func</span>&nbsp;<span class="op" id="3447128">(</span><span class="ident" id="3447129">d</span>&nbsp;<span class="op" id="3447131">*</span><span class="ident" id="3447132">decoder</span><span class="op" id="3447139">)</span>&nbsp;<span class="ident" id="3447141">Read</span><span class="op" id="3447145">(</span><span class="ident" id="3447146">p</span>&nbsp;<span class="op" id="3447148">[</span><span class="op" id="3447149">]</span><span class="builtintype" id="3447150">byte</span><span class="op" id="3447154">)</span>&nbsp;<span class="op" id="3447156">(</span><span class="ident" id="3447157">n</span>&nbsp;<span class="builtintype" id="3447159">int</span><span class="op" id="3447162">,</span>&nbsp;<span class="ident" id="3447164">err</span>&nbsp;<span class="builtintype" id="3447168">error</span><span class="op" id="3447173">)</span>&nbsp;<span class="op" id="3447175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3447178">if</span>&nbsp;<span class="ident" id="3447181">d</span><span class="op" id="3447182">.</span><span class="ident" id="3447183">err</span>&nbsp;<span class="op" id="3447187">!=</span>&nbsp;<span class="builtintype" id="3447190">nil</span>&nbsp;<span class="op" id="3447194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3447198">return</span>&nbsp;<span class="num" id="3447205">0</span><span class="op" id="3447206">,</span>&nbsp;<span class="ident" id="3447208">d</span><span class="op" id="3447209">.</span><span class="ident" id="3447210">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3447215">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3447219">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3447267">if</span>&nbsp;<span class="builtinfunc" id="3447270">len</span><span class="op" id="3447273">(</span><span class="ident" id="3447274">d</span><span class="op" id="3447275">.</span><span class="ident" id="3447276">out</span><span class="op" id="3447279">)</span>&nbsp;<span class="op" id="3447281">&gt;</span>&nbsp;<span class="num" id="3447283">0</span>&nbsp;<span class="op" id="3447285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447289">n</span>&nbsp;<span class="op" id="3447291">=</span>&nbsp;<span class="builtinfunc" id="3447293">copy</span><span class="op" id="3447297">(</span><span class="ident" id="3447298">p</span><span class="op" id="3447299">,</span>&nbsp;<span class="ident" id="3447301">d</span><span class="op" id="3447302">.</span><span class="ident" id="3447303">out</span><span class="op" id="3447306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447310">d</span><span class="op" id="3447311">.</span><span class="ident" id="3447312">out</span>&nbsp;<span class="op" id="3447316">=</span>&nbsp;<span class="ident" id="3447318">d</span><span class="op" id="3447319">.</span><span class="ident" id="3447320">out</span><span class="op" id="3447323">[</span><span class="ident" id="3447324">n</span><span class="op" id="3447325">:</span><span class="op" id="3447326">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3447330">return</span>&nbsp;<span class="ident" id="3447337">n</span><span class="op" id="3447338">,</span>&nbsp;<span class="builtintype" id="3447340">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3447345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3447349">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447367">nn</span>&nbsp;<span class="op" id="3447370">:=</span>&nbsp;<span class="builtinfunc" id="3447373">len</span><span class="op" id="3447376">(</span><span class="ident" id="3447377">p</span><span class="op" id="3447378">)</span>&nbsp;<span class="op" id="3447380">/</span>&nbsp;<span class="num" id="3447382">3</span>&nbsp;<span class="op" id="3447384">*</span>&nbsp;<span class="num" id="3447386">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3447389">if</span>&nbsp;<span class="ident" id="3447392">nn</span>&nbsp;<span class="op" id="3447395">&lt;</span>&nbsp;<span class="num" id="3447397">4</span>&nbsp;<span class="op" id="3447399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447403">nn</span>&nbsp;<span class="op" id="3447406">=</span>&nbsp;<span class="num" id="3447408">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3447411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3447414">if</span>&nbsp;<span class="ident" id="3447417">nn</span>&nbsp;<span class="op" id="3447420">&gt;</span>&nbsp;<span class="builtinfunc" id="3447422">len</span><span class="op" id="3447425">(</span><span class="ident" id="3447426">d</span><span class="op" id="3447427">.</span><span class="ident" id="3447428">buf</span><span class="op" id="3447431">)</span>&nbsp;<span class="op" id="3447433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447437">nn</span>&nbsp;<span class="op" id="3447440">=</span>&nbsp;<span class="builtinfunc" id="3447442">len</span><span class="op" id="3447445">(</span><span class="ident" id="3447446">d</span><span class="op" id="3447447">.</span><span class="ident" id="3447448">buf</span><span class="op" id="3447451">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3447454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447457">nn</span><span class="op" id="3447459">,</span>&nbsp;<span class="ident" id="3447461">d</span><span class="op" id="3447462">.</span><span class="ident" id="3447463">err</span>&nbsp;<span class="op" id="3447467">=</span>&nbsp;<span class="ident" id="3447469">io</span><span class="op" id="3447471">.</span><span class="ident" id="3447472">ReadAtLeast</span><span class="op" id="3447483">(</span><span class="ident" id="3447484">d</span><span class="op" id="3447485">.</span><span class="ident" id="3447486">r</span><span class="op" id="3447487">,</span>&nbsp;<span class="ident" id="3447489">d</span><span class="op" id="3447490">.</span><span class="ident" id="3447491">buf</span><span class="op" id="3447494">[</span><span class="ident" id="3447495">d</span><span class="op" id="3447496">.</span><span class="ident" id="3447497">nbuf</span><span class="op" id="3447501">:</span><span class="ident" id="3447502">nn</span><span class="op" id="3447504">]</span><span class="op" id="3447505">,</span>&nbsp;<span class="num" id="3447507">4</span><span class="op" id="3447508">-</span><span class="ident" id="3447509">d</span><span class="op" id="3447510">.</span><span class="ident" id="3447511">nbuf</span><span class="op" id="3447515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447518">d</span><span class="op" id="3447519">.</span><span class="ident" id="3447520">nbuf</span>&nbsp;<span class="op" id="3447525">+=</span>&nbsp;<span class="ident" id="3447528">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3447532">if</span>&nbsp;<span class="ident" id="3447535">d</span><span class="op" id="3447536">.</span><span class="ident" id="3447537">err</span>&nbsp;<span class="op" id="3447541">!=</span>&nbsp;<span class="builtintype" id="3447544">nil</span>&nbsp;<span class="op" id="3447548">||</span>&nbsp;<span class="ident" id="3447551">d</span><span class="op" id="3447552">.</span><span class="ident" id="3447553">nbuf</span>&nbsp;<span class="op" id="3447558">&lt;</span>&nbsp;<span class="num" id="3447560">4</span>&nbsp;<span class="op" id="3447562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3447566">return</span>&nbsp;<span class="num" id="3447573">0</span><span class="op" id="3447574">,</span>&nbsp;<span class="ident" id="3447576">d</span><span class="op" id="3447577">.</span><span class="ident" id="3447578">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3447583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3447587">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447651">nr</span>&nbsp;<span class="op" id="3447654">:=</span>&nbsp;<span class="ident" id="3447657">d</span><span class="op" id="3447658">.</span><span class="ident" id="3447659">nbuf</span>&nbsp;<span class="op" id="3447664">/</span>&nbsp;<span class="num" id="3447666">4</span>&nbsp;<span class="op" id="3447668">*</span>&nbsp;<span class="num" id="3447670">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447673">nw</span>&nbsp;<span class="op" id="3447676">:=</span>&nbsp;<span class="ident" id="3447679">d</span><span class="op" id="3447680">.</span><span class="ident" id="3447681">nbuf</span>&nbsp;<span class="op" id="3447686">/</span>&nbsp;<span class="num" id="3447688">4</span>&nbsp;<span class="op" id="3447690">*</span>&nbsp;<span class="num" id="3447692">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3447695">if</span>&nbsp;<span class="ident" id="3447698">nw</span>&nbsp;<span class="op" id="3447701">&gt;</span>&nbsp;<span class="builtinfunc" id="3447703">len</span><span class="op" id="3447706">(</span><span class="ident" id="3447707">p</span><span class="op" id="3447708">)</span>&nbsp;<span class="op" id="3447710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447714">nw</span><span class="op" id="3447716">,</span>&nbsp;<span class="ident" id="3447718">d</span><span class="op" id="3447719">.</span><span class="ident" id="3447720">end</span><span class="op" id="3447723">,</span>&nbsp;<span class="ident" id="3447725">d</span><span class="op" id="3447726">.</span><span class="ident" id="3447727">err</span>&nbsp;<span class="op" id="3447731">=</span>&nbsp;<span class="ident" id="3447733">d</span><span class="op" id="3447734">.</span><span class="ident" id="3447735">enc</span><span class="op" id="3447738">.</span><span class="ident" id="3447739">decode</span><span class="op" id="3447745">(</span><span class="ident" id="3447746">d</span><span class="op" id="3447747">.</span><span class="ident" id="3447748">outbuf</span><span class="op" id="3447754">[</span><span class="num" id="3447755">0</span><span class="op" id="3447756">:</span><span class="op" id="3447757">]</span><span class="op" id="3447758">,</span>&nbsp;<span class="ident" id="3447760">d</span><span class="op" id="3447761">.</span><span class="ident" id="3447762">buf</span><span class="op" id="3447765">[</span><span class="num" id="3447766">0</span><span class="op" id="3447767">:</span><span class="ident" id="3447768">nr</span><span class="op" id="3447770">]</span><span class="op" id="3447771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447775">d</span><span class="op" id="3447776">.</span><span class="ident" id="3447777">out</span>&nbsp;<span class="op" id="3447781">=</span>&nbsp;<span class="ident" id="3447783">d</span><span class="op" id="3447784">.</span><span class="ident" id="3447785">outbuf</span><span class="op" id="3447791">[</span><span class="num" id="3447792">0</span><span class="op" id="3447793">:</span><span class="ident" id="3447794">nw</span><span class="op" id="3447796">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447800">n</span>&nbsp;<span class="op" id="3447802">=</span>&nbsp;<span class="builtinfunc" id="3447804">copy</span><span class="op" id="3447808">(</span><span class="ident" id="3447809">p</span><span class="op" id="3447810">,</span>&nbsp;<span class="ident" id="3447812">d</span><span class="op" id="3447813">.</span><span class="ident" id="3447814">out</span><span class="op" id="3447817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447821">d</span><span class="op" id="3447822">.</span><span class="ident" id="3447823">out</span>&nbsp;<span class="op" id="3447827">=</span>&nbsp;<span class="ident" id="3447829">d</span><span class="op" id="3447830">.</span><span class="ident" id="3447831">out</span><span class="op" id="3447834">[</span><span class="ident" id="3447835">n</span><span class="op" id="3447836">:</span><span class="op" id="3447837">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3447840">}</span>&nbsp;<span class="keyword" id="3447842">else</span>&nbsp;<span class="op" id="3447847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447851">n</span><span class="op" id="3447852">,</span>&nbsp;<span class="ident" id="3447854">d</span><span class="op" id="3447855">.</span><span class="ident" id="3447856">end</span><span class="op" id="3447859">,</span>&nbsp;<span class="ident" id="3447861">d</span><span class="op" id="3447862">.</span><span class="ident" id="3447863">err</span>&nbsp;<span class="op" id="3447867">=</span>&nbsp;<span class="ident" id="3447869">d</span><span class="op" id="3447870">.</span><span class="ident" id="3447871">enc</span><span class="op" id="3447874">.</span><span class="ident" id="3447875">decode</span><span class="op" id="3447881">(</span><span class="ident" id="3447882">p</span><span class="op" id="3447883">,</span>&nbsp;<span class="ident" id="3447885">d</span><span class="op" id="3447886">.</span><span class="ident" id="3447887">buf</span><span class="op" id="3447890">[</span><span class="num" id="3447891">0</span><span class="op" id="3447892">:</span><span class="ident" id="3447893">nr</span><span class="op" id="3447895">]</span><span class="op" id="3447896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3447899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447902">d</span><span class="op" id="3447903">.</span><span class="ident" id="3447904">nbuf</span>&nbsp;<span class="op" id="3447909">-=</span>&nbsp;<span class="ident" id="3447912">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3447916">for</span>&nbsp;<span class="ident" id="3447920">i</span>&nbsp;<span class="op" id="3447922">:=</span>&nbsp;<span class="num" id="3447925">0</span><span class="op" id="3447926">;</span>&nbsp;<span class="ident" id="3447928">i</span>&nbsp;<span class="op" id="3447930">&lt;</span>&nbsp;<span class="ident" id="3447932">d</span><span class="op" id="3447933">.</span><span class="ident" id="3447934">nbuf</span><span class="op" id="3447938">;</span>&nbsp;<span class="ident" id="3447940">i</span><span class="op" id="3447941">++</span>&nbsp;<span class="op" id="3447944">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447948">d</span><span class="op" id="3447949">.</span><span class="ident" id="3447950">buf</span><span class="op" id="3447953">[</span><span class="ident" id="3447954">i</span><span class="op" id="3447955">]</span>&nbsp;<span class="op" id="3447957">=</span>&nbsp;<span class="ident" id="3447959">d</span><span class="op" id="3447960">.</span><span class="ident" id="3447961">buf</span><span class="op" id="3447964">[</span><span class="ident" id="3447965">i</span><span class="op" id="3447966">+</span><span class="ident" id="3447967">nr</span><span class="op" id="3447969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3447972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3447976">if</span>&nbsp;<span class="ident" id="3447979">d</span><span class="op" id="3447980">.</span><span class="ident" id="3447981">err</span>&nbsp;<span class="op" id="3447985">==</span>&nbsp;<span class="builtintype" id="3447988">nil</span>&nbsp;<span class="op" id="3447992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3447996">d</span><span class="op" id="3447997">.</span><span class="ident" id="3447998">err</span>&nbsp;<span class="op" id="3448002">=</span>&nbsp;<span class="ident" id="3448004">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3448009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3448012">return</span>&nbsp;<span class="ident" id="3448019">n</span><span class="op" id="3448020">,</span>&nbsp;<span class="ident" id="3448022">d</span><span class="op" id="3448023">.</span><span class="ident" id="3448024">err</span><br>
<span class="lineno"></span><span class="op" id="3448028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3448031">type</span>&nbsp;<span class="ident" id="3448036">newlineFilteringReader</span>&nbsp;<span class="keyword" id="3448059">struct</span>&nbsp;<span class="op" id="3448066">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3448069">wrapped</span>&nbsp;<span class="ident" id="3448077">io</span><span class="op" id="3448079">.</span><span class="ident" id="3448080">Reader</span><br>
<span class="lineno"></span><span class="op" id="3448087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3448090">func</span>&nbsp;<span class="op" id="3448095">(</span><span class="ident" id="3448096">r</span>&nbsp;<span class="op" id="3448098">*</span><span class="ident" id="3448099">newlineFilteringReader</span><span class="op" id="3448121">)</span>&nbsp;<span class="ident" id="3448123">Read</span><span class="op" id="3448127">(</span><span class="ident" id="3448128">p</span>&nbsp;<span class="op" id="3448130">[</span><span class="op" id="3448131">]</span><span class="builtintype" id="3448132">byte</span><span class="op" id="3448136">)</span>&nbsp;<span class="op" id="3448138">(</span><span class="builtintype" id="3448139">int</span><span class="op" id="3448142">,</span>&nbsp;<span class="builtintype" id="3448144">error</span><span class="op" id="3448149">)</span>&nbsp;<span class="op" id="3448151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3448154">n</span><span class="op" id="3448155">,</span>&nbsp;<span class="ident" id="3448157">err</span>&nbsp;<span class="op" id="3448161">:=</span>&nbsp;<span class="ident" id="3448164">r</span><span class="op" id="3448165">.</span><span class="ident" id="3448166">wrapped</span><span class="op" id="3448173">.</span><span class="ident" id="3448174">Read</span><span class="op" id="3448178">(</span><span class="ident" id="3448179">p</span><span class="op" id="3448180">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3448183">for</span>&nbsp;<span class="ident" id="3448187">n</span>&nbsp;<span class="op" id="3448189">&gt;</span>&nbsp;<span class="num" id="3448191">0</span>&nbsp;<span class="op" id="3448193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3448197">offset</span>&nbsp;<span class="op" id="3448204">:=</span>&nbsp;<span class="num" id="3448207">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3448211">for</span>&nbsp;<span class="ident" id="3448215">i</span><span class="op" id="3448216">,</span>&nbsp;<span class="ident" id="3448218">b</span>&nbsp;<span class="op" id="3448220">:=</span>&nbsp;<span class="keyword" id="3448223">range</span>&nbsp;<span class="ident" id="3448229">p</span><span class="op" id="3448230">[</span><span class="num" id="3448231">0</span><span class="op" id="3448232">:</span><span class="ident" id="3448233">n</span><span class="op" id="3448234">]</span>&nbsp;<span class="op" id="3448236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3448241">if</span>&nbsp;<span class="ident" id="3448244">b</span>&nbsp;<span class="op" id="3448246">!=</span>&nbsp;<span class="string" id="3448249">&#39;\r&#39;</span>&nbsp;<span class="op" id="3448254">&amp;&amp;</span>&nbsp;<span class="ident" id="3448257">b</span>&nbsp;<span class="op" id="3448259">!=</span>&nbsp;<span class="string" id="3448262">&#39;\n&#39;</span>&nbsp;<span class="op" id="3448267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3448273">if</span>&nbsp;<span class="ident" id="3448276">i</span>&nbsp;<span class="op" id="3448278">!=</span>&nbsp;<span class="ident" id="3448281">offset</span>&nbsp;<span class="op" id="3448288">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3448295">p</span><span class="op" id="3448296">[</span><span class="ident" id="3448297">offset</span><span class="op" id="3448303">]</span>&nbsp;<span class="op" id="3448305">=</span>&nbsp;<span class="ident" id="3448307">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3448313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3448319">offset</span><span class="op" id="3448325">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3448331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3448335">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3448339">if</span>&nbsp;<span class="ident" id="3448342">offset</span>&nbsp;<span class="op" id="3448349">&gt;</span>&nbsp;<span class="num" id="3448351">0</span>&nbsp;<span class="op" id="3448353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3448358">return</span>&nbsp;<span class="ident" id="3448365">offset</span><span class="op" id="3448371">,</span>&nbsp;<span class="ident" id="3448373">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3448379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3448383">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3448436">n</span><span class="op" id="3448437">,</span>&nbsp;<span class="ident" id="3448439">err</span>&nbsp;<span class="op" id="3448443">=</span>&nbsp;<span class="ident" id="3448445">r</span><span class="op" id="3448446">.</span><span class="ident" id="3448447">wrapped</span><span class="op" id="3448454">.</span><span class="ident" id="3448455">Read</span><span class="op" id="3448459">(</span><span class="ident" id="3448460">p</span><span class="op" id="3448461">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3448464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3448467">return</span>&nbsp;<span class="ident" id="3448474">n</span><span class="op" id="3448475">,</span>&nbsp;<span class="ident" id="3448477">err</span><br>
<span class="lineno"></span><span class="op" id="3448481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3448484">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="3448538">func</span>&nbsp;<span class="ident" id="3448543">NewDecoder</span><span class="op" id="3448553">(</span><span class="ident" id="3448554">enc</span>&nbsp;<span class="op" id="3448558">*</span><span class="ident" id="3448559">Encoding</span><span class="op" id="3448567">,</span>&nbsp;<span class="ident" id="3448569">r</span>&nbsp;<span class="ident" id="3448571">io</span><span class="op" id="3448573">.</span><span class="ident" id="3448574">Reader</span><span class="op" id="3448580">)</span>&nbsp;<span class="ident" id="3448582">io</span><span class="op" id="3448584">.</span><span class="ident" id="3448585">Reader</span>&nbsp;<span class="op" id="3448592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3448595">return</span>&nbsp;<span class="op" id="3448602">&amp;</span><span class="ident" id="3448603">decoder</span><span class="op" id="3448610">{</span><span class="ident" id="3448611">enc</span><span class="op" id="3448614">:</span>&nbsp;<span class="ident" id="3448616">enc</span><span class="op" id="3448619">,</span>&nbsp;<span class="ident" id="3448621">r</span><span class="op" id="3448622">:</span>&nbsp;<span class="op" id="3448624">&amp;</span><span class="ident" id="3448625">newlineFilteringReader</span><span class="op" id="3448647">{</span><span class="ident" id="3448648">r</span><span class="op" id="3448649">}</span><span class="op" id="3448650">}</span><br>
<span class="lineno"></span><span class="op" id="3448652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3448655">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="3448725">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3448777">func</span>&nbsp;<span class="op" id="3448782">(</span><span class="ident" id="3448783">enc</span>&nbsp;<span class="op" id="3448787">*</span><span class="ident" id="3448788">Encoding</span><span class="op" id="3448796">)</span>&nbsp;<span class="ident" id="3448798">DecodedLen</span><span class="op" id="3448808">(</span><span class="ident" id="3448809">n</span>&nbsp;<span class="builtintype" id="3448811">int</span><span class="op" id="3448814">)</span>&nbsp;<span class="builtintype" id="3448816">int</span>&nbsp;<span class="op" id="3448820">{</span>&nbsp;<span class="keyword" id="3448822">return</span>&nbsp;<span class="ident" id="3448829">n</span>&nbsp;<span class="op" id="3448831">/</span>&nbsp;<span class="num" id="3448833">4</span>&nbsp;<span class="op" id="3448835">*</span>&nbsp;<span class="num" id="3448837">3</span>&nbsp;<span class="op" id="3448839">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
