<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7256962">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7257017">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7257071">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7257122">package</span>&nbsp;<span class="ident" id="7257130">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7257139">import</span>&nbsp;<span class="op" id="7257146">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257149">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257158">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257164">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257177">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257188">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7257198">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7257201">type</span>&nbsp;<span class="ident" id="7257206">testpair</span>&nbsp;<span class="keyword" id="7257215">struct</span>&nbsp;<span class="op" id="7257222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7257225">decoded</span><span class="op" id="7257232">,</span>&nbsp;<span class="ident" id="7257234">encoded</span>&nbsp;<span class="builtintype" id="7257242">string</span><br>
<span class="lineno"></span><span class="op" id="7257249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7257252">var</span>&nbsp;<span class="ident" id="7257256">pairs</span>&nbsp;<span class="op" id="7257262">=</span>&nbsp;<span class="op" id="7257264">[</span><span class="op" id="7257265">]</span><span class="ident" id="7257266">testpair</span><span class="op" id="7257274">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7257277">//&nbsp;Encode&nbsp;returns&nbsp;0&nbsp;when&nbsp;len(src)&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7257317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257321">&#34;&#34;</span><span class="op" id="7257323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257327">&#34;&#34;</span><span class="op" id="7257329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7257332">}</span><span class="op" id="7257333">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7257336">//&nbsp;Wikipedia&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7257358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257362">&#34;Man&nbsp;is&nbsp;distinguished,&nbsp;not&nbsp;only&nbsp;by&nbsp;his&nbsp;reason,&nbsp;but&nbsp;by&nbsp;this&nbsp;singular&nbsp;passion&nbsp;from&nbsp;&#34;</span>&nbsp;<span class="op" id="7257445">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257450">&#34;other&nbsp;animals,&nbsp;which&nbsp;is&nbsp;a&nbsp;lust&nbsp;of&nbsp;the&nbsp;mind,&nbsp;that&nbsp;by&nbsp;a&nbsp;perseverance&nbsp;of&nbsp;delight&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="7257534">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257539">&#34;the&nbsp;continued&nbsp;and&nbsp;indefatigable&nbsp;generation&nbsp;of&nbsp;knowledge,&nbsp;exceeds&nbsp;the&nbsp;short&nbsp;&#34;</span>&nbsp;<span class="op" id="7257617">+</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257622">&#34;vehemence&nbsp;of&nbsp;any&nbsp;carnal&nbsp;pleasure.&#34;</span><span class="op" id="7257657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257661">&#34;9jqo^BlbD-BleB1DJ+*+F(f,q/0JhKF&lt;GL&gt;Cj@.4Gp$d7F!,L7@&lt;6@)/0JDEF&lt;G%&lt;+EV:2F!,\n&#34;</span>&nbsp;<span class="op" id="7257739">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257744">&#34;O&lt;DJ+*.@&lt;*K0@&lt;6L(Df-\\0Ec5e;DffZ(EZee.Bl.9pF\&#34;AGXBPCsi+DGm&gt;@3BB/F*&amp;OCAfu2/AKY\n&#34;</span>&nbsp;<span class="op" id="7257826">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257831">&#34;i(DIb:@FD,*)+C]U=@3BN#EcYf8ATD3s@q?d$AftVqCh[NqF&lt;G:8+EV:.+Cf&gt;-FD5W8ARlolDIa\n&#34;</span>&nbsp;<span class="op" id="7257911">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7257916">&#34;l(DId&lt;j@&lt;?3r@:F%a+D58&#39;ATD4$Bl@l3De:,-DJs`8ARoFb/0JMK@qB4^F!,R&lt;AKZ&amp;-DfTqBG%G\n&#34;</span>&nbsp;<span class="op" id="7257996">+</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7258001">&#34;&gt;uD.RTpAKYo&#39;+CT/5+Cei#DII?(E,9)oF*2M7/c\n&#34;</span><span class="op" id="7258044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7258047">}</span><span class="op" id="7258048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7258051">//&nbsp;Special&nbsp;case&nbsp;when&nbsp;shortening&nbsp;!!!!!&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7258096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7258100">&#34;\000\000\000\000&#34;</span><span class="op" id="7258118">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7258122">&#34;z&#34;</span><span class="op" id="7258125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7258128">}</span><span class="op" id="7258129">,</span><br>
<span class="lineno"></span><span class="op" id="7258131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7258134">var</span>&nbsp;<span class="ident" id="7258138">bigtest</span>&nbsp;<span class="op" id="7258146">=</span>&nbsp;<span class="ident" id="7258148">pairs</span><span class="op" id="7258153">[</span><span class="builtinfunc" id="7258154">len</span><span class="op" id="7258157">(</span><span class="ident" id="7258158">pairs</span><span class="op" id="7258163">)</span><span class="op" id="7258164">-</span><span class="num" id="7258165">1</span><span class="op" id="7258166">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7258169">func</span>&nbsp;<span class="ident" id="7258174">testEqual</span><span class="op" id="7258183">(</span><span class="ident" id="7258184">t</span>&nbsp;<span class="op" id="7258186">*</span><span class="ident" id="7258187">testing</span><span class="op" id="7258194">.</span><span class="ident" id="7258195">T</span><span class="op" id="7258196">,</span>&nbsp;<span class="ident" id="7258198">msg</span>&nbsp;<span class="builtintype" id="7258202">string</span><span class="op" id="7258208">,</span>&nbsp;<span class="ident" id="7258210">args</span>&nbsp;<span class="op" id="7258215">...</span><span class="keyword" id="7258218">interface</span><span class="op" id="7258227">{</span><span class="op" id="7258228">}</span><span class="op" id="7258229">)</span>&nbsp;<span class="builtintype" id="7258231">bool</span>&nbsp;<span class="op" id="7258236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7258239">if</span>&nbsp;<span class="ident" id="7258242">args</span><span class="op" id="7258246">[</span><span class="builtinfunc" id="7258247">len</span><span class="op" id="7258250">(</span><span class="ident" id="7258251">args</span><span class="op" id="7258255">)</span><span class="op" id="7258256">-</span><span class="num" id="7258257">2</span><span class="op" id="7258258">]</span>&nbsp;<span class="op" id="7258260">!=</span>&nbsp;<span class="ident" id="7258263">args</span><span class="op" id="7258267">[</span><span class="builtinfunc" id="7258268">len</span><span class="op" id="7258271">(</span><span class="ident" id="7258272">args</span><span class="op" id="7258276">)</span><span class="op" id="7258277">-</span><span class="num" id="7258278">1</span><span class="op" id="7258279">]</span>&nbsp;<span class="op" id="7258281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258285">t</span><span class="op" id="7258286">.</span><span class="ident" id="7258287">Errorf</span><span class="op" id="7258293">(</span><span class="ident" id="7258294">msg</span><span class="op" id="7258297">,</span>&nbsp;<span class="ident" id="7258299">args</span><span class="op" id="7258303">...</span><span class="op" id="7258306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7258310">return</span>&nbsp;<span class="builtintype" id="7258317">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7258324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7258327">return</span>&nbsp;<span class="builtintype" id="7258334">true</span><br>
<span class="lineno"></span><span class="op" id="7258339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7258342">func</span>&nbsp;<span class="ident" id="7258347">strip85</span><span class="op" id="7258354">(</span><span class="ident" id="7258355">s</span>&nbsp;<span class="builtintype" id="7258357">string</span><span class="op" id="7258363">)</span>&nbsp;<span class="builtintype" id="7258365">string</span>&nbsp;<span class="op" id="7258372">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258375">t</span>&nbsp;<span class="op" id="7258377">:=</span>&nbsp;<span class="builtinfunc" id="7258380">make</span><span class="op" id="7258384">(</span><span class="op" id="7258385">[</span><span class="op" id="7258386">]</span><span class="builtintype" id="7258387">byte</span><span class="op" id="7258391">,</span>&nbsp;<span class="builtinfunc" id="7258393">len</span><span class="op" id="7258396">(</span><span class="ident" id="7258397">s</span><span class="op" id="7258398">)</span><span class="op" id="7258399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258402">w</span>&nbsp;<span class="op" id="7258404">:=</span>&nbsp;<span class="num" id="7258407">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7258410">for</span>&nbsp;<span class="ident" id="7258414">r</span>&nbsp;<span class="op" id="7258416">:=</span>&nbsp;<span class="num" id="7258419">0</span><span class="op" id="7258420">;</span>&nbsp;<span class="ident" id="7258422">r</span>&nbsp;<span class="op" id="7258424">&lt;</span>&nbsp;<span class="builtinfunc" id="7258426">len</span><span class="op" id="7258429">(</span><span class="ident" id="7258430">s</span><span class="op" id="7258431">)</span><span class="op" id="7258432">;</span>&nbsp;<span class="ident" id="7258434">r</span><span class="op" id="7258435">++</span>&nbsp;<span class="op" id="7258438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258442">c</span>&nbsp;<span class="op" id="7258444">:=</span>&nbsp;<span class="ident" id="7258447">s</span><span class="op" id="7258448">[</span><span class="ident" id="7258449">r</span><span class="op" id="7258450">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7258454">if</span>&nbsp;<span class="ident" id="7258457">c</span>&nbsp;<span class="op" id="7258459">&gt;</span>&nbsp;<span class="string" id="7258461">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="7258465">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258470">t</span><span class="op" id="7258471">[</span><span class="ident" id="7258472">w</span><span class="op" id="7258473">]</span>&nbsp;<span class="op" id="7258475">=</span>&nbsp;<span class="ident" id="7258477">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258482">w</span><span class="op" id="7258483">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7258488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7258491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7258494">return</span>&nbsp;<span class="builtintype" id="7258501">string</span><span class="op" id="7258507">(</span><span class="ident" id="7258508">t</span><span class="op" id="7258509">[</span><span class="num" id="7258510">0</span><span class="op" id="7258511">:</span><span class="ident" id="7258512">w</span><span class="op" id="7258513">]</span><span class="op" id="7258514">)</span><br>
<span class="lineno">65</span><span class="op" id="7258516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7258519">func</span>&nbsp;<span class="ident" id="7258524">TestEncode</span><span class="op" id="7258534">(</span><span class="ident" id="7258535">t</span>&nbsp;<span class="op" id="7258537">*</span><span class="ident" id="7258538">testing</span><span class="op" id="7258545">.</span><span class="ident" id="7258546">T</span><span class="op" id="7258547">)</span>&nbsp;<span class="op" id="7258549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7258552">for</span>&nbsp;<span class="ident" id="7258556">_</span><span class="op" id="7258557">,</span>&nbsp;<span class="ident" id="7258559">p</span>&nbsp;<span class="op" id="7258561">:=</span>&nbsp;<span class="keyword" id="7258564">range</span>&nbsp;<span class="ident" id="7258570">pairs</span>&nbsp;<span class="op" id="7258576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258580">buf</span>&nbsp;<span class="op" id="7258584">:=</span>&nbsp;<span class="builtinfunc" id="7258587">make</span><span class="op" id="7258591">(</span><span class="op" id="7258592">[</span><span class="op" id="7258593">]</span><span class="builtintype" id="7258594">byte</span><span class="op" id="7258598">,</span>&nbsp;<span class="ident" id="7258600">MaxEncodedLen</span><span class="op" id="7258613">(</span><span class="builtinfunc" id="7258614">len</span><span class="op" id="7258617">(</span><span class="ident" id="7258618">p</span><span class="op" id="7258619">.</span><span class="ident" id="7258620">decoded</span><span class="op" id="7258627">)</span><span class="op" id="7258628">)</span><span class="op" id="7258629">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258633">n</span>&nbsp;<span class="op" id="7258635">:=</span>&nbsp;<span class="ident" id="7258638">Encode</span><span class="op" id="7258644">(</span><span class="ident" id="7258645">buf</span><span class="op" id="7258648">,</span>&nbsp;<span class="op" id="7258650">[</span><span class="op" id="7258651">]</span><span class="builtintype" id="7258652">byte</span><span class="op" id="7258656">(</span><span class="ident" id="7258657">p</span><span class="op" id="7258658">.</span><span class="ident" id="7258659">decoded</span><span class="op" id="7258666">)</span><span class="op" id="7258667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258671">buf</span>&nbsp;<span class="op" id="7258675">=</span>&nbsp;<span class="ident" id="7258677">buf</span><span class="op" id="7258680">[</span><span class="num" id="7258681">0</span><span class="op" id="7258682">:</span><span class="ident" id="7258683">n</span><span class="op" id="7258684">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258688">testEqual</span><span class="op" id="7258697">(</span><span class="ident" id="7258698">t</span><span class="op" id="7258699">,</span>&nbsp;<span class="string" id="7258701">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7258727">,</span>&nbsp;<span class="ident" id="7258729">p</span><span class="op" id="7258730">.</span><span class="ident" id="7258731">decoded</span><span class="op" id="7258738">,</span>&nbsp;<span class="ident" id="7258740">strip85</span><span class="op" id="7258747">(</span><span class="builtintype" id="7258748">string</span><span class="op" id="7258754">(</span><span class="ident" id="7258755">buf</span><span class="op" id="7258758">)</span><span class="op" id="7258759">)</span><span class="op" id="7258760">,</span>&nbsp;<span class="ident" id="7258762">strip85</span><span class="op" id="7258769">(</span><span class="ident" id="7258770">p</span><span class="op" id="7258771">.</span><span class="ident" id="7258772">encoded</span><span class="op" id="7258779">)</span><span class="op" id="7258780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7258783">}</span><br>
<span class="lineno"></span><span class="op" id="7258785">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7258788">func</span>&nbsp;<span class="ident" id="7258793">TestEncoder</span><span class="op" id="7258804">(</span><span class="ident" id="7258805">t</span>&nbsp;<span class="op" id="7258807">*</span><span class="ident" id="7258808">testing</span><span class="op" id="7258815">.</span><span class="ident" id="7258816">T</span><span class="op" id="7258817">)</span>&nbsp;<span class="op" id="7258819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7258822">for</span>&nbsp;<span class="ident" id="7258826">_</span><span class="op" id="7258827">,</span>&nbsp;<span class="ident" id="7258829">p</span>&nbsp;<span class="op" id="7258831">:=</span>&nbsp;<span class="keyword" id="7258834">range</span>&nbsp;<span class="ident" id="7258840">pairs</span>&nbsp;<span class="op" id="7258846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258850">bb</span>&nbsp;<span class="op" id="7258853">:=</span>&nbsp;<span class="op" id="7258856">&amp;</span><span class="ident" id="7258857">bytes</span><span class="op" id="7258862">.</span><span class="ident" id="7258863">Buffer</span><span class="op" id="7258869">{</span><span class="op" id="7258870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258874">encoder</span>&nbsp;<span class="op" id="7258882">:=</span>&nbsp;<span class="ident" id="7258885">NewEncoder</span><span class="op" id="7258895">(</span><span class="ident" id="7258896">bb</span><span class="op" id="7258898">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258902">encoder</span><span class="op" id="7258909">.</span><span class="ident" id="7258910">Write</span><span class="op" id="7258915">(</span><span class="op" id="7258916">[</span><span class="op" id="7258917">]</span><span class="builtintype" id="7258918">byte</span><span class="op" id="7258922">(</span><span class="ident" id="7258923">p</span><span class="op" id="7258924">.</span><span class="ident" id="7258925">decoded</span><span class="op" id="7258932">)</span><span class="op" id="7258933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258937">encoder</span><span class="op" id="7258944">.</span><span class="ident" id="7258945">Close</span><span class="op" id="7258950">(</span><span class="op" id="7258951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7258955">testEqual</span><span class="op" id="7258964">(</span><span class="ident" id="7258965">t</span><span class="op" id="7258966">,</span>&nbsp;<span class="string" id="7258968">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7258994">,</span>&nbsp;<span class="ident" id="7258996">p</span><span class="op" id="7258997">.</span><span class="ident" id="7258998">decoded</span><span class="op" id="7259005">,</span>&nbsp;<span class="ident" id="7259007">strip85</span><span class="op" id="7259014">(</span><span class="ident" id="7259015">bb</span><span class="op" id="7259017">.</span><span class="ident" id="7259018">String</span><span class="op" id="7259024">(</span><span class="op" id="7259025">)</span><span class="op" id="7259026">)</span><span class="op" id="7259027">,</span>&nbsp;<span class="ident" id="7259029">strip85</span><span class="op" id="7259036">(</span><span class="ident" id="7259037">p</span><span class="op" id="7259038">.</span><span class="ident" id="7259039">encoded</span><span class="op" id="7259046">)</span><span class="op" id="7259047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7259050">}</span><br>
<span class="lineno"></span><span class="op" id="7259052">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7259055">func</span>&nbsp;<span class="ident" id="7259060">TestEncoderBuffering</span><span class="op" id="7259080">(</span><span class="ident" id="7259081">t</span>&nbsp;<span class="op" id="7259083">*</span><span class="ident" id="7259084">testing</span><span class="op" id="7259091">.</span><span class="ident" id="7259092">T</span><span class="op" id="7259093">)</span>&nbsp;<span class="op" id="7259095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259098">input</span>&nbsp;<span class="op" id="7259104">:=</span>&nbsp;<span class="op" id="7259107">[</span><span class="op" id="7259108">]</span><span class="builtintype" id="7259109">byte</span><span class="op" id="7259113">(</span><span class="ident" id="7259114">bigtest</span><span class="op" id="7259121">.</span><span class="ident" id="7259122">decoded</span><span class="op" id="7259129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7259132">for</span>&nbsp;<span class="ident" id="7259136">bs</span>&nbsp;<span class="op" id="7259139">:=</span>&nbsp;<span class="num" id="7259142">1</span><span class="op" id="7259143">;</span>&nbsp;<span class="ident" id="7259145">bs</span>&nbsp;<span class="op" id="7259148">&lt;=</span>&nbsp;<span class="num" id="7259151">12</span><span class="op" id="7259153">;</span>&nbsp;<span class="ident" id="7259155">bs</span><span class="op" id="7259157">++</span>&nbsp;<span class="op" id="7259160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259164">bb</span>&nbsp;<span class="op" id="7259167">:=</span>&nbsp;<span class="op" id="7259170">&amp;</span><span class="ident" id="7259171">bytes</span><span class="op" id="7259176">.</span><span class="ident" id="7259177">Buffer</span><span class="op" id="7259183">{</span><span class="op" id="7259184">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259188">encoder</span>&nbsp;<span class="op" id="7259196">:=</span>&nbsp;<span class="ident" id="7259199">NewEncoder</span><span class="op" id="7259209">(</span><span class="ident" id="7259210">bb</span><span class="op" id="7259212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7259216">for</span>&nbsp;<span class="ident" id="7259220">pos</span>&nbsp;<span class="op" id="7259224">:=</span>&nbsp;<span class="num" id="7259227">0</span><span class="op" id="7259228">;</span>&nbsp;<span class="ident" id="7259230">pos</span>&nbsp;<span class="op" id="7259234">&lt;</span>&nbsp;<span class="builtinfunc" id="7259236">len</span><span class="op" id="7259239">(</span><span class="ident" id="7259240">input</span><span class="op" id="7259245">)</span><span class="op" id="7259246">;</span>&nbsp;<span class="ident" id="7259248">pos</span>&nbsp;<span class="op" id="7259252">+=</span>&nbsp;<span class="ident" id="7259255">bs</span>&nbsp;<span class="op" id="7259258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259263">end</span>&nbsp;<span class="op" id="7259267">:=</span>&nbsp;<span class="ident" id="7259270">pos</span>&nbsp;<span class="op" id="7259274">+</span>&nbsp;<span class="ident" id="7259276">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7259282">if</span>&nbsp;<span class="ident" id="7259285">end</span>&nbsp;<span class="op" id="7259289">&gt;</span>&nbsp;<span class="builtinfunc" id="7259291">len</span><span class="op" id="7259294">(</span><span class="ident" id="7259295">input</span><span class="op" id="7259300">)</span>&nbsp;<span class="op" id="7259302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259308">end</span>&nbsp;<span class="op" id="7259312">=</span>&nbsp;<span class="builtinfunc" id="7259314">len</span><span class="op" id="7259317">(</span><span class="ident" id="7259318">input</span><span class="op" id="7259323">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7259328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259333">n</span><span class="op" id="7259334">,</span>&nbsp;<span class="ident" id="7259336">err</span>&nbsp;<span class="op" id="7259340">:=</span>&nbsp;<span class="ident" id="7259343">encoder</span><span class="op" id="7259350">.</span><span class="ident" id="7259351">Write</span><span class="op" id="7259356">(</span><span class="ident" id="7259357">input</span><span class="op" id="7259362">[</span><span class="ident" id="7259363">pos</span><span class="op" id="7259366">:</span><span class="ident" id="7259367">end</span><span class="op" id="7259370">]</span><span class="op" id="7259371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259376">testEqual</span><span class="op" id="7259385">(</span><span class="ident" id="7259386">t</span><span class="op" id="7259387">,</span>&nbsp;<span class="string" id="7259389">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7259423">,</span>&nbsp;<span class="ident" id="7259425">input</span><span class="op" id="7259430">[</span><span class="ident" id="7259431">pos</span><span class="op" id="7259434">:</span><span class="ident" id="7259435">end</span><span class="op" id="7259438">]</span><span class="op" id="7259439">,</span>&nbsp;<span class="ident" id="7259441">err</span><span class="op" id="7259444">,</span>&nbsp;<span class="builtintype" id="7259446">error</span><span class="op" id="7259451">(</span><span class="ident" id="7259452">nil</span><span class="op" id="7259455">)</span><span class="op" id="7259456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259461">testEqual</span><span class="op" id="7259470">(</span><span class="ident" id="7259471">t</span><span class="op" id="7259472">,</span>&nbsp;<span class="string" id="7259474">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7259509">,</span>&nbsp;<span class="ident" id="7259511">input</span><span class="op" id="7259516">[</span><span class="ident" id="7259517">pos</span><span class="op" id="7259520">:</span><span class="ident" id="7259521">end</span><span class="op" id="7259524">]</span><span class="op" id="7259525">,</span>&nbsp;<span class="ident" id="7259527">n</span><span class="op" id="7259528">,</span>&nbsp;<span class="ident" id="7259530">end</span><span class="op" id="7259533">-</span><span class="ident" id="7259534">pos</span><span class="op" id="7259537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7259541">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259545">err</span>&nbsp;<span class="op" id="7259549">:=</span>&nbsp;<span class="ident" id="7259552">encoder</span><span class="op" id="7259559">.</span><span class="ident" id="7259560">Close</span><span class="op" id="7259565">(</span><span class="op" id="7259566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259570">testEqual</span><span class="op" id="7259579">(</span><span class="ident" id="7259580">t</span><span class="op" id="7259581">,</span>&nbsp;<span class="string" id="7259583">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7259613">,</span>&nbsp;<span class="ident" id="7259615">err</span><span class="op" id="7259618">,</span>&nbsp;<span class="builtintype" id="7259620">error</span><span class="op" id="7259625">(</span><span class="ident" id="7259626">nil</span><span class="op" id="7259629">)</span><span class="op" id="7259630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259634">testEqual</span><span class="op" id="7259643">(</span><span class="ident" id="7259644">t</span><span class="op" id="7259645">,</span>&nbsp;<span class="string" id="7259647">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7259680">,</span>&nbsp;<span class="ident" id="7259682">bs</span><span class="op" id="7259684">,</span>&nbsp;<span class="ident" id="7259686">bigtest</span><span class="op" id="7259693">.</span><span class="ident" id="7259694">decoded</span><span class="op" id="7259701">,</span>&nbsp;<span class="ident" id="7259703">strip85</span><span class="op" id="7259710">(</span><span class="ident" id="7259711">bb</span><span class="op" id="7259713">.</span><span class="ident" id="7259714">String</span><span class="op" id="7259720">(</span><span class="op" id="7259721">)</span><span class="op" id="7259722">)</span><span class="op" id="7259723">,</span>&nbsp;<span class="ident" id="7259725">strip85</span><span class="op" id="7259732">(</span><span class="ident" id="7259733">bigtest</span><span class="op" id="7259740">.</span><span class="ident" id="7259741">encoded</span><span class="op" id="7259748">)</span><span class="op" id="7259749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7259752">}</span><br>
<span class="lineno"></span><span class="op" id="7259754">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7259757">func</span>&nbsp;<span class="ident" id="7259762">TestDecode</span><span class="op" id="7259772">(</span><span class="ident" id="7259773">t</span>&nbsp;<span class="op" id="7259775">*</span><span class="ident" id="7259776">testing</span><span class="op" id="7259783">.</span><span class="ident" id="7259784">T</span><span class="op" id="7259785">)</span>&nbsp;<span class="op" id="7259787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7259790">for</span>&nbsp;<span class="ident" id="7259794">_</span><span class="op" id="7259795">,</span>&nbsp;<span class="ident" id="7259797">p</span>&nbsp;<span class="op" id="7259799">:=</span>&nbsp;<span class="keyword" id="7259802">range</span>&nbsp;<span class="ident" id="7259808">pairs</span>&nbsp;<span class="op" id="7259814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259818">dbuf</span>&nbsp;<span class="op" id="7259823">:=</span>&nbsp;<span class="builtinfunc" id="7259826">make</span><span class="op" id="7259830">(</span><span class="op" id="7259831">[</span><span class="op" id="7259832">]</span><span class="builtintype" id="7259833">byte</span><span class="op" id="7259837">,</span>&nbsp;<span class="num" id="7259839">4</span><span class="op" id="7259840">*</span><span class="builtinfunc" id="7259841">len</span><span class="op" id="7259844">(</span><span class="ident" id="7259845">p</span><span class="op" id="7259846">.</span><span class="ident" id="7259847">encoded</span><span class="op" id="7259854">)</span><span class="op" id="7259855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259859">ndst</span><span class="op" id="7259863">,</span>&nbsp;<span class="ident" id="7259865">nsrc</span><span class="op" id="7259869">,</span>&nbsp;<span class="ident" id="7259871">err</span>&nbsp;<span class="op" id="7259875">:=</span>&nbsp;<span class="ident" id="7259878">Decode</span><span class="op" id="7259884">(</span><span class="ident" id="7259885">dbuf</span><span class="op" id="7259889">,</span>&nbsp;<span class="op" id="7259891">[</span><span class="op" id="7259892">]</span><span class="builtintype" id="7259893">byte</span><span class="op" id="7259897">(</span><span class="ident" id="7259898">p</span><span class="op" id="7259899">.</span><span class="ident" id="7259900">encoded</span><span class="op" id="7259907">)</span><span class="op" id="7259908">,</span>&nbsp;<span class="builtintype" id="7259910">true</span><span class="op" id="7259914">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259918">testEqual</span><span class="op" id="7259927">(</span><span class="ident" id="7259928">t</span><span class="op" id="7259929">,</span>&nbsp;<span class="string" id="7259931">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7259963">,</span>&nbsp;<span class="ident" id="7259965">p</span><span class="op" id="7259966">.</span><span class="ident" id="7259967">encoded</span><span class="op" id="7259974">,</span>&nbsp;<span class="ident" id="7259976">err</span><span class="op" id="7259979">,</span>&nbsp;<span class="builtintype" id="7259981">error</span><span class="op" id="7259986">(</span><span class="ident" id="7259987">nil</span><span class="op" id="7259990">)</span><span class="op" id="7259991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259995">testEqual</span><span class="op" id="7260004">(</span><span class="ident" id="7260005">t</span><span class="op" id="7260006">,</span>&nbsp;<span class="string" id="7260008">&#34;Decode(%q)&nbsp;=&nbsp;nsrc&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7260039">,</span>&nbsp;<span class="ident" id="7260041">p</span><span class="op" id="7260042">.</span><span class="ident" id="7260043">encoded</span><span class="op" id="7260050">,</span>&nbsp;<span class="ident" id="7260052">nsrc</span><span class="op" id="7260056">,</span>&nbsp;<span class="builtinfunc" id="7260058">len</span><span class="op" id="7260061">(</span><span class="ident" id="7260062">p</span><span class="op" id="7260063">.</span><span class="ident" id="7260064">encoded</span><span class="op" id="7260071">)</span><span class="op" id="7260072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260076">testEqual</span><span class="op" id="7260085">(</span><span class="ident" id="7260086">t</span><span class="op" id="7260087">,</span>&nbsp;<span class="string" id="7260089">&#34;Decode(%q)&nbsp;=&nbsp;ndst&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7260120">,</span>&nbsp;<span class="ident" id="7260122">p</span><span class="op" id="7260123">.</span><span class="ident" id="7260124">encoded</span><span class="op" id="7260131">,</span>&nbsp;<span class="ident" id="7260133">ndst</span><span class="op" id="7260137">,</span>&nbsp;<span class="builtinfunc" id="7260139">len</span><span class="op" id="7260142">(</span><span class="ident" id="7260143">p</span><span class="op" id="7260144">.</span><span class="ident" id="7260145">decoded</span><span class="op" id="7260152">)</span><span class="op" id="7260153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260157">testEqual</span><span class="op" id="7260166">(</span><span class="ident" id="7260167">t</span><span class="op" id="7260168">,</span>&nbsp;<span class="string" id="7260170">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7260196">,</span>&nbsp;<span class="ident" id="7260198">p</span><span class="op" id="7260199">.</span><span class="ident" id="7260200">encoded</span><span class="op" id="7260207">,</span>&nbsp;<span class="builtintype" id="7260209">string</span><span class="op" id="7260215">(</span><span class="ident" id="7260216">dbuf</span><span class="op" id="7260220">[</span><span class="num" id="7260221">0</span><span class="op" id="7260222">:</span><span class="ident" id="7260223">ndst</span><span class="op" id="7260227">]</span><span class="op" id="7260228">)</span><span class="op" id="7260229">,</span>&nbsp;<span class="ident" id="7260231">p</span><span class="op" id="7260232">.</span><span class="ident" id="7260233">decoded</span><span class="op" id="7260240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7260243">}</span><br>
<span class="lineno">115</span><span class="op" id="7260245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7260248">func</span>&nbsp;<span class="ident" id="7260253">TestDecoder</span><span class="op" id="7260264">(</span><span class="ident" id="7260265">t</span>&nbsp;<span class="op" id="7260267">*</span><span class="ident" id="7260268">testing</span><span class="op" id="7260275">.</span><span class="ident" id="7260276">T</span><span class="op" id="7260277">)</span>&nbsp;<span class="op" id="7260279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7260282">for</span>&nbsp;<span class="ident" id="7260286">_</span><span class="op" id="7260287">,</span>&nbsp;<span class="ident" id="7260289">p</span>&nbsp;<span class="op" id="7260291">:=</span>&nbsp;<span class="keyword" id="7260294">range</span>&nbsp;<span class="ident" id="7260300">pairs</span>&nbsp;<span class="op" id="7260306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260310">decoder</span>&nbsp;<span class="op" id="7260318">:=</span>&nbsp;<span class="ident" id="7260321">NewDecoder</span><span class="op" id="7260331">(</span><span class="ident" id="7260332">strings</span><span class="op" id="7260339">.</span><span class="ident" id="7260340">NewReader</span><span class="op" id="7260349">(</span><span class="ident" id="7260350">p</span><span class="op" id="7260351">.</span><span class="ident" id="7260352">encoded</span><span class="op" id="7260359">)</span><span class="op" id="7260360">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260364">dbuf</span><span class="op" id="7260368">,</span>&nbsp;<span class="ident" id="7260370">err</span>&nbsp;<span class="op" id="7260374">:=</span>&nbsp;<span class="ident" id="7260377">ioutil</span><span class="op" id="7260383">.</span><span class="ident" id="7260384">ReadAll</span><span class="op" id="7260391">(</span><span class="ident" id="7260392">decoder</span><span class="op" id="7260399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7260403">if</span>&nbsp;<span class="ident" id="7260406">err</span>&nbsp;<span class="op" id="7260410">!=</span>&nbsp;<span class="ident" id="7260413">nil</span>&nbsp;<span class="op" id="7260417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260422">t</span><span class="op" id="7260423">.</span><span class="ident" id="7260424">Fatal</span><span class="op" id="7260429">(</span><span class="string" id="7260430">&#34;Read&nbsp;failed&#34;</span><span class="op" id="7260443">,</span>&nbsp;<span class="ident" id="7260445">err</span><span class="op" id="7260448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7260452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260456">testEqual</span><span class="op" id="7260465">(</span><span class="ident" id="7260466">t</span><span class="op" id="7260467">,</span>&nbsp;<span class="string" id="7260469">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7260504">,</span>&nbsp;<span class="ident" id="7260506">p</span><span class="op" id="7260507">.</span><span class="ident" id="7260508">encoded</span><span class="op" id="7260515">,</span>&nbsp;<span class="builtinfunc" id="7260517">len</span><span class="op" id="7260520">(</span><span class="ident" id="7260521">dbuf</span><span class="op" id="7260525">)</span><span class="op" id="7260526">,</span>&nbsp;<span class="builtinfunc" id="7260528">len</span><span class="op" id="7260531">(</span><span class="ident" id="7260532">p</span><span class="op" id="7260533">.</span><span class="ident" id="7260534">decoded</span><span class="op" id="7260541">)</span><span class="op" id="7260542">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260546">testEqual</span><span class="op" id="7260555">(</span><span class="ident" id="7260556">t</span><span class="op" id="7260557">,</span>&nbsp;<span class="string" id="7260559">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7260589">,</span>&nbsp;<span class="ident" id="7260591">p</span><span class="op" id="7260592">.</span><span class="ident" id="7260593">encoded</span><span class="op" id="7260600">,</span>&nbsp;<span class="builtintype" id="7260602">string</span><span class="op" id="7260608">(</span><span class="ident" id="7260609">dbuf</span><span class="op" id="7260613">)</span><span class="op" id="7260614">,</span>&nbsp;<span class="ident" id="7260616">p</span><span class="op" id="7260617">.</span><span class="ident" id="7260618">decoded</span><span class="op" id="7260625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7260629">if</span>&nbsp;<span class="ident" id="7260632">err</span>&nbsp;<span class="op" id="7260636">!=</span>&nbsp;<span class="ident" id="7260639">nil</span>&nbsp;<span class="op" id="7260643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260648">testEqual</span><span class="op" id="7260657">(</span><span class="ident" id="7260658">t</span><span class="op" id="7260659">,</span>&nbsp;<span class="string" id="7260661">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7260689">,</span>&nbsp;<span class="ident" id="7260691">p</span><span class="op" id="7260692">.</span><span class="ident" id="7260693">encoded</span><span class="op" id="7260700">,</span>&nbsp;<span class="ident" id="7260702">err</span><span class="op" id="7260705">,</span>&nbsp;<span class="ident" id="7260707">io</span><span class="op" id="7260709">.</span><span class="ident" id="7260710">EOF</span><span class="op" id="7260713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7260717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7260720">}</span><br>
<span class="lineno">130</span><span class="op" id="7260722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7260725">func</span>&nbsp;<span class="ident" id="7260730">TestDecoderBuffering</span><span class="op" id="7260750">(</span><span class="ident" id="7260751">t</span>&nbsp;<span class="op" id="7260753">*</span><span class="ident" id="7260754">testing</span><span class="op" id="7260761">.</span><span class="ident" id="7260762">T</span><span class="op" id="7260763">)</span>&nbsp;<span class="op" id="7260765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7260768">for</span>&nbsp;<span class="ident" id="7260772">bs</span>&nbsp;<span class="op" id="7260775">:=</span>&nbsp;<span class="num" id="7260778">1</span><span class="op" id="7260779">;</span>&nbsp;<span class="ident" id="7260781">bs</span>&nbsp;<span class="op" id="7260784">&lt;=</span>&nbsp;<span class="num" id="7260787">12</span><span class="op" id="7260789">;</span>&nbsp;<span class="ident" id="7260791">bs</span><span class="op" id="7260793">++</span>&nbsp;<span class="op" id="7260796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260800">decoder</span>&nbsp;<span class="op" id="7260808">:=</span>&nbsp;<span class="ident" id="7260811">NewDecoder</span><span class="op" id="7260821">(</span><span class="ident" id="7260822">strings</span><span class="op" id="7260829">.</span><span class="ident" id="7260830">NewReader</span><span class="op" id="7260839">(</span><span class="ident" id="7260840">bigtest</span><span class="op" id="7260847">.</span><span class="ident" id="7260848">encoded</span><span class="op" id="7260855">)</span><span class="op" id="7260856">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260860">buf</span>&nbsp;<span class="op" id="7260864">:=</span>&nbsp;<span class="builtinfunc" id="7260867">make</span><span class="op" id="7260871">(</span><span class="op" id="7260872">[</span><span class="op" id="7260873">]</span><span class="builtintype" id="7260874">byte</span><span class="op" id="7260878">,</span>&nbsp;<span class="builtinfunc" id="7260880">len</span><span class="op" id="7260883">(</span><span class="ident" id="7260884">bigtest</span><span class="op" id="7260891">.</span><span class="ident" id="7260892">decoded</span><span class="op" id="7260899">)</span><span class="op" id="7260900">+</span><span class="num" id="7260901">12</span><span class="op" id="7260903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7260907">var</span>&nbsp;<span class="ident" id="7260911">total</span>&nbsp;<span class="builtintype" id="7260917">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7260923">for</span>&nbsp;<span class="ident" id="7260927">total</span>&nbsp;<span class="op" id="7260933">=</span>&nbsp;<span class="num" id="7260935">0</span><span class="op" id="7260936">;</span>&nbsp;<span class="ident" id="7260938">total</span>&nbsp;<span class="op" id="7260944">&lt;</span>&nbsp;<span class="builtinfunc" id="7260946">len</span><span class="op" id="7260949">(</span><span class="ident" id="7260950">bigtest</span><span class="op" id="7260957">.</span><span class="ident" id="7260958">decoded</span><span class="op" id="7260965">)</span><span class="op" id="7260966">;</span>&nbsp;<span class="op" id="7260968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260973">n</span><span class="op" id="7260974">,</span>&nbsp;<span class="ident" id="7260976">err</span>&nbsp;<span class="op" id="7260980">:=</span>&nbsp;<span class="ident" id="7260983">decoder</span><span class="op" id="7260990">.</span><span class="ident" id="7260991">Read</span><span class="op" id="7260995">(</span><span class="ident" id="7260996">buf</span><span class="op" id="7260999">[</span><span class="ident" id="7261000">total</span>&nbsp;<span class="op" id="7261006">:</span>&nbsp;<span class="ident" id="7261008">total</span><span class="op" id="7261013">+</span><span class="ident" id="7261014">bs</span><span class="op" id="7261016">]</span><span class="op" id="7261017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261022">testEqual</span><span class="op" id="7261031">(</span><span class="ident" id="7261032">t</span><span class="op" id="7261033">,</span>&nbsp;<span class="string" id="7261035">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7261080">,</span>&nbsp;<span class="ident" id="7261082">bigtest</span><span class="op" id="7261089">.</span><span class="ident" id="7261090">encoded</span><span class="op" id="7261097">,</span>&nbsp;<span class="ident" id="7261099">total</span><span class="op" id="7261104">,</span>&nbsp;<span class="ident" id="7261106">n</span><span class="op" id="7261107">,</span>&nbsp;<span class="ident" id="7261109">err</span><span class="op" id="7261112">,</span>&nbsp;<span class="builtintype" id="7261114">error</span><span class="op" id="7261119">(</span><span class="ident" id="7261120">nil</span><span class="op" id="7261123">)</span><span class="op" id="7261124">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261129">total</span>&nbsp;<span class="op" id="7261135">+=</span>&nbsp;<span class="ident" id="7261138">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261146">testEqual</span><span class="op" id="7261155">(</span><span class="ident" id="7261156">t</span><span class="op" id="7261157">,</span>&nbsp;<span class="string" id="7261159">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7261192">,</span>&nbsp;<span class="ident" id="7261194">bs</span><span class="op" id="7261196">,</span>&nbsp;<span class="ident" id="7261198">bigtest</span><span class="op" id="7261205">.</span><span class="ident" id="7261206">encoded</span><span class="op" id="7261213">,</span>&nbsp;<span class="builtintype" id="7261215">string</span><span class="op" id="7261221">(</span><span class="ident" id="7261222">buf</span><span class="op" id="7261225">[</span><span class="num" id="7261226">0</span><span class="op" id="7261227">:</span><span class="ident" id="7261228">total</span><span class="op" id="7261233">]</span><span class="op" id="7261234">)</span><span class="op" id="7261235">,</span>&nbsp;<span class="ident" id="7261237">bigtest</span><span class="op" id="7261244">.</span><span class="ident" id="7261245">decoded</span><span class="op" id="7261252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261255">}</span><br>
<span class="lineno"></span><span class="op" id="7261257">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7261260">func</span>&nbsp;<span class="ident" id="7261265">TestDecodeCorrupt</span><span class="op" id="7261282">(</span><span class="ident" id="7261283">t</span>&nbsp;<span class="op" id="7261285">*</span><span class="ident" id="7261286">testing</span><span class="op" id="7261293">.</span><span class="ident" id="7261294">T</span><span class="op" id="7261295">)</span>&nbsp;<span class="op" id="7261297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7261300">type</span>&nbsp;<span class="ident" id="7261305">corrupt</span>&nbsp;<span class="keyword" id="7261313">struct</span>&nbsp;<span class="op" id="7261320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261324">e</span>&nbsp;<span class="builtintype" id="7261326">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261335">p</span>&nbsp;<span class="builtintype" id="7261337">int</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261345">examples</span>&nbsp;<span class="op" id="7261354">:=</span>&nbsp;<span class="op" id="7261357">[</span><span class="op" id="7261358">]</span><span class="ident" id="7261359">corrupt</span><span class="op" id="7261366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261370">{</span><span class="string" id="7261371">&#34;v&#34;</span><span class="op" id="7261374">,</span>&nbsp;<span class="num" id="7261376">0</span><span class="op" id="7261377">}</span><span class="op" id="7261378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261382">{</span><span class="string" id="7261383">&#34;!z!!!!!!!!!&#34;</span><span class="op" id="7261396">,</span>&nbsp;<span class="num" id="7261398">1</span><span class="op" id="7261399">}</span><span class="op" id="7261400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261403">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7261407">for</span>&nbsp;<span class="ident" id="7261411">_</span><span class="op" id="7261412">,</span>&nbsp;<span class="ident" id="7261414">e</span>&nbsp;<span class="op" id="7261416">:=</span>&nbsp;<span class="keyword" id="7261419">range</span>&nbsp;<span class="ident" id="7261425">examples</span>&nbsp;<span class="op" id="7261434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261438">dbuf</span>&nbsp;<span class="op" id="7261443">:=</span>&nbsp;<span class="builtinfunc" id="7261446">make</span><span class="op" id="7261450">(</span><span class="op" id="7261451">[</span><span class="op" id="7261452">]</span><span class="builtintype" id="7261453">byte</span><span class="op" id="7261457">,</span>&nbsp;<span class="num" id="7261459">4</span><span class="op" id="7261460">*</span><span class="builtinfunc" id="7261461">len</span><span class="op" id="7261464">(</span><span class="ident" id="7261465">e</span><span class="op" id="7261466">.</span><span class="ident" id="7261467">e</span><span class="op" id="7261468">)</span><span class="op" id="7261469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261473">_</span><span class="op" id="7261474">,</span>&nbsp;<span class="ident" id="7261476">_</span><span class="op" id="7261477">,</span>&nbsp;<span class="ident" id="7261479">err</span>&nbsp;<span class="op" id="7261483">:=</span>&nbsp;<span class="ident" id="7261486">Decode</span><span class="op" id="7261492">(</span><span class="ident" id="7261493">dbuf</span><span class="op" id="7261497">,</span>&nbsp;<span class="op" id="7261499">[</span><span class="op" id="7261500">]</span><span class="builtintype" id="7261501">byte</span><span class="op" id="7261505">(</span><span class="ident" id="7261506">e</span><span class="op" id="7261507">.</span><span class="ident" id="7261508">e</span><span class="op" id="7261509">)</span><span class="op" id="7261510">,</span>&nbsp;<span class="builtintype" id="7261512">true</span><span class="op" id="7261516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7261520">switch</span>&nbsp;<span class="ident" id="7261527">err</span>&nbsp;<span class="op" id="7261531">:=</span>&nbsp;<span class="ident" id="7261534">err</span><span class="op" id="7261537">.</span><span class="op" id="7261538">(</span><span class="keyword" id="7261539">type</span><span class="op" id="7261543">)</span>&nbsp;<span class="op" id="7261545">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7261549">case</span>&nbsp;<span class="ident" id="7261554">CorruptInputError</span><span class="op" id="7261571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261576">testEqual</span><span class="op" id="7261585">(</span><span class="ident" id="7261586">t</span><span class="op" id="7261587">,</span>&nbsp;<span class="string" id="7261589">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7261629">,</span>&nbsp;<span class="ident" id="7261631">e</span><span class="op" id="7261632">.</span><span class="ident" id="7261633">e</span><span class="op" id="7261634">,</span>&nbsp;<span class="builtintype" id="7261636">int</span><span class="op" id="7261639">(</span><span class="ident" id="7261640">err</span><span class="op" id="7261643">)</span><span class="op" id="7261644">,</span>&nbsp;<span class="ident" id="7261646">e</span><span class="op" id="7261647">.</span><span class="ident" id="7261648">p</span><span class="op" id="7261649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7261653">default</span><span class="op" id="7261660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261665">t</span><span class="op" id="7261666">.</span><span class="ident" id="7261667">Error</span><span class="op" id="7261672">(</span><span class="string" id="7261673">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="7261713">,</span>&nbsp;<span class="ident" id="7261715">e</span><span class="op" id="7261716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261720">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261723">}</span><br>
<span class="lineno"></span><span class="op" id="7261725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7261728">func</span>&nbsp;<span class="ident" id="7261733">TestBig</span><span class="op" id="7261740">(</span><span class="ident" id="7261741">t</span>&nbsp;<span class="op" id="7261743">*</span><span class="ident" id="7261744">testing</span><span class="op" id="7261751">.</span><span class="ident" id="7261752">T</span><span class="op" id="7261753">)</span>&nbsp;<span class="op" id="7261755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261758">n</span>&nbsp;<span class="op" id="7261760">:=</span>&nbsp;<span class="num" id="7261763">3</span><span class="op" id="7261764">*</span><span class="num" id="7261765">1000</span>&nbsp;<span class="op" id="7261770">+</span>&nbsp;<span class="num" id="7261772">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261775">raw</span>&nbsp;<span class="op" id="7261779">:=</span>&nbsp;<span class="builtinfunc" id="7261782">make</span><span class="op" id="7261786">(</span><span class="op" id="7261787">[</span><span class="op" id="7261788">]</span><span class="builtintype" id="7261789">byte</span><span class="op" id="7261793">,</span>&nbsp;<span class="ident" id="7261795">n</span><span class="op" id="7261796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7261799">const</span>&nbsp;<span class="ident" id="7261805">alpha</span>&nbsp;<span class="op" id="7261811">=</span>&nbsp;<span class="string" id="7261813">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7261879">for</span>&nbsp;<span class="ident" id="7261883">i</span>&nbsp;<span class="op" id="7261885">:=</span>&nbsp;<span class="num" id="7261888">0</span><span class="op" id="7261889">;</span>&nbsp;<span class="ident" id="7261891">i</span>&nbsp;<span class="op" id="7261893">&lt;</span>&nbsp;<span class="ident" id="7261895">n</span><span class="op" id="7261896">;</span>&nbsp;<span class="ident" id="7261898">i</span><span class="op" id="7261899">++</span>&nbsp;<span class="op" id="7261902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261906">raw</span><span class="op" id="7261909">[</span><span class="ident" id="7261910">i</span><span class="op" id="7261911">]</span>&nbsp;<span class="op" id="7261913">=</span>&nbsp;<span class="ident" id="7261915">alpha</span><span class="op" id="7261920">[</span><span class="ident" id="7261921">i</span><span class="op" id="7261922">%</span><span class="builtinfunc" id="7261923">len</span><span class="op" id="7261926">(</span><span class="ident" id="7261927">alpha</span><span class="op" id="7261932">)</span><span class="op" id="7261933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261936">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261939">encoded</span>&nbsp;<span class="op" id="7261947">:=</span>&nbsp;<span class="builtinfunc" id="7261950">new</span><span class="op" id="7261953">(</span><span class="ident" id="7261954">bytes</span><span class="op" id="7261959">.</span><span class="ident" id="7261960">Buffer</span><span class="op" id="7261966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261969">w</span>&nbsp;<span class="op" id="7261971">:=</span>&nbsp;<span class="ident" id="7261974">NewEncoder</span><span class="op" id="7261984">(</span><span class="ident" id="7261985">encoded</span><span class="op" id="7261992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261995">nn</span><span class="op" id="7261997">,</span>&nbsp;<span class="ident" id="7261999">err</span>&nbsp;<span class="op" id="7262003">:=</span>&nbsp;<span class="ident" id="7262006">w</span><span class="op" id="7262007">.</span><span class="ident" id="7262008">Write</span><span class="op" id="7262013">(</span><span class="ident" id="7262014">raw</span><span class="op" id="7262017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262020">if</span>&nbsp;<span class="ident" id="7262023">nn</span>&nbsp;<span class="op" id="7262026">!=</span>&nbsp;<span class="ident" id="7262029">n</span>&nbsp;<span class="op" id="7262031">||</span>&nbsp;<span class="ident" id="7262034">err</span>&nbsp;<span class="op" id="7262038">!=</span>&nbsp;<span class="ident" id="7262041">nil</span>&nbsp;<span class="op" id="7262045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262049">t</span><span class="op" id="7262050">.</span><span class="ident" id="7262051">Fatalf</span><span class="op" id="7262057">(</span><span class="string" id="7262058">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7262100">,</span>&nbsp;<span class="ident" id="7262102">nn</span><span class="op" id="7262104">,</span>&nbsp;<span class="ident" id="7262106">err</span><span class="op" id="7262109">,</span>&nbsp;<span class="ident" id="7262111">n</span><span class="op" id="7262112">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7262115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262118">err</span>&nbsp;<span class="op" id="7262122">=</span>&nbsp;<span class="ident" id="7262124">w</span><span class="op" id="7262125">.</span><span class="ident" id="7262126">Close</span><span class="op" id="7262131">(</span><span class="op" id="7262132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262135">if</span>&nbsp;<span class="ident" id="7262138">err</span>&nbsp;<span class="op" id="7262142">!=</span>&nbsp;<span class="ident" id="7262145">nil</span>&nbsp;<span class="op" id="7262149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262153">t</span><span class="op" id="7262154">.</span><span class="ident" id="7262155">Fatalf</span><span class="op" id="7262161">(</span><span class="string" id="7262162">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7262193">,</span>&nbsp;<span class="ident" id="7262195">err</span><span class="op" id="7262198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7262201">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262204">decoded</span><span class="op" id="7262211">,</span>&nbsp;<span class="ident" id="7262213">err</span>&nbsp;<span class="op" id="7262217">:=</span>&nbsp;<span class="ident" id="7262220">ioutil</span><span class="op" id="7262226">.</span><span class="ident" id="7262227">ReadAll</span><span class="op" id="7262234">(</span><span class="ident" id="7262235">NewDecoder</span><span class="op" id="7262245">(</span><span class="ident" id="7262246">encoded</span><span class="op" id="7262253">)</span><span class="op" id="7262254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262257">if</span>&nbsp;<span class="ident" id="7262260">err</span>&nbsp;<span class="op" id="7262264">!=</span>&nbsp;<span class="ident" id="7262267">nil</span>&nbsp;<span class="op" id="7262271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262275">t</span><span class="op" id="7262276">.</span><span class="ident" id="7262277">Fatalf</span><span class="op" id="7262283">(</span><span class="string" id="7262284">&#34;io.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="7262317">,</span>&nbsp;<span class="ident" id="7262319">err</span><span class="op" id="7262322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7262325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262329">if</span>&nbsp;<span class="op" id="7262332">!</span><span class="ident" id="7262333">bytes</span><span class="op" id="7262338">.</span><span class="ident" id="7262339">Equal</span><span class="op" id="7262344">(</span><span class="ident" id="7262345">raw</span><span class="op" id="7262348">,</span>&nbsp;<span class="ident" id="7262350">decoded</span><span class="op" id="7262357">)</span>&nbsp;<span class="op" id="7262359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262363">var</span>&nbsp;<span class="ident" id="7262367">i</span>&nbsp;<span class="builtintype" id="7262369">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262375">for</span>&nbsp;<span class="ident" id="7262379">i</span>&nbsp;<span class="op" id="7262381">=</span>&nbsp;<span class="num" id="7262383">0</span><span class="op" id="7262384">;</span>&nbsp;<span class="ident" id="7262386">i</span>&nbsp;<span class="op" id="7262388">&lt;</span>&nbsp;<span class="builtinfunc" id="7262390">len</span><span class="op" id="7262393">(</span><span class="ident" id="7262394">decoded</span><span class="op" id="7262401">)</span>&nbsp;<span class="op" id="7262403">&amp;&amp;</span>&nbsp;<span class="ident" id="7262406">i</span>&nbsp;<span class="op" id="7262408">&lt;</span>&nbsp;<span class="builtinfunc" id="7262410">len</span><span class="op" id="7262413">(</span><span class="ident" id="7262414">raw</span><span class="op" id="7262417">)</span><span class="op" id="7262418">;</span>&nbsp;<span class="ident" id="7262420">i</span><span class="op" id="7262421">++</span>&nbsp;<span class="op" id="7262424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262429">if</span>&nbsp;<span class="ident" id="7262432">decoded</span><span class="op" id="7262439">[</span><span class="ident" id="7262440">i</span><span class="op" id="7262441">]</span>&nbsp;<span class="op" id="7262443">!=</span>&nbsp;<span class="ident" id="7262446">raw</span><span class="op" id="7262449">[</span><span class="ident" id="7262450">i</span><span class="op" id="7262451">]</span>&nbsp;<span class="op" id="7262453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262459">break</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7262468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7262472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262476">t</span><span class="op" id="7262477">.</span><span class="ident" id="7262478">Errorf</span><span class="op" id="7262484">(</span><span class="string" id="7262485">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="7262537">,</span>&nbsp;<span class="ident" id="7262539">n</span><span class="op" id="7262540">,</span>&nbsp;<span class="ident" id="7262542">i</span><span class="op" id="7262543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7262546">}</span><br>
<span class="lineno"></span><span class="op" id="7262548">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="7262551">func</span>&nbsp;<span class="ident" id="7262556">TestDecoderInternalWhitespace</span><span class="op" id="7262585">(</span><span class="ident" id="7262586">t</span>&nbsp;<span class="op" id="7262588">*</span><span class="ident" id="7262589">testing</span><span class="op" id="7262596">.</span><span class="ident" id="7262597">T</span><span class="op" id="7262598">)</span>&nbsp;<span class="op" id="7262600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262603">s</span>&nbsp;<span class="op" id="7262605">:=</span>&nbsp;<span class="ident" id="7262608">strings</span><span class="op" id="7262615">.</span><span class="ident" id="7262616">Repeat</span><span class="op" id="7262622">(</span><span class="string" id="7262623">&#34;&nbsp;&#34;</span><span class="op" id="7262626">,</span>&nbsp;<span class="num" id="7262628">2048</span><span class="op" id="7262632">)</span>&nbsp;<span class="op" id="7262634">+</span>&nbsp;<span class="string" id="7262636">&#34;z&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262641">decoded</span><span class="op" id="7262648">,</span>&nbsp;<span class="ident" id="7262650">err</span>&nbsp;<span class="op" id="7262654">:=</span>&nbsp;<span class="ident" id="7262657">ioutil</span><span class="op" id="7262663">.</span><span class="ident" id="7262664">ReadAll</span><span class="op" id="7262671">(</span><span class="ident" id="7262672">NewDecoder</span><span class="op" id="7262682">(</span><span class="ident" id="7262683">strings</span><span class="op" id="7262690">.</span><span class="ident" id="7262691">NewReader</span><span class="op" id="7262700">(</span><span class="ident" id="7262701">s</span><span class="op" id="7262702">)</span><span class="op" id="7262703">)</span><span class="op" id="7262704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262707">if</span>&nbsp;<span class="ident" id="7262710">err</span>&nbsp;<span class="op" id="7262714">!=</span>&nbsp;<span class="ident" id="7262717">nil</span>&nbsp;<span class="op" id="7262721">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262725">t</span><span class="op" id="7262726">.</span><span class="ident" id="7262727">Errorf</span><span class="op" id="7262733">(</span><span class="string" id="7262734">&#34;Decode&nbsp;gave&nbsp;error&nbsp;%v&#34;</span><span class="op" id="7262756">,</span>&nbsp;<span class="ident" id="7262758">err</span><span class="op" id="7262761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7262764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262767">if</span>&nbsp;<span class="ident" id="7262770">want</span>&nbsp;<span class="op" id="7262775">:=</span>&nbsp;<span class="op" id="7262778">[</span><span class="op" id="7262779">]</span><span class="builtintype" id="7262780">byte</span><span class="op" id="7262784">(</span><span class="string" id="7262785">&#34;\000\000\000\000&#34;</span><span class="op" id="7262803">)</span><span class="op" id="7262804">;</span>&nbsp;<span class="op" id="7262806">!</span><span class="ident" id="7262807">bytes</span><span class="op" id="7262812">.</span><span class="ident" id="7262813">Equal</span><span class="op" id="7262818">(</span><span class="ident" id="7262819">want</span><span class="op" id="7262823">,</span>&nbsp;<span class="ident" id="7262825">decoded</span><span class="op" id="7262832">)</span>&nbsp;<span class="op" id="7262834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262838">t</span><span class="op" id="7262839">.</span><span class="ident" id="7262840">Errorf</span><span class="op" id="7262846">(</span><span class="string" id="7262847">&#34;Decode&nbsp;failed:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7262879">,</span>&nbsp;<span class="ident" id="7262881">decoded</span><span class="op" id="7262888">,</span>&nbsp;<span class="ident" id="7262890">want</span><span class="op" id="7262894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7262897">}</span><br>
<span class="lineno">210</span><span class="op" id="7262899">}</span>
</div>
</body>
</html>
