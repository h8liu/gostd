<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7707927">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7707982">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7708036">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7708087">package</span>&nbsp;<span class="ident" id="7708095">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7708102">import</span>&nbsp;<span class="op" id="7708109">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7708112">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7708125">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7708131">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7708142">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7708152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7708155">func</span>&nbsp;<span class="ident" id="7708160">TestWriteHeapDumpNonempty</span><span class="op" id="7708185">(</span><span class="ident" id="7708186">t</span>&nbsp;<span class="op" id="7708188">*</span><span class="ident" id="7708189">testing</span><span class="op" id="7708196">.</span><span class="ident" id="7708197">T</span><span class="op" id="7708198">)</span>&nbsp;<span class="op" id="7708200">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708203">if</span>&nbsp;<span class="ident" id="7708206">runtime</span><span class="op" id="7708213">.</span><span class="ident" id="7708214">GOOS</span>&nbsp;<span class="op" id="7708219">==</span>&nbsp;<span class="string" id="7708222">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7708229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708233">t</span><span class="op" id="7708234">.</span><span class="ident" id="7708235">Skip</span><span class="op" id="7708239">(</span><span class="string" id="7708240">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="7708281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708287">f</span><span class="op" id="7708288">,</span>&nbsp;<span class="ident" id="7708290">err</span>&nbsp;<span class="op" id="7708294">:=</span>&nbsp;<span class="ident" id="7708297">ioutil</span><span class="op" id="7708303">.</span><span class="ident" id="7708304">TempFile</span><span class="op" id="7708312">(</span><span class="string" id="7708313">&#34;&#34;</span><span class="op" id="7708315">,</span>&nbsp;<span class="string" id="7708317">&#34;heapdumptest&#34;</span><span class="op" id="7708331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708334">if</span>&nbsp;<span class="ident" id="7708337">err</span>&nbsp;<span class="op" id="7708341">!=</span>&nbsp;<span class="ident" id="7708344">nil</span>&nbsp;<span class="op" id="7708348">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708352">t</span><span class="op" id="7708353">.</span><span class="ident" id="7708354">Fatalf</span><span class="op" id="7708360">(</span><span class="string" id="7708361">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7708382">,</span>&nbsp;<span class="ident" id="7708384">err</span><span class="op" id="7708387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708393">defer</span>&nbsp;<span class="ident" id="7708399">os</span><span class="op" id="7708401">.</span><span class="ident" id="7708402">Remove</span><span class="op" id="7708408">(</span><span class="ident" id="7708409">f</span><span class="op" id="7708410">.</span><span class="ident" id="7708411">Name</span><span class="op" id="7708415">(</span><span class="op" id="7708416">)</span><span class="op" id="7708417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708420">defer</span>&nbsp;<span class="ident" id="7708426">f</span><span class="op" id="7708427">.</span><span class="ident" id="7708428">Close</span><span class="op" id="7708433">(</span><span class="op" id="7708434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708437">WriteHeapDump</span><span class="op" id="7708450">(</span><span class="ident" id="7708451">f</span><span class="op" id="7708452">.</span><span class="ident" id="7708453">Fd</span><span class="op" id="7708455">(</span><span class="op" id="7708456">)</span><span class="op" id="7708457">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708460">fi</span><span class="op" id="7708462">,</span>&nbsp;<span class="ident" id="7708464">err</span>&nbsp;<span class="op" id="7708468">:=</span>&nbsp;<span class="ident" id="7708471">f</span><span class="op" id="7708472">.</span><span class="ident" id="7708473">Stat</span><span class="op" id="7708477">(</span><span class="op" id="7708478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708481">if</span>&nbsp;<span class="ident" id="7708484">err</span>&nbsp;<span class="op" id="7708488">!=</span>&nbsp;<span class="ident" id="7708491">nil</span>&nbsp;<span class="op" id="7708495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708499">t</span><span class="op" id="7708500">.</span><span class="ident" id="7708501">Fatalf</span><span class="op" id="7708507">(</span><span class="string" id="7708508">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7708525">,</span>&nbsp;<span class="ident" id="7708527">err</span><span class="op" id="7708530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708536">const</span>&nbsp;<span class="ident" id="7708542">minSize</span>&nbsp;<span class="op" id="7708550">=</span>&nbsp;<span class="num" id="7708552">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708555">if</span>&nbsp;<span class="ident" id="7708558">size</span>&nbsp;<span class="op" id="7708563">:=</span>&nbsp;<span class="ident" id="7708566">fi</span><span class="op" id="7708568">.</span><span class="ident" id="7708569">Size</span><span class="op" id="7708573">(</span><span class="op" id="7708574">)</span><span class="op" id="7708575">;</span>&nbsp;<span class="ident" id="7708577">size</span>&nbsp;<span class="op" id="7708582">&lt;</span>&nbsp;<span class="ident" id="7708584">minSize</span>&nbsp;<span class="op" id="7708592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708596">t</span><span class="op" id="7708597">.</span><span class="ident" id="7708598">Fatalf</span><span class="op" id="7708604">(</span><span class="string" id="7708605">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7708658">,</span>&nbsp;<span class="ident" id="7708660">size</span><span class="op" id="7708664">,</span>&nbsp;<span class="ident" id="7708666">minSize</span><span class="op" id="7708673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708676">}</span><br>
<span class="lineno"></span><span class="op" id="7708678">}</span>
</div>
</body>
</html>
