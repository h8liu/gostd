<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html" class="current">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7358685">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7358740">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7358794">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7358845">package</span>&nbsp;<span class="ident" id="7358853">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7358866">import</span>&nbsp;<span class="op" id="7358873">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7358876">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7358885">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7358898">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7358908">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7358916">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7358927">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7358937">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7358940">type</span>&nbsp;<span class="ident" id="7358945">testCase</span>&nbsp;<span class="keyword" id="7358954">struct</span>&nbsp;<span class="op" id="7358961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7358964">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7358973">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7358982">//&nbsp;name&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7359004">source</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7359013">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7359022">//&nbsp;source&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7359042">patterns</span>&nbsp;<span class="op" id="7359051">[</span><span class="op" id="7359052">]</span><span class="builtintype" id="7359053">string</span>&nbsp;<span class="comment" id="7359060">//&nbsp;patterns&nbsp;to&nbsp;lookup</span><br>
<span class="lineno">20</span><span class="op" id="7359082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7359085">var</span>&nbsp;<span class="ident" id="7359089">testCases</span>&nbsp;<span class="op" id="7359099">=</span>&nbsp;<span class="op" id="7359101">[</span><span class="op" id="7359102">]</span><span class="ident" id="7359103">testCase</span><span class="op" id="7359111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359118">&#34;empty&nbsp;string&#34;</span><span class="op" id="7359132">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359136">&#34;&#34;</span><span class="op" id="7359138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359142">[</span><span class="op" id="7359143">]</span><span class="builtintype" id="7359144">string</span><span class="op" id="7359150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359155">&#34;&#34;</span><span class="op" id="7359157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359162">&#34;foo&#34;</span><span class="op" id="7359167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359172">&#34;(foo)&#34;</span><span class="op" id="7359179">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359184">&#34;.*&#34;</span><span class="op" id="7359188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359193">&#34;a*&#34;</span><span class="op" id="7359197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359201">}</span><span class="op" id="7359202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359205">}</span><span class="op" id="7359206">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359214">&#34;all&nbsp;a&#39;s&#34;</span><span class="op" id="7359223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359227">&#34;aaaaaaaaaa&#34;</span><span class="op" id="7359239">,</span>&nbsp;<span class="comment" id="7359241">//&nbsp;10&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359253">[</span><span class="op" id="7359254">]</span><span class="builtintype" id="7359255">string</span><span class="op" id="7359261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359266">&#34;&#34;</span><span class="op" id="7359268">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359273">&#34;a&#34;</span><span class="op" id="7359276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359281">&#34;aa&#34;</span><span class="op" id="7359285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359290">&#34;aaa&#34;</span><span class="op" id="7359295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359300">&#34;aaaa&#34;</span><span class="op" id="7359306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359311">&#34;aaaaa&#34;</span><span class="op" id="7359318">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359323">&#34;aaaaaa&#34;</span><span class="op" id="7359331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359336">&#34;aaaaaaa&#34;</span><span class="op" id="7359345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359350">&#34;aaaaaaaa&#34;</span><span class="op" id="7359360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359365">&#34;aaaaaaaaa&#34;</span><span class="op" id="7359376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359381">&#34;aaaaaaaaaa&#34;</span><span class="op" id="7359393">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359398">&#34;aaaaaaaaaaa&#34;</span><span class="op" id="7359411">,</span>&nbsp;<span class="comment" id="7359413">//&nbsp;11&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359426">&#34;.&#34;</span><span class="op" id="7359429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359434">&#34;.*&#34;</span><span class="op" id="7359438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359443">&#34;a+&#34;</span><span class="op" id="7359447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359452">&#34;aa+&#34;</span><span class="op" id="7359457">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359462">&#34;aaaa[b]?&#34;</span><span class="op" id="7359472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359477">&#34;aaa*&#34;</span><span class="op" id="7359483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359487">}</span><span class="op" id="7359488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359491">}</span><span class="op" id="7359492">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359500">&#34;abc&#34;</span><span class="op" id="7359505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359509">&#34;abc&#34;</span><span class="op" id="7359514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359518">[</span><span class="op" id="7359519">]</span><span class="builtintype" id="7359520">string</span><span class="op" id="7359526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359531">&#34;a&#34;</span><span class="op" id="7359534">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359539">&#34;b&#34;</span><span class="op" id="7359542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359547">&#34;c&#34;</span><span class="op" id="7359550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359555">&#34;ab&#34;</span><span class="op" id="7359559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359564">&#34;bc&#34;</span><span class="op" id="7359568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359573">&#34;abc&#34;</span><span class="op" id="7359578">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359583">&#34;a.c&#34;</span><span class="op" id="7359588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359593">&#34;a(b|c)&#34;</span><span class="op" id="7359601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359606">&#34;abc?&#34;</span><span class="op" id="7359612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359616">}</span><span class="op" id="7359617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359620">}</span><span class="op" id="7359621">,</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359629">&#34;barbara*3&#34;</span><span class="op" id="7359640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359644">&#34;barbarabarbarabarbara&#34;</span><span class="op" id="7359667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359671">[</span><span class="op" id="7359672">]</span><span class="builtintype" id="7359673">string</span><span class="op" id="7359679">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359684">&#34;a&#34;</span><span class="op" id="7359687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359692">&#34;bar&#34;</span><span class="op" id="7359697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359702">&#34;rab&#34;</span><span class="op" id="7359707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359712">&#34;arab&#34;</span><span class="op" id="7359718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359723">&#34;barbar&#34;</span><span class="op" id="7359731">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359736">&#34;bara?bar&#34;</span><span class="op" id="7359746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359750">}</span><span class="op" id="7359751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359754">}</span><span class="op" id="7359755">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359759">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359763">&#34;typing&nbsp;drill&#34;</span><span class="op" id="7359777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359781">&#34;Now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&nbsp;country.&#34;</span><span class="op" id="7359852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359856">[</span><span class="op" id="7359857">]</span><span class="builtintype" id="7359858">string</span><span class="op" id="7359864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359869">&#34;Now&#34;</span><span class="op" id="7359874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359879">&#34;the&nbsp;time&#34;</span><span class="op" id="7359889">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359894">&#34;to&nbsp;come&nbsp;the&nbsp;aid&#34;</span><span class="op" id="7359911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359916">&#34;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&#34;</span><span class="op" id="7359974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7359979">&#34;to&nbsp;(come|the)?&#34;</span><span class="op" id="7359995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7359999">}</span><span class="op" id="7360000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7360003">}</span><span class="op" id="7360004">,</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7360008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7360012">&#34;godoc&nbsp;simulation&#34;</span><span class="op" id="7360030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7360034">&#34;package&nbsp;main\n\nimport(\n&nbsp;&nbsp;&nbsp;&nbsp;\&#34;rand\&#34;\n&nbsp;&nbsp;&nbsp;&nbsp;&#34;</span><span class="op" id="7360079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7360083">[</span><span class="op" id="7360084">]</span><span class="builtintype" id="7360085">string</span><span class="op" id="7360091">{</span><span class="op" id="7360092">}</span><span class="op" id="7360093">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7360096">}</span><span class="op" id="7360097">,</span><br>
<span class="lineno"></span><span class="op" id="7360099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7360102">//&nbsp;find&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;source;&nbsp;report&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences</span><br>
<span class="lineno"></span><span class="keyword" id="7360171">func</span>&nbsp;<span class="ident" id="7360176">find</span><span class="op" id="7360180">(</span><span class="ident" id="7360181">src</span><span class="op" id="7360184">,</span>&nbsp;<span class="ident" id="7360186">s</span>&nbsp;<span class="builtintype" id="7360188">string</span><span class="op" id="7360194">,</span>&nbsp;<span class="ident" id="7360196">n</span>&nbsp;<span class="builtintype" id="7360198">int</span><span class="op" id="7360201">)</span>&nbsp;<span class="op" id="7360203">[</span><span class="op" id="7360204">]</span><span class="builtintype" id="7360205">int</span>&nbsp;<span class="op" id="7360209">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7360212">var</span>&nbsp;<span class="ident" id="7360216">res</span>&nbsp;<span class="op" id="7360220">[</span><span class="op" id="7360221">]</span><span class="builtintype" id="7360222">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7360227">if</span>&nbsp;<span class="ident" id="7360230">s</span>&nbsp;<span class="op" id="7360232">!=</span>&nbsp;<span class="string" id="7360235">&#34;&#34;</span>&nbsp;<span class="op" id="7360238">&amp;&amp;</span>&nbsp;<span class="ident" id="7360241">n</span>&nbsp;<span class="op" id="7360243">!=</span>&nbsp;<span class="num" id="7360246">0</span>&nbsp;<span class="op" id="7360248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7360252">//&nbsp;find&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7360296">for</span>&nbsp;<span class="ident" id="7360300">i</span>&nbsp;<span class="op" id="7360302">:=</span>&nbsp;<span class="op" id="7360305">-</span><span class="num" id="7360306">1</span><span class="op" id="7360307">;</span>&nbsp;<span class="ident" id="7360309">n</span>&nbsp;<span class="op" id="7360311">&lt;</span>&nbsp;<span class="num" id="7360313">0</span>&nbsp;<span class="op" id="7360315">||</span>&nbsp;<span class="builtinfunc" id="7360318">len</span><span class="op" id="7360321">(</span><span class="ident" id="7360322">res</span><span class="op" id="7360325">)</span>&nbsp;<span class="op" id="7360327">&lt;</span>&nbsp;<span class="ident" id="7360329">n</span><span class="op" id="7360330">;</span>&nbsp;<span class="op" id="7360332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7360337">j</span>&nbsp;<span class="op" id="7360339">:=</span>&nbsp;<span class="ident" id="7360342">strings</span><span class="op" id="7360349">.</span><span class="ident" id="7360350">Index</span><span class="op" id="7360355">(</span><span class="ident" id="7360356">src</span><span class="op" id="7360359">[</span><span class="ident" id="7360360">i</span><span class="op" id="7360361">+</span><span class="num" id="7360362">1</span><span class="op" id="7360363">:</span><span class="op" id="7360364">]</span><span class="op" id="7360365">,</span>&nbsp;<span class="ident" id="7360367">s</span><span class="op" id="7360368">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7360373">if</span>&nbsp;<span class="ident" id="7360376">j</span>&nbsp;<span class="op" id="7360378">&lt;</span>&nbsp;<span class="num" id="7360380">0</span>&nbsp;<span class="op" id="7360382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7360388">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7360397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7360402">i</span>&nbsp;<span class="op" id="7360404">+=</span>&nbsp;<span class="ident" id="7360407">j</span>&nbsp;<span class="op" id="7360409">+</span>&nbsp;<span class="num" id="7360411">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7360416">res</span>&nbsp;<span class="op" id="7360420">=</span>&nbsp;<span class="builtinfunc" id="7360422">append</span><span class="op" id="7360428">(</span><span class="ident" id="7360429">res</span><span class="op" id="7360432">,</span>&nbsp;<span class="ident" id="7360434">i</span><span class="op" id="7360435">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7360439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7360442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7360445">return</span>&nbsp;<span class="ident" id="7360452">res</span><br>
<span class="lineno"></span><span class="op" id="7360456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="7360459">func</span>&nbsp;<span class="ident" id="7360464">testLookup</span><span class="op" id="7360474">(</span><span class="ident" id="7360475">t</span>&nbsp;<span class="op" id="7360477">*</span><span class="ident" id="7360478">testing</span><span class="op" id="7360485">.</span><span class="ident" id="7360486">T</span><span class="op" id="7360487">,</span>&nbsp;<span class="ident" id="7360489">tc</span>&nbsp;<span class="op" id="7360492">*</span><span class="ident" id="7360493">testCase</span><span class="op" id="7360501">,</span>&nbsp;<span class="ident" id="7360503">x</span>&nbsp;<span class="op" id="7360505">*</span><span class="ident" id="7360506">Index</span><span class="op" id="7360511">,</span>&nbsp;<span class="ident" id="7360513">s</span>&nbsp;<span class="builtintype" id="7360515">string</span><span class="op" id="7360521">,</span>&nbsp;<span class="ident" id="7360523">n</span>&nbsp;<span class="builtintype" id="7360525">int</span><span class="op" id="7360528">)</span>&nbsp;<span class="op" id="7360530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7360533">res</span>&nbsp;<span class="op" id="7360537">:=</span>&nbsp;<span class="ident" id="7360540">x</span><span class="op" id="7360541">.</span><span class="ident" id="7360542">Lookup</span><span class="op" id="7360548">(</span><span class="op" id="7360549">[</span><span class="op" id="7360550">]</span><span class="builtintype" id="7360551">byte</span><span class="op" id="7360555">(</span><span class="ident" id="7360556">s</span><span class="op" id="7360557">)</span><span class="op" id="7360558">,</span>&nbsp;<span class="ident" id="7360560">n</span><span class="op" id="7360561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7360564">exp</span>&nbsp;<span class="op" id="7360568">:=</span>&nbsp;<span class="ident" id="7360571">find</span><span class="op" id="7360575">(</span><span class="ident" id="7360576">tc</span><span class="op" id="7360578">.</span><span class="ident" id="7360579">source</span><span class="op" id="7360585">,</span>&nbsp;<span class="ident" id="7360587">s</span><span class="op" id="7360588">,</span>&nbsp;<span class="ident" id="7360590">n</span><span class="op" id="7360591">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7360595">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7360628">if</span>&nbsp;<span class="builtinfunc" id="7360631">len</span><span class="op" id="7360634">(</span><span class="ident" id="7360635">res</span><span class="op" id="7360638">)</span>&nbsp;<span class="op" id="7360640">!=</span>&nbsp;<span class="builtinfunc" id="7360643">len</span><span class="op" id="7360646">(</span><span class="ident" id="7360647">exp</span><span class="op" id="7360650">)</span>&nbsp;<span class="op" id="7360652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7360656">t</span><span class="op" id="7360657">.</span><span class="ident" id="7360658">Errorf</span><span class="op" id="7360664">(</span><span class="string" id="7360665">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7360723">,</span>&nbsp;<span class="ident" id="7360725">tc</span><span class="op" id="7360727">.</span><span class="ident" id="7360728">name</span><span class="op" id="7360732">,</span>&nbsp;<span class="ident" id="7360734">s</span><span class="op" id="7360735">,</span>&nbsp;<span class="ident" id="7360737">n</span><span class="op" id="7360738">,</span>&nbsp;<span class="builtinfunc" id="7360740">len</span><span class="op" id="7360743">(</span><span class="ident" id="7360744">exp</span><span class="op" id="7360747">)</span><span class="op" id="7360748">,</span>&nbsp;<span class="builtinfunc" id="7360750">len</span><span class="op" id="7360753">(</span><span class="ident" id="7360754">res</span><span class="op" id="7360757">)</span><span class="op" id="7360758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7360761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7360765">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7360841">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;find&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7360917">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;find)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7360993">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7361058">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;duplicates</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7361140">sort</span><span class="op" id="7361144">.</span><span class="ident" id="7361145">Ints</span><span class="op" id="7361149">(</span><span class="ident" id="7361150">res</span><span class="op" id="7361153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7361156">for</span>&nbsp;<span class="ident" id="7361160">i</span><span class="op" id="7361161">,</span>&nbsp;<span class="ident" id="7361163">r</span>&nbsp;<span class="op" id="7361165">:=</span>&nbsp;<span class="keyword" id="7361168">range</span>&nbsp;<span class="ident" id="7361174">res</span>&nbsp;<span class="op" id="7361178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7361182">if</span>&nbsp;<span class="ident" id="7361185">r</span>&nbsp;<span class="op" id="7361187">&lt;</span>&nbsp;<span class="num" id="7361189">0</span>&nbsp;<span class="op" id="7361191">||</span>&nbsp;<span class="builtinfunc" id="7361194">len</span><span class="op" id="7361197">(</span><span class="ident" id="7361198">tc</span><span class="op" id="7361200">.</span><span class="ident" id="7361201">source</span><span class="op" id="7361207">)</span>&nbsp;<span class="op" id="7361209">&lt;=</span>&nbsp;<span class="ident" id="7361212">r</span>&nbsp;<span class="op" id="7361214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7361219">t</span><span class="op" id="7361220">.</span><span class="ident" id="7361221">Errorf</span><span class="op" id="7361227">(</span><span class="string" id="7361228">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&nbsp;[0,&nbsp;%d[&#34;</span><span class="op" id="7361299">,</span>&nbsp;<span class="ident" id="7361301">tc</span><span class="op" id="7361303">.</span><span class="ident" id="7361304">name</span><span class="op" id="7361308">,</span>&nbsp;<span class="ident" id="7361310">s</span><span class="op" id="7361311">,</span>&nbsp;<span class="ident" id="7361313">i</span><span class="op" id="7361314">,</span>&nbsp;<span class="ident" id="7361316">n</span><span class="op" id="7361317">,</span>&nbsp;<span class="ident" id="7361319">r</span><span class="op" id="7361320">,</span>&nbsp;<span class="builtinfunc" id="7361322">len</span><span class="op" id="7361325">(</span><span class="ident" id="7361326">tc</span><span class="op" id="7361328">.</span><span class="ident" id="7361329">source</span><span class="op" id="7361335">)</span><span class="op" id="7361336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7361340">}</span>&nbsp;<span class="keyword" id="7361342">else</span>&nbsp;<span class="keyword" id="7361347">if</span>&nbsp;<span class="op" id="7361350">!</span><span class="ident" id="7361351">strings</span><span class="op" id="7361358">.</span><span class="ident" id="7361359">HasPrefix</span><span class="op" id="7361368">(</span><span class="ident" id="7361369">tc</span><span class="op" id="7361371">.</span><span class="ident" id="7361372">source</span><span class="op" id="7361378">[</span><span class="ident" id="7361379">r</span><span class="op" id="7361380">:</span><span class="op" id="7361381">]</span><span class="op" id="7361382">,</span>&nbsp;<span class="ident" id="7361384">s</span><span class="op" id="7361385">)</span>&nbsp;<span class="op" id="7361387">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7361392">t</span><span class="op" id="7361393">.</span><span class="ident" id="7361394">Errorf</span><span class="op" id="7361400">(</span><span class="string" id="7361401">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="7361463">,</span>&nbsp;<span class="ident" id="7361465">tc</span><span class="op" id="7361467">.</span><span class="ident" id="7361468">name</span><span class="op" id="7361472">,</span>&nbsp;<span class="ident" id="7361474">s</span><span class="op" id="7361475">,</span>&nbsp;<span class="ident" id="7361477">i</span><span class="op" id="7361478">,</span>&nbsp;<span class="ident" id="7361480">n</span><span class="op" id="7361481">,</span>&nbsp;<span class="ident" id="7361483">r</span><span class="op" id="7361484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7361488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7361492">if</span>&nbsp;<span class="ident" id="7361495">i</span>&nbsp;<span class="op" id="7361497">&gt;</span>&nbsp;<span class="num" id="7361499">0</span>&nbsp;<span class="op" id="7361501">&amp;&amp;</span>&nbsp;<span class="ident" id="7361504">res</span><span class="op" id="7361507">[</span><span class="ident" id="7361508">i</span><span class="op" id="7361509">-</span><span class="num" id="7361510">1</span><span class="op" id="7361511">]</span>&nbsp;<span class="op" id="7361513">==</span>&nbsp;<span class="ident" id="7361516">r</span>&nbsp;<span class="op" id="7361518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7361523">t</span><span class="op" id="7361524">.</span><span class="ident" id="7361525">Errorf</span><span class="op" id="7361531">(</span><span class="string" id="7361532">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;found&nbsp;duplicate&nbsp;index&nbsp;%d&#34;</span><span class="op" id="7361598">,</span>&nbsp;<span class="ident" id="7361600">tc</span><span class="op" id="7361602">.</span><span class="ident" id="7361603">name</span><span class="op" id="7361607">,</span>&nbsp;<span class="ident" id="7361609">s</span><span class="op" id="7361610">,</span>&nbsp;<span class="ident" id="7361612">i</span><span class="op" id="7361613">,</span>&nbsp;<span class="ident" id="7361615">n</span><span class="op" id="7361616">,</span>&nbsp;<span class="ident" id="7361618">r</span><span class="op" id="7361619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7361623">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7361626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7361630">if</span>&nbsp;<span class="ident" id="7361633">n</span>&nbsp;<span class="op" id="7361635">&lt;</span>&nbsp;<span class="num" id="7361637">0</span>&nbsp;<span class="op" id="7361639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7361643">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7361704">for</span>&nbsp;<span class="ident" id="7361708">i</span><span class="op" id="7361709">,</span>&nbsp;<span class="ident" id="7361711">r</span>&nbsp;<span class="op" id="7361713">:=</span>&nbsp;<span class="keyword" id="7361716">range</span>&nbsp;<span class="ident" id="7361722">res</span>&nbsp;<span class="op" id="7361726">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7361731">e</span>&nbsp;<span class="op" id="7361733">:=</span>&nbsp;<span class="ident" id="7361736">exp</span><span class="op" id="7361739">[</span><span class="ident" id="7361740">i</span><span class="op" id="7361741">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7361746">if</span>&nbsp;<span class="ident" id="7361749">r</span>&nbsp;<span class="op" id="7361751">!=</span>&nbsp;<span class="ident" id="7361754">e</span>&nbsp;<span class="op" id="7361756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7361762">t</span><span class="op" id="7361763">.</span><span class="ident" id="7361764">Errorf</span><span class="op" id="7361770">(</span><span class="string" id="7361771">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;index&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7361829">,</span>&nbsp;<span class="ident" id="7361831">tc</span><span class="op" id="7361833">.</span><span class="ident" id="7361834">name</span><span class="op" id="7361838">,</span>&nbsp;<span class="ident" id="7361840">s</span><span class="op" id="7361841">,</span>&nbsp;<span class="ident" id="7361843">i</span><span class="op" id="7361844">,</span>&nbsp;<span class="ident" id="7361846">e</span><span class="op" id="7361847">,</span>&nbsp;<span class="ident" id="7361849">r</span><span class="op" id="7361850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7361855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7361859">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7361862">}</span><br>
<span class="lineno"></span><span class="op" id="7361864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7361867">func</span>&nbsp;<span class="ident" id="7361872">testFindAllIndex</span><span class="op" id="7361888">(</span><span class="ident" id="7361889">t</span>&nbsp;<span class="op" id="7361891">*</span><span class="ident" id="7361892">testing</span><span class="op" id="7361899">.</span><span class="ident" id="7361900">T</span><span class="op" id="7361901">,</span>&nbsp;<span class="ident" id="7361903">tc</span>&nbsp;<span class="op" id="7361906">*</span><span class="ident" id="7361907">testCase</span><span class="op" id="7361915">,</span>&nbsp;<span class="ident" id="7361917">x</span>&nbsp;<span class="op" id="7361919">*</span><span class="ident" id="7361920">Index</span><span class="op" id="7361925">,</span>&nbsp;<span class="ident" id="7361927">rx</span>&nbsp;<span class="op" id="7361930">*</span><span class="ident" id="7361931">regexp</span><span class="op" id="7361937">.</span><span class="ident" id="7361938">Regexp</span><span class="op" id="7361944">,</span>&nbsp;<span class="ident" id="7361946">n</span>&nbsp;<span class="builtintype" id="7361948">int</span><span class="op" id="7361951">)</span>&nbsp;<span class="op" id="7361953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7361956">res</span>&nbsp;<span class="op" id="7361960">:=</span>&nbsp;<span class="ident" id="7361963">x</span><span class="op" id="7361964">.</span><span class="ident" id="7361965">FindAllIndex</span><span class="op" id="7361977">(</span><span class="ident" id="7361978">rx</span><span class="op" id="7361980">,</span>&nbsp;<span class="ident" id="7361982">n</span><span class="op" id="7361983">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7361986">exp</span>&nbsp;<span class="op" id="7361990">:=</span>&nbsp;<span class="ident" id="7361993">rx</span><span class="op" id="7361995">.</span><span class="ident" id="7361996">FindAllStringIndex</span><span class="op" id="7362014">(</span><span class="ident" id="7362015">tc</span><span class="op" id="7362017">.</span><span class="ident" id="7362018">source</span><span class="op" id="7362024">,</span>&nbsp;<span class="ident" id="7362026">n</span><span class="op" id="7362027">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7362031">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7362064">if</span>&nbsp;<span class="builtinfunc" id="7362067">len</span><span class="op" id="7362070">(</span><span class="ident" id="7362071">res</span><span class="op" id="7362074">)</span>&nbsp;<span class="op" id="7362076">!=</span>&nbsp;<span class="builtinfunc" id="7362079">len</span><span class="op" id="7362082">(</span><span class="ident" id="7362083">exp</span><span class="op" id="7362086">)</span>&nbsp;<span class="op" id="7362088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7362092">t</span><span class="op" id="7362093">.</span><span class="ident" id="7362094">Errorf</span><span class="op" id="7362100">(</span><span class="string" id="7362101">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7362165">,</span>&nbsp;<span class="ident" id="7362167">tc</span><span class="op" id="7362169">.</span><span class="ident" id="7362170">name</span><span class="op" id="7362174">,</span>&nbsp;<span class="ident" id="7362176">rx</span><span class="op" id="7362178">,</span>&nbsp;<span class="ident" id="7362180">n</span><span class="op" id="7362181">,</span>&nbsp;<span class="builtinfunc" id="7362183">len</span><span class="op" id="7362186">(</span><span class="ident" id="7362187">exp</span><span class="op" id="7362190">)</span><span class="op" id="7362191">,</span>&nbsp;<span class="builtinfunc" id="7362193">len</span><span class="op" id="7362196">(</span><span class="ident" id="7362197">res</span><span class="op" id="7362200">)</span><span class="op" id="7362201">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7362204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7362208">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7362284">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;regexp&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7362362">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;regexp)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7362440">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7362505">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7362584">for</span>&nbsp;<span class="ident" id="7362588">i</span><span class="op" id="7362589">,</span>&nbsp;<span class="ident" id="7362591">r</span>&nbsp;<span class="op" id="7362593">:=</span>&nbsp;<span class="keyword" id="7362596">range</span>&nbsp;<span class="ident" id="7362602">res</span>&nbsp;<span class="op" id="7362606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7362610">if</span>&nbsp;<span class="ident" id="7362613">r</span><span class="op" id="7362614">[</span><span class="num" id="7362615">0</span><span class="op" id="7362616">]</span>&nbsp;<span class="op" id="7362618">&lt;</span>&nbsp;<span class="num" id="7362620">0</span>&nbsp;<span class="op" id="7362622">||</span>&nbsp;<span class="ident" id="7362625">r</span><span class="op" id="7362626">[</span><span class="num" id="7362627">0</span><span class="op" id="7362628">]</span>&nbsp;<span class="op" id="7362630">&gt;</span>&nbsp;<span class="ident" id="7362632">r</span><span class="op" id="7362633">[</span><span class="num" id="7362634">1</span><span class="op" id="7362635">]</span>&nbsp;<span class="op" id="7362637">||</span>&nbsp;<span class="builtinfunc" id="7362640">len</span><span class="op" id="7362643">(</span><span class="ident" id="7362644">tc</span><span class="op" id="7362646">.</span><span class="ident" id="7362647">source</span><span class="op" id="7362653">)</span>&nbsp;<span class="op" id="7362655">&lt;</span>&nbsp;<span class="ident" id="7362657">r</span><span class="op" id="7362658">[</span><span class="num" id="7362659">1</span><span class="op" id="7362660">]</span>&nbsp;<span class="op" id="7362662">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7362667">t</span><span class="op" id="7362668">.</span><span class="ident" id="7362669">Errorf</span><span class="op" id="7362675">(</span><span class="string" id="7362676">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;==&nbsp;%d):&nbsp;illegal&nbsp;match&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="7362747">,</span>&nbsp;<span class="ident" id="7362749">tc</span><span class="op" id="7362751">.</span><span class="ident" id="7362752">name</span><span class="op" id="7362756">,</span>&nbsp;<span class="ident" id="7362758">rx</span><span class="op" id="7362760">,</span>&nbsp;<span class="ident" id="7362762">i</span><span class="op" id="7362763">,</span>&nbsp;<span class="ident" id="7362765">n</span><span class="op" id="7362766">,</span>&nbsp;<span class="ident" id="7362768">r</span><span class="op" id="7362769">[</span><span class="num" id="7362770">0</span><span class="op" id="7362771">]</span><span class="op" id="7362772">,</span>&nbsp;<span class="ident" id="7362774">r</span><span class="op" id="7362775">[</span><span class="num" id="7362776">1</span><span class="op" id="7362777">]</span><span class="op" id="7362778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7362782">}</span>&nbsp;<span class="keyword" id="7362784">else</span>&nbsp;<span class="keyword" id="7362789">if</span>&nbsp;<span class="op" id="7362792">!</span><span class="ident" id="7362793">rx</span><span class="op" id="7362795">.</span><span class="ident" id="7362796">MatchString</span><span class="op" id="7362807">(</span><span class="ident" id="7362808">tc</span><span class="op" id="7362810">.</span><span class="ident" id="7362811">source</span><span class="op" id="7362817">[</span><span class="ident" id="7362818">r</span><span class="op" id="7362819">[</span><span class="num" id="7362820">0</span><span class="op" id="7362821">]</span><span class="op" id="7362822">:</span><span class="ident" id="7362823">r</span><span class="op" id="7362824">[</span><span class="num" id="7362825">1</span><span class="op" id="7362826">]</span><span class="op" id="7362827">]</span><span class="op" id="7362828">)</span>&nbsp;<span class="op" id="7362830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7362835">t</span><span class="op" id="7362836">.</span><span class="ident" id="7362837">Errorf</span><span class="op" id="7362843">(</span><span class="string" id="7362844">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;[%d,&nbsp;%d]&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="7362912">,</span>&nbsp;<span class="ident" id="7362914">tc</span><span class="op" id="7362916">.</span><span class="ident" id="7362917">name</span><span class="op" id="7362921">,</span>&nbsp;<span class="ident" id="7362923">rx</span><span class="op" id="7362925">,</span>&nbsp;<span class="ident" id="7362927">i</span><span class="op" id="7362928">,</span>&nbsp;<span class="ident" id="7362930">n</span><span class="op" id="7362931">,</span>&nbsp;<span class="ident" id="7362933">r</span><span class="op" id="7362934">[</span><span class="num" id="7362935">0</span><span class="op" id="7362936">]</span><span class="op" id="7362937">,</span>&nbsp;<span class="ident" id="7362939">r</span><span class="op" id="7362940">[</span><span class="num" id="7362941">1</span><span class="op" id="7362942">]</span><span class="op" id="7362943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7362947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7362950">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7362954">if</span>&nbsp;<span class="ident" id="7362957">n</span>&nbsp;<span class="op" id="7362959">&lt;</span>&nbsp;<span class="num" id="7362961">0</span>&nbsp;<span class="op" id="7362963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7362967">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7363028">for</span>&nbsp;<span class="ident" id="7363032">i</span><span class="op" id="7363033">,</span>&nbsp;<span class="ident" id="7363035">r</span>&nbsp;<span class="op" id="7363037">:=</span>&nbsp;<span class="keyword" id="7363040">range</span>&nbsp;<span class="ident" id="7363046">res</span>&nbsp;<span class="op" id="7363050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7363055">e</span>&nbsp;<span class="op" id="7363057">:=</span>&nbsp;<span class="ident" id="7363060">exp</span><span class="op" id="7363063">[</span><span class="ident" id="7363064">i</span><span class="op" id="7363065">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7363070">if</span>&nbsp;<span class="ident" id="7363073">r</span><span class="op" id="7363074">[</span><span class="num" id="7363075">0</span><span class="op" id="7363076">]</span>&nbsp;<span class="op" id="7363078">!=</span>&nbsp;<span class="ident" id="7363081">e</span><span class="op" id="7363082">[</span><span class="num" id="7363083">0</span><span class="op" id="7363084">]</span>&nbsp;<span class="op" id="7363086">||</span>&nbsp;<span class="ident" id="7363089">r</span><span class="op" id="7363090">[</span><span class="num" id="7363091">1</span><span class="op" id="7363092">]</span>&nbsp;<span class="op" id="7363094">!=</span>&nbsp;<span class="ident" id="7363097">e</span><span class="op" id="7363098">[</span><span class="num" id="7363099">1</span><span class="op" id="7363100">]</span>&nbsp;<span class="op" id="7363102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7363108">t</span><span class="op" id="7363109">.</span><span class="ident" id="7363110">Errorf</span><span class="op" id="7363116">(</span><span class="string" id="7363117">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;match&nbsp;[%d,&nbsp;%d];&nbsp;got&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="7363193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7363200">tc</span><span class="op" id="7363202">.</span><span class="ident" id="7363203">name</span><span class="op" id="7363207">,</span>&nbsp;<span class="ident" id="7363209">rx</span><span class="op" id="7363211">,</span>&nbsp;<span class="ident" id="7363213">i</span><span class="op" id="7363214">,</span>&nbsp;<span class="ident" id="7363216">e</span><span class="op" id="7363217">[</span><span class="num" id="7363218">0</span><span class="op" id="7363219">]</span><span class="op" id="7363220">,</span>&nbsp;<span class="ident" id="7363222">e</span><span class="op" id="7363223">[</span><span class="num" id="7363224">1</span><span class="op" id="7363225">]</span><span class="op" id="7363226">,</span>&nbsp;<span class="ident" id="7363228">r</span><span class="op" id="7363229">[</span><span class="num" id="7363230">0</span><span class="op" id="7363231">]</span><span class="op" id="7363232">,</span>&nbsp;<span class="ident" id="7363234">r</span><span class="op" id="7363235">[</span><span class="num" id="7363236">1</span><span class="op" id="7363237">]</span><span class="op" id="7363238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7363243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7363247">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7363250">}</span><br>
<span class="lineno"></span><span class="op" id="7363252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7363255">func</span>&nbsp;<span class="ident" id="7363260">testLookups</span><span class="op" id="7363271">(</span><span class="ident" id="7363272">t</span>&nbsp;<span class="op" id="7363274">*</span><span class="ident" id="7363275">testing</span><span class="op" id="7363282">.</span><span class="ident" id="7363283">T</span><span class="op" id="7363284">,</span>&nbsp;<span class="ident" id="7363286">tc</span>&nbsp;<span class="op" id="7363289">*</span><span class="ident" id="7363290">testCase</span><span class="op" id="7363298">,</span>&nbsp;<span class="ident" id="7363300">x</span>&nbsp;<span class="op" id="7363302">*</span><span class="ident" id="7363303">Index</span><span class="op" id="7363308">,</span>&nbsp;<span class="ident" id="7363310">n</span>&nbsp;<span class="builtintype" id="7363312">int</span><span class="op" id="7363315">)</span>&nbsp;<span class="op" id="7363317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7363320">for</span>&nbsp;<span class="ident" id="7363324">_</span><span class="op" id="7363325">,</span>&nbsp;<span class="ident" id="7363327">pat</span>&nbsp;<span class="op" id="7363331">:=</span>&nbsp;<span class="keyword" id="7363334">range</span>&nbsp;<span class="ident" id="7363340">tc</span><span class="op" id="7363342">.</span><span class="ident" id="7363343">patterns</span>&nbsp;<span class="op" id="7363352">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7363356">testLookup</span><span class="op" id="7363366">(</span><span class="ident" id="7363367">t</span><span class="op" id="7363368">,</span>&nbsp;<span class="ident" id="7363370">tc</span><span class="op" id="7363372">,</span>&nbsp;<span class="ident" id="7363374">x</span><span class="op" id="7363375">,</span>&nbsp;<span class="ident" id="7363377">pat</span><span class="op" id="7363380">,</span>&nbsp;<span class="ident" id="7363382">n</span><span class="op" id="7363383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7363387">if</span>&nbsp;<span class="ident" id="7363390">rx</span><span class="op" id="7363392">,</span>&nbsp;<span class="ident" id="7363394">err</span>&nbsp;<span class="op" id="7363398">:=</span>&nbsp;<span class="ident" id="7363401">regexp</span><span class="op" id="7363407">.</span><span class="ident" id="7363408">Compile</span><span class="op" id="7363415">(</span><span class="ident" id="7363416">pat</span><span class="op" id="7363419">)</span><span class="op" id="7363420">;</span>&nbsp;<span class="ident" id="7363422">err</span>&nbsp;<span class="op" id="7363426">==</span>&nbsp;<span class="builtintype" id="7363429">nil</span>&nbsp;<span class="op" id="7363433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7363438">testFindAllIndex</span><span class="op" id="7363454">(</span><span class="ident" id="7363455">t</span><span class="op" id="7363456">,</span>&nbsp;<span class="ident" id="7363458">tc</span><span class="op" id="7363460">,</span>&nbsp;<span class="ident" id="7363462">x</span><span class="op" id="7363463">,</span>&nbsp;<span class="ident" id="7363465">rx</span><span class="op" id="7363467">,</span>&nbsp;<span class="ident" id="7363469">n</span><span class="op" id="7363470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7363474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7363477">}</span><br>
<span class="lineno">205</span><span class="op" id="7363479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7363482">//&nbsp;index&nbsp;is&nbsp;used&nbsp;to&nbsp;hide&nbsp;the&nbsp;sort.Interface</span><br>
<span class="lineno"></span><span class="keyword" id="7363526">type</span>&nbsp;<span class="ident" id="7363531">index</span>&nbsp;<span class="ident" id="7363537">Index</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="7363544">func</span>&nbsp;<span class="op" id="7363549">(</span><span class="ident" id="7363550">x</span>&nbsp;<span class="op" id="7363552">*</span><span class="ident" id="7363553">index</span><span class="op" id="7363558">)</span>&nbsp;<span class="ident" id="7363560">Len</span><span class="op" id="7363563">(</span><span class="op" id="7363564">)</span>&nbsp;<span class="builtintype" id="7363566">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7363580">{</span>&nbsp;<span class="keyword" id="7363582">return</span>&nbsp;<span class="builtinfunc" id="7363589">len</span><span class="op" id="7363592">(</span><span class="ident" id="7363593">x</span><span class="op" id="7363594">.</span><span class="ident" id="7363595">sa</span><span class="op" id="7363597">)</span>&nbsp;<span class="op" id="7363599">}</span><br>
<span class="lineno"></span><span class="keyword" id="7363601">func</span>&nbsp;<span class="op" id="7363606">(</span><span class="ident" id="7363607">x</span>&nbsp;<span class="op" id="7363609">*</span><span class="ident" id="7363610">index</span><span class="op" id="7363615">)</span>&nbsp;<span class="ident" id="7363617">Less</span><span class="op" id="7363621">(</span><span class="ident" id="7363622">i</span><span class="op" id="7363623">,</span>&nbsp;<span class="ident" id="7363625">j</span>&nbsp;<span class="builtintype" id="7363627">int</span><span class="op" id="7363630">)</span>&nbsp;<span class="builtintype" id="7363632">bool</span>&nbsp;<span class="op" id="7363637">{</span>&nbsp;<span class="keyword" id="7363639">return</span>&nbsp;<span class="ident" id="7363646">bytes</span><span class="op" id="7363651">.</span><span class="ident" id="7363652">Compare</span><span class="op" id="7363659">(</span><span class="ident" id="7363660">x</span><span class="op" id="7363661">.</span><span class="ident" id="7363662">at</span><span class="op" id="7363664">(</span><span class="ident" id="7363665">i</span><span class="op" id="7363666">)</span><span class="op" id="7363667">,</span>&nbsp;<span class="ident" id="7363669">x</span><span class="op" id="7363670">.</span><span class="ident" id="7363671">at</span><span class="op" id="7363673">(</span><span class="ident" id="7363674">j</span><span class="op" id="7363675">)</span><span class="op" id="7363676">)</span>&nbsp;<span class="op" id="7363678">&lt;</span>&nbsp;<span class="num" id="7363680">0</span>&nbsp;<span class="op" id="7363682">}</span><br>
<span class="lineno"></span><span class="keyword" id="7363684">func</span>&nbsp;<span class="op" id="7363689">(</span><span class="ident" id="7363690">x</span>&nbsp;<span class="op" id="7363692">*</span><span class="ident" id="7363693">index</span><span class="op" id="7363698">)</span>&nbsp;<span class="ident" id="7363700">Swap</span><span class="op" id="7363704">(</span><span class="ident" id="7363705">i</span><span class="op" id="7363706">,</span>&nbsp;<span class="ident" id="7363708">j</span>&nbsp;<span class="builtintype" id="7363710">int</span><span class="op" id="7363713">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7363720">{</span>&nbsp;<span class="ident" id="7363722">x</span><span class="op" id="7363723">.</span><span class="ident" id="7363724">sa</span><span class="op" id="7363726">[</span><span class="ident" id="7363727">i</span><span class="op" id="7363728">]</span><span class="op" id="7363729">,</span>&nbsp;<span class="ident" id="7363731">x</span><span class="op" id="7363732">.</span><span class="ident" id="7363733">sa</span><span class="op" id="7363735">[</span><span class="ident" id="7363736">j</span><span class="op" id="7363737">]</span>&nbsp;<span class="op" id="7363739">=</span>&nbsp;<span class="ident" id="7363741">x</span><span class="op" id="7363742">.</span><span class="ident" id="7363743">sa</span><span class="op" id="7363745">[</span><span class="ident" id="7363746">j</span><span class="op" id="7363747">]</span><span class="op" id="7363748">,</span>&nbsp;<span class="ident" id="7363750">x</span><span class="op" id="7363751">.</span><span class="ident" id="7363752">sa</span><span class="op" id="7363754">[</span><span class="ident" id="7363755">i</span><span class="op" id="7363756">]</span>&nbsp;<span class="op" id="7363758">}</span><br>
<span class="lineno"></span><span class="keyword" id="7363760">func</span>&nbsp;<span class="op" id="7363765">(</span><span class="ident" id="7363766">a</span>&nbsp;<span class="op" id="7363768">*</span><span class="ident" id="7363769">index</span><span class="op" id="7363774">)</span>&nbsp;<span class="ident" id="7363776">at</span><span class="op" id="7363778">(</span><span class="ident" id="7363779">i</span>&nbsp;<span class="builtintype" id="7363781">int</span><span class="op" id="7363784">)</span>&nbsp;<span class="op" id="7363786">[</span><span class="op" id="7363787">]</span><span class="builtintype" id="7363788">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7363796">{</span>&nbsp;<span class="keyword" id="7363798">return</span>&nbsp;<span class="ident" id="7363805">a</span><span class="op" id="7363806">.</span><span class="ident" id="7363807">data</span><span class="op" id="7363811">[</span><span class="ident" id="7363812">a</span><span class="op" id="7363813">.</span><span class="ident" id="7363814">sa</span><span class="op" id="7363816">[</span><span class="ident" id="7363817">i</span><span class="op" id="7363818">]</span><span class="op" id="7363819">:</span><span class="op" id="7363820">]</span>&nbsp;<span class="op" id="7363822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="7363825">func</span>&nbsp;<span class="ident" id="7363830">testConstruction</span><span class="op" id="7363846">(</span><span class="ident" id="7363847">t</span>&nbsp;<span class="op" id="7363849">*</span><span class="ident" id="7363850">testing</span><span class="op" id="7363857">.</span><span class="ident" id="7363858">T</span><span class="op" id="7363859">,</span>&nbsp;<span class="ident" id="7363861">tc</span>&nbsp;<span class="op" id="7363864">*</span><span class="ident" id="7363865">testCase</span><span class="op" id="7363873">,</span>&nbsp;<span class="ident" id="7363875">x</span>&nbsp;<span class="op" id="7363877">*</span><span class="ident" id="7363878">Index</span><span class="op" id="7363883">)</span>&nbsp;<span class="op" id="7363885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7363888">if</span>&nbsp;<span class="op" id="7363891">!</span><span class="ident" id="7363892">sort</span><span class="op" id="7363896">.</span><span class="ident" id="7363897">IsSorted</span><span class="op" id="7363905">(</span><span class="op" id="7363906">(</span><span class="op" id="7363907">*</span><span class="ident" id="7363908">index</span><span class="op" id="7363913">)</span><span class="op" id="7363914">(</span><span class="ident" id="7363915">x</span><span class="op" id="7363916">)</span><span class="op" id="7363917">)</span>&nbsp;<span class="op" id="7363919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7363923">t</span><span class="op" id="7363924">.</span><span class="ident" id="7363925">Errorf</span><span class="op" id="7363931">(</span><span class="string" id="7363932">&#34;failed&nbsp;testConstruction&nbsp;%s&#34;</span><span class="op" id="7363960">,</span>&nbsp;<span class="ident" id="7363962">tc</span><span class="op" id="7363964">.</span><span class="ident" id="7363965">name</span><span class="op" id="7363969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7363972">}</span><br>
<span class="lineno"></span><span class="op" id="7363974">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="7363977">func</span>&nbsp;<span class="ident" id="7363982">equal</span><span class="op" id="7363987">(</span><span class="ident" id="7363988">x</span><span class="op" id="7363989">,</span>&nbsp;<span class="ident" id="7363991">y</span>&nbsp;<span class="op" id="7363993">*</span><span class="ident" id="7363994">Index</span><span class="op" id="7363999">)</span>&nbsp;<span class="builtintype" id="7364001">bool</span>&nbsp;<span class="op" id="7364006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364009">if</span>&nbsp;<span class="op" id="7364012">!</span><span class="ident" id="7364013">bytes</span><span class="op" id="7364018">.</span><span class="ident" id="7364019">Equal</span><span class="op" id="7364024">(</span><span class="ident" id="7364025">x</span><span class="op" id="7364026">.</span><span class="ident" id="7364027">data</span><span class="op" id="7364031">,</span>&nbsp;<span class="ident" id="7364033">y</span><span class="op" id="7364034">.</span><span class="ident" id="7364035">data</span><span class="op" id="7364039">)</span>&nbsp;<span class="op" id="7364041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364045">return</span>&nbsp;<span class="builtintype" id="7364052">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7364059">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364062">for</span>&nbsp;<span class="ident" id="7364066">i</span><span class="op" id="7364067">,</span>&nbsp;<span class="ident" id="7364069">j</span>&nbsp;<span class="op" id="7364071">:=</span>&nbsp;<span class="keyword" id="7364074">range</span>&nbsp;<span class="ident" id="7364080">x</span><span class="op" id="7364081">.</span><span class="ident" id="7364082">sa</span>&nbsp;<span class="op" id="7364085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364089">if</span>&nbsp;<span class="ident" id="7364092">j</span>&nbsp;<span class="op" id="7364094">!=</span>&nbsp;<span class="ident" id="7364097">y</span><span class="op" id="7364098">.</span><span class="ident" id="7364099">sa</span><span class="op" id="7364101">[</span><span class="ident" id="7364102">i</span><span class="op" id="7364103">]</span>&nbsp;<span class="op" id="7364105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364110">return</span>&nbsp;<span class="builtintype" id="7364117">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7364125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7364128">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364131">return</span>&nbsp;<span class="builtintype" id="7364138">true</span><br>
<span class="lineno"></span><span class="op" id="7364143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7364146">//&nbsp;returns&nbsp;the&nbsp;serialized&nbsp;index&nbsp;size</span><br>
<span class="lineno"></span><span class="keyword" id="7364183">func</span>&nbsp;<span class="ident" id="7364188">testSaveRestore</span><span class="op" id="7364203">(</span><span class="ident" id="7364204">t</span>&nbsp;<span class="op" id="7364206">*</span><span class="ident" id="7364207">testing</span><span class="op" id="7364214">.</span><span class="ident" id="7364215">T</span><span class="op" id="7364216">,</span>&nbsp;<span class="ident" id="7364218">tc</span>&nbsp;<span class="op" id="7364221">*</span><span class="ident" id="7364222">testCase</span><span class="op" id="7364230">,</span>&nbsp;<span class="ident" id="7364232">x</span>&nbsp;<span class="op" id="7364234">*</span><span class="ident" id="7364235">Index</span><span class="op" id="7364240">)</span>&nbsp;<span class="builtintype" id="7364242">int</span>&nbsp;<span class="op" id="7364246">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364249">var</span>&nbsp;<span class="ident" id="7364253">buf</span>&nbsp;<span class="ident" id="7364257">bytes</span><span class="op" id="7364262">.</span><span class="ident" id="7364263">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364271">if</span>&nbsp;<span class="ident" id="7364274">err</span>&nbsp;<span class="op" id="7364278">:=</span>&nbsp;<span class="ident" id="7364281">x</span><span class="op" id="7364282">.</span><span class="ident" id="7364283">Write</span><span class="op" id="7364288">(</span><span class="op" id="7364289">&amp;</span><span class="ident" id="7364290">buf</span><span class="op" id="7364293">)</span><span class="op" id="7364294">;</span>&nbsp;<span class="ident" id="7364296">err</span>&nbsp;<span class="op" id="7364300">!=</span>&nbsp;<span class="builtintype" id="7364303">nil</span>&nbsp;<span class="op" id="7364307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364311">t</span><span class="op" id="7364312">.</span><span class="ident" id="7364313">Errorf</span><span class="op" id="7364319">(</span><span class="string" id="7364320">&#34;failed&nbsp;writing&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="7364350">,</span>&nbsp;<span class="ident" id="7364352">tc</span><span class="op" id="7364354">.</span><span class="ident" id="7364355">name</span><span class="op" id="7364359">,</span>&nbsp;<span class="ident" id="7364361">err</span><span class="op" id="7364364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7364367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364370">size</span>&nbsp;<span class="op" id="7364375">:=</span>&nbsp;<span class="ident" id="7364378">buf</span><span class="op" id="7364381">.</span><span class="ident" id="7364382">Len</span><span class="op" id="7364385">(</span><span class="op" id="7364386">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364389">var</span>&nbsp;<span class="ident" id="7364393">y</span>&nbsp;<span class="ident" id="7364395">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364402">if</span>&nbsp;<span class="ident" id="7364405">err</span>&nbsp;<span class="op" id="7364409">:=</span>&nbsp;<span class="ident" id="7364412">y</span><span class="op" id="7364413">.</span><span class="ident" id="7364414">Read</span><span class="op" id="7364418">(</span><span class="op" id="7364419">&amp;</span><span class="ident" id="7364420">buf</span><span class="op" id="7364423">)</span><span class="op" id="7364424">;</span>&nbsp;<span class="ident" id="7364426">err</span>&nbsp;<span class="op" id="7364430">!=</span>&nbsp;<span class="builtintype" id="7364433">nil</span>&nbsp;<span class="op" id="7364437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364441">t</span><span class="op" id="7364442">.</span><span class="ident" id="7364443">Errorf</span><span class="op" id="7364449">(</span><span class="string" id="7364450">&#34;failed&nbsp;reading&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="7364480">,</span>&nbsp;<span class="ident" id="7364482">tc</span><span class="op" id="7364484">.</span><span class="ident" id="7364485">name</span><span class="op" id="7364489">,</span>&nbsp;<span class="ident" id="7364491">err</span><span class="op" id="7364494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7364497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364500">if</span>&nbsp;<span class="op" id="7364503">!</span><span class="ident" id="7364504">equal</span><span class="op" id="7364509">(</span><span class="ident" id="7364510">x</span><span class="op" id="7364511">,</span>&nbsp;<span class="op" id="7364513">&amp;</span><span class="ident" id="7364514">y</span><span class="op" id="7364515">)</span>&nbsp;<span class="op" id="7364517">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364521">t</span><span class="op" id="7364522">.</span><span class="ident" id="7364523">Errorf</span><span class="op" id="7364529">(</span><span class="string" id="7364530">&#34;restored&nbsp;index&nbsp;doesn&#39;t&nbsp;match&nbsp;saved&nbsp;index&nbsp;%s&#34;</span><span class="op" id="7364575">,</span>&nbsp;<span class="ident" id="7364577">tc</span><span class="op" id="7364579">.</span><span class="ident" id="7364580">name</span><span class="op" id="7364584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7364587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364590">return</span>&nbsp;<span class="ident" id="7364597">size</span><br>
<span class="lineno"></span><span class="op" id="7364602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="7364605">func</span>&nbsp;<span class="ident" id="7364610">TestIndex</span><span class="op" id="7364619">(</span><span class="ident" id="7364620">t</span>&nbsp;<span class="op" id="7364622">*</span><span class="ident" id="7364623">testing</span><span class="op" id="7364630">.</span><span class="ident" id="7364631">T</span><span class="op" id="7364632">)</span>&nbsp;<span class="op" id="7364634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7364637">for</span>&nbsp;<span class="ident" id="7364641">_</span><span class="op" id="7364642">,</span>&nbsp;<span class="ident" id="7364644">tc</span>&nbsp;<span class="op" id="7364647">:=</span>&nbsp;<span class="keyword" id="7364650">range</span>&nbsp;<span class="ident" id="7364656">testCases</span>&nbsp;<span class="op" id="7364666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364670">x</span>&nbsp;<span class="op" id="7364672">:=</span>&nbsp;<span class="ident" id="7364675">New</span><span class="op" id="7364678">(</span><span class="op" id="7364679">[</span><span class="op" id="7364680">]</span><span class="builtintype" id="7364681">byte</span><span class="op" id="7364685">(</span><span class="ident" id="7364686">tc</span><span class="op" id="7364688">.</span><span class="ident" id="7364689">source</span><span class="op" id="7364695">)</span><span class="op" id="7364696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364700">testConstruction</span><span class="op" id="7364716">(</span><span class="ident" id="7364717">t</span><span class="op" id="7364718">,</span>&nbsp;<span class="op" id="7364720">&amp;</span><span class="ident" id="7364721">tc</span><span class="op" id="7364723">,</span>&nbsp;<span class="ident" id="7364725">x</span><span class="op" id="7364726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364730">testSaveRestore</span><span class="op" id="7364745">(</span><span class="ident" id="7364746">t</span><span class="op" id="7364747">,</span>&nbsp;<span class="op" id="7364749">&amp;</span><span class="ident" id="7364750">tc</span><span class="op" id="7364752">,</span>&nbsp;<span class="ident" id="7364754">x</span><span class="op" id="7364755">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364759">testLookups</span><span class="op" id="7364770">(</span><span class="ident" id="7364771">t</span><span class="op" id="7364772">,</span>&nbsp;<span class="op" id="7364774">&amp;</span><span class="ident" id="7364775">tc</span><span class="op" id="7364777">,</span>&nbsp;<span class="ident" id="7364779">x</span><span class="op" id="7364780">,</span>&nbsp;<span class="num" id="7364782">0</span><span class="op" id="7364783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364787">testLookups</span><span class="op" id="7364798">(</span><span class="ident" id="7364799">t</span><span class="op" id="7364800">,</span>&nbsp;<span class="op" id="7364802">&amp;</span><span class="ident" id="7364803">tc</span><span class="op" id="7364805">,</span>&nbsp;<span class="ident" id="7364807">x</span><span class="op" id="7364808">,</span>&nbsp;<span class="num" id="7364810">1</span><span class="op" id="7364811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364815">testLookups</span><span class="op" id="7364826">(</span><span class="ident" id="7364827">t</span><span class="op" id="7364828">,</span>&nbsp;<span class="op" id="7364830">&amp;</span><span class="ident" id="7364831">tc</span><span class="op" id="7364833">,</span>&nbsp;<span class="ident" id="7364835">x</span><span class="op" id="7364836">,</span>&nbsp;<span class="num" id="7364838">10</span><span class="op" id="7364840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364844">testLookups</span><span class="op" id="7364855">(</span><span class="ident" id="7364856">t</span><span class="op" id="7364857">,</span>&nbsp;<span class="op" id="7364859">&amp;</span><span class="ident" id="7364860">tc</span><span class="op" id="7364862">,</span>&nbsp;<span class="ident" id="7364864">x</span><span class="op" id="7364865">,</span>&nbsp;<span class="num" id="7364867">2e9</span><span class="op" id="7364870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7364874">testLookups</span><span class="op" id="7364885">(</span><span class="ident" id="7364886">t</span><span class="op" id="7364887">,</span>&nbsp;<span class="op" id="7364889">&amp;</span><span class="ident" id="7364890">tc</span><span class="op" id="7364892">,</span>&nbsp;<span class="ident" id="7364894">x</span><span class="op" id="7364895">,</span>&nbsp;<span class="op" id="7364897">-</span><span class="num" id="7364898">1</span><span class="op" id="7364899">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7364902">}</span><br>
<span class="lineno"></span><span class="op" id="7364904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7364907">//&nbsp;Of&nbsp;all&nbsp;possible&nbsp;inputs,&nbsp;the&nbsp;random&nbsp;bytes&nbsp;have&nbsp;the&nbsp;least&nbsp;amount&nbsp;of&nbsp;substring</span><br>
<span class="lineno"></span><span class="comment" id="7364986">//&nbsp;repetition,&nbsp;and&nbsp;the&nbsp;repeated&nbsp;bytes&nbsp;have&nbsp;the&nbsp;most.&nbsp;For&nbsp;most&nbsp;algorithms,</span><br>
<span class="lineno">265</span><span class="comment" id="7365060">//&nbsp;the&nbsp;running&nbsp;time&nbsp;of&nbsp;every&nbsp;input&nbsp;will&nbsp;be&nbsp;between&nbsp;these&nbsp;two.</span><br>
<span class="lineno"></span><span class="keyword" id="7365122">func</span>&nbsp;<span class="ident" id="7365127">benchmarkNew</span><span class="op" id="7365139">(</span><span class="ident" id="7365140">b</span>&nbsp;<span class="op" id="7365142">*</span><span class="ident" id="7365143">testing</span><span class="op" id="7365150">.</span><span class="ident" id="7365151">B</span><span class="op" id="7365152">,</span>&nbsp;<span class="ident" id="7365154">random</span>&nbsp;<span class="builtintype" id="7365161">bool</span><span class="op" id="7365165">)</span>&nbsp;<span class="op" id="7365167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365170">b</span><span class="op" id="7365171">.</span><span class="ident" id="7365172">StopTimer</span><span class="op" id="7365181">(</span><span class="op" id="7365182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365185">data</span>&nbsp;<span class="op" id="7365190">:=</span>&nbsp;<span class="builtinfunc" id="7365193">make</span><span class="op" id="7365197">(</span><span class="op" id="7365198">[</span><span class="op" id="7365199">]</span><span class="builtintype" id="7365200">byte</span><span class="op" id="7365204">,</span>&nbsp;<span class="num" id="7365206">1e6</span><span class="op" id="7365209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7365212">if</span>&nbsp;<span class="ident" id="7365215">random</span>&nbsp;<span class="op" id="7365222">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7365226">for</span>&nbsp;<span class="ident" id="7365230">i</span>&nbsp;<span class="op" id="7365232">:=</span>&nbsp;<span class="keyword" id="7365235">range</span>&nbsp;<span class="ident" id="7365241">data</span>&nbsp;<span class="op" id="7365246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365251">data</span><span class="op" id="7365255">[</span><span class="ident" id="7365256">i</span><span class="op" id="7365257">]</span>&nbsp;<span class="op" id="7365259">=</span>&nbsp;<span class="builtintype" id="7365261">byte</span><span class="op" id="7365265">(</span><span class="ident" id="7365266">rand</span><span class="op" id="7365270">.</span><span class="ident" id="7365271">Intn</span><span class="op" id="7365275">(</span><span class="num" id="7365276">256</span><span class="op" id="7365279">)</span><span class="op" id="7365280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7365284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7365287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365290">b</span><span class="op" id="7365291">.</span><span class="ident" id="7365292">StartTimer</span><span class="op" id="7365302">(</span><span class="op" id="7365303">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7365306">for</span>&nbsp;<span class="ident" id="7365310">i</span>&nbsp;<span class="op" id="7365312">:=</span>&nbsp;<span class="num" id="7365315">0</span><span class="op" id="7365316">;</span>&nbsp;<span class="ident" id="7365318">i</span>&nbsp;<span class="op" id="7365320">&lt;</span>&nbsp;<span class="ident" id="7365322">b</span><span class="op" id="7365323">.</span><span class="ident" id="7365324">N</span><span class="op" id="7365325">;</span>&nbsp;<span class="ident" id="7365327">i</span><span class="op" id="7365328">++</span>&nbsp;<span class="op" id="7365331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365335">New</span><span class="op" id="7365338">(</span><span class="ident" id="7365339">data</span><span class="op" id="7365343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7365346">}</span><br>
<span class="lineno"></span><span class="op" id="7365348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7365351">func</span>&nbsp;<span class="ident" id="7365356">BenchmarkNewIndexRandom</span><span class="op" id="7365379">(</span><span class="ident" id="7365380">b</span>&nbsp;<span class="op" id="7365382">*</span><span class="ident" id="7365383">testing</span><span class="op" id="7365390">.</span><span class="ident" id="7365391">B</span><span class="op" id="7365392">)</span>&nbsp;<span class="op" id="7365394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365397">benchmarkNew</span><span class="op" id="7365409">(</span><span class="ident" id="7365410">b</span><span class="op" id="7365411">,</span>&nbsp;<span class="builtintype" id="7365413">true</span><span class="op" id="7365417">)</span><br>
<span class="lineno"></span><span class="op" id="7365419">}</span><br>
<span class="lineno"></span><span class="keyword" id="7365421">func</span>&nbsp;<span class="ident" id="7365426">BenchmarkNewIndexRepeat</span><span class="op" id="7365449">(</span><span class="ident" id="7365450">b</span>&nbsp;<span class="op" id="7365452">*</span><span class="ident" id="7365453">testing</span><span class="op" id="7365460">.</span><span class="ident" id="7365461">B</span><span class="op" id="7365462">)</span>&nbsp;<span class="op" id="7365464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365467">benchmarkNew</span><span class="op" id="7365479">(</span><span class="ident" id="7365480">b</span><span class="op" id="7365481">,</span>&nbsp;<span class="builtintype" id="7365483">false</span><span class="op" id="7365488">)</span><br>
<span class="lineno">285</span><span class="op" id="7365490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7365493">func</span>&nbsp;<span class="ident" id="7365498">BenchmarkSaveRestore</span><span class="op" id="7365518">(</span><span class="ident" id="7365519">b</span>&nbsp;<span class="op" id="7365521">*</span><span class="ident" id="7365522">testing</span><span class="op" id="7365529">.</span><span class="ident" id="7365530">B</span><span class="op" id="7365531">)</span>&nbsp;<span class="op" id="7365533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365536">b</span><span class="op" id="7365537">.</span><span class="ident" id="7365538">StopTimer</span><span class="op" id="7365547">(</span><span class="op" id="7365548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365551">r</span>&nbsp;<span class="op" id="7365553">:=</span>&nbsp;<span class="ident" id="7365556">rand</span><span class="op" id="7365560">.</span><span class="ident" id="7365561">New</span><span class="op" id="7365564">(</span><span class="ident" id="7365565">rand</span><span class="op" id="7365569">.</span><span class="ident" id="7365570">NewSource</span><span class="op" id="7365579">(</span><span class="num" id="7365580">0x5a77a1</span><span class="op" id="7365588">)</span><span class="op" id="7365589">)</span>&nbsp;<span class="comment" id="7365591">//&nbsp;guarantee&nbsp;always&nbsp;same&nbsp;sequence</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365626">data</span>&nbsp;<span class="op" id="7365631">:=</span>&nbsp;<span class="builtinfunc" id="7365634">make</span><span class="op" id="7365638">(</span><span class="op" id="7365639">[</span><span class="op" id="7365640">]</span><span class="builtintype" id="7365641">byte</span><span class="op" id="7365645">,</span>&nbsp;<span class="num" id="7365647">1</span><span class="op" id="7365648">&lt;&lt;</span><span class="num" id="7365650">20</span><span class="op" id="7365652">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7365666">//&nbsp;1MB&nbsp;of&nbsp;data&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7365691">for</span>&nbsp;<span class="ident" id="7365695">i</span>&nbsp;<span class="op" id="7365697">:=</span>&nbsp;<span class="keyword" id="7365700">range</span>&nbsp;<span class="ident" id="7365706">data</span>&nbsp;<span class="op" id="7365711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365715">data</span><span class="op" id="7365719">[</span><span class="ident" id="7365720">i</span><span class="op" id="7365721">]</span>&nbsp;<span class="op" id="7365723">=</span>&nbsp;<span class="builtintype" id="7365725">byte</span><span class="op" id="7365729">(</span><span class="ident" id="7365730">r</span><span class="op" id="7365731">.</span><span class="ident" id="7365732">Intn</span><span class="op" id="7365736">(</span><span class="num" id="7365737">256</span><span class="op" id="7365740">)</span><span class="op" id="7365741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7365744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365747">x</span>&nbsp;<span class="op" id="7365749">:=</span>&nbsp;<span class="ident" id="7365752">New</span><span class="op" id="7365755">(</span><span class="ident" id="7365756">data</span><span class="op" id="7365760">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365763">size</span>&nbsp;<span class="op" id="7365768">:=</span>&nbsp;<span class="ident" id="7365771">testSaveRestore</span><span class="op" id="7365786">(</span><span class="builtintype" id="7365787">nil</span><span class="op" id="7365790">,</span>&nbsp;<span class="builtintype" id="7365792">nil</span><span class="op" id="7365795">,</span>&nbsp;<span class="ident" id="7365797">x</span><span class="op" id="7365798">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7365806">//&nbsp;verify&nbsp;correctness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365829">buf</span>&nbsp;<span class="op" id="7365833">:=</span>&nbsp;<span class="ident" id="7365836">bytes</span><span class="op" id="7365841">.</span><span class="ident" id="7365842">NewBuffer</span><span class="op" id="7365851">(</span><span class="builtinfunc" id="7365852">make</span><span class="op" id="7365856">(</span><span class="op" id="7365857">[</span><span class="op" id="7365858">]</span><span class="builtintype" id="7365859">byte</span><span class="op" id="7365863">,</span>&nbsp;<span class="ident" id="7365865">size</span><span class="op" id="7365869">)</span><span class="op" id="7365870">)</span>&nbsp;<span class="comment" id="7365872">//&nbsp;avoid&nbsp;growing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365890">b</span><span class="op" id="7365891">.</span><span class="ident" id="7365892">SetBytes</span><span class="op" id="7365900">(</span><span class="ident" id="7365901">int64</span><span class="op" id="7365906">(</span><span class="ident" id="7365907">size</span><span class="op" id="7365911">)</span><span class="op" id="7365912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365915">b</span><span class="op" id="7365916">.</span><span class="ident" id="7365917">StartTimer</span><span class="op" id="7365927">(</span><span class="op" id="7365928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7365931">for</span>&nbsp;<span class="ident" id="7365935">i</span>&nbsp;<span class="op" id="7365937">:=</span>&nbsp;<span class="num" id="7365940">0</span><span class="op" id="7365941">;</span>&nbsp;<span class="ident" id="7365943">i</span>&nbsp;<span class="op" id="7365945">&lt;</span>&nbsp;<span class="ident" id="7365947">b</span><span class="op" id="7365948">.</span><span class="ident" id="7365949">N</span><span class="op" id="7365950">;</span>&nbsp;<span class="ident" id="7365952">i</span><span class="op" id="7365953">++</span>&nbsp;<span class="op" id="7365956">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365960">x</span><span class="op" id="7365961">.</span><span class="ident" id="7365962">Write</span><span class="op" id="7365967">(</span><span class="ident" id="7365968">buf</span><span class="op" id="7365971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7365975">var</span>&nbsp;<span class="ident" id="7365979">y</span>&nbsp;<span class="ident" id="7365981">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7365989">y</span><span class="op" id="7365990">.</span><span class="ident" id="7365991">Read</span><span class="op" id="7365995">(</span><span class="ident" id="7365996">buf</span><span class="op" id="7365999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7366002">}</span><br>
<span class="lineno"></span><span class="op" id="7366004">}</span>
</div>
</body>
</html>
