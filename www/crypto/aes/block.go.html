<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3795828">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3795883">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3795937">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3795988">//&nbsp;This&nbsp;Go&nbsp;implementation&nbsp;is&nbsp;derived&nbsp;in&nbsp;part&nbsp;from&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="3796052">//&nbsp;ANSI&nbsp;C&nbsp;implementation,&nbsp;which&nbsp;carries&nbsp;the&nbsp;following&nbsp;notice:</span><br>
<span class="lineno"></span><span class="comment" id="3796114">//</span><br>
<span class="lineno"></span><span class="comment" id="3796117">//&nbsp;&nbsp;&nbsp;&nbsprijndael-alg-fst.c</span><br>
<span class="lineno"></span><span class="comment" id="3796139">//</span><br>
<span class="lineno">10</span><span class="comment" id="3796142">//&nbsp;&nbsp;&nbsp;&nbsp@version&nbsp;3.0&nbsp;(December&nbsp;2000)</span><br>
<span class="lineno"></span><span class="comment" id="3796174">//</span><br>
<span class="lineno"></span><span class="comment" id="3796177">//&nbsp;&nbsp;&nbsp;&nbspOptimised&nbsp;ANSI&nbsp;C&nbsp;code&nbsp;for&nbsp;the&nbsp;Rijndael&nbsp;cipher&nbsp;(now&nbsp;AES)</span><br>
<span class="lineno"></span><span class="comment" id="3796236">//</span><br>
<span class="lineno"></span><span class="comment" id="3796239">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Vincent&nbsp;Rijmen&nbsp;&lt;vincent.rijmen@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno">15</span><span class="comment" id="3796302">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Antoon&nbsp;Bosselaers&nbsp;&lt;antoon.bosselaers@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3796371">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Paulo&nbsp;Barreto&nbsp;&lt;paulo.barreto@terra.com.br&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3796425">//</span><br>
<span class="lineno"></span><span class="comment" id="3796428">//&nbsp;&nbsp;&nbsp;&nbspThis&nbsp;code&nbsp;is&nbsp;hereby&nbsp;placed&nbsp;in&nbsp;the&nbsp;public&nbsp;domain.</span><br>
<span class="lineno"></span><span class="comment" id="3796480">//</span><br>
<span class="lineno">20</span><span class="comment" id="3796483">//&nbsp;&nbsp;&nbsp;&nbspTHIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;AUTHORS&nbsp;&#39;&#39;AS&nbsp;IS&#39;&#39;&nbsp;AND&nbsp;ANY&nbsp;EXPRESS</span><br>
<span class="lineno"></span><span class="comment" id="3796553">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;THE&nbsp;IMPLIED</span><br>
<span class="lineno"></span><span class="comment" id="3796622">//&nbsp;&nbsp;&nbsp;&nbspWARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE</span><br>
<span class="lineno"></span><span class="comment" id="3796692">//&nbsp;&nbsp;&nbsp;&nbspARE&nbsp;DISCLAIMED.&nbsp;&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE&nbsp;AUTHORS&nbsp;OR&nbsp;CONTRIBUTORS&nbsp;BE</span><br>
<span class="lineno"></span><span class="comment" id="3796761">//&nbsp;&nbsp;&nbsp;&nbspLIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,&nbsp;INCIDENTAL,&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR</span><br>
<span class="lineno">25</span><span class="comment" id="3796832">//&nbsp;&nbsp;&nbsp;&nbspCONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF</span><br>
<span class="lineno"></span><span class="comment" id="3796904">//&nbsp;&nbsp;&nbsp;&nbspSUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;&nbsp;LOSS&nbsp;OF&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR</span><br>
<span class="lineno"></span><span class="comment" id="3796971">//&nbsp;&nbsp;&nbsp;&nbspBUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER&nbsp;CAUSED&nbsp;AND&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,</span><br>
<span class="lineno"></span><span class="comment" id="3797044">//&nbsp;&nbsp;&nbsp;&nbspWHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT&nbsp;LIABILITY,&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE</span><br>
<span class="lineno"></span><span class="comment" id="3797116">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,</span><br>
<span class="lineno">30</span><span class="comment" id="3797185">//&nbsp;&nbsp;&nbsp;&nbspEVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE&nbsp;POSSIBILITY&nbsp;OF&nbsp;SUCH&nbsp;DAMAGE.</span><br>
<span class="lineno"></span><span class="comment" id="3797239">//</span><br>
<span class="lineno"></span><span class="comment" id="3797242">//&nbsp;See&nbsp;FIPS&nbsp;197&nbsp;for&nbsp;specification,&nbsp;and&nbsp;see&nbsp;Daemen&nbsp;and&nbsp;Rijmen&#39;s&nbsp;Rijndael&nbsp;submission</span><br>
<span class="lineno"></span><span class="comment" id="3797325">//&nbsp;for&nbsp;implementation&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3797356">//&nbsp;&nbsp;&nbsp;&nbsphttp://www.csrc.nist.gov/publications/fips/fips197/fips-197.pdf</span><br>
<span class="lineno">35</span><span class="comment" id="3797423">//&nbsp;&nbsp;&nbsp;&nbsphttp://csrc.nist.gov/archive/aes/rijndael/Rijndael-ammended.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3797491">package</span>&nbsp;<span class="ident" id="3797499">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3797504">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">40</span><span class="keyword" id="3797571">func</span>&nbsp;<span class="ident" id="3797576">encryptBlockGo</span><span class="op" id="3797590">(</span><span class="ident" id="3797591">xk</span>&nbsp;<span class="op" id="3797594">[</span><span class="op" id="3797595">]</span><span class="builtintype" id="3797596">uint32</span><span class="op" id="3797602">,</span>&nbsp;<span class="ident" id="3797604">dst</span><span class="op" id="3797607">,</span>&nbsp;<span class="ident" id="3797609">src</span>&nbsp;<span class="op" id="3797613">[</span><span class="op" id="3797614">]</span><span class="builtintype" id="3797615">byte</span><span class="op" id="3797619">)</span>&nbsp;<span class="op" id="3797621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797624">var</span>&nbsp;<span class="ident" id="3797628">s0</span><span class="op" id="3797630">,</span>&nbsp;<span class="ident" id="3797632">s1</span><span class="op" id="3797634">,</span>&nbsp;<span class="ident" id="3797636">s2</span><span class="op" id="3797638">,</span>&nbsp;<span class="ident" id="3797640">s3</span><span class="op" id="3797642">,</span>&nbsp;<span class="ident" id="3797644">t0</span><span class="op" id="3797646">,</span>&nbsp;<span class="ident" id="3797648">t1</span><span class="op" id="3797650">,</span>&nbsp;<span class="ident" id="3797652">t2</span><span class="op" id="3797654">,</span>&nbsp;<span class="ident" id="3797656">t3</span>&nbsp;<span class="builtintype" id="3797659">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797668">s0</span>&nbsp;<span class="op" id="3797671">=</span>&nbsp;<span class="builtintype" id="3797673">uint32</span><span class="op" id="3797679">(</span><span class="ident" id="3797680">src</span><span class="op" id="3797683">[</span><span class="num" id="3797684">0</span><span class="op" id="3797685">]</span><span class="op" id="3797686">)</span><span class="op" id="3797687">&lt;&lt;</span><span class="num" id="3797689">24</span>&nbsp;<span class="op" id="3797692">|</span>&nbsp;<span class="builtintype" id="3797694">uint32</span><span class="op" id="3797700">(</span><span class="ident" id="3797701">src</span><span class="op" id="3797704">[</span><span class="num" id="3797705">1</span><span class="op" id="3797706">]</span><span class="op" id="3797707">)</span><span class="op" id="3797708">&lt;&lt;</span><span class="num" id="3797710">16</span>&nbsp;<span class="op" id="3797713">|</span>&nbsp;<span class="builtintype" id="3797715">uint32</span><span class="op" id="3797721">(</span><span class="ident" id="3797722">src</span><span class="op" id="3797725">[</span><span class="num" id="3797726">2</span><span class="op" id="3797727">]</span><span class="op" id="3797728">)</span><span class="op" id="3797729">&lt;&lt;</span><span class="num" id="3797731">8</span>&nbsp;<span class="op" id="3797733">|</span>&nbsp;<span class="builtintype" id="3797735">uint32</span><span class="op" id="3797741">(</span><span class="ident" id="3797742">src</span><span class="op" id="3797745">[</span><span class="num" id="3797746">3</span><span class="op" id="3797747">]</span><span class="op" id="3797748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797751">s1</span>&nbsp;<span class="op" id="3797754">=</span>&nbsp;<span class="builtintype" id="3797756">uint32</span><span class="op" id="3797762">(</span><span class="ident" id="3797763">src</span><span class="op" id="3797766">[</span><span class="num" id="3797767">4</span><span class="op" id="3797768">]</span><span class="op" id="3797769">)</span><span class="op" id="3797770">&lt;&lt;</span><span class="num" id="3797772">24</span>&nbsp;<span class="op" id="3797775">|</span>&nbsp;<span class="builtintype" id="3797777">uint32</span><span class="op" id="3797783">(</span><span class="ident" id="3797784">src</span><span class="op" id="3797787">[</span><span class="num" id="3797788">5</span><span class="op" id="3797789">]</span><span class="op" id="3797790">)</span><span class="op" id="3797791">&lt;&lt;</span><span class="num" id="3797793">16</span>&nbsp;<span class="op" id="3797796">|</span>&nbsp;<span class="builtintype" id="3797798">uint32</span><span class="op" id="3797804">(</span><span class="ident" id="3797805">src</span><span class="op" id="3797808">[</span><span class="num" id="3797809">6</span><span class="op" id="3797810">]</span><span class="op" id="3797811">)</span><span class="op" id="3797812">&lt;&lt;</span><span class="num" id="3797814">8</span>&nbsp;<span class="op" id="3797816">|</span>&nbsp;<span class="builtintype" id="3797818">uint32</span><span class="op" id="3797824">(</span><span class="ident" id="3797825">src</span><span class="op" id="3797828">[</span><span class="num" id="3797829">7</span><span class="op" id="3797830">]</span><span class="op" id="3797831">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797834">s2</span>&nbsp;<span class="op" id="3797837">=</span>&nbsp;<span class="builtintype" id="3797839">uint32</span><span class="op" id="3797845">(</span><span class="ident" id="3797846">src</span><span class="op" id="3797849">[</span><span class="num" id="3797850">8</span><span class="op" id="3797851">]</span><span class="op" id="3797852">)</span><span class="op" id="3797853">&lt;&lt;</span><span class="num" id="3797855">24</span>&nbsp;<span class="op" id="3797858">|</span>&nbsp;<span class="builtintype" id="3797860">uint32</span><span class="op" id="3797866">(</span><span class="ident" id="3797867">src</span><span class="op" id="3797870">[</span><span class="num" id="3797871">9</span><span class="op" id="3797872">]</span><span class="op" id="3797873">)</span><span class="op" id="3797874">&lt;&lt;</span><span class="num" id="3797876">16</span>&nbsp;<span class="op" id="3797879">|</span>&nbsp;<span class="builtintype" id="3797881">uint32</span><span class="op" id="3797887">(</span><span class="ident" id="3797888">src</span><span class="op" id="3797891">[</span><span class="num" id="3797892">10</span><span class="op" id="3797894">]</span><span class="op" id="3797895">)</span><span class="op" id="3797896">&lt;&lt;</span><span class="num" id="3797898">8</span>&nbsp;<span class="op" id="3797900">|</span>&nbsp;<span class="builtintype" id="3797902">uint32</span><span class="op" id="3797908">(</span><span class="ident" id="3797909">src</span><span class="op" id="3797912">[</span><span class="num" id="3797913">11</span><span class="op" id="3797915">]</span><span class="op" id="3797916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797919">s3</span>&nbsp;<span class="op" id="3797922">=</span>&nbsp;<span class="builtintype" id="3797924">uint32</span><span class="op" id="3797930">(</span><span class="ident" id="3797931">src</span><span class="op" id="3797934">[</span><span class="num" id="3797935">12</span><span class="op" id="3797937">]</span><span class="op" id="3797938">)</span><span class="op" id="3797939">&lt;&lt;</span><span class="num" id="3797941">24</span>&nbsp;<span class="op" id="3797944">|</span>&nbsp;<span class="builtintype" id="3797946">uint32</span><span class="op" id="3797952">(</span><span class="ident" id="3797953">src</span><span class="op" id="3797956">[</span><span class="num" id="3797957">13</span><span class="op" id="3797959">]</span><span class="op" id="3797960">)</span><span class="op" id="3797961">&lt;&lt;</span><span class="num" id="3797963">16</span>&nbsp;<span class="op" id="3797966">|</span>&nbsp;<span class="builtintype" id="3797968">uint32</span><span class="op" id="3797974">(</span><span class="ident" id="3797975">src</span><span class="op" id="3797978">[</span><span class="num" id="3797979">14</span><span class="op" id="3797981">]</span><span class="op" id="3797982">)</span><span class="op" id="3797983">&lt;&lt;</span><span class="num" id="3797985">8</span>&nbsp;<span class="op" id="3797987">|</span>&nbsp;<span class="builtintype" id="3797989">uint32</span><span class="op" id="3797995">(</span><span class="ident" id="3797996">src</span><span class="op" id="3797999">[</span><span class="num" id="3798000">15</span><span class="op" id="3798002">]</span><span class="op" id="3798003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798007">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798049">s0</span>&nbsp;<span class="op" id="3798052">^=</span>&nbsp;<span class="ident" id="3798055">xk</span><span class="op" id="3798057">[</span><span class="num" id="3798058">0</span><span class="op" id="3798059">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798062">s1</span>&nbsp;<span class="op" id="3798065">^=</span>&nbsp;<span class="ident" id="3798068">xk</span><span class="op" id="3798070">[</span><span class="num" id="3798071">1</span><span class="op" id="3798072">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798075">s2</span>&nbsp;<span class="op" id="3798078">^=</span>&nbsp;<span class="ident" id="3798081">xk</span><span class="op" id="3798083">[</span><span class="num" id="3798084">2</span><span class="op" id="3798085">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798088">s3</span>&nbsp;<span class="op" id="3798091">^=</span>&nbsp;<span class="ident" id="3798094">xk</span><span class="op" id="3798096">[</span><span class="num" id="3798097">3</span><span class="op" id="3798098">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798102">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798142">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798197">nr</span>&nbsp;<span class="op" id="3798200">:=</span>&nbsp;<span class="builtinfunc" id="3798203">len</span><span class="op" id="3798206">(</span><span class="ident" id="3798207">xk</span><span class="op" id="3798209">)</span><span class="op" id="3798210">/</span><span class="num" id="3798211">4</span>&nbsp;<span class="op" id="3798213">-</span>&nbsp;<span class="num" id="3798215">2</span>&nbsp;<span class="comment" id="3798217">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798252">k</span>&nbsp;<span class="op" id="3798254">:=</span>&nbsp;<span class="num" id="3798257">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798260">for</span>&nbsp;<span class="ident" id="3798264">r</span>&nbsp;<span class="op" id="3798266">:=</span>&nbsp;<span class="num" id="3798269">0</span><span class="op" id="3798270">;</span>&nbsp;<span class="ident" id="3798272">r</span>&nbsp;<span class="op" id="3798274">&lt;</span>&nbsp;<span class="ident" id="3798276">nr</span><span class="op" id="3798278">;</span>&nbsp;<span class="ident" id="3798280">r</span><span class="op" id="3798281">++</span>&nbsp;<span class="op" id="3798284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798288">t0</span>&nbsp;<span class="op" id="3798291">=</span>&nbsp;<span class="ident" id="3798293">xk</span><span class="op" id="3798295">[</span><span class="ident" id="3798296">k</span><span class="op" id="3798297">+</span><span class="num" id="3798298">0</span><span class="op" id="3798299">]</span>&nbsp;<span class="op" id="3798301">^</span>&nbsp;<span class="ident" id="3798303">te0</span><span class="op" id="3798306">[</span><span class="builtintype" id="3798307">uint8</span><span class="op" id="3798312">(</span><span class="ident" id="3798313">s0</span><span class="op" id="3798315">&gt;&gt;</span><span class="num" id="3798317">24</span><span class="op" id="3798319">)</span><span class="op" id="3798320">]</span>&nbsp;<span class="op" id="3798322">^</span>&nbsp;<span class="ident" id="3798324">te1</span><span class="op" id="3798327">[</span><span class="builtintype" id="3798328">uint8</span><span class="op" id="3798333">(</span><span class="ident" id="3798334">s1</span><span class="op" id="3798336">&gt;&gt;</span><span class="num" id="3798338">16</span><span class="op" id="3798340">)</span><span class="op" id="3798341">]</span>&nbsp;<span class="op" id="3798343">^</span>&nbsp;<span class="ident" id="3798345">te2</span><span class="op" id="3798348">[</span><span class="builtintype" id="3798349">uint8</span><span class="op" id="3798354">(</span><span class="ident" id="3798355">s2</span><span class="op" id="3798357">&gt;&gt;</span><span class="num" id="3798359">8</span><span class="op" id="3798360">)</span><span class="op" id="3798361">]</span>&nbsp;<span class="op" id="3798363">^</span>&nbsp;<span class="ident" id="3798365">te3</span><span class="op" id="3798368">[</span><span class="builtintype" id="3798369">uint8</span><span class="op" id="3798374">(</span><span class="ident" id="3798375">s3</span><span class="op" id="3798377">)</span><span class="op" id="3798378">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798382">t1</span>&nbsp;<span class="op" id="3798385">=</span>&nbsp;<span class="ident" id="3798387">xk</span><span class="op" id="3798389">[</span><span class="ident" id="3798390">k</span><span class="op" id="3798391">+</span><span class="num" id="3798392">1</span><span class="op" id="3798393">]</span>&nbsp;<span class="op" id="3798395">^</span>&nbsp;<span class="ident" id="3798397">te0</span><span class="op" id="3798400">[</span><span class="builtintype" id="3798401">uint8</span><span class="op" id="3798406">(</span><span class="ident" id="3798407">s1</span><span class="op" id="3798409">&gt;&gt;</span><span class="num" id="3798411">24</span><span class="op" id="3798413">)</span><span class="op" id="3798414">]</span>&nbsp;<span class="op" id="3798416">^</span>&nbsp;<span class="ident" id="3798418">te1</span><span class="op" id="3798421">[</span><span class="builtintype" id="3798422">uint8</span><span class="op" id="3798427">(</span><span class="ident" id="3798428">s2</span><span class="op" id="3798430">&gt;&gt;</span><span class="num" id="3798432">16</span><span class="op" id="3798434">)</span><span class="op" id="3798435">]</span>&nbsp;<span class="op" id="3798437">^</span>&nbsp;<span class="ident" id="3798439">te2</span><span class="op" id="3798442">[</span><span class="builtintype" id="3798443">uint8</span><span class="op" id="3798448">(</span><span class="ident" id="3798449">s3</span><span class="op" id="3798451">&gt;&gt;</span><span class="num" id="3798453">8</span><span class="op" id="3798454">)</span><span class="op" id="3798455">]</span>&nbsp;<span class="op" id="3798457">^</span>&nbsp;<span class="ident" id="3798459">te3</span><span class="op" id="3798462">[</span><span class="builtintype" id="3798463">uint8</span><span class="op" id="3798468">(</span><span class="ident" id="3798469">s0</span><span class="op" id="3798471">)</span><span class="op" id="3798472">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798476">t2</span>&nbsp;<span class="op" id="3798479">=</span>&nbsp;<span class="ident" id="3798481">xk</span><span class="op" id="3798483">[</span><span class="ident" id="3798484">k</span><span class="op" id="3798485">+</span><span class="num" id="3798486">2</span><span class="op" id="3798487">]</span>&nbsp;<span class="op" id="3798489">^</span>&nbsp;<span class="ident" id="3798491">te0</span><span class="op" id="3798494">[</span><span class="builtintype" id="3798495">uint8</span><span class="op" id="3798500">(</span><span class="ident" id="3798501">s2</span><span class="op" id="3798503">&gt;&gt;</span><span class="num" id="3798505">24</span><span class="op" id="3798507">)</span><span class="op" id="3798508">]</span>&nbsp;<span class="op" id="3798510">^</span>&nbsp;<span class="ident" id="3798512">te1</span><span class="op" id="3798515">[</span><span class="builtintype" id="3798516">uint8</span><span class="op" id="3798521">(</span><span class="ident" id="3798522">s3</span><span class="op" id="3798524">&gt;&gt;</span><span class="num" id="3798526">16</span><span class="op" id="3798528">)</span><span class="op" id="3798529">]</span>&nbsp;<span class="op" id="3798531">^</span>&nbsp;<span class="ident" id="3798533">te2</span><span class="op" id="3798536">[</span><span class="builtintype" id="3798537">uint8</span><span class="op" id="3798542">(</span><span class="ident" id="3798543">s0</span><span class="op" id="3798545">&gt;&gt;</span><span class="num" id="3798547">8</span><span class="op" id="3798548">)</span><span class="op" id="3798549">]</span>&nbsp;<span class="op" id="3798551">^</span>&nbsp;<span class="ident" id="3798553">te3</span><span class="op" id="3798556">[</span><span class="builtintype" id="3798557">uint8</span><span class="op" id="3798562">(</span><span class="ident" id="3798563">s1</span><span class="op" id="3798565">)</span><span class="op" id="3798566">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798570">t3</span>&nbsp;<span class="op" id="3798573">=</span>&nbsp;<span class="ident" id="3798575">xk</span><span class="op" id="3798577">[</span><span class="ident" id="3798578">k</span><span class="op" id="3798579">+</span><span class="num" id="3798580">3</span><span class="op" id="3798581">]</span>&nbsp;<span class="op" id="3798583">^</span>&nbsp;<span class="ident" id="3798585">te0</span><span class="op" id="3798588">[</span><span class="builtintype" id="3798589">uint8</span><span class="op" id="3798594">(</span><span class="ident" id="3798595">s3</span><span class="op" id="3798597">&gt;&gt;</span><span class="num" id="3798599">24</span><span class="op" id="3798601">)</span><span class="op" id="3798602">]</span>&nbsp;<span class="op" id="3798604">^</span>&nbsp;<span class="ident" id="3798606">te1</span><span class="op" id="3798609">[</span><span class="builtintype" id="3798610">uint8</span><span class="op" id="3798615">(</span><span class="ident" id="3798616">s0</span><span class="op" id="3798618">&gt;&gt;</span><span class="num" id="3798620">16</span><span class="op" id="3798622">)</span><span class="op" id="3798623">]</span>&nbsp;<span class="op" id="3798625">^</span>&nbsp;<span class="ident" id="3798627">te2</span><span class="op" id="3798630">[</span><span class="builtintype" id="3798631">uint8</span><span class="op" id="3798636">(</span><span class="ident" id="3798637">s1</span><span class="op" id="3798639">&gt;&gt;</span><span class="num" id="3798641">8</span><span class="op" id="3798642">)</span><span class="op" id="3798643">]</span>&nbsp;<span class="op" id="3798645">^</span>&nbsp;<span class="ident" id="3798647">te3</span><span class="op" id="3798650">[</span><span class="builtintype" id="3798651">uint8</span><span class="op" id="3798656">(</span><span class="ident" id="3798657">s2</span><span class="op" id="3798659">)</span><span class="op" id="3798660">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798664">k</span>&nbsp;<span class="op" id="3798666">+=</span>&nbsp;<span class="num" id="3798669">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798673">s0</span><span class="op" id="3798675">,</span>&nbsp;<span class="ident" id="3798677">s1</span><span class="op" id="3798679">,</span>&nbsp;<span class="ident" id="3798681">s2</span><span class="op" id="3798683">,</span>&nbsp;<span class="ident" id="3798685">s3</span>&nbsp;<span class="op" id="3798688">=</span>&nbsp;<span class="ident" id="3798690">t0</span><span class="op" id="3798692">,</span>&nbsp;<span class="ident" id="3798694">t1</span><span class="op" id="3798696">,</span>&nbsp;<span class="ident" id="3798698">t2</span><span class="op" id="3798700">,</span>&nbsp;<span class="ident" id="3798702">t3</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798710">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798773">s0</span>&nbsp;<span class="op" id="3798776">=</span>&nbsp;<span class="builtintype" id="3798778">uint32</span><span class="op" id="3798784">(</span><span class="ident" id="3798785">sbox0</span><span class="op" id="3798790">[</span><span class="ident" id="3798791">t0</span><span class="op" id="3798793">&gt;&gt;</span><span class="num" id="3798795">24</span><span class="op" id="3798797">]</span><span class="op" id="3798798">)</span><span class="op" id="3798799">&lt;&lt;</span><span class="num" id="3798801">24</span>&nbsp;<span class="op" id="3798804">|</span>&nbsp;<span class="builtintype" id="3798806">uint32</span><span class="op" id="3798812">(</span><span class="ident" id="3798813">sbox0</span><span class="op" id="3798818">[</span><span class="ident" id="3798819">t1</span><span class="op" id="3798821">&gt;&gt;</span><span class="num" id="3798823">16</span><span class="op" id="3798825">&amp;</span><span class="num" id="3798826">0xff</span><span class="op" id="3798830">]</span><span class="op" id="3798831">)</span><span class="op" id="3798832">&lt;&lt;</span><span class="num" id="3798834">16</span>&nbsp;<span class="op" id="3798837">|</span>&nbsp;<span class="builtintype" id="3798839">uint32</span><span class="op" id="3798845">(</span><span class="ident" id="3798846">sbox0</span><span class="op" id="3798851">[</span><span class="ident" id="3798852">t2</span><span class="op" id="3798854">&gt;&gt;</span><span class="num" id="3798856">8</span><span class="op" id="3798857">&amp;</span><span class="num" id="3798858">0xff</span><span class="op" id="3798862">]</span><span class="op" id="3798863">)</span><span class="op" id="3798864">&lt;&lt;</span><span class="num" id="3798866">8</span>&nbsp;<span class="op" id="3798868">|</span>&nbsp;<span class="builtintype" id="3798870">uint32</span><span class="op" id="3798876">(</span><span class="ident" id="3798877">sbox0</span><span class="op" id="3798882">[</span><span class="ident" id="3798883">t3</span><span class="op" id="3798885">&amp;</span><span class="num" id="3798886">0xff</span><span class="op" id="3798890">]</span><span class="op" id="3798891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798894">s1</span>&nbsp;<span class="op" id="3798897">=</span>&nbsp;<span class="builtintype" id="3798899">uint32</span><span class="op" id="3798905">(</span><span class="ident" id="3798906">sbox0</span><span class="op" id="3798911">[</span><span class="ident" id="3798912">t1</span><span class="op" id="3798914">&gt;&gt;</span><span class="num" id="3798916">24</span><span class="op" id="3798918">]</span><span class="op" id="3798919">)</span><span class="op" id="3798920">&lt;&lt;</span><span class="num" id="3798922">24</span>&nbsp;<span class="op" id="3798925">|</span>&nbsp;<span class="builtintype" id="3798927">uint32</span><span class="op" id="3798933">(</span><span class="ident" id="3798934">sbox0</span><span class="op" id="3798939">[</span><span class="ident" id="3798940">t2</span><span class="op" id="3798942">&gt;&gt;</span><span class="num" id="3798944">16</span><span class="op" id="3798946">&amp;</span><span class="num" id="3798947">0xff</span><span class="op" id="3798951">]</span><span class="op" id="3798952">)</span><span class="op" id="3798953">&lt;&lt;</span><span class="num" id="3798955">16</span>&nbsp;<span class="op" id="3798958">|</span>&nbsp;<span class="builtintype" id="3798960">uint32</span><span class="op" id="3798966">(</span><span class="ident" id="3798967">sbox0</span><span class="op" id="3798972">[</span><span class="ident" id="3798973">t3</span><span class="op" id="3798975">&gt;&gt;</span><span class="num" id="3798977">8</span><span class="op" id="3798978">&amp;</span><span class="num" id="3798979">0xff</span><span class="op" id="3798983">]</span><span class="op" id="3798984">)</span><span class="op" id="3798985">&lt;&lt;</span><span class="num" id="3798987">8</span>&nbsp;<span class="op" id="3798989">|</span>&nbsp;<span class="builtintype" id="3798991">uint32</span><span class="op" id="3798997">(</span><span class="ident" id="3798998">sbox0</span><span class="op" id="3799003">[</span><span class="ident" id="3799004">t0</span><span class="op" id="3799006">&amp;</span><span class="num" id="3799007">0xff</span><span class="op" id="3799011">]</span><span class="op" id="3799012">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799015">s2</span>&nbsp;<span class="op" id="3799018">=</span>&nbsp;<span class="builtintype" id="3799020">uint32</span><span class="op" id="3799026">(</span><span class="ident" id="3799027">sbox0</span><span class="op" id="3799032">[</span><span class="ident" id="3799033">t2</span><span class="op" id="3799035">&gt;&gt;</span><span class="num" id="3799037">24</span><span class="op" id="3799039">]</span><span class="op" id="3799040">)</span><span class="op" id="3799041">&lt;&lt;</span><span class="num" id="3799043">24</span>&nbsp;<span class="op" id="3799046">|</span>&nbsp;<span class="builtintype" id="3799048">uint32</span><span class="op" id="3799054">(</span><span class="ident" id="3799055">sbox0</span><span class="op" id="3799060">[</span><span class="ident" id="3799061">t3</span><span class="op" id="3799063">&gt;&gt;</span><span class="num" id="3799065">16</span><span class="op" id="3799067">&amp;</span><span class="num" id="3799068">0xff</span><span class="op" id="3799072">]</span><span class="op" id="3799073">)</span><span class="op" id="3799074">&lt;&lt;</span><span class="num" id="3799076">16</span>&nbsp;<span class="op" id="3799079">|</span>&nbsp;<span class="builtintype" id="3799081">uint32</span><span class="op" id="3799087">(</span><span class="ident" id="3799088">sbox0</span><span class="op" id="3799093">[</span><span class="ident" id="3799094">t0</span><span class="op" id="3799096">&gt;&gt;</span><span class="num" id="3799098">8</span><span class="op" id="3799099">&amp;</span><span class="num" id="3799100">0xff</span><span class="op" id="3799104">]</span><span class="op" id="3799105">)</span><span class="op" id="3799106">&lt;&lt;</span><span class="num" id="3799108">8</span>&nbsp;<span class="op" id="3799110">|</span>&nbsp;<span class="builtintype" id="3799112">uint32</span><span class="op" id="3799118">(</span><span class="ident" id="3799119">sbox0</span><span class="op" id="3799124">[</span><span class="ident" id="3799125">t1</span><span class="op" id="3799127">&amp;</span><span class="num" id="3799128">0xff</span><span class="op" id="3799132">]</span><span class="op" id="3799133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799136">s3</span>&nbsp;<span class="op" id="3799139">=</span>&nbsp;<span class="builtintype" id="3799141">uint32</span><span class="op" id="3799147">(</span><span class="ident" id="3799148">sbox0</span><span class="op" id="3799153">[</span><span class="ident" id="3799154">t3</span><span class="op" id="3799156">&gt;&gt;</span><span class="num" id="3799158">24</span><span class="op" id="3799160">]</span><span class="op" id="3799161">)</span><span class="op" id="3799162">&lt;&lt;</span><span class="num" id="3799164">24</span>&nbsp;<span class="op" id="3799167">|</span>&nbsp;<span class="builtintype" id="3799169">uint32</span><span class="op" id="3799175">(</span><span class="ident" id="3799176">sbox0</span><span class="op" id="3799181">[</span><span class="ident" id="3799182">t0</span><span class="op" id="3799184">&gt;&gt;</span><span class="num" id="3799186">16</span><span class="op" id="3799188">&amp;</span><span class="num" id="3799189">0xff</span><span class="op" id="3799193">]</span><span class="op" id="3799194">)</span><span class="op" id="3799195">&lt;&lt;</span><span class="num" id="3799197">16</span>&nbsp;<span class="op" id="3799200">|</span>&nbsp;<span class="builtintype" id="3799202">uint32</span><span class="op" id="3799208">(</span><span class="ident" id="3799209">sbox0</span><span class="op" id="3799214">[</span><span class="ident" id="3799215">t1</span><span class="op" id="3799217">&gt;&gt;</span><span class="num" id="3799219">8</span><span class="op" id="3799220">&amp;</span><span class="num" id="3799221">0xff</span><span class="op" id="3799225">]</span><span class="op" id="3799226">)</span><span class="op" id="3799227">&lt;&lt;</span><span class="num" id="3799229">8</span>&nbsp;<span class="op" id="3799231">|</span>&nbsp;<span class="builtintype" id="3799233">uint32</span><span class="op" id="3799239">(</span><span class="ident" id="3799240">sbox0</span><span class="op" id="3799245">[</span><span class="ident" id="3799246">t2</span><span class="op" id="3799248">&amp;</span><span class="num" id="3799249">0xff</span><span class="op" id="3799253">]</span><span class="op" id="3799254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799258">s0</span>&nbsp;<span class="op" id="3799261">^=</span>&nbsp;<span class="ident" id="3799264">xk</span><span class="op" id="3799266">[</span><span class="ident" id="3799267">k</span><span class="op" id="3799268">+</span><span class="num" id="3799269">0</span><span class="op" id="3799270">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799273">s1</span>&nbsp;<span class="op" id="3799276">^=</span>&nbsp;<span class="ident" id="3799279">xk</span><span class="op" id="3799281">[</span><span class="ident" id="3799282">k</span><span class="op" id="3799283">+</span><span class="num" id="3799284">1</span><span class="op" id="3799285">]</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799288">s2</span>&nbsp;<span class="op" id="3799291">^=</span>&nbsp;<span class="ident" id="3799294">xk</span><span class="op" id="3799296">[</span><span class="ident" id="3799297">k</span><span class="op" id="3799298">+</span><span class="num" id="3799299">2</span><span class="op" id="3799300">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799303">s3</span>&nbsp;<span class="op" id="3799306">^=</span>&nbsp;<span class="ident" id="3799309">xk</span><span class="op" id="3799311">[</span><span class="ident" id="3799312">k</span><span class="op" id="3799313">+</span><span class="num" id="3799314">3</span><span class="op" id="3799315">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799319">dst</span><span class="op" id="3799322">[</span><span class="num" id="3799323">0</span><span class="op" id="3799324">]</span><span class="op" id="3799325">,</span>&nbsp;<span class="ident" id="3799327">dst</span><span class="op" id="3799330">[</span><span class="num" id="3799331">1</span><span class="op" id="3799332">]</span><span class="op" id="3799333">,</span>&nbsp;<span class="ident" id="3799335">dst</span><span class="op" id="3799338">[</span><span class="num" id="3799339">2</span><span class="op" id="3799340">]</span><span class="op" id="3799341">,</span>&nbsp;<span class="ident" id="3799343">dst</span><span class="op" id="3799346">[</span><span class="num" id="3799347">3</span><span class="op" id="3799348">]</span>&nbsp;<span class="op" id="3799350">=</span>&nbsp;<span class="builtintype" id="3799352">byte</span><span class="op" id="3799356">(</span><span class="ident" id="3799357">s0</span><span class="op" id="3799359">&gt;&gt;</span><span class="num" id="3799361">24</span><span class="op" id="3799363">)</span><span class="op" id="3799364">,</span>&nbsp;<span class="builtintype" id="3799366">byte</span><span class="op" id="3799370">(</span><span class="ident" id="3799371">s0</span><span class="op" id="3799373">&gt;&gt;</span><span class="num" id="3799375">16</span><span class="op" id="3799377">)</span><span class="op" id="3799378">,</span>&nbsp;<span class="builtintype" id="3799380">byte</span><span class="op" id="3799384">(</span><span class="ident" id="3799385">s0</span><span class="op" id="3799387">&gt;&gt;</span><span class="num" id="3799389">8</span><span class="op" id="3799390">)</span><span class="op" id="3799391">,</span>&nbsp;<span class="builtintype" id="3799393">byte</span><span class="op" id="3799397">(</span><span class="ident" id="3799398">s0</span><span class="op" id="3799400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799403">dst</span><span class="op" id="3799406">[</span><span class="num" id="3799407">4</span><span class="op" id="3799408">]</span><span class="op" id="3799409">,</span>&nbsp;<span class="ident" id="3799411">dst</span><span class="op" id="3799414">[</span><span class="num" id="3799415">5</span><span class="op" id="3799416">]</span><span class="op" id="3799417">,</span>&nbsp;<span class="ident" id="3799419">dst</span><span class="op" id="3799422">[</span><span class="num" id="3799423">6</span><span class="op" id="3799424">]</span><span class="op" id="3799425">,</span>&nbsp;<span class="ident" id="3799427">dst</span><span class="op" id="3799430">[</span><span class="num" id="3799431">7</span><span class="op" id="3799432">]</span>&nbsp;<span class="op" id="3799434">=</span>&nbsp;<span class="builtintype" id="3799436">byte</span><span class="op" id="3799440">(</span><span class="ident" id="3799441">s1</span><span class="op" id="3799443">&gt;&gt;</span><span class="num" id="3799445">24</span><span class="op" id="3799447">)</span><span class="op" id="3799448">,</span>&nbsp;<span class="builtintype" id="3799450">byte</span><span class="op" id="3799454">(</span><span class="ident" id="3799455">s1</span><span class="op" id="3799457">&gt;&gt;</span><span class="num" id="3799459">16</span><span class="op" id="3799461">)</span><span class="op" id="3799462">,</span>&nbsp;<span class="builtintype" id="3799464">byte</span><span class="op" id="3799468">(</span><span class="ident" id="3799469">s1</span><span class="op" id="3799471">&gt;&gt;</span><span class="num" id="3799473">8</span><span class="op" id="3799474">)</span><span class="op" id="3799475">,</span>&nbsp;<span class="builtintype" id="3799477">byte</span><span class="op" id="3799481">(</span><span class="ident" id="3799482">s1</span><span class="op" id="3799484">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799487">dst</span><span class="op" id="3799490">[</span><span class="num" id="3799491">8</span><span class="op" id="3799492">]</span><span class="op" id="3799493">,</span>&nbsp;<span class="ident" id="3799495">dst</span><span class="op" id="3799498">[</span><span class="num" id="3799499">9</span><span class="op" id="3799500">]</span><span class="op" id="3799501">,</span>&nbsp;<span class="ident" id="3799503">dst</span><span class="op" id="3799506">[</span><span class="num" id="3799507">10</span><span class="op" id="3799509">]</span><span class="op" id="3799510">,</span>&nbsp;<span class="ident" id="3799512">dst</span><span class="op" id="3799515">[</span><span class="num" id="3799516">11</span><span class="op" id="3799518">]</span>&nbsp;<span class="op" id="3799520">=</span>&nbsp;<span class="builtintype" id="3799522">byte</span><span class="op" id="3799526">(</span><span class="ident" id="3799527">s2</span><span class="op" id="3799529">&gt;&gt;</span><span class="num" id="3799531">24</span><span class="op" id="3799533">)</span><span class="op" id="3799534">,</span>&nbsp;<span class="builtintype" id="3799536">byte</span><span class="op" id="3799540">(</span><span class="ident" id="3799541">s2</span><span class="op" id="3799543">&gt;&gt;</span><span class="num" id="3799545">16</span><span class="op" id="3799547">)</span><span class="op" id="3799548">,</span>&nbsp;<span class="builtintype" id="3799550">byte</span><span class="op" id="3799554">(</span><span class="ident" id="3799555">s2</span><span class="op" id="3799557">&gt;&gt;</span><span class="num" id="3799559">8</span><span class="op" id="3799560">)</span><span class="op" id="3799561">,</span>&nbsp;<span class="builtintype" id="3799563">byte</span><span class="op" id="3799567">(</span><span class="ident" id="3799568">s2</span><span class="op" id="3799570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799573">dst</span><span class="op" id="3799576">[</span><span class="num" id="3799577">12</span><span class="op" id="3799579">]</span><span class="op" id="3799580">,</span>&nbsp;<span class="ident" id="3799582">dst</span><span class="op" id="3799585">[</span><span class="num" id="3799586">13</span><span class="op" id="3799588">]</span><span class="op" id="3799589">,</span>&nbsp;<span class="ident" id="3799591">dst</span><span class="op" id="3799594">[</span><span class="num" id="3799595">14</span><span class="op" id="3799597">]</span><span class="op" id="3799598">,</span>&nbsp;<span class="ident" id="3799600">dst</span><span class="op" id="3799603">[</span><span class="num" id="3799604">15</span><span class="op" id="3799606">]</span>&nbsp;<span class="op" id="3799608">=</span>&nbsp;<span class="builtintype" id="3799610">byte</span><span class="op" id="3799614">(</span><span class="ident" id="3799615">s3</span><span class="op" id="3799617">&gt;&gt;</span><span class="num" id="3799619">24</span><span class="op" id="3799621">)</span><span class="op" id="3799622">,</span>&nbsp;<span class="builtintype" id="3799624">byte</span><span class="op" id="3799628">(</span><span class="ident" id="3799629">s3</span><span class="op" id="3799631">&gt;&gt;</span><span class="num" id="3799633">16</span><span class="op" id="3799635">)</span><span class="op" id="3799636">,</span>&nbsp;<span class="builtintype" id="3799638">byte</span><span class="op" id="3799642">(</span><span class="ident" id="3799643">s3</span><span class="op" id="3799645">&gt;&gt;</span><span class="num" id="3799647">8</span><span class="op" id="3799648">)</span><span class="op" id="3799649">,</span>&nbsp;<span class="builtintype" id="3799651">byte</span><span class="op" id="3799655">(</span><span class="ident" id="3799656">s3</span><span class="op" id="3799658">)</span><br>
<span class="lineno"></span><span class="op" id="3799660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3799663">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">85</span><span class="keyword" id="3799730">func</span>&nbsp;<span class="ident" id="3799735">decryptBlockGo</span><span class="op" id="3799749">(</span><span class="ident" id="3799750">xk</span>&nbsp;<span class="op" id="3799753">[</span><span class="op" id="3799754">]</span><span class="builtintype" id="3799755">uint32</span><span class="op" id="3799761">,</span>&nbsp;<span class="ident" id="3799763">dst</span><span class="op" id="3799766">,</span>&nbsp;<span class="ident" id="3799768">src</span>&nbsp;<span class="op" id="3799772">[</span><span class="op" id="3799773">]</span><span class="builtintype" id="3799774">byte</span><span class="op" id="3799778">)</span>&nbsp;<span class="op" id="3799780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799783">var</span>&nbsp;<span class="ident" id="3799787">s0</span><span class="op" id="3799789">,</span>&nbsp;<span class="ident" id="3799791">s1</span><span class="op" id="3799793">,</span>&nbsp;<span class="ident" id="3799795">s2</span><span class="op" id="3799797">,</span>&nbsp;<span class="ident" id="3799799">s3</span><span class="op" id="3799801">,</span>&nbsp;<span class="ident" id="3799803">t0</span><span class="op" id="3799805">,</span>&nbsp;<span class="ident" id="3799807">t1</span><span class="op" id="3799809">,</span>&nbsp;<span class="ident" id="3799811">t2</span><span class="op" id="3799813">,</span>&nbsp;<span class="ident" id="3799815">t3</span>&nbsp;<span class="builtintype" id="3799818">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799827">s0</span>&nbsp;<span class="op" id="3799830">=</span>&nbsp;<span class="builtintype" id="3799832">uint32</span><span class="op" id="3799838">(</span><span class="ident" id="3799839">src</span><span class="op" id="3799842">[</span><span class="num" id="3799843">0</span><span class="op" id="3799844">]</span><span class="op" id="3799845">)</span><span class="op" id="3799846">&lt;&lt;</span><span class="num" id="3799848">24</span>&nbsp;<span class="op" id="3799851">|</span>&nbsp;<span class="builtintype" id="3799853">uint32</span><span class="op" id="3799859">(</span><span class="ident" id="3799860">src</span><span class="op" id="3799863">[</span><span class="num" id="3799864">1</span><span class="op" id="3799865">]</span><span class="op" id="3799866">)</span><span class="op" id="3799867">&lt;&lt;</span><span class="num" id="3799869">16</span>&nbsp;<span class="op" id="3799872">|</span>&nbsp;<span class="builtintype" id="3799874">uint32</span><span class="op" id="3799880">(</span><span class="ident" id="3799881">src</span><span class="op" id="3799884">[</span><span class="num" id="3799885">2</span><span class="op" id="3799886">]</span><span class="op" id="3799887">)</span><span class="op" id="3799888">&lt;&lt;</span><span class="num" id="3799890">8</span>&nbsp;<span class="op" id="3799892">|</span>&nbsp;<span class="builtintype" id="3799894">uint32</span><span class="op" id="3799900">(</span><span class="ident" id="3799901">src</span><span class="op" id="3799904">[</span><span class="num" id="3799905">3</span><span class="op" id="3799906">]</span><span class="op" id="3799907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799910">s1</span>&nbsp;<span class="op" id="3799913">=</span>&nbsp;<span class="builtintype" id="3799915">uint32</span><span class="op" id="3799921">(</span><span class="ident" id="3799922">src</span><span class="op" id="3799925">[</span><span class="num" id="3799926">4</span><span class="op" id="3799927">]</span><span class="op" id="3799928">)</span><span class="op" id="3799929">&lt;&lt;</span><span class="num" id="3799931">24</span>&nbsp;<span class="op" id="3799934">|</span>&nbsp;<span class="builtintype" id="3799936">uint32</span><span class="op" id="3799942">(</span><span class="ident" id="3799943">src</span><span class="op" id="3799946">[</span><span class="num" id="3799947">5</span><span class="op" id="3799948">]</span><span class="op" id="3799949">)</span><span class="op" id="3799950">&lt;&lt;</span><span class="num" id="3799952">16</span>&nbsp;<span class="op" id="3799955">|</span>&nbsp;<span class="builtintype" id="3799957">uint32</span><span class="op" id="3799963">(</span><span class="ident" id="3799964">src</span><span class="op" id="3799967">[</span><span class="num" id="3799968">6</span><span class="op" id="3799969">]</span><span class="op" id="3799970">)</span><span class="op" id="3799971">&lt;&lt;</span><span class="num" id="3799973">8</span>&nbsp;<span class="op" id="3799975">|</span>&nbsp;<span class="builtintype" id="3799977">uint32</span><span class="op" id="3799983">(</span><span class="ident" id="3799984">src</span><span class="op" id="3799987">[</span><span class="num" id="3799988">7</span><span class="op" id="3799989">]</span><span class="op" id="3799990">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799993">s2</span>&nbsp;<span class="op" id="3799996">=</span>&nbsp;<span class="builtintype" id="3799998">uint32</span><span class="op" id="3800004">(</span><span class="ident" id="3800005">src</span><span class="op" id="3800008">[</span><span class="num" id="3800009">8</span><span class="op" id="3800010">]</span><span class="op" id="3800011">)</span><span class="op" id="3800012">&lt;&lt;</span><span class="num" id="3800014">24</span>&nbsp;<span class="op" id="3800017">|</span>&nbsp;<span class="builtintype" id="3800019">uint32</span><span class="op" id="3800025">(</span><span class="ident" id="3800026">src</span><span class="op" id="3800029">[</span><span class="num" id="3800030">9</span><span class="op" id="3800031">]</span><span class="op" id="3800032">)</span><span class="op" id="3800033">&lt;&lt;</span><span class="num" id="3800035">16</span>&nbsp;<span class="op" id="3800038">|</span>&nbsp;<span class="builtintype" id="3800040">uint32</span><span class="op" id="3800046">(</span><span class="ident" id="3800047">src</span><span class="op" id="3800050">[</span><span class="num" id="3800051">10</span><span class="op" id="3800053">]</span><span class="op" id="3800054">)</span><span class="op" id="3800055">&lt;&lt;</span><span class="num" id="3800057">8</span>&nbsp;<span class="op" id="3800059">|</span>&nbsp;<span class="builtintype" id="3800061">uint32</span><span class="op" id="3800067">(</span><span class="ident" id="3800068">src</span><span class="op" id="3800071">[</span><span class="num" id="3800072">11</span><span class="op" id="3800074">]</span><span class="op" id="3800075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800078">s3</span>&nbsp;<span class="op" id="3800081">=</span>&nbsp;<span class="builtintype" id="3800083">uint32</span><span class="op" id="3800089">(</span><span class="ident" id="3800090">src</span><span class="op" id="3800093">[</span><span class="num" id="3800094">12</span><span class="op" id="3800096">]</span><span class="op" id="3800097">)</span><span class="op" id="3800098">&lt;&lt;</span><span class="num" id="3800100">24</span>&nbsp;<span class="op" id="3800103">|</span>&nbsp;<span class="builtintype" id="3800105">uint32</span><span class="op" id="3800111">(</span><span class="ident" id="3800112">src</span><span class="op" id="3800115">[</span><span class="num" id="3800116">13</span><span class="op" id="3800118">]</span><span class="op" id="3800119">)</span><span class="op" id="3800120">&lt;&lt;</span><span class="num" id="3800122">16</span>&nbsp;<span class="op" id="3800125">|</span>&nbsp;<span class="builtintype" id="3800127">uint32</span><span class="op" id="3800133">(</span><span class="ident" id="3800134">src</span><span class="op" id="3800137">[</span><span class="num" id="3800138">14</span><span class="op" id="3800140">]</span><span class="op" id="3800141">)</span><span class="op" id="3800142">&lt;&lt;</span><span class="num" id="3800144">8</span>&nbsp;<span class="op" id="3800146">|</span>&nbsp;<span class="builtintype" id="3800148">uint32</span><span class="op" id="3800154">(</span><span class="ident" id="3800155">src</span><span class="op" id="3800158">[</span><span class="num" id="3800159">15</span><span class="op" id="3800161">]</span><span class="op" id="3800162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3800166">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800208">s0</span>&nbsp;<span class="op" id="3800211">^=</span>&nbsp;<span class="ident" id="3800214">xk</span><span class="op" id="3800216">[</span><span class="num" id="3800217">0</span><span class="op" id="3800218">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800221">s1</span>&nbsp;<span class="op" id="3800224">^=</span>&nbsp;<span class="ident" id="3800227">xk</span><span class="op" id="3800229">[</span><span class="num" id="3800230">1</span><span class="op" id="3800231">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800234">s2</span>&nbsp;<span class="op" id="3800237">^=</span>&nbsp;<span class="ident" id="3800240">xk</span><span class="op" id="3800242">[</span><span class="num" id="3800243">2</span><span class="op" id="3800244">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800247">s3</span>&nbsp;<span class="op" id="3800250">^=</span>&nbsp;<span class="ident" id="3800253">xk</span><span class="op" id="3800255">[</span><span class="num" id="3800256">3</span><span class="op" id="3800257">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3800261">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3800301">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800356">nr</span>&nbsp;<span class="op" id="3800359">:=</span>&nbsp;<span class="builtinfunc" id="3800362">len</span><span class="op" id="3800365">(</span><span class="ident" id="3800366">xk</span><span class="op" id="3800368">)</span><span class="op" id="3800369">/</span><span class="num" id="3800370">4</span>&nbsp;<span class="op" id="3800372">-</span>&nbsp;<span class="num" id="3800374">2</span>&nbsp;<span class="comment" id="3800376">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800411">k</span>&nbsp;<span class="op" id="3800413">:=</span>&nbsp;<span class="num" id="3800416">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800419">for</span>&nbsp;<span class="ident" id="3800423">r</span>&nbsp;<span class="op" id="3800425">:=</span>&nbsp;<span class="num" id="3800428">0</span><span class="op" id="3800429">;</span>&nbsp;<span class="ident" id="3800431">r</span>&nbsp;<span class="op" id="3800433">&lt;</span>&nbsp;<span class="ident" id="3800435">nr</span><span class="op" id="3800437">;</span>&nbsp;<span class="ident" id="3800439">r</span><span class="op" id="3800440">++</span>&nbsp;<span class="op" id="3800443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800447">t0</span>&nbsp;<span class="op" id="3800450">=</span>&nbsp;<span class="ident" id="3800452">xk</span><span class="op" id="3800454">[</span><span class="ident" id="3800455">k</span><span class="op" id="3800456">+</span><span class="num" id="3800457">0</span><span class="op" id="3800458">]</span>&nbsp;<span class="op" id="3800460">^</span>&nbsp;<span class="ident" id="3800462">td0</span><span class="op" id="3800465">[</span><span class="builtintype" id="3800466">uint8</span><span class="op" id="3800471">(</span><span class="ident" id="3800472">s0</span><span class="op" id="3800474">&gt;&gt;</span><span class="num" id="3800476">24</span><span class="op" id="3800478">)</span><span class="op" id="3800479">]</span>&nbsp;<span class="op" id="3800481">^</span>&nbsp;<span class="ident" id="3800483">td1</span><span class="op" id="3800486">[</span><span class="builtintype" id="3800487">uint8</span><span class="op" id="3800492">(</span><span class="ident" id="3800493">s3</span><span class="op" id="3800495">&gt;&gt;</span><span class="num" id="3800497">16</span><span class="op" id="3800499">)</span><span class="op" id="3800500">]</span>&nbsp;<span class="op" id="3800502">^</span>&nbsp;<span class="ident" id="3800504">td2</span><span class="op" id="3800507">[</span><span class="builtintype" id="3800508">uint8</span><span class="op" id="3800513">(</span><span class="ident" id="3800514">s2</span><span class="op" id="3800516">&gt;&gt;</span><span class="num" id="3800518">8</span><span class="op" id="3800519">)</span><span class="op" id="3800520">]</span>&nbsp;<span class="op" id="3800522">^</span>&nbsp;<span class="ident" id="3800524">td3</span><span class="op" id="3800527">[</span><span class="builtintype" id="3800528">uint8</span><span class="op" id="3800533">(</span><span class="ident" id="3800534">s1</span><span class="op" id="3800536">)</span><span class="op" id="3800537">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800541">t1</span>&nbsp;<span class="op" id="3800544">=</span>&nbsp;<span class="ident" id="3800546">xk</span><span class="op" id="3800548">[</span><span class="ident" id="3800549">k</span><span class="op" id="3800550">+</span><span class="num" id="3800551">1</span><span class="op" id="3800552">]</span>&nbsp;<span class="op" id="3800554">^</span>&nbsp;<span class="ident" id="3800556">td0</span><span class="op" id="3800559">[</span><span class="builtintype" id="3800560">uint8</span><span class="op" id="3800565">(</span><span class="ident" id="3800566">s1</span><span class="op" id="3800568">&gt;&gt;</span><span class="num" id="3800570">24</span><span class="op" id="3800572">)</span><span class="op" id="3800573">]</span>&nbsp;<span class="op" id="3800575">^</span>&nbsp;<span class="ident" id="3800577">td1</span><span class="op" id="3800580">[</span><span class="builtintype" id="3800581">uint8</span><span class="op" id="3800586">(</span><span class="ident" id="3800587">s0</span><span class="op" id="3800589">&gt;&gt;</span><span class="num" id="3800591">16</span><span class="op" id="3800593">)</span><span class="op" id="3800594">]</span>&nbsp;<span class="op" id="3800596">^</span>&nbsp;<span class="ident" id="3800598">td2</span><span class="op" id="3800601">[</span><span class="builtintype" id="3800602">uint8</span><span class="op" id="3800607">(</span><span class="ident" id="3800608">s3</span><span class="op" id="3800610">&gt;&gt;</span><span class="num" id="3800612">8</span><span class="op" id="3800613">)</span><span class="op" id="3800614">]</span>&nbsp;<span class="op" id="3800616">^</span>&nbsp;<span class="ident" id="3800618">td3</span><span class="op" id="3800621">[</span><span class="builtintype" id="3800622">uint8</span><span class="op" id="3800627">(</span><span class="ident" id="3800628">s2</span><span class="op" id="3800630">)</span><span class="op" id="3800631">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800635">t2</span>&nbsp;<span class="op" id="3800638">=</span>&nbsp;<span class="ident" id="3800640">xk</span><span class="op" id="3800642">[</span><span class="ident" id="3800643">k</span><span class="op" id="3800644">+</span><span class="num" id="3800645">2</span><span class="op" id="3800646">]</span>&nbsp;<span class="op" id="3800648">^</span>&nbsp;<span class="ident" id="3800650">td0</span><span class="op" id="3800653">[</span><span class="builtintype" id="3800654">uint8</span><span class="op" id="3800659">(</span><span class="ident" id="3800660">s2</span><span class="op" id="3800662">&gt;&gt;</span><span class="num" id="3800664">24</span><span class="op" id="3800666">)</span><span class="op" id="3800667">]</span>&nbsp;<span class="op" id="3800669">^</span>&nbsp;<span class="ident" id="3800671">td1</span><span class="op" id="3800674">[</span><span class="builtintype" id="3800675">uint8</span><span class="op" id="3800680">(</span><span class="ident" id="3800681">s1</span><span class="op" id="3800683">&gt;&gt;</span><span class="num" id="3800685">16</span><span class="op" id="3800687">)</span><span class="op" id="3800688">]</span>&nbsp;<span class="op" id="3800690">^</span>&nbsp;<span class="ident" id="3800692">td2</span><span class="op" id="3800695">[</span><span class="builtintype" id="3800696">uint8</span><span class="op" id="3800701">(</span><span class="ident" id="3800702">s0</span><span class="op" id="3800704">&gt;&gt;</span><span class="num" id="3800706">8</span><span class="op" id="3800707">)</span><span class="op" id="3800708">]</span>&nbsp;<span class="op" id="3800710">^</span>&nbsp;<span class="ident" id="3800712">td3</span><span class="op" id="3800715">[</span><span class="builtintype" id="3800716">uint8</span><span class="op" id="3800721">(</span><span class="ident" id="3800722">s3</span><span class="op" id="3800724">)</span><span class="op" id="3800725">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800729">t3</span>&nbsp;<span class="op" id="3800732">=</span>&nbsp;<span class="ident" id="3800734">xk</span><span class="op" id="3800736">[</span><span class="ident" id="3800737">k</span><span class="op" id="3800738">+</span><span class="num" id="3800739">3</span><span class="op" id="3800740">]</span>&nbsp;<span class="op" id="3800742">^</span>&nbsp;<span class="ident" id="3800744">td0</span><span class="op" id="3800747">[</span><span class="builtintype" id="3800748">uint8</span><span class="op" id="3800753">(</span><span class="ident" id="3800754">s3</span><span class="op" id="3800756">&gt;&gt;</span><span class="num" id="3800758">24</span><span class="op" id="3800760">)</span><span class="op" id="3800761">]</span>&nbsp;<span class="op" id="3800763">^</span>&nbsp;<span class="ident" id="3800765">td1</span><span class="op" id="3800768">[</span><span class="builtintype" id="3800769">uint8</span><span class="op" id="3800774">(</span><span class="ident" id="3800775">s2</span><span class="op" id="3800777">&gt;&gt;</span><span class="num" id="3800779">16</span><span class="op" id="3800781">)</span><span class="op" id="3800782">]</span>&nbsp;<span class="op" id="3800784">^</span>&nbsp;<span class="ident" id="3800786">td2</span><span class="op" id="3800789">[</span><span class="builtintype" id="3800790">uint8</span><span class="op" id="3800795">(</span><span class="ident" id="3800796">s1</span><span class="op" id="3800798">&gt;&gt;</span><span class="num" id="3800800">8</span><span class="op" id="3800801">)</span><span class="op" id="3800802">]</span>&nbsp;<span class="op" id="3800804">^</span>&nbsp;<span class="ident" id="3800806">td3</span><span class="op" id="3800809">[</span><span class="builtintype" id="3800810">uint8</span><span class="op" id="3800815">(</span><span class="ident" id="3800816">s0</span><span class="op" id="3800818">)</span><span class="op" id="3800819">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800823">k</span>&nbsp;<span class="op" id="3800825">+=</span>&nbsp;<span class="num" id="3800828">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800832">s0</span><span class="op" id="3800834">,</span>&nbsp;<span class="ident" id="3800836">s1</span><span class="op" id="3800838">,</span>&nbsp;<span class="ident" id="3800840">s2</span><span class="op" id="3800842">,</span>&nbsp;<span class="ident" id="3800844">s3</span>&nbsp;<span class="op" id="3800847">=</span>&nbsp;<span class="ident" id="3800849">t0</span><span class="op" id="3800851">,</span>&nbsp;<span class="ident" id="3800853">t1</span><span class="op" id="3800855">,</span>&nbsp;<span class="ident" id="3800857">t2</span><span class="op" id="3800859">,</span>&nbsp;<span class="ident" id="3800861">t3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3800869">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800932">s0</span>&nbsp;<span class="op" id="3800935">=</span>&nbsp;<span class="builtintype" id="3800937">uint32</span><span class="op" id="3800943">(</span><span class="ident" id="3800944">sbox1</span><span class="op" id="3800949">[</span><span class="ident" id="3800950">t0</span><span class="op" id="3800952">&gt;&gt;</span><span class="num" id="3800954">24</span><span class="op" id="3800956">]</span><span class="op" id="3800957">)</span><span class="op" id="3800958">&lt;&lt;</span><span class="num" id="3800960">24</span>&nbsp;<span class="op" id="3800963">|</span>&nbsp;<span class="builtintype" id="3800965">uint32</span><span class="op" id="3800971">(</span><span class="ident" id="3800972">sbox1</span><span class="op" id="3800977">[</span><span class="ident" id="3800978">t3</span><span class="op" id="3800980">&gt;&gt;</span><span class="num" id="3800982">16</span><span class="op" id="3800984">&amp;</span><span class="num" id="3800985">0xff</span><span class="op" id="3800989">]</span><span class="op" id="3800990">)</span><span class="op" id="3800991">&lt;&lt;</span><span class="num" id="3800993">16</span>&nbsp;<span class="op" id="3800996">|</span>&nbsp;<span class="builtintype" id="3800998">uint32</span><span class="op" id="3801004">(</span><span class="ident" id="3801005">sbox1</span><span class="op" id="3801010">[</span><span class="ident" id="3801011">t2</span><span class="op" id="3801013">&gt;&gt;</span><span class="num" id="3801015">8</span><span class="op" id="3801016">&amp;</span><span class="num" id="3801017">0xff</span><span class="op" id="3801021">]</span><span class="op" id="3801022">)</span><span class="op" id="3801023">&lt;&lt;</span><span class="num" id="3801025">8</span>&nbsp;<span class="op" id="3801027">|</span>&nbsp;<span class="builtintype" id="3801029">uint32</span><span class="op" id="3801035">(</span><span class="ident" id="3801036">sbox1</span><span class="op" id="3801041">[</span><span class="ident" id="3801042">t1</span><span class="op" id="3801044">&amp;</span><span class="num" id="3801045">0xff</span><span class="op" id="3801049">]</span><span class="op" id="3801050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801053">s1</span>&nbsp;<span class="op" id="3801056">=</span>&nbsp;<span class="builtintype" id="3801058">uint32</span><span class="op" id="3801064">(</span><span class="ident" id="3801065">sbox1</span><span class="op" id="3801070">[</span><span class="ident" id="3801071">t1</span><span class="op" id="3801073">&gt;&gt;</span><span class="num" id="3801075">24</span><span class="op" id="3801077">]</span><span class="op" id="3801078">)</span><span class="op" id="3801079">&lt;&lt;</span><span class="num" id="3801081">24</span>&nbsp;<span class="op" id="3801084">|</span>&nbsp;<span class="builtintype" id="3801086">uint32</span><span class="op" id="3801092">(</span><span class="ident" id="3801093">sbox1</span><span class="op" id="3801098">[</span><span class="ident" id="3801099">t0</span><span class="op" id="3801101">&gt;&gt;</span><span class="num" id="3801103">16</span><span class="op" id="3801105">&amp;</span><span class="num" id="3801106">0xff</span><span class="op" id="3801110">]</span><span class="op" id="3801111">)</span><span class="op" id="3801112">&lt;&lt;</span><span class="num" id="3801114">16</span>&nbsp;<span class="op" id="3801117">|</span>&nbsp;<span class="builtintype" id="3801119">uint32</span><span class="op" id="3801125">(</span><span class="ident" id="3801126">sbox1</span><span class="op" id="3801131">[</span><span class="ident" id="3801132">t3</span><span class="op" id="3801134">&gt;&gt;</span><span class="num" id="3801136">8</span><span class="op" id="3801137">&amp;</span><span class="num" id="3801138">0xff</span><span class="op" id="3801142">]</span><span class="op" id="3801143">)</span><span class="op" id="3801144">&lt;&lt;</span><span class="num" id="3801146">8</span>&nbsp;<span class="op" id="3801148">|</span>&nbsp;<span class="builtintype" id="3801150">uint32</span><span class="op" id="3801156">(</span><span class="ident" id="3801157">sbox1</span><span class="op" id="3801162">[</span><span class="ident" id="3801163">t2</span><span class="op" id="3801165">&amp;</span><span class="num" id="3801166">0xff</span><span class="op" id="3801170">]</span><span class="op" id="3801171">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801174">s2</span>&nbsp;<span class="op" id="3801177">=</span>&nbsp;<span class="builtintype" id="3801179">uint32</span><span class="op" id="3801185">(</span><span class="ident" id="3801186">sbox1</span><span class="op" id="3801191">[</span><span class="ident" id="3801192">t2</span><span class="op" id="3801194">&gt;&gt;</span><span class="num" id="3801196">24</span><span class="op" id="3801198">]</span><span class="op" id="3801199">)</span><span class="op" id="3801200">&lt;&lt;</span><span class="num" id="3801202">24</span>&nbsp;<span class="op" id="3801205">|</span>&nbsp;<span class="builtintype" id="3801207">uint32</span><span class="op" id="3801213">(</span><span class="ident" id="3801214">sbox1</span><span class="op" id="3801219">[</span><span class="ident" id="3801220">t1</span><span class="op" id="3801222">&gt;&gt;</span><span class="num" id="3801224">16</span><span class="op" id="3801226">&amp;</span><span class="num" id="3801227">0xff</span><span class="op" id="3801231">]</span><span class="op" id="3801232">)</span><span class="op" id="3801233">&lt;&lt;</span><span class="num" id="3801235">16</span>&nbsp;<span class="op" id="3801238">|</span>&nbsp;<span class="builtintype" id="3801240">uint32</span><span class="op" id="3801246">(</span><span class="ident" id="3801247">sbox1</span><span class="op" id="3801252">[</span><span class="ident" id="3801253">t0</span><span class="op" id="3801255">&gt;&gt;</span><span class="num" id="3801257">8</span><span class="op" id="3801258">&amp;</span><span class="num" id="3801259">0xff</span><span class="op" id="3801263">]</span><span class="op" id="3801264">)</span><span class="op" id="3801265">&lt;&lt;</span><span class="num" id="3801267">8</span>&nbsp;<span class="op" id="3801269">|</span>&nbsp;<span class="builtintype" id="3801271">uint32</span><span class="op" id="3801277">(</span><span class="ident" id="3801278">sbox1</span><span class="op" id="3801283">[</span><span class="ident" id="3801284">t3</span><span class="op" id="3801286">&amp;</span><span class="num" id="3801287">0xff</span><span class="op" id="3801291">]</span><span class="op" id="3801292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801295">s3</span>&nbsp;<span class="op" id="3801298">=</span>&nbsp;<span class="builtintype" id="3801300">uint32</span><span class="op" id="3801306">(</span><span class="ident" id="3801307">sbox1</span><span class="op" id="3801312">[</span><span class="ident" id="3801313">t3</span><span class="op" id="3801315">&gt;&gt;</span><span class="num" id="3801317">24</span><span class="op" id="3801319">]</span><span class="op" id="3801320">)</span><span class="op" id="3801321">&lt;&lt;</span><span class="num" id="3801323">24</span>&nbsp;<span class="op" id="3801326">|</span>&nbsp;<span class="builtintype" id="3801328">uint32</span><span class="op" id="3801334">(</span><span class="ident" id="3801335">sbox1</span><span class="op" id="3801340">[</span><span class="ident" id="3801341">t2</span><span class="op" id="3801343">&gt;&gt;</span><span class="num" id="3801345">16</span><span class="op" id="3801347">&amp;</span><span class="num" id="3801348">0xff</span><span class="op" id="3801352">]</span><span class="op" id="3801353">)</span><span class="op" id="3801354">&lt;&lt;</span><span class="num" id="3801356">16</span>&nbsp;<span class="op" id="3801359">|</span>&nbsp;<span class="builtintype" id="3801361">uint32</span><span class="op" id="3801367">(</span><span class="ident" id="3801368">sbox1</span><span class="op" id="3801373">[</span><span class="ident" id="3801374">t1</span><span class="op" id="3801376">&gt;&gt;</span><span class="num" id="3801378">8</span><span class="op" id="3801379">&amp;</span><span class="num" id="3801380">0xff</span><span class="op" id="3801384">]</span><span class="op" id="3801385">)</span><span class="op" id="3801386">&lt;&lt;</span><span class="num" id="3801388">8</span>&nbsp;<span class="op" id="3801390">|</span>&nbsp;<span class="builtintype" id="3801392">uint32</span><span class="op" id="3801398">(</span><span class="ident" id="3801399">sbox1</span><span class="op" id="3801404">[</span><span class="ident" id="3801405">t0</span><span class="op" id="3801407">&amp;</span><span class="num" id="3801408">0xff</span><span class="op" id="3801412">]</span><span class="op" id="3801413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801417">s0</span>&nbsp;<span class="op" id="3801420">^=</span>&nbsp;<span class="ident" id="3801423">xk</span><span class="op" id="3801425">[</span><span class="ident" id="3801426">k</span><span class="op" id="3801427">+</span><span class="num" id="3801428">0</span><span class="op" id="3801429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801432">s1</span>&nbsp;<span class="op" id="3801435">^=</span>&nbsp;<span class="ident" id="3801438">xk</span><span class="op" id="3801440">[</span><span class="ident" id="3801441">k</span><span class="op" id="3801442">+</span><span class="num" id="3801443">1</span><span class="op" id="3801444">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801447">s2</span>&nbsp;<span class="op" id="3801450">^=</span>&nbsp;<span class="ident" id="3801453">xk</span><span class="op" id="3801455">[</span><span class="ident" id="3801456">k</span><span class="op" id="3801457">+</span><span class="num" id="3801458">2</span><span class="op" id="3801459">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801462">s3</span>&nbsp;<span class="op" id="3801465">^=</span>&nbsp;<span class="ident" id="3801468">xk</span><span class="op" id="3801470">[</span><span class="ident" id="3801471">k</span><span class="op" id="3801472">+</span><span class="num" id="3801473">3</span><span class="op" id="3801474">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801478">dst</span><span class="op" id="3801481">[</span><span class="num" id="3801482">0</span><span class="op" id="3801483">]</span><span class="op" id="3801484">,</span>&nbsp;<span class="ident" id="3801486">dst</span><span class="op" id="3801489">[</span><span class="num" id="3801490">1</span><span class="op" id="3801491">]</span><span class="op" id="3801492">,</span>&nbsp;<span class="ident" id="3801494">dst</span><span class="op" id="3801497">[</span><span class="num" id="3801498">2</span><span class="op" id="3801499">]</span><span class="op" id="3801500">,</span>&nbsp;<span class="ident" id="3801502">dst</span><span class="op" id="3801505">[</span><span class="num" id="3801506">3</span><span class="op" id="3801507">]</span>&nbsp;<span class="op" id="3801509">=</span>&nbsp;<span class="builtintype" id="3801511">byte</span><span class="op" id="3801515">(</span><span class="ident" id="3801516">s0</span><span class="op" id="3801518">&gt;&gt;</span><span class="num" id="3801520">24</span><span class="op" id="3801522">)</span><span class="op" id="3801523">,</span>&nbsp;<span class="builtintype" id="3801525">byte</span><span class="op" id="3801529">(</span><span class="ident" id="3801530">s0</span><span class="op" id="3801532">&gt;&gt;</span><span class="num" id="3801534">16</span><span class="op" id="3801536">)</span><span class="op" id="3801537">,</span>&nbsp;<span class="builtintype" id="3801539">byte</span><span class="op" id="3801543">(</span><span class="ident" id="3801544">s0</span><span class="op" id="3801546">&gt;&gt;</span><span class="num" id="3801548">8</span><span class="op" id="3801549">)</span><span class="op" id="3801550">,</span>&nbsp;<span class="builtintype" id="3801552">byte</span><span class="op" id="3801556">(</span><span class="ident" id="3801557">s0</span><span class="op" id="3801559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801562">dst</span><span class="op" id="3801565">[</span><span class="num" id="3801566">4</span><span class="op" id="3801567">]</span><span class="op" id="3801568">,</span>&nbsp;<span class="ident" id="3801570">dst</span><span class="op" id="3801573">[</span><span class="num" id="3801574">5</span><span class="op" id="3801575">]</span><span class="op" id="3801576">,</span>&nbsp;<span class="ident" id="3801578">dst</span><span class="op" id="3801581">[</span><span class="num" id="3801582">6</span><span class="op" id="3801583">]</span><span class="op" id="3801584">,</span>&nbsp;<span class="ident" id="3801586">dst</span><span class="op" id="3801589">[</span><span class="num" id="3801590">7</span><span class="op" id="3801591">]</span>&nbsp;<span class="op" id="3801593">=</span>&nbsp;<span class="builtintype" id="3801595">byte</span><span class="op" id="3801599">(</span><span class="ident" id="3801600">s1</span><span class="op" id="3801602">&gt;&gt;</span><span class="num" id="3801604">24</span><span class="op" id="3801606">)</span><span class="op" id="3801607">,</span>&nbsp;<span class="builtintype" id="3801609">byte</span><span class="op" id="3801613">(</span><span class="ident" id="3801614">s1</span><span class="op" id="3801616">&gt;&gt;</span><span class="num" id="3801618">16</span><span class="op" id="3801620">)</span><span class="op" id="3801621">,</span>&nbsp;<span class="builtintype" id="3801623">byte</span><span class="op" id="3801627">(</span><span class="ident" id="3801628">s1</span><span class="op" id="3801630">&gt;&gt;</span><span class="num" id="3801632">8</span><span class="op" id="3801633">)</span><span class="op" id="3801634">,</span>&nbsp;<span class="builtintype" id="3801636">byte</span><span class="op" id="3801640">(</span><span class="ident" id="3801641">s1</span><span class="op" id="3801643">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801646">dst</span><span class="op" id="3801649">[</span><span class="num" id="3801650">8</span><span class="op" id="3801651">]</span><span class="op" id="3801652">,</span>&nbsp;<span class="ident" id="3801654">dst</span><span class="op" id="3801657">[</span><span class="num" id="3801658">9</span><span class="op" id="3801659">]</span><span class="op" id="3801660">,</span>&nbsp;<span class="ident" id="3801662">dst</span><span class="op" id="3801665">[</span><span class="num" id="3801666">10</span><span class="op" id="3801668">]</span><span class="op" id="3801669">,</span>&nbsp;<span class="ident" id="3801671">dst</span><span class="op" id="3801674">[</span><span class="num" id="3801675">11</span><span class="op" id="3801677">]</span>&nbsp;<span class="op" id="3801679">=</span>&nbsp;<span class="builtintype" id="3801681">byte</span><span class="op" id="3801685">(</span><span class="ident" id="3801686">s2</span><span class="op" id="3801688">&gt;&gt;</span><span class="num" id="3801690">24</span><span class="op" id="3801692">)</span><span class="op" id="3801693">,</span>&nbsp;<span class="builtintype" id="3801695">byte</span><span class="op" id="3801699">(</span><span class="ident" id="3801700">s2</span><span class="op" id="3801702">&gt;&gt;</span><span class="num" id="3801704">16</span><span class="op" id="3801706">)</span><span class="op" id="3801707">,</span>&nbsp;<span class="builtintype" id="3801709">byte</span><span class="op" id="3801713">(</span><span class="ident" id="3801714">s2</span><span class="op" id="3801716">&gt;&gt;</span><span class="num" id="3801718">8</span><span class="op" id="3801719">)</span><span class="op" id="3801720">,</span>&nbsp;<span class="builtintype" id="3801722">byte</span><span class="op" id="3801726">(</span><span class="ident" id="3801727">s2</span><span class="op" id="3801729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801732">dst</span><span class="op" id="3801735">[</span><span class="num" id="3801736">12</span><span class="op" id="3801738">]</span><span class="op" id="3801739">,</span>&nbsp;<span class="ident" id="3801741">dst</span><span class="op" id="3801744">[</span><span class="num" id="3801745">13</span><span class="op" id="3801747">]</span><span class="op" id="3801748">,</span>&nbsp;<span class="ident" id="3801750">dst</span><span class="op" id="3801753">[</span><span class="num" id="3801754">14</span><span class="op" id="3801756">]</span><span class="op" id="3801757">,</span>&nbsp;<span class="ident" id="3801759">dst</span><span class="op" id="3801762">[</span><span class="num" id="3801763">15</span><span class="op" id="3801765">]</span>&nbsp;<span class="op" id="3801767">=</span>&nbsp;<span class="builtintype" id="3801769">byte</span><span class="op" id="3801773">(</span><span class="ident" id="3801774">s3</span><span class="op" id="3801776">&gt;&gt;</span><span class="num" id="3801778">24</span><span class="op" id="3801780">)</span><span class="op" id="3801781">,</span>&nbsp;<span class="builtintype" id="3801783">byte</span><span class="op" id="3801787">(</span><span class="ident" id="3801788">s3</span><span class="op" id="3801790">&gt;&gt;</span><span class="num" id="3801792">16</span><span class="op" id="3801794">)</span><span class="op" id="3801795">,</span>&nbsp;<span class="builtintype" id="3801797">byte</span><span class="op" id="3801801">(</span><span class="ident" id="3801802">s3</span><span class="op" id="3801804">&gt;&gt;</span><span class="num" id="3801806">8</span><span class="op" id="3801807">)</span><span class="op" id="3801808">,</span>&nbsp;<span class="builtintype" id="3801810">byte</span><span class="op" id="3801814">(</span><span class="ident" id="3801815">s3</span><span class="op" id="3801817">)</span><br>
<span class="lineno"></span><span class="op" id="3801819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3801822">//&nbsp;Apply&nbsp;sbox0&nbsp;to&nbsp;each&nbsp;byte&nbsp;in&nbsp;w.</span><br>
<span class="lineno">130</span><span class="keyword" id="3801856">func</span>&nbsp;<span class="ident" id="3801861">subw</span><span class="op" id="3801865">(</span><span class="ident" id="3801866">w</span>&nbsp;<span class="builtintype" id="3801868">uint32</span><span class="op" id="3801874">)</span>&nbsp;<span class="builtintype" id="3801876">uint32</span>&nbsp;<span class="op" id="3801883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801886">return</span>&nbsp;<span class="builtintype" id="3801893">uint32</span><span class="op" id="3801899">(</span><span class="ident" id="3801900">sbox0</span><span class="op" id="3801905">[</span><span class="ident" id="3801906">w</span><span class="op" id="3801907">&gt;&gt;</span><span class="num" id="3801909">24</span><span class="op" id="3801911">]</span><span class="op" id="3801912">)</span><span class="op" id="3801913">&lt;&lt;</span><span class="num" id="3801915">24</span>&nbsp;<span class="op" id="3801918">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3801922">uint32</span><span class="op" id="3801928">(</span><span class="ident" id="3801929">sbox0</span><span class="op" id="3801934">[</span><span class="ident" id="3801935">w</span><span class="op" id="3801936">&gt;&gt;</span><span class="num" id="3801938">16</span><span class="op" id="3801940">&amp;</span><span class="num" id="3801941">0xff</span><span class="op" id="3801945">]</span><span class="op" id="3801946">)</span><span class="op" id="3801947">&lt;&lt;</span><span class="num" id="3801949">16</span>&nbsp;<span class="op" id="3801952">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3801956">uint32</span><span class="op" id="3801962">(</span><span class="ident" id="3801963">sbox0</span><span class="op" id="3801968">[</span><span class="ident" id="3801969">w</span><span class="op" id="3801970">&gt;&gt;</span><span class="num" id="3801972">8</span><span class="op" id="3801973">&amp;</span><span class="num" id="3801974">0xff</span><span class="op" id="3801978">]</span><span class="op" id="3801979">)</span><span class="op" id="3801980">&lt;&lt;</span><span class="num" id="3801982">8</span>&nbsp;<span class="op" id="3801984">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3801988">uint32</span><span class="op" id="3801994">(</span><span class="ident" id="3801995">sbox0</span><span class="op" id="3802000">[</span><span class="ident" id="3802001">w</span><span class="op" id="3802002">&amp;</span><span class="num" id="3802003">0xff</span><span class="op" id="3802007">]</span><span class="op" id="3802008">)</span><br>
<span class="lineno">135</span><span class="op" id="3802010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3802013">//&nbsp;Rotate</span><br>
<span class="lineno"></span><span class="keyword" id="3802023">func</span>&nbsp;<span class="ident" id="3802028">rotw</span><span class="op" id="3802032">(</span><span class="ident" id="3802033">w</span>&nbsp;<span class="builtintype" id="3802035">uint32</span><span class="op" id="3802041">)</span>&nbsp;<span class="builtintype" id="3802043">uint32</span>&nbsp;<span class="op" id="3802050">{</span>&nbsp;<span class="keyword" id="3802052">return</span>&nbsp;<span class="ident" id="3802059">w</span><span class="op" id="3802060">&lt;&lt;</span><span class="num" id="3802062">8</span>&nbsp;<span class="op" id="3802064">|</span>&nbsp;<span class="ident" id="3802066">w</span><span class="op" id="3802067">&gt;&gt;</span><span class="num" id="3802069">24</span>&nbsp;<span class="op" id="3802072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3802075">//&nbsp;Key&nbsp;expansion&nbsp;algorithm.&nbsp;&nbsp;See&nbsp;FIPS-197,&nbsp;Figure&nbsp;11.</span><br>
<span class="lineno"></span><span class="comment" id="3802129">//&nbsp;Their&nbsp;rcon[i]&nbsp;is&nbsp;our&nbsp;powx[i-1]&nbsp;&lt;&lt;&nbsp;24.</span><br>
<span class="lineno"></span><span class="keyword" id="3802170">func</span>&nbsp;<span class="ident" id="3802175">expandKeyGo</span><span class="op" id="3802186">(</span><span class="ident" id="3802187">key</span>&nbsp;<span class="op" id="3802191">[</span><span class="op" id="3802192">]</span><span class="builtintype" id="3802193">byte</span><span class="op" id="3802197">,</span>&nbsp;<span class="ident" id="3802199">enc</span><span class="op" id="3802202">,</span>&nbsp;<span class="ident" id="3802204">dec</span>&nbsp;<span class="op" id="3802208">[</span><span class="op" id="3802209">]</span><span class="builtintype" id="3802210">uint32</span><span class="op" id="3802216">)</span>&nbsp;<span class="op" id="3802218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3802221">//&nbsp;Encryption&nbsp;key&nbsp;setup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802247">var</span>&nbsp;<span class="ident" id="3802251">i</span>&nbsp;<span class="builtintype" id="3802253">int</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802258">nk</span>&nbsp;<span class="op" id="3802261">:=</span>&nbsp;<span class="builtinfunc" id="3802264">len</span><span class="op" id="3802267">(</span><span class="ident" id="3802268">key</span><span class="op" id="3802271">)</span>&nbsp;<span class="op" id="3802273">/</span>&nbsp;<span class="num" id="3802275">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802278">for</span>&nbsp;<span class="ident" id="3802282">i</span>&nbsp;<span class="op" id="3802284">=</span>&nbsp;<span class="num" id="3802286">0</span><span class="op" id="3802287">;</span>&nbsp;<span class="ident" id="3802289">i</span>&nbsp;<span class="op" id="3802291">&lt;</span>&nbsp;<span class="ident" id="3802293">nk</span><span class="op" id="3802295">;</span>&nbsp;<span class="ident" id="3802297">i</span><span class="op" id="3802298">++</span>&nbsp;<span class="op" id="3802301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802305">enc</span><span class="op" id="3802308">[</span><span class="ident" id="3802309">i</span><span class="op" id="3802310">]</span>&nbsp;<span class="op" id="3802312">=</span>&nbsp;<span class="builtintype" id="3802314">uint32</span><span class="op" id="3802320">(</span><span class="ident" id="3802321">key</span><span class="op" id="3802324">[</span><span class="num" id="3802325">4</span><span class="op" id="3802326">*</span><span class="ident" id="3802327">i</span><span class="op" id="3802328">]</span><span class="op" id="3802329">)</span><span class="op" id="3802330">&lt;&lt;</span><span class="num" id="3802332">24</span>&nbsp;<span class="op" id="3802335">|</span>&nbsp;<span class="builtintype" id="3802337">uint32</span><span class="op" id="3802343">(</span><span class="ident" id="3802344">key</span><span class="op" id="3802347">[</span><span class="num" id="3802348">4</span><span class="op" id="3802349">*</span><span class="ident" id="3802350">i</span><span class="op" id="3802351">+</span><span class="num" id="3802352">1</span><span class="op" id="3802353">]</span><span class="op" id="3802354">)</span><span class="op" id="3802355">&lt;&lt;</span><span class="num" id="3802357">16</span>&nbsp;<span class="op" id="3802360">|</span>&nbsp;<span class="builtintype" id="3802362">uint32</span><span class="op" id="3802368">(</span><span class="ident" id="3802369">key</span><span class="op" id="3802372">[</span><span class="num" id="3802373">4</span><span class="op" id="3802374">*</span><span class="ident" id="3802375">i</span><span class="op" id="3802376">+</span><span class="num" id="3802377">2</span><span class="op" id="3802378">]</span><span class="op" id="3802379">)</span><span class="op" id="3802380">&lt;&lt;</span><span class="num" id="3802382">8</span>&nbsp;<span class="op" id="3802384">|</span>&nbsp;<span class="builtintype" id="3802386">uint32</span><span class="op" id="3802392">(</span><span class="ident" id="3802393">key</span><span class="op" id="3802396">[</span><span class="num" id="3802397">4</span><span class="op" id="3802398">*</span><span class="ident" id="3802399">i</span><span class="op" id="3802400">+</span><span class="num" id="3802401">3</span><span class="op" id="3802402">]</span><span class="op" id="3802403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802409">for</span>&nbsp;<span class="op" id="3802413">;</span>&nbsp;<span class="ident" id="3802415">i</span>&nbsp;<span class="op" id="3802417">&lt;</span>&nbsp;<span class="builtinfunc" id="3802419">len</span><span class="op" id="3802422">(</span><span class="ident" id="3802423">enc</span><span class="op" id="3802426">)</span><span class="op" id="3802427">;</span>&nbsp;<span class="ident" id="3802429">i</span><span class="op" id="3802430">++</span>&nbsp;<span class="op" id="3802433">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802437">t</span>&nbsp;<span class="op" id="3802439">:=</span>&nbsp;<span class="ident" id="3802442">enc</span><span class="op" id="3802445">[</span><span class="ident" id="3802446">i</span><span class="op" id="3802447">-</span><span class="num" id="3802448">1</span><span class="op" id="3802449">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802453">if</span>&nbsp;<span class="ident" id="3802456">i</span><span class="op" id="3802457">%</span><span class="ident" id="3802458">nk</span>&nbsp;<span class="op" id="3802461">==</span>&nbsp;<span class="num" id="3802464">0</span>&nbsp;<span class="op" id="3802466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802471">t</span>&nbsp;<span class="op" id="3802473">=</span>&nbsp;<span class="ident" id="3802475">subw</span><span class="op" id="3802479">(</span><span class="ident" id="3802480">rotw</span><span class="op" id="3802484">(</span><span class="ident" id="3802485">t</span><span class="op" id="3802486">)</span><span class="op" id="3802487">)</span>&nbsp;<span class="op" id="3802489">^</span>&nbsp;<span class="op" id="3802491">(</span><span class="builtintype" id="3802492">uint32</span><span class="op" id="3802498">(</span><span class="ident" id="3802499">powx</span><span class="op" id="3802503">[</span><span class="ident" id="3802504">i</span><span class="op" id="3802505">/</span><span class="ident" id="3802506">nk</span><span class="op" id="3802508">-</span><span class="num" id="3802509">1</span><span class="op" id="3802510">]</span><span class="op" id="3802511">)</span>&nbsp;<span class="op" id="3802513">&lt;&lt;</span>&nbsp;<span class="num" id="3802516">24</span><span class="op" id="3802518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802522">}</span>&nbsp;<span class="keyword" id="3802524">else</span>&nbsp;<span class="keyword" id="3802529">if</span>&nbsp;<span class="ident" id="3802532">nk</span>&nbsp;<span class="op" id="3802535">&gt;</span>&nbsp;<span class="num" id="3802537">6</span>&nbsp;<span class="op" id="3802539">&amp;&amp;</span>&nbsp;<span class="ident" id="3802542">i</span><span class="op" id="3802543">%</span><span class="ident" id="3802544">nk</span>&nbsp;<span class="op" id="3802547">==</span>&nbsp;<span class="num" id="3802550">4</span>&nbsp;<span class="op" id="3802552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802557">t</span>&nbsp;<span class="op" id="3802559">=</span>&nbsp;<span class="ident" id="3802561">subw</span><span class="op" id="3802565">(</span><span class="ident" id="3802566">t</span><span class="op" id="3802567">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802575">enc</span><span class="op" id="3802578">[</span><span class="ident" id="3802579">i</span><span class="op" id="3802580">]</span>&nbsp;<span class="op" id="3802582">=</span>&nbsp;<span class="ident" id="3802584">enc</span><span class="op" id="3802587">[</span><span class="ident" id="3802588">i</span><span class="op" id="3802589">-</span><span class="ident" id="3802590">nk</span><span class="op" id="3802592">]</span>&nbsp;<span class="op" id="3802594">^</span>&nbsp;<span class="ident" id="3802596">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3802603">//&nbsp;Derive&nbsp;decryption&nbsp;key&nbsp;from&nbsp;encryption&nbsp;key.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3802650">//&nbsp;Reverse&nbsp;the&nbsp;4-word&nbsp;round&nbsp;key&nbsp;sets&nbsp;from&nbsp;enc&nbsp;to&nbsp;produce&nbsp;dec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3802713">//&nbsp;All&nbsp;sets&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;get&nbsp;the&nbsp;MixColumn&nbsp;transform&nbsp;applied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802786">if</span>&nbsp;<span class="ident" id="3802789">dec</span>&nbsp;<span class="op" id="3802793">==</span>&nbsp;<span class="ident" id="3802796">nil</span>&nbsp;<span class="op" id="3802800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802804">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802812">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802815">n</span>&nbsp;<span class="op" id="3802817">:=</span>&nbsp;<span class="builtinfunc" id="3802820">len</span><span class="op" id="3802823">(</span><span class="ident" id="3802824">enc</span><span class="op" id="3802827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802830">for</span>&nbsp;<span class="ident" id="3802834">i</span>&nbsp;<span class="op" id="3802836">:=</span>&nbsp;<span class="num" id="3802839">0</span><span class="op" id="3802840">;</span>&nbsp;<span class="ident" id="3802842">i</span>&nbsp;<span class="op" id="3802844">&lt;</span>&nbsp;<span class="ident" id="3802846">n</span><span class="op" id="3802847">;</span>&nbsp;<span class="ident" id="3802849">i</span>&nbsp;<span class="op" id="3802851">+=</span>&nbsp;<span class="num" id="3802854">4</span>&nbsp;<span class="op" id="3802856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802860">ei</span>&nbsp;<span class="op" id="3802863">:=</span>&nbsp;<span class="ident" id="3802866">n</span>&nbsp;<span class="op" id="3802868">-</span>&nbsp;<span class="ident" id="3802870">i</span>&nbsp;<span class="op" id="3802872">-</span>&nbsp;<span class="num" id="3802874">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802878">for</span>&nbsp;<span class="ident" id="3802882">j</span>&nbsp;<span class="op" id="3802884">:=</span>&nbsp;<span class="num" id="3802887">0</span><span class="op" id="3802888">;</span>&nbsp;<span class="ident" id="3802890">j</span>&nbsp;<span class="op" id="3802892">&lt;</span>&nbsp;<span class="num" id="3802894">4</span><span class="op" id="3802895">;</span>&nbsp;<span class="ident" id="3802897">j</span><span class="op" id="3802898">++</span>&nbsp;<span class="op" id="3802901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802906">x</span>&nbsp;<span class="op" id="3802908">:=</span>&nbsp;<span class="ident" id="3802911">enc</span><span class="op" id="3802914">[</span><span class="ident" id="3802915">ei</span><span class="op" id="3802917">+</span><span class="ident" id="3802918">j</span><span class="op" id="3802919">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802924">if</span>&nbsp;<span class="ident" id="3802927">i</span>&nbsp;<span class="op" id="3802929">&gt;</span>&nbsp;<span class="num" id="3802931">0</span>&nbsp;<span class="op" id="3802933">&amp;&amp;</span>&nbsp;<span class="ident" id="3802936">i</span><span class="op" id="3802937">+</span><span class="num" id="3802938">4</span>&nbsp;<span class="op" id="3802940">&lt;</span>&nbsp;<span class="ident" id="3802942">n</span>&nbsp;<span class="op" id="3802944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802950">x</span>&nbsp;<span class="op" id="3802952">=</span>&nbsp;<span class="ident" id="3802954">td0</span><span class="op" id="3802957">[</span><span class="ident" id="3802958">sbox0</span><span class="op" id="3802963">[</span><span class="ident" id="3802964">x</span><span class="op" id="3802965">&gt;&gt;</span><span class="num" id="3802967">24</span><span class="op" id="3802969">]</span><span class="op" id="3802970">]</span>&nbsp;<span class="op" id="3802972">^</span>&nbsp;<span class="ident" id="3802974">td1</span><span class="op" id="3802977">[</span><span class="ident" id="3802978">sbox0</span><span class="op" id="3802983">[</span><span class="ident" id="3802984">x</span><span class="op" id="3802985">&gt;&gt;</span><span class="num" id="3802987">16</span><span class="op" id="3802989">&amp;</span><span class="num" id="3802990">0xff</span><span class="op" id="3802994">]</span><span class="op" id="3802995">]</span>&nbsp;<span class="op" id="3802997">^</span>&nbsp;<span class="ident" id="3802999">td2</span><span class="op" id="3803002">[</span><span class="ident" id="3803003">sbox0</span><span class="op" id="3803008">[</span><span class="ident" id="3803009">x</span><span class="op" id="3803010">&gt;&gt;</span><span class="num" id="3803012">8</span><span class="op" id="3803013">&amp;</span><span class="num" id="3803014">0xff</span><span class="op" id="3803018">]</span><span class="op" id="3803019">]</span>&nbsp;<span class="op" id="3803021">^</span>&nbsp;<span class="ident" id="3803023">td3</span><span class="op" id="3803026">[</span><span class="ident" id="3803027">sbox0</span><span class="op" id="3803032">[</span><span class="ident" id="3803033">x</span><span class="op" id="3803034">&amp;</span><span class="num" id="3803035">0xff</span><span class="op" id="3803039">]</span><span class="op" id="3803040">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803050">dec</span><span class="op" id="3803053">[</span><span class="ident" id="3803054">i</span><span class="op" id="3803055">+</span><span class="ident" id="3803056">j</span><span class="op" id="3803057">]</span>&nbsp;<span class="op" id="3803059">=</span>&nbsp;<span class="ident" id="3803061">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803065">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803068">}</span><br>
<span class="lineno"></span><span class="op" id="3803070">}</span>
</div>
</body>
</html>
