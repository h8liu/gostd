<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/md5</h2>
<ul>
<li><a href="/gostd/crypto/md5/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/md5/md5.go.html" class="current">md5.go</a></li>
<li><a href="/gostd/crypto/md5/md5_test.go.html">md5_test.go</a></li>
<li><a href="/gostd/crypto/md5/md5block.go.html">md5block.go</a></li>
<li><a href="/gostd/crypto/md5/md5block_decl.go.html">md5block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4135349">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4135404">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4135458">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4135509">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-full&nbsp;-output&nbsp;md5block.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4135564">//&nbsp;Package&nbsp;md5&nbsp;implements&nbsp;the&nbsp;MD5&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;1321.</span><br>
<span class="lineno"></span><span class="keyword" id="4135637">package</span>&nbsp;<span class="ident" id="4135645">md5</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4135650">import</span>&nbsp;<span class="op" id="4135657">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4135660">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4135670">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4135677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4135680">func</span>&nbsp;<span class="ident" id="4135685">init</span><span class="op" id="4135689">(</span><span class="op" id="4135690">)</span>&nbsp;<span class="op" id="4135692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4135695">crypto</span><span class="op" id="4135701">.</span><span class="ident" id="4135702">RegisterHash</span><span class="op" id="4135714">(</span><span class="ident" id="4135715">crypto</span><span class="op" id="4135721">.</span><span class="ident" id="4135722">MD5</span><span class="op" id="4135725">,</span>&nbsp;<span class="ident" id="4135727">New</span><span class="op" id="4135730">)</span><br>
<span class="lineno"></span><span class="op" id="4135732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4135735">//&nbsp;The&nbsp;size&nbsp;of&nbsp;an&nbsp;MD5&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno">20</span><span class="keyword" id="4135776">const</span>&nbsp;<span class="ident" id="4135782">Size</span>&nbsp;<span class="op" id="4135787">=</span>&nbsp;<span class="num" id="4135789">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4135793">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;MD5&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4135827">const</span>&nbsp;<span class="ident" id="4135833">BlockSize</span>&nbsp;<span class="op" id="4135843">=</span>&nbsp;<span class="num" id="4135845">64</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="4135849">const</span>&nbsp;<span class="op" id="4135855">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4135858">chunk</span>&nbsp;<span class="op" id="4135864">=</span>&nbsp;<span class="num" id="4135866">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4135870">init0</span>&nbsp;<span class="op" id="4135876">=</span>&nbsp;<span class="num" id="4135878">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4135890">init1</span>&nbsp;<span class="op" id="4135896">=</span>&nbsp;<span class="num" id="4135898">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4135910">init2</span>&nbsp;<span class="op" id="4135916">=</span>&nbsp;<span class="num" id="4135918">0x98BADCFE</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4135930">init3</span>&nbsp;<span class="op" id="4135936">=</span>&nbsp;<span class="num" id="4135938">0x10325476</span><br>
<span class="lineno"></span><span class="op" id="4135949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4135952">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4136011">type</span>&nbsp;<span class="ident" id="4136016">digest</span>&nbsp;<span class="keyword" id="4136023">struct</span>&nbsp;<span class="op" id="4136030">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136033">s</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4136037">[</span><span class="num" id="4136038">4</span><span class="op" id="4136039">]</span><span class="builtintype" id="4136040">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136048">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4136052">[</span><span class="ident" id="4136053">chunk</span><span class="op" id="4136058">]</span><span class="builtintype" id="4136059">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136065">nx</span>&nbsp;&nbsp;<span class="builtintype" id="4136069">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4136074">len</span>&nbsp;<span class="ident" id="4136078">uint64</span><br>
<span class="lineno"></span><span class="op" id="4136085">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4136088">func</span>&nbsp;<span class="op" id="4136093">(</span><span class="ident" id="4136094">d</span>&nbsp;<span class="op" id="4136096">*</span><span class="ident" id="4136097">digest</span><span class="op" id="4136103">)</span>&nbsp;<span class="ident" id="4136105">Reset</span><span class="op" id="4136110">(</span><span class="op" id="4136111">)</span>&nbsp;<span class="op" id="4136113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136116">d</span><span class="op" id="4136117">.</span><span class="ident" id="4136118">s</span><span class="op" id="4136119">[</span><span class="num" id="4136120">0</span><span class="op" id="4136121">]</span>&nbsp;<span class="op" id="4136123">=</span>&nbsp;<span class="ident" id="4136125">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136132">d</span><span class="op" id="4136133">.</span><span class="ident" id="4136134">s</span><span class="op" id="4136135">[</span><span class="num" id="4136136">1</span><span class="op" id="4136137">]</span>&nbsp;<span class="op" id="4136139">=</span>&nbsp;<span class="ident" id="4136141">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136148">d</span><span class="op" id="4136149">.</span><span class="ident" id="4136150">s</span><span class="op" id="4136151">[</span><span class="num" id="4136152">2</span><span class="op" id="4136153">]</span>&nbsp;<span class="op" id="4136155">=</span>&nbsp;<span class="ident" id="4136157">init2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136164">d</span><span class="op" id="4136165">.</span><span class="ident" id="4136166">s</span><span class="op" id="4136167">[</span><span class="num" id="4136168">3</span><span class="op" id="4136169">]</span>&nbsp;<span class="op" id="4136171">=</span>&nbsp;<span class="ident" id="4136173">init3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136180">d</span><span class="op" id="4136181">.</span><span class="ident" id="4136182">nx</span>&nbsp;<span class="op" id="4136185">=</span>&nbsp;<span class="num" id="4136187">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136190">d</span><span class="op" id="4136191">.</span><span class="builtinfunc" id="4136192">len</span>&nbsp;<span class="op" id="4136196">=</span>&nbsp;<span class="num" id="4136198">0</span><br>
<span class="lineno"></span><span class="op" id="4136200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4136203">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;MD5&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4136262">func</span>&nbsp;<span class="ident" id="4136267">New</span><span class="op" id="4136270">(</span><span class="op" id="4136271">)</span>&nbsp;<span class="ident" id="4136273">hash</span><span class="op" id="4136277">.</span><span class="ident" id="4136278">Hash</span>&nbsp;<span class="op" id="4136283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136286">d</span>&nbsp;<span class="op" id="4136288">:=</span>&nbsp;<span class="builtinfunc" id="4136291">new</span><span class="op" id="4136294">(</span><span class="ident" id="4136295">digest</span><span class="op" id="4136301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136304">d</span><span class="op" id="4136305">.</span><span class="ident" id="4136306">Reset</span><span class="op" id="4136311">(</span><span class="op" id="4136312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4136315">return</span>&nbsp;<span class="ident" id="4136322">d</span><br>
<span class="lineno">55</span><span class="op" id="4136324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4136327">func</span>&nbsp;<span class="op" id="4136332">(</span><span class="ident" id="4136333">d</span>&nbsp;<span class="op" id="4136335">*</span><span class="ident" id="4136336">digest</span><span class="op" id="4136342">)</span>&nbsp;<span class="ident" id="4136344">Size</span><span class="op" id="4136348">(</span><span class="op" id="4136349">)</span>&nbsp;<span class="builtintype" id="4136351">int</span>&nbsp;<span class="op" id="4136355">{</span>&nbsp;<span class="keyword" id="4136357">return</span>&nbsp;<span class="ident" id="4136364">Size</span>&nbsp;<span class="op" id="4136369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4136372">func</span>&nbsp;<span class="op" id="4136377">(</span><span class="ident" id="4136378">d</span>&nbsp;<span class="op" id="4136380">*</span><span class="ident" id="4136381">digest</span><span class="op" id="4136387">)</span>&nbsp;<span class="ident" id="4136389">BlockSize</span><span class="op" id="4136398">(</span><span class="op" id="4136399">)</span>&nbsp;<span class="builtintype" id="4136401">int</span>&nbsp;<span class="op" id="4136405">{</span>&nbsp;<span class="keyword" id="4136407">return</span>&nbsp;<span class="ident" id="4136414">BlockSize</span>&nbsp;<span class="op" id="4136424">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4136427">func</span>&nbsp;<span class="op" id="4136432">(</span><span class="ident" id="4136433">d</span>&nbsp;<span class="op" id="4136435">*</span><span class="ident" id="4136436">digest</span><span class="op" id="4136442">)</span>&nbsp;<span class="ident" id="4136444">Write</span><span class="op" id="4136449">(</span><span class="ident" id="4136450">p</span>&nbsp;<span class="op" id="4136452">[</span><span class="op" id="4136453">]</span><span class="builtintype" id="4136454">byte</span><span class="op" id="4136458">)</span>&nbsp;<span class="op" id="4136460">(</span><span class="ident" id="4136461">nn</span>&nbsp;<span class="builtintype" id="4136464">int</span><span class="op" id="4136467">,</span>&nbsp;<span class="ident" id="4136469">err</span>&nbsp;<span class="builtintype" id="4136473">error</span><span class="op" id="4136478">)</span>&nbsp;<span class="op" id="4136480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136483">nn</span>&nbsp;<span class="op" id="4136486">=</span>&nbsp;<span class="builtinfunc" id="4136488">len</span><span class="op" id="4136491">(</span><span class="ident" id="4136492">p</span><span class="op" id="4136493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136496">d</span><span class="op" id="4136497">.</span><span class="builtinfunc" id="4136498">len</span>&nbsp;<span class="op" id="4136502">+=</span>&nbsp;<span class="ident" id="4136505">uint64</span><span class="op" id="4136511">(</span><span class="ident" id="4136512">nn</span><span class="op" id="4136514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4136517">if</span>&nbsp;<span class="ident" id="4136520">d</span><span class="op" id="4136521">.</span><span class="ident" id="4136522">nx</span>&nbsp;<span class="op" id="4136525">&gt;</span>&nbsp;<span class="num" id="4136527">0</span>&nbsp;<span class="op" id="4136529">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136533">n</span>&nbsp;<span class="op" id="4136535">:=</span>&nbsp;<span class="builtinfunc" id="4136538">len</span><span class="op" id="4136541">(</span><span class="ident" id="4136542">p</span><span class="op" id="4136543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4136547">if</span>&nbsp;<span class="ident" id="4136550">n</span>&nbsp;<span class="op" id="4136552">&gt;</span>&nbsp;<span class="ident" id="4136554">chunk</span><span class="op" id="4136559">-</span><span class="ident" id="4136560">d</span><span class="op" id="4136561">.</span><span class="ident" id="4136562">nx</span>&nbsp;<span class="op" id="4136565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136570">n</span>&nbsp;<span class="op" id="4136572">=</span>&nbsp;<span class="ident" id="4136574">chunk</span>&nbsp;<span class="op" id="4136580">-</span>&nbsp;<span class="ident" id="4136582">d</span><span class="op" id="4136583">.</span><span class="ident" id="4136584">nx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4136589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4136593">for</span>&nbsp;<span class="ident" id="4136597">i</span>&nbsp;<span class="op" id="4136599">:=</span>&nbsp;<span class="num" id="4136602">0</span><span class="op" id="4136603">;</span>&nbsp;<span class="ident" id="4136605">i</span>&nbsp;<span class="op" id="4136607">&lt;</span>&nbsp;<span class="ident" id="4136609">n</span><span class="op" id="4136610">;</span>&nbsp;<span class="ident" id="4136612">i</span><span class="op" id="4136613">++</span>&nbsp;<span class="op" id="4136616">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136621">d</span><span class="op" id="4136622">.</span><span class="ident" id="4136623">x</span><span class="op" id="4136624">[</span><span class="ident" id="4136625">d</span><span class="op" id="4136626">.</span><span class="ident" id="4136627">nx</span><span class="op" id="4136629">+</span><span class="ident" id="4136630">i</span><span class="op" id="4136631">]</span>&nbsp;<span class="op" id="4136633">=</span>&nbsp;<span class="ident" id="4136635">p</span><span class="op" id="4136636">[</span><span class="ident" id="4136637">i</span><span class="op" id="4136638">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4136642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136646">d</span><span class="op" id="4136647">.</span><span class="ident" id="4136648">nx</span>&nbsp;<span class="op" id="4136651">+=</span>&nbsp;<span class="ident" id="4136654">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4136658">if</span>&nbsp;<span class="ident" id="4136661">d</span><span class="op" id="4136662">.</span><span class="ident" id="4136663">nx</span>&nbsp;<span class="op" id="4136666">==</span>&nbsp;<span class="ident" id="4136669">chunk</span>&nbsp;<span class="op" id="4136675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136680">block</span><span class="op" id="4136685">(</span><span class="ident" id="4136686">d</span><span class="op" id="4136687">,</span>&nbsp;<span class="ident" id="4136689">d</span><span class="op" id="4136690">.</span><span class="ident" id="4136691">x</span><span class="op" id="4136692">[</span><span class="num" id="4136693">0</span><span class="op" id="4136694">:</span><span class="ident" id="4136695">chunk</span><span class="op" id="4136700">]</span><span class="op" id="4136701">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136706">d</span><span class="op" id="4136707">.</span><span class="ident" id="4136708">nx</span>&nbsp;<span class="op" id="4136711">=</span>&nbsp;<span class="num" id="4136713">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4136717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136721">p</span>&nbsp;<span class="op" id="4136723">=</span>&nbsp;<span class="ident" id="4136725">p</span><span class="op" id="4136726">[</span><span class="ident" id="4136727">n</span><span class="op" id="4136728">:</span><span class="op" id="4136729">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4136732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4136735">if</span>&nbsp;<span class="builtinfunc" id="4136738">len</span><span class="op" id="4136741">(</span><span class="ident" id="4136742">p</span><span class="op" id="4136743">)</span>&nbsp;<span class="op" id="4136745">&gt;=</span>&nbsp;<span class="ident" id="4136748">chunk</span>&nbsp;<span class="op" id="4136754">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136758">n</span>&nbsp;<span class="op" id="4136760">:=</span>&nbsp;<span class="builtinfunc" id="4136763">len</span><span class="op" id="4136766">(</span><span class="ident" id="4136767">p</span><span class="op" id="4136768">)</span>&nbsp;<span class="op" id="4136770">&amp;^</span>&nbsp;<span class="op" id="4136773">(</span><span class="ident" id="4136774">chunk</span>&nbsp;<span class="op" id="4136780">-</span>&nbsp;<span class="num" id="4136782">1</span><span class="op" id="4136783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136787">block</span><span class="op" id="4136792">(</span><span class="ident" id="4136793">d</span><span class="op" id="4136794">,</span>&nbsp;<span class="ident" id="4136796">p</span><span class="op" id="4136797">[</span><span class="op" id="4136798">:</span><span class="ident" id="4136799">n</span><span class="op" id="4136800">]</span><span class="op" id="4136801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136805">p</span>&nbsp;<span class="op" id="4136807">=</span>&nbsp;<span class="ident" id="4136809">p</span><span class="op" id="4136810">[</span><span class="ident" id="4136811">n</span><span class="op" id="4136812">:</span><span class="op" id="4136813">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4136816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4136819">if</span>&nbsp;<span class="builtinfunc" id="4136822">len</span><span class="op" id="4136825">(</span><span class="ident" id="4136826">p</span><span class="op" id="4136827">)</span>&nbsp;<span class="op" id="4136829">&gt;</span>&nbsp;<span class="num" id="4136831">0</span>&nbsp;<span class="op" id="4136833">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136837">d</span><span class="op" id="4136838">.</span><span class="ident" id="4136839">nx</span>&nbsp;<span class="op" id="4136842">=</span>&nbsp;<span class="builtinfunc" id="4136844">copy</span><span class="op" id="4136848">(</span><span class="ident" id="4136849">d</span><span class="op" id="4136850">.</span><span class="ident" id="4136851">x</span><span class="op" id="4136852">[</span><span class="op" id="4136853">:</span><span class="op" id="4136854">]</span><span class="op" id="4136855">,</span>&nbsp;<span class="ident" id="4136857">p</span><span class="op" id="4136858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4136861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4136864">return</span><br>
<span class="lineno"></span><span class="op" id="4136871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4136874">func</span>&nbsp;<span class="op" id="4136879">(</span><span class="ident" id="4136880">d0</span>&nbsp;<span class="op" id="4136883">*</span><span class="ident" id="4136884">digest</span><span class="op" id="4136890">)</span>&nbsp;<span class="ident" id="4136892">Sum</span><span class="op" id="4136895">(</span><span class="ident" id="4136896">in</span>&nbsp;<span class="op" id="4136899">[</span><span class="op" id="4136900">]</span><span class="builtintype" id="4136901">byte</span><span class="op" id="4136905">)</span>&nbsp;<span class="op" id="4136907">[</span><span class="op" id="4136908">]</span><span class="builtintype" id="4136909">byte</span>&nbsp;<span class="op" id="4136914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4136917">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136984">d</span>&nbsp;<span class="op" id="4136986">:=</span>&nbsp;<span class="op" id="4136989">*</span><span class="ident" id="4136990">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4136994">hash</span>&nbsp;<span class="op" id="4136999">:=</span>&nbsp;<span class="ident" id="4137002">d</span><span class="op" id="4137003">.</span><span class="ident" id="4137004">checkSum</span><span class="op" id="4137012">(</span><span class="op" id="4137013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4137016">return</span>&nbsp;<span class="builtinfunc" id="4137023">append</span><span class="op" id="4137029">(</span><span class="ident" id="4137030">in</span><span class="op" id="4137032">,</span>&nbsp;<span class="ident" id="4137034">hash</span><span class="op" id="4137038">[</span><span class="op" id="4137039">:</span><span class="op" id="4137040">]</span><span class="op" id="4137041">...</span><span class="op" id="4137044">)</span><br>
<span class="lineno">95</span><span class="op" id="4137046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4137049">func</span>&nbsp;<span class="op" id="4137054">(</span><span class="ident" id="4137055">d</span>&nbsp;<span class="op" id="4137057">*</span><span class="ident" id="4137058">digest</span><span class="op" id="4137064">)</span>&nbsp;<span class="ident" id="4137066">checkSum</span><span class="op" id="4137074">(</span><span class="op" id="4137075">)</span>&nbsp;<span class="op" id="4137077">[</span><span class="ident" id="4137078">Size</span><span class="op" id="4137082">]</span><span class="builtintype" id="4137083">byte</span>&nbsp;<span class="op" id="4137088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4137091">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4137151">len</span>&nbsp;<span class="op" id="4137155">:=</span>&nbsp;<span class="ident" id="4137158">d</span><span class="op" id="4137159">.</span><span class="builtinfunc" id="4137160">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4137165">var</span>&nbsp;<span class="ident" id="4137169">tmp</span>&nbsp;<span class="op" id="4137173">[</span><span class="num" id="4137174">64</span><span class="op" id="4137176">]</span><span class="builtintype" id="4137177">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4137183">tmp</span><span class="op" id="4137186">[</span><span class="num" id="4137187">0</span><span class="op" id="4137188">]</span>&nbsp;<span class="op" id="4137190">=</span>&nbsp;<span class="num" id="4137192">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4137198">if</span>&nbsp;<span class="builtinfunc" id="4137201">len</span><span class="op" id="4137204">%</span><span class="num" id="4137205">64</span>&nbsp;<span class="op" id="4137208">&lt;</span>&nbsp;<span class="num" id="4137210">56</span>&nbsp;<span class="op" id="4137213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4137217">d</span><span class="op" id="4137218">.</span><span class="ident" id="4137219">Write</span><span class="op" id="4137224">(</span><span class="ident" id="4137225">tmp</span><span class="op" id="4137228">[</span><span class="num" id="4137229">0</span>&nbsp;<span class="op" id="4137231">:</span>&nbsp;<span class="num" id="4137233">56</span><span class="op" id="4137235">-</span><span class="builtinfunc" id="4137236">len</span><span class="op" id="4137239">%</span><span class="num" id="4137240">64</span><span class="op" id="4137242">]</span><span class="op" id="4137243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4137246">}</span>&nbsp;<span class="keyword" id="4137248">else</span>&nbsp;<span class="op" id="4137253">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4137257">d</span><span class="op" id="4137258">.</span><span class="ident" id="4137259">Write</span><span class="op" id="4137264">(</span><span class="ident" id="4137265">tmp</span><span class="op" id="4137268">[</span><span class="num" id="4137269">0</span>&nbsp;<span class="op" id="4137271">:</span>&nbsp;<span class="num" id="4137273">64</span><span class="op" id="4137275">+</span><span class="num" id="4137276">56</span><span class="op" id="4137278">-</span><span class="builtinfunc" id="4137279">len</span><span class="op" id="4137282">%</span><span class="num" id="4137283">64</span><span class="op" id="4137285">]</span><span class="op" id="4137286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4137289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4137293">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4137313">len</span>&nbsp;<span class="op" id="4137317">&lt;&lt;=</span>&nbsp;<span class="num" id="4137321">3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4137324">for</span>&nbsp;<span class="ident" id="4137328">i</span>&nbsp;<span class="op" id="4137330">:=</span>&nbsp;<span class="builtintype" id="4137333">uint</span><span class="op" id="4137337">(</span><span class="num" id="4137338">0</span><span class="op" id="4137339">)</span><span class="op" id="4137340">;</span>&nbsp;<span class="ident" id="4137342">i</span>&nbsp;<span class="op" id="4137344">&lt;</span>&nbsp;<span class="num" id="4137346">8</span><span class="op" id="4137347">;</span>&nbsp;<span class="ident" id="4137349">i</span><span class="op" id="4137350">++</span>&nbsp;<span class="op" id="4137353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4137357">tmp</span><span class="op" id="4137360">[</span><span class="ident" id="4137361">i</span><span class="op" id="4137362">]</span>&nbsp;<span class="op" id="4137364">=</span>&nbsp;<span class="builtintype" id="4137366">byte</span><span class="op" id="4137370">(</span><span class="builtinfunc" id="4137371">len</span>&nbsp;<span class="op" id="4137375">&gt;&gt;</span>&nbsp;<span class="op" id="4137378">(</span><span class="num" id="4137379">8</span>&nbsp;<span class="op" id="4137381">*</span>&nbsp;<span class="ident" id="4137383">i</span><span class="op" id="4137384">)</span><span class="op" id="4137385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4137388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4137391">d</span><span class="op" id="4137392">.</span><span class="ident" id="4137393">Write</span><span class="op" id="4137398">(</span><span class="ident" id="4137399">tmp</span><span class="op" id="4137402">[</span><span class="num" id="4137403">0</span><span class="op" id="4137404">:</span><span class="num" id="4137405">8</span><span class="op" id="4137406">]</span><span class="op" id="4137407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4137411">if</span>&nbsp;<span class="ident" id="4137414">d</span><span class="op" id="4137415">.</span><span class="ident" id="4137416">nx</span>&nbsp;<span class="op" id="4137419">!=</span>&nbsp;<span class="num" id="4137422">0</span>&nbsp;<span class="op" id="4137424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4137428">panic</span><span class="op" id="4137433">(</span><span class="string" id="4137434">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="4137445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4137448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4137452">var</span>&nbsp;<span class="ident" id="4137456">digest</span>&nbsp;<span class="op" id="4137463">[</span><span class="ident" id="4137464">Size</span><span class="op" id="4137468">]</span><span class="builtintype" id="4137469">byte</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4137475">for</span>&nbsp;<span class="ident" id="4137479">i</span><span class="op" id="4137480">,</span>&nbsp;<span class="ident" id="4137482">s</span>&nbsp;<span class="op" id="4137484">:=</span>&nbsp;<span class="keyword" id="4137487">range</span>&nbsp;<span class="ident" id="4137493">d</span><span class="op" id="4137494">.</span><span class="ident" id="4137495">s</span>&nbsp;<span class="op" id="4137497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4137501">digest</span><span class="op" id="4137507">[</span><span class="ident" id="4137508">i</span><span class="op" id="4137509">*</span><span class="num" id="4137510">4</span><span class="op" id="4137511">]</span>&nbsp;<span class="op" id="4137513">=</span>&nbsp;<span class="builtintype" id="4137515">byte</span><span class="op" id="4137519">(</span><span class="ident" id="4137520">s</span><span class="op" id="4137521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4137525">digest</span><span class="op" id="4137531">[</span><span class="ident" id="4137532">i</span><span class="op" id="4137533">*</span><span class="num" id="4137534">4</span><span class="op" id="4137535">+</span><span class="num" id="4137536">1</span><span class="op" id="4137537">]</span>&nbsp;<span class="op" id="4137539">=</span>&nbsp;<span class="builtintype" id="4137541">byte</span><span class="op" id="4137545">(</span><span class="ident" id="4137546">s</span>&nbsp;<span class="op" id="4137548">&gt;&gt;</span>&nbsp;<span class="num" id="4137551">8</span><span class="op" id="4137552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4137556">digest</span><span class="op" id="4137562">[</span><span class="ident" id="4137563">i</span><span class="op" id="4137564">*</span><span class="num" id="4137565">4</span><span class="op" id="4137566">+</span><span class="num" id="4137567">2</span><span class="op" id="4137568">]</span>&nbsp;<span class="op" id="4137570">=</span>&nbsp;<span class="builtintype" id="4137572">byte</span><span class="op" id="4137576">(</span><span class="ident" id="4137577">s</span>&nbsp;<span class="op" id="4137579">&gt;&gt;</span>&nbsp;<span class="num" id="4137582">16</span><span class="op" id="4137584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4137588">digest</span><span class="op" id="4137594">[</span><span class="ident" id="4137595">i</span><span class="op" id="4137596">*</span><span class="num" id="4137597">4</span><span class="op" id="4137598">+</span><span class="num" id="4137599">3</span><span class="op" id="4137600">]</span>&nbsp;<span class="op" id="4137602">=</span>&nbsp;<span class="builtintype" id="4137604">byte</span><span class="op" id="4137608">(</span><span class="ident" id="4137609">s</span>&nbsp;<span class="op" id="4137611">&gt;&gt;</span>&nbsp;<span class="num" id="4137614">24</span><span class="op" id="4137616">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4137619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4137623">return</span>&nbsp;<span class="ident" id="4137630">digest</span><br>
<span class="lineno"></span><span class="op" id="4137637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4137640">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;MD5&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4137685">func</span>&nbsp;<span class="ident" id="4137690">Sum</span><span class="op" id="4137693">(</span><span class="ident" id="4137694">data</span>&nbsp;<span class="op" id="4137699">[</span><span class="op" id="4137700">]</span><span class="builtintype" id="4137701">byte</span><span class="op" id="4137705">)</span>&nbsp;<span class="op" id="4137707">[</span><span class="ident" id="4137708">Size</span><span class="op" id="4137712">]</span><span class="builtintype" id="4137713">byte</span>&nbsp;<span class="op" id="4137718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4137721">var</span>&nbsp;<span class="ident" id="4137725">d</span>&nbsp;<span class="ident" id="4137727">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4137735">d</span><span class="op" id="4137736">.</span><span class="ident" id="4137737">Reset</span><span class="op" id="4137742">(</span><span class="op" id="4137743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4137746">d</span><span class="op" id="4137747">.</span><span class="ident" id="4137748">Write</span><span class="op" id="4137753">(</span><span class="ident" id="4137754">data</span><span class="op" id="4137758">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4137761">return</span>&nbsp;<span class="ident" id="4137768">d</span><span class="op" id="4137769">.</span><span class="ident" id="4137770">checkSum</span><span class="op" id="4137778">(</span><span class="op" id="4137779">)</span><br>
<span class="lineno"></span><span class="op" id="4137781">}</span>
</div>
</body>
</html>
