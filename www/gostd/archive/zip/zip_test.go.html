<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8106519">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8106574">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8106628">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8106679">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8106728">package</span>&nbsp;<span class="ident" id="8106736">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8106741">import</span>&nbsp;<span class="op" id="8106748">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8106751">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8106760">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8106767">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8106775">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8106781">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8106794">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8106802">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8106813">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8106824">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8106831">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8106834">func</span>&nbsp;<span class="ident" id="8106839">TestOver65kFiles</span><span class="op" id="8106855">(</span><span class="ident" id="8106856">t</span>&nbsp;<span class="op" id="8106858">*</span><span class="ident" id="8106859">testing</span><span class="op" id="8106866">.</span><span class="ident" id="8106867">T</span><span class="op" id="8106868">)</span>&nbsp;<span class="op" id="8106870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106873">buf</span>&nbsp;<span class="op" id="8106877">:=</span>&nbsp;<span class="builtinfunc" id="8106880">new</span><span class="op" id="8106883">(</span><span class="ident" id="8106884">bytes</span><span class="op" id="8106889">.</span><span class="ident" id="8106890">Buffer</span><span class="op" id="8106896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106899">w</span>&nbsp;<span class="op" id="8106901">:=</span>&nbsp;<span class="ident" id="8106904">NewWriter</span><span class="op" id="8106913">(</span><span class="ident" id="8106914">buf</span><span class="op" id="8106917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8106920">const</span>&nbsp;<span class="ident" id="8106926">nFiles</span>&nbsp;<span class="op" id="8106933">=</span>&nbsp;<span class="op" id="8106935">(</span><span class="num" id="8106936">1</span>&nbsp;<span class="op" id="8106938">&lt;&lt;</span>&nbsp;<span class="num" id="8106941">16</span><span class="op" id="8106943">)</span>&nbsp;<span class="op" id="8106945">+</span>&nbsp;<span class="num" id="8106947">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8106951">for</span>&nbsp;<span class="ident" id="8106955">i</span>&nbsp;<span class="op" id="8106957">:=</span>&nbsp;<span class="num" id="8106960">0</span><span class="op" id="8106961">;</span>&nbsp;<span class="ident" id="8106963">i</span>&nbsp;<span class="op" id="8106965">&lt;</span>&nbsp;<span class="ident" id="8106967">nFiles</span><span class="op" id="8106973">;</span>&nbsp;<span class="ident" id="8106975">i</span><span class="op" id="8106976">++</span>&nbsp;<span class="op" id="8106979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106983">_</span><span class="op" id="8106984">,</span>&nbsp;<span class="ident" id="8106986">err</span>&nbsp;<span class="op" id="8106990">:=</span>&nbsp;<span class="ident" id="8106993">w</span><span class="op" id="8106994">.</span><span class="ident" id="8106995">CreateHeader</span><span class="op" id="8107007">(</span><span class="op" id="8107008">&amp;</span><span class="ident" id="8107009">FileHeader</span><span class="op" id="8107019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107024">Name</span><span class="op" id="8107028">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8107032">fmt</span><span class="op" id="8107035">.</span><span class="ident" id="8107036">Sprintf</span><span class="op" id="8107043">(</span><span class="string" id="8107044">&#34;%d.dat&#34;</span><span class="op" id="8107052">,</span>&nbsp;<span class="ident" id="8107054">i</span><span class="op" id="8107055">)</span><span class="op" id="8107056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107061">Method</span><span class="op" id="8107067">:</span>&nbsp;<span class="ident" id="8107069">Store</span><span class="op" id="8107074">,</span>&nbsp;<span class="comment" id="8107076">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107113">}</span><span class="op" id="8107114">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8107118">if</span>&nbsp;<span class="ident" id="8107121">err</span>&nbsp;<span class="op" id="8107125">!=</span>&nbsp;<span class="ident" id="8107128">nil</span>&nbsp;<span class="op" id="8107132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107137">t</span><span class="op" id="8107138">.</span><span class="ident" id="8107139">Fatalf</span><span class="op" id="8107145">(</span><span class="string" id="8107146">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="8107168">,</span>&nbsp;<span class="ident" id="8107170">i</span><span class="op" id="8107171">,</span>&nbsp;<span class="ident" id="8107173">err</span><span class="op" id="8107176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8107186">if</span>&nbsp;<span class="ident" id="8107189">err</span>&nbsp;<span class="op" id="8107193">:=</span>&nbsp;<span class="ident" id="8107196">w</span><span class="op" id="8107197">.</span><span class="ident" id="8107198">Close</span><span class="op" id="8107203">(</span><span class="op" id="8107204">)</span><span class="op" id="8107205">;</span>&nbsp;<span class="ident" id="8107207">err</span>&nbsp;<span class="op" id="8107211">!=</span>&nbsp;<span class="ident" id="8107214">nil</span>&nbsp;<span class="op" id="8107218">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107222">t</span><span class="op" id="8107223">.</span><span class="ident" id="8107224">Fatalf</span><span class="op" id="8107230">(</span><span class="string" id="8107231">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="8107249">,</span>&nbsp;<span class="ident" id="8107251">err</span><span class="op" id="8107254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107260">s</span>&nbsp;<span class="op" id="8107262">:=</span>&nbsp;<span class="ident" id="8107265">buf</span><span class="op" id="8107268">.</span><span class="ident" id="8107269">String</span><span class="op" id="8107275">(</span><span class="op" id="8107276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107279">zr</span><span class="op" id="8107281">,</span>&nbsp;<span class="ident" id="8107283">err</span>&nbsp;<span class="op" id="8107287">:=</span>&nbsp;<span class="ident" id="8107290">NewReader</span><span class="op" id="8107299">(</span><span class="ident" id="8107300">strings</span><span class="op" id="8107307">.</span><span class="ident" id="8107308">NewReader</span><span class="op" id="8107317">(</span><span class="ident" id="8107318">s</span><span class="op" id="8107319">)</span><span class="op" id="8107320">,</span>&nbsp;<span class="ident" id="8107322">int64</span><span class="op" id="8107327">(</span><span class="builtinfunc" id="8107328">len</span><span class="op" id="8107331">(</span><span class="ident" id="8107332">s</span><span class="op" id="8107333">)</span><span class="op" id="8107334">)</span><span class="op" id="8107335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8107338">if</span>&nbsp;<span class="ident" id="8107341">err</span>&nbsp;<span class="op" id="8107345">!=</span>&nbsp;<span class="ident" id="8107348">nil</span>&nbsp;<span class="op" id="8107352">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107356">t</span><span class="op" id="8107357">.</span><span class="ident" id="8107358">Fatalf</span><span class="op" id="8107364">(</span><span class="string" id="8107365">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="8107380">,</span>&nbsp;<span class="ident" id="8107382">err</span><span class="op" id="8107385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8107391">if</span>&nbsp;<span class="ident" id="8107394">got</span>&nbsp;<span class="op" id="8107398">:=</span>&nbsp;<span class="builtinfunc" id="8107401">len</span><span class="op" id="8107404">(</span><span class="ident" id="8107405">zr</span><span class="op" id="8107407">.</span><span class="ident" id="8107408">File</span><span class="op" id="8107412">)</span><span class="op" id="8107413">;</span>&nbsp;<span class="ident" id="8107415">got</span>&nbsp;<span class="op" id="8107419">!=</span>&nbsp;<span class="ident" id="8107422">nFiles</span>&nbsp;<span class="op" id="8107429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107433">t</span><span class="op" id="8107434">.</span><span class="ident" id="8107435">Fatalf</span><span class="op" id="8107441">(</span><span class="string" id="8107442">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8107475">,</span>&nbsp;<span class="ident" id="8107477">got</span><span class="op" id="8107480">,</span>&nbsp;<span class="ident" id="8107482">nFiles</span><span class="op" id="8107488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107491">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8107494">for</span>&nbsp;<span class="ident" id="8107498">i</span>&nbsp;<span class="op" id="8107500">:=</span>&nbsp;<span class="num" id="8107503">0</span><span class="op" id="8107504">;</span>&nbsp;<span class="ident" id="8107506">i</span>&nbsp;<span class="op" id="8107508">&lt;</span>&nbsp;<span class="ident" id="8107510">nFiles</span><span class="op" id="8107516">;</span>&nbsp;<span class="ident" id="8107518">i</span><span class="op" id="8107519">++</span>&nbsp;<span class="op" id="8107522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107526">want</span>&nbsp;<span class="op" id="8107531">:=</span>&nbsp;<span class="ident" id="8107534">fmt</span><span class="op" id="8107537">.</span><span class="ident" id="8107538">Sprintf</span><span class="op" id="8107545">(</span><span class="string" id="8107546">&#34;%d.dat&#34;</span><span class="op" id="8107554">,</span>&nbsp;<span class="ident" id="8107556">i</span><span class="op" id="8107557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8107561">if</span>&nbsp;<span class="ident" id="8107564">zr</span><span class="op" id="8107566">.</span><span class="ident" id="8107567">File</span><span class="op" id="8107571">[</span><span class="ident" id="8107572">i</span><span class="op" id="8107573">]</span><span class="op" id="8107574">.</span><span class="ident" id="8107575">Name</span>&nbsp;<span class="op" id="8107580">!=</span>&nbsp;<span class="ident" id="8107583">want</span>&nbsp;<span class="op" id="8107588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107593">t</span><span class="op" id="8107594">.</span><span class="ident" id="8107595">Fatalf</span><span class="op" id="8107601">(</span><span class="string" id="8107602">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8107626">,</span>&nbsp;<span class="ident" id="8107628">i</span><span class="op" id="8107629">,</span>&nbsp;<span class="ident" id="8107631">zr</span><span class="op" id="8107633">.</span><span class="ident" id="8107634">File</span><span class="op" id="8107638">[</span><span class="ident" id="8107639">i</span><span class="op" id="8107640">]</span><span class="op" id="8107641">.</span><span class="ident" id="8107642">Name</span><span class="op" id="8107646">,</span>&nbsp;<span class="ident" id="8107648">want</span><span class="op" id="8107652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107656">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107659">}</span><br>
<span class="lineno"></span><span class="op" id="8107661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8107664">func</span>&nbsp;<span class="ident" id="8107669">TestModTime</span><span class="op" id="8107680">(</span><span class="ident" id="8107681">t</span>&nbsp;<span class="op" id="8107683">*</span><span class="ident" id="8107684">testing</span><span class="op" id="8107691">.</span><span class="ident" id="8107692">T</span><span class="op" id="8107693">)</span>&nbsp;<span class="op" id="8107695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8107698">var</span>&nbsp;<span class="ident" id="8107702">testTime</span>&nbsp;<span class="op" id="8107711">=</span>&nbsp;<span class="ident" id="8107713">time</span><span class="op" id="8107717">.</span><span class="ident" id="8107718">Date</span><span class="op" id="8107722">(</span><span class="num" id="8107723">2009</span><span class="op" id="8107727">,</span>&nbsp;<span class="ident" id="8107729">time</span><span class="op" id="8107733">.</span><span class="ident" id="8107734">November</span><span class="op" id="8107742">,</span>&nbsp;<span class="num" id="8107744">10</span><span class="op" id="8107746">,</span>&nbsp;<span class="num" id="8107748">23</span><span class="op" id="8107750">,</span>&nbsp;<span class="num" id="8107752">45</span><span class="op" id="8107754">,</span>&nbsp;<span class="num" id="8107756">58</span><span class="op" id="8107758">,</span>&nbsp;<span class="num" id="8107760">0</span><span class="op" id="8107761">,</span>&nbsp;<span class="ident" id="8107763">time</span><span class="op" id="8107767">.</span><span class="ident" id="8107768">UTC</span><span class="op" id="8107771">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107774">fh</span>&nbsp;<span class="op" id="8107777">:=</span>&nbsp;<span class="builtinfunc" id="8107780">new</span><span class="op" id="8107783">(</span><span class="ident" id="8107784">FileHeader</span><span class="op" id="8107794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107797">fh</span><span class="op" id="8107799">.</span><span class="ident" id="8107800">SetModTime</span><span class="op" id="8107810">(</span><span class="ident" id="8107811">testTime</span><span class="op" id="8107819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107822">outTime</span>&nbsp;<span class="op" id="8107830">:=</span>&nbsp;<span class="ident" id="8107833">fh</span><span class="op" id="8107835">.</span><span class="ident" id="8107836">ModTime</span><span class="op" id="8107843">(</span><span class="op" id="8107844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8107847">if</span>&nbsp;<span class="op" id="8107850">!</span><span class="ident" id="8107851">outTime</span><span class="op" id="8107858">.</span><span class="ident" id="8107859">Equal</span><span class="op" id="8107864">(</span><span class="ident" id="8107865">testTime</span><span class="op" id="8107873">)</span>&nbsp;<span class="op" id="8107875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107879">t</span><span class="op" id="8107880">.</span><span class="ident" id="8107881">Errorf</span><span class="op" id="8107887">(</span><span class="string" id="8107888">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8107924">,</span>&nbsp;<span class="ident" id="8107926">outTime</span><span class="op" id="8107933">,</span>&nbsp;<span class="ident" id="8107935">testTime</span><span class="op" id="8107943">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107946">}</span><br>
<span class="lineno"></span><span class="op" id="8107948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8107951">func</span>&nbsp;<span class="ident" id="8107956">testHeaderRoundTrip</span><span class="op" id="8107975">(</span><span class="ident" id="8107976">fh</span>&nbsp;<span class="op" id="8107979">*</span><span class="ident" id="8107980">FileHeader</span><span class="op" id="8107990">,</span>&nbsp;<span class="ident" id="8107992">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="8108013">uint32</span><span class="op" id="8108019">,</span>&nbsp;<span class="ident" id="8108021">wantUncompressedSize64</span>&nbsp;<span class="ident" id="8108044">uint64</span><span class="op" id="8108050">,</span>&nbsp;<span class="ident" id="8108052">t</span>&nbsp;<span class="op" id="8108054">*</span><span class="ident" id="8108055">testing</span><span class="op" id="8108062">.</span><span class="ident" id="8108063">T</span><span class="op" id="8108064">)</span>&nbsp;<span class="op" id="8108066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108069">fi</span>&nbsp;<span class="op" id="8108072">:=</span>&nbsp;<span class="ident" id="8108075">fh</span><span class="op" id="8108077">.</span><span class="ident" id="8108078">FileInfo</span><span class="op" id="8108086">(</span><span class="op" id="8108087">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108090">fh2</span><span class="op" id="8108093">,</span>&nbsp;<span class="ident" id="8108095">err</span>&nbsp;<span class="op" id="8108099">:=</span>&nbsp;<span class="ident" id="8108102">FileInfoHeader</span><span class="op" id="8108116">(</span><span class="ident" id="8108117">fi</span><span class="op" id="8108119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108122">if</span>&nbsp;<span class="ident" id="8108125">err</span>&nbsp;<span class="op" id="8108129">!=</span>&nbsp;<span class="ident" id="8108132">nil</span>&nbsp;<span class="op" id="8108136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108140">t</span><span class="op" id="8108141">.</span><span class="ident" id="8108142">Fatal</span><span class="op" id="8108147">(</span><span class="ident" id="8108148">err</span><span class="op" id="8108151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108157">if</span>&nbsp;<span class="ident" id="8108160">got</span><span class="op" id="8108163">,</span>&nbsp;<span class="ident" id="8108165">want</span>&nbsp;<span class="op" id="8108170">:=</span>&nbsp;<span class="ident" id="8108173">fh2</span><span class="op" id="8108176">.</span><span class="ident" id="8108177">Name</span><span class="op" id="8108181">,</span>&nbsp;<span class="ident" id="8108183">fh</span><span class="op" id="8108185">.</span><span class="ident" id="8108186">Name</span><span class="op" id="8108190">;</span>&nbsp;<span class="ident" id="8108192">got</span>&nbsp;<span class="op" id="8108196">!=</span>&nbsp;<span class="ident" id="8108199">want</span>&nbsp;<span class="op" id="8108204">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108208">t</span><span class="op" id="8108209">.</span><span class="ident" id="8108210">Errorf</span><span class="op" id="8108216">(</span><span class="string" id="8108217">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="8108242">,</span>&nbsp;<span class="ident" id="8108244">got</span><span class="op" id="8108247">,</span>&nbsp;<span class="ident" id="8108249">want</span><span class="op" id="8108253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108259">if</span>&nbsp;<span class="ident" id="8108262">got</span><span class="op" id="8108265">,</span>&nbsp;<span class="ident" id="8108267">want</span>&nbsp;<span class="op" id="8108272">:=</span>&nbsp;<span class="ident" id="8108275">fh2</span><span class="op" id="8108278">.</span><span class="ident" id="8108279">UncompressedSize</span><span class="op" id="8108295">,</span>&nbsp;<span class="ident" id="8108297">wantUncompressedSize</span><span class="op" id="8108317">;</span>&nbsp;<span class="ident" id="8108319">got</span>&nbsp;<span class="op" id="8108323">!=</span>&nbsp;<span class="ident" id="8108326">want</span>&nbsp;<span class="op" id="8108331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108335">t</span><span class="op" id="8108336">.</span><span class="ident" id="8108337">Errorf</span><span class="op" id="8108343">(</span><span class="string" id="8108344">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="8108381">,</span>&nbsp;<span class="ident" id="8108383">got</span><span class="op" id="8108386">,</span>&nbsp;<span class="ident" id="8108388">want</span><span class="op" id="8108392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108395">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108398">if</span>&nbsp;<span class="ident" id="8108401">got</span><span class="op" id="8108404">,</span>&nbsp;<span class="ident" id="8108406">want</span>&nbsp;<span class="op" id="8108411">:=</span>&nbsp;<span class="ident" id="8108414">fh2</span><span class="op" id="8108417">.</span><span class="ident" id="8108418">UncompressedSize64</span><span class="op" id="8108436">,</span>&nbsp;<span class="ident" id="8108438">wantUncompressedSize64</span><span class="op" id="8108460">;</span>&nbsp;<span class="ident" id="8108462">got</span>&nbsp;<span class="op" id="8108466">!=</span>&nbsp;<span class="ident" id="8108469">want</span>&nbsp;<span class="op" id="8108474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108478">t</span><span class="op" id="8108479">.</span><span class="ident" id="8108480">Errorf</span><span class="op" id="8108486">(</span><span class="string" id="8108487">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="8108526">,</span>&nbsp;<span class="ident" id="8108528">got</span><span class="op" id="8108531">,</span>&nbsp;<span class="ident" id="8108533">want</span><span class="op" id="8108537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108543">if</span>&nbsp;<span class="ident" id="8108546">got</span><span class="op" id="8108549">,</span>&nbsp;<span class="ident" id="8108551">want</span>&nbsp;<span class="op" id="8108556">:=</span>&nbsp;<span class="ident" id="8108559">fh2</span><span class="op" id="8108562">.</span><span class="ident" id="8108563">ModifiedTime</span><span class="op" id="8108575">,</span>&nbsp;<span class="ident" id="8108577">fh</span><span class="op" id="8108579">.</span><span class="ident" id="8108580">ModifiedTime</span><span class="op" id="8108592">;</span>&nbsp;<span class="ident" id="8108594">got</span>&nbsp;<span class="op" id="8108598">!=</span>&nbsp;<span class="ident" id="8108601">want</span>&nbsp;<span class="op" id="8108606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108610">t</span><span class="op" id="8108611">.</span><span class="ident" id="8108612">Errorf</span><span class="op" id="8108618">(</span><span class="string" id="8108619">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="8108652">,</span>&nbsp;<span class="ident" id="8108654">got</span><span class="op" id="8108657">,</span>&nbsp;<span class="ident" id="8108659">want</span><span class="op" id="8108663">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108669">if</span>&nbsp;<span class="ident" id="8108672">got</span><span class="op" id="8108675">,</span>&nbsp;<span class="ident" id="8108677">want</span>&nbsp;<span class="op" id="8108682">:=</span>&nbsp;<span class="ident" id="8108685">fh2</span><span class="op" id="8108688">.</span><span class="ident" id="8108689">ModifiedDate</span><span class="op" id="8108701">,</span>&nbsp;<span class="ident" id="8108703">fh</span><span class="op" id="8108705">.</span><span class="ident" id="8108706">ModifiedDate</span><span class="op" id="8108718">;</span>&nbsp;<span class="ident" id="8108720">got</span>&nbsp;<span class="op" id="8108724">!=</span>&nbsp;<span class="ident" id="8108727">want</span>&nbsp;<span class="op" id="8108732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108736">t</span><span class="op" id="8108737">.</span><span class="ident" id="8108738">Errorf</span><span class="op" id="8108744">(</span><span class="string" id="8108745">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="8108778">,</span>&nbsp;<span class="ident" id="8108780">got</span><span class="op" id="8108783">,</span>&nbsp;<span class="ident" id="8108785">want</span><span class="op" id="8108789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108796">if</span>&nbsp;<span class="ident" id="8108799">sysfh</span><span class="op" id="8108804">,</span>&nbsp;<span class="ident" id="8108806">ok</span>&nbsp;<span class="op" id="8108809">:=</span>&nbsp;<span class="ident" id="8108812">fi</span><span class="op" id="8108814">.</span><span class="ident" id="8108815">Sys</span><span class="op" id="8108818">(</span><span class="op" id="8108819">)</span><span class="op" id="8108820">.</span><span class="op" id="8108821">(</span><span class="op" id="8108822">*</span><span class="ident" id="8108823">FileHeader</span><span class="op" id="8108833">)</span><span class="op" id="8108834">;</span>&nbsp;<span class="op" id="8108836">!</span><span class="ident" id="8108837">ok</span>&nbsp;<span class="op" id="8108840">&amp;&amp;</span>&nbsp;<span class="ident" id="8108843">sysfh</span>&nbsp;<span class="op" id="8108849">!=</span>&nbsp;<span class="ident" id="8108852">fh</span>&nbsp;<span class="op" id="8108855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108859">t</span><span class="op" id="8108860">.</span><span class="ident" id="8108861">Errorf</span><span class="op" id="8108867">(</span><span class="string" id="8108868">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="8108908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108911">}</span><br>
<span class="lineno"></span><span class="op" id="8108913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="8108916">func</span>&nbsp;<span class="ident" id="8108921">TestFileHeaderRoundTrip</span><span class="op" id="8108944">(</span><span class="ident" id="8108945">t</span>&nbsp;<span class="op" id="8108947">*</span><span class="ident" id="8108948">testing</span><span class="op" id="8108955">.</span><span class="ident" id="8108956">T</span><span class="op" id="8108957">)</span>&nbsp;<span class="op" id="8108959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108962">fh</span>&nbsp;<span class="op" id="8108965">:=</span>&nbsp;<span class="op" id="8108968">&amp;</span><span class="ident" id="8108969">FileHeader</span><span class="op" id="8108979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108983">Name</span><span class="op" id="8108987">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8109001">&#34;foo.txt&#34;</span><span class="op" id="8109010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109014">UncompressedSize</span><span class="op" id="8109030">:</span>&nbsp;<span class="num" id="8109032">987654321</span><span class="op" id="8109041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109045">ModifiedTime</span><span class="op" id="8109057">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8109063">1234</span><span class="op" id="8109067">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109071">ModifiedDate</span><span class="op" id="8109083">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8109089">5678</span><span class="op" id="8109093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109099">testHeaderRoundTrip</span><span class="op" id="8109118">(</span><span class="ident" id="8109119">fh</span><span class="op" id="8109121">,</span>&nbsp;<span class="ident" id="8109123">fh</span><span class="op" id="8109125">.</span><span class="ident" id="8109126">UncompressedSize</span><span class="op" id="8109142">,</span>&nbsp;<span class="ident" id="8109144">uint64</span><span class="op" id="8109150">(</span><span class="ident" id="8109151">fh</span><span class="op" id="8109153">.</span><span class="ident" id="8109154">UncompressedSize</span><span class="op" id="8109170">)</span><span class="op" id="8109171">,</span>&nbsp;<span class="ident" id="8109173">t</span><span class="op" id="8109174">)</span><br>
<span class="lineno"></span><span class="op" id="8109176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="8109179">func</span>&nbsp;<span class="ident" id="8109184">TestFileHeaderRoundTrip64</span><span class="op" id="8109209">(</span><span class="ident" id="8109210">t</span>&nbsp;<span class="op" id="8109212">*</span><span class="ident" id="8109213">testing</span><span class="op" id="8109220">.</span><span class="ident" id="8109221">T</span><span class="op" id="8109222">)</span>&nbsp;<span class="op" id="8109224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109227">fh</span>&nbsp;<span class="op" id="8109230">:=</span>&nbsp;<span class="op" id="8109233">&amp;</span><span class="ident" id="8109234">FileHeader</span><span class="op" id="8109244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109248">Name</span><span class="op" id="8109252">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8109268">&#34;foo.txt&#34;</span><span class="op" id="8109277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109281">UncompressedSize64</span><span class="op" id="8109299">:</span>&nbsp;<span class="num" id="8109301">9876543210</span><span class="op" id="8109311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109315">ModifiedTime</span><span class="op" id="8109327">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8109335">1234</span><span class="op" id="8109339">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109343">ModifiedDate</span><span class="op" id="8109355">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8109363">5678</span><span class="op" id="8109367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109373">testHeaderRoundTrip</span><span class="op" id="8109392">(</span><span class="ident" id="8109393">fh</span><span class="op" id="8109395">,</span>&nbsp;<span class="ident" id="8109397">uint32max</span><span class="op" id="8109406">,</span>&nbsp;<span class="ident" id="8109408">fh</span><span class="op" id="8109410">.</span><span class="ident" id="8109411">UncompressedSize64</span><span class="op" id="8109429">,</span>&nbsp;<span class="ident" id="8109431">t</span><span class="op" id="8109432">)</span><br>
<span class="lineno"></span><span class="op" id="8109434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8109437">type</span>&nbsp;<span class="ident" id="8109442">repeatedByte</span>&nbsp;<span class="keyword" id="8109455">struct</span>&nbsp;<span class="op" id="8109462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109465">off</span>&nbsp;<span class="ident" id="8109469">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109476">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8109480">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109486">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8109490">int64</span><br>
<span class="lineno"></span><span class="op" id="8109496">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="8109499">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="8109549">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="8109617">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="8109650">type</span>&nbsp;<span class="ident" id="8109655">rleBuffer</span>&nbsp;<span class="keyword" id="8109665">struct</span>&nbsp;<span class="op" id="8109672">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109675">buf</span>&nbsp;<span class="op" id="8109679">[</span><span class="op" id="8109680">]</span><span class="ident" id="8109681">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="8109694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8109697">func</span>&nbsp;<span class="op" id="8109702">(</span><span class="ident" id="8109703">r</span>&nbsp;<span class="op" id="8109705">*</span><span class="ident" id="8109706">rleBuffer</span><span class="op" id="8109715">)</span>&nbsp;<span class="ident" id="8109717">Size</span><span class="op" id="8109721">(</span><span class="op" id="8109722">)</span>&nbsp;<span class="ident" id="8109724">int64</span>&nbsp;<span class="op" id="8109730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109733">if</span>&nbsp;<span class="builtinfunc" id="8109736">len</span><span class="op" id="8109739">(</span><span class="ident" id="8109740">r</span><span class="op" id="8109741">.</span><span class="ident" id="8109742">buf</span><span class="op" id="8109745">)</span>&nbsp;<span class="op" id="8109747">==</span>&nbsp;<span class="num" id="8109750">0</span>&nbsp;<span class="op" id="8109752">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109756">return</span>&nbsp;<span class="num" id="8109763">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109769">last</span>&nbsp;<span class="op" id="8109774">:=</span>&nbsp;<span class="op" id="8109777">&amp;</span><span class="ident" id="8109778">r</span><span class="op" id="8109779">.</span><span class="ident" id="8109780">buf</span><span class="op" id="8109783">[</span><span class="builtinfunc" id="8109784">len</span><span class="op" id="8109787">(</span><span class="ident" id="8109788">r</span><span class="op" id="8109789">.</span><span class="ident" id="8109790">buf</span><span class="op" id="8109793">)</span><span class="op" id="8109794">-</span><span class="num" id="8109795">1</span><span class="op" id="8109796">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109799">return</span>&nbsp;<span class="ident" id="8109806">last</span><span class="op" id="8109810">.</span><span class="ident" id="8109811">off</span>&nbsp;<span class="op" id="8109815">+</span>&nbsp;<span class="ident" id="8109817">last</span><span class="op" id="8109821">.</span><span class="ident" id="8109822">n</span><br>
<span class="lineno"></span><span class="op" id="8109824">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="8109827">func</span>&nbsp;<span class="op" id="8109832">(</span><span class="ident" id="8109833">r</span>&nbsp;<span class="op" id="8109835">*</span><span class="ident" id="8109836">rleBuffer</span><span class="op" id="8109845">)</span>&nbsp;<span class="ident" id="8109847">Write</span><span class="op" id="8109852">(</span><span class="ident" id="8109853">p</span>&nbsp;<span class="op" id="8109855">[</span><span class="op" id="8109856">]</span><span class="builtintype" id="8109857">byte</span><span class="op" id="8109861">)</span>&nbsp;<span class="op" id="8109863">(</span><span class="ident" id="8109864">n</span>&nbsp;<span class="builtintype" id="8109866">int</span><span class="op" id="8109869">,</span>&nbsp;<span class="ident" id="8109871">err</span>&nbsp;<span class="builtintype" id="8109875">error</span><span class="op" id="8109880">)</span>&nbsp;<span class="op" id="8109882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109885">var</span>&nbsp;<span class="ident" id="8109889">rp</span>&nbsp;<span class="op" id="8109892">*</span><span class="ident" id="8109893">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109907">if</span>&nbsp;<span class="builtinfunc" id="8109910">len</span><span class="op" id="8109913">(</span><span class="ident" id="8109914">r</span><span class="op" id="8109915">.</span><span class="ident" id="8109916">buf</span><span class="op" id="8109919">)</span>&nbsp;<span class="op" id="8109921">&gt;</span>&nbsp;<span class="num" id="8109923">0</span>&nbsp;<span class="op" id="8109925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109929">rp</span>&nbsp;<span class="op" id="8109932">=</span>&nbsp;<span class="op" id="8109934">&amp;</span><span class="ident" id="8109935">r</span><span class="op" id="8109936">.</span><span class="ident" id="8109937">buf</span><span class="op" id="8109940">[</span><span class="builtinfunc" id="8109941">len</span><span class="op" id="8109944">(</span><span class="ident" id="8109945">r</span><span class="op" id="8109946">.</span><span class="ident" id="8109947">buf</span><span class="op" id="8109950">)</span><span class="op" id="8109951">-</span><span class="num" id="8109952">1</span><span class="op" id="8109953">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8109957">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110014">if</span>&nbsp;<span class="ident" id="8110017">lastByte</span>&nbsp;<span class="op" id="8110026">:=</span>&nbsp;<span class="ident" id="8110029">rp</span><span class="op" id="8110031">.</span><span class="ident" id="8110032">b</span><span class="op" id="8110033">;</span>&nbsp;<span class="builtinfunc" id="8110035">len</span><span class="op" id="8110038">(</span><span class="ident" id="8110039">p</span><span class="op" id="8110040">)</span>&nbsp;<span class="op" id="8110042">&gt;</span>&nbsp;<span class="num" id="8110044">0</span>&nbsp;<span class="op" id="8110046">&amp;&amp;</span>&nbsp;<span class="ident" id="8110049">p</span><span class="op" id="8110050">[</span><span class="num" id="8110051">0</span><span class="op" id="8110052">]</span>&nbsp;<span class="op" id="8110054">==</span>&nbsp;<span class="ident" id="8110057">lastByte</span>&nbsp;<span class="op" id="8110066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110071">all</span>&nbsp;<span class="op" id="8110075">:=</span>&nbsp;<span class="builtintype" id="8110078">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110086">for</span>&nbsp;<span class="ident" id="8110090">_</span><span class="op" id="8110091">,</span>&nbsp;<span class="ident" id="8110093">b</span>&nbsp;<span class="op" id="8110095">:=</span>&nbsp;<span class="keyword" id="8110098">range</span>&nbsp;<span class="ident" id="8110104">p</span>&nbsp;<span class="op" id="8110106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110112">if</span>&nbsp;<span class="ident" id="8110115">b</span>&nbsp;<span class="op" id="8110117">!=</span>&nbsp;<span class="ident" id="8110120">lastByte</span>&nbsp;<span class="op" id="8110129">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110136">all</span>&nbsp;<span class="op" id="8110140">=</span>&nbsp;<span class="builtintype" id="8110142">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110153">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110173">if</span>&nbsp;<span class="ident" id="8110176">all</span>&nbsp;<span class="op" id="8110180">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110186">rp</span><span class="op" id="8110188">.</span><span class="ident" id="8110189">n</span>&nbsp;<span class="op" id="8110191">+=</span>&nbsp;<span class="ident" id="8110194">int64</span><span class="op" id="8110199">(</span><span class="builtinfunc" id="8110200">len</span><span class="op" id="8110203">(</span><span class="ident" id="8110204">p</span><span class="op" id="8110205">)</span><span class="op" id="8110206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110212">return</span>&nbsp;<span class="builtinfunc" id="8110219">len</span><span class="op" id="8110222">(</span><span class="ident" id="8110223">p</span><span class="op" id="8110224">)</span><span class="op" id="8110225">,</span>&nbsp;<span class="ident" id="8110227">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110241">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110245">for</span>&nbsp;<span class="ident" id="8110249">_</span><span class="op" id="8110250">,</span>&nbsp;<span class="ident" id="8110252">b</span>&nbsp;<span class="op" id="8110254">:=</span>&nbsp;<span class="keyword" id="8110257">range</span>&nbsp;<span class="ident" id="8110263">p</span>&nbsp;<span class="op" id="8110265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110269">if</span>&nbsp;<span class="ident" id="8110272">rp</span>&nbsp;<span class="op" id="8110275">==</span>&nbsp;<span class="ident" id="8110278">nil</span>&nbsp;<span class="op" id="8110282">||</span>&nbsp;<span class="ident" id="8110285">rp</span><span class="op" id="8110287">.</span><span class="ident" id="8110288">b</span>&nbsp;<span class="op" id="8110290">!=</span>&nbsp;<span class="ident" id="8110293">b</span>&nbsp;<span class="op" id="8110295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110300">r</span><span class="op" id="8110301">.</span><span class="ident" id="8110302">buf</span>&nbsp;<span class="op" id="8110306">=</span>&nbsp;<span class="builtinfunc" id="8110308">append</span><span class="op" id="8110314">(</span><span class="ident" id="8110315">r</span><span class="op" id="8110316">.</span><span class="ident" id="8110317">buf</span><span class="op" id="8110320">,</span>&nbsp;<span class="ident" id="8110322">repeatedByte</span><span class="op" id="8110334">{</span><span class="ident" id="8110335">r</span><span class="op" id="8110336">.</span><span class="ident" id="8110337">Size</span><span class="op" id="8110341">(</span><span class="op" id="8110342">)</span><span class="op" id="8110343">,</span>&nbsp;<span class="ident" id="8110345">b</span><span class="op" id="8110346">,</span>&nbsp;<span class="num" id="8110348">1</span><span class="op" id="8110349">}</span><span class="op" id="8110350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110355">rp</span>&nbsp;<span class="op" id="8110358">=</span>&nbsp;<span class="op" id="8110360">&amp;</span><span class="ident" id="8110361">r</span><span class="op" id="8110362">.</span><span class="ident" id="8110363">buf</span><span class="op" id="8110366">[</span><span class="builtinfunc" id="8110367">len</span><span class="op" id="8110370">(</span><span class="ident" id="8110371">r</span><span class="op" id="8110372">.</span><span class="ident" id="8110373">buf</span><span class="op" id="8110376">)</span><span class="op" id="8110377">-</span><span class="num" id="8110378">1</span><span class="op" id="8110379">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110383">}</span>&nbsp;<span class="keyword" id="8110385">else</span>&nbsp;<span class="op" id="8110390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110395">rp</span><span class="op" id="8110397">.</span><span class="ident" id="8110398">n</span><span class="op" id="8110399">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110410">return</span>&nbsp;<span class="builtinfunc" id="8110417">len</span><span class="op" id="8110420">(</span><span class="ident" id="8110421">p</span><span class="op" id="8110422">)</span><span class="op" id="8110423">,</span>&nbsp;<span class="ident" id="8110425">nil</span><br>
<span class="lineno">160</span><span class="op" id="8110429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8110432">func</span>&nbsp;<span class="op" id="8110437">(</span><span class="ident" id="8110438">r</span>&nbsp;<span class="op" id="8110440">*</span><span class="ident" id="8110441">rleBuffer</span><span class="op" id="8110450">)</span>&nbsp;<span class="ident" id="8110452">ReadAt</span><span class="op" id="8110458">(</span><span class="ident" id="8110459">p</span>&nbsp;<span class="op" id="8110461">[</span><span class="op" id="8110462">]</span><span class="builtintype" id="8110463">byte</span><span class="op" id="8110467">,</span>&nbsp;<span class="ident" id="8110469">off</span>&nbsp;<span class="ident" id="8110473">int64</span><span class="op" id="8110478">)</span>&nbsp;<span class="op" id="8110480">(</span><span class="ident" id="8110481">n</span>&nbsp;<span class="builtintype" id="8110483">int</span><span class="op" id="8110486">,</span>&nbsp;<span class="ident" id="8110488">err</span>&nbsp;<span class="builtintype" id="8110492">error</span><span class="op" id="8110497">)</span>&nbsp;<span class="op" id="8110499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110502">if</span>&nbsp;<span class="builtinfunc" id="8110505">len</span><span class="op" id="8110508">(</span><span class="ident" id="8110509">p</span><span class="op" id="8110510">)</span>&nbsp;<span class="op" id="8110512">==</span>&nbsp;<span class="num" id="8110515">0</span>&nbsp;<span class="op" id="8110517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110521">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110532">skipParts</span>&nbsp;<span class="op" id="8110542">:=</span>&nbsp;<span class="ident" id="8110545">sort</span><span class="op" id="8110549">.</span><span class="ident" id="8110550">Search</span><span class="op" id="8110556">(</span><span class="builtinfunc" id="8110557">len</span><span class="op" id="8110560">(</span><span class="ident" id="8110561">r</span><span class="op" id="8110562">.</span><span class="ident" id="8110563">buf</span><span class="op" id="8110566">)</span><span class="op" id="8110567">,</span>&nbsp;<span class="keyword" id="8110569">func</span><span class="op" id="8110573">(</span><span class="ident" id="8110574">i</span>&nbsp;<span class="builtintype" id="8110576">int</span><span class="op" id="8110579">)</span>&nbsp;<span class="builtintype" id="8110581">bool</span>&nbsp;<span class="op" id="8110586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110590">part</span>&nbsp;<span class="op" id="8110595">:=</span>&nbsp;<span class="op" id="8110598">&amp;</span><span class="ident" id="8110599">r</span><span class="op" id="8110600">.</span><span class="ident" id="8110601">buf</span><span class="op" id="8110604">[</span><span class="ident" id="8110605">i</span><span class="op" id="8110606">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110610">return</span>&nbsp;<span class="ident" id="8110617">part</span><span class="op" id="8110621">.</span><span class="ident" id="8110622">off</span><span class="op" id="8110625">+</span><span class="ident" id="8110626">part</span><span class="op" id="8110630">.</span><span class="ident" id="8110631">n</span>&nbsp;<span class="op" id="8110633">&gt;</span>&nbsp;<span class="ident" id="8110635">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110640">}</span><span class="op" id="8110641">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110644">parts</span>&nbsp;<span class="op" id="8110650">:=</span>&nbsp;<span class="ident" id="8110653">r</span><span class="op" id="8110654">.</span><span class="ident" id="8110655">buf</span><span class="op" id="8110658">[</span><span class="ident" id="8110659">skipParts</span><span class="op" id="8110668">:</span><span class="op" id="8110669">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110672">if</span>&nbsp;<span class="builtinfunc" id="8110675">len</span><span class="op" id="8110678">(</span><span class="ident" id="8110679">parts</span><span class="op" id="8110684">)</span>&nbsp;<span class="op" id="8110686">&gt;</span>&nbsp;<span class="num" id="8110688">0</span>&nbsp;<span class="op" id="8110690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110694">skipBytes</span>&nbsp;<span class="op" id="8110704">:=</span>&nbsp;<span class="ident" id="8110707">off</span>&nbsp;<span class="op" id="8110711">-</span>&nbsp;<span class="ident" id="8110713">parts</span><span class="op" id="8110718">[</span><span class="num" id="8110719">0</span><span class="op" id="8110720">]</span><span class="op" id="8110721">.</span><span class="ident" id="8110722">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110728">for</span>&nbsp;<span class="builtinfunc" id="8110732">len</span><span class="op" id="8110735">(</span><span class="ident" id="8110736">parts</span><span class="op" id="8110741">)</span>&nbsp;<span class="op" id="8110743">&gt;</span>&nbsp;<span class="num" id="8110745">0</span>&nbsp;<span class="op" id="8110747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110752">part</span>&nbsp;<span class="op" id="8110757">:=</span>&nbsp;<span class="ident" id="8110760">parts</span><span class="op" id="8110765">[</span><span class="num" id="8110766">0</span><span class="op" id="8110767">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110772">for</span>&nbsp;<span class="ident" id="8110776">i</span>&nbsp;<span class="op" id="8110778">:=</span>&nbsp;<span class="ident" id="8110781">skipBytes</span><span class="op" id="8110790">;</span>&nbsp;<span class="ident" id="8110792">i</span>&nbsp;<span class="op" id="8110794">&lt;</span>&nbsp;<span class="ident" id="8110796">part</span><span class="op" id="8110800">.</span><span class="ident" id="8110801">n</span><span class="op" id="8110802">;</span>&nbsp;<span class="ident" id="8110804">i</span><span class="op" id="8110805">++</span>&nbsp;<span class="op" id="8110808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110814">if</span>&nbsp;<span class="ident" id="8110817">n</span>&nbsp;<span class="op" id="8110819">==</span>&nbsp;<span class="builtinfunc" id="8110822">len</span><span class="op" id="8110825">(</span><span class="ident" id="8110826">p</span><span class="op" id="8110827">)</span>&nbsp;<span class="op" id="8110829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110836">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110853">p</span><span class="op" id="8110854">[</span><span class="ident" id="8110855">n</span><span class="op" id="8110856">]</span>&nbsp;<span class="op" id="8110858">=</span>&nbsp;<span class="ident" id="8110860">part</span><span class="op" id="8110864">.</span><span class="ident" id="8110865">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110871">n</span><span class="op" id="8110872">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110883">parts</span>&nbsp;<span class="op" id="8110889">=</span>&nbsp;<span class="ident" id="8110891">parts</span><span class="op" id="8110896">[</span><span class="num" id="8110897">1</span><span class="op" id="8110898">:</span><span class="op" id="8110899">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110904">skipBytes</span>&nbsp;<span class="op" id="8110914">=</span>&nbsp;<span class="num" id="8110916">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110920">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110926">if</span>&nbsp;<span class="ident" id="8110929">n</span>&nbsp;<span class="op" id="8110931">!=</span>&nbsp;<span class="builtinfunc" id="8110934">len</span><span class="op" id="8110937">(</span><span class="ident" id="8110938">p</span><span class="op" id="8110939">)</span>&nbsp;<span class="op" id="8110941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110945">err</span>&nbsp;<span class="op" id="8110949">=</span>&nbsp;<span class="ident" id="8110951">io</span><span class="op" id="8110953">.</span><span class="ident" id="8110954">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110975">return</span><br>
<span class="lineno">190</span><span class="op" id="8110982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8110985">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="8111071">func</span>&nbsp;<span class="ident" id="8111076">TestRLEBuffer</span><span class="op" id="8111089">(</span><span class="ident" id="8111090">t</span>&nbsp;<span class="op" id="8111092">*</span><span class="ident" id="8111093">testing</span><span class="op" id="8111100">.</span><span class="ident" id="8111101">T</span><span class="op" id="8111102">)</span>&nbsp;<span class="op" id="8111104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111107">b</span>&nbsp;<span class="op" id="8111109">:=</span>&nbsp;<span class="builtinfunc" id="8111112">new</span><span class="op" id="8111115">(</span><span class="ident" id="8111116">rleBuffer</span><span class="op" id="8111125">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111128">var</span>&nbsp;<span class="ident" id="8111132">all</span>&nbsp;<span class="op" id="8111136">[</span><span class="op" id="8111137">]</span><span class="builtintype" id="8111138">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111144">writes</span>&nbsp;<span class="op" id="8111151">:=</span>&nbsp;<span class="op" id="8111154">[</span><span class="op" id="8111155">]</span><span class="builtintype" id="8111156">string</span><span class="op" id="8111162">{</span><span class="string" id="8111163">&#34;abcdeee&#34;</span><span class="op" id="8111172">,</span>&nbsp;<span class="string" id="8111174">&#34;eeeeeee&#34;</span><span class="op" id="8111183">,</span>&nbsp;<span class="string" id="8111185">&#34;eeeefghaaiii&#34;</span><span class="op" id="8111199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111202">for</span>&nbsp;<span class="ident" id="8111206">_</span><span class="op" id="8111207">,</span>&nbsp;<span class="ident" id="8111209">w</span>&nbsp;<span class="op" id="8111211">:=</span>&nbsp;<span class="keyword" id="8111214">range</span>&nbsp;<span class="ident" id="8111220">writes</span>&nbsp;<span class="op" id="8111227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111231">b</span><span class="op" id="8111232">.</span><span class="ident" id="8111233">Write</span><span class="op" id="8111238">(</span><span class="op" id="8111239">[</span><span class="op" id="8111240">]</span><span class="builtintype" id="8111241">byte</span><span class="op" id="8111245">(</span><span class="ident" id="8111246">w</span><span class="op" id="8111247">)</span><span class="op" id="8111248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111252">all</span>&nbsp;<span class="op" id="8111256">=</span>&nbsp;<span class="builtinfunc" id="8111258">append</span><span class="op" id="8111264">(</span><span class="ident" id="8111265">all</span><span class="op" id="8111268">,</span>&nbsp;<span class="ident" id="8111270">w</span><span class="op" id="8111271">...</span><span class="op" id="8111274">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111280">if</span>&nbsp;<span class="builtinfunc" id="8111283">len</span><span class="op" id="8111286">(</span><span class="ident" id="8111287">b</span><span class="op" id="8111288">.</span><span class="ident" id="8111289">buf</span><span class="op" id="8111292">)</span>&nbsp;<span class="op" id="8111294">!=</span>&nbsp;<span class="num" id="8111297">10</span>&nbsp;<span class="op" id="8111300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111304">t</span><span class="op" id="8111305">.</span><span class="ident" id="8111306">Fatalf</span><span class="op" id="8111312">(</span><span class="string" id="8111313">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="8111339">,</span>&nbsp;<span class="builtinfunc" id="8111341">len</span><span class="op" id="8111344">(</span><span class="ident" id="8111345">b</span><span class="op" id="8111346">.</span><span class="ident" id="8111347">buf</span><span class="op" id="8111350">)</span><span class="op" id="8111351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111358">for</span>&nbsp;<span class="ident" id="8111362">i</span>&nbsp;<span class="op" id="8111364">:=</span>&nbsp;<span class="num" id="8111367">0</span><span class="op" id="8111368">;</span>&nbsp;<span class="ident" id="8111370">i</span>&nbsp;<span class="op" id="8111372">&lt;</span>&nbsp;<span class="builtinfunc" id="8111374">len</span><span class="op" id="8111377">(</span><span class="ident" id="8111378">all</span><span class="op" id="8111381">)</span><span class="op" id="8111382">;</span>&nbsp;<span class="ident" id="8111384">i</span><span class="op" id="8111385">++</span>&nbsp;<span class="op" id="8111388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111392">for</span>&nbsp;<span class="ident" id="8111396">j</span>&nbsp;<span class="op" id="8111398">:=</span>&nbsp;<span class="num" id="8111401">0</span><span class="op" id="8111402">;</span>&nbsp;<span class="ident" id="8111404">j</span>&nbsp;<span class="op" id="8111406">&lt;</span>&nbsp;<span class="builtinfunc" id="8111408">len</span><span class="op" id="8111411">(</span><span class="ident" id="8111412">all</span><span class="op" id="8111415">)</span><span class="op" id="8111416">-</span><span class="ident" id="8111417">i</span><span class="op" id="8111418">;</span>&nbsp;<span class="ident" id="8111420">j</span><span class="op" id="8111421">++</span>&nbsp;<span class="op" id="8111424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111429">buf</span>&nbsp;<span class="op" id="8111433">:=</span>&nbsp;<span class="builtinfunc" id="8111436">make</span><span class="op" id="8111440">(</span><span class="op" id="8111441">[</span><span class="op" id="8111442">]</span><span class="builtintype" id="8111443">byte</span><span class="op" id="8111447">,</span>&nbsp;<span class="ident" id="8111449">j</span><span class="op" id="8111450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111455">n</span><span class="op" id="8111456">,</span>&nbsp;<span class="ident" id="8111458">err</span>&nbsp;<span class="op" id="8111462">:=</span>&nbsp;<span class="ident" id="8111465">b</span><span class="op" id="8111466">.</span><span class="ident" id="8111467">ReadAt</span><span class="op" id="8111473">(</span><span class="ident" id="8111474">buf</span><span class="op" id="8111477">,</span>&nbsp;<span class="ident" id="8111479">int64</span><span class="op" id="8111484">(</span><span class="ident" id="8111485">i</span><span class="op" id="8111486">)</span><span class="op" id="8111487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111492">if</span>&nbsp;<span class="ident" id="8111495">err</span>&nbsp;<span class="op" id="8111499">!=</span>&nbsp;<span class="ident" id="8111502">nil</span>&nbsp;<span class="op" id="8111506">||</span>&nbsp;<span class="ident" id="8111509">n</span>&nbsp;<span class="op" id="8111511">!=</span>&nbsp;<span class="builtinfunc" id="8111514">len</span><span class="op" id="8111517">(</span><span class="ident" id="8111518">buf</span><span class="op" id="8111521">)</span>&nbsp;<span class="op" id="8111523">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111529">t</span><span class="op" id="8111530">.</span><span class="ident" id="8111531">Errorf</span><span class="op" id="8111537">(</span><span class="string" id="8111538">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="8111577">,</span>&nbsp;<span class="ident" id="8111579">i</span><span class="op" id="8111580">,</span>&nbsp;<span class="ident" id="8111582">j</span><span class="op" id="8111583">,</span>&nbsp;<span class="ident" id="8111585">n</span><span class="op" id="8111586">,</span>&nbsp;<span class="ident" id="8111588">err</span><span class="op" id="8111591">,</span>&nbsp;<span class="builtinfunc" id="8111593">len</span><span class="op" id="8111596">(</span><span class="ident" id="8111597">buf</span><span class="op" id="8111600">)</span><span class="op" id="8111601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111611">if</span>&nbsp;<span class="op" id="8111614">!</span><span class="ident" id="8111615">bytes</span><span class="op" id="8111620">.</span><span class="ident" id="8111621">Equal</span><span class="op" id="8111626">(</span><span class="ident" id="8111627">buf</span><span class="op" id="8111630">,</span>&nbsp;<span class="ident" id="8111632">all</span><span class="op" id="8111635">[</span><span class="ident" id="8111636">i</span><span class="op" id="8111637">:</span><span class="ident" id="8111638">i</span><span class="op" id="8111639">+</span><span class="ident" id="8111640">j</span><span class="op" id="8111641">]</span><span class="op" id="8111642">)</span>&nbsp;<span class="op" id="8111644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111650">t</span><span class="op" id="8111651">.</span><span class="ident" id="8111652">Errorf</span><span class="op" id="8111658">(</span><span class="string" id="8111659">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8111689">,</span>&nbsp;<span class="ident" id="8111691">i</span><span class="op" id="8111692">,</span>&nbsp;<span class="ident" id="8111694">j</span><span class="op" id="8111695">,</span>&nbsp;<span class="ident" id="8111697">buf</span><span class="op" id="8111700">,</span>&nbsp;<span class="ident" id="8111702">all</span><span class="op" id="8111705">[</span><span class="ident" id="8111706">i</span><span class="op" id="8111707">:</span><span class="ident" id="8111708">i</span><span class="op" id="8111709">+</span><span class="ident" id="8111710">j</span><span class="op" id="8111711">]</span><span class="op" id="8111712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111717">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111724">}</span><br>
<span class="lineno"></span><span class="op" id="8111726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8111729">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="8111784">type</span>&nbsp;<span class="ident" id="8111789">fakeHash32</span>&nbsp;<span class="keyword" id="8111800">struct</span>&nbsp;<span class="op" id="8111807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111810">hash</span><span class="op" id="8111814">.</span><span class="ident" id="8111815">Hash32</span><br>
<span class="lineno"></span><span class="op" id="8111822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8111825">func</span>&nbsp;<span class="op" id="8111830">(</span><span class="ident" id="8111831">fakeHash32</span><span class="op" id="8111841">)</span>&nbsp;<span class="ident" id="8111843">Write</span><span class="op" id="8111848">(</span><span class="ident" id="8111849">p</span>&nbsp;<span class="op" id="8111851">[</span><span class="op" id="8111852">]</span><span class="builtintype" id="8111853">byte</span><span class="op" id="8111857">)</span>&nbsp;<span class="op" id="8111859">(</span><span class="builtintype" id="8111860">int</span><span class="op" id="8111863">,</span>&nbsp;<span class="builtintype" id="8111865">error</span><span class="op" id="8111870">)</span>&nbsp;<span class="op" id="8111872">{</span>&nbsp;<span class="keyword" id="8111874">return</span>&nbsp;<span class="builtinfunc" id="8111881">len</span><span class="op" id="8111884">(</span><span class="ident" id="8111885">p</span><span class="op" id="8111886">)</span><span class="op" id="8111887">,</span>&nbsp;<span class="ident" id="8111889">nil</span>&nbsp;<span class="op" id="8111893">}</span><br>
<span class="lineno">225</span><span class="keyword" id="8111895">func</span>&nbsp;<span class="op" id="8111900">(</span><span class="ident" id="8111901">fakeHash32</span><span class="op" id="8111911">)</span>&nbsp;<span class="ident" id="8111913">Sum32</span><span class="op" id="8111918">(</span><span class="op" id="8111919">)</span>&nbsp;<span class="builtintype" id="8111921">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8111942">{</span>&nbsp;<span class="keyword" id="8111944">return</span>&nbsp;<span class="num" id="8111951">0</span>&nbsp;<span class="op" id="8111953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8111956">func</span>&nbsp;<span class="ident" id="8111961">TestZip64</span><span class="op" id="8111970">(</span><span class="ident" id="8111971">t</span>&nbsp;<span class="op" id="8111973">*</span><span class="ident" id="8111974">testing</span><span class="op" id="8111981">.</span><span class="ident" id="8111982">T</span><span class="op" id="8111983">)</span>&nbsp;<span class="op" id="8111985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111988">if</span>&nbsp;<span class="ident" id="8111991">testing</span><span class="op" id="8111998">.</span><span class="ident" id="8111999">Short</span><span class="op" id="8112004">(</span><span class="op" id="8112005">)</span>&nbsp;<span class="op" id="8112007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112011">t</span><span class="op" id="8112012">.</span><span class="ident" id="8112013">Skip</span><span class="op" id="8112017">(</span><span class="string" id="8112018">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="8112039">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112045">const</span>&nbsp;<span class="ident" id="8112051">size</span>&nbsp;<span class="op" id="8112056">=</span>&nbsp;<span class="num" id="8112058">1</span>&nbsp;<span class="op" id="8112060">&lt;&lt;</span>&nbsp;<span class="num" id="8112063">32</span>&nbsp;<span class="comment" id="8112066">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112094">testZip64</span><span class="op" id="8112103">(</span><span class="ident" id="8112104">t</span><span class="op" id="8112105">,</span>&nbsp;<span class="ident" id="8112107">size</span><span class="op" id="8112111">)</span><br>
<span class="lineno"></span><span class="op" id="8112113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="8112116">func</span>&nbsp;<span class="ident" id="8112121">testZip64</span><span class="op" id="8112130">(</span><span class="ident" id="8112131">t</span>&nbsp;<span class="ident" id="8112133">testing</span><span class="op" id="8112140">.</span><span class="ident" id="8112141">TB</span><span class="op" id="8112143">,</span>&nbsp;<span class="ident" id="8112145">size</span>&nbsp;<span class="ident" id="8112150">int64</span><span class="op" id="8112155">)</span>&nbsp;<span class="op" id="8112157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112160">const</span>&nbsp;<span class="ident" id="8112166">chunkSize</span>&nbsp;<span class="op" id="8112176">=</span>&nbsp;<span class="num" id="8112178">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112184">chunks</span>&nbsp;<span class="op" id="8112191">:=</span>&nbsp;<span class="builtintype" id="8112194">int</span><span class="op" id="8112197">(</span><span class="ident" id="8112198">size</span>&nbsp;<span class="op" id="8112203">/</span>&nbsp;<span class="ident" id="8112205">chunkSize</span><span class="op" id="8112214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8112217">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112265">buf</span>&nbsp;<span class="op" id="8112269">:=</span>&nbsp;<span class="builtinfunc" id="8112272">new</span><span class="op" id="8112275">(</span><span class="ident" id="8112276">rleBuffer</span><span class="op" id="8112285">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112288">w</span>&nbsp;<span class="op" id="8112290">:=</span>&nbsp;<span class="ident" id="8112293">NewWriter</span><span class="op" id="8112302">(</span><span class="ident" id="8112303">buf</span><span class="op" id="8112306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112309">f</span><span class="op" id="8112310">,</span>&nbsp;<span class="ident" id="8112312">err</span>&nbsp;<span class="op" id="8112316">:=</span>&nbsp;<span class="ident" id="8112319">w</span><span class="op" id="8112320">.</span><span class="ident" id="8112321">CreateHeader</span><span class="op" id="8112333">(</span><span class="op" id="8112334">&amp;</span><span class="ident" id="8112335">FileHeader</span><span class="op" id="8112345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112349">Name</span><span class="op" id="8112353">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8112357">&#34;huge.txt&#34;</span><span class="op" id="8112367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112371">Method</span><span class="op" id="8112377">:</span>&nbsp;<span class="ident" id="8112379">Store</span><span class="op" id="8112384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112387">}</span><span class="op" id="8112388">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112391">if</span>&nbsp;<span class="ident" id="8112394">err</span>&nbsp;<span class="op" id="8112398">!=</span>&nbsp;<span class="ident" id="8112401">nil</span>&nbsp;<span class="op" id="8112405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112409">t</span><span class="op" id="8112410">.</span><span class="ident" id="8112411">Fatal</span><span class="op" id="8112416">(</span><span class="ident" id="8112417">err</span><span class="op" id="8112420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112426">f</span><span class="op" id="8112427">.</span><span class="op" id="8112428">(</span><span class="op" id="8112429">*</span><span class="ident" id="8112430">fileWriter</span><span class="op" id="8112440">)</span><span class="op" id="8112441">.</span><span class="ident" id="8112442">crc32</span>&nbsp;<span class="op" id="8112448">=</span>&nbsp;<span class="ident" id="8112450">fakeHash32</span><span class="op" id="8112460">{</span><span class="op" id="8112461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112464">chunk</span>&nbsp;<span class="op" id="8112470">:=</span>&nbsp;<span class="builtinfunc" id="8112473">make</span><span class="op" id="8112477">(</span><span class="op" id="8112478">[</span><span class="op" id="8112479">]</span><span class="builtintype" id="8112480">byte</span><span class="op" id="8112484">,</span>&nbsp;<span class="ident" id="8112486">chunkSize</span><span class="op" id="8112495">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112498">for</span>&nbsp;<span class="ident" id="8112502">i</span>&nbsp;<span class="op" id="8112504">:=</span>&nbsp;<span class="keyword" id="8112507">range</span>&nbsp;<span class="ident" id="8112513">chunk</span>&nbsp;<span class="op" id="8112519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112523">chunk</span><span class="op" id="8112528">[</span><span class="ident" id="8112529">i</span><span class="op" id="8112530">]</span>&nbsp;<span class="op" id="8112532">=</span>&nbsp;<span class="string" id="8112534">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112542">for</span>&nbsp;<span class="ident" id="8112546">i</span>&nbsp;<span class="op" id="8112548">:=</span>&nbsp;<span class="num" id="8112551">0</span><span class="op" id="8112552">;</span>&nbsp;<span class="ident" id="8112554">i</span>&nbsp;<span class="op" id="8112556">&lt;</span>&nbsp;<span class="ident" id="8112558">chunks</span><span class="op" id="8112564">;</span>&nbsp;<span class="ident" id="8112566">i</span><span class="op" id="8112567">++</span>&nbsp;<span class="op" id="8112570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112574">_</span><span class="op" id="8112575">,</span>&nbsp;<span class="ident" id="8112577">err</span>&nbsp;<span class="op" id="8112581">:=</span>&nbsp;<span class="ident" id="8112584">f</span><span class="op" id="8112585">.</span><span class="ident" id="8112586">Write</span><span class="op" id="8112591">(</span><span class="ident" id="8112592">chunk</span><span class="op" id="8112597">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112601">if</span>&nbsp;<span class="ident" id="8112604">err</span>&nbsp;<span class="op" id="8112608">!=</span>&nbsp;<span class="ident" id="8112611">nil</span>&nbsp;<span class="op" id="8112615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112620">t</span><span class="op" id="8112621">.</span><span class="ident" id="8112622">Fatal</span><span class="op" id="8112627">(</span><span class="string" id="8112628">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="8112642">,</span>&nbsp;<span class="ident" id="8112644">err</span><span class="op" id="8112647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112657">end</span>&nbsp;<span class="op" id="8112661">:=</span>&nbsp;<span class="op" id="8112664">[</span><span class="op" id="8112665">]</span><span class="builtintype" id="8112666">byte</span><span class="op" id="8112670">(</span><span class="string" id="8112671">&#34;END\n&#34;</span><span class="op" id="8112678">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112681">_</span><span class="op" id="8112682">,</span>&nbsp;<span class="ident" id="8112684">err</span>&nbsp;<span class="op" id="8112688">=</span>&nbsp;<span class="ident" id="8112690">f</span><span class="op" id="8112691">.</span><span class="ident" id="8112692">Write</span><span class="op" id="8112697">(</span><span class="ident" id="8112698">end</span><span class="op" id="8112701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112704">if</span>&nbsp;<span class="ident" id="8112707">err</span>&nbsp;<span class="op" id="8112711">!=</span>&nbsp;<span class="ident" id="8112714">nil</span>&nbsp;<span class="op" id="8112718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112722">t</span><span class="op" id="8112723">.</span><span class="ident" id="8112724">Fatal</span><span class="op" id="8112729">(</span><span class="string" id="8112730">&#34;write&nbsp;end:&#34;</span><span class="op" id="8112742">,</span>&nbsp;<span class="ident" id="8112744">err</span><span class="op" id="8112747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112753">if</span>&nbsp;<span class="ident" id="8112756">err</span>&nbsp;<span class="op" id="8112760">:=</span>&nbsp;<span class="ident" id="8112763">w</span><span class="op" id="8112764">.</span><span class="ident" id="8112765">Close</span><span class="op" id="8112770">(</span><span class="op" id="8112771">)</span><span class="op" id="8112772">;</span>&nbsp;<span class="ident" id="8112774">err</span>&nbsp;<span class="op" id="8112778">!=</span>&nbsp;<span class="ident" id="8112781">nil</span>&nbsp;<span class="op" id="8112785">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112789">t</span><span class="op" id="8112790">.</span><span class="ident" id="8112791">Fatal</span><span class="op" id="8112796">(</span><span class="ident" id="8112797">err</span><span class="op" id="8112800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8112807">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112869">r</span><span class="op" id="8112870">,</span>&nbsp;<span class="ident" id="8112872">err</span>&nbsp;<span class="op" id="8112876">:=</span>&nbsp;<span class="ident" id="8112879">NewReader</span><span class="op" id="8112888">(</span><span class="ident" id="8112889">buf</span><span class="op" id="8112892">,</span>&nbsp;<span class="ident" id="8112894">int64</span><span class="op" id="8112899">(</span><span class="ident" id="8112900">buf</span><span class="op" id="8112903">.</span><span class="ident" id="8112904">Size</span><span class="op" id="8112908">(</span><span class="op" id="8112909">)</span><span class="op" id="8112910">)</span><span class="op" id="8112911">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112914">if</span>&nbsp;<span class="ident" id="8112917">err</span>&nbsp;<span class="op" id="8112921">!=</span>&nbsp;<span class="ident" id="8112924">nil</span>&nbsp;<span class="op" id="8112928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112932">t</span><span class="op" id="8112933">.</span><span class="ident" id="8112934">Fatal</span><span class="op" id="8112939">(</span><span class="string" id="8112940">&#34;reader:&#34;</span><span class="op" id="8112949">,</span>&nbsp;<span class="ident" id="8112951">err</span><span class="op" id="8112954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112960">f0</span>&nbsp;<span class="op" id="8112963">:=</span>&nbsp;<span class="ident" id="8112966">r</span><span class="op" id="8112967">.</span><span class="ident" id="8112968">File</span><span class="op" id="8112972">[</span><span class="num" id="8112973">0</span><span class="op" id="8112974">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112977">rc</span><span class="op" id="8112979">,</span>&nbsp;<span class="ident" id="8112981">err</span>&nbsp;<span class="op" id="8112985">:=</span>&nbsp;<span class="ident" id="8112988">f0</span><span class="op" id="8112990">.</span><span class="ident" id="8112991">Open</span><span class="op" id="8112995">(</span><span class="op" id="8112996">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112999">if</span>&nbsp;<span class="ident" id="8113002">err</span>&nbsp;<span class="op" id="8113006">!=</span>&nbsp;<span class="ident" id="8113009">nil</span>&nbsp;<span class="op" id="8113013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113017">t</span><span class="op" id="8113018">.</span><span class="ident" id="8113019">Fatal</span><span class="op" id="8113024">(</span><span class="string" id="8113025">&#34;opening:&#34;</span><span class="op" id="8113035">,</span>&nbsp;<span class="ident" id="8113037">err</span><span class="op" id="8113040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113046">rc</span><span class="op" id="8113048">.</span><span class="op" id="8113049">(</span><span class="op" id="8113050">*</span><span class="ident" id="8113051">checksumReader</span><span class="op" id="8113065">)</span><span class="op" id="8113066">.</span><span class="ident" id="8113067">hash</span>&nbsp;<span class="op" id="8113072">=</span>&nbsp;<span class="ident" id="8113074">fakeHash32</span><span class="op" id="8113084">{</span><span class="op" id="8113085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113088">for</span>&nbsp;<span class="ident" id="8113092">i</span>&nbsp;<span class="op" id="8113094">:=</span>&nbsp;<span class="num" id="8113097">0</span><span class="op" id="8113098">;</span>&nbsp;<span class="ident" id="8113100">i</span>&nbsp;<span class="op" id="8113102">&lt;</span>&nbsp;<span class="ident" id="8113104">chunks</span><span class="op" id="8113110">;</span>&nbsp;<span class="ident" id="8113112">i</span><span class="op" id="8113113">++</span>&nbsp;<span class="op" id="8113116">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113120">_</span><span class="op" id="8113121">,</span>&nbsp;<span class="ident" id="8113123">err</span>&nbsp;<span class="op" id="8113127">:=</span>&nbsp;<span class="ident" id="8113130">io</span><span class="op" id="8113132">.</span><span class="ident" id="8113133">ReadFull</span><span class="op" id="8113141">(</span><span class="ident" id="8113142">rc</span><span class="op" id="8113144">,</span>&nbsp;<span class="ident" id="8113146">chunk</span><span class="op" id="8113151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113155">if</span>&nbsp;<span class="ident" id="8113158">err</span>&nbsp;<span class="op" id="8113162">!=</span>&nbsp;<span class="ident" id="8113165">nil</span>&nbsp;<span class="op" id="8113169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113174">t</span><span class="op" id="8113175">.</span><span class="ident" id="8113176">Fatal</span><span class="op" id="8113181">(</span><span class="string" id="8113182">&#34;read:&#34;</span><span class="op" id="8113189">,</span>&nbsp;<span class="ident" id="8113191">err</span><span class="op" id="8113194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113201">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113204">gotEnd</span><span class="op" id="8113210">,</span>&nbsp;<span class="ident" id="8113212">err</span>&nbsp;<span class="op" id="8113216">:=</span>&nbsp;<span class="ident" id="8113219">ioutil</span><span class="op" id="8113225">.</span><span class="ident" id="8113226">ReadAll</span><span class="op" id="8113233">(</span><span class="ident" id="8113234">rc</span><span class="op" id="8113236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113239">if</span>&nbsp;<span class="ident" id="8113242">err</span>&nbsp;<span class="op" id="8113246">!=</span>&nbsp;<span class="ident" id="8113249">nil</span>&nbsp;<span class="op" id="8113253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113257">t</span><span class="op" id="8113258">.</span><span class="ident" id="8113259">Fatal</span><span class="op" id="8113264">(</span><span class="string" id="8113265">&#34;read&nbsp;end:&#34;</span><span class="op" id="8113276">,</span>&nbsp;<span class="ident" id="8113278">err</span><span class="op" id="8113281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113287">if</span>&nbsp;<span class="op" id="8113290">!</span><span class="ident" id="8113291">bytes</span><span class="op" id="8113296">.</span><span class="ident" id="8113297">Equal</span><span class="op" id="8113302">(</span><span class="ident" id="8113303">gotEnd</span><span class="op" id="8113309">,</span>&nbsp;<span class="ident" id="8113311">end</span><span class="op" id="8113314">)</span>&nbsp;<span class="op" id="8113316">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113320">t</span><span class="op" id="8113321">.</span><span class="ident" id="8113322">Errorf</span><span class="op" id="8113328">(</span><span class="string" id="8113329">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8113363">,</span>&nbsp;<span class="ident" id="8113365">gotEnd</span><span class="op" id="8113371">,</span>&nbsp;<span class="ident" id="8113373">end</span><span class="op" id="8113376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113382">err</span>&nbsp;<span class="op" id="8113386">=</span>&nbsp;<span class="ident" id="8113388">rc</span><span class="op" id="8113390">.</span><span class="ident" id="8113391">Close</span><span class="op" id="8113396">(</span><span class="op" id="8113397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113400">if</span>&nbsp;<span class="ident" id="8113403">err</span>&nbsp;<span class="op" id="8113407">!=</span>&nbsp;<span class="ident" id="8113410">nil</span>&nbsp;<span class="op" id="8113414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113418">t</span><span class="op" id="8113419">.</span><span class="ident" id="8113420">Fatal</span><span class="op" id="8113425">(</span><span class="string" id="8113426">&#34;closing:&#34;</span><span class="op" id="8113436">,</span>&nbsp;<span class="ident" id="8113438">err</span><span class="op" id="8113441">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113447">if</span>&nbsp;<span class="ident" id="8113450">size</span>&nbsp;<span class="op" id="8113455">==</span>&nbsp;<span class="num" id="8113458">1</span><span class="op" id="8113459">&lt;&lt;</span><span class="num" id="8113461">32</span>&nbsp;<span class="op" id="8113464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113468">if</span>&nbsp;<span class="ident" id="8113471">got</span><span class="op" id="8113474">,</span>&nbsp;<span class="ident" id="8113476">want</span>&nbsp;<span class="op" id="8113481">:=</span>&nbsp;<span class="ident" id="8113484">f0</span><span class="op" id="8113486">.</span><span class="ident" id="8113487">UncompressedSize</span><span class="op" id="8113503">,</span>&nbsp;<span class="builtintype" id="8113505">uint32</span><span class="op" id="8113511">(</span><span class="ident" id="8113512">uint32max</span><span class="op" id="8113521">)</span><span class="op" id="8113522">;</span>&nbsp;<span class="ident" id="8113524">got</span>&nbsp;<span class="op" id="8113528">!=</span>&nbsp;<span class="ident" id="8113531">want</span>&nbsp;<span class="op" id="8113536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113541">t</span><span class="op" id="8113542">.</span><span class="ident" id="8113543">Errorf</span><span class="op" id="8113549">(</span><span class="string" id="8113550">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8113580">,</span>&nbsp;<span class="ident" id="8113582">got</span><span class="op" id="8113585">,</span>&nbsp;<span class="ident" id="8113587">want</span><span class="op" id="8113591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113595">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113602">if</span>&nbsp;<span class="ident" id="8113605">got</span><span class="op" id="8113608">,</span>&nbsp;<span class="ident" id="8113610">want</span>&nbsp;<span class="op" id="8113615">:=</span>&nbsp;<span class="ident" id="8113618">f0</span><span class="op" id="8113620">.</span><span class="ident" id="8113621">UncompressedSize64</span><span class="op" id="8113639">,</span>&nbsp;<span class="ident" id="8113641">uint64</span><span class="op" id="8113647">(</span><span class="ident" id="8113648">size</span><span class="op" id="8113652">)</span><span class="op" id="8113653">+</span><span class="ident" id="8113654">uint64</span><span class="op" id="8113660">(</span><span class="builtinfunc" id="8113661">len</span><span class="op" id="8113664">(</span><span class="ident" id="8113665">end</span><span class="op" id="8113668">)</span><span class="op" id="8113669">)</span><span class="op" id="8113670">;</span>&nbsp;<span class="ident" id="8113672">got</span>&nbsp;<span class="op" id="8113676">!=</span>&nbsp;<span class="ident" id="8113679">want</span>&nbsp;<span class="op" id="8113684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113688">t</span><span class="op" id="8113689">.</span><span class="ident" id="8113690">Errorf</span><span class="op" id="8113696">(</span><span class="string" id="8113697">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8113729">,</span>&nbsp;<span class="ident" id="8113731">got</span><span class="op" id="8113734">,</span>&nbsp;<span class="ident" id="8113736">want</span><span class="op" id="8113740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113743">}</span><br>
<span class="lineno">305</span><span class="op" id="8113745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8113748">func</span>&nbsp;<span class="ident" id="8113753">testInvalidHeader</span><span class="op" id="8113770">(</span><span class="ident" id="8113771">h</span>&nbsp;<span class="op" id="8113773">*</span><span class="ident" id="8113774">FileHeader</span><span class="op" id="8113784">,</span>&nbsp;<span class="ident" id="8113786">t</span>&nbsp;<span class="op" id="8113788">*</span><span class="ident" id="8113789">testing</span><span class="op" id="8113796">.</span><span class="ident" id="8113797">T</span><span class="op" id="8113798">)</span>&nbsp;<span class="op" id="8113800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113803">var</span>&nbsp;<span class="ident" id="8113807">buf</span>&nbsp;<span class="ident" id="8113811">bytes</span><span class="op" id="8113816">.</span><span class="ident" id="8113817">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113825">z</span>&nbsp;<span class="op" id="8113827">:=</span>&nbsp;<span class="ident" id="8113830">NewWriter</span><span class="op" id="8113839">(</span><span class="op" id="8113840">&amp;</span><span class="ident" id="8113841">buf</span><span class="op" id="8113844">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113848">f</span><span class="op" id="8113849">,</span>&nbsp;<span class="ident" id="8113851">err</span>&nbsp;<span class="op" id="8113855">:=</span>&nbsp;<span class="ident" id="8113858">z</span><span class="op" id="8113859">.</span><span class="ident" id="8113860">CreateHeader</span><span class="op" id="8113872">(</span><span class="ident" id="8113873">h</span><span class="op" id="8113874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113877">if</span>&nbsp;<span class="ident" id="8113880">err</span>&nbsp;<span class="op" id="8113884">!=</span>&nbsp;<span class="ident" id="8113887">nil</span>&nbsp;<span class="op" id="8113891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113895">t</span><span class="op" id="8113896">.</span><span class="ident" id="8113897">Fatalf</span><span class="op" id="8113903">(</span><span class="string" id="8113904">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="8113931">,</span>&nbsp;<span class="ident" id="8113933">err</span><span class="op" id="8113936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113939">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113942">if</span>&nbsp;<span class="ident" id="8113945">_</span><span class="op" id="8113946">,</span>&nbsp;<span class="ident" id="8113948">err</span>&nbsp;<span class="op" id="8113952">:=</span>&nbsp;<span class="ident" id="8113955">f</span><span class="op" id="8113956">.</span><span class="ident" id="8113957">Write</span><span class="op" id="8113962">(</span><span class="op" id="8113963">[</span><span class="op" id="8113964">]</span><span class="builtintype" id="8113965">byte</span><span class="op" id="8113969">(</span><span class="string" id="8113970">&#34;hi&#34;</span><span class="op" id="8113974">)</span><span class="op" id="8113975">)</span><span class="op" id="8113976">;</span>&nbsp;<span class="ident" id="8113978">err</span>&nbsp;<span class="op" id="8113982">!=</span>&nbsp;<span class="ident" id="8113985">nil</span>&nbsp;<span class="op" id="8113989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113993">t</span><span class="op" id="8113994">.</span><span class="ident" id="8113995">Fatalf</span><span class="op" id="8114001">(</span><span class="string" id="8114002">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="8114029">,</span>&nbsp;<span class="ident" id="8114031">err</span><span class="op" id="8114034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114040">if</span>&nbsp;<span class="ident" id="8114043">err</span>&nbsp;<span class="op" id="8114047">:=</span>&nbsp;<span class="ident" id="8114050">z</span><span class="op" id="8114051">.</span><span class="ident" id="8114052">Close</span><span class="op" id="8114057">(</span><span class="op" id="8114058">)</span><span class="op" id="8114059">;</span>&nbsp;<span class="ident" id="8114061">err</span>&nbsp;<span class="op" id="8114065">!=</span>&nbsp;<span class="ident" id="8114068">nil</span>&nbsp;<span class="op" id="8114072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114076">t</span><span class="op" id="8114077">.</span><span class="ident" id="8114078">Fatalf</span><span class="op" id="8114084">(</span><span class="string" id="8114085">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="8114115">,</span>&nbsp;<span class="ident" id="8114117">err</span><span class="op" id="8114120">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114127">b</span>&nbsp;<span class="op" id="8114129">:=</span>&nbsp;<span class="ident" id="8114132">buf</span><span class="op" id="8114135">.</span><span class="ident" id="8114136">Bytes</span><span class="op" id="8114141">(</span><span class="op" id="8114142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114145">if</span>&nbsp;<span class="ident" id="8114148">_</span><span class="op" id="8114149">,</span>&nbsp;<span class="ident" id="8114151">err</span>&nbsp;<span class="op" id="8114155">=</span>&nbsp;<span class="ident" id="8114157">NewReader</span><span class="op" id="8114166">(</span><span class="ident" id="8114167">bytes</span><span class="op" id="8114172">.</span><span class="ident" id="8114173">NewReader</span><span class="op" id="8114182">(</span><span class="ident" id="8114183">b</span><span class="op" id="8114184">)</span><span class="op" id="8114185">,</span>&nbsp;<span class="ident" id="8114187">int64</span><span class="op" id="8114192">(</span><span class="builtinfunc" id="8114193">len</span><span class="op" id="8114196">(</span><span class="ident" id="8114197">b</span><span class="op" id="8114198">)</span><span class="op" id="8114199">)</span><span class="op" id="8114200">)</span><span class="op" id="8114201">;</span>&nbsp;<span class="ident" id="8114203">err</span>&nbsp;<span class="op" id="8114207">!=</span>&nbsp;<span class="ident" id="8114210">ErrFormat</span>&nbsp;<span class="op" id="8114220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114224">t</span><span class="op" id="8114225">.</span><span class="ident" id="8114226">Fatalf</span><span class="op" id="8114232">(</span><span class="string" id="8114233">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="8114261">,</span>&nbsp;<span class="ident" id="8114263">err</span><span class="op" id="8114266">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114269">}</span><br>
<span class="lineno"></span><span class="op" id="8114271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8114274">func</span>&nbsp;<span class="ident" id="8114279">testValidHeader</span><span class="op" id="8114294">(</span><span class="ident" id="8114295">h</span>&nbsp;<span class="op" id="8114297">*</span><span class="ident" id="8114298">FileHeader</span><span class="op" id="8114308">,</span>&nbsp;<span class="ident" id="8114310">t</span>&nbsp;<span class="op" id="8114312">*</span><span class="ident" id="8114313">testing</span><span class="op" id="8114320">.</span><span class="ident" id="8114321">T</span><span class="op" id="8114322">)</span>&nbsp;<span class="op" id="8114324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114327">var</span>&nbsp;<span class="ident" id="8114331">buf</span>&nbsp;<span class="ident" id="8114335">bytes</span><span class="op" id="8114340">.</span><span class="ident" id="8114341">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114349">z</span>&nbsp;<span class="op" id="8114351">:=</span>&nbsp;<span class="ident" id="8114354">NewWriter</span><span class="op" id="8114363">(</span><span class="op" id="8114364">&amp;</span><span class="ident" id="8114365">buf</span><span class="op" id="8114368">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114372">f</span><span class="op" id="8114373">,</span>&nbsp;<span class="ident" id="8114375">err</span>&nbsp;<span class="op" id="8114379">:=</span>&nbsp;<span class="ident" id="8114382">z</span><span class="op" id="8114383">.</span><span class="ident" id="8114384">CreateHeader</span><span class="op" id="8114396">(</span><span class="ident" id="8114397">h</span><span class="op" id="8114398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114401">if</span>&nbsp;<span class="ident" id="8114404">err</span>&nbsp;<span class="op" id="8114408">!=</span>&nbsp;<span class="ident" id="8114411">nil</span>&nbsp;<span class="op" id="8114415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114419">t</span><span class="op" id="8114420">.</span><span class="ident" id="8114421">Fatalf</span><span class="op" id="8114427">(</span><span class="string" id="8114428">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="8114455">,</span>&nbsp;<span class="ident" id="8114457">err</span><span class="op" id="8114460">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114466">if</span>&nbsp;<span class="ident" id="8114469">_</span><span class="op" id="8114470">,</span>&nbsp;<span class="ident" id="8114472">err</span>&nbsp;<span class="op" id="8114476">:=</span>&nbsp;<span class="ident" id="8114479">f</span><span class="op" id="8114480">.</span><span class="ident" id="8114481">Write</span><span class="op" id="8114486">(</span><span class="op" id="8114487">[</span><span class="op" id="8114488">]</span><span class="builtintype" id="8114489">byte</span><span class="op" id="8114493">(</span><span class="string" id="8114494">&#34;hi&#34;</span><span class="op" id="8114498">)</span><span class="op" id="8114499">)</span><span class="op" id="8114500">;</span>&nbsp;<span class="ident" id="8114502">err</span>&nbsp;<span class="op" id="8114506">!=</span>&nbsp;<span class="ident" id="8114509">nil</span>&nbsp;<span class="op" id="8114513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114517">t</span><span class="op" id="8114518">.</span><span class="ident" id="8114519">Fatalf</span><span class="op" id="8114525">(</span><span class="string" id="8114526">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="8114553">,</span>&nbsp;<span class="ident" id="8114555">err</span><span class="op" id="8114558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114564">if</span>&nbsp;<span class="ident" id="8114567">err</span>&nbsp;<span class="op" id="8114571">:=</span>&nbsp;<span class="ident" id="8114574">z</span><span class="op" id="8114575">.</span><span class="ident" id="8114576">Close</span><span class="op" id="8114581">(</span><span class="op" id="8114582">)</span><span class="op" id="8114583">;</span>&nbsp;<span class="ident" id="8114585">err</span>&nbsp;<span class="op" id="8114589">!=</span>&nbsp;<span class="ident" id="8114592">nil</span>&nbsp;<span class="op" id="8114596">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114600">t</span><span class="op" id="8114601">.</span><span class="ident" id="8114602">Fatalf</span><span class="op" id="8114608">(</span><span class="string" id="8114609">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="8114639">,</span>&nbsp;<span class="ident" id="8114641">err</span><span class="op" id="8114644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114651">b</span>&nbsp;<span class="op" id="8114653">:=</span>&nbsp;<span class="ident" id="8114656">buf</span><span class="op" id="8114659">.</span><span class="ident" id="8114660">Bytes</span><span class="op" id="8114665">(</span><span class="op" id="8114666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114669">if</span>&nbsp;<span class="ident" id="8114672">_</span><span class="op" id="8114673">,</span>&nbsp;<span class="ident" id="8114675">err</span>&nbsp;<span class="op" id="8114679">=</span>&nbsp;<span class="ident" id="8114681">NewReader</span><span class="op" id="8114690">(</span><span class="ident" id="8114691">bytes</span><span class="op" id="8114696">.</span><span class="ident" id="8114697">NewReader</span><span class="op" id="8114706">(</span><span class="ident" id="8114707">b</span><span class="op" id="8114708">)</span><span class="op" id="8114709">,</span>&nbsp;<span class="ident" id="8114711">int64</span><span class="op" id="8114716">(</span><span class="builtinfunc" id="8114717">len</span><span class="op" id="8114720">(</span><span class="ident" id="8114721">b</span><span class="op" id="8114722">)</span><span class="op" id="8114723">)</span><span class="op" id="8114724">)</span><span class="op" id="8114725">;</span>&nbsp;<span class="ident" id="8114727">err</span>&nbsp;<span class="op" id="8114731">!=</span>&nbsp;<span class="ident" id="8114734">nil</span>&nbsp;<span class="op" id="8114738">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114742">t</span><span class="op" id="8114743">.</span><span class="ident" id="8114744">Fatalf</span><span class="op" id="8114750">(</span><span class="string" id="8114751">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="8114773">,</span>&nbsp;<span class="ident" id="8114775">err</span><span class="op" id="8114778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114781">}</span><br>
<span class="lineno"></span><span class="op" id="8114783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8114786">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="8114801">func</span>&nbsp;<span class="ident" id="8114806">TestHeaderInvalidTagAndSize</span><span class="op" id="8114833">(</span><span class="ident" id="8114834">t</span>&nbsp;<span class="op" id="8114836">*</span><span class="ident" id="8114837">testing</span><span class="op" id="8114844">.</span><span class="ident" id="8114845">T</span><span class="op" id="8114846">)</span>&nbsp;<span class="op" id="8114848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114851">const</span>&nbsp;<span class="ident" id="8114857">timeFormat</span>&nbsp;<span class="op" id="8114868">=</span>&nbsp;<span class="string" id="8114870">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114898">ts</span>&nbsp;<span class="op" id="8114901">:=</span>&nbsp;<span class="ident" id="8114904">time</span><span class="op" id="8114908">.</span><span class="ident" id="8114909">Now</span><span class="op" id="8114912">(</span><span class="op" id="8114913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114916">filename</span>&nbsp;<span class="op" id="8114925">:=</span>&nbsp;<span class="ident" id="8114928">ts</span><span class="op" id="8114930">.</span><span class="ident" id="8114931">Format</span><span class="op" id="8114937">(</span><span class="ident" id="8114938">timeFormat</span><span class="op" id="8114948">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114952">h</span>&nbsp;<span class="op" id="8114954">:=</span>&nbsp;<span class="ident" id="8114957">FileHeader</span><span class="op" id="8114967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114971">Name</span><span class="op" id="8114975">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8114979">filename</span><span class="op" id="8114987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114991">Method</span><span class="op" id="8114997">:</span>&nbsp;<span class="ident" id="8114999">Deflate</span><span class="op" id="8115006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115010">Extra</span><span class="op" id="8115015">:</span>&nbsp;&nbsp;<span class="op" id="8115018">[</span><span class="op" id="8115019">]</span><span class="builtintype" id="8115020">byte</span><span class="op" id="8115024">(</span><span class="ident" id="8115025">ts</span><span class="op" id="8115027">.</span><span class="ident" id="8115028">Format</span><span class="op" id="8115034">(</span><span class="ident" id="8115035">time</span><span class="op" id="8115039">.</span><span class="ident" id="8115040">RFC3339Nano</span><span class="op" id="8115051">)</span><span class="op" id="8115052">)</span><span class="op" id="8115053">,</span>&nbsp;<span class="comment" id="8115055">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115082">h</span><span class="op" id="8115083">.</span><span class="ident" id="8115084">SetModTime</span><span class="op" id="8115094">(</span><span class="ident" id="8115095">ts</span><span class="op" id="8115097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115101">testInvalidHeader</span><span class="op" id="8115118">(</span><span class="op" id="8115119">&amp;</span><span class="ident" id="8115120">h</span><span class="op" id="8115121">,</span>&nbsp;<span class="ident" id="8115123">t</span><span class="op" id="8115124">)</span><br>
<span class="lineno"></span><span class="op" id="8115126">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="8115129">func</span>&nbsp;<span class="ident" id="8115134">TestHeaderTooShort</span><span class="op" id="8115152">(</span><span class="ident" id="8115153">t</span>&nbsp;<span class="op" id="8115155">*</span><span class="ident" id="8115156">testing</span><span class="op" id="8115163">.</span><span class="ident" id="8115164">T</span><span class="op" id="8115165">)</span>&nbsp;<span class="op" id="8115167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115170">h</span>&nbsp;<span class="op" id="8115172">:=</span>&nbsp;<span class="ident" id="8115175">FileHeader</span><span class="op" id="8115185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115189">Name</span><span class="op" id="8115193">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8115197">&#34;foo.txt&#34;</span><span class="op" id="8115206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115210">Method</span><span class="op" id="8115216">:</span>&nbsp;<span class="ident" id="8115218">Deflate</span><span class="op" id="8115225">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115229">Extra</span><span class="op" id="8115234">:</span>&nbsp;&nbsp;<span class="op" id="8115237">[</span><span class="op" id="8115238">]</span><span class="builtintype" id="8115239">byte</span><span class="op" id="8115243">{</span><span class="ident" id="8115244">zip64ExtraId</span><span class="op" id="8115256">}</span><span class="op" id="8115257">,</span>&nbsp;<span class="comment" id="8115259">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115279">testInvalidHeader</span><span class="op" id="8115296">(</span><span class="op" id="8115297">&amp;</span><span class="ident" id="8115298">h</span><span class="op" id="8115299">,</span>&nbsp;<span class="ident" id="8115301">t</span><span class="op" id="8115302">)</span><br>
<span class="lineno"></span><span class="op" id="8115304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="8115307">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="8115363">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="8115390">func</span>&nbsp;<span class="ident" id="8115395">TestZeroLengthHeader</span><span class="op" id="8115415">(</span><span class="ident" id="8115416">t</span>&nbsp;<span class="op" id="8115418">*</span><span class="ident" id="8115419">testing</span><span class="op" id="8115426">.</span><span class="ident" id="8115427">T</span><span class="op" id="8115428">)</span>&nbsp;<span class="op" id="8115430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115433">h</span>&nbsp;<span class="op" id="8115435">:=</span>&nbsp;<span class="ident" id="8115438">FileHeader</span><span class="op" id="8115448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115452">Name</span><span class="op" id="8115456">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8115460">&#34;extadata.txt&#34;</span><span class="op" id="8115474">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115478">Method</span><span class="op" id="8115484">:</span>&nbsp;<span class="ident" id="8115486">Deflate</span><span class="op" id="8115493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115497">Extra</span><span class="op" id="8115502">:</span>&nbsp;<span class="op" id="8115504">[</span><span class="op" id="8115505">]</span><span class="builtintype" id="8115506">byte</span><span class="op" id="8115510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8115515">85</span><span class="op" id="8115517">,</span>&nbsp;<span class="num" id="8115519">84</span><span class="op" id="8115521">,</span>&nbsp;<span class="num" id="8115523">5</span><span class="op" id="8115524">,</span>&nbsp;<span class="num" id="8115526">0</span><span class="op" id="8115527">,</span>&nbsp;<span class="num" id="8115529">3</span><span class="op" id="8115530">,</span>&nbsp;<span class="num" id="8115532">154</span><span class="op" id="8115535">,</span>&nbsp;<span class="num" id="8115537">144</span><span class="op" id="8115540">,</span>&nbsp;<span class="num" id="8115542">195</span><span class="op" id="8115545">,</span>&nbsp;<span class="num" id="8115547">77</span><span class="op" id="8115549">,</span>&nbsp;<span class="comment" id="8115551">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8115574">85</span><span class="op" id="8115576">,</span>&nbsp;<span class="num" id="8115578">120</span><span class="op" id="8115581">,</span>&nbsp;<span class="num" id="8115583">0</span><span class="op" id="8115584">,</span>&nbsp;<span class="num" id="8115586">0</span><span class="op" id="8115587">,</span>&nbsp;<span class="comment" id="8115589">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115611">}</span><span class="op" id="8115612">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115618">testValidHeader</span><span class="op" id="8115633">(</span><span class="op" id="8115634">&amp;</span><span class="ident" id="8115635">h</span><span class="op" id="8115636">,</span>&nbsp;<span class="ident" id="8115638">t</span><span class="op" id="8115639">)</span><br>
<span class="lineno"></span><span class="op" id="8115641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8115644">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="8115714">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="8115785">func</span>&nbsp;<span class="ident" id="8115790">BenchmarkZip64Test</span><span class="op" id="8115808">(</span><span class="ident" id="8115809">b</span>&nbsp;<span class="op" id="8115811">*</span><span class="ident" id="8115812">testing</span><span class="op" id="8115819">.</span><span class="ident" id="8115820">B</span><span class="op" id="8115821">)</span>&nbsp;<span class="op" id="8115823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115826">for</span>&nbsp;<span class="ident" id="8115830">i</span>&nbsp;<span class="op" id="8115832">:=</span>&nbsp;<span class="num" id="8115835">0</span><span class="op" id="8115836">;</span>&nbsp;<span class="ident" id="8115838">i</span>&nbsp;<span class="op" id="8115840">&lt;</span>&nbsp;<span class="ident" id="8115842">b</span><span class="op" id="8115843">.</span><span class="ident" id="8115844">N</span><span class="op" id="8115845">;</span>&nbsp;<span class="ident" id="8115847">i</span><span class="op" id="8115848">++</span>&nbsp;<span class="op" id="8115851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115855">testZip64</span><span class="op" id="8115864">(</span><span class="ident" id="8115865">b</span><span class="op" id="8115866">,</span>&nbsp;<span class="num" id="8115868">1</span><span class="op" id="8115869">&lt;&lt;</span><span class="num" id="8115871">26</span><span class="op" id="8115873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115876">}</span><br>
<span class="lineno">395</span><span class="op" id="8115878">}</span>
</div>
</body>
</html>
