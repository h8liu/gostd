<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html" class="current">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2489695">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2489751">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2489805">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2489856">//&nbsp;Netlink&nbsp;sockets&nbsp;and&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2489889">package</span>&nbsp;<span class="ident" id="2489897">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2489906">import</span>&nbsp;<span class="string" id="2489913">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2489923">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;message&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2489989">func</span>&nbsp;<span class="ident" id="2489994">nlmAlignOf</span><span class="op" id="2490004">(</span><span class="ident" id="2490005">msglen</span>&nbsp;<span class="builtintype" id="2490012">int</span><span class="op" id="2490015">)</span>&nbsp;<span class="builtintype" id="2490017">int</span>&nbsp;<span class="op" id="2490021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490024">return</span>&nbsp;<span class="op" id="2490031">(</span><span class="ident" id="2490032">msglen</span>&nbsp;<span class="op" id="2490039">+</span>&nbsp;<span class="ident" id="2490041">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2490055">-</span>&nbsp;<span class="num" id="2490057">1</span><span class="op" id="2490058">)</span>&nbsp;<span class="op" id="2490060">&amp;</span>&nbsp;<span class="op" id="2490062">^</span><span class="op" id="2490063">(</span><span class="ident" id="2490064">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2490078">-</span>&nbsp;<span class="num" id="2490080">1</span><span class="op" id="2490081">)</span><br>
<span class="lineno"></span><span class="op" id="2490083">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2490086">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute&nbsp;up&nbsp;to&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2490150">//&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2490163">func</span>&nbsp;<span class="ident" id="2490168">rtaAlignOf</span><span class="op" id="2490178">(</span><span class="ident" id="2490179">attrlen</span>&nbsp;<span class="builtintype" id="2490187">int</span><span class="op" id="2490190">)</span>&nbsp;<span class="builtintype" id="2490192">int</span>&nbsp;<span class="op" id="2490196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490199">return</span>&nbsp;<span class="op" id="2490206">(</span><span class="ident" id="2490207">attrlen</span>&nbsp;<span class="op" id="2490215">+</span>&nbsp;<span class="ident" id="2490217">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2490229">-</span>&nbsp;<span class="num" id="2490231">1</span><span class="op" id="2490232">)</span>&nbsp;<span class="op" id="2490234">&amp;</span>&nbsp;<span class="op" id="2490236">^</span><span class="op" id="2490237">(</span><span class="ident" id="2490238">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2490250">-</span>&nbsp;<span class="num" id="2490252">1</span><span class="op" id="2490253">)</span><br>
<span class="lineno">20</span><span class="op" id="2490255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2490258">//&nbsp;NetlinkRouteRequest&nbsp;represents&nbsp;a&nbsp;request&nbsp;message&nbsp;to&nbsp;receive&nbsp;routing</span><br>
<span class="lineno"></span><span class="comment" id="2490329">//&nbsp;and&nbsp;link&nbsp;states&nbsp;from&nbsp;the&nbsp;kernel.</span><br>
<span class="lineno"></span><span class="keyword" id="2490365">type</span>&nbsp;<span class="ident" id="2490370">NetlinkRouteRequest</span>&nbsp;<span class="keyword" id="2490390">struct</span>&nbsp;<span class="op" id="2490397">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2490400">Header</span>&nbsp;<span class="ident" id="2490407">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2490417">Data</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2490424">RtGenmsg</span><br>
<span class="lineno"></span><span class="op" id="2490433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2490436">func</span>&nbsp;<span class="op" id="2490441">(</span><span class="ident" id="2490442">rr</span>&nbsp;<span class="op" id="2490445">*</span><span class="ident" id="2490446">NetlinkRouteRequest</span><span class="op" id="2490465">)</span>&nbsp;<span class="ident" id="2490467">toWireFormat</span><span class="op" id="2490479">(</span><span class="op" id="2490480">)</span>&nbsp;<span class="op" id="2490482">[</span><span class="op" id="2490483">]</span><span class="builtintype" id="2490484">byte</span>&nbsp;<span class="op" id="2490489">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2490492">b</span>&nbsp;<span class="op" id="2490494">:=</span>&nbsp;<span class="builtinfunc" id="2490497">make</span><span class="op" id="2490501">(</span><span class="op" id="2490502">[</span><span class="op" id="2490503">]</span><span class="builtintype" id="2490504">byte</span><span class="op" id="2490508">,</span>&nbsp;<span class="ident" id="2490510">rr</span><span class="op" id="2490512">.</span><span class="ident" id="2490513">Header</span><span class="op" id="2490519">.</span><span class="ident" id="2490520">Len</span><span class="op" id="2490523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2490526">*</span><span class="op" id="2490527">(</span><span class="op" id="2490528">*</span><span class="builtintype" id="2490529">uint32</span><span class="op" id="2490535">)</span><span class="op" id="2490536">(</span><span class="ident" id="2490537">unsafe</span><span class="op" id="2490543">.</span><span class="ident" id="2490544">Pointer</span><span class="op" id="2490551">(</span><span class="op" id="2490552">&amp;</span><span class="ident" id="2490553">b</span><span class="op" id="2490554">[</span><span class="num" id="2490555">0</span><span class="op" id="2490556">:</span><span class="num" id="2490557">4</span><span class="op" id="2490558">]</span><span class="op" id="2490559">[</span><span class="num" id="2490560">0</span><span class="op" id="2490561">]</span><span class="op" id="2490562">)</span><span class="op" id="2490563">)</span>&nbsp;<span class="op" id="2490565">=</span>&nbsp;<span class="ident" id="2490567">rr</span><span class="op" id="2490569">.</span><span class="ident" id="2490570">Header</span><span class="op" id="2490576">.</span><span class="ident" id="2490577">Len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2490582">*</span><span class="op" id="2490583">(</span><span class="op" id="2490584">*</span><span class="builtintype" id="2490585">uint16</span><span class="op" id="2490591">)</span><span class="op" id="2490592">(</span><span class="ident" id="2490593">unsafe</span><span class="op" id="2490599">.</span><span class="ident" id="2490600">Pointer</span><span class="op" id="2490607">(</span><span class="op" id="2490608">&amp;</span><span class="ident" id="2490609">b</span><span class="op" id="2490610">[</span><span class="num" id="2490611">4</span><span class="op" id="2490612">:</span><span class="num" id="2490613">6</span><span class="op" id="2490614">]</span><span class="op" id="2490615">[</span><span class="num" id="2490616">0</span><span class="op" id="2490617">]</span><span class="op" id="2490618">)</span><span class="op" id="2490619">)</span>&nbsp;<span class="op" id="2490621">=</span>&nbsp;<span class="ident" id="2490623">rr</span><span class="op" id="2490625">.</span><span class="ident" id="2490626">Header</span><span class="op" id="2490632">.</span><span class="ident" id="2490633">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2490639">*</span><span class="op" id="2490640">(</span><span class="op" id="2490641">*</span><span class="builtintype" id="2490642">uint16</span><span class="op" id="2490648">)</span><span class="op" id="2490649">(</span><span class="ident" id="2490650">unsafe</span><span class="op" id="2490656">.</span><span class="ident" id="2490657">Pointer</span><span class="op" id="2490664">(</span><span class="op" id="2490665">&amp;</span><span class="ident" id="2490666">b</span><span class="op" id="2490667">[</span><span class="num" id="2490668">6</span><span class="op" id="2490669">:</span><span class="num" id="2490670">8</span><span class="op" id="2490671">]</span><span class="op" id="2490672">[</span><span class="num" id="2490673">0</span><span class="op" id="2490674">]</span><span class="op" id="2490675">)</span><span class="op" id="2490676">)</span>&nbsp;<span class="op" id="2490678">=</span>&nbsp;<span class="ident" id="2490680">rr</span><span class="op" id="2490682">.</span><span class="ident" id="2490683">Header</span><span class="op" id="2490689">.</span><span class="ident" id="2490690">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2490697">*</span><span class="op" id="2490698">(</span><span class="op" id="2490699">*</span><span class="builtintype" id="2490700">uint32</span><span class="op" id="2490706">)</span><span class="op" id="2490707">(</span><span class="ident" id="2490708">unsafe</span><span class="op" id="2490714">.</span><span class="ident" id="2490715">Pointer</span><span class="op" id="2490722">(</span><span class="op" id="2490723">&amp;</span><span class="ident" id="2490724">b</span><span class="op" id="2490725">[</span><span class="num" id="2490726">8</span><span class="op" id="2490727">:</span><span class="num" id="2490728">12</span><span class="op" id="2490730">]</span><span class="op" id="2490731">[</span><span class="num" id="2490732">0</span><span class="op" id="2490733">]</span><span class="op" id="2490734">)</span><span class="op" id="2490735">)</span>&nbsp;<span class="op" id="2490737">=</span>&nbsp;<span class="ident" id="2490739">rr</span><span class="op" id="2490741">.</span><span class="ident" id="2490742">Header</span><span class="op" id="2490748">.</span><span class="ident" id="2490749">Seq</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2490754">*</span><span class="op" id="2490755">(</span><span class="op" id="2490756">*</span><span class="builtintype" id="2490757">uint32</span><span class="op" id="2490763">)</span><span class="op" id="2490764">(</span><span class="ident" id="2490765">unsafe</span><span class="op" id="2490771">.</span><span class="ident" id="2490772">Pointer</span><span class="op" id="2490779">(</span><span class="op" id="2490780">&amp;</span><span class="ident" id="2490781">b</span><span class="op" id="2490782">[</span><span class="num" id="2490783">12</span><span class="op" id="2490785">:</span><span class="num" id="2490786">16</span><span class="op" id="2490788">]</span><span class="op" id="2490789">[</span><span class="num" id="2490790">0</span><span class="op" id="2490791">]</span><span class="op" id="2490792">)</span><span class="op" id="2490793">)</span>&nbsp;<span class="op" id="2490795">=</span>&nbsp;<span class="ident" id="2490797">rr</span><span class="op" id="2490799">.</span><span class="ident" id="2490800">Header</span><span class="op" id="2490806">.</span><span class="ident" id="2490807">Pid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2490812">b</span><span class="op" id="2490813">[</span><span class="num" id="2490814">16</span><span class="op" id="2490816">]</span>&nbsp;<span class="op" id="2490818">=</span>&nbsp;<span class="builtintype" id="2490820">byte</span><span class="op" id="2490824">(</span><span class="ident" id="2490825">rr</span><span class="op" id="2490827">.</span><span class="ident" id="2490828">Data</span><span class="op" id="2490832">.</span><span class="ident" id="2490833">Family</span><span class="op" id="2490839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2490842">return</span>&nbsp;<span class="ident" id="2490849">b</span><br>
<span class="lineno"></span><span class="op" id="2490851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2490854">func</span>&nbsp;<span class="ident" id="2490859">newNetlinkRouteRequest</span><span class="op" id="2490881">(</span><span class="ident" id="2490882">proto</span><span class="op" id="2490887">,</span>&nbsp;<span class="ident" id="2490889">seq</span><span class="op" id="2490892">,</span>&nbsp;<span class="ident" id="2490894">family</span>&nbsp;<span class="builtintype" id="2490901">int</span><span class="op" id="2490904">)</span>&nbsp;<span class="op" id="2490906">[</span><span class="op" id="2490907">]</span><span class="builtintype" id="2490908">byte</span>&nbsp;<span class="op" id="2490913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2490916">rr</span>&nbsp;<span class="op" id="2490919">:=</span>&nbsp;<span class="op" id="2490922">&amp;</span><span class="ident" id="2490923">NetlinkRouteRequest</span><span class="op" id="2490942">{</span><span class="op" id="2490943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2490946">rr</span><span class="op" id="2490948">.</span><span class="ident" id="2490949">Header</span><span class="op" id="2490955">.</span><span class="ident" id="2490956">Len</span>&nbsp;<span class="op" id="2490960">=</span>&nbsp;<span class="builtintype" id="2490962">uint32</span><span class="op" id="2490968">(</span><span class="ident" id="2490969">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2490982">+</span>&nbsp;<span class="ident" id="2490984">SizeofRtGenmsg</span><span class="op" id="2490998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491001">rr</span><span class="op" id="2491003">.</span><span class="ident" id="2491004">Header</span><span class="op" id="2491010">.</span><span class="ident" id="2491011">Type</span>&nbsp;<span class="op" id="2491016">=</span>&nbsp;<span class="builtintype" id="2491018">uint16</span><span class="op" id="2491024">(</span><span class="ident" id="2491025">proto</span><span class="op" id="2491030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491033">rr</span><span class="op" id="2491035">.</span><span class="ident" id="2491036">Header</span><span class="op" id="2491042">.</span><span class="ident" id="2491043">Flags</span>&nbsp;<span class="op" id="2491049">=</span>&nbsp;<span class="ident" id="2491051">NLM_F_DUMP</span>&nbsp;<span class="op" id="2491062">|</span>&nbsp;<span class="ident" id="2491064">NLM_F_REQUEST</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491079">rr</span><span class="op" id="2491081">.</span><span class="ident" id="2491082">Header</span><span class="op" id="2491088">.</span><span class="ident" id="2491089">Seq</span>&nbsp;<span class="op" id="2491093">=</span>&nbsp;<span class="builtintype" id="2491095">uint32</span><span class="op" id="2491101">(</span><span class="ident" id="2491102">seq</span><span class="op" id="2491105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491108">rr</span><span class="op" id="2491110">.</span><span class="ident" id="2491111">Data</span><span class="op" id="2491115">.</span><span class="ident" id="2491116">Family</span>&nbsp;<span class="op" id="2491123">=</span>&nbsp;<span class="builtintype" id="2491125">uint8</span><span class="op" id="2491130">(</span><span class="ident" id="2491131">family</span><span class="op" id="2491137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491140">return</span>&nbsp;<span class="ident" id="2491147">rr</span><span class="op" id="2491149">.</span><span class="ident" id="2491150">toWireFormat</span><span class="op" id="2491162">(</span><span class="op" id="2491163">)</span><br>
<span class="lineno"></span><span class="op" id="2491165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2491168">//&nbsp;NetlinkRIB&nbsp;returns&nbsp;routing&nbsp;information&nbsp;base,&nbsp;as&nbsp;known&nbsp;as&nbsp;RIB,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2491239">//&nbsp;consists&nbsp;of&nbsp;network&nbsp;facility&nbsp;information,&nbsp;states&nbsp;and&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2491307">func</span>&nbsp;<span class="ident" id="2491312">NetlinkRIB</span><span class="op" id="2491322">(</span><span class="ident" id="2491323">proto</span><span class="op" id="2491328">,</span>&nbsp;<span class="ident" id="2491330">family</span>&nbsp;<span class="builtintype" id="2491337">int</span><span class="op" id="2491340">)</span>&nbsp;<span class="op" id="2491342">(</span><span class="op" id="2491343">[</span><span class="op" id="2491344">]</span><span class="builtintype" id="2491345">byte</span><span class="op" id="2491349">,</span>&nbsp;<span class="builtintype" id="2491351">error</span><span class="op" id="2491356">)</span>&nbsp;<span class="op" id="2491358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491361">s</span><span class="op" id="2491362">,</span>&nbsp;<span class="ident" id="2491364">err</span>&nbsp;<span class="op" id="2491368">:=</span>&nbsp;<span class="ident" id="2491371">Socket</span><span class="op" id="2491377">(</span><span class="ident" id="2491378">AF_NETLINK</span><span class="op" id="2491388">,</span>&nbsp;<span class="ident" id="2491390">SOCK_RAW</span><span class="op" id="2491398">,</span>&nbsp;<span class="ident" id="2491400">NETLINK_ROUTE</span><span class="op" id="2491413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491416">if</span>&nbsp;<span class="ident" id="2491419">err</span>&nbsp;<span class="op" id="2491423">!=</span>&nbsp;<span class="builtintype" id="2491426">nil</span>&nbsp;<span class="op" id="2491430">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491434">return</span>&nbsp;<span class="builtintype" id="2491441">nil</span><span class="op" id="2491444">,</span>&nbsp;<span class="ident" id="2491446">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2491451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491454">defer</span>&nbsp;<span class="ident" id="2491460">Close</span><span class="op" id="2491465">(</span><span class="ident" id="2491466">s</span><span class="op" id="2491467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491470">lsa</span>&nbsp;<span class="op" id="2491474">:=</span>&nbsp;<span class="op" id="2491477">&amp;</span><span class="ident" id="2491478">SockaddrNetlink</span><span class="op" id="2491493">{</span><span class="ident" id="2491494">Family</span><span class="op" id="2491500">:</span>&nbsp;<span class="ident" id="2491502">AF_NETLINK</span><span class="op" id="2491512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491515">if</span>&nbsp;<span class="ident" id="2491518">err</span>&nbsp;<span class="op" id="2491522">:=</span>&nbsp;<span class="ident" id="2491525">Bind</span><span class="op" id="2491529">(</span><span class="ident" id="2491530">s</span><span class="op" id="2491531">,</span>&nbsp;<span class="ident" id="2491533">lsa</span><span class="op" id="2491536">)</span><span class="op" id="2491537">;</span>&nbsp;<span class="ident" id="2491539">err</span>&nbsp;<span class="op" id="2491543">!=</span>&nbsp;<span class="builtintype" id="2491546">nil</span>&nbsp;<span class="op" id="2491550">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491554">return</span>&nbsp;<span class="builtintype" id="2491561">nil</span><span class="op" id="2491564">,</span>&nbsp;<span class="ident" id="2491566">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2491571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491574">wb</span>&nbsp;<span class="op" id="2491577">:=</span>&nbsp;<span class="ident" id="2491580">newNetlinkRouteRequest</span><span class="op" id="2491602">(</span><span class="ident" id="2491603">proto</span><span class="op" id="2491608">,</span>&nbsp;<span class="num" id="2491610">1</span><span class="op" id="2491611">,</span>&nbsp;<span class="ident" id="2491613">family</span><span class="op" id="2491619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491622">if</span>&nbsp;<span class="ident" id="2491625">err</span>&nbsp;<span class="op" id="2491629">:=</span>&nbsp;<span class="ident" id="2491632">Sendto</span><span class="op" id="2491638">(</span><span class="ident" id="2491639">s</span><span class="op" id="2491640">,</span>&nbsp;<span class="ident" id="2491642">wb</span><span class="op" id="2491644">,</span>&nbsp;<span class="num" id="2491646">0</span><span class="op" id="2491647">,</span>&nbsp;<span class="ident" id="2491649">lsa</span><span class="op" id="2491652">)</span><span class="op" id="2491653">;</span>&nbsp;<span class="ident" id="2491655">err</span>&nbsp;<span class="op" id="2491659">!=</span>&nbsp;<span class="builtintype" id="2491662">nil</span>&nbsp;<span class="op" id="2491666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491670">return</span>&nbsp;<span class="builtintype" id="2491677">nil</span><span class="op" id="2491680">,</span>&nbsp;<span class="ident" id="2491682">err</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2491687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491690">var</span>&nbsp;<span class="ident" id="2491694">tab</span>&nbsp;<span class="op" id="2491698">[</span><span class="op" id="2491699">]</span><span class="builtintype" id="2491700">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491706">rbNew</span>&nbsp;<span class="op" id="2491712">:=</span>&nbsp;<span class="builtinfunc" id="2491715">make</span><span class="op" id="2491719">(</span><span class="op" id="2491720">[</span><span class="op" id="2491721">]</span><span class="builtintype" id="2491722">byte</span><span class="op" id="2491726">,</span>&nbsp;<span class="ident" id="2491728">Getpagesize</span><span class="op" id="2491739">(</span><span class="op" id="2491740">)</span><span class="op" id="2491741">)</span><br>
<span class="lineno"></span><span class="ident" id="2491743">done</span><span class="op" id="2491747">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491750">for</span>&nbsp;<span class="op" id="2491754">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491758">rb</span>&nbsp;<span class="op" id="2491761">:=</span>&nbsp;<span class="ident" id="2491764">rbNew</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491772">nr</span><span class="op" id="2491774">,</span>&nbsp;<span class="ident" id="2491776">_</span><span class="op" id="2491777">,</span>&nbsp;<span class="ident" id="2491779">err</span>&nbsp;<span class="op" id="2491783">:=</span>&nbsp;<span class="ident" id="2491786">Recvfrom</span><span class="op" id="2491794">(</span><span class="ident" id="2491795">s</span><span class="op" id="2491796">,</span>&nbsp;<span class="ident" id="2491798">rb</span><span class="op" id="2491800">,</span>&nbsp;<span class="num" id="2491802">0</span><span class="op" id="2491803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491807">if</span>&nbsp;<span class="ident" id="2491810">err</span>&nbsp;<span class="op" id="2491814">!=</span>&nbsp;<span class="builtintype" id="2491817">nil</span>&nbsp;<span class="op" id="2491821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491826">return</span>&nbsp;<span class="builtintype" id="2491833">nil</span><span class="op" id="2491836">,</span>&nbsp;<span class="ident" id="2491838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2491844">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491848">if</span>&nbsp;<span class="ident" id="2491851">nr</span>&nbsp;<span class="op" id="2491854">&lt;</span>&nbsp;<span class="ident" id="2491856">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2491869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491874">return</span>&nbsp;<span class="builtintype" id="2491881">nil</span><span class="op" id="2491884">,</span>&nbsp;<span class="ident" id="2491886">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2491895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491899">rb</span>&nbsp;<span class="op" id="2491902">=</span>&nbsp;<span class="ident" id="2491904">rb</span><span class="op" id="2491906">[</span><span class="op" id="2491907">:</span><span class="ident" id="2491908">nr</span><span class="op" id="2491910">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491914">tab</span>&nbsp;<span class="op" id="2491918">=</span>&nbsp;<span class="builtinfunc" id="2491920">append</span><span class="op" id="2491926">(</span><span class="ident" id="2491927">tab</span><span class="op" id="2491930">,</span>&nbsp;<span class="ident" id="2491932">rb</span><span class="op" id="2491934">...</span><span class="op" id="2491937">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2491941">msgs</span><span class="op" id="2491945">,</span>&nbsp;<span class="ident" id="2491947">err</span>&nbsp;<span class="op" id="2491951">:=</span>&nbsp;<span class="ident" id="2491954">ParseNetlinkMessage</span><span class="op" id="2491973">(</span><span class="ident" id="2491974">rb</span><span class="op" id="2491976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491980">if</span>&nbsp;<span class="ident" id="2491983">err</span>&nbsp;<span class="op" id="2491987">!=</span>&nbsp;<span class="builtintype" id="2491990">nil</span>&nbsp;<span class="op" id="2491994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2491999">return</span>&nbsp;<span class="builtintype" id="2492006">nil</span><span class="op" id="2492009">,</span>&nbsp;<span class="ident" id="2492011">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492021">for</span>&nbsp;<span class="ident" id="2492025">_</span><span class="op" id="2492026">,</span>&nbsp;<span class="ident" id="2492028">m</span>&nbsp;<span class="op" id="2492030">:=</span>&nbsp;<span class="keyword" id="2492033">range</span>&nbsp;<span class="ident" id="2492039">msgs</span>&nbsp;<span class="op" id="2492044">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2492049">lsa</span><span class="op" id="2492052">,</span>&nbsp;<span class="ident" id="2492054">err</span>&nbsp;<span class="op" id="2492058">:=</span>&nbsp;<span class="ident" id="2492061">Getsockname</span><span class="op" id="2492072">(</span><span class="ident" id="2492073">s</span><span class="op" id="2492074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492079">if</span>&nbsp;<span class="ident" id="2492082">err</span>&nbsp;<span class="op" id="2492086">!=</span>&nbsp;<span class="builtintype" id="2492089">nil</span>&nbsp;<span class="op" id="2492093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492099">return</span>&nbsp;<span class="builtintype" id="2492106">nil</span><span class="op" id="2492109">,</span>&nbsp;<span class="ident" id="2492111">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492123">switch</span>&nbsp;<span class="ident" id="2492130">v</span>&nbsp;<span class="op" id="2492132">:=</span>&nbsp;<span class="ident" id="2492135">lsa</span><span class="op" id="2492138">.</span><span class="op" id="2492139">(</span><span class="keyword" id="2492140">type</span><span class="op" id="2492144">)</span>&nbsp;<span class="op" id="2492146">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492151">case</span>&nbsp;<span class="op" id="2492156">*</span><span class="ident" id="2492157">SockaddrNetlink</span><span class="op" id="2492172">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492178">if</span>&nbsp;<span class="ident" id="2492181">m</span><span class="op" id="2492182">.</span><span class="ident" id="2492183">Header</span><span class="op" id="2492189">.</span><span class="ident" id="2492190">Seq</span>&nbsp;<span class="op" id="2492194">!=</span>&nbsp;<span class="num" id="2492197">1</span>&nbsp;<span class="op" id="2492199">||</span>&nbsp;<span class="ident" id="2492202">m</span><span class="op" id="2492203">.</span><span class="ident" id="2492204">Header</span><span class="op" id="2492210">.</span><span class="ident" id="2492211">Pid</span>&nbsp;<span class="op" id="2492215">!=</span>&nbsp;<span class="ident" id="2492218">v</span><span class="op" id="2492219">.</span><span class="ident" id="2492220">Pid</span>&nbsp;<span class="op" id="2492224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492231">return</span>&nbsp;<span class="builtintype" id="2492238">nil</span><span class="op" id="2492241">,</span>&nbsp;<span class="ident" id="2492243">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492259">default</span><span class="op" id="2492266">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492272">return</span>&nbsp;<span class="builtintype" id="2492279">nil</span><span class="op" id="2492282">,</span>&nbsp;<span class="ident" id="2492284">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492299">if</span>&nbsp;<span class="ident" id="2492302">m</span><span class="op" id="2492303">.</span><span class="ident" id="2492304">Header</span><span class="op" id="2492310">.</span><span class="ident" id="2492311">Type</span>&nbsp;<span class="op" id="2492316">==</span>&nbsp;<span class="ident" id="2492319">NLMSG_DONE</span>&nbsp;<span class="op" id="2492330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492336">break</span>&nbsp;<span class="ident" id="2492342">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492350">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492355">if</span>&nbsp;<span class="ident" id="2492358">m</span><span class="op" id="2492359">.</span><span class="ident" id="2492360">Header</span><span class="op" id="2492366">.</span><span class="ident" id="2492367">Type</span>&nbsp;<span class="op" id="2492372">==</span>&nbsp;<span class="ident" id="2492375">NLMSG_ERROR</span>&nbsp;<span class="op" id="2492387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492393">return</span>&nbsp;<span class="builtintype" id="2492400">nil</span><span class="op" id="2492403">,</span>&nbsp;<span class="ident" id="2492405">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492422">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492425">return</span>&nbsp;<span class="ident" id="2492432">tab</span><span class="op" id="2492435">,</span>&nbsp;<span class="builtintype" id="2492437">nil</span><br>
<span class="lineno"></span><span class="op" id="2492441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2492444">//&nbsp;NetlinkMessage&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2492492">type</span>&nbsp;<span class="ident" id="2492497">NetlinkMessage</span>&nbsp;<span class="keyword" id="2492512">struct</span>&nbsp;<span class="op" id="2492519">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2492522">Header</span>&nbsp;<span class="ident" id="2492529">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2492539">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2492546">[</span><span class="op" id="2492547">]</span><span class="builtintype" id="2492548">byte</span><br>
<span class="lineno"></span><span class="op" id="2492553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2492556">//&nbsp;ParseNetlinkMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink&nbsp;messages&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="2492624">//&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the&nbsp;NetlinkMessage&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2492687">func</span>&nbsp;<span class="ident" id="2492692">ParseNetlinkMessage</span><span class="op" id="2492711">(</span><span class="ident" id="2492712">b</span>&nbsp;<span class="op" id="2492714">[</span><span class="op" id="2492715">]</span><span class="builtintype" id="2492716">byte</span><span class="op" id="2492720">)</span>&nbsp;<span class="op" id="2492722">(</span><span class="op" id="2492723">[</span><span class="op" id="2492724">]</span><span class="ident" id="2492725">NetlinkMessage</span><span class="op" id="2492739">,</span>&nbsp;<span class="builtintype" id="2492741">error</span><span class="op" id="2492746">)</span>&nbsp;<span class="op" id="2492748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492751">var</span>&nbsp;<span class="ident" id="2492755">msgs</span>&nbsp;<span class="op" id="2492760">[</span><span class="op" id="2492761">]</span><span class="ident" id="2492762">NetlinkMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492778">for</span>&nbsp;<span class="builtinfunc" id="2492782">len</span><span class="op" id="2492785">(</span><span class="ident" id="2492786">b</span><span class="op" id="2492787">)</span>&nbsp;<span class="op" id="2492789">&gt;=</span>&nbsp;<span class="ident" id="2492792">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2492805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2492809">h</span><span class="op" id="2492810">,</span>&nbsp;<span class="ident" id="2492812">dbuf</span><span class="op" id="2492816">,</span>&nbsp;<span class="ident" id="2492818">dlen</span><span class="op" id="2492822">,</span>&nbsp;<span class="ident" id="2492824">err</span>&nbsp;<span class="op" id="2492828">:=</span>&nbsp;<span class="ident" id="2492831">netlinkMessageHeaderAndData</span><span class="op" id="2492858">(</span><span class="ident" id="2492859">b</span><span class="op" id="2492860">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492864">if</span>&nbsp;<span class="ident" id="2492867">err</span>&nbsp;<span class="op" id="2492871">!=</span>&nbsp;<span class="builtintype" id="2492874">nil</span>&nbsp;<span class="op" id="2492878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2492883">return</span>&nbsp;<span class="builtintype" id="2492890">nil</span><span class="op" id="2492893">,</span>&nbsp;<span class="ident" id="2492895">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2492901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2492905">m</span>&nbsp;<span class="op" id="2492907">:=</span>&nbsp;<span class="ident" id="2492910">NetlinkMessage</span><span class="op" id="2492924">{</span><span class="ident" id="2492925">Header</span><span class="op" id="2492931">:</span>&nbsp;<span class="op" id="2492933">*</span><span class="ident" id="2492934">h</span><span class="op" id="2492935">,</span>&nbsp;<span class="ident" id="2492937">Data</span><span class="op" id="2492941">:</span>&nbsp;<span class="ident" id="2492943">dbuf</span><span class="op" id="2492947">[</span><span class="op" id="2492948">:</span><span class="builtintype" id="2492949">int</span><span class="op" id="2492952">(</span><span class="ident" id="2492953">h</span><span class="op" id="2492954">.</span><span class="ident" id="2492955">Len</span><span class="op" id="2492958">)</span><span class="op" id="2492959">-</span><span class="ident" id="2492960">NLMSG_HDRLEN</span><span class="op" id="2492972">]</span><span class="op" id="2492973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2492977">msgs</span>&nbsp;<span class="op" id="2492982">=</span>&nbsp;<span class="builtinfunc" id="2492984">append</span><span class="op" id="2492990">(</span><span class="ident" id="2492991">msgs</span><span class="op" id="2492995">,</span>&nbsp;<span class="ident" id="2492997">m</span><span class="op" id="2492998">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493002">b</span>&nbsp;<span class="op" id="2493004">=</span>&nbsp;<span class="ident" id="2493006">b</span><span class="op" id="2493007">[</span><span class="ident" id="2493008">dlen</span><span class="op" id="2493012">:</span><span class="op" id="2493013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2493016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493019">return</span>&nbsp;<span class="ident" id="2493026">msgs</span><span class="op" id="2493030">,</span>&nbsp;<span class="builtintype" id="2493032">nil</span><br>
<span class="lineno"></span><span class="op" id="2493036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2493039">func</span>&nbsp;<span class="ident" id="2493044">netlinkMessageHeaderAndData</span><span class="op" id="2493071">(</span><span class="ident" id="2493072">b</span>&nbsp;<span class="op" id="2493074">[</span><span class="op" id="2493075">]</span><span class="builtintype" id="2493076">byte</span><span class="op" id="2493080">)</span>&nbsp;<span class="op" id="2493082">(</span><span class="op" id="2493083">*</span><span class="ident" id="2493084">NlMsghdr</span><span class="op" id="2493092">,</span>&nbsp;<span class="op" id="2493094">[</span><span class="op" id="2493095">]</span><span class="builtintype" id="2493096">byte</span><span class="op" id="2493100">,</span>&nbsp;<span class="builtintype" id="2493102">int</span><span class="op" id="2493105">,</span>&nbsp;<span class="builtintype" id="2493107">error</span><span class="op" id="2493112">)</span>&nbsp;<span class="op" id="2493114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493117">h</span>&nbsp;<span class="op" id="2493119">:=</span>&nbsp;<span class="op" id="2493122">(</span><span class="op" id="2493123">*</span><span class="ident" id="2493124">NlMsghdr</span><span class="op" id="2493132">)</span><span class="op" id="2493133">(</span><span class="ident" id="2493134">unsafe</span><span class="op" id="2493140">.</span><span class="ident" id="2493141">Pointer</span><span class="op" id="2493148">(</span><span class="op" id="2493149">&amp;</span><span class="ident" id="2493150">b</span><span class="op" id="2493151">[</span><span class="num" id="2493152">0</span><span class="op" id="2493153">]</span><span class="op" id="2493154">)</span><span class="op" id="2493155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493158">if</span>&nbsp;<span class="builtintype" id="2493161">int</span><span class="op" id="2493164">(</span><span class="ident" id="2493165">h</span><span class="op" id="2493166">.</span><span class="ident" id="2493167">Len</span><span class="op" id="2493170">)</span>&nbsp;<span class="op" id="2493172">&lt;</span>&nbsp;<span class="ident" id="2493174">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2493187">||</span>&nbsp;<span class="builtintype" id="2493190">int</span><span class="op" id="2493193">(</span><span class="ident" id="2493194">h</span><span class="op" id="2493195">.</span><span class="ident" id="2493196">Len</span><span class="op" id="2493199">)</span>&nbsp;<span class="op" id="2493201">&gt;</span>&nbsp;<span class="builtinfunc" id="2493203">len</span><span class="op" id="2493206">(</span><span class="ident" id="2493207">b</span><span class="op" id="2493208">)</span>&nbsp;<span class="op" id="2493210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493214">return</span>&nbsp;<span class="builtintype" id="2493221">nil</span><span class="op" id="2493224">,</span>&nbsp;<span class="builtintype" id="2493226">nil</span><span class="op" id="2493229">,</span>&nbsp;<span class="num" id="2493231">0</span><span class="op" id="2493232">,</span>&nbsp;<span class="ident" id="2493234">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2493242">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493245">return</span>&nbsp;<span class="ident" id="2493252">h</span><span class="op" id="2493253">,</span>&nbsp;<span class="ident" id="2493255">b</span><span class="op" id="2493256">[</span><span class="ident" id="2493257">NLMSG_HDRLEN</span><span class="op" id="2493269">:</span><span class="op" id="2493270">]</span><span class="op" id="2493271">,</span>&nbsp;<span class="ident" id="2493273">nlmAlignOf</span><span class="op" id="2493283">(</span><span class="builtintype" id="2493284">int</span><span class="op" id="2493287">(</span><span class="ident" id="2493288">h</span><span class="op" id="2493289">.</span><span class="ident" id="2493290">Len</span><span class="op" id="2493293">)</span><span class="op" id="2493294">)</span><span class="op" id="2493295">,</span>&nbsp;<span class="builtintype" id="2493297">nil</span><br>
<span class="lineno"></span><span class="op" id="2493301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2493304">//&nbsp;NetlinkRouteAttr&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="2493362">type</span>&nbsp;<span class="ident" id="2493367">NetlinkRouteAttr</span>&nbsp;<span class="keyword" id="2493384">struct</span>&nbsp;<span class="op" id="2493391">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493394">Attr</span>&nbsp;&nbsp;<span class="ident" id="2493400">RtAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493408">Value</span>&nbsp;<span class="op" id="2493414">[</span><span class="op" id="2493415">]</span><span class="builtintype" id="2493416">byte</span><br>
<span class="lineno"></span><span class="op" id="2493421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2493424">//&nbsp;ParseNetlinkRouteAttr&nbsp;parses&nbsp;m&#39;s&nbsp;payload&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink</span><br>
<span class="lineno">145</span><span class="comment" id="2493491">//&nbsp;route&nbsp;attributes&nbsp;and&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2493548">//&nbsp;NetlinkRouteAttr&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2493580">func</span>&nbsp;<span class="ident" id="2493585">ParseNetlinkRouteAttr</span><span class="op" id="2493606">(</span><span class="ident" id="2493607">m</span>&nbsp;<span class="op" id="2493609">*</span><span class="ident" id="2493610">NetlinkMessage</span><span class="op" id="2493624">)</span>&nbsp;<span class="op" id="2493626">(</span><span class="op" id="2493627">[</span><span class="op" id="2493628">]</span><span class="ident" id="2493629">NetlinkRouteAttr</span><span class="op" id="2493645">,</span>&nbsp;<span class="builtintype" id="2493647">error</span><span class="op" id="2493652">)</span>&nbsp;<span class="op" id="2493654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493657">var</span>&nbsp;<span class="ident" id="2493661">b</span>&nbsp;<span class="op" id="2493663">[</span><span class="op" id="2493664">]</span><span class="builtintype" id="2493665">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493671">switch</span>&nbsp;<span class="ident" id="2493678">m</span><span class="op" id="2493679">.</span><span class="ident" id="2493680">Header</span><span class="op" id="2493686">.</span><span class="ident" id="2493687">Type</span>&nbsp;<span class="op" id="2493692">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493695">case</span>&nbsp;<span class="ident" id="2493700">RTM_NEWLINK</span><span class="op" id="2493711">,</span>&nbsp;<span class="ident" id="2493713">RTM_DELLINK</span><span class="op" id="2493724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493728">b</span>&nbsp;<span class="op" id="2493730">=</span>&nbsp;<span class="ident" id="2493732">m</span><span class="op" id="2493733">.</span><span class="ident" id="2493734">Data</span><span class="op" id="2493738">[</span><span class="ident" id="2493739">SizeofIfInfomsg</span><span class="op" id="2493754">:</span><span class="op" id="2493755">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493758">case</span>&nbsp;<span class="ident" id="2493763">RTM_NEWADDR</span><span class="op" id="2493774">,</span>&nbsp;<span class="ident" id="2493776">RTM_DELADDR</span><span class="op" id="2493787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493791">b</span>&nbsp;<span class="op" id="2493793">=</span>&nbsp;<span class="ident" id="2493795">m</span><span class="op" id="2493796">.</span><span class="ident" id="2493797">Data</span><span class="op" id="2493801">[</span><span class="ident" id="2493802">SizeofIfAddrmsg</span><span class="op" id="2493817">:</span><span class="op" id="2493818">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493821">case</span>&nbsp;<span class="ident" id="2493826">RTM_NEWROUTE</span><span class="op" id="2493838">,</span>&nbsp;<span class="ident" id="2493840">RTM_DELROUTE</span><span class="op" id="2493852">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493856">b</span>&nbsp;<span class="op" id="2493858">=</span>&nbsp;<span class="ident" id="2493860">m</span><span class="op" id="2493861">.</span><span class="ident" id="2493862">Data</span><span class="op" id="2493866">[</span><span class="ident" id="2493867">SizeofRtMsg</span><span class="op" id="2493878">:</span><span class="op" id="2493879">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493882">default</span><span class="op" id="2493889">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493893">return</span>&nbsp;<span class="builtintype" id="2493900">nil</span><span class="op" id="2493903">,</span>&nbsp;<span class="ident" id="2493905">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2493913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493916">var</span>&nbsp;<span class="ident" id="2493920">attrs</span>&nbsp;<span class="op" id="2493926">[</span><span class="op" id="2493927">]</span><span class="ident" id="2493928">NetlinkRouteAttr</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2493946">for</span>&nbsp;<span class="builtinfunc" id="2493950">len</span><span class="op" id="2493953">(</span><span class="ident" id="2493954">b</span><span class="op" id="2493955">)</span>&nbsp;<span class="op" id="2493957">&gt;=</span>&nbsp;<span class="ident" id="2493960">SizeofRtAttr</span>&nbsp;<span class="op" id="2493973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2493977">a</span><span class="op" id="2493978">,</span>&nbsp;<span class="ident" id="2493980">vbuf</span><span class="op" id="2493984">,</span>&nbsp;<span class="ident" id="2493986">alen</span><span class="op" id="2493990">,</span>&nbsp;<span class="ident" id="2493992">err</span>&nbsp;<span class="op" id="2493996">:=</span>&nbsp;<span class="ident" id="2493999">netlinkRouteAttrAndValue</span><span class="op" id="2494023">(</span><span class="ident" id="2494024">b</span><span class="op" id="2494025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494029">if</span>&nbsp;<span class="ident" id="2494032">err</span>&nbsp;<span class="op" id="2494036">!=</span>&nbsp;<span class="builtintype" id="2494039">nil</span>&nbsp;<span class="op" id="2494043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494048">return</span>&nbsp;<span class="builtintype" id="2494055">nil</span><span class="op" id="2494058">,</span>&nbsp;<span class="ident" id="2494060">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2494066">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2494070">ra</span>&nbsp;<span class="op" id="2494073">:=</span>&nbsp;<span class="ident" id="2494076">NetlinkRouteAttr</span><span class="op" id="2494092">{</span><span class="ident" id="2494093">Attr</span><span class="op" id="2494097">:</span>&nbsp;<span class="op" id="2494099">*</span><span class="ident" id="2494100">a</span><span class="op" id="2494101">,</span>&nbsp;<span class="ident" id="2494103">Value</span><span class="op" id="2494108">:</span>&nbsp;<span class="ident" id="2494110">vbuf</span><span class="op" id="2494114">[</span><span class="op" id="2494115">:</span><span class="builtintype" id="2494116">int</span><span class="op" id="2494119">(</span><span class="ident" id="2494120">a</span><span class="op" id="2494121">.</span><span class="ident" id="2494122">Len</span><span class="op" id="2494125">)</span><span class="op" id="2494126">-</span><span class="ident" id="2494127">SizeofRtAttr</span><span class="op" id="2494139">]</span><span class="op" id="2494140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2494144">attrs</span>&nbsp;<span class="op" id="2494150">=</span>&nbsp;<span class="builtinfunc" id="2494152">append</span><span class="op" id="2494158">(</span><span class="ident" id="2494159">attrs</span><span class="op" id="2494164">,</span>&nbsp;<span class="ident" id="2494166">ra</span><span class="op" id="2494168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2494172">b</span>&nbsp;<span class="op" id="2494174">=</span>&nbsp;<span class="ident" id="2494176">b</span><span class="op" id="2494177">[</span><span class="ident" id="2494178">alen</span><span class="op" id="2494182">:</span><span class="op" id="2494183">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2494186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494189">return</span>&nbsp;<span class="ident" id="2494196">attrs</span><span class="op" id="2494201">,</span>&nbsp;<span class="builtintype" id="2494203">nil</span><br>
<span class="lineno">170</span><span class="op" id="2494207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2494210">func</span>&nbsp;<span class="ident" id="2494215">netlinkRouteAttrAndValue</span><span class="op" id="2494239">(</span><span class="ident" id="2494240">b</span>&nbsp;<span class="op" id="2494242">[</span><span class="op" id="2494243">]</span><span class="builtintype" id="2494244">byte</span><span class="op" id="2494248">)</span>&nbsp;<span class="op" id="2494250">(</span><span class="op" id="2494251">*</span><span class="ident" id="2494252">RtAttr</span><span class="op" id="2494258">,</span>&nbsp;<span class="op" id="2494260">[</span><span class="op" id="2494261">]</span><span class="builtintype" id="2494262">byte</span><span class="op" id="2494266">,</span>&nbsp;<span class="builtintype" id="2494268">int</span><span class="op" id="2494271">,</span>&nbsp;<span class="builtintype" id="2494273">error</span><span class="op" id="2494278">)</span>&nbsp;<span class="op" id="2494280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2494283">a</span>&nbsp;<span class="op" id="2494285">:=</span>&nbsp;<span class="op" id="2494288">(</span><span class="op" id="2494289">*</span><span class="ident" id="2494290">RtAttr</span><span class="op" id="2494296">)</span><span class="op" id="2494297">(</span><span class="ident" id="2494298">unsafe</span><span class="op" id="2494304">.</span><span class="ident" id="2494305">Pointer</span><span class="op" id="2494312">(</span><span class="op" id="2494313">&amp;</span><span class="ident" id="2494314">b</span><span class="op" id="2494315">[</span><span class="num" id="2494316">0</span><span class="op" id="2494317">]</span><span class="op" id="2494318">)</span><span class="op" id="2494319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494322">if</span>&nbsp;<span class="builtintype" id="2494325">int</span><span class="op" id="2494328">(</span><span class="ident" id="2494329">a</span><span class="op" id="2494330">.</span><span class="ident" id="2494331">Len</span><span class="op" id="2494334">)</span>&nbsp;<span class="op" id="2494336">&lt;</span>&nbsp;<span class="ident" id="2494338">SizeofRtAttr</span>&nbsp;<span class="op" id="2494351">||</span>&nbsp;<span class="builtintype" id="2494354">int</span><span class="op" id="2494357">(</span><span class="ident" id="2494358">a</span><span class="op" id="2494359">.</span><span class="ident" id="2494360">Len</span><span class="op" id="2494363">)</span>&nbsp;<span class="op" id="2494365">&gt;</span>&nbsp;<span class="builtinfunc" id="2494367">len</span><span class="op" id="2494370">(</span><span class="ident" id="2494371">b</span><span class="op" id="2494372">)</span>&nbsp;<span class="op" id="2494374">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494378">return</span>&nbsp;<span class="builtintype" id="2494385">nil</span><span class="op" id="2494388">,</span>&nbsp;<span class="builtintype" id="2494390">nil</span><span class="op" id="2494393">,</span>&nbsp;<span class="num" id="2494395">0</span><span class="op" id="2494396">,</span>&nbsp;<span class="ident" id="2494398">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2494406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2494409">return</span>&nbsp;<span class="ident" id="2494416">a</span><span class="op" id="2494417">,</span>&nbsp;<span class="ident" id="2494419">b</span><span class="op" id="2494420">[</span><span class="ident" id="2494421">SizeofRtAttr</span><span class="op" id="2494433">:</span><span class="op" id="2494434">]</span><span class="op" id="2494435">,</span>&nbsp;<span class="ident" id="2494437">rtaAlignOf</span><span class="op" id="2494447">(</span><span class="builtintype" id="2494448">int</span><span class="op" id="2494451">(</span><span class="ident" id="2494452">a</span><span class="op" id="2494453">.</span><span class="ident" id="2494454">Len</span><span class="op" id="2494457">)</span><span class="op" id="2494458">)</span><span class="op" id="2494459">,</span>&nbsp;<span class="builtintype" id="2494461">nil</span><br>
<span class="lineno"></span><span class="op" id="2494465">}</span>
</div>
</body>
</html>
