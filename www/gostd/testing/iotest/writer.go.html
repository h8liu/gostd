<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6346820">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6346875">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6346929">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6346980">package</span>&nbsp;<span class="ident" id="6346988">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6346996">import</span>&nbsp;<span class="string" id="6347003">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6347009">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="6347061">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6347098">func</span>&nbsp;<span class="ident" id="6347103">TruncateWriter</span><span class="op" id="6347117">(</span><span class="ident" id="6347118">w</span>&nbsp;<span class="ident" id="6347120">io</span><span class="op" id="6347122">.</span><span class="ident" id="6347123">Writer</span><span class="op" id="6347129">,</span>&nbsp;<span class="ident" id="6347131">n</span>&nbsp;<span class="ident" id="6347133">int64</span><span class="op" id="6347138">)</span>&nbsp;<span class="ident" id="6347140">io</span><span class="op" id="6347142">.</span><span class="ident" id="6347143">Writer</span>&nbsp;<span class="op" id="6347150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347153">return</span>&nbsp;<span class="op" id="6347160">&amp;</span><span class="ident" id="6347161">truncateWriter</span><span class="op" id="6347175">{</span><span class="ident" id="6347176">w</span><span class="op" id="6347177">,</span>&nbsp;<span class="ident" id="6347179">n</span><span class="op" id="6347180">}</span><br>
<span class="lineno"></span><span class="op" id="6347182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6347185">type</span>&nbsp;<span class="ident" id="6347190">truncateWriter</span>&nbsp;<span class="keyword" id="6347205">struct</span>&nbsp;<span class="op" id="6347212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6347215">w</span>&nbsp;<span class="ident" id="6347217">io</span><span class="op" id="6347219">.</span><span class="ident" id="6347220">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6347228">n</span>&nbsp;<span class="ident" id="6347230">int64</span><br>
<span class="lineno"></span><span class="op" id="6347236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6347239">func</span>&nbsp;<span class="op" id="6347244">(</span><span class="ident" id="6347245">t</span>&nbsp;<span class="op" id="6347247">*</span><span class="ident" id="6347248">truncateWriter</span><span class="op" id="6347262">)</span>&nbsp;<span class="ident" id="6347264">Write</span><span class="op" id="6347269">(</span><span class="ident" id="6347270">p</span>&nbsp;<span class="op" id="6347272">[</span><span class="op" id="6347273">]</span><span class="builtintype" id="6347274">byte</span><span class="op" id="6347278">)</span>&nbsp;<span class="op" id="6347280">(</span><span class="ident" id="6347281">n</span>&nbsp;<span class="builtintype" id="6347283">int</span><span class="op" id="6347286">,</span>&nbsp;<span class="ident" id="6347288">err</span>&nbsp;<span class="builtintype" id="6347292">error</span><span class="op" id="6347297">)</span>&nbsp;<span class="op" id="6347299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347302">if</span>&nbsp;<span class="ident" id="6347305">t</span><span class="op" id="6347306">.</span><span class="ident" id="6347307">n</span>&nbsp;<span class="op" id="6347309">&lt;=</span>&nbsp;<span class="num" id="6347312">0</span>&nbsp;<span class="op" id="6347314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347318">return</span>&nbsp;<span class="builtinfunc" id="6347325">len</span><span class="op" id="6347328">(</span><span class="ident" id="6347329">p</span><span class="op" id="6347330">)</span><span class="op" id="6347331">,</span>&nbsp;<span class="ident" id="6347333">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6347338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6347341">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6347356">n</span>&nbsp;<span class="op" id="6347358">=</span>&nbsp;<span class="builtinfunc" id="6347360">len</span><span class="op" id="6347363">(</span><span class="ident" id="6347364">p</span><span class="op" id="6347365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347368">if</span>&nbsp;<span class="ident" id="6347371">int64</span><span class="op" id="6347376">(</span><span class="ident" id="6347377">n</span><span class="op" id="6347378">)</span>&nbsp;<span class="op" id="6347380">&gt;</span>&nbsp;<span class="ident" id="6347382">t</span><span class="op" id="6347383">.</span><span class="ident" id="6347384">n</span>&nbsp;<span class="op" id="6347386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6347390">n</span>&nbsp;<span class="op" id="6347392">=</span>&nbsp;<span class="builtintype" id="6347394">int</span><span class="op" id="6347397">(</span><span class="ident" id="6347398">t</span><span class="op" id="6347399">.</span><span class="ident" id="6347400">n</span><span class="op" id="6347401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6347404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6347407">n</span><span class="op" id="6347408">,</span>&nbsp;<span class="ident" id="6347410">err</span>&nbsp;<span class="op" id="6347414">=</span>&nbsp;<span class="ident" id="6347416">t</span><span class="op" id="6347417">.</span><span class="ident" id="6347418">w</span><span class="op" id="6347419">.</span><span class="ident" id="6347420">Write</span><span class="op" id="6347425">(</span><span class="ident" id="6347426">p</span><span class="op" id="6347427">[</span><span class="num" id="6347428">0</span><span class="op" id="6347429">:</span><span class="ident" id="6347430">n</span><span class="op" id="6347431">]</span><span class="op" id="6347432">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6347435">t</span><span class="op" id="6347436">.</span><span class="ident" id="6347437">n</span>&nbsp;<span class="op" id="6347439">-=</span>&nbsp;<span class="ident" id="6347442">int64</span><span class="op" id="6347447">(</span><span class="ident" id="6347448">n</span><span class="op" id="6347449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347452">if</span>&nbsp;<span class="ident" id="6347455">err</span>&nbsp;<span class="op" id="6347459">==</span>&nbsp;<span class="ident" id="6347462">nil</span>&nbsp;<span class="op" id="6347466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6347470">n</span>&nbsp;<span class="op" id="6347472">=</span>&nbsp;<span class="builtinfunc" id="6347474">len</span><span class="op" id="6347477">(</span><span class="ident" id="6347478">p</span><span class="op" id="6347479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6347482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347485">return</span><br>
<span class="lineno">35</span><span class="op" id="6347492">}</span>
</div>
</body>
</html>
