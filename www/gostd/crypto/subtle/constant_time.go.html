<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html" class="current">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4045760">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4045815">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4045869">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4045920">//&nbsp;Package&nbsp;subtle&nbsp;implements&nbsp;functions&nbsp;that&nbsp;are&nbsp;often&nbsp;useful&nbsp;in&nbsp;cryptographic</span><br>
<span class="lineno"></span><span class="comment" id="4045998">//&nbsp;code&nbsp;but&nbsp;require&nbsp;careful&nbsp;thought&nbsp;to&nbsp;use&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="4046052">package</span>&nbsp;<span class="ident" id="4046060">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4046068">//&nbsp;ConstantTimeCompare&nbsp;returns&nbsp;1&nbsp;iff&nbsp;the&nbsp;two&nbsp;slices,&nbsp;x</span><br>
<span class="lineno">10</span><span class="comment" id="4046123">//&nbsp;and&nbsp;y,&nbsp;have&nbsp;equal&nbsp;contents.&nbsp;The&nbsp;time&nbsp;taken&nbsp;is&nbsp;a&nbsp;function&nbsp;of&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4046200">//&nbsp;the&nbsp;slices&nbsp;and&nbsp;is&nbsp;independent&nbsp;of&nbsp;the&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="4046250">func</span>&nbsp;<span class="ident" id="4046255">ConstantTimeCompare</span><span class="op" id="4046274">(</span><span class="ident" id="4046275">x</span><span class="op" id="4046276">,</span>&nbsp;<span class="ident" id="4046278">y</span>&nbsp;<span class="op" id="4046280">[</span><span class="op" id="4046281">]</span><span class="builtintype" id="4046282">byte</span><span class="op" id="4046286">)</span>&nbsp;<span class="builtintype" id="4046288">int</span>&nbsp;<span class="op" id="4046292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046295">if</span>&nbsp;<span class="builtinfunc" id="4046298">len</span><span class="op" id="4046301">(</span><span class="ident" id="4046302">x</span><span class="op" id="4046303">)</span>&nbsp;<span class="op" id="4046305">!=</span>&nbsp;<span class="builtinfunc" id="4046308">len</span><span class="op" id="4046311">(</span><span class="ident" id="4046312">y</span><span class="op" id="4046313">)</span>&nbsp;<span class="op" id="4046315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046319">return</span>&nbsp;<span class="num" id="4046326">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046333">var</span>&nbsp;<span class="ident" id="4046337">v</span>&nbsp;<span class="builtintype" id="4046339">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046346">for</span>&nbsp;<span class="ident" id="4046350">i</span>&nbsp;<span class="op" id="4046352">:=</span>&nbsp;<span class="num" id="4046355">0</span><span class="op" id="4046356">;</span>&nbsp;<span class="ident" id="4046358">i</span>&nbsp;<span class="op" id="4046360">&lt;</span>&nbsp;<span class="builtinfunc" id="4046362">len</span><span class="op" id="4046365">(</span><span class="ident" id="4046366">x</span><span class="op" id="4046367">)</span><span class="op" id="4046368">;</span>&nbsp;<span class="ident" id="4046370">i</span><span class="op" id="4046371">++</span>&nbsp;<span class="op" id="4046374">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046378">v</span>&nbsp;<span class="op" id="4046380">|=</span>&nbsp;<span class="ident" id="4046383">x</span><span class="op" id="4046384">[</span><span class="ident" id="4046385">i</span><span class="op" id="4046386">]</span>&nbsp;<span class="op" id="4046388">^</span>&nbsp;<span class="ident" id="4046390">y</span><span class="op" id="4046391">[</span><span class="ident" id="4046392">i</span><span class="op" id="4046393">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046400">return</span>&nbsp;<span class="ident" id="4046407">ConstantTimeByteEq</span><span class="op" id="4046425">(</span><span class="ident" id="4046426">v</span><span class="op" id="4046427">,</span>&nbsp;<span class="num" id="4046429">0</span><span class="op" id="4046430">)</span><br>
<span class="lineno"></span><span class="op" id="4046432">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4046435">//&nbsp;ConstantTimeSelect&nbsp;returns&nbsp;x&nbsp;if&nbsp;v&nbsp;is&nbsp;1&nbsp;and&nbsp;y&nbsp;if&nbsp;v&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4046494">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4046551">func</span>&nbsp;<span class="ident" id="4046556">ConstantTimeSelect</span><span class="op" id="4046574">(</span><span class="ident" id="4046575">v</span><span class="op" id="4046576">,</span>&nbsp;<span class="ident" id="4046578">x</span><span class="op" id="4046579">,</span>&nbsp;<span class="ident" id="4046581">y</span>&nbsp;<span class="builtintype" id="4046583">int</span><span class="op" id="4046586">)</span>&nbsp;<span class="builtintype" id="4046588">int</span>&nbsp;<span class="op" id="4046592">{</span>&nbsp;<span class="keyword" id="4046594">return</span>&nbsp;<span class="op" id="4046601">^</span><span class="op" id="4046602">(</span><span class="ident" id="4046603">v</span><span class="op" id="4046604">-</span><span class="num" id="4046605">1</span><span class="op" id="4046606">)</span><span class="op" id="4046607">&amp;</span><span class="ident" id="4046608">x</span>&nbsp;<span class="op" id="4046610">|</span>&nbsp;<span class="op" id="4046612">(</span><span class="ident" id="4046613">v</span><span class="op" id="4046614">-</span><span class="num" id="4046615">1</span><span class="op" id="4046616">)</span><span class="op" id="4046617">&amp;</span><span class="ident" id="4046618">y</span>&nbsp;<span class="op" id="4046620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4046623">//&nbsp;ConstantTimeByteEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="4046682">func</span>&nbsp;<span class="ident" id="4046687">ConstantTimeByteEq</span><span class="op" id="4046705">(</span><span class="ident" id="4046706">x</span><span class="op" id="4046707">,</span>&nbsp;<span class="ident" id="4046709">y</span>&nbsp;<span class="builtintype" id="4046711">uint8</span><span class="op" id="4046716">)</span>&nbsp;<span class="builtintype" id="4046718">int</span>&nbsp;<span class="op" id="4046722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046725">z</span>&nbsp;<span class="op" id="4046727">:=</span>&nbsp;<span class="op" id="4046730">^</span><span class="op" id="4046731">(</span><span class="ident" id="4046732">x</span>&nbsp;<span class="op" id="4046734">^</span>&nbsp;<span class="ident" id="4046736">y</span><span class="op" id="4046737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046740">z</span>&nbsp;<span class="op" id="4046742">&amp;=</span>&nbsp;<span class="ident" id="4046745">z</span>&nbsp;<span class="op" id="4046747">&gt;&gt;</span>&nbsp;<span class="num" id="4046750">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046753">z</span>&nbsp;<span class="op" id="4046755">&amp;=</span>&nbsp;<span class="ident" id="4046758">z</span>&nbsp;<span class="op" id="4046760">&gt;&gt;</span>&nbsp;<span class="num" id="4046763">2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046766">z</span>&nbsp;<span class="op" id="4046768">&amp;=</span>&nbsp;<span class="ident" id="4046771">z</span>&nbsp;<span class="op" id="4046773">&gt;&gt;</span>&nbsp;<span class="num" id="4046776">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046780">return</span>&nbsp;<span class="builtintype" id="4046787">int</span><span class="op" id="4046790">(</span><span class="ident" id="4046791">z</span><span class="op" id="4046792">)</span><br>
<span class="lineno"></span><span class="op" id="4046794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4046797">//&nbsp;ConstantTimeEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="4046852">func</span>&nbsp;<span class="ident" id="4046857">ConstantTimeEq</span><span class="op" id="4046871">(</span><span class="ident" id="4046872">x</span><span class="op" id="4046873">,</span>&nbsp;<span class="ident" id="4046875">y</span>&nbsp;<span class="builtintype" id="4046877">int32</span><span class="op" id="4046882">)</span>&nbsp;<span class="builtintype" id="4046884">int</span>&nbsp;<span class="op" id="4046888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046891">z</span>&nbsp;<span class="op" id="4046893">:=</span>&nbsp;<span class="op" id="4046896">^</span><span class="op" id="4046897">(</span><span class="ident" id="4046898">x</span>&nbsp;<span class="op" id="4046900">^</span>&nbsp;<span class="ident" id="4046902">y</span><span class="op" id="4046903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046906">z</span>&nbsp;<span class="op" id="4046908">&amp;=</span>&nbsp;<span class="ident" id="4046911">z</span>&nbsp;<span class="op" id="4046913">&gt;&gt;</span>&nbsp;<span class="num" id="4046916">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046920">z</span>&nbsp;<span class="op" id="4046922">&amp;=</span>&nbsp;<span class="ident" id="4046925">z</span>&nbsp;<span class="op" id="4046927">&gt;&gt;</span>&nbsp;<span class="num" id="4046930">8</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046933">z</span>&nbsp;<span class="op" id="4046935">&amp;=</span>&nbsp;<span class="ident" id="4046938">z</span>&nbsp;<span class="op" id="4046940">&gt;&gt;</span>&nbsp;<span class="num" id="4046943">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046946">z</span>&nbsp;<span class="op" id="4046948">&amp;=</span>&nbsp;<span class="ident" id="4046951">z</span>&nbsp;<span class="op" id="4046953">&gt;&gt;</span>&nbsp;<span class="num" id="4046956">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046959">z</span>&nbsp;<span class="op" id="4046961">&amp;=</span>&nbsp;<span class="ident" id="4046964">z</span>&nbsp;<span class="op" id="4046966">&gt;&gt;</span>&nbsp;<span class="num" id="4046969">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046973">return</span>&nbsp;<span class="builtintype" id="4046980">int</span><span class="op" id="4046983">(</span><span class="ident" id="4046984">z</span>&nbsp;<span class="op" id="4046986">&amp;</span>&nbsp;<span class="num" id="4046988">1</span><span class="op" id="4046989">)</span><br>
<span class="lineno">50</span><span class="op" id="4046991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4046994">//&nbsp;ConstantTimeCopy&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;y&nbsp;into&nbsp;x&nbsp;(a&nbsp;slice&nbsp;of&nbsp;equal&nbsp;length)</span><br>
<span class="lineno"></span><span class="comment" id="4047072">//&nbsp;if&nbsp;v&nbsp;==&nbsp;1.&nbsp;If&nbsp;v&nbsp;==&nbsp;0,&nbsp;x&nbsp;is&nbsp;left&nbsp;unchanged.&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v</span><br>
<span class="lineno"></span><span class="comment" id="4047149">//&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno">55</span><span class="keyword" id="4047175">func</span>&nbsp;<span class="ident" id="4047180">ConstantTimeCopy</span><span class="op" id="4047196">(</span><span class="ident" id="4047197">v</span>&nbsp;<span class="builtintype" id="4047199">int</span><span class="op" id="4047202">,</span>&nbsp;<span class="ident" id="4047204">x</span><span class="op" id="4047205">,</span>&nbsp;<span class="ident" id="4047207">y</span>&nbsp;<span class="op" id="4047209">[</span><span class="op" id="4047210">]</span><span class="builtintype" id="4047211">byte</span><span class="op" id="4047215">)</span>&nbsp;<span class="op" id="4047217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047220">if</span>&nbsp;<span class="builtinfunc" id="4047223">len</span><span class="op" id="4047226">(</span><span class="ident" id="4047227">x</span><span class="op" id="4047228">)</span>&nbsp;<span class="op" id="4047230">!=</span>&nbsp;<span class="builtinfunc" id="4047233">len</span><span class="op" id="4047236">(</span><span class="ident" id="4047237">y</span><span class="op" id="4047238">)</span>&nbsp;<span class="op" id="4047240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4047244">panic</span><span class="op" id="4047249">(</span><span class="string" id="4047250">&#34;subtle:&nbsp;slices&nbsp;have&nbsp;different&nbsp;lengths&#34;</span><span class="op" id="4047289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4047292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047296">xmask</span>&nbsp;<span class="op" id="4047302">:=</span>&nbsp;<span class="builtintype" id="4047305">byte</span><span class="op" id="4047309">(</span><span class="ident" id="4047310">v</span>&nbsp;<span class="op" id="4047312">-</span>&nbsp;<span class="num" id="4047314">1</span><span class="op" id="4047315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047318">ymask</span>&nbsp;<span class="op" id="4047324">:=</span>&nbsp;<span class="builtintype" id="4047327">byte</span><span class="op" id="4047331">(</span><span class="op" id="4047332">^</span><span class="op" id="4047333">(</span><span class="ident" id="4047334">v</span>&nbsp;<span class="op" id="4047336">-</span>&nbsp;<span class="num" id="4047338">1</span><span class="op" id="4047339">)</span><span class="op" id="4047340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047343">for</span>&nbsp;<span class="ident" id="4047347">i</span>&nbsp;<span class="op" id="4047349">:=</span>&nbsp;<span class="num" id="4047352">0</span><span class="op" id="4047353">;</span>&nbsp;<span class="ident" id="4047355">i</span>&nbsp;<span class="op" id="4047357">&lt;</span>&nbsp;<span class="builtinfunc" id="4047359">len</span><span class="op" id="4047362">(</span><span class="ident" id="4047363">x</span><span class="op" id="4047364">)</span><span class="op" id="4047365">;</span>&nbsp;<span class="ident" id="4047367">i</span><span class="op" id="4047368">++</span>&nbsp;<span class="op" id="4047371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047375">x</span><span class="op" id="4047376">[</span><span class="ident" id="4047377">i</span><span class="op" id="4047378">]</span>&nbsp;<span class="op" id="4047380">=</span>&nbsp;<span class="ident" id="4047382">x</span><span class="op" id="4047383">[</span><span class="ident" id="4047384">i</span><span class="op" id="4047385">]</span><span class="op" id="4047386">&amp;</span><span class="ident" id="4047387">xmask</span>&nbsp;<span class="op" id="4047393">|</span>&nbsp;<span class="ident" id="4047395">y</span><span class="op" id="4047396">[</span><span class="ident" id="4047397">i</span><span class="op" id="4047398">]</span><span class="op" id="4047399">&amp;</span><span class="ident" id="4047400">ymask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4047407">}</span><br>
<span class="lineno">65</span><span class="op" id="4047409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4047412">//&nbsp;ConstantTimeLessOrEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;&lt;=&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4047473">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;x&nbsp;or&nbsp;y&nbsp;are&nbsp;negative&nbsp;or&nbsp;&gt;&nbsp;2**31&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="4047541">func</span>&nbsp;<span class="ident" id="4047546">ConstantTimeLessOrEq</span><span class="op" id="4047566">(</span><span class="ident" id="4047567">x</span><span class="op" id="4047568">,</span>&nbsp;<span class="ident" id="4047570">y</span>&nbsp;<span class="builtintype" id="4047572">int</span><span class="op" id="4047575">)</span>&nbsp;<span class="builtintype" id="4047577">int</span>&nbsp;<span class="op" id="4047581">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047584">x32</span>&nbsp;<span class="op" id="4047588">:=</span>&nbsp;<span class="builtintype" id="4047591">int32</span><span class="op" id="4047596">(</span><span class="ident" id="4047597">x</span><span class="op" id="4047598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4047601">y32</span>&nbsp;<span class="op" id="4047605">:=</span>&nbsp;<span class="builtintype" id="4047608">int32</span><span class="op" id="4047613">(</span><span class="ident" id="4047614">y</span><span class="op" id="4047615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047618">return</span>&nbsp;<span class="builtintype" id="4047625">int</span><span class="op" id="4047628">(</span><span class="op" id="4047629">(</span><span class="op" id="4047630">(</span><span class="ident" id="4047631">x32</span>&nbsp;<span class="op" id="4047635">-</span>&nbsp;<span class="ident" id="4047637">y32</span>&nbsp;<span class="op" id="4047641">-</span>&nbsp;<span class="num" id="4047643">1</span><span class="op" id="4047644">)</span>&nbsp;<span class="op" id="4047646">&gt;&gt;</span>&nbsp;<span class="num" id="4047649">31</span><span class="op" id="4047651">)</span>&nbsp;<span class="op" id="4047653">&amp;</span>&nbsp;<span class="num" id="4047655">1</span><span class="op" id="4047656">)</span><br>
<span class="lineno"></span><span class="op" id="4047658">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
