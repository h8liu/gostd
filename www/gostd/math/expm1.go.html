<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1553741">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1553796">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1553850">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1553901">package</span>&nbsp;<span class="ident" id="1553909">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1553915">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="1553975">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="1554035">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="1554094">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="1554124">//</span><br>
<span class="lineno"></span><span class="comment" id="1554127">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="1554183">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1554252">//</span><br>
<span class="lineno">15</span><span class="comment" id="1554255">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="1554314">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="1554370">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="1554427">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="1554444">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="1554500">//</span><br>
<span class="lineno"></span><span class="comment" id="1554503">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="1554515">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="1554566">//</span><br>
<span class="lineno"></span><span class="comment" id="1554569">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="1554579">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="1554607">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1554655">//</span><br>
<span class="lineno"></span><span class="comment" id="1554658">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="1554716">//</span><br>
<span class="lineno">30</span><span class="comment" id="1554719">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="1554783">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="1554847">//</span><br>
<span class="lineno"></span><span class="comment" id="1554850">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1554915">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="1554949">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="1554963">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1555028">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1555057">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="1555115">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="1555132">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="1555190">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="1555251">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1555318">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="1555383">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="1555446">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="1555512">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="1555547">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="1555618">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="1555668">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="1555718">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="1555768">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="1555818">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="1555868">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="1555935">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="1555965">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="1556018">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="1556068">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="1556113">//</span><br>
<span class="lineno"></span><span class="comment" id="1556116">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="1556178">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="1556247">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="1556286">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="1556350">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="1556414">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="1556478">//</span><br>
<span class="lineno"></span><span class="comment" id="1556481">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="1556547">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="1556602">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="1556650">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="1556714">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="1556779">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="1556797">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1556869">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1556941">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="1557013">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1557085">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1557157">//</span><br>
<span class="lineno"></span><span class="comment" id="1557160">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="1557187">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="1557226">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="1557255">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="1557306">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="1557363">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="1557393">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="1557462">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="1557514">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1557579">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="1557650">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="1557685">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="1557731">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="1557790">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="1557850">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="1557921">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="1557984">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="1558029">//</span><br>
<span class="lineno"></span><span class="comment" id="1558032">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="1558050">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="1558096">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1558127">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="1558182">//</span><br>
<span class="lineno"></span><span class="comment" id="1558185">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="1558198">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="1558268">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="1558308">//</span><br>
<span class="lineno">105</span><span class="comment" id="1558311">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="1558326">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="1558350">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="1558420">//</span><br>
<span class="lineno"></span><span class="comment" id="1558423">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="1558437">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="1558503">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1558567">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="1558633">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="1558677">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1558681">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="1558745">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1558805">//</span><br>
<span class="lineno"></span><span class="comment" id="1558808">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="1558830">//&nbsp;&nbsp;&nbsp;&nbspExpm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="1558852">//&nbsp;&nbsp;&nbsp;&nbspExpm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="1558872">//&nbsp;&nbsp;&nbsp;&nbspExpm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="1558892">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="1558937">func</span>&nbsp;<span class="ident" id="1558942">Expm1</span><span class="op" id="1558947">(</span><span class="ident" id="1558948">x</span>&nbsp;<span class="builtintype" id="1558950">float64</span><span class="op" id="1558957">)</span>&nbsp;<span class="builtintype" id="1558959">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="1558968">func</span>&nbsp;<span class="ident" id="1558973">expm1</span><span class="op" id="1558978">(</span><span class="ident" id="1558979">x</span>&nbsp;<span class="builtintype" id="1558981">float64</span><span class="op" id="1558988">)</span>&nbsp;<span class="builtintype" id="1558990">float64</span>&nbsp;<span class="op" id="1558998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559001">const</span>&nbsp;<span class="op" id="1559007">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559011">Othreshold</span>&nbsp;<span class="op" id="1559022">=</span>&nbsp;<span class="num" id="1559024">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="1559051">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559075">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1559086">=</span>&nbsp;<span class="num" id="1559088">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="1559115">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559139">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="1559150">=</span>&nbsp;<span class="num" id="1559152">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="1559179">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559203">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1559214">=</span>&nbsp;<span class="num" id="1559216">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="1559243">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559267">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1559278">=</span>&nbsp;<span class="num" id="1559280">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="1559307">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559331">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1559342">=</span>&nbsp;<span class="num" id="1559344">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="1559371">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559395">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1559406">=</span>&nbsp;<span class="num" id="1559408">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="1559435">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559459">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1559470">=</span>&nbsp;<span class="num" id="1559472">1.0</span>&nbsp;<span class="op" id="1559476">/</span>&nbsp;<span class="op" id="1559478">(</span><span class="num" id="1559479">1</span>&nbsp;<span class="op" id="1559481">&lt;&lt;</span>&nbsp;<span class="num" id="1559484">54</span><span class="op" id="1559486">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1559499">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1559532">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559574">Q1</span>&nbsp;<span class="op" id="1559577">=</span>&nbsp;<span class="op" id="1559579">-</span><span class="num" id="1559580">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="1559607">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559631">Q2</span>&nbsp;<span class="op" id="1559634">=</span>&nbsp;<span class="num" id="1559636">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="1559664">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559688">Q3</span>&nbsp;<span class="op" id="1559691">=</span>&nbsp;<span class="op" id="1559693">-</span><span class="num" id="1559694">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="1559721">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559745">Q4</span>&nbsp;<span class="op" id="1559748">=</span>&nbsp;<span class="num" id="1559750">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="1559778">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559802">Q5</span>&nbsp;<span class="op" id="1559805">=</span>&nbsp;<span class="op" id="1559807">-</span><span class="num" id="1559808">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="1559835">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559858">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1559862">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559880">switch</span>&nbsp;<span class="op" id="1559887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559890">case</span>&nbsp;<span class="ident" id="1559895">IsInf</span><span class="op" id="1559900">(</span><span class="ident" id="1559901">x</span><span class="op" id="1559902">,</span>&nbsp;<span class="num" id="1559904">1</span><span class="op" id="1559905">)</span>&nbsp;<span class="op" id="1559907">||</span>&nbsp;<span class="ident" id="1559910">IsNaN</span><span class="op" id="1559915">(</span><span class="ident" id="1559916">x</span><span class="op" id="1559917">)</span><span class="op" id="1559918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559922">return</span>&nbsp;<span class="ident" id="1559929">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559932">case</span>&nbsp;<span class="ident" id="1559937">IsInf</span><span class="op" id="1559942">(</span><span class="ident" id="1559943">x</span><span class="op" id="1559944">,</span>&nbsp;<span class="op" id="1559946">-</span><span class="num" id="1559947">1</span><span class="op" id="1559948">)</span><span class="op" id="1559949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559953">return</span>&nbsp;<span class="op" id="1559960">-</span><span class="num" id="1559961">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559968">absx</span>&nbsp;<span class="op" id="1559973">:=</span>&nbsp;<span class="ident" id="1559976">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559979">sign</span>&nbsp;<span class="op" id="1559984">:=</span>&nbsp;<span class="builtintype" id="1559987">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559994">if</span>&nbsp;<span class="ident" id="1559997">x</span>&nbsp;<span class="op" id="1559999">&lt;</span>&nbsp;<span class="num" id="1560001">0</span>&nbsp;<span class="op" id="1560003">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560007">absx</span>&nbsp;<span class="op" id="1560012">=</span>&nbsp;<span class="op" id="1560014">-</span><span class="ident" id="1560015">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560022">sign</span>&nbsp;<span class="op" id="1560027">=</span>&nbsp;<span class="builtintype" id="1560029">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1560039">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560068">if</span>&nbsp;<span class="ident" id="1560071">absx</span>&nbsp;<span class="op" id="1560076">&gt;=</span>&nbsp;<span class="ident" id="1560079">Ln2X56</span>&nbsp;<span class="op" id="1560086">{</span>&nbsp;<span class="comment" id="1560088">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560112">if</span>&nbsp;<span class="ident" id="1560115">absx</span>&nbsp;<span class="op" id="1560120">&gt;=</span>&nbsp;<span class="ident" id="1560123">Othreshold</span>&nbsp;<span class="op" id="1560134">{</span>&nbsp;<span class="comment" id="1560136">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560162">return</span>&nbsp;<span class="ident" id="1560169">Inf</span><span class="op" id="1560172">(</span><span class="num" id="1560173">1</span><span class="op" id="1560174">)</span>&nbsp;<span class="comment" id="1560176">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560194">if</span>&nbsp;<span class="ident" id="1560197">sign</span>&nbsp;<span class="op" id="1560202">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560207">return</span>&nbsp;<span class="op" id="1560214">-</span><span class="num" id="1560215">1</span>&nbsp;<span class="comment" id="1560217">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1560254">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560277">var</span>&nbsp;<span class="ident" id="1560281">c</span>&nbsp;<span class="builtintype" id="1560283">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560292">var</span>&nbsp;<span class="ident" id="1560296">k</span>&nbsp;<span class="builtintype" id="1560298">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560303">if</span>&nbsp;<span class="ident" id="1560306">absx</span>&nbsp;<span class="op" id="1560311">&gt;</span>&nbsp;<span class="ident" id="1560313">Ln2Half</span>&nbsp;<span class="op" id="1560321">{</span>&nbsp;<span class="comment" id="1560323">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560348">var</span>&nbsp;<span class="ident" id="1560352">hi</span><span class="op" id="1560354">,</span>&nbsp;<span class="ident" id="1560356">lo</span>&nbsp;<span class="builtintype" id="1560359">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560369">if</span>&nbsp;<span class="ident" id="1560372">absx</span>&nbsp;<span class="op" id="1560377">&lt;</span>&nbsp;<span class="ident" id="1560379">Ln2HalfX3</span>&nbsp;<span class="op" id="1560389">{</span>&nbsp;<span class="comment" id="1560391">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560417">if</span>&nbsp;<span class="op" id="1560420">!</span><span class="ident" id="1560421">sign</span>&nbsp;<span class="op" id="1560426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560432">hi</span>&nbsp;<span class="op" id="1560435">=</span>&nbsp;<span class="ident" id="1560437">x</span>&nbsp;<span class="op" id="1560439">-</span>&nbsp;<span class="ident" id="1560441">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560451">lo</span>&nbsp;<span class="op" id="1560454">=</span>&nbsp;<span class="ident" id="1560456">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560466">k</span>&nbsp;<span class="op" id="1560468">=</span>&nbsp;<span class="num" id="1560470">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560475">}</span>&nbsp;<span class="keyword" id="1560477">else</span>&nbsp;<span class="op" id="1560482">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560488">hi</span>&nbsp;<span class="op" id="1560491">=</span>&nbsp;<span class="ident" id="1560493">x</span>&nbsp;<span class="op" id="1560495">+</span>&nbsp;<span class="ident" id="1560497">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560507">lo</span>&nbsp;<span class="op" id="1560510">=</span>&nbsp;<span class="op" id="1560512">-</span><span class="ident" id="1560513">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560523">k</span>&nbsp;<span class="op" id="1560525">=</span>&nbsp;<span class="op" id="1560527">-</span><span class="num" id="1560528">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560537">}</span>&nbsp;<span class="keyword" id="1560539">else</span>&nbsp;<span class="op" id="1560544">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560549">if</span>&nbsp;<span class="op" id="1560552">!</span><span class="ident" id="1560553">sign</span>&nbsp;<span class="op" id="1560558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560564">k</span>&nbsp;<span class="op" id="1560566">=</span>&nbsp;<span class="builtintype" id="1560568">int</span><span class="op" id="1560571">(</span><span class="ident" id="1560572">InvLn2</span><span class="op" id="1560578">*</span><span class="ident" id="1560579">x</span>&nbsp;<span class="op" id="1560581">+</span>&nbsp;<span class="num" id="1560583">0.5</span><span class="op" id="1560586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560591">}</span>&nbsp;<span class="keyword" id="1560593">else</span>&nbsp;<span class="op" id="1560598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560604">k</span>&nbsp;<span class="op" id="1560606">=</span>&nbsp;<span class="builtintype" id="1560608">int</span><span class="op" id="1560611">(</span><span class="ident" id="1560612">InvLn2</span><span class="op" id="1560618">*</span><span class="ident" id="1560619">x</span>&nbsp;<span class="op" id="1560621">-</span>&nbsp;<span class="num" id="1560623">0.5</span><span class="op" id="1560626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560631">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560636">t</span>&nbsp;<span class="op" id="1560638">:=</span>&nbsp;<span class="builtintype" id="1560641">float64</span><span class="op" id="1560648">(</span><span class="ident" id="1560649">k</span><span class="op" id="1560650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560655">hi</span>&nbsp;<span class="op" id="1560658">=</span>&nbsp;<span class="ident" id="1560660">x</span>&nbsp;<span class="op" id="1560662">-</span>&nbsp;<span class="ident" id="1560664">t</span><span class="op" id="1560665">*</span><span class="ident" id="1560666">Ln2Hi</span>&nbsp;<span class="comment" id="1560672">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560702">lo</span>&nbsp;<span class="op" id="1560705">=</span>&nbsp;<span class="ident" id="1560707">t</span>&nbsp;<span class="op" id="1560709">*</span>&nbsp;<span class="ident" id="1560711">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560723">x</span>&nbsp;<span class="op" id="1560725">=</span>&nbsp;<span class="ident" id="1560727">hi</span>&nbsp;<span class="op" id="1560730">-</span>&nbsp;<span class="ident" id="1560732">lo</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560737">c</span>&nbsp;<span class="op" id="1560739">=</span>&nbsp;<span class="op" id="1560741">(</span><span class="ident" id="1560742">hi</span>&nbsp;<span class="op" id="1560745">-</span>&nbsp;<span class="ident" id="1560747">x</span><span class="op" id="1560748">)</span>&nbsp;<span class="op" id="1560750">-</span>&nbsp;<span class="ident" id="1560752">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560756">}</span>&nbsp;<span class="keyword" id="1560758">else</span>&nbsp;<span class="keyword" id="1560763">if</span>&nbsp;<span class="ident" id="1560766">absx</span>&nbsp;<span class="op" id="1560771">&lt;</span>&nbsp;<span class="ident" id="1560773">Tiny</span>&nbsp;<span class="op" id="1560778">{</span>&nbsp;<span class="comment" id="1560780">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560813">return</span>&nbsp;<span class="ident" id="1560820">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560823">}</span>&nbsp;<span class="keyword" id="1560825">else</span>&nbsp;<span class="op" id="1560830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560834">k</span>&nbsp;<span class="op" id="1560836">=</span>&nbsp;<span class="num" id="1560838">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1560845">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560875">hfx</span>&nbsp;<span class="op" id="1560879">:=</span>&nbsp;<span class="num" id="1560882">0.5</span>&nbsp;<span class="op" id="1560886">*</span>&nbsp;<span class="ident" id="1560888">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560891">hxs</span>&nbsp;<span class="op" id="1560895">:=</span>&nbsp;<span class="ident" id="1560898">x</span>&nbsp;<span class="op" id="1560900">*</span>&nbsp;<span class="ident" id="1560902">hfx</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560907">r1</span>&nbsp;<span class="op" id="1560910">:=</span>&nbsp;<span class="num" id="1560913">1</span>&nbsp;<span class="op" id="1560915">+</span>&nbsp;<span class="ident" id="1560917">hxs</span><span class="op" id="1560920">*</span><span class="op" id="1560921">(</span><span class="ident" id="1560922">Q1</span><span class="op" id="1560924">+</span><span class="ident" id="1560925">hxs</span><span class="op" id="1560928">*</span><span class="op" id="1560929">(</span><span class="ident" id="1560930">Q2</span><span class="op" id="1560932">+</span><span class="ident" id="1560933">hxs</span><span class="op" id="1560936">*</span><span class="op" id="1560937">(</span><span class="ident" id="1560938">Q3</span><span class="op" id="1560940">+</span><span class="ident" id="1560941">hxs</span><span class="op" id="1560944">*</span><span class="op" id="1560945">(</span><span class="ident" id="1560946">Q4</span><span class="op" id="1560948">+</span><span class="ident" id="1560949">hxs</span><span class="op" id="1560952">*</span><span class="ident" id="1560953">Q5</span><span class="op" id="1560955">)</span><span class="op" id="1560956">)</span><span class="op" id="1560957">)</span><span class="op" id="1560958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560961">t</span>&nbsp;<span class="op" id="1560963">:=</span>&nbsp;<span class="num" id="1560966">3</span>&nbsp;<span class="op" id="1560968">-</span>&nbsp;<span class="ident" id="1560970">r1</span><span class="op" id="1560972">*</span><span class="ident" id="1560973">hfx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560978">e</span>&nbsp;<span class="op" id="1560980">:=</span>&nbsp;<span class="ident" id="1560983">hxs</span>&nbsp;<span class="op" id="1560987">*</span>&nbsp;<span class="op" id="1560989">(</span><span class="op" id="1560990">(</span><span class="ident" id="1560991">r1</span>&nbsp;<span class="op" id="1560994">-</span>&nbsp;<span class="ident" id="1560996">t</span><span class="op" id="1560997">)</span>&nbsp;<span class="op" id="1560999">/</span>&nbsp;<span class="op" id="1561001">(</span><span class="num" id="1561002">6.0</span>&nbsp;<span class="op" id="1561006">-</span>&nbsp;<span class="ident" id="1561008">x</span><span class="op" id="1561009">*</span><span class="ident" id="1561010">t</span><span class="op" id="1561011">)</span><span class="op" id="1561012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561015">if</span>&nbsp;<span class="ident" id="1561018">k</span>&nbsp;<span class="op" id="1561020">!=</span>&nbsp;<span class="num" id="1561023">0</span>&nbsp;<span class="op" id="1561025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561029">e</span>&nbsp;<span class="op" id="1561031">=</span>&nbsp;<span class="op" id="1561033">(</span><span class="ident" id="1561034">x</span><span class="op" id="1561035">*</span><span class="op" id="1561036">(</span><span class="ident" id="1561037">e</span><span class="op" id="1561038">-</span><span class="ident" id="1561039">c</span><span class="op" id="1561040">)</span>&nbsp;<span class="op" id="1561042">-</span>&nbsp;<span class="ident" id="1561044">c</span><span class="op" id="1561045">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561049">e</span>&nbsp;<span class="op" id="1561051">-=</span>&nbsp;<span class="ident" id="1561054">hxs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561060">switch</span>&nbsp;<span class="op" id="1561067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561071">case</span>&nbsp;<span class="ident" id="1561076">k</span>&nbsp;<span class="op" id="1561078">==</span>&nbsp;<span class="op" id="1561081">-</span><span class="num" id="1561082">1</span><span class="op" id="1561083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561088">return</span>&nbsp;<span class="num" id="1561095">0.5</span><span class="op" id="1561098">*</span><span class="op" id="1561099">(</span><span class="ident" id="1561100">x</span><span class="op" id="1561101">-</span><span class="ident" id="1561102">e</span><span class="op" id="1561103">)</span>&nbsp;<span class="op" id="1561105">-</span>&nbsp;<span class="num" id="1561107">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561113">case</span>&nbsp;<span class="ident" id="1561118">k</span>&nbsp;<span class="op" id="1561120">==</span>&nbsp;<span class="num" id="1561123">1</span><span class="op" id="1561124">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561129">if</span>&nbsp;<span class="ident" id="1561132">x</span>&nbsp;<span class="op" id="1561134">&lt;</span>&nbsp;<span class="op" id="1561136">-</span><span class="num" id="1561137">0.25</span>&nbsp;<span class="op" id="1561142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561148">return</span>&nbsp;<span class="op" id="1561155">-</span><span class="num" id="1561156">2</span>&nbsp;<span class="op" id="1561158">*</span>&nbsp;<span class="op" id="1561160">(</span><span class="ident" id="1561161">e</span>&nbsp;<span class="op" id="1561163">-</span>&nbsp;<span class="op" id="1561165">(</span><span class="ident" id="1561166">x</span>&nbsp;<span class="op" id="1561168">+</span>&nbsp;<span class="num" id="1561170">0.5</span><span class="op" id="1561173">)</span><span class="op" id="1561174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561184">return</span>&nbsp;<span class="num" id="1561191">1</span>&nbsp;<span class="op" id="1561193">+</span>&nbsp;<span class="num" id="1561195">2</span><span class="op" id="1561196">*</span><span class="op" id="1561197">(</span><span class="ident" id="1561198">x</span><span class="op" id="1561199">-</span><span class="ident" id="1561200">e</span><span class="op" id="1561201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561205">case</span>&nbsp;<span class="ident" id="1561210">k</span>&nbsp;<span class="op" id="1561212">&lt;=</span>&nbsp;<span class="op" id="1561215">-</span><span class="num" id="1561216">2</span>&nbsp;<span class="op" id="1561218">||</span>&nbsp;<span class="ident" id="1561221">k</span>&nbsp;<span class="op" id="1561223">&gt;</span>&nbsp;<span class="num" id="1561225">56</span><span class="op" id="1561227">:</span>&nbsp;<span class="comment" id="1561229">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561262">y</span>&nbsp;<span class="op" id="1561264">:=</span>&nbsp;<span class="num" id="1561267">1</span>&nbsp;<span class="op" id="1561269">-</span>&nbsp;<span class="op" id="1561271">(</span><span class="ident" id="1561272">e</span>&nbsp;<span class="op" id="1561274">-</span>&nbsp;<span class="ident" id="1561276">x</span><span class="op" id="1561277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561282">y</span>&nbsp;<span class="op" id="1561284">=</span>&nbsp;<span class="ident" id="1561286">Float64frombits</span><span class="op" id="1561301">(</span><span class="ident" id="1561302">Float64bits</span><span class="op" id="1561313">(</span><span class="ident" id="1561314">y</span><span class="op" id="1561315">)</span>&nbsp;<span class="op" id="1561317">+</span>&nbsp;<span class="ident" id="1561319">uint64</span><span class="op" id="1561325">(</span><span class="ident" id="1561326">k</span><span class="op" id="1561327">)</span><span class="op" id="1561328">&lt;&lt;</span><span class="num" id="1561330">52</span><span class="op" id="1561332">)</span>&nbsp;<span class="comment" id="1561334">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561362">return</span>&nbsp;<span class="ident" id="1561369">y</span>&nbsp;<span class="op" id="1561371">-</span>&nbsp;<span class="num" id="1561373">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561381">if</span>&nbsp;<span class="ident" id="1561384">k</span>&nbsp;<span class="op" id="1561386">&lt;</span>&nbsp;<span class="num" id="1561388">20</span>&nbsp;<span class="op" id="1561391">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561396">t</span>&nbsp;<span class="op" id="1561398">:=</span>&nbsp;<span class="ident" id="1561401">Float64frombits</span><span class="op" id="1561416">(</span><span class="num" id="1561417">0x3ff0000000000000</span>&nbsp;<span class="op" id="1561436">-</span>&nbsp;<span class="op" id="1561438">(</span><span class="num" id="1561439">0x20000000000000</span>&nbsp;<span class="op" id="1561456">&gt;&gt;</span>&nbsp;<span class="builtintype" id="1561459">uint</span><span class="op" id="1561463">(</span><span class="ident" id="1561464">k</span><span class="op" id="1561465">)</span><span class="op" id="1561466">)</span><span class="op" id="1561467">)</span>&nbsp;<span class="comment" id="1561469">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561485">y</span>&nbsp;<span class="op" id="1561487">:=</span>&nbsp;<span class="ident" id="1561490">t</span>&nbsp;<span class="op" id="1561492">-</span>&nbsp;<span class="op" id="1561494">(</span><span class="ident" id="1561495">e</span>&nbsp;<span class="op" id="1561497">-</span>&nbsp;<span class="ident" id="1561499">x</span><span class="op" id="1561500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561505">y</span>&nbsp;<span class="op" id="1561507">=</span>&nbsp;<span class="ident" id="1561509">Float64frombits</span><span class="op" id="1561524">(</span><span class="ident" id="1561525">Float64bits</span><span class="op" id="1561536">(</span><span class="ident" id="1561537">y</span><span class="op" id="1561538">)</span>&nbsp;<span class="op" id="1561540">+</span>&nbsp;<span class="ident" id="1561542">uint64</span><span class="op" id="1561548">(</span><span class="ident" id="1561549">k</span><span class="op" id="1561550">)</span><span class="op" id="1561551">&lt;&lt;</span><span class="num" id="1561553">52</span><span class="op" id="1561555">)</span>&nbsp;<span class="comment" id="1561557">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561585">return</span>&nbsp;<span class="ident" id="1561592">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561596">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561600">t</span>&nbsp;<span class="op" id="1561602">:=</span>&nbsp;<span class="ident" id="1561605">Float64frombits</span><span class="op" id="1561620">(</span><span class="ident" id="1561621">uint64</span><span class="op" id="1561627">(</span><span class="op" id="1561628">(</span><span class="num" id="1561629">0x3ff</span>&nbsp;<span class="op" id="1561635">-</span>&nbsp;<span class="ident" id="1561637">k</span><span class="op" id="1561638">)</span>&nbsp;<span class="op" id="1561640">&lt;&lt;</span>&nbsp;<span class="num" id="1561643">52</span><span class="op" id="1561645">)</span><span class="op" id="1561646">)</span>&nbsp;<span class="comment" id="1561648">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561659">y</span>&nbsp;<span class="op" id="1561661">:=</span>&nbsp;<span class="ident" id="1561664">x</span>&nbsp;<span class="op" id="1561666">-</span>&nbsp;<span class="op" id="1561668">(</span><span class="ident" id="1561669">e</span>&nbsp;<span class="op" id="1561671">+</span>&nbsp;<span class="ident" id="1561673">t</span><span class="op" id="1561674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561678">y</span>&nbsp;<span class="op" id="1561680">+=</span>&nbsp;<span class="num" id="1561683">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561687">y</span>&nbsp;<span class="op" id="1561689">=</span>&nbsp;<span class="ident" id="1561691">Float64frombits</span><span class="op" id="1561706">(</span><span class="ident" id="1561707">Float64bits</span><span class="op" id="1561718">(</span><span class="ident" id="1561719">y</span><span class="op" id="1561720">)</span>&nbsp;<span class="op" id="1561722">+</span>&nbsp;<span class="ident" id="1561724">uint64</span><span class="op" id="1561730">(</span><span class="ident" id="1561731">k</span><span class="op" id="1561732">)</span><span class="op" id="1561733">&lt;&lt;</span><span class="num" id="1561735">52</span><span class="op" id="1561737">)</span>&nbsp;<span class="comment" id="1561739">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561766">return</span>&nbsp;<span class="ident" id="1561773">y</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561779">return</span>&nbsp;<span class="ident" id="1561786">x</span>&nbsp;<span class="op" id="1561788">-</span>&nbsp;<span class="op" id="1561790">(</span><span class="ident" id="1561791">x</span><span class="op" id="1561792">*</span><span class="ident" id="1561793">e</span>&nbsp;<span class="op" id="1561795">-</span>&nbsp;<span class="ident" id="1561797">hxs</span><span class="op" id="1561800">)</span>&nbsp;<span class="comment" id="1561802">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="1561812">}</span>
</div>
</body>
</html>
