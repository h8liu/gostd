<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5334577">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5334633">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5334687">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5334738">package</span>&nbsp;<span class="ident" id="5334746">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5334754">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="5334832">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="5334912">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="5334989">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="5335060">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5335134">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="5335201">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="5335269">func</span>&nbsp;<span class="op" id="5335274">(</span><span class="ident" id="5335275">re</span>&nbsp;<span class="op" id="5335278">*</span><span class="ident" id="5335279">Regexp</span><span class="op" id="5335285">)</span>&nbsp;<span class="ident" id="5335287">Simplify</span><span class="op" id="5335295">(</span><span class="op" id="5335296">)</span>&nbsp;<span class="op" id="5335298">*</span><span class="ident" id="5335299">Regexp</span>&nbsp;<span class="op" id="5335306">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335309">if</span>&nbsp;<span class="ident" id="5335312">re</span>&nbsp;<span class="op" id="5335315">==</span>&nbsp;<span class="ident" id="5335318">nil</span>&nbsp;<span class="op" id="5335322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335326">return</span>&nbsp;<span class="ident" id="5335333">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5335338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335341">switch</span>&nbsp;<span class="ident" id="5335348">re</span><span class="op" id="5335350">.</span><span class="ident" id="5335351">Op</span>&nbsp;<span class="op" id="5335354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335357">case</span>&nbsp;<span class="ident" id="5335362">OpCapture</span><span class="op" id="5335371">,</span>&nbsp;<span class="ident" id="5335373">OpConcat</span><span class="op" id="5335381">,</span>&nbsp;<span class="ident" id="5335383">OpAlternate</span><span class="op" id="5335394">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5335398">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335462">nre</span>&nbsp;<span class="op" id="5335466">:=</span>&nbsp;<span class="ident" id="5335469">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335474">for</span>&nbsp;<span class="ident" id="5335478">i</span><span class="op" id="5335479">,</span>&nbsp;<span class="ident" id="5335481">sub</span>&nbsp;<span class="op" id="5335485">:=</span>&nbsp;<span class="keyword" id="5335488">range</span>&nbsp;<span class="ident" id="5335494">re</span><span class="op" id="5335496">.</span><span class="ident" id="5335497">Sub</span>&nbsp;<span class="op" id="5335501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335506">nsub</span>&nbsp;<span class="op" id="5335511">:=</span>&nbsp;<span class="ident" id="5335514">sub</span><span class="op" id="5335517">.</span><span class="ident" id="5335518">Simplify</span><span class="op" id="5335526">(</span><span class="op" id="5335527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335532">if</span>&nbsp;<span class="ident" id="5335535">nre</span>&nbsp;<span class="op" id="5335539">==</span>&nbsp;<span class="ident" id="5335542">re</span>&nbsp;<span class="op" id="5335545">&amp;&amp;</span>&nbsp;<span class="ident" id="5335548">nsub</span>&nbsp;<span class="op" id="5335553">!=</span>&nbsp;<span class="ident" id="5335556">sub</span>&nbsp;<span class="op" id="5335560">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5335566">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335587">nre</span>&nbsp;<span class="op" id="5335591">=</span>&nbsp;<span class="builtinfunc" id="5335593">new</span><span class="op" id="5335596">(</span><span class="ident" id="5335597">Regexp</span><span class="op" id="5335603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5335609">*</span><span class="ident" id="5335610">nre</span>&nbsp;<span class="op" id="5335614">=</span>&nbsp;<span class="op" id="5335616">*</span><span class="ident" id="5335617">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335624">nre</span><span class="op" id="5335627">.</span><span class="ident" id="5335628">Rune</span>&nbsp;<span class="op" id="5335633">=</span>&nbsp;<span class="ident" id="5335635">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335643">nre</span><span class="op" id="5335646">.</span><span class="ident" id="5335647">Sub</span>&nbsp;<span class="op" id="5335651">=</span>&nbsp;<span class="builtinfunc" id="5335653">append</span><span class="op" id="5335659">(</span><span class="ident" id="5335660">nre</span><span class="op" id="5335663">.</span><span class="ident" id="5335664">Sub0</span><span class="op" id="5335668">[</span><span class="op" id="5335669">:</span><span class="num" id="5335670">0</span><span class="op" id="5335671">]</span><span class="op" id="5335672">,</span>&nbsp;<span class="ident" id="5335674">re</span><span class="op" id="5335676">.</span><span class="ident" id="5335677">Sub</span><span class="op" id="5335680">[</span><span class="op" id="5335681">:</span><span class="ident" id="5335682">i</span><span class="op" id="5335683">]</span><span class="op" id="5335684">...</span><span class="op" id="5335687">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5335692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335697">if</span>&nbsp;<span class="ident" id="5335700">nre</span>&nbsp;<span class="op" id="5335704">!=</span>&nbsp;<span class="ident" id="5335707">re</span>&nbsp;<span class="op" id="5335710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335716">nre</span><span class="op" id="5335719">.</span><span class="ident" id="5335720">Sub</span>&nbsp;<span class="op" id="5335724">=</span>&nbsp;<span class="builtinfunc" id="5335726">append</span><span class="op" id="5335732">(</span><span class="ident" id="5335733">nre</span><span class="op" id="5335736">.</span><span class="ident" id="5335737">Sub</span><span class="op" id="5335740">,</span>&nbsp;<span class="ident" id="5335742">nsub</span><span class="op" id="5335746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5335751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5335755">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335759">return</span>&nbsp;<span class="ident" id="5335766">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335772">case</span>&nbsp;<span class="ident" id="5335777">OpStar</span><span class="op" id="5335783">,</span>&nbsp;<span class="ident" id="5335785">OpPlus</span><span class="op" id="5335791">,</span>&nbsp;<span class="ident" id="5335793">OpQuest</span><span class="op" id="5335800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5335804">sub</span>&nbsp;<span class="op" id="5335808">:=</span>&nbsp;<span class="ident" id="5335811">re</span><span class="op" id="5335813">.</span><span class="ident" id="5335814">Sub</span><span class="op" id="5335817">[</span><span class="num" id="5335818">0</span><span class="op" id="5335819">]</span><span class="op" id="5335820">.</span><span class="ident" id="5335821">Simplify</span><span class="op" id="5335829">(</span><span class="op" id="5335830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335834">return</span>&nbsp;<span class="ident" id="5335841">simplify1</span><span class="op" id="5335850">(</span><span class="ident" id="5335851">re</span><span class="op" id="5335853">.</span><span class="ident" id="5335854">Op</span><span class="op" id="5335856">,</span>&nbsp;<span class="ident" id="5335858">re</span><span class="op" id="5335860">.</span><span class="ident" id="5335861">Flags</span><span class="op" id="5335866">,</span>&nbsp;<span class="ident" id="5335868">sub</span><span class="op" id="5335871">,</span>&nbsp;<span class="ident" id="5335873">re</span><span class="op" id="5335875">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335879">case</span>&nbsp;<span class="ident" id="5335884">OpRepeat</span><span class="op" id="5335892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5335896">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5335953">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5335995">if</span>&nbsp;<span class="ident" id="5335998">re</span><span class="op" id="5336000">.</span><span class="ident" id="5336001">Min</span>&nbsp;<span class="op" id="5336005">==</span>&nbsp;<span class="num" id="5336008">0</span>&nbsp;<span class="op" id="5336010">&amp;&amp;</span>&nbsp;<span class="ident" id="5336013">re</span><span class="op" id="5336015">.</span><span class="ident" id="5336016">Max</span>&nbsp;<span class="op" id="5336020">==</span>&nbsp;<span class="num" id="5336023">0</span>&nbsp;<span class="op" id="5336025">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336030">return</span>&nbsp;<span class="op" id="5336037">&amp;</span><span class="ident" id="5336038">Regexp</span><span class="op" id="5336044">{</span><span class="ident" id="5336045">Op</span><span class="op" id="5336047">:</span>&nbsp;<span class="ident" id="5336049">OpEmptyMatch</span><span class="op" id="5336061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336070">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336091">sub</span>&nbsp;<span class="op" id="5336095">:=</span>&nbsp;<span class="ident" id="5336098">re</span><span class="op" id="5336100">.</span><span class="ident" id="5336101">Sub</span><span class="op" id="5336104">[</span><span class="num" id="5336105">0</span><span class="op" id="5336106">]</span><span class="op" id="5336107">.</span><span class="ident" id="5336108">Simplify</span><span class="op" id="5336116">(</span><span class="op" id="5336117">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336122">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336164">if</span>&nbsp;<span class="ident" id="5336167">re</span><span class="op" id="5336169">.</span><span class="ident" id="5336170">Max</span>&nbsp;<span class="op" id="5336174">==</span>&nbsp;<span class="op" id="5336177">-</span><span class="num" id="5336178">1</span>&nbsp;<span class="op" id="5336180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336185">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336218">if</span>&nbsp;<span class="ident" id="5336221">re</span><span class="op" id="5336223">.</span><span class="ident" id="5336224">Min</span>&nbsp;<span class="op" id="5336228">==</span>&nbsp;<span class="num" id="5336231">0</span>&nbsp;<span class="op" id="5336233">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336239">return</span>&nbsp;<span class="ident" id="5336246">simplify1</span><span class="op" id="5336255">(</span><span class="ident" id="5336256">OpStar</span><span class="op" id="5336262">,</span>&nbsp;<span class="ident" id="5336264">re</span><span class="op" id="5336266">.</span><span class="ident" id="5336267">Flags</span><span class="op" id="5336272">,</span>&nbsp;<span class="ident" id="5336274">sub</span><span class="op" id="5336277">,</span>&nbsp;<span class="ident" id="5336279">nil</span><span class="op" id="5336282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336293">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336326">if</span>&nbsp;<span class="ident" id="5336329">re</span><span class="op" id="5336331">.</span><span class="ident" id="5336332">Min</span>&nbsp;<span class="op" id="5336336">==</span>&nbsp;<span class="num" id="5336339">1</span>&nbsp;<span class="op" id="5336341">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336347">return</span>&nbsp;<span class="ident" id="5336354">simplify1</span><span class="op" id="5336363">(</span><span class="ident" id="5336364">OpPlus</span><span class="op" id="5336370">,</span>&nbsp;<span class="ident" id="5336372">re</span><span class="op" id="5336374">.</span><span class="ident" id="5336375">Flags</span><span class="op" id="5336380">,</span>&nbsp;<span class="ident" id="5336382">sub</span><span class="op" id="5336385">,</span>&nbsp;<span class="ident" id="5336387">nil</span><span class="op" id="5336390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336401">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336437">nre</span>&nbsp;<span class="op" id="5336441">:=</span>&nbsp;<span class="op" id="5336444">&amp;</span><span class="ident" id="5336445">Regexp</span><span class="op" id="5336451">{</span><span class="ident" id="5336452">Op</span><span class="op" id="5336454">:</span>&nbsp;<span class="ident" id="5336456">OpConcat</span><span class="op" id="5336464">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336469">nre</span><span class="op" id="5336472">.</span><span class="ident" id="5336473">Sub</span>&nbsp;<span class="op" id="5336477">=</span>&nbsp;<span class="ident" id="5336479">nre</span><span class="op" id="5336482">.</span><span class="ident" id="5336483">Sub0</span><span class="op" id="5336487">[</span><span class="op" id="5336488">:</span><span class="num" id="5336489">0</span><span class="op" id="5336490">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336495">for</span>&nbsp;<span class="ident" id="5336499">i</span>&nbsp;<span class="op" id="5336501">:=</span>&nbsp;<span class="num" id="5336504">0</span><span class="op" id="5336505">;</span>&nbsp;<span class="ident" id="5336507">i</span>&nbsp;<span class="op" id="5336509">&lt;</span>&nbsp;<span class="ident" id="5336511">re</span><span class="op" id="5336513">.</span><span class="ident" id="5336514">Min</span><span class="op" id="5336517">-</span><span class="num" id="5336518">1</span><span class="op" id="5336519">;</span>&nbsp;<span class="ident" id="5336521">i</span><span class="op" id="5336522">++</span>&nbsp;<span class="op" id="5336525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336531">nre</span><span class="op" id="5336534">.</span><span class="ident" id="5336535">Sub</span>&nbsp;<span class="op" id="5336539">=</span>&nbsp;<span class="builtinfunc" id="5336541">append</span><span class="op" id="5336547">(</span><span class="ident" id="5336548">nre</span><span class="op" id="5336551">.</span><span class="ident" id="5336552">Sub</span><span class="op" id="5336555">,</span>&nbsp;<span class="ident" id="5336557">sub</span><span class="op" id="5336560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5336570">nre</span><span class="op" id="5336573">.</span><span class="ident" id="5336574">Sub</span>&nbsp;<span class="op" id="5336578">=</span>&nbsp;<span class="builtinfunc" id="5336580">append</span><span class="op" id="5336586">(</span><span class="ident" id="5336587">nre</span><span class="op" id="5336590">.</span><span class="ident" id="5336591">Sub</span><span class="op" id="5336594">,</span>&nbsp;<span class="ident" id="5336596">simplify1</span><span class="op" id="5336605">(</span><span class="ident" id="5336606">OpPlus</span><span class="op" id="5336612">,</span>&nbsp;<span class="ident" id="5336614">re</span><span class="op" id="5336616">.</span><span class="ident" id="5336617">Flags</span><span class="op" id="5336622">,</span>&nbsp;<span class="ident" id="5336624">sub</span><span class="op" id="5336627">,</span>&nbsp;<span class="ident" id="5336629">nil</span><span class="op" id="5336632">)</span><span class="op" id="5336633">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336638">return</span>&nbsp;<span class="ident" id="5336645">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336656">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336695">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336730">if</span>&nbsp;<span class="ident" id="5336733">re</span><span class="op" id="5336735">.</span><span class="ident" id="5336736">Min</span>&nbsp;<span class="op" id="5336740">==</span>&nbsp;<span class="num" id="5336743">1</span>&nbsp;<span class="op" id="5336745">&amp;&amp;</span>&nbsp;<span class="ident" id="5336748">re</span><span class="op" id="5336750">.</span><span class="ident" id="5336751">Max</span>&nbsp;<span class="op" id="5336755">==</span>&nbsp;<span class="num" id="5336758">1</span>&nbsp;<span class="op" id="5336760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336765">return</span>&nbsp;<span class="ident" id="5336772">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5336778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336783">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336848">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336914">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5336952">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5336983">var</span>&nbsp;<span class="ident" id="5336987">prefix</span>&nbsp;<span class="op" id="5336994">*</span><span class="ident" id="5336995">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337004">if</span>&nbsp;<span class="ident" id="5337007">re</span><span class="op" id="5337009">.</span><span class="ident" id="5337010">Min</span>&nbsp;<span class="op" id="5337014">&gt;</span>&nbsp;<span class="num" id="5337016">0</span>&nbsp;<span class="op" id="5337018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337023">prefix</span>&nbsp;<span class="op" id="5337030">=</span>&nbsp;<span class="op" id="5337032">&amp;</span><span class="ident" id="5337033">Regexp</span><span class="op" id="5337039">{</span><span class="ident" id="5337040">Op</span><span class="op" id="5337042">:</span>&nbsp;<span class="ident" id="5337044">OpConcat</span><span class="op" id="5337052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337057">prefix</span><span class="op" id="5337063">.</span><span class="ident" id="5337064">Sub</span>&nbsp;<span class="op" id="5337068">=</span>&nbsp;<span class="ident" id="5337070">prefix</span><span class="op" id="5337076">.</span><span class="ident" id="5337077">Sub0</span><span class="op" id="5337081">[</span><span class="op" id="5337082">:</span><span class="num" id="5337083">0</span><span class="op" id="5337084">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337089">for</span>&nbsp;<span class="ident" id="5337093">i</span>&nbsp;<span class="op" id="5337095">:=</span>&nbsp;<span class="num" id="5337098">0</span><span class="op" id="5337099">;</span>&nbsp;<span class="ident" id="5337101">i</span>&nbsp;<span class="op" id="5337103">&lt;</span>&nbsp;<span class="ident" id="5337105">re</span><span class="op" id="5337107">.</span><span class="ident" id="5337108">Min</span><span class="op" id="5337111">;</span>&nbsp;<span class="ident" id="5337113">i</span><span class="op" id="5337114">++</span>&nbsp;<span class="op" id="5337117">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337123">prefix</span><span class="op" id="5337129">.</span><span class="ident" id="5337130">Sub</span>&nbsp;<span class="op" id="5337134">=</span>&nbsp;<span class="builtinfunc" id="5337136">append</span><span class="op" id="5337142">(</span><span class="ident" id="5337143">prefix</span><span class="op" id="5337149">.</span><span class="ident" id="5337150">Sub</span><span class="op" id="5337153">,</span>&nbsp;<span class="ident" id="5337155">sub</span><span class="op" id="5337158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5337172">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337215">if</span>&nbsp;<span class="ident" id="5337218">re</span><span class="op" id="5337220">.</span><span class="ident" id="5337221">Max</span>&nbsp;<span class="op" id="5337225">&gt;</span>&nbsp;<span class="ident" id="5337227">re</span><span class="op" id="5337229">.</span><span class="ident" id="5337230">Min</span>&nbsp;<span class="op" id="5337234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337239">suffix</span>&nbsp;<span class="op" id="5337246">:=</span>&nbsp;<span class="ident" id="5337249">simplify1</span><span class="op" id="5337258">(</span><span class="ident" id="5337259">OpQuest</span><span class="op" id="5337266">,</span>&nbsp;<span class="ident" id="5337268">re</span><span class="op" id="5337270">.</span><span class="ident" id="5337271">Flags</span><span class="op" id="5337276">,</span>&nbsp;<span class="ident" id="5337278">sub</span><span class="op" id="5337281">,</span>&nbsp;<span class="ident" id="5337283">nil</span><span class="op" id="5337286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337291">for</span>&nbsp;<span class="ident" id="5337295">i</span>&nbsp;<span class="op" id="5337297">:=</span>&nbsp;<span class="ident" id="5337300">re</span><span class="op" id="5337302">.</span><span class="ident" id="5337303">Min</span>&nbsp;<span class="op" id="5337307">+</span>&nbsp;<span class="num" id="5337309">1</span><span class="op" id="5337310">;</span>&nbsp;<span class="ident" id="5337312">i</span>&nbsp;<span class="op" id="5337314">&lt;</span>&nbsp;<span class="ident" id="5337316">re</span><span class="op" id="5337318">.</span><span class="ident" id="5337319">Max</span><span class="op" id="5337322">;</span>&nbsp;<span class="ident" id="5337324">i</span><span class="op" id="5337325">++</span>&nbsp;<span class="op" id="5337328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337334">nre2</span>&nbsp;<span class="op" id="5337339">:=</span>&nbsp;<span class="op" id="5337342">&amp;</span><span class="ident" id="5337343">Regexp</span><span class="op" id="5337349">{</span><span class="ident" id="5337350">Op</span><span class="op" id="5337352">:</span>&nbsp;<span class="ident" id="5337354">OpConcat</span><span class="op" id="5337362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337368">nre2</span><span class="op" id="5337372">.</span><span class="ident" id="5337373">Sub</span>&nbsp;<span class="op" id="5337377">=</span>&nbsp;<span class="builtinfunc" id="5337379">append</span><span class="op" id="5337385">(</span><span class="ident" id="5337386">nre2</span><span class="op" id="5337390">.</span><span class="ident" id="5337391">Sub0</span><span class="op" id="5337395">[</span><span class="op" id="5337396">:</span><span class="num" id="5337397">0</span><span class="op" id="5337398">]</span><span class="op" id="5337399">,</span>&nbsp;<span class="ident" id="5337401">sub</span><span class="op" id="5337404">,</span>&nbsp;<span class="ident" id="5337406">suffix</span><span class="op" id="5337412">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337418">suffix</span>&nbsp;<span class="op" id="5337425">=</span>&nbsp;<span class="ident" id="5337427">simplify1</span><span class="op" id="5337436">(</span><span class="ident" id="5337437">OpQuest</span><span class="op" id="5337444">,</span>&nbsp;<span class="ident" id="5337446">re</span><span class="op" id="5337448">.</span><span class="ident" id="5337449">Flags</span><span class="op" id="5337454">,</span>&nbsp;<span class="ident" id="5337456">nre2</span><span class="op" id="5337460">,</span>&nbsp;<span class="ident" id="5337462">nil</span><span class="op" id="5337465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337475">if</span>&nbsp;<span class="ident" id="5337478">prefix</span>&nbsp;<span class="op" id="5337485">==</span>&nbsp;<span class="ident" id="5337488">nil</span>&nbsp;<span class="op" id="5337492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337498">return</span>&nbsp;<span class="ident" id="5337505">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337515">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5337520">prefix</span><span class="op" id="5337526">.</span><span class="ident" id="5337527">Sub</span>&nbsp;<span class="op" id="5337531">=</span>&nbsp;<span class="builtinfunc" id="5337533">append</span><span class="op" id="5337539">(</span><span class="ident" id="5337540">prefix</span><span class="op" id="5337546">.</span><span class="ident" id="5337547">Sub</span><span class="op" id="5337550">,</span>&nbsp;<span class="ident" id="5337552">suffix</span><span class="op" id="5337558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337566">if</span>&nbsp;<span class="ident" id="5337569">prefix</span>&nbsp;<span class="op" id="5337576">!=</span>&nbsp;<span class="ident" id="5337579">nil</span>&nbsp;<span class="op" id="5337583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337588">return</span>&nbsp;<span class="ident" id="5337595">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337604">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5337609">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5337668">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337701">return</span>&nbsp;<span class="op" id="5337708">&amp;</span><span class="ident" id="5337709">Regexp</span><span class="op" id="5337715">{</span><span class="ident" id="5337716">Op</span><span class="op" id="5337718">:</span>&nbsp;<span class="ident" id="5337720">OpNoMatch</span><span class="op" id="5337729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5337732">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5337736">return</span>&nbsp;<span class="ident" id="5337743">re</span><br>
<span class="lineno"></span><span class="op" id="5337746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5337749">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="5337804">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5337868">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5337885">//</span><br>
<span class="lineno"></span><span class="comment" id="5337888">//&nbsp;&nbsp;&nbsp;&nbspRegexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="5337932">//</span><br>
<span class="lineno">125</span><span class="comment" id="5337935">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5337991">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5338050">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="5338112">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5338135">//</span><br>
<span class="lineno">130</span><span class="comment" id="5338138">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5338206">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="5338264">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5338327">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="5338351">func</span>&nbsp;<span class="ident" id="5338356">simplify1</span><span class="op" id="5338365">(</span><span class="ident" id="5338366">op</span>&nbsp;<span class="ident" id="5338369">Op</span><span class="op" id="5338371">,</span>&nbsp;<span class="ident" id="5338373">flags</span>&nbsp;<span class="ident" id="5338379">Flags</span><span class="op" id="5338384">,</span>&nbsp;<span class="ident" id="5338386">sub</span><span class="op" id="5338389">,</span>&nbsp;<span class="ident" id="5338391">re</span>&nbsp;<span class="op" id="5338394">*</span><span class="ident" id="5338395">Regexp</span><span class="op" id="5338401">)</span>&nbsp;<span class="op" id="5338403">*</span><span class="ident" id="5338404">Regexp</span>&nbsp;<span class="op" id="5338411">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5338414">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5338467">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338514">if</span>&nbsp;<span class="ident" id="5338517">sub</span><span class="op" id="5338520">.</span><span class="ident" id="5338521">Op</span>&nbsp;<span class="op" id="5338524">==</span>&nbsp;<span class="ident" id="5338527">OpEmptyMatch</span>&nbsp;<span class="op" id="5338540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338544">return</span>&nbsp;<span class="ident" id="5338551">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5338556">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5338559">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338612">if</span>&nbsp;<span class="ident" id="5338615">op</span>&nbsp;<span class="op" id="5338618">==</span>&nbsp;<span class="ident" id="5338621">sub</span><span class="op" id="5338624">.</span><span class="ident" id="5338625">Op</span>&nbsp;<span class="op" id="5338628">&amp;&amp;</span>&nbsp;<span class="ident" id="5338631">flags</span><span class="op" id="5338636">&amp;</span><span class="ident" id="5338637">NonGreedy</span>&nbsp;<span class="op" id="5338647">==</span>&nbsp;<span class="ident" id="5338650">sub</span><span class="op" id="5338653">.</span><span class="ident" id="5338654">Flags</span><span class="op" id="5338659">&amp;</span><span class="ident" id="5338660">NonGreedy</span>&nbsp;<span class="op" id="5338670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338674">return</span>&nbsp;<span class="ident" id="5338681">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5338686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338689">if</span>&nbsp;<span class="ident" id="5338692">re</span>&nbsp;<span class="op" id="5338695">!=</span>&nbsp;<span class="ident" id="5338698">nil</span>&nbsp;<span class="op" id="5338702">&amp;&amp;</span>&nbsp;<span class="ident" id="5338705">re</span><span class="op" id="5338707">.</span><span class="ident" id="5338708">Op</span>&nbsp;<span class="op" id="5338711">==</span>&nbsp;<span class="ident" id="5338714">op</span>&nbsp;<span class="op" id="5338717">&amp;&amp;</span>&nbsp;<span class="ident" id="5338720">re</span><span class="op" id="5338722">.</span><span class="ident" id="5338723">Flags</span><span class="op" id="5338728">&amp;</span><span class="ident" id="5338729">NonGreedy</span>&nbsp;<span class="op" id="5338739">==</span>&nbsp;<span class="ident" id="5338742">flags</span><span class="op" id="5338747">&amp;</span><span class="ident" id="5338748">NonGreedy</span>&nbsp;<span class="op" id="5338758">&amp;&amp;</span>&nbsp;<span class="ident" id="5338761">sub</span>&nbsp;<span class="op" id="5338765">==</span>&nbsp;<span class="ident" id="5338768">re</span><span class="op" id="5338770">.</span><span class="ident" id="5338771">Sub</span><span class="op" id="5338774">[</span><span class="num" id="5338775">0</span><span class="op" id="5338776">]</span>&nbsp;<span class="op" id="5338778">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338782">return</span>&nbsp;<span class="ident" id="5338789">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5338793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5338797">re</span>&nbsp;<span class="op" id="5338800">=</span>&nbsp;<span class="op" id="5338802">&amp;</span><span class="ident" id="5338803">Regexp</span><span class="op" id="5338809">{</span><span class="ident" id="5338810">Op</span><span class="op" id="5338812">:</span>&nbsp;<span class="ident" id="5338814">op</span><span class="op" id="5338816">,</span>&nbsp;<span class="ident" id="5338818">Flags</span><span class="op" id="5338823">:</span>&nbsp;<span class="ident" id="5338825">flags</span><span class="op" id="5338830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5338833">re</span><span class="op" id="5338835">.</span><span class="ident" id="5338836">Sub</span>&nbsp;<span class="op" id="5338840">=</span>&nbsp;<span class="builtinfunc" id="5338842">append</span><span class="op" id="5338848">(</span><span class="ident" id="5338849">re</span><span class="op" id="5338851">.</span><span class="ident" id="5338852">Sub0</span><span class="op" id="5338856">[</span><span class="op" id="5338857">:</span><span class="num" id="5338858">0</span><span class="op" id="5338859">]</span><span class="op" id="5338860">,</span>&nbsp;<span class="ident" id="5338862">sub</span><span class="op" id="5338865">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5338868">return</span>&nbsp;<span class="ident" id="5338875">re</span><br>
<span class="lineno"></span><span class="op" id="5338878">}</span>
</div>
</body>
</html>
