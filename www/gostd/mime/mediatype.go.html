<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5220471">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5220526">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5220580">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5220631">package</span>&nbsp;<span class="ident" id="5220639">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5220645">import</span>&nbsp;<span class="op" id="5220652">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5220655">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5220664">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5220674">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5220681">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5220689">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5220700">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5220710">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5220713">//&nbsp;FormatMediaType&nbsp;serializes&nbsp;mediatype&nbsp;t&nbsp;and&nbsp;the&nbsp;parameters</span><br>
<span class="lineno"></span><span class="comment" id="5220774">//&nbsp;param&nbsp;as&nbsp;a&nbsp;media&nbsp;type&nbsp;conforming&nbsp;to&nbsp;RFC&nbsp;2045&nbsp;and&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="5220836">//&nbsp;The&nbsp;type&nbsp;and&nbsp;parameter&nbsp;names&nbsp;are&nbsp;written&nbsp;in&nbsp;lower-case.</span><br>
<span class="lineno"></span><span class="comment" id="5220895">//&nbsp;When&nbsp;any&nbsp;of&nbsp;the&nbsp;arguments&nbsp;result&nbsp;in&nbsp;a&nbsp;standard&nbsp;violation&nbsp;then</span><br>
<span class="lineno">20</span><span class="comment" id="5220960">//&nbsp;FormatMediaType&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5221005">func</span>&nbsp;<span class="ident" id="5221010">FormatMediaType</span><span class="op" id="5221025">(</span><span class="ident" id="5221026">t</span>&nbsp;<span class="builtintype" id="5221028">string</span><span class="op" id="5221034">,</span>&nbsp;<span class="ident" id="5221036">param</span>&nbsp;<span class="keyword" id="5221042">map</span><span class="op" id="5221045">[</span><span class="builtintype" id="5221046">string</span><span class="op" id="5221052">]</span><span class="builtintype" id="5221053">string</span><span class="op" id="5221059">)</span>&nbsp;<span class="builtintype" id="5221061">string</span>&nbsp;<span class="op" id="5221068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221071">slash</span>&nbsp;<span class="op" id="5221077">:=</span>&nbsp;<span class="ident" id="5221080">strings</span><span class="op" id="5221087">.</span><span class="ident" id="5221088">Index</span><span class="op" id="5221093">(</span><span class="ident" id="5221094">t</span><span class="op" id="5221095">,</span>&nbsp;<span class="string" id="5221097">&#34;/&#34;</span><span class="op" id="5221100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221103">if</span>&nbsp;<span class="ident" id="5221106">slash</span>&nbsp;<span class="op" id="5221112">==</span>&nbsp;<span class="op" id="5221115">-</span><span class="num" id="5221116">1</span>&nbsp;<span class="op" id="5221118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221122">return</span>&nbsp;<span class="string" id="5221129">&#34;&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221136">major</span><span class="op" id="5221141">,</span>&nbsp;<span class="ident" id="5221143">sub</span>&nbsp;<span class="op" id="5221147">:=</span>&nbsp;<span class="ident" id="5221150">t</span><span class="op" id="5221151">[</span><span class="op" id="5221152">:</span><span class="ident" id="5221153">slash</span><span class="op" id="5221158">]</span><span class="op" id="5221159">,</span>&nbsp;<span class="ident" id="5221161">t</span><span class="op" id="5221162">[</span><span class="ident" id="5221163">slash</span><span class="op" id="5221168">+</span><span class="num" id="5221169">1</span><span class="op" id="5221170">:</span><span class="op" id="5221171">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221174">if</span>&nbsp;<span class="op" id="5221177">!</span><span class="ident" id="5221178">isToken</span><span class="op" id="5221185">(</span><span class="ident" id="5221186">major</span><span class="op" id="5221191">)</span>&nbsp;<span class="op" id="5221193">||</span>&nbsp;<span class="op" id="5221196">!</span><span class="ident" id="5221197">isToken</span><span class="op" id="5221204">(</span><span class="ident" id="5221205">sub</span><span class="op" id="5221208">)</span>&nbsp;<span class="op" id="5221210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221214">return</span>&nbsp;<span class="string" id="5221221">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221225">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221228">var</span>&nbsp;<span class="ident" id="5221232">b</span>&nbsp;<span class="ident" id="5221234">bytes</span><span class="op" id="5221239">.</span><span class="ident" id="5221240">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221248">b</span><span class="op" id="5221249">.</span><span class="ident" id="5221250">WriteString</span><span class="op" id="5221261">(</span><span class="ident" id="5221262">strings</span><span class="op" id="5221269">.</span><span class="ident" id="5221270">ToLower</span><span class="op" id="5221277">(</span><span class="ident" id="5221278">major</span><span class="op" id="5221283">)</span><span class="op" id="5221284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221287">b</span><span class="op" id="5221288">.</span><span class="ident" id="5221289">WriteByte</span><span class="op" id="5221298">(</span><span class="string" id="5221299">&#39;/&#39;</span><span class="op" id="5221302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221305">b</span><span class="op" id="5221306">.</span><span class="ident" id="5221307">WriteString</span><span class="op" id="5221318">(</span><span class="ident" id="5221319">strings</span><span class="op" id="5221326">.</span><span class="ident" id="5221327">ToLower</span><span class="op" id="5221334">(</span><span class="ident" id="5221335">sub</span><span class="op" id="5221338">)</span><span class="op" id="5221339">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221343">attrs</span>&nbsp;<span class="op" id="5221349">:=</span>&nbsp;<span class="builtinfunc" id="5221352">make</span><span class="op" id="5221356">(</span><span class="op" id="5221357">[</span><span class="op" id="5221358">]</span><span class="builtintype" id="5221359">string</span><span class="op" id="5221365">,</span>&nbsp;<span class="num" id="5221367">0</span><span class="op" id="5221368">,</span>&nbsp;<span class="builtinfunc" id="5221370">len</span><span class="op" id="5221373">(</span><span class="ident" id="5221374">param</span><span class="op" id="5221379">)</span><span class="op" id="5221380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221383">for</span>&nbsp;<span class="ident" id="5221387">a</span>&nbsp;<span class="op" id="5221389">:=</span>&nbsp;<span class="keyword" id="5221392">range</span>&nbsp;<span class="ident" id="5221398">param</span>&nbsp;<span class="op" id="5221404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221408">attrs</span>&nbsp;<span class="op" id="5221414">=</span>&nbsp;<span class="builtinfunc" id="5221416">append</span><span class="op" id="5221422">(</span><span class="ident" id="5221423">attrs</span><span class="op" id="5221428">,</span>&nbsp;<span class="ident" id="5221430">a</span><span class="op" id="5221431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221437">sort</span><span class="op" id="5221441">.</span><span class="ident" id="5221442">Strings</span><span class="op" id="5221449">(</span><span class="ident" id="5221450">attrs</span><span class="op" id="5221455">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221459">for</span>&nbsp;<span class="ident" id="5221463">_</span><span class="op" id="5221464">,</span>&nbsp;<span class="ident" id="5221466">attribute</span>&nbsp;<span class="op" id="5221476">:=</span>&nbsp;<span class="keyword" id="5221479">range</span>&nbsp;<span class="ident" id="5221485">attrs</span>&nbsp;<span class="op" id="5221491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221495">value</span>&nbsp;<span class="op" id="5221501">:=</span>&nbsp;<span class="ident" id="5221504">param</span><span class="op" id="5221509">[</span><span class="ident" id="5221510">attribute</span><span class="op" id="5221519">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221523">b</span><span class="op" id="5221524">.</span><span class="ident" id="5221525">WriteByte</span><span class="op" id="5221534">(</span><span class="string" id="5221535">&#39;;&#39;</span><span class="op" id="5221538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221542">b</span><span class="op" id="5221543">.</span><span class="ident" id="5221544">WriteByte</span><span class="op" id="5221553">(</span><span class="string" id="5221554">&#39;&nbsp;&#39;</span><span class="op" id="5221557">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221561">if</span>&nbsp;<span class="op" id="5221564">!</span><span class="ident" id="5221565">isToken</span><span class="op" id="5221572">(</span><span class="ident" id="5221573">attribute</span><span class="op" id="5221582">)</span>&nbsp;<span class="op" id="5221584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221589">return</span>&nbsp;<span class="string" id="5221596">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221605">b</span><span class="op" id="5221606">.</span><span class="ident" id="5221607">WriteString</span><span class="op" id="5221618">(</span><span class="ident" id="5221619">strings</span><span class="op" id="5221626">.</span><span class="ident" id="5221627">ToLower</span><span class="op" id="5221634">(</span><span class="ident" id="5221635">attribute</span><span class="op" id="5221644">)</span><span class="op" id="5221645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221649">b</span><span class="op" id="5221650">.</span><span class="ident" id="5221651">WriteByte</span><span class="op" id="5221660">(</span><span class="string" id="5221661">&#39;=&#39;</span><span class="op" id="5221664">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221668">if</span>&nbsp;<span class="ident" id="5221671">isToken</span><span class="op" id="5221678">(</span><span class="ident" id="5221679">value</span><span class="op" id="5221684">)</span>&nbsp;<span class="op" id="5221686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221691">b</span><span class="op" id="5221692">.</span><span class="ident" id="5221693">WriteString</span><span class="op" id="5221704">(</span><span class="ident" id="5221705">value</span><span class="op" id="5221710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221715">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221731">b</span><span class="op" id="5221732">.</span><span class="ident" id="5221733">WriteByte</span><span class="op" id="5221742">(</span><span class="string" id="5221743">&#39;&#34;&#39;</span><span class="op" id="5221746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221750">offset</span>&nbsp;<span class="op" id="5221757">:=</span>&nbsp;<span class="num" id="5221760">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221764">for</span>&nbsp;<span class="ident" id="5221768">index</span><span class="op" id="5221773">,</span>&nbsp;<span class="ident" id="5221775">character</span>&nbsp;<span class="op" id="5221785">:=</span>&nbsp;<span class="keyword" id="5221788">range</span>&nbsp;<span class="ident" id="5221794">value</span>&nbsp;<span class="op" id="5221800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221805">if</span>&nbsp;<span class="ident" id="5221808">character</span>&nbsp;<span class="op" id="5221818">==</span>&nbsp;<span class="string" id="5221821">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="5221825">||</span>&nbsp;<span class="ident" id="5221828">character</span>&nbsp;<span class="op" id="5221838">==</span>&nbsp;<span class="string" id="5221841">&#39;\\&#39;</span>&nbsp;<span class="op" id="5221846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221852">b</span><span class="op" id="5221853">.</span><span class="ident" id="5221854">WriteString</span><span class="op" id="5221865">(</span><span class="ident" id="5221866">value</span><span class="op" id="5221871">[</span><span class="ident" id="5221872">offset</span><span class="op" id="5221878">:</span><span class="ident" id="5221879">index</span><span class="op" id="5221884">]</span><span class="op" id="5221885">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221891">offset</span>&nbsp;<span class="op" id="5221898">=</span>&nbsp;<span class="ident" id="5221900">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221910">b</span><span class="op" id="5221911">.</span><span class="ident" id="5221912">WriteByte</span><span class="op" id="5221921">(</span><span class="string" id="5221922">&#39;\\&#39;</span><span class="op" id="5221926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221936">if</span>&nbsp;<span class="ident" id="5221939">character</span><span class="op" id="5221948">&amp;</span><span class="num" id="5221949">0x80</span>&nbsp;<span class="op" id="5221954">!=</span>&nbsp;<span class="num" id="5221957">0</span>&nbsp;<span class="op" id="5221959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5221965">return</span>&nbsp;<span class="string" id="5221972">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5221982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5221986">b</span><span class="op" id="5221987">.</span><span class="ident" id="5221988">WriteString</span><span class="op" id="5221999">(</span><span class="ident" id="5222000">value</span><span class="op" id="5222005">[</span><span class="ident" id="5222006">offset</span><span class="op" id="5222012">:</span><span class="op" id="5222013">]</span><span class="op" id="5222014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222018">b</span><span class="op" id="5222019">.</span><span class="ident" id="5222020">WriteByte</span><span class="op" id="5222029">(</span><span class="string" id="5222030">&#39;&#34;&#39;</span><span class="op" id="5222033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222036">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222039">return</span>&nbsp;<span class="ident" id="5222046">b</span><span class="op" id="5222047">.</span><span class="ident" id="5222048">String</span><span class="op" id="5222054">(</span><span class="op" id="5222055">)</span><br>
<span class="lineno"></span><span class="op" id="5222057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5222060">func</span>&nbsp;<span class="ident" id="5222065">checkMediaTypeDisposition</span><span class="op" id="5222090">(</span><span class="ident" id="5222091">s</span>&nbsp;<span class="builtintype" id="5222093">string</span><span class="op" id="5222099">)</span>&nbsp;<span class="builtintype" id="5222101">error</span>&nbsp;<span class="op" id="5222107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222110">typ</span><span class="op" id="5222113">,</span>&nbsp;<span class="ident" id="5222115">rest</span>&nbsp;<span class="op" id="5222120">:=</span>&nbsp;<span class="ident" id="5222123">consumeToken</span><span class="op" id="5222135">(</span><span class="ident" id="5222136">s</span><span class="op" id="5222137">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222140">if</span>&nbsp;<span class="ident" id="5222143">typ</span>&nbsp;<span class="op" id="5222147">==</span>&nbsp;<span class="string" id="5222150">&#34;&#34;</span>&nbsp;<span class="op" id="5222153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222157">return</span>&nbsp;<span class="ident" id="5222164">errors</span><span class="op" id="5222170">.</span><span class="ident" id="5222171">New</span><span class="op" id="5222174">(</span><span class="string" id="5222175">&#34;mime:&nbsp;no&nbsp;media&nbsp;type&#34;</span><span class="op" id="5222196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222202">if</span>&nbsp;<span class="ident" id="5222205">rest</span>&nbsp;<span class="op" id="5222210">==</span>&nbsp;<span class="string" id="5222213">&#34;&#34;</span>&nbsp;<span class="op" id="5222216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222220">return</span>&nbsp;<span class="ident" id="5222227">nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222235">if</span>&nbsp;<span class="op" id="5222238">!</span><span class="ident" id="5222239">strings</span><span class="op" id="5222246">.</span><span class="ident" id="5222247">HasPrefix</span><span class="op" id="5222256">(</span><span class="ident" id="5222257">rest</span><span class="op" id="5222261">,</span>&nbsp;<span class="string" id="5222263">&#34;/&#34;</span><span class="op" id="5222266">)</span>&nbsp;<span class="op" id="5222268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222272">return</span>&nbsp;<span class="ident" id="5222279">errors</span><span class="op" id="5222285">.</span><span class="ident" id="5222286">New</span><span class="op" id="5222289">(</span><span class="string" id="5222290">&#34;mime:&nbsp;expected&nbsp;slash&nbsp;after&nbsp;first&nbsp;token&#34;</span><span class="op" id="5222330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222336">subtype</span><span class="op" id="5222343">,</span>&nbsp;<span class="ident" id="5222345">rest</span>&nbsp;<span class="op" id="5222350">:=</span>&nbsp;<span class="ident" id="5222353">consumeToken</span><span class="op" id="5222365">(</span><span class="ident" id="5222366">rest</span><span class="op" id="5222370">[</span><span class="num" id="5222371">1</span><span class="op" id="5222372">:</span><span class="op" id="5222373">]</span><span class="op" id="5222374">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222377">if</span>&nbsp;<span class="ident" id="5222380">subtype</span>&nbsp;<span class="op" id="5222388">==</span>&nbsp;<span class="string" id="5222391">&#34;&#34;</span>&nbsp;<span class="op" id="5222394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222398">return</span>&nbsp;<span class="ident" id="5222405">errors</span><span class="op" id="5222411">.</span><span class="ident" id="5222412">New</span><span class="op" id="5222415">(</span><span class="string" id="5222416">&#34;mime:&nbsp;expected&nbsp;token&nbsp;after&nbsp;slash&#34;</span><span class="op" id="5222450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222456">if</span>&nbsp;<span class="ident" id="5222459">rest</span>&nbsp;<span class="op" id="5222464">!=</span>&nbsp;<span class="string" id="5222467">&#34;&#34;</span>&nbsp;<span class="op" id="5222470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222474">return</span>&nbsp;<span class="ident" id="5222481">errors</span><span class="op" id="5222487">.</span><span class="ident" id="5222488">New</span><span class="op" id="5222491">(</span><span class="string" id="5222492">&#34;mime:&nbsp;unexpected&nbsp;content&nbsp;after&nbsp;media&nbsp;subtype&#34;</span><span class="op" id="5222538">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222544">return</span>&nbsp;<span class="ident" id="5222551">nil</span><br>
<span class="lineno"></span><span class="op" id="5222555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5222558">//&nbsp;ParseMediaType&nbsp;parses&nbsp;a&nbsp;media&nbsp;type&nbsp;value&nbsp;and&nbsp;any&nbsp;optional</span><br>
<span class="lineno">95</span><span class="comment" id="5222619">//&nbsp;parameters,&nbsp;per&nbsp;RFC&nbsp;1521.&nbsp;&nbsp;Media&nbsp;types&nbsp;are&nbsp;the&nbsp;values&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5222679">//&nbsp;Content-Type&nbsp;and&nbsp;Content-Disposition&nbsp;headers&nbsp;(RFC&nbsp;2183).</span><br>
<span class="lineno"></span><span class="comment" id="5222739">//&nbsp;On&nbsp;success,&nbsp;ParseMediaType&nbsp;returns&nbsp;the&nbsp;media&nbsp;type&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5222802">//&nbsp;to&nbsp;lowercase&nbsp;and&nbsp;trimmed&nbsp;of&nbsp;white&nbsp;space&nbsp;and&nbsp;a&nbsp;non-nil&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5222864">//&nbsp;The&nbsp;returned&nbsp;map,&nbsp;params,&nbsp;maps&nbsp;from&nbsp;the&nbsp;lowercase</span><br>
<span class="lineno">100</span><span class="comment" id="5222917">//&nbsp;attribute&nbsp;to&nbsp;the&nbsp;attribute&nbsp;value&nbsp;with&nbsp;its&nbsp;case&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="keyword" id="5222978">func</span>&nbsp;<span class="ident" id="5222983">ParseMediaType</span><span class="op" id="5222997">(</span><span class="ident" id="5222998">v</span>&nbsp;<span class="builtintype" id="5223000">string</span><span class="op" id="5223006">)</span>&nbsp;<span class="op" id="5223008">(</span><span class="ident" id="5223009">mediatype</span>&nbsp;<span class="builtintype" id="5223019">string</span><span class="op" id="5223025">,</span>&nbsp;<span class="ident" id="5223027">params</span>&nbsp;<span class="keyword" id="5223034">map</span><span class="op" id="5223037">[</span><span class="builtintype" id="5223038">string</span><span class="op" id="5223044">]</span><span class="builtintype" id="5223045">string</span><span class="op" id="5223051">,</span>&nbsp;<span class="ident" id="5223053">err</span>&nbsp;<span class="builtintype" id="5223057">error</span><span class="op" id="5223062">)</span>&nbsp;<span class="op" id="5223064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223067">i</span>&nbsp;<span class="op" id="5223069">:=</span>&nbsp;<span class="ident" id="5223072">strings</span><span class="op" id="5223079">.</span><span class="ident" id="5223080">Index</span><span class="op" id="5223085">(</span><span class="ident" id="5223086">v</span><span class="op" id="5223087">,</span>&nbsp;<span class="string" id="5223089">&#34;;&#34;</span><span class="op" id="5223092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223095">if</span>&nbsp;<span class="ident" id="5223098">i</span>&nbsp;<span class="op" id="5223100">==</span>&nbsp;<span class="op" id="5223103">-</span><span class="num" id="5223104">1</span>&nbsp;<span class="op" id="5223106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223110">i</span>&nbsp;<span class="op" id="5223112">=</span>&nbsp;<span class="builtinfunc" id="5223114">len</span><span class="op" id="5223117">(</span><span class="ident" id="5223118">v</span><span class="op" id="5223119">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5223122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223125">mediatype</span>&nbsp;<span class="op" id="5223135">=</span>&nbsp;<span class="ident" id="5223137">strings</span><span class="op" id="5223144">.</span><span class="ident" id="5223145">TrimSpace</span><span class="op" id="5223154">(</span><span class="ident" id="5223155">strings</span><span class="op" id="5223162">.</span><span class="ident" id="5223163">ToLower</span><span class="op" id="5223170">(</span><span class="ident" id="5223171">v</span><span class="op" id="5223172">[</span><span class="num" id="5223173">0</span><span class="op" id="5223174">:</span><span class="ident" id="5223175">i</span><span class="op" id="5223176">]</span><span class="op" id="5223177">)</span><span class="op" id="5223178">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223182">err</span>&nbsp;<span class="op" id="5223186">=</span>&nbsp;<span class="ident" id="5223188">checkMediaTypeDisposition</span><span class="op" id="5223213">(</span><span class="ident" id="5223214">mediatype</span><span class="op" id="5223223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223226">if</span>&nbsp;<span class="ident" id="5223229">err</span>&nbsp;<span class="op" id="5223233">!=</span>&nbsp;<span class="ident" id="5223236">nil</span>&nbsp;<span class="op" id="5223240">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223244">return</span>&nbsp;<span class="string" id="5223251">&#34;&#34;</span><span class="op" id="5223253">,</span>&nbsp;<span class="ident" id="5223255">nil</span><span class="op" id="5223258">,</span>&nbsp;<span class="ident" id="5223260">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5223265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223269">params</span>&nbsp;<span class="op" id="5223276">=</span>&nbsp;<span class="builtinfunc" id="5223278">make</span><span class="op" id="5223282">(</span><span class="keyword" id="5223283">map</span><span class="op" id="5223286">[</span><span class="builtintype" id="5223287">string</span><span class="op" id="5223293">]</span><span class="builtintype" id="5223294">string</span><span class="op" id="5223300">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5223304">//&nbsp;Map&nbsp;of&nbsp;base&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5223362">//&nbsp;for&nbsp;parameters&nbsp;containing&nbsp;a&nbsp;&#39;*&#39;&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5223409">//&nbsp;Lazily&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223433">var</span>&nbsp;<span class="ident" id="5223437">continuation</span>&nbsp;<span class="keyword" id="5223450">map</span><span class="op" id="5223453">[</span><span class="builtintype" id="5223454">string</span><span class="op" id="5223460">]</span><span class="keyword" id="5223461">map</span><span class="op" id="5223464">[</span><span class="builtintype" id="5223465">string</span><span class="op" id="5223471">]</span><span class="builtintype" id="5223472">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223481">v</span>&nbsp;<span class="op" id="5223483">=</span>&nbsp;<span class="ident" id="5223485">v</span><span class="op" id="5223486">[</span><span class="ident" id="5223487">i</span><span class="op" id="5223488">:</span><span class="op" id="5223489">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223492">for</span>&nbsp;<span class="builtinfunc" id="5223496">len</span><span class="op" id="5223499">(</span><span class="ident" id="5223500">v</span><span class="op" id="5223501">)</span>&nbsp;<span class="op" id="5223503">&gt;</span>&nbsp;<span class="num" id="5223505">0</span>&nbsp;<span class="op" id="5223507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223511">v</span>&nbsp;<span class="op" id="5223513">=</span>&nbsp;<span class="ident" id="5223515">strings</span><span class="op" id="5223522">.</span><span class="ident" id="5223523">TrimLeftFunc</span><span class="op" id="5223535">(</span><span class="ident" id="5223536">v</span><span class="op" id="5223537">,</span>&nbsp;<span class="ident" id="5223539">unicode</span><span class="op" id="5223546">.</span><span class="ident" id="5223547">IsSpace</span><span class="op" id="5223554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223558">if</span>&nbsp;<span class="builtinfunc" id="5223561">len</span><span class="op" id="5223564">(</span><span class="ident" id="5223565">v</span><span class="op" id="5223566">)</span>&nbsp;<span class="op" id="5223568">==</span>&nbsp;<span class="num" id="5223571">0</span>&nbsp;<span class="op" id="5223573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223578">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5223586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223590">key</span><span class="op" id="5223593">,</span>&nbsp;<span class="ident" id="5223595">value</span><span class="op" id="5223600">,</span>&nbsp;<span class="ident" id="5223602">rest</span>&nbsp;<span class="op" id="5223607">:=</span>&nbsp;<span class="ident" id="5223610">consumeMediaParam</span><span class="op" id="5223627">(</span><span class="ident" id="5223628">v</span><span class="op" id="5223629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223633">if</span>&nbsp;<span class="ident" id="5223636">key</span>&nbsp;<span class="op" id="5223640">==</span>&nbsp;<span class="string" id="5223643">&#34;&#34;</span>&nbsp;<span class="op" id="5223646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223651">if</span>&nbsp;<span class="ident" id="5223654">strings</span><span class="op" id="5223661">.</span><span class="ident" id="5223662">TrimSpace</span><span class="op" id="5223671">(</span><span class="ident" id="5223672">rest</span><span class="op" id="5223676">)</span>&nbsp;<span class="op" id="5223678">==</span>&nbsp;<span class="string" id="5223681">&#34;;&#34;</span>&nbsp;<span class="op" id="5223685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5223691">//&nbsp;Ignore&nbsp;trailing&nbsp;semicolons.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5223726">//&nbsp;Not&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223747">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5223757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5223762">//&nbsp;Parse&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223781">return</span>&nbsp;<span class="string" id="5223788">&#34;&#34;</span><span class="op" id="5223790">,</span>&nbsp;<span class="ident" id="5223792">nil</span><span class="op" id="5223795">,</span>&nbsp;<span class="ident" id="5223797">errors</span><span class="op" id="5223803">.</span><span class="ident" id="5223804">New</span><span class="op" id="5223807">(</span><span class="string" id="5223808">&#34;mime:&nbsp;invalid&nbsp;media&nbsp;parameter&#34;</span><span class="op" id="5223839">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5223843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223848">pmap</span>&nbsp;<span class="op" id="5223853">:=</span>&nbsp;<span class="ident" id="5223856">params</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223865">if</span>&nbsp;<span class="ident" id="5223868">idx</span>&nbsp;<span class="op" id="5223872">:=</span>&nbsp;<span class="ident" id="5223875">strings</span><span class="op" id="5223882">.</span><span class="ident" id="5223883">Index</span><span class="op" id="5223888">(</span><span class="ident" id="5223889">key</span><span class="op" id="5223892">,</span>&nbsp;<span class="string" id="5223894">&#34;*&#34;</span><span class="op" id="5223897">)</span><span class="op" id="5223898">;</span>&nbsp;<span class="ident" id="5223900">idx</span>&nbsp;<span class="op" id="5223904">!=</span>&nbsp;<span class="op" id="5223907">-</span><span class="num" id="5223908">1</span>&nbsp;<span class="op" id="5223910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223915">baseName</span>&nbsp;<span class="op" id="5223924">:=</span>&nbsp;<span class="ident" id="5223927">key</span><span class="op" id="5223930">[</span><span class="op" id="5223931">:</span><span class="ident" id="5223932">idx</span><span class="op" id="5223935">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223940">if</span>&nbsp;<span class="ident" id="5223943">continuation</span>&nbsp;<span class="op" id="5223956">==</span>&nbsp;<span class="ident" id="5223959">nil</span>&nbsp;<span class="op" id="5223963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223969">continuation</span>&nbsp;<span class="op" id="5223982">=</span>&nbsp;<span class="builtinfunc" id="5223984">make</span><span class="op" id="5223988">(</span><span class="keyword" id="5223989">map</span><span class="op" id="5223992">[</span><span class="builtintype" id="5223993">string</span><span class="op" id="5223999">]</span><span class="keyword" id="5224000">map</span><span class="op" id="5224003">[</span><span class="builtintype" id="5224004">string</span><span class="op" id="5224010">]</span><span class="builtintype" id="5224011">string</span><span class="op" id="5224017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224027">var</span>&nbsp;<span class="ident" id="5224031">ok</span>&nbsp;<span class="builtintype" id="5224034">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224042">if</span>&nbsp;<span class="ident" id="5224045">pmap</span><span class="op" id="5224049">,</span>&nbsp;<span class="ident" id="5224051">ok</span>&nbsp;<span class="op" id="5224054">=</span>&nbsp;<span class="ident" id="5224056">continuation</span><span class="op" id="5224068">[</span><span class="ident" id="5224069">baseName</span><span class="op" id="5224077">]</span><span class="op" id="5224078">;</span>&nbsp;<span class="op" id="5224080">!</span><span class="ident" id="5224081">ok</span>&nbsp;<span class="op" id="5224084">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224090">continuation</span><span class="op" id="5224102">[</span><span class="ident" id="5224103">baseName</span><span class="op" id="5224111">]</span>&nbsp;<span class="op" id="5224113">=</span>&nbsp;<span class="builtinfunc" id="5224115">make</span><span class="op" id="5224119">(</span><span class="keyword" id="5224120">map</span><span class="op" id="5224123">[</span><span class="builtintype" id="5224124">string</span><span class="op" id="5224130">]</span><span class="builtintype" id="5224131">string</span><span class="op" id="5224137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224143">pmap</span>&nbsp;<span class="op" id="5224148">=</span>&nbsp;<span class="ident" id="5224150">continuation</span><span class="op" id="5224162">[</span><span class="ident" id="5224163">baseName</span><span class="op" id="5224171">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224184">if</span>&nbsp;<span class="ident" id="5224187">_</span><span class="op" id="5224188">,</span>&nbsp;<span class="ident" id="5224190">exists</span>&nbsp;<span class="op" id="5224197">:=</span>&nbsp;<span class="ident" id="5224200">pmap</span><span class="op" id="5224204">[</span><span class="ident" id="5224205">key</span><span class="op" id="5224208">]</span><span class="op" id="5224209">;</span>&nbsp;<span class="ident" id="5224211">exists</span>&nbsp;<span class="op" id="5224218">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5224223">//&nbsp;Duplicate&nbsp;parameter&nbsp;name&nbsp;is&nbsp;bogus.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224264">return</span>&nbsp;<span class="string" id="5224271">&#34;&#34;</span><span class="op" id="5224273">,</span>&nbsp;<span class="ident" id="5224275">nil</span><span class="op" id="5224278">,</span>&nbsp;<span class="ident" id="5224280">errors</span><span class="op" id="5224286">.</span><span class="ident" id="5224287">New</span><span class="op" id="5224290">(</span><span class="string" id="5224291">&#34;mime:&nbsp;duplicate&nbsp;parameter&nbsp;name&#34;</span><span class="op" id="5224323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224331">pmap</span><span class="op" id="5224335">[</span><span class="ident" id="5224336">key</span><span class="op" id="5224339">]</span>&nbsp;<span class="op" id="5224341">=</span>&nbsp;<span class="ident" id="5224343">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224351">v</span>&nbsp;<span class="op" id="5224353">=</span>&nbsp;<span class="ident" id="5224355">rest</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5224365">//&nbsp;Stitch&nbsp;together&nbsp;any&nbsp;continuations&nbsp;or&nbsp;things&nbsp;with&nbsp;stars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5224424">//&nbsp;(i.e.&nbsp;RFC&nbsp;2231&nbsp;things&nbsp;with&nbsp;stars:&nbsp;&#34;foo*0&#34;&nbsp;or&nbsp;&#34;foo*&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224481">var</span>&nbsp;<span class="ident" id="5224485">buf</span>&nbsp;<span class="ident" id="5224489">bytes</span><span class="op" id="5224494">.</span><span class="ident" id="5224495">Buffer</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224503">for</span>&nbsp;<span class="ident" id="5224507">key</span><span class="op" id="5224510">,</span>&nbsp;<span class="ident" id="5224512">pieceMap</span>&nbsp;<span class="op" id="5224521">:=</span>&nbsp;<span class="keyword" id="5224524">range</span>&nbsp;<span class="ident" id="5224530">continuation</span>&nbsp;<span class="op" id="5224543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224547">singlePartKey</span>&nbsp;<span class="op" id="5224561">:=</span>&nbsp;<span class="ident" id="5224564">key</span>&nbsp;<span class="op" id="5224568">+</span>&nbsp;<span class="string" id="5224570">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224576">if</span>&nbsp;<span class="ident" id="5224579">v</span><span class="op" id="5224580">,</span>&nbsp;<span class="ident" id="5224582">ok</span>&nbsp;<span class="op" id="5224585">:=</span>&nbsp;<span class="ident" id="5224588">pieceMap</span><span class="op" id="5224596">[</span><span class="ident" id="5224597">singlePartKey</span><span class="op" id="5224610">]</span><span class="op" id="5224611">;</span>&nbsp;<span class="ident" id="5224613">ok</span>&nbsp;<span class="op" id="5224616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224621">decv</span>&nbsp;<span class="op" id="5224626">:=</span>&nbsp;<span class="ident" id="5224629">decode2231Enc</span><span class="op" id="5224642">(</span><span class="ident" id="5224643">v</span><span class="op" id="5224644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224649">params</span><span class="op" id="5224655">[</span><span class="ident" id="5224656">key</span><span class="op" id="5224659">]</span>&nbsp;<span class="op" id="5224661">=</span>&nbsp;<span class="ident" id="5224663">decv</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224671">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224687">buf</span><span class="op" id="5224690">.</span><span class="ident" id="5224691">Reset</span><span class="op" id="5224696">(</span><span class="op" id="5224697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224701">valid</span>&nbsp;<span class="op" id="5224707">:=</span>&nbsp;<span class="builtintype" id="5224710">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224718">for</span>&nbsp;<span class="ident" id="5224722">n</span>&nbsp;<span class="op" id="5224724">:=</span>&nbsp;<span class="num" id="5224727">0</span><span class="op" id="5224728">;</span>&nbsp;<span class="op" id="5224730">;</span>&nbsp;<span class="ident" id="5224732">n</span><span class="op" id="5224733">++</span>&nbsp;<span class="op" id="5224736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224741">simplePart</span>&nbsp;<span class="op" id="5224752">:=</span>&nbsp;<span class="ident" id="5224755">fmt</span><span class="op" id="5224758">.</span><span class="ident" id="5224759">Sprintf</span><span class="op" id="5224766">(</span><span class="string" id="5224767">&#34;%s*%d&#34;</span><span class="op" id="5224774">,</span>&nbsp;<span class="ident" id="5224776">key</span><span class="op" id="5224779">,</span>&nbsp;<span class="ident" id="5224781">n</span><span class="op" id="5224782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224787">if</span>&nbsp;<span class="ident" id="5224790">v</span><span class="op" id="5224791">,</span>&nbsp;<span class="ident" id="5224793">ok</span>&nbsp;<span class="op" id="5224796">:=</span>&nbsp;<span class="ident" id="5224799">pieceMap</span><span class="op" id="5224807">[</span><span class="ident" id="5224808">simplePart</span><span class="op" id="5224818">]</span><span class="op" id="5224819">;</span>&nbsp;<span class="ident" id="5224821">ok</span>&nbsp;<span class="op" id="5224824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224830">valid</span>&nbsp;<span class="op" id="5224836">=</span>&nbsp;<span class="builtintype" id="5224838">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224847">buf</span><span class="op" id="5224850">.</span><span class="ident" id="5224851">WriteString</span><span class="op" id="5224862">(</span><span class="ident" id="5224863">v</span><span class="op" id="5224864">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224870">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224887">encodedPart</span>&nbsp;<span class="op" id="5224899">:=</span>&nbsp;<span class="ident" id="5224902">simplePart</span>&nbsp;<span class="op" id="5224913">+</span>&nbsp;<span class="string" id="5224915">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224922">if</span>&nbsp;<span class="ident" id="5224925">v</span><span class="op" id="5224926">,</span>&nbsp;<span class="ident" id="5224928">ok</span>&nbsp;<span class="op" id="5224931">:=</span>&nbsp;<span class="ident" id="5224934">pieceMap</span><span class="op" id="5224942">[</span><span class="ident" id="5224943">encodedPart</span><span class="op" id="5224954">]</span><span class="op" id="5224955">;</span>&nbsp;<span class="ident" id="5224957">ok</span>&nbsp;<span class="op" id="5224960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224966">valid</span>&nbsp;<span class="op" id="5224972">=</span>&nbsp;<span class="builtintype" id="5224974">true</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224983">if</span>&nbsp;<span class="ident" id="5224986">n</span>&nbsp;<span class="op" id="5224988">==</span>&nbsp;<span class="num" id="5224991">0</span>&nbsp;<span class="op" id="5224993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225000">buf</span><span class="op" id="5225003">.</span><span class="ident" id="5225004">WriteString</span><span class="op" id="5225015">(</span><span class="ident" id="5225016">decode2231Enc</span><span class="op" id="5225029">(</span><span class="ident" id="5225030">v</span><span class="op" id="5225031">)</span><span class="op" id="5225032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225038">}</span>&nbsp;<span class="keyword" id="5225040">else</span>&nbsp;<span class="op" id="5225045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225052">decv</span><span class="op" id="5225056">,</span>&nbsp;<span class="ident" id="5225058">_</span>&nbsp;<span class="op" id="5225060">:=</span>&nbsp;<span class="ident" id="5225063">percentHexUnescape</span><span class="op" id="5225081">(</span><span class="ident" id="5225082">v</span><span class="op" id="5225083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225090">buf</span><span class="op" id="5225093">.</span><span class="ident" id="5225094">WriteString</span><span class="op" id="5225105">(</span><span class="ident" id="5225106">decv</span><span class="op" id="5225110">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225121">}</span>&nbsp;<span class="keyword" id="5225123">else</span>&nbsp;<span class="op" id="5225128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225134">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225147">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225151">if</span>&nbsp;<span class="ident" id="5225154">valid</span>&nbsp;<span class="op" id="5225160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225165">params</span><span class="op" id="5225171">[</span><span class="ident" id="5225172">key</span><span class="op" id="5225175">]</span>&nbsp;<span class="op" id="5225177">=</span>&nbsp;<span class="ident" id="5225179">buf</span><span class="op" id="5225182">.</span><span class="ident" id="5225183">String</span><span class="op" id="5225189">(</span><span class="op" id="5225190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225201">return</span><br>
<span class="lineno"></span><span class="op" id="5225208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5225211">func</span>&nbsp;<span class="ident" id="5225216">decode2231Enc</span><span class="op" id="5225229">(</span><span class="ident" id="5225230">v</span>&nbsp;<span class="builtintype" id="5225232">string</span><span class="op" id="5225238">)</span>&nbsp;<span class="builtintype" id="5225240">string</span>&nbsp;<span class="op" id="5225247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225250">sv</span>&nbsp;<span class="op" id="5225253">:=</span>&nbsp;<span class="ident" id="5225256">strings</span><span class="op" id="5225263">.</span><span class="ident" id="5225264">SplitN</span><span class="op" id="5225270">(</span><span class="ident" id="5225271">v</span><span class="op" id="5225272">,</span>&nbsp;<span class="string" id="5225274">&#34;&#39;&#34;</span><span class="op" id="5225277">,</span>&nbsp;<span class="num" id="5225279">3</span><span class="op" id="5225280">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225283">if</span>&nbsp;<span class="builtinfunc" id="5225286">len</span><span class="op" id="5225289">(</span><span class="ident" id="5225290">sv</span><span class="op" id="5225292">)</span>&nbsp;<span class="op" id="5225294">!=</span>&nbsp;<span class="num" id="5225297">3</span>&nbsp;<span class="op" id="5225299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225303">return</span>&nbsp;<span class="string" id="5225310">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225317">//&nbsp;TODO:&nbsp;ignoring&nbsp;lang&nbsp;in&nbsp;sv[1]&nbsp;for&nbsp;now.&nbsp;If&nbsp;anybody&nbsp;needs&nbsp;it&nbsp;we&#39;ll</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225385">//&nbsp;need&nbsp;to&nbsp;decide&nbsp;how&nbsp;to&nbsp;expose&nbsp;it&nbsp;in&nbsp;the&nbsp;API.&nbsp;But&nbsp;I&#39;m&nbsp;not&nbsp;sure</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225450">//&nbsp;anybody&nbsp;uses&nbsp;it&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225483">charset</span>&nbsp;<span class="op" id="5225491">:=</span>&nbsp;<span class="ident" id="5225494">strings</span><span class="op" id="5225501">.</span><span class="ident" id="5225502">ToLower</span><span class="op" id="5225509">(</span><span class="ident" id="5225510">sv</span><span class="op" id="5225512">[</span><span class="num" id="5225513">0</span><span class="op" id="5225514">]</span><span class="op" id="5225515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225518">if</span>&nbsp;<span class="ident" id="5225521">charset</span>&nbsp;<span class="op" id="5225529">!=</span>&nbsp;<span class="string" id="5225532">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="5225543">&amp;&amp;</span>&nbsp;<span class="ident" id="5225546">charset</span>&nbsp;<span class="op" id="5225554">!=</span>&nbsp;<span class="string" id="5225557">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="5225565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225569">//&nbsp;TODO:&nbsp;unsupported&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225601">return</span>&nbsp;<span class="string" id="5225608">&#34;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225615">encv</span><span class="op" id="5225619">,</span>&nbsp;<span class="ident" id="5225621">_</span>&nbsp;<span class="op" id="5225623">:=</span>&nbsp;<span class="ident" id="5225626">percentHexUnescape</span><span class="op" id="5225644">(</span><span class="ident" id="5225645">sv</span><span class="op" id="5225647">[</span><span class="num" id="5225648">2</span><span class="op" id="5225649">]</span><span class="op" id="5225650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225653">return</span>&nbsp;<span class="ident" id="5225660">encv</span><br>
<span class="lineno"></span><span class="op" id="5225665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="5225668">func</span>&nbsp;<span class="ident" id="5225673">isNotTokenChar</span><span class="op" id="5225687">(</span><span class="ident" id="5225688">r</span>&nbsp;<span class="builtintype" id="5225690">rune</span><span class="op" id="5225694">)</span>&nbsp;<span class="builtintype" id="5225696">bool</span>&nbsp;<span class="op" id="5225701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225704">return</span>&nbsp;<span class="op" id="5225711">!</span><span class="ident" id="5225712">isTokenChar</span><span class="op" id="5225723">(</span><span class="ident" id="5225724">r</span><span class="op" id="5225725">)</span><br>
<span class="lineno"></span><span class="op" id="5225727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5225730">//&nbsp;consumeToken&nbsp;consumes&nbsp;a&nbsp;token&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;provided</span><br>
<span class="lineno">220</span><span class="comment" id="5225794">//&nbsp;string,&nbsp;per&nbsp;RFC&nbsp;2045&nbsp;section&nbsp;5.1&nbsp;(referenced&nbsp;from&nbsp;2183),&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5225865">//&nbsp;the&nbsp;token&nbsp;consumed&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;Returns&nbsp;(&#34;&#34;,&nbsp;v)&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5225935">//&nbsp;failure&nbsp;to&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="5225981">func</span>&nbsp;<span class="ident" id="5225986">consumeToken</span><span class="op" id="5225998">(</span><span class="ident" id="5225999">v</span>&nbsp;<span class="builtintype" id="5226001">string</span><span class="op" id="5226007">)</span>&nbsp;<span class="op" id="5226009">(</span><span class="ident" id="5226010">token</span><span class="op" id="5226015">,</span>&nbsp;<span class="ident" id="5226017">rest</span>&nbsp;<span class="builtintype" id="5226022">string</span><span class="op" id="5226028">)</span>&nbsp;<span class="op" id="5226030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226033">notPos</span>&nbsp;<span class="op" id="5226040">:=</span>&nbsp;<span class="ident" id="5226043">strings</span><span class="op" id="5226050">.</span><span class="ident" id="5226051">IndexFunc</span><span class="op" id="5226060">(</span><span class="ident" id="5226061">v</span><span class="op" id="5226062">,</span>&nbsp;<span class="ident" id="5226064">isNotTokenChar</span><span class="op" id="5226078">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226081">if</span>&nbsp;<span class="ident" id="5226084">notPos</span>&nbsp;<span class="op" id="5226091">==</span>&nbsp;<span class="op" id="5226094">-</span><span class="num" id="5226095">1</span>&nbsp;<span class="op" id="5226097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226101">return</span>&nbsp;<span class="ident" id="5226108">v</span><span class="op" id="5226109">,</span>&nbsp;<span class="string" id="5226111">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226118">if</span>&nbsp;<span class="ident" id="5226121">notPos</span>&nbsp;<span class="op" id="5226128">==</span>&nbsp;<span class="num" id="5226131">0</span>&nbsp;<span class="op" id="5226133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226137">return</span>&nbsp;<span class="string" id="5226144">&#34;&#34;</span><span class="op" id="5226146">,</span>&nbsp;<span class="ident" id="5226148">v</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226154">return</span>&nbsp;<span class="ident" id="5226161">v</span><span class="op" id="5226162">[</span><span class="num" id="5226163">0</span><span class="op" id="5226164">:</span><span class="ident" id="5226165">notPos</span><span class="op" id="5226171">]</span><span class="op" id="5226172">,</span>&nbsp;<span class="ident" id="5226174">v</span><span class="op" id="5226175">[</span><span class="ident" id="5226176">notPos</span><span class="op" id="5226182">:</span><span class="op" id="5226183">]</span><br>
<span class="lineno"></span><span class="op" id="5226185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5226188">//&nbsp;consumeValue&nbsp;consumes&nbsp;a&nbsp;&#34;value&#34;&nbsp;per&nbsp;RFC&nbsp;2045,&nbsp;where&nbsp;a&nbsp;value&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="5226254">//&nbsp;either&nbsp;a&nbsp;&#39;token&#39;&nbsp;or&nbsp;a&nbsp;&#39;quoted-string&#39;.&nbsp;&nbsp;On&nbsp;success,&nbsp;consumeValue</span><br>
<span class="lineno"></span><span class="comment" id="5226322">//&nbsp;returns&nbsp;the&nbsp;value&nbsp;consumed&nbsp;(and&nbsp;de-quoted/escaped,&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5226381">//&nbsp;quoted-string)&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;On&nbsp;failure,&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5226448">//&nbsp;(&#34;&#34;,&nbsp;v).</span><br>
<span class="lineno"></span><span class="keyword" id="5226460">func</span>&nbsp;<span class="ident" id="5226465">consumeValue</span><span class="op" id="5226477">(</span><span class="ident" id="5226478">v</span>&nbsp;<span class="builtintype" id="5226480">string</span><span class="op" id="5226486">)</span>&nbsp;<span class="op" id="5226488">(</span><span class="ident" id="5226489">value</span><span class="op" id="5226494">,</span>&nbsp;<span class="ident" id="5226496">rest</span>&nbsp;<span class="builtintype" id="5226501">string</span><span class="op" id="5226507">)</span>&nbsp;<span class="op" id="5226509">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226512">if</span>&nbsp;<span class="op" id="5226515">!</span><span class="ident" id="5226516">strings</span><span class="op" id="5226523">.</span><span class="ident" id="5226524">HasPrefix</span><span class="op" id="5226533">(</span><span class="ident" id="5226534">v</span><span class="op" id="5226535">,</span>&nbsp;<span class="string" id="5226537">`&#34;`</span><span class="op" id="5226540">)</span>&nbsp;<span class="op" id="5226542">&amp;&amp;</span>&nbsp;<span class="op" id="5226545">!</span><span class="ident" id="5226546">strings</span><span class="op" id="5226553">.</span><span class="ident" id="5226554">HasPrefix</span><span class="op" id="5226563">(</span><span class="ident" id="5226564">v</span><span class="op" id="5226565">,</span>&nbsp;<span class="string" id="5226567">`&#39;`</span><span class="op" id="5226570">)</span>&nbsp;<span class="op" id="5226572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226576">return</span>&nbsp;<span class="ident" id="5226583">consumeToken</span><span class="op" id="5226595">(</span><span class="ident" id="5226596">v</span><span class="op" id="5226597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226604">leadQuote</span>&nbsp;<span class="op" id="5226614">:=</span>&nbsp;<span class="builtintype" id="5226617">rune</span><span class="op" id="5226621">(</span><span class="ident" id="5226622">v</span><span class="op" id="5226623">[</span><span class="num" id="5226624">0</span><span class="op" id="5226625">]</span><span class="op" id="5226626">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5226630">//&nbsp;parse&nbsp;a&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226656">rest</span>&nbsp;<span class="op" id="5226661">=</span>&nbsp;<span class="ident" id="5226663">v</span><span class="op" id="5226664">[</span><span class="num" id="5226665">1</span><span class="op" id="5226666">:</span><span class="op" id="5226667">]</span>&nbsp;<span class="comment" id="5226669">//&nbsp;consume&nbsp;the&nbsp;leading&nbsp;quote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226699">buffer</span>&nbsp;<span class="op" id="5226706">:=</span>&nbsp;<span class="builtinfunc" id="5226709">new</span><span class="op" id="5226712">(</span><span class="ident" id="5226713">bytes</span><span class="op" id="5226718">.</span><span class="ident" id="5226719">Buffer</span><span class="op" id="5226725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226728">var</span>&nbsp;<span class="ident" id="5226732">idx</span>&nbsp;<span class="builtintype" id="5226736">int</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226741">var</span>&nbsp;<span class="ident" id="5226745">r</span>&nbsp;<span class="builtintype" id="5226747">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226753">var</span>&nbsp;<span class="ident" id="5226757">nextIsLiteral</span>&nbsp;<span class="builtintype" id="5226771">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226777">for</span>&nbsp;<span class="ident" id="5226781">idx</span><span class="op" id="5226784">,</span>&nbsp;<span class="ident" id="5226786">r</span>&nbsp;<span class="op" id="5226788">=</span>&nbsp;<span class="keyword" id="5226790">range</span>&nbsp;<span class="ident" id="5226796">rest</span>&nbsp;<span class="op" id="5226801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226805">switch</span>&nbsp;<span class="op" id="5226812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226816">case</span>&nbsp;<span class="ident" id="5226821">nextIsLiteral</span><span class="op" id="5226834">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226839">buffer</span><span class="op" id="5226845">.</span><span class="ident" id="5226846">WriteRune</span><span class="op" id="5226855">(</span><span class="ident" id="5226856">r</span><span class="op" id="5226857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226862">nextIsLiteral</span>&nbsp;<span class="op" id="5226876">=</span>&nbsp;<span class="builtintype" id="5226878">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226886">case</span>&nbsp;<span class="ident" id="5226891">r</span>&nbsp;<span class="op" id="5226893">==</span>&nbsp;<span class="ident" id="5226896">leadQuote</span><span class="op" id="5226905">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226910">return</span>&nbsp;<span class="ident" id="5226917">buffer</span><span class="op" id="5226923">.</span><span class="ident" id="5226924">String</span><span class="op" id="5226930">(</span><span class="op" id="5226931">)</span><span class="op" id="5226932">,</span>&nbsp;<span class="ident" id="5226934">rest</span><span class="op" id="5226938">[</span><span class="ident" id="5226939">idx</span><span class="op" id="5226942">+</span><span class="num" id="5226943">1</span><span class="op" id="5226944">:</span><span class="op" id="5226945">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226949">case</span>&nbsp;<span class="ident" id="5226954">r</span>&nbsp;<span class="op" id="5226956">==</span>&nbsp;<span class="string" id="5226959">&#39;\\&#39;</span><span class="op" id="5226963">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226968">nextIsLiteral</span>&nbsp;<span class="op" id="5226982">=</span>&nbsp;<span class="builtintype" id="5226984">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226991">case</span>&nbsp;<span class="ident" id="5226996">r</span>&nbsp;<span class="op" id="5226998">!=</span>&nbsp;<span class="string" id="5227001">&#39;\r&#39;</span>&nbsp;<span class="op" id="5227006">&amp;&amp;</span>&nbsp;<span class="ident" id="5227009">r</span>&nbsp;<span class="op" id="5227011">!=</span>&nbsp;<span class="string" id="5227014">&#39;\n&#39;</span><span class="op" id="5227018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227023">buffer</span><span class="op" id="5227029">.</span><span class="ident" id="5227030">WriteRune</span><span class="op" id="5227039">(</span><span class="ident" id="5227040">r</span><span class="op" id="5227041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227045">default</span><span class="op" id="5227052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227057">return</span>&nbsp;<span class="string" id="5227064">&#34;&#34;</span><span class="op" id="5227066">,</span>&nbsp;<span class="ident" id="5227068">v</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227078">return</span>&nbsp;<span class="string" id="5227085">&#34;&#34;</span><span class="op" id="5227087">,</span>&nbsp;<span class="ident" id="5227089">v</span><br>
<span class="lineno"></span><span class="op" id="5227091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="5227094">func</span>&nbsp;<span class="ident" id="5227099">consumeMediaParam</span><span class="op" id="5227116">(</span><span class="ident" id="5227117">v</span>&nbsp;<span class="builtintype" id="5227119">string</span><span class="op" id="5227125">)</span>&nbsp;<span class="op" id="5227127">(</span><span class="ident" id="5227128">param</span><span class="op" id="5227133">,</span>&nbsp;<span class="ident" id="5227135">value</span><span class="op" id="5227140">,</span>&nbsp;<span class="ident" id="5227142">rest</span>&nbsp;<span class="builtintype" id="5227147">string</span><span class="op" id="5227153">)</span>&nbsp;<span class="op" id="5227155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227158">rest</span>&nbsp;<span class="op" id="5227163">=</span>&nbsp;<span class="ident" id="5227165">strings</span><span class="op" id="5227172">.</span><span class="ident" id="5227173">TrimLeftFunc</span><span class="op" id="5227185">(</span><span class="ident" id="5227186">v</span><span class="op" id="5227187">,</span>&nbsp;<span class="ident" id="5227189">unicode</span><span class="op" id="5227196">.</span><span class="ident" id="5227197">IsSpace</span><span class="op" id="5227204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227207">if</span>&nbsp;<span class="op" id="5227210">!</span><span class="ident" id="5227211">strings</span><span class="op" id="5227218">.</span><span class="ident" id="5227219">HasPrefix</span><span class="op" id="5227228">(</span><span class="ident" id="5227229">rest</span><span class="op" id="5227233">,</span>&nbsp;<span class="string" id="5227235">&#34;;&#34;</span><span class="op" id="5227238">)</span>&nbsp;<span class="op" id="5227240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227244">return</span>&nbsp;<span class="string" id="5227251">&#34;&#34;</span><span class="op" id="5227253">,</span>&nbsp;<span class="string" id="5227255">&#34;&#34;</span><span class="op" id="5227257">,</span>&nbsp;<span class="ident" id="5227259">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227262">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227266">rest</span>&nbsp;<span class="op" id="5227271">=</span>&nbsp;<span class="ident" id="5227273">rest</span><span class="op" id="5227277">[</span><span class="num" id="5227278">1</span><span class="op" id="5227279">:</span><span class="op" id="5227280">]</span>&nbsp;<span class="comment" id="5227282">//&nbsp;consume&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227304">rest</span>&nbsp;<span class="op" id="5227309">=</span>&nbsp;<span class="ident" id="5227311">strings</span><span class="op" id="5227318">.</span><span class="ident" id="5227319">TrimLeftFunc</span><span class="op" id="5227331">(</span><span class="ident" id="5227332">rest</span><span class="op" id="5227336">,</span>&nbsp;<span class="ident" id="5227338">unicode</span><span class="op" id="5227345">.</span><span class="ident" id="5227346">IsSpace</span><span class="op" id="5227353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227356">param</span><span class="op" id="5227361">,</span>&nbsp;<span class="ident" id="5227363">rest</span>&nbsp;<span class="op" id="5227368">=</span>&nbsp;<span class="ident" id="5227370">consumeToken</span><span class="op" id="5227382">(</span><span class="ident" id="5227383">rest</span><span class="op" id="5227387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227390">param</span>&nbsp;<span class="op" id="5227396">=</span>&nbsp;<span class="ident" id="5227398">strings</span><span class="op" id="5227405">.</span><span class="ident" id="5227406">ToLower</span><span class="op" id="5227413">(</span><span class="ident" id="5227414">param</span><span class="op" id="5227419">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227422">if</span>&nbsp;<span class="ident" id="5227425">param</span>&nbsp;<span class="op" id="5227431">==</span>&nbsp;<span class="string" id="5227434">&#34;&#34;</span>&nbsp;<span class="op" id="5227437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227441">return</span>&nbsp;<span class="string" id="5227448">&#34;&#34;</span><span class="op" id="5227450">,</span>&nbsp;<span class="string" id="5227452">&#34;&#34;</span><span class="op" id="5227454">,</span>&nbsp;<span class="ident" id="5227456">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227463">rest</span>&nbsp;<span class="op" id="5227468">=</span>&nbsp;<span class="ident" id="5227470">strings</span><span class="op" id="5227477">.</span><span class="ident" id="5227478">TrimLeftFunc</span><span class="op" id="5227490">(</span><span class="ident" id="5227491">rest</span><span class="op" id="5227495">,</span>&nbsp;<span class="ident" id="5227497">unicode</span><span class="op" id="5227504">.</span><span class="ident" id="5227505">IsSpace</span><span class="op" id="5227512">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227515">if</span>&nbsp;<span class="op" id="5227518">!</span><span class="ident" id="5227519">strings</span><span class="op" id="5227526">.</span><span class="ident" id="5227527">HasPrefix</span><span class="op" id="5227536">(</span><span class="ident" id="5227537">rest</span><span class="op" id="5227541">,</span>&nbsp;<span class="string" id="5227543">&#34;=&#34;</span><span class="op" id="5227546">)</span>&nbsp;<span class="op" id="5227548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227552">return</span>&nbsp;<span class="string" id="5227559">&#34;&#34;</span><span class="op" id="5227561">,</span>&nbsp;<span class="string" id="5227563">&#34;&#34;</span><span class="op" id="5227565">,</span>&nbsp;<span class="ident" id="5227567">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227573">rest</span>&nbsp;<span class="op" id="5227578">=</span>&nbsp;<span class="ident" id="5227580">rest</span><span class="op" id="5227584">[</span><span class="num" id="5227585">1</span><span class="op" id="5227586">:</span><span class="op" id="5227587">]</span>&nbsp;<span class="comment" id="5227589">//&nbsp;consume&nbsp;equals&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227613">rest</span>&nbsp;<span class="op" id="5227618">=</span>&nbsp;<span class="ident" id="5227620">strings</span><span class="op" id="5227627">.</span><span class="ident" id="5227628">TrimLeftFunc</span><span class="op" id="5227640">(</span><span class="ident" id="5227641">rest</span><span class="op" id="5227645">,</span>&nbsp;<span class="ident" id="5227647">unicode</span><span class="op" id="5227654">.</span><span class="ident" id="5227655">IsSpace</span><span class="op" id="5227662">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227665">value</span><span class="op" id="5227670">,</span>&nbsp;<span class="ident" id="5227672">rest</span>&nbsp;<span class="op" id="5227677">=</span>&nbsp;<span class="ident" id="5227679">consumeValue</span><span class="op" id="5227691">(</span><span class="ident" id="5227692">rest</span><span class="op" id="5227696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227699">if</span>&nbsp;<span class="ident" id="5227702">value</span>&nbsp;<span class="op" id="5227708">==</span>&nbsp;<span class="string" id="5227711">&#34;&#34;</span>&nbsp;<span class="op" id="5227714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227718">return</span>&nbsp;<span class="string" id="5227725">&#34;&#34;</span><span class="op" id="5227727">,</span>&nbsp;<span class="string" id="5227729">&#34;&#34;</span><span class="op" id="5227731">,</span>&nbsp;<span class="ident" id="5227733">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227739">return</span>&nbsp;<span class="ident" id="5227746">param</span><span class="op" id="5227751">,</span>&nbsp;<span class="ident" id="5227753">value</span><span class="op" id="5227758">,</span>&nbsp;<span class="ident" id="5227760">rest</span><br>
<span class="lineno">295</span><span class="op" id="5227765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5227768">func</span>&nbsp;<span class="ident" id="5227773">percentHexUnescape</span><span class="op" id="5227791">(</span><span class="ident" id="5227792">s</span>&nbsp;<span class="builtintype" id="5227794">string</span><span class="op" id="5227800">)</span>&nbsp;<span class="op" id="5227802">(</span><span class="builtintype" id="5227803">string</span><span class="op" id="5227809">,</span>&nbsp;<span class="builtintype" id="5227811">error</span><span class="op" id="5227816">)</span>&nbsp;<span class="op" id="5227818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5227821">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227866">percents</span>&nbsp;<span class="op" id="5227875">:=</span>&nbsp;<span class="num" id="5227878">0</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227881">for</span>&nbsp;<span class="ident" id="5227885">i</span>&nbsp;<span class="op" id="5227887">:=</span>&nbsp;<span class="num" id="5227890">0</span><span class="op" id="5227891">;</span>&nbsp;<span class="ident" id="5227893">i</span>&nbsp;<span class="op" id="5227895">&lt;</span>&nbsp;<span class="builtinfunc" id="5227897">len</span><span class="op" id="5227900">(</span><span class="ident" id="5227901">s</span><span class="op" id="5227902">)</span><span class="op" id="5227903">;</span>&nbsp;<span class="op" id="5227905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227909">if</span>&nbsp;<span class="ident" id="5227912">s</span><span class="op" id="5227913">[</span><span class="ident" id="5227914">i</span><span class="op" id="5227915">]</span>&nbsp;<span class="op" id="5227917">!=</span>&nbsp;<span class="string" id="5227920">&#39;%&#39;</span>&nbsp;<span class="op" id="5227924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227929">i</span><span class="op" id="5227930">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227936">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227947">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227951">percents</span><span class="op" id="5227959">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227964">if</span>&nbsp;<span class="ident" id="5227967">i</span><span class="op" id="5227968">+</span><span class="num" id="5227969">2</span>&nbsp;<span class="op" id="5227971">&gt;=</span>&nbsp;<span class="builtinfunc" id="5227974">len</span><span class="op" id="5227977">(</span><span class="ident" id="5227978">s</span><span class="op" id="5227979">)</span>&nbsp;<span class="op" id="5227981">||</span>&nbsp;<span class="op" id="5227984">!</span><span class="ident" id="5227985">ishex</span><span class="op" id="5227990">(</span><span class="ident" id="5227991">s</span><span class="op" id="5227992">[</span><span class="ident" id="5227993">i</span><span class="op" id="5227994">+</span><span class="num" id="5227995">1</span><span class="op" id="5227996">]</span><span class="op" id="5227997">)</span>&nbsp;<span class="op" id="5227999">||</span>&nbsp;<span class="op" id="5228002">!</span><span class="ident" id="5228003">ishex</span><span class="op" id="5228008">(</span><span class="ident" id="5228009">s</span><span class="op" id="5228010">[</span><span class="ident" id="5228011">i</span><span class="op" id="5228012">+</span><span class="num" id="5228013">2</span><span class="op" id="5228014">]</span><span class="op" id="5228015">)</span>&nbsp;<span class="op" id="5228017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228022">s</span>&nbsp;<span class="op" id="5228024">=</span>&nbsp;<span class="ident" id="5228026">s</span><span class="op" id="5228027">[</span><span class="ident" id="5228028">i</span><span class="op" id="5228029">:</span><span class="op" id="5228030">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228035">if</span>&nbsp;<span class="builtinfunc" id="5228038">len</span><span class="op" id="5228041">(</span><span class="ident" id="5228042">s</span><span class="op" id="5228043">)</span>&nbsp;<span class="op" id="5228045">&gt;</span>&nbsp;<span class="num" id="5228047">3</span>&nbsp;<span class="op" id="5228049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228055">s</span>&nbsp;<span class="op" id="5228057">=</span>&nbsp;<span class="ident" id="5228059">s</span><span class="op" id="5228060">[</span><span class="num" id="5228061">0</span><span class="op" id="5228062">:</span><span class="num" id="5228063">3</span><span class="op" id="5228064">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228074">return</span>&nbsp;<span class="string" id="5228081">&#34;&#34;</span><span class="op" id="5228083">,</span>&nbsp;<span class="ident" id="5228085">fmt</span><span class="op" id="5228088">.</span><span class="ident" id="5228089">Errorf</span><span class="op" id="5228095">(</span><span class="string" id="5228096">&#34;mime:&nbsp;bogus&nbsp;characters&nbsp;after&nbsp;%%:&nbsp;%q&#34;</span><span class="op" id="5228133">,</span>&nbsp;<span class="ident" id="5228135">s</span><span class="op" id="5228136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228144">i</span>&nbsp;<span class="op" id="5228146">+=</span>&nbsp;<span class="num" id="5228149">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228152">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228155">if</span>&nbsp;<span class="ident" id="5228158">percents</span>&nbsp;<span class="op" id="5228167">==</span>&nbsp;<span class="num" id="5228170">0</span>&nbsp;<span class="op" id="5228172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228176">return</span>&nbsp;<span class="ident" id="5228183">s</span><span class="op" id="5228184">,</span>&nbsp;<span class="ident" id="5228186">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228195">t</span>&nbsp;<span class="op" id="5228197">:=</span>&nbsp;<span class="builtinfunc" id="5228200">make</span><span class="op" id="5228204">(</span><span class="op" id="5228205">[</span><span class="op" id="5228206">]</span><span class="builtintype" id="5228207">byte</span><span class="op" id="5228211">,</span>&nbsp;<span class="builtinfunc" id="5228213">len</span><span class="op" id="5228216">(</span><span class="ident" id="5228217">s</span><span class="op" id="5228218">)</span><span class="op" id="5228219">-</span><span class="num" id="5228220">2</span><span class="op" id="5228221">*</span><span class="ident" id="5228222">percents</span><span class="op" id="5228230">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228233">j</span>&nbsp;<span class="op" id="5228235">:=</span>&nbsp;<span class="num" id="5228238">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228241">for</span>&nbsp;<span class="ident" id="5228245">i</span>&nbsp;<span class="op" id="5228247">:=</span>&nbsp;<span class="num" id="5228250">0</span><span class="op" id="5228251">;</span>&nbsp;<span class="ident" id="5228253">i</span>&nbsp;<span class="op" id="5228255">&lt;</span>&nbsp;<span class="builtinfunc" id="5228257">len</span><span class="op" id="5228260">(</span><span class="ident" id="5228261">s</span><span class="op" id="5228262">)</span><span class="op" id="5228263">;</span>&nbsp;<span class="op" id="5228265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228269">switch</span>&nbsp;<span class="ident" id="5228276">s</span><span class="op" id="5228277">[</span><span class="ident" id="5228278">i</span><span class="op" id="5228279">]</span>&nbsp;<span class="op" id="5228281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228285">case</span>&nbsp;<span class="string" id="5228290">&#39;%&#39;</span><span class="op" id="5228293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228298">t</span><span class="op" id="5228299">[</span><span class="ident" id="5228300">j</span><span class="op" id="5228301">]</span>&nbsp;<span class="op" id="5228303">=</span>&nbsp;<span class="ident" id="5228305">unhex</span><span class="op" id="5228310">(</span><span class="ident" id="5228311">s</span><span class="op" id="5228312">[</span><span class="ident" id="5228313">i</span><span class="op" id="5228314">+</span><span class="num" id="5228315">1</span><span class="op" id="5228316">]</span><span class="op" id="5228317">)</span><span class="op" id="5228318">&lt;&lt;</span><span class="num" id="5228320">4</span>&nbsp;<span class="op" id="5228322">|</span>&nbsp;<span class="ident" id="5228324">unhex</span><span class="op" id="5228329">(</span><span class="ident" id="5228330">s</span><span class="op" id="5228331">[</span><span class="ident" id="5228332">i</span><span class="op" id="5228333">+</span><span class="num" id="5228334">2</span><span class="op" id="5228335">]</span><span class="op" id="5228336">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228341">j</span><span class="op" id="5228342">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228348">i</span>&nbsp;<span class="op" id="5228350">+=</span>&nbsp;<span class="num" id="5228353">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228357">default</span><span class="op" id="5228364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228369">t</span><span class="op" id="5228370">[</span><span class="ident" id="5228371">j</span><span class="op" id="5228372">]</span>&nbsp;<span class="op" id="5228374">=</span>&nbsp;<span class="ident" id="5228376">s</span><span class="op" id="5228377">[</span><span class="ident" id="5228378">i</span><span class="op" id="5228379">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228384">j</span><span class="op" id="5228385">++</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228391">i</span><span class="op" id="5228392">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228403">return</span>&nbsp;<span class="builtintype" id="5228410">string</span><span class="op" id="5228416">(</span><span class="ident" id="5228417">t</span><span class="op" id="5228418">)</span><span class="op" id="5228419">,</span>&nbsp;<span class="ident" id="5228421">nil</span><br>
<span class="lineno"></span><span class="op" id="5228425">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="keyword" id="5228428">func</span>&nbsp;<span class="ident" id="5228433">ishex</span><span class="op" id="5228438">(</span><span class="ident" id="5228439">c</span>&nbsp;<span class="builtintype" id="5228441">byte</span><span class="op" id="5228445">)</span>&nbsp;<span class="builtintype" id="5228447">bool</span>&nbsp;<span class="op" id="5228452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228455">switch</span>&nbsp;<span class="op" id="5228462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228465">case</span>&nbsp;<span class="string" id="5228470">&#39;0&#39;</span>&nbsp;<span class="op" id="5228474">&lt;=</span>&nbsp;<span class="ident" id="5228477">c</span>&nbsp;<span class="op" id="5228479">&amp;&amp;</span>&nbsp;<span class="ident" id="5228482">c</span>&nbsp;<span class="op" id="5228484">&lt;=</span>&nbsp;<span class="string" id="5228487">&#39;9&#39;</span><span class="op" id="5228490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228494">return</span>&nbsp;<span class="builtintype" id="5228501">true</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228507">case</span>&nbsp;<span class="string" id="5228512">&#39;a&#39;</span>&nbsp;<span class="op" id="5228516">&lt;=</span>&nbsp;<span class="ident" id="5228519">c</span>&nbsp;<span class="op" id="5228521">&amp;&amp;</span>&nbsp;<span class="ident" id="5228524">c</span>&nbsp;<span class="op" id="5228526">&lt;=</span>&nbsp;<span class="string" id="5228529">&#39;f&#39;</span><span class="op" id="5228532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228536">return</span>&nbsp;<span class="builtintype" id="5228543">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228549">case</span>&nbsp;<span class="string" id="5228554">&#39;A&#39;</span>&nbsp;<span class="op" id="5228558">&lt;=</span>&nbsp;<span class="ident" id="5228561">c</span>&nbsp;<span class="op" id="5228563">&amp;&amp;</span>&nbsp;<span class="ident" id="5228566">c</span>&nbsp;<span class="op" id="5228568">&lt;=</span>&nbsp;<span class="string" id="5228571">&#39;F&#39;</span><span class="op" id="5228574">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228578">return</span>&nbsp;<span class="builtintype" id="5228585">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228591">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228594">return</span>&nbsp;<span class="builtintype" id="5228601">false</span><br>
<span class="lineno"></span><span class="op" id="5228607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5228610">func</span>&nbsp;<span class="ident" id="5228615">unhex</span><span class="op" id="5228620">(</span><span class="ident" id="5228621">c</span>&nbsp;<span class="builtintype" id="5228623">byte</span><span class="op" id="5228627">)</span>&nbsp;<span class="builtintype" id="5228629">byte</span>&nbsp;<span class="op" id="5228634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228637">switch</span>&nbsp;<span class="op" id="5228644">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228647">case</span>&nbsp;<span class="string" id="5228652">&#39;0&#39;</span>&nbsp;<span class="op" id="5228656">&lt;=</span>&nbsp;<span class="ident" id="5228659">c</span>&nbsp;<span class="op" id="5228661">&amp;&amp;</span>&nbsp;<span class="ident" id="5228664">c</span>&nbsp;<span class="op" id="5228666">&lt;=</span>&nbsp;<span class="string" id="5228669">&#39;9&#39;</span><span class="op" id="5228672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228676">return</span>&nbsp;<span class="ident" id="5228683">c</span>&nbsp;<span class="op" id="5228685">-</span>&nbsp;<span class="string" id="5228687">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228692">case</span>&nbsp;<span class="string" id="5228697">&#39;a&#39;</span>&nbsp;<span class="op" id="5228701">&lt;=</span>&nbsp;<span class="ident" id="5228704">c</span>&nbsp;<span class="op" id="5228706">&amp;&amp;</span>&nbsp;<span class="ident" id="5228709">c</span>&nbsp;<span class="op" id="5228711">&lt;=</span>&nbsp;<span class="string" id="5228714">&#39;f&#39;</span><span class="op" id="5228717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228721">return</span>&nbsp;<span class="ident" id="5228728">c</span>&nbsp;<span class="op" id="5228730">-</span>&nbsp;<span class="string" id="5228732">&#39;a&#39;</span>&nbsp;<span class="op" id="5228736">+</span>&nbsp;<span class="num" id="5228738">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228742">case</span>&nbsp;<span class="string" id="5228747">&#39;A&#39;</span>&nbsp;<span class="op" id="5228751">&lt;=</span>&nbsp;<span class="ident" id="5228754">c</span>&nbsp;<span class="op" id="5228756">&amp;&amp;</span>&nbsp;<span class="ident" id="5228759">c</span>&nbsp;<span class="op" id="5228761">&lt;=</span>&nbsp;<span class="string" id="5228764">&#39;F&#39;</span><span class="op" id="5228767">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228771">return</span>&nbsp;<span class="ident" id="5228778">c</span>&nbsp;<span class="op" id="5228780">-</span>&nbsp;<span class="string" id="5228782">&#39;A&#39;</span>&nbsp;<span class="op" id="5228786">+</span>&nbsp;<span class="num" id="5228788">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228795">return</span>&nbsp;<span class="num" id="5228802">0</span><br>
<span class="lineno"></span><span class="op" id="5228804">}</span>
</div>
</body>
</html>
