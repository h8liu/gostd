<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html" class="current">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1434200">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1434255">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1434309">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1434360">package</span>&nbsp;<span class="ident" id="1434368">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1434376">import</span>&nbsp;<span class="op" id="1434383">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1434386">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1434395">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1434398">//&nbsp;A&nbsp;Value&nbsp;provides&nbsp;an&nbsp;atomic&nbsp;load&nbsp;and&nbsp;store&nbsp;of&nbsp;a&nbsp;consistently&nbsp;typed&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1434474">//&nbsp;Values&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;data&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1434533">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Value&nbsp;returns&nbsp;nil&nbsp;from&nbsp;Load.</span><br>
<span class="lineno"></span><span class="comment" id="1434586">//&nbsp;Once&nbsp;Store&nbsp;has&nbsp;been&nbsp;called,&nbsp;a&nbsp;Value&nbsp;must&nbsp;not&nbsp;be&nbsp;copied.</span><br>
<span class="lineno">15</span><span class="keyword" id="1434645">type</span>&nbsp;<span class="ident" id="1434650">Value</span>&nbsp;<span class="keyword" id="1434656">struct</span>&nbsp;<span class="op" id="1434663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434666">v</span>&nbsp;<span class="keyword" id="1434668">interface</span><span class="op" id="1434677">{</span><span class="op" id="1434678">}</span><br>
<span class="lineno"></span><span class="op" id="1434680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1434683">//&nbsp;ifaceWords&nbsp;is&nbsp;interface{}&nbsp;internal&nbsp;representation.</span><br>
<span class="lineno">20</span><span class="keyword" id="1434737">type</span>&nbsp;<span class="ident" id="1434742">ifaceWords</span>&nbsp;<span class="keyword" id="1434753">struct</span>&nbsp;<span class="op" id="1434760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434763">typ</span>&nbsp;&nbsp;<span class="ident" id="1434768">unsafe</span><span class="op" id="1434774">.</span><span class="ident" id="1434775">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434784">data</span>&nbsp;<span class="ident" id="1434789">unsafe</span><span class="op" id="1434795">.</span><span class="ident" id="1434796">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1434804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1434807">//&nbsp;Load&nbsp;returns&nbsp;the&nbsp;value&nbsp;set&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;Store.</span><br>
<span class="lineno"></span><span class="comment" id="1434863">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;there&nbsp;has&nbsp;been&nbsp;no&nbsp;call&nbsp;to&nbsp;Store&nbsp;for&nbsp;this&nbsp;Value.</span><br>
<span class="lineno"></span><span class="keyword" id="1434932">func</span>&nbsp;<span class="op" id="1434937">(</span><span class="ident" id="1434938">v</span>&nbsp;<span class="op" id="1434940">*</span><span class="ident" id="1434941">Value</span><span class="op" id="1434946">)</span>&nbsp;<span class="ident" id="1434948">Load</span><span class="op" id="1434952">(</span><span class="op" id="1434953">)</span>&nbsp;<span class="op" id="1434955">(</span><span class="ident" id="1434956">x</span>&nbsp;<span class="keyword" id="1434958">interface</span><span class="op" id="1434967">{</span><span class="op" id="1434968">}</span><span class="op" id="1434969">)</span>&nbsp;<span class="op" id="1434971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1434974">vp</span>&nbsp;<span class="op" id="1434977">:=</span>&nbsp;<span class="op" id="1434980">(</span><span class="op" id="1434981">*</span><span class="ident" id="1434982">ifaceWords</span><span class="op" id="1434992">)</span><span class="op" id="1434993">(</span><span class="ident" id="1434994">unsafe</span><span class="op" id="1435000">.</span><span class="ident" id="1435001">Pointer</span><span class="op" id="1435008">(</span><span class="ident" id="1435009">v</span><span class="op" id="1435010">)</span><span class="op" id="1435011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435014">typ</span>&nbsp;<span class="op" id="1435018">:=</span>&nbsp;<span class="ident" id="1435021">LoadPointer</span><span class="op" id="1435032">(</span><span class="op" id="1435033">&amp;</span><span class="ident" id="1435034">vp</span><span class="op" id="1435036">.</span><span class="ident" id="1435037">typ</span><span class="op" id="1435040">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435043">if</span>&nbsp;<span class="ident" id="1435046">typ</span>&nbsp;<span class="op" id="1435050">==</span>&nbsp;<span class="builtintype" id="1435053">nil</span>&nbsp;<span class="op" id="1435057">||</span>&nbsp;<span class="builtintype" id="1435060">uintptr</span><span class="op" id="1435067">(</span><span class="ident" id="1435068">typ</span><span class="op" id="1435071">)</span>&nbsp;<span class="op" id="1435073">==</span>&nbsp;<span class="op" id="1435076">^</span><span class="builtintype" id="1435077">uintptr</span><span class="op" id="1435084">(</span><span class="num" id="1435085">0</span><span class="op" id="1435086">)</span>&nbsp;<span class="op" id="1435088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435092">//&nbsp;First&nbsp;store&nbsp;not&nbsp;yet&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435128">return</span>&nbsp;<span class="builtintype" id="1435135">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1435140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435143">data</span>&nbsp;<span class="op" id="1435148">:=</span>&nbsp;<span class="ident" id="1435151">LoadPointer</span><span class="op" id="1435162">(</span><span class="op" id="1435163">&amp;</span><span class="ident" id="1435164">vp</span><span class="op" id="1435166">.</span><span class="ident" id="1435167">data</span><span class="op" id="1435171">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435174">xp</span>&nbsp;<span class="op" id="1435177">:=</span>&nbsp;<span class="op" id="1435180">(</span><span class="op" id="1435181">*</span><span class="ident" id="1435182">ifaceWords</span><span class="op" id="1435192">)</span><span class="op" id="1435193">(</span><span class="ident" id="1435194">unsafe</span><span class="op" id="1435200">.</span><span class="ident" id="1435201">Pointer</span><span class="op" id="1435208">(</span><span class="op" id="1435209">&amp;</span><span class="ident" id="1435210">x</span><span class="op" id="1435211">)</span><span class="op" id="1435212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435215">xp</span><span class="op" id="1435217">.</span><span class="ident" id="1435218">typ</span>&nbsp;<span class="op" id="1435222">=</span>&nbsp;<span class="ident" id="1435224">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435229">xp</span><span class="op" id="1435231">.</span><span class="ident" id="1435232">data</span>&nbsp;<span class="op" id="1435237">=</span>&nbsp;<span class="ident" id="1435239">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435245">return</span><br>
<span class="lineno"></span><span class="op" id="1435252">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="1435255">//&nbsp;Store&nbsp;sets&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Value&nbsp;to&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1435298">//&nbsp;All&nbsp;calls&nbsp;to&nbsp;Store&nbsp;for&nbsp;a&nbsp;given&nbsp;Value&nbsp;must&nbsp;use&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="1435381">//&nbsp;Store&nbsp;of&nbsp;an&nbsp;inconsistent&nbsp;type&nbsp;panics,&nbsp;as&nbsp;does&nbsp;Store(nil).</span><br>
<span class="lineno"></span><span class="keyword" id="1435442">func</span>&nbsp;<span class="op" id="1435447">(</span><span class="ident" id="1435448">v</span>&nbsp;<span class="op" id="1435450">*</span><span class="ident" id="1435451">Value</span><span class="op" id="1435456">)</span>&nbsp;<span class="ident" id="1435458">Store</span><span class="op" id="1435463">(</span><span class="ident" id="1435464">x</span>&nbsp;<span class="keyword" id="1435466">interface</span><span class="op" id="1435475">{</span><span class="op" id="1435476">}</span><span class="op" id="1435477">)</span>&nbsp;<span class="op" id="1435479">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435482">if</span>&nbsp;<span class="ident" id="1435485">x</span>&nbsp;<span class="op" id="1435487">==</span>&nbsp;<span class="builtintype" id="1435490">nil</span>&nbsp;<span class="op" id="1435494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1435498">panic</span><span class="op" id="1435503">(</span><span class="string" id="1435504">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;nil&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1435548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1435551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435554">vp</span>&nbsp;<span class="op" id="1435557">:=</span>&nbsp;<span class="op" id="1435560">(</span><span class="op" id="1435561">*</span><span class="ident" id="1435562">ifaceWords</span><span class="op" id="1435572">)</span><span class="op" id="1435573">(</span><span class="ident" id="1435574">unsafe</span><span class="op" id="1435580">.</span><span class="ident" id="1435581">Pointer</span><span class="op" id="1435588">(</span><span class="ident" id="1435589">v</span><span class="op" id="1435590">)</span><span class="op" id="1435591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435594">xp</span>&nbsp;<span class="op" id="1435597">:=</span>&nbsp;<span class="op" id="1435600">(</span><span class="op" id="1435601">*</span><span class="ident" id="1435602">ifaceWords</span><span class="op" id="1435612">)</span><span class="op" id="1435613">(</span><span class="ident" id="1435614">unsafe</span><span class="op" id="1435620">.</span><span class="ident" id="1435621">Pointer</span><span class="op" id="1435628">(</span><span class="op" id="1435629">&amp;</span><span class="ident" id="1435630">x</span><span class="op" id="1435631">)</span><span class="op" id="1435632">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435635">for</span>&nbsp;<span class="op" id="1435639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435643">typ</span>&nbsp;<span class="op" id="1435647">:=</span>&nbsp;<span class="ident" id="1435650">LoadPointer</span><span class="op" id="1435661">(</span><span class="op" id="1435662">&amp;</span><span class="ident" id="1435663">vp</span><span class="op" id="1435665">.</span><span class="ident" id="1435666">typ</span><span class="op" id="1435669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435673">if</span>&nbsp;<span class="ident" id="1435676">typ</span>&nbsp;<span class="op" id="1435680">==</span>&nbsp;<span class="builtintype" id="1435683">nil</span>&nbsp;<span class="op" id="1435687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435692">//&nbsp;Attempt&nbsp;to&nbsp;start&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435728">//&nbsp;Disable&nbsp;preemption&nbsp;so&nbsp;that&nbsp;other&nbsp;goroutines&nbsp;can&nbsp;use</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435786">//&nbsp;active&nbsp;spin&nbsp;wait&nbsp;to&nbsp;wait&nbsp;for&nbsp;completion;&nbsp;and&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1435845">//&nbsp;GC&nbsp;does&nbsp;not&nbsp;see&nbsp;the&nbsp;fake&nbsp;type&nbsp;accidentally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435895">runtime_procPin</span><span class="op" id="1435910">(</span><span class="op" id="1435911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1435916">if</span>&nbsp;<span class="op" id="1435919">!</span><span class="ident" id="1435920">CompareAndSwapPointer</span><span class="op" id="1435941">(</span><span class="op" id="1435942">&amp;</span><span class="ident" id="1435943">vp</span><span class="op" id="1435945">.</span><span class="ident" id="1435946">typ</span><span class="op" id="1435949">,</span>&nbsp;<span class="builtintype" id="1435951">nil</span><span class="op" id="1435954">,</span>&nbsp;<span class="ident" id="1435956">unsafe</span><span class="op" id="1435962">.</span><span class="ident" id="1435963">Pointer</span><span class="op" id="1435970">(</span><span class="op" id="1435971">^</span><span class="builtintype" id="1435972">uintptr</span><span class="op" id="1435979">(</span><span class="num" id="1435980">0</span><span class="op" id="1435981">)</span><span class="op" id="1435982">)</span><span class="op" id="1435983">)</span>&nbsp;<span class="op" id="1435985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1435991">runtime_procUnpin</span><span class="op" id="1436008">(</span><span class="op" id="1436009">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436015">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1436027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436032">//&nbsp;Complete&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436060">StorePointer</span><span class="op" id="1436072">(</span><span class="op" id="1436073">&amp;</span><span class="ident" id="1436074">vp</span><span class="op" id="1436076">.</span><span class="ident" id="1436077">data</span><span class="op" id="1436081">,</span>&nbsp;<span class="ident" id="1436083">xp</span><span class="op" id="1436085">.</span><span class="ident" id="1436086">data</span><span class="op" id="1436090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436095">StorePointer</span><span class="op" id="1436107">(</span><span class="op" id="1436108">&amp;</span><span class="ident" id="1436109">vp</span><span class="op" id="1436111">.</span><span class="ident" id="1436112">typ</span><span class="op" id="1436115">,</span>&nbsp;<span class="ident" id="1436117">xp</span><span class="op" id="1436119">.</span><span class="ident" id="1436120">typ</span><span class="op" id="1436123">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436128">runtime_procUnpin</span><span class="op" id="1436145">(</span><span class="op" id="1436146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436151">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1436160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436164">if</span>&nbsp;<span class="builtintype" id="1436167">uintptr</span><span class="op" id="1436174">(</span><span class="ident" id="1436175">typ</span><span class="op" id="1436178">)</span>&nbsp;<span class="op" id="1436180">==</span>&nbsp;<span class="op" id="1436183">^</span><span class="builtintype" id="1436184">uintptr</span><span class="op" id="1436191">(</span><span class="num" id="1436192">0</span><span class="op" id="1436193">)</span>&nbsp;<span class="op" id="1436195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436200">//&nbsp;First&nbsp;store&nbsp;in&nbsp;progress.&nbsp;Wait.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436237">//&nbsp;Since&nbsp;we&nbsp;disable&nbsp;preemption&nbsp;around&nbsp;the&nbsp;first&nbsp;store,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436295">//&nbsp;we&nbsp;can&nbsp;wait&nbsp;with&nbsp;active&nbsp;spinning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436335">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1436346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1436350">//&nbsp;First&nbsp;store&nbsp;completed.&nbsp;Check&nbsp;type&nbsp;and&nbsp;overwrite&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436409">if</span>&nbsp;<span class="ident" id="1436412">typ</span>&nbsp;<span class="op" id="1436416">!=</span>&nbsp;<span class="ident" id="1436419">xp</span><span class="op" id="1436421">.</span><span class="ident" id="1436422">typ</span>&nbsp;<span class="op" id="1436426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1436431">panic</span><span class="op" id="1436436">(</span><span class="string" id="1436437">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;inconsistently&nbsp;typed&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1436498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1436502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1436506">StorePointer</span><span class="op" id="1436518">(</span><span class="op" id="1436519">&amp;</span><span class="ident" id="1436520">vp</span><span class="op" id="1436522">.</span><span class="ident" id="1436523">data</span><span class="op" id="1436527">,</span>&nbsp;<span class="ident" id="1436529">xp</span><span class="op" id="1436531">.</span><span class="ident" id="1436532">data</span><span class="op" id="1436536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1436540">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1436548">}</span><br>
<span class="lineno"></span><span class="op" id="1436550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1436553">//&nbsp;Disable/enable&nbsp;preemption,&nbsp;implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1436607">func</span>&nbsp;<span class="ident" id="1436612">runtime_procPin</span><span class="op" id="1436627">(</span><span class="op" id="1436628">)</span><br>
<span class="lineno">85</span><span class="keyword" id="1436630">func</span>&nbsp;<span class="ident" id="1436635">runtime_procUnpin</span><span class="op" id="1436652">(</span><span class="op" id="1436653">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
