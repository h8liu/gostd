<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5168383">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5168438">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5168492">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5168543">package</span>&nbsp;<span class="ident" id="5168551">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5168561">import</span>&nbsp;<span class="op" id="5168568">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5168571">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5168580">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5168587">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5168598">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5168613">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5168616">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="5168690">func</span>&nbsp;<span class="ident" id="5168695">htmlNospaceEscaper</span><span class="op" id="5168713">(</span><span class="ident" id="5168714">args</span>&nbsp;<span class="op" id="5168719">...</span><span class="keyword" id="5168722">interface</span><span class="op" id="5168731">{</span><span class="op" id="5168732">}</span><span class="op" id="5168733">)</span>&nbsp;<span class="builtintype" id="5168735">string</span>&nbsp;<span class="op" id="5168742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168745">s</span><span class="op" id="5168746">,</span>&nbsp;<span class="ident" id="5168748">t</span>&nbsp;<span class="op" id="5168750">:=</span>&nbsp;<span class="ident" id="5168753">stringify</span><span class="op" id="5168762">(</span><span class="ident" id="5168763">args</span><span class="op" id="5168767">...</span><span class="op" id="5168770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168773">if</span>&nbsp;<span class="ident" id="5168776">t</span>&nbsp;<span class="op" id="5168778">==</span>&nbsp;<span class="ident" id="5168781">contentTypeHTML</span>&nbsp;<span class="op" id="5168797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168801">return</span>&nbsp;<span class="ident" id="5168808">htmlReplacer</span><span class="op" id="5168820">(</span><span class="ident" id="5168821">stripTags</span><span class="op" id="5168830">(</span><span class="ident" id="5168831">s</span><span class="op" id="5168832">)</span><span class="op" id="5168833">,</span>&nbsp;<span class="ident" id="5168835">htmlNospaceNormReplacementTable</span><span class="op" id="5168866">,</span>&nbsp;<span class="builtintype" id="5168868">false</span><span class="op" id="5168873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168876">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168879">return</span>&nbsp;<span class="ident" id="5168886">htmlReplacer</span><span class="op" id="5168898">(</span><span class="ident" id="5168899">s</span><span class="op" id="5168900">,</span>&nbsp;<span class="ident" id="5168902">htmlNospaceReplacementTable</span><span class="op" id="5168929">,</span>&nbsp;<span class="builtintype" id="5168931">false</span><span class="op" id="5168936">)</span><br>
<span class="lineno"></span><span class="op" id="5168938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5168941">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5169006">func</span>&nbsp;<span class="ident" id="5169011">attrEscaper</span><span class="op" id="5169022">(</span><span class="ident" id="5169023">args</span>&nbsp;<span class="op" id="5169028">...</span><span class="keyword" id="5169031">interface</span><span class="op" id="5169040">{</span><span class="op" id="5169041">}</span><span class="op" id="5169042">)</span>&nbsp;<span class="builtintype" id="5169044">string</span>&nbsp;<span class="op" id="5169051">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169054">s</span><span class="op" id="5169055">,</span>&nbsp;<span class="ident" id="5169057">t</span>&nbsp;<span class="op" id="5169059">:=</span>&nbsp;<span class="ident" id="5169062">stringify</span><span class="op" id="5169071">(</span><span class="ident" id="5169072">args</span><span class="op" id="5169076">...</span><span class="op" id="5169079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169082">if</span>&nbsp;<span class="ident" id="5169085">t</span>&nbsp;<span class="op" id="5169087">==</span>&nbsp;<span class="ident" id="5169090">contentTypeHTML</span>&nbsp;<span class="op" id="5169106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169110">return</span>&nbsp;<span class="ident" id="5169117">htmlReplacer</span><span class="op" id="5169129">(</span><span class="ident" id="5169130">stripTags</span><span class="op" id="5169139">(</span><span class="ident" id="5169140">s</span><span class="op" id="5169141">)</span><span class="op" id="5169142">,</span>&nbsp;<span class="ident" id="5169144">htmlNormReplacementTable</span><span class="op" id="5169168">,</span>&nbsp;<span class="builtintype" id="5169170">true</span><span class="op" id="5169174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169180">return</span>&nbsp;<span class="ident" id="5169187">htmlReplacer</span><span class="op" id="5169199">(</span><span class="ident" id="5169200">s</span><span class="op" id="5169201">,</span>&nbsp;<span class="ident" id="5169203">htmlReplacementTable</span><span class="op" id="5169223">,</span>&nbsp;<span class="builtintype" id="5169225">true</span><span class="op" id="5169229">)</span><br>
<span class="lineno">30</span><span class="op" id="5169231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5169234">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5169300">func</span>&nbsp;<span class="ident" id="5169305">rcdataEscaper</span><span class="op" id="5169318">(</span><span class="ident" id="5169319">args</span>&nbsp;<span class="op" id="5169324">...</span><span class="keyword" id="5169327">interface</span><span class="op" id="5169336">{</span><span class="op" id="5169337">}</span><span class="op" id="5169338">)</span>&nbsp;<span class="builtintype" id="5169340">string</span>&nbsp;<span class="op" id="5169347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169350">s</span><span class="op" id="5169351">,</span>&nbsp;<span class="ident" id="5169353">t</span>&nbsp;<span class="op" id="5169355">:=</span>&nbsp;<span class="ident" id="5169358">stringify</span><span class="op" id="5169367">(</span><span class="ident" id="5169368">args</span><span class="op" id="5169372">...</span><span class="op" id="5169375">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169378">if</span>&nbsp;<span class="ident" id="5169381">t</span>&nbsp;<span class="op" id="5169383">==</span>&nbsp;<span class="ident" id="5169386">contentTypeHTML</span>&nbsp;<span class="op" id="5169402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169406">return</span>&nbsp;<span class="ident" id="5169413">htmlReplacer</span><span class="op" id="5169425">(</span><span class="ident" id="5169426">s</span><span class="op" id="5169427">,</span>&nbsp;<span class="ident" id="5169429">htmlNormReplacementTable</span><span class="op" id="5169453">,</span>&nbsp;<span class="builtintype" id="5169455">true</span><span class="op" id="5169459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169465">return</span>&nbsp;<span class="ident" id="5169472">htmlReplacer</span><span class="op" id="5169484">(</span><span class="ident" id="5169485">s</span><span class="op" id="5169486">,</span>&nbsp;<span class="ident" id="5169488">htmlReplacementTable</span><span class="op" id="5169508">,</span>&nbsp;<span class="builtintype" id="5169510">true</span><span class="op" id="5169514">)</span><br>
<span class="lineno"></span><span class="op" id="5169516">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5169519">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5169570">func</span>&nbsp;<span class="ident" id="5169575">htmlEscaper</span><span class="op" id="5169586">(</span><span class="ident" id="5169587">args</span>&nbsp;<span class="op" id="5169592">...</span><span class="keyword" id="5169595">interface</span><span class="op" id="5169604">{</span><span class="op" id="5169605">}</span><span class="op" id="5169606">)</span>&nbsp;<span class="builtintype" id="5169608">string</span>&nbsp;<span class="op" id="5169615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169618">s</span><span class="op" id="5169619">,</span>&nbsp;<span class="ident" id="5169621">t</span>&nbsp;<span class="op" id="5169623">:=</span>&nbsp;<span class="ident" id="5169626">stringify</span><span class="op" id="5169635">(</span><span class="ident" id="5169636">args</span><span class="op" id="5169640">...</span><span class="op" id="5169643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169646">if</span>&nbsp;<span class="ident" id="5169649">t</span>&nbsp;<span class="op" id="5169651">==</span>&nbsp;<span class="ident" id="5169654">contentTypeHTML</span>&nbsp;<span class="op" id="5169670">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169674">return</span>&nbsp;<span class="ident" id="5169681">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169687">return</span>&nbsp;<span class="ident" id="5169694">htmlReplacer</span><span class="op" id="5169706">(</span><span class="ident" id="5169707">s</span><span class="op" id="5169708">,</span>&nbsp;<span class="ident" id="5169710">htmlReplacementTable</span><span class="op" id="5169730">,</span>&nbsp;<span class="builtintype" id="5169732">true</span><span class="op" id="5169736">)</span><br>
<span class="lineno"></span><span class="op" id="5169738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5169741">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="5169808">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5169862">var</span>&nbsp;<span class="ident" id="5169866">htmlReplacementTable</span>&nbsp;<span class="op" id="5169887">=</span>&nbsp;<span class="op" id="5169889">[</span><span class="op" id="5169890">]</span><span class="builtintype" id="5169891">string</span><span class="op" id="5169897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5169900">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5169976">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5170033">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5170091">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5170097">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5170115">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5170187">0</span><span class="op" id="5170188">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5170193">&#34;\uFFFD&#34;</span><span class="op" id="5170201">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5170204">&#39;&#34;&#39;</span><span class="op" id="5170207">:</span>&nbsp;&nbsp;<span class="string" id="5170210">&#34;&amp;#34;&#34;</span><span class="op" id="5170217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5170220">&#39;&amp;&#39;</span><span class="op" id="5170223">:</span>&nbsp;&nbsp;<span class="string" id="5170226">&#34;&amp;amp;&#34;</span><span class="op" id="5170233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5170236">&#39;\&#39;&#39;</span><span class="op" id="5170240">:</span>&nbsp;<span class="string" id="5170242">&#34;&amp;#39;&#34;</span><span class="op" id="5170249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5170252">&#39;+&#39;</span><span class="op" id="5170255">:</span>&nbsp;&nbsp;<span class="string" id="5170258">&#34;&amp;#43;&#34;</span><span class="op" id="5170265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5170268">&#39;&lt;&#39;</span><span class="op" id="5170271">:</span>&nbsp;&nbsp;<span class="string" id="5170274">&#34;&amp;lt;&#34;</span><span class="op" id="5170280">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5170283">&#39;&gt;&#39;</span><span class="op" id="5170286">:</span>&nbsp;&nbsp;<span class="string" id="5170289">&#34;&amp;gt;&#34;</span><span class="op" id="5170295">,</span><br>
<span class="lineno"></span><span class="op" id="5170297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5170300">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5170376">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="5170418">var</span>&nbsp;<span class="ident" id="5170422">htmlNormReplacementTable</span>&nbsp;<span class="op" id="5170447">=</span>&nbsp;<span class="op" id="5170449">[</span><span class="op" id="5170450">]</span><span class="builtintype" id="5170451">string</span><span class="op" id="5170457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5170460">0</span><span class="op" id="5170461">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5170466">&#34;\uFFFD&#34;</span><span class="op" id="5170474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5170477">&#39;&#34;&#39;</span><span class="op" id="5170480">:</span>&nbsp;&nbsp;<span class="string" id="5170483">&#34;&amp;#34;&#34;</span><span class="op" id="5170490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5170493">&#39;\&#39;&#39;</span><span class="op" id="5170497">:</span>&nbsp;<span class="string" id="5170499">&#34;&amp;#39;&#34;</span><span class="op" id="5170506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5170509">&#39;+&#39;</span><span class="op" id="5170512">:</span>&nbsp;&nbsp;<span class="string" id="5170515">&#34;&amp;#43;&#34;</span><span class="op" id="5170522">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5170525">&#39;&lt;&#39;</span><span class="op" id="5170528">:</span>&nbsp;&nbsp;<span class="string" id="5170531">&#34;&amp;lt;&#34;</span><span class="op" id="5170537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5170540">&#39;&gt;&#39;</span><span class="op" id="5170543">:</span>&nbsp;&nbsp;<span class="string" id="5170546">&#34;&amp;gt;&#34;</span><span class="op" id="5170552">,</span><br>
<span class="lineno"></span><span class="op" id="5170554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5170557">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="5170631">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5170670">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5170736">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="5170793">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="5170813">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="5170839">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="5170897">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5170932">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="5170965">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5171027">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="5171071">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5171140">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5171145">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="5171178">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="5171195">var</span>&nbsp;<span class="ident" id="5171199">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="5171227">=</span>&nbsp;<span class="op" id="5171229">[</span><span class="op" id="5171230">]</span><span class="builtintype" id="5171231">string</span><span class="op" id="5171237">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5171240">0</span><span class="op" id="5171241">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5171246">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5171256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171259">&#39;\t&#39;</span><span class="op" id="5171263">:</span>&nbsp;<span class="string" id="5171265">&#34;&amp;#9;&#34;</span><span class="op" id="5171271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171274">&#39;\n&#39;</span><span class="op" id="5171278">:</span>&nbsp;<span class="string" id="5171280">&#34;&amp;#10;&#34;</span><span class="op" id="5171287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171290">&#39;\v&#39;</span><span class="op" id="5171294">:</span>&nbsp;<span class="string" id="5171296">&#34;&amp;#11;&#34;</span><span class="op" id="5171303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171306">&#39;\f&#39;</span><span class="op" id="5171310">:</span>&nbsp;<span class="string" id="5171312">&#34;&amp;#12;&#34;</span><span class="op" id="5171319">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171322">&#39;\r&#39;</span><span class="op" id="5171326">:</span>&nbsp;<span class="string" id="5171328">&#34;&amp;#13;&#34;</span><span class="op" id="5171335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171338">&#39;&nbsp;&#39;</span><span class="op" id="5171341">:</span>&nbsp;&nbsp;<span class="string" id="5171344">&#34;&amp;#32;&#34;</span><span class="op" id="5171351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171354">&#39;&#34;&#39;</span><span class="op" id="5171357">:</span>&nbsp;&nbsp;<span class="string" id="5171360">&#34;&amp;#34;&#34;</span><span class="op" id="5171367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171370">&#39;&amp;&#39;</span><span class="op" id="5171373">:</span>&nbsp;&nbsp;<span class="string" id="5171376">&#34;&amp;amp;&#34;</span><span class="op" id="5171383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171386">&#39;\&#39;&#39;</span><span class="op" id="5171390">:</span>&nbsp;<span class="string" id="5171392">&#34;&amp;#39;&#34;</span><span class="op" id="5171399">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171402">&#39;+&#39;</span><span class="op" id="5171405">:</span>&nbsp;&nbsp;<span class="string" id="5171408">&#34;&amp;#43;&#34;</span><span class="op" id="5171415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171418">&#39;&lt;&#39;</span><span class="op" id="5171421">:</span>&nbsp;&nbsp;<span class="string" id="5171424">&#34;&amp;lt;&#34;</span><span class="op" id="5171430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171433">&#39;=&#39;</span><span class="op" id="5171436">:</span>&nbsp;&nbsp;<span class="string" id="5171439">&#34;&amp;#61;&#34;</span><span class="op" id="5171446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171449">&#39;&gt;&#39;</span><span class="op" id="5171452">:</span>&nbsp;&nbsp;<span class="string" id="5171455">&#34;&amp;gt;&#34;</span><span class="op" id="5171461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5171464">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5171520">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5171555">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171597">&#39;`&#39;</span><span class="op" id="5171600">:</span>&nbsp;<span class="string" id="5171602">&#34;&amp;#96;&#34;</span><span class="op" id="5171609">,</span><br>
<span class="lineno"></span><span class="op" id="5171611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5171614">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="5171689">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="5171746">var</span>&nbsp;<span class="ident" id="5171750">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="5171782">=</span>&nbsp;<span class="op" id="5171784">[</span><span class="op" id="5171785">]</span><span class="builtintype" id="5171786">string</span><span class="op" id="5171792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5171795">0</span><span class="op" id="5171796">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5171801">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5171811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171814">&#39;\t&#39;</span><span class="op" id="5171818">:</span>&nbsp;<span class="string" id="5171820">&#34;&amp;#9;&#34;</span><span class="op" id="5171826">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171829">&#39;\n&#39;</span><span class="op" id="5171833">:</span>&nbsp;<span class="string" id="5171835">&#34;&amp;#10;&#34;</span><span class="op" id="5171842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171845">&#39;\v&#39;</span><span class="op" id="5171849">:</span>&nbsp;<span class="string" id="5171851">&#34;&amp;#11;&#34;</span><span class="op" id="5171858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171861">&#39;\f&#39;</span><span class="op" id="5171865">:</span>&nbsp;<span class="string" id="5171867">&#34;&amp;#12;&#34;</span><span class="op" id="5171874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171877">&#39;\r&#39;</span><span class="op" id="5171881">:</span>&nbsp;<span class="string" id="5171883">&#34;&amp;#13;&#34;</span><span class="op" id="5171890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171893">&#39;&nbsp;&#39;</span><span class="op" id="5171896">:</span>&nbsp;&nbsp;<span class="string" id="5171899">&#34;&amp;#32;&#34;</span><span class="op" id="5171906">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171909">&#39;&#34;&#39;</span><span class="op" id="5171912">:</span>&nbsp;&nbsp;<span class="string" id="5171915">&#34;&amp;#34;&#34;</span><span class="op" id="5171922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171925">&#39;\&#39;&#39;</span><span class="op" id="5171929">:</span>&nbsp;<span class="string" id="5171931">&#34;&amp;#39;&#34;</span><span class="op" id="5171938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171941">&#39;+&#39;</span><span class="op" id="5171944">:</span>&nbsp;&nbsp;<span class="string" id="5171947">&#34;&amp;#43;&#34;</span><span class="op" id="5171954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171957">&#39;&lt;&#39;</span><span class="op" id="5171960">:</span>&nbsp;&nbsp;<span class="string" id="5171963">&#34;&amp;lt;&#34;</span><span class="op" id="5171969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171972">&#39;=&#39;</span><span class="op" id="5171975">:</span>&nbsp;&nbsp;<span class="string" id="5171978">&#34;&amp;#61;&#34;</span><span class="op" id="5171985">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171988">&#39;&gt;&#39;</span><span class="op" id="5171991">:</span>&nbsp;&nbsp;<span class="string" id="5171994">&#34;&amp;gt;&#34;</span><span class="op" id="5172000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5172003">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5172059">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5172094">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5172136">&#39;`&#39;</span><span class="op" id="5172139">:</span>&nbsp;<span class="string" id="5172141">&#34;&amp;#96;&#34;</span><span class="op" id="5172148">,</span><br>
<span class="lineno">135</span><span class="op" id="5172150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5172153">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="5172229">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="5172308">func</span>&nbsp;<span class="ident" id="5172313">htmlReplacer</span><span class="op" id="5172325">(</span><span class="ident" id="5172326">s</span>&nbsp;<span class="builtintype" id="5172328">string</span><span class="op" id="5172334">,</span>&nbsp;<span class="ident" id="5172336">replacementTable</span>&nbsp;<span class="op" id="5172353">[</span><span class="op" id="5172354">]</span><span class="builtintype" id="5172355">string</span><span class="op" id="5172361">,</span>&nbsp;<span class="ident" id="5172363">badRunes</span>&nbsp;<span class="builtintype" id="5172372">bool</span><span class="op" id="5172376">)</span>&nbsp;<span class="builtintype" id="5172378">string</span>&nbsp;<span class="op" id="5172385">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172388">written</span><span class="op" id="5172395">,</span>&nbsp;<span class="ident" id="5172397">b</span>&nbsp;<span class="op" id="5172399">:=</span>&nbsp;<span class="num" id="5172402">0</span><span class="op" id="5172403">,</span>&nbsp;<span class="builtinfunc" id="5172405">new</span><span class="op" id="5172408">(</span><span class="ident" id="5172409">bytes</span><span class="op" id="5172414">.</span><span class="ident" id="5172415">Buffer</span><span class="op" id="5172421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5172424">for</span>&nbsp;<span class="ident" id="5172428">i</span><span class="op" id="5172429">,</span>&nbsp;<span class="ident" id="5172431">r</span>&nbsp;<span class="op" id="5172433">:=</span>&nbsp;<span class="keyword" id="5172436">range</span>&nbsp;<span class="ident" id="5172442">s</span>&nbsp;<span class="op" id="5172444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5172448">if</span>&nbsp;<span class="builtintype" id="5172451">int</span><span class="op" id="5172454">(</span><span class="ident" id="5172455">r</span><span class="op" id="5172456">)</span>&nbsp;<span class="op" id="5172458">&lt;</span>&nbsp;<span class="builtinfunc" id="5172460">len</span><span class="op" id="5172463">(</span><span class="ident" id="5172464">replacementTable</span><span class="op" id="5172480">)</span>&nbsp;<span class="op" id="5172482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5172487">if</span>&nbsp;<span class="ident" id="5172490">repl</span>&nbsp;<span class="op" id="5172495">:=</span>&nbsp;<span class="ident" id="5172498">replacementTable</span><span class="op" id="5172514">[</span><span class="ident" id="5172515">r</span><span class="op" id="5172516">]</span><span class="op" id="5172517">;</span>&nbsp;<span class="builtinfunc" id="5172519">len</span><span class="op" id="5172522">(</span><span class="ident" id="5172523">repl</span><span class="op" id="5172527">)</span>&nbsp;<span class="op" id="5172529">!=</span>&nbsp;<span class="num" id="5172532">0</span>&nbsp;<span class="op" id="5172534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172540">b</span><span class="op" id="5172541">.</span><span class="ident" id="5172542">WriteString</span><span class="op" id="5172553">(</span><span class="ident" id="5172554">s</span><span class="op" id="5172555">[</span><span class="ident" id="5172556">written</span><span class="op" id="5172563">:</span><span class="ident" id="5172564">i</span><span class="op" id="5172565">]</span><span class="op" id="5172566">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172572">b</span><span class="op" id="5172573">.</span><span class="ident" id="5172574">WriteString</span><span class="op" id="5172585">(</span><span class="ident" id="5172586">repl</span><span class="op" id="5172590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5172596">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5172645">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172681">written</span>&nbsp;<span class="op" id="5172689">=</span>&nbsp;<span class="ident" id="5172691">i</span>&nbsp;<span class="op" id="5172693">+</span>&nbsp;<span class="ident" id="5172695">utf8</span><span class="op" id="5172699">.</span><span class="ident" id="5172700">RuneLen</span><span class="op" id="5172707">(</span><span class="ident" id="5172708">r</span><span class="op" id="5172709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5172714">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5172718">}</span>&nbsp;<span class="keyword" id="5172720">else</span>&nbsp;<span class="keyword" id="5172725">if</span>&nbsp;<span class="ident" id="5172728">badRunes</span>&nbsp;<span class="op" id="5172737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5172742">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5172755">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5172810">}</span>&nbsp;<span class="keyword" id="5172812">else</span>&nbsp;<span class="keyword" id="5172817">if</span>&nbsp;<span class="num" id="5172820">0xfdd0</span>&nbsp;<span class="op" id="5172827">&lt;=</span>&nbsp;<span class="ident" id="5172830">r</span>&nbsp;<span class="op" id="5172832">&amp;&amp;</span>&nbsp;<span class="ident" id="5172835">r</span>&nbsp;<span class="op" id="5172837">&lt;=</span>&nbsp;<span class="num" id="5172840">0xfdef</span>&nbsp;<span class="op" id="5172847">||</span>&nbsp;<span class="num" id="5172850">0xfff0</span>&nbsp;<span class="op" id="5172857">&lt;=</span>&nbsp;<span class="ident" id="5172860">r</span>&nbsp;<span class="op" id="5172862">&amp;&amp;</span>&nbsp;<span class="ident" id="5172865">r</span>&nbsp;<span class="op" id="5172867">&lt;=</span>&nbsp;<span class="num" id="5172870">0xffff</span>&nbsp;<span class="op" id="5172877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172882">fmt</span><span class="op" id="5172885">.</span><span class="ident" id="5172886">Fprintf</span><span class="op" id="5172893">(</span><span class="ident" id="5172894">b</span><span class="op" id="5172895">,</span>&nbsp;<span class="string" id="5172897">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="5172907">,</span>&nbsp;<span class="ident" id="5172909">s</span><span class="op" id="5172910">[</span><span class="ident" id="5172911">written</span><span class="op" id="5172918">:</span><span class="ident" id="5172919">i</span><span class="op" id="5172920">]</span><span class="op" id="5172921">,</span>&nbsp;<span class="ident" id="5172923">r</span><span class="op" id="5172924">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172929">written</span>&nbsp;<span class="op" id="5172937">=</span>&nbsp;<span class="ident" id="5172939">i</span>&nbsp;<span class="op" id="5172941">+</span>&nbsp;<span class="ident" id="5172943">utf8</span><span class="op" id="5172947">.</span><span class="ident" id="5172948">RuneLen</span><span class="op" id="5172955">(</span><span class="ident" id="5172956">r</span><span class="op" id="5172957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5172961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5172964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5172967">if</span>&nbsp;<span class="ident" id="5172970">written</span>&nbsp;<span class="op" id="5172978">==</span>&nbsp;<span class="num" id="5172981">0</span>&nbsp;<span class="op" id="5172983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5172987">return</span>&nbsp;<span class="ident" id="5172994">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5172997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5173000">b</span><span class="op" id="5173001">.</span><span class="ident" id="5173002">WriteString</span><span class="op" id="5173013">(</span><span class="ident" id="5173014">s</span><span class="op" id="5173015">[</span><span class="ident" id="5173016">written</span><span class="op" id="5173023">:</span><span class="op" id="5173024">]</span><span class="op" id="5173025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5173028">return</span>&nbsp;<span class="ident" id="5173035">b</span><span class="op" id="5173036">.</span><span class="ident" id="5173037">String</span><span class="op" id="5173043">(</span><span class="op" id="5173044">)</span><br>
<span class="lineno"></span><span class="op" id="5173046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5173049">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="5173121">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="5173196">func</span>&nbsp;<span class="ident" id="5173201">stripTags</span><span class="op" id="5173210">(</span><span class="ident" id="5173211">html</span>&nbsp;<span class="builtintype" id="5173216">string</span><span class="op" id="5173222">)</span>&nbsp;<span class="builtintype" id="5173224">string</span>&nbsp;<span class="op" id="5173231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5173234">var</span>&nbsp;<span class="ident" id="5173238">b</span>&nbsp;<span class="ident" id="5173240">bytes</span><span class="op" id="5173245">.</span><span class="ident" id="5173246">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5173254">s</span><span class="op" id="5173255">,</span>&nbsp;<span class="ident" id="5173257">c</span><span class="op" id="5173258">,</span>&nbsp;<span class="ident" id="5173260">i</span><span class="op" id="5173261">,</span>&nbsp;<span class="ident" id="5173263">allText</span>&nbsp;<span class="op" id="5173271">:=</span>&nbsp;<span class="op" id="5173274">[</span><span class="op" id="5173275">]</span><span class="builtintype" id="5173276">byte</span><span class="op" id="5173280">(</span><span class="ident" id="5173281">html</span><span class="op" id="5173285">)</span><span class="op" id="5173286">,</span>&nbsp;<span class="ident" id="5173288">context</span><span class="op" id="5173295">{</span><span class="op" id="5173296">}</span><span class="op" id="5173297">,</span>&nbsp;<span class="num" id="5173299">0</span><span class="op" id="5173300">,</span>&nbsp;<span class="builtintype" id="5173302">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5173308">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5173363">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5173406">for</span>&nbsp;<span class="ident" id="5173410">i</span>&nbsp;<span class="op" id="5173412">!=</span>&nbsp;<span class="builtinfunc" id="5173415">len</span><span class="op" id="5173418">(</span><span class="ident" id="5173419">s</span><span class="op" id="5173420">)</span>&nbsp;<span class="op" id="5173422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5173426">if</span>&nbsp;<span class="ident" id="5173429">c</span><span class="op" id="5173430">.</span><span class="ident" id="5173431">delim</span>&nbsp;<span class="op" id="5173437">==</span>&nbsp;<span class="ident" id="5173440">delimNone</span>&nbsp;<span class="op" id="5173450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5173455">st</span>&nbsp;<span class="op" id="5173458">:=</span>&nbsp;<span class="ident" id="5173461">c</span><span class="op" id="5173462">.</span><span class="ident" id="5173463">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5173472">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5173531">if</span>&nbsp;<span class="ident" id="5173534">c</span><span class="op" id="5173535">.</span><span class="ident" id="5173536">element</span>&nbsp;<span class="op" id="5173544">!=</span>&nbsp;<span class="ident" id="5173547">elementNone</span>&nbsp;<span class="op" id="5173559">&amp;&amp;</span>&nbsp;<span class="op" id="5173562">!</span><span class="ident" id="5173563">isInTag</span><span class="op" id="5173570">(</span><span class="ident" id="5173571">st</span><span class="op" id="5173573">)</span>&nbsp;<span class="op" id="5173575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5173581">st</span>&nbsp;<span class="op" id="5173584">=</span>&nbsp;<span class="ident" id="5173586">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5173601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5173606">d</span><span class="op" id="5173607">,</span>&nbsp;<span class="ident" id="5173609">nread</span>&nbsp;<span class="op" id="5173615">:=</span>&nbsp;<span class="ident" id="5173618">transitionFunc</span><span class="op" id="5173632">[</span><span class="ident" id="5173633">st</span><span class="op" id="5173635">]</span><span class="op" id="5173636">(</span><span class="ident" id="5173637">c</span><span class="op" id="5173638">,</span>&nbsp;<span class="ident" id="5173640">s</span><span class="op" id="5173641">[</span><span class="ident" id="5173642">i</span><span class="op" id="5173643">:</span><span class="op" id="5173644">]</span><span class="op" id="5173645">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5173650">i1</span>&nbsp;<span class="op" id="5173653">:=</span>&nbsp;<span class="ident" id="5173656">i</span>&nbsp;<span class="op" id="5173658">+</span>&nbsp;<span class="ident" id="5173660">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5173669">if</span>&nbsp;<span class="ident" id="5173672">c</span><span class="op" id="5173673">.</span><span class="ident" id="5173674">state</span>&nbsp;<span class="op" id="5173680">==</span>&nbsp;<span class="ident" id="5173683">stateText</span>&nbsp;<span class="op" id="5173693">||</span>&nbsp;<span class="ident" id="5173696">c</span><span class="op" id="5173697">.</span><span class="ident" id="5173698">state</span>&nbsp;<span class="op" id="5173704">==</span>&nbsp;<span class="ident" id="5173707">stateRCDATA</span>&nbsp;<span class="op" id="5173719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5173725">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5173781">j</span>&nbsp;<span class="op" id="5173783">:=</span>&nbsp;<span class="ident" id="5173786">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5173793">if</span>&nbsp;<span class="ident" id="5173796">d</span><span class="op" id="5173797">.</span><span class="ident" id="5173798">state</span>&nbsp;<span class="op" id="5173804">!=</span>&nbsp;<span class="ident" id="5173807">c</span><span class="op" id="5173808">.</span><span class="ident" id="5173809">state</span>&nbsp;<span class="op" id="5173815">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5173822">for</span>&nbsp;<span class="ident" id="5173826">j1</span>&nbsp;<span class="op" id="5173829">:=</span>&nbsp;<span class="ident" id="5173832">j</span>&nbsp;<span class="op" id="5173834">-</span>&nbsp;<span class="num" id="5173836">1</span><span class="op" id="5173837">;</span>&nbsp;<span class="ident" id="5173839">j1</span>&nbsp;<span class="op" id="5173842">&gt;=</span>&nbsp;<span class="ident" id="5173845">i</span><span class="op" id="5173846">;</span>&nbsp;<span class="ident" id="5173848">j1</span><span class="op" id="5173850">--</span>&nbsp;<span class="op" id="5173853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5173861">if</span>&nbsp;<span class="ident" id="5173864">s</span><span class="op" id="5173865">[</span><span class="ident" id="5173866">j1</span><span class="op" id="5173868">]</span>&nbsp;<span class="op" id="5173870">==</span>&nbsp;<span class="string" id="5173873">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5173877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5173886">j</span>&nbsp;<span class="op" id="5173888">=</span>&nbsp;<span class="ident" id="5173890">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5173900">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5173912">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5173919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5173925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5173931">b</span><span class="op" id="5173932">.</span><span class="ident" id="5173933">Write</span><span class="op" id="5173938">(</span><span class="ident" id="5173939">s</span><span class="op" id="5173940">[</span><span class="ident" id="5173941">i</span><span class="op" id="5173942">:</span><span class="ident" id="5173943">j</span><span class="op" id="5173944">]</span><span class="op" id="5173945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5173950">}</span>&nbsp;<span class="keyword" id="5173952">else</span>&nbsp;<span class="op" id="5173957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5173963">allText</span>&nbsp;<span class="op" id="5173971">=</span>&nbsp;<span class="builtintype" id="5173973">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5173982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5173987">c</span><span class="op" id="5173988">,</span>&nbsp;<span class="ident" id="5173990">i</span>&nbsp;<span class="op" id="5173992">=</span>&nbsp;<span class="ident" id="5173994">d</span><span class="op" id="5173995">,</span>&nbsp;<span class="ident" id="5173997">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174003">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5174014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174018">i1</span>&nbsp;<span class="op" id="5174021">:=</span>&nbsp;<span class="ident" id="5174024">i</span>&nbsp;<span class="op" id="5174026">+</span>&nbsp;<span class="ident" id="5174028">bytes</span><span class="op" id="5174033">.</span><span class="ident" id="5174034">IndexAny</span><span class="op" id="5174042">(</span><span class="ident" id="5174043">s</span><span class="op" id="5174044">[</span><span class="ident" id="5174045">i</span><span class="op" id="5174046">:</span><span class="op" id="5174047">]</span><span class="op" id="5174048">,</span>&nbsp;<span class="ident" id="5174050">delimEnds</span><span class="op" id="5174059">[</span><span class="ident" id="5174060">c</span><span class="op" id="5174061">.</span><span class="ident" id="5174062">delim</span><span class="op" id="5174067">]</span><span class="op" id="5174068">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174072">if</span>&nbsp;<span class="ident" id="5174075">i1</span>&nbsp;<span class="op" id="5174078">&lt;</span>&nbsp;<span class="ident" id="5174080">i</span>&nbsp;<span class="op" id="5174082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174087">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5174095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174099">if</span>&nbsp;<span class="ident" id="5174102">c</span><span class="op" id="5174103">.</span><span class="ident" id="5174104">delim</span>&nbsp;<span class="op" id="5174110">!=</span>&nbsp;<span class="ident" id="5174113">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="5174132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5174137">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174162">i1</span><span class="op" id="5174164">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5174169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174173">c</span><span class="op" id="5174174">,</span>&nbsp;<span class="ident" id="5174176">i</span>&nbsp;<span class="op" id="5174178">=</span>&nbsp;<span class="ident" id="5174180">context</span><span class="op" id="5174187">{</span><span class="ident" id="5174188">state</span><span class="op" id="5174193">:</span>&nbsp;<span class="ident" id="5174195">stateTag</span><span class="op" id="5174203">,</span>&nbsp;<span class="ident" id="5174205">element</span><span class="op" id="5174212">:</span>&nbsp;<span class="ident" id="5174214">c</span><span class="op" id="5174215">.</span><span class="ident" id="5174216">element</span><span class="op" id="5174223">}</span><span class="op" id="5174224">,</span>&nbsp;<span class="ident" id="5174226">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5174230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174233">if</span>&nbsp;<span class="ident" id="5174236">allText</span>&nbsp;<span class="op" id="5174244">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174248">return</span>&nbsp;<span class="ident" id="5174255">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5174261">}</span>&nbsp;<span class="keyword" id="5174263">else</span>&nbsp;<span class="keyword" id="5174268">if</span>&nbsp;<span class="ident" id="5174271">c</span><span class="op" id="5174272">.</span><span class="ident" id="5174273">state</span>&nbsp;<span class="op" id="5174279">==</span>&nbsp;<span class="ident" id="5174282">stateText</span>&nbsp;<span class="op" id="5174292">||</span>&nbsp;<span class="ident" id="5174295">c</span><span class="op" id="5174296">.</span><span class="ident" id="5174297">state</span>&nbsp;<span class="op" id="5174303">==</span>&nbsp;<span class="ident" id="5174306">stateRCDATA</span>&nbsp;<span class="op" id="5174318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174322">b</span><span class="op" id="5174323">.</span><span class="ident" id="5174324">Write</span><span class="op" id="5174329">(</span><span class="ident" id="5174330">s</span><span class="op" id="5174331">[</span><span class="ident" id="5174332">i</span><span class="op" id="5174333">:</span><span class="op" id="5174334">]</span><span class="op" id="5174335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5174338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174341">return</span>&nbsp;<span class="ident" id="5174348">b</span><span class="op" id="5174349">.</span><span class="ident" id="5174350">String</span><span class="op" id="5174356">(</span><span class="op" id="5174357">)</span><br>
<span class="lineno">215</span><span class="op" id="5174359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5174362">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5174436">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="5174468">func</span>&nbsp;<span class="ident" id="5174473">htmlNameFilter</span><span class="op" id="5174487">(</span><span class="ident" id="5174488">args</span>&nbsp;<span class="op" id="5174493">...</span><span class="keyword" id="5174496">interface</span><span class="op" id="5174505">{</span><span class="op" id="5174506">}</span><span class="op" id="5174507">)</span>&nbsp;<span class="builtintype" id="5174509">string</span>&nbsp;<span class="op" id="5174516">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174519">s</span><span class="op" id="5174520">,</span>&nbsp;<span class="ident" id="5174522">t</span>&nbsp;<span class="op" id="5174524">:=</span>&nbsp;<span class="ident" id="5174527">stringify</span><span class="op" id="5174536">(</span><span class="ident" id="5174537">args</span><span class="op" id="5174541">...</span><span class="op" id="5174544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174547">if</span>&nbsp;<span class="ident" id="5174550">t</span>&nbsp;<span class="op" id="5174552">==</span>&nbsp;<span class="ident" id="5174555">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="5174575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174579">return</span>&nbsp;<span class="ident" id="5174586">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5174589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174592">if</span>&nbsp;<span class="builtinfunc" id="5174595">len</span><span class="op" id="5174598">(</span><span class="ident" id="5174599">s</span><span class="op" id="5174600">)</span>&nbsp;<span class="op" id="5174602">==</span>&nbsp;<span class="num" id="5174605">0</span>&nbsp;<span class="op" id="5174607">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5174611">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5174659">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5174695">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5174753">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5174814">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174829">return</span>&nbsp;<span class="ident" id="5174836">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5174852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174855">s</span>&nbsp;<span class="op" id="5174857">=</span>&nbsp;<span class="ident" id="5174859">strings</span><span class="op" id="5174866">.</span><span class="ident" id="5174867">ToLower</span><span class="op" id="5174874">(</span><span class="ident" id="5174875">s</span><span class="op" id="5174876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174879">if</span>&nbsp;<span class="ident" id="5174882">t</span>&nbsp;<span class="op" id="5174884">:=</span>&nbsp;<span class="ident" id="5174887">attrType</span><span class="op" id="5174895">(</span><span class="ident" id="5174896">s</span><span class="op" id="5174897">)</span><span class="op" id="5174898">;</span>&nbsp;<span class="ident" id="5174900">t</span>&nbsp;<span class="op" id="5174902">!=</span>&nbsp;<span class="ident" id="5174905">contentTypePlain</span>&nbsp;<span class="op" id="5174922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5174926">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5174998">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175015">return</span>&nbsp;<span class="ident" id="5175022">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5175038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175041">for</span>&nbsp;<span class="ident" id="5175045">_</span><span class="op" id="5175046">,</span>&nbsp;<span class="ident" id="5175048">r</span>&nbsp;<span class="op" id="5175050">:=</span>&nbsp;<span class="keyword" id="5175053">range</span>&nbsp;<span class="ident" id="5175059">s</span>&nbsp;<span class="op" id="5175061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175065">switch</span>&nbsp;<span class="op" id="5175072">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175076">case</span>&nbsp;<span class="string" id="5175081">&#39;0&#39;</span>&nbsp;<span class="op" id="5175085">&lt;=</span>&nbsp;<span class="ident" id="5175088">r</span>&nbsp;<span class="op" id="5175090">&amp;&amp;</span>&nbsp;<span class="ident" id="5175093">r</span>&nbsp;<span class="op" id="5175095">&lt;=</span>&nbsp;<span class="string" id="5175098">&#39;9&#39;</span><span class="op" id="5175101">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175105">case</span>&nbsp;<span class="string" id="5175110">&#39;a&#39;</span>&nbsp;<span class="op" id="5175114">&lt;=</span>&nbsp;<span class="ident" id="5175117">r</span>&nbsp;<span class="op" id="5175119">&amp;&amp;</span>&nbsp;<span class="ident" id="5175122">r</span>&nbsp;<span class="op" id="5175124">&lt;=</span>&nbsp;<span class="string" id="5175127">&#39;z&#39;</span><span class="op" id="5175130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175134">default</span><span class="op" id="5175141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175146">return</span>&nbsp;<span class="ident" id="5175153">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5175170">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5175173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175176">return</span>&nbsp;<span class="ident" id="5175183">s</span><br>
<span class="lineno"></span><span class="op" id="5175185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5175188">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="5175252">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5175318">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="5175395">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5175434">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5175509">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="5175539">func</span>&nbsp;<span class="ident" id="5175544">commentEscaper</span><span class="op" id="5175558">(</span><span class="ident" id="5175559">args</span>&nbsp;<span class="op" id="5175564">...</span><span class="keyword" id="5175567">interface</span><span class="op" id="5175576">{</span><span class="op" id="5175577">}</span><span class="op" id="5175578">)</span>&nbsp;<span class="builtintype" id="5175580">string</span>&nbsp;<span class="op" id="5175587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175590">return</span>&nbsp;<span class="string" id="5175597">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5175600">}</span>
</div>
</body>
</html>
