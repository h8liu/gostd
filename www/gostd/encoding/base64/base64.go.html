<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html" class="current">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4255668">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4255723">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4255777">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4255828">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="4255899">package</span>&nbsp;<span class="ident" id="4255907">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4255915">import</span>&nbsp;<span class="op" id="4255922">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4255925">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4255934">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4255940">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4255951">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4255961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4255964">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4255985">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="4256053">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4256121">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="4256189">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4256259">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="4256322">type</span>&nbsp;<span class="ident" id="4256327">Encoding</span>&nbsp;<span class="keyword" id="4256336">struct</span>&nbsp;<span class="op" id="4256343">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256346">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4256356">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256364">decodeMap</span>&nbsp;<span class="op" id="4256374">[</span><span class="num" id="4256375">256</span><span class="op" id="4256378">]</span><span class="builtintype" id="4256379">byte</span><br>
<span class="lineno"></span><span class="op" id="4256384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4256387">const</span>&nbsp;<span class="ident" id="4256393">encodeStd</span>&nbsp;<span class="op" id="4256403">=</span>&nbsp;<span class="string" id="4256405">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="4256472">const</span>&nbsp;<span class="ident" id="4256478">encodeURL</span>&nbsp;<span class="op" id="4256488">=</span>&nbsp;<span class="string" id="4256490">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4256558">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="4256627">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4256662">func</span>&nbsp;<span class="ident" id="4256667">NewEncoding</span><span class="op" id="4256678">(</span><span class="ident" id="4256679">encoder</span>&nbsp;<span class="builtintype" id="4256687">string</span><span class="op" id="4256693">)</span>&nbsp;<span class="op" id="4256695">*</span><span class="ident" id="4256696">Encoding</span>&nbsp;<span class="op" id="4256705">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256708">e</span>&nbsp;<span class="op" id="4256710">:=</span>&nbsp;<span class="builtinfunc" id="4256713">new</span><span class="op" id="4256716">(</span><span class="ident" id="4256717">Encoding</span><span class="op" id="4256725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256728">e</span><span class="op" id="4256729">.</span><span class="ident" id="4256730">encode</span>&nbsp;<span class="op" id="4256737">=</span>&nbsp;<span class="ident" id="4256739">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256748">for</span>&nbsp;<span class="ident" id="4256752">i</span>&nbsp;<span class="op" id="4256754">:=</span>&nbsp;<span class="num" id="4256757">0</span><span class="op" id="4256758">;</span>&nbsp;<span class="ident" id="4256760">i</span>&nbsp;<span class="op" id="4256762">&lt;</span>&nbsp;<span class="builtinfunc" id="4256764">len</span><span class="op" id="4256767">(</span><span class="ident" id="4256768">e</span><span class="op" id="4256769">.</span><span class="ident" id="4256770">decodeMap</span><span class="op" id="4256779">)</span><span class="op" id="4256780">;</span>&nbsp;<span class="ident" id="4256782">i</span><span class="op" id="4256783">++</span>&nbsp;<span class="op" id="4256786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256790">e</span><span class="op" id="4256791">.</span><span class="ident" id="4256792">decodeMap</span><span class="op" id="4256801">[</span><span class="ident" id="4256802">i</span><span class="op" id="4256803">]</span>&nbsp;<span class="op" id="4256805">=</span>&nbsp;<span class="num" id="4256807">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256813">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256816">for</span>&nbsp;<span class="ident" id="4256820">i</span>&nbsp;<span class="op" id="4256822">:=</span>&nbsp;<span class="num" id="4256825">0</span><span class="op" id="4256826">;</span>&nbsp;<span class="ident" id="4256828">i</span>&nbsp;<span class="op" id="4256830">&lt;</span>&nbsp;<span class="builtinfunc" id="4256832">len</span><span class="op" id="4256835">(</span><span class="ident" id="4256836">encoder</span><span class="op" id="4256843">)</span><span class="op" id="4256844">;</span>&nbsp;<span class="ident" id="4256846">i</span><span class="op" id="4256847">++</span>&nbsp;<span class="op" id="4256850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256854">e</span><span class="op" id="4256855">.</span><span class="ident" id="4256856">decodeMap</span><span class="op" id="4256865">[</span><span class="ident" id="4256866">encoder</span><span class="op" id="4256873">[</span><span class="ident" id="4256874">i</span><span class="op" id="4256875">]</span><span class="op" id="4256876">]</span>&nbsp;<span class="op" id="4256878">=</span>&nbsp;<span class="builtintype" id="4256880">byte</span><span class="op" id="4256884">(</span><span class="ident" id="4256885">i</span><span class="op" id="4256886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256892">return</span>&nbsp;<span class="ident" id="4256899">e</span><br>
<span class="lineno"></span><span class="op" id="4256901">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4256904">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4256966">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="4256979">var</span>&nbsp;<span class="ident" id="4256983">StdEncoding</span>&nbsp;<span class="op" id="4256995">=</span>&nbsp;<span class="ident" id="4256997">NewEncoding</span><span class="op" id="4257008">(</span><span class="ident" id="4257009">encodeStd</span><span class="op" id="4257018">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4257021">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="4257090">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="4257138">var</span>&nbsp;<span class="ident" id="4257142">URLEncoding</span>&nbsp;<span class="op" id="4257154">=</span>&nbsp;<span class="ident" id="4257156">NewEncoding</span><span class="op" id="4257167">(</span><span class="ident" id="4257168">encodeURL</span><span class="op" id="4257177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4257180">var</span>&nbsp;<span class="ident" id="4257184">removeNewlinesMapper</span>&nbsp;<span class="op" id="4257205">=</span>&nbsp;<span class="keyword" id="4257207">func</span><span class="op" id="4257211">(</span><span class="ident" id="4257212">r</span>&nbsp;<span class="builtintype" id="4257214">rune</span><span class="op" id="4257218">)</span>&nbsp;<span class="builtintype" id="4257220">rune</span>&nbsp;<span class="op" id="4257225">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257228">if</span>&nbsp;<span class="ident" id="4257231">r</span>&nbsp;<span class="op" id="4257233">==</span>&nbsp;<span class="string" id="4257236">&#39;\r&#39;</span>&nbsp;<span class="op" id="4257241">||</span>&nbsp;<span class="ident" id="4257244">r</span>&nbsp;<span class="op" id="4257246">==</span>&nbsp;<span class="string" id="4257249">&#39;\n&#39;</span>&nbsp;<span class="op" id="4257254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257258">return</span>&nbsp;<span class="op" id="4257265">-</span><span class="num" id="4257266">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257272">return</span>&nbsp;<span class="ident" id="4257279">r</span><br>
<span class="lineno"></span><span class="op" id="4257281">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="4257284">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4257303">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="4257357">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="4257395">//</span><br>
<span class="lineno"></span><span class="comment" id="4257398">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="4257456">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="4257517">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="4257571">func</span>&nbsp;<span class="op" id="4257576">(</span><span class="ident" id="4257577">enc</span>&nbsp;<span class="op" id="4257581">*</span><span class="ident" id="4257582">Encoding</span><span class="op" id="4257590">)</span>&nbsp;<span class="ident" id="4257592">Encode</span><span class="op" id="4257598">(</span><span class="ident" id="4257599">dst</span><span class="op" id="4257602">,</span>&nbsp;<span class="ident" id="4257604">src</span>&nbsp;<span class="op" id="4257608">[</span><span class="op" id="4257609">]</span><span class="builtintype" id="4257610">byte</span><span class="op" id="4257614">)</span>&nbsp;<span class="op" id="4257616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257619">if</span>&nbsp;<span class="builtinfunc" id="4257622">len</span><span class="op" id="4257625">(</span><span class="ident" id="4257626">src</span><span class="op" id="4257629">)</span>&nbsp;<span class="op" id="4257631">==</span>&nbsp;<span class="num" id="4257634">0</span>&nbsp;<span class="op" id="4257636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257640">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257648">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257652">for</span>&nbsp;<span class="builtinfunc" id="4257656">len</span><span class="op" id="4257659">(</span><span class="ident" id="4257660">src</span><span class="op" id="4257663">)</span>&nbsp;<span class="op" id="4257665">&gt;</span>&nbsp;<span class="num" id="4257667">0</span>&nbsp;<span class="op" id="4257669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257673">var</span>&nbsp;<span class="ident" id="4257677">b0</span><span class="op" id="4257679">,</span>&nbsp;<span class="ident" id="4257681">b1</span><span class="op" id="4257683">,</span>&nbsp;<span class="ident" id="4257685">b2</span><span class="op" id="4257687">,</span>&nbsp;<span class="ident" id="4257689">b3</span>&nbsp;<span class="builtintype" id="4257692">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257700">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257749">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257774">switch</span>&nbsp;<span class="builtinfunc" id="4257781">len</span><span class="op" id="4257784">(</span><span class="ident" id="4257785">src</span><span class="op" id="4257788">)</span>&nbsp;<span class="op" id="4257790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257794">default</span><span class="op" id="4257801">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257806">b3</span>&nbsp;<span class="op" id="4257809">=</span>&nbsp;<span class="ident" id="4257811">src</span><span class="op" id="4257814">[</span><span class="num" id="4257815">2</span><span class="op" id="4257816">]</span>&nbsp;<span class="op" id="4257818">&amp;</span>&nbsp;<span class="num" id="4257820">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257828">b2</span>&nbsp;<span class="op" id="4257831">=</span>&nbsp;<span class="ident" id="4257833">src</span><span class="op" id="4257836">[</span><span class="num" id="4257837">2</span><span class="op" id="4257838">]</span>&nbsp;<span class="op" id="4257840">&gt;&gt;</span>&nbsp;<span class="num" id="4257843">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257848">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257862">case</span>&nbsp;<span class="num" id="4257867">2</span><span class="op" id="4257868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257873">b2</span>&nbsp;<span class="op" id="4257876">|=</span>&nbsp;<span class="op" id="4257879">(</span><span class="ident" id="4257880">src</span><span class="op" id="4257883">[</span><span class="num" id="4257884">1</span><span class="op" id="4257885">]</span>&nbsp;<span class="op" id="4257887">&lt;&lt;</span>&nbsp;<span class="num" id="4257890">2</span><span class="op" id="4257891">)</span>&nbsp;<span class="op" id="4257893">&amp;</span>&nbsp;<span class="num" id="4257895">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257903">b1</span>&nbsp;<span class="op" id="4257906">=</span>&nbsp;<span class="ident" id="4257908">src</span><span class="op" id="4257911">[</span><span class="num" id="4257912">1</span><span class="op" id="4257913">]</span>&nbsp;<span class="op" id="4257915">&gt;&gt;</span>&nbsp;<span class="num" id="4257918">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257923">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257937">case</span>&nbsp;<span class="num" id="4257942">1</span><span class="op" id="4257943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257948">b1</span>&nbsp;<span class="op" id="4257951">|=</span>&nbsp;<span class="op" id="4257954">(</span><span class="ident" id="4257955">src</span><span class="op" id="4257958">[</span><span class="num" id="4257959">0</span><span class="op" id="4257960">]</span>&nbsp;<span class="op" id="4257962">&lt;&lt;</span>&nbsp;<span class="num" id="4257965">4</span><span class="op" id="4257966">)</span>&nbsp;<span class="op" id="4257968">&amp;</span>&nbsp;<span class="num" id="4257970">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257978">b0</span>&nbsp;<span class="op" id="4257981">=</span>&nbsp;<span class="ident" id="4257983">src</span><span class="op" id="4257986">[</span><span class="num" id="4257987">0</span><span class="op" id="4257988">]</span>&nbsp;<span class="op" id="4257990">&gt;&gt;</span>&nbsp;<span class="num" id="4257993">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258002">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258053">dst</span><span class="op" id="4258056">[</span><span class="num" id="4258057">0</span><span class="op" id="4258058">]</span>&nbsp;<span class="op" id="4258060">=</span>&nbsp;<span class="ident" id="4258062">enc</span><span class="op" id="4258065">.</span><span class="ident" id="4258066">encode</span><span class="op" id="4258072">[</span><span class="ident" id="4258073">b0</span><span class="op" id="4258075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258079">dst</span><span class="op" id="4258082">[</span><span class="num" id="4258083">1</span><span class="op" id="4258084">]</span>&nbsp;<span class="op" id="4258086">=</span>&nbsp;<span class="ident" id="4258088">enc</span><span class="op" id="4258091">.</span><span class="ident" id="4258092">encode</span><span class="op" id="4258098">[</span><span class="ident" id="4258099">b1</span><span class="op" id="4258101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258105">dst</span><span class="op" id="4258108">[</span><span class="num" id="4258109">2</span><span class="op" id="4258110">]</span>&nbsp;<span class="op" id="4258112">=</span>&nbsp;<span class="ident" id="4258114">enc</span><span class="op" id="4258117">.</span><span class="ident" id="4258118">encode</span><span class="op" id="4258124">[</span><span class="ident" id="4258125">b2</span><span class="op" id="4258127">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258131">dst</span><span class="op" id="4258134">[</span><span class="num" id="4258135">3</span><span class="op" id="4258136">]</span>&nbsp;<span class="op" id="4258138">=</span>&nbsp;<span class="ident" id="4258140">enc</span><span class="op" id="4258143">.</span><span class="ident" id="4258144">encode</span><span class="op" id="4258150">[</span><span class="ident" id="4258151">b3</span><span class="op" id="4258153">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258158">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258185">if</span>&nbsp;<span class="builtinfunc" id="4258188">len</span><span class="op" id="4258191">(</span><span class="ident" id="4258192">src</span><span class="op" id="4258195">)</span>&nbsp;<span class="op" id="4258197">&lt;</span>&nbsp;<span class="num" id="4258199">3</span>&nbsp;<span class="op" id="4258201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258206">dst</span><span class="op" id="4258209">[</span><span class="num" id="4258210">3</span><span class="op" id="4258211">]</span>&nbsp;<span class="op" id="4258213">=</span>&nbsp;<span class="string" id="4258215">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258222">if</span>&nbsp;<span class="builtinfunc" id="4258225">len</span><span class="op" id="4258228">(</span><span class="ident" id="4258229">src</span><span class="op" id="4258232">)</span>&nbsp;<span class="op" id="4258234">&lt;</span>&nbsp;<span class="num" id="4258236">2</span>&nbsp;<span class="op" id="4258238">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258244">dst</span><span class="op" id="4258247">[</span><span class="num" id="4258248">2</span><span class="op" id="4258249">]</span>&nbsp;<span class="op" id="4258251">=</span>&nbsp;<span class="string" id="4258253">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258265">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258278">src</span>&nbsp;<span class="op" id="4258282">=</span>&nbsp;<span class="ident" id="4258284">src</span><span class="op" id="4258287">[</span><span class="num" id="4258288">3</span><span class="op" id="4258289">:</span><span class="op" id="4258290">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258294">dst</span>&nbsp;<span class="op" id="4258298">=</span>&nbsp;<span class="ident" id="4258300">dst</span><span class="op" id="4258303">[</span><span class="num" id="4258304">4</span><span class="op" id="4258305">:</span><span class="op" id="4258306">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258309">}</span><br>
<span class="lineno"></span><span class="op" id="4258311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4258314">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="4258368">func</span>&nbsp;<span class="op" id="4258373">(</span><span class="ident" id="4258374">enc</span>&nbsp;<span class="op" id="4258378">*</span><span class="ident" id="4258379">Encoding</span><span class="op" id="4258387">)</span>&nbsp;<span class="ident" id="4258389">EncodeToString</span><span class="op" id="4258403">(</span><span class="ident" id="4258404">src</span>&nbsp;<span class="op" id="4258408">[</span><span class="op" id="4258409">]</span><span class="builtintype" id="4258410">byte</span><span class="op" id="4258414">)</span>&nbsp;<span class="builtintype" id="4258416">string</span>&nbsp;<span class="op" id="4258423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258426">buf</span>&nbsp;<span class="op" id="4258430">:=</span>&nbsp;<span class="builtinfunc" id="4258433">make</span><span class="op" id="4258437">(</span><span class="op" id="4258438">[</span><span class="op" id="4258439">]</span><span class="builtintype" id="4258440">byte</span><span class="op" id="4258444">,</span>&nbsp;<span class="ident" id="4258446">enc</span><span class="op" id="4258449">.</span><span class="ident" id="4258450">EncodedLen</span><span class="op" id="4258460">(</span><span class="builtinfunc" id="4258461">len</span><span class="op" id="4258464">(</span><span class="ident" id="4258465">src</span><span class="op" id="4258468">)</span><span class="op" id="4258469">)</span><span class="op" id="4258470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258473">enc</span><span class="op" id="4258476">.</span><span class="ident" id="4258477">Encode</span><span class="op" id="4258483">(</span><span class="ident" id="4258484">buf</span><span class="op" id="4258487">,</span>&nbsp;<span class="ident" id="4258489">src</span><span class="op" id="4258492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258495">return</span>&nbsp;<span class="builtintype" id="4258502">string</span><span class="op" id="4258508">(</span><span class="ident" id="4258509">buf</span><span class="op" id="4258512">)</span><br>
<span class="lineno">120</span><span class="op" id="4258514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4258517">type</span>&nbsp;<span class="ident" id="4258522">encoder</span>&nbsp;<span class="keyword" id="4258530">struct</span>&nbsp;<span class="op" id="4258537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258540">err</span>&nbsp;&nbsp;<span class="builtintype" id="4258545">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258552">enc</span>&nbsp;&nbsp;<span class="op" id="4258557">*</span><span class="ident" id="4258558">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258568">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258573">io</span><span class="op" id="4258575">.</span><span class="ident" id="4258576">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258584">buf</span>&nbsp;&nbsp;<span class="op" id="4258589">[</span><span class="num" id="4258590">3</span><span class="op" id="4258591">]</span><span class="builtintype" id="4258592">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258600">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258640">nbuf</span>&nbsp;<span class="builtintype" id="4258645">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258656">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258683">out</span>&nbsp;&nbsp;<span class="op" id="4258688">[</span><span class="num" id="4258689">1024</span><span class="op" id="4258693">]</span><span class="builtintype" id="4258694">byte</span>&nbsp;<span class="comment" id="4258699">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="4258716">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="4258719">func</span>&nbsp;<span class="op" id="4258724">(</span><span class="ident" id="4258725">e</span>&nbsp;<span class="op" id="4258727">*</span><span class="ident" id="4258728">encoder</span><span class="op" id="4258735">)</span>&nbsp;<span class="ident" id="4258737">Write</span><span class="op" id="4258742">(</span><span class="ident" id="4258743">p</span>&nbsp;<span class="op" id="4258745">[</span><span class="op" id="4258746">]</span><span class="builtintype" id="4258747">byte</span><span class="op" id="4258751">)</span>&nbsp;<span class="op" id="4258753">(</span><span class="ident" id="4258754">n</span>&nbsp;<span class="builtintype" id="4258756">int</span><span class="op" id="4258759">,</span>&nbsp;<span class="ident" id="4258761">err</span>&nbsp;<span class="builtintype" id="4258765">error</span><span class="op" id="4258770">)</span>&nbsp;<span class="op" id="4258772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258775">if</span>&nbsp;<span class="ident" id="4258778">e</span><span class="op" id="4258779">.</span><span class="ident" id="4258780">err</span>&nbsp;<span class="op" id="4258784">!=</span>&nbsp;<span class="builtintype" id="4258787">nil</span>&nbsp;<span class="op" id="4258791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258795">return</span>&nbsp;<span class="num" id="4258802">0</span><span class="op" id="4258803">,</span>&nbsp;<span class="ident" id="4258805">e</span><span class="op" id="4258806">.</span><span class="ident" id="4258807">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258812">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258816">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258836">if</span>&nbsp;<span class="ident" id="4258839">e</span><span class="op" id="4258840">.</span><span class="ident" id="4258841">nbuf</span>&nbsp;<span class="op" id="4258846">&gt;</span>&nbsp;<span class="num" id="4258848">0</span>&nbsp;<span class="op" id="4258850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258854">var</span>&nbsp;<span class="ident" id="4258858">i</span>&nbsp;<span class="builtintype" id="4258860">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258866">for</span>&nbsp;<span class="ident" id="4258870">i</span>&nbsp;<span class="op" id="4258872">=</span>&nbsp;<span class="num" id="4258874">0</span><span class="op" id="4258875">;</span>&nbsp;<span class="ident" id="4258877">i</span>&nbsp;<span class="op" id="4258879">&lt;</span>&nbsp;<span class="builtinfunc" id="4258881">len</span><span class="op" id="4258884">(</span><span class="ident" id="4258885">p</span><span class="op" id="4258886">)</span>&nbsp;<span class="op" id="4258888">&amp;&amp;</span>&nbsp;<span class="ident" id="4258891">e</span><span class="op" id="4258892">.</span><span class="ident" id="4258893">nbuf</span>&nbsp;<span class="op" id="4258898">&lt;</span>&nbsp;<span class="num" id="4258900">3</span><span class="op" id="4258901">;</span>&nbsp;<span class="ident" id="4258903">i</span><span class="op" id="4258904">++</span>&nbsp;<span class="op" id="4258907">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258912">e</span><span class="op" id="4258913">.</span><span class="ident" id="4258914">buf</span><span class="op" id="4258917">[</span><span class="ident" id="4258918">e</span><span class="op" id="4258919">.</span><span class="ident" id="4258920">nbuf</span><span class="op" id="4258924">]</span>&nbsp;<span class="op" id="4258926">=</span>&nbsp;<span class="ident" id="4258928">p</span><span class="op" id="4258929">[</span><span class="ident" id="4258930">i</span><span class="op" id="4258931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258936">e</span><span class="op" id="4258937">.</span><span class="ident" id="4258938">nbuf</span><span class="op" id="4258942">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258951">n</span>&nbsp;<span class="op" id="4258953">+=</span>&nbsp;<span class="ident" id="4258956">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258960">p</span>&nbsp;<span class="op" id="4258962">=</span>&nbsp;<span class="ident" id="4258964">p</span><span class="op" id="4258965">[</span><span class="ident" id="4258966">i</span><span class="op" id="4258967">:</span><span class="op" id="4258968">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258972">if</span>&nbsp;<span class="ident" id="4258975">e</span><span class="op" id="4258976">.</span><span class="ident" id="4258977">nbuf</span>&nbsp;<span class="op" id="4258982">&lt;</span>&nbsp;<span class="num" id="4258984">3</span>&nbsp;<span class="op" id="4258986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258991">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259004">e</span><span class="op" id="4259005">.</span><span class="ident" id="4259006">enc</span><span class="op" id="4259009">.</span><span class="ident" id="4259010">Encode</span><span class="op" id="4259016">(</span><span class="ident" id="4259017">e</span><span class="op" id="4259018">.</span><span class="ident" id="4259019">out</span><span class="op" id="4259022">[</span><span class="num" id="4259023">0</span><span class="op" id="4259024">:</span><span class="op" id="4259025">]</span><span class="op" id="4259026">,</span>&nbsp;<span class="ident" id="4259028">e</span><span class="op" id="4259029">.</span><span class="ident" id="4259030">buf</span><span class="op" id="4259033">[</span><span class="num" id="4259034">0</span><span class="op" id="4259035">:</span><span class="op" id="4259036">]</span><span class="op" id="4259037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259041">if</span>&nbsp;<span class="ident" id="4259044">_</span><span class="op" id="4259045">,</span>&nbsp;<span class="ident" id="4259047">e</span><span class="op" id="4259048">.</span><span class="ident" id="4259049">err</span>&nbsp;<span class="op" id="4259053">=</span>&nbsp;<span class="ident" id="4259055">e</span><span class="op" id="4259056">.</span><span class="ident" id="4259057">w</span><span class="op" id="4259058">.</span><span class="ident" id="4259059">Write</span><span class="op" id="4259064">(</span><span class="ident" id="4259065">e</span><span class="op" id="4259066">.</span><span class="ident" id="4259067">out</span><span class="op" id="4259070">[</span><span class="num" id="4259071">0</span><span class="op" id="4259072">:</span><span class="num" id="4259073">4</span><span class="op" id="4259074">]</span><span class="op" id="4259075">)</span><span class="op" id="4259076">;</span>&nbsp;<span class="ident" id="4259078">e</span><span class="op" id="4259079">.</span><span class="ident" id="4259080">err</span>&nbsp;<span class="op" id="4259084">!=</span>&nbsp;<span class="builtintype" id="4259087">nil</span>&nbsp;<span class="op" id="4259091">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259096">return</span>&nbsp;<span class="ident" id="4259103">n</span><span class="op" id="4259104">,</span>&nbsp;<span class="ident" id="4259106">e</span><span class="op" id="4259107">.</span><span class="ident" id="4259108">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259118">e</span><span class="op" id="4259119">.</span><span class="ident" id="4259120">nbuf</span>&nbsp;<span class="op" id="4259125">=</span>&nbsp;<span class="num" id="4259127">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4259134">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259161">for</span>&nbsp;<span class="builtinfunc" id="4259165">len</span><span class="op" id="4259168">(</span><span class="ident" id="4259169">p</span><span class="op" id="4259170">)</span>&nbsp;<span class="op" id="4259172">&gt;=</span>&nbsp;<span class="num" id="4259175">3</span>&nbsp;<span class="op" id="4259177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259181">nn</span>&nbsp;<span class="op" id="4259184">:=</span>&nbsp;<span class="builtinfunc" id="4259187">len</span><span class="op" id="4259190">(</span><span class="ident" id="4259191">e</span><span class="op" id="4259192">.</span><span class="ident" id="4259193">out</span><span class="op" id="4259196">)</span>&nbsp;<span class="op" id="4259198">/</span>&nbsp;<span class="num" id="4259200">4</span>&nbsp;<span class="op" id="4259202">*</span>&nbsp;<span class="num" id="4259204">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259208">if</span>&nbsp;<span class="ident" id="4259211">nn</span>&nbsp;<span class="op" id="4259214">&gt;</span>&nbsp;<span class="builtinfunc" id="4259216">len</span><span class="op" id="4259219">(</span><span class="ident" id="4259220">p</span><span class="op" id="4259221">)</span>&nbsp;<span class="op" id="4259223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259228">nn</span>&nbsp;<span class="op" id="4259231">=</span>&nbsp;<span class="builtinfunc" id="4259233">len</span><span class="op" id="4259236">(</span><span class="ident" id="4259237">p</span><span class="op" id="4259238">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259243">nn</span>&nbsp;<span class="op" id="4259246">-=</span>&nbsp;<span class="ident" id="4259249">nn</span>&nbsp;<span class="op" id="4259252">%</span>&nbsp;<span class="num" id="4259254">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259262">e</span><span class="op" id="4259263">.</span><span class="ident" id="4259264">enc</span><span class="op" id="4259267">.</span><span class="ident" id="4259268">Encode</span><span class="op" id="4259274">(</span><span class="ident" id="4259275">e</span><span class="op" id="4259276">.</span><span class="ident" id="4259277">out</span><span class="op" id="4259280">[</span><span class="num" id="4259281">0</span><span class="op" id="4259282">:</span><span class="op" id="4259283">]</span><span class="op" id="4259284">,</span>&nbsp;<span class="ident" id="4259286">p</span><span class="op" id="4259287">[</span><span class="num" id="4259288">0</span><span class="op" id="4259289">:</span><span class="ident" id="4259290">nn</span><span class="op" id="4259292">]</span><span class="op" id="4259293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259297">if</span>&nbsp;<span class="ident" id="4259300">_</span><span class="op" id="4259301">,</span>&nbsp;<span class="ident" id="4259303">e</span><span class="op" id="4259304">.</span><span class="ident" id="4259305">err</span>&nbsp;<span class="op" id="4259309">=</span>&nbsp;<span class="ident" id="4259311">e</span><span class="op" id="4259312">.</span><span class="ident" id="4259313">w</span><span class="op" id="4259314">.</span><span class="ident" id="4259315">Write</span><span class="op" id="4259320">(</span><span class="ident" id="4259321">e</span><span class="op" id="4259322">.</span><span class="ident" id="4259323">out</span><span class="op" id="4259326">[</span><span class="num" id="4259327">0</span>&nbsp;<span class="op" id="4259329">:</span>&nbsp;<span class="ident" id="4259331">nn</span><span class="op" id="4259333">/</span><span class="num" id="4259334">3</span><span class="op" id="4259335">*</span><span class="num" id="4259336">4</span><span class="op" id="4259337">]</span><span class="op" id="4259338">)</span><span class="op" id="4259339">;</span>&nbsp;<span class="ident" id="4259341">e</span><span class="op" id="4259342">.</span><span class="ident" id="4259343">err</span>&nbsp;<span class="op" id="4259347">!=</span>&nbsp;<span class="builtintype" id="4259350">nil</span>&nbsp;<span class="op" id="4259354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259359">return</span>&nbsp;<span class="ident" id="4259366">n</span><span class="op" id="4259367">,</span>&nbsp;<span class="ident" id="4259369">e</span><span class="op" id="4259370">.</span><span class="ident" id="4259371">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259381">n</span>&nbsp;<span class="op" id="4259383">+=</span>&nbsp;<span class="ident" id="4259386">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259391">p</span>&nbsp;<span class="op" id="4259393">=</span>&nbsp;<span class="ident" id="4259395">p</span><span class="op" id="4259396">[</span><span class="ident" id="4259397">nn</span><span class="op" id="4259399">:</span><span class="op" id="4259400">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4259407">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259428">for</span>&nbsp;<span class="ident" id="4259432">i</span>&nbsp;<span class="op" id="4259434">:=</span>&nbsp;<span class="num" id="4259437">0</span><span class="op" id="4259438">;</span>&nbsp;<span class="ident" id="4259440">i</span>&nbsp;<span class="op" id="4259442">&lt;</span>&nbsp;<span class="builtinfunc" id="4259444">len</span><span class="op" id="4259447">(</span><span class="ident" id="4259448">p</span><span class="op" id="4259449">)</span><span class="op" id="4259450">;</span>&nbsp;<span class="ident" id="4259452">i</span><span class="op" id="4259453">++</span>&nbsp;<span class="op" id="4259456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259460">e</span><span class="op" id="4259461">.</span><span class="ident" id="4259462">buf</span><span class="op" id="4259465">[</span><span class="ident" id="4259466">i</span><span class="op" id="4259467">]</span>&nbsp;<span class="op" id="4259469">=</span>&nbsp;<span class="ident" id="4259471">p</span><span class="op" id="4259472">[</span><span class="ident" id="4259473">i</span><span class="op" id="4259474">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259480">e</span><span class="op" id="4259481">.</span><span class="ident" id="4259482">nbuf</span>&nbsp;<span class="op" id="4259487">=</span>&nbsp;<span class="builtinfunc" id="4259489">len</span><span class="op" id="4259492">(</span><span class="ident" id="4259493">p</span><span class="op" id="4259494">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259497">n</span>&nbsp;<span class="op" id="4259499">+=</span>&nbsp;<span class="builtinfunc" id="4259502">len</span><span class="op" id="4259505">(</span><span class="ident" id="4259506">p</span><span class="op" id="4259507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259510">return</span><br>
<span class="lineno"></span><span class="op" id="4259517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4259520">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="4259574">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4259627">func</span>&nbsp;<span class="op" id="4259632">(</span><span class="ident" id="4259633">e</span>&nbsp;<span class="op" id="4259635">*</span><span class="ident" id="4259636">encoder</span><span class="op" id="4259643">)</span>&nbsp;<span class="ident" id="4259645">Close</span><span class="op" id="4259650">(</span><span class="op" id="4259651">)</span>&nbsp;<span class="builtintype" id="4259653">error</span>&nbsp;<span class="op" id="4259659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4259662">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259719">if</span>&nbsp;<span class="ident" id="4259722">e</span><span class="op" id="4259723">.</span><span class="ident" id="4259724">err</span>&nbsp;<span class="op" id="4259728">==</span>&nbsp;<span class="builtintype" id="4259731">nil</span>&nbsp;<span class="op" id="4259735">&amp;&amp;</span>&nbsp;<span class="ident" id="4259738">e</span><span class="op" id="4259739">.</span><span class="ident" id="4259740">nbuf</span>&nbsp;<span class="op" id="4259745">&gt;</span>&nbsp;<span class="num" id="4259747">0</span>&nbsp;<span class="op" id="4259749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259753">e</span><span class="op" id="4259754">.</span><span class="ident" id="4259755">enc</span><span class="op" id="4259758">.</span><span class="ident" id="4259759">Encode</span><span class="op" id="4259765">(</span><span class="ident" id="4259766">e</span><span class="op" id="4259767">.</span><span class="ident" id="4259768">out</span><span class="op" id="4259771">[</span><span class="num" id="4259772">0</span><span class="op" id="4259773">:</span><span class="op" id="4259774">]</span><span class="op" id="4259775">,</span>&nbsp;<span class="ident" id="4259777">e</span><span class="op" id="4259778">.</span><span class="ident" id="4259779">buf</span><span class="op" id="4259782">[</span><span class="num" id="4259783">0</span><span class="op" id="4259784">:</span><span class="ident" id="4259785">e</span><span class="op" id="4259786">.</span><span class="ident" id="4259787">nbuf</span><span class="op" id="4259791">]</span><span class="op" id="4259792">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259796">e</span><span class="op" id="4259797">.</span><span class="ident" id="4259798">nbuf</span>&nbsp;<span class="op" id="4259803">=</span>&nbsp;<span class="num" id="4259805">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259809">_</span><span class="op" id="4259810">,</span>&nbsp;<span class="ident" id="4259812">e</span><span class="op" id="4259813">.</span><span class="ident" id="4259814">err</span>&nbsp;<span class="op" id="4259818">=</span>&nbsp;<span class="ident" id="4259820">e</span><span class="op" id="4259821">.</span><span class="ident" id="4259822">w</span><span class="op" id="4259823">.</span><span class="ident" id="4259824">Write</span><span class="op" id="4259829">(</span><span class="ident" id="4259830">e</span><span class="op" id="4259831">.</span><span class="ident" id="4259832">out</span><span class="op" id="4259835">[</span><span class="num" id="4259836">0</span><span class="op" id="4259837">:</span><span class="num" id="4259838">4</span><span class="op" id="4259839">]</span><span class="op" id="4259840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259846">return</span>&nbsp;<span class="ident" id="4259853">e</span><span class="op" id="4259854">.</span><span class="ident" id="4259855">err</span><br>
<span class="lineno"></span><span class="op" id="4259859">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="4259862">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4259930">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4260002">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="4260062">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="4260130">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4260159">func</span>&nbsp;<span class="ident" id="4260164">NewEncoder</span><span class="op" id="4260174">(</span><span class="ident" id="4260175">enc</span>&nbsp;<span class="op" id="4260179">*</span><span class="ident" id="4260180">Encoding</span><span class="op" id="4260188">,</span>&nbsp;<span class="ident" id="4260190">w</span>&nbsp;<span class="ident" id="4260192">io</span><span class="op" id="4260194">.</span><span class="ident" id="4260195">Writer</span><span class="op" id="4260201">)</span>&nbsp;<span class="ident" id="4260203">io</span><span class="op" id="4260205">.</span><span class="ident" id="4260206">WriteCloser</span>&nbsp;<span class="op" id="4260218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260221">return</span>&nbsp;<span class="op" id="4260228">&amp;</span><span class="ident" id="4260229">encoder</span><span class="op" id="4260236">{</span><span class="ident" id="4260237">enc</span><span class="op" id="4260240">:</span>&nbsp;<span class="ident" id="4260242">enc</span><span class="op" id="4260245">,</span>&nbsp;<span class="ident" id="4260247">w</span><span class="op" id="4260248">:</span>&nbsp;<span class="ident" id="4260250">w</span><span class="op" id="4260251">}</span><br>
<span class="lineno"></span><span class="op" id="4260253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4260256">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4260321">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="4260356">func</span>&nbsp;<span class="op" id="4260361">(</span><span class="ident" id="4260362">enc</span>&nbsp;<span class="op" id="4260366">*</span><span class="ident" id="4260367">Encoding</span><span class="op" id="4260375">)</span>&nbsp;<span class="ident" id="4260377">EncodedLen</span><span class="op" id="4260387">(</span><span class="ident" id="4260388">n</span>&nbsp;<span class="builtintype" id="4260390">int</span><span class="op" id="4260393">)</span>&nbsp;<span class="builtintype" id="4260395">int</span>&nbsp;<span class="op" id="4260399">{</span>&nbsp;<span class="keyword" id="4260401">return</span>&nbsp;<span class="op" id="4260408">(</span><span class="ident" id="4260409">n</span>&nbsp;<span class="op" id="4260411">+</span>&nbsp;<span class="num" id="4260413">2</span><span class="op" id="4260414">)</span>&nbsp;<span class="op" id="4260416">/</span>&nbsp;<span class="num" id="4260418">3</span>&nbsp;<span class="op" id="4260420">*</span>&nbsp;<span class="num" id="4260422">4</span>&nbsp;<span class="op" id="4260424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4260427">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4260446">type</span>&nbsp;<span class="ident" id="4260451">CorruptInputError</span>&nbsp;<span class="ident" id="4260469">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="4260476">func</span>&nbsp;<span class="op" id="4260481">(</span><span class="ident" id="4260482">e</span>&nbsp;<span class="ident" id="4260484">CorruptInputError</span><span class="op" id="4260501">)</span>&nbsp;<span class="ident" id="4260503">Error</span><span class="op" id="4260508">(</span><span class="op" id="4260509">)</span>&nbsp;<span class="builtintype" id="4260511">string</span>&nbsp;<span class="op" id="4260518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260521">return</span>&nbsp;<span class="string" id="4260528">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="4260565">+</span>&nbsp;<span class="ident" id="4260567">strconv</span><span class="op" id="4260574">.</span><span class="ident" id="4260575">FormatInt</span><span class="op" id="4260584">(</span><span class="ident" id="4260585">int64</span><span class="op" id="4260590">(</span><span class="ident" id="4260591">e</span><span class="op" id="4260592">)</span><span class="op" id="4260593">,</span>&nbsp;<span class="num" id="4260595">10</span><span class="op" id="4260597">)</span><br>
<span class="lineno"></span><span class="op" id="4260599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4260602">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="4260672">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="4260740">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="4260810">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="4260867">func</span>&nbsp;<span class="op" id="4260872">(</span><span class="ident" id="4260873">enc</span>&nbsp;<span class="op" id="4260877">*</span><span class="ident" id="4260878">Encoding</span><span class="op" id="4260886">)</span>&nbsp;<span class="ident" id="4260888">decode</span><span class="op" id="4260894">(</span><span class="ident" id="4260895">dst</span><span class="op" id="4260898">,</span>&nbsp;<span class="ident" id="4260900">src</span>&nbsp;<span class="op" id="4260904">[</span><span class="op" id="4260905">]</span><span class="builtintype" id="4260906">byte</span><span class="op" id="4260910">)</span>&nbsp;<span class="op" id="4260912">(</span><span class="ident" id="4260913">n</span>&nbsp;<span class="builtintype" id="4260915">int</span><span class="op" id="4260918">,</span>&nbsp;<span class="ident" id="4260920">end</span>&nbsp;<span class="builtintype" id="4260924">bool</span><span class="op" id="4260928">,</span>&nbsp;<span class="ident" id="4260930">err</span>&nbsp;<span class="builtintype" id="4260934">error</span><span class="op" id="4260939">)</span>&nbsp;<span class="op" id="4260941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260944">olen</span>&nbsp;<span class="op" id="4260949">:=</span>&nbsp;<span class="builtinfunc" id="4260952">len</span><span class="op" id="4260955">(</span><span class="ident" id="4260956">src</span><span class="op" id="4260959">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260962">for</span>&nbsp;<span class="builtinfunc" id="4260966">len</span><span class="op" id="4260969">(</span><span class="ident" id="4260970">src</span><span class="op" id="4260973">)</span>&nbsp;<span class="op" id="4260975">&gt;</span>&nbsp;<span class="num" id="4260977">0</span>&nbsp;<span class="op" id="4260979">&amp;&amp;</span>&nbsp;<span class="op" id="4260982">!</span><span class="ident" id="4260983">end</span>&nbsp;<span class="op" id="4260987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4260991">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261037">var</span>&nbsp;<span class="ident" id="4261041">dbuf</span>&nbsp;<span class="op" id="4261046">[</span><span class="num" id="4261047">4</span><span class="op" id="4261048">]</span><span class="builtintype" id="4261049">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261056">dlen</span>&nbsp;<span class="op" id="4261061">:=</span>&nbsp;<span class="num" id="4261064">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261069">for</span>&nbsp;<span class="ident" id="4261073">j</span>&nbsp;<span class="op" id="4261075">:=</span>&nbsp;<span class="keyword" id="4261078">range</span>&nbsp;<span class="ident" id="4261084">dbuf</span>&nbsp;<span class="op" id="4261089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261094">if</span>&nbsp;<span class="builtinfunc" id="4261097">len</span><span class="op" id="4261100">(</span><span class="ident" id="4261101">src</span><span class="op" id="4261104">)</span>&nbsp;<span class="op" id="4261106">==</span>&nbsp;<span class="num" id="4261109">0</span>&nbsp;<span class="op" id="4261111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261117">return</span>&nbsp;<span class="ident" id="4261124">n</span><span class="op" id="4261125">,</span>&nbsp;<span class="builtintype" id="4261127">false</span><span class="op" id="4261132">,</span>&nbsp;<span class="ident" id="4261134">CorruptInputError</span><span class="op" id="4261151">(</span><span class="ident" id="4261152">olen</span>&nbsp;<span class="op" id="4261157">-</span>&nbsp;<span class="builtinfunc" id="4261159">len</span><span class="op" id="4261162">(</span><span class="ident" id="4261163">src</span><span class="op" id="4261166">)</span>&nbsp;<span class="op" id="4261168">-</span>&nbsp;<span class="ident" id="4261170">j</span><span class="op" id="4261171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261181">in</span>&nbsp;<span class="op" id="4261184">:=</span>&nbsp;<span class="ident" id="4261187">src</span><span class="op" id="4261190">[</span><span class="num" id="4261191">0</span><span class="op" id="4261192">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261197">src</span>&nbsp;<span class="op" id="4261201">=</span>&nbsp;<span class="ident" id="4261203">src</span><span class="op" id="4261206">[</span><span class="num" id="4261207">1</span><span class="op" id="4261208">:</span><span class="op" id="4261209">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261214">if</span>&nbsp;<span class="ident" id="4261217">in</span>&nbsp;<span class="op" id="4261220">==</span>&nbsp;<span class="string" id="4261223">&#39;=&#39;</span>&nbsp;<span class="op" id="4261227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261233">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261282">switch</span>&nbsp;<span class="ident" id="4261289">j</span>&nbsp;<span class="op" id="4261291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261297">case</span>&nbsp;<span class="num" id="4261302">0</span><span class="op" id="4261303">,</span>&nbsp;<span class="num" id="4261305">1</span><span class="op" id="4261306">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261313">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261339">return</span>&nbsp;<span class="ident" id="4261346">n</span><span class="op" id="4261347">,</span>&nbsp;<span class="builtintype" id="4261349">false</span><span class="op" id="4261354">,</span>&nbsp;<span class="ident" id="4261356">CorruptInputError</span><span class="op" id="4261373">(</span><span class="ident" id="4261374">olen</span>&nbsp;<span class="op" id="4261379">-</span>&nbsp;<span class="builtinfunc" id="4261381">len</span><span class="op" id="4261384">(</span><span class="ident" id="4261385">src</span><span class="op" id="4261388">)</span>&nbsp;<span class="op" id="4261390">-</span>&nbsp;<span class="num" id="4261392">1</span><span class="op" id="4261393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261399">case</span>&nbsp;<span class="num" id="4261404">2</span><span class="op" id="4261405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261412">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261473">if</span>&nbsp;<span class="builtinfunc" id="4261476">len</span><span class="op" id="4261479">(</span><span class="ident" id="4261480">src</span><span class="op" id="4261483">)</span>&nbsp;<span class="op" id="4261485">==</span>&nbsp;<span class="num" id="4261488">0</span>&nbsp;<span class="op" id="4261490">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261498">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261526">return</span>&nbsp;<span class="ident" id="4261533">n</span><span class="op" id="4261534">,</span>&nbsp;<span class="builtintype" id="4261536">false</span><span class="op" id="4261541">,</span>&nbsp;<span class="ident" id="4261543">CorruptInputError</span><span class="op" id="4261560">(</span><span class="ident" id="4261561">olen</span><span class="op" id="4261565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261579">if</span>&nbsp;<span class="ident" id="4261582">src</span><span class="op" id="4261585">[</span><span class="num" id="4261586">0</span><span class="op" id="4261587">]</span>&nbsp;<span class="op" id="4261589">!=</span>&nbsp;<span class="string" id="4261592">&#39;=&#39;</span>&nbsp;<span class="op" id="4261596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261604">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261631">return</span>&nbsp;<span class="ident" id="4261638">n</span><span class="op" id="4261639">,</span>&nbsp;<span class="builtintype" id="4261641">false</span><span class="op" id="4261646">,</span>&nbsp;<span class="ident" id="4261648">CorruptInputError</span><span class="op" id="4261665">(</span><span class="ident" id="4261666">olen</span>&nbsp;<span class="op" id="4261671">-</span>&nbsp;<span class="builtinfunc" id="4261673">len</span><span class="op" id="4261676">(</span><span class="ident" id="4261677">src</span><span class="op" id="4261680">)</span>&nbsp;<span class="op" id="4261682">-</span>&nbsp;<span class="num" id="4261684">1</span><span class="op" id="4261685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261699">src</span>&nbsp;<span class="op" id="4261703">=</span>&nbsp;<span class="ident" id="4261705">src</span><span class="op" id="4261708">[</span><span class="num" id="4261709">1</span><span class="op" id="4261710">:</span><span class="op" id="4261711">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261723">if</span>&nbsp;<span class="builtinfunc" id="4261726">len</span><span class="op" id="4261729">(</span><span class="ident" id="4261730">src</span><span class="op" id="4261733">)</span>&nbsp;<span class="op" id="4261735">&gt;</span>&nbsp;<span class="num" id="4261737">0</span>&nbsp;<span class="op" id="4261739">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261746">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261771">err</span>&nbsp;<span class="op" id="4261775">=</span>&nbsp;<span class="ident" id="4261777">CorruptInputError</span><span class="op" id="4261794">(</span><span class="ident" id="4261795">olen</span>&nbsp;<span class="op" id="4261800">-</span>&nbsp;<span class="builtinfunc" id="4261802">len</span><span class="op" id="4261805">(</span><span class="ident" id="4261806">src</span><span class="op" id="4261809">)</span><span class="op" id="4261810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261822">dlen</span><span class="op" id="4261826">,</span>&nbsp;<span class="ident" id="4261828">end</span>&nbsp;<span class="op" id="4261832">=</span>&nbsp;<span class="ident" id="4261834">j</span><span class="op" id="4261835">,</span>&nbsp;<span class="builtintype" id="4261837">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261846">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261860">dbuf</span><span class="op" id="4261864">[</span><span class="ident" id="4261865">j</span><span class="op" id="4261866">]</span>&nbsp;<span class="op" id="4261868">=</span>&nbsp;<span class="ident" id="4261870">enc</span><span class="op" id="4261873">.</span><span class="ident" id="4261874">decodeMap</span><span class="op" id="4261883">[</span><span class="ident" id="4261884">in</span><span class="op" id="4261886">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261891">if</span>&nbsp;<span class="ident" id="4261894">dbuf</span><span class="op" id="4261898">[</span><span class="ident" id="4261899">j</span><span class="op" id="4261900">]</span>&nbsp;<span class="op" id="4261902">==</span>&nbsp;<span class="num" id="4261905">0xFF</span>&nbsp;<span class="op" id="4261910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261916">return</span>&nbsp;<span class="ident" id="4261923">n</span><span class="op" id="4261924">,</span>&nbsp;<span class="builtintype" id="4261926">false</span><span class="op" id="4261931">,</span>&nbsp;<span class="ident" id="4261933">CorruptInputError</span><span class="op" id="4261950">(</span><span class="ident" id="4261951">olen</span>&nbsp;<span class="op" id="4261956">-</span>&nbsp;<span class="builtinfunc" id="4261958">len</span><span class="op" id="4261961">(</span><span class="ident" id="4261962">src</span><span class="op" id="4261965">)</span>&nbsp;<span class="op" id="4261967">-</span>&nbsp;<span class="num" id="4261969">1</span><span class="op" id="4261970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261975">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261984">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262041">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262054">switch</span>&nbsp;<span class="ident" id="4262061">dlen</span>&nbsp;<span class="op" id="4262066">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262070">case</span>&nbsp;<span class="num" id="4262075">4</span><span class="op" id="4262076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262081">dst</span><span class="op" id="4262084">[</span><span class="num" id="4262085">2</span><span class="op" id="4262086">]</span>&nbsp;<span class="op" id="4262088">=</span>&nbsp;<span class="ident" id="4262090">dbuf</span><span class="op" id="4262094">[</span><span class="num" id="4262095">2</span><span class="op" id="4262096">]</span><span class="op" id="4262097">&lt;&lt;</span><span class="num" id="4262099">6</span>&nbsp;<span class="op" id="4262101">|</span>&nbsp;<span class="ident" id="4262103">dbuf</span><span class="op" id="4262107">[</span><span class="num" id="4262108">3</span><span class="op" id="4262109">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262114">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262128">case</span>&nbsp;<span class="num" id="4262133">3</span><span class="op" id="4262134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262139">dst</span><span class="op" id="4262142">[</span><span class="num" id="4262143">1</span><span class="op" id="4262144">]</span>&nbsp;<span class="op" id="4262146">=</span>&nbsp;<span class="ident" id="4262148">dbuf</span><span class="op" id="4262152">[</span><span class="num" id="4262153">1</span><span class="op" id="4262154">]</span><span class="op" id="4262155">&lt;&lt;</span><span class="num" id="4262157">4</span>&nbsp;<span class="op" id="4262159">|</span>&nbsp;<span class="ident" id="4262161">dbuf</span><span class="op" id="4262165">[</span><span class="num" id="4262166">2</span><span class="op" id="4262167">]</span><span class="op" id="4262168">&gt;&gt;</span><span class="num" id="4262170">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262175">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262189">case</span>&nbsp;<span class="num" id="4262194">2</span><span class="op" id="4262195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262200">dst</span><span class="op" id="4262203">[</span><span class="num" id="4262204">0</span><span class="op" id="4262205">]</span>&nbsp;<span class="op" id="4262207">=</span>&nbsp;<span class="ident" id="4262209">dbuf</span><span class="op" id="4262213">[</span><span class="num" id="4262214">0</span><span class="op" id="4262215">]</span><span class="op" id="4262216">&lt;&lt;</span><span class="num" id="4262218">2</span>&nbsp;<span class="op" id="4262220">|</span>&nbsp;<span class="ident" id="4262222">dbuf</span><span class="op" id="4262226">[</span><span class="num" id="4262227">1</span><span class="op" id="4262228">]</span><span class="op" id="4262229">&gt;&gt;</span><span class="num" id="4262231">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4262235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262239">dst</span>&nbsp;<span class="op" id="4262243">=</span>&nbsp;<span class="ident" id="4262245">dst</span><span class="op" id="4262248">[</span><span class="num" id="4262249">3</span><span class="op" id="4262250">:</span><span class="op" id="4262251">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262255">n</span>&nbsp;<span class="op" id="4262257">+=</span>&nbsp;<span class="ident" id="4262260">dlen</span>&nbsp;<span class="op" id="4262265">-</span>&nbsp;<span class="num" id="4262267">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4262270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262274">return</span>&nbsp;<span class="ident" id="4262281">n</span><span class="op" id="4262282">,</span>&nbsp;<span class="ident" id="4262284">end</span><span class="op" id="4262287">,</span>&nbsp;<span class="ident" id="4262289">err</span><br>
<span class="lineno"></span><span class="op" id="4262293">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="4262296">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="4262361">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="4262430">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4262499">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="4262562">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="4262610">func</span>&nbsp;<span class="op" id="4262615">(</span><span class="ident" id="4262616">enc</span>&nbsp;<span class="op" id="4262620">*</span><span class="ident" id="4262621">Encoding</span><span class="op" id="4262629">)</span>&nbsp;<span class="ident" id="4262631">Decode</span><span class="op" id="4262637">(</span><span class="ident" id="4262638">dst</span><span class="op" id="4262641">,</span>&nbsp;<span class="ident" id="4262643">src</span>&nbsp;<span class="op" id="4262647">[</span><span class="op" id="4262648">]</span><span class="builtintype" id="4262649">byte</span><span class="op" id="4262653">)</span>&nbsp;<span class="op" id="4262655">(</span><span class="ident" id="4262656">n</span>&nbsp;<span class="builtintype" id="4262658">int</span><span class="op" id="4262661">,</span>&nbsp;<span class="ident" id="4262663">err</span>&nbsp;<span class="builtintype" id="4262667">error</span><span class="op" id="4262672">)</span>&nbsp;<span class="op" id="4262674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262677">src</span>&nbsp;<span class="op" id="4262681">=</span>&nbsp;<span class="ident" id="4262683">bytes</span><span class="op" id="4262688">.</span><span class="ident" id="4262689">Map</span><span class="op" id="4262692">(</span><span class="ident" id="4262693">removeNewlinesMapper</span><span class="op" id="4262713">,</span>&nbsp;<span class="ident" id="4262715">src</span><span class="op" id="4262718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262721">n</span><span class="op" id="4262722">,</span>&nbsp;<span class="ident" id="4262724">_</span><span class="op" id="4262725">,</span>&nbsp;<span class="ident" id="4262727">err</span>&nbsp;<span class="op" id="4262731">=</span>&nbsp;<span class="ident" id="4262733">enc</span><span class="op" id="4262736">.</span><span class="ident" id="4262737">decode</span><span class="op" id="4262743">(</span><span class="ident" id="4262744">dst</span><span class="op" id="4262747">,</span>&nbsp;<span class="ident" id="4262749">src</span><span class="op" id="4262752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262755">return</span><br>
<span class="lineno">290</span><span class="op" id="4262762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4262765">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="4262835">func</span>&nbsp;<span class="op" id="4262840">(</span><span class="ident" id="4262841">enc</span>&nbsp;<span class="op" id="4262845">*</span><span class="ident" id="4262846">Encoding</span><span class="op" id="4262854">)</span>&nbsp;<span class="ident" id="4262856">DecodeString</span><span class="op" id="4262868">(</span><span class="ident" id="4262869">s</span>&nbsp;<span class="builtintype" id="4262871">string</span><span class="op" id="4262877">)</span>&nbsp;<span class="op" id="4262879">(</span><span class="op" id="4262880">[</span><span class="op" id="4262881">]</span><span class="builtintype" id="4262882">byte</span><span class="op" id="4262886">,</span>&nbsp;<span class="builtintype" id="4262888">error</span><span class="op" id="4262893">)</span>&nbsp;<span class="op" id="4262895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262898">s</span>&nbsp;<span class="op" id="4262900">=</span>&nbsp;<span class="ident" id="4262902">strings</span><span class="op" id="4262909">.</span><span class="ident" id="4262910">Map</span><span class="op" id="4262913">(</span><span class="ident" id="4262914">removeNewlinesMapper</span><span class="op" id="4262934">,</span>&nbsp;<span class="ident" id="4262936">s</span><span class="op" id="4262937">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262940">dbuf</span>&nbsp;<span class="op" id="4262945">:=</span>&nbsp;<span class="builtinfunc" id="4262948">make</span><span class="op" id="4262952">(</span><span class="op" id="4262953">[</span><span class="op" id="4262954">]</span><span class="builtintype" id="4262955">byte</span><span class="op" id="4262959">,</span>&nbsp;<span class="ident" id="4262961">enc</span><span class="op" id="4262964">.</span><span class="ident" id="4262965">DecodedLen</span><span class="op" id="4262975">(</span><span class="builtinfunc" id="4262976">len</span><span class="op" id="4262979">(</span><span class="ident" id="4262980">s</span><span class="op" id="4262981">)</span><span class="op" id="4262982">)</span><span class="op" id="4262983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262986">n</span><span class="op" id="4262987">,</span>&nbsp;<span class="ident" id="4262989">_</span><span class="op" id="4262990">,</span>&nbsp;<span class="ident" id="4262992">err</span>&nbsp;<span class="op" id="4262996">:=</span>&nbsp;<span class="ident" id="4262999">enc</span><span class="op" id="4263002">.</span><span class="ident" id="4263003">decode</span><span class="op" id="4263009">(</span><span class="ident" id="4263010">dbuf</span><span class="op" id="4263014">,</span>&nbsp;<span class="op" id="4263016">[</span><span class="op" id="4263017">]</span><span class="builtintype" id="4263018">byte</span><span class="op" id="4263022">(</span><span class="ident" id="4263023">s</span><span class="op" id="4263024">)</span><span class="op" id="4263025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263028">return</span>&nbsp;<span class="ident" id="4263035">dbuf</span><span class="op" id="4263039">[</span><span class="op" id="4263040">:</span><span class="ident" id="4263041">n</span><span class="op" id="4263042">]</span><span class="op" id="4263043">,</span>&nbsp;<span class="ident" id="4263045">err</span><br>
<span class="lineno"></span><span class="op" id="4263049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="4263052">type</span>&nbsp;<span class="ident" id="4263057">decoder</span>&nbsp;<span class="keyword" id="4263065">struct</span>&nbsp;<span class="op" id="4263072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263075">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4263082">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263089">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263096">*</span><span class="ident" id="4263097">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263107">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263114">io</span><span class="op" id="4263116">.</span><span class="ident" id="4263117">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263125">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4263132">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263143">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263166">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263173">[</span><span class="num" id="4263174">1024</span><span class="op" id="4263178">]</span><span class="builtintype" id="4263179">byte</span>&nbsp;<span class="comment" id="4263184">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263203">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4263210">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263215">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263222">[</span><span class="op" id="4263223">]</span><span class="builtintype" id="4263224">byte</span>&nbsp;<span class="comment" id="4263229">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263257">outbuf</span>&nbsp;<span class="op" id="4263264">[</span><span class="num" id="4263265">1024</span>&nbsp;<span class="op" id="4263270">/</span>&nbsp;<span class="num" id="4263272">4</span>&nbsp;<span class="op" id="4263274">*</span>&nbsp;<span class="num" id="4263276">3</span><span class="op" id="4263277">]</span><span class="builtintype" id="4263278">byte</span><br>
<span class="lineno"></span><span class="op" id="4263283">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="4263286">func</span>&nbsp;<span class="op" id="4263291">(</span><span class="ident" id="4263292">d</span>&nbsp;<span class="op" id="4263294">*</span><span class="ident" id="4263295">decoder</span><span class="op" id="4263302">)</span>&nbsp;<span class="ident" id="4263304">Read</span><span class="op" id="4263308">(</span><span class="ident" id="4263309">p</span>&nbsp;<span class="op" id="4263311">[</span><span class="op" id="4263312">]</span><span class="builtintype" id="4263313">byte</span><span class="op" id="4263317">)</span>&nbsp;<span class="op" id="4263319">(</span><span class="ident" id="4263320">n</span>&nbsp;<span class="builtintype" id="4263322">int</span><span class="op" id="4263325">,</span>&nbsp;<span class="ident" id="4263327">err</span>&nbsp;<span class="builtintype" id="4263331">error</span><span class="op" id="4263336">)</span>&nbsp;<span class="op" id="4263338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263341">if</span>&nbsp;<span class="ident" id="4263344">d</span><span class="op" id="4263345">.</span><span class="ident" id="4263346">err</span>&nbsp;<span class="op" id="4263350">!=</span>&nbsp;<span class="builtintype" id="4263353">nil</span>&nbsp;<span class="op" id="4263357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263361">return</span>&nbsp;<span class="num" id="4263368">0</span><span class="op" id="4263369">,</span>&nbsp;<span class="ident" id="4263371">d</span><span class="op" id="4263372">.</span><span class="ident" id="4263373">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263378">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263382">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263430">if</span>&nbsp;<span class="builtinfunc" id="4263433">len</span><span class="op" id="4263436">(</span><span class="ident" id="4263437">d</span><span class="op" id="4263438">.</span><span class="ident" id="4263439">out</span><span class="op" id="4263442">)</span>&nbsp;<span class="op" id="4263444">&gt;</span>&nbsp;<span class="num" id="4263446">0</span>&nbsp;<span class="op" id="4263448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263452">n</span>&nbsp;<span class="op" id="4263454">=</span>&nbsp;<span class="builtinfunc" id="4263456">copy</span><span class="op" id="4263460">(</span><span class="ident" id="4263461">p</span><span class="op" id="4263462">,</span>&nbsp;<span class="ident" id="4263464">d</span><span class="op" id="4263465">.</span><span class="ident" id="4263466">out</span><span class="op" id="4263469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263473">d</span><span class="op" id="4263474">.</span><span class="ident" id="4263475">out</span>&nbsp;<span class="op" id="4263479">=</span>&nbsp;<span class="ident" id="4263481">d</span><span class="op" id="4263482">.</span><span class="ident" id="4263483">out</span><span class="op" id="4263486">[</span><span class="ident" id="4263487">n</span><span class="op" id="4263488">:</span><span class="op" id="4263489">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263493">return</span>&nbsp;<span class="ident" id="4263500">n</span><span class="op" id="4263501">,</span>&nbsp;<span class="builtintype" id="4263503">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263512">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263530">nn</span>&nbsp;<span class="op" id="4263533">:=</span>&nbsp;<span class="builtinfunc" id="4263536">len</span><span class="op" id="4263539">(</span><span class="ident" id="4263540">p</span><span class="op" id="4263541">)</span>&nbsp;<span class="op" id="4263543">/</span>&nbsp;<span class="num" id="4263545">3</span>&nbsp;<span class="op" id="4263547">*</span>&nbsp;<span class="num" id="4263549">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263552">if</span>&nbsp;<span class="ident" id="4263555">nn</span>&nbsp;<span class="op" id="4263558">&lt;</span>&nbsp;<span class="num" id="4263560">4</span>&nbsp;<span class="op" id="4263562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263566">nn</span>&nbsp;<span class="op" id="4263569">=</span>&nbsp;<span class="num" id="4263571">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263577">if</span>&nbsp;<span class="ident" id="4263580">nn</span>&nbsp;<span class="op" id="4263583">&gt;</span>&nbsp;<span class="builtinfunc" id="4263585">len</span><span class="op" id="4263588">(</span><span class="ident" id="4263589">d</span><span class="op" id="4263590">.</span><span class="ident" id="4263591">buf</span><span class="op" id="4263594">)</span>&nbsp;<span class="op" id="4263596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263600">nn</span>&nbsp;<span class="op" id="4263603">=</span>&nbsp;<span class="builtinfunc" id="4263605">len</span><span class="op" id="4263608">(</span><span class="ident" id="4263609">d</span><span class="op" id="4263610">.</span><span class="ident" id="4263611">buf</span><span class="op" id="4263614">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263620">nn</span><span class="op" id="4263622">,</span>&nbsp;<span class="ident" id="4263624">d</span><span class="op" id="4263625">.</span><span class="ident" id="4263626">err</span>&nbsp;<span class="op" id="4263630">=</span>&nbsp;<span class="ident" id="4263632">io</span><span class="op" id="4263634">.</span><span class="ident" id="4263635">ReadAtLeast</span><span class="op" id="4263646">(</span><span class="ident" id="4263647">d</span><span class="op" id="4263648">.</span><span class="ident" id="4263649">r</span><span class="op" id="4263650">,</span>&nbsp;<span class="ident" id="4263652">d</span><span class="op" id="4263653">.</span><span class="ident" id="4263654">buf</span><span class="op" id="4263657">[</span><span class="ident" id="4263658">d</span><span class="op" id="4263659">.</span><span class="ident" id="4263660">nbuf</span><span class="op" id="4263664">:</span><span class="ident" id="4263665">nn</span><span class="op" id="4263667">]</span><span class="op" id="4263668">,</span>&nbsp;<span class="num" id="4263670">4</span><span class="op" id="4263671">-</span><span class="ident" id="4263672">d</span><span class="op" id="4263673">.</span><span class="ident" id="4263674">nbuf</span><span class="op" id="4263678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263681">d</span><span class="op" id="4263682">.</span><span class="ident" id="4263683">nbuf</span>&nbsp;<span class="op" id="4263688">+=</span>&nbsp;<span class="ident" id="4263691">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263695">if</span>&nbsp;<span class="ident" id="4263698">d</span><span class="op" id="4263699">.</span><span class="ident" id="4263700">err</span>&nbsp;<span class="op" id="4263704">!=</span>&nbsp;<span class="builtintype" id="4263707">nil</span>&nbsp;<span class="op" id="4263711">||</span>&nbsp;<span class="ident" id="4263714">d</span><span class="op" id="4263715">.</span><span class="ident" id="4263716">nbuf</span>&nbsp;<span class="op" id="4263721">&lt;</span>&nbsp;<span class="num" id="4263723">4</span>&nbsp;<span class="op" id="4263725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263729">return</span>&nbsp;<span class="num" id="4263736">0</span><span class="op" id="4263737">,</span>&nbsp;<span class="ident" id="4263739">d</span><span class="op" id="4263740">.</span><span class="ident" id="4263741">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263750">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263814">nr</span>&nbsp;<span class="op" id="4263817">:=</span>&nbsp;<span class="ident" id="4263820">d</span><span class="op" id="4263821">.</span><span class="ident" id="4263822">nbuf</span>&nbsp;<span class="op" id="4263827">/</span>&nbsp;<span class="num" id="4263829">4</span>&nbsp;<span class="op" id="4263831">*</span>&nbsp;<span class="num" id="4263833">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263836">nw</span>&nbsp;<span class="op" id="4263839">:=</span>&nbsp;<span class="ident" id="4263842">d</span><span class="op" id="4263843">.</span><span class="ident" id="4263844">nbuf</span>&nbsp;<span class="op" id="4263849">/</span>&nbsp;<span class="num" id="4263851">4</span>&nbsp;<span class="op" id="4263853">*</span>&nbsp;<span class="num" id="4263855">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263858">if</span>&nbsp;<span class="ident" id="4263861">nw</span>&nbsp;<span class="op" id="4263864">&gt;</span>&nbsp;<span class="builtinfunc" id="4263866">len</span><span class="op" id="4263869">(</span><span class="ident" id="4263870">p</span><span class="op" id="4263871">)</span>&nbsp;<span class="op" id="4263873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263877">nw</span><span class="op" id="4263879">,</span>&nbsp;<span class="ident" id="4263881">d</span><span class="op" id="4263882">.</span><span class="ident" id="4263883">end</span><span class="op" id="4263886">,</span>&nbsp;<span class="ident" id="4263888">d</span><span class="op" id="4263889">.</span><span class="ident" id="4263890">err</span>&nbsp;<span class="op" id="4263894">=</span>&nbsp;<span class="ident" id="4263896">d</span><span class="op" id="4263897">.</span><span class="ident" id="4263898">enc</span><span class="op" id="4263901">.</span><span class="ident" id="4263902">decode</span><span class="op" id="4263908">(</span><span class="ident" id="4263909">d</span><span class="op" id="4263910">.</span><span class="ident" id="4263911">outbuf</span><span class="op" id="4263917">[</span><span class="num" id="4263918">0</span><span class="op" id="4263919">:</span><span class="op" id="4263920">]</span><span class="op" id="4263921">,</span>&nbsp;<span class="ident" id="4263923">d</span><span class="op" id="4263924">.</span><span class="ident" id="4263925">buf</span><span class="op" id="4263928">[</span><span class="num" id="4263929">0</span><span class="op" id="4263930">:</span><span class="ident" id="4263931">nr</span><span class="op" id="4263933">]</span><span class="op" id="4263934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263938">d</span><span class="op" id="4263939">.</span><span class="ident" id="4263940">out</span>&nbsp;<span class="op" id="4263944">=</span>&nbsp;<span class="ident" id="4263946">d</span><span class="op" id="4263947">.</span><span class="ident" id="4263948">outbuf</span><span class="op" id="4263954">[</span><span class="num" id="4263955">0</span><span class="op" id="4263956">:</span><span class="ident" id="4263957">nw</span><span class="op" id="4263959">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263963">n</span>&nbsp;<span class="op" id="4263965">=</span>&nbsp;<span class="builtinfunc" id="4263967">copy</span><span class="op" id="4263971">(</span><span class="ident" id="4263972">p</span><span class="op" id="4263973">,</span>&nbsp;<span class="ident" id="4263975">d</span><span class="op" id="4263976">.</span><span class="ident" id="4263977">out</span><span class="op" id="4263980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263984">d</span><span class="op" id="4263985">.</span><span class="ident" id="4263986">out</span>&nbsp;<span class="op" id="4263990">=</span>&nbsp;<span class="ident" id="4263992">d</span><span class="op" id="4263993">.</span><span class="ident" id="4263994">out</span><span class="op" id="4263997">[</span><span class="ident" id="4263998">n</span><span class="op" id="4263999">:</span><span class="op" id="4264000">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264003">}</span>&nbsp;<span class="keyword" id="4264005">else</span>&nbsp;<span class="op" id="4264010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264014">n</span><span class="op" id="4264015">,</span>&nbsp;<span class="ident" id="4264017">d</span><span class="op" id="4264018">.</span><span class="ident" id="4264019">end</span><span class="op" id="4264022">,</span>&nbsp;<span class="ident" id="4264024">d</span><span class="op" id="4264025">.</span><span class="ident" id="4264026">err</span>&nbsp;<span class="op" id="4264030">=</span>&nbsp;<span class="ident" id="4264032">d</span><span class="op" id="4264033">.</span><span class="ident" id="4264034">enc</span><span class="op" id="4264037">.</span><span class="ident" id="4264038">decode</span><span class="op" id="4264044">(</span><span class="ident" id="4264045">p</span><span class="op" id="4264046">,</span>&nbsp;<span class="ident" id="4264048">d</span><span class="op" id="4264049">.</span><span class="ident" id="4264050">buf</span><span class="op" id="4264053">[</span><span class="num" id="4264054">0</span><span class="op" id="4264055">:</span><span class="ident" id="4264056">nr</span><span class="op" id="4264058">]</span><span class="op" id="4264059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264065">d</span><span class="op" id="4264066">.</span><span class="ident" id="4264067">nbuf</span>&nbsp;<span class="op" id="4264072">-=</span>&nbsp;<span class="ident" id="4264075">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264079">for</span>&nbsp;<span class="ident" id="4264083">i</span>&nbsp;<span class="op" id="4264085">:=</span>&nbsp;<span class="num" id="4264088">0</span><span class="op" id="4264089">;</span>&nbsp;<span class="ident" id="4264091">i</span>&nbsp;<span class="op" id="4264093">&lt;</span>&nbsp;<span class="ident" id="4264095">d</span><span class="op" id="4264096">.</span><span class="ident" id="4264097">nbuf</span><span class="op" id="4264101">;</span>&nbsp;<span class="ident" id="4264103">i</span><span class="op" id="4264104">++</span>&nbsp;<span class="op" id="4264107">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264111">d</span><span class="op" id="4264112">.</span><span class="ident" id="4264113">buf</span><span class="op" id="4264116">[</span><span class="ident" id="4264117">i</span><span class="op" id="4264118">]</span>&nbsp;<span class="op" id="4264120">=</span>&nbsp;<span class="ident" id="4264122">d</span><span class="op" id="4264123">.</span><span class="ident" id="4264124">buf</span><span class="op" id="4264127">[</span><span class="ident" id="4264128">i</span><span class="op" id="4264129">+</span><span class="ident" id="4264130">nr</span><span class="op" id="4264132">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264139">if</span>&nbsp;<span class="ident" id="4264142">d</span><span class="op" id="4264143">.</span><span class="ident" id="4264144">err</span>&nbsp;<span class="op" id="4264148">==</span>&nbsp;<span class="builtintype" id="4264151">nil</span>&nbsp;<span class="op" id="4264155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264159">d</span><span class="op" id="4264160">.</span><span class="ident" id="4264161">err</span>&nbsp;<span class="op" id="4264165">=</span>&nbsp;<span class="ident" id="4264167">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264175">return</span>&nbsp;<span class="ident" id="4264182">n</span><span class="op" id="4264183">,</span>&nbsp;<span class="ident" id="4264185">d</span><span class="op" id="4264186">.</span><span class="ident" id="4264187">err</span><br>
<span class="lineno"></span><span class="op" id="4264191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4264194">type</span>&nbsp;<span class="ident" id="4264199">newlineFilteringReader</span>&nbsp;<span class="keyword" id="4264222">struct</span>&nbsp;<span class="op" id="4264229">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264232">wrapped</span>&nbsp;<span class="ident" id="4264240">io</span><span class="op" id="4264242">.</span><span class="ident" id="4264243">Reader</span><br>
<span class="lineno"></span><span class="op" id="4264250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4264253">func</span>&nbsp;<span class="op" id="4264258">(</span><span class="ident" id="4264259">r</span>&nbsp;<span class="op" id="4264261">*</span><span class="ident" id="4264262">newlineFilteringReader</span><span class="op" id="4264284">)</span>&nbsp;<span class="ident" id="4264286">Read</span><span class="op" id="4264290">(</span><span class="ident" id="4264291">p</span>&nbsp;<span class="op" id="4264293">[</span><span class="op" id="4264294">]</span><span class="builtintype" id="4264295">byte</span><span class="op" id="4264299">)</span>&nbsp;<span class="op" id="4264301">(</span><span class="builtintype" id="4264302">int</span><span class="op" id="4264305">,</span>&nbsp;<span class="builtintype" id="4264307">error</span><span class="op" id="4264312">)</span>&nbsp;<span class="op" id="4264314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264317">n</span><span class="op" id="4264318">,</span>&nbsp;<span class="ident" id="4264320">err</span>&nbsp;<span class="op" id="4264324">:=</span>&nbsp;<span class="ident" id="4264327">r</span><span class="op" id="4264328">.</span><span class="ident" id="4264329">wrapped</span><span class="op" id="4264336">.</span><span class="ident" id="4264337">Read</span><span class="op" id="4264341">(</span><span class="ident" id="4264342">p</span><span class="op" id="4264343">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264346">for</span>&nbsp;<span class="ident" id="4264350">n</span>&nbsp;<span class="op" id="4264352">&gt;</span>&nbsp;<span class="num" id="4264354">0</span>&nbsp;<span class="op" id="4264356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264360">offset</span>&nbsp;<span class="op" id="4264367">:=</span>&nbsp;<span class="num" id="4264370">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264374">for</span>&nbsp;<span class="ident" id="4264378">i</span><span class="op" id="4264379">,</span>&nbsp;<span class="ident" id="4264381">b</span>&nbsp;<span class="op" id="4264383">:=</span>&nbsp;<span class="keyword" id="4264386">range</span>&nbsp;<span class="ident" id="4264392">p</span><span class="op" id="4264393">[</span><span class="num" id="4264394">0</span><span class="op" id="4264395">:</span><span class="ident" id="4264396">n</span><span class="op" id="4264397">]</span>&nbsp;<span class="op" id="4264399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264404">if</span>&nbsp;<span class="ident" id="4264407">b</span>&nbsp;<span class="op" id="4264409">!=</span>&nbsp;<span class="string" id="4264412">&#39;\r&#39;</span>&nbsp;<span class="op" id="4264417">&amp;&amp;</span>&nbsp;<span class="ident" id="4264420">b</span>&nbsp;<span class="op" id="4264422">!=</span>&nbsp;<span class="string" id="4264425">&#39;\n&#39;</span>&nbsp;<span class="op" id="4264430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264436">if</span>&nbsp;<span class="ident" id="4264439">i</span>&nbsp;<span class="op" id="4264441">!=</span>&nbsp;<span class="ident" id="4264444">offset</span>&nbsp;<span class="op" id="4264451">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264458">p</span><span class="op" id="4264459">[</span><span class="ident" id="4264460">offset</span><span class="op" id="4264466">]</span>&nbsp;<span class="op" id="4264468">=</span>&nbsp;<span class="ident" id="4264470">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264482">offset</span><span class="op" id="4264488">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264498">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264502">if</span>&nbsp;<span class="ident" id="4264505">offset</span>&nbsp;<span class="op" id="4264512">&gt;</span>&nbsp;<span class="num" id="4264514">0</span>&nbsp;<span class="op" id="4264516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264521">return</span>&nbsp;<span class="ident" id="4264528">offset</span><span class="op" id="4264534">,</span>&nbsp;<span class="ident" id="4264536">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4264546">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264599">n</span><span class="op" id="4264600">,</span>&nbsp;<span class="ident" id="4264602">err</span>&nbsp;<span class="op" id="4264606">=</span>&nbsp;<span class="ident" id="4264608">r</span><span class="op" id="4264609">.</span><span class="ident" id="4264610">wrapped</span><span class="op" id="4264617">.</span><span class="ident" id="4264618">Read</span><span class="op" id="4264622">(</span><span class="ident" id="4264623">p</span><span class="op" id="4264624">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264630">return</span>&nbsp;<span class="ident" id="4264637">n</span><span class="op" id="4264638">,</span>&nbsp;<span class="ident" id="4264640">err</span><br>
<span class="lineno"></span><span class="op" id="4264644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4264647">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="4264701">func</span>&nbsp;<span class="ident" id="4264706">NewDecoder</span><span class="op" id="4264716">(</span><span class="ident" id="4264717">enc</span>&nbsp;<span class="op" id="4264721">*</span><span class="ident" id="4264722">Encoding</span><span class="op" id="4264730">,</span>&nbsp;<span class="ident" id="4264732">r</span>&nbsp;<span class="ident" id="4264734">io</span><span class="op" id="4264736">.</span><span class="ident" id="4264737">Reader</span><span class="op" id="4264743">)</span>&nbsp;<span class="ident" id="4264745">io</span><span class="op" id="4264747">.</span><span class="ident" id="4264748">Reader</span>&nbsp;<span class="op" id="4264755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264758">return</span>&nbsp;<span class="op" id="4264765">&amp;</span><span class="ident" id="4264766">decoder</span><span class="op" id="4264773">{</span><span class="ident" id="4264774">enc</span><span class="op" id="4264777">:</span>&nbsp;<span class="ident" id="4264779">enc</span><span class="op" id="4264782">,</span>&nbsp;<span class="ident" id="4264784">r</span><span class="op" id="4264785">:</span>&nbsp;<span class="op" id="4264787">&amp;</span><span class="ident" id="4264788">newlineFilteringReader</span><span class="op" id="4264810">{</span><span class="ident" id="4264811">r</span><span class="op" id="4264812">}</span><span class="op" id="4264813">}</span><br>
<span class="lineno"></span><span class="op" id="4264815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4264818">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="4264888">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4264940">func</span>&nbsp;<span class="op" id="4264945">(</span><span class="ident" id="4264946">enc</span>&nbsp;<span class="op" id="4264950">*</span><span class="ident" id="4264951">Encoding</span><span class="op" id="4264959">)</span>&nbsp;<span class="ident" id="4264961">DecodedLen</span><span class="op" id="4264971">(</span><span class="ident" id="4264972">n</span>&nbsp;<span class="builtintype" id="4264974">int</span><span class="op" id="4264977">)</span>&nbsp;<span class="builtintype" id="4264979">int</span>&nbsp;<span class="op" id="4264983">{</span>&nbsp;<span class="keyword" id="4264985">return</span>&nbsp;<span class="ident" id="4264992">n</span>&nbsp;<span class="op" id="4264994">/</span>&nbsp;<span class="num" id="4264996">4</span>&nbsp;<span class="op" id="4264998">*</span>&nbsp;<span class="num" id="4265000">3</span>&nbsp;<span class="op" id="4265002">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
