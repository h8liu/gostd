<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html" class="current">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4240584">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4240639">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4240693">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4240744">package</span>&nbsp;<span class="ident" id="4240752">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4240758">import</span>&nbsp;<span class="op" id="4240765">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240768">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240777">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240786">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240796">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240803">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240809">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240822">&#34;net/http/internal&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240843">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240860">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240868">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240879">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240890">&#34;sync&#34;</span><br>
<span class="lineno">20</span><span class="op" id="4240897">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4240900">//&nbsp;ErrLineTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;request&nbsp;or&nbsp;response&nbsp;bodies</span><br>
<span class="lineno"></span><span class="comment" id="4240970">//&nbsp;with&nbsp;malformed&nbsp;chunked&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4241006">var</span>&nbsp;<span class="ident" id="4241010">ErrLineTooLong</span>&nbsp;<span class="op" id="4241025">=</span>&nbsp;<span class="ident" id="4241027"><a href="/gostd/net/http/transfer.go.html#4240822">internal</a></span><span class="op" id="4241035">.</span><span class="ident" id="4241036"><a href="/gostd/net/http/internal/chunked.go.html#4772694">ErrLineTooLong</a></span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4241052">type</span>&nbsp;<span class="ident" id="4241057">errorReader</span>&nbsp;<span class="keyword" id="4241069">struct</span>&nbsp;<span class="op" id="4241076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241079">err</span>&nbsp;<span class="builtintype" id="4241083">error</span><br>
<span class="lineno"></span><span class="op" id="4241089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4241092">func</span>&nbsp;<span class="op" id="4241097">(</span><span class="ident" id="4241098">r</span>&nbsp;<span class="op" id="4241100">*</span><span class="ident" id="4241101"><a href="/gostd/net/http/transfer.go.html#4241057">errorReader</a></span><span class="op" id="4241112">)</span>&nbsp;<span class="ident" id="4241114">Read</span><span class="op" id="4241118">(</span><span class="ident" id="4241119">p</span>&nbsp;<span class="op" id="4241121">[</span><span class="op" id="4241122">]</span><span class="builtintype" id="4241123">byte</span><span class="op" id="4241127">)</span>&nbsp;<span class="op" id="4241129">(</span><span class="ident" id="4241130">n</span>&nbsp;<span class="builtintype" id="4241132">int</span><span class="op" id="4241135">,</span>&nbsp;<span class="ident" id="4241137">err</span>&nbsp;<span class="builtintype" id="4241141">error</span><span class="op" id="4241146">)</span>&nbsp;<span class="op" id="4241148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4241151">return</span>&nbsp;<span class="num" id="4241158">0</span><span class="op" id="4241159">,</span>&nbsp;<span class="ident" id="4241161"><a href="/gostd/net/http/transfer.go.html#4241098">r</a></span><span class="op" id="4241162">.</span><span class="ident" id="4241163"><a href="/gostd/net/http/transfer.go.html#4241079">err</a></span><br>
<span class="lineno"></span><span class="op" id="4241167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4241170">//&nbsp;transferWriter&nbsp;inspects&nbsp;the&nbsp;fields&nbsp;of&nbsp;a&nbsp;user-supplied&nbsp;Request&nbsp;or&nbsp;Response,</span><br>
<span class="lineno">35</span><span class="comment" id="4241248">//&nbsp;sanitizes&nbsp;them&nbsp;without&nbsp;changing&nbsp;the&nbsp;user&nbsp;object&nbsp;and&nbsp;provides&nbsp;methods&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4241324">//&nbsp;writing&nbsp;the&nbsp;respective&nbsp;header,&nbsp;body&nbsp;and&nbsp;trailer&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="4241391">type</span>&nbsp;<span class="ident" id="4241396">transferWriter</span>&nbsp;<span class="keyword" id="4241411">struct</span>&nbsp;<span class="op" id="4241418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241421">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4241438">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241446">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241463"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4241465">.</span><span class="ident" id="4241466"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241474">BodyCloser</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241491"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4241493">.</span><span class="ident" id="4241494"><a href="/gostd/io/io.go.html#1422563">Closer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241502">ResponseToHEAD</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4241519">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241525">ContentLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4241542">int64</span>&nbsp;<span class="comment" id="4241548">//&nbsp;-1&nbsp;means&nbsp;unknown,&nbsp;0&nbsp;means&nbsp;exactly&nbsp;none</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241591">Close</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4241608">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241614">TransferEncoding</span>&nbsp;<span class="op" id="4241631">[</span><span class="op" id="4241632">]</span><span class="builtintype" id="4241633">string</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241641">Trailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241658"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><br>
<span class="lineno"></span><span class="op" id="4241665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4241668">func</span>&nbsp;<span class="ident" id="4241673">newTransferWriter</span><span class="op" id="4241690">(</span><span class="ident" id="4241691">r</span>&nbsp;<span class="keyword" id="4241693">interface</span><span class="op" id="4241702">{</span><span class="op" id="4241703">}</span><span class="op" id="4241704">)</span>&nbsp;<span class="op" id="4241706">(</span><span class="ident" id="4241707">t</span>&nbsp;<span class="op" id="4241709">*</span><span class="ident" id="4241710"><a href="/gostd/net/http/transfer.go.html#4241396">transferWriter</a></span><span class="op" id="4241724">,</span>&nbsp;<span class="ident" id="4241726">err</span>&nbsp;<span class="builtintype" id="4241730">error</span><span class="op" id="4241735">)</span>&nbsp;<span class="op" id="4241737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241740"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span>&nbsp;<span class="op" id="4241742">=</span>&nbsp;<span class="op" id="4241744">&amp;</span><span class="ident" id="4241745"><a href="/gostd/net/http/transfer.go.html#4241396">transferWriter</a></span><span class="op" id="4241759">{</span><span class="op" id="4241760">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4241764">//&nbsp;Extract&nbsp;relevant&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241792">atLeastHTTP11</span>&nbsp;<span class="op" id="4241806">:=</span>&nbsp;<span class="builtintype" id="4241809">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4241816">switch</span>&nbsp;<span class="ident" id="4241823">rr</span>&nbsp;<span class="op" id="4241826">:=</span>&nbsp;<span class="ident" id="4241829"><a href="/gostd/net/http/transfer.go.html#4241691">r</a></span><span class="op" id="4241830">.</span><span class="op" id="4241831">(</span><span class="keyword" id="4241832">type</span><span class="op" id="4241836">)</span>&nbsp;<span class="op" id="4241838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4241841">case</span>&nbsp;<span class="op" id="4241846">*</span><span class="ident" id="4241847"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4241854">:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4241858">if</span>&nbsp;<span class="ident" id="4241861"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4241863">.</span><span class="ident" id="4241864"><a href="/gostd/net/http/request.go.html#4138292">ContentLength</a></span>&nbsp;<span class="op" id="4241878">!=</span>&nbsp;<span class="num" id="4241881">0</span>&nbsp;<span class="op" id="4241883">&amp;&amp;</span>&nbsp;<span class="ident" id="4241886"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4241888">.</span><span class="ident" id="4241889"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="4241894">==</span>&nbsp;<span class="builtintype" id="4241897">nil</span>&nbsp;<span class="op" id="4241901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4241906">return</span>&nbsp;<span class="builtintype" id="4241913">nil</span><span class="op" id="4241916">,</span>&nbsp;<span class="ident" id="4241918"><a href="/gostd/net/http/transfer.go.html#4240796">fmt</a></span><span class="op" id="4241921">.</span><span class="ident" id="4241922"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4241928">(</span><span class="string" id="4241929">&#34;http:&nbsp;Request.ContentLength=%d&nbsp;with&nbsp;nil&nbsp;Body&#34;</span><span class="op" id="4241975">,</span>&nbsp;<span class="ident" id="4241977"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4241979">.</span><span class="ident" id="4241980"><a href="/gostd/net/http/request.go.html#4138292">ContentLength</a></span><span class="op" id="4241993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4241997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242001"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242002">.</span><span class="ident" id="4242003"><a href="/gostd/net/http/transfer.go.html#4241421">Method</a></span>&nbsp;<span class="op" id="4242010">=</span>&nbsp;<span class="ident" id="4242012"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4242014">.</span><span class="ident" id="4242015"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242024"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242025">.</span><span class="ident" id="4242026"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span>&nbsp;<span class="op" id="4242031">=</span>&nbsp;<span class="ident" id="4242033"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4242035">.</span><span class="ident" id="4242036"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242043"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242044">.</span><span class="ident" id="4242045"><a href="/gostd/net/http/transfer.go.html#4241474">BodyCloser</a></span>&nbsp;<span class="op" id="4242056">=</span>&nbsp;<span class="ident" id="4242058"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4242060">.</span><span class="ident" id="4242061"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242068"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242069">.</span><span class="ident" id="4242070"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4242084">=</span>&nbsp;<span class="ident" id="4242086"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4242088">.</span><span class="ident" id="4242089"><a href="/gostd/net/http/request.go.html#4138292">ContentLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242105"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242106">.</span><span class="ident" id="4242107"><a href="/gostd/net/http/transfer.go.html#4241591">Close</a></span>&nbsp;<span class="op" id="4242113">=</span>&nbsp;<span class="ident" id="4242115"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4242117">.</span><span class="ident" id="4242118"><a href="/gostd/net/http/request.go.html#4138776">Close</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242126"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242127">.</span><span class="ident" id="4242128"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span>&nbsp;<span class="op" id="4242145">=</span>&nbsp;<span class="ident" id="4242147"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4242149">.</span><span class="ident" id="4242150"><a href="/gostd/net/http/request.go.html#4138599">TransferEncoding</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242169"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242170">.</span><span class="ident" id="4242171"><a href="/gostd/net/http/transfer.go.html#4241641">Trailer</a></span>&nbsp;<span class="op" id="4242179">=</span>&nbsp;<span class="ident" id="4242181"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4242183">.</span><span class="ident" id="4242184"><a href="/gostd/net/http/request.go.html#4140820">Trailer</a></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242194"><a href="/gostd/net/http/transfer.go.html#4241792">atLeastHTTP11</a></span>&nbsp;<span class="op" id="4242208">=</span>&nbsp;<span class="ident" id="4242210"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4242212">.</span><span class="ident" id="4242213"><a href="/gostd/net/http/request.go.html#4142002">ProtoAtLeast</a></span><span class="op" id="4242225">(</span><span class="num" id="4242226">1</span><span class="op" id="4242227">,</span>&nbsp;<span class="num" id="4242229">1</span><span class="op" id="4242230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242234">if</span>&nbsp;<span class="ident" id="4242237"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242238">.</span><span class="ident" id="4242239"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span>&nbsp;<span class="op" id="4242244">!=</span>&nbsp;<span class="builtintype" id="4242247">nil</span>&nbsp;<span class="op" id="4242251">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4242254">len</span><span class="op" id="4242257">(</span><span class="ident" id="4242258"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242259">.</span><span class="ident" id="4242260"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span><span class="op" id="4242276">)</span>&nbsp;<span class="op" id="4242278">==</span>&nbsp;<span class="num" id="4242281">0</span>&nbsp;<span class="op" id="4242283">&amp;&amp;</span>&nbsp;<span class="ident" id="4242286"><a href="/gostd/net/http/transfer.go.html#4241792">atLeastHTTP11</a></span>&nbsp;<span class="op" id="4242300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242305">if</span>&nbsp;<span class="ident" id="4242308"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242309">.</span><span class="ident" id="4242310"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4242324">==</span>&nbsp;<span class="num" id="4242327">0</span>&nbsp;<span class="op" id="4242329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242335">//&nbsp;Test&nbsp;to&nbsp;see&nbsp;if&nbsp;it&#39;s&nbsp;actually&nbsp;zero&nbsp;or&nbsp;just&nbsp;unset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242391">var</span>&nbsp;<span class="ident" id="4242395">buf</span>&nbsp;<span class="op" id="4242399">[</span><span class="num" id="4242400">1</span><span class="op" id="4242401">]</span><span class="builtintype" id="4242402">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242411">n</span><span class="op" id="4242412">,</span>&nbsp;<span class="ident" id="4242414">rerr</span>&nbsp;<span class="op" id="4242419">:=</span>&nbsp;<span class="ident" id="4242422"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4242424">.</span><span class="ident" id="4242425"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4242433">(</span><span class="ident" id="4242434"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242435">.</span><span class="ident" id="4242436"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span><span class="op" id="4242440">,</span>&nbsp;<span class="ident" id="4242442"><a href="/gostd/net/http/transfer.go.html#4242395">buf</a></span><span class="op" id="4242445">[</span><span class="op" id="4242446">:</span><span class="op" id="4242447">]</span><span class="op" id="4242448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242454">if</span>&nbsp;<span class="ident" id="4242457"><a href="/gostd/net/http/transfer.go.html#4242414">rerr</a></span>&nbsp;<span class="op" id="4242462">!=</span>&nbsp;<span class="builtintype" id="4242465">nil</span>&nbsp;<span class="op" id="4242469">&amp;&amp;</span>&nbsp;<span class="ident" id="4242472"><a href="/gostd/net/http/transfer.go.html#4242414">rerr</a></span>&nbsp;<span class="op" id="4242477">!=</span>&nbsp;<span class="ident" id="4242480"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4242482">.</span><span class="ident" id="4242483"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="4242487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242494"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242495">.</span><span class="ident" id="4242496"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4242510">=</span>&nbsp;<span class="op" id="4242512">-</span><span class="num" id="4242513">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242520"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242521">.</span><span class="ident" id="4242522"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span>&nbsp;<span class="op" id="4242527">=</span>&nbsp;<span class="op" id="4242529">&amp;</span><span class="ident" id="4242530"><a href="/gostd/net/http/transfer.go.html#4241057">errorReader</a></span><span class="op" id="4242541">{</span><span class="ident" id="4242542"><a href="/gostd/net/http/transfer.go.html#4242414">rerr</a></span><span class="op" id="4242546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4242552">}</span>&nbsp;<span class="keyword" id="4242554">else</span>&nbsp;<span class="keyword" id="4242559">if</span>&nbsp;<span class="ident" id="4242562"><a href="/gostd/net/http/transfer.go.html#4242411">n</a></span>&nbsp;<span class="op" id="4242564">==</span>&nbsp;<span class="num" id="4242567">1</span>&nbsp;<span class="op" id="4242569">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242576">//&nbsp;Oh,&nbsp;guess&nbsp;there&nbsp;is&nbsp;data&nbsp;in&nbsp;this&nbsp;Body&nbsp;Reader&nbsp;after&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242639">//&nbsp;The&nbsp;ContentLength&nbsp;field&nbsp;just&nbsp;wasn&#39;t&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242688">//&nbsp;Stich&nbsp;the&nbsp;Body&nbsp;back&nbsp;together&nbsp;again,&nbsp;re-attaching&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242749">//&nbsp;consumed&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242772"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242773">.</span><span class="ident" id="4242774"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4242788">=</span>&nbsp;<span class="op" id="4242790">-</span><span class="num" id="4242791">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242798"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242799">.</span><span class="ident" id="4242800"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span>&nbsp;<span class="op" id="4242805">=</span>&nbsp;<span class="ident" id="4242807"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4242809">.</span><span class="ident" id="4242810"><a href="/gostd/io/multi.go.html#1435263">MultiReader</a></span><span class="op" id="4242821">(</span><span class="ident" id="4242822"><a href="/gostd/net/http/transfer.go.html#4240777">bytes</a></span><span class="op" id="4242827">.</span><span class="ident" id="4242828"><a href="/gostd/bytes/reader.go.html#1418136">NewReader</a></span><span class="op" id="4242837">(</span><span class="ident" id="4242838"><a href="/gostd/net/http/transfer.go.html#4242395">buf</a></span><span class="op" id="4242841">[</span><span class="op" id="4242842">:</span><span class="op" id="4242843">]</span><span class="op" id="4242844">)</span><span class="op" id="4242845">,</span>&nbsp;<span class="ident" id="4242847"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242848">.</span><span class="ident" id="4242849"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span><span class="op" id="4242853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4242859">}</span>&nbsp;<span class="keyword" id="4242861">else</span>&nbsp;<span class="op" id="4242866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242873">//&nbsp;Body&nbsp;is&nbsp;actually&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242905"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242906">.</span><span class="ident" id="4242907"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span>&nbsp;<span class="op" id="4242912">=</span>&nbsp;<span class="builtintype" id="4242914">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242923"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242924">.</span><span class="ident" id="4242925"><a href="/gostd/net/http/transfer.go.html#4241474">BodyCloser</a></span>&nbsp;<span class="op" id="4242936">=</span>&nbsp;<span class="builtintype" id="4242938">nil</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4242946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4242951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242956">if</span>&nbsp;<span class="ident" id="4242959"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242960">.</span><span class="ident" id="4242961"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4242975">&lt;</span>&nbsp;<span class="num" id="4242977">0</span>&nbsp;<span class="op" id="4242979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242985"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4242986">.</span><span class="ident" id="4242987"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span>&nbsp;<span class="op" id="4243004">=</span>&nbsp;<span class="op" id="4243006">[</span><span class="op" id="4243007">]</span><span class="builtintype" id="4243008">string</span><span class="op" id="4243014">{</span><span class="string" id="4243015">&#34;chunked&#34;</span><span class="op" id="4243024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243029">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243036">case</span>&nbsp;<span class="op" id="4243041">*</span><span class="ident" id="4243042"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><span class="op" id="4243050">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243054">if</span>&nbsp;<span class="ident" id="4243057"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4243059">.</span><span class="ident" id="4243060"><a href="/gostd/net/http/response.go.html#4163410">Request</a></span>&nbsp;<span class="op" id="4243068">!=</span>&nbsp;<span class="builtintype" id="4243071">nil</span>&nbsp;<span class="op" id="4243075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243080"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243081">.</span><span class="ident" id="4243082"><a href="/gostd/net/http/transfer.go.html#4241421">Method</a></span>&nbsp;<span class="op" id="4243089">=</span>&nbsp;<span class="ident" id="4243091"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4243093">.</span><span class="ident" id="4243094"><a href="/gostd/net/http/response.go.html#4163410">Request</a></span><span class="op" id="4243101">.</span><span class="ident" id="4243102"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243111">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243115"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243116">.</span><span class="ident" id="4243117"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span>&nbsp;<span class="op" id="4243122">=</span>&nbsp;<span class="ident" id="4243124"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4243126">.</span><span class="ident" id="4243127"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243134"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243135">.</span><span class="ident" id="4243136"><a href="/gostd/net/http/transfer.go.html#4241474">BodyCloser</a></span>&nbsp;<span class="op" id="4243147">=</span>&nbsp;<span class="ident" id="4243149"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4243151">.</span><span class="ident" id="4243152"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243159"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243160">.</span><span class="ident" id="4243161"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4243175">=</span>&nbsp;<span class="ident" id="4243177"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4243179">.</span><span class="ident" id="4243180"><a href="/gostd/net/http/response.go.html#4162765">ContentLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243196"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243197">.</span><span class="ident" id="4243198"><a href="/gostd/net/http/transfer.go.html#4241591">Close</a></span>&nbsp;<span class="op" id="4243204">=</span>&nbsp;<span class="ident" id="4243206"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4243208">.</span><span class="ident" id="4243209"><a href="/gostd/net/http/response.go.html#4163140">Close</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243217"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243218">.</span><span class="ident" id="4243219"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span>&nbsp;<span class="op" id="4243236">=</span>&nbsp;<span class="ident" id="4243238"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4243240">.</span><span class="ident" id="4243241"><a href="/gostd/net/http/response.go.html#4162908">TransferEncoding</a></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243260"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243261">.</span><span class="ident" id="4243262"><a href="/gostd/net/http/transfer.go.html#4241641">Trailer</a></span>&nbsp;<span class="op" id="4243270">=</span>&nbsp;<span class="ident" id="4243272"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4243274">.</span><span class="ident" id="4243275"><a href="/gostd/net/http/response.go.html#4163232">Trailer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243285"><a href="/gostd/net/http/transfer.go.html#4241792">atLeastHTTP11</a></span>&nbsp;<span class="op" id="4243299">=</span>&nbsp;<span class="ident" id="4243301"><a href="/gostd/net/http/transfer.go.html#4241823">rr</a></span><span class="op" id="4243303">.</span><span class="ident" id="4243304"><a href="/gostd/net/http/response.go.html#4166304">ProtoAtLeast</a></span><span class="op" id="4243316">(</span><span class="num" id="4243317">1</span><span class="op" id="4243318">,</span>&nbsp;<span class="num" id="4243320">1</span><span class="op" id="4243321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243325"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243326">.</span><span class="ident" id="4243327"><a href="/gostd/net/http/transfer.go.html#4241502">ResponseToHEAD</a></span>&nbsp;<span class="op" id="4243342">=</span>&nbsp;<span class="ident" id="4243344"><a href="/gostd/net/http/transfer.go.html#4243847">noBodyExpected</a></span><span class="op" id="4243358">(</span><span class="ident" id="4243359"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243360">.</span><span class="ident" id="4243361"><a href="/gostd/net/http/transfer.go.html#4241421">Method</a></span><span class="op" id="4243367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4243374">//&nbsp;Sanitize&nbsp;Body,ContentLength,TransferEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243423">if</span>&nbsp;<span class="ident" id="4243426"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243427">.</span><span class="ident" id="4243428"><a href="/gostd/net/http/transfer.go.html#4241502">ResponseToHEAD</a></span>&nbsp;<span class="op" id="4243443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243447"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243448">.</span><span class="ident" id="4243449"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span>&nbsp;<span class="op" id="4243454">=</span>&nbsp;<span class="builtintype" id="4243456">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243462">if</span>&nbsp;<span class="ident" id="4243465"><a href="/gostd/net/http/transfer.go.html#4250825">chunked</a></span><span class="op" id="4243472">(</span><span class="ident" id="4243473"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243474">.</span><span class="ident" id="4243475"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span><span class="op" id="4243491">)</span>&nbsp;<span class="op" id="4243493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243498"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243499">.</span><span class="ident" id="4243500"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4243514">=</span>&nbsp;<span class="op" id="4243516">-</span><span class="num" id="4243517">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243524">}</span>&nbsp;<span class="keyword" id="4243526">else</span>&nbsp;<span class="op" id="4243531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243535">if</span>&nbsp;<span class="op" id="4243538">!</span><span class="ident" id="4243539"><a href="/gostd/net/http/transfer.go.html#4241792">atLeastHTTP11</a></span>&nbsp;<span class="op" id="4243553">||</span>&nbsp;<span class="ident" id="4243556"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243557">.</span><span class="ident" id="4243558"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span>&nbsp;<span class="op" id="4243563">==</span>&nbsp;<span class="builtintype" id="4243566">nil</span>&nbsp;<span class="op" id="4243570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243575"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243576">.</span><span class="ident" id="4243577"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span>&nbsp;<span class="op" id="4243594">=</span>&nbsp;<span class="builtintype" id="4243596">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243602">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243606">if</span>&nbsp;<span class="ident" id="4243609"><a href="/gostd/net/http/transfer.go.html#4250825">chunked</a></span><span class="op" id="4243616">(</span><span class="ident" id="4243617"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243618">.</span><span class="ident" id="4243619"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span><span class="op" id="4243635">)</span>&nbsp;<span class="op" id="4243637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243642"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243643">.</span><span class="ident" id="4243644"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4243658">=</span>&nbsp;<span class="op" id="4243660">-</span><span class="num" id="4243661">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243665">}</span>&nbsp;<span class="keyword" id="4243667">else</span>&nbsp;<span class="keyword" id="4243672">if</span>&nbsp;<span class="ident" id="4243675"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243676">.</span><span class="ident" id="4243677"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span>&nbsp;<span class="op" id="4243682">==</span>&nbsp;<span class="builtintype" id="4243685">nil</span>&nbsp;<span class="op" id="4243689">{</span>&nbsp;<span class="comment" id="4243691">//&nbsp;no&nbsp;chunking,&nbsp;no&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243718"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243719">.</span><span class="ident" id="4243720"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4243734">=</span>&nbsp;<span class="num" id="4243736">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243740">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4243747">//&nbsp;Sanitize&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243768">if</span>&nbsp;<span class="op" id="4243771">!</span><span class="ident" id="4243772"><a href="/gostd/net/http/transfer.go.html#4250825">chunked</a></span><span class="op" id="4243779">(</span><span class="ident" id="4243780"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243781">.</span><span class="ident" id="4243782"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span><span class="op" id="4243798">)</span>&nbsp;<span class="op" id="4243800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243804"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243805">.</span><span class="ident" id="4243806"><a href="/gostd/net/http/transfer.go.html#4241641">Trailer</a></span>&nbsp;<span class="op" id="4243814">=</span>&nbsp;<span class="builtintype" id="4243816">nil</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243825">return</span>&nbsp;<span class="ident" id="4243832"><a href="/gostd/net/http/transfer.go.html#4241707">t</a></span><span class="op" id="4243833">,</span>&nbsp;<span class="builtintype" id="4243835">nil</span><br>
<span class="lineno"></span><span class="op" id="4243839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="4243842">func</span>&nbsp;<span class="ident" id="4243847">noBodyExpected</span><span class="op" id="4243861">(</span><span class="ident" id="4243862">requestMethod</span>&nbsp;<span class="builtintype" id="4243876">string</span><span class="op" id="4243882">)</span>&nbsp;<span class="builtintype" id="4243884">bool</span>&nbsp;<span class="op" id="4243889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243892">return</span>&nbsp;<span class="ident" id="4243899"><a href="/gostd/net/http/transfer.go.html#4243862">requestMethod</a></span>&nbsp;<span class="op" id="4243913">==</span>&nbsp;<span class="string" id="4243916">&#34;HEAD&#34;</span><br>
<span class="lineno"></span><span class="op" id="4243923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4243926">func</span>&nbsp;<span class="op" id="4243931">(</span><span class="ident" id="4243932">t</span>&nbsp;<span class="op" id="4243934">*</span><span class="ident" id="4243935"><a href="/gostd/net/http/transfer.go.html#4241396">transferWriter</a></span><span class="op" id="4243949">)</span>&nbsp;<span class="ident" id="4243951">shouldSendContentLength</span><span class="op" id="4243974">(</span><span class="op" id="4243975">)</span>&nbsp;<span class="builtintype" id="4243977">bool</span>&nbsp;<span class="op" id="4243982">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243985">if</span>&nbsp;<span class="ident" id="4243988"><a href="/gostd/net/http/transfer.go.html#4250825">chunked</a></span><span class="op" id="4243995">(</span><span class="ident" id="4243996"><a href="/gostd/net/http/transfer.go.html#4243932">t</a></span><span class="op" id="4243997">.</span><span class="ident" id="4243998"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span><span class="op" id="4244014">)</span>&nbsp;<span class="op" id="4244016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244020">return</span>&nbsp;<span class="builtintype" id="4244027">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244037">if</span>&nbsp;<span class="ident" id="4244040"><a href="/gostd/net/http/transfer.go.html#4243932">t</a></span><span class="op" id="4244041">.</span><span class="ident" id="4244042"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4244056">&gt;</span>&nbsp;<span class="num" id="4244058">0</span>&nbsp;<span class="op" id="4244060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244064">return</span>&nbsp;<span class="builtintype" id="4244071">true</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4244080">//&nbsp;Many&nbsp;servers&nbsp;expect&nbsp;a&nbsp;Content-Length&nbsp;for&nbsp;these&nbsp;methods</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244139">if</span>&nbsp;<span class="ident" id="4244142"><a href="/gostd/net/http/transfer.go.html#4243932">t</a></span><span class="op" id="4244143">.</span><span class="ident" id="4244144"><a href="/gostd/net/http/transfer.go.html#4241421">Method</a></span>&nbsp;<span class="op" id="4244151">==</span>&nbsp;<span class="string" id="4244154">&#34;POST&#34;</span>&nbsp;<span class="op" id="4244161">||</span>&nbsp;<span class="ident" id="4244164"><a href="/gostd/net/http/transfer.go.html#4243932">t</a></span><span class="op" id="4244165">.</span><span class="ident" id="4244166"><a href="/gostd/net/http/transfer.go.html#4241421">Method</a></span>&nbsp;<span class="op" id="4244173">==</span>&nbsp;<span class="string" id="4244176">&#34;PUT&#34;</span>&nbsp;<span class="op" id="4244182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244186">return</span>&nbsp;<span class="builtintype" id="4244193">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244199">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244202">if</span>&nbsp;<span class="ident" id="4244205"><a href="/gostd/net/http/transfer.go.html#4243932">t</a></span><span class="op" id="4244206">.</span><span class="ident" id="4244207"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4244221">==</span>&nbsp;<span class="num" id="4244224">0</span>&nbsp;<span class="op" id="4244226">&amp;&amp;</span>&nbsp;<span class="ident" id="4244229"><a href="/gostd/net/http/transfer.go.html#4250959">isIdentity</a></span><span class="op" id="4244239">(</span><span class="ident" id="4244240"><a href="/gostd/net/http/transfer.go.html#4243932">t</a></span><span class="op" id="4244241">.</span><span class="ident" id="4244242"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span><span class="op" id="4244258">)</span>&nbsp;<span class="op" id="4244260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244264">return</span>&nbsp;<span class="builtintype" id="4244271">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244281">return</span>&nbsp;<span class="builtintype" id="4244288">false</span><br>
<span class="lineno">150</span><span class="op" id="4244294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4244297">func</span>&nbsp;<span class="op" id="4244302">(</span><span class="ident" id="4244303">t</span>&nbsp;<span class="op" id="4244305">*</span><span class="ident" id="4244306"><a href="/gostd/net/http/transfer.go.html#4241396">transferWriter</a></span><span class="op" id="4244320">)</span>&nbsp;<span class="ident" id="4244322">WriteHeader</span><span class="op" id="4244333">(</span><span class="ident" id="4244334">w</span>&nbsp;<span class="ident" id="4244336"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4244338">.</span><span class="ident" id="4244339"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="4244345">)</span>&nbsp;<span class="builtintype" id="4244347">error</span>&nbsp;<span class="op" id="4244353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244356">if</span>&nbsp;<span class="ident" id="4244359"><a href="/gostd/net/http/transfer.go.html#4244303">t</a></span><span class="op" id="4244360">.</span><span class="ident" id="4244361"><a href="/gostd/net/http/transfer.go.html#4241591">Close</a></span>&nbsp;<span class="op" id="4244367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244371">if</span>&nbsp;<span class="ident" id="4244374">_</span><span class="op" id="4244375">,</span>&nbsp;<span class="ident" id="4244377">err</span>&nbsp;<span class="op" id="4244381">:=</span>&nbsp;<span class="ident" id="4244384"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4244386">.</span><span class="ident" id="4244387"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="4244398">(</span><span class="ident" id="4244399"><a href="/gostd/net/http/transfer.go.html#4244334">w</a></span><span class="op" id="4244400">,</span>&nbsp;<span class="string" id="4244402">&#34;Connection:&nbsp;close\r\n&#34;</span><span class="op" id="4244425">)</span><span class="op" id="4244426">;</span>&nbsp;<span class="ident" id="4244428"><a href="/gostd/net/http/transfer.go.html#4244377">err</a></span>&nbsp;<span class="op" id="4244432">!=</span>&nbsp;<span class="builtintype" id="4244435">nil</span>&nbsp;<span class="op" id="4244439">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244444">return</span>&nbsp;<span class="ident" id="4244451"><a href="/gostd/net/http/transfer.go.html#4244377">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4244464">//&nbsp;Write&nbsp;Content-Length&nbsp;and/or&nbsp;Transfer-Encoding&nbsp;whose&nbsp;values&nbsp;are&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4244533">//&nbsp;function&nbsp;of&nbsp;the&nbsp;sanitized&nbsp;field&nbsp;triple&nbsp;(Body,&nbsp;ContentLength,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4244598">//&nbsp;TransferEncoding)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244620">if</span>&nbsp;<span class="ident" id="4244623"><a href="/gostd/net/http/transfer.go.html#4244303">t</a></span><span class="op" id="4244624">.</span><span class="ident" id="4244625"><a href="/gostd/net/http/transfer.go.html#4243951">shouldSendContentLength</a></span><span class="op" id="4244648">(</span><span class="op" id="4244649">)</span>&nbsp;<span class="op" id="4244651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244655">if</span>&nbsp;<span class="ident" id="4244658">_</span><span class="op" id="4244659">,</span>&nbsp;<span class="ident" id="4244661">err</span>&nbsp;<span class="op" id="4244665">:=</span>&nbsp;<span class="ident" id="4244668"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4244670">.</span><span class="ident" id="4244671"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="4244682">(</span><span class="ident" id="4244683"><a href="/gostd/net/http/transfer.go.html#4244334">w</a></span><span class="op" id="4244684">,</span>&nbsp;<span class="string" id="4244686">&#34;Content-Length:&nbsp;&#34;</span><span class="op" id="4244704">)</span><span class="op" id="4244705">;</span>&nbsp;<span class="ident" id="4244707"><a href="/gostd/net/http/transfer.go.html#4244661">err</a></span>&nbsp;<span class="op" id="4244711">!=</span>&nbsp;<span class="builtintype" id="4244714">nil</span>&nbsp;<span class="op" id="4244718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244723">return</span>&nbsp;<span class="ident" id="4244730"><a href="/gostd/net/http/transfer.go.html#4244661">err</a></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244740">if</span>&nbsp;<span class="ident" id="4244743">_</span><span class="op" id="4244744">,</span>&nbsp;<span class="ident" id="4244746">err</span>&nbsp;<span class="op" id="4244750">:=</span>&nbsp;<span class="ident" id="4244753"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4244755">.</span><span class="ident" id="4244756"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="4244767">(</span><span class="ident" id="4244768"><a href="/gostd/net/http/transfer.go.html#4244334">w</a></span><span class="op" id="4244769">,</span>&nbsp;<span class="ident" id="4244771"><a href="/gostd/net/http/transfer.go.html#4240868">strconv</a></span><span class="op" id="4244778">.</span><span class="ident" id="4244779"><a href="/gostd/strconv/itoa.go.html#2407133">FormatInt</a></span><span class="op" id="4244788">(</span><span class="ident" id="4244789"><a href="/gostd/net/http/transfer.go.html#4244303">t</a></span><span class="op" id="4244790">.</span><span class="ident" id="4244791"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span><span class="op" id="4244804">,</span>&nbsp;<span class="num" id="4244806">10</span><span class="op" id="4244808">)</span><span class="op" id="4244809">+</span><span class="string" id="4244810">&#34;\r\n&#34;</span><span class="op" id="4244816">)</span><span class="op" id="4244817">;</span>&nbsp;<span class="ident" id="4244819"><a href="/gostd/net/http/transfer.go.html#4244746">err</a></span>&nbsp;<span class="op" id="4244823">!=</span>&nbsp;<span class="builtintype" id="4244826">nil</span>&nbsp;<span class="op" id="4244830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244835">return</span>&nbsp;<span class="ident" id="4244842"><a href="/gostd/net/http/transfer.go.html#4244746">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244851">}</span>&nbsp;<span class="keyword" id="4244853">else</span>&nbsp;<span class="keyword" id="4244858">if</span>&nbsp;<span class="ident" id="4244861"><a href="/gostd/net/http/transfer.go.html#4250825">chunked</a></span><span class="op" id="4244868">(</span><span class="ident" id="4244869"><a href="/gostd/net/http/transfer.go.html#4244303">t</a></span><span class="op" id="4244870">.</span><span class="ident" id="4244871"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span><span class="op" id="4244887">)</span>&nbsp;<span class="op" id="4244889">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244893">if</span>&nbsp;<span class="ident" id="4244896">_</span><span class="op" id="4244897">,</span>&nbsp;<span class="ident" id="4244899">err</span>&nbsp;<span class="op" id="4244903">:=</span>&nbsp;<span class="ident" id="4244906"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4244908">.</span><span class="ident" id="4244909"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="4244920">(</span><span class="ident" id="4244921"><a href="/gostd/net/http/transfer.go.html#4244334">w</a></span><span class="op" id="4244922">,</span>&nbsp;<span class="string" id="4244924">&#34;Transfer-Encoding:&nbsp;chunked\r\n&#34;</span><span class="op" id="4244956">)</span><span class="op" id="4244957">;</span>&nbsp;<span class="ident" id="4244959"><a href="/gostd/net/http/transfer.go.html#4244899">err</a></span>&nbsp;<span class="op" id="4244963">!=</span>&nbsp;<span class="builtintype" id="4244966">nil</span>&nbsp;<span class="op" id="4244970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244975">return</span>&nbsp;<span class="ident" id="4244982"><a href="/gostd/net/http/transfer.go.html#4244899">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4244995">//&nbsp;Write&nbsp;Trailer&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245020">if</span>&nbsp;<span class="ident" id="4245023"><a href="/gostd/net/http/transfer.go.html#4244303">t</a></span><span class="op" id="4245024">.</span><span class="ident" id="4245025"><a href="/gostd/net/http/transfer.go.html#4241641">Trailer</a></span>&nbsp;<span class="op" id="4245033">!=</span>&nbsp;<span class="builtintype" id="4245036">nil</span>&nbsp;<span class="op" id="4245040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245044">keys</span>&nbsp;<span class="op" id="4245049">:=</span>&nbsp;<span class="builtinfunc" id="4245052">make</span><span class="op" id="4245056">(</span><span class="op" id="4245057">[</span><span class="op" id="4245058">]</span><span class="builtintype" id="4245059">string</span><span class="op" id="4245065">,</span>&nbsp;<span class="num" id="4245067">0</span><span class="op" id="4245068">,</span>&nbsp;<span class="builtinfunc" id="4245070">len</span><span class="op" id="4245073">(</span><span class="ident" id="4245074"><a href="/gostd/net/http/transfer.go.html#4244303">t</a></span><span class="op" id="4245075">.</span><span class="ident" id="4245076"><a href="/gostd/net/http/transfer.go.html#4241641">Trailer</a></span><span class="op" id="4245083">)</span><span class="op" id="4245084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245088">for</span>&nbsp;<span class="ident" id="4245092">k</span>&nbsp;<span class="op" id="4245094">:=</span>&nbsp;<span class="keyword" id="4245097">range</span>&nbsp;<span class="ident" id="4245103"><a href="/gostd/net/http/transfer.go.html#4244303">t</a></span><span class="op" id="4245104">.</span><span class="ident" id="4245105"><a href="/gostd/net/http/transfer.go.html#4241641">Trailer</a></span>&nbsp;<span class="op" id="4245113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245118"><a href="/gostd/net/http/transfer.go.html#4245092">k</a></span>&nbsp;<span class="op" id="4245120">=</span>&nbsp;<span class="ident" id="4245122"><a href="/gostd/net/http/header.go.html#4130232">CanonicalHeaderKey</a></span><span class="op" id="4245140">(</span><span class="ident" id="4245141"><a href="/gostd/net/http/transfer.go.html#4245092">k</a></span><span class="op" id="4245142">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245147">switch</span>&nbsp;<span class="ident" id="4245154"><a href="/gostd/net/http/transfer.go.html#4245092">k</a></span>&nbsp;<span class="op" id="4245156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245161">case</span>&nbsp;<span class="string" id="4245166">&#34;Transfer-Encoding&#34;</span><span class="op" id="4245185">,</span>&nbsp;<span class="string" id="4245187">&#34;Trailer&#34;</span><span class="op" id="4245196">,</span>&nbsp;<span class="string" id="4245198">&#34;Content-Length&#34;</span><span class="op" id="4245214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245220">return</span>&nbsp;<span class="op" id="4245227">&amp;</span><span class="ident" id="4245228"><a href="/gostd/net/http/request.go.html#4135248">badStringError</a></span><span class="op" id="4245242">{</span><span class="string" id="4245243">&#34;invalid&nbsp;Trailer&nbsp;key&#34;</span><span class="op" id="4245264">,</span>&nbsp;<span class="ident" id="4245266"><a href="/gostd/net/http/transfer.go.html#4245092">k</a></span><span class="op" id="4245267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4245272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245277"><a href="/gostd/net/http/transfer.go.html#4245044">keys</a></span>&nbsp;<span class="op" id="4245282">=</span>&nbsp;<span class="builtinfunc" id="4245284">append</span><span class="op" id="4245290">(</span><span class="ident" id="4245291"><a href="/gostd/net/http/transfer.go.html#4245044">keys</a></span><span class="op" id="4245295">,</span>&nbsp;<span class="ident" id="4245297"><a href="/gostd/net/http/transfer.go.html#4245092">k</a></span><span class="op" id="4245298">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4245302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245306">if</span>&nbsp;<span class="builtinfunc" id="4245309">len</span><span class="op" id="4245312">(</span><span class="ident" id="4245313"><a href="/gostd/net/http/transfer.go.html#4245044">keys</a></span><span class="op" id="4245317">)</span>&nbsp;<span class="op" id="4245319">&gt;</span>&nbsp;<span class="num" id="4245321">0</span>&nbsp;<span class="op" id="4245323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245328"><a href="/gostd/net/http/transfer.go.html#4240860">sort</a></span><span class="op" id="4245332">.</span><span class="ident" id="4245333"><a href="/gostd/sort/sort.go.html#2017831">Strings</a></span><span class="op" id="4245340">(</span><span class="ident" id="4245341"><a href="/gostd/net/http/transfer.go.html#4245044">keys</a></span><span class="op" id="4245345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4245350">//&nbsp;TODO:&nbsp;could&nbsp;do&nbsp;better&nbsp;allocation-wise&nbsp;here,&nbsp;but&nbsp;trailers&nbsp;are&nbsp;rare,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4245423">//&nbsp;so&nbsp;being&nbsp;lazy&nbsp;for&nbsp;now.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245452">if</span>&nbsp;<span class="ident" id="4245455">_</span><span class="op" id="4245456">,</span>&nbsp;<span class="ident" id="4245458">err</span>&nbsp;<span class="op" id="4245462">:=</span>&nbsp;<span class="ident" id="4245465"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4245467">.</span><span class="ident" id="4245468"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="4245479">(</span><span class="ident" id="4245480"><a href="/gostd/net/http/transfer.go.html#4244334">w</a></span><span class="op" id="4245481">,</span>&nbsp;<span class="string" id="4245483">&#34;Trailer:&nbsp;&#34;</span><span class="op" id="4245494">+</span><span class="ident" id="4245495"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4245502">.</span><span class="ident" id="4245503"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="4245507">(</span><span class="ident" id="4245508"><a href="/gostd/net/http/transfer.go.html#4245044">keys</a></span><span class="op" id="4245512">,</span>&nbsp;<span class="string" id="4245514">&#34;,&#34;</span><span class="op" id="4245517">)</span><span class="op" id="4245518">+</span><span class="string" id="4245519">&#34;\r\n&#34;</span><span class="op" id="4245525">)</span><span class="op" id="4245526">;</span>&nbsp;<span class="ident" id="4245528"><a href="/gostd/net/http/transfer.go.html#4245458">err</a></span>&nbsp;<span class="op" id="4245532">!=</span>&nbsp;<span class="builtintype" id="4245535">nil</span>&nbsp;<span class="op" id="4245539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245545">return</span>&nbsp;<span class="ident" id="4245552"><a href="/gostd/net/http/transfer.go.html#4245458">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4245559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4245563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4245566">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245570">return</span>&nbsp;<span class="builtintype" id="4245577">nil</span><br>
<span class="lineno"></span><span class="op" id="4245581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4245584">func</span>&nbsp;<span class="op" id="4245589">(</span><span class="ident" id="4245590">t</span>&nbsp;<span class="op" id="4245592">*</span><span class="ident" id="4245593"><a href="/gostd/net/http/transfer.go.html#4241396">transferWriter</a></span><span class="op" id="4245607">)</span>&nbsp;<span class="ident" id="4245609">WriteBody</span><span class="op" id="4245618">(</span><span class="ident" id="4245619">w</span>&nbsp;<span class="ident" id="4245621"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4245623">.</span><span class="ident" id="4245624"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="4245630">)</span>&nbsp;<span class="builtintype" id="4245632">error</span>&nbsp;<span class="op" id="4245638">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245641">var</span>&nbsp;<span class="ident" id="4245645">err</span>&nbsp;<span class="builtintype" id="4245649">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245656">var</span>&nbsp;<span class="ident" id="4245660">ncopy</span>&nbsp;<span class="builtintype" id="4245666">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4245674">//&nbsp;Write&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245689">if</span>&nbsp;<span class="ident" id="4245692"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4245693">.</span><span class="ident" id="4245694"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span>&nbsp;<span class="op" id="4245699">!=</span>&nbsp;<span class="builtintype" id="4245702">nil</span>&nbsp;<span class="op" id="4245706">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245710">if</span>&nbsp;<span class="ident" id="4245713"><a href="/gostd/net/http/transfer.go.html#4250825">chunked</a></span><span class="op" id="4245720">(</span><span class="ident" id="4245721"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4245722">.</span><span class="ident" id="4245723"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span><span class="op" id="4245739">)</span>&nbsp;<span class="op" id="4245741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245746">cw</span>&nbsp;<span class="op" id="4245749">:=</span>&nbsp;<span class="ident" id="4245752"><a href="/gostd/net/http/transfer.go.html#4240822">internal</a></span><span class="op" id="4245760">.</span><span class="ident" id="4245761"><a href="/gostd/net/http/internal/chunked.go.html#4775998">NewChunkedWriter</a></span><span class="op" id="4245777">(</span><span class="ident" id="4245778"><a href="/gostd/net/http/transfer.go.html#4245619">w</a></span><span class="op" id="4245779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245784">_</span><span class="op" id="4245785">,</span>&nbsp;<span class="ident" id="4245787"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span>&nbsp;<span class="op" id="4245791">=</span>&nbsp;<span class="ident" id="4245793"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4245795">.</span><span class="ident" id="4245796"><a href="/gostd/io/io.go.html#1430946">Copy</a></span><span class="op" id="4245800">(</span><span class="ident" id="4245801"><a href="/gostd/net/http/transfer.go.html#4245746">cw</a></span><span class="op" id="4245803">,</span>&nbsp;<span class="ident" id="4245805"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4245806">.</span><span class="ident" id="4245807"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span><span class="op" id="4245811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245816">if</span>&nbsp;<span class="ident" id="4245819"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span>&nbsp;<span class="op" id="4245823">==</span>&nbsp;<span class="builtintype" id="4245826">nil</span>&nbsp;<span class="op" id="4245830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245836"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span>&nbsp;<span class="op" id="4245840">=</span>&nbsp;<span class="ident" id="4245842"><a href="/gostd/net/http/transfer.go.html#4245746">cw</a></span><span class="op" id="4245844">.</span><span class="ident" id="4245845"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="4245850">(</span><span class="op" id="4245851">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4245856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4245860">}</span>&nbsp;<span class="keyword" id="4245862">else</span>&nbsp;<span class="keyword" id="4245867">if</span>&nbsp;<span class="ident" id="4245870"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4245871">.</span><span class="ident" id="4245872"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4245886">==</span>&nbsp;<span class="op" id="4245889">-</span><span class="num" id="4245890">1</span>&nbsp;<span class="op" id="4245892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245897"><a href="/gostd/net/http/transfer.go.html#4245660">ncopy</a></span><span class="op" id="4245902">,</span>&nbsp;<span class="ident" id="4245904"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span>&nbsp;<span class="op" id="4245908">=</span>&nbsp;<span class="ident" id="4245910"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4245912">.</span><span class="ident" id="4245913"><a href="/gostd/io/io.go.html#1430946">Copy</a></span><span class="op" id="4245917">(</span><span class="ident" id="4245918"><a href="/gostd/net/http/transfer.go.html#4245619">w</a></span><span class="op" id="4245919">,</span>&nbsp;<span class="ident" id="4245921"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4245922">.</span><span class="ident" id="4245923"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span><span class="op" id="4245927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4245931">}</span>&nbsp;<span class="keyword" id="4245933">else</span>&nbsp;<span class="op" id="4245938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245943"><a href="/gostd/net/http/transfer.go.html#4245660">ncopy</a></span><span class="op" id="4245948">,</span>&nbsp;<span class="ident" id="4245950"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span>&nbsp;<span class="op" id="4245954">=</span>&nbsp;<span class="ident" id="4245956"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4245958">.</span><span class="ident" id="4245959"><a href="/gostd/io/io.go.html#1430946">Copy</a></span><span class="op" id="4245963">(</span><span class="ident" id="4245964"><a href="/gostd/net/http/transfer.go.html#4245619">w</a></span><span class="op" id="4245965">,</span>&nbsp;<span class="ident" id="4245967"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4245969">.</span><span class="ident" id="4245970"><a href="/gostd/io/io.go.html#1431815">LimitReader</a></span><span class="op" id="4245981">(</span><span class="ident" id="4245982"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4245983">.</span><span class="ident" id="4245984"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span><span class="op" id="4245988">,</span>&nbsp;<span class="ident" id="4245990"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4245991">.</span><span class="ident" id="4245992"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span><span class="op" id="4246005">)</span><span class="op" id="4246006">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246011">if</span>&nbsp;<span class="ident" id="4246014"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span>&nbsp;<span class="op" id="4246018">!=</span>&nbsp;<span class="builtintype" id="4246021">nil</span>&nbsp;<span class="op" id="4246025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246031">return</span>&nbsp;<span class="ident" id="4246038"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246050">var</span>&nbsp;<span class="ident" id="4246054">nextra</span>&nbsp;<span class="builtintype" id="4246061">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246070"><a href="/gostd/net/http/transfer.go.html#4246054">nextra</a></span><span class="op" id="4246076">,</span>&nbsp;<span class="ident" id="4246078"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span>&nbsp;<span class="op" id="4246082">=</span>&nbsp;<span class="ident" id="4246084"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4246086">.</span><span class="ident" id="4246087"><a href="/gostd/io/io.go.html#1430946">Copy</a></span><span class="op" id="4246091">(</span><span class="ident" id="4246092"><a href="/gostd/net/http/transfer.go.html#4240809">ioutil</a></span><span class="op" id="4246098">.</span><span class="ident" id="4246099"><a href="/gostd/io/ioutil/ioutil.go.html#3768458">Discard</a></span><span class="op" id="4246106">,</span>&nbsp;<span class="ident" id="4246108"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4246109">.</span><span class="ident" id="4246110"><a href="/gostd/net/http/transfer.go.html#4241446">Body</a></span><span class="op" id="4246114">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246119"><a href="/gostd/net/http/transfer.go.html#4245660">ncopy</a></span>&nbsp;<span class="op" id="4246125">+=</span>&nbsp;<span class="ident" id="4246128"><a href="/gostd/net/http/transfer.go.html#4246054">nextra</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246141">if</span>&nbsp;<span class="ident" id="4246144"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span>&nbsp;<span class="op" id="4246148">!=</span>&nbsp;<span class="builtintype" id="4246151">nil</span>&nbsp;<span class="op" id="4246155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246160">return</span>&nbsp;<span class="ident" id="4246167"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246173">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246177">if</span>&nbsp;<span class="ident" id="4246180"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span>&nbsp;<span class="op" id="4246184">=</span>&nbsp;<span class="ident" id="4246186"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4246187">.</span><span class="ident" id="4246188"><a href="/gostd/net/http/transfer.go.html#4241474">BodyCloser</a></span><span class="op" id="4246198">.</span><span class="ident" id="4246199"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="4246204">(</span><span class="op" id="4246205">)</span><span class="op" id="4246206">;</span>&nbsp;<span class="ident" id="4246208"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span>&nbsp;<span class="op" id="4246212">!=</span>&nbsp;<span class="builtintype" id="4246215">nil</span>&nbsp;<span class="op" id="4246219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246224">return</span>&nbsp;<span class="ident" id="4246231"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246244">if</span>&nbsp;<span class="op" id="4246247">!</span><span class="ident" id="4246248"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4246249">.</span><span class="ident" id="4246250"><a href="/gostd/net/http/transfer.go.html#4241502">ResponseToHEAD</a></span>&nbsp;<span class="op" id="4246265">&amp;&amp;</span>&nbsp;<span class="ident" id="4246268"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4246269">.</span><span class="ident" id="4246270"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4246284">!=</span>&nbsp;<span class="op" id="4246287">-</span><span class="num" id="4246288">1</span>&nbsp;<span class="op" id="4246290">&amp;&amp;</span>&nbsp;<span class="ident" id="4246293"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4246294">.</span><span class="ident" id="4246295"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span>&nbsp;<span class="op" id="4246309">!=</span>&nbsp;<span class="ident" id="4246312"><a href="/gostd/net/http/transfer.go.html#4245660">ncopy</a></span>&nbsp;<span class="op" id="4246318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246322">return</span>&nbsp;<span class="ident" id="4246329"><a href="/gostd/net/http/transfer.go.html#4240796">fmt</a></span><span class="op" id="4246332">.</span><span class="ident" id="4246333"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4246339">(</span><span class="string" id="4246340">&#34;http:&nbsp;ContentLength=%d&nbsp;with&nbsp;Body&nbsp;length&nbsp;%d&#34;</span><span class="op" id="4246384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246389"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4246390">.</span><span class="ident" id="4246391"><a href="/gostd/net/http/transfer.go.html#4241525">ContentLength</a></span><span class="op" id="4246404">,</span>&nbsp;<span class="ident" id="4246406"><a href="/gostd/net/http/transfer.go.html#4245660">ncopy</a></span><span class="op" id="4246411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246418">//&nbsp;TODO(petar):&nbsp;Place&nbsp;trailer&nbsp;writer&nbsp;code&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246467">if</span>&nbsp;<span class="ident" id="4246470"><a href="/gostd/net/http/transfer.go.html#4250825">chunked</a></span><span class="op" id="4246477">(</span><span class="ident" id="4246478"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4246479">.</span><span class="ident" id="4246480"><a href="/gostd/net/http/transfer.go.html#4241614">TransferEncoding</a></span><span class="op" id="4246496">)</span>&nbsp;<span class="op" id="4246498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246502">//&nbsp;Write&nbsp;Trailer&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246528">if</span>&nbsp;<span class="ident" id="4246531"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4246532">.</span><span class="ident" id="4246533"><a href="/gostd/net/http/transfer.go.html#4241641">Trailer</a></span>&nbsp;<span class="op" id="4246541">!=</span>&nbsp;<span class="builtintype" id="4246544">nil</span>&nbsp;<span class="op" id="4246548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246553">if</span>&nbsp;<span class="ident" id="4246556">err</span>&nbsp;<span class="op" id="4246560">:=</span>&nbsp;<span class="ident" id="4246563"><a href="/gostd/net/http/transfer.go.html#4245590">t</a></span><span class="op" id="4246564">.</span><span class="ident" id="4246565"><a href="/gostd/net/http/transfer.go.html#4241641">Trailer</a></span><span class="op" id="4246572">.</span><span class="ident" id="4246573"><a href="/gostd/net/http/header.go.html#4127211">Write</a></span><span class="op" id="4246578">(</span><span class="ident" id="4246579"><a href="/gostd/net/http/transfer.go.html#4245619">w</a></span><span class="op" id="4246580">)</span><span class="op" id="4246581">;</span>&nbsp;<span class="ident" id="4246583"><a href="/gostd/net/http/transfer.go.html#4246556">err</a></span>&nbsp;<span class="op" id="4246587">!=</span>&nbsp;<span class="builtintype" id="4246590">nil</span>&nbsp;<span class="op" id="4246594">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246600">return</span>&nbsp;<span class="ident" id="4246607"><a href="/gostd/net/http/transfer.go.html#4246556">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246622">//&nbsp;Last&nbsp;chunk,&nbsp;empty&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246653">_</span><span class="op" id="4246654">,</span>&nbsp;<span class="ident" id="4246656"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span>&nbsp;<span class="op" id="4246660">=</span>&nbsp;<span class="ident" id="4246662"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4246664">.</span><span class="ident" id="4246665"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="4246676">(</span><span class="ident" id="4246677"><a href="/gostd/net/http/transfer.go.html#4245619">w</a></span><span class="op" id="4246678">,</span>&nbsp;<span class="string" id="4246680">&#34;\r\n&#34;</span><span class="op" id="4246686">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246692">return</span>&nbsp;<span class="ident" id="4246699"><a href="/gostd/net/http/transfer.go.html#4245645">err</a></span><br>
<span class="lineno"></span><span class="op" id="4246703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4246706">type</span>&nbsp;<span class="ident" id="4246711">transferReader</span>&nbsp;<span class="keyword" id="4246726">struct</span>&nbsp;<span class="op" id="4246733">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246736">//&nbsp;Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246746">Header</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246760"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246768">StatusCode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4246782">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246787">RequestMethod</span>&nbsp;<span class="builtintype" id="4246801">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246809">ProtoMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4246823">int</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246828">ProtoMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4246842">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246847">//&nbsp;Output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246858">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246875"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4246877">.</span><span class="ident" id="4246878"><a href="/gostd/io/io.go.html#1423414">ReadCloser</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246890">ContentLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4246907">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246914">TransferEncoding</span>&nbsp;<span class="op" id="4246931">[</span><span class="op" id="4246932">]</span><span class="builtintype" id="4246933">string</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246941">Close</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4246958">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246964">Trailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246981"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><br>
<span class="lineno"></span><span class="op" id="4246988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4246991">//&nbsp;bodyAllowedForStatus&nbsp;reports&nbsp;whether&nbsp;a&nbsp;given&nbsp;response&nbsp;status&nbsp;code</span><br>
<span class="lineno">265</span><span class="comment" id="4247060">//&nbsp;permits&nbsp;a&nbsp;body.&nbsp;&nbsp;See&nbsp;RFC2616,&nbsp;section&nbsp;4.4.</span><br>
<span class="lineno"></span><span class="keyword" id="4247106">func</span>&nbsp;<span class="ident" id="4247111">bodyAllowedForStatus</span><span class="op" id="4247131">(</span><span class="ident" id="4247132">status</span>&nbsp;<span class="builtintype" id="4247139">int</span><span class="op" id="4247142">)</span>&nbsp;<span class="builtintype" id="4247144">bool</span>&nbsp;<span class="op" id="4247149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247152">switch</span>&nbsp;<span class="op" id="4247159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247162">case</span>&nbsp;<span class="ident" id="4247167"><a href="/gostd/net/http/transfer.go.html#4247132">status</a></span>&nbsp;<span class="op" id="4247174">&gt;=</span>&nbsp;<span class="num" id="4247177">100</span>&nbsp;<span class="op" id="4247181">&amp;&amp;</span>&nbsp;<span class="ident" id="4247184"><a href="/gostd/net/http/transfer.go.html#4247132">status</a></span>&nbsp;<span class="op" id="4247191">&lt;=</span>&nbsp;<span class="num" id="4247194">199</span><span class="op" id="4247197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247201">return</span>&nbsp;<span class="builtintype" id="4247208">false</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247215">case</span>&nbsp;<span class="ident" id="4247220"><a href="/gostd/net/http/transfer.go.html#4247132">status</a></span>&nbsp;<span class="op" id="4247227">==</span>&nbsp;<span class="num" id="4247230">204</span><span class="op" id="4247233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247237">return</span>&nbsp;<span class="builtintype" id="4247244">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247251">case</span>&nbsp;<span class="ident" id="4247256"><a href="/gostd/net/http/transfer.go.html#4247132">status</a></span>&nbsp;<span class="op" id="4247263">==</span>&nbsp;<span class="num" id="4247266">304</span><span class="op" id="4247269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247273">return</span>&nbsp;<span class="builtintype" id="4247280">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4247287">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247290">return</span>&nbsp;<span class="builtintype" id="4247297">true</span><br>
<span class="lineno"></span><span class="op" id="4247302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4247305">var</span>&nbsp;<span class="op" id="4247309">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247312">suppressedHeaders304</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4247336">=</span>&nbsp;<span class="op" id="4247338">[</span><span class="op" id="4247339">]</span><span class="builtintype" id="4247340">string</span><span class="op" id="4247346">{</span><span class="string" id="4247347">&#34;Content-Type&#34;</span><span class="op" id="4247361">,</span>&nbsp;<span class="string" id="4247363">&#34;Content-Length&#34;</span><span class="op" id="4247379">,</span>&nbsp;<span class="string" id="4247381">&#34;Transfer-Encoding&#34;</span><span class="op" id="4247400">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247403">suppressedHeadersNoBody</span>&nbsp;<span class="op" id="4247427">=</span>&nbsp;<span class="op" id="4247429">[</span><span class="op" id="4247430">]</span><span class="builtintype" id="4247431">string</span><span class="op" id="4247437">{</span><span class="string" id="4247438">&#34;Content-Length&#34;</span><span class="op" id="4247454">,</span>&nbsp;<span class="string" id="4247456">&#34;Transfer-Encoding&#34;</span><span class="op" id="4247475">}</span><br>
<span class="lineno"></span><span class="op" id="4247477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4247480">func</span>&nbsp;<span class="ident" id="4247485">suppressedHeaders</span><span class="op" id="4247502">(</span><span class="ident" id="4247503">status</span>&nbsp;<span class="builtintype" id="4247510">int</span><span class="op" id="4247513">)</span>&nbsp;<span class="op" id="4247515">[</span><span class="op" id="4247516">]</span><span class="builtintype" id="4247517">string</span>&nbsp;<span class="op" id="4247524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247527">switch</span>&nbsp;<span class="op" id="4247534">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247537">case</span>&nbsp;<span class="ident" id="4247542"><a href="/gostd/net/http/transfer.go.html#4247503">status</a></span>&nbsp;<span class="op" id="4247549">==</span>&nbsp;<span class="num" id="4247552">304</span><span class="op" id="4247555">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247559">//&nbsp;RFC&nbsp;2616&nbsp;section&nbsp;10.3.5:&nbsp;&#34;the&nbsp;response&nbsp;MUST&nbsp;NOT&nbsp;include&nbsp;other&nbsp;entity-headers&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247642">return</span>&nbsp;<span class="ident" id="4247649"><a href="/gostd/net/http/transfer.go.html#4247312">suppressedHeaders304</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247671">case</span>&nbsp;<span class="op" id="4247676">!</span><span class="ident" id="4247677"><a href="/gostd/net/http/transfer.go.html#4247111">bodyAllowedForStatus</a></span><span class="op" id="4247697">(</span><span class="ident" id="4247698"><a href="/gostd/net/http/transfer.go.html#4247503">status</a></span><span class="op" id="4247704">)</span><span class="op" id="4247705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247709">return</span>&nbsp;<span class="ident" id="4247716"><a href="/gostd/net/http/transfer.go.html#4247403">suppressedHeadersNoBody</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4247741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247744">return</span>&nbsp;<span class="builtintype" id="4247751">nil</span><br>
<span class="lineno"></span><span class="op" id="4247755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4247758">//&nbsp;msg&nbsp;is&nbsp;*Request&nbsp;or&nbsp;*Response.</span><br>
<span class="lineno">295</span><span class="keyword" id="4247791">func</span>&nbsp;<span class="ident" id="4247796">readTransfer</span><span class="op" id="4247808">(</span><span class="ident" id="4247809">msg</span>&nbsp;<span class="keyword" id="4247813">interface</span><span class="op" id="4247822">{</span><span class="op" id="4247823">}</span><span class="op" id="4247824">,</span>&nbsp;<span class="ident" id="4247826">r</span>&nbsp;<span class="op" id="4247828">*</span><span class="ident" id="4247829"><a href="/gostd/net/http/transfer.go.html#4240768">bufio</a></span><span class="op" id="4247834">.</span><span class="ident" id="4247835"><a href="/gostd/bufio/bufio.go.html#1354974">Reader</a></span><span class="op" id="4247841">)</span>&nbsp;<span class="op" id="4247843">(</span><span class="ident" id="4247844">err</span>&nbsp;<span class="builtintype" id="4247848">error</span><span class="op" id="4247853">)</span>&nbsp;<span class="op" id="4247855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247858">t</span>&nbsp;<span class="op" id="4247860">:=</span>&nbsp;<span class="op" id="4247863">&amp;</span><span class="ident" id="4247864"><a href="/gostd/net/http/transfer.go.html#4246711">transferReader</a></span><span class="op" id="4247878">{</span><span class="ident" id="4247879"><a href="/gostd/net/http/transfer.go.html#4246787">RequestMethod</a></span><span class="op" id="4247892">:</span>&nbsp;<span class="string" id="4247894">&#34;GET&#34;</span><span class="op" id="4247899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247903">//&nbsp;Unify&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247919">isResponse</span>&nbsp;<span class="op" id="4247930">:=</span>&nbsp;<span class="builtintype" id="4247933">false</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247940">switch</span>&nbsp;<span class="ident" id="4247947">rr</span>&nbsp;<span class="op" id="4247950">:=</span>&nbsp;<span class="ident" id="4247953"><a href="/gostd/net/http/transfer.go.html#4247809">msg</a></span><span class="op" id="4247956">.</span><span class="op" id="4247957">(</span><span class="keyword" id="4247958">type</span><span class="op" id="4247962">)</span>&nbsp;<span class="op" id="4247964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247967">case</span>&nbsp;<span class="op" id="4247972">*</span><span class="ident" id="4247973"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><span class="op" id="4247981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247985"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4247986">.</span><span class="ident" id="4247987"><a href="/gostd/net/http/transfer.go.html#4246746">Header</a></span>&nbsp;<span class="op" id="4247994">=</span>&nbsp;<span class="ident" id="4247996"><a href="/gostd/net/http/transfer.go.html#4247947">rr</a></span><span class="op" id="4247998">.</span><span class="ident" id="4247999"><a href="/gostd/net/http/response.go.html#4162137">Header</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248008"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248009">.</span><span class="ident" id="4248010"><a href="/gostd/net/http/transfer.go.html#4246768">StatusCode</a></span>&nbsp;<span class="op" id="4248021">=</span>&nbsp;<span class="ident" id="4248023"><a href="/gostd/net/http/transfer.go.html#4247947">rr</a></span><span class="op" id="4248025">.</span><span class="ident" id="4248026"><a href="/gostd/net/http/response.go.html#4161564">StatusCode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248039"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248040">.</span><span class="ident" id="4248041"><a href="/gostd/net/http/transfer.go.html#4246809">ProtoMajor</a></span>&nbsp;<span class="op" id="4248052">=</span>&nbsp;<span class="ident" id="4248054"><a href="/gostd/net/http/transfer.go.html#4247947">rr</a></span><span class="op" id="4248056">.</span><span class="ident" id="4248057"><a href="/gostd/net/http/response.go.html#4161633">ProtoMajor</a></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248070"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248071">.</span><span class="ident" id="4248072"><a href="/gostd/net/http/transfer.go.html#4246828">ProtoMinor</a></span>&nbsp;<span class="op" id="4248083">=</span>&nbsp;<span class="ident" id="4248085"><a href="/gostd/net/http/transfer.go.html#4247947">rr</a></span><span class="op" id="4248087">.</span><span class="ident" id="4248088"><a href="/gostd/net/http/response.go.html#4161662">ProtoMinor</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248101"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248102">.</span><span class="ident" id="4248103"><a href="/gostd/net/http/transfer.go.html#4246941">Close</a></span>&nbsp;<span class="op" id="4248109">=</span>&nbsp;<span class="ident" id="4248111"><a href="/gostd/net/http/transfer.go.html#4253547">shouldClose</a></span><span class="op" id="4248122">(</span><span class="ident" id="4248123"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248124">.</span><span class="ident" id="4248125"><a href="/gostd/net/http/transfer.go.html#4246809">ProtoMajor</a></span><span class="op" id="4248135">,</span>&nbsp;<span class="ident" id="4248137"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248138">.</span><span class="ident" id="4248139"><a href="/gostd/net/http/transfer.go.html#4246828">ProtoMinor</a></span><span class="op" id="4248149">,</span>&nbsp;<span class="ident" id="4248151"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248152">.</span><span class="ident" id="4248153"><a href="/gostd/net/http/transfer.go.html#4246746">Header</a></span><span class="op" id="4248159">,</span>&nbsp;<span class="builtintype" id="4248161">true</span><span class="op" id="4248165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248169"><a href="/gostd/net/http/transfer.go.html#4247919">isResponse</a></span>&nbsp;<span class="op" id="4248180">=</span>&nbsp;<span class="builtintype" id="4248182">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248189">if</span>&nbsp;<span class="ident" id="4248192"><a href="/gostd/net/http/transfer.go.html#4247947">rr</a></span><span class="op" id="4248194">.</span><span class="ident" id="4248195"><a href="/gostd/net/http/response.go.html#4163410">Request</a></span>&nbsp;<span class="op" id="4248203">!=</span>&nbsp;<span class="builtintype" id="4248206">nil</span>&nbsp;<span class="op" id="4248210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248215"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248216">.</span><span class="ident" id="4248217"><a href="/gostd/net/http/transfer.go.html#4246787">RequestMethod</a></span>&nbsp;<span class="op" id="4248231">=</span>&nbsp;<span class="ident" id="4248233"><a href="/gostd/net/http/transfer.go.html#4247947">rr</a></span><span class="op" id="4248235">.</span><span class="ident" id="4248236"><a href="/gostd/net/http/response.go.html#4163410">Request</a></span><span class="op" id="4248243">.</span><span class="ident" id="4248244"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4248253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248256">case</span>&nbsp;<span class="op" id="4248261">*</span><span class="ident" id="4248262"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4248269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248273"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248274">.</span><span class="ident" id="4248275"><a href="/gostd/net/http/transfer.go.html#4246746">Header</a></span>&nbsp;<span class="op" id="4248282">=</span>&nbsp;<span class="ident" id="4248284"><a href="/gostd/net/http/transfer.go.html#4247947">rr</a></span><span class="op" id="4248286">.</span><span class="ident" id="4248287"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248296"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248297">.</span><span class="ident" id="4248298"><a href="/gostd/net/http/transfer.go.html#4246809">ProtoMajor</a></span>&nbsp;<span class="op" id="4248309">=</span>&nbsp;<span class="ident" id="4248311"><a href="/gostd/net/http/transfer.go.html#4247947">rr</a></span><span class="op" id="4248313">.</span><span class="ident" id="4248314"><a href="/gostd/net/http/request.go.html#4136777">ProtoMajor</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248327"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248328">.</span><span class="ident" id="4248329"><a href="/gostd/net/http/transfer.go.html#4246828">ProtoMinor</a></span>&nbsp;<span class="op" id="4248340">=</span>&nbsp;<span class="ident" id="4248342"><a href="/gostd/net/http/transfer.go.html#4247947">rr</a></span><span class="op" id="4248344">.</span><span class="ident" id="4248345"><a href="/gostd/net/http/request.go.html#4136801">ProtoMinor</a></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4248358">//&nbsp;Transfer&nbsp;semantics&nbsp;for&nbsp;Requests&nbsp;are&nbsp;exactly&nbsp;like&nbsp;those&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4248422">//&nbsp;Responses&nbsp;with&nbsp;status&nbsp;code&nbsp;200,&nbsp;responding&nbsp;to&nbsp;a&nbsp;GET&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248486"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248487">.</span><span class="ident" id="4248488"><a href="/gostd/net/http/transfer.go.html#4246768">StatusCode</a></span>&nbsp;<span class="op" id="4248499">=</span>&nbsp;<span class="num" id="4248501">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248506">default</span><span class="op" id="4248513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4248517">panic</span><span class="op" id="4248522">(</span><span class="string" id="4248523">&#34;unexpected&nbsp;type&#34;</span><span class="op" id="4248540">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4248543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4248547">//&nbsp;Default&nbsp;to&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248571">if</span>&nbsp;<span class="ident" id="4248574"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248575">.</span><span class="ident" id="4248576"><a href="/gostd/net/http/transfer.go.html#4246809">ProtoMajor</a></span>&nbsp;<span class="op" id="4248587">==</span>&nbsp;<span class="num" id="4248590">0</span>&nbsp;<span class="op" id="4248592">&amp;&amp;</span>&nbsp;<span class="ident" id="4248595"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248596">.</span><span class="ident" id="4248597"><a href="/gostd/net/http/transfer.go.html#4246828">ProtoMinor</a></span>&nbsp;<span class="op" id="4248608">==</span>&nbsp;<span class="num" id="4248611">0</span>&nbsp;<span class="op" id="4248613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248617"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248618">.</span><span class="ident" id="4248619"><a href="/gostd/net/http/transfer.go.html#4246809">ProtoMajor</a></span><span class="op" id="4248629">,</span>&nbsp;<span class="ident" id="4248631"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248632">.</span><span class="ident" id="4248633"><a href="/gostd/net/http/transfer.go.html#4246828">ProtoMinor</a></span>&nbsp;<span class="op" id="4248644">=</span>&nbsp;<span class="num" id="4248646">1</span><span class="op" id="4248647">,</span>&nbsp;<span class="num" id="4248649">1</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4248652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4248656">//&nbsp;Transfer&nbsp;encoding,&nbsp;content&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248694"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248695">.</span><span class="ident" id="4248696"><a href="/gostd/net/http/transfer.go.html#4246914">TransferEncoding</a></span><span class="op" id="4248712">,</span>&nbsp;<span class="ident" id="4248714"><a href="/gostd/net/http/transfer.go.html#4247844">err</a></span>&nbsp;<span class="op" id="4248718">=</span>&nbsp;<span class="ident" id="4248720"><a href="/gostd/net/http/transfer.go.html#4251071">fixTransferEncoding</a></span><span class="op" id="4248739">(</span><span class="ident" id="4248740"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248741">.</span><span class="ident" id="4248742"><a href="/gostd/net/http/transfer.go.html#4246787">RequestMethod</a></span><span class="op" id="4248755">,</span>&nbsp;<span class="ident" id="4248757"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248758">.</span><span class="ident" id="4248759"><a href="/gostd/net/http/transfer.go.html#4246746">Header</a></span><span class="op" id="4248765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248768">if</span>&nbsp;<span class="ident" id="4248771"><a href="/gostd/net/http/transfer.go.html#4247844">err</a></span>&nbsp;<span class="op" id="4248775">!=</span>&nbsp;<span class="builtintype" id="4248778">nil</span>&nbsp;<span class="op" id="4248782">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248786">return</span>&nbsp;<span class="ident" id="4248793"><a href="/gostd/net/http/transfer.go.html#4247844">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4248798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248802">realLength</span><span class="op" id="4248812">,</span>&nbsp;<span class="ident" id="4248814"><a href="/gostd/net/http/transfer.go.html#4247844">err</a></span>&nbsp;<span class="op" id="4248818">:=</span>&nbsp;<span class="ident" id="4248821"><a href="/gostd/net/http/transfer.go.html#4252430">fixLength</a></span><span class="op" id="4248830">(</span><span class="ident" id="4248831"><a href="/gostd/net/http/transfer.go.html#4247919">isResponse</a></span><span class="op" id="4248841">,</span>&nbsp;<span class="ident" id="4248843"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248844">.</span><span class="ident" id="4248845"><a href="/gostd/net/http/transfer.go.html#4246768">StatusCode</a></span><span class="op" id="4248855">,</span>&nbsp;<span class="ident" id="4248857"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248858">.</span><span class="ident" id="4248859"><a href="/gostd/net/http/transfer.go.html#4246787">RequestMethod</a></span><span class="op" id="4248872">,</span>&nbsp;<span class="ident" id="4248874"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248875">.</span><span class="ident" id="4248876"><a href="/gostd/net/http/transfer.go.html#4246746">Header</a></span><span class="op" id="4248882">,</span>&nbsp;<span class="ident" id="4248884"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248885">.</span><span class="ident" id="4248886"><a href="/gostd/net/http/transfer.go.html#4246914">TransferEncoding</a></span><span class="op" id="4248902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248905">if</span>&nbsp;<span class="ident" id="4248908"><a href="/gostd/net/http/transfer.go.html#4247844">err</a></span>&nbsp;<span class="op" id="4248912">!=</span>&nbsp;<span class="builtintype" id="4248915">nil</span>&nbsp;<span class="op" id="4248919">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248923">return</span>&nbsp;<span class="ident" id="4248930"><a href="/gostd/net/http/transfer.go.html#4247844">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4248935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248938">if</span>&nbsp;<span class="ident" id="4248941"><a href="/gostd/net/http/transfer.go.html#4247919">isResponse</a></span>&nbsp;<span class="op" id="4248952">&amp;&amp;</span>&nbsp;<span class="ident" id="4248955"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4248956">.</span><span class="ident" id="4248957"><a href="/gostd/net/http/transfer.go.html#4246787">RequestMethod</a></span>&nbsp;<span class="op" id="4248971">==</span>&nbsp;<span class="string" id="4248974">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="4248981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248985">if</span>&nbsp;<span class="ident" id="4248988">n</span><span class="op" id="4248989">,</span>&nbsp;<span class="ident" id="4248991">err</span>&nbsp;<span class="op" id="4248995">:=</span>&nbsp;<span class="ident" id="4248998"><a href="/gostd/net/http/transfer.go.html#4259220">parseContentLength</a></span><span class="op" id="4249016">(</span><span class="ident" id="4249017"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249018">.</span><span class="ident" id="4249019"><a href="/gostd/net/http/transfer.go.html#4246746">Header</a></span><span class="op" id="4249025">.</span><span class="ident" id="4249026"><a href="/gostd/net/http/header.go.html#4126950">get</a></span><span class="op" id="4249029">(</span><span class="string" id="4249030">&#34;Content-Length&#34;</span><span class="op" id="4249046">)</span><span class="op" id="4249047">)</span><span class="op" id="4249048">;</span>&nbsp;<span class="ident" id="4249050"><a href="/gostd/net/http/transfer.go.html#4248991">err</a></span>&nbsp;<span class="op" id="4249054">!=</span>&nbsp;<span class="builtintype" id="4249057">nil</span>&nbsp;<span class="op" id="4249061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249066">return</span>&nbsp;<span class="ident" id="4249073"><a href="/gostd/net/http/transfer.go.html#4248991">err</a></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249079">}</span>&nbsp;<span class="keyword" id="4249081">else</span>&nbsp;<span class="op" id="4249086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249091"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249092">.</span><span class="ident" id="4249093"><a href="/gostd/net/http/transfer.go.html#4246890">ContentLength</a></span>&nbsp;<span class="op" id="4249107">=</span>&nbsp;<span class="ident" id="4249109"><a href="/gostd/net/http/transfer.go.html#4248988">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249116">}</span>&nbsp;<span class="keyword" id="4249118">else</span>&nbsp;<span class="op" id="4249123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249127"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249128">.</span><span class="ident" id="4249129"><a href="/gostd/net/http/transfer.go.html#4246890">ContentLength</a></span>&nbsp;<span class="op" id="4249143">=</span>&nbsp;<span class="ident" id="4249145"><a href="/gostd/net/http/transfer.go.html#4248802">realLength</a></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249161">//&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249173"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249174">.</span><span class="ident" id="4249175"><a href="/gostd/net/http/transfer.go.html#4246964">Trailer</a></span><span class="op" id="4249182">,</span>&nbsp;<span class="ident" id="4249184"><a href="/gostd/net/http/transfer.go.html#4247844">err</a></span>&nbsp;<span class="op" id="4249188">=</span>&nbsp;<span class="ident" id="4249190"><a href="/gostd/net/http/transfer.go.html#4254101">fixTrailer</a></span><span class="op" id="4249200">(</span><span class="ident" id="4249201"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249202">.</span><span class="ident" id="4249203"><a href="/gostd/net/http/transfer.go.html#4246746">Header</a></span><span class="op" id="4249209">,</span>&nbsp;<span class="ident" id="4249211"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249212">.</span><span class="ident" id="4249213"><a href="/gostd/net/http/transfer.go.html#4246914">TransferEncoding</a></span><span class="op" id="4249229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249232">if</span>&nbsp;<span class="ident" id="4249235"><a href="/gostd/net/http/transfer.go.html#4247844">err</a></span>&nbsp;<span class="op" id="4249239">!=</span>&nbsp;<span class="builtintype" id="4249242">nil</span>&nbsp;<span class="op" id="4249246">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249250">return</span>&nbsp;<span class="ident" id="4249257"><a href="/gostd/net/http/transfer.go.html#4247844">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249266">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;Content-Length&nbsp;or&nbsp;chunked&nbsp;Transfer-Encoding&nbsp;on&nbsp;a&nbsp;*Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249344">//&nbsp;and&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;1xx,&nbsp;204&nbsp;or&nbsp;304,&nbsp;then&nbsp;the&nbsp;body&nbsp;is&nbsp;unbounded.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249415">//&nbsp;See&nbsp;RFC2616,&nbsp;section&nbsp;4.4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249445">switch</span>&nbsp;<span class="ident" id="4249452"><a href="/gostd/net/http/transfer.go.html#4247809">msg</a></span><span class="op" id="4249455">.</span><span class="op" id="4249456">(</span><span class="keyword" id="4249457">type</span><span class="op" id="4249461">)</span>&nbsp;<span class="op" id="4249463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249466">case</span>&nbsp;<span class="op" id="4249471">*</span><span class="ident" id="4249472"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><span class="op" id="4249480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249484">if</span>&nbsp;<span class="ident" id="4249487"><a href="/gostd/net/http/transfer.go.html#4248802">realLength</a></span>&nbsp;<span class="op" id="4249498">==</span>&nbsp;<span class="op" id="4249501">-</span><span class="num" id="4249502">1</span>&nbsp;<span class="op" id="4249504">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249510">!</span><span class="ident" id="4249511"><a href="/gostd/net/http/transfer.go.html#4250825">chunked</a></span><span class="op" id="4249518">(</span><span class="ident" id="4249519"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249520">.</span><span class="ident" id="4249521"><a href="/gostd/net/http/transfer.go.html#4246914">TransferEncoding</a></span><span class="op" id="4249537">)</span>&nbsp;<span class="op" id="4249539">&amp;&amp;</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249545"><a href="/gostd/net/http/transfer.go.html#4247111">bodyAllowedForStatus</a></span><span class="op" id="4249565">(</span><span class="ident" id="4249566"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249567">.</span><span class="ident" id="4249568"><a href="/gostd/net/http/transfer.go.html#4246768">StatusCode</a></span><span class="op" id="4249578">)</span>&nbsp;<span class="op" id="4249580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249585">//&nbsp;Unbounded&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249607"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249608">.</span><span class="ident" id="4249609"><a href="/gostd/net/http/transfer.go.html#4246941">Close</a></span>&nbsp;<span class="op" id="4249615">=</span>&nbsp;<span class="builtintype" id="4249617">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249627">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249631">//&nbsp;Prepare&nbsp;body&nbsp;reader.&nbsp;&nbsp;ContentLength&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;chunked&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249698">//&nbsp;or&nbsp;close&nbsp;connection&nbsp;when&nbsp;finished,&nbsp;since&nbsp;multipart&nbsp;is&nbsp;not&nbsp;supported&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249774">switch</span>&nbsp;<span class="op" id="4249781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249784">case</span>&nbsp;<span class="ident" id="4249789"><a href="/gostd/net/http/transfer.go.html#4250825">chunked</a></span><span class="op" id="4249796">(</span><span class="ident" id="4249797"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249798">.</span><span class="ident" id="4249799"><a href="/gostd/net/http/transfer.go.html#4246914">TransferEncoding</a></span><span class="op" id="4249815">)</span><span class="op" id="4249816">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249820">if</span>&nbsp;<span class="ident" id="4249823"><a href="/gostd/net/http/transfer.go.html#4243847">noBodyExpected</a></span><span class="op" id="4249837">(</span><span class="ident" id="4249838"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249839">.</span><span class="ident" id="4249840"><a href="/gostd/net/http/transfer.go.html#4246787">RequestMethod</a></span><span class="op" id="4249853">)</span>&nbsp;<span class="op" id="4249855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249860"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249861">.</span><span class="ident" id="4249862"><a href="/gostd/net/http/transfer.go.html#4246858">Body</a></span>&nbsp;<span class="op" id="4249867">=</span>&nbsp;<span class="ident" id="4249869"><a href="/gostd/net/http/server.go.html#4228427">eofReader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249881">}</span>&nbsp;<span class="keyword" id="4249883">else</span>&nbsp;<span class="op" id="4249888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249893"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249894">.</span><span class="ident" id="4249895"><a href="/gostd/net/http/transfer.go.html#4246858">Body</a></span>&nbsp;<span class="op" id="4249900">=</span>&nbsp;<span class="op" id="4249902">&amp;</span><span class="ident" id="4249903"><a href="/gostd/net/http/transfer.go.html#4254838">body</a></span><span class="op" id="4249907">{</span><span class="ident" id="4249908"><a href="/gostd/net/http/transfer.go.html#4254853">src</a></span><span class="op" id="4249911">:</span>&nbsp;<span class="ident" id="4249913"><a href="/gostd/net/http/transfer.go.html#4240822">internal</a></span><span class="op" id="4249921">.</span><span class="ident" id="4249922"><a href="/gostd/net/http/internal/chunked.go.html#4773107">NewChunkedReader</a></span><span class="op" id="4249938">(</span><span class="ident" id="4249939"><a href="/gostd/net/http/transfer.go.html#4247826">r</a></span><span class="op" id="4249940">)</span><span class="op" id="4249941">,</span>&nbsp;<span class="ident" id="4249943"><a href="/gostd/net/http/transfer.go.html#4254872">hdr</a></span><span class="op" id="4249946">:</span>&nbsp;<span class="ident" id="4249948"><a href="/gostd/net/http/transfer.go.html#4247809">msg</a></span><span class="op" id="4249951">,</span>&nbsp;<span class="ident" id="4249953"><a href="/gostd/net/http/transfer.go.html#4254953">r</a></span><span class="op" id="4249954">:</span>&nbsp;<span class="ident" id="4249956"><a href="/gostd/net/http/transfer.go.html#4247826">r</a></span><span class="op" id="4249957">,</span>&nbsp;<span class="ident" id="4249959"><a href="/gostd/net/http/transfer.go.html#4255025">closing</a></span><span class="op" id="4249966">:</span>&nbsp;<span class="ident" id="4249968"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4249969">.</span><span class="ident" id="4249970"><a href="/gostd/net/http/transfer.go.html#4246941">Close</a></span><span class="op" id="4249975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249979">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249982">case</span>&nbsp;<span class="ident" id="4249987"><a href="/gostd/net/http/transfer.go.html#4248802">realLength</a></span>&nbsp;<span class="op" id="4249998">==</span>&nbsp;<span class="num" id="4250001">0</span><span class="op" id="4250002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250006"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250007">.</span><span class="ident" id="4250008"><a href="/gostd/net/http/transfer.go.html#4246858">Body</a></span>&nbsp;<span class="op" id="4250013">=</span>&nbsp;<span class="ident" id="4250015"><a href="/gostd/net/http/server.go.html#4228427">eofReader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4250026">case</span>&nbsp;<span class="ident" id="4250031"><a href="/gostd/net/http/transfer.go.html#4248802">realLength</a></span>&nbsp;<span class="op" id="4250042">&gt;</span>&nbsp;<span class="num" id="4250044">0</span><span class="op" id="4250045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250049"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250050">.</span><span class="ident" id="4250051"><a href="/gostd/net/http/transfer.go.html#4246858">Body</a></span>&nbsp;<span class="op" id="4250056">=</span>&nbsp;<span class="op" id="4250058">&amp;</span><span class="ident" id="4250059"><a href="/gostd/net/http/transfer.go.html#4254838">body</a></span><span class="op" id="4250063">{</span><span class="ident" id="4250064"><a href="/gostd/net/http/transfer.go.html#4254853">src</a></span><span class="op" id="4250067">:</span>&nbsp;<span class="ident" id="4250069"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4250071">.</span><span class="ident" id="4250072"><a href="/gostd/io/io.go.html#1431815">LimitReader</a></span><span class="op" id="4250083">(</span><span class="ident" id="4250084"><a href="/gostd/net/http/transfer.go.html#4247826">r</a></span><span class="op" id="4250085">,</span>&nbsp;<span class="ident" id="4250087"><a href="/gostd/net/http/transfer.go.html#4248802">realLength</a></span><span class="op" id="4250097">)</span><span class="op" id="4250098">,</span>&nbsp;<span class="ident" id="4250100"><a href="/gostd/net/http/transfer.go.html#4255025">closing</a></span><span class="op" id="4250107">:</span>&nbsp;<span class="ident" id="4250109"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250110">.</span><span class="ident" id="4250111"><a href="/gostd/net/http/transfer.go.html#4246941">Close</a></span><span class="op" id="4250116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4250119">default</span><span class="op" id="4250126">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4250130">//&nbsp;realLength&nbsp;&lt;&nbsp;0,&nbsp;i.e.&nbsp;&#34;Content-Length&#34;&nbsp;not&nbsp;mentioned&nbsp;in&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4250197">if</span>&nbsp;<span class="ident" id="4250200"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250201">.</span><span class="ident" id="4250202"><a href="/gostd/net/http/transfer.go.html#4246941">Close</a></span>&nbsp;<span class="op" id="4250208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4250213">//&nbsp;Close&nbsp;semantics&nbsp;(i.e.&nbsp;HTTP/1.0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250251"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250252">.</span><span class="ident" id="4250253"><a href="/gostd/net/http/transfer.go.html#4246858">Body</a></span>&nbsp;<span class="op" id="4250258">=</span>&nbsp;<span class="op" id="4250260">&amp;</span><span class="ident" id="4250261"><a href="/gostd/net/http/transfer.go.html#4254838">body</a></span><span class="op" id="4250265">{</span><span class="ident" id="4250266"><a href="/gostd/net/http/transfer.go.html#4254853">src</a></span><span class="op" id="4250269">:</span>&nbsp;<span class="ident" id="4250271"><a href="/gostd/net/http/transfer.go.html#4247826">r</a></span><span class="op" id="4250272">,</span>&nbsp;<span class="ident" id="4250274"><a href="/gostd/net/http/transfer.go.html#4255025">closing</a></span><span class="op" id="4250281">:</span>&nbsp;<span class="ident" id="4250283"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250284">.</span><span class="ident" id="4250285"><a href="/gostd/net/http/transfer.go.html#4246941">Close</a></span><span class="op" id="4250290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4250294">}</span>&nbsp;<span class="keyword" id="4250296">else</span>&nbsp;<span class="op" id="4250301">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4250306">//&nbsp;Persistent&nbsp;connection&nbsp;(i.e.&nbsp;HTTP/1.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250350"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250351">.</span><span class="ident" id="4250352"><a href="/gostd/net/http/transfer.go.html#4246858">Body</a></span>&nbsp;<span class="op" id="4250357">=</span>&nbsp;<span class="ident" id="4250359"><a href="/gostd/net/http/server.go.html#4228427">eofReader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4250371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4250374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4250378">//&nbsp;Unify&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4250395">switch</span>&nbsp;<span class="ident" id="4250402">rr</span>&nbsp;<span class="op" id="4250405">:=</span>&nbsp;<span class="ident" id="4250408"><a href="/gostd/net/http/transfer.go.html#4247809">msg</a></span><span class="op" id="4250411">.</span><span class="op" id="4250412">(</span><span class="keyword" id="4250413">type</span><span class="op" id="4250417">)</span>&nbsp;<span class="op" id="4250419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4250422">case</span>&nbsp;<span class="op" id="4250427">*</span><span class="ident" id="4250428"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4250435">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250439"><a href="/gostd/net/http/transfer.go.html#4250402">rr</a></span><span class="op" id="4250441">.</span><span class="ident" id="4250442"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="4250447">=</span>&nbsp;<span class="ident" id="4250449"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250450">.</span><span class="ident" id="4250451"><a href="/gostd/net/http/transfer.go.html#4246858">Body</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250458"><a href="/gostd/net/http/transfer.go.html#4250402">rr</a></span><span class="op" id="4250460">.</span><span class="ident" id="4250461"><a href="/gostd/net/http/request.go.html#4138292">ContentLength</a></span>&nbsp;<span class="op" id="4250475">=</span>&nbsp;<span class="ident" id="4250477"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250478">.</span><span class="ident" id="4250479"><a href="/gostd/net/http/transfer.go.html#4246890">ContentLength</a></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250495"><a href="/gostd/net/http/transfer.go.html#4250402">rr</a></span><span class="op" id="4250497">.</span><span class="ident" id="4250498"><a href="/gostd/net/http/request.go.html#4138599">TransferEncoding</a></span>&nbsp;<span class="op" id="4250515">=</span>&nbsp;<span class="ident" id="4250517"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250518">.</span><span class="ident" id="4250519"><a href="/gostd/net/http/transfer.go.html#4246914">TransferEncoding</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250538"><a href="/gostd/net/http/transfer.go.html#4250402">rr</a></span><span class="op" id="4250540">.</span><span class="ident" id="4250541"><a href="/gostd/net/http/request.go.html#4138776">Close</a></span>&nbsp;<span class="op" id="4250547">=</span>&nbsp;<span class="ident" id="4250549"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250550">.</span><span class="ident" id="4250551"><a href="/gostd/net/http/transfer.go.html#4246941">Close</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250559"><a href="/gostd/net/http/transfer.go.html#4250402">rr</a></span><span class="op" id="4250561">.</span><span class="ident" id="4250562"><a href="/gostd/net/http/request.go.html#4140820">Trailer</a></span>&nbsp;<span class="op" id="4250570">=</span>&nbsp;<span class="ident" id="4250572"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250573">.</span><span class="ident" id="4250574"><a href="/gostd/net/http/transfer.go.html#4246964">Trailer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4250583">case</span>&nbsp;<span class="op" id="4250588">*</span><span class="ident" id="4250589"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><span class="op" id="4250597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250601"><a href="/gostd/net/http/transfer.go.html#4250402">rr</a></span><span class="op" id="4250603">.</span><span class="ident" id="4250604"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span>&nbsp;<span class="op" id="4250609">=</span>&nbsp;<span class="ident" id="4250611"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250612">.</span><span class="ident" id="4250613"><a href="/gostd/net/http/transfer.go.html#4246858">Body</a></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250620"><a href="/gostd/net/http/transfer.go.html#4250402">rr</a></span><span class="op" id="4250622">.</span><span class="ident" id="4250623"><a href="/gostd/net/http/response.go.html#4162765">ContentLength</a></span>&nbsp;<span class="op" id="4250637">=</span>&nbsp;<span class="ident" id="4250639"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250640">.</span><span class="ident" id="4250641"><a href="/gostd/net/http/transfer.go.html#4246890">ContentLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250657"><a href="/gostd/net/http/transfer.go.html#4250402">rr</a></span><span class="op" id="4250659">.</span><span class="ident" id="4250660"><a href="/gostd/net/http/response.go.html#4162908">TransferEncoding</a></span>&nbsp;<span class="op" id="4250677">=</span>&nbsp;<span class="ident" id="4250679"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250680">.</span><span class="ident" id="4250681"><a href="/gostd/net/http/transfer.go.html#4246914">TransferEncoding</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250700"><a href="/gostd/net/http/transfer.go.html#4250402">rr</a></span><span class="op" id="4250702">.</span><span class="ident" id="4250703"><a href="/gostd/net/http/response.go.html#4163140">Close</a></span>&nbsp;<span class="op" id="4250709">=</span>&nbsp;<span class="ident" id="4250711"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250712">.</span><span class="ident" id="4250713"><a href="/gostd/net/http/transfer.go.html#4246941">Close</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250721"><a href="/gostd/net/http/transfer.go.html#4250402">rr</a></span><span class="op" id="4250723">.</span><span class="ident" id="4250724"><a href="/gostd/net/http/response.go.html#4163232">Trailer</a></span>&nbsp;<span class="op" id="4250732">=</span>&nbsp;<span class="ident" id="4250734"><a href="/gostd/net/http/transfer.go.html#4247858">t</a></span><span class="op" id="4250735">.</span><span class="ident" id="4250736"><a href="/gostd/net/http/transfer.go.html#4246964">Trailer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4250745">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4250749">return</span>&nbsp;<span class="builtintype" id="4250756">nil</span><br>
<span class="lineno"></span><span class="op" id="4250760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4250763">//&nbsp;Checks&nbsp;whether&nbsp;chunked&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;encodings&nbsp;stack</span><br>
<span class="lineno">410</span><span class="keyword" id="4250820">func</span>&nbsp;<span class="ident" id="4250825">chunked</span><span class="op" id="4250832">(</span><span class="ident" id="4250833">te</span>&nbsp;<span class="op" id="4250836">[</span><span class="op" id="4250837">]</span><span class="builtintype" id="4250838">string</span><span class="op" id="4250844">)</span>&nbsp;<span class="builtintype" id="4250846">bool</span>&nbsp;<span class="op" id="4250851">{</span>&nbsp;<span class="keyword" id="4250853">return</span>&nbsp;<span class="builtinfunc" id="4250860">len</span><span class="op" id="4250863">(</span><span class="ident" id="4250864"><a href="/gostd/net/http/transfer.go.html#4250833">te</a></span><span class="op" id="4250866">)</span>&nbsp;<span class="op" id="4250868">&gt;</span>&nbsp;<span class="num" id="4250870">0</span>&nbsp;<span class="op" id="4250872">&amp;&amp;</span>&nbsp;<span class="ident" id="4250875"><a href="/gostd/net/http/transfer.go.html#4250833">te</a></span><span class="op" id="4250877">[</span><span class="num" id="4250878">0</span><span class="op" id="4250879">]</span>&nbsp;<span class="op" id="4250881">==</span>&nbsp;<span class="string" id="4250884">&#34;chunked&#34;</span>&nbsp;<span class="op" id="4250894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4250897">//&nbsp;Checks&nbsp;whether&nbsp;the&nbsp;encoding&nbsp;is&nbsp;explicitly&nbsp;&#34;identity&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4250954">func</span>&nbsp;<span class="ident" id="4250959">isIdentity</span><span class="op" id="4250969">(</span><span class="ident" id="4250970">te</span>&nbsp;<span class="op" id="4250973">[</span><span class="op" id="4250974">]</span><span class="builtintype" id="4250975">string</span><span class="op" id="4250981">)</span>&nbsp;<span class="builtintype" id="4250983">bool</span>&nbsp;<span class="op" id="4250988">{</span>&nbsp;<span class="keyword" id="4250990">return</span>&nbsp;<span class="builtinfunc" id="4250997">len</span><span class="op" id="4251000">(</span><span class="ident" id="4251001"><a href="/gostd/net/http/transfer.go.html#4250970">te</a></span><span class="op" id="4251003">)</span>&nbsp;<span class="op" id="4251005">==</span>&nbsp;<span class="num" id="4251008">1</span>&nbsp;<span class="op" id="4251010">&amp;&amp;</span>&nbsp;<span class="ident" id="4251013"><a href="/gostd/net/http/transfer.go.html#4250970">te</a></span><span class="op" id="4251015">[</span><span class="num" id="4251016">0</span><span class="op" id="4251017">]</span>&nbsp;<span class="op" id="4251019">==</span>&nbsp;<span class="string" id="4251022">&#34;identity&#34;</span>&nbsp;<span class="op" id="4251033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="4251036">//&nbsp;Sanitize&nbsp;transfer&nbsp;encoding</span><br>
<span class="lineno"></span><span class="keyword" id="4251066">func</span>&nbsp;<span class="ident" id="4251071">fixTransferEncoding</span><span class="op" id="4251090">(</span><span class="ident" id="4251091">requestMethod</span>&nbsp;<span class="builtintype" id="4251105">string</span><span class="op" id="4251111">,</span>&nbsp;<span class="ident" id="4251113">header</span>&nbsp;<span class="ident" id="4251120"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4251126">)</span>&nbsp;<span class="op" id="4251128">(</span><span class="op" id="4251129">[</span><span class="op" id="4251130">]</span><span class="builtintype" id="4251131">string</span><span class="op" id="4251137">,</span>&nbsp;<span class="builtintype" id="4251139">error</span><span class="op" id="4251144">)</span>&nbsp;<span class="op" id="4251146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251149">raw</span><span class="op" id="4251152">,</span>&nbsp;<span class="ident" id="4251154">present</span>&nbsp;<span class="op" id="4251162">:=</span>&nbsp;<span class="ident" id="4251165"><a href="/gostd/net/http/transfer.go.html#4251113">header</a></span><span class="op" id="4251171">[</span><span class="string" id="4251172">&#34;Transfer-Encoding&#34;</span><span class="op" id="4251191">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4251194">if</span>&nbsp;<span class="op" id="4251197">!</span><span class="ident" id="4251198"><a href="/gostd/net/http/transfer.go.html#4251154">present</a></span>&nbsp;<span class="op" id="4251206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4251210">return</span>&nbsp;<span class="builtintype" id="4251217">nil</span><span class="op" id="4251220">,</span>&nbsp;<span class="builtintype" id="4251222">nil</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4251227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4251231">delete</span><span class="op" id="4251237">(</span><span class="ident" id="4251238"><a href="/gostd/net/http/transfer.go.html#4251113">header</a></span><span class="op" id="4251244">,</span>&nbsp;<span class="string" id="4251246">&#34;Transfer-Encoding&#34;</span><span class="op" id="4251265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251269">encodings</span>&nbsp;<span class="op" id="4251279">:=</span>&nbsp;<span class="ident" id="4251282"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4251289">.</span><span class="ident" id="4251290"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="4251295">(</span><span class="ident" id="4251296"><a href="/gostd/net/http/transfer.go.html#4251149">raw</a></span><span class="op" id="4251299">[</span><span class="num" id="4251300">0</span><span class="op" id="4251301">]</span><span class="op" id="4251302">,</span>&nbsp;<span class="string" id="4251304">&#34;,&#34;</span><span class="op" id="4251307">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251310">te</span>&nbsp;<span class="op" id="4251313">:=</span>&nbsp;<span class="builtinfunc" id="4251316">make</span><span class="op" id="4251320">(</span><span class="op" id="4251321">[</span><span class="op" id="4251322">]</span><span class="builtintype" id="4251323">string</span><span class="op" id="4251329">,</span>&nbsp;<span class="num" id="4251331">0</span><span class="op" id="4251332">,</span>&nbsp;<span class="builtinfunc" id="4251334">len</span><span class="op" id="4251337">(</span><span class="ident" id="4251338"><a href="/gostd/net/http/transfer.go.html#4251269">encodings</a></span><span class="op" id="4251347">)</span><span class="op" id="4251348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4251351">//&nbsp;TODO:&nbsp;Even&nbsp;though&nbsp;we&nbsp;only&nbsp;support&nbsp;&#34;identity&#34;&nbsp;and&nbsp;&#34;chunked&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4251414">//&nbsp;encodings,&nbsp;the&nbsp;loop&nbsp;below&nbsp;is&nbsp;designed&nbsp;with&nbsp;foresight.&nbsp;One</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4251476">//&nbsp;invariant&nbsp;that&nbsp;must&nbsp;be&nbsp;maintained&nbsp;is&nbsp;that,&nbsp;if&nbsp;present,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4251535">//&nbsp;chunked&nbsp;encoding&nbsp;must&nbsp;always&nbsp;come&nbsp;first.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4251580">for</span>&nbsp;<span class="ident" id="4251584">_</span><span class="op" id="4251585">,</span>&nbsp;<span class="ident" id="4251587">encoding</span>&nbsp;<span class="op" id="4251596">:=</span>&nbsp;<span class="keyword" id="4251599">range</span>&nbsp;<span class="ident" id="4251605"><a href="/gostd/net/http/transfer.go.html#4251269">encodings</a></span>&nbsp;<span class="op" id="4251615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251619"><a href="/gostd/net/http/transfer.go.html#4251587">encoding</a></span>&nbsp;<span class="op" id="4251628">=</span>&nbsp;<span class="ident" id="4251630"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4251637">.</span><span class="ident" id="4251638"><a href="/gostd/strings/strings.go.html#2977307">ToLower</a></span><span class="op" id="4251645">(</span><span class="ident" id="4251646"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4251653">.</span><span class="ident" id="4251654"><a href="/gostd/strings/strings.go.html#2982525">TrimSpace</a></span><span class="op" id="4251663">(</span><span class="ident" id="4251664"><a href="/gostd/net/http/transfer.go.html#4251587">encoding</a></span><span class="op" id="4251672">)</span><span class="op" id="4251673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4251677">//&nbsp;&#34;identity&#34;&nbsp;encoding&nbsp;is&nbsp;not&nbsp;recorded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4251718">if</span>&nbsp;<span class="ident" id="4251721"><a href="/gostd/net/http/transfer.go.html#4251587">encoding</a></span>&nbsp;<span class="op" id="4251730">==</span>&nbsp;<span class="string" id="4251733">&#34;identity&#34;</span>&nbsp;<span class="op" id="4251744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4251749">break</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4251757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4251761">if</span>&nbsp;<span class="ident" id="4251764"><a href="/gostd/net/http/transfer.go.html#4251587">encoding</a></span>&nbsp;<span class="op" id="4251773">!=</span>&nbsp;<span class="string" id="4251776">&#34;chunked&#34;</span>&nbsp;<span class="op" id="4251786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4251791">return</span>&nbsp;<span class="builtintype" id="4251798">nil</span><span class="op" id="4251801">,</span>&nbsp;<span class="op" id="4251803">&amp;</span><span class="ident" id="4251804"><a href="/gostd/net/http/request.go.html#4135248">badStringError</a></span><span class="op" id="4251818">{</span><span class="string" id="4251819">&#34;unsupported&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="4251850">,</span>&nbsp;<span class="ident" id="4251852"><a href="/gostd/net/http/transfer.go.html#4251587">encoding</a></span><span class="op" id="4251860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4251864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251868"><a href="/gostd/net/http/transfer.go.html#4251310">te</a></span>&nbsp;<span class="op" id="4251871">=</span>&nbsp;<span class="ident" id="4251873"><a href="/gostd/net/http/transfer.go.html#4251310">te</a></span><span class="op" id="4251875">[</span><span class="num" id="4251876">0</span>&nbsp;<span class="op" id="4251878">:</span>&nbsp;<span class="builtinfunc" id="4251880">len</span><span class="op" id="4251883">(</span><span class="ident" id="4251884"><a href="/gostd/net/http/transfer.go.html#4251310">te</a></span><span class="op" id="4251886">)</span><span class="op" id="4251887">+</span><span class="num" id="4251888">1</span><span class="op" id="4251889">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251893"><a href="/gostd/net/http/transfer.go.html#4251310">te</a></span><span class="op" id="4251895">[</span><span class="builtinfunc" id="4251896">len</span><span class="op" id="4251899">(</span><span class="ident" id="4251900"><a href="/gostd/net/http/transfer.go.html#4251310">te</a></span><span class="op" id="4251902">)</span><span class="op" id="4251903">-</span><span class="num" id="4251904">1</span><span class="op" id="4251905">]</span>&nbsp;<span class="op" id="4251907">=</span>&nbsp;<span class="ident" id="4251909"><a href="/gostd/net/http/transfer.go.html#4251587">encoding</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4251919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4251922">if</span>&nbsp;<span class="builtinfunc" id="4251925">len</span><span class="op" id="4251928">(</span><span class="ident" id="4251929"><a href="/gostd/net/http/transfer.go.html#4251310">te</a></span><span class="op" id="4251931">)</span>&nbsp;<span class="op" id="4251933">&gt;</span>&nbsp;<span class="num" id="4251935">1</span>&nbsp;<span class="op" id="4251937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4251941">return</span>&nbsp;<span class="builtintype" id="4251948">nil</span><span class="op" id="4251951">,</span>&nbsp;<span class="op" id="4251953">&amp;</span><span class="ident" id="4251954"><a href="/gostd/net/http/request.go.html#4135248">badStringError</a></span><span class="op" id="4251968">{</span><span class="string" id="4251969">&#34;too&nbsp;many&nbsp;transfer&nbsp;encodings&#34;</span><span class="op" id="4251998">,</span>&nbsp;<span class="ident" id="4252000"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4252007">.</span><span class="ident" id="4252008"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="4252012">(</span><span class="ident" id="4252013"><a href="/gostd/net/http/transfer.go.html#4251310">te</a></span><span class="op" id="4252015">,</span>&nbsp;<span class="string" id="4252017">&#34;,&#34;</span><span class="op" id="4252020">)</span><span class="op" id="4252021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4252024">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252027">if</span>&nbsp;<span class="builtinfunc" id="4252030">len</span><span class="op" id="4252033">(</span><span class="ident" id="4252034"><a href="/gostd/net/http/transfer.go.html#4251310">te</a></span><span class="op" id="4252036">)</span>&nbsp;<span class="op" id="4252038">&gt;</span>&nbsp;<span class="num" id="4252040">0</span>&nbsp;<span class="op" id="4252042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4252046">//&nbsp;Chunked&nbsp;encoding&nbsp;trumps&nbsp;Content-Length.&nbsp;See&nbsp;RFC&nbsp;2616</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4252104">//&nbsp;Section&nbsp;4.4.&nbsp;Currently&nbsp;len(te)&nbsp;&gt;&nbsp;0&nbsp;implies&nbsp;chunked</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4252160">//&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4252175">delete</span><span class="op" id="4252181">(</span><span class="ident" id="4252182"><a href="/gostd/net/http/transfer.go.html#4251113">header</a></span><span class="op" id="4252188">,</span>&nbsp;<span class="string" id="4252190">&#34;Content-Length&#34;</span><span class="op" id="4252206">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252210">return</span>&nbsp;<span class="ident" id="4252217"><a href="/gostd/net/http/transfer.go.html#4251310">te</a></span><span class="op" id="4252219">,</span>&nbsp;<span class="builtintype" id="4252221">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4252226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252230">return</span>&nbsp;<span class="builtintype" id="4252237">nil</span><span class="op" id="4252240">,</span>&nbsp;<span class="builtintype" id="4252242">nil</span><br>
<span class="lineno"></span><span class="op" id="4252246">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="4252249">//&nbsp;Determine&nbsp;the&nbsp;expected&nbsp;body&nbsp;length,&nbsp;using&nbsp;RFC&nbsp;2616&nbsp;Section&nbsp;4.4.&nbsp;This</span><br>
<span class="lineno"></span><span class="comment" id="4252321">//&nbsp;function&nbsp;is&nbsp;not&nbsp;a&nbsp;method,&nbsp;because&nbsp;ultimately&nbsp;it&nbsp;should&nbsp;be&nbsp;shared&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4252392">//&nbsp;ReadResponse&nbsp;and&nbsp;ReadRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="4252425">func</span>&nbsp;<span class="ident" id="4252430">fixLength</span><span class="op" id="4252439">(</span><span class="ident" id="4252440">isResponse</span>&nbsp;<span class="builtintype" id="4252451">bool</span><span class="op" id="4252455">,</span>&nbsp;<span class="ident" id="4252457">status</span>&nbsp;<span class="builtintype" id="4252464">int</span><span class="op" id="4252467">,</span>&nbsp;<span class="ident" id="4252469">requestMethod</span>&nbsp;<span class="builtintype" id="4252483">string</span><span class="op" id="4252489">,</span>&nbsp;<span class="ident" id="4252491">header</span>&nbsp;<span class="ident" id="4252498"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4252504">,</span>&nbsp;<span class="ident" id="4252506">te</span>&nbsp;<span class="op" id="4252509">[</span><span class="op" id="4252510">]</span><span class="builtintype" id="4252511">string</span><span class="op" id="4252517">)</span>&nbsp;<span class="op" id="4252519">(</span><span class="builtintype" id="4252520">int64</span><span class="op" id="4252525">,</span>&nbsp;<span class="builtintype" id="4252527">error</span><span class="op" id="4252532">)</span>&nbsp;<span class="op" id="4252534">{</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4252538">//&nbsp;Logic&nbsp;based&nbsp;on&nbsp;response&nbsp;type&nbsp;or&nbsp;status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252581">if</span>&nbsp;<span class="ident" id="4252584"><a href="/gostd/net/http/transfer.go.html#4243847">noBodyExpected</a></span><span class="op" id="4252598">(</span><span class="ident" id="4252599"><a href="/gostd/net/http/transfer.go.html#4252469">requestMethod</a></span><span class="op" id="4252612">)</span>&nbsp;<span class="op" id="4252614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252618">return</span>&nbsp;<span class="num" id="4252625">0</span><span class="op" id="4252626">,</span>&nbsp;<span class="builtintype" id="4252628">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4252633">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252636">if</span>&nbsp;<span class="ident" id="4252639"><a href="/gostd/net/http/transfer.go.html#4252457">status</a></span><span class="op" id="4252645">/</span><span class="num" id="4252646">100</span>&nbsp;<span class="op" id="4252650">==</span>&nbsp;<span class="num" id="4252653">1</span>&nbsp;<span class="op" id="4252655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252659">return</span>&nbsp;<span class="num" id="4252666">0</span><span class="op" id="4252667">,</span>&nbsp;<span class="builtintype" id="4252669">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4252674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252677">switch</span>&nbsp;<span class="ident" id="4252684"><a href="/gostd/net/http/transfer.go.html#4252457">status</a></span>&nbsp;<span class="op" id="4252691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252694">case</span>&nbsp;<span class="num" id="4252699">204</span><span class="op" id="4252702">,</span>&nbsp;<span class="num" id="4252704">304</span><span class="op" id="4252707">:</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252711">return</span>&nbsp;<span class="num" id="4252718">0</span><span class="op" id="4252719">,</span>&nbsp;<span class="builtintype" id="4252721">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4252726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4252730">//&nbsp;Logic&nbsp;based&nbsp;on&nbsp;Transfer-Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252767">if</span>&nbsp;<span class="ident" id="4252770"><a href="/gostd/net/http/transfer.go.html#4250825">chunked</a></span><span class="op" id="4252777">(</span><span class="ident" id="4252778"><a href="/gostd/net/http/transfer.go.html#4252506">te</a></span><span class="op" id="4252780">)</span>&nbsp;<span class="op" id="4252782">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252786">return</span>&nbsp;<span class="op" id="4252793">-</span><span class="num" id="4252794">1</span><span class="op" id="4252795">,</span>&nbsp;<span class="builtintype" id="4252797">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4252802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4252806">//&nbsp;Logic&nbsp;based&nbsp;on&nbsp;Content-Length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4252840">cl</span>&nbsp;<span class="op" id="4252843">:=</span>&nbsp;<span class="ident" id="4252846"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4252853">.</span><span class="ident" id="4252854"><a href="/gostd/strings/strings.go.html#2982525">TrimSpace</a></span><span class="op" id="4252863">(</span><span class="ident" id="4252864"><a href="/gostd/net/http/transfer.go.html#4252491">header</a></span><span class="op" id="4252870">.</span><span class="ident" id="4252871"><a href="/gostd/net/http/header.go.html#4126950">get</a></span><span class="op" id="4252874">(</span><span class="string" id="4252875">&#34;Content-Length&#34;</span><span class="op" id="4252891">)</span><span class="op" id="4252892">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252895">if</span>&nbsp;<span class="ident" id="4252898"><a href="/gostd/net/http/transfer.go.html#4252840">cl</a></span>&nbsp;<span class="op" id="4252901">!=</span>&nbsp;<span class="string" id="4252904">&#34;&#34;</span>&nbsp;<span class="op" id="4252907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4252911">n</span><span class="op" id="4252912">,</span>&nbsp;<span class="ident" id="4252914">err</span>&nbsp;<span class="op" id="4252918">:=</span>&nbsp;<span class="ident" id="4252921"><a href="/gostd/net/http/transfer.go.html#4259220">parseContentLength</a></span><span class="op" id="4252939">(</span><span class="ident" id="4252940"><a href="/gostd/net/http/transfer.go.html#4252840">cl</a></span><span class="op" id="4252942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252946">if</span>&nbsp;<span class="ident" id="4252949"><a href="/gostd/net/http/transfer.go.html#4252914">err</a></span>&nbsp;<span class="op" id="4252953">!=</span>&nbsp;<span class="builtintype" id="4252956">nil</span>&nbsp;<span class="op" id="4252960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252965">return</span>&nbsp;<span class="op" id="4252972">-</span><span class="num" id="4252973">1</span><span class="op" id="4252974">,</span>&nbsp;<span class="ident" id="4252976"><a href="/gostd/net/http/transfer.go.html#4252914">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4252982">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252986">return</span>&nbsp;<span class="ident" id="4252993"><a href="/gostd/net/http/transfer.go.html#4252911">n</a></span><span class="op" id="4252994">,</span>&nbsp;<span class="builtintype" id="4252996">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4253001">}</span>&nbsp;<span class="keyword" id="4253003">else</span>&nbsp;<span class="op" id="4253008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4253012"><a href="/gostd/net/http/transfer.go.html#4252491">header</a></span><span class="op" id="4253018">.</span><span class="ident" id="4253019"><a href="/gostd/net/http/header.go.html#4127099">Del</a></span><span class="op" id="4253022">(</span><span class="string" id="4253023">&#34;Content-Length&#34;</span><span class="op" id="4253039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4253042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4253046">if</span>&nbsp;<span class="op" id="4253049">!</span><span class="ident" id="4253050"><a href="/gostd/net/http/transfer.go.html#4252440">isResponse</a></span>&nbsp;<span class="op" id="4253061">&amp;&amp;</span>&nbsp;<span class="ident" id="4253064"><a href="/gostd/net/http/transfer.go.html#4252469">requestMethod</a></span>&nbsp;<span class="op" id="4253078">==</span>&nbsp;<span class="string" id="4253081">&#34;GET&#34;</span>&nbsp;<span class="op" id="4253087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4253091">//&nbsp;RFC&nbsp;2616&nbsp;doesn&#39;t&nbsp;explicitly&nbsp;permit&nbsp;nor&nbsp;forbid&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4253145">//&nbsp;entity-body&nbsp;on&nbsp;a&nbsp;GET&nbsp;request&nbsp;so&nbsp;we&nbsp;permit&nbsp;one&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4253199">//&nbsp;declared,&nbsp;but&nbsp;we&nbsp;default&nbsp;to&nbsp;0&nbsp;here&nbsp;(not&nbsp;-1&nbsp;below)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4253254">//&nbsp;if&nbsp;there&#39;s&nbsp;no&nbsp;mention&nbsp;of&nbsp;a&nbsp;body.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4253292">return</span>&nbsp;<span class="num" id="4253299">0</span><span class="op" id="4253300">,</span>&nbsp;<span class="builtintype" id="4253302">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4253307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4253311">//&nbsp;Body-EOF&nbsp;logic&nbsp;based&nbsp;on&nbsp;other&nbsp;methods&nbsp;(like&nbsp;closing,&nbsp;or&nbsp;chunked&nbsp;coding)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4253387">return</span>&nbsp;<span class="op" id="4253394">-</span><span class="num" id="4253395">1</span><span class="op" id="4253396">,</span>&nbsp;<span class="builtintype" id="4253398">nil</span><br>
<span class="lineno">500</span><span class="op" id="4253402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4253405">//&nbsp;Determine&nbsp;whether&nbsp;to&nbsp;hang&nbsp;up&nbsp;after&nbsp;sending&nbsp;a&nbsp;request&nbsp;and&nbsp;body,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4253474">//&nbsp;receiving&nbsp;a&nbsp;response&nbsp;and&nbsp;body</span><br>
<span class="lineno"></span><span class="comment" id="4253507">//&nbsp;&#39;header&#39;&nbsp;is&nbsp;the&nbsp;request&nbsp;headers</span><br>
<span class="lineno">505</span><span class="keyword" id="4253542">func</span>&nbsp;<span class="ident" id="4253547">shouldClose</span><span class="op" id="4253558">(</span><span class="ident" id="4253559">major</span><span class="op" id="4253564">,</span>&nbsp;<span class="ident" id="4253566">minor</span>&nbsp;<span class="builtintype" id="4253572">int</span><span class="op" id="4253575">,</span>&nbsp;<span class="ident" id="4253577">header</span>&nbsp;<span class="ident" id="4253584"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4253590">,</span>&nbsp;<span class="ident" id="4253592">removeCloseHeader</span>&nbsp;<span class="builtintype" id="4253610">bool</span><span class="op" id="4253614">)</span>&nbsp;<span class="builtintype" id="4253616">bool</span>&nbsp;<span class="op" id="4253621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4253624">if</span>&nbsp;<span class="ident" id="4253627"><a href="/gostd/net/http/transfer.go.html#4253559">major</a></span>&nbsp;<span class="op" id="4253633">&lt;</span>&nbsp;<span class="num" id="4253635">1</span>&nbsp;<span class="op" id="4253637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4253641">return</span>&nbsp;<span class="builtintype" id="4253648">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4253654">}</span>&nbsp;<span class="keyword" id="4253656">else</span>&nbsp;<span class="keyword" id="4253661">if</span>&nbsp;<span class="ident" id="4253664"><a href="/gostd/net/http/transfer.go.html#4253559">major</a></span>&nbsp;<span class="op" id="4253670">==</span>&nbsp;<span class="num" id="4253673">1</span>&nbsp;<span class="op" id="4253675">&amp;&amp;</span>&nbsp;<span class="ident" id="4253678"><a href="/gostd/net/http/transfer.go.html#4253566">minor</a></span>&nbsp;<span class="op" id="4253684">==</span>&nbsp;<span class="num" id="4253687">0</span>&nbsp;<span class="op" id="4253689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4253693">if</span>&nbsp;<span class="op" id="4253696">!</span><span class="ident" id="4253697"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4253704">.</span><span class="ident" id="4253705"><a href="/gostd/strings/strings.go.html#2968416">Contains</a></span><span class="op" id="4253713">(</span><span class="ident" id="4253714"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4253721">.</span><span class="ident" id="4253722"><a href="/gostd/strings/strings.go.html#2977307">ToLower</a></span><span class="op" id="4253729">(</span><span class="ident" id="4253730"><a href="/gostd/net/http/transfer.go.html#4253577">header</a></span><span class="op" id="4253736">.</span><span class="ident" id="4253737"><a href="/gostd/net/http/header.go.html#4126950">get</a></span><span class="op" id="4253740">(</span><span class="string" id="4253741">&#34;Connection&#34;</span><span class="op" id="4253753">)</span><span class="op" id="4253754">)</span><span class="op" id="4253755">,</span>&nbsp;<span class="string" id="4253757">&#34;keep-alive&#34;</span><span class="op" id="4253769">)</span>&nbsp;<span class="op" id="4253771">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4253776">return</span>&nbsp;<span class="builtintype" id="4253783">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4253790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4253794">return</span>&nbsp;<span class="builtintype" id="4253801">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4253808">}</span>&nbsp;<span class="keyword" id="4253810">else</span>&nbsp;<span class="op" id="4253815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4253819">//&nbsp;TODO:&nbsp;Should&nbsp;split&nbsp;on&nbsp;commas,&nbsp;toss&nbsp;surrounding&nbsp;white&nbsp;space,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4253884">//&nbsp;and&nbsp;check&nbsp;each&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4253911">if</span>&nbsp;<span class="ident" id="4253914"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4253921">.</span><span class="ident" id="4253922"><a href="/gostd/strings/strings.go.html#2977307">ToLower</a></span><span class="op" id="4253929">(</span><span class="ident" id="4253930"><a href="/gostd/net/http/transfer.go.html#4253577">header</a></span><span class="op" id="4253936">.</span><span class="ident" id="4253937"><a href="/gostd/net/http/header.go.html#4126950">get</a></span><span class="op" id="4253940">(</span><span class="string" id="4253941">&#34;Connection&#34;</span><span class="op" id="4253953">)</span><span class="op" id="4253954">)</span>&nbsp;<span class="op" id="4253956">==</span>&nbsp;<span class="string" id="4253959">&#34;close&#34;</span>&nbsp;<span class="op" id="4253967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4253972">if</span>&nbsp;<span class="ident" id="4253975"><a href="/gostd/net/http/transfer.go.html#4253592">removeCloseHeader</a></span>&nbsp;<span class="op" id="4253993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4253999"><a href="/gostd/net/http/transfer.go.html#4253577">header</a></span><span class="op" id="4254005">.</span><span class="ident" id="4254006"><a href="/gostd/net/http/header.go.html#4127099">Del</a></span><span class="op" id="4254009">(</span><span class="string" id="4254010">&#34;Connection&#34;</span><span class="op" id="4254022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254027">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254032">return</span>&nbsp;<span class="builtintype" id="4254039">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254052">return</span>&nbsp;<span class="builtintype" id="4254059">false</span><br>
<span class="lineno"></span><span class="op" id="4254065">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span><span class="comment" id="4254068">//&nbsp;Parse&nbsp;the&nbsp;trailer&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="4254096">func</span>&nbsp;<span class="ident" id="4254101">fixTrailer</span><span class="op" id="4254111">(</span><span class="ident" id="4254112">header</span>&nbsp;<span class="ident" id="4254119"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4254125">,</span>&nbsp;<span class="ident" id="4254127">te</span>&nbsp;<span class="op" id="4254130">[</span><span class="op" id="4254131">]</span><span class="builtintype" id="4254132">string</span><span class="op" id="4254138">)</span>&nbsp;<span class="op" id="4254140">(</span><span class="ident" id="4254141"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4254147">,</span>&nbsp;<span class="builtintype" id="4254149">error</span><span class="op" id="4254154">)</span>&nbsp;<span class="op" id="4254156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254159">raw</span>&nbsp;<span class="op" id="4254163">:=</span>&nbsp;<span class="ident" id="4254166"><a href="/gostd/net/http/transfer.go.html#4254112">header</a></span><span class="op" id="4254172">.</span><span class="ident" id="4254173"><a href="/gostd/net/http/header.go.html#4126950">get</a></span><span class="op" id="4254176">(</span><span class="string" id="4254177">&#34;Trailer&#34;</span><span class="op" id="4254186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254189">if</span>&nbsp;<span class="ident" id="4254192"><a href="/gostd/net/http/transfer.go.html#4254159">raw</a></span>&nbsp;<span class="op" id="4254196">==</span>&nbsp;<span class="string" id="4254199">&#34;&#34;</span>&nbsp;<span class="op" id="4254202">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254206">return</span>&nbsp;<span class="builtintype" id="4254213">nil</span><span class="op" id="4254216">,</span>&nbsp;<span class="builtintype" id="4254218">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254227"><a href="/gostd/net/http/transfer.go.html#4254112">header</a></span><span class="op" id="4254233">.</span><span class="ident" id="4254234"><a href="/gostd/net/http/header.go.html#4127099">Del</a></span><span class="op" id="4254237">(</span><span class="string" id="4254238">&#34;Trailer&#34;</span><span class="op" id="4254247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254250">trailer</span>&nbsp;<span class="op" id="4254258">:=</span>&nbsp;<span class="builtinfunc" id="4254261">make</span><span class="op" id="4254265">(</span><span class="ident" id="4254266"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4254272">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254275">keys</span>&nbsp;<span class="op" id="4254280">:=</span>&nbsp;<span class="ident" id="4254283"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4254290">.</span><span class="ident" id="4254291"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="4254296">(</span><span class="ident" id="4254297"><a href="/gostd/net/http/transfer.go.html#4254159">raw</a></span><span class="op" id="4254300">,</span>&nbsp;<span class="string" id="4254302">&#34;,&#34;</span><span class="op" id="4254305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254308">for</span>&nbsp;<span class="ident" id="4254312">_</span><span class="op" id="4254313">,</span>&nbsp;<span class="ident" id="4254315">key</span>&nbsp;<span class="op" id="4254319">:=</span>&nbsp;<span class="keyword" id="4254322">range</span>&nbsp;<span class="ident" id="4254328"><a href="/gostd/net/http/transfer.go.html#4254275">keys</a></span>&nbsp;<span class="op" id="4254333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254337"><a href="/gostd/net/http/transfer.go.html#4254315">key</a></span>&nbsp;<span class="op" id="4254341">=</span>&nbsp;<span class="ident" id="4254343"><a href="/gostd/net/http/header.go.html#4130232">CanonicalHeaderKey</a></span><span class="op" id="4254361">(</span><span class="ident" id="4254362"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4254369">.</span><span class="ident" id="4254370"><a href="/gostd/strings/strings.go.html#2982525">TrimSpace</a></span><span class="op" id="4254379">(</span><span class="ident" id="4254380"><a href="/gostd/net/http/transfer.go.html#4254315">key</a></span><span class="op" id="4254383">)</span><span class="op" id="4254384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254388">switch</span>&nbsp;<span class="ident" id="4254395"><a href="/gostd/net/http/transfer.go.html#4254315">key</a></span>&nbsp;<span class="op" id="4254399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254403">case</span>&nbsp;<span class="string" id="4254408">&#34;Transfer-Encoding&#34;</span><span class="op" id="4254427">,</span>&nbsp;<span class="string" id="4254429">&#34;Trailer&#34;</span><span class="op" id="4254438">,</span>&nbsp;<span class="string" id="4254440">&#34;Content-Length&#34;</span><span class="op" id="4254456">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254461">return</span>&nbsp;<span class="builtintype" id="4254468">nil</span><span class="op" id="4254471">,</span>&nbsp;<span class="op" id="4254473">&amp;</span><span class="ident" id="4254474"><a href="/gostd/net/http/request.go.html#4135248">badStringError</a></span><span class="op" id="4254488">{</span><span class="string" id="4254489">&#34;bad&nbsp;trailer&nbsp;key&#34;</span><span class="op" id="4254506">,</span>&nbsp;<span class="ident" id="4254508"><a href="/gostd/net/http/transfer.go.html#4254315">key</a></span><span class="op" id="4254511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254519"><a href="/gostd/net/http/transfer.go.html#4254250">trailer</a></span><span class="op" id="4254526">[</span><span class="ident" id="4254527"><a href="/gostd/net/http/transfer.go.html#4254315">key</a></span><span class="op" id="4254530">]</span>&nbsp;<span class="op" id="4254532">=</span>&nbsp;<span class="builtintype" id="4254534">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254542">if</span>&nbsp;<span class="builtinfunc" id="4254545">len</span><span class="op" id="4254548">(</span><span class="ident" id="4254549"><a href="/gostd/net/http/transfer.go.html#4254250">trailer</a></span><span class="op" id="4254556">)</span>&nbsp;<span class="op" id="4254558">==</span>&nbsp;<span class="num" id="4254561">0</span>&nbsp;<span class="op" id="4254563">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254567">return</span>&nbsp;<span class="builtintype" id="4254574">nil</span><span class="op" id="4254577">,</span>&nbsp;<span class="builtintype" id="4254579">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254587">if</span>&nbsp;<span class="op" id="4254590">!</span><span class="ident" id="4254591"><a href="/gostd/net/http/transfer.go.html#4250825">chunked</a></span><span class="op" id="4254598">(</span><span class="ident" id="4254599"><a href="/gostd/net/http/transfer.go.html#4254127">te</a></span><span class="op" id="4254601">)</span>&nbsp;<span class="op" id="4254603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4254607">//&nbsp;Trailer&nbsp;and&nbsp;no&nbsp;chunking</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254636">return</span>&nbsp;<span class="builtintype" id="4254643">nil</span><span class="op" id="4254646">,</span>&nbsp;<span class="ident" id="4254648"><a href="/gostd/net/http/request.go.html#4134882">ErrUnexpectedTrailer</a></span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254673">return</span>&nbsp;<span class="ident" id="4254680"><a href="/gostd/net/http/transfer.go.html#4254250">trailer</a></span><span class="op" id="4254687">,</span>&nbsp;<span class="builtintype" id="4254689">nil</span><br>
<span class="lineno"></span><span class="op" id="4254693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4254696">//&nbsp;body&nbsp;turns&nbsp;a&nbsp;Reader&nbsp;into&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno">555</span><span class="comment" id="4254738">//&nbsp;Close&nbsp;ensures&nbsp;that&nbsp;the&nbsp;body&nbsp;has&nbsp;been&nbsp;fully&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="4254789">//&nbsp;and&nbsp;then&nbsp;reads&nbsp;the&nbsp;trailer&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="4254833">type</span>&nbsp;<span class="ident" id="4254838">body</span>&nbsp;<span class="keyword" id="4254843">struct</span>&nbsp;<span class="op" id="4254850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254853">src</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254861"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4254863">.</span><span class="ident" id="4254864"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254872">hdr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254880">interface</span><span class="op" id="4254889">{</span><span class="op" id="4254890">}</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4254894">//&nbsp;non-nil&nbsp;(Response&nbsp;or&nbsp;Request)&nbsp;value&nbsp;means&nbsp;read&nbsp;trailer</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254953">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254961">*</span><span class="ident" id="4254962"><a href="/gostd/net/http/transfer.go.html#4240768">bufio</a></span><span class="op" id="4254967">.</span><span class="ident" id="4254968"><a href="/gostd/bufio/bufio.go.html#1354974">Reader</a></span>&nbsp;<span class="comment" id="4254975">//&nbsp;underlying&nbsp;wire-format&nbsp;reader&nbsp;for&nbsp;the&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255025">closing</span>&nbsp;<span class="builtintype" id="4255033">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4255047">//&nbsp;is&nbsp;the&nbsp;connection&nbsp;to&nbsp;be&nbsp;closed&nbsp;after&nbsp;reading&nbsp;body?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255103">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255110"><a href="/gostd/net/http/transfer.go.html#4240890">sync</a></span><span class="op" id="4255114">.</span><span class="ident" id="4255115"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="4255121">//&nbsp;guards&nbsp;closed,&nbsp;and&nbsp;calls&nbsp;to&nbsp;Read&nbsp;and&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255168">closed</span>&nbsp;<span class="builtintype" id="4255175">bool</span><br>
<span class="lineno">565</span><span class="op" id="4255180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4255183">//&nbsp;ErrBodyReadAfterClose&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;a&nbsp;Request&nbsp;or&nbsp;Response</span><br>
<span class="lineno"></span><span class="comment" id="4255255">//&nbsp;Body&nbsp;after&nbsp;the&nbsp;body&nbsp;has&nbsp;been&nbsp;closed.&nbsp;This&nbsp;typically&nbsp;happens&nbsp;when&nbsp;the&nbsp;body&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4255335">//&nbsp;read&nbsp;after&nbsp;an&nbsp;HTTP&nbsp;Handler&nbsp;calls&nbsp;WriteHeader&nbsp;or&nbsp;Write&nbsp;on&nbsp;its</span><br>
<span class="lineno">570</span><span class="comment" id="4255399">//&nbsp;ResponseWriter.</span><br>
<span class="lineno"></span><span class="keyword" id="4255418">var</span>&nbsp;<span class="ident" id="4255422">ErrBodyReadAfterClose</span>&nbsp;<span class="op" id="4255444">=</span>&nbsp;<span class="ident" id="4255446"><a href="/gostd/net/http/transfer.go.html#4240786">errors</a></span><span class="op" id="4255452">.</span><span class="ident" id="4255453"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4255456">(</span><span class="string" id="4255457">&#34;http:&nbsp;invalid&nbsp;Read&nbsp;on&nbsp;closed&nbsp;Body&#34;</span><span class="op" id="4255492">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4255495">func</span>&nbsp;<span class="op" id="4255500">(</span><span class="ident" id="4255501">b</span>&nbsp;<span class="op" id="4255503">*</span><span class="ident" id="4255504"><a href="/gostd/net/http/transfer.go.html#4254838">body</a></span><span class="op" id="4255508">)</span>&nbsp;<span class="ident" id="4255510">Read</span><span class="op" id="4255514">(</span><span class="ident" id="4255515">p</span>&nbsp;<span class="op" id="4255517">[</span><span class="op" id="4255518">]</span><span class="builtintype" id="4255519">byte</span><span class="op" id="4255523">)</span>&nbsp;<span class="op" id="4255525">(</span><span class="ident" id="4255526">n</span>&nbsp;<span class="builtintype" id="4255528">int</span><span class="op" id="4255531">,</span>&nbsp;<span class="ident" id="4255533">err</span>&nbsp;<span class="builtintype" id="4255537">error</span><span class="op" id="4255542">)</span>&nbsp;<span class="op" id="4255544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255547"><a href="/gostd/net/http/transfer.go.html#4255501">b</a></span><span class="op" id="4255548">.</span><span class="ident" id="4255549"><a href="/gostd/net/http/transfer.go.html#4255103">mu</a></span><span class="op" id="4255551">.</span><span class="ident" id="4255552"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4255556">(</span><span class="op" id="4255557">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255560">defer</span>&nbsp;<span class="ident" id="4255566"><a href="/gostd/net/http/transfer.go.html#4255501">b</a></span><span class="op" id="4255567">.</span><span class="ident" id="4255568"><a href="/gostd/net/http/transfer.go.html#4255103">mu</a></span><span class="op" id="4255570">.</span><span class="ident" id="4255571"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4255577">(</span><span class="op" id="4255578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255581">if</span>&nbsp;<span class="ident" id="4255584"><a href="/gostd/net/http/transfer.go.html#4255501">b</a></span><span class="op" id="4255585">.</span><span class="ident" id="4255586"><a href="/gostd/net/http/transfer.go.html#4255168">closed</a></span>&nbsp;<span class="op" id="4255593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255597">return</span>&nbsp;<span class="num" id="4255604">0</span><span class="op" id="4255605">,</span>&nbsp;<span class="ident" id="4255607"><a href="/gostd/net/http/transfer.go.html#4255422">ErrBodyReadAfterClose</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4255630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255633">return</span>&nbsp;<span class="ident" id="4255640"><a href="/gostd/net/http/transfer.go.html#4255501">b</a></span><span class="op" id="4255641">.</span><span class="ident" id="4255642"><a href="/gostd/net/http/transfer.go.html#4255693">readLocked</a></span><span class="op" id="4255652">(</span><span class="ident" id="4255653"><a href="/gostd/net/http/transfer.go.html#4255515">p</a></span><span class="op" id="4255654">)</span><br>
<span class="lineno">580</span><span class="op" id="4255656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4255659">//&nbsp;Must&nbsp;hold&nbsp;b.mu.</span><br>
<span class="lineno"></span><span class="keyword" id="4255678">func</span>&nbsp;<span class="op" id="4255683">(</span><span class="ident" id="4255684">b</span>&nbsp;<span class="op" id="4255686">*</span><span class="ident" id="4255687"><a href="/gostd/net/http/transfer.go.html#4254838">body</a></span><span class="op" id="4255691">)</span>&nbsp;<span class="ident" id="4255693">readLocked</span><span class="op" id="4255703">(</span><span class="ident" id="4255704">p</span>&nbsp;<span class="op" id="4255706">[</span><span class="op" id="4255707">]</span><span class="builtintype" id="4255708">byte</span><span class="op" id="4255712">)</span>&nbsp;<span class="op" id="4255714">(</span><span class="ident" id="4255715">n</span>&nbsp;<span class="builtintype" id="4255717">int</span><span class="op" id="4255720">,</span>&nbsp;<span class="ident" id="4255722">err</span>&nbsp;<span class="builtintype" id="4255726">error</span><span class="op" id="4255731">)</span>&nbsp;<span class="op" id="4255733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255736"><a href="/gostd/net/http/transfer.go.html#4255715">n</a></span><span class="op" id="4255737">,</span>&nbsp;<span class="ident" id="4255739"><a href="/gostd/net/http/transfer.go.html#4255722">err</a></span>&nbsp;<span class="op" id="4255743">=</span>&nbsp;<span class="ident" id="4255745"><a href="/gostd/net/http/transfer.go.html#4255684">b</a></span><span class="op" id="4255746">.</span><span class="ident" id="4255747"><a href="/gostd/net/http/transfer.go.html#4254853">src</a></span><span class="op" id="4255750">.</span><span class="ident" id="4255751"><a href="/gostd/io/io.go.html#1421843">Read</a></span><span class="op" id="4255755">(</span><span class="ident" id="4255756"><a href="/gostd/net/http/transfer.go.html#4255704">p</a></span><span class="op" id="4255757">)</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255761">if</span>&nbsp;<span class="ident" id="4255764"><a href="/gostd/net/http/transfer.go.html#4255722">err</a></span>&nbsp;<span class="op" id="4255768">==</span>&nbsp;<span class="ident" id="4255771"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4255773">.</span><span class="ident" id="4255774"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="4255778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4255782">//&nbsp;Chunked&nbsp;case.&nbsp;Read&nbsp;the&nbsp;trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255819">if</span>&nbsp;<span class="ident" id="4255822"><a href="/gostd/net/http/transfer.go.html#4255684">b</a></span><span class="op" id="4255823">.</span><span class="ident" id="4255824"><a href="/gostd/net/http/transfer.go.html#4254872">hdr</a></span>&nbsp;<span class="op" id="4255828">!=</span>&nbsp;<span class="builtintype" id="4255831">nil</span>&nbsp;<span class="op" id="4255835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255840">if</span>&nbsp;<span class="ident" id="4255843">e</span>&nbsp;<span class="op" id="4255845">:=</span>&nbsp;<span class="ident" id="4255848"><a href="/gostd/net/http/transfer.go.html#4255684">b</a></span><span class="op" id="4255849">.</span><span class="ident" id="4255850"><a href="/gostd/net/http/transfer.go.html#4257063">readTrailer</a></span><span class="op" id="4255861">(</span><span class="op" id="4255862">)</span><span class="op" id="4255863">;</span>&nbsp;<span class="ident" id="4255865"><a href="/gostd/net/http/transfer.go.html#4255843">e</a></span>&nbsp;<span class="op" id="4255867">!=</span>&nbsp;<span class="builtintype" id="4255870">nil</span>&nbsp;<span class="op" id="4255874">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255880"><a href="/gostd/net/http/transfer.go.html#4255722">err</a></span>&nbsp;<span class="op" id="4255884">=</span>&nbsp;<span class="ident" id="4255886"><a href="/gostd/net/http/transfer.go.html#4255843">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4255891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255896"><a href="/gostd/net/http/transfer.go.html#4255684">b</a></span><span class="op" id="4255897">.</span><span class="ident" id="4255898"><a href="/gostd/net/http/transfer.go.html#4254872">hdr</a></span>&nbsp;<span class="op" id="4255902">=</span>&nbsp;<span class="builtintype" id="4255904">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4255910">}</span>&nbsp;<span class="keyword" id="4255912">else</span>&nbsp;<span class="op" id="4255917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4255922">//&nbsp;If&nbsp;the&nbsp;server&nbsp;declared&nbsp;the&nbsp;Content-Length,&nbsp;our&nbsp;body&nbsp;is&nbsp;a&nbsp;LimitedReader</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4255999">//&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;check&nbsp;whether&nbsp;this&nbsp;EOF&nbsp;arrived&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256058">if</span>&nbsp;<span class="ident" id="4256061">lr</span><span class="op" id="4256063">,</span>&nbsp;<span class="ident" id="4256065">ok</span>&nbsp;<span class="op" id="4256068">:=</span>&nbsp;<span class="ident" id="4256071"><a href="/gostd/net/http/transfer.go.html#4255684">b</a></span><span class="op" id="4256072">.</span><span class="ident" id="4256073"><a href="/gostd/net/http/transfer.go.html#4254853">src</a></span><span class="op" id="4256076">.</span><span class="op" id="4256077">(</span><span class="op" id="4256078">*</span><span class="ident" id="4256079"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4256081">.</span><span class="ident" id="4256082"><a href="/gostd/io/io.go.html#1432050">LimitedReader</a></span><span class="op" id="4256095">)</span><span class="op" id="4256096">;</span>&nbsp;<span class="ident" id="4256098"><a href="/gostd/net/http/transfer.go.html#4256065">ok</a></span>&nbsp;<span class="op" id="4256101">&amp;&amp;</span>&nbsp;<span class="ident" id="4256104"><a href="/gostd/net/http/transfer.go.html#4256061">lr</a></span><span class="op" id="4256106">.</span><span class="ident" id="4256107"><a href="/gostd/io/io.go.html#1432105">N</a></span>&nbsp;<span class="op" id="4256109">&gt;</span>&nbsp;<span class="num" id="4256111">0</span>&nbsp;<span class="op" id="4256113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256119"><a href="/gostd/net/http/transfer.go.html#4255722">err</a></span>&nbsp;<span class="op" id="4256123">=</span>&nbsp;<span class="ident" id="4256125"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4256127">.</span><span class="ident" id="4256128"><a href="/gostd/io/io.go.html#1420096">ErrUnexpectedEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256152">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256159">//&nbsp;If&nbsp;we&nbsp;can&nbsp;return&nbsp;an&nbsp;EOF&nbsp;here&nbsp;along&nbsp;with&nbsp;the&nbsp;read&nbsp;data,&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256221">//&nbsp;so.&nbsp;This&nbsp;is&nbsp;optional&nbsp;per&nbsp;the&nbsp;io.Reader&nbsp;contract,&nbsp;but&nbsp;doing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256284">//&nbsp;so&nbsp;helps&nbsp;the&nbsp;HTTP&nbsp;transport&nbsp;code&nbsp;recycle&nbsp;its&nbsp;connection</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256344">//&nbsp;earlier&nbsp;(since&nbsp;it&nbsp;will&nbsp;see&nbsp;this&nbsp;EOF&nbsp;itself),&nbsp;even&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256405">//&nbsp;client&nbsp;doesn&#39;t&nbsp;do&nbsp;future&nbsp;reads&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256450">if</span>&nbsp;<span class="ident" id="4256453"><a href="/gostd/net/http/transfer.go.html#4255722">err</a></span>&nbsp;<span class="op" id="4256457">==</span>&nbsp;<span class="builtintype" id="4256460">nil</span>&nbsp;<span class="op" id="4256464">&amp;&amp;</span>&nbsp;<span class="ident" id="4256467"><a href="/gostd/net/http/transfer.go.html#4255715">n</a></span>&nbsp;<span class="op" id="4256469">&gt;</span>&nbsp;<span class="num" id="4256471">0</span>&nbsp;<span class="op" id="4256473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256477">if</span>&nbsp;<span class="ident" id="4256480">lr</span><span class="op" id="4256482">,</span>&nbsp;<span class="ident" id="4256484">ok</span>&nbsp;<span class="op" id="4256487">:=</span>&nbsp;<span class="ident" id="4256490"><a href="/gostd/net/http/transfer.go.html#4255684">b</a></span><span class="op" id="4256491">.</span><span class="ident" id="4256492"><a href="/gostd/net/http/transfer.go.html#4254853">src</a></span><span class="op" id="4256495">.</span><span class="op" id="4256496">(</span><span class="op" id="4256497">*</span><span class="ident" id="4256498"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4256500">.</span><span class="ident" id="4256501"><a href="/gostd/io/io.go.html#1432050">LimitedReader</a></span><span class="op" id="4256514">)</span><span class="op" id="4256515">;</span>&nbsp;<span class="ident" id="4256517"><a href="/gostd/net/http/transfer.go.html#4256484">ok</a></span>&nbsp;<span class="op" id="4256520">&amp;&amp;</span>&nbsp;<span class="ident" id="4256523"><a href="/gostd/net/http/transfer.go.html#4256480">lr</a></span><span class="op" id="4256525">.</span><span class="ident" id="4256526"><a href="/gostd/io/io.go.html#1432105">N</a></span>&nbsp;<span class="op" id="4256528">==</span>&nbsp;<span class="num" id="4256531">0</span>&nbsp;<span class="op" id="4256533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256538"><a href="/gostd/net/http/transfer.go.html#4255722">err</a></span>&nbsp;<span class="op" id="4256542">=</span>&nbsp;<span class="ident" id="4256544"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4256546">.</span><span class="ident" id="4256547"><a href="/gostd/io/io.go.html#1419950">EOF</a></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256560">return</span>&nbsp;<span class="ident" id="4256567"><a href="/gostd/net/http/transfer.go.html#4255715">n</a></span><span class="op" id="4256568">,</span>&nbsp;<span class="ident" id="4256570"><a href="/gostd/net/http/transfer.go.html#4255722">err</a></span><br>
<span class="lineno"></span><span class="op" id="4256574">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4256577">var</span>&nbsp;<span class="op" id="4256581">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256584">singleCRLF</span>&nbsp;<span class="op" id="4256595">=</span>&nbsp;<span class="op" id="4256597">[</span><span class="op" id="4256598">]</span><span class="builtintype" id="4256599">byte</span><span class="op" id="4256603">(</span><span class="string" id="4256604">&#34;\r\n&#34;</span><span class="op" id="4256610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256613">doubleCRLF</span>&nbsp;<span class="op" id="4256624">=</span>&nbsp;<span class="op" id="4256626">[</span><span class="op" id="4256627">]</span><span class="builtintype" id="4256628">byte</span><span class="op" id="4256632">(</span><span class="string" id="4256633">&#34;\r\n\r\n&#34;</span><span class="op" id="4256643">)</span><br>
<span class="lineno"></span><span class="op" id="4256645">)</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="4256648">func</span>&nbsp;<span class="ident" id="4256653">seeUpcomingDoubleCRLF</span><span class="op" id="4256674">(</span><span class="ident" id="4256675">r</span>&nbsp;<span class="op" id="4256677">*</span><span class="ident" id="4256678"><a href="/gostd/net/http/transfer.go.html#4240768">bufio</a></span><span class="op" id="4256683">.</span><span class="ident" id="4256684"><a href="/gostd/bufio/bufio.go.html#1354974">Reader</a></span><span class="op" id="4256690">)</span>&nbsp;<span class="builtintype" id="4256692">bool</span>&nbsp;<span class="op" id="4256697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256700">for</span>&nbsp;<span class="ident" id="4256704">peekSize</span>&nbsp;<span class="op" id="4256713">:=</span>&nbsp;<span class="num" id="4256716">4</span><span class="op" id="4256717">;</span>&nbsp;<span class="op" id="4256719">;</span>&nbsp;<span class="ident" id="4256721"><a href="/gostd/net/http/transfer.go.html#4256704">peekSize</a></span><span class="op" id="4256729">++</span>&nbsp;<span class="op" id="4256732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256736">//&nbsp;This&nbsp;loop&nbsp;stops&nbsp;when&nbsp;Peek&nbsp;returns&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256785">//&nbsp;which&nbsp;it&nbsp;does&nbsp;when&nbsp;r&#39;s&nbsp;buffer&nbsp;has&nbsp;been&nbsp;filled.</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256837">buf</span><span class="op" id="4256840">,</span>&nbsp;<span class="ident" id="4256842">err</span>&nbsp;<span class="op" id="4256846">:=</span>&nbsp;<span class="ident" id="4256849"><a href="/gostd/net/http/transfer.go.html#4256675">r</a></span><span class="op" id="4256850">.</span><span class="ident" id="4256851"><a href="/gostd/bufio/bufio.go.html#1357192">Peek</a></span><span class="op" id="4256855">(</span><span class="ident" id="4256856"><a href="/gostd/net/http/transfer.go.html#4256704">peekSize</a></span><span class="op" id="4256864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256868">if</span>&nbsp;<span class="ident" id="4256871"><a href="/gostd/net/http/transfer.go.html#4240777">bytes</a></span><span class="op" id="4256876">.</span><span class="ident" id="4256877"><a href="/gostd/bytes/bytes.go.html#1404147">HasSuffix</a></span><span class="op" id="4256886">(</span><span class="ident" id="4256887"><a href="/gostd/net/http/transfer.go.html#4256837">buf</a></span><span class="op" id="4256890">,</span>&nbsp;<span class="ident" id="4256892"><a href="/gostd/net/http/transfer.go.html#4256613">doubleCRLF</a></span><span class="op" id="4256902">)</span>&nbsp;<span class="op" id="4256904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256909">return</span>&nbsp;<span class="builtintype" id="4256916">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256927">if</span>&nbsp;<span class="ident" id="4256930"><a href="/gostd/net/http/transfer.go.html#4256842">err</a></span>&nbsp;<span class="op" id="4256934">!=</span>&nbsp;<span class="builtintype" id="4256937">nil</span>&nbsp;<span class="op" id="4256941">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256946">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256960">return</span>&nbsp;<span class="builtintype" id="4256967">false</span><br>
<span class="lineno"></span><span class="op" id="4256973">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="keyword" id="4256976">var</span>&nbsp;<span class="ident" id="4256980">errTrailerEOF</span>&nbsp;<span class="op" id="4256994">=</span>&nbsp;<span class="ident" id="4256996"><a href="/gostd/net/http/transfer.go.html#4240786">errors</a></span><span class="op" id="4257002">.</span><span class="ident" id="4257003"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4257006">(</span><span class="string" id="4257007">&#34;http:&nbsp;unexpected&nbsp;EOF&nbsp;reading&nbsp;trailer&#34;</span><span class="op" id="4257045">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4257048">func</span>&nbsp;<span class="op" id="4257053">(</span><span class="ident" id="4257054">b</span>&nbsp;<span class="op" id="4257056">*</span><span class="ident" id="4257057"><a href="/gostd/net/http/transfer.go.html#4254838">body</a></span><span class="op" id="4257061">)</span>&nbsp;<span class="ident" id="4257063">readTrailer</span><span class="op" id="4257074">(</span><span class="op" id="4257075">)</span>&nbsp;<span class="builtintype" id="4257077">error</span>&nbsp;<span class="op" id="4257083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257086">//&nbsp;The&nbsp;common&nbsp;case,&nbsp;since&nbsp;nobody&nbsp;uses&nbsp;trailers.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257135">buf</span><span class="op" id="4257138">,</span>&nbsp;<span class="ident" id="4257140">err</span>&nbsp;<span class="op" id="4257144">:=</span>&nbsp;<span class="ident" id="4257147"><a href="/gostd/net/http/transfer.go.html#4257054">b</a></span><span class="op" id="4257148">.</span><span class="ident" id="4257149"><a href="/gostd/net/http/transfer.go.html#4254953">r</a></span><span class="op" id="4257150">.</span><span class="ident" id="4257151"><a href="/gostd/bufio/bufio.go.html#1357192">Peek</a></span><span class="op" id="4257155">(</span><span class="num" id="4257156">2</span><span class="op" id="4257157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257160">if</span>&nbsp;<span class="ident" id="4257163"><a href="/gostd/net/http/transfer.go.html#4240777">bytes</a></span><span class="op" id="4257168">.</span><span class="ident" id="4257169"><a href="/gostd/bytes/bytes_decl.go.html#1414806">Equal</a></span><span class="op" id="4257174">(</span><span class="ident" id="4257175"><a href="/gostd/net/http/transfer.go.html#4257135">buf</a></span><span class="op" id="4257178">,</span>&nbsp;<span class="ident" id="4257180"><a href="/gostd/net/http/transfer.go.html#4256584">singleCRLF</a></span><span class="op" id="4257190">)</span>&nbsp;<span class="op" id="4257192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257196"><a href="/gostd/net/http/transfer.go.html#4257054">b</a></span><span class="op" id="4257197">.</span><span class="ident" id="4257198"><a href="/gostd/net/http/transfer.go.html#4254953">r</a></span><span class="op" id="4257199">.</span><span class="ident" id="4257200"><a href="/gostd/bufio/bufio.go.html#1358635">ReadByte</a></span><span class="op" id="4257208">(</span><span class="op" id="4257209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257213"><a href="/gostd/net/http/transfer.go.html#4257054">b</a></span><span class="op" id="4257214">.</span><span class="ident" id="4257215"><a href="/gostd/net/http/transfer.go.html#4254953">r</a></span><span class="op" id="4257216">.</span><span class="ident" id="4257217"><a href="/gostd/bufio/bufio.go.html#1358635">ReadByte</a></span><span class="op" id="4257225">(</span><span class="op" id="4257226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257230">return</span>&nbsp;<span class="builtintype" id="4257237">nil</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257245">if</span>&nbsp;<span class="builtinfunc" id="4257248">len</span><span class="op" id="4257251">(</span><span class="ident" id="4257252"><a href="/gostd/net/http/transfer.go.html#4257135">buf</a></span><span class="op" id="4257255">)</span>&nbsp;<span class="op" id="4257257">&lt;</span>&nbsp;<span class="num" id="4257259">2</span>&nbsp;<span class="op" id="4257261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257265">return</span>&nbsp;<span class="ident" id="4257272"><a href="/gostd/net/http/transfer.go.html#4256980">errTrailerEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257290">if</span>&nbsp;<span class="ident" id="4257293"><a href="/gostd/net/http/transfer.go.html#4257140">err</a></span>&nbsp;<span class="op" id="4257297">!=</span>&nbsp;<span class="builtintype" id="4257300">nil</span>&nbsp;<span class="op" id="4257304">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257308">return</span>&nbsp;<span class="ident" id="4257315"><a href="/gostd/net/http/transfer.go.html#4257140">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257324">//&nbsp;Make&nbsp;sure&nbsp;there&#39;s&nbsp;a&nbsp;header&nbsp;terminator&nbsp;coming&nbsp;up,&nbsp;to&nbsp;prevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257388">//&nbsp;a&nbsp;DoS&nbsp;with&nbsp;an&nbsp;unbounded&nbsp;size&nbsp;Trailer.&nbsp;&nbsp;It&#39;s&nbsp;not&nbsp;easy&nbsp;to</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257448">//&nbsp;slip&nbsp;in&nbsp;a&nbsp;LimitReader&nbsp;here,&nbsp;as&nbsp;textproto.NewReader&nbsp;requires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257512">//&nbsp;a&nbsp;concrete&nbsp;*bufio.Reader.&nbsp;&nbsp;Also,&nbsp;we&nbsp;can&#39;t&nbsp;get&nbsp;all&nbsp;the&nbsp;way</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257574">//&nbsp;back&nbsp;up&nbsp;to&nbsp;our&nbsp;conn&#39;s&nbsp;LimitedReader&nbsp;that&nbsp;*might*&nbsp;be&nbsp;backing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257638">//&nbsp;this&nbsp;bufio.Reader.&nbsp;&nbsp;Instead,&nbsp;a&nbsp;hack:&nbsp;we&nbsp;iteratively&nbsp;Peek&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257702">//&nbsp;to&nbsp;the&nbsp;bufio.Reader&#39;s&nbsp;max&nbsp;size,&nbsp;looking&nbsp;for&nbsp;a&nbsp;double&nbsp;CRLF.</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257765">//&nbsp;This&nbsp;limits&nbsp;the&nbsp;trailer&nbsp;to&nbsp;the&nbsp;underlying&nbsp;buffer&nbsp;size,&nbsp;typically&nbsp;4kB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257839">if</span>&nbsp;<span class="op" id="4257842">!</span><span class="ident" id="4257843"><a href="/gostd/net/http/transfer.go.html#4256653">seeUpcomingDoubleCRLF</a></span><span class="op" id="4257864">(</span><span class="ident" id="4257865"><a href="/gostd/net/http/transfer.go.html#4257054">b</a></span><span class="op" id="4257866">.</span><span class="ident" id="4257867"><a href="/gostd/net/http/transfer.go.html#4254953">r</a></span><span class="op" id="4257868">)</span>&nbsp;<span class="op" id="4257870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257874">return</span>&nbsp;<span class="ident" id="4257881"><a href="/gostd/net/http/transfer.go.html#4240786">errors</a></span><span class="op" id="4257887">.</span><span class="ident" id="4257888"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4257891">(</span><span class="string" id="4257892">&#34;http:&nbsp;suspiciously&nbsp;long&nbsp;trailer&nbsp;after&nbsp;chunked&nbsp;body&#34;</span><span class="op" id="4257944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257951">hdr</span><span class="op" id="4257954">,</span>&nbsp;<span class="ident" id="4257956"><a href="/gostd/net/http/transfer.go.html#4257140">err</a></span>&nbsp;<span class="op" id="4257960">:=</span>&nbsp;<span class="ident" id="4257963"><a href="/gostd/net/http/transfer.go.html#4240843">textproto</a></span><span class="op" id="4257972">.</span><span class="ident" id="4257973"><a href="/gostd/net/textproto/reader.go.html#4333349">NewReader</a></span><span class="op" id="4257982">(</span><span class="ident" id="4257983"><a href="/gostd/net/http/transfer.go.html#4257054">b</a></span><span class="op" id="4257984">.</span><span class="ident" id="4257985"><a href="/gostd/net/http/transfer.go.html#4254953">r</a></span><span class="op" id="4257986">)</span><span class="op" id="4257987">.</span><span class="ident" id="4257988"><a href="/gostd/net/textproto/reader.go.html#4344573">ReadMIMEHeader</a></span><span class="op" id="4258002">(</span><span class="op" id="4258003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258006">if</span>&nbsp;<span class="ident" id="4258009"><a href="/gostd/net/http/transfer.go.html#4257140">err</a></span>&nbsp;<span class="op" id="4258013">!=</span>&nbsp;<span class="builtintype" id="4258016">nil</span>&nbsp;<span class="op" id="4258020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258024">if</span>&nbsp;<span class="ident" id="4258027"><a href="/gostd/net/http/transfer.go.html#4257140">err</a></span>&nbsp;<span class="op" id="4258031">==</span>&nbsp;<span class="ident" id="4258034"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4258036">.</span><span class="ident" id="4258037"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="4258041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258046">return</span>&nbsp;<span class="ident" id="4258053"><a href="/gostd/net/http/transfer.go.html#4256980">errTrailerEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258069">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258073">return</span>&nbsp;<span class="ident" id="4258080"><a href="/gostd/net/http/transfer.go.html#4257140">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258088">switch</span>&nbsp;<span class="ident" id="4258095">rr</span>&nbsp;<span class="op" id="4258098">:=</span>&nbsp;<span class="ident" id="4258101"><a href="/gostd/net/http/transfer.go.html#4257054">b</a></span><span class="op" id="4258102">.</span><span class="ident" id="4258103"><a href="/gostd/net/http/transfer.go.html#4254872">hdr</a></span><span class="op" id="4258106">.</span><span class="op" id="4258107">(</span><span class="keyword" id="4258108">type</span><span class="op" id="4258112">)</span>&nbsp;<span class="op" id="4258114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258117">case</span>&nbsp;<span class="op" id="4258122">*</span><span class="ident" id="4258123"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4258130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258134"><a href="/gostd/net/http/transfer.go.html#4258258">mergeSetHeader</a></span><span class="op" id="4258148">(</span><span class="op" id="4258149">&amp;</span><span class="ident" id="4258150"><a href="/gostd/net/http/transfer.go.html#4258095">rr</a></span><span class="op" id="4258152">.</span><span class="ident" id="4258153"><a href="/gostd/net/http/request.go.html#4140820">Trailer</a></span><span class="op" id="4258160">,</span>&nbsp;<span class="ident" id="4258162"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4258168">(</span><span class="ident" id="4258169"><a href="/gostd/net/http/transfer.go.html#4257951">hdr</a></span><span class="op" id="4258172">)</span><span class="op" id="4258173">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258176">case</span>&nbsp;<span class="op" id="4258181">*</span><span class="ident" id="4258182"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><span class="op" id="4258190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258194"><a href="/gostd/net/http/transfer.go.html#4258258">mergeSetHeader</a></span><span class="op" id="4258208">(</span><span class="op" id="4258209">&amp;</span><span class="ident" id="4258210"><a href="/gostd/net/http/transfer.go.html#4258095">rr</a></span><span class="op" id="4258212">.</span><span class="ident" id="4258213"><a href="/gostd/net/http/response.go.html#4163232">Trailer</a></span><span class="op" id="4258220">,</span>&nbsp;<span class="ident" id="4258222"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4258228">(</span><span class="ident" id="4258229"><a href="/gostd/net/http/transfer.go.html#4257951">hdr</a></span><span class="op" id="4258232">)</span><span class="op" id="4258233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258239">return</span>&nbsp;<span class="builtintype" id="4258246">nil</span><br>
<span class="lineno"></span><span class="op" id="4258250">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="4258253">func</span>&nbsp;<span class="ident" id="4258258">mergeSetHeader</span><span class="op" id="4258272">(</span><span class="ident" id="4258273">dst</span>&nbsp;<span class="op" id="4258277">*</span><span class="ident" id="4258278"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4258284">,</span>&nbsp;<span class="ident" id="4258286">src</span>&nbsp;<span class="ident" id="4258290"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4258296">)</span>&nbsp;<span class="op" id="4258298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258301">if</span>&nbsp;<span class="op" id="4258304">*</span><span class="ident" id="4258305"><a href="/gostd/net/http/transfer.go.html#4258273">dst</a></span>&nbsp;<span class="op" id="4258309">==</span>&nbsp;<span class="builtintype" id="4258312">nil</span>&nbsp;<span class="op" id="4258316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258320">*</span><span class="ident" id="4258321"><a href="/gostd/net/http/transfer.go.html#4258273">dst</a></span>&nbsp;<span class="op" id="4258325">=</span>&nbsp;<span class="ident" id="4258327"><a href="/gostd/net/http/transfer.go.html#4258286">src</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258333">return</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258344">for</span>&nbsp;<span class="ident" id="4258348">k</span><span class="op" id="4258349">,</span>&nbsp;<span class="ident" id="4258351">vv</span>&nbsp;<span class="op" id="4258354">:=</span>&nbsp;<span class="keyword" id="4258357">range</span>&nbsp;<span class="ident" id="4258363"><a href="/gostd/net/http/transfer.go.html#4258286">src</a></span>&nbsp;<span class="op" id="4258367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258371">(</span><span class="op" id="4258372">*</span><span class="ident" id="4258373"><a href="/gostd/net/http/transfer.go.html#4258273">dst</a></span><span class="op" id="4258376">)</span><span class="op" id="4258377">[</span><span class="ident" id="4258378"><a href="/gostd/net/http/transfer.go.html#4258348">k</a></span><span class="op" id="4258379">]</span>&nbsp;<span class="op" id="4258381">=</span>&nbsp;<span class="ident" id="4258383"><a href="/gostd/net/http/transfer.go.html#4258351">vv</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258387">}</span><br>
<span class="lineno"></span><span class="op" id="4258389">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4258392">func</span>&nbsp;<span class="op" id="4258397">(</span><span class="ident" id="4258398">b</span>&nbsp;<span class="op" id="4258400">*</span><span class="ident" id="4258401"><a href="/gostd/net/http/transfer.go.html#4254838">body</a></span><span class="op" id="4258405">)</span>&nbsp;<span class="ident" id="4258407">Close</span><span class="op" id="4258412">(</span><span class="op" id="4258413">)</span>&nbsp;<span class="builtintype" id="4258415">error</span>&nbsp;<span class="op" id="4258421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258424"><a href="/gostd/net/http/transfer.go.html#4258398">b</a></span><span class="op" id="4258425">.</span><span class="ident" id="4258426"><a href="/gostd/net/http/transfer.go.html#4255103">mu</a></span><span class="op" id="4258428">.</span><span class="ident" id="4258429"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4258433">(</span><span class="op" id="4258434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258437">defer</span>&nbsp;<span class="ident" id="4258443"><a href="/gostd/net/http/transfer.go.html#4258398">b</a></span><span class="op" id="4258444">.</span><span class="ident" id="4258445"><a href="/gostd/net/http/transfer.go.html#4255103">mu</a></span><span class="op" id="4258447">.</span><span class="ident" id="4258448"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4258454">(</span><span class="op" id="4258455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258458">if</span>&nbsp;<span class="ident" id="4258461"><a href="/gostd/net/http/transfer.go.html#4258398">b</a></span><span class="op" id="4258462">.</span><span class="ident" id="4258463"><a href="/gostd/net/http/transfer.go.html#4255168">closed</a></span>&nbsp;<span class="op" id="4258470">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258474">return</span>&nbsp;<span class="builtintype" id="4258481">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258489">var</span>&nbsp;<span class="ident" id="4258493">err</span>&nbsp;<span class="builtintype" id="4258497">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258504">switch</span>&nbsp;<span class="op" id="4258511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258514">case</span>&nbsp;<span class="ident" id="4258519"><a href="/gostd/net/http/transfer.go.html#4258398">b</a></span><span class="op" id="4258520">.</span><span class="ident" id="4258521"><a href="/gostd/net/http/transfer.go.html#4254872">hdr</a></span>&nbsp;<span class="op" id="4258525">==</span>&nbsp;<span class="builtintype" id="4258528">nil</span>&nbsp;<span class="op" id="4258532">&amp;&amp;</span>&nbsp;<span class="ident" id="4258535"><a href="/gostd/net/http/transfer.go.html#4258398">b</a></span><span class="op" id="4258536">.</span><span class="ident" id="4258537"><a href="/gostd/net/http/transfer.go.html#4255025">closing</a></span><span class="op" id="4258544">:</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258548">//&nbsp;no&nbsp;trailer&nbsp;and&nbsp;closing&nbsp;the&nbsp;connection&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258597">//&nbsp;no&nbsp;point&nbsp;in&nbsp;reading&nbsp;to&nbsp;EOF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258629">default</span><span class="op" id="4258636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258640">//&nbsp;Fully&nbsp;consume&nbsp;the&nbsp;body,&nbsp;which&nbsp;will&nbsp;also&nbsp;lead&nbsp;to&nbsp;us&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258704">//&nbsp;the&nbsp;trailer&nbsp;headers&nbsp;after&nbsp;the&nbsp;body,&nbsp;if&nbsp;present.</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258757">_</span><span class="op" id="4258758">,</span>&nbsp;<span class="ident" id="4258760"><a href="/gostd/net/http/transfer.go.html#4258493">err</a></span>&nbsp;<span class="op" id="4258764">=</span>&nbsp;<span class="ident" id="4258766"><a href="/gostd/net/http/transfer.go.html#4240803">io</a></span><span class="op" id="4258768">.</span><span class="ident" id="4258769"><a href="/gostd/io/io.go.html#1430946">Copy</a></span><span class="op" id="4258773">(</span><span class="ident" id="4258774"><a href="/gostd/net/http/transfer.go.html#4240809">ioutil</a></span><span class="op" id="4258780">.</span><span class="ident" id="4258781"><a href="/gostd/io/ioutil/ioutil.go.html#3768458">Discard</a></span><span class="op" id="4258788">,</span>&nbsp;<span class="ident" id="4258790"><a href="/gostd/net/http/transfer.go.html#4258930">bodyLocked</a></span><span class="op" id="4258800">{</span><span class="ident" id="4258801"><a href="/gostd/net/http/transfer.go.html#4258398">b</a></span><span class="op" id="4258802">}</span><span class="op" id="4258803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258809"><a href="/gostd/net/http/transfer.go.html#4258398">b</a></span><span class="op" id="4258810">.</span><span class="ident" id="4258811"><a href="/gostd/net/http/transfer.go.html#4255168">closed</a></span>&nbsp;<span class="op" id="4258818">=</span>&nbsp;<span class="builtintype" id="4258820">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258826">return</span>&nbsp;<span class="ident" id="4258833"><a href="/gostd/net/http/transfer.go.html#4258493">err</a></span><br>
<span class="lineno"></span><span class="op" id="4258837">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="4258840">//&nbsp;bodyLocked&nbsp;is&nbsp;a&nbsp;io.Reader&nbsp;reading&nbsp;from&nbsp;a&nbsp;*body&nbsp;when&nbsp;its&nbsp;mutex&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4258908">//&nbsp;already&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="4258925">type</span>&nbsp;<span class="ident" id="4258930">bodyLocked</span>&nbsp;<span class="keyword" id="4258941">struct</span>&nbsp;<span class="op" id="4258948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258951">b</span>&nbsp;<span class="op" id="4258953">*</span><span class="ident" id="4258954"><a href="/gostd/net/http/transfer.go.html#4254838">body</a></span><br>
<span class="lineno">715</span><span class="op" id="4258959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4258962">func</span>&nbsp;<span class="op" id="4258967">(</span><span class="ident" id="4258968">bl</span>&nbsp;<span class="ident" id="4258971"><a href="/gostd/net/http/transfer.go.html#4258930">bodyLocked</a></span><span class="op" id="4258981">)</span>&nbsp;<span class="ident" id="4258983">Read</span><span class="op" id="4258987">(</span><span class="ident" id="4258988">p</span>&nbsp;<span class="op" id="4258990">[</span><span class="op" id="4258991">]</span><span class="builtintype" id="4258992">byte</span><span class="op" id="4258996">)</span>&nbsp;<span class="op" id="4258998">(</span><span class="ident" id="4258999">n</span>&nbsp;<span class="builtintype" id="4259001">int</span><span class="op" id="4259004">,</span>&nbsp;<span class="ident" id="4259006">err</span>&nbsp;<span class="builtintype" id="4259010">error</span><span class="op" id="4259015">)</span>&nbsp;<span class="op" id="4259017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259020">if</span>&nbsp;<span class="ident" id="4259023"><a href="/gostd/net/http/transfer.go.html#4258968">bl</a></span><span class="op" id="4259025">.</span><span class="ident" id="4259026"><a href="/gostd/net/http/transfer.go.html#4258951">b</a></span><span class="op" id="4259027">.</span><span class="ident" id="4259028"><a href="/gostd/net/http/transfer.go.html#4255168">closed</a></span>&nbsp;<span class="op" id="4259035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259039">return</span>&nbsp;<span class="num" id="4259046">0</span><span class="op" id="4259047">,</span>&nbsp;<span class="ident" id="4259049"><a href="/gostd/net/http/transfer.go.html#4255422">ErrBodyReadAfterClose</a></span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259075">return</span>&nbsp;<span class="ident" id="4259082"><a href="/gostd/net/http/transfer.go.html#4258968">bl</a></span><span class="op" id="4259084">.</span><span class="ident" id="4259085"><a href="/gostd/net/http/transfer.go.html#4258951">b</a></span><span class="op" id="4259086">.</span><span class="ident" id="4259087"><a href="/gostd/net/http/transfer.go.html#4255693">readLocked</a></span><span class="op" id="4259097">(</span><span class="ident" id="4259098"><a href="/gostd/net/http/transfer.go.html#4258988">p</a></span><span class="op" id="4259099">)</span><br>
<span class="lineno"></span><span class="op" id="4259101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4259104">//&nbsp;parseContentLength&nbsp;trims&nbsp;whitespace&nbsp;from&nbsp;s&nbsp;and&nbsp;returns&nbsp;-1&nbsp;if&nbsp;no&nbsp;value</span><br>
<span class="lineno">725</span><span class="comment" id="4259177">//&nbsp;is&nbsp;set,&nbsp;or&nbsp;the&nbsp;value&nbsp;if&nbsp;it&#39;s&nbsp;&gt;=&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4259215">func</span>&nbsp;<span class="ident" id="4259220">parseContentLength</span><span class="op" id="4259238">(</span><span class="ident" id="4259239">cl</span>&nbsp;<span class="builtintype" id="4259242">string</span><span class="op" id="4259248">)</span>&nbsp;<span class="op" id="4259250">(</span><span class="builtintype" id="4259251">int64</span><span class="op" id="4259256">,</span>&nbsp;<span class="builtintype" id="4259258">error</span><span class="op" id="4259263">)</span>&nbsp;<span class="op" id="4259265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259268"><a href="/gostd/net/http/transfer.go.html#4259239">cl</a></span>&nbsp;<span class="op" id="4259271">=</span>&nbsp;<span class="ident" id="4259273"><a href="/gostd/net/http/transfer.go.html#4240879">strings</a></span><span class="op" id="4259280">.</span><span class="ident" id="4259281"><a href="/gostd/strings/strings.go.html#2982525">TrimSpace</a></span><span class="op" id="4259290">(</span><span class="ident" id="4259291"><a href="/gostd/net/http/transfer.go.html#4259239">cl</a></span><span class="op" id="4259293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259296">if</span>&nbsp;<span class="ident" id="4259299"><a href="/gostd/net/http/transfer.go.html#4259239">cl</a></span>&nbsp;<span class="op" id="4259302">==</span>&nbsp;<span class="string" id="4259305">&#34;&#34;</span>&nbsp;<span class="op" id="4259308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259312">return</span>&nbsp;<span class="op" id="4259319">-</span><span class="num" id="4259320">1</span><span class="op" id="4259321">,</span>&nbsp;<span class="builtintype" id="4259323">nil</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259331">n</span><span class="op" id="4259332">,</span>&nbsp;<span class="ident" id="4259334">err</span>&nbsp;<span class="op" id="4259338">:=</span>&nbsp;<span class="ident" id="4259341"><a href="/gostd/net/http/transfer.go.html#4240868">strconv</a></span><span class="op" id="4259348">.</span><span class="ident" id="4259349"><a href="/gostd/strconv/atoi.go.html#2356133">ParseInt</a></span><span class="op" id="4259357">(</span><span class="ident" id="4259358"><a href="/gostd/net/http/transfer.go.html#4259239">cl</a></span><span class="op" id="4259360">,</span>&nbsp;<span class="num" id="4259362">10</span><span class="op" id="4259364">,</span>&nbsp;<span class="num" id="4259366">64</span><span class="op" id="4259368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259371">if</span>&nbsp;<span class="ident" id="4259374"><a href="/gostd/net/http/transfer.go.html#4259334">err</a></span>&nbsp;<span class="op" id="4259378">!=</span>&nbsp;<span class="builtintype" id="4259381">nil</span>&nbsp;<span class="op" id="4259385">||</span>&nbsp;<span class="ident" id="4259388"><a href="/gostd/net/http/transfer.go.html#4259331">n</a></span>&nbsp;<span class="op" id="4259390">&lt;</span>&nbsp;<span class="num" id="4259392">0</span>&nbsp;<span class="op" id="4259394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259398">return</span>&nbsp;<span class="num" id="4259405">0</span><span class="op" id="4259406">,</span>&nbsp;<span class="op" id="4259408">&amp;</span><span class="ident" id="4259409"><a href="/gostd/net/http/request.go.html#4135248">badStringError</a></span><span class="op" id="4259423">{</span><span class="string" id="4259424">&#34;bad&nbsp;Content-Length&#34;</span><span class="op" id="4259444">,</span>&nbsp;<span class="ident" id="4259446"><a href="/gostd/net/http/transfer.go.html#4259239">cl</a></span><span class="op" id="4259448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259451">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259454">return</span>&nbsp;<span class="ident" id="4259461"><a href="/gostd/net/http/transfer.go.html#4259331">n</a></span><span class="op" id="4259462">,</span>&nbsp;<span class="builtintype" id="4259464">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4259469">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
