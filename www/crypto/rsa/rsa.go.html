<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4188464">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4188519">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4188573">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4188624">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="4188689">package</span>&nbsp;<span class="ident" id="4188697">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4188702">import</span>&nbsp;<span class="op" id="4188709">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4188712">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4188722">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4188737">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4188754">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4188764">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4188772">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4188778">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4188789">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4188792">var</span>&nbsp;<span class="ident" id="4188796">bigZero</span>&nbsp;<span class="op" id="4188804">=</span>&nbsp;<span class="ident" id="4188806">big</span><span class="op" id="4188809">.</span><span class="ident" id="4188810">NewInt</span><span class="op" id="4188816">(</span><span class="num" id="4188817">0</span><span class="op" id="4188818">)</span><br>
<span class="lineno"></span><span class="keyword" id="4188820">var</span>&nbsp;<span class="ident" id="4188824">bigOne</span>&nbsp;<span class="op" id="4188831">=</span>&nbsp;<span class="ident" id="4188833">big</span><span class="op" id="4188836">.</span><span class="ident" id="4188837">NewInt</span><span class="op" id="4188843">(</span><span class="num" id="4188844">1</span><span class="op" id="4188845">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4188848">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4188905">type</span>&nbsp;<span class="ident" id="4188910">PublicKey</span>&nbsp;<span class="keyword" id="4188920">struct</span>&nbsp;<span class="op" id="4188927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188930">N</span>&nbsp;<span class="op" id="4188932">*</span><span class="ident" id="4188933">big</span><span class="op" id="4188936">.</span><span class="ident" id="4188937">Int</span>&nbsp;<span class="comment" id="4188941">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188953">E</span>&nbsp;<span class="builtintype" id="4188955">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188964">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="4188983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4188986">var</span>&nbsp;<span class="op" id="4188990">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188993">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4189016">=</span>&nbsp;<span class="ident" id="4189018">errors</span><span class="op" id="4189024">.</span><span class="ident" id="4189025">New</span><span class="op" id="4189028">(</span><span class="string" id="4189029">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="4189065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189068">errPublicExponentSmall</span>&nbsp;<span class="op" id="4189091">=</span>&nbsp;<span class="ident" id="4189093">errors</span><span class="op" id="4189099">.</span><span class="ident" id="4189100">New</span><span class="op" id="4189103">(</span><span class="string" id="4189104">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="4189143">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189146">errPublicExponentLarge</span>&nbsp;<span class="op" id="4189169">=</span>&nbsp;<span class="ident" id="4189171">errors</span><span class="op" id="4189177">.</span><span class="ident" id="4189178">New</span><span class="op" id="4189181">(</span><span class="string" id="4189182">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="4189221">)</span><br>
<span class="lineno"></span><span class="op" id="4189223">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4189226">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4189285">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="4189345">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="4189400">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4189434">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="4189489">func</span>&nbsp;<span class="ident" id="4189494">checkPub</span><span class="op" id="4189502">(</span><span class="ident" id="4189503">pub</span>&nbsp;<span class="op" id="4189507">*</span><span class="ident" id="4189508">PublicKey</span><span class="op" id="4189517">)</span>&nbsp;<span class="builtintype" id="4189519">error</span>&nbsp;<span class="op" id="4189525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189528">if</span>&nbsp;<span class="ident" id="4189531">pub</span><span class="op" id="4189534">.</span><span class="ident" id="4189535">N</span>&nbsp;<span class="op" id="4189537">==</span>&nbsp;<span class="ident" id="4189540">nil</span>&nbsp;<span class="op" id="4189544">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189548">return</span>&nbsp;<span class="ident" id="4189555">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189576">if</span>&nbsp;<span class="ident" id="4189579">pub</span><span class="op" id="4189582">.</span><span class="ident" id="4189583">E</span>&nbsp;<span class="op" id="4189585">&lt;</span>&nbsp;<span class="num" id="4189587">2</span>&nbsp;<span class="op" id="4189589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189593">return</span>&nbsp;<span class="ident" id="4189600">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189624">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189627">if</span>&nbsp;<span class="ident" id="4189630">pub</span><span class="op" id="4189633">.</span><span class="ident" id="4189634">E</span>&nbsp;<span class="op" id="4189636">&gt;</span>&nbsp;<span class="num" id="4189638">1</span><span class="op" id="4189639">&lt;&lt;</span><span class="num" id="4189641">31</span><span class="op" id="4189643">-</span><span class="num" id="4189644">1</span>&nbsp;<span class="op" id="4189646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189650">return</span>&nbsp;<span class="ident" id="4189657">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189684">return</span>&nbsp;<span class="ident" id="4189691">nil</span><br>
<span class="lineno"></span><span class="op" id="4189695">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4189698">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4189736">type</span>&nbsp;<span class="ident" id="4189741">PrivateKey</span>&nbsp;<span class="keyword" id="4189752">struct</span>&nbsp;<span class="op" id="4189759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189762">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4189783">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189800">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4189810">*</span><span class="ident" id="4189811">big</span><span class="op" id="4189814">.</span><span class="ident" id="4189815">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4189821">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189842">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4189852">[</span><span class="op" id="4189853">]</span><span class="op" id="4189854">*</span><span class="ident" id="4189855">big</span><span class="op" id="4189858">.</span><span class="ident" id="4189859">Int</span>&nbsp;<span class="comment" id="4189863">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189907">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189973">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190003">Precomputed</span>&nbsp;<span class="ident" id="4190015">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="4190033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4190036">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="4190092">func</span>&nbsp;<span class="op" id="4190097">(</span><span class="ident" id="4190098">priv</span>&nbsp;<span class="op" id="4190103">*</span><span class="ident" id="4190104">PrivateKey</span><span class="op" id="4190114">)</span>&nbsp;<span class="ident" id="4190116">Public</span><span class="op" id="4190122">(</span><span class="op" id="4190123">)</span>&nbsp;<span class="ident" id="4190125">crypto</span><span class="op" id="4190131">.</span><span class="ident" id="4190132">PublicKey</span>&nbsp;<span class="op" id="4190142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190145">return</span>&nbsp;<span class="op" id="4190152">&amp;</span><span class="ident" id="4190153">priv</span><span class="op" id="4190157">.</span><span class="ident" id="4190158">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="4190168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4190171">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4190243">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4190322">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4190400">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="4190477">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4190507">func</span>&nbsp;<span class="op" id="4190512">(</span><span class="ident" id="4190513">priv</span>&nbsp;<span class="op" id="4190518">*</span><span class="ident" id="4190519">PrivateKey</span><span class="op" id="4190529">)</span>&nbsp;<span class="ident" id="4190531">Sign</span><span class="op" id="4190535">(</span><span class="ident" id="4190536">rand</span>&nbsp;<span class="ident" id="4190541">io</span><span class="op" id="4190543">.</span><span class="ident" id="4190544">Reader</span><span class="op" id="4190550">,</span>&nbsp;<span class="ident" id="4190552">msg</span>&nbsp;<span class="op" id="4190556">[</span><span class="op" id="4190557">]</span><span class="builtintype" id="4190558">byte</span><span class="op" id="4190562">,</span>&nbsp;<span class="ident" id="4190564">opts</span>&nbsp;<span class="ident" id="4190569">crypto</span><span class="op" id="4190575">.</span><span class="ident" id="4190576">SignerOpts</span><span class="op" id="4190586">)</span>&nbsp;<span class="op" id="4190588">(</span><span class="op" id="4190589">[</span><span class="op" id="4190590">]</span><span class="builtintype" id="4190591">byte</span><span class="op" id="4190595">,</span>&nbsp;<span class="builtintype" id="4190597">error</span><span class="op" id="4190602">)</span>&nbsp;<span class="op" id="4190604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190607">if</span>&nbsp;<span class="ident" id="4190610">pssOpts</span><span class="op" id="4190617">,</span>&nbsp;<span class="ident" id="4190619">ok</span>&nbsp;<span class="op" id="4190622">:=</span>&nbsp;<span class="ident" id="4190625">opts</span><span class="op" id="4190629">.</span><span class="op" id="4190630">(</span><span class="op" id="4190631">*</span><span class="ident" id="4190632">PSSOptions</span><span class="op" id="4190642">)</span><span class="op" id="4190643">;</span>&nbsp;<span class="ident" id="4190645">ok</span>&nbsp;<span class="op" id="4190648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190652">return</span>&nbsp;<span class="ident" id="4190659">SignPSS</span><span class="op" id="4190666">(</span><span class="ident" id="4190667">rand</span><span class="op" id="4190671">,</span>&nbsp;<span class="ident" id="4190673">priv</span><span class="op" id="4190677">,</span>&nbsp;<span class="ident" id="4190679">pssOpts</span><span class="op" id="4190686">.</span><span class="ident" id="4190687">Hash</span><span class="op" id="4190691">,</span>&nbsp;<span class="ident" id="4190693">msg</span><span class="op" id="4190696">,</span>&nbsp;<span class="ident" id="4190698">pssOpts</span><span class="op" id="4190705">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190712">return</span>&nbsp;<span class="ident" id="4190719">SignPKCS1v15</span><span class="op" id="4190731">(</span><span class="ident" id="4190732">rand</span><span class="op" id="4190736">,</span>&nbsp;<span class="ident" id="4190738">priv</span><span class="op" id="4190742">,</span>&nbsp;<span class="ident" id="4190744">opts</span><span class="op" id="4190748">.</span><span class="ident" id="4190749">HashFunc</span><span class="op" id="4190757">(</span><span class="op" id="4190758">)</span><span class="op" id="4190759">,</span>&nbsp;<span class="ident" id="4190761">msg</span><span class="op" id="4190764">)</span><br>
<span class="lineno"></span><span class="op" id="4190766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4190769">type</span>&nbsp;<span class="ident" id="4190774">PrecomputedValues</span>&nbsp;<span class="keyword" id="4190792">struct</span>&nbsp;<span class="op" id="4190799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190802">Dp</span><span class="op" id="4190804">,</span>&nbsp;<span class="ident" id="4190806">Dq</span>&nbsp;<span class="op" id="4190809">*</span><span class="ident" id="4190810">big</span><span class="op" id="4190813">.</span><span class="ident" id="4190814">Int</span>&nbsp;<span class="comment" id="4190818">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190847">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4190854">*</span><span class="ident" id="4190855">big</span><span class="op" id="4190858">.</span><span class="ident" id="4190859">Int</span>&nbsp;<span class="comment" id="4190863">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190879">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190945">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191014">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191077">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191112">CRTValues</span>&nbsp;<span class="op" id="4191122">[</span><span class="op" id="4191123">]</span><span class="ident" id="4191124">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="4191133">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4191136">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4191207">type</span>&nbsp;<span class="ident" id="4191212">CRTValue</span>&nbsp;<span class="keyword" id="4191221">struct</span>&nbsp;<span class="op" id="4191228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191231">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4191237">*</span><span class="ident" id="4191238">big</span><span class="op" id="4191241">.</span><span class="ident" id="4191242">Int</span>&nbsp;<span class="comment" id="4191246">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191267">Coeff</span>&nbsp;<span class="op" id="4191273">*</span><span class="ident" id="4191274">big</span><span class="op" id="4191277">.</span><span class="ident" id="4191278">Int</span>&nbsp;<span class="comment" id="4191282">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191312">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4191318">*</span><span class="ident" id="4191319">big</span><span class="op" id="4191322">.</span><span class="ident" id="4191323">Int</span>&nbsp;<span class="comment" id="4191327">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="4191377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4191380">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4191433">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="4191511">func</span>&nbsp;<span class="op" id="4191516">(</span><span class="ident" id="4191517">priv</span>&nbsp;<span class="op" id="4191522">*</span><span class="ident" id="4191523">PrivateKey</span><span class="op" id="4191533">)</span>&nbsp;<span class="ident" id="4191535">Validate</span><span class="op" id="4191543">(</span><span class="op" id="4191544">)</span>&nbsp;<span class="builtintype" id="4191546">error</span>&nbsp;<span class="op" id="4191552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191555">if</span>&nbsp;<span class="ident" id="4191558">err</span>&nbsp;<span class="op" id="4191562">:=</span>&nbsp;<span class="ident" id="4191565">checkPub</span><span class="op" id="4191573">(</span><span class="op" id="4191574">&amp;</span><span class="ident" id="4191575">priv</span><span class="op" id="4191579">.</span><span class="ident" id="4191580">PublicKey</span><span class="op" id="4191589">)</span><span class="op" id="4191590">;</span>&nbsp;<span class="ident" id="4191592">err</span>&nbsp;<span class="op" id="4191596">!=</span>&nbsp;<span class="ident" id="4191599">nil</span>&nbsp;<span class="op" id="4191603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191607">return</span>&nbsp;<span class="ident" id="4191614">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191623">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191694">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191756">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191826">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191893">for</span>&nbsp;<span class="ident" id="4191897">_</span><span class="op" id="4191898">,</span>&nbsp;<span class="ident" id="4191900">prime</span>&nbsp;<span class="op" id="4191906">:=</span>&nbsp;<span class="keyword" id="4191909">range</span>&nbsp;<span class="ident" id="4191915">priv</span><span class="op" id="4191919">.</span><span class="ident" id="4191920">Primes</span>&nbsp;<span class="op" id="4191927">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191931">if</span>&nbsp;<span class="op" id="4191934">!</span><span class="ident" id="4191935">prime</span><span class="op" id="4191940">.</span><span class="ident" id="4191941">ProbablyPrime</span><span class="op" id="4191954">(</span><span class="num" id="4191955">20</span><span class="op" id="4191957">)</span>&nbsp;<span class="op" id="4191959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191964">return</span>&nbsp;<span class="ident" id="4191971">errors</span><span class="op" id="4191977">.</span><span class="ident" id="4191978">New</span><span class="op" id="4191981">(</span><span class="string" id="4191982">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="4192021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4192032">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192062">modulus</span>&nbsp;<span class="op" id="4192070">:=</span>&nbsp;<span class="builtinfunc" id="4192073">new</span><span class="op" id="4192076">(</span><span class="ident" id="4192077">big</span><span class="op" id="4192080">.</span><span class="ident" id="4192081">Int</span><span class="op" id="4192084">)</span><span class="op" id="4192085">.</span><span class="ident" id="4192086">Set</span><span class="op" id="4192089">(</span><span class="ident" id="4192090">bigOne</span><span class="op" id="4192096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192099">for</span>&nbsp;<span class="ident" id="4192103">_</span><span class="op" id="4192104">,</span>&nbsp;<span class="ident" id="4192106">prime</span>&nbsp;<span class="op" id="4192112">:=</span>&nbsp;<span class="keyword" id="4192115">range</span>&nbsp;<span class="ident" id="4192121">priv</span><span class="op" id="4192125">.</span><span class="ident" id="4192126">Primes</span>&nbsp;<span class="op" id="4192133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192137">modulus</span><span class="op" id="4192144">.</span><span class="ident" id="4192145">Mul</span><span class="op" id="4192148">(</span><span class="ident" id="4192149">modulus</span><span class="op" id="4192156">,</span>&nbsp;<span class="ident" id="4192158">prime</span><span class="op" id="4192163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192166">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192169">if</span>&nbsp;<span class="ident" id="4192172">modulus</span><span class="op" id="4192179">.</span><span class="ident" id="4192180">Cmp</span><span class="op" id="4192183">(</span><span class="ident" id="4192184">priv</span><span class="op" id="4192188">.</span><span class="ident" id="4192189">N</span><span class="op" id="4192190">)</span>&nbsp;<span class="op" id="4192192">!=</span>&nbsp;<span class="num" id="4192195">0</span>&nbsp;<span class="op" id="4192197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192201">return</span>&nbsp;<span class="ident" id="4192208">errors</span><span class="op" id="4192214">.</span><span class="ident" id="4192215">New</span><span class="op" id="4192218">(</span><span class="string" id="4192219">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="4192248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4192255">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4192304">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4192377">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4192439">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4192518">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192588">congruence</span>&nbsp;<span class="op" id="4192599">:=</span>&nbsp;<span class="builtinfunc" id="4192602">new</span><span class="op" id="4192605">(</span><span class="ident" id="4192606">big</span><span class="op" id="4192609">.</span><span class="ident" id="4192610">Int</span><span class="op" id="4192613">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192616">de</span>&nbsp;<span class="op" id="4192619">:=</span>&nbsp;<span class="builtinfunc" id="4192622">new</span><span class="op" id="4192625">(</span><span class="ident" id="4192626">big</span><span class="op" id="4192629">.</span><span class="ident" id="4192630">Int</span><span class="op" id="4192633">)</span><span class="op" id="4192634">.</span><span class="ident" id="4192635">SetInt64</span><span class="op" id="4192643">(</span><span class="ident" id="4192644">int64</span><span class="op" id="4192649">(</span><span class="ident" id="4192650">priv</span><span class="op" id="4192654">.</span><span class="ident" id="4192655">E</span><span class="op" id="4192656">)</span><span class="op" id="4192657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192660">de</span><span class="op" id="4192662">.</span><span class="ident" id="4192663">Mul</span><span class="op" id="4192666">(</span><span class="ident" id="4192667">de</span><span class="op" id="4192669">,</span>&nbsp;<span class="ident" id="4192671">priv</span><span class="op" id="4192675">.</span><span class="ident" id="4192676">D</span><span class="op" id="4192677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192680">for</span>&nbsp;<span class="ident" id="4192684">_</span><span class="op" id="4192685">,</span>&nbsp;<span class="ident" id="4192687">prime</span>&nbsp;<span class="op" id="4192693">:=</span>&nbsp;<span class="keyword" id="4192696">range</span>&nbsp;<span class="ident" id="4192702">priv</span><span class="op" id="4192706">.</span><span class="ident" id="4192707">Primes</span>&nbsp;<span class="op" id="4192714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192718">pminus1</span>&nbsp;<span class="op" id="4192726">:=</span>&nbsp;<span class="builtinfunc" id="4192729">new</span><span class="op" id="4192732">(</span><span class="ident" id="4192733">big</span><span class="op" id="4192736">.</span><span class="ident" id="4192737">Int</span><span class="op" id="4192740">)</span><span class="op" id="4192741">.</span><span class="ident" id="4192742">Sub</span><span class="op" id="4192745">(</span><span class="ident" id="4192746">prime</span><span class="op" id="4192751">,</span>&nbsp;<span class="ident" id="4192753">bigOne</span><span class="op" id="4192759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192763">congruence</span><span class="op" id="4192773">.</span><span class="ident" id="4192774">Mod</span><span class="op" id="4192777">(</span><span class="ident" id="4192778">de</span><span class="op" id="4192780">,</span>&nbsp;<span class="ident" id="4192782">pminus1</span><span class="op" id="4192789">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192793">if</span>&nbsp;<span class="ident" id="4192796">congruence</span><span class="op" id="4192806">.</span><span class="ident" id="4192807">Cmp</span><span class="op" id="4192810">(</span><span class="ident" id="4192811">bigOne</span><span class="op" id="4192817">)</span>&nbsp;<span class="op" id="4192819">!=</span>&nbsp;<span class="num" id="4192822">0</span>&nbsp;<span class="op" id="4192824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192829">return</span>&nbsp;<span class="ident" id="4192836">errors</span><span class="op" id="4192842">.</span><span class="ident" id="4192843">New</span><span class="op" id="4192846">(</span><span class="string" id="4192847">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="4192878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192888">return</span>&nbsp;<span class="ident" id="4192895">nil</span><br>
<span class="lineno">140</span><span class="op" id="4192899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4192902">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4192974">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="4193033">func</span>&nbsp;<span class="ident" id="4193038">GenerateKey</span><span class="op" id="4193049">(</span><span class="ident" id="4193050">random</span>&nbsp;<span class="ident" id="4193057">io</span><span class="op" id="4193059">.</span><span class="ident" id="4193060">Reader</span><span class="op" id="4193066">,</span>&nbsp;<span class="ident" id="4193068">bits</span>&nbsp;<span class="builtintype" id="4193073">int</span><span class="op" id="4193076">)</span>&nbsp;<span class="op" id="4193078">(</span><span class="ident" id="4193079">priv</span>&nbsp;<span class="op" id="4193084">*</span><span class="ident" id="4193085">PrivateKey</span><span class="op" id="4193095">,</span>&nbsp;<span class="ident" id="4193097">err</span>&nbsp;<span class="builtintype" id="4193101">error</span><span class="op" id="4193106">)</span>&nbsp;<span class="op" id="4193108">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193111">return</span>&nbsp;<span class="ident" id="4193118">GenerateMultiPrimeKey</span><span class="op" id="4193139">(</span><span class="ident" id="4193140">random</span><span class="op" id="4193146">,</span>&nbsp;<span class="num" id="4193148">2</span><span class="op" id="4193149">,</span>&nbsp;<span class="ident" id="4193151">bits</span><span class="op" id="4193155">)</span><br>
<span class="lineno"></span><span class="op" id="4193157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4193160">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4193238">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="4193316">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="4193392">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="4193471">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="4193548">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4193557">//</span><br>
<span class="lineno">155</span><span class="comment" id="4193560">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="4193631">//</span><br>
<span class="lineno"></span><span class="comment" id="4193634">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="4193675">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="4193749">func</span>&nbsp;<span class="ident" id="4193754">GenerateMultiPrimeKey</span><span class="op" id="4193775">(</span><span class="ident" id="4193776">random</span>&nbsp;<span class="ident" id="4193783">io</span><span class="op" id="4193785">.</span><span class="ident" id="4193786">Reader</span><span class="op" id="4193792">,</span>&nbsp;<span class="ident" id="4193794">nprimes</span>&nbsp;<span class="builtintype" id="4193802">int</span><span class="op" id="4193805">,</span>&nbsp;<span class="ident" id="4193807">bits</span>&nbsp;<span class="builtintype" id="4193812">int</span><span class="op" id="4193815">)</span>&nbsp;<span class="op" id="4193817">(</span><span class="ident" id="4193818">priv</span>&nbsp;<span class="op" id="4193823">*</span><span class="ident" id="4193824">PrivateKey</span><span class="op" id="4193834">,</span>&nbsp;<span class="ident" id="4193836">err</span>&nbsp;<span class="builtintype" id="4193840">error</span><span class="op" id="4193845">)</span>&nbsp;<span class="op" id="4193847">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193850">priv</span>&nbsp;<span class="op" id="4193855">=</span>&nbsp;<span class="builtinfunc" id="4193857">new</span><span class="op" id="4193860">(</span><span class="ident" id="4193861">PrivateKey</span><span class="op" id="4193871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193874">priv</span><span class="op" id="4193878">.</span><span class="ident" id="4193879">E</span>&nbsp;<span class="op" id="4193881">=</span>&nbsp;<span class="num" id="4193883">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193891">if</span>&nbsp;<span class="ident" id="4193894">nprimes</span>&nbsp;<span class="op" id="4193902">&lt;</span>&nbsp;<span class="num" id="4193904">2</span>&nbsp;<span class="op" id="4193906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193910">return</span>&nbsp;<span class="ident" id="4193917">nil</span><span class="op" id="4193920">,</span>&nbsp;<span class="ident" id="4193922">errors</span><span class="op" id="4193928">.</span><span class="ident" id="4193929">New</span><span class="op" id="4193932">(</span><span class="string" id="4193933">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="4193990">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193997">primes</span>&nbsp;<span class="op" id="4194004">:=</span>&nbsp;<span class="builtinfunc" id="4194007">make</span><span class="op" id="4194011">(</span><span class="op" id="4194012">[</span><span class="op" id="4194013">]</span><span class="op" id="4194014">*</span><span class="ident" id="4194015">big</span><span class="op" id="4194018">.</span><span class="ident" id="4194019">Int</span><span class="op" id="4194022">,</span>&nbsp;<span class="ident" id="4194024">nprimes</span><span class="op" id="4194031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4194034">NextSetOfPrimes</span><span class="op" id="4194049">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194052">for</span>&nbsp;<span class="op" id="4194056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194060">todo</span>&nbsp;<span class="op" id="4194065">:=</span>&nbsp;<span class="ident" id="4194068">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194075">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194135">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194169">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194220">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194245">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194269">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194337">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194342">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194406">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194477">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194542">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194571">if</span>&nbsp;<span class="ident" id="4194574">nprimes</span>&nbsp;<span class="op" id="4194582">&gt;=</span>&nbsp;<span class="num" id="4194585">7</span>&nbsp;<span class="op" id="4194587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194592">todo</span>&nbsp;<span class="op" id="4194597">+=</span>&nbsp;<span class="op" id="4194600">(</span><span class="ident" id="4194601">nprimes</span>&nbsp;<span class="op" id="4194609">-</span>&nbsp;<span class="num" id="4194611">2</span><span class="op" id="4194612">)</span>&nbsp;<span class="op" id="4194614">/</span>&nbsp;<span class="num" id="4194616">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194624">for</span>&nbsp;<span class="ident" id="4194628">i</span>&nbsp;<span class="op" id="4194630">:=</span>&nbsp;<span class="num" id="4194633">0</span><span class="op" id="4194634">;</span>&nbsp;<span class="ident" id="4194636">i</span>&nbsp;<span class="op" id="4194638">&lt;</span>&nbsp;<span class="ident" id="4194640">nprimes</span><span class="op" id="4194647">;</span>&nbsp;<span class="ident" id="4194649">i</span><span class="op" id="4194650">++</span>&nbsp;<span class="op" id="4194653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194658">primes</span><span class="op" id="4194664">[</span><span class="ident" id="4194665">i</span><span class="op" id="4194666">]</span><span class="op" id="4194667">,</span>&nbsp;<span class="ident" id="4194669">err</span>&nbsp;<span class="op" id="4194673">=</span>&nbsp;<span class="ident" id="4194675">rand</span><span class="op" id="4194679">.</span><span class="ident" id="4194680">Prime</span><span class="op" id="4194685">(</span><span class="ident" id="4194686">random</span><span class="op" id="4194692">,</span>&nbsp;<span class="ident" id="4194694">todo</span><span class="op" id="4194698">/</span><span class="op" id="4194699">(</span><span class="ident" id="4194700">nprimes</span><span class="op" id="4194707">-</span><span class="ident" id="4194708">i</span><span class="op" id="4194709">)</span><span class="op" id="4194710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194715">if</span>&nbsp;<span class="ident" id="4194718">err</span>&nbsp;<span class="op" id="4194722">!=</span>&nbsp;<span class="ident" id="4194725">nil</span>&nbsp;<span class="op" id="4194729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194735">return</span>&nbsp;<span class="ident" id="4194742">nil</span><span class="op" id="4194745">,</span>&nbsp;<span class="ident" id="4194747">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194759">todo</span>&nbsp;<span class="op" id="4194764">-=</span>&nbsp;<span class="ident" id="4194767">primes</span><span class="op" id="4194773">[</span><span class="ident" id="4194774">i</span><span class="op" id="4194775">]</span><span class="op" id="4194776">.</span><span class="ident" id="4194777">BitLen</span><span class="op" id="4194783">(</span><span class="op" id="4194784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194793">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194841">for</span>&nbsp;<span class="ident" id="4194845">i</span><span class="op" id="4194846">,</span>&nbsp;<span class="ident" id="4194848">prime</span>&nbsp;<span class="op" id="4194854">:=</span>&nbsp;<span class="keyword" id="4194857">range</span>&nbsp;<span class="ident" id="4194863">primes</span>&nbsp;<span class="op" id="4194870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194875">for</span>&nbsp;<span class="ident" id="4194879">j</span>&nbsp;<span class="op" id="4194881">:=</span>&nbsp;<span class="num" id="4194884">0</span><span class="op" id="4194885">;</span>&nbsp;<span class="ident" id="4194887">j</span>&nbsp;<span class="op" id="4194889">&lt;</span>&nbsp;<span class="ident" id="4194891">i</span><span class="op" id="4194892">;</span>&nbsp;<span class="ident" id="4194894">j</span><span class="op" id="4194895">++</span>&nbsp;<span class="op" id="4194898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194904">if</span>&nbsp;<span class="ident" id="4194907">prime</span><span class="op" id="4194912">.</span><span class="ident" id="4194913">Cmp</span><span class="op" id="4194916">(</span><span class="ident" id="4194917">primes</span><span class="op" id="4194923">[</span><span class="ident" id="4194924">j</span><span class="op" id="4194925">]</span><span class="op" id="4194926">)</span>&nbsp;<span class="op" id="4194928">==</span>&nbsp;<span class="num" id="4194931">0</span>&nbsp;<span class="op" id="4194933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194940">continue</span>&nbsp;<span class="ident" id="4194949">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194969">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194983">n</span>&nbsp;<span class="op" id="4194985">:=</span>&nbsp;<span class="builtinfunc" id="4194988">new</span><span class="op" id="4194991">(</span><span class="ident" id="4194992">big</span><span class="op" id="4194995">.</span><span class="ident" id="4194996">Int</span><span class="op" id="4194999">)</span><span class="op" id="4195000">.</span><span class="ident" id="4195001">Set</span><span class="op" id="4195004">(</span><span class="ident" id="4195005">bigOne</span><span class="op" id="4195011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195015">totient</span>&nbsp;<span class="op" id="4195023">:=</span>&nbsp;<span class="builtinfunc" id="4195026">new</span><span class="op" id="4195029">(</span><span class="ident" id="4195030">big</span><span class="op" id="4195033">.</span><span class="ident" id="4195034">Int</span><span class="op" id="4195037">)</span><span class="op" id="4195038">.</span><span class="ident" id="4195039">Set</span><span class="op" id="4195042">(</span><span class="ident" id="4195043">bigOne</span><span class="op" id="4195049">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195053">pminus1</span>&nbsp;<span class="op" id="4195061">:=</span>&nbsp;<span class="builtinfunc" id="4195064">new</span><span class="op" id="4195067">(</span><span class="ident" id="4195068">big</span><span class="op" id="4195071">.</span><span class="ident" id="4195072">Int</span><span class="op" id="4195075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195079">for</span>&nbsp;<span class="ident" id="4195083">_</span><span class="op" id="4195084">,</span>&nbsp;<span class="ident" id="4195086">prime</span>&nbsp;<span class="op" id="4195092">:=</span>&nbsp;<span class="keyword" id="4195095">range</span>&nbsp;<span class="ident" id="4195101">primes</span>&nbsp;<span class="op" id="4195108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195113">n</span><span class="op" id="4195114">.</span><span class="ident" id="4195115">Mul</span><span class="op" id="4195118">(</span><span class="ident" id="4195119">n</span><span class="op" id="4195120">,</span>&nbsp;<span class="ident" id="4195122">prime</span><span class="op" id="4195127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195132">pminus1</span><span class="op" id="4195139">.</span><span class="ident" id="4195140">Sub</span><span class="op" id="4195143">(</span><span class="ident" id="4195144">prime</span><span class="op" id="4195149">,</span>&nbsp;<span class="ident" id="4195151">bigOne</span><span class="op" id="4195157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195162">totient</span><span class="op" id="4195169">.</span><span class="ident" id="4195170">Mul</span><span class="op" id="4195173">(</span><span class="ident" id="4195174">totient</span><span class="op" id="4195181">,</span>&nbsp;<span class="ident" id="4195183">pminus1</span><span class="op" id="4195190">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195198">if</span>&nbsp;<span class="ident" id="4195201">n</span><span class="op" id="4195202">.</span><span class="ident" id="4195203">BitLen</span><span class="op" id="4195209">(</span><span class="op" id="4195210">)</span>&nbsp;<span class="op" id="4195212">!=</span>&nbsp;<span class="ident" id="4195215">bits</span>&nbsp;<span class="op" id="4195220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4195225">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4195281">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4195342">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195398">continue</span>&nbsp;<span class="ident" id="4195407">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195430">g</span>&nbsp;<span class="op" id="4195432">:=</span>&nbsp;<span class="builtinfunc" id="4195435">new</span><span class="op" id="4195438">(</span><span class="ident" id="4195439">big</span><span class="op" id="4195442">.</span><span class="ident" id="4195443">Int</span><span class="op" id="4195446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195450">priv</span><span class="op" id="4195454">.</span><span class="ident" id="4195455">D</span>&nbsp;<span class="op" id="4195457">=</span>&nbsp;<span class="builtinfunc" id="4195459">new</span><span class="op" id="4195462">(</span><span class="ident" id="4195463">big</span><span class="op" id="4195466">.</span><span class="ident" id="4195467">Int</span><span class="op" id="4195470">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195474">y</span>&nbsp;<span class="op" id="4195476">:=</span>&nbsp;<span class="builtinfunc" id="4195479">new</span><span class="op" id="4195482">(</span><span class="ident" id="4195483">big</span><span class="op" id="4195486">.</span><span class="ident" id="4195487">Int</span><span class="op" id="4195490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195494">e</span>&nbsp;<span class="op" id="4195496">:=</span>&nbsp;<span class="ident" id="4195499">big</span><span class="op" id="4195502">.</span><span class="ident" id="4195503">NewInt</span><span class="op" id="4195509">(</span><span class="ident" id="4195510">int64</span><span class="op" id="4195515">(</span><span class="ident" id="4195516">priv</span><span class="op" id="4195520">.</span><span class="ident" id="4195521">E</span><span class="op" id="4195522">)</span><span class="op" id="4195523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195527">g</span><span class="op" id="4195528">.</span><span class="ident" id="4195529">GCD</span><span class="op" id="4195532">(</span><span class="ident" id="4195533">priv</span><span class="op" id="4195537">.</span><span class="ident" id="4195538">D</span><span class="op" id="4195539">,</span>&nbsp;<span class="ident" id="4195541">y</span><span class="op" id="4195542">,</span>&nbsp;<span class="ident" id="4195544">e</span><span class="op" id="4195545">,</span>&nbsp;<span class="ident" id="4195547">totient</span><span class="op" id="4195554">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195559">if</span>&nbsp;<span class="ident" id="4195562">g</span><span class="op" id="4195563">.</span><span class="ident" id="4195564">Cmp</span><span class="op" id="4195567">(</span><span class="ident" id="4195568">bigOne</span><span class="op" id="4195574">)</span>&nbsp;<span class="op" id="4195576">==</span>&nbsp;<span class="num" id="4195579">0</span>&nbsp;<span class="op" id="4195581">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195586">if</span>&nbsp;<span class="ident" id="4195589">priv</span><span class="op" id="4195593">.</span><span class="ident" id="4195594">D</span><span class="op" id="4195595">.</span><span class="ident" id="4195596">Sign</span><span class="op" id="4195600">(</span><span class="op" id="4195601">)</span>&nbsp;<span class="op" id="4195603">&lt;</span>&nbsp;<span class="num" id="4195605">0</span>&nbsp;<span class="op" id="4195607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195613">priv</span><span class="op" id="4195617">.</span><span class="ident" id="4195618">D</span><span class="op" id="4195619">.</span><span class="ident" id="4195620">Add</span><span class="op" id="4195623">(</span><span class="ident" id="4195624">priv</span><span class="op" id="4195628">.</span><span class="ident" id="4195629">D</span><span class="op" id="4195630">,</span>&nbsp;<span class="ident" id="4195632">totient</span><span class="op" id="4195639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195649">priv</span><span class="op" id="4195653">.</span><span class="ident" id="4195654">Primes</span>&nbsp;<span class="op" id="4195661">=</span>&nbsp;<span class="ident" id="4195663">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195673">priv</span><span class="op" id="4195677">.</span><span class="ident" id="4195678">N</span>&nbsp;<span class="op" id="4195680">=</span>&nbsp;<span class="ident" id="4195682">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195688">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195703">priv</span><span class="op" id="4195707">.</span><span class="ident" id="4195708">Precompute</span><span class="op" id="4195718">(</span><span class="op" id="4195719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195722">return</span><br>
<span class="lineno"></span><span class="op" id="4195729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4195732">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="4195790">func</span>&nbsp;<span class="ident" id="4195795">incCounter</span><span class="op" id="4195805">(</span><span class="ident" id="4195806">c</span>&nbsp;<span class="op" id="4195808">*</span><span class="op" id="4195809">[</span><span class="num" id="4195810">4</span><span class="op" id="4195811">]</span><span class="builtintype" id="4195812">byte</span><span class="op" id="4195816">)</span>&nbsp;<span class="op" id="4195818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195821">if</span>&nbsp;<span class="ident" id="4195824">c</span><span class="op" id="4195825">[</span><span class="num" id="4195826">3</span><span class="op" id="4195827">]</span><span class="op" id="4195828">++</span><span class="op" id="4195830">;</span>&nbsp;<span class="ident" id="4195832">c</span><span class="op" id="4195833">[</span><span class="num" id="4195834">3</span><span class="op" id="4195835">]</span>&nbsp;<span class="op" id="4195837">!=</span>&nbsp;<span class="num" id="4195840">0</span>&nbsp;<span class="op" id="4195842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195846">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195857">if</span>&nbsp;<span class="ident" id="4195860">c</span><span class="op" id="4195861">[</span><span class="num" id="4195862">2</span><span class="op" id="4195863">]</span><span class="op" id="4195864">++</span><span class="op" id="4195866">;</span>&nbsp;<span class="ident" id="4195868">c</span><span class="op" id="4195869">[</span><span class="num" id="4195870">2</span><span class="op" id="4195871">]</span>&nbsp;<span class="op" id="4195873">!=</span>&nbsp;<span class="num" id="4195876">0</span>&nbsp;<span class="op" id="4195878">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195882">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195893">if</span>&nbsp;<span class="ident" id="4195896">c</span><span class="op" id="4195897">[</span><span class="num" id="4195898">1</span><span class="op" id="4195899">]</span><span class="op" id="4195900">++</span><span class="op" id="4195902">;</span>&nbsp;<span class="ident" id="4195904">c</span><span class="op" id="4195905">[</span><span class="num" id="4195906">1</span><span class="op" id="4195907">]</span>&nbsp;<span class="op" id="4195909">!=</span>&nbsp;<span class="num" id="4195912">0</span>&nbsp;<span class="op" id="4195914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195918">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195926">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195929">c</span><span class="op" id="4195930">[</span><span class="num" id="4195931">0</span><span class="op" id="4195932">]</span><span class="op" id="4195933">++</span><br>
<span class="lineno"></span><span class="op" id="4195936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4195939">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4196018">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="4196047">func</span>&nbsp;<span class="ident" id="4196052">mgf1XOR</span><span class="op" id="4196059">(</span><span class="ident" id="4196060">out</span>&nbsp;<span class="op" id="4196064">[</span><span class="op" id="4196065">]</span><span class="builtintype" id="4196066">byte</span><span class="op" id="4196070">,</span>&nbsp;<span class="ident" id="4196072">hash</span>&nbsp;<span class="ident" id="4196077">hash</span><span class="op" id="4196081">.</span><span class="ident" id="4196082">Hash</span><span class="op" id="4196086">,</span>&nbsp;<span class="ident" id="4196088">seed</span>&nbsp;<span class="op" id="4196093">[</span><span class="op" id="4196094">]</span><span class="builtintype" id="4196095">byte</span><span class="op" id="4196099">)</span>&nbsp;<span class="op" id="4196101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196104">var</span>&nbsp;<span class="ident" id="4196108">counter</span>&nbsp;<span class="op" id="4196116">[</span><span class="num" id="4196117">4</span><span class="op" id="4196118">]</span><span class="builtintype" id="4196119">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196125">var</span>&nbsp;<span class="ident" id="4196129">digest</span>&nbsp;<span class="op" id="4196136">[</span><span class="op" id="4196137">]</span><span class="builtintype" id="4196138">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196145">done</span>&nbsp;<span class="op" id="4196150">:=</span>&nbsp;<span class="num" id="4196153">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196156">for</span>&nbsp;<span class="ident" id="4196160">done</span>&nbsp;<span class="op" id="4196165">&lt;</span>&nbsp;<span class="builtinfunc" id="4196167">len</span><span class="op" id="4196170">(</span><span class="ident" id="4196171">out</span><span class="op" id="4196174">)</span>&nbsp;<span class="op" id="4196176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196180">hash</span><span class="op" id="4196184">.</span><span class="ident" id="4196185">Write</span><span class="op" id="4196190">(</span><span class="ident" id="4196191">seed</span><span class="op" id="4196195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196199">hash</span><span class="op" id="4196203">.</span><span class="ident" id="4196204">Write</span><span class="op" id="4196209">(</span><span class="ident" id="4196210">counter</span><span class="op" id="4196217">[</span><span class="num" id="4196218">0</span><span class="op" id="4196219">:</span><span class="num" id="4196220">4</span><span class="op" id="4196221">]</span><span class="op" id="4196222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196226">digest</span>&nbsp;<span class="op" id="4196233">=</span>&nbsp;<span class="ident" id="4196235">hash</span><span class="op" id="4196239">.</span><span class="ident" id="4196240">Sum</span><span class="op" id="4196243">(</span><span class="ident" id="4196244">digest</span><span class="op" id="4196250">[</span><span class="op" id="4196251">:</span><span class="num" id="4196252">0</span><span class="op" id="4196253">]</span><span class="op" id="4196254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196258">hash</span><span class="op" id="4196262">.</span><span class="ident" id="4196263">Reset</span><span class="op" id="4196268">(</span><span class="op" id="4196269">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196274">for</span>&nbsp;<span class="ident" id="4196278">i</span>&nbsp;<span class="op" id="4196280">:=</span>&nbsp;<span class="num" id="4196283">0</span><span class="op" id="4196284">;</span>&nbsp;<span class="ident" id="4196286">i</span>&nbsp;<span class="op" id="4196288">&lt;</span>&nbsp;<span class="builtinfunc" id="4196290">len</span><span class="op" id="4196293">(</span><span class="ident" id="4196294">digest</span><span class="op" id="4196300">)</span>&nbsp;<span class="op" id="4196302">&amp;&amp;</span>&nbsp;<span class="ident" id="4196305">done</span>&nbsp;<span class="op" id="4196310">&lt;</span>&nbsp;<span class="builtinfunc" id="4196312">len</span><span class="op" id="4196315">(</span><span class="ident" id="4196316">out</span><span class="op" id="4196319">)</span><span class="op" id="4196320">;</span>&nbsp;<span class="ident" id="4196322">i</span><span class="op" id="4196323">++</span>&nbsp;<span class="op" id="4196326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196331">out</span><span class="op" id="4196334">[</span><span class="ident" id="4196335">done</span><span class="op" id="4196339">]</span>&nbsp;<span class="op" id="4196341">^=</span>&nbsp;<span class="ident" id="4196344">digest</span><span class="op" id="4196350">[</span><span class="ident" id="4196351">i</span><span class="op" id="4196352">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196357">done</span><span class="op" id="4196361">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4196366">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196370">incCounter</span><span class="op" id="4196380">(</span><span class="op" id="4196381">&amp;</span><span class="ident" id="4196382">counter</span><span class="op" id="4196389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4196392">}</span><br>
<span class="lineno"></span><span class="op" id="4196394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4196397">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="4196476">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4196521">var</span>&nbsp;<span class="ident" id="4196525">ErrMessageTooLong</span>&nbsp;<span class="op" id="4196543">=</span>&nbsp;<span class="ident" id="4196545">errors</span><span class="op" id="4196551">.</span><span class="ident" id="4196552">New</span><span class="op" id="4196555">(</span><span class="string" id="4196556">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="4196610">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4196613">func</span>&nbsp;<span class="ident" id="4196618">encrypt</span><span class="op" id="4196625">(</span><span class="ident" id="4196626">c</span>&nbsp;<span class="op" id="4196628">*</span><span class="ident" id="4196629">big</span><span class="op" id="4196632">.</span><span class="ident" id="4196633">Int</span><span class="op" id="4196636">,</span>&nbsp;<span class="ident" id="4196638">pub</span>&nbsp;<span class="op" id="4196642">*</span><span class="ident" id="4196643">PublicKey</span><span class="op" id="4196652">,</span>&nbsp;<span class="ident" id="4196654">m</span>&nbsp;<span class="op" id="4196656">*</span><span class="ident" id="4196657">big</span><span class="op" id="4196660">.</span><span class="ident" id="4196661">Int</span><span class="op" id="4196664">)</span>&nbsp;<span class="op" id="4196666">*</span><span class="ident" id="4196667">big</span><span class="op" id="4196670">.</span><span class="ident" id="4196671">Int</span>&nbsp;<span class="op" id="4196675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196678">e</span>&nbsp;<span class="op" id="4196680">:=</span>&nbsp;<span class="ident" id="4196683">big</span><span class="op" id="4196686">.</span><span class="ident" id="4196687">NewInt</span><span class="op" id="4196693">(</span><span class="ident" id="4196694">int64</span><span class="op" id="4196699">(</span><span class="ident" id="4196700">pub</span><span class="op" id="4196703">.</span><span class="ident" id="4196704">E</span><span class="op" id="4196705">)</span><span class="op" id="4196706">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4196709">c</span><span class="op" id="4196710">.</span><span class="ident" id="4196711">Exp</span><span class="op" id="4196714">(</span><span class="ident" id="4196715">m</span><span class="op" id="4196716">,</span>&nbsp;<span class="ident" id="4196718">e</span><span class="op" id="4196719">,</span>&nbsp;<span class="ident" id="4196721">pub</span><span class="op" id="4196724">.</span><span class="ident" id="4196725">N</span><span class="op" id="4196726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4196729">return</span>&nbsp;<span class="ident" id="4196736">c</span><br>
<span class="lineno"></span><span class="op" id="4196738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4196741">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="4196798">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="4196874">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4196907">func</span>&nbsp;<span class="ident" id="4196912">EncryptOAEP</span><span class="op" id="4196923">(</span><span class="ident" id="4196924">hash</span>&nbsp;<span class="ident" id="4196929">hash</span><span class="op" id="4196933">.</span><span class="ident" id="4196934">Hash</span><span class="op" id="4196938">,</span>&nbsp;<span class="ident" id="4196940">random</span>&nbsp;<span class="ident" id="4196947">io</span><span class="op" id="4196949">.</span><span class="ident" id="4196950">Reader</span><span class="op" id="4196956">,</span>&nbsp;<span class="ident" id="4196958">pub</span>&nbsp;<span class="op" id="4196962">*</span><span class="ident" id="4196963">PublicKey</span><span class="op" id="4196972">,</span>&nbsp;<span class="ident" id="4196974">msg</span>&nbsp;<span class="op" id="4196978">[</span><span class="op" id="4196979">]</span><span class="builtintype" id="4196980">byte</span><span class="op" id="4196984">,</span>&nbsp;<span class="ident" id="4196986">label</span>&nbsp;<span class="op" id="4196992">[</span><span class="op" id="4196993">]</span><span class="builtintype" id="4196994">byte</span><span class="op" id="4196998">)</span>&nbsp;<span class="op" id="4197000">(</span><span class="ident" id="4197001">out</span>&nbsp;<span class="op" id="4197005">[</span><span class="op" id="4197006">]</span><span class="builtintype" id="4197007">byte</span><span class="op" id="4197011">,</span>&nbsp;<span class="ident" id="4197013">err</span>&nbsp;<span class="builtintype" id="4197017">error</span><span class="op" id="4197022">)</span>&nbsp;<span class="op" id="4197024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197027">if</span>&nbsp;<span class="ident" id="4197030">err</span>&nbsp;<span class="op" id="4197034">:=</span>&nbsp;<span class="ident" id="4197037">checkPub</span><span class="op" id="4197045">(</span><span class="ident" id="4197046">pub</span><span class="op" id="4197049">)</span><span class="op" id="4197050">;</span>&nbsp;<span class="ident" id="4197052">err</span>&nbsp;<span class="op" id="4197056">!=</span>&nbsp;<span class="ident" id="4197059">nil</span>&nbsp;<span class="op" id="4197063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197067">return</span>&nbsp;<span class="ident" id="4197074">nil</span><span class="op" id="4197077">,</span>&nbsp;<span class="ident" id="4197079">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197087">hash</span><span class="op" id="4197091">.</span><span class="ident" id="4197092">Reset</span><span class="op" id="4197097">(</span><span class="op" id="4197098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197101">k</span>&nbsp;<span class="op" id="4197103">:=</span>&nbsp;<span class="op" id="4197106">(</span><span class="ident" id="4197107">pub</span><span class="op" id="4197110">.</span><span class="ident" id="4197111">N</span><span class="op" id="4197112">.</span><span class="ident" id="4197113">BitLen</span><span class="op" id="4197119">(</span><span class="op" id="4197120">)</span>&nbsp;<span class="op" id="4197122">+</span>&nbsp;<span class="num" id="4197124">7</span><span class="op" id="4197125">)</span>&nbsp;<span class="op" id="4197127">/</span>&nbsp;<span class="num" id="4197129">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197132">if</span>&nbsp;<span class="builtinfunc" id="4197135">len</span><span class="op" id="4197138">(</span><span class="ident" id="4197139">msg</span><span class="op" id="4197142">)</span>&nbsp;<span class="op" id="4197144">&gt;</span>&nbsp;<span class="ident" id="4197146">k</span><span class="op" id="4197147">-</span><span class="num" id="4197148">2</span><span class="op" id="4197149">*</span><span class="ident" id="4197150">hash</span><span class="op" id="4197154">.</span><span class="ident" id="4197155">Size</span><span class="op" id="4197159">(</span><span class="op" id="4197160">)</span><span class="op" id="4197161">-</span><span class="num" id="4197162">2</span>&nbsp;<span class="op" id="4197164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197168">err</span>&nbsp;<span class="op" id="4197172">=</span>&nbsp;<span class="ident" id="4197174">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197194">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197206">hash</span><span class="op" id="4197210">.</span><span class="ident" id="4197211">Write</span><span class="op" id="4197216">(</span><span class="ident" id="4197217">label</span><span class="op" id="4197222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197225">lHash</span>&nbsp;<span class="op" id="4197231">:=</span>&nbsp;<span class="ident" id="4197234">hash</span><span class="op" id="4197238">.</span><span class="ident" id="4197239">Sum</span><span class="op" id="4197242">(</span><span class="ident" id="4197243">nil</span><span class="op" id="4197246">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197249">hash</span><span class="op" id="4197253">.</span><span class="ident" id="4197254">Reset</span><span class="op" id="4197259">(</span><span class="op" id="4197260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197264">em</span>&nbsp;<span class="op" id="4197267">:=</span>&nbsp;<span class="builtinfunc" id="4197270">make</span><span class="op" id="4197274">(</span><span class="op" id="4197275">[</span><span class="op" id="4197276">]</span><span class="builtintype" id="4197277">byte</span><span class="op" id="4197281">,</span>&nbsp;<span class="ident" id="4197283">k</span><span class="op" id="4197284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197287">seed</span>&nbsp;<span class="op" id="4197292">:=</span>&nbsp;<span class="ident" id="4197295">em</span><span class="op" id="4197297">[</span><span class="num" id="4197298">1</span>&nbsp;<span class="op" id="4197300">:</span>&nbsp;<span class="num" id="4197302">1</span><span class="op" id="4197303">+</span><span class="ident" id="4197304">hash</span><span class="op" id="4197308">.</span><span class="ident" id="4197309">Size</span><span class="op" id="4197313">(</span><span class="op" id="4197314">)</span><span class="op" id="4197315">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197318">db</span>&nbsp;<span class="op" id="4197321">:=</span>&nbsp;<span class="ident" id="4197324">em</span><span class="op" id="4197326">[</span><span class="num" id="4197327">1</span><span class="op" id="4197328">+</span><span class="ident" id="4197329">hash</span><span class="op" id="4197333">.</span><span class="ident" id="4197334">Size</span><span class="op" id="4197338">(</span><span class="op" id="4197339">)</span><span class="op" id="4197340">:</span><span class="op" id="4197341">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4197345">copy</span><span class="op" id="4197349">(</span><span class="ident" id="4197350">db</span><span class="op" id="4197352">[</span><span class="num" id="4197353">0</span><span class="op" id="4197354">:</span><span class="ident" id="4197355">hash</span><span class="op" id="4197359">.</span><span class="ident" id="4197360">Size</span><span class="op" id="4197364">(</span><span class="op" id="4197365">)</span><span class="op" id="4197366">]</span><span class="op" id="4197367">,</span>&nbsp;<span class="ident" id="4197369">lHash</span><span class="op" id="4197374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197377">db</span><span class="op" id="4197379">[</span><span class="builtinfunc" id="4197380">len</span><span class="op" id="4197383">(</span><span class="ident" id="4197384">db</span><span class="op" id="4197386">)</span><span class="op" id="4197387">-</span><span class="builtinfunc" id="4197388">len</span><span class="op" id="4197391">(</span><span class="ident" id="4197392">msg</span><span class="op" id="4197395">)</span><span class="op" id="4197396">-</span><span class="num" id="4197397">1</span><span class="op" id="4197398">]</span>&nbsp;<span class="op" id="4197400">=</span>&nbsp;<span class="num" id="4197402">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4197405">copy</span><span class="op" id="4197409">(</span><span class="ident" id="4197410">db</span><span class="op" id="4197412">[</span><span class="builtinfunc" id="4197413">len</span><span class="op" id="4197416">(</span><span class="ident" id="4197417">db</span><span class="op" id="4197419">)</span><span class="op" id="4197420">-</span><span class="builtinfunc" id="4197421">len</span><span class="op" id="4197424">(</span><span class="ident" id="4197425">msg</span><span class="op" id="4197428">)</span><span class="op" id="4197429">:</span><span class="op" id="4197430">]</span><span class="op" id="4197431">,</span>&nbsp;<span class="ident" id="4197433">msg</span><span class="op" id="4197436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197440">_</span><span class="op" id="4197441">,</span>&nbsp;<span class="ident" id="4197443">err</span>&nbsp;<span class="op" id="4197447">=</span>&nbsp;<span class="ident" id="4197449">io</span><span class="op" id="4197451">.</span><span class="ident" id="4197452">ReadFull</span><span class="op" id="4197460">(</span><span class="ident" id="4197461">random</span><span class="op" id="4197467">,</span>&nbsp;<span class="ident" id="4197469">seed</span><span class="op" id="4197473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197476">if</span>&nbsp;<span class="ident" id="4197479">err</span>&nbsp;<span class="op" id="4197483">!=</span>&nbsp;<span class="ident" id="4197486">nil</span>&nbsp;<span class="op" id="4197490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197494">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197506">mgf1XOR</span><span class="op" id="4197513">(</span><span class="ident" id="4197514">db</span><span class="op" id="4197516">,</span>&nbsp;<span class="ident" id="4197518">hash</span><span class="op" id="4197522">,</span>&nbsp;<span class="ident" id="4197524">seed</span><span class="op" id="4197528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197531">mgf1XOR</span><span class="op" id="4197538">(</span><span class="ident" id="4197539">seed</span><span class="op" id="4197543">,</span>&nbsp;<span class="ident" id="4197545">hash</span><span class="op" id="4197549">,</span>&nbsp;<span class="ident" id="4197551">db</span><span class="op" id="4197553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197557">m</span>&nbsp;<span class="op" id="4197559">:=</span>&nbsp;<span class="builtinfunc" id="4197562">new</span><span class="op" id="4197565">(</span><span class="ident" id="4197566">big</span><span class="op" id="4197569">.</span><span class="ident" id="4197570">Int</span><span class="op" id="4197573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197576">m</span><span class="op" id="4197577">.</span><span class="ident" id="4197578">SetBytes</span><span class="op" id="4197586">(</span><span class="ident" id="4197587">em</span><span class="op" id="4197589">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197592">c</span>&nbsp;<span class="op" id="4197594">:=</span>&nbsp;<span class="ident" id="4197597">encrypt</span><span class="op" id="4197604">(</span><span class="builtinfunc" id="4197605">new</span><span class="op" id="4197608">(</span><span class="ident" id="4197609">big</span><span class="op" id="4197612">.</span><span class="ident" id="4197613">Int</span><span class="op" id="4197616">)</span><span class="op" id="4197617">,</span>&nbsp;<span class="ident" id="4197619">pub</span><span class="op" id="4197622">,</span>&nbsp;<span class="ident" id="4197624">m</span><span class="op" id="4197625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197628">out</span>&nbsp;<span class="op" id="4197632">=</span>&nbsp;<span class="ident" id="4197634">c</span><span class="op" id="4197635">.</span><span class="ident" id="4197636">Bytes</span><span class="op" id="4197641">(</span><span class="op" id="4197642">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197646">if</span>&nbsp;<span class="builtinfunc" id="4197649">len</span><span class="op" id="4197652">(</span><span class="ident" id="4197653">out</span><span class="op" id="4197656">)</span>&nbsp;<span class="op" id="4197658">&lt;</span>&nbsp;<span class="ident" id="4197660">k</span>&nbsp;<span class="op" id="4197662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4197666">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197731">t</span>&nbsp;<span class="op" id="4197733">:=</span>&nbsp;<span class="builtinfunc" id="4197736">make</span><span class="op" id="4197740">(</span><span class="op" id="4197741">[</span><span class="op" id="4197742">]</span><span class="builtintype" id="4197743">byte</span><span class="op" id="4197747">,</span>&nbsp;<span class="ident" id="4197749">k</span><span class="op" id="4197750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4197754">copy</span><span class="op" id="4197758">(</span><span class="ident" id="4197759">t</span><span class="op" id="4197760">[</span><span class="ident" id="4197761">k</span><span class="op" id="4197762">-</span><span class="builtinfunc" id="4197763">len</span><span class="op" id="4197766">(</span><span class="ident" id="4197767">out</span><span class="op" id="4197770">)</span><span class="op" id="4197771">:</span><span class="op" id="4197772">]</span><span class="op" id="4197773">,</span>&nbsp;<span class="ident" id="4197775">out</span><span class="op" id="4197778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4197782">out</span>&nbsp;<span class="op" id="4197786">=</span>&nbsp;<span class="ident" id="4197788">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4197791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4197795">return</span><br>
<span class="lineno"></span><span class="op" id="4197802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4197805">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="4197865">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="4197920">var</span>&nbsp;<span class="ident" id="4197924">ErrDecryption</span>&nbsp;<span class="op" id="4197938">=</span>&nbsp;<span class="ident" id="4197940">errors</span><span class="op" id="4197946">.</span><span class="ident" id="4197947">New</span><span class="op" id="4197950">(</span><span class="string" id="4197951">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="4197981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4197984">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4198047">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4198102">var</span>&nbsp;<span class="ident" id="4198106">ErrVerification</span>&nbsp;<span class="op" id="4198122">=</span>&nbsp;<span class="ident" id="4198124">errors</span><span class="op" id="4198130">.</span><span class="ident" id="4198131">New</span><span class="op" id="4198134">(</span><span class="string" id="4198135">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="4198167">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="4198170">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="4198250">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="4198326">func</span>&nbsp;<span class="ident" id="4198331">modInverse</span><span class="op" id="4198341">(</span><span class="ident" id="4198342">a</span><span class="op" id="4198343">,</span>&nbsp;<span class="ident" id="4198345">n</span>&nbsp;<span class="op" id="4198347">*</span><span class="ident" id="4198348">big</span><span class="op" id="4198351">.</span><span class="ident" id="4198352">Int</span><span class="op" id="4198355">)</span>&nbsp;<span class="op" id="4198357">(</span><span class="ident" id="4198358">ia</span>&nbsp;<span class="op" id="4198361">*</span><span class="ident" id="4198362">big</span><span class="op" id="4198365">.</span><span class="ident" id="4198366">Int</span><span class="op" id="4198369">,</span>&nbsp;<span class="ident" id="4198371">ok</span>&nbsp;<span class="builtintype" id="4198374">bool</span><span class="op" id="4198378">)</span>&nbsp;<span class="op" id="4198380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198383">g</span>&nbsp;<span class="op" id="4198385">:=</span>&nbsp;<span class="builtinfunc" id="4198388">new</span><span class="op" id="4198391">(</span><span class="ident" id="4198392">big</span><span class="op" id="4198395">.</span><span class="ident" id="4198396">Int</span><span class="op" id="4198399">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198402">x</span>&nbsp;<span class="op" id="4198404">:=</span>&nbsp;<span class="builtinfunc" id="4198407">new</span><span class="op" id="4198410">(</span><span class="ident" id="4198411">big</span><span class="op" id="4198414">.</span><span class="ident" id="4198415">Int</span><span class="op" id="4198418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198421">y</span>&nbsp;<span class="op" id="4198423">:=</span>&nbsp;<span class="builtinfunc" id="4198426">new</span><span class="op" id="4198429">(</span><span class="ident" id="4198430">big</span><span class="op" id="4198433">.</span><span class="ident" id="4198434">Int</span><span class="op" id="4198437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198440">g</span><span class="op" id="4198441">.</span><span class="ident" id="4198442">GCD</span><span class="op" id="4198445">(</span><span class="ident" id="4198446">x</span><span class="op" id="4198447">,</span>&nbsp;<span class="ident" id="4198449">y</span><span class="op" id="4198450">,</span>&nbsp;<span class="ident" id="4198452">a</span><span class="op" id="4198453">,</span>&nbsp;<span class="ident" id="4198455">n</span><span class="op" id="4198456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198459">if</span>&nbsp;<span class="ident" id="4198462">g</span><span class="op" id="4198463">.</span><span class="ident" id="4198464">Cmp</span><span class="op" id="4198467">(</span><span class="ident" id="4198468">bigOne</span><span class="op" id="4198474">)</span>&nbsp;<span class="op" id="4198476">!=</span>&nbsp;<span class="num" id="4198479">0</span>&nbsp;<span class="op" id="4198481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4198485">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4198551">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4198617">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4198680">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198692">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4198700">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198704">if</span>&nbsp;<span class="ident" id="4198707">x</span><span class="op" id="4198708">.</span><span class="ident" id="4198709">Cmp</span><span class="op" id="4198712">(</span><span class="ident" id="4198713">bigOne</span><span class="op" id="4198719">)</span>&nbsp;<span class="op" id="4198721">&lt;</span>&nbsp;<span class="num" id="4198723">0</span>&nbsp;<span class="op" id="4198725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4198729">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4198794">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198824">x</span><span class="op" id="4198825">.</span><span class="ident" id="4198826">Add</span><span class="op" id="4198829">(</span><span class="ident" id="4198830">x</span><span class="op" id="4198831">,</span>&nbsp;<span class="ident" id="4198833">n</span><span class="op" id="4198834">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4198837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198841">return</span>&nbsp;<span class="ident" id="4198848">x</span><span class="op" id="4198849">,</span>&nbsp;<span class="ident" id="4198851">true</span><br>
<span class="lineno"></span><span class="op" id="4198856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4198859">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="4198937">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="4198955">func</span>&nbsp;<span class="op" id="4198960">(</span><span class="ident" id="4198961">priv</span>&nbsp;<span class="op" id="4198966">*</span><span class="ident" id="4198967">PrivateKey</span><span class="op" id="4198977">)</span>&nbsp;<span class="ident" id="4198979">Precompute</span><span class="op" id="4198989">(</span><span class="op" id="4198990">)</span>&nbsp;<span class="op" id="4198992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198995">if</span>&nbsp;<span class="ident" id="4198998">priv</span><span class="op" id="4199002">.</span><span class="ident" id="4199003">Precomputed</span><span class="op" id="4199014">.</span><span class="ident" id="4199015">Dp</span>&nbsp;<span class="op" id="4199018">!=</span>&nbsp;<span class="ident" id="4199021">nil</span>&nbsp;<span class="op" id="4199025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199029">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4199037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199041">priv</span><span class="op" id="4199045">.</span><span class="ident" id="4199046">Precomputed</span><span class="op" id="4199057">.</span><span class="ident" id="4199058">Dp</span>&nbsp;<span class="op" id="4199061">=</span>&nbsp;<span class="builtinfunc" id="4199063">new</span><span class="op" id="4199066">(</span><span class="ident" id="4199067">big</span><span class="op" id="4199070">.</span><span class="ident" id="4199071">Int</span><span class="op" id="4199074">)</span><span class="op" id="4199075">.</span><span class="ident" id="4199076">Sub</span><span class="op" id="4199079">(</span><span class="ident" id="4199080">priv</span><span class="op" id="4199084">.</span><span class="ident" id="4199085">Primes</span><span class="op" id="4199091">[</span><span class="num" id="4199092">0</span><span class="op" id="4199093">]</span><span class="op" id="4199094">,</span>&nbsp;<span class="ident" id="4199096">bigOne</span><span class="op" id="4199102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199105">priv</span><span class="op" id="4199109">.</span><span class="ident" id="4199110">Precomputed</span><span class="op" id="4199121">.</span><span class="ident" id="4199122">Dp</span><span class="op" id="4199124">.</span><span class="ident" id="4199125">Mod</span><span class="op" id="4199128">(</span><span class="ident" id="4199129">priv</span><span class="op" id="4199133">.</span><span class="ident" id="4199134">D</span><span class="op" id="4199135">,</span>&nbsp;<span class="ident" id="4199137">priv</span><span class="op" id="4199141">.</span><span class="ident" id="4199142">Precomputed</span><span class="op" id="4199153">.</span><span class="ident" id="4199154">Dp</span><span class="op" id="4199156">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199160">priv</span><span class="op" id="4199164">.</span><span class="ident" id="4199165">Precomputed</span><span class="op" id="4199176">.</span><span class="ident" id="4199177">Dq</span>&nbsp;<span class="op" id="4199180">=</span>&nbsp;<span class="builtinfunc" id="4199182">new</span><span class="op" id="4199185">(</span><span class="ident" id="4199186">big</span><span class="op" id="4199189">.</span><span class="ident" id="4199190">Int</span><span class="op" id="4199193">)</span><span class="op" id="4199194">.</span><span class="ident" id="4199195">Sub</span><span class="op" id="4199198">(</span><span class="ident" id="4199199">priv</span><span class="op" id="4199203">.</span><span class="ident" id="4199204">Primes</span><span class="op" id="4199210">[</span><span class="num" id="4199211">1</span><span class="op" id="4199212">]</span><span class="op" id="4199213">,</span>&nbsp;<span class="ident" id="4199215">bigOne</span><span class="op" id="4199221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199224">priv</span><span class="op" id="4199228">.</span><span class="ident" id="4199229">Precomputed</span><span class="op" id="4199240">.</span><span class="ident" id="4199241">Dq</span><span class="op" id="4199243">.</span><span class="ident" id="4199244">Mod</span><span class="op" id="4199247">(</span><span class="ident" id="4199248">priv</span><span class="op" id="4199252">.</span><span class="ident" id="4199253">D</span><span class="op" id="4199254">,</span>&nbsp;<span class="ident" id="4199256">priv</span><span class="op" id="4199260">.</span><span class="ident" id="4199261">Precomputed</span><span class="op" id="4199272">.</span><span class="ident" id="4199273">Dq</span><span class="op" id="4199275">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199279">priv</span><span class="op" id="4199283">.</span><span class="ident" id="4199284">Precomputed</span><span class="op" id="4199295">.</span><span class="ident" id="4199296">Qinv</span>&nbsp;<span class="op" id="4199301">=</span>&nbsp;<span class="builtinfunc" id="4199303">new</span><span class="op" id="4199306">(</span><span class="ident" id="4199307">big</span><span class="op" id="4199310">.</span><span class="ident" id="4199311">Int</span><span class="op" id="4199314">)</span><span class="op" id="4199315">.</span><span class="ident" id="4199316">ModInverse</span><span class="op" id="4199326">(</span><span class="ident" id="4199327">priv</span><span class="op" id="4199331">.</span><span class="ident" id="4199332">Primes</span><span class="op" id="4199338">[</span><span class="num" id="4199339">1</span><span class="op" id="4199340">]</span><span class="op" id="4199341">,</span>&nbsp;<span class="ident" id="4199343">priv</span><span class="op" id="4199347">.</span><span class="ident" id="4199348">Primes</span><span class="op" id="4199354">[</span><span class="num" id="4199355">0</span><span class="op" id="4199356">]</span><span class="op" id="4199357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199361">r</span>&nbsp;<span class="op" id="4199363">:=</span>&nbsp;<span class="builtinfunc" id="4199366">new</span><span class="op" id="4199369">(</span><span class="ident" id="4199370">big</span><span class="op" id="4199373">.</span><span class="ident" id="4199374">Int</span><span class="op" id="4199377">)</span><span class="op" id="4199378">.</span><span class="ident" id="4199379">Mul</span><span class="op" id="4199382">(</span><span class="ident" id="4199383">priv</span><span class="op" id="4199387">.</span><span class="ident" id="4199388">Primes</span><span class="op" id="4199394">[</span><span class="num" id="4199395">0</span><span class="op" id="4199396">]</span><span class="op" id="4199397">,</span>&nbsp;<span class="ident" id="4199399">priv</span><span class="op" id="4199403">.</span><span class="ident" id="4199404">Primes</span><span class="op" id="4199410">[</span><span class="num" id="4199411">1</span><span class="op" id="4199412">]</span><span class="op" id="4199413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199416">priv</span><span class="op" id="4199420">.</span><span class="ident" id="4199421">Precomputed</span><span class="op" id="4199432">.</span><span class="ident" id="4199433">CRTValues</span>&nbsp;<span class="op" id="4199443">=</span>&nbsp;<span class="builtinfunc" id="4199445">make</span><span class="op" id="4199449">(</span><span class="op" id="4199450">[</span><span class="op" id="4199451">]</span><span class="ident" id="4199452">CRTValue</span><span class="op" id="4199460">,</span>&nbsp;<span class="builtinfunc" id="4199462">len</span><span class="op" id="4199465">(</span><span class="ident" id="4199466">priv</span><span class="op" id="4199470">.</span><span class="ident" id="4199471">Primes</span><span class="op" id="4199477">)</span><span class="op" id="4199478">-</span><span class="num" id="4199479">2</span><span class="op" id="4199480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199483">for</span>&nbsp;<span class="ident" id="4199487">i</span>&nbsp;<span class="op" id="4199489">:=</span>&nbsp;<span class="num" id="4199492">2</span><span class="op" id="4199493">;</span>&nbsp;<span class="ident" id="4199495">i</span>&nbsp;<span class="op" id="4199497">&lt;</span>&nbsp;<span class="builtinfunc" id="4199499">len</span><span class="op" id="4199502">(</span><span class="ident" id="4199503">priv</span><span class="op" id="4199507">.</span><span class="ident" id="4199508">Primes</span><span class="op" id="4199514">)</span><span class="op" id="4199515">;</span>&nbsp;<span class="ident" id="4199517">i</span><span class="op" id="4199518">++</span>&nbsp;<span class="op" id="4199521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199525">prime</span>&nbsp;<span class="op" id="4199531">:=</span>&nbsp;<span class="ident" id="4199534">priv</span><span class="op" id="4199538">.</span><span class="ident" id="4199539">Primes</span><span class="op" id="4199545">[</span><span class="ident" id="4199546">i</span><span class="op" id="4199547">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199551">values</span>&nbsp;<span class="op" id="4199558">:=</span>&nbsp;<span class="op" id="4199561">&amp;</span><span class="ident" id="4199562">priv</span><span class="op" id="4199566">.</span><span class="ident" id="4199567">Precomputed</span><span class="op" id="4199578">.</span><span class="ident" id="4199579">CRTValues</span><span class="op" id="4199588">[</span><span class="ident" id="4199589">i</span><span class="op" id="4199590">-</span><span class="num" id="4199591">2</span><span class="op" id="4199592">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199597">values</span><span class="op" id="4199603">.</span><span class="ident" id="4199604">Exp</span>&nbsp;<span class="op" id="4199608">=</span>&nbsp;<span class="builtinfunc" id="4199610">new</span><span class="op" id="4199613">(</span><span class="ident" id="4199614">big</span><span class="op" id="4199617">.</span><span class="ident" id="4199618">Int</span><span class="op" id="4199621">)</span><span class="op" id="4199622">.</span><span class="ident" id="4199623">Sub</span><span class="op" id="4199626">(</span><span class="ident" id="4199627">prime</span><span class="op" id="4199632">,</span>&nbsp;<span class="ident" id="4199634">bigOne</span><span class="op" id="4199640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199644">values</span><span class="op" id="4199650">.</span><span class="ident" id="4199651">Exp</span><span class="op" id="4199654">.</span><span class="ident" id="4199655">Mod</span><span class="op" id="4199658">(</span><span class="ident" id="4199659">priv</span><span class="op" id="4199663">.</span><span class="ident" id="4199664">D</span><span class="op" id="4199665">,</span>&nbsp;<span class="ident" id="4199667">values</span><span class="op" id="4199673">.</span><span class="ident" id="4199674">Exp</span><span class="op" id="4199677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199682">values</span><span class="op" id="4199688">.</span><span class="ident" id="4199689">R</span>&nbsp;<span class="op" id="4199691">=</span>&nbsp;<span class="builtinfunc" id="4199693">new</span><span class="op" id="4199696">(</span><span class="ident" id="4199697">big</span><span class="op" id="4199700">.</span><span class="ident" id="4199701">Int</span><span class="op" id="4199704">)</span><span class="op" id="4199705">.</span><span class="ident" id="4199706">Set</span><span class="op" id="4199709">(</span><span class="ident" id="4199710">r</span><span class="op" id="4199711">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199715">values</span><span class="op" id="4199721">.</span><span class="ident" id="4199722">Coeff</span>&nbsp;<span class="op" id="4199728">=</span>&nbsp;<span class="builtinfunc" id="4199730">new</span><span class="op" id="4199733">(</span><span class="ident" id="4199734">big</span><span class="op" id="4199737">.</span><span class="ident" id="4199738">Int</span><span class="op" id="4199741">)</span><span class="op" id="4199742">.</span><span class="ident" id="4199743">ModInverse</span><span class="op" id="4199753">(</span><span class="ident" id="4199754">r</span><span class="op" id="4199755">,</span>&nbsp;<span class="ident" id="4199757">prime</span><span class="op" id="4199762">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199767">r</span><span class="op" id="4199768">.</span><span class="ident" id="4199769">Mul</span><span class="op" id="4199772">(</span><span class="ident" id="4199773">r</span><span class="op" id="4199774">,</span>&nbsp;<span class="ident" id="4199776">prime</span><span class="op" id="4199781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4199784">}</span><br>
<span class="lineno"></span><span class="op" id="4199786">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="4199789">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4199867">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4199916">func</span>&nbsp;<span class="ident" id="4199921">decrypt</span><span class="op" id="4199928">(</span><span class="ident" id="4199929">random</span>&nbsp;<span class="ident" id="4199936">io</span><span class="op" id="4199938">.</span><span class="ident" id="4199939">Reader</span><span class="op" id="4199945">,</span>&nbsp;<span class="ident" id="4199947">priv</span>&nbsp;<span class="op" id="4199952">*</span><span class="ident" id="4199953">PrivateKey</span><span class="op" id="4199963">,</span>&nbsp;<span class="ident" id="4199965">c</span>&nbsp;<span class="op" id="4199967">*</span><span class="ident" id="4199968">big</span><span class="op" id="4199971">.</span><span class="ident" id="4199972">Int</span><span class="op" id="4199975">)</span>&nbsp;<span class="op" id="4199977">(</span><span class="ident" id="4199978">m</span>&nbsp;<span class="op" id="4199980">*</span><span class="ident" id="4199981">big</span><span class="op" id="4199984">.</span><span class="ident" id="4199985">Int</span><span class="op" id="4199988">,</span>&nbsp;<span class="ident" id="4199990">err</span>&nbsp;<span class="builtintype" id="4199994">error</span><span class="op" id="4199999">)</span>&nbsp;<span class="op" id="4200001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200004">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200056">if</span>&nbsp;<span class="ident" id="4200059">c</span><span class="op" id="4200060">.</span><span class="ident" id="4200061">Cmp</span><span class="op" id="4200064">(</span><span class="ident" id="4200065">priv</span><span class="op" id="4200069">.</span><span class="ident" id="4200070">N</span><span class="op" id="4200071">)</span>&nbsp;<span class="op" id="4200073">&gt;</span>&nbsp;<span class="num" id="4200075">0</span>&nbsp;<span class="op" id="4200077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200081">err</span>&nbsp;<span class="op" id="4200085">=</span>&nbsp;<span class="ident" id="4200087">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200103">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200115">var</span>&nbsp;<span class="ident" id="4200119">ir</span>&nbsp;<span class="op" id="4200122">*</span><span class="ident" id="4200123">big</span><span class="op" id="4200126">.</span><span class="ident" id="4200127">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200132">if</span>&nbsp;<span class="ident" id="4200135">random</span>&nbsp;<span class="op" id="4200142">!=</span>&nbsp;<span class="ident" id="4200145">nil</span>&nbsp;<span class="op" id="4200149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200153">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200216">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200280">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200344">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200401">var</span>&nbsp;<span class="ident" id="4200405">r</span>&nbsp;<span class="op" id="4200407">*</span><span class="ident" id="4200408">big</span><span class="op" id="4200411">.</span><span class="ident" id="4200412">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200419">for</span>&nbsp;<span class="op" id="4200423">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200428">r</span><span class="op" id="4200429">,</span>&nbsp;<span class="ident" id="4200431">err</span>&nbsp;<span class="op" id="4200435">=</span>&nbsp;<span class="ident" id="4200437">rand</span><span class="op" id="4200441">.</span><span class="ident" id="4200442">Int</span><span class="op" id="4200445">(</span><span class="ident" id="4200446">random</span><span class="op" id="4200452">,</span>&nbsp;<span class="ident" id="4200454">priv</span><span class="op" id="4200458">.</span><span class="ident" id="4200459">N</span><span class="op" id="4200460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200465">if</span>&nbsp;<span class="ident" id="4200468">err</span>&nbsp;<span class="op" id="4200472">!=</span>&nbsp;<span class="ident" id="4200475">nil</span>&nbsp;<span class="op" id="4200479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200485">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200500">if</span>&nbsp;<span class="ident" id="4200503">r</span><span class="op" id="4200504">.</span><span class="ident" id="4200505">Cmp</span><span class="op" id="4200508">(</span><span class="ident" id="4200509">bigZero</span><span class="op" id="4200516">)</span>&nbsp;<span class="op" id="4200518">==</span>&nbsp;<span class="num" id="4200521">0</span>&nbsp;<span class="op" id="4200523">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200529">r</span>&nbsp;<span class="op" id="4200531">=</span>&nbsp;<span class="ident" id="4200533">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200548">var</span>&nbsp;<span class="ident" id="4200552">ok</span>&nbsp;<span class="builtintype" id="4200555">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200563">ir</span><span class="op" id="4200565">,</span>&nbsp;<span class="ident" id="4200567">ok</span>&nbsp;<span class="op" id="4200570">=</span>&nbsp;<span class="ident" id="4200572">modInverse</span><span class="op" id="4200582">(</span><span class="ident" id="4200583">r</span><span class="op" id="4200584">,</span>&nbsp;<span class="ident" id="4200586">priv</span><span class="op" id="4200590">.</span><span class="ident" id="4200591">N</span><span class="op" id="4200592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200597">if</span>&nbsp;<span class="ident" id="4200600">ok</span>&nbsp;<span class="op" id="4200603">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200609">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200626">bigE</span>&nbsp;<span class="op" id="4200631">:=</span>&nbsp;<span class="ident" id="4200634">big</span><span class="op" id="4200637">.</span><span class="ident" id="4200638">NewInt</span><span class="op" id="4200644">(</span><span class="ident" id="4200645">int64</span><span class="op" id="4200650">(</span><span class="ident" id="4200651">priv</span><span class="op" id="4200655">.</span><span class="ident" id="4200656">E</span><span class="op" id="4200657">)</span><span class="op" id="4200658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200662">rpowe</span>&nbsp;<span class="op" id="4200668">:=</span>&nbsp;<span class="builtinfunc" id="4200671">new</span><span class="op" id="4200674">(</span><span class="ident" id="4200675">big</span><span class="op" id="4200678">.</span><span class="ident" id="4200679">Int</span><span class="op" id="4200682">)</span><span class="op" id="4200683">.</span><span class="ident" id="4200684">Exp</span><span class="op" id="4200687">(</span><span class="ident" id="4200688">r</span><span class="op" id="4200689">,</span>&nbsp;<span class="ident" id="4200691">bigE</span><span class="op" id="4200695">,</span>&nbsp;<span class="ident" id="4200697">priv</span><span class="op" id="4200701">.</span><span class="ident" id="4200702">N</span><span class="op" id="4200703">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200707">cCopy</span>&nbsp;<span class="op" id="4200713">:=</span>&nbsp;<span class="builtinfunc" id="4200716">new</span><span class="op" id="4200719">(</span><span class="ident" id="4200720">big</span><span class="op" id="4200723">.</span><span class="ident" id="4200724">Int</span><span class="op" id="4200727">)</span><span class="op" id="4200728">.</span><span class="ident" id="4200729">Set</span><span class="op" id="4200732">(</span><span class="ident" id="4200733">c</span><span class="op" id="4200734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200738">cCopy</span><span class="op" id="4200743">.</span><span class="ident" id="4200744">Mul</span><span class="op" id="4200747">(</span><span class="ident" id="4200748">cCopy</span><span class="op" id="4200753">,</span>&nbsp;<span class="ident" id="4200755">rpowe</span><span class="op" id="4200760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200764">cCopy</span><span class="op" id="4200769">.</span><span class="ident" id="4200770">Mod</span><span class="op" id="4200773">(</span><span class="ident" id="4200774">cCopy</span><span class="op" id="4200779">,</span>&nbsp;<span class="ident" id="4200781">priv</span><span class="op" id="4200785">.</span><span class="ident" id="4200786">N</span><span class="op" id="4200787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200791">c</span>&nbsp;<span class="op" id="4200793">=</span>&nbsp;<span class="ident" id="4200795">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200802">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200806">if</span>&nbsp;<span class="ident" id="4200809">priv</span><span class="op" id="4200813">.</span><span class="ident" id="4200814">Precomputed</span><span class="op" id="4200825">.</span><span class="ident" id="4200826">Dp</span>&nbsp;<span class="op" id="4200829">==</span>&nbsp;<span class="ident" id="4200832">nil</span>&nbsp;<span class="op" id="4200836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200840">m</span>&nbsp;<span class="op" id="4200842">=</span>&nbsp;<span class="builtinfunc" id="4200844">new</span><span class="op" id="4200847">(</span><span class="ident" id="4200848">big</span><span class="op" id="4200851">.</span><span class="ident" id="4200852">Int</span><span class="op" id="4200855">)</span><span class="op" id="4200856">.</span><span class="ident" id="4200857">Exp</span><span class="op" id="4200860">(</span><span class="ident" id="4200861">c</span><span class="op" id="4200862">,</span>&nbsp;<span class="ident" id="4200864">priv</span><span class="op" id="4200868">.</span><span class="ident" id="4200869">D</span><span class="op" id="4200870">,</span>&nbsp;<span class="ident" id="4200872">priv</span><span class="op" id="4200876">.</span><span class="ident" id="4200877">N</span><span class="op" id="4200878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200881">}</span>&nbsp;<span class="keyword" id="4200883">else</span>&nbsp;<span class="op" id="4200888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200892">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200950">m</span>&nbsp;<span class="op" id="4200952">=</span>&nbsp;<span class="builtinfunc" id="4200954">new</span><span class="op" id="4200957">(</span><span class="ident" id="4200958">big</span><span class="op" id="4200961">.</span><span class="ident" id="4200962">Int</span><span class="op" id="4200965">)</span><span class="op" id="4200966">.</span><span class="ident" id="4200967">Exp</span><span class="op" id="4200970">(</span><span class="ident" id="4200971">c</span><span class="op" id="4200972">,</span>&nbsp;<span class="ident" id="4200974">priv</span><span class="op" id="4200978">.</span><span class="ident" id="4200979">Precomputed</span><span class="op" id="4200990">.</span><span class="ident" id="4200991">Dp</span><span class="op" id="4200993">,</span>&nbsp;<span class="ident" id="4200995">priv</span><span class="op" id="4200999">.</span><span class="ident" id="4201000">Primes</span><span class="op" id="4201006">[</span><span class="num" id="4201007">0</span><span class="op" id="4201008">]</span><span class="op" id="4201009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201013">m2</span>&nbsp;<span class="op" id="4201016">:=</span>&nbsp;<span class="builtinfunc" id="4201019">new</span><span class="op" id="4201022">(</span><span class="ident" id="4201023">big</span><span class="op" id="4201026">.</span><span class="ident" id="4201027">Int</span><span class="op" id="4201030">)</span><span class="op" id="4201031">.</span><span class="ident" id="4201032">Exp</span><span class="op" id="4201035">(</span><span class="ident" id="4201036">c</span><span class="op" id="4201037">,</span>&nbsp;<span class="ident" id="4201039">priv</span><span class="op" id="4201043">.</span><span class="ident" id="4201044">Precomputed</span><span class="op" id="4201055">.</span><span class="ident" id="4201056">Dq</span><span class="op" id="4201058">,</span>&nbsp;<span class="ident" id="4201060">priv</span><span class="op" id="4201064">.</span><span class="ident" id="4201065">Primes</span><span class="op" id="4201071">[</span><span class="num" id="4201072">1</span><span class="op" id="4201073">]</span><span class="op" id="4201074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201078">m</span><span class="op" id="4201079">.</span><span class="ident" id="4201080">Sub</span><span class="op" id="4201083">(</span><span class="ident" id="4201084">m</span><span class="op" id="4201085">,</span>&nbsp;<span class="ident" id="4201087">m2</span><span class="op" id="4201089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201093">if</span>&nbsp;<span class="ident" id="4201096">m</span><span class="op" id="4201097">.</span><span class="ident" id="4201098">Sign</span><span class="op" id="4201102">(</span><span class="op" id="4201103">)</span>&nbsp;<span class="op" id="4201105">&lt;</span>&nbsp;<span class="num" id="4201107">0</span>&nbsp;<span class="op" id="4201109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201114">m</span><span class="op" id="4201115">.</span><span class="ident" id="4201116">Add</span><span class="op" id="4201119">(</span><span class="ident" id="4201120">m</span><span class="op" id="4201121">,</span>&nbsp;<span class="ident" id="4201123">priv</span><span class="op" id="4201127">.</span><span class="ident" id="4201128">Primes</span><span class="op" id="4201134">[</span><span class="num" id="4201135">0</span><span class="op" id="4201136">]</span><span class="op" id="4201137">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201145">m</span><span class="op" id="4201146">.</span><span class="ident" id="4201147">Mul</span><span class="op" id="4201150">(</span><span class="ident" id="4201151">m</span><span class="op" id="4201152">,</span>&nbsp;<span class="ident" id="4201154">priv</span><span class="op" id="4201158">.</span><span class="ident" id="4201159">Precomputed</span><span class="op" id="4201170">.</span><span class="ident" id="4201171">Qinv</span><span class="op" id="4201175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201179">m</span><span class="op" id="4201180">.</span><span class="ident" id="4201181">Mod</span><span class="op" id="4201184">(</span><span class="ident" id="4201185">m</span><span class="op" id="4201186">,</span>&nbsp;<span class="ident" id="4201188">priv</span><span class="op" id="4201192">.</span><span class="ident" id="4201193">Primes</span><span class="op" id="4201199">[</span><span class="num" id="4201200">0</span><span class="op" id="4201201">]</span><span class="op" id="4201202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201206">m</span><span class="op" id="4201207">.</span><span class="ident" id="4201208">Mul</span><span class="op" id="4201211">(</span><span class="ident" id="4201212">m</span><span class="op" id="4201213">,</span>&nbsp;<span class="ident" id="4201215">priv</span><span class="op" id="4201219">.</span><span class="ident" id="4201220">Primes</span><span class="op" id="4201226">[</span><span class="num" id="4201227">1</span><span class="op" id="4201228">]</span><span class="op" id="4201229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201233">m</span><span class="op" id="4201234">.</span><span class="ident" id="4201235">Add</span><span class="op" id="4201238">(</span><span class="ident" id="4201239">m</span><span class="op" id="4201240">,</span>&nbsp;<span class="ident" id="4201242">m2</span><span class="op" id="4201244">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201249">for</span>&nbsp;<span class="ident" id="4201253">i</span><span class="op" id="4201254">,</span>&nbsp;<span class="ident" id="4201256">values</span>&nbsp;<span class="op" id="4201263">:=</span>&nbsp;<span class="keyword" id="4201266">range</span>&nbsp;<span class="ident" id="4201272">priv</span><span class="op" id="4201276">.</span><span class="ident" id="4201277">Precomputed</span><span class="op" id="4201288">.</span><span class="ident" id="4201289">CRTValues</span>&nbsp;<span class="op" id="4201299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201304">prime</span>&nbsp;<span class="op" id="4201310">:=</span>&nbsp;<span class="ident" id="4201313">priv</span><span class="op" id="4201317">.</span><span class="ident" id="4201318">Primes</span><span class="op" id="4201324">[</span><span class="num" id="4201325">2</span><span class="op" id="4201326">+</span><span class="ident" id="4201327">i</span><span class="op" id="4201328">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201333">m2</span><span class="op" id="4201335">.</span><span class="ident" id="4201336">Exp</span><span class="op" id="4201339">(</span><span class="ident" id="4201340">c</span><span class="op" id="4201341">,</span>&nbsp;<span class="ident" id="4201343">values</span><span class="op" id="4201349">.</span><span class="ident" id="4201350">Exp</span><span class="op" id="4201353">,</span>&nbsp;<span class="ident" id="4201355">prime</span><span class="op" id="4201360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201365">m2</span><span class="op" id="4201367">.</span><span class="ident" id="4201368">Sub</span><span class="op" id="4201371">(</span><span class="ident" id="4201372">m2</span><span class="op" id="4201374">,</span>&nbsp;<span class="ident" id="4201376">m</span><span class="op" id="4201377">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201382">m2</span><span class="op" id="4201384">.</span><span class="ident" id="4201385">Mul</span><span class="op" id="4201388">(</span><span class="ident" id="4201389">m2</span><span class="op" id="4201391">,</span>&nbsp;<span class="ident" id="4201393">values</span><span class="op" id="4201399">.</span><span class="ident" id="4201400">Coeff</span><span class="op" id="4201405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201410">m2</span><span class="op" id="4201412">.</span><span class="ident" id="4201413">Mod</span><span class="op" id="4201416">(</span><span class="ident" id="4201417">m2</span><span class="op" id="4201419">,</span>&nbsp;<span class="ident" id="4201421">prime</span><span class="op" id="4201426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201431">if</span>&nbsp;<span class="ident" id="4201434">m2</span><span class="op" id="4201436">.</span><span class="ident" id="4201437">Sign</span><span class="op" id="4201441">(</span><span class="op" id="4201442">)</span>&nbsp;<span class="op" id="4201444">&lt;</span>&nbsp;<span class="num" id="4201446">0</span>&nbsp;<span class="op" id="4201448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201454">m2</span><span class="op" id="4201456">.</span><span class="ident" id="4201457">Add</span><span class="op" id="4201460">(</span><span class="ident" id="4201461">m2</span><span class="op" id="4201463">,</span>&nbsp;<span class="ident" id="4201465">prime</span><span class="op" id="4201470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201475">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201480">m2</span><span class="op" id="4201482">.</span><span class="ident" id="4201483">Mul</span><span class="op" id="4201486">(</span><span class="ident" id="4201487">m2</span><span class="op" id="4201489">,</span>&nbsp;<span class="ident" id="4201491">values</span><span class="op" id="4201497">.</span><span class="ident" id="4201498">R</span><span class="op" id="4201499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201504">m</span><span class="op" id="4201505">.</span><span class="ident" id="4201506">Add</span><span class="op" id="4201509">(</span><span class="ident" id="4201510">m</span><span class="op" id="4201511">,</span>&nbsp;<span class="ident" id="4201513">m2</span><span class="op" id="4201515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201526">if</span>&nbsp;<span class="ident" id="4201529">ir</span>&nbsp;<span class="op" id="4201532">!=</span>&nbsp;<span class="ident" id="4201535">nil</span>&nbsp;<span class="op" id="4201539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4201543">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201557">m</span><span class="op" id="4201558">.</span><span class="ident" id="4201559">Mul</span><span class="op" id="4201562">(</span><span class="ident" id="4201563">m</span><span class="op" id="4201564">,</span>&nbsp;<span class="ident" id="4201566">ir</span><span class="op" id="4201568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201572">m</span><span class="op" id="4201573">.</span><span class="ident" id="4201574">Mod</span><span class="op" id="4201577">(</span><span class="ident" id="4201578">m</span><span class="op" id="4201579">,</span>&nbsp;<span class="ident" id="4201581">priv</span><span class="op" id="4201585">.</span><span class="ident" id="4201586">N</span><span class="op" id="4201587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201590">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201594">return</span><br>
<span class="lineno"></span><span class="op" id="4201601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4201604">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="4201655">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4201744">func</span>&nbsp;<span class="ident" id="4201749">DecryptOAEP</span><span class="op" id="4201760">(</span><span class="ident" id="4201761">hash</span>&nbsp;<span class="ident" id="4201766">hash</span><span class="op" id="4201770">.</span><span class="ident" id="4201771">Hash</span><span class="op" id="4201775">,</span>&nbsp;<span class="ident" id="4201777">random</span>&nbsp;<span class="ident" id="4201784">io</span><span class="op" id="4201786">.</span><span class="ident" id="4201787">Reader</span><span class="op" id="4201793">,</span>&nbsp;<span class="ident" id="4201795">priv</span>&nbsp;<span class="op" id="4201800">*</span><span class="ident" id="4201801">PrivateKey</span><span class="op" id="4201811">,</span>&nbsp;<span class="ident" id="4201813">ciphertext</span>&nbsp;<span class="op" id="4201824">[</span><span class="op" id="4201825">]</span><span class="builtintype" id="4201826">byte</span><span class="op" id="4201830">,</span>&nbsp;<span class="ident" id="4201832">label</span>&nbsp;<span class="op" id="4201838">[</span><span class="op" id="4201839">]</span><span class="builtintype" id="4201840">byte</span><span class="op" id="4201844">)</span>&nbsp;<span class="op" id="4201846">(</span><span class="ident" id="4201847">msg</span>&nbsp;<span class="op" id="4201851">[</span><span class="op" id="4201852">]</span><span class="builtintype" id="4201853">byte</span><span class="op" id="4201857">,</span>&nbsp;<span class="ident" id="4201859">err</span>&nbsp;<span class="builtintype" id="4201863">error</span><span class="op" id="4201868">)</span>&nbsp;<span class="op" id="4201870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201873">if</span>&nbsp;<span class="ident" id="4201876">err</span>&nbsp;<span class="op" id="4201880">:=</span>&nbsp;<span class="ident" id="4201883">checkPub</span><span class="op" id="4201891">(</span><span class="op" id="4201892">&amp;</span><span class="ident" id="4201893">priv</span><span class="op" id="4201897">.</span><span class="ident" id="4201898">PublicKey</span><span class="op" id="4201907">)</span><span class="op" id="4201908">;</span>&nbsp;<span class="ident" id="4201910">err</span>&nbsp;<span class="op" id="4201914">!=</span>&nbsp;<span class="ident" id="4201917">nil</span>&nbsp;<span class="op" id="4201921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201925">return</span>&nbsp;<span class="ident" id="4201932">nil</span><span class="op" id="4201935">,</span>&nbsp;<span class="ident" id="4201937">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201942">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201945">k</span>&nbsp;<span class="op" id="4201947">:=</span>&nbsp;<span class="op" id="4201950">(</span><span class="ident" id="4201951">priv</span><span class="op" id="4201955">.</span><span class="ident" id="4201956">N</span><span class="op" id="4201957">.</span><span class="ident" id="4201958">BitLen</span><span class="op" id="4201964">(</span><span class="op" id="4201965">)</span>&nbsp;<span class="op" id="4201967">+</span>&nbsp;<span class="num" id="4201969">7</span><span class="op" id="4201970">)</span>&nbsp;<span class="op" id="4201972">/</span>&nbsp;<span class="num" id="4201974">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201977">if</span>&nbsp;<span class="builtinfunc" id="4201980">len</span><span class="op" id="4201983">(</span><span class="ident" id="4201984">ciphertext</span><span class="op" id="4201994">)</span>&nbsp;<span class="op" id="4201996">&gt;</span>&nbsp;<span class="ident" id="4201998">k</span>&nbsp;<span class="op" id="4202000">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202005">k</span>&nbsp;<span class="op" id="4202007">&lt;</span>&nbsp;<span class="ident" id="4202009">hash</span><span class="op" id="4202013">.</span><span class="ident" id="4202014">Size</span><span class="op" id="4202018">(</span><span class="op" id="4202019">)</span><span class="op" id="4202020">*</span><span class="num" id="4202021">2</span><span class="op" id="4202022">+</span><span class="num" id="4202023">2</span>&nbsp;<span class="op" id="4202025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202029">err</span>&nbsp;<span class="op" id="4202033">=</span>&nbsp;<span class="ident" id="4202035">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202051">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4202059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202063">c</span>&nbsp;<span class="op" id="4202065">:=</span>&nbsp;<span class="builtinfunc" id="4202068">new</span><span class="op" id="4202071">(</span><span class="ident" id="4202072">big</span><span class="op" id="4202075">.</span><span class="ident" id="4202076">Int</span><span class="op" id="4202079">)</span><span class="op" id="4202080">.</span><span class="ident" id="4202081">SetBytes</span><span class="op" id="4202089">(</span><span class="ident" id="4202090">ciphertext</span><span class="op" id="4202100">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202104">m</span><span class="op" id="4202105">,</span>&nbsp;<span class="ident" id="4202107">err</span>&nbsp;<span class="op" id="4202111">:=</span>&nbsp;<span class="ident" id="4202114">decrypt</span><span class="op" id="4202121">(</span><span class="ident" id="4202122">random</span><span class="op" id="4202128">,</span>&nbsp;<span class="ident" id="4202130">priv</span><span class="op" id="4202134">,</span>&nbsp;<span class="ident" id="4202136">c</span><span class="op" id="4202137">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202140">if</span>&nbsp;<span class="ident" id="4202143">err</span>&nbsp;<span class="op" id="4202147">!=</span>&nbsp;<span class="ident" id="4202150">nil</span>&nbsp;<span class="op" id="4202154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202158">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4202166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202170">hash</span><span class="op" id="4202174">.</span><span class="ident" id="4202175">Write</span><span class="op" id="4202180">(</span><span class="ident" id="4202181">label</span><span class="op" id="4202186">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202189">lHash</span>&nbsp;<span class="op" id="4202195">:=</span>&nbsp;<span class="ident" id="4202198">hash</span><span class="op" id="4202202">.</span><span class="ident" id="4202203">Sum</span><span class="op" id="4202206">(</span><span class="ident" id="4202207">nil</span><span class="op" id="4202210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202213">hash</span><span class="op" id="4202217">.</span><span class="ident" id="4202218">Reset</span><span class="op" id="4202223">(</span><span class="op" id="4202224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4202228">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4202288">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4202361">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4202430">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4202498">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202524">em</span>&nbsp;<span class="op" id="4202527">:=</span>&nbsp;<span class="ident" id="4202530">leftPad</span><span class="op" id="4202537">(</span><span class="ident" id="4202538">m</span><span class="op" id="4202539">.</span><span class="ident" id="4202540">Bytes</span><span class="op" id="4202545">(</span><span class="op" id="4202546">)</span><span class="op" id="4202547">,</span>&nbsp;<span class="ident" id="4202549">k</span><span class="op" id="4202550">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202554">firstByteIsZero</span>&nbsp;<span class="op" id="4202570">:=</span>&nbsp;<span class="ident" id="4202573">subtle</span><span class="op" id="4202579">.</span><span class="ident" id="4202580">ConstantTimeByteEq</span><span class="op" id="4202598">(</span><span class="ident" id="4202599">em</span><span class="op" id="4202601">[</span><span class="num" id="4202602">0</span><span class="op" id="4202603">]</span><span class="op" id="4202604">,</span>&nbsp;<span class="num" id="4202606">0</span><span class="op" id="4202607">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202611">seed</span>&nbsp;<span class="op" id="4202616">:=</span>&nbsp;<span class="ident" id="4202619">em</span><span class="op" id="4202621">[</span><span class="num" id="4202622">1</span>&nbsp;<span class="op" id="4202624">:</span>&nbsp;<span class="ident" id="4202626">hash</span><span class="op" id="4202630">.</span><span class="ident" id="4202631">Size</span><span class="op" id="4202635">(</span><span class="op" id="4202636">)</span><span class="op" id="4202637">+</span><span class="num" id="4202638">1</span><span class="op" id="4202639">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202642">db</span>&nbsp;<span class="op" id="4202645">:=</span>&nbsp;<span class="ident" id="4202648">em</span><span class="op" id="4202650">[</span><span class="ident" id="4202651">hash</span><span class="op" id="4202655">.</span><span class="ident" id="4202656">Size</span><span class="op" id="4202660">(</span><span class="op" id="4202661">)</span><span class="op" id="4202662">+</span><span class="num" id="4202663">1</span><span class="op" id="4202664">:</span><span class="op" id="4202665">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202669">mgf1XOR</span><span class="op" id="4202676">(</span><span class="ident" id="4202677">seed</span><span class="op" id="4202681">,</span>&nbsp;<span class="ident" id="4202683">hash</span><span class="op" id="4202687">,</span>&nbsp;<span class="ident" id="4202689">db</span><span class="op" id="4202691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202694">mgf1XOR</span><span class="op" id="4202701">(</span><span class="ident" id="4202702">db</span><span class="op" id="4202704">,</span>&nbsp;<span class="ident" id="4202706">hash</span><span class="op" id="4202710">,</span>&nbsp;<span class="ident" id="4202712">seed</span><span class="op" id="4202716">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202720">lHash2</span>&nbsp;<span class="op" id="4202727">:=</span>&nbsp;<span class="ident" id="4202730">db</span><span class="op" id="4202732">[</span><span class="num" id="4202733">0</span><span class="op" id="4202734">:</span><span class="ident" id="4202735">hash</span><span class="op" id="4202739">.</span><span class="ident" id="4202740">Size</span><span class="op" id="4202744">(</span><span class="op" id="4202745">)</span><span class="op" id="4202746">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4202750">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4202823">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4202894">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4202962">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203018">lHash2Good</span>&nbsp;<span class="op" id="4203029">:=</span>&nbsp;<span class="ident" id="4203032">subtle</span><span class="op" id="4203038">.</span><span class="ident" id="4203039">ConstantTimeCompare</span><span class="op" id="4203058">(</span><span class="ident" id="4203059">lHash</span><span class="op" id="4203064">,</span>&nbsp;<span class="ident" id="4203066">lHash2</span><span class="op" id="4203072">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4203076">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4203147">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4203185">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4203248">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4203295">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203356">var</span>&nbsp;<span class="ident" id="4203360">lookingForIndex</span><span class="op" id="4203375">,</span>&nbsp;<span class="ident" id="4203377">index</span><span class="op" id="4203382">,</span>&nbsp;<span class="ident" id="4203384">invalid</span>&nbsp;<span class="builtintype" id="4203392">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203397">lookingForIndex</span>&nbsp;<span class="op" id="4203413">=</span>&nbsp;<span class="num" id="4203415">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203418">rest</span>&nbsp;<span class="op" id="4203423">:=</span>&nbsp;<span class="ident" id="4203426">db</span><span class="op" id="4203428">[</span><span class="ident" id="4203429">hash</span><span class="op" id="4203433">.</span><span class="ident" id="4203434">Size</span><span class="op" id="4203438">(</span><span class="op" id="4203439">)</span><span class="op" id="4203440">:</span><span class="op" id="4203441">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203445">for</span>&nbsp;<span class="ident" id="4203449">i</span>&nbsp;<span class="op" id="4203451">:=</span>&nbsp;<span class="num" id="4203454">0</span><span class="op" id="4203455">;</span>&nbsp;<span class="ident" id="4203457">i</span>&nbsp;<span class="op" id="4203459">&lt;</span>&nbsp;<span class="builtinfunc" id="4203461">len</span><span class="op" id="4203464">(</span><span class="ident" id="4203465">rest</span><span class="op" id="4203469">)</span><span class="op" id="4203470">;</span>&nbsp;<span class="ident" id="4203472">i</span><span class="op" id="4203473">++</span>&nbsp;<span class="op" id="4203476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203480">equals0</span>&nbsp;<span class="op" id="4203488">:=</span>&nbsp;<span class="ident" id="4203491">subtle</span><span class="op" id="4203497">.</span><span class="ident" id="4203498">ConstantTimeByteEq</span><span class="op" id="4203516">(</span><span class="ident" id="4203517">rest</span><span class="op" id="4203521">[</span><span class="ident" id="4203522">i</span><span class="op" id="4203523">]</span><span class="op" id="4203524">,</span>&nbsp;<span class="num" id="4203526">0</span><span class="op" id="4203527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203531">equals1</span>&nbsp;<span class="op" id="4203539">:=</span>&nbsp;<span class="ident" id="4203542">subtle</span><span class="op" id="4203548">.</span><span class="ident" id="4203549">ConstantTimeByteEq</span><span class="op" id="4203567">(</span><span class="ident" id="4203568">rest</span><span class="op" id="4203572">[</span><span class="ident" id="4203573">i</span><span class="op" id="4203574">]</span><span class="op" id="4203575">,</span>&nbsp;<span class="num" id="4203577">1</span><span class="op" id="4203578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203582">index</span>&nbsp;<span class="op" id="4203588">=</span>&nbsp;<span class="ident" id="4203590">subtle</span><span class="op" id="4203596">.</span><span class="ident" id="4203597">ConstantTimeSelect</span><span class="op" id="4203615">(</span><span class="ident" id="4203616">lookingForIndex</span><span class="op" id="4203631">&amp;</span><span class="ident" id="4203632">equals1</span><span class="op" id="4203639">,</span>&nbsp;<span class="ident" id="4203641">i</span><span class="op" id="4203642">,</span>&nbsp;<span class="ident" id="4203644">index</span><span class="op" id="4203649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203653">lookingForIndex</span>&nbsp;<span class="op" id="4203669">=</span>&nbsp;<span class="ident" id="4203671">subtle</span><span class="op" id="4203677">.</span><span class="ident" id="4203678">ConstantTimeSelect</span><span class="op" id="4203696">(</span><span class="ident" id="4203697">equals1</span><span class="op" id="4203704">,</span>&nbsp;<span class="num" id="4203706">0</span><span class="op" id="4203707">,</span>&nbsp;<span class="ident" id="4203709">lookingForIndex</span><span class="op" id="4203724">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203728">invalid</span>&nbsp;<span class="op" id="4203736">=</span>&nbsp;<span class="ident" id="4203738">subtle</span><span class="op" id="4203744">.</span><span class="ident" id="4203745">ConstantTimeSelect</span><span class="op" id="4203763">(</span><span class="ident" id="4203764">lookingForIndex</span><span class="op" id="4203779">&amp;^</span><span class="ident" id="4203781">equals0</span><span class="op" id="4203788">,</span>&nbsp;<span class="num" id="4203790">1</span><span class="op" id="4203791">,</span>&nbsp;<span class="ident" id="4203793">invalid</span><span class="op" id="4203800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203807">if</span>&nbsp;<span class="ident" id="4203810">firstByteIsZero</span><span class="op" id="4203825">&amp;</span><span class="ident" id="4203826">lHash2Good</span><span class="op" id="4203836">&amp;^</span><span class="ident" id="4203838">invalid</span><span class="op" id="4203845">&amp;^</span><span class="ident" id="4203847">lookingForIndex</span>&nbsp;<span class="op" id="4203863">!=</span>&nbsp;<span class="num" id="4203866">1</span>&nbsp;<span class="op" id="4203868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203872">err</span>&nbsp;<span class="op" id="4203876">=</span>&nbsp;<span class="ident" id="4203878">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203894">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203906">msg</span>&nbsp;<span class="op" id="4203910">=</span>&nbsp;<span class="ident" id="4203912">rest</span><span class="op" id="4203916">[</span><span class="ident" id="4203917">index</span><span class="op" id="4203922">+</span><span class="num" id="4203923">1</span><span class="op" id="4203924">:</span><span class="op" id="4203925">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203928">return</span><br>
<span class="lineno">545</span><span class="op" id="4203935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4203938">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="4204017">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4204046">func</span>&nbsp;<span class="ident" id="4204051">leftPad</span><span class="op" id="4204058">(</span><span class="ident" id="4204059">input</span>&nbsp;<span class="op" id="4204065">[</span><span class="op" id="4204066">]</span><span class="builtintype" id="4204067">byte</span><span class="op" id="4204071">,</span>&nbsp;<span class="ident" id="4204073">size</span>&nbsp;<span class="builtintype" id="4204078">int</span><span class="op" id="4204081">)</span>&nbsp;<span class="op" id="4204083">(</span><span class="ident" id="4204084">out</span>&nbsp;<span class="op" id="4204088">[</span><span class="op" id="4204089">]</span><span class="builtintype" id="4204090">byte</span><span class="op" id="4204094">)</span>&nbsp;<span class="op" id="4204096">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204099">n</span>&nbsp;<span class="op" id="4204101">:=</span>&nbsp;<span class="builtinfunc" id="4204104">len</span><span class="op" id="4204107">(</span><span class="ident" id="4204108">input</span><span class="op" id="4204113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204116">if</span>&nbsp;<span class="ident" id="4204119">n</span>&nbsp;<span class="op" id="4204121">&gt;</span>&nbsp;<span class="ident" id="4204123">size</span>&nbsp;<span class="op" id="4204128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204132">n</span>&nbsp;<span class="op" id="4204134">=</span>&nbsp;<span class="ident" id="4204136">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204145">out</span>&nbsp;<span class="op" id="4204149">=</span>&nbsp;<span class="builtinfunc" id="4204151">make</span><span class="op" id="4204155">(</span><span class="op" id="4204156">[</span><span class="op" id="4204157">]</span><span class="builtintype" id="4204158">byte</span><span class="op" id="4204162">,</span>&nbsp;<span class="ident" id="4204164">size</span><span class="op" id="4204168">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4204171">copy</span><span class="op" id="4204175">(</span><span class="ident" id="4204176">out</span><span class="op" id="4204179">[</span><span class="builtinfunc" id="4204180">len</span><span class="op" id="4204183">(</span><span class="ident" id="4204184">out</span><span class="op" id="4204187">)</span><span class="op" id="4204188">-</span><span class="ident" id="4204189">n</span><span class="op" id="4204190">:</span><span class="op" id="4204191">]</span><span class="op" id="4204192">,</span>&nbsp;<span class="ident" id="4204194">input</span><span class="op" id="4204199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204202">return</span><br>
<span class="lineno"></span><span class="op" id="4204209">}</span>
</div>
</body>
</html>
