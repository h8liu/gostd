<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html" class="current">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6406711">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6406766">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6406820">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6406871">package</span>&nbsp;<span class="ident" id="6406879">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6406884">import</span>&nbsp;<span class="op" id="6406891">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6406894">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6406904">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6406911">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6406917">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6406924">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6406931">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6406952">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6406963">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6406974">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6406982">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6406997">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6407008">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="6407015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6407018">var</span>&nbsp;<span class="op" id="6407022">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6407025">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6407051">*</span><span class="ident" id="6407052">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6407060">serverAddr</span><span class="op" id="6407070">,</span>&nbsp;<span class="ident" id="6407072">newServerAddr</span>&nbsp;<span class="builtintype" id="6407086">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6407094">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6407120">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6407128">once</span><span class="op" id="6407132">,</span>&nbsp;<span class="ident" id="6407134">newOnce</span><span class="op" id="6407141">,</span>&nbsp;<span class="ident" id="6407143">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6407154">sync</span><span class="op" id="6407158">.</span><span class="ident" id="6407159">Once</span><br>
<span class="lineno"></span><span class="op" id="6407164">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6407167">const</span>&nbsp;<span class="op" id="6407173">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6407176">newHttpPath</span>&nbsp;<span class="op" id="6407188">=</span>&nbsp;<span class="string" id="6407190">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="6407197">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6407200">type</span>&nbsp;<span class="ident" id="6407205">Args</span>&nbsp;<span class="keyword" id="6407210">struct</span>&nbsp;<span class="op" id="6407217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6407220">A</span><span class="op" id="6407221">,</span>&nbsp;<span class="ident" id="6407223">B</span>&nbsp;<span class="builtintype" id="6407225">int</span><br>
<span class="lineno">35</span><span class="op" id="6407229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6407232">type</span>&nbsp;<span class="ident" id="6407237">Reply</span>&nbsp;<span class="keyword" id="6407243">struct</span>&nbsp;<span class="op" id="6407250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6407253">C</span>&nbsp;<span class="builtintype" id="6407255">int</span><br>
<span class="lineno"></span><span class="op" id="6407259">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6407262">type</span>&nbsp;<span class="ident" id="6407267">Arith</span>&nbsp;<span class="builtintype" id="6407273">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6407278">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6407366">func</span>&nbsp;<span class="op" id="6407371">(</span><span class="ident" id="6407372">t</span>&nbsp;<span class="op" id="6407374">*</span><span class="ident" id="6407375">Arith</span><span class="op" id="6407380">)</span>&nbsp;<span class="ident" id="6407382">Add</span><span class="op" id="6407385">(</span><span class="ident" id="6407386">args</span>&nbsp;<span class="ident" id="6407391">Args</span><span class="op" id="6407395">,</span>&nbsp;<span class="ident" id="6407397">reply</span>&nbsp;<span class="op" id="6407403">*</span><span class="ident" id="6407404">Reply</span><span class="op" id="6407409">)</span>&nbsp;<span class="builtintype" id="6407411">error</span>&nbsp;<span class="op" id="6407417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6407420">reply</span><span class="op" id="6407425">.</span><span class="ident" id="6407426">C</span>&nbsp;<span class="op" id="6407428">=</span>&nbsp;<span class="ident" id="6407430">args</span><span class="op" id="6407434">.</span><span class="ident" id="6407435">A</span>&nbsp;<span class="op" id="6407437">+</span>&nbsp;<span class="ident" id="6407439">args</span><span class="op" id="6407443">.</span><span class="ident" id="6407444">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6407447">return</span>&nbsp;<span class="ident" id="6407454">nil</span><br>
<span class="lineno"></span><span class="op" id="6407458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6407461">func</span>&nbsp;<span class="op" id="6407466">(</span><span class="ident" id="6407467">t</span>&nbsp;<span class="op" id="6407469">*</span><span class="ident" id="6407470">Arith</span><span class="op" id="6407475">)</span>&nbsp;<span class="ident" id="6407477">Mul</span><span class="op" id="6407480">(</span><span class="ident" id="6407481">args</span>&nbsp;<span class="op" id="6407486">*</span><span class="ident" id="6407487">Args</span><span class="op" id="6407491">,</span>&nbsp;<span class="ident" id="6407493">reply</span>&nbsp;<span class="op" id="6407499">*</span><span class="ident" id="6407500">Reply</span><span class="op" id="6407505">)</span>&nbsp;<span class="builtintype" id="6407507">error</span>&nbsp;<span class="op" id="6407513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6407516">reply</span><span class="op" id="6407521">.</span><span class="ident" id="6407522">C</span>&nbsp;<span class="op" id="6407524">=</span>&nbsp;<span class="ident" id="6407526">args</span><span class="op" id="6407530">.</span><span class="ident" id="6407531">A</span>&nbsp;<span class="op" id="6407533">*</span>&nbsp;<span class="ident" id="6407535">args</span><span class="op" id="6407539">.</span><span class="ident" id="6407540">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6407543">return</span>&nbsp;<span class="ident" id="6407550">nil</span><br>
<span class="lineno"></span><span class="op" id="6407554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6407557">func</span>&nbsp;<span class="op" id="6407562">(</span><span class="ident" id="6407563">t</span>&nbsp;<span class="op" id="6407565">*</span><span class="ident" id="6407566">Arith</span><span class="op" id="6407571">)</span>&nbsp;<span class="ident" id="6407573">Div</span><span class="op" id="6407576">(</span><span class="ident" id="6407577">args</span>&nbsp;<span class="ident" id="6407582">Args</span><span class="op" id="6407586">,</span>&nbsp;<span class="ident" id="6407588">reply</span>&nbsp;<span class="op" id="6407594">*</span><span class="ident" id="6407595">Reply</span><span class="op" id="6407600">)</span>&nbsp;<span class="builtintype" id="6407602">error</span>&nbsp;<span class="op" id="6407608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6407611">if</span>&nbsp;<span class="ident" id="6407614">args</span><span class="op" id="6407618">.</span><span class="ident" id="6407619">B</span>&nbsp;<span class="op" id="6407621">==</span>&nbsp;<span class="num" id="6407624">0</span>&nbsp;<span class="op" id="6407626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6407630">return</span>&nbsp;<span class="ident" id="6407637">errors</span><span class="op" id="6407643">.</span><span class="ident" id="6407644">New</span><span class="op" id="6407647">(</span><span class="string" id="6407648">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="6407664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6407667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6407670">reply</span><span class="op" id="6407675">.</span><span class="ident" id="6407676">C</span>&nbsp;<span class="op" id="6407678">=</span>&nbsp;<span class="ident" id="6407680">args</span><span class="op" id="6407684">.</span><span class="ident" id="6407685">A</span>&nbsp;<span class="op" id="6407687">/</span>&nbsp;<span class="ident" id="6407689">args</span><span class="op" id="6407693">.</span><span class="ident" id="6407694">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6407697">return</span>&nbsp;<span class="ident" id="6407704">nil</span><br>
<span class="lineno"></span><span class="op" id="6407708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6407711">func</span>&nbsp;<span class="op" id="6407716">(</span><span class="ident" id="6407717">t</span>&nbsp;<span class="op" id="6407719">*</span><span class="ident" id="6407720">Arith</span><span class="op" id="6407725">)</span>&nbsp;<span class="ident" id="6407727">String</span><span class="op" id="6407733">(</span><span class="ident" id="6407734">args</span>&nbsp;<span class="op" id="6407739">*</span><span class="ident" id="6407740">Args</span><span class="op" id="6407744">,</span>&nbsp;<span class="ident" id="6407746">reply</span>&nbsp;<span class="op" id="6407752">*</span><span class="builtintype" id="6407753">string</span><span class="op" id="6407759">)</span>&nbsp;<span class="builtintype" id="6407761">error</span>&nbsp;<span class="op" id="6407767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6407770">*</span><span class="ident" id="6407771">reply</span>&nbsp;<span class="op" id="6407777">=</span>&nbsp;<span class="ident" id="6407779">fmt</span><span class="op" id="6407782">.</span><span class="ident" id="6407783">Sprintf</span><span class="op" id="6407790">(</span><span class="string" id="6407791">&#34;%d+%d=%d&#34;</span><span class="op" id="6407801">,</span>&nbsp;<span class="ident" id="6407803">args</span><span class="op" id="6407807">.</span><span class="ident" id="6407808">A</span><span class="op" id="6407809">,</span>&nbsp;<span class="ident" id="6407811">args</span><span class="op" id="6407815">.</span><span class="ident" id="6407816">B</span><span class="op" id="6407817">,</span>&nbsp;<span class="ident" id="6407819">args</span><span class="op" id="6407823">.</span><span class="ident" id="6407824">A</span><span class="op" id="6407825">+</span><span class="ident" id="6407826">args</span><span class="op" id="6407830">.</span><span class="ident" id="6407831">B</span><span class="op" id="6407832">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6407835">return</span>&nbsp;<span class="ident" id="6407842">nil</span><br>
<span class="lineno"></span><span class="op" id="6407846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6407849">func</span>&nbsp;<span class="op" id="6407854">(</span><span class="ident" id="6407855">t</span>&nbsp;<span class="op" id="6407857">*</span><span class="ident" id="6407858">Arith</span><span class="op" id="6407863">)</span>&nbsp;<span class="ident" id="6407865">Scan</span><span class="op" id="6407869">(</span><span class="ident" id="6407870">args</span>&nbsp;<span class="builtintype" id="6407875">string</span><span class="op" id="6407881">,</span>&nbsp;<span class="ident" id="6407883">reply</span>&nbsp;<span class="op" id="6407889">*</span><span class="ident" id="6407890">Reply</span><span class="op" id="6407895">)</span>&nbsp;<span class="op" id="6407897">(</span><span class="ident" id="6407898">err</span>&nbsp;<span class="builtintype" id="6407902">error</span><span class="op" id="6407907">)</span>&nbsp;<span class="op" id="6407909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6407912">_</span><span class="op" id="6407913">,</span>&nbsp;<span class="ident" id="6407915">err</span>&nbsp;<span class="op" id="6407919">=</span>&nbsp;<span class="ident" id="6407921">fmt</span><span class="op" id="6407924">.</span><span class="ident" id="6407925">Sscan</span><span class="op" id="6407930">(</span><span class="ident" id="6407931">args</span><span class="op" id="6407935">,</span>&nbsp;<span class="op" id="6407937">&amp;</span><span class="ident" id="6407938">reply</span><span class="op" id="6407943">.</span><span class="ident" id="6407944">C</span><span class="op" id="6407945">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6407948">return</span><br>
<span class="lineno"></span><span class="op" id="6407955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6407958">func</span>&nbsp;<span class="op" id="6407963">(</span><span class="ident" id="6407964">t</span>&nbsp;<span class="op" id="6407966">*</span><span class="ident" id="6407967">Arith</span><span class="op" id="6407972">)</span>&nbsp;<span class="ident" id="6407974">Error</span><span class="op" id="6407979">(</span><span class="ident" id="6407980">args</span>&nbsp;<span class="op" id="6407985">*</span><span class="ident" id="6407986">Args</span><span class="op" id="6407990">,</span>&nbsp;<span class="ident" id="6407992">reply</span>&nbsp;<span class="op" id="6407998">*</span><span class="ident" id="6407999">Reply</span><span class="op" id="6408004">)</span>&nbsp;<span class="builtintype" id="6408006">error</span>&nbsp;<span class="op" id="6408012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6408015">panic</span><span class="op" id="6408020">(</span><span class="string" id="6408021">&#34;ERROR&#34;</span><span class="op" id="6408028">)</span><br>
<span class="lineno">75</span><span class="op" id="6408030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408033">func</span>&nbsp;<span class="ident" id="6408038">listenTCP</span><span class="op" id="6408047">(</span><span class="op" id="6408048">)</span>&nbsp;<span class="op" id="6408050">(</span><span class="ident" id="6408051">net</span><span class="op" id="6408054">.</span><span class="ident" id="6408055">Listener</span><span class="op" id="6408063">,</span>&nbsp;<span class="builtintype" id="6408065">string</span><span class="op" id="6408071">)</span>&nbsp;<span class="op" id="6408073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408076">l</span><span class="op" id="6408077">,</span>&nbsp;<span class="ident" id="6408079">e</span>&nbsp;<span class="op" id="6408081">:=</span>&nbsp;<span class="ident" id="6408084">net</span><span class="op" id="6408087">.</span><span class="ident" id="6408088">Listen</span><span class="op" id="6408094">(</span><span class="string" id="6408095">&#34;tcp&#34;</span><span class="op" id="6408100">,</span>&nbsp;<span class="string" id="6408102">&#34;127.0.0.1:0&#34;</span><span class="op" id="6408115">)</span>&nbsp;<span class="comment" id="6408117">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408143">if</span>&nbsp;<span class="ident" id="6408146">e</span>&nbsp;<span class="op" id="6408148">!=</span>&nbsp;<span class="ident" id="6408151">nil</span>&nbsp;<span class="op" id="6408155">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408159">log</span><span class="op" id="6408162">.</span><span class="ident" id="6408163">Fatalf</span><span class="op" id="6408169">(</span><span class="string" id="6408170">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="6408193">,</span>&nbsp;<span class="ident" id="6408195">e</span><span class="op" id="6408196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6408199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408202">return</span>&nbsp;<span class="ident" id="6408209">l</span><span class="op" id="6408210">,</span>&nbsp;<span class="ident" id="6408212">l</span><span class="op" id="6408213">.</span><span class="ident" id="6408214">Addr</span><span class="op" id="6408218">(</span><span class="op" id="6408219">)</span><span class="op" id="6408220">.</span><span class="ident" id="6408221">String</span><span class="op" id="6408227">(</span><span class="op" id="6408228">)</span><br>
<span class="lineno"></span><span class="op" id="6408230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="6408233">func</span>&nbsp;<span class="ident" id="6408238">startServer</span><span class="op" id="6408249">(</span><span class="op" id="6408250">)</span>&nbsp;<span class="op" id="6408252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408255">Register</span><span class="op" id="6408263">(</span><span class="builtinfunc" id="6408264">new</span><span class="op" id="6408267">(</span><span class="ident" id="6408268">Arith</span><span class="op" id="6408273">)</span><span class="op" id="6408274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408277">RegisterName</span><span class="op" id="6408289">(</span><span class="string" id="6408290">&#34;net.rpc.Arith&#34;</span><span class="op" id="6408305">,</span>&nbsp;<span class="builtinfunc" id="6408307">new</span><span class="op" id="6408310">(</span><span class="ident" id="6408311">Arith</span><span class="op" id="6408316">)</span><span class="op" id="6408317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408321">var</span>&nbsp;<span class="ident" id="6408325">l</span>&nbsp;<span class="ident" id="6408327">net</span><span class="op" id="6408330">.</span><span class="ident" id="6408331">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408341">l</span><span class="op" id="6408342">,</span>&nbsp;<span class="ident" id="6408344">serverAddr</span>&nbsp;<span class="op" id="6408355">=</span>&nbsp;<span class="ident" id="6408357">listenTCP</span><span class="op" id="6408366">(</span><span class="op" id="6408367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408370">log</span><span class="op" id="6408373">.</span><span class="ident" id="6408374">Println</span><span class="op" id="6408381">(</span><span class="string" id="6408382">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6408412">,</span>&nbsp;<span class="ident" id="6408414">serverAddr</span><span class="op" id="6408424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408427">go</span>&nbsp;<span class="ident" id="6408430">Accept</span><span class="op" id="6408436">(</span><span class="ident" id="6408437">l</span><span class="op" id="6408438">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408442">HandleHTTP</span><span class="op" id="6408452">(</span><span class="op" id="6408453">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408456">httpOnce</span><span class="op" id="6408464">.</span><span class="ident" id="6408465">Do</span><span class="op" id="6408467">(</span><span class="ident" id="6408468">startHttpServer</span><span class="op" id="6408483">)</span><br>
<span class="lineno"></span><span class="op" id="6408485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408488">func</span>&nbsp;<span class="ident" id="6408493">startNewServer</span><span class="op" id="6408507">(</span><span class="op" id="6408508">)</span>&nbsp;<span class="op" id="6408510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408513">newServer</span>&nbsp;<span class="op" id="6408523">=</span>&nbsp;<span class="ident" id="6408525">NewServer</span><span class="op" id="6408534">(</span><span class="op" id="6408535">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408538">newServer</span><span class="op" id="6408547">.</span><span class="ident" id="6408548">Register</span><span class="op" id="6408556">(</span><span class="builtinfunc" id="6408557">new</span><span class="op" id="6408560">(</span><span class="ident" id="6408561">Arith</span><span class="op" id="6408566">)</span><span class="op" id="6408567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408570">newServer</span><span class="op" id="6408579">.</span><span class="ident" id="6408580">RegisterName</span><span class="op" id="6408592">(</span><span class="string" id="6408593">&#34;net.rpc.Arith&#34;</span><span class="op" id="6408608">,</span>&nbsp;<span class="builtinfunc" id="6408610">new</span><span class="op" id="6408613">(</span><span class="ident" id="6408614">Arith</span><span class="op" id="6408619">)</span><span class="op" id="6408620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408623">newServer</span><span class="op" id="6408632">.</span><span class="ident" id="6408633">RegisterName</span><span class="op" id="6408645">(</span><span class="string" id="6408646">&#34;newServer.Arith&#34;</span><span class="op" id="6408663">,</span>&nbsp;<span class="builtinfunc" id="6408665">new</span><span class="op" id="6408668">(</span><span class="ident" id="6408669">Arith</span><span class="op" id="6408674">)</span><span class="op" id="6408675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408679">var</span>&nbsp;<span class="ident" id="6408683">l</span>&nbsp;<span class="ident" id="6408685">net</span><span class="op" id="6408688">.</span><span class="ident" id="6408689">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408699">l</span><span class="op" id="6408700">,</span>&nbsp;<span class="ident" id="6408702">newServerAddr</span>&nbsp;<span class="op" id="6408716">=</span>&nbsp;<span class="ident" id="6408718">listenTCP</span><span class="op" id="6408727">(</span><span class="op" id="6408728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408731">log</span><span class="op" id="6408734">.</span><span class="ident" id="6408735">Println</span><span class="op" id="6408742">(</span><span class="string" id="6408743">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6408783">,</span>&nbsp;<span class="ident" id="6408785">newServerAddr</span><span class="op" id="6408798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408801">go</span>&nbsp;<span class="ident" id="6408804">newServer</span><span class="op" id="6408813">.</span><span class="ident" id="6408814">Accept</span><span class="op" id="6408820">(</span><span class="ident" id="6408821">l</span><span class="op" id="6408822">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408826">newServer</span><span class="op" id="6408835">.</span><span class="ident" id="6408836">HandleHTTP</span><span class="op" id="6408846">(</span><span class="ident" id="6408847">newHttpPath</span><span class="op" id="6408858">,</span>&nbsp;<span class="string" id="6408860">&#34;/bar&#34;</span><span class="op" id="6408866">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408869">httpOnce</span><span class="op" id="6408877">.</span><span class="ident" id="6408878">Do</span><span class="op" id="6408880">(</span><span class="ident" id="6408881">startHttpServer</span><span class="op" id="6408896">)</span><br>
<span class="lineno"></span><span class="op" id="6408898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6408901">func</span>&nbsp;<span class="ident" id="6408906">startHttpServer</span><span class="op" id="6408921">(</span><span class="op" id="6408922">)</span>&nbsp;<span class="op" id="6408924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408927">server</span>&nbsp;<span class="op" id="6408934">:=</span>&nbsp;<span class="ident" id="6408937">httptest</span><span class="op" id="6408945">.</span><span class="ident" id="6408946">NewServer</span><span class="op" id="6408955">(</span><span class="ident" id="6408956">nil</span><span class="op" id="6408959">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6408962">httpServerAddr</span>&nbsp;<span class="op" id="6408977">=</span>&nbsp;<span class="ident" id="6408979">server</span><span class="op" id="6408985">.</span><span class="ident" id="6408986">Listener</span><span class="op" id="6408994">.</span><span class="ident" id="6408995">Addr</span><span class="op" id="6408999">(</span><span class="op" id="6409000">)</span><span class="op" id="6409001">.</span><span class="ident" id="6409002">String</span><span class="op" id="6409008">(</span><span class="op" id="6409009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409012">log</span><span class="op" id="6409015">.</span><span class="ident" id="6409016">Println</span><span class="op" id="6409023">(</span><span class="string" id="6409024">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6409059">,</span>&nbsp;<span class="ident" id="6409061">httpServerAddr</span><span class="op" id="6409075">)</span><br>
<span class="lineno"></span><span class="op" id="6409077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6409080">func</span>&nbsp;<span class="ident" id="6409085">TestRPC</span><span class="op" id="6409092">(</span><span class="ident" id="6409093">t</span>&nbsp;<span class="op" id="6409095">*</span><span class="ident" id="6409096">testing</span><span class="op" id="6409103">.</span><span class="ident" id="6409104">T</span><span class="op" id="6409105">)</span>&nbsp;<span class="op" id="6409107">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409110">once</span><span class="op" id="6409114">.</span><span class="ident" id="6409115">Do</span><span class="op" id="6409117">(</span><span class="ident" id="6409118">startServer</span><span class="op" id="6409129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409132">testRPC</span><span class="op" id="6409139">(</span><span class="ident" id="6409140">t</span><span class="op" id="6409141">,</span>&nbsp;<span class="ident" id="6409143">serverAddr</span><span class="op" id="6409153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409156">newOnce</span><span class="op" id="6409163">.</span><span class="ident" id="6409164">Do</span><span class="op" id="6409166">(</span><span class="ident" id="6409167">startNewServer</span><span class="op" id="6409181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409184">testRPC</span><span class="op" id="6409191">(</span><span class="ident" id="6409192">t</span><span class="op" id="6409193">,</span>&nbsp;<span class="ident" id="6409195">newServerAddr</span><span class="op" id="6409208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409211">testNewServerRPC</span><span class="op" id="6409227">(</span><span class="ident" id="6409228">t</span><span class="op" id="6409229">,</span>&nbsp;<span class="ident" id="6409231">newServerAddr</span><span class="op" id="6409244">)</span><br>
<span class="lineno">125</span><span class="op" id="6409246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6409249">func</span>&nbsp;<span class="ident" id="6409254">testRPC</span><span class="op" id="6409261">(</span><span class="ident" id="6409262">t</span>&nbsp;<span class="op" id="6409264">*</span><span class="ident" id="6409265">testing</span><span class="op" id="6409272">.</span><span class="ident" id="6409273">T</span><span class="op" id="6409274">,</span>&nbsp;<span class="ident" id="6409276">addr</span>&nbsp;<span class="builtintype" id="6409281">string</span><span class="op" id="6409287">)</span>&nbsp;<span class="op" id="6409289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409292">client</span><span class="op" id="6409298">,</span>&nbsp;<span class="ident" id="6409300">err</span>&nbsp;<span class="op" id="6409304">:=</span>&nbsp;<span class="ident" id="6409307">Dial</span><span class="op" id="6409311">(</span><span class="string" id="6409312">&#34;tcp&#34;</span><span class="op" id="6409317">,</span>&nbsp;<span class="ident" id="6409319">addr</span><span class="op" id="6409323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409326">if</span>&nbsp;<span class="ident" id="6409329">err</span>&nbsp;<span class="op" id="6409333">!=</span>&nbsp;<span class="ident" id="6409336">nil</span>&nbsp;<span class="op" id="6409340">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409344">t</span><span class="op" id="6409345">.</span><span class="ident" id="6409346">Fatal</span><span class="op" id="6409351">(</span><span class="string" id="6409352">&#34;dialing&#34;</span><span class="op" id="6409361">,</span>&nbsp;<span class="ident" id="6409363">err</span><span class="op" id="6409366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409372">defer</span>&nbsp;<span class="ident" id="6409378">client</span><span class="op" id="6409384">.</span><span class="ident" id="6409385">Close</span><span class="op" id="6409390">(</span><span class="op" id="6409391">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6409395">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409417">args</span>&nbsp;<span class="op" id="6409422">:=</span>&nbsp;<span class="op" id="6409425">&amp;</span><span class="ident" id="6409426">Args</span><span class="op" id="6409430">{</span><span class="num" id="6409431">7</span><span class="op" id="6409432">,</span>&nbsp;<span class="num" id="6409434">8</span><span class="op" id="6409435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409438">reply</span>&nbsp;<span class="op" id="6409444">:=</span>&nbsp;<span class="builtinfunc" id="6409447">new</span><span class="op" id="6409450">(</span><span class="ident" id="6409451">Reply</span><span class="op" id="6409456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409459">err</span>&nbsp;<span class="op" id="6409463">=</span>&nbsp;<span class="ident" id="6409465">client</span><span class="op" id="6409471">.</span><span class="ident" id="6409472">Call</span><span class="op" id="6409476">(</span><span class="string" id="6409477">&#34;Arith.Add&#34;</span><span class="op" id="6409488">,</span>&nbsp;<span class="ident" id="6409490">args</span><span class="op" id="6409494">,</span>&nbsp;<span class="ident" id="6409496">reply</span><span class="op" id="6409501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409504">if</span>&nbsp;<span class="ident" id="6409507">err</span>&nbsp;<span class="op" id="6409511">!=</span>&nbsp;<span class="ident" id="6409514">nil</span>&nbsp;<span class="op" id="6409518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409522">t</span><span class="op" id="6409523">.</span><span class="ident" id="6409524">Errorf</span><span class="op" id="6409530">(</span><span class="string" id="6409531">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6409573">,</span>&nbsp;<span class="ident" id="6409575">err</span><span class="op" id="6409578">.</span><span class="ident" id="6409579">Error</span><span class="op" id="6409584">(</span><span class="op" id="6409585">)</span><span class="op" id="6409586">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409592">if</span>&nbsp;<span class="ident" id="6409595">reply</span><span class="op" id="6409600">.</span><span class="ident" id="6409601">C</span>&nbsp;<span class="op" id="6409603">!=</span>&nbsp;<span class="ident" id="6409606">args</span><span class="op" id="6409610">.</span><span class="ident" id="6409611">A</span><span class="op" id="6409612">+</span><span class="ident" id="6409613">args</span><span class="op" id="6409617">.</span><span class="ident" id="6409618">B</span>&nbsp;<span class="op" id="6409620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409624">t</span><span class="op" id="6409625">.</span><span class="ident" id="6409626">Errorf</span><span class="op" id="6409632">(</span><span class="string" id="6409633">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6409658">,</span>&nbsp;<span class="ident" id="6409660">reply</span><span class="op" id="6409665">.</span><span class="ident" id="6409666">C</span><span class="op" id="6409667">,</span>&nbsp;<span class="ident" id="6409669">args</span><span class="op" id="6409673">.</span><span class="ident" id="6409674">A</span><span class="op" id="6409675">+</span><span class="ident" id="6409676">args</span><span class="op" id="6409680">.</span><span class="ident" id="6409681">B</span><span class="op" id="6409682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6409689">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409712">args</span>&nbsp;<span class="op" id="6409717">=</span>&nbsp;<span class="op" id="6409719">&amp;</span><span class="ident" id="6409720">Args</span><span class="op" id="6409724">{</span><span class="num" id="6409725">7</span><span class="op" id="6409726">,</span>&nbsp;<span class="num" id="6409728">0</span><span class="op" id="6409729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409732">reply</span>&nbsp;<span class="op" id="6409738">=</span>&nbsp;<span class="builtinfunc" id="6409740">new</span><span class="op" id="6409743">(</span><span class="ident" id="6409744">Reply</span><span class="op" id="6409749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409752">err</span>&nbsp;<span class="op" id="6409756">=</span>&nbsp;<span class="ident" id="6409758">client</span><span class="op" id="6409764">.</span><span class="ident" id="6409765">Call</span><span class="op" id="6409769">(</span><span class="string" id="6409770">&#34;Arith.BadOperation&#34;</span><span class="op" id="6409790">,</span>&nbsp;<span class="ident" id="6409792">args</span><span class="op" id="6409796">,</span>&nbsp;<span class="ident" id="6409798">reply</span><span class="op" id="6409803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6409806">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6409826">if</span>&nbsp;<span class="ident" id="6409829">err</span>&nbsp;<span class="op" id="6409833">==</span>&nbsp;<span class="ident" id="6409836">nil</span>&nbsp;<span class="op" id="6409840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409844">t</span><span class="op" id="6409845">.</span><span class="ident" id="6409846">Error</span><span class="op" id="6409851">(</span><span class="string" id="6409852">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6409882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6409885">}</span>&nbsp;<span class="keyword" id="6409887">else</span>&nbsp;<span class="keyword" id="6409892">if</span>&nbsp;<span class="op" id="6409895">!</span><span class="ident" id="6409896">strings</span><span class="op" id="6409903">.</span><span class="ident" id="6409904">HasPrefix</span><span class="op" id="6409913">(</span><span class="ident" id="6409914">err</span><span class="op" id="6409917">.</span><span class="ident" id="6409918">Error</span><span class="op" id="6409923">(</span><span class="op" id="6409924">)</span><span class="op" id="6409925">,</span>&nbsp;<span class="string" id="6409927">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="6409952">)</span>&nbsp;<span class="op" id="6409954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409958">t</span><span class="op" id="6409959">.</span><span class="ident" id="6409960">Errorf</span><span class="op" id="6409966">(</span><span class="string" id="6409967">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6410023">,</span>&nbsp;<span class="ident" id="6410025">err</span><span class="op" id="6410028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410031">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6410035">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410055">args</span>&nbsp;<span class="op" id="6410060">=</span>&nbsp;<span class="op" id="6410062">&amp;</span><span class="ident" id="6410063">Args</span><span class="op" id="6410067">{</span><span class="num" id="6410068">7</span><span class="op" id="6410069">,</span>&nbsp;<span class="num" id="6410071">8</span><span class="op" id="6410072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410075">reply</span>&nbsp;<span class="op" id="6410081">=</span>&nbsp;<span class="builtinfunc" id="6410083">new</span><span class="op" id="6410086">(</span><span class="ident" id="6410087">Reply</span><span class="op" id="6410092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410095">err</span>&nbsp;<span class="op" id="6410099">=</span>&nbsp;<span class="ident" id="6410101">client</span><span class="op" id="6410107">.</span><span class="ident" id="6410108">Call</span><span class="op" id="6410112">(</span><span class="string" id="6410113">&#34;Arith.Unknown&#34;</span><span class="op" id="6410128">,</span>&nbsp;<span class="ident" id="6410130">args</span><span class="op" id="6410134">,</span>&nbsp;<span class="ident" id="6410136">reply</span><span class="op" id="6410141">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410144">if</span>&nbsp;<span class="ident" id="6410147">err</span>&nbsp;<span class="op" id="6410151">==</span>&nbsp;<span class="ident" id="6410154">nil</span>&nbsp;<span class="op" id="6410158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410162">t</span><span class="op" id="6410163">.</span><span class="ident" id="6410164">Error</span><span class="op" id="6410169">(</span><span class="string" id="6410170">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="6410210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410213">}</span>&nbsp;<span class="keyword" id="6410215">else</span>&nbsp;<span class="keyword" id="6410220">if</span>&nbsp;<span class="ident" id="6410223">strings</span><span class="op" id="6410230">.</span><span class="ident" id="6410231">Index</span><span class="op" id="6410236">(</span><span class="ident" id="6410237">err</span><span class="op" id="6410240">.</span><span class="ident" id="6410241">Error</span><span class="op" id="6410246">(</span><span class="op" id="6410247">)</span><span class="op" id="6410248">,</span>&nbsp;<span class="string" id="6410250">&#34;method&#34;</span><span class="op" id="6410258">)</span>&nbsp;<span class="op" id="6410260">&lt;</span>&nbsp;<span class="num" id="6410262">0</span>&nbsp;<span class="op" id="6410264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410268">t</span><span class="op" id="6410269">.</span><span class="ident" id="6410270">Error</span><span class="op" id="6410275">(</span><span class="string" id="6410276">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="6410310">,</span>&nbsp;<span class="ident" id="6410312">err</span><span class="op" id="6410315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410318">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6410322">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410340">args</span>&nbsp;<span class="op" id="6410345">=</span>&nbsp;<span class="op" id="6410347">&amp;</span><span class="ident" id="6410348">Args</span><span class="op" id="6410352">{</span><span class="num" id="6410353">7</span><span class="op" id="6410354">,</span>&nbsp;<span class="num" id="6410356">8</span><span class="op" id="6410357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410360">mulReply</span>&nbsp;<span class="op" id="6410369">:=</span>&nbsp;<span class="builtinfunc" id="6410372">new</span><span class="op" id="6410375">(</span><span class="ident" id="6410376">Reply</span><span class="op" id="6410381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410384">mulCall</span>&nbsp;<span class="op" id="6410392">:=</span>&nbsp;<span class="ident" id="6410395">client</span><span class="op" id="6410401">.</span><span class="ident" id="6410402">Go</span><span class="op" id="6410404">(</span><span class="string" id="6410405">&#34;Arith.Mul&#34;</span><span class="op" id="6410416">,</span>&nbsp;<span class="ident" id="6410418">args</span><span class="op" id="6410422">,</span>&nbsp;<span class="ident" id="6410424">mulReply</span><span class="op" id="6410432">,</span>&nbsp;<span class="ident" id="6410434">nil</span><span class="op" id="6410437">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410440">addReply</span>&nbsp;<span class="op" id="6410449">:=</span>&nbsp;<span class="builtinfunc" id="6410452">new</span><span class="op" id="6410455">(</span><span class="ident" id="6410456">Reply</span><span class="op" id="6410461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410464">addCall</span>&nbsp;<span class="op" id="6410472">:=</span>&nbsp;<span class="ident" id="6410475">client</span><span class="op" id="6410481">.</span><span class="ident" id="6410482">Go</span><span class="op" id="6410484">(</span><span class="string" id="6410485">&#34;Arith.Add&#34;</span><span class="op" id="6410496">,</span>&nbsp;<span class="ident" id="6410498">args</span><span class="op" id="6410502">,</span>&nbsp;<span class="ident" id="6410504">addReply</span><span class="op" id="6410512">,</span>&nbsp;<span class="ident" id="6410514">nil</span><span class="op" id="6410517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410521">addCall</span>&nbsp;<span class="op" id="6410529">=</span>&nbsp;<span class="op" id="6410531">&lt;-</span><span class="ident" id="6410533">addCall</span><span class="op" id="6410540">.</span><span class="ident" id="6410541">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410547">if</span>&nbsp;<span class="ident" id="6410550">addCall</span><span class="op" id="6410557">.</span><span class="ident" id="6410558">Error</span>&nbsp;<span class="op" id="6410564">!=</span>&nbsp;<span class="ident" id="6410567">nil</span>&nbsp;<span class="op" id="6410571">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410575">t</span><span class="op" id="6410576">.</span><span class="ident" id="6410577">Errorf</span><span class="op" id="6410583">(</span><span class="string" id="6410584">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6410626">,</span>&nbsp;<span class="ident" id="6410628">addCall</span><span class="op" id="6410635">.</span><span class="ident" id="6410636">Error</span><span class="op" id="6410641">.</span><span class="ident" id="6410642">Error</span><span class="op" id="6410647">(</span><span class="op" id="6410648">)</span><span class="op" id="6410649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410655">if</span>&nbsp;<span class="ident" id="6410658">addReply</span><span class="op" id="6410666">.</span><span class="ident" id="6410667">C</span>&nbsp;<span class="op" id="6410669">!=</span>&nbsp;<span class="ident" id="6410672">args</span><span class="op" id="6410676">.</span><span class="ident" id="6410677">A</span><span class="op" id="6410678">+</span><span class="ident" id="6410679">args</span><span class="op" id="6410683">.</span><span class="ident" id="6410684">B</span>&nbsp;<span class="op" id="6410686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410690">t</span><span class="op" id="6410691">.</span><span class="ident" id="6410692">Errorf</span><span class="op" id="6410698">(</span><span class="string" id="6410699">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6410724">,</span>&nbsp;<span class="ident" id="6410726">addReply</span><span class="op" id="6410734">.</span><span class="ident" id="6410735">C</span><span class="op" id="6410736">,</span>&nbsp;<span class="ident" id="6410738">args</span><span class="op" id="6410742">.</span><span class="ident" id="6410743">A</span><span class="op" id="6410744">+</span><span class="ident" id="6410745">args</span><span class="op" id="6410749">.</span><span class="ident" id="6410750">B</span><span class="op" id="6410751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410754">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410758">mulCall</span>&nbsp;<span class="op" id="6410766">=</span>&nbsp;<span class="op" id="6410768">&lt;-</span><span class="ident" id="6410770">mulCall</span><span class="op" id="6410777">.</span><span class="ident" id="6410778">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410784">if</span>&nbsp;<span class="ident" id="6410787">mulCall</span><span class="op" id="6410794">.</span><span class="ident" id="6410795">Error</span>&nbsp;<span class="op" id="6410801">!=</span>&nbsp;<span class="ident" id="6410804">nil</span>&nbsp;<span class="op" id="6410808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410812">t</span><span class="op" id="6410813">.</span><span class="ident" id="6410814">Errorf</span><span class="op" id="6410820">(</span><span class="string" id="6410821">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6410863">,</span>&nbsp;<span class="ident" id="6410865">mulCall</span><span class="op" id="6410872">.</span><span class="ident" id="6410873">Error</span><span class="op" id="6410878">.</span><span class="ident" id="6410879">Error</span><span class="op" id="6410884">(</span><span class="op" id="6410885">)</span><span class="op" id="6410886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410889">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410892">if</span>&nbsp;<span class="ident" id="6410895">mulReply</span><span class="op" id="6410903">.</span><span class="ident" id="6410904">C</span>&nbsp;<span class="op" id="6410906">!=</span>&nbsp;<span class="ident" id="6410909">args</span><span class="op" id="6410913">.</span><span class="ident" id="6410914">A</span><span class="op" id="6410915">*</span><span class="ident" id="6410916">args</span><span class="op" id="6410920">.</span><span class="ident" id="6410921">B</span>&nbsp;<span class="op" id="6410923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410927">t</span><span class="op" id="6410928">.</span><span class="ident" id="6410929">Errorf</span><span class="op" id="6410935">(</span><span class="string" id="6410936">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6410961">,</span>&nbsp;<span class="ident" id="6410963">mulReply</span><span class="op" id="6410971">.</span><span class="ident" id="6410972">C</span><span class="op" id="6410973">,</span>&nbsp;<span class="ident" id="6410975">args</span><span class="op" id="6410979">.</span><span class="ident" id="6410980">A</span><span class="op" id="6410981">*</span><span class="ident" id="6410982">args</span><span class="op" id="6410986">.</span><span class="ident" id="6410987">B</span><span class="op" id="6410988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6410995">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411010">args</span>&nbsp;<span class="op" id="6411015">=</span>&nbsp;<span class="op" id="6411017">&amp;</span><span class="ident" id="6411018">Args</span><span class="op" id="6411022">{</span><span class="num" id="6411023">7</span><span class="op" id="6411024">,</span>&nbsp;<span class="num" id="6411026">0</span><span class="op" id="6411027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411030">reply</span>&nbsp;<span class="op" id="6411036">=</span>&nbsp;<span class="builtinfunc" id="6411038">new</span><span class="op" id="6411041">(</span><span class="ident" id="6411042">Reply</span><span class="op" id="6411047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411050">err</span>&nbsp;<span class="op" id="6411054">=</span>&nbsp;<span class="ident" id="6411056">client</span><span class="op" id="6411062">.</span><span class="ident" id="6411063">Call</span><span class="op" id="6411067">(</span><span class="string" id="6411068">&#34;Arith.Div&#34;</span><span class="op" id="6411079">,</span>&nbsp;<span class="ident" id="6411081">args</span><span class="op" id="6411085">,</span>&nbsp;<span class="ident" id="6411087">reply</span><span class="op" id="6411092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6411095">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411128">if</span>&nbsp;<span class="ident" id="6411131">err</span>&nbsp;<span class="op" id="6411135">==</span>&nbsp;<span class="ident" id="6411138">nil</span>&nbsp;<span class="op" id="6411142">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411146">t</span><span class="op" id="6411147">.</span><span class="ident" id="6411148">Error</span><span class="op" id="6411153">(</span><span class="string" id="6411154">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6411175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411178">}</span>&nbsp;<span class="keyword" id="6411180">else</span>&nbsp;<span class="keyword" id="6411185">if</span>&nbsp;<span class="ident" id="6411188">err</span><span class="op" id="6411191">.</span><span class="ident" id="6411192">Error</span><span class="op" id="6411197">(</span><span class="op" id="6411198">)</span>&nbsp;<span class="op" id="6411200">!=</span>&nbsp;<span class="string" id="6411203">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="6411220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411224">t</span><span class="op" id="6411225">.</span><span class="ident" id="6411226">Error</span><span class="op" id="6411231">(</span><span class="string" id="6411232">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6411273">,</span>&nbsp;<span class="ident" id="6411275">err</span><span class="op" id="6411278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6411285">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411299">reply</span>&nbsp;<span class="op" id="6411305">=</span>&nbsp;<span class="builtinfunc" id="6411307">new</span><span class="op" id="6411310">(</span><span class="ident" id="6411311">Reply</span><span class="op" id="6411316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411319">err</span>&nbsp;<span class="op" id="6411323">=</span>&nbsp;<span class="ident" id="6411325">client</span><span class="op" id="6411331">.</span><span class="ident" id="6411332">Call</span><span class="op" id="6411336">(</span><span class="string" id="6411337">&#34;Arith.Add&#34;</span><span class="op" id="6411348">,</span>&nbsp;<span class="ident" id="6411350">reply</span><span class="op" id="6411355">,</span>&nbsp;<span class="ident" id="6411357">reply</span><span class="op" id="6411362">)</span>&nbsp;<span class="comment" id="6411364">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411414">if</span>&nbsp;<span class="ident" id="6411417">err</span>&nbsp;<span class="op" id="6411421">==</span>&nbsp;<span class="ident" id="6411424">nil</span>&nbsp;<span class="op" id="6411428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411432">t</span><span class="op" id="6411433">.</span><span class="ident" id="6411434">Error</span><span class="op" id="6411439">(</span><span class="string" id="6411440">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="6411494">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411497">}</span>&nbsp;<span class="keyword" id="6411499">else</span>&nbsp;<span class="keyword" id="6411504">if</span>&nbsp;<span class="ident" id="6411507">strings</span><span class="op" id="6411514">.</span><span class="ident" id="6411515">Index</span><span class="op" id="6411520">(</span><span class="ident" id="6411521">err</span><span class="op" id="6411524">.</span><span class="ident" id="6411525">Error</span><span class="op" id="6411530">(</span><span class="op" id="6411531">)</span><span class="op" id="6411532">,</span>&nbsp;<span class="string" id="6411534">&#34;type&#34;</span><span class="op" id="6411540">)</span>&nbsp;<span class="op" id="6411542">&lt;</span>&nbsp;<span class="num" id="6411544">0</span>&nbsp;<span class="op" id="6411546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411550">t</span><span class="op" id="6411551">.</span><span class="ident" id="6411552">Error</span><span class="op" id="6411557">(</span><span class="string" id="6411558">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="6411590">,</span>&nbsp;<span class="ident" id="6411592">err</span><span class="op" id="6411595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6411602">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411626">const</span>&nbsp;<span class="ident" id="6411632">Val</span>&nbsp;<span class="op" id="6411636">=</span>&nbsp;<span class="num" id="6411638">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411645">str</span>&nbsp;<span class="op" id="6411649">:=</span>&nbsp;<span class="ident" id="6411652">fmt</span><span class="op" id="6411655">.</span><span class="ident" id="6411656">Sprint</span><span class="op" id="6411662">(</span><span class="ident" id="6411663">Val</span><span class="op" id="6411666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411669">reply</span>&nbsp;<span class="op" id="6411675">=</span>&nbsp;<span class="builtinfunc" id="6411677">new</span><span class="op" id="6411680">(</span><span class="ident" id="6411681">Reply</span><span class="op" id="6411686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411689">err</span>&nbsp;<span class="op" id="6411693">=</span>&nbsp;<span class="ident" id="6411695">client</span><span class="op" id="6411701">.</span><span class="ident" id="6411702">Call</span><span class="op" id="6411706">(</span><span class="string" id="6411707">&#34;Arith.Scan&#34;</span><span class="op" id="6411719">,</span>&nbsp;<span class="op" id="6411721">&amp;</span><span class="ident" id="6411722">str</span><span class="op" id="6411725">,</span>&nbsp;<span class="ident" id="6411727">reply</span><span class="op" id="6411732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411735">if</span>&nbsp;<span class="ident" id="6411738">err</span>&nbsp;<span class="op" id="6411742">!=</span>&nbsp;<span class="ident" id="6411745">nil</span>&nbsp;<span class="op" id="6411749">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411753">t</span><span class="op" id="6411754">.</span><span class="ident" id="6411755">Errorf</span><span class="op" id="6411761">(</span><span class="string" id="6411762">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6411805">,</span>&nbsp;<span class="ident" id="6411807">err</span><span class="op" id="6411810">.</span><span class="ident" id="6411811">Error</span><span class="op" id="6411816">(</span><span class="op" id="6411817">)</span><span class="op" id="6411818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411821">}</span>&nbsp;<span class="keyword" id="6411823">else</span>&nbsp;<span class="keyword" id="6411828">if</span>&nbsp;<span class="ident" id="6411831">reply</span><span class="op" id="6411836">.</span><span class="ident" id="6411837">C</span>&nbsp;<span class="op" id="6411839">!=</span>&nbsp;<span class="ident" id="6411842">Val</span>&nbsp;<span class="op" id="6411846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411850">t</span><span class="op" id="6411851">.</span><span class="ident" id="6411852">Errorf</span><span class="op" id="6411858">(</span><span class="string" id="6411859">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6411885">,</span>&nbsp;<span class="ident" id="6411887">Val</span><span class="op" id="6411890">,</span>&nbsp;<span class="ident" id="6411892">reply</span><span class="op" id="6411897">.</span><span class="ident" id="6411898">C</span><span class="op" id="6411899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6411906">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411927">args</span>&nbsp;<span class="op" id="6411932">=</span>&nbsp;<span class="op" id="6411934">&amp;</span><span class="ident" id="6411935">Args</span><span class="op" id="6411939">{</span><span class="num" id="6411940">27</span><span class="op" id="6411942">,</span>&nbsp;<span class="num" id="6411944">35</span><span class="op" id="6411946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411949">str</span>&nbsp;<span class="op" id="6411953">=</span>&nbsp;<span class="string" id="6411955">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411959">err</span>&nbsp;<span class="op" id="6411963">=</span>&nbsp;<span class="ident" id="6411965">client</span><span class="op" id="6411971">.</span><span class="ident" id="6411972">Call</span><span class="op" id="6411976">(</span><span class="string" id="6411977">&#34;Arith.String&#34;</span><span class="op" id="6411991">,</span>&nbsp;<span class="ident" id="6411993">args</span><span class="op" id="6411997">,</span>&nbsp;<span class="op" id="6411999">&amp;</span><span class="ident" id="6412000">str</span><span class="op" id="6412003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412006">if</span>&nbsp;<span class="ident" id="6412009">err</span>&nbsp;<span class="op" id="6412013">!=</span>&nbsp;<span class="ident" id="6412016">nil</span>&nbsp;<span class="op" id="6412020">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412024">t</span><span class="op" id="6412025">.</span><span class="ident" id="6412026">Errorf</span><span class="op" id="6412032">(</span><span class="string" id="6412033">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6412078">,</span>&nbsp;<span class="ident" id="6412080">err</span><span class="op" id="6412083">.</span><span class="ident" id="6412084">Error</span><span class="op" id="6412089">(</span><span class="op" id="6412090">)</span><span class="op" id="6412091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412097">expect</span>&nbsp;<span class="op" id="6412104">:=</span>&nbsp;<span class="ident" id="6412107">fmt</span><span class="op" id="6412110">.</span><span class="ident" id="6412111">Sprintf</span><span class="op" id="6412118">(</span><span class="string" id="6412119">&#34;%d+%d=%d&#34;</span><span class="op" id="6412129">,</span>&nbsp;<span class="ident" id="6412131">args</span><span class="op" id="6412135">.</span><span class="ident" id="6412136">A</span><span class="op" id="6412137">,</span>&nbsp;<span class="ident" id="6412139">args</span><span class="op" id="6412143">.</span><span class="ident" id="6412144">B</span><span class="op" id="6412145">,</span>&nbsp;<span class="ident" id="6412147">args</span><span class="op" id="6412151">.</span><span class="ident" id="6412152">A</span><span class="op" id="6412153">+</span><span class="ident" id="6412154">args</span><span class="op" id="6412158">.</span><span class="ident" id="6412159">B</span><span class="op" id="6412160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412163">if</span>&nbsp;<span class="ident" id="6412166">str</span>&nbsp;<span class="op" id="6412170">!=</span>&nbsp;<span class="ident" id="6412173">expect</span>&nbsp;<span class="op" id="6412180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412184">t</span><span class="op" id="6412185">.</span><span class="ident" id="6412186">Errorf</span><span class="op" id="6412192">(</span><span class="string" id="6412193">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="6412221">,</span>&nbsp;<span class="ident" id="6412223">expect</span><span class="op" id="6412229">,</span>&nbsp;<span class="ident" id="6412231">str</span><span class="op" id="6412234">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412241">args</span>&nbsp;<span class="op" id="6412246">=</span>&nbsp;<span class="op" id="6412248">&amp;</span><span class="ident" id="6412249">Args</span><span class="op" id="6412253">{</span><span class="num" id="6412254">7</span><span class="op" id="6412255">,</span>&nbsp;<span class="num" id="6412257">8</span><span class="op" id="6412258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412261">reply</span>&nbsp;<span class="op" id="6412267">=</span>&nbsp;<span class="builtinfunc" id="6412269">new</span><span class="op" id="6412272">(</span><span class="ident" id="6412273">Reply</span><span class="op" id="6412278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412281">err</span>&nbsp;<span class="op" id="6412285">=</span>&nbsp;<span class="ident" id="6412287">client</span><span class="op" id="6412293">.</span><span class="ident" id="6412294">Call</span><span class="op" id="6412298">(</span><span class="string" id="6412299">&#34;Arith.Mul&#34;</span><span class="op" id="6412310">,</span>&nbsp;<span class="ident" id="6412312">args</span><span class="op" id="6412316">,</span>&nbsp;<span class="ident" id="6412318">reply</span><span class="op" id="6412323">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412326">if</span>&nbsp;<span class="ident" id="6412329">err</span>&nbsp;<span class="op" id="6412333">!=</span>&nbsp;<span class="ident" id="6412336">nil</span>&nbsp;<span class="op" id="6412340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412344">t</span><span class="op" id="6412345">.</span><span class="ident" id="6412346">Errorf</span><span class="op" id="6412352">(</span><span class="string" id="6412353">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6412395">,</span>&nbsp;<span class="ident" id="6412397">err</span><span class="op" id="6412400">.</span><span class="ident" id="6412401">Error</span><span class="op" id="6412406">(</span><span class="op" id="6412407">)</span><span class="op" id="6412408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412414">if</span>&nbsp;<span class="ident" id="6412417">reply</span><span class="op" id="6412422">.</span><span class="ident" id="6412423">C</span>&nbsp;<span class="op" id="6412425">!=</span>&nbsp;<span class="ident" id="6412428">args</span><span class="op" id="6412432">.</span><span class="ident" id="6412433">A</span><span class="op" id="6412434">*</span><span class="ident" id="6412435">args</span><span class="op" id="6412439">.</span><span class="ident" id="6412440">B</span>&nbsp;<span class="op" id="6412442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412446">t</span><span class="op" id="6412447">.</span><span class="ident" id="6412448">Errorf</span><span class="op" id="6412454">(</span><span class="string" id="6412455">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6412480">,</span>&nbsp;<span class="ident" id="6412482">reply</span><span class="op" id="6412487">.</span><span class="ident" id="6412488">C</span><span class="op" id="6412489">,</span>&nbsp;<span class="ident" id="6412491">args</span><span class="op" id="6412495">.</span><span class="ident" id="6412496">A</span><span class="op" id="6412497">*</span><span class="ident" id="6412498">args</span><span class="op" id="6412502">.</span><span class="ident" id="6412503">B</span><span class="op" id="6412504">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6412511">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412549">args</span>&nbsp;<span class="op" id="6412554">=</span>&nbsp;<span class="op" id="6412556">&amp;</span><span class="ident" id="6412557">Args</span><span class="op" id="6412561">{</span><span class="num" id="6412562">7</span><span class="op" id="6412563">,</span>&nbsp;<span class="num" id="6412565">8</span><span class="op" id="6412566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412569">reply</span>&nbsp;<span class="op" id="6412575">=</span>&nbsp;<span class="builtinfunc" id="6412577">new</span><span class="op" id="6412580">(</span><span class="ident" id="6412581">Reply</span><span class="op" id="6412586">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412589">err</span>&nbsp;<span class="op" id="6412593">=</span>&nbsp;<span class="ident" id="6412595">client</span><span class="op" id="6412601">.</span><span class="ident" id="6412602">Call</span><span class="op" id="6412606">(</span><span class="string" id="6412607">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="6412626">,</span>&nbsp;<span class="ident" id="6412628">args</span><span class="op" id="6412632">,</span>&nbsp;<span class="ident" id="6412634">reply</span><span class="op" id="6412639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412642">if</span>&nbsp;<span class="ident" id="6412645">err</span>&nbsp;<span class="op" id="6412649">!=</span>&nbsp;<span class="ident" id="6412652">nil</span>&nbsp;<span class="op" id="6412656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412660">t</span><span class="op" id="6412661">.</span><span class="ident" id="6412662">Errorf</span><span class="op" id="6412668">(</span><span class="string" id="6412669">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6412711">,</span>&nbsp;<span class="ident" id="6412713">err</span><span class="op" id="6412716">.</span><span class="ident" id="6412717">Error</span><span class="op" id="6412722">(</span><span class="op" id="6412723">)</span><span class="op" id="6412724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412730">if</span>&nbsp;<span class="ident" id="6412733">reply</span><span class="op" id="6412738">.</span><span class="ident" id="6412739">C</span>&nbsp;<span class="op" id="6412741">!=</span>&nbsp;<span class="ident" id="6412744">args</span><span class="op" id="6412748">.</span><span class="ident" id="6412749">A</span><span class="op" id="6412750">+</span><span class="ident" id="6412751">args</span><span class="op" id="6412755">.</span><span class="ident" id="6412756">B</span>&nbsp;<span class="op" id="6412758">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412762">t</span><span class="op" id="6412763">.</span><span class="ident" id="6412764">Errorf</span><span class="op" id="6412770">(</span><span class="string" id="6412771">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6412796">,</span>&nbsp;<span class="ident" id="6412798">reply</span><span class="op" id="6412803">.</span><span class="ident" id="6412804">C</span><span class="op" id="6412805">,</span>&nbsp;<span class="ident" id="6412807">args</span><span class="op" id="6412811">.</span><span class="ident" id="6412812">A</span><span class="op" id="6412813">+</span><span class="ident" id="6412814">args</span><span class="op" id="6412818">.</span><span class="ident" id="6412819">B</span><span class="op" id="6412820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412823">}</span><br>
<span class="lineno"></span><span class="op" id="6412825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6412828">func</span>&nbsp;<span class="ident" id="6412833">testNewServerRPC</span><span class="op" id="6412849">(</span><span class="ident" id="6412850">t</span>&nbsp;<span class="op" id="6412852">*</span><span class="ident" id="6412853">testing</span><span class="op" id="6412860">.</span><span class="ident" id="6412861">T</span><span class="op" id="6412862">,</span>&nbsp;<span class="ident" id="6412864">addr</span>&nbsp;<span class="builtintype" id="6412869">string</span><span class="op" id="6412875">)</span>&nbsp;<span class="op" id="6412877">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412880">client</span><span class="op" id="6412886">,</span>&nbsp;<span class="ident" id="6412888">err</span>&nbsp;<span class="op" id="6412892">:=</span>&nbsp;<span class="ident" id="6412895">Dial</span><span class="op" id="6412899">(</span><span class="string" id="6412900">&#34;tcp&#34;</span><span class="op" id="6412905">,</span>&nbsp;<span class="ident" id="6412907">addr</span><span class="op" id="6412911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412914">if</span>&nbsp;<span class="ident" id="6412917">err</span>&nbsp;<span class="op" id="6412921">!=</span>&nbsp;<span class="ident" id="6412924">nil</span>&nbsp;<span class="op" id="6412928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412932">t</span><span class="op" id="6412933">.</span><span class="ident" id="6412934">Fatal</span><span class="op" id="6412939">(</span><span class="string" id="6412940">&#34;dialing&#34;</span><span class="op" id="6412949">,</span>&nbsp;<span class="ident" id="6412951">err</span><span class="op" id="6412954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412960">defer</span>&nbsp;<span class="ident" id="6412966">client</span><span class="op" id="6412972">.</span><span class="ident" id="6412973">Close</span><span class="op" id="6412978">(</span><span class="op" id="6412979">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6412983">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413005">args</span>&nbsp;<span class="op" id="6413010">:=</span>&nbsp;<span class="op" id="6413013">&amp;</span><span class="ident" id="6413014">Args</span><span class="op" id="6413018">{</span><span class="num" id="6413019">7</span><span class="op" id="6413020">,</span>&nbsp;<span class="num" id="6413022">8</span><span class="op" id="6413023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413026">reply</span>&nbsp;<span class="op" id="6413032">:=</span>&nbsp;<span class="builtinfunc" id="6413035">new</span><span class="op" id="6413038">(</span><span class="ident" id="6413039">Reply</span><span class="op" id="6413044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413047">err</span>&nbsp;<span class="op" id="6413051">=</span>&nbsp;<span class="ident" id="6413053">client</span><span class="op" id="6413059">.</span><span class="ident" id="6413060">Call</span><span class="op" id="6413064">(</span><span class="string" id="6413065">&#34;newServer.Arith.Add&#34;</span><span class="op" id="6413086">,</span>&nbsp;<span class="ident" id="6413088">args</span><span class="op" id="6413092">,</span>&nbsp;<span class="ident" id="6413094">reply</span><span class="op" id="6413099">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413102">if</span>&nbsp;<span class="ident" id="6413105">err</span>&nbsp;<span class="op" id="6413109">!=</span>&nbsp;<span class="ident" id="6413112">nil</span>&nbsp;<span class="op" id="6413116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413120">t</span><span class="op" id="6413121">.</span><span class="ident" id="6413122">Errorf</span><span class="op" id="6413128">(</span><span class="string" id="6413129">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6413171">,</span>&nbsp;<span class="ident" id="6413173">err</span><span class="op" id="6413176">.</span><span class="ident" id="6413177">Error</span><span class="op" id="6413182">(</span><span class="op" id="6413183">)</span><span class="op" id="6413184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413190">if</span>&nbsp;<span class="ident" id="6413193">reply</span><span class="op" id="6413198">.</span><span class="ident" id="6413199">C</span>&nbsp;<span class="op" id="6413201">!=</span>&nbsp;<span class="ident" id="6413204">args</span><span class="op" id="6413208">.</span><span class="ident" id="6413209">A</span><span class="op" id="6413210">+</span><span class="ident" id="6413211">args</span><span class="op" id="6413215">.</span><span class="ident" id="6413216">B</span>&nbsp;<span class="op" id="6413218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413222">t</span><span class="op" id="6413223">.</span><span class="ident" id="6413224">Errorf</span><span class="op" id="6413230">(</span><span class="string" id="6413231">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6413256">,</span>&nbsp;<span class="ident" id="6413258">reply</span><span class="op" id="6413263">.</span><span class="ident" id="6413264">C</span><span class="op" id="6413265">,</span>&nbsp;<span class="ident" id="6413267">args</span><span class="op" id="6413271">.</span><span class="ident" id="6413272">A</span><span class="op" id="6413273">+</span><span class="ident" id="6413274">args</span><span class="op" id="6413278">.</span><span class="ident" id="6413279">B</span><span class="op" id="6413280">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413283">}</span><br>
<span class="lineno"></span><span class="op" id="6413285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6413288">func</span>&nbsp;<span class="ident" id="6413293">TestHTTP</span><span class="op" id="6413301">(</span><span class="ident" id="6413302">t</span>&nbsp;<span class="op" id="6413304">*</span><span class="ident" id="6413305">testing</span><span class="op" id="6413312">.</span><span class="ident" id="6413313">T</span><span class="op" id="6413314">)</span>&nbsp;<span class="op" id="6413316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413319">once</span><span class="op" id="6413323">.</span><span class="ident" id="6413324">Do</span><span class="op" id="6413326">(</span><span class="ident" id="6413327">startServer</span><span class="op" id="6413338">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413341">testHTTPRPC</span><span class="op" id="6413352">(</span><span class="ident" id="6413353">t</span><span class="op" id="6413354">,</span>&nbsp;<span class="string" id="6413356">&#34;&#34;</span><span class="op" id="6413358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413361">newOnce</span><span class="op" id="6413368">.</span><span class="ident" id="6413369">Do</span><span class="op" id="6413371">(</span><span class="ident" id="6413372">startNewServer</span><span class="op" id="6413386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413389">testHTTPRPC</span><span class="op" id="6413400">(</span><span class="ident" id="6413401">t</span><span class="op" id="6413402">,</span>&nbsp;<span class="ident" id="6413404">newHttpPath</span><span class="op" id="6413415">)</span><br>
<span class="lineno"></span><span class="op" id="6413417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6413420">func</span>&nbsp;<span class="ident" id="6413425">testHTTPRPC</span><span class="op" id="6413436">(</span><span class="ident" id="6413437">t</span>&nbsp;<span class="op" id="6413439">*</span><span class="ident" id="6413440">testing</span><span class="op" id="6413447">.</span><span class="ident" id="6413448">T</span><span class="op" id="6413449">,</span>&nbsp;<span class="ident" id="6413451">path</span>&nbsp;<span class="builtintype" id="6413456">string</span><span class="op" id="6413462">)</span>&nbsp;<span class="op" id="6413464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413467">var</span>&nbsp;<span class="ident" id="6413471">client</span>&nbsp;<span class="op" id="6413478">*</span><span class="ident" id="6413479">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413487">var</span>&nbsp;<span class="ident" id="6413491">err</span>&nbsp;<span class="builtintype" id="6413495">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413502">if</span>&nbsp;<span class="ident" id="6413505">path</span>&nbsp;<span class="op" id="6413510">==</span>&nbsp;<span class="string" id="6413513">&#34;&#34;</span>&nbsp;<span class="op" id="6413516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413520">client</span><span class="op" id="6413526">,</span>&nbsp;<span class="ident" id="6413528">err</span>&nbsp;<span class="op" id="6413532">=</span>&nbsp;<span class="ident" id="6413534">DialHTTP</span><span class="op" id="6413542">(</span><span class="string" id="6413543">&#34;tcp&#34;</span><span class="op" id="6413548">,</span>&nbsp;<span class="ident" id="6413550">httpServerAddr</span><span class="op" id="6413564">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413567">}</span>&nbsp;<span class="keyword" id="6413569">else</span>&nbsp;<span class="op" id="6413574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413578">client</span><span class="op" id="6413584">,</span>&nbsp;<span class="ident" id="6413586">err</span>&nbsp;<span class="op" id="6413590">=</span>&nbsp;<span class="ident" id="6413592">DialHTTPPath</span><span class="op" id="6413604">(</span><span class="string" id="6413605">&#34;tcp&#34;</span><span class="op" id="6413610">,</span>&nbsp;<span class="ident" id="6413612">httpServerAddr</span><span class="op" id="6413626">,</span>&nbsp;<span class="ident" id="6413628">path</span><span class="op" id="6413632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413638">if</span>&nbsp;<span class="ident" id="6413641">err</span>&nbsp;<span class="op" id="6413645">!=</span>&nbsp;<span class="ident" id="6413648">nil</span>&nbsp;<span class="op" id="6413652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413656">t</span><span class="op" id="6413657">.</span><span class="ident" id="6413658">Fatal</span><span class="op" id="6413663">(</span><span class="string" id="6413664">&#34;dialing&#34;</span><span class="op" id="6413673">,</span>&nbsp;<span class="ident" id="6413675">err</span><span class="op" id="6413678">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413684">defer</span>&nbsp;<span class="ident" id="6413690">client</span><span class="op" id="6413696">.</span><span class="ident" id="6413697">Close</span><span class="op" id="6413702">(</span><span class="op" id="6413703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6413707">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413729">args</span>&nbsp;<span class="op" id="6413734">:=</span>&nbsp;<span class="op" id="6413737">&amp;</span><span class="ident" id="6413738">Args</span><span class="op" id="6413742">{</span><span class="num" id="6413743">7</span><span class="op" id="6413744">,</span>&nbsp;<span class="num" id="6413746">8</span><span class="op" id="6413747">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413750">reply</span>&nbsp;<span class="op" id="6413756">:=</span>&nbsp;<span class="builtinfunc" id="6413759">new</span><span class="op" id="6413762">(</span><span class="ident" id="6413763">Reply</span><span class="op" id="6413768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413771">err</span>&nbsp;<span class="op" id="6413775">=</span>&nbsp;<span class="ident" id="6413777">client</span><span class="op" id="6413783">.</span><span class="ident" id="6413784">Call</span><span class="op" id="6413788">(</span><span class="string" id="6413789">&#34;Arith.Add&#34;</span><span class="op" id="6413800">,</span>&nbsp;<span class="ident" id="6413802">args</span><span class="op" id="6413806">,</span>&nbsp;<span class="ident" id="6413808">reply</span><span class="op" id="6413813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413816">if</span>&nbsp;<span class="ident" id="6413819">err</span>&nbsp;<span class="op" id="6413823">!=</span>&nbsp;<span class="ident" id="6413826">nil</span>&nbsp;<span class="op" id="6413830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413834">t</span><span class="op" id="6413835">.</span><span class="ident" id="6413836">Errorf</span><span class="op" id="6413842">(</span><span class="string" id="6413843">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6413885">,</span>&nbsp;<span class="ident" id="6413887">err</span><span class="op" id="6413890">.</span><span class="ident" id="6413891">Error</span><span class="op" id="6413896">(</span><span class="op" id="6413897">)</span><span class="op" id="6413898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413901">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413904">if</span>&nbsp;<span class="ident" id="6413907">reply</span><span class="op" id="6413912">.</span><span class="ident" id="6413913">C</span>&nbsp;<span class="op" id="6413915">!=</span>&nbsp;<span class="ident" id="6413918">args</span><span class="op" id="6413922">.</span><span class="ident" id="6413923">A</span><span class="op" id="6413924">+</span><span class="ident" id="6413925">args</span><span class="op" id="6413929">.</span><span class="ident" id="6413930">B</span>&nbsp;<span class="op" id="6413932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413936">t</span><span class="op" id="6413937">.</span><span class="ident" id="6413938">Errorf</span><span class="op" id="6413944">(</span><span class="string" id="6413945">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6413970">,</span>&nbsp;<span class="ident" id="6413972">reply</span><span class="op" id="6413977">.</span><span class="ident" id="6413978">C</span><span class="op" id="6413979">,</span>&nbsp;<span class="ident" id="6413981">args</span><span class="op" id="6413985">.</span><span class="ident" id="6413986">A</span><span class="op" id="6413987">+</span><span class="ident" id="6413988">args</span><span class="op" id="6413992">.</span><span class="ident" id="6413993">B</span><span class="op" id="6413994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413997">}</span><br>
<span class="lineno"></span><span class="op" id="6413999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="6414002">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6414075">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="6414112">type</span>&nbsp;<span class="ident" id="6414117">CodecEmulator</span>&nbsp;<span class="keyword" id="6414131">struct</span>&nbsp;<span class="op" id="6414138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414141">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6414155">*</span><span class="ident" id="6414156">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414164">serviceMethod</span>&nbsp;<span class="builtintype" id="6414178">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414186">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6414200">*</span><span class="ident" id="6414201">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414207">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6414221">*</span><span class="ident" id="6414222">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414229">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6414243">error</span><br>
<span class="lineno"></span><span class="op" id="6414249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="6414252">func</span>&nbsp;<span class="op" id="6414257">(</span><span class="ident" id="6414258">codec</span>&nbsp;<span class="op" id="6414264">*</span><span class="ident" id="6414265">CodecEmulator</span><span class="op" id="6414278">)</span>&nbsp;<span class="ident" id="6414280">Call</span><span class="op" id="6414284">(</span><span class="ident" id="6414285">serviceMethod</span>&nbsp;<span class="builtintype" id="6414299">string</span><span class="op" id="6414305">,</span>&nbsp;<span class="ident" id="6414307">args</span>&nbsp;<span class="op" id="6414312">*</span><span class="ident" id="6414313">Args</span><span class="op" id="6414317">,</span>&nbsp;<span class="ident" id="6414319">reply</span>&nbsp;<span class="op" id="6414325">*</span><span class="ident" id="6414326">Reply</span><span class="op" id="6414331">)</span>&nbsp;<span class="builtintype" id="6414333">error</span>&nbsp;<span class="op" id="6414339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414342">codec</span><span class="op" id="6414347">.</span><span class="ident" id="6414348">serviceMethod</span>&nbsp;<span class="op" id="6414362">=</span>&nbsp;<span class="ident" id="6414364">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414379">codec</span><span class="op" id="6414384">.</span><span class="ident" id="6414385">args</span>&nbsp;<span class="op" id="6414390">=</span>&nbsp;<span class="ident" id="6414392">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414398">codec</span><span class="op" id="6414403">.</span><span class="ident" id="6414404">reply</span>&nbsp;<span class="op" id="6414410">=</span>&nbsp;<span class="ident" id="6414412">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414419">codec</span><span class="op" id="6414424">.</span><span class="ident" id="6414425">err</span>&nbsp;<span class="op" id="6414429">=</span>&nbsp;<span class="ident" id="6414431">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414436">var</span>&nbsp;<span class="ident" id="6414440">serverError</span>&nbsp;<span class="builtintype" id="6414452">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414459">if</span>&nbsp;<span class="ident" id="6414462">codec</span><span class="op" id="6414467">.</span><span class="ident" id="6414468">server</span>&nbsp;<span class="op" id="6414475">==</span>&nbsp;<span class="ident" id="6414478">nil</span>&nbsp;<span class="op" id="6414482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414486">serverError</span>&nbsp;<span class="op" id="6414498">=</span>&nbsp;<span class="ident" id="6414500">ServeRequest</span><span class="op" id="6414512">(</span><span class="ident" id="6414513">codec</span><span class="op" id="6414518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6414521">}</span>&nbsp;<span class="keyword" id="6414523">else</span>&nbsp;<span class="op" id="6414528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414532">serverError</span>&nbsp;<span class="op" id="6414544">=</span>&nbsp;<span class="ident" id="6414546">codec</span><span class="op" id="6414551">.</span><span class="ident" id="6414552">server</span><span class="op" id="6414558">.</span><span class="ident" id="6414559">ServeRequest</span><span class="op" id="6414571">(</span><span class="ident" id="6414572">codec</span><span class="op" id="6414577">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6414580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414583">if</span>&nbsp;<span class="ident" id="6414586">codec</span><span class="op" id="6414591">.</span><span class="ident" id="6414592">err</span>&nbsp;<span class="op" id="6414596">==</span>&nbsp;<span class="ident" id="6414599">nil</span>&nbsp;<span class="op" id="6414603">&amp;&amp;</span>&nbsp;<span class="ident" id="6414606">serverError</span>&nbsp;<span class="op" id="6414618">!=</span>&nbsp;<span class="ident" id="6414621">nil</span>&nbsp;<span class="op" id="6414625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414629">codec</span><span class="op" id="6414634">.</span><span class="ident" id="6414635">err</span>&nbsp;<span class="op" id="6414639">=</span>&nbsp;<span class="ident" id="6414641">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6414654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414657">return</span>&nbsp;<span class="ident" id="6414664">codec</span><span class="op" id="6414669">.</span><span class="ident" id="6414670">err</span><br>
<span class="lineno">330</span><span class="op" id="6414674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6414677">func</span>&nbsp;<span class="op" id="6414682">(</span><span class="ident" id="6414683">codec</span>&nbsp;<span class="op" id="6414689">*</span><span class="ident" id="6414690">CodecEmulator</span><span class="op" id="6414703">)</span>&nbsp;<span class="ident" id="6414705">ReadRequestHeader</span><span class="op" id="6414722">(</span><span class="ident" id="6414723">req</span>&nbsp;<span class="op" id="6414727">*</span><span class="ident" id="6414728">Request</span><span class="op" id="6414735">)</span>&nbsp;<span class="builtintype" id="6414737">error</span>&nbsp;<span class="op" id="6414743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414746">req</span><span class="op" id="6414749">.</span><span class="ident" id="6414750">ServiceMethod</span>&nbsp;<span class="op" id="6414764">=</span>&nbsp;<span class="ident" id="6414766">codec</span><span class="op" id="6414771">.</span><span class="ident" id="6414772">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414787">req</span><span class="op" id="6414790">.</span><span class="ident" id="6414791">Seq</span>&nbsp;<span class="op" id="6414795">=</span>&nbsp;<span class="num" id="6414797">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414800">return</span>&nbsp;<span class="ident" id="6414807">nil</span><br>
<span class="lineno"></span><span class="op" id="6414811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6414814">func</span>&nbsp;<span class="op" id="6414819">(</span><span class="ident" id="6414820">codec</span>&nbsp;<span class="op" id="6414826">*</span><span class="ident" id="6414827">CodecEmulator</span><span class="op" id="6414840">)</span>&nbsp;<span class="ident" id="6414842">ReadRequestBody</span><span class="op" id="6414857">(</span><span class="ident" id="6414858">argv</span>&nbsp;<span class="keyword" id="6414863">interface</span><span class="op" id="6414872">{</span><span class="op" id="6414873">}</span><span class="op" id="6414874">)</span>&nbsp;<span class="builtintype" id="6414876">error</span>&nbsp;<span class="op" id="6414882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414885">if</span>&nbsp;<span class="ident" id="6414888">codec</span><span class="op" id="6414893">.</span><span class="ident" id="6414894">args</span>&nbsp;<span class="op" id="6414899">==</span>&nbsp;<span class="ident" id="6414902">nil</span>&nbsp;<span class="op" id="6414906">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414910">return</span>&nbsp;<span class="ident" id="6414917">io</span><span class="op" id="6414919">.</span><span class="ident" id="6414920">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6414938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6414941">*</span><span class="op" id="6414942">(</span><span class="ident" id="6414943">argv</span><span class="op" id="6414947">.</span><span class="op" id="6414948">(</span><span class="op" id="6414949">*</span><span class="ident" id="6414950">Args</span><span class="op" id="6414954">)</span><span class="op" id="6414955">)</span>&nbsp;<span class="op" id="6414957">=</span>&nbsp;<span class="op" id="6414959">*</span><span class="ident" id="6414960">codec</span><span class="op" id="6414965">.</span><span class="ident" id="6414966">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414972">return</span>&nbsp;<span class="ident" id="6414979">nil</span><br>
<span class="lineno"></span><span class="op" id="6414983">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6414986">func</span>&nbsp;<span class="op" id="6414991">(</span><span class="ident" id="6414992">codec</span>&nbsp;<span class="op" id="6414998">*</span><span class="ident" id="6414999">CodecEmulator</span><span class="op" id="6415012">)</span>&nbsp;<span class="ident" id="6415014">WriteResponse</span><span class="op" id="6415027">(</span><span class="ident" id="6415028">resp</span>&nbsp;<span class="op" id="6415033">*</span><span class="ident" id="6415034">Response</span><span class="op" id="6415042">,</span>&nbsp;<span class="ident" id="6415044">reply</span>&nbsp;<span class="keyword" id="6415050">interface</span><span class="op" id="6415059">{</span><span class="op" id="6415060">}</span><span class="op" id="6415061">)</span>&nbsp;<span class="builtintype" id="6415063">error</span>&nbsp;<span class="op" id="6415069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415072">if</span>&nbsp;<span class="ident" id="6415075">resp</span><span class="op" id="6415079">.</span><span class="ident" id="6415080">Error</span>&nbsp;<span class="op" id="6415086">!=</span>&nbsp;<span class="string" id="6415089">&#34;&#34;</span>&nbsp;<span class="op" id="6415092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415096">codec</span><span class="op" id="6415101">.</span><span class="ident" id="6415102">err</span>&nbsp;<span class="op" id="6415106">=</span>&nbsp;<span class="ident" id="6415108">errors</span><span class="op" id="6415114">.</span><span class="ident" id="6415115">New</span><span class="op" id="6415118">(</span><span class="ident" id="6415119">resp</span><span class="op" id="6415123">.</span><span class="ident" id="6415124">Error</span><span class="op" id="6415129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415132">}</span>&nbsp;<span class="keyword" id="6415134">else</span>&nbsp;<span class="op" id="6415139">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415143">*</span><span class="ident" id="6415144">codec</span><span class="op" id="6415149">.</span><span class="ident" id="6415150">reply</span>&nbsp;<span class="op" id="6415156">=</span>&nbsp;<span class="op" id="6415158">*</span><span class="op" id="6415159">(</span><span class="ident" id="6415160">reply</span><span class="op" id="6415165">.</span><span class="op" id="6415166">(</span><span class="op" id="6415167">*</span><span class="ident" id="6415168">Reply</span><span class="op" id="6415173">)</span><span class="op" id="6415174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415180">return</span>&nbsp;<span class="ident" id="6415187">nil</span><br>
<span class="lineno"></span><span class="op" id="6415191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="6415194">func</span>&nbsp;<span class="op" id="6415199">(</span><span class="ident" id="6415200">codec</span>&nbsp;<span class="op" id="6415206">*</span><span class="ident" id="6415207">CodecEmulator</span><span class="op" id="6415220">)</span>&nbsp;<span class="ident" id="6415222">Close</span><span class="op" id="6415227">(</span><span class="op" id="6415228">)</span>&nbsp;<span class="builtintype" id="6415230">error</span>&nbsp;<span class="op" id="6415236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415239">return</span>&nbsp;<span class="ident" id="6415246">nil</span><br>
<span class="lineno"></span><span class="op" id="6415250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6415253">func</span>&nbsp;<span class="ident" id="6415258">TestServeRequest</span><span class="op" id="6415274">(</span><span class="ident" id="6415275">t</span>&nbsp;<span class="op" id="6415277">*</span><span class="ident" id="6415278">testing</span><span class="op" id="6415285">.</span><span class="ident" id="6415286">T</span><span class="op" id="6415287">)</span>&nbsp;<span class="op" id="6415289">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415292">once</span><span class="op" id="6415296">.</span><span class="ident" id="6415297">Do</span><span class="op" id="6415299">(</span><span class="ident" id="6415300">startServer</span><span class="op" id="6415311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415314">testServeRequest</span><span class="op" id="6415330">(</span><span class="ident" id="6415331">t</span><span class="op" id="6415332">,</span>&nbsp;<span class="ident" id="6415334">nil</span><span class="op" id="6415337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415340">newOnce</span><span class="op" id="6415347">.</span><span class="ident" id="6415348">Do</span><span class="op" id="6415350">(</span><span class="ident" id="6415351">startNewServer</span><span class="op" id="6415365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415368">testServeRequest</span><span class="op" id="6415384">(</span><span class="ident" id="6415385">t</span><span class="op" id="6415386">,</span>&nbsp;<span class="ident" id="6415388">newServer</span><span class="op" id="6415397">)</span><br>
<span class="lineno"></span><span class="op" id="6415399">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6415402">func</span>&nbsp;<span class="ident" id="6415407">testServeRequest</span><span class="op" id="6415423">(</span><span class="ident" id="6415424">t</span>&nbsp;<span class="op" id="6415426">*</span><span class="ident" id="6415427">testing</span><span class="op" id="6415434">.</span><span class="ident" id="6415435">T</span><span class="op" id="6415436">,</span>&nbsp;<span class="ident" id="6415438">server</span>&nbsp;<span class="op" id="6415445">*</span><span class="ident" id="6415446">Server</span><span class="op" id="6415452">)</span>&nbsp;<span class="op" id="6415454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415457">client</span>&nbsp;<span class="op" id="6415464">:=</span>&nbsp;<span class="ident" id="6415467">CodecEmulator</span><span class="op" id="6415480">{</span><span class="ident" id="6415481">server</span><span class="op" id="6415487">:</span>&nbsp;<span class="ident" id="6415489">server</span><span class="op" id="6415495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415498">defer</span>&nbsp;<span class="ident" id="6415504">client</span><span class="op" id="6415510">.</span><span class="ident" id="6415511">Close</span><span class="op" id="6415516">(</span><span class="op" id="6415517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415521">args</span>&nbsp;<span class="op" id="6415526">:=</span>&nbsp;<span class="op" id="6415529">&amp;</span><span class="ident" id="6415530">Args</span><span class="op" id="6415534">{</span><span class="num" id="6415535">7</span><span class="op" id="6415536">,</span>&nbsp;<span class="num" id="6415538">8</span><span class="op" id="6415539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415542">reply</span>&nbsp;<span class="op" id="6415548">:=</span>&nbsp;<span class="builtinfunc" id="6415551">new</span><span class="op" id="6415554">(</span><span class="ident" id="6415555">Reply</span><span class="op" id="6415560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415563">err</span>&nbsp;<span class="op" id="6415567">:=</span>&nbsp;<span class="ident" id="6415570">client</span><span class="op" id="6415576">.</span><span class="ident" id="6415577">Call</span><span class="op" id="6415581">(</span><span class="string" id="6415582">&#34;Arith.Add&#34;</span><span class="op" id="6415593">,</span>&nbsp;<span class="ident" id="6415595">args</span><span class="op" id="6415599">,</span>&nbsp;<span class="ident" id="6415601">reply</span><span class="op" id="6415606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415609">if</span>&nbsp;<span class="ident" id="6415612">err</span>&nbsp;<span class="op" id="6415616">!=</span>&nbsp;<span class="ident" id="6415619">nil</span>&nbsp;<span class="op" id="6415623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415627">t</span><span class="op" id="6415628">.</span><span class="ident" id="6415629">Errorf</span><span class="op" id="6415635">(</span><span class="string" id="6415636">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6415678">,</span>&nbsp;<span class="ident" id="6415680">err</span><span class="op" id="6415683">.</span><span class="ident" id="6415684">Error</span><span class="op" id="6415689">(</span><span class="op" id="6415690">)</span><span class="op" id="6415691">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415697">if</span>&nbsp;<span class="ident" id="6415700">reply</span><span class="op" id="6415705">.</span><span class="ident" id="6415706">C</span>&nbsp;<span class="op" id="6415708">!=</span>&nbsp;<span class="ident" id="6415711">args</span><span class="op" id="6415715">.</span><span class="ident" id="6415716">A</span><span class="op" id="6415717">+</span><span class="ident" id="6415718">args</span><span class="op" id="6415722">.</span><span class="ident" id="6415723">B</span>&nbsp;<span class="op" id="6415725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415729">t</span><span class="op" id="6415730">.</span><span class="ident" id="6415731">Errorf</span><span class="op" id="6415737">(</span><span class="string" id="6415738">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6415763">,</span>&nbsp;<span class="ident" id="6415765">reply</span><span class="op" id="6415770">.</span><span class="ident" id="6415771">C</span><span class="op" id="6415772">,</span>&nbsp;<span class="ident" id="6415774">args</span><span class="op" id="6415778">.</span><span class="ident" id="6415779">A</span><span class="op" id="6415780">+</span><span class="ident" id="6415781">args</span><span class="op" id="6415785">.</span><span class="ident" id="6415786">B</span><span class="op" id="6415787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415794">err</span>&nbsp;<span class="op" id="6415798">=</span>&nbsp;<span class="ident" id="6415800">client</span><span class="op" id="6415806">.</span><span class="ident" id="6415807">Call</span><span class="op" id="6415811">(</span><span class="string" id="6415812">&#34;Arith.Add&#34;</span><span class="op" id="6415823">,</span>&nbsp;<span class="ident" id="6415825">nil</span><span class="op" id="6415828">,</span>&nbsp;<span class="ident" id="6415830">reply</span><span class="op" id="6415835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415838">if</span>&nbsp;<span class="ident" id="6415841">err</span>&nbsp;<span class="op" id="6415845">==</span>&nbsp;<span class="ident" id="6415848">nil</span>&nbsp;<span class="op" id="6415852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415856">t</span><span class="op" id="6415857">.</span><span class="ident" id="6415858">Errorf</span><span class="op" id="6415864">(</span><span class="string" id="6415865">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="6415912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415915">}</span><br>
<span class="lineno"></span><span class="op" id="6415917">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="6415920">type</span>&nbsp;<span class="ident" id="6415925">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="6415941">int</span><br>
<span class="lineno"></span><span class="keyword" id="6415945">type</span>&nbsp;<span class="ident" id="6415950">ArgNotPublic</span>&nbsp;<span class="builtintype" id="6415963">int</span><br>
<span class="lineno"></span><span class="keyword" id="6415967">type</span>&nbsp;<span class="ident" id="6415972">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="6415987">int</span><br>
<span class="lineno"></span><span class="keyword" id="6415991">type</span>&nbsp;<span class="ident" id="6415996">NeedsPtrType</span>&nbsp;<span class="builtintype" id="6416009">int</span><br>
<span class="lineno">390</span><span class="keyword" id="6416013">type</span>&nbsp;<span class="ident" id="6416018">local</span>&nbsp;<span class="keyword" id="6416024">struct</span><span class="op" id="6416030">{</span><span class="op" id="6416031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6416034">func</span>&nbsp;<span class="op" id="6416039">(</span><span class="ident" id="6416040">t</span>&nbsp;<span class="op" id="6416042">*</span><span class="ident" id="6416043">ReplyNotPointer</span><span class="op" id="6416058">)</span>&nbsp;<span class="ident" id="6416060">ReplyNotPointer</span><span class="op" id="6416075">(</span><span class="ident" id="6416076">args</span>&nbsp;<span class="op" id="6416081">*</span><span class="ident" id="6416082">Args</span><span class="op" id="6416086">,</span>&nbsp;<span class="ident" id="6416088">reply</span>&nbsp;<span class="ident" id="6416094">Reply</span><span class="op" id="6416099">)</span>&nbsp;<span class="builtintype" id="6416101">error</span>&nbsp;<span class="op" id="6416107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416110">return</span>&nbsp;<span class="ident" id="6416117">nil</span><br>
<span class="lineno"></span><span class="op" id="6416121">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6416124">func</span>&nbsp;<span class="op" id="6416129">(</span><span class="ident" id="6416130">t</span>&nbsp;<span class="op" id="6416132">*</span><span class="ident" id="6416133">ArgNotPublic</span><span class="op" id="6416145">)</span>&nbsp;<span class="ident" id="6416147">ArgNotPublic</span><span class="op" id="6416159">(</span><span class="ident" id="6416160">args</span>&nbsp;<span class="op" id="6416165">*</span><span class="ident" id="6416166">local</span><span class="op" id="6416171">,</span>&nbsp;<span class="ident" id="6416173">reply</span>&nbsp;<span class="op" id="6416179">*</span><span class="ident" id="6416180">Reply</span><span class="op" id="6416185">)</span>&nbsp;<span class="builtintype" id="6416187">error</span>&nbsp;<span class="op" id="6416193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416196">return</span>&nbsp;<span class="ident" id="6416203">nil</span><br>
<span class="lineno"></span><span class="op" id="6416207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="6416210">func</span>&nbsp;<span class="op" id="6416215">(</span><span class="ident" id="6416216">t</span>&nbsp;<span class="op" id="6416218">*</span><span class="ident" id="6416219">ReplyNotPublic</span><span class="op" id="6416233">)</span>&nbsp;<span class="ident" id="6416235">ReplyNotPublic</span><span class="op" id="6416249">(</span><span class="ident" id="6416250">args</span>&nbsp;<span class="op" id="6416255">*</span><span class="ident" id="6416256">Args</span><span class="op" id="6416260">,</span>&nbsp;<span class="ident" id="6416262">reply</span>&nbsp;<span class="op" id="6416268">*</span><span class="ident" id="6416269">local</span><span class="op" id="6416274">)</span>&nbsp;<span class="builtintype" id="6416276">error</span>&nbsp;<span class="op" id="6416282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416285">return</span>&nbsp;<span class="ident" id="6416292">nil</span><br>
<span class="lineno"></span><span class="op" id="6416296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6416299">func</span>&nbsp;<span class="op" id="6416304">(</span><span class="ident" id="6416305">t</span>&nbsp;<span class="op" id="6416307">*</span><span class="ident" id="6416308">NeedsPtrType</span><span class="op" id="6416320">)</span>&nbsp;<span class="ident" id="6416322">NeedsPtrType</span><span class="op" id="6416334">(</span><span class="ident" id="6416335">args</span>&nbsp;<span class="op" id="6416340">*</span><span class="ident" id="6416341">Args</span><span class="op" id="6416345">,</span>&nbsp;<span class="ident" id="6416347">reply</span>&nbsp;<span class="op" id="6416353">*</span><span class="ident" id="6416354">Reply</span><span class="op" id="6416359">)</span>&nbsp;<span class="builtintype" id="6416361">error</span>&nbsp;<span class="op" id="6416367">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416370">return</span>&nbsp;<span class="ident" id="6416377">nil</span><br>
<span class="lineno"></span><span class="op" id="6416381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6416384">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6416476">func</span>&nbsp;<span class="ident" id="6416481">TestRegistrationError</span><span class="op" id="6416502">(</span><span class="ident" id="6416503">t</span>&nbsp;<span class="op" id="6416505">*</span><span class="ident" id="6416506">testing</span><span class="op" id="6416513">.</span><span class="ident" id="6416514">T</span><span class="op" id="6416515">)</span>&nbsp;<span class="op" id="6416517">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416520">err</span>&nbsp;<span class="op" id="6416524">:=</span>&nbsp;<span class="ident" id="6416527">Register</span><span class="op" id="6416535">(</span><span class="builtinfunc" id="6416536">new</span><span class="op" id="6416539">(</span><span class="ident" id="6416540">ReplyNotPointer</span><span class="op" id="6416555">)</span><span class="op" id="6416556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416559">if</span>&nbsp;<span class="ident" id="6416562">err</span>&nbsp;<span class="op" id="6416566">==</span>&nbsp;<span class="ident" id="6416569">nil</span>&nbsp;<span class="op" id="6416573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416577">t</span><span class="op" id="6416578">.</span><span class="ident" id="6416579">Error</span><span class="op" id="6416584">(</span><span class="string" id="6416585">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="6416629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6416632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416635">err</span>&nbsp;<span class="op" id="6416639">=</span>&nbsp;<span class="ident" id="6416641">Register</span><span class="op" id="6416649">(</span><span class="builtinfunc" id="6416650">new</span><span class="op" id="6416653">(</span><span class="ident" id="6416654">ArgNotPublic</span><span class="op" id="6416666">)</span><span class="op" id="6416667">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416670">if</span>&nbsp;<span class="ident" id="6416673">err</span>&nbsp;<span class="op" id="6416677">==</span>&nbsp;<span class="ident" id="6416680">nil</span>&nbsp;<span class="op" id="6416684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416688">t</span><span class="op" id="6416689">.</span><span class="ident" id="6416690">Error</span><span class="op" id="6416695">(</span><span class="string" id="6416696">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="6416737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6416740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416743">err</span>&nbsp;<span class="op" id="6416747">=</span>&nbsp;<span class="ident" id="6416749">Register</span><span class="op" id="6416757">(</span><span class="builtinfunc" id="6416758">new</span><span class="op" id="6416761">(</span><span class="ident" id="6416762">ReplyNotPublic</span><span class="op" id="6416776">)</span><span class="op" id="6416777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416780">if</span>&nbsp;<span class="ident" id="6416783">err</span>&nbsp;<span class="op" id="6416787">==</span>&nbsp;<span class="ident" id="6416790">nil</span>&nbsp;<span class="op" id="6416794">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416798">t</span><span class="op" id="6416799">.</span><span class="ident" id="6416800">Error</span><span class="op" id="6416805">(</span><span class="string" id="6416806">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="6416849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6416852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416855">err</span>&nbsp;<span class="op" id="6416859">=</span>&nbsp;<span class="ident" id="6416861">Register</span><span class="op" id="6416869">(</span><span class="ident" id="6416870">NeedsPtrType</span><span class="op" id="6416882">(</span><span class="num" id="6416883">0</span><span class="op" id="6416884">)</span><span class="op" id="6416885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416888">if</span>&nbsp;<span class="ident" id="6416891">err</span>&nbsp;<span class="op" id="6416895">==</span>&nbsp;<span class="ident" id="6416898">nil</span>&nbsp;<span class="op" id="6416902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416906">t</span><span class="op" id="6416907">.</span><span class="ident" id="6416908">Error</span><span class="op" id="6416913">(</span><span class="string" id="6416914">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="6416955">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6416958">}</span>&nbsp;<span class="keyword" id="6416960">else</span>&nbsp;<span class="keyword" id="6416965">if</span>&nbsp;<span class="op" id="6416968">!</span><span class="ident" id="6416969">strings</span><span class="op" id="6416976">.</span><span class="ident" id="6416977">Contains</span><span class="op" id="6416985">(</span><span class="ident" id="6416986">err</span><span class="op" id="6416989">.</span><span class="ident" id="6416990">Error</span><span class="op" id="6416995">(</span><span class="op" id="6416996">)</span><span class="op" id="6416997">,</span>&nbsp;<span class="string" id="6416999">&#34;pointer&#34;</span><span class="op" id="6417008">)</span>&nbsp;<span class="op" id="6417010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417014">t</span><span class="op" id="6417015">.</span><span class="ident" id="6417016">Error</span><span class="op" id="6417021">(</span><span class="string" id="6417022">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="6417067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417070">}</span><br>
<span class="lineno"></span><span class="op" id="6417072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="6417075">type</span>&nbsp;<span class="ident" id="6417080">WriteFailCodec</span>&nbsp;<span class="builtintype" id="6417095">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6417100">func</span>&nbsp;<span class="op" id="6417105">(</span><span class="ident" id="6417106">WriteFailCodec</span><span class="op" id="6417120">)</span>&nbsp;<span class="ident" id="6417122">WriteRequest</span><span class="op" id="6417134">(</span><span class="op" id="6417135">*</span><span class="ident" id="6417136">Request</span><span class="op" id="6417143">,</span>&nbsp;<span class="keyword" id="6417145">interface</span><span class="op" id="6417154">{</span><span class="op" id="6417155">}</span><span class="op" id="6417156">)</span>&nbsp;<span class="builtintype" id="6417158">error</span>&nbsp;<span class="op" id="6417164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6417167">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417229">return</span>&nbsp;<span class="ident" id="6417236">errors</span><span class="op" id="6417242">.</span><span class="ident" id="6417243">New</span><span class="op" id="6417246">(</span><span class="string" id="6417247">&#34;fail&#34;</span><span class="op" id="6417253">)</span><br>
<span class="lineno">435</span><span class="op" id="6417255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6417258">func</span>&nbsp;<span class="op" id="6417263">(</span><span class="ident" id="6417264">WriteFailCodec</span><span class="op" id="6417278">)</span>&nbsp;<span class="ident" id="6417280">ReadResponseHeader</span><span class="op" id="6417298">(</span><span class="op" id="6417299">*</span><span class="ident" id="6417300">Response</span><span class="op" id="6417308">)</span>&nbsp;<span class="builtintype" id="6417310">error</span>&nbsp;<span class="op" id="6417316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417319">select</span>&nbsp;<span class="op" id="6417326">{</span><span class="op" id="6417327">}</span><br>
<span class="lineno"></span><span class="op" id="6417329">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="6417332">func</span>&nbsp;<span class="op" id="6417337">(</span><span class="ident" id="6417338">WriteFailCodec</span><span class="op" id="6417352">)</span>&nbsp;<span class="ident" id="6417354">ReadResponseBody</span><span class="op" id="6417370">(</span><span class="keyword" id="6417371">interface</span><span class="op" id="6417380">{</span><span class="op" id="6417381">}</span><span class="op" id="6417382">)</span>&nbsp;<span class="builtintype" id="6417384">error</span>&nbsp;<span class="op" id="6417390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417393">select</span>&nbsp;<span class="op" id="6417400">{</span><span class="op" id="6417401">}</span><br>
<span class="lineno"></span><span class="op" id="6417403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="6417406">func</span>&nbsp;<span class="op" id="6417411">(</span><span class="ident" id="6417412">WriteFailCodec</span><span class="op" id="6417426">)</span>&nbsp;<span class="ident" id="6417428">Close</span><span class="op" id="6417433">(</span><span class="op" id="6417434">)</span>&nbsp;<span class="builtintype" id="6417436">error</span>&nbsp;<span class="op" id="6417442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417445">return</span>&nbsp;<span class="ident" id="6417452">nil</span><br>
<span class="lineno"></span><span class="op" id="6417456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6417459">func</span>&nbsp;<span class="ident" id="6417464">TestSendDeadlock</span><span class="op" id="6417480">(</span><span class="ident" id="6417481">t</span>&nbsp;<span class="op" id="6417483">*</span><span class="ident" id="6417484">testing</span><span class="op" id="6417491">.</span><span class="ident" id="6417492">T</span><span class="op" id="6417493">)</span>&nbsp;<span class="op" id="6417495">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417498">client</span>&nbsp;<span class="op" id="6417505">:=</span>&nbsp;<span class="ident" id="6417508">NewClientWithCodec</span><span class="op" id="6417526">(</span><span class="ident" id="6417527">WriteFailCodec</span><span class="op" id="6417541">(</span><span class="num" id="6417542">0</span><span class="op" id="6417543">)</span><span class="op" id="6417544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417547">defer</span>&nbsp;<span class="ident" id="6417553">client</span><span class="op" id="6417559">.</span><span class="ident" id="6417560">Close</span><span class="op" id="6417565">(</span><span class="op" id="6417566">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417570">done</span>&nbsp;<span class="op" id="6417575">:=</span>&nbsp;<span class="builtinfunc" id="6417578">make</span><span class="op" id="6417582">(</span><span class="keyword" id="6417583">chan</span>&nbsp;<span class="builtintype" id="6417588">bool</span><span class="op" id="6417592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417595">go</span>&nbsp;<span class="keyword" id="6417598">func</span><span class="op" id="6417602">(</span><span class="op" id="6417603">)</span>&nbsp;<span class="op" id="6417605">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417609">testSendDeadlock</span><span class="op" id="6417625">(</span><span class="ident" id="6417626">client</span><span class="op" id="6417632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417636">testSendDeadlock</span><span class="op" id="6417652">(</span><span class="ident" id="6417653">client</span><span class="op" id="6417659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417663">done</span>&nbsp;<span class="op" id="6417668">&lt;-</span>&nbsp;<span class="builtintype" id="6417671">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417677">}</span><span class="op" id="6417678">(</span><span class="op" id="6417679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417682">select</span>&nbsp;<span class="op" id="6417689">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417692">case</span>&nbsp;<span class="op" id="6417697">&lt;-</span><span class="ident" id="6417699">done</span><span class="op" id="6417703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417707">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417715">case</span>&nbsp;<span class="op" id="6417720">&lt;-</span><span class="ident" id="6417722">time</span><span class="op" id="6417726">.</span><span class="ident" id="6417727">After</span><span class="op" id="6417732">(</span><span class="num" id="6417733">5</span>&nbsp;<span class="op" id="6417735">*</span>&nbsp;<span class="ident" id="6417737">time</span><span class="op" id="6417741">.</span><span class="ident" id="6417742">Second</span><span class="op" id="6417748">)</span><span class="op" id="6417749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417753">t</span><span class="op" id="6417754">.</span><span class="ident" id="6417755">Fatal</span><span class="op" id="6417760">(</span><span class="string" id="6417761">&#34;deadlock&#34;</span><span class="op" id="6417771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417774">}</span><br>
<span class="lineno">465</span><span class="op" id="6417776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6417779">func</span>&nbsp;<span class="ident" id="6417784">testSendDeadlock</span><span class="op" id="6417800">(</span><span class="ident" id="6417801">client</span>&nbsp;<span class="op" id="6417808">*</span><span class="ident" id="6417809">Client</span><span class="op" id="6417815">)</span>&nbsp;<span class="op" id="6417817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417820">defer</span>&nbsp;<span class="keyword" id="6417826">func</span><span class="op" id="6417830">(</span><span class="op" id="6417831">)</span>&nbsp;<span class="op" id="6417833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6417837">recover</span><span class="op" id="6417844">(</span><span class="op" id="6417845">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417848">}</span><span class="op" id="6417849">(</span><span class="op" id="6417850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417853">args</span>&nbsp;<span class="op" id="6417858">:=</span>&nbsp;<span class="op" id="6417861">&amp;</span><span class="ident" id="6417862">Args</span><span class="op" id="6417866">{</span><span class="num" id="6417867">7</span><span class="op" id="6417868">,</span>&nbsp;<span class="num" id="6417870">8</span><span class="op" id="6417871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417874">reply</span>&nbsp;<span class="op" id="6417880">:=</span>&nbsp;<span class="builtinfunc" id="6417883">new</span><span class="op" id="6417886">(</span><span class="ident" id="6417887">Reply</span><span class="op" id="6417892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417895">client</span><span class="op" id="6417901">.</span><span class="ident" id="6417902">Call</span><span class="op" id="6417906">(</span><span class="string" id="6417907">&#34;Arith.Add&#34;</span><span class="op" id="6417918">,</span>&nbsp;<span class="ident" id="6417920">args</span><span class="op" id="6417924">,</span>&nbsp;<span class="ident" id="6417926">reply</span><span class="op" id="6417931">)</span><br>
<span class="lineno"></span><span class="op" id="6417933">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="6417936">func</span>&nbsp;<span class="ident" id="6417941">dialDirect</span><span class="op" id="6417951">(</span><span class="op" id="6417952">)</span>&nbsp;<span class="op" id="6417954">(</span><span class="op" id="6417955">*</span><span class="ident" id="6417956">Client</span><span class="op" id="6417962">,</span>&nbsp;<span class="builtintype" id="6417964">error</span><span class="op" id="6417969">)</span>&nbsp;<span class="op" id="6417971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417974">return</span>&nbsp;<span class="ident" id="6417981">Dial</span><span class="op" id="6417985">(</span><span class="string" id="6417986">&#34;tcp&#34;</span><span class="op" id="6417991">,</span>&nbsp;<span class="ident" id="6417993">serverAddr</span><span class="op" id="6418003">)</span><br>
<span class="lineno"></span><span class="op" id="6418005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="6418008">func</span>&nbsp;<span class="ident" id="6418013">dialHTTP</span><span class="op" id="6418021">(</span><span class="op" id="6418022">)</span>&nbsp;<span class="op" id="6418024">(</span><span class="op" id="6418025">*</span><span class="ident" id="6418026">Client</span><span class="op" id="6418032">,</span>&nbsp;<span class="builtintype" id="6418034">error</span><span class="op" id="6418039">)</span>&nbsp;<span class="op" id="6418041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418044">return</span>&nbsp;<span class="ident" id="6418051">DialHTTP</span><span class="op" id="6418059">(</span><span class="string" id="6418060">&#34;tcp&#34;</span><span class="op" id="6418065">,</span>&nbsp;<span class="ident" id="6418067">httpServerAddr</span><span class="op" id="6418081">)</span><br>
<span class="lineno"></span><span class="op" id="6418083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6418086">func</span>&nbsp;<span class="ident" id="6418091">countMallocs</span><span class="op" id="6418103">(</span><span class="ident" id="6418104">dial</span>&nbsp;<span class="keyword" id="6418109">func</span><span class="op" id="6418113">(</span><span class="op" id="6418114">)</span>&nbsp;<span class="op" id="6418116">(</span><span class="op" id="6418117">*</span><span class="ident" id="6418118">Client</span><span class="op" id="6418124">,</span>&nbsp;<span class="builtintype" id="6418126">error</span><span class="op" id="6418131">)</span><span class="op" id="6418132">,</span>&nbsp;<span class="ident" id="6418134">t</span>&nbsp;<span class="op" id="6418136">*</span><span class="ident" id="6418137">testing</span><span class="op" id="6418144">.</span><span class="ident" id="6418145">T</span><span class="op" id="6418146">)</span>&nbsp;<span class="builtintype" id="6418148">float64</span>&nbsp;<span class="op" id="6418156">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418159">once</span><span class="op" id="6418163">.</span><span class="ident" id="6418164">Do</span><span class="op" id="6418166">(</span><span class="ident" id="6418167">startServer</span><span class="op" id="6418178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418181">client</span><span class="op" id="6418187">,</span>&nbsp;<span class="ident" id="6418189">err</span>&nbsp;<span class="op" id="6418193">:=</span>&nbsp;<span class="ident" id="6418196">dial</span><span class="op" id="6418200">(</span><span class="op" id="6418201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418204">if</span>&nbsp;<span class="ident" id="6418207">err</span>&nbsp;<span class="op" id="6418211">!=</span>&nbsp;<span class="ident" id="6418214">nil</span>&nbsp;<span class="op" id="6418218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418222">t</span><span class="op" id="6418223">.</span><span class="ident" id="6418224">Fatal</span><span class="op" id="6418229">(</span><span class="string" id="6418230">&#34;error&nbsp;dialing&#34;</span><span class="op" id="6418245">,</span>&nbsp;<span class="ident" id="6418247">err</span><span class="op" id="6418250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418253">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418256">defer</span>&nbsp;<span class="ident" id="6418262">client</span><span class="op" id="6418268">.</span><span class="ident" id="6418269">Close</span><span class="op" id="6418274">(</span><span class="op" id="6418275">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418279">args</span>&nbsp;<span class="op" id="6418284">:=</span>&nbsp;<span class="op" id="6418287">&amp;</span><span class="ident" id="6418288">Args</span><span class="op" id="6418292">{</span><span class="num" id="6418293">7</span><span class="op" id="6418294">,</span>&nbsp;<span class="num" id="6418296">8</span><span class="op" id="6418297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418300">reply</span>&nbsp;<span class="op" id="6418306">:=</span>&nbsp;<span class="builtinfunc" id="6418309">new</span><span class="op" id="6418312">(</span><span class="ident" id="6418313">Reply</span><span class="op" id="6418318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418321">return</span>&nbsp;<span class="ident" id="6418328">testing</span><span class="op" id="6418335">.</span><span class="ident" id="6418336">AllocsPerRun</span><span class="op" id="6418348">(</span><span class="num" id="6418349">100</span><span class="op" id="6418352">,</span>&nbsp;<span class="keyword" id="6418354">func</span><span class="op" id="6418358">(</span><span class="op" id="6418359">)</span>&nbsp;<span class="op" id="6418361">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418365">err</span>&nbsp;<span class="op" id="6418369">:=</span>&nbsp;<span class="ident" id="6418372">client</span><span class="op" id="6418378">.</span><span class="ident" id="6418379">Call</span><span class="op" id="6418383">(</span><span class="string" id="6418384">&#34;Arith.Add&#34;</span><span class="op" id="6418395">,</span>&nbsp;<span class="ident" id="6418397">args</span><span class="op" id="6418401">,</span>&nbsp;<span class="ident" id="6418403">reply</span><span class="op" id="6418408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418412">if</span>&nbsp;<span class="ident" id="6418415">err</span>&nbsp;<span class="op" id="6418419">!=</span>&nbsp;<span class="ident" id="6418422">nil</span>&nbsp;<span class="op" id="6418426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418431">t</span><span class="op" id="6418432">.</span><span class="ident" id="6418433">Errorf</span><span class="op" id="6418439">(</span><span class="string" id="6418440">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6418482">,</span>&nbsp;<span class="ident" id="6418484">err</span><span class="op" id="6418487">.</span><span class="ident" id="6418488">Error</span><span class="op" id="6418493">(</span><span class="op" id="6418494">)</span><span class="op" id="6418495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418503">if</span>&nbsp;<span class="ident" id="6418506">reply</span><span class="op" id="6418511">.</span><span class="ident" id="6418512">C</span>&nbsp;<span class="op" id="6418514">!=</span>&nbsp;<span class="ident" id="6418517">args</span><span class="op" id="6418521">.</span><span class="ident" id="6418522">A</span><span class="op" id="6418523">+</span><span class="ident" id="6418524">args</span><span class="op" id="6418528">.</span><span class="ident" id="6418529">B</span>&nbsp;<span class="op" id="6418531">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418536">t</span><span class="op" id="6418537">.</span><span class="ident" id="6418538">Errorf</span><span class="op" id="6418544">(</span><span class="string" id="6418545">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6418570">,</span>&nbsp;<span class="ident" id="6418572">reply</span><span class="op" id="6418577">.</span><span class="ident" id="6418578">C</span><span class="op" id="6418579">,</span>&nbsp;<span class="ident" id="6418581">args</span><span class="op" id="6418585">.</span><span class="ident" id="6418586">A</span><span class="op" id="6418587">+</span><span class="ident" id="6418588">args</span><span class="op" id="6418592">.</span><span class="ident" id="6418593">B</span><span class="op" id="6418594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418601">}</span><span class="op" id="6418602">)</span><br>
<span class="lineno"></span><span class="op" id="6418604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="6418607">func</span>&nbsp;<span class="ident" id="6418612">TestCountMallocs</span><span class="op" id="6418628">(</span><span class="ident" id="6418629">t</span>&nbsp;<span class="op" id="6418631">*</span><span class="ident" id="6418632">testing</span><span class="op" id="6418639">.</span><span class="ident" id="6418640">T</span><span class="op" id="6418641">)</span>&nbsp;<span class="op" id="6418643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418646">if</span>&nbsp;<span class="ident" id="6418649">testing</span><span class="op" id="6418656">.</span><span class="ident" id="6418657">Short</span><span class="op" id="6418662">(</span><span class="op" id="6418663">)</span>&nbsp;<span class="op" id="6418665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418669">t</span><span class="op" id="6418670">.</span><span class="ident" id="6418671">Skip</span><span class="op" id="6418675">(</span><span class="string" id="6418676">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6418713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418719">if</span>&nbsp;<span class="ident" id="6418722">runtime</span><span class="op" id="6418729">.</span><span class="ident" id="6418730">GOMAXPROCS</span><span class="op" id="6418740">(</span><span class="num" id="6418741">0</span><span class="op" id="6418742">)</span>&nbsp;<span class="op" id="6418744">&gt;</span>&nbsp;<span class="num" id="6418746">1</span>&nbsp;<span class="op" id="6418748">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418752">t</span><span class="op" id="6418753">.</span><span class="ident" id="6418754">Skip</span><span class="op" id="6418758">(</span><span class="string" id="6418759">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="6418783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418789">fmt</span><span class="op" id="6418792">.</span><span class="ident" id="6418793">Printf</span><span class="op" id="6418799">(</span><span class="string" id="6418800">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="6418834">,</span>&nbsp;<span class="ident" id="6418836">countMallocs</span><span class="op" id="6418848">(</span><span class="ident" id="6418849">dialDirect</span><span class="op" id="6418859">,</span>&nbsp;<span class="ident" id="6418861">t</span><span class="op" id="6418862">)</span><span class="op" id="6418863">)</span><br>
<span class="lineno"></span><span class="op" id="6418865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="6418868">func</span>&nbsp;<span class="ident" id="6418873">TestCountMallocsOverHTTP</span><span class="op" id="6418897">(</span><span class="ident" id="6418898">t</span>&nbsp;<span class="op" id="6418900">*</span><span class="ident" id="6418901">testing</span><span class="op" id="6418908">.</span><span class="ident" id="6418909">T</span><span class="op" id="6418910">)</span>&nbsp;<span class="op" id="6418912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418915">if</span>&nbsp;<span class="ident" id="6418918">testing</span><span class="op" id="6418925">.</span><span class="ident" id="6418926">Short</span><span class="op" id="6418931">(</span><span class="op" id="6418932">)</span>&nbsp;<span class="op" id="6418934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418938">t</span><span class="op" id="6418939">.</span><span class="ident" id="6418940">Skip</span><span class="op" id="6418944">(</span><span class="string" id="6418945">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6418982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418988">if</span>&nbsp;<span class="ident" id="6418991">runtime</span><span class="op" id="6418998">.</span><span class="ident" id="6418999">GOMAXPROCS</span><span class="op" id="6419009">(</span><span class="num" id="6419010">0</span><span class="op" id="6419011">)</span>&nbsp;<span class="op" id="6419013">&gt;</span>&nbsp;<span class="num" id="6419015">1</span>&nbsp;<span class="op" id="6419017">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419021">t</span><span class="op" id="6419022">.</span><span class="ident" id="6419023">Skip</span><span class="op" id="6419027">(</span><span class="string" id="6419028">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="6419052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419058">fmt</span><span class="op" id="6419061">.</span><span class="ident" id="6419062">Printf</span><span class="op" id="6419068">(</span><span class="string" id="6419069">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="6419108">,</span>&nbsp;<span class="ident" id="6419110">countMallocs</span><span class="op" id="6419122">(</span><span class="ident" id="6419123">dialHTTP</span><span class="op" id="6419131">,</span>&nbsp;<span class="ident" id="6419133">t</span><span class="op" id="6419134">)</span><span class="op" id="6419135">)</span><br>
<span class="lineno"></span><span class="op" id="6419137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="6419140">type</span>&nbsp;<span class="ident" id="6419145">writeCrasher</span>&nbsp;<span class="keyword" id="6419158">struct</span>&nbsp;<span class="op" id="6419165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419168">done</span>&nbsp;<span class="keyword" id="6419173">chan</span>&nbsp;<span class="builtintype" id="6419178">bool</span><br>
<span class="lineno"></span><span class="op" id="6419183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6419186">func</span>&nbsp;<span class="op" id="6419191">(</span><span class="ident" id="6419192">writeCrasher</span><span class="op" id="6419204">)</span>&nbsp;<span class="ident" id="6419206">Close</span><span class="op" id="6419211">(</span><span class="op" id="6419212">)</span>&nbsp;<span class="builtintype" id="6419214">error</span>&nbsp;<span class="op" id="6419220">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419223">return</span>&nbsp;<span class="ident" id="6419230">nil</span><br>
<span class="lineno"></span><span class="op" id="6419234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6419237">func</span>&nbsp;<span class="op" id="6419242">(</span><span class="ident" id="6419243">w</span>&nbsp;<span class="op" id="6419245">*</span><span class="ident" id="6419246">writeCrasher</span><span class="op" id="6419258">)</span>&nbsp;<span class="ident" id="6419260">Read</span><span class="op" id="6419264">(</span><span class="ident" id="6419265">p</span>&nbsp;<span class="op" id="6419267">[</span><span class="op" id="6419268">]</span><span class="builtintype" id="6419269">byte</span><span class="op" id="6419273">)</span>&nbsp;<span class="op" id="6419275">(</span><span class="builtintype" id="6419276">int</span><span class="op" id="6419279">,</span>&nbsp;<span class="builtintype" id="6419281">error</span><span class="op" id="6419286">)</span>&nbsp;<span class="op" id="6419288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419291">&lt;-</span><span class="ident" id="6419293">w</span><span class="op" id="6419294">.</span><span class="ident" id="6419295">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419301">return</span>&nbsp;<span class="num" id="6419308">0</span><span class="op" id="6419309">,</span>&nbsp;<span class="ident" id="6419311">io</span><span class="op" id="6419313">.</span><span class="ident" id="6419314">EOF</span><br>
<span class="lineno"></span><span class="op" id="6419318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6419321">func</span>&nbsp;<span class="op" id="6419326">(</span><span class="ident" id="6419327">writeCrasher</span><span class="op" id="6419339">)</span>&nbsp;<span class="ident" id="6419341">Write</span><span class="op" id="6419346">(</span><span class="ident" id="6419347">p</span>&nbsp;<span class="op" id="6419349">[</span><span class="op" id="6419350">]</span><span class="builtintype" id="6419351">byte</span><span class="op" id="6419355">)</span>&nbsp;<span class="op" id="6419357">(</span><span class="builtintype" id="6419358">int</span><span class="op" id="6419361">,</span>&nbsp;<span class="builtintype" id="6419363">error</span><span class="op" id="6419368">)</span>&nbsp;<span class="op" id="6419370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419373">return</span>&nbsp;<span class="num" id="6419380">0</span><span class="op" id="6419381">,</span>&nbsp;<span class="ident" id="6419383">errors</span><span class="op" id="6419389">.</span><span class="ident" id="6419390">New</span><span class="op" id="6419393">(</span><span class="string" id="6419394">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="6419414">)</span><br>
<span class="lineno">540</span><span class="op" id="6419416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6419419">func</span>&nbsp;<span class="ident" id="6419424">TestClientWriteError</span><span class="op" id="6419444">(</span><span class="ident" id="6419445">t</span>&nbsp;<span class="op" id="6419447">*</span><span class="ident" id="6419448">testing</span><span class="op" id="6419455">.</span><span class="ident" id="6419456">T</span><span class="op" id="6419457">)</span>&nbsp;<span class="op" id="6419459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419462">w</span>&nbsp;<span class="op" id="6419464">:=</span>&nbsp;<span class="op" id="6419467">&amp;</span><span class="ident" id="6419468">writeCrasher</span><span class="op" id="6419480">{</span><span class="ident" id="6419481">done</span><span class="op" id="6419485">:</span>&nbsp;<span class="builtinfunc" id="6419487">make</span><span class="op" id="6419491">(</span><span class="keyword" id="6419492">chan</span>&nbsp;<span class="builtintype" id="6419497">bool</span><span class="op" id="6419501">)</span><span class="op" id="6419502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419505">c</span>&nbsp;<span class="op" id="6419507">:=</span>&nbsp;<span class="ident" id="6419510">NewClient</span><span class="op" id="6419519">(</span><span class="ident" id="6419520">w</span><span class="op" id="6419521">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419524">defer</span>&nbsp;<span class="ident" id="6419530">c</span><span class="op" id="6419531">.</span><span class="ident" id="6419532">Close</span><span class="op" id="6419537">(</span><span class="op" id="6419538">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419542">res</span>&nbsp;<span class="op" id="6419546">:=</span>&nbsp;<span class="builtintype" id="6419549">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419556">err</span>&nbsp;<span class="op" id="6419560">:=</span>&nbsp;<span class="ident" id="6419563">c</span><span class="op" id="6419564">.</span><span class="ident" id="6419565">Call</span><span class="op" id="6419569">(</span><span class="string" id="6419570">&#34;foo&#34;</span><span class="op" id="6419575">,</span>&nbsp;<span class="num" id="6419577">1</span><span class="op" id="6419578">,</span>&nbsp;<span class="op" id="6419580">&amp;</span><span class="ident" id="6419581">res</span><span class="op" id="6419584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419587">if</span>&nbsp;<span class="ident" id="6419590">err</span>&nbsp;<span class="op" id="6419594">==</span>&nbsp;<span class="ident" id="6419597">nil</span>&nbsp;<span class="op" id="6419601">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419605">t</span><span class="op" id="6419606">.</span><span class="ident" id="6419607">Fatal</span><span class="op" id="6419612">(</span><span class="string" id="6419613">&#34;expected&nbsp;error&#34;</span><span class="op" id="6419629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419635">if</span>&nbsp;<span class="ident" id="6419638">err</span><span class="op" id="6419641">.</span><span class="ident" id="6419642">Error</span><span class="op" id="6419647">(</span><span class="op" id="6419648">)</span>&nbsp;<span class="op" id="6419650">!=</span>&nbsp;<span class="string" id="6419653">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="6419674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419678">t</span><span class="op" id="6419679">.</span><span class="ident" id="6419680">Error</span><span class="op" id="6419685">(</span><span class="string" id="6419686">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="6419714">,</span>&nbsp;<span class="ident" id="6419716">err</span><span class="op" id="6419719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419722">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419725">w</span><span class="op" id="6419726">.</span><span class="ident" id="6419727">done</span>&nbsp;<span class="op" id="6419732">&lt;-</span>&nbsp;<span class="builtintype" id="6419735">true</span><br>
<span class="lineno"></span><span class="op" id="6419740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6419743">func</span>&nbsp;<span class="ident" id="6419748">TestTCPClose</span><span class="op" id="6419760">(</span><span class="ident" id="6419761">t</span>&nbsp;<span class="op" id="6419763">*</span><span class="ident" id="6419764">testing</span><span class="op" id="6419771">.</span><span class="ident" id="6419772">T</span><span class="op" id="6419773">)</span>&nbsp;<span class="op" id="6419775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419778">once</span><span class="op" id="6419782">.</span><span class="ident" id="6419783">Do</span><span class="op" id="6419785">(</span><span class="ident" id="6419786">startServer</span><span class="op" id="6419797">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419801">client</span><span class="op" id="6419807">,</span>&nbsp;<span class="ident" id="6419809">err</span>&nbsp;<span class="op" id="6419813">:=</span>&nbsp;<span class="ident" id="6419816">dialHTTP</span><span class="op" id="6419824">(</span><span class="op" id="6419825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419828">if</span>&nbsp;<span class="ident" id="6419831">err</span>&nbsp;<span class="op" id="6419835">!=</span>&nbsp;<span class="ident" id="6419838">nil</span>&nbsp;<span class="op" id="6419842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419846">t</span><span class="op" id="6419847">.</span><span class="ident" id="6419848">Fatalf</span><span class="op" id="6419854">(</span><span class="string" id="6419855">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="6419868">,</span>&nbsp;<span class="ident" id="6419870">err</span><span class="op" id="6419873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419876">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419879">defer</span>&nbsp;<span class="ident" id="6419885">client</span><span class="op" id="6419891">.</span><span class="ident" id="6419892">Close</span><span class="op" id="6419897">(</span><span class="op" id="6419898">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419902">args</span>&nbsp;<span class="op" id="6419907">:=</span>&nbsp;<span class="ident" id="6419910">Args</span><span class="op" id="6419914">{</span><span class="num" id="6419915">17</span><span class="op" id="6419917">,</span>&nbsp;<span class="num" id="6419919">8</span><span class="op" id="6419920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419923">var</span>&nbsp;<span class="ident" id="6419927">reply</span>&nbsp;<span class="ident" id="6419933">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419940">err</span>&nbsp;<span class="op" id="6419944">=</span>&nbsp;<span class="ident" id="6419946">client</span><span class="op" id="6419952">.</span><span class="ident" id="6419953">Call</span><span class="op" id="6419957">(</span><span class="string" id="6419958">&#34;Arith.Mul&#34;</span><span class="op" id="6419969">,</span>&nbsp;<span class="ident" id="6419971">args</span><span class="op" id="6419975">,</span>&nbsp;<span class="op" id="6419977">&amp;</span><span class="ident" id="6419978">reply</span><span class="op" id="6419983">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419986">if</span>&nbsp;<span class="ident" id="6419989">err</span>&nbsp;<span class="op" id="6419993">!=</span>&nbsp;<span class="ident" id="6419996">nil</span>&nbsp;<span class="op" id="6420000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420004">t</span><span class="op" id="6420005">.</span><span class="ident" id="6420006">Fatal</span><span class="op" id="6420011">(</span><span class="string" id="6420012">&#34;arith&nbsp;error:&#34;</span><span class="op" id="6420026">,</span>&nbsp;<span class="ident" id="6420028">err</span><span class="op" id="6420031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420037">t</span><span class="op" id="6420038">.</span><span class="ident" id="6420039">Logf</span><span class="op" id="6420043">(</span><span class="string" id="6420044">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="6420063">,</span>&nbsp;<span class="ident" id="6420065">args</span><span class="op" id="6420069">.</span><span class="ident" id="6420070">A</span><span class="op" id="6420071">,</span>&nbsp;<span class="ident" id="6420073">args</span><span class="op" id="6420077">.</span><span class="ident" id="6420078">B</span><span class="op" id="6420079">,</span>&nbsp;<span class="ident" id="6420081">reply</span><span class="op" id="6420086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420089">if</span>&nbsp;<span class="ident" id="6420092">reply</span><span class="op" id="6420097">.</span><span class="ident" id="6420098">C</span>&nbsp;<span class="op" id="6420100">!=</span>&nbsp;<span class="ident" id="6420103">args</span><span class="op" id="6420107">.</span><span class="ident" id="6420108">A</span><span class="op" id="6420109">*</span><span class="ident" id="6420110">args</span><span class="op" id="6420114">.</span><span class="ident" id="6420115">B</span>&nbsp;<span class="op" id="6420117">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420121">t</span><span class="op" id="6420122">.</span><span class="ident" id="6420123">Errorf</span><span class="op" id="6420129">(</span><span class="string" id="6420130">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6420155">,</span>&nbsp;<span class="ident" id="6420157">reply</span><span class="op" id="6420162">.</span><span class="ident" id="6420163">C</span><span class="op" id="6420164">,</span>&nbsp;<span class="ident" id="6420166">args</span><span class="op" id="6420170">.</span><span class="ident" id="6420171">A</span><span class="op" id="6420172">*</span><span class="ident" id="6420173">args</span><span class="op" id="6420177">.</span><span class="ident" id="6420178">B</span><span class="op" id="6420179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420182">}</span><br>
<span class="lineno"></span><span class="op" id="6420184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6420187">func</span>&nbsp;<span class="ident" id="6420192">TestErrorAfterClientClose</span><span class="op" id="6420217">(</span><span class="ident" id="6420218">t</span>&nbsp;<span class="op" id="6420220">*</span><span class="ident" id="6420221">testing</span><span class="op" id="6420228">.</span><span class="ident" id="6420229">T</span><span class="op" id="6420230">)</span>&nbsp;<span class="op" id="6420232">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420235">once</span><span class="op" id="6420239">.</span><span class="ident" id="6420240">Do</span><span class="op" id="6420242">(</span><span class="ident" id="6420243">startServer</span><span class="op" id="6420254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420258">client</span><span class="op" id="6420264">,</span>&nbsp;<span class="ident" id="6420266">err</span>&nbsp;<span class="op" id="6420270">:=</span>&nbsp;<span class="ident" id="6420273">dialHTTP</span><span class="op" id="6420281">(</span><span class="op" id="6420282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420285">if</span>&nbsp;<span class="ident" id="6420288">err</span>&nbsp;<span class="op" id="6420292">!=</span>&nbsp;<span class="ident" id="6420295">nil</span>&nbsp;<span class="op" id="6420299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420303">t</span><span class="op" id="6420304">.</span><span class="ident" id="6420305">Fatalf</span><span class="op" id="6420311">(</span><span class="string" id="6420312">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="6420325">,</span>&nbsp;<span class="ident" id="6420327">err</span><span class="op" id="6420330">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420336">err</span>&nbsp;<span class="op" id="6420340">=</span>&nbsp;<span class="ident" id="6420342">client</span><span class="op" id="6420348">.</span><span class="ident" id="6420349">Close</span><span class="op" id="6420354">(</span><span class="op" id="6420355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420358">if</span>&nbsp;<span class="ident" id="6420361">err</span>&nbsp;<span class="op" id="6420365">!=</span>&nbsp;<span class="ident" id="6420368">nil</span>&nbsp;<span class="op" id="6420372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420376">t</span><span class="op" id="6420377">.</span><span class="ident" id="6420378">Fatal</span><span class="op" id="6420383">(</span><span class="string" id="6420384">&#34;close&nbsp;error:&#34;</span><span class="op" id="6420398">,</span>&nbsp;<span class="ident" id="6420400">err</span><span class="op" id="6420403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420406">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420409">err</span>&nbsp;<span class="op" id="6420413">=</span>&nbsp;<span class="ident" id="6420415">client</span><span class="op" id="6420421">.</span><span class="ident" id="6420422">Call</span><span class="op" id="6420426">(</span><span class="string" id="6420427">&#34;Arith.Add&#34;</span><span class="op" id="6420438">,</span>&nbsp;<span class="op" id="6420440">&amp;</span><span class="ident" id="6420441">Args</span><span class="op" id="6420445">{</span><span class="num" id="6420446">7</span><span class="op" id="6420447">,</span>&nbsp;<span class="num" id="6420449">9</span><span class="op" id="6420450">}</span><span class="op" id="6420451">,</span>&nbsp;<span class="builtinfunc" id="6420453">new</span><span class="op" id="6420456">(</span><span class="ident" id="6420457">Reply</span><span class="op" id="6420462">)</span><span class="op" id="6420463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420466">if</span>&nbsp;<span class="ident" id="6420469">err</span>&nbsp;<span class="op" id="6420473">!=</span>&nbsp;<span class="ident" id="6420476">ErrShutdown</span>&nbsp;<span class="op" id="6420488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420492">t</span><span class="op" id="6420493">.</span><span class="ident" id="6420494">Errorf</span><span class="op" id="6420500">(</span><span class="string" id="6420501">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6420539">,</span>&nbsp;<span class="ident" id="6420541">err</span><span class="op" id="6420544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420547">}</span><br>
<span class="lineno"></span><span class="op" id="6420549">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="6420552">func</span>&nbsp;<span class="ident" id="6420557">benchmarkEndToEnd</span><span class="op" id="6420574">(</span><span class="ident" id="6420575">dial</span>&nbsp;<span class="keyword" id="6420580">func</span><span class="op" id="6420584">(</span><span class="op" id="6420585">)</span>&nbsp;<span class="op" id="6420587">(</span><span class="op" id="6420588">*</span><span class="ident" id="6420589">Client</span><span class="op" id="6420595">,</span>&nbsp;<span class="builtintype" id="6420597">error</span><span class="op" id="6420602">)</span><span class="op" id="6420603">,</span>&nbsp;<span class="ident" id="6420605">b</span>&nbsp;<span class="op" id="6420607">*</span><span class="ident" id="6420608">testing</span><span class="op" id="6420615">.</span><span class="ident" id="6420616">B</span><span class="op" id="6420617">)</span>&nbsp;<span class="op" id="6420619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420622">once</span><span class="op" id="6420626">.</span><span class="ident" id="6420627">Do</span><span class="op" id="6420629">(</span><span class="ident" id="6420630">startServer</span><span class="op" id="6420641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420644">client</span><span class="op" id="6420650">,</span>&nbsp;<span class="ident" id="6420652">err</span>&nbsp;<span class="op" id="6420656">:=</span>&nbsp;<span class="ident" id="6420659">dial</span><span class="op" id="6420663">(</span><span class="op" id="6420664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420667">if</span>&nbsp;<span class="ident" id="6420670">err</span>&nbsp;<span class="op" id="6420674">!=</span>&nbsp;<span class="ident" id="6420677">nil</span>&nbsp;<span class="op" id="6420681">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420685">b</span><span class="op" id="6420686">.</span><span class="ident" id="6420687">Fatal</span><span class="op" id="6420692">(</span><span class="string" id="6420693">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="6420709">,</span>&nbsp;<span class="ident" id="6420711">err</span><span class="op" id="6420714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420720">defer</span>&nbsp;<span class="ident" id="6420726">client</span><span class="op" id="6420732">.</span><span class="ident" id="6420733">Close</span><span class="op" id="6420738">(</span><span class="op" id="6420739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6420743">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420765">args</span>&nbsp;<span class="op" id="6420770">:=</span>&nbsp;<span class="op" id="6420773">&amp;</span><span class="ident" id="6420774">Args</span><span class="op" id="6420778">{</span><span class="num" id="6420779">7</span><span class="op" id="6420780">,</span>&nbsp;<span class="num" id="6420782">8</span><span class="op" id="6420783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420786">b</span><span class="op" id="6420787">.</span><span class="ident" id="6420788">ResetTimer</span><span class="op" id="6420798">(</span><span class="op" id="6420799">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420803">b</span><span class="op" id="6420804">.</span><span class="ident" id="6420805">RunParallel</span><span class="op" id="6420816">(</span><span class="keyword" id="6420817">func</span><span class="op" id="6420821">(</span><span class="ident" id="6420822">pb</span>&nbsp;<span class="op" id="6420825">*</span><span class="ident" id="6420826">testing</span><span class="op" id="6420833">.</span><span class="ident" id="6420834">PB</span><span class="op" id="6420836">)</span>&nbsp;<span class="op" id="6420838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420842">reply</span>&nbsp;<span class="op" id="6420848">:=</span>&nbsp;<span class="builtinfunc" id="6420851">new</span><span class="op" id="6420854">(</span><span class="ident" id="6420855">Reply</span><span class="op" id="6420860">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420864">for</span>&nbsp;<span class="ident" id="6420868">pb</span><span class="op" id="6420870">.</span><span class="ident" id="6420871">Next</span><span class="op" id="6420875">(</span><span class="op" id="6420876">)</span>&nbsp;<span class="op" id="6420878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420883">err</span>&nbsp;<span class="op" id="6420887">:=</span>&nbsp;<span class="ident" id="6420890">client</span><span class="op" id="6420896">.</span><span class="ident" id="6420897">Call</span><span class="op" id="6420901">(</span><span class="string" id="6420902">&#34;Arith.Add&#34;</span><span class="op" id="6420913">,</span>&nbsp;<span class="ident" id="6420915">args</span><span class="op" id="6420919">,</span>&nbsp;<span class="ident" id="6420921">reply</span><span class="op" id="6420926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420931">if</span>&nbsp;<span class="ident" id="6420934">err</span>&nbsp;<span class="op" id="6420938">!=</span>&nbsp;<span class="ident" id="6420941">nil</span>&nbsp;<span class="op" id="6420945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420951">b</span><span class="op" id="6420952">.</span><span class="ident" id="6420953">Fatalf</span><span class="op" id="6420959">(</span><span class="string" id="6420960">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6421013">,</span>&nbsp;<span class="ident" id="6421015">err</span><span class="op" id="6421018">.</span><span class="ident" id="6421019">Error</span><span class="op" id="6421024">(</span><span class="op" id="6421025">)</span><span class="op" id="6421026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421031">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421036">if</span>&nbsp;<span class="ident" id="6421039">reply</span><span class="op" id="6421044">.</span><span class="ident" id="6421045">C</span>&nbsp;<span class="op" id="6421047">!=</span>&nbsp;<span class="ident" id="6421050">args</span><span class="op" id="6421054">.</span><span class="ident" id="6421055">A</span><span class="op" id="6421056">+</span><span class="ident" id="6421057">args</span><span class="op" id="6421061">.</span><span class="ident" id="6421062">B</span>&nbsp;<span class="op" id="6421064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421070">b</span><span class="op" id="6421071">.</span><span class="ident" id="6421072">Fatalf</span><span class="op" id="6421078">(</span><span class="string" id="6421079">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6421115">,</span>&nbsp;<span class="ident" id="6421117">reply</span><span class="op" id="6421122">.</span><span class="ident" id="6421123">C</span><span class="op" id="6421124">,</span>&nbsp;<span class="ident" id="6421126">args</span><span class="op" id="6421130">.</span><span class="ident" id="6421131">A</span><span class="op" id="6421132">+</span><span class="ident" id="6421133">args</span><span class="op" id="6421137">.</span><span class="ident" id="6421138">B</span><span class="op" id="6421139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421151">}</span><span class="op" id="6421152">)</span><br>
<span class="lineno">620</span><span class="op" id="6421154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6421157">func</span>&nbsp;<span class="ident" id="6421162">benchmarkEndToEndAsync</span><span class="op" id="6421184">(</span><span class="ident" id="6421185">dial</span>&nbsp;<span class="keyword" id="6421190">func</span><span class="op" id="6421194">(</span><span class="op" id="6421195">)</span>&nbsp;<span class="op" id="6421197">(</span><span class="op" id="6421198">*</span><span class="ident" id="6421199">Client</span><span class="op" id="6421205">,</span>&nbsp;<span class="builtintype" id="6421207">error</span><span class="op" id="6421212">)</span><span class="op" id="6421213">,</span>&nbsp;<span class="ident" id="6421215">b</span>&nbsp;<span class="op" id="6421217">*</span><span class="ident" id="6421218">testing</span><span class="op" id="6421225">.</span><span class="ident" id="6421226">B</span><span class="op" id="6421227">)</span>&nbsp;<span class="op" id="6421229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421232">const</span>&nbsp;<span class="ident" id="6421238">MaxConcurrentCalls</span>&nbsp;<span class="op" id="6421257">=</span>&nbsp;<span class="num" id="6421259">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421264">once</span><span class="op" id="6421268">.</span><span class="ident" id="6421269">Do</span><span class="op" id="6421271">(</span><span class="ident" id="6421272">startServer</span><span class="op" id="6421283">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421286">client</span><span class="op" id="6421292">,</span>&nbsp;<span class="ident" id="6421294">err</span>&nbsp;<span class="op" id="6421298">:=</span>&nbsp;<span class="ident" id="6421301">dial</span><span class="op" id="6421305">(</span><span class="op" id="6421306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421309">if</span>&nbsp;<span class="ident" id="6421312">err</span>&nbsp;<span class="op" id="6421316">!=</span>&nbsp;<span class="ident" id="6421319">nil</span>&nbsp;<span class="op" id="6421323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421327">b</span><span class="op" id="6421328">.</span><span class="ident" id="6421329">Fatal</span><span class="op" id="6421334">(</span><span class="string" id="6421335">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="6421351">,</span>&nbsp;<span class="ident" id="6421353">err</span><span class="op" id="6421356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421362">defer</span>&nbsp;<span class="ident" id="6421368">client</span><span class="op" id="6421374">.</span><span class="ident" id="6421375">Close</span><span class="op" id="6421380">(</span><span class="op" id="6421381">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6421385">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421408">args</span>&nbsp;<span class="op" id="6421413">:=</span>&nbsp;<span class="op" id="6421416">&amp;</span><span class="ident" id="6421417">Args</span><span class="op" id="6421421">{</span><span class="num" id="6421422">7</span><span class="op" id="6421423">,</span>&nbsp;<span class="num" id="6421425">8</span><span class="op" id="6421426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421429">procs</span>&nbsp;<span class="op" id="6421435">:=</span>&nbsp;<span class="num" id="6421438">4</span>&nbsp;<span class="op" id="6421440">*</span>&nbsp;<span class="ident" id="6421442">runtime</span><span class="op" id="6421449">.</span><span class="ident" id="6421450">GOMAXPROCS</span><span class="op" id="6421460">(</span><span class="op" id="6421461">-</span><span class="num" id="6421462">1</span><span class="op" id="6421463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421466">send</span>&nbsp;<span class="op" id="6421471">:=</span>&nbsp;<span class="builtintype" id="6421474">int32</span><span class="op" id="6421479">(</span><span class="ident" id="6421480">b</span><span class="op" id="6421481">.</span><span class="ident" id="6421482">N</span><span class="op" id="6421483">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421486">recv</span>&nbsp;<span class="op" id="6421491">:=</span>&nbsp;<span class="builtintype" id="6421494">int32</span><span class="op" id="6421499">(</span><span class="ident" id="6421500">b</span><span class="op" id="6421501">.</span><span class="ident" id="6421502">N</span><span class="op" id="6421503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421506">var</span>&nbsp;<span class="ident" id="6421510">wg</span>&nbsp;<span class="ident" id="6421513">sync</span><span class="op" id="6421517">.</span><span class="ident" id="6421518">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421529">wg</span><span class="op" id="6421531">.</span><span class="ident" id="6421532">Add</span><span class="op" id="6421535">(</span><span class="ident" id="6421536">procs</span><span class="op" id="6421541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421544">gate</span>&nbsp;<span class="op" id="6421549">:=</span>&nbsp;<span class="builtinfunc" id="6421552">make</span><span class="op" id="6421556">(</span><span class="keyword" id="6421557">chan</span>&nbsp;<span class="builtintype" id="6421562">bool</span><span class="op" id="6421566">,</span>&nbsp;<span class="ident" id="6421568">MaxConcurrentCalls</span><span class="op" id="6421586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421589">res</span>&nbsp;<span class="op" id="6421593">:=</span>&nbsp;<span class="builtinfunc" id="6421596">make</span><span class="op" id="6421600">(</span><span class="keyword" id="6421601">chan</span>&nbsp;<span class="op" id="6421606">*</span><span class="ident" id="6421607">Call</span><span class="op" id="6421611">,</span>&nbsp;<span class="ident" id="6421613">MaxConcurrentCalls</span><span class="op" id="6421631">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421634">b</span><span class="op" id="6421635">.</span><span class="ident" id="6421636">ResetTimer</span><span class="op" id="6421646">(</span><span class="op" id="6421647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421651">for</span>&nbsp;<span class="ident" id="6421655">p</span>&nbsp;<span class="op" id="6421657">:=</span>&nbsp;<span class="num" id="6421660">0</span><span class="op" id="6421661">;</span>&nbsp;<span class="ident" id="6421663">p</span>&nbsp;<span class="op" id="6421665">&lt;</span>&nbsp;<span class="ident" id="6421667">procs</span><span class="op" id="6421672">;</span>&nbsp;<span class="ident" id="6421674">p</span><span class="op" id="6421675">++</span>&nbsp;<span class="op" id="6421678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421682">go</span>&nbsp;<span class="keyword" id="6421685">func</span><span class="op" id="6421689">(</span><span class="op" id="6421690">)</span>&nbsp;<span class="op" id="6421692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421697">for</span>&nbsp;<span class="ident" id="6421701">atomic</span><span class="op" id="6421707">.</span><span class="ident" id="6421708">AddInt32</span><span class="op" id="6421716">(</span><span class="op" id="6421717">&amp;</span><span class="ident" id="6421718">send</span><span class="op" id="6421722">,</span>&nbsp;<span class="op" id="6421724">-</span><span class="num" id="6421725">1</span><span class="op" id="6421726">)</span>&nbsp;<span class="op" id="6421728">&gt;=</span>&nbsp;<span class="num" id="6421731">0</span>&nbsp;<span class="op" id="6421733">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421739">gate</span>&nbsp;<span class="op" id="6421744">&lt;-</span>&nbsp;<span class="builtintype" id="6421747">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421756">reply</span>&nbsp;<span class="op" id="6421762">:=</span>&nbsp;<span class="builtinfunc" id="6421765">new</span><span class="op" id="6421768">(</span><span class="ident" id="6421769">Reply</span><span class="op" id="6421774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421780">client</span><span class="op" id="6421786">.</span><span class="ident" id="6421787">Go</span><span class="op" id="6421789">(</span><span class="string" id="6421790">&#34;Arith.Add&#34;</span><span class="op" id="6421801">,</span>&nbsp;<span class="ident" id="6421803">args</span><span class="op" id="6421807">,</span>&nbsp;<span class="ident" id="6421809">reply</span><span class="op" id="6421814">,</span>&nbsp;<span class="ident" id="6421816">res</span><span class="op" id="6421819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421828">}</span><span class="op" id="6421829">(</span><span class="op" id="6421830">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421834">go</span>&nbsp;<span class="keyword" id="6421837">func</span><span class="op" id="6421841">(</span><span class="op" id="6421842">)</span>&nbsp;<span class="op" id="6421844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421849">for</span>&nbsp;<span class="ident" id="6421853">call</span>&nbsp;<span class="op" id="6421858">:=</span>&nbsp;<span class="keyword" id="6421861">range</span>&nbsp;<span class="ident" id="6421867">res</span>&nbsp;<span class="op" id="6421871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421877">A</span>&nbsp;<span class="op" id="6421879">:=</span>&nbsp;<span class="ident" id="6421882">call</span><span class="op" id="6421886">.</span><span class="ident" id="6421887">Args</span><span class="op" id="6421891">.</span><span class="op" id="6421892">(</span><span class="op" id="6421893">*</span><span class="ident" id="6421894">Args</span><span class="op" id="6421898">)</span><span class="op" id="6421899">.</span><span class="ident" id="6421900">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421906">B</span>&nbsp;<span class="op" id="6421908">:=</span>&nbsp;<span class="ident" id="6421911">call</span><span class="op" id="6421915">.</span><span class="ident" id="6421916">Args</span><span class="op" id="6421920">.</span><span class="op" id="6421921">(</span><span class="op" id="6421922">*</span><span class="ident" id="6421923">Args</span><span class="op" id="6421927">)</span><span class="op" id="6421928">.</span><span class="ident" id="6421929">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421935">C</span>&nbsp;<span class="op" id="6421937">:=</span>&nbsp;<span class="ident" id="6421940">call</span><span class="op" id="6421944">.</span><span class="ident" id="6421945">Reply</span><span class="op" id="6421950">.</span><span class="op" id="6421951">(</span><span class="op" id="6421952">*</span><span class="ident" id="6421953">Reply</span><span class="op" id="6421958">)</span><span class="op" id="6421959">.</span><span class="ident" id="6421960">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421966">if</span>&nbsp;<span class="ident" id="6421969">A</span><span class="op" id="6421970">+</span><span class="ident" id="6421971">B</span>&nbsp;<span class="op" id="6421973">!=</span>&nbsp;<span class="ident" id="6421976">C</span>&nbsp;<span class="op" id="6421978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421985">b</span><span class="op" id="6421986">.</span><span class="ident" id="6421987">Fatalf</span><span class="op" id="6421993">(</span><span class="string" id="6421994">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6422036">,</span>&nbsp;<span class="ident" id="6422038">A</span><span class="op" id="6422039">+</span><span class="ident" id="6422040">B</span><span class="op" id="6422041">,</span>&nbsp;<span class="ident" id="6422043">C</span><span class="op" id="6422044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422056">&lt;-</span><span class="ident" id="6422058">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422067">if</span>&nbsp;<span class="ident" id="6422070">atomic</span><span class="op" id="6422076">.</span><span class="ident" id="6422077">AddInt32</span><span class="op" id="6422085">(</span><span class="op" id="6422086">&amp;</span><span class="ident" id="6422087">recv</span><span class="op" id="6422091">,</span>&nbsp;<span class="op" id="6422093">-</span><span class="num" id="6422094">1</span><span class="op" id="6422095">)</span>&nbsp;<span class="op" id="6422097">==</span>&nbsp;<span class="num" id="6422100">0</span>&nbsp;<span class="op" id="6422102">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6422109">close</span><span class="op" id="6422114">(</span><span class="ident" id="6422115">res</span><span class="op" id="6422118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422134">wg</span><span class="op" id="6422136">.</span><span class="ident" id="6422137">Done</span><span class="op" id="6422141">(</span><span class="op" id="6422142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422146">}</span><span class="op" id="6422147">(</span><span class="op" id="6422148">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422154">wg</span><span class="op" id="6422156">.</span><span class="ident" id="6422157">Wait</span><span class="op" id="6422161">(</span><span class="op" id="6422162">)</span><br>
<span class="lineno"></span><span class="op" id="6422164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6422167">func</span>&nbsp;<span class="ident" id="6422172">BenchmarkEndToEnd</span><span class="op" id="6422189">(</span><span class="ident" id="6422190">b</span>&nbsp;<span class="op" id="6422192">*</span><span class="ident" id="6422193">testing</span><span class="op" id="6422200">.</span><span class="ident" id="6422201">B</span><span class="op" id="6422202">)</span>&nbsp;<span class="op" id="6422204">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422207">benchmarkEndToEnd</span><span class="op" id="6422224">(</span><span class="ident" id="6422225">dialDirect</span><span class="op" id="6422235">,</span>&nbsp;<span class="ident" id="6422237">b</span><span class="op" id="6422238">)</span><br>
<span class="lineno"></span><span class="op" id="6422240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6422243">func</span>&nbsp;<span class="ident" id="6422248">BenchmarkEndToEndHTTP</span><span class="op" id="6422269">(</span><span class="ident" id="6422270">b</span>&nbsp;<span class="op" id="6422272">*</span><span class="ident" id="6422273">testing</span><span class="op" id="6422280">.</span><span class="ident" id="6422281">B</span><span class="op" id="6422282">)</span>&nbsp;<span class="op" id="6422284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422287">benchmarkEndToEnd</span><span class="op" id="6422304">(</span><span class="ident" id="6422305">dialHTTP</span><span class="op" id="6422313">,</span>&nbsp;<span class="ident" id="6422315">b</span><span class="op" id="6422316">)</span><br>
<span class="lineno">675</span><span class="op" id="6422318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6422321">func</span>&nbsp;<span class="ident" id="6422326">BenchmarkEndToEndAsync</span><span class="op" id="6422348">(</span><span class="ident" id="6422349">b</span>&nbsp;<span class="op" id="6422351">*</span><span class="ident" id="6422352">testing</span><span class="op" id="6422359">.</span><span class="ident" id="6422360">B</span><span class="op" id="6422361">)</span>&nbsp;<span class="op" id="6422363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422366">benchmarkEndToEndAsync</span><span class="op" id="6422388">(</span><span class="ident" id="6422389">dialDirect</span><span class="op" id="6422399">,</span>&nbsp;<span class="ident" id="6422401">b</span><span class="op" id="6422402">)</span><br>
<span class="lineno"></span><span class="op" id="6422404">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="6422407">func</span>&nbsp;<span class="ident" id="6422412">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="6422438">(</span><span class="ident" id="6422439">b</span>&nbsp;<span class="op" id="6422441">*</span><span class="ident" id="6422442">testing</span><span class="op" id="6422449">.</span><span class="ident" id="6422450">B</span><span class="op" id="6422451">)</span>&nbsp;<span class="op" id="6422453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422456">benchmarkEndToEndAsync</span><span class="op" id="6422478">(</span><span class="ident" id="6422479">dialHTTP</span><span class="op" id="6422487">,</span>&nbsp;<span class="ident" id="6422489">b</span><span class="op" id="6422490">)</span><br>
<span class="lineno"></span><span class="op" id="6422492">}</span>
</div>
</body>
</html>
