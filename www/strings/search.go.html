<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2501967">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2502022">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2502076">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2502127">package</span>&nbsp;<span class="ident" id="2502135">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2502144">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2502221">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2502271">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2502339">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2502416">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2502451">type</span>&nbsp;<span class="ident" id="2502456">stringFinder</span>&nbsp;<span class="keyword" id="2502469">struct</span>&nbsp;<span class="op" id="2502476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2502479">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2502544">pattern</span>&nbsp;<span class="builtintype" id="2502552">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2502561">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2502635">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2502709">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2502745">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2502749">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2502821">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2502894">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2502939">badCharSkip</span>&nbsp;<span class="op" id="2502951">[</span><span class="num" id="2502952">256</span><span class="op" id="2502955">]</span><span class="builtintype" id="2502956">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2502962">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503038">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503110">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503152">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503156">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503228">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503302">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503372">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503445">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503510">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503545">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503549">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503624">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503692">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503766">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503832">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503900">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2503970">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2504041">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2504114">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2504171">goodSuffixSkip</span>&nbsp;<span class="op" id="2504186">[</span><span class="op" id="2504187">]</span><span class="builtintype" id="2504188">int</span><br>
<span class="lineno"></span><span class="op" id="2504192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2504195">func</span>&nbsp;<span class="ident" id="2504200">makeStringFinder</span><span class="op" id="2504216">(</span><span class="ident" id="2504217">pattern</span>&nbsp;<span class="builtintype" id="2504225">string</span><span class="op" id="2504231">)</span>&nbsp;<span class="op" id="2504233">*</span><span class="ident" id="2504234"><a href="/strings/search.go.html#2502456">stringFinder</a></span>&nbsp;<span class="op" id="2504247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2504250">f</span>&nbsp;<span class="op" id="2504252">:=</span>&nbsp;<span class="op" id="2504255">&amp;</span><span class="ident" id="2504256"><a href="/strings/search.go.html#2502456">stringFinder</a></span><span class="op" id="2504268">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2504272">pattern</span><span class="op" id="2504279">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2504288"><a href="/strings/search.go.html#2504217">pattern</a></span><span class="op" id="2504295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2504299">goodSuffixSkip</span><span class="op" id="2504313">:</span>&nbsp;<span class="builtinfunc" id="2504315">make</span><span class="op" id="2504319">(</span><span class="op" id="2504320">[</span><span class="op" id="2504321">]</span><span class="builtintype" id="2504322">int</span><span class="op" id="2504325">,</span>&nbsp;<span class="builtinfunc" id="2504327">len</span><span class="op" id="2504330">(</span><span class="ident" id="2504331"><a href="/strings/search.go.html#2504217">pattern</a></span><span class="op" id="2504338">)</span><span class="op" id="2504339">)</span><span class="op" id="2504340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2504343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2504346">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2504406">last</span>&nbsp;<span class="op" id="2504411">:=</span>&nbsp;<span class="builtinfunc" id="2504414">len</span><span class="op" id="2504417">(</span><span class="ident" id="2504418"><a href="/strings/search.go.html#2504217">pattern</a></span><span class="op" id="2504425">)</span>&nbsp;<span class="op" id="2504427">-</span>&nbsp;<span class="num" id="2504429">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2504433">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2504464">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2504524">for</span>&nbsp;<span class="ident" id="2504528">i</span>&nbsp;<span class="op" id="2504530">:=</span>&nbsp;<span class="keyword" id="2504533">range</span>&nbsp;<span class="ident" id="2504539"><a href="/strings/search.go.html#2504250">f</a></span><span class="op" id="2504540">.</span><span class="ident" id="2504541">badCharSkip</span>&nbsp;<span class="op" id="2504553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2504557"><a href="/strings/search.go.html#2504250">f</a></span><span class="op" id="2504558">.</span><span class="ident" id="2504559">badCharSkip</span><span class="op" id="2504570">[</span><span class="ident" id="2504571"><a href="/strings/search.go.html#2504528">i</a></span><span class="op" id="2504572">]</span>&nbsp;<span class="op" id="2504574">=</span>&nbsp;<span class="builtinfunc" id="2504576">len</span><span class="op" id="2504579">(</span><span class="ident" id="2504580"><a href="/strings/search.go.html#2504217">pattern</a></span><span class="op" id="2504587">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2504590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2504593">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2504666">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2504741">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2504782">for</span>&nbsp;<span class="ident" id="2504786">i</span>&nbsp;<span class="op" id="2504788">:=</span>&nbsp;<span class="num" id="2504791">0</span><span class="op" id="2504792">;</span>&nbsp;<span class="ident" id="2504794"><a href="/strings/search.go.html#2504786">i</a></span>&nbsp;<span class="op" id="2504796">&lt;</span>&nbsp;<span class="ident" id="2504798"><a href="/strings/search.go.html#2504406">last</a></span><span class="op" id="2504802">;</span>&nbsp;<span class="ident" id="2504804"><a href="/strings/search.go.html#2504786">i</a></span><span class="op" id="2504805">++</span>&nbsp;<span class="op" id="2504808">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2504812"><a href="/strings/search.go.html#2504250">f</a></span><span class="op" id="2504813">.</span><span class="ident" id="2504814">badCharSkip</span><span class="op" id="2504825">[</span><span class="ident" id="2504826"><a href="/strings/search.go.html#2504217">pattern</a></span><span class="op" id="2504833">[</span><span class="ident" id="2504834"><a href="/strings/search.go.html#2504786">i</a></span><span class="op" id="2504835">]</span><span class="op" id="2504836">]</span>&nbsp;<span class="op" id="2504838">=</span>&nbsp;<span class="ident" id="2504840"><a href="/strings/search.go.html#2504406">last</a></span>&nbsp;<span class="op" id="2504845">-</span>&nbsp;<span class="ident" id="2504847"><a href="/strings/search.go.html#2504786">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2504850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2504854">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2504883">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2504957">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2504970">lastPrefix</span>&nbsp;<span class="op" id="2504981">:=</span>&nbsp;<span class="ident" id="2504984"><a href="/strings/search.go.html#2504406">last</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2504990">for</span>&nbsp;<span class="ident" id="2504994">i</span>&nbsp;<span class="op" id="2504996">:=</span>&nbsp;<span class="ident" id="2504999"><a href="/strings/search.go.html#2504406">last</a></span><span class="op" id="2505003">;</span>&nbsp;<span class="ident" id="2505005"><a href="/strings/search.go.html#2504994">i</a></span>&nbsp;<span class="op" id="2505007">&gt;=</span>&nbsp;<span class="num" id="2505010">0</span><span class="op" id="2505011">;</span>&nbsp;<span class="ident" id="2505013"><a href="/strings/search.go.html#2504994">i</a></span><span class="op" id="2505014">--</span>&nbsp;<span class="op" id="2505017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2505021">if</span>&nbsp;<span class="ident" id="2505024"><a href="/strings/strings.go.html#2516015">HasPrefix</a></span><span class="op" id="2505033">(</span><span class="ident" id="2505034"><a href="/strings/search.go.html#2504217">pattern</a></span><span class="op" id="2505041">,</span>&nbsp;<span class="ident" id="2505043"><a href="/strings/search.go.html#2504217">pattern</a></span><span class="op" id="2505050">[</span><span class="ident" id="2505051"><a href="/strings/search.go.html#2504994">i</a></span><span class="op" id="2505052">+</span><span class="num" id="2505053">1</span><span class="op" id="2505054">:</span><span class="op" id="2505055">]</span><span class="op" id="2505056">)</span>&nbsp;<span class="op" id="2505058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2505063"><a href="/strings/search.go.html#2504970">lastPrefix</a></span>&nbsp;<span class="op" id="2505074">=</span>&nbsp;<span class="ident" id="2505076"><a href="/strings/search.go.html#2504994">i</a></span>&nbsp;<span class="op" id="2505078">+</span>&nbsp;<span class="num" id="2505080">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2505084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2505088">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2505147"><a href="/strings/search.go.html#2504250">f</a></span><span class="op" id="2505148">.</span><span class="ident" id="2505149">goodSuffixSkip</span><span class="op" id="2505163">[</span><span class="ident" id="2505164"><a href="/strings/search.go.html#2504994">i</a></span><span class="op" id="2505165">]</span>&nbsp;<span class="op" id="2505167">=</span>&nbsp;<span class="ident" id="2505169"><a href="/strings/search.go.html#2504970">lastPrefix</a></span>&nbsp;<span class="op" id="2505180">+</span>&nbsp;<span class="ident" id="2505182"><a href="/strings/search.go.html#2504406">last</a></span>&nbsp;<span class="op" id="2505187">-</span>&nbsp;<span class="ident" id="2505189"><a href="/strings/search.go.html#2504994">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2505192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2505195">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2505270">for</span>&nbsp;<span class="ident" id="2505274">i</span>&nbsp;<span class="op" id="2505276">:=</span>&nbsp;<span class="num" id="2505279">0</span><span class="op" id="2505280">;</span>&nbsp;<span class="ident" id="2505282"><a href="/strings/search.go.html#2505274">i</a></span>&nbsp;<span class="op" id="2505284">&lt;</span>&nbsp;<span class="ident" id="2505286"><a href="/strings/search.go.html#2504406">last</a></span><span class="op" id="2505290">;</span>&nbsp;<span class="ident" id="2505292"><a href="/strings/search.go.html#2505274">i</a></span><span class="op" id="2505293">++</span>&nbsp;<span class="op" id="2505296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2505300">lenSuffix</span>&nbsp;<span class="op" id="2505310">:=</span>&nbsp;<span class="ident" id="2505313"><a href="/strings/search.go.html#2505557">longestCommonSuffix</a></span><span class="op" id="2505332">(</span><span class="ident" id="2505333"><a href="/strings/search.go.html#2504217">pattern</a></span><span class="op" id="2505340">,</span>&nbsp;<span class="ident" id="2505342"><a href="/strings/search.go.html#2504217">pattern</a></span><span class="op" id="2505349">[</span><span class="num" id="2505350">1</span><span class="op" id="2505351">:</span><span class="ident" id="2505352"><a href="/strings/search.go.html#2505274">i</a></span><span class="op" id="2505353">+</span><span class="num" id="2505354">1</span><span class="op" id="2505355">]</span><span class="op" id="2505356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2505360">if</span>&nbsp;<span class="ident" id="2505363"><a href="/strings/search.go.html#2504217">pattern</a></span><span class="op" id="2505370">[</span><span class="ident" id="2505371"><a href="/strings/search.go.html#2505274">i</a></span><span class="op" id="2505372">-</span><span class="ident" id="2505373"><a href="/strings/search.go.html#2505300">lenSuffix</a></span><span class="op" id="2505382">]</span>&nbsp;<span class="op" id="2505384">!=</span>&nbsp;<span class="ident" id="2505387"><a href="/strings/search.go.html#2504217">pattern</a></span><span class="op" id="2505394">[</span><span class="ident" id="2505395"><a href="/strings/search.go.html#2504406">last</a></span><span class="op" id="2505399">-</span><span class="ident" id="2505400"><a href="/strings/search.go.html#2505300">lenSuffix</a></span><span class="op" id="2505409">]</span>&nbsp;<span class="op" id="2505411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2505416">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2505475"><a href="/strings/search.go.html#2504250">f</a></span><span class="op" id="2505476">.</span><span class="ident" id="2505477">goodSuffixSkip</span><span class="op" id="2505491">[</span><span class="ident" id="2505492"><a href="/strings/search.go.html#2504406">last</a></span><span class="op" id="2505496">-</span><span class="ident" id="2505497"><a href="/strings/search.go.html#2505300">lenSuffix</a></span><span class="op" id="2505506">]</span>&nbsp;<span class="op" id="2505508">=</span>&nbsp;<span class="ident" id="2505510"><a href="/strings/search.go.html#2505300">lenSuffix</a></span>&nbsp;<span class="op" id="2505520">+</span>&nbsp;<span class="ident" id="2505522"><a href="/strings/search.go.html#2504406">last</a></span>&nbsp;<span class="op" id="2505527">-</span>&nbsp;<span class="ident" id="2505529"><a href="/strings/search.go.html#2505274">i</a></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2505533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2505536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2505540">return</span>&nbsp;<span class="ident" id="2505547"><a href="/strings/search.go.html#2504250">f</a></span><br>
<span class="lineno"></span><span class="op" id="2505549">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2505552">func</span>&nbsp;<span class="ident" id="2505557">longestCommonSuffix</span><span class="op" id="2505576">(</span><span class="ident" id="2505577">a</span><span class="op" id="2505578">,</span>&nbsp;<span class="ident" id="2505580">b</span>&nbsp;<span class="builtintype" id="2505582">string</span><span class="op" id="2505588">)</span>&nbsp;<span class="op" id="2505590">(</span><span class="ident" id="2505591">i</span>&nbsp;<span class="builtintype" id="2505593">int</span><span class="op" id="2505596">)</span>&nbsp;<span class="op" id="2505598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2505601">for</span>&nbsp;<span class="op" id="2505605">;</span>&nbsp;<span class="ident" id="2505607"><a href="/strings/search.go.html#2505591">i</a></span>&nbsp;<span class="op" id="2505609">&lt;</span>&nbsp;<span class="builtinfunc" id="2505611">len</span><span class="op" id="2505614">(</span><span class="ident" id="2505615"><a href="/strings/search.go.html#2505577">a</a></span><span class="op" id="2505616">)</span>&nbsp;<span class="op" id="2505618">&amp;&amp;</span>&nbsp;<span class="ident" id="2505621"><a href="/strings/search.go.html#2505591">i</a></span>&nbsp;<span class="op" id="2505623">&lt;</span>&nbsp;<span class="builtinfunc" id="2505625">len</span><span class="op" id="2505628">(</span><span class="ident" id="2505629"><a href="/strings/search.go.html#2505580">b</a></span><span class="op" id="2505630">)</span><span class="op" id="2505631">;</span>&nbsp;<span class="ident" id="2505633"><a href="/strings/search.go.html#2505591">i</a></span><span class="op" id="2505634">++</span>&nbsp;<span class="op" id="2505637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2505641">if</span>&nbsp;<span class="ident" id="2505644"><a href="/strings/search.go.html#2505577">a</a></span><span class="op" id="2505645">[</span><span class="builtinfunc" id="2505646">len</span><span class="op" id="2505649">(</span><span class="ident" id="2505650"><a href="/strings/search.go.html#2505577">a</a></span><span class="op" id="2505651">)</span><span class="op" id="2505652">-</span><span class="num" id="2505653">1</span><span class="op" id="2505654">-</span><span class="ident" id="2505655"><a href="/strings/search.go.html#2505591">i</a></span><span class="op" id="2505656">]</span>&nbsp;<span class="op" id="2505658">!=</span>&nbsp;<span class="ident" id="2505661"><a href="/strings/search.go.html#2505580">b</a></span><span class="op" id="2505662">[</span><span class="builtinfunc" id="2505663">len</span><span class="op" id="2505666">(</span><span class="ident" id="2505667"><a href="/strings/search.go.html#2505580">b</a></span><span class="op" id="2505668">)</span><span class="op" id="2505669">-</span><span class="num" id="2505670">1</span><span class="op" id="2505671">-</span><span class="ident" id="2505672"><a href="/strings/search.go.html#2505591">i</a></span><span class="op" id="2505673">]</span>&nbsp;<span class="op" id="2505675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2505680">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2505688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2505691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2505694">return</span><br>
<span class="lineno"></span><span class="op" id="2505701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2505704">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2505781">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2505825">func</span>&nbsp;<span class="op" id="2505830">(</span><span class="ident" id="2505831">f</span>&nbsp;<span class="op" id="2505833">*</span><span class="ident" id="2505834"><a href="/strings/search.go.html#2502456">stringFinder</a></span><span class="op" id="2505846">)</span>&nbsp;<span class="ident" id="2505848">next</span><span class="op" id="2505852">(</span><span class="ident" id="2505853">text</span>&nbsp;<span class="builtintype" id="2505858">string</span><span class="op" id="2505864">)</span>&nbsp;<span class="builtintype" id="2505866">int</span>&nbsp;<span class="op" id="2505870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2505873">i</span>&nbsp;<span class="op" id="2505875">:=</span>&nbsp;<span class="builtinfunc" id="2505878">len</span><span class="op" id="2505881">(</span><span class="ident" id="2505882"><a href="/strings/search.go.html#2505831">f</a></span><span class="op" id="2505883">.</span><span class="ident" id="2505884">pattern</span><span class="op" id="2505891">)</span>&nbsp;<span class="op" id="2505893">-</span>&nbsp;<span class="num" id="2505895">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2505898">for</span>&nbsp;<span class="ident" id="2505902"><a href="/strings/search.go.html#2505873">i</a></span>&nbsp;<span class="op" id="2505904">&lt;</span>&nbsp;<span class="builtinfunc" id="2505906">len</span><span class="op" id="2505909">(</span><span class="ident" id="2505910"><a href="/strings/search.go.html#2505853">text</a></span><span class="op" id="2505914">)</span>&nbsp;<span class="op" id="2505916">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2505920">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2505994">j</span>&nbsp;<span class="op" id="2505996">:=</span>&nbsp;<span class="builtinfunc" id="2505999">len</span><span class="op" id="2506002">(</span><span class="ident" id="2506003"><a href="/strings/search.go.html#2505831">f</a></span><span class="op" id="2506004">.</span><span class="ident" id="2506005">pattern</span><span class="op" id="2506012">)</span>&nbsp;<span class="op" id="2506014">-</span>&nbsp;<span class="num" id="2506016">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2506020">for</span>&nbsp;<span class="ident" id="2506024"><a href="/strings/search.go.html#2505994">j</a></span>&nbsp;<span class="op" id="2506026">&gt;=</span>&nbsp;<span class="num" id="2506029">0</span>&nbsp;<span class="op" id="2506031">&amp;&amp;</span>&nbsp;<span class="ident" id="2506034"><a href="/strings/search.go.html#2505853">text</a></span><span class="op" id="2506038">[</span><span class="ident" id="2506039"><a href="/strings/search.go.html#2505873">i</a></span><span class="op" id="2506040">]</span>&nbsp;<span class="op" id="2506042">==</span>&nbsp;<span class="ident" id="2506045"><a href="/strings/search.go.html#2505831">f</a></span><span class="op" id="2506046">.</span><span class="ident" id="2506047">pattern</span><span class="op" id="2506054">[</span><span class="ident" id="2506055"><a href="/strings/search.go.html#2505994">j</a></span><span class="op" id="2506056">]</span>&nbsp;<span class="op" id="2506058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2506063"><a href="/strings/search.go.html#2505873">i</a></span><span class="op" id="2506064">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2506070"><a href="/strings/search.go.html#2505994">j</a></span><span class="op" id="2506071">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2506076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2506080">if</span>&nbsp;<span class="ident" id="2506083"><a href="/strings/search.go.html#2505994">j</a></span>&nbsp;<span class="op" id="2506085">&lt;</span>&nbsp;<span class="num" id="2506087">0</span>&nbsp;<span class="op" id="2506089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2506094">return</span>&nbsp;<span class="ident" id="2506101"><a href="/strings/search.go.html#2505873">i</a></span>&nbsp;<span class="op" id="2506103">+</span>&nbsp;<span class="num" id="2506105">1</span>&nbsp;<span class="comment" id="2506107">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2506118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2506122"><a href="/strings/search.go.html#2505873">i</a></span>&nbsp;<span class="op" id="2506124">+=</span>&nbsp;<span class="ident" id="2506127"><a href="/strings/search.go.html#2506198">max</a></span><span class="op" id="2506130">(</span><span class="ident" id="2506131"><a href="/strings/search.go.html#2505831">f</a></span><span class="op" id="2506132">.</span><span class="ident" id="2506133">badCharSkip</span><span class="op" id="2506144">[</span><span class="ident" id="2506145"><a href="/strings/search.go.html#2505853">text</a></span><span class="op" id="2506149">[</span><span class="ident" id="2506150"><a href="/strings/search.go.html#2505873">i</a></span><span class="op" id="2506151">]</span><span class="op" id="2506152">]</span><span class="op" id="2506153">,</span>&nbsp;<span class="ident" id="2506155"><a href="/strings/search.go.html#2505831">f</a></span><span class="op" id="2506156">.</span><span class="ident" id="2506157">goodSuffixSkip</span><span class="op" id="2506171">[</span><span class="ident" id="2506172"><a href="/strings/search.go.html#2505994">j</a></span><span class="op" id="2506173">]</span><span class="op" id="2506174">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2506177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2506180">return</span>&nbsp;<span class="op" id="2506187">-</span><span class="num" id="2506188">1</span><br>
<span class="lineno"></span><span class="op" id="2506190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2506193">func</span>&nbsp;<span class="ident" id="2506198">max</span><span class="op" id="2506201">(</span><span class="ident" id="2506202">a</span><span class="op" id="2506203">,</span>&nbsp;<span class="ident" id="2506205">b</span>&nbsp;<span class="builtintype" id="2506207">int</span><span class="op" id="2506210">)</span>&nbsp;<span class="builtintype" id="2506212">int</span>&nbsp;<span class="op" id="2506216">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2506219">if</span>&nbsp;<span class="ident" id="2506222"><a href="/strings/search.go.html#2506202">a</a></span>&nbsp;<span class="op" id="2506224">&gt;</span>&nbsp;<span class="ident" id="2506226"><a href="/strings/search.go.html#2506205">b</a></span>&nbsp;<span class="op" id="2506228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2506232">return</span>&nbsp;<span class="ident" id="2506239"><a href="/strings/search.go.html#2506202">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2506242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2506245">return</span>&nbsp;<span class="ident" id="2506252"><a href="/strings/search.go.html#2506205">b</a></span><br>
<span class="lineno"></span><span class="op" id="2506254">}</span>
</div>
</body>
</html>
