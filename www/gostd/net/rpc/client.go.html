<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5427406">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5427461">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5427515">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5427566">package</span>&nbsp;<span class="ident" id="5427574">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5427579">import</span>&nbsp;<span class="op" id="5427586">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427589">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427598">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427614">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427624">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427630">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427637">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427644">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427656">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5427663">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5427666">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5427729">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="5427771">type</span>&nbsp;<span class="ident" id="5427776">ServerError</span>&nbsp;<span class="builtintype" id="5427788">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5427796">func</span>&nbsp;<span class="op" id="5427801">(</span><span class="ident" id="5427802">e</span>&nbsp;<span class="ident" id="5427804">ServerError</span><span class="op" id="5427815">)</span>&nbsp;<span class="ident" id="5427817">Error</span><span class="op" id="5427822">(</span><span class="op" id="5427823">)</span>&nbsp;<span class="builtintype" id="5427825">string</span>&nbsp;<span class="op" id="5427832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5427835">return</span>&nbsp;<span class="builtintype" id="5427842">string</span><span class="op" id="5427848">(</span><span class="ident" id="5427849">e</span><span class="op" id="5427850">)</span><br>
<span class="lineno"></span><span class="op" id="5427852">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5427855">var</span>&nbsp;<span class="ident" id="5427859">ErrShutdown</span>&nbsp;<span class="op" id="5427871">=</span>&nbsp;<span class="ident" id="5427873">errors</span><span class="op" id="5427879">.</span><span class="ident" id="5427880">New</span><span class="op" id="5427883">(</span><span class="string" id="5427884">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="5427909">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5427912">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="5427946">type</span>&nbsp;<span class="ident" id="5427951">Call</span>&nbsp;<span class="keyword" id="5427956">struct</span>&nbsp;<span class="op" id="5427963">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5427966">ServiceMethod</span>&nbsp;<span class="builtintype" id="5427980">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5427992">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428040">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5428054">interface</span><span class="op" id="5428063">{</span><span class="op" id="5428064">}</span>&nbsp;<span class="comment" id="5428066">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428110">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5428124">interface</span><span class="op" id="5428133">{</span><span class="op" id="5428134">}</span>&nbsp;<span class="comment" id="5428136">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428179">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5428193">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5428205">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428245">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5428259">chan</span>&nbsp;<span class="op" id="5428264">*</span><span class="ident" id="5428265">Call</span>&nbsp;&nbsp;<span class="comment" id="5428271">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="5428305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5428308">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="5428344">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5428398">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="5428451">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="5428490">type</span>&nbsp;<span class="ident" id="5428495">Client</span>&nbsp;<span class="keyword" id="5428502">struct</span>&nbsp;<span class="op" id="5428509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428512">codec</span>&nbsp;<span class="ident" id="5428518">ClientCodec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428532">reqMutex</span>&nbsp;<span class="ident" id="5428541">sync</span><span class="op" id="5428545">.</span><span class="ident" id="5428546">Mutex</span>&nbsp;<span class="comment" id="5428552">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428575">request</span>&nbsp;&nbsp;<span class="ident" id="5428584">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428594">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428603">sync</span><span class="op" id="5428607">.</span><span class="ident" id="5428608">Mutex</span>&nbsp;<span class="comment" id="5428614">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428637">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428646">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428654">pending</span>&nbsp;&nbsp;<span class="keyword" id="5428663">map</span><span class="op" id="5428666">[</span><span class="ident" id="5428667">uint64</span><span class="op" id="5428673">]</span><span class="op" id="5428674">*</span><span class="ident" id="5428675">Call</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428681">closing</span>&nbsp;&nbsp;<span class="builtintype" id="5428690">bool</span>&nbsp;<span class="comment" id="5428695">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428721">shutdown</span>&nbsp;<span class="builtintype" id="5428730">bool</span>&nbsp;<span class="comment" id="5428735">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="5428765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5428768">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="5428824">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="5428891">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5428961">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5429023">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5429092">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="5429149">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5429215">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5429229">type</span>&nbsp;<span class="ident" id="5429234">ClientCodec</span>&nbsp;<span class="keyword" id="5429246">interface</span>&nbsp;<span class="op" id="5429256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429259">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429332">WriteRequest</span><span class="op" id="5429344">(</span><span class="op" id="5429345">*</span><span class="ident" id="5429346">Request</span><span class="op" id="5429353">,</span>&nbsp;<span class="keyword" id="5429355">interface</span><span class="op" id="5429364">{</span><span class="op" id="5429365">}</span><span class="op" id="5429366">)</span>&nbsp;<span class="builtintype" id="5429368">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429375">ReadResponseHeader</span><span class="op" id="5429393">(</span><span class="op" id="5429394">*</span><span class="ident" id="5429395">Response</span><span class="op" id="5429403">)</span>&nbsp;<span class="builtintype" id="5429405">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429412">ReadResponseBody</span><span class="op" id="5429428">(</span><span class="keyword" id="5429429">interface</span><span class="op" id="5429438">{</span><span class="op" id="5429439">}</span><span class="op" id="5429440">)</span>&nbsp;<span class="builtintype" id="5429442">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429450">Close</span><span class="op" id="5429455">(</span><span class="op" id="5429456">)</span>&nbsp;<span class="builtintype" id="5429458">error</span><br>
<span class="lineno"></span><span class="op" id="5429464">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5429467">func</span>&nbsp;<span class="op" id="5429472">(</span><span class="ident" id="5429473">client</span>&nbsp;<span class="op" id="5429480">*</span><span class="ident" id="5429481">Client</span><span class="op" id="5429487">)</span>&nbsp;<span class="ident" id="5429489">send</span><span class="op" id="5429493">(</span><span class="ident" id="5429494">call</span>&nbsp;<span class="op" id="5429499">*</span><span class="ident" id="5429500">Call</span><span class="op" id="5429504">)</span>&nbsp;<span class="op" id="5429506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429509">client</span><span class="op" id="5429515">.</span><span class="ident" id="5429516">reqMutex</span><span class="op" id="5429524">.</span><span class="ident" id="5429525">Lock</span><span class="op" id="5429529">(</span><span class="op" id="5429530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5429533">defer</span>&nbsp;<span class="ident" id="5429539">client</span><span class="op" id="5429545">.</span><span class="ident" id="5429546">reqMutex</span><span class="op" id="5429554">.</span><span class="ident" id="5429555">Unlock</span><span class="op" id="5429561">(</span><span class="op" id="5429562">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429566">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429590">client</span><span class="op" id="5429596">.</span><span class="ident" id="5429597">mutex</span><span class="op" id="5429602">.</span><span class="ident" id="5429603">Lock</span><span class="op" id="5429607">(</span><span class="op" id="5429608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5429611">if</span>&nbsp;<span class="ident" id="5429614">client</span><span class="op" id="5429620">.</span><span class="ident" id="5429621">shutdown</span>&nbsp;<span class="op" id="5429630">||</span>&nbsp;<span class="ident" id="5429633">client</span><span class="op" id="5429639">.</span><span class="ident" id="5429640">closing</span>&nbsp;<span class="op" id="5429648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429652">call</span><span class="op" id="5429656">.</span><span class="ident" id="5429657">Error</span>&nbsp;<span class="op" id="5429663">=</span>&nbsp;<span class="ident" id="5429665">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429679">client</span><span class="op" id="5429685">.</span><span class="ident" id="5429686">mutex</span><span class="op" id="5429691">.</span><span class="ident" id="5429692">Unlock</span><span class="op" id="5429698">(</span><span class="op" id="5429699">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429703">call</span><span class="op" id="5429707">.</span><span class="ident" id="5429708">done</span><span class="op" id="5429712">(</span><span class="op" id="5429713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5429717">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429728">seq</span>&nbsp;<span class="op" id="5429732">:=</span>&nbsp;<span class="ident" id="5429735">client</span><span class="op" id="5429741">.</span><span class="ident" id="5429742">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429747">client</span><span class="op" id="5429753">.</span><span class="ident" id="5429754">seq</span><span class="op" id="5429757">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429761">client</span><span class="op" id="5429767">.</span><span class="ident" id="5429768">pending</span><span class="op" id="5429775">[</span><span class="ident" id="5429776">seq</span><span class="op" id="5429779">]</span>&nbsp;<span class="op" id="5429781">=</span>&nbsp;<span class="ident" id="5429783">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429789">client</span><span class="op" id="5429795">.</span><span class="ident" id="5429796">mutex</span><span class="op" id="5429801">.</span><span class="ident" id="5429802">Unlock</span><span class="op" id="5429808">(</span><span class="op" id="5429809">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429813">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429846">client</span><span class="op" id="5429852">.</span><span class="ident" id="5429853">request</span><span class="op" id="5429860">.</span><span class="ident" id="5429861">Seq</span>&nbsp;<span class="op" id="5429865">=</span>&nbsp;<span class="ident" id="5429867">seq</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429872">client</span><span class="op" id="5429878">.</span><span class="ident" id="5429879">request</span><span class="op" id="5429886">.</span><span class="ident" id="5429887">ServiceMethod</span>&nbsp;<span class="op" id="5429901">=</span>&nbsp;<span class="ident" id="5429903">call</span><span class="op" id="5429907">.</span><span class="ident" id="5429908">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429923">err</span>&nbsp;<span class="op" id="5429927">:=</span>&nbsp;<span class="ident" id="5429930">client</span><span class="op" id="5429936">.</span><span class="ident" id="5429937">codec</span><span class="op" id="5429942">.</span><span class="ident" id="5429943">WriteRequest</span><span class="op" id="5429955">(</span><span class="op" id="5429956">&amp;</span><span class="ident" id="5429957">client</span><span class="op" id="5429963">.</span><span class="ident" id="5429964">request</span><span class="op" id="5429971">,</span>&nbsp;<span class="ident" id="5429973">call</span><span class="op" id="5429977">.</span><span class="ident" id="5429978">Args</span><span class="op" id="5429982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5429985">if</span>&nbsp;<span class="ident" id="5429988">err</span>&nbsp;<span class="op" id="5429992">!=</span>&nbsp;<span class="builtintype" id="5429995">nil</span>&nbsp;<span class="op" id="5429999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430003">client</span><span class="op" id="5430009">.</span><span class="ident" id="5430010">mutex</span><span class="op" id="5430015">.</span><span class="ident" id="5430016">Lock</span><span class="op" id="5430020">(</span><span class="op" id="5430021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430025">call</span>&nbsp;<span class="op" id="5430030">=</span>&nbsp;<span class="ident" id="5430032">client</span><span class="op" id="5430038">.</span><span class="ident" id="5430039">pending</span><span class="op" id="5430046">[</span><span class="ident" id="5430047">seq</span><span class="op" id="5430050">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5430054">delete</span><span class="op" id="5430060">(</span><span class="ident" id="5430061">client</span><span class="op" id="5430067">.</span><span class="ident" id="5430068">pending</span><span class="op" id="5430075">,</span>&nbsp;<span class="ident" id="5430077">seq</span><span class="op" id="5430080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430084">client</span><span class="op" id="5430090">.</span><span class="ident" id="5430091">mutex</span><span class="op" id="5430096">.</span><span class="ident" id="5430097">Unlock</span><span class="op" id="5430103">(</span><span class="op" id="5430104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430108">if</span>&nbsp;<span class="ident" id="5430111">call</span>&nbsp;<span class="op" id="5430116">!=</span>&nbsp;<span class="builtintype" id="5430119">nil</span>&nbsp;<span class="op" id="5430123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430128">call</span><span class="op" id="5430132">.</span><span class="ident" id="5430133">Error</span>&nbsp;<span class="op" id="5430139">=</span>&nbsp;<span class="ident" id="5430141">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430148">call</span><span class="op" id="5430152">.</span><span class="ident" id="5430153">done</span><span class="op" id="5430157">(</span><span class="op" id="5430158">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430165">}</span><br>
<span class="lineno"></span><span class="op" id="5430167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5430170">func</span>&nbsp;<span class="op" id="5430175">(</span><span class="ident" id="5430176">client</span>&nbsp;<span class="op" id="5430183">*</span><span class="ident" id="5430184">Client</span><span class="op" id="5430190">)</span>&nbsp;<span class="ident" id="5430192">input</span><span class="op" id="5430197">(</span><span class="op" id="5430198">)</span>&nbsp;<span class="op" id="5430200">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430203">var</span>&nbsp;<span class="ident" id="5430207">err</span>&nbsp;<span class="builtintype" id="5430211">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430218">var</span>&nbsp;<span class="ident" id="5430222">response</span>&nbsp;<span class="ident" id="5430231">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430241">for</span>&nbsp;<span class="ident" id="5430245">err</span>&nbsp;<span class="op" id="5430249">==</span>&nbsp;<span class="builtintype" id="5430252">nil</span>&nbsp;<span class="op" id="5430256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430260">response</span>&nbsp;<span class="op" id="5430269">=</span>&nbsp;<span class="ident" id="5430271">Response</span><span class="op" id="5430279">{</span><span class="op" id="5430280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430284">err</span>&nbsp;<span class="op" id="5430288">=</span>&nbsp;<span class="ident" id="5430290">client</span><span class="op" id="5430296">.</span><span class="ident" id="5430297">codec</span><span class="op" id="5430302">.</span><span class="ident" id="5430303">ReadResponseHeader</span><span class="op" id="5430321">(</span><span class="op" id="5430322">&amp;</span><span class="ident" id="5430323">response</span><span class="op" id="5430331">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430335">if</span>&nbsp;<span class="ident" id="5430338">err</span>&nbsp;<span class="op" id="5430342">!=</span>&nbsp;<span class="builtintype" id="5430345">nil</span>&nbsp;<span class="op" id="5430349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430354">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430366">seq</span>&nbsp;<span class="op" id="5430370">:=</span>&nbsp;<span class="ident" id="5430373">response</span><span class="op" id="5430381">.</span><span class="ident" id="5430382">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430388">client</span><span class="op" id="5430394">.</span><span class="ident" id="5430395">mutex</span><span class="op" id="5430400">.</span><span class="ident" id="5430401">Lock</span><span class="op" id="5430405">(</span><span class="op" id="5430406">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430410">call</span>&nbsp;<span class="op" id="5430415">:=</span>&nbsp;<span class="ident" id="5430418">client</span><span class="op" id="5430424">.</span><span class="ident" id="5430425">pending</span><span class="op" id="5430432">[</span><span class="ident" id="5430433">seq</span><span class="op" id="5430436">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5430440">delete</span><span class="op" id="5430446">(</span><span class="ident" id="5430447">client</span><span class="op" id="5430453">.</span><span class="ident" id="5430454">pending</span><span class="op" id="5430461">,</span>&nbsp;<span class="ident" id="5430463">seq</span><span class="op" id="5430466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430470">client</span><span class="op" id="5430476">.</span><span class="ident" id="5430477">mutex</span><span class="op" id="5430482">.</span><span class="ident" id="5430483">Unlock</span><span class="op" id="5430489">(</span><span class="op" id="5430490">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430495">switch</span>&nbsp;<span class="op" id="5430502">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430506">case</span>&nbsp;<span class="ident" id="5430511">call</span>&nbsp;<span class="op" id="5430516">==</span>&nbsp;<span class="builtintype" id="5430519">nil</span><span class="op" id="5430522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5430527">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5430584">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5430642">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5430698">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5430756">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430816">err</span>&nbsp;<span class="op" id="5430820">=</span>&nbsp;<span class="ident" id="5430822">client</span><span class="op" id="5430828">.</span><span class="ident" id="5430829">codec</span><span class="op" id="5430834">.</span><span class="ident" id="5430835">ReadResponseBody</span><span class="op" id="5430851">(</span><span class="builtintype" id="5430852">nil</span><span class="op" id="5430855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430860">if</span>&nbsp;<span class="ident" id="5430863">err</span>&nbsp;<span class="op" id="5430867">!=</span>&nbsp;<span class="builtintype" id="5430870">nil</span>&nbsp;<span class="op" id="5430874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430880">err</span>&nbsp;<span class="op" id="5430884">=</span>&nbsp;<span class="ident" id="5430886">errors</span><span class="op" id="5430892">.</span><span class="ident" id="5430893">New</span><span class="op" id="5430896">(</span><span class="string" id="5430897">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5430920">+</span>&nbsp;<span class="ident" id="5430922">err</span><span class="op" id="5430925">.</span><span class="ident" id="5430926">Error</span><span class="op" id="5430931">(</span><span class="op" id="5430932">)</span><span class="op" id="5430933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430938">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430942">case</span>&nbsp;<span class="ident" id="5430947">response</span><span class="op" id="5430955">.</span><span class="ident" id="5430956">Error</span>&nbsp;<span class="op" id="5430962">!=</span>&nbsp;<span class="string" id="5430965">&#34;&#34;</span><span class="op" id="5430967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5430972">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5431033">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5431093">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431122">call</span><span class="op" id="5431126">.</span><span class="ident" id="5431127">Error</span>&nbsp;<span class="op" id="5431133">=</span>&nbsp;<span class="ident" id="5431135">ServerError</span><span class="op" id="5431146">(</span><span class="ident" id="5431147">response</span><span class="op" id="5431155">.</span><span class="ident" id="5431156">Error</span><span class="op" id="5431161">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431166">err</span>&nbsp;<span class="op" id="5431170">=</span>&nbsp;<span class="ident" id="5431172">client</span><span class="op" id="5431178">.</span><span class="ident" id="5431179">codec</span><span class="op" id="5431184">.</span><span class="ident" id="5431185">ReadResponseBody</span><span class="op" id="5431201">(</span><span class="builtintype" id="5431202">nil</span><span class="op" id="5431205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431210">if</span>&nbsp;<span class="ident" id="5431213">err</span>&nbsp;<span class="op" id="5431217">!=</span>&nbsp;<span class="builtintype" id="5431220">nil</span>&nbsp;<span class="op" id="5431224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431230">err</span>&nbsp;<span class="op" id="5431234">=</span>&nbsp;<span class="ident" id="5431236">errors</span><span class="op" id="5431242">.</span><span class="ident" id="5431243">New</span><span class="op" id="5431246">(</span><span class="string" id="5431247">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5431270">+</span>&nbsp;<span class="ident" id="5431272">err</span><span class="op" id="5431275">.</span><span class="ident" id="5431276">Error</span><span class="op" id="5431281">(</span><span class="op" id="5431282">)</span><span class="op" id="5431283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431293">call</span><span class="op" id="5431297">.</span><span class="ident" id="5431298">done</span><span class="op" id="5431302">(</span><span class="op" id="5431303">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431307">default</span><span class="op" id="5431314">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431319">err</span>&nbsp;<span class="op" id="5431323">=</span>&nbsp;<span class="ident" id="5431325">client</span><span class="op" id="5431331">.</span><span class="ident" id="5431332">codec</span><span class="op" id="5431337">.</span><span class="ident" id="5431338">ReadResponseBody</span><span class="op" id="5431354">(</span><span class="ident" id="5431355">call</span><span class="op" id="5431359">.</span><span class="ident" id="5431360">Reply</span><span class="op" id="5431365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431370">if</span>&nbsp;<span class="ident" id="5431373">err</span>&nbsp;<span class="op" id="5431377">!=</span>&nbsp;<span class="builtintype" id="5431380">nil</span>&nbsp;<span class="op" id="5431384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431390">call</span><span class="op" id="5431394">.</span><span class="ident" id="5431395">Error</span>&nbsp;<span class="op" id="5431401">=</span>&nbsp;<span class="ident" id="5431403">errors</span><span class="op" id="5431409">.</span><span class="ident" id="5431410">New</span><span class="op" id="5431413">(</span><span class="string" id="5431414">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="5431430">+</span>&nbsp;<span class="ident" id="5431432">err</span><span class="op" id="5431435">.</span><span class="ident" id="5431436">Error</span><span class="op" id="5431441">(</span><span class="op" id="5431442">)</span><span class="op" id="5431443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431448">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431453">call</span><span class="op" id="5431457">.</span><span class="ident" id="5431458">done</span><span class="op" id="5431462">(</span><span class="op" id="5431463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5431473">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431502">client</span><span class="op" id="5431508">.</span><span class="ident" id="5431509">reqMutex</span><span class="op" id="5431517">.</span><span class="ident" id="5431518">Lock</span><span class="op" id="5431522">(</span><span class="op" id="5431523">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431526">client</span><span class="op" id="5431532">.</span><span class="ident" id="5431533">mutex</span><span class="op" id="5431538">.</span><span class="ident" id="5431539">Lock</span><span class="op" id="5431543">(</span><span class="op" id="5431544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431547">client</span><span class="op" id="5431553">.</span><span class="ident" id="5431554">shutdown</span>&nbsp;<span class="op" id="5431563">=</span>&nbsp;<span class="builtintype" id="5431565">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431571">closing</span>&nbsp;<span class="op" id="5431579">:=</span>&nbsp;<span class="ident" id="5431582">client</span><span class="op" id="5431588">.</span><span class="ident" id="5431589">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431598">if</span>&nbsp;<span class="ident" id="5431601">err</span>&nbsp;<span class="op" id="5431605">==</span>&nbsp;<span class="ident" id="5431608">io</span><span class="op" id="5431610">.</span><span class="ident" id="5431611">EOF</span>&nbsp;<span class="op" id="5431615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431619">if</span>&nbsp;<span class="ident" id="5431622">closing</span>&nbsp;<span class="op" id="5431630">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431635">err</span>&nbsp;<span class="op" id="5431639">=</span>&nbsp;<span class="ident" id="5431641">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431655">}</span>&nbsp;<span class="keyword" id="5431657">else</span>&nbsp;<span class="op" id="5431662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431667">err</span>&nbsp;<span class="op" id="5431671">=</span>&nbsp;<span class="ident" id="5431673">io</span><span class="op" id="5431675">.</span><span class="ident" id="5431676">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431698">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431701">for</span>&nbsp;<span class="ident" id="5431705">_</span><span class="op" id="5431706">,</span>&nbsp;<span class="ident" id="5431708">call</span>&nbsp;<span class="op" id="5431713">:=</span>&nbsp;<span class="keyword" id="5431716">range</span>&nbsp;<span class="ident" id="5431722">client</span><span class="op" id="5431728">.</span><span class="ident" id="5431729">pending</span>&nbsp;<span class="op" id="5431737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431741">call</span><span class="op" id="5431745">.</span><span class="ident" id="5431746">Error</span>&nbsp;<span class="op" id="5431752">=</span>&nbsp;<span class="ident" id="5431754">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431760">call</span><span class="op" id="5431764">.</span><span class="ident" id="5431765">done</span><span class="op" id="5431769">(</span><span class="op" id="5431770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431776">client</span><span class="op" id="5431782">.</span><span class="ident" id="5431783">mutex</span><span class="op" id="5431788">.</span><span class="ident" id="5431789">Unlock</span><span class="op" id="5431795">(</span><span class="op" id="5431796">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431799">client</span><span class="op" id="5431805">.</span><span class="ident" id="5431806">reqMutex</span><span class="op" id="5431814">.</span><span class="ident" id="5431815">Unlock</span><span class="op" id="5431821">(</span><span class="op" id="5431822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431825">if</span>&nbsp;<span class="ident" id="5431828">debugLog</span>&nbsp;<span class="op" id="5431837">&amp;&amp;</span>&nbsp;<span class="ident" id="5431840">err</span>&nbsp;<span class="op" id="5431844">!=</span>&nbsp;<span class="ident" id="5431847">io</span><span class="op" id="5431849">.</span><span class="ident" id="5431850">EOF</span>&nbsp;<span class="op" id="5431854">&amp;&amp;</span>&nbsp;<span class="op" id="5431857">!</span><span class="ident" id="5431858">closing</span>&nbsp;<span class="op" id="5431866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431870">log</span><span class="op" id="5431873">.</span><span class="ident" id="5431874">Println</span><span class="op" id="5431881">(</span><span class="string" id="5431882">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="5431911">,</span>&nbsp;<span class="ident" id="5431913">err</span><span class="op" id="5431916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431919">}</span><br>
<span class="lineno"></span><span class="op" id="5431921">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5431924">func</span>&nbsp;<span class="op" id="5431929">(</span><span class="ident" id="5431930">call</span>&nbsp;<span class="op" id="5431935">*</span><span class="ident" id="5431936">Call</span><span class="op" id="5431940">)</span>&nbsp;<span class="ident" id="5431942">done</span><span class="op" id="5431946">(</span><span class="op" id="5431947">)</span>&nbsp;<span class="op" id="5431949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431952">select</span>&nbsp;<span class="op" id="5431959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431962">case</span>&nbsp;<span class="ident" id="5431967">call</span><span class="op" id="5431971">.</span><span class="ident" id="5431972">Done</span>&nbsp;<span class="op" id="5431977">&lt;-</span>&nbsp;<span class="ident" id="5431980">call</span><span class="op" id="5431984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5431988">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431995">default</span><span class="op" id="5432002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5432006">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5432083">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432151">if</span>&nbsp;<span class="ident" id="5432154">debugLog</span>&nbsp;<span class="op" id="5432163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432168">log</span><span class="op" id="5432171">.</span><span class="ident" id="5432172">Println</span><span class="op" id="5432179">(</span><span class="string" id="5432180">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="5432247">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5432251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5432254">}</span><br>
<span class="lineno"></span><span class="op" id="5432256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5432259">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="5432319">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5432374">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5432433">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="5432479">func</span>&nbsp;<span class="ident" id="5432484">NewClient</span><span class="op" id="5432493">(</span><span class="ident" id="5432494">conn</span>&nbsp;<span class="ident" id="5432499">io</span><span class="op" id="5432501">.</span><span class="ident" id="5432502">ReadWriteCloser</span><span class="op" id="5432517">)</span>&nbsp;<span class="op" id="5432519">*</span><span class="ident" id="5432520">Client</span>&nbsp;<span class="op" id="5432527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432530">encBuf</span>&nbsp;<span class="op" id="5432537">:=</span>&nbsp;<span class="ident" id="5432540">bufio</span><span class="op" id="5432545">.</span><span class="ident" id="5432546">NewWriter</span><span class="op" id="5432555">(</span><span class="ident" id="5432556">conn</span><span class="op" id="5432560">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432563">client</span>&nbsp;<span class="op" id="5432570">:=</span>&nbsp;<span class="op" id="5432573">&amp;</span><span class="ident" id="5432574">gobClientCodec</span><span class="op" id="5432588">{</span><span class="ident" id="5432589">conn</span><span class="op" id="5432593">,</span>&nbsp;<span class="ident" id="5432595">gob</span><span class="op" id="5432598">.</span><span class="ident" id="5432599">NewDecoder</span><span class="op" id="5432609">(</span><span class="ident" id="5432610">conn</span><span class="op" id="5432614">)</span><span class="op" id="5432615">,</span>&nbsp;<span class="ident" id="5432617">gob</span><span class="op" id="5432620">.</span><span class="ident" id="5432621">NewEncoder</span><span class="op" id="5432631">(</span><span class="ident" id="5432632">encBuf</span><span class="op" id="5432638">)</span><span class="op" id="5432639">,</span>&nbsp;<span class="ident" id="5432641">encBuf</span><span class="op" id="5432647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432650">return</span>&nbsp;<span class="ident" id="5432657">NewClientWithCodec</span><span class="op" id="5432675">(</span><span class="ident" id="5432676">client</span><span class="op" id="5432682">)</span><br>
<span class="lineno"></span><span class="op" id="5432684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5432687">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="5432750">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5432800">func</span>&nbsp;<span class="ident" id="5432805">NewClientWithCodec</span><span class="op" id="5432823">(</span><span class="ident" id="5432824">codec</span>&nbsp;<span class="ident" id="5432830">ClientCodec</span><span class="op" id="5432841">)</span>&nbsp;<span class="op" id="5432843">*</span><span class="ident" id="5432844">Client</span>&nbsp;<span class="op" id="5432851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432854">client</span>&nbsp;<span class="op" id="5432861">:=</span>&nbsp;<span class="op" id="5432864">&amp;</span><span class="ident" id="5432865">Client</span><span class="op" id="5432871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432875">codec</span><span class="op" id="5432880">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5432884">codec</span><span class="op" id="5432889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432893">pending</span><span class="op" id="5432900">:</span>&nbsp;<span class="builtinfunc" id="5432902">make</span><span class="op" id="5432906">(</span><span class="keyword" id="5432907">map</span><span class="op" id="5432910">[</span><span class="ident" id="5432911">uint64</span><span class="op" id="5432917">]</span><span class="op" id="5432918">*</span><span class="ident" id="5432919">Call</span><span class="op" id="5432923">)</span><span class="op" id="5432924">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5432927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432930">go</span>&nbsp;<span class="ident" id="5432933">client</span><span class="op" id="5432939">.</span><span class="ident" id="5432940">input</span><span class="op" id="5432945">(</span><span class="op" id="5432946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432949">return</span>&nbsp;<span class="ident" id="5432956">client</span><br>
<span class="lineno"></span><span class="op" id="5432963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5432966">type</span>&nbsp;<span class="ident" id="5432971">gobClientCodec</span>&nbsp;<span class="keyword" id="5432986">struct</span>&nbsp;<span class="op" id="5432993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432996">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433003">io</span><span class="op" id="5433005">.</span><span class="ident" id="5433006">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433023">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433030">*</span><span class="ident" id="5433031">gob</span><span class="op" id="5433034">.</span><span class="ident" id="5433035">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433044">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433051">*</span><span class="ident" id="5433052">gob</span><span class="op" id="5433055">.</span><span class="ident" id="5433056">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433065">encBuf</span>&nbsp;<span class="op" id="5433072">*</span><span class="ident" id="5433073">bufio</span><span class="op" id="5433078">.</span><span class="ident" id="5433079">Writer</span><br>
<span class="lineno">210</span><span class="op" id="5433086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5433089">func</span>&nbsp;<span class="op" id="5433094">(</span><span class="ident" id="5433095">c</span>&nbsp;<span class="op" id="5433097">*</span><span class="ident" id="5433098">gobClientCodec</span><span class="op" id="5433112">)</span>&nbsp;<span class="ident" id="5433114">WriteRequest</span><span class="op" id="5433126">(</span><span class="ident" id="5433127">r</span>&nbsp;<span class="op" id="5433129">*</span><span class="ident" id="5433130">Request</span><span class="op" id="5433137">,</span>&nbsp;<span class="ident" id="5433139">body</span>&nbsp;<span class="keyword" id="5433144">interface</span><span class="op" id="5433153">{</span><span class="op" id="5433154">}</span><span class="op" id="5433155">)</span>&nbsp;<span class="op" id="5433157">(</span><span class="ident" id="5433158">err</span>&nbsp;<span class="builtintype" id="5433162">error</span><span class="op" id="5433167">)</span>&nbsp;<span class="op" id="5433169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433172">if</span>&nbsp;<span class="ident" id="5433175">err</span>&nbsp;<span class="op" id="5433179">=</span>&nbsp;<span class="ident" id="5433181">c</span><span class="op" id="5433182">.</span><span class="ident" id="5433183">enc</span><span class="op" id="5433186">.</span><span class="ident" id="5433187">Encode</span><span class="op" id="5433193">(</span><span class="ident" id="5433194">r</span><span class="op" id="5433195">)</span><span class="op" id="5433196">;</span>&nbsp;<span class="ident" id="5433198">err</span>&nbsp;<span class="op" id="5433202">!=</span>&nbsp;<span class="builtintype" id="5433205">nil</span>&nbsp;<span class="op" id="5433209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433213">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433224">if</span>&nbsp;<span class="ident" id="5433227">err</span>&nbsp;<span class="op" id="5433231">=</span>&nbsp;<span class="ident" id="5433233">c</span><span class="op" id="5433234">.</span><span class="ident" id="5433235">enc</span><span class="op" id="5433238">.</span><span class="ident" id="5433239">Encode</span><span class="op" id="5433245">(</span><span class="ident" id="5433246">body</span><span class="op" id="5433250">)</span><span class="op" id="5433251">;</span>&nbsp;<span class="ident" id="5433253">err</span>&nbsp;<span class="op" id="5433257">!=</span>&nbsp;<span class="builtintype" id="5433260">nil</span>&nbsp;<span class="op" id="5433264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433268">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433279">return</span>&nbsp;<span class="ident" id="5433286">c</span><span class="op" id="5433287">.</span><span class="ident" id="5433288">encBuf</span><span class="op" id="5433294">.</span><span class="ident" id="5433295">Flush</span><span class="op" id="5433300">(</span><span class="op" id="5433301">)</span><br>
<span class="lineno">220</span><span class="op" id="5433303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5433306">func</span>&nbsp;<span class="op" id="5433311">(</span><span class="ident" id="5433312">c</span>&nbsp;<span class="op" id="5433314">*</span><span class="ident" id="5433315">gobClientCodec</span><span class="op" id="5433329">)</span>&nbsp;<span class="ident" id="5433331">ReadResponseHeader</span><span class="op" id="5433349">(</span><span class="ident" id="5433350">r</span>&nbsp;<span class="op" id="5433352">*</span><span class="ident" id="5433353">Response</span><span class="op" id="5433361">)</span>&nbsp;<span class="builtintype" id="5433363">error</span>&nbsp;<span class="op" id="5433369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433372">return</span>&nbsp;<span class="ident" id="5433379">c</span><span class="op" id="5433380">.</span><span class="ident" id="5433381">dec</span><span class="op" id="5433384">.</span><span class="ident" id="5433385">Decode</span><span class="op" id="5433391">(</span><span class="ident" id="5433392">r</span><span class="op" id="5433393">)</span><br>
<span class="lineno"></span><span class="op" id="5433395">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="5433398">func</span>&nbsp;<span class="op" id="5433403">(</span><span class="ident" id="5433404">c</span>&nbsp;<span class="op" id="5433406">*</span><span class="ident" id="5433407">gobClientCodec</span><span class="op" id="5433421">)</span>&nbsp;<span class="ident" id="5433423">ReadResponseBody</span><span class="op" id="5433439">(</span><span class="ident" id="5433440">body</span>&nbsp;<span class="keyword" id="5433445">interface</span><span class="op" id="5433454">{</span><span class="op" id="5433455">}</span><span class="op" id="5433456">)</span>&nbsp;<span class="builtintype" id="5433458">error</span>&nbsp;<span class="op" id="5433464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433467">return</span>&nbsp;<span class="ident" id="5433474">c</span><span class="op" id="5433475">.</span><span class="ident" id="5433476">dec</span><span class="op" id="5433479">.</span><span class="ident" id="5433480">Decode</span><span class="op" id="5433486">(</span><span class="ident" id="5433487">body</span><span class="op" id="5433491">)</span><br>
<span class="lineno"></span><span class="op" id="5433493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5433496">func</span>&nbsp;<span class="op" id="5433501">(</span><span class="ident" id="5433502">c</span>&nbsp;<span class="op" id="5433504">*</span><span class="ident" id="5433505">gobClientCodec</span><span class="op" id="5433519">)</span>&nbsp;<span class="ident" id="5433521">Close</span><span class="op" id="5433526">(</span><span class="op" id="5433527">)</span>&nbsp;<span class="builtintype" id="5433529">error</span>&nbsp;<span class="op" id="5433535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433538">return</span>&nbsp;<span class="ident" id="5433545">c</span><span class="op" id="5433546">.</span><span class="ident" id="5433547">rwc</span><span class="op" id="5433550">.</span><span class="ident" id="5433551">Close</span><span class="op" id="5433556">(</span><span class="op" id="5433557">)</span><br>
<span class="lineno"></span><span class="op" id="5433559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5433562">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="5433638">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5433681">func</span>&nbsp;<span class="ident" id="5433686">DialHTTP</span><span class="op" id="5433694">(</span><span class="ident" id="5433695">network</span><span class="op" id="5433702">,</span>&nbsp;<span class="ident" id="5433704">address</span>&nbsp;<span class="builtintype" id="5433712">string</span><span class="op" id="5433718">)</span>&nbsp;<span class="op" id="5433720">(</span><span class="op" id="5433721">*</span><span class="ident" id="5433722">Client</span><span class="op" id="5433728">,</span>&nbsp;<span class="builtintype" id="5433730">error</span><span class="op" id="5433735">)</span>&nbsp;<span class="op" id="5433737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433740">return</span>&nbsp;<span class="ident" id="5433747">DialHTTPPath</span><span class="op" id="5433759">(</span><span class="ident" id="5433760">network</span><span class="op" id="5433767">,</span>&nbsp;<span class="ident" id="5433769">address</span><span class="op" id="5433776">,</span>&nbsp;<span class="ident" id="5433778">DefaultRPCPath</span><span class="op" id="5433792">)</span><br>
<span class="lineno"></span><span class="op" id="5433794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="5433797">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5433844">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5433890">func</span>&nbsp;<span class="ident" id="5433895">DialHTTPPath</span><span class="op" id="5433907">(</span><span class="ident" id="5433908">network</span><span class="op" id="5433915">,</span>&nbsp;<span class="ident" id="5433917">address</span><span class="op" id="5433924">,</span>&nbsp;<span class="ident" id="5433926">path</span>&nbsp;<span class="builtintype" id="5433931">string</span><span class="op" id="5433937">)</span>&nbsp;<span class="op" id="5433939">(</span><span class="op" id="5433940">*</span><span class="ident" id="5433941">Client</span><span class="op" id="5433947">,</span>&nbsp;<span class="builtintype" id="5433949">error</span><span class="op" id="5433954">)</span>&nbsp;<span class="op" id="5433956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433959">var</span>&nbsp;<span class="ident" id="5433963">err</span>&nbsp;<span class="builtintype" id="5433967">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433974">conn</span><span class="op" id="5433978">,</span>&nbsp;<span class="ident" id="5433980">err</span>&nbsp;<span class="op" id="5433984">:=</span>&nbsp;<span class="ident" id="5433987">net</span><span class="op" id="5433990">.</span><span class="ident" id="5433991">Dial</span><span class="op" id="5433995">(</span><span class="ident" id="5433996">network</span><span class="op" id="5434003">,</span>&nbsp;<span class="ident" id="5434005">address</span><span class="op" id="5434012">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434015">if</span>&nbsp;<span class="ident" id="5434018">err</span>&nbsp;<span class="op" id="5434022">!=</span>&nbsp;<span class="builtintype" id="5434025">nil</span>&nbsp;<span class="op" id="5434029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434033">return</span>&nbsp;<span class="builtintype" id="5434040">nil</span><span class="op" id="5434043">,</span>&nbsp;<span class="ident" id="5434045">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434053">io</span><span class="op" id="5434055">.</span><span class="ident" id="5434056">WriteString</span><span class="op" id="5434067">(</span><span class="ident" id="5434068">conn</span><span class="op" id="5434072">,</span>&nbsp;<span class="string" id="5434074">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="5434084">+</span><span class="ident" id="5434085">path</span><span class="op" id="5434089">+</span><span class="string" id="5434090">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="5434105">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434109">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434146">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434184">resp</span><span class="op" id="5434188">,</span>&nbsp;<span class="ident" id="5434190">err</span>&nbsp;<span class="op" id="5434194">:=</span>&nbsp;<span class="ident" id="5434197">http</span><span class="op" id="5434201">.</span><span class="ident" id="5434202">ReadResponse</span><span class="op" id="5434214">(</span><span class="ident" id="5434215">bufio</span><span class="op" id="5434220">.</span><span class="ident" id="5434221">NewReader</span><span class="op" id="5434230">(</span><span class="ident" id="5434231">conn</span><span class="op" id="5434235">)</span><span class="op" id="5434236">,</span>&nbsp;<span class="op" id="5434238">&amp;</span><span class="ident" id="5434239">http</span><span class="op" id="5434243">.</span><span class="ident" id="5434244">Request</span><span class="op" id="5434251">{</span><span class="ident" id="5434252">Method</span><span class="op" id="5434258">:</span>&nbsp;<span class="string" id="5434260">&#34;CONNECT&#34;</span><span class="op" id="5434269">}</span><span class="op" id="5434270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434273">if</span>&nbsp;<span class="ident" id="5434276">err</span>&nbsp;<span class="op" id="5434280">==</span>&nbsp;<span class="builtintype" id="5434283">nil</span>&nbsp;<span class="op" id="5434287">&amp;&amp;</span>&nbsp;<span class="ident" id="5434290">resp</span><span class="op" id="5434294">.</span><span class="ident" id="5434295">Status</span>&nbsp;<span class="op" id="5434302">==</span>&nbsp;<span class="ident" id="5434305">connected</span>&nbsp;<span class="op" id="5434315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434319">return</span>&nbsp;<span class="ident" id="5434326">NewClient</span><span class="op" id="5434335">(</span><span class="ident" id="5434336">conn</span><span class="op" id="5434340">)</span><span class="op" id="5434341">,</span>&nbsp;<span class="builtintype" id="5434343">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434351">if</span>&nbsp;<span class="ident" id="5434354">err</span>&nbsp;<span class="op" id="5434358">==</span>&nbsp;<span class="builtintype" id="5434361">nil</span>&nbsp;<span class="op" id="5434365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434369">err</span>&nbsp;<span class="op" id="5434373">=</span>&nbsp;<span class="ident" id="5434375">errors</span><span class="op" id="5434381">.</span><span class="ident" id="5434382">New</span><span class="op" id="5434385">(</span><span class="string" id="5434386">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="5434415">+</span>&nbsp;<span class="ident" id="5434417">resp</span><span class="op" id="5434421">.</span><span class="ident" id="5434422">Status</span><span class="op" id="5434428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434434">conn</span><span class="op" id="5434438">.</span><span class="ident" id="5434439">Close</span><span class="op" id="5434444">(</span><span class="op" id="5434445">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434448">return</span>&nbsp;<span class="builtintype" id="5434455">nil</span><span class="op" id="5434458">,</span>&nbsp;<span class="op" id="5434460">&amp;</span><span class="ident" id="5434461">net</span><span class="op" id="5434464">.</span><span class="ident" id="5434465">OpError</span><span class="op" id="5434472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434476">Op</span><span class="op" id="5434478">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5434482">&#34;dial-http&#34;</span><span class="op" id="5434493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434497">Net</span><span class="op" id="5434500">:</span>&nbsp;&nbsp;<span class="ident" id="5434503">network</span>&nbsp;<span class="op" id="5434511">+</span>&nbsp;<span class="string" id="5434513">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5434517">+</span>&nbsp;<span class="ident" id="5434519">address</span><span class="op" id="5434526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434530">Addr</span><span class="op" id="5434534">:</span>&nbsp;<span class="builtintype" id="5434536">nil</span><span class="op" id="5434539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434543">Err</span><span class="op" id="5434546">:</span>&nbsp;&nbsp;<span class="ident" id="5434549">err</span><span class="op" id="5434552">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434555">}</span><br>
<span class="lineno"></span><span class="op" id="5434557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5434560">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5434628">func</span>&nbsp;<span class="ident" id="5434633">Dial</span><span class="op" id="5434637">(</span><span class="ident" id="5434638">network</span><span class="op" id="5434645">,</span>&nbsp;<span class="ident" id="5434647">address</span>&nbsp;<span class="builtintype" id="5434655">string</span><span class="op" id="5434661">)</span>&nbsp;<span class="op" id="5434663">(</span><span class="op" id="5434664">*</span><span class="ident" id="5434665">Client</span><span class="op" id="5434671">,</span>&nbsp;<span class="builtintype" id="5434673">error</span><span class="op" id="5434678">)</span>&nbsp;<span class="op" id="5434680">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434683">conn</span><span class="op" id="5434687">,</span>&nbsp;<span class="ident" id="5434689">err</span>&nbsp;<span class="op" id="5434693">:=</span>&nbsp;<span class="ident" id="5434696">net</span><span class="op" id="5434699">.</span><span class="ident" id="5434700">Dial</span><span class="op" id="5434704">(</span><span class="ident" id="5434705">network</span><span class="op" id="5434712">,</span>&nbsp;<span class="ident" id="5434714">address</span><span class="op" id="5434721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434724">if</span>&nbsp;<span class="ident" id="5434727">err</span>&nbsp;<span class="op" id="5434731">!=</span>&nbsp;<span class="builtintype" id="5434734">nil</span>&nbsp;<span class="op" id="5434738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434742">return</span>&nbsp;<span class="builtintype" id="5434749">nil</span><span class="op" id="5434752">,</span>&nbsp;<span class="ident" id="5434754">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434762">return</span>&nbsp;<span class="ident" id="5434769">NewClient</span><span class="op" id="5434778">(</span><span class="ident" id="5434779">conn</span><span class="op" id="5434783">)</span><span class="op" id="5434784">,</span>&nbsp;<span class="builtintype" id="5434786">nil</span><br>
<span class="lineno">275</span><span class="op" id="5434790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5434793">func</span>&nbsp;<span class="op" id="5434798">(</span><span class="ident" id="5434799">client</span>&nbsp;<span class="op" id="5434806">*</span><span class="ident" id="5434807">Client</span><span class="op" id="5434813">)</span>&nbsp;<span class="ident" id="5434815">Close</span><span class="op" id="5434820">(</span><span class="op" id="5434821">)</span>&nbsp;<span class="builtintype" id="5434823">error</span>&nbsp;<span class="op" id="5434829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434832">client</span><span class="op" id="5434838">.</span><span class="ident" id="5434839">mutex</span><span class="op" id="5434844">.</span><span class="ident" id="5434845">Lock</span><span class="op" id="5434849">(</span><span class="op" id="5434850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434853">if</span>&nbsp;<span class="ident" id="5434856">client</span><span class="op" id="5434862">.</span><span class="ident" id="5434863">closing</span>&nbsp;<span class="op" id="5434871">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434875">client</span><span class="op" id="5434881">.</span><span class="ident" id="5434882">mutex</span><span class="op" id="5434887">.</span><span class="ident" id="5434888">Unlock</span><span class="op" id="5434894">(</span><span class="op" id="5434895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434899">return</span>&nbsp;<span class="ident" id="5434906">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434922">client</span><span class="op" id="5434928">.</span><span class="ident" id="5434929">closing</span>&nbsp;<span class="op" id="5434937">=</span>&nbsp;<span class="builtintype" id="5434939">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434945">client</span><span class="op" id="5434951">.</span><span class="ident" id="5434952">mutex</span><span class="op" id="5434957">.</span><span class="ident" id="5434958">Unlock</span><span class="op" id="5434964">(</span><span class="op" id="5434965">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434968">return</span>&nbsp;<span class="ident" id="5434975">client</span><span class="op" id="5434981">.</span><span class="ident" id="5434982">codec</span><span class="op" id="5434987">.</span><span class="ident" id="5434988">Close</span><span class="op" id="5434993">(</span><span class="op" id="5434994">)</span><br>
<span class="lineno"></span><span class="op" id="5434996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5434999">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="5435086">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="5435174">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5435248">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="5435316">func</span>&nbsp;<span class="op" id="5435321">(</span><span class="ident" id="5435322">client</span>&nbsp;<span class="op" id="5435329">*</span><span class="ident" id="5435330">Client</span><span class="op" id="5435336">)</span>&nbsp;<span class="ident" id="5435338">Go</span><span class="op" id="5435340">(</span><span class="ident" id="5435341">serviceMethod</span>&nbsp;<span class="builtintype" id="5435355">string</span><span class="op" id="5435361">,</span>&nbsp;<span class="ident" id="5435363">args</span>&nbsp;<span class="keyword" id="5435368">interface</span><span class="op" id="5435377">{</span><span class="op" id="5435378">}</span><span class="op" id="5435379">,</span>&nbsp;<span class="ident" id="5435381">reply</span>&nbsp;<span class="keyword" id="5435387">interface</span><span class="op" id="5435396">{</span><span class="op" id="5435397">}</span><span class="op" id="5435398">,</span>&nbsp;<span class="ident" id="5435400">done</span>&nbsp;<span class="keyword" id="5435405">chan</span>&nbsp;<span class="op" id="5435410">*</span><span class="ident" id="5435411">Call</span><span class="op" id="5435415">)</span>&nbsp;<span class="op" id="5435417">*</span><span class="ident" id="5435418">Call</span>&nbsp;<span class="op" id="5435423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435426">call</span>&nbsp;<span class="op" id="5435431">:=</span>&nbsp;<span class="builtinfunc" id="5435434">new</span><span class="op" id="5435437">(</span><span class="ident" id="5435438">Call</span><span class="op" id="5435442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435445">call</span><span class="op" id="5435449">.</span><span class="ident" id="5435450">ServiceMethod</span>&nbsp;<span class="op" id="5435464">=</span>&nbsp;<span class="ident" id="5435466">serviceMethod</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435481">call</span><span class="op" id="5435485">.</span><span class="ident" id="5435486">Args</span>&nbsp;<span class="op" id="5435491">=</span>&nbsp;<span class="ident" id="5435493">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435499">call</span><span class="op" id="5435503">.</span><span class="ident" id="5435504">Reply</span>&nbsp;<span class="op" id="5435510">=</span>&nbsp;<span class="ident" id="5435512">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435519">if</span>&nbsp;<span class="ident" id="5435522">done</span>&nbsp;<span class="op" id="5435527">==</span>&nbsp;<span class="builtintype" id="5435530">nil</span>&nbsp;<span class="op" id="5435534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435538">done</span>&nbsp;<span class="op" id="5435543">=</span>&nbsp;<span class="builtinfunc" id="5435545">make</span><span class="op" id="5435549">(</span><span class="keyword" id="5435550">chan</span>&nbsp;<span class="op" id="5435555">*</span><span class="ident" id="5435556">Call</span><span class="op" id="5435560">,</span>&nbsp;<span class="num" id="5435562">10</span><span class="op" id="5435564">)</span>&nbsp;<span class="comment" id="5435566">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435580">}</span>&nbsp;<span class="keyword" id="5435582">else</span>&nbsp;<span class="op" id="5435587">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435591">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435647">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435706">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5435765">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435822">if</span>&nbsp;<span class="builtinfunc" id="5435825">cap</span><span class="op" id="5435828">(</span><span class="ident" id="5435829">done</span><span class="op" id="5435833">)</span>&nbsp;<span class="op" id="5435835">==</span>&nbsp;<span class="num" id="5435838">0</span>&nbsp;<span class="op" id="5435840">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435845">log</span><span class="op" id="5435848">.</span><span class="ident" id="5435849">Panic</span><span class="op" id="5435854">(</span><span class="string" id="5435855">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="5435888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435898">call</span><span class="op" id="5435902">.</span><span class="ident" id="5435903">Done</span>&nbsp;<span class="op" id="5435908">=</span>&nbsp;<span class="ident" id="5435910">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435916">client</span><span class="op" id="5435922">.</span><span class="ident" id="5435923">send</span><span class="op" id="5435927">(</span><span class="ident" id="5435928">call</span><span class="op" id="5435932">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435935">return</span>&nbsp;<span class="ident" id="5435942">call</span><br>
<span class="lineno"></span><span class="op" id="5435947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5435950">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="5436042">func</span>&nbsp;<span class="op" id="5436047">(</span><span class="ident" id="5436048">client</span>&nbsp;<span class="op" id="5436055">*</span><span class="ident" id="5436056">Client</span><span class="op" id="5436062">)</span>&nbsp;<span class="ident" id="5436064">Call</span><span class="op" id="5436068">(</span><span class="ident" id="5436069">serviceMethod</span>&nbsp;<span class="builtintype" id="5436083">string</span><span class="op" id="5436089">,</span>&nbsp;<span class="ident" id="5436091">args</span>&nbsp;<span class="keyword" id="5436096">interface</span><span class="op" id="5436105">{</span><span class="op" id="5436106">}</span><span class="op" id="5436107">,</span>&nbsp;<span class="ident" id="5436109">reply</span>&nbsp;<span class="keyword" id="5436115">interface</span><span class="op" id="5436124">{</span><span class="op" id="5436125">}</span><span class="op" id="5436126">)</span>&nbsp;<span class="builtintype" id="5436128">error</span>&nbsp;<span class="op" id="5436134">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436137">call</span>&nbsp;<span class="op" id="5436142">:=</span>&nbsp;<span class="op" id="5436145">&lt;-</span><span class="ident" id="5436147">client</span><span class="op" id="5436153">.</span><span class="ident" id="5436154">Go</span><span class="op" id="5436156">(</span><span class="ident" id="5436157">serviceMethod</span><span class="op" id="5436170">,</span>&nbsp;<span class="ident" id="5436172">args</span><span class="op" id="5436176">,</span>&nbsp;<span class="ident" id="5436178">reply</span><span class="op" id="5436183">,</span>&nbsp;<span class="builtinfunc" id="5436185">make</span><span class="op" id="5436189">(</span><span class="keyword" id="5436190">chan</span>&nbsp;<span class="op" id="5436195">*</span><span class="ident" id="5436196">Call</span><span class="op" id="5436200">,</span>&nbsp;<span class="num" id="5436202">1</span><span class="op" id="5436203">)</span><span class="op" id="5436204">)</span><span class="op" id="5436205">.</span><span class="ident" id="5436206">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436212">return</span>&nbsp;<span class="ident" id="5436219">call</span><span class="op" id="5436223">.</span><span class="ident" id="5436224">Error</span><br>
<span class="lineno"></span><span class="op" id="5436230">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
