<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html" class="current">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6652805">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6652860">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6652914">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6652965">package</span>&nbsp;<span class="ident" id="6652973">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6652978">import</span>&nbsp;<span class="op" id="6652985">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6652988">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6653001">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6653012">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6653023">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6653030">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6653033">func</span>&nbsp;<span class="ident" id="6653038">TestMutexLock</span><span class="op" id="6653051">(</span><span class="ident" id="6653052">t</span>&nbsp;<span class="op" id="6653054">*</span><span class="ident" id="6653055">testing</span><span class="op" id="6653062">.</span><span class="ident" id="6653063">T</span><span class="op" id="6653064">)</span>&nbsp;<span class="op" id="6653066">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653069">var</span>&nbsp;<span class="ident" id="6653073">mu</span>&nbsp;<span class="ident" id="6653076">fdMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653086">if</span>&nbsp;<span class="op" id="6653089">!</span><span class="ident" id="6653090">mu</span><span class="op" id="6653092">.</span><span class="ident" id="6653093">Incref</span><span class="op" id="6653099">(</span><span class="op" id="6653100">)</span>&nbsp;<span class="op" id="6653102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653106">t</span><span class="op" id="6653107">.</span><span class="ident" id="6653108">Fatal</span><span class="op" id="6653113">(</span><span class="string" id="6653114">&#34;broken&#34;</span><span class="op" id="6653122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653125">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653128">if</span>&nbsp;<span class="ident" id="6653131">mu</span><span class="op" id="6653133">.</span><span class="ident" id="6653134">Decref</span><span class="op" id="6653140">(</span><span class="op" id="6653141">)</span>&nbsp;<span class="op" id="6653143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653147">t</span><span class="op" id="6653148">.</span><span class="ident" id="6653149">Fatal</span><span class="op" id="6653154">(</span><span class="string" id="6653155">&#34;broken&#34;</span><span class="op" id="6653163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653170">if</span>&nbsp;<span class="op" id="6653173">!</span><span class="ident" id="6653174">mu</span><span class="op" id="6653176">.</span><span class="ident" id="6653177">RWLock</span><span class="op" id="6653183">(</span><span class="builtintype" id="6653184">true</span><span class="op" id="6653188">)</span>&nbsp;<span class="op" id="6653190">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653194">t</span><span class="op" id="6653195">.</span><span class="ident" id="6653196">Fatal</span><span class="op" id="6653201">(</span><span class="string" id="6653202">&#34;broken&#34;</span><span class="op" id="6653210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653216">if</span>&nbsp;<span class="ident" id="6653219">mu</span><span class="op" id="6653221">.</span><span class="ident" id="6653222">RWUnlock</span><span class="op" id="6653230">(</span><span class="builtintype" id="6653231">true</span><span class="op" id="6653235">)</span>&nbsp;<span class="op" id="6653237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653241">t</span><span class="op" id="6653242">.</span><span class="ident" id="6653243">Fatal</span><span class="op" id="6653248">(</span><span class="string" id="6653249">&#34;broken&#34;</span><span class="op" id="6653257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653260">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653264">if</span>&nbsp;<span class="op" id="6653267">!</span><span class="ident" id="6653268">mu</span><span class="op" id="6653270">.</span><span class="ident" id="6653271">RWLock</span><span class="op" id="6653277">(</span><span class="builtintype" id="6653278">false</span><span class="op" id="6653283">)</span>&nbsp;<span class="op" id="6653285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653289">t</span><span class="op" id="6653290">.</span><span class="ident" id="6653291">Fatal</span><span class="op" id="6653296">(</span><span class="string" id="6653297">&#34;broken&#34;</span><span class="op" id="6653305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653311">if</span>&nbsp;<span class="ident" id="6653314">mu</span><span class="op" id="6653316">.</span><span class="ident" id="6653317">RWUnlock</span><span class="op" id="6653325">(</span><span class="builtintype" id="6653326">false</span><span class="op" id="6653331">)</span>&nbsp;<span class="op" id="6653333">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653337">t</span><span class="op" id="6653338">.</span><span class="ident" id="6653339">Fatal</span><span class="op" id="6653344">(</span><span class="string" id="6653345">&#34;broken&#34;</span><span class="op" id="6653353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653356">}</span><br>
<span class="lineno"></span><span class="op" id="6653358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6653361">func</span>&nbsp;<span class="ident" id="6653366">TestMutexClose</span><span class="op" id="6653380">(</span><span class="ident" id="6653381">t</span>&nbsp;<span class="op" id="6653383">*</span><span class="ident" id="6653384">testing</span><span class="op" id="6653391">.</span><span class="ident" id="6653392">T</span><span class="op" id="6653393">)</span>&nbsp;<span class="op" id="6653395">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653398">var</span>&nbsp;<span class="ident" id="6653402">mu</span>&nbsp;<span class="ident" id="6653405">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653414">if</span>&nbsp;<span class="op" id="6653417">!</span><span class="ident" id="6653418">mu</span><span class="op" id="6653420">.</span><span class="ident" id="6653421">IncrefAndClose</span><span class="op" id="6653435">(</span><span class="op" id="6653436">)</span>&nbsp;<span class="op" id="6653438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653442">t</span><span class="op" id="6653443">.</span><span class="ident" id="6653444">Fatal</span><span class="op" id="6653449">(</span><span class="string" id="6653450">&#34;broken&#34;</span><span class="op" id="6653458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653465">if</span>&nbsp;<span class="ident" id="6653468">mu</span><span class="op" id="6653470">.</span><span class="ident" id="6653471">Incref</span><span class="op" id="6653477">(</span><span class="op" id="6653478">)</span>&nbsp;<span class="op" id="6653480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653484">t</span><span class="op" id="6653485">.</span><span class="ident" id="6653486">Fatal</span><span class="op" id="6653491">(</span><span class="string" id="6653492">&#34;broken&#34;</span><span class="op" id="6653500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653506">if</span>&nbsp;<span class="ident" id="6653509">mu</span><span class="op" id="6653511">.</span><span class="ident" id="6653512">RWLock</span><span class="op" id="6653518">(</span><span class="builtintype" id="6653519">true</span><span class="op" id="6653523">)</span>&nbsp;<span class="op" id="6653525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653529">t</span><span class="op" id="6653530">.</span><span class="ident" id="6653531">Fatal</span><span class="op" id="6653536">(</span><span class="string" id="6653537">&#34;broken&#34;</span><span class="op" id="6653545">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653551">if</span>&nbsp;<span class="ident" id="6653554">mu</span><span class="op" id="6653556">.</span><span class="ident" id="6653557">RWLock</span><span class="op" id="6653563">(</span><span class="builtintype" id="6653564">false</span><span class="op" id="6653569">)</span>&nbsp;<span class="op" id="6653571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653575">t</span><span class="op" id="6653576">.</span><span class="ident" id="6653577">Fatal</span><span class="op" id="6653582">(</span><span class="string" id="6653583">&#34;broken&#34;</span><span class="op" id="6653591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653597">if</span>&nbsp;<span class="ident" id="6653600">mu</span><span class="op" id="6653602">.</span><span class="ident" id="6653603">IncrefAndClose</span><span class="op" id="6653617">(</span><span class="op" id="6653618">)</span>&nbsp;<span class="op" id="6653620">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653624">t</span><span class="op" id="6653625">.</span><span class="ident" id="6653626">Fatal</span><span class="op" id="6653631">(</span><span class="string" id="6653632">&#34;broken&#34;</span><span class="op" id="6653640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653643">}</span><br>
<span class="lineno"></span><span class="op" id="6653645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6653648">func</span>&nbsp;<span class="ident" id="6653653">TestMutexCloseUnblock</span><span class="op" id="6653674">(</span><span class="ident" id="6653675">t</span>&nbsp;<span class="op" id="6653677">*</span><span class="ident" id="6653678">testing</span><span class="op" id="6653685">.</span><span class="ident" id="6653686">T</span><span class="op" id="6653687">)</span>&nbsp;<span class="op" id="6653689">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653692">c</span>&nbsp;<span class="op" id="6653694">:=</span>&nbsp;<span class="builtinfunc" id="6653697">make</span><span class="op" id="6653701">(</span><span class="keyword" id="6653702">chan</span>&nbsp;<span class="builtintype" id="6653707">bool</span><span class="op" id="6653711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653714">var</span>&nbsp;<span class="ident" id="6653718">mu</span>&nbsp;<span class="ident" id="6653721">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653730">mu</span><span class="op" id="6653732">.</span><span class="ident" id="6653733">RWLock</span><span class="op" id="6653739">(</span><span class="builtintype" id="6653740">true</span><span class="op" id="6653744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653747">for</span>&nbsp;<span class="ident" id="6653751">i</span>&nbsp;<span class="op" id="6653753">:=</span>&nbsp;<span class="num" id="6653756">0</span><span class="op" id="6653757">;</span>&nbsp;<span class="ident" id="6653759">i</span>&nbsp;<span class="op" id="6653761">&lt;</span>&nbsp;<span class="num" id="6653763">4</span><span class="op" id="6653764">;</span>&nbsp;<span class="ident" id="6653766">i</span><span class="op" id="6653767">++</span>&nbsp;<span class="op" id="6653770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653774">go</span>&nbsp;<span class="keyword" id="6653777">func</span><span class="op" id="6653781">(</span><span class="op" id="6653782">)</span>&nbsp;<span class="op" id="6653784">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653789">if</span>&nbsp;<span class="ident" id="6653792">mu</span><span class="op" id="6653794">.</span><span class="ident" id="6653795">RWLock</span><span class="op" id="6653801">(</span><span class="builtintype" id="6653802">true</span><span class="op" id="6653806">)</span>&nbsp;<span class="op" id="6653808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653814">t</span><span class="op" id="6653815">.</span><span class="ident" id="6653816">Error</span><span class="op" id="6653821">(</span><span class="string" id="6653822">&#34;broken&#34;</span><span class="op" id="6653830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653836">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653851">c</span>&nbsp;<span class="op" id="6653853">&lt;-</span>&nbsp;<span class="builtintype" id="6653856">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653863">}</span><span class="op" id="6653864">(</span><span class="op" id="6653865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6653871">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653938">time</span><span class="op" id="6653942">.</span><span class="ident" id="6653943">Sleep</span><span class="op" id="6653948">(</span><span class="ident" id="6653949">time</span><span class="op" id="6653953">.</span><span class="ident" id="6653954">Millisecond</span><span class="op" id="6653965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653968">select</span>&nbsp;<span class="op" id="6653975">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653978">case</span>&nbsp;<span class="op" id="6653983">&lt;-</span><span class="ident" id="6653985">c</span><span class="op" id="6653986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653990">t</span><span class="op" id="6653991">.</span><span class="ident" id="6653992">Fatal</span><span class="op" id="6653997">(</span><span class="string" id="6653998">&#34;broken&#34;</span><span class="op" id="6654006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654009">default</span><span class="op" id="6654016">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654022">mu</span><span class="op" id="6654024">.</span><span class="ident" id="6654025">IncrefAndClose</span><span class="op" id="6654039">(</span><span class="op" id="6654040">)</span>&nbsp;<span class="comment" id="6654042">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654072">for</span>&nbsp;<span class="ident" id="6654076">i</span>&nbsp;<span class="op" id="6654078">:=</span>&nbsp;<span class="num" id="6654081">0</span><span class="op" id="6654082">;</span>&nbsp;<span class="ident" id="6654084">i</span>&nbsp;<span class="op" id="6654086">&lt;</span>&nbsp;<span class="num" id="6654088">4</span><span class="op" id="6654089">;</span>&nbsp;<span class="ident" id="6654091">i</span><span class="op" id="6654092">++</span>&nbsp;<span class="op" id="6654095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654099">select</span>&nbsp;<span class="op" id="6654106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654110">case</span>&nbsp;<span class="op" id="6654115">&lt;-</span><span class="ident" id="6654117">c</span><span class="op" id="6654118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654122">case</span>&nbsp;<span class="op" id="6654127">&lt;-</span><span class="ident" id="6654129">time</span><span class="op" id="6654133">.</span><span class="ident" id="6654134">After</span><span class="op" id="6654139">(</span><span class="num" id="6654140">10</span>&nbsp;<span class="op" id="6654143">*</span>&nbsp;<span class="ident" id="6654145">time</span><span class="op" id="6654149">.</span><span class="ident" id="6654150">Second</span><span class="op" id="6654156">)</span><span class="op" id="6654157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654162">t</span><span class="op" id="6654163">.</span><span class="ident" id="6654164">Fatal</span><span class="op" id="6654169">(</span><span class="string" id="6654170">&#34;broken&#34;</span><span class="op" id="6654178">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654188">if</span>&nbsp;<span class="ident" id="6654191">mu</span><span class="op" id="6654193">.</span><span class="ident" id="6654194">Decref</span><span class="op" id="6654200">(</span><span class="op" id="6654201">)</span>&nbsp;<span class="op" id="6654203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654207">t</span><span class="op" id="6654208">.</span><span class="ident" id="6654209">Fatal</span><span class="op" id="6654214">(</span><span class="string" id="6654215">&#34;broken&#34;</span><span class="op" id="6654223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654226">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654229">if</span>&nbsp;<span class="op" id="6654232">!</span><span class="ident" id="6654233">mu</span><span class="op" id="6654235">.</span><span class="ident" id="6654236">RWUnlock</span><span class="op" id="6654244">(</span><span class="builtintype" id="6654245">true</span><span class="op" id="6654249">)</span>&nbsp;<span class="op" id="6654251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654255">t</span><span class="op" id="6654256">.</span><span class="ident" id="6654257">Fatal</span><span class="op" id="6654262">(</span><span class="string" id="6654263">&#34;broken&#34;</span><span class="op" id="6654271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654274">}</span><br>
<span class="lineno"></span><span class="op" id="6654276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6654279">func</span>&nbsp;<span class="ident" id="6654284">TestMutexPanic</span><span class="op" id="6654298">(</span><span class="ident" id="6654299">t</span>&nbsp;<span class="op" id="6654301">*</span><span class="ident" id="6654302">testing</span><span class="op" id="6654309">.</span><span class="ident" id="6654310">T</span><span class="op" id="6654311">)</span>&nbsp;<span class="op" id="6654313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654316">ensurePanics</span>&nbsp;<span class="op" id="6654329">:=</span>&nbsp;<span class="keyword" id="6654332">func</span><span class="op" id="6654336">(</span><span class="ident" id="6654337">f</span>&nbsp;<span class="keyword" id="6654339">func</span><span class="op" id="6654343">(</span><span class="op" id="6654344">)</span><span class="op" id="6654345">)</span>&nbsp;<span class="op" id="6654347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654351">defer</span>&nbsp;<span class="keyword" id="6654357">func</span><span class="op" id="6654361">(</span><span class="op" id="6654362">)</span>&nbsp;<span class="op" id="6654364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654369">if</span>&nbsp;<span class="builtinfunc" id="6654372">recover</span><span class="op" id="6654379">(</span><span class="op" id="6654380">)</span>&nbsp;<span class="op" id="6654382">==</span>&nbsp;<span class="builtintype" id="6654385">nil</span>&nbsp;<span class="op" id="6654389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654395">t</span><span class="op" id="6654396">.</span><span class="ident" id="6654397">Fatal</span><span class="op" id="6654402">(</span><span class="string" id="6654403">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="6654419">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654428">}</span><span class="op" id="6654429">(</span><span class="op" id="6654430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654434">f</span><span class="op" id="6654435">(</span><span class="op" id="6654436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654443">var</span>&nbsp;<span class="ident" id="6654447">mu</span>&nbsp;<span class="ident" id="6654450">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654459">ensurePanics</span><span class="op" id="6654471">(</span><span class="keyword" id="6654472">func</span><span class="op" id="6654476">(</span><span class="op" id="6654477">)</span>&nbsp;<span class="op" id="6654479">{</span>&nbsp;<span class="ident" id="6654481">mu</span><span class="op" id="6654483">.</span><span class="ident" id="6654484">Decref</span><span class="op" id="6654490">(</span><span class="op" id="6654491">)</span>&nbsp;<span class="op" id="6654493">}</span><span class="op" id="6654494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654497">ensurePanics</span><span class="op" id="6654509">(</span><span class="keyword" id="6654510">func</span><span class="op" id="6654514">(</span><span class="op" id="6654515">)</span>&nbsp;<span class="op" id="6654517">{</span>&nbsp;<span class="ident" id="6654519">mu</span><span class="op" id="6654521">.</span><span class="ident" id="6654522">RWUnlock</span><span class="op" id="6654530">(</span><span class="builtintype" id="6654531">true</span><span class="op" id="6654535">)</span>&nbsp;<span class="op" id="6654537">}</span><span class="op" id="6654538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654541">ensurePanics</span><span class="op" id="6654553">(</span><span class="keyword" id="6654554">func</span><span class="op" id="6654558">(</span><span class="op" id="6654559">)</span>&nbsp;<span class="op" id="6654561">{</span>&nbsp;<span class="ident" id="6654563">mu</span><span class="op" id="6654565">.</span><span class="ident" id="6654566">RWUnlock</span><span class="op" id="6654574">(</span><span class="builtintype" id="6654575">false</span><span class="op" id="6654580">)</span>&nbsp;<span class="op" id="6654582">}</span><span class="op" id="6654583">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654587">ensurePanics</span><span class="op" id="6654599">(</span><span class="keyword" id="6654600">func</span><span class="op" id="6654604">(</span><span class="op" id="6654605">)</span>&nbsp;<span class="op" id="6654607">{</span>&nbsp;<span class="ident" id="6654609">mu</span><span class="op" id="6654611">.</span><span class="ident" id="6654612">Incref</span><span class="op" id="6654618">(</span><span class="op" id="6654619">)</span><span class="op" id="6654620">;</span>&nbsp;<span class="ident" id="6654622">mu</span><span class="op" id="6654624">.</span><span class="ident" id="6654625">Decref</span><span class="op" id="6654631">(</span><span class="op" id="6654632">)</span><span class="op" id="6654633">;</span>&nbsp;<span class="ident" id="6654635">mu</span><span class="op" id="6654637">.</span><span class="ident" id="6654638">Decref</span><span class="op" id="6654644">(</span><span class="op" id="6654645">)</span>&nbsp;<span class="op" id="6654647">}</span><span class="op" id="6654648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654651">ensurePanics</span><span class="op" id="6654663">(</span><span class="keyword" id="6654664">func</span><span class="op" id="6654668">(</span><span class="op" id="6654669">)</span>&nbsp;<span class="op" id="6654671">{</span>&nbsp;<span class="ident" id="6654673">mu</span><span class="op" id="6654675">.</span><span class="ident" id="6654676">RWLock</span><span class="op" id="6654682">(</span><span class="builtintype" id="6654683">true</span><span class="op" id="6654687">)</span><span class="op" id="6654688">;</span>&nbsp;<span class="ident" id="6654690">mu</span><span class="op" id="6654692">.</span><span class="ident" id="6654693">RWUnlock</span><span class="op" id="6654701">(</span><span class="builtintype" id="6654702">true</span><span class="op" id="6654706">)</span><span class="op" id="6654707">;</span>&nbsp;<span class="ident" id="6654709">mu</span><span class="op" id="6654711">.</span><span class="ident" id="6654712">RWUnlock</span><span class="op" id="6654720">(</span><span class="builtintype" id="6654721">true</span><span class="op" id="6654725">)</span>&nbsp;<span class="op" id="6654727">}</span><span class="op" id="6654728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654731">ensurePanics</span><span class="op" id="6654743">(</span><span class="keyword" id="6654744">func</span><span class="op" id="6654748">(</span><span class="op" id="6654749">)</span>&nbsp;<span class="op" id="6654751">{</span>&nbsp;<span class="ident" id="6654753">mu</span><span class="op" id="6654755">.</span><span class="ident" id="6654756">RWLock</span><span class="op" id="6654762">(</span><span class="builtintype" id="6654763">false</span><span class="op" id="6654768">)</span><span class="op" id="6654769">;</span>&nbsp;<span class="ident" id="6654771">mu</span><span class="op" id="6654773">.</span><span class="ident" id="6654774">RWUnlock</span><span class="op" id="6654782">(</span><span class="builtintype" id="6654783">false</span><span class="op" id="6654788">)</span><span class="op" id="6654789">;</span>&nbsp;<span class="ident" id="6654791">mu</span><span class="op" id="6654793">.</span><span class="ident" id="6654794">RWUnlock</span><span class="op" id="6654802">(</span><span class="builtintype" id="6654803">false</span><span class="op" id="6654808">)</span>&nbsp;<span class="op" id="6654810">}</span><span class="op" id="6654811">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6654815">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654853">mu</span><span class="op" id="6654855">.</span><span class="ident" id="6654856">Incref</span><span class="op" id="6654862">(</span><span class="op" id="6654863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654866">mu</span><span class="op" id="6654868">.</span><span class="ident" id="6654869">Decref</span><span class="op" id="6654875">(</span><span class="op" id="6654876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654879">mu</span><span class="op" id="6654881">.</span><span class="ident" id="6654882">RWLock</span><span class="op" id="6654888">(</span><span class="builtintype" id="6654889">true</span><span class="op" id="6654893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654896">mu</span><span class="op" id="6654898">.</span><span class="ident" id="6654899">RWUnlock</span><span class="op" id="6654907">(</span><span class="builtintype" id="6654908">true</span><span class="op" id="6654912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654915">mu</span><span class="op" id="6654917">.</span><span class="ident" id="6654918">RWLock</span><span class="op" id="6654924">(</span><span class="builtintype" id="6654925">false</span><span class="op" id="6654930">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654933">mu</span><span class="op" id="6654935">.</span><span class="ident" id="6654936">RWUnlock</span><span class="op" id="6654944">(</span><span class="builtintype" id="6654945">false</span><span class="op" id="6654950">)</span><br>
<span class="lineno"></span><span class="op" id="6654952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6654955">func</span>&nbsp;<span class="ident" id="6654960">TestMutexStress</span><span class="op" id="6654975">(</span><span class="ident" id="6654976">t</span>&nbsp;<span class="op" id="6654978">*</span><span class="ident" id="6654979">testing</span><span class="op" id="6654986">.</span><span class="ident" id="6654987">T</span><span class="op" id="6654988">)</span>&nbsp;<span class="op" id="6654990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654993">P</span>&nbsp;<span class="op" id="6654995">:=</span>&nbsp;<span class="num" id="6654998">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655001">N</span>&nbsp;<span class="op" id="6655003">:=</span>&nbsp;<span class="builtintype" id="6655006">int</span><span class="op" id="6655009">(</span><span class="num" id="6655010">1e6</span><span class="op" id="6655013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655016">if</span>&nbsp;<span class="ident" id="6655019">testing</span><span class="op" id="6655026">.</span><span class="ident" id="6655027">Short</span><span class="op" id="6655032">(</span><span class="op" id="6655033">)</span>&nbsp;<span class="op" id="6655035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655039">P</span>&nbsp;<span class="op" id="6655041">=</span>&nbsp;<span class="num" id="6655043">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655047">N</span>&nbsp;<span class="op" id="6655049">=</span>&nbsp;<span class="num" id="6655051">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655056">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655059">defer</span>&nbsp;<span class="ident" id="6655065">runtime</span><span class="op" id="6655072">.</span><span class="ident" id="6655073">GOMAXPROCS</span><span class="op" id="6655083">(</span><span class="ident" id="6655084">runtime</span><span class="op" id="6655091">.</span><span class="ident" id="6655092">GOMAXPROCS</span><span class="op" id="6655102">(</span><span class="ident" id="6655103">P</span><span class="op" id="6655104">)</span><span class="op" id="6655105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655108">done</span>&nbsp;<span class="op" id="6655113">:=</span>&nbsp;<span class="builtinfunc" id="6655116">make</span><span class="op" id="6655120">(</span><span class="keyword" id="6655121">chan</span>&nbsp;<span class="builtintype" id="6655126">bool</span><span class="op" id="6655130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655133">var</span>&nbsp;<span class="ident" id="6655137">mu</span>&nbsp;<span class="ident" id="6655140">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655149">var</span>&nbsp;<span class="ident" id="6655153">readState</span>&nbsp;<span class="op" id="6655163">[</span><span class="num" id="6655164">2</span><span class="op" id="6655165">]</span><span class="builtintype" id="6655166">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655174">var</span>&nbsp;<span class="ident" id="6655178">writeState</span>&nbsp;<span class="op" id="6655189">[</span><span class="num" id="6655190">2</span><span class="op" id="6655191">]</span><span class="builtintype" id="6655192">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655200">for</span>&nbsp;<span class="ident" id="6655204">p</span>&nbsp;<span class="op" id="6655206">:=</span>&nbsp;<span class="num" id="6655209">0</span><span class="op" id="6655210">;</span>&nbsp;<span class="ident" id="6655212">p</span>&nbsp;<span class="op" id="6655214">&lt;</span>&nbsp;<span class="ident" id="6655216">P</span><span class="op" id="6655217">;</span>&nbsp;<span class="ident" id="6655219">p</span><span class="op" id="6655220">++</span>&nbsp;<span class="op" id="6655223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655227">go</span>&nbsp;<span class="keyword" id="6655230">func</span><span class="op" id="6655234">(</span><span class="op" id="6655235">)</span>&nbsp;<span class="op" id="6655237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655242">r</span>&nbsp;<span class="op" id="6655244">:=</span>&nbsp;<span class="ident" id="6655247">rand</span><span class="op" id="6655251">.</span><span class="ident" id="6655252">New</span><span class="op" id="6655255">(</span><span class="ident" id="6655256">rand</span><span class="op" id="6655260">.</span><span class="ident" id="6655261">NewSource</span><span class="op" id="6655270">(</span><span class="ident" id="6655271">rand</span><span class="op" id="6655275">.</span><span class="ident" id="6655276">Int63</span><span class="op" id="6655281">(</span><span class="op" id="6655282">)</span><span class="op" id="6655283">)</span><span class="op" id="6655284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655289">for</span>&nbsp;<span class="ident" id="6655293">i</span>&nbsp;<span class="op" id="6655295">:=</span>&nbsp;<span class="num" id="6655298">0</span><span class="op" id="6655299">;</span>&nbsp;<span class="ident" id="6655301">i</span>&nbsp;<span class="op" id="6655303">&lt;</span>&nbsp;<span class="ident" id="6655305">N</span><span class="op" id="6655306">;</span>&nbsp;<span class="ident" id="6655308">i</span><span class="op" id="6655309">++</span>&nbsp;<span class="op" id="6655312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655318">switch</span>&nbsp;<span class="ident" id="6655325">r</span><span class="op" id="6655326">.</span><span class="ident" id="6655327">Intn</span><span class="op" id="6655331">(</span><span class="num" id="6655332">3</span><span class="op" id="6655333">)</span>&nbsp;<span class="op" id="6655335">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655341">case</span>&nbsp;<span class="num" id="6655346">0</span><span class="op" id="6655347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655354">if</span>&nbsp;<span class="op" id="6655357">!</span><span class="ident" id="6655358">mu</span><span class="op" id="6655360">.</span><span class="ident" id="6655361">Incref</span><span class="op" id="6655367">(</span><span class="op" id="6655368">)</span>&nbsp;<span class="op" id="6655370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655378">t</span><span class="op" id="6655379">.</span><span class="ident" id="6655380">Error</span><span class="op" id="6655385">(</span><span class="string" id="6655386">&#34;broken&#34;</span><span class="op" id="6655394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655402">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655414">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655421">if</span>&nbsp;<span class="ident" id="6655424">mu</span><span class="op" id="6655426">.</span><span class="ident" id="6655427">Decref</span><span class="op" id="6655433">(</span><span class="op" id="6655434">)</span>&nbsp;<span class="op" id="6655436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655444">t</span><span class="op" id="6655445">.</span><span class="ident" id="6655446">Error</span><span class="op" id="6655451">(</span><span class="string" id="6655452">&#34;broken&#34;</span><span class="op" id="6655460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655468">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655486">case</span>&nbsp;<span class="num" id="6655491">1</span><span class="op" id="6655492">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655499">if</span>&nbsp;<span class="op" id="6655502">!</span><span class="ident" id="6655503">mu</span><span class="op" id="6655505">.</span><span class="ident" id="6655506">RWLock</span><span class="op" id="6655512">(</span><span class="builtintype" id="6655513">true</span><span class="op" id="6655517">)</span>&nbsp;<span class="op" id="6655519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655527">t</span><span class="op" id="6655528">.</span><span class="ident" id="6655529">Error</span><span class="op" id="6655534">(</span><span class="string" id="6655535">&#34;broken&#34;</span><span class="op" id="6655543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655551">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6655570">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655632">if</span>&nbsp;<span class="ident" id="6655635">readState</span><span class="op" id="6655644">[</span><span class="num" id="6655645">0</span><span class="op" id="6655646">]</span>&nbsp;<span class="op" id="6655648">!=</span>&nbsp;<span class="ident" id="6655651">readState</span><span class="op" id="6655660">[</span><span class="num" id="6655661">1</span><span class="op" id="6655662">]</span>&nbsp;<span class="op" id="6655664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655672">t</span><span class="op" id="6655673">.</span><span class="ident" id="6655674">Error</span><span class="op" id="6655679">(</span><span class="string" id="6655680">&#34;broken&#34;</span><span class="op" id="6655688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655696">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655715">readState</span><span class="op" id="6655724">[</span><span class="num" id="6655725">0</span><span class="op" id="6655726">]</span><span class="op" id="6655727">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655735">readState</span><span class="op" id="6655744">[</span><span class="num" id="6655745">1</span><span class="op" id="6655746">]</span><span class="op" id="6655747">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655755">if</span>&nbsp;<span class="ident" id="6655758">mu</span><span class="op" id="6655760">.</span><span class="ident" id="6655761">RWUnlock</span><span class="op" id="6655769">(</span><span class="builtintype" id="6655770">true</span><span class="op" id="6655774">)</span>&nbsp;<span class="op" id="6655776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655784">t</span><span class="op" id="6655785">.</span><span class="ident" id="6655786">Error</span><span class="op" id="6655791">(</span><span class="string" id="6655792">&#34;broken&#34;</span><span class="op" id="6655800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655808">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655820">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655826">case</span>&nbsp;<span class="num" id="6655831">2</span><span class="op" id="6655832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655839">if</span>&nbsp;<span class="op" id="6655842">!</span><span class="ident" id="6655843">mu</span><span class="op" id="6655845">.</span><span class="ident" id="6655846">RWLock</span><span class="op" id="6655852">(</span><span class="builtintype" id="6655853">false</span><span class="op" id="6655858">)</span>&nbsp;<span class="op" id="6655860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655868">t</span><span class="op" id="6655869">.</span><span class="ident" id="6655870">Error</span><span class="op" id="6655875">(</span><span class="string" id="6655876">&#34;broken&#34;</span><span class="op" id="6655884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655892">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655904">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6655911">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655973">if</span>&nbsp;<span class="ident" id="6655976">writeState</span><span class="op" id="6655986">[</span><span class="num" id="6655987">0</span><span class="op" id="6655988">]</span>&nbsp;<span class="op" id="6655990">!=</span>&nbsp;<span class="ident" id="6655993">writeState</span><span class="op" id="6656003">[</span><span class="num" id="6656004">1</span><span class="op" id="6656005">]</span>&nbsp;<span class="op" id="6656007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656015">t</span><span class="op" id="6656016">.</span><span class="ident" id="6656017">Error</span><span class="op" id="6656022">(</span><span class="string" id="6656023">&#34;broken&#34;</span><span class="op" id="6656031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656039">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656051">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656058">writeState</span><span class="op" id="6656068">[</span><span class="num" id="6656069">0</span><span class="op" id="6656070">]</span><span class="op" id="6656071">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656079">writeState</span><span class="op" id="6656089">[</span><span class="num" id="6656090">1</span><span class="op" id="6656091">]</span><span class="op" id="6656092">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656100">if</span>&nbsp;<span class="ident" id="6656103">mu</span><span class="op" id="6656105">.</span><span class="ident" id="6656106">RWUnlock</span><span class="op" id="6656114">(</span><span class="builtintype" id="6656115">false</span><span class="op" id="6656120">)</span>&nbsp;<span class="op" id="6656122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656130">t</span><span class="op" id="6656131">.</span><span class="ident" id="6656132">Error</span><span class="op" id="6656137">(</span><span class="string" id="6656138">&#34;broken&#34;</span><span class="op" id="6656146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656154">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656182">done</span>&nbsp;<span class="op" id="6656187">&lt;-</span>&nbsp;<span class="builtintype" id="6656190">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656197">}</span><span class="op" id="6656198">(</span><span class="op" id="6656199">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656205">for</span>&nbsp;<span class="ident" id="6656209">p</span>&nbsp;<span class="op" id="6656211">:=</span>&nbsp;<span class="num" id="6656214">0</span><span class="op" id="6656215">;</span>&nbsp;<span class="ident" id="6656217">p</span>&nbsp;<span class="op" id="6656219">&lt;</span>&nbsp;<span class="ident" id="6656221">P</span><span class="op" id="6656222">;</span>&nbsp;<span class="ident" id="6656224">p</span><span class="op" id="6656225">++</span>&nbsp;<span class="op" id="6656228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656232">&lt;-</span><span class="ident" id="6656234">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656243">if</span>&nbsp;<span class="op" id="6656246">!</span><span class="ident" id="6656247">mu</span><span class="op" id="6656249">.</span><span class="ident" id="6656250">IncrefAndClose</span><span class="op" id="6656264">(</span><span class="op" id="6656265">)</span>&nbsp;<span class="op" id="6656267">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656271">t</span><span class="op" id="6656272">.</span><span class="ident" id="6656273">Fatal</span><span class="op" id="6656278">(</span><span class="string" id="6656279">&#34;broken&#34;</span><span class="op" id="6656287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656293">if</span>&nbsp;<span class="op" id="6656296">!</span><span class="ident" id="6656297">mu</span><span class="op" id="6656299">.</span><span class="ident" id="6656300">Decref</span><span class="op" id="6656306">(</span><span class="op" id="6656307">)</span>&nbsp;<span class="op" id="6656309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656313">t</span><span class="op" id="6656314">.</span><span class="ident" id="6656315">Fatal</span><span class="op" id="6656320">(</span><span class="string" id="6656321">&#34;broken&#34;</span><span class="op" id="6656329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656332">}</span><br>
<span class="lineno">195</span><span class="op" id="6656334">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
