<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1849302">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1849357">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1849411">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1849462">//&nbsp;Malloc&nbsp;profiling.</span><br>
<span class="lineno"></span><span class="comment" id="1849483">//&nbsp;Patterned&nbsp;after&nbsp;tcmalloc&#39;s&nbsp;algorithms;&nbsp;shorter&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1849540">package</span>&nbsp;<span class="ident" id="1849548">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1849557">import</span>&nbsp;<span class="op" id="1849564">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1849567">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1849576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1849579">//&nbsp;NOTE(rsc):&nbsp;Everything&nbsp;here&nbsp;could&nbsp;use&nbsp;cas&nbsp;if&nbsp;contention&nbsp;became&nbsp;an&nbsp;issue.</span><br>
<span class="lineno">15</span><span class="keyword" id="1849654">var</span>&nbsp;<span class="ident" id="1849658">proflock</span>&nbsp;<span class="ident" id="1849667"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016175">mutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1849674">//&nbsp;All&nbsp;memory&nbsp;allocations&nbsp;are&nbsp;local&nbsp;and&nbsp;do&nbsp;not&nbsp;escape&nbsp;outside&nbsp;of&nbsp;the&nbsp;profiler.</span><br>
<span class="lineno"></span><span class="comment" id="1849753">//&nbsp;The&nbsp;profiler&nbsp;is&nbsp;forbidden&nbsp;from&nbsp;referring&nbsp;to&nbsp;garbage-collected&nbsp;memory.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="1849827">const</span>&nbsp;<span class="op" id="1849833">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849836">//&nbsp;profile&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849854">memProfile</span>&nbsp;<span class="ident" id="1849865"><a href="/runtime/mprof.go.html#1850022">bucketType</a></span>&nbsp;<span class="op" id="1849876">=</span>&nbsp;<span class="num" id="1849878">1</span>&nbsp;<span class="op" id="1849880">+</span>&nbsp;<span class="ident" id="1849882">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849888">blockProfile</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849903">//&nbsp;size&nbsp;of&nbsp;bucket&nbsp;hash&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849933">buckHashSize</span>&nbsp;<span class="op" id="1849946">=</span>&nbsp;<span class="num" id="1849948">179999</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849957">//&nbsp;max&nbsp;depth&nbsp;of&nbsp;stack&nbsp;to&nbsp;record&nbsp;in&nbsp;bucket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850000">maxStack</span>&nbsp;<span class="op" id="1850009">=</span>&nbsp;<span class="num" id="1850011">32</span><br>
<span class="lineno">30</span><span class="op" id="1850014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1850017">type</span>&nbsp;<span class="ident" id="1850022">bucketType</span>&nbsp;<span class="builtintype" id="1850033">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1850038">//&nbsp;A&nbsp;bucket&nbsp;holds&nbsp;per-call-stack&nbsp;profiling&nbsp;information.</span><br>
<span class="lineno">35</span><span class="comment" id="1850094">//&nbsp;The&nbsp;representation&nbsp;is&nbsp;a&nbsp;bit&nbsp;sleazy,&nbsp;inherited&nbsp;from&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="1850151">//&nbsp;This&nbsp;struct&nbsp;defines&nbsp;the&nbsp;bucket&nbsp;header.&nbsp;It&nbsp;is&nbsp;followed&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1850211">//&nbsp;memory&nbsp;by&nbsp;the&nbsp;stack&nbsp;words&nbsp;and&nbsp;then&nbsp;the&nbsp;actual&nbsp;record</span><br>
<span class="lineno"></span><span class="comment" id="1850267">//&nbsp;data,&nbsp;either&nbsp;a&nbsp;memRecord&nbsp;or&nbsp;a&nbsp;blockRecord.</span><br>
<span class="lineno"></span><span class="comment" id="1850313">//</span><br>
<span class="lineno">40</span><span class="comment" id="1850316">//&nbsp;Per-call-stack&nbsp;profiling&nbsp;information.</span><br>
<span class="lineno"></span><span class="comment" id="1850357">//&nbsp;Lookup&nbsp;by&nbsp;hashing&nbsp;call&nbsp;stack&nbsp;into&nbsp;a&nbsp;linked-list&nbsp;hash&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword" id="1850420">type</span>&nbsp;<span class="ident" id="1850425">bucket</span>&nbsp;<span class="keyword" id="1850432">struct</span>&nbsp;<span class="op" id="1850439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850442">next</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1850450">*</span><span class="ident" id="1850451"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850459">allnext</span>&nbsp;<span class="op" id="1850467">*</span><span class="ident" id="1850468"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850476">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1850484"><a href="/runtime/mprof.go.html#1850022">bucketType</a></span>&nbsp;<span class="comment" id="1850495">//&nbsp;memBucket&nbsp;or&nbsp;blockBucket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850524">hash</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1850532">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850541">size</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1850549">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850558">nstk</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1850566">uintptr</span><br>
<span class="lineno"></span><span class="op" id="1850574">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="1850577">//&nbsp;A&nbsp;memRecord&nbsp;is&nbsp;the&nbsp;bucket&nbsp;data&nbsp;for&nbsp;a&nbsp;bucket&nbsp;of&nbsp;type&nbsp;memProfile,</span><br>
<span class="lineno"></span><span class="comment" id="1850644">//&nbsp;part&nbsp;of&nbsp;the&nbsp;memory&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="1850675">type</span>&nbsp;<span class="ident" id="1850680">memRecord</span>&nbsp;<span class="keyword" id="1850690">struct</span>&nbsp;<span class="op" id="1850697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1850700">//&nbsp;The&nbsp;following&nbsp;complex&nbsp;3-stage&nbsp;scheme&nbsp;of&nbsp;stats&nbsp;accumulation</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1850763">//&nbsp;is&nbsp;required&nbsp;to&nbsp;obtain&nbsp;a&nbsp;consistent&nbsp;picture&nbsp;of&nbsp;mallocs&nbsp;and&nbsp;frees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1850831">//&nbsp;for&nbsp;some&nbsp;point&nbsp;in&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1850859">//&nbsp;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;mallocs&nbsp;come&nbsp;in&nbsp;real&nbsp;time,&nbsp;while&nbsp;frees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1850922">//&nbsp;come&nbsp;only&nbsp;after&nbsp;a&nbsp;GC&nbsp;during&nbsp;concurrent&nbsp;sweeping.&nbsp;So&nbsp;if&nbsp;we&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1850990">//&nbsp;naively&nbsp;count&nbsp;them,&nbsp;we&nbsp;would&nbsp;get&nbsp;a&nbsp;skew&nbsp;toward&nbsp;mallocs.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851050">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851054">//&nbsp;Mallocs&nbsp;are&nbsp;accounted&nbsp;in&nbsp;recent&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851097">//&nbsp;Explicit&nbsp;frees&nbsp;are&nbsp;accounted&nbsp;in&nbsp;recent&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851147">//&nbsp;GC&nbsp;frees&nbsp;are&nbsp;accounted&nbsp;in&nbsp;prev&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851189">//&nbsp;After&nbsp;GC&nbsp;prev&nbsp;stats&nbsp;are&nbsp;added&nbsp;to&nbsp;final&nbsp;stats&nbsp;and</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851242">//&nbsp;recent&nbsp;stats&nbsp;are&nbsp;moved&nbsp;into&nbsp;prev&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851286">allocs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1851298">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851307">frees</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1851319">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851328">alloc_bytes</span>&nbsp;<span class="builtintype" id="1851340">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851349">free_bytes</span>&nbsp;&nbsp;<span class="builtintype" id="1851361">uintptr</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851371">//&nbsp;changes&nbsp;between&nbsp;next-to-last&nbsp;GC&nbsp;and&nbsp;last&nbsp;GC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851419">prev_allocs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1851436">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851445">prev_frees</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1851462">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851471">prev_alloc_bytes</span>&nbsp;<span class="builtintype" id="1851488">uintptr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851497">prev_free_bytes</span>&nbsp;&nbsp;<span class="builtintype" id="1851514">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1851524">//&nbsp;changes&nbsp;since&nbsp;last&nbsp;GC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851550">recent_allocs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1851569">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851578">recent_frees</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1851597">uintptr</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851606">recent_alloc_bytes</span>&nbsp;<span class="builtintype" id="1851625">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851634">recent_free_bytes</span>&nbsp;&nbsp;<span class="builtintype" id="1851653">uintptr</span><br>
<span class="lineno"></span><span class="op" id="1851661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1851664">//&nbsp;A&nbsp;blockRecord&nbsp;is&nbsp;the&nbsp;bucket&nbsp;data&nbsp;for&nbsp;a&nbsp;bucket&nbsp;of&nbsp;type&nbsp;blockProfile,</span><br>
<span class="lineno">85</span><span class="comment" id="1851735">//&nbsp;part&nbsp;of&nbsp;the&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="1851768">type</span>&nbsp;<span class="ident" id="1851773">blockRecord</span>&nbsp;<span class="keyword" id="1851785">struct</span>&nbsp;<span class="op" id="1851792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851795">count</span>&nbsp;&nbsp;<span class="ident" id="1851802">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851809">cycles</span>&nbsp;<span class="ident" id="1851816">int64</span><br>
<span class="lineno"></span><span class="op" id="1851822">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="1851825">var</span>&nbsp;<span class="op" id="1851829">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851832">mbuckets</span>&nbsp;&nbsp;<span class="op" id="1851842">*</span><span class="ident" id="1851843"><a href="/runtime/mprof.go.html#1850425">bucket</a></span>&nbsp;<span class="comment" id="1851850">//&nbsp;memory&nbsp;profile&nbsp;buckets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851877">bbuckets</span>&nbsp;&nbsp;<span class="op" id="1851887">*</span><span class="ident" id="1851888"><a href="/runtime/mprof.go.html#1850425">bucket</a></span>&nbsp;<span class="comment" id="1851895">//&nbsp;blocking&nbsp;profile&nbsp;buckets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851924">buckhash</span>&nbsp;&nbsp;<span class="op" id="1851934">*</span><span class="op" id="1851935">[</span><span class="num" id="1851936">179999</span><span class="op" id="1851942">]</span><span class="op" id="1851943">*</span><span class="ident" id="1851944"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851952">bucketmem</span>&nbsp;<span class="builtintype" id="1851962">uintptr</span><br>
<span class="lineno"></span><span class="op" id="1851970">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1851973">//&nbsp;newBucket&nbsp;allocates&nbsp;a&nbsp;bucket&nbsp;with&nbsp;the&nbsp;given&nbsp;type&nbsp;and&nbsp;number&nbsp;of&nbsp;stack&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="1852054">func</span>&nbsp;<span class="ident" id="1852059">newBucket</span><span class="op" id="1852068">(</span><span class="ident" id="1852069">typ</span>&nbsp;<span class="ident" id="1852073"><a href="/runtime/mprof.go.html#1850022">bucketType</a></span><span class="op" id="1852083">,</span>&nbsp;<span class="ident" id="1852085">nstk</span>&nbsp;<span class="builtintype" id="1852090">int</span><span class="op" id="1852093">)</span>&nbsp;<span class="op" id="1852095">*</span><span class="ident" id="1852096"><a href="/runtime/mprof.go.html#1850425">bucket</a></span>&nbsp;<span class="op" id="1852103">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852106">size</span>&nbsp;<span class="op" id="1852111">:=</span>&nbsp;<span class="ident" id="1852114"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1852120">.</span><span class="ident" id="1852121">Sizeof</span><span class="op" id="1852127">(</span><span class="ident" id="1852128"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><span class="op" id="1852134">{</span><span class="op" id="1852135">}</span><span class="op" id="1852136">)</span>&nbsp;<span class="op" id="1852138">+</span>&nbsp;<span class="builtintype" id="1852140">uintptr</span><span class="op" id="1852147">(</span><span class="ident" id="1852148"><a href="/runtime/mprof.go.html#1852085">nstk</a></span><span class="op" id="1852152">)</span><span class="op" id="1852153">*</span><span class="ident" id="1852154"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1852160">.</span><span class="ident" id="1852161">Sizeof</span><span class="op" id="1852167">(</span><span class="builtintype" id="1852168">uintptr</span><span class="op" id="1852175">(</span><span class="num" id="1852176">0</span><span class="op" id="1852177">)</span><span class="op" id="1852178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852181">switch</span>&nbsp;<span class="ident" id="1852188"><a href="/runtime/mprof.go.html#1852069">typ</a></span>&nbsp;<span class="op" id="1852192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852195">default</span><span class="op" id="1852202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852206"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1852213">(</span><span class="string" id="1852214">&#34;invalid&nbsp;profile&nbsp;bucket&nbsp;type&#34;</span><span class="op" id="1852243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852246">case</span>&nbsp;<span class="ident" id="1852251"><a href="/runtime/mprof.go.html#1849854">memProfile</a></span><span class="op" id="1852261">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852265"><a href="/runtime/mprof.go.html#1852106">size</a></span>&nbsp;<span class="op" id="1852270">+=</span>&nbsp;<span class="ident" id="1852273"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1852279">.</span><span class="ident" id="1852280">Sizeof</span><span class="op" id="1852286">(</span><span class="ident" id="1852287"><a href="/runtime/mprof.go.html#1850680">memRecord</a></span><span class="op" id="1852296">{</span><span class="op" id="1852297">}</span><span class="op" id="1852298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852301">case</span>&nbsp;<span class="ident" id="1852306"><a href="/runtime/mprof.go.html#1849888">blockProfile</a></span><span class="op" id="1852318">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852322"><a href="/runtime/mprof.go.html#1852106">size</a></span>&nbsp;<span class="op" id="1852327">+=</span>&nbsp;<span class="ident" id="1852330"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1852336">.</span><span class="ident" id="1852337">Sizeof</span><span class="op" id="1852343">(</span><span class="ident" id="1852344"><a href="/runtime/mprof.go.html#1851773">blockRecord</a></span><span class="op" id="1852355">{</span><span class="op" id="1852356">}</span><span class="op" id="1852357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1852360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852364">b</span>&nbsp;<span class="op" id="1852366">:=</span>&nbsp;<span class="op" id="1852369">(</span><span class="op" id="1852370">*</span><span class="ident" id="1852371"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><span class="op" id="1852377">)</span><span class="op" id="1852378">(</span><span class="ident" id="1852379"><a href="/runtime/malloc.go.html#1842049">persistentalloc</a></span><span class="op" id="1852394">(</span><span class="ident" id="1852395"><a href="/runtime/mprof.go.html#1852106">size</a></span><span class="op" id="1852399">,</span>&nbsp;<span class="num" id="1852401">0</span><span class="op" id="1852402">,</span>&nbsp;<span class="op" id="1852404">&amp;</span><span class="ident" id="1852405"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1852413">.</span><span class="ident" id="1852414">buckhash_sys</span><span class="op" id="1852426">)</span><span class="op" id="1852427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852430"><a href="/runtime/mprof.go.html#1851952">bucketmem</a></span>&nbsp;<span class="op" id="1852440">+=</span>&nbsp;<span class="ident" id="1852443"><a href="/runtime/mprof.go.html#1852106">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852449"><a href="/runtime/mprof.go.html#1852364">b</a></span><span class="op" id="1852450">.</span><span class="ident" id="1852451">typ</span>&nbsp;<span class="op" id="1852455">=</span>&nbsp;<span class="ident" id="1852457"><a href="/runtime/mprof.go.html#1852069">typ</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852462"><a href="/runtime/mprof.go.html#1852364">b</a></span><span class="op" id="1852463">.</span><span class="ident" id="1852464">nstk</span>&nbsp;<span class="op" id="1852469">=</span>&nbsp;<span class="builtintype" id="1852471">uintptr</span><span class="op" id="1852478">(</span><span class="ident" id="1852479"><a href="/runtime/mprof.go.html#1852085">nstk</a></span><span class="op" id="1852483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852486">return</span>&nbsp;<span class="ident" id="1852493"><a href="/runtime/mprof.go.html#1852364">b</a></span><br>
<span class="lineno">115</span><span class="op" id="1852495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1852498">//&nbsp;stk&nbsp;returns&nbsp;the&nbsp;slice&nbsp;in&nbsp;b&nbsp;holding&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="1852547">func</span>&nbsp;<span class="op" id="1852552">(</span><span class="ident" id="1852553">b</span>&nbsp;<span class="op" id="1852555">*</span><span class="ident" id="1852556"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><span class="op" id="1852562">)</span>&nbsp;<span class="ident" id="1852564">stk</span><span class="op" id="1852567">(</span><span class="op" id="1852568">)</span>&nbsp;<span class="op" id="1852570">[</span><span class="op" id="1852571">]</span><span class="builtintype" id="1852572">uintptr</span>&nbsp;<span class="op" id="1852580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852583">stk</span>&nbsp;<span class="op" id="1852587">:=</span>&nbsp;<span class="op" id="1852590">(</span><span class="op" id="1852591">*</span><span class="op" id="1852592">[</span><span class="ident" id="1852593"><a href="/runtime/mprof.go.html#1850000">maxStack</a></span><span class="op" id="1852601">]</span><span class="builtintype" id="1852602">uintptr</span><span class="op" id="1852609">)</span><span class="op" id="1852610">(</span><span class="ident" id="1852611"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1852614">(</span><span class="ident" id="1852615"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1852621">.</span><span class="ident" id="1852622">Pointer</span><span class="op" id="1852629">(</span><span class="ident" id="1852630"><a href="/runtime/mprof.go.html#1852553">b</a></span><span class="op" id="1852631">)</span><span class="op" id="1852632">,</span>&nbsp;<span class="ident" id="1852634"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1852640">.</span><span class="ident" id="1852641">Sizeof</span><span class="op" id="1852647">(</span><span class="op" id="1852648">*</span><span class="ident" id="1852649"><a href="/runtime/mprof.go.html#1852553">b</a></span><span class="op" id="1852650">)</span><span class="op" id="1852651">)</span><span class="op" id="1852652">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852655">return</span>&nbsp;<span class="ident" id="1852662"><a href="/runtime/mprof.go.html#1852583">stk</a></span><span class="op" id="1852665">[</span><span class="op" id="1852666">:</span><span class="ident" id="1852667"><a href="/runtime/mprof.go.html#1852553">b</a></span><span class="op" id="1852668">.</span><span class="ident" id="1852669">nstk</span><span class="op" id="1852673">:</span><span class="ident" id="1852674"><a href="/runtime/mprof.go.html#1852553">b</a></span><span class="op" id="1852675">.</span><span class="ident" id="1852676">nstk</span><span class="op" id="1852680">]</span><br>
<span class="lineno"></span><span class="op" id="1852682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1852685">//&nbsp;mp&nbsp;returns&nbsp;the&nbsp;memRecord&nbsp;associated&nbsp;with&nbsp;the&nbsp;memProfile&nbsp;bucket&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="1852754">func</span>&nbsp;<span class="op" id="1852759">(</span><span class="ident" id="1852760">b</span>&nbsp;<span class="op" id="1852762">*</span><span class="ident" id="1852763"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><span class="op" id="1852769">)</span>&nbsp;<span class="ident" id="1852771">mp</span><span class="op" id="1852773">(</span><span class="op" id="1852774">)</span>&nbsp;<span class="op" id="1852776">*</span><span class="ident" id="1852777"><a href="/runtime/mprof.go.html#1850680">memRecord</a></span>&nbsp;<span class="op" id="1852787">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852790">if</span>&nbsp;<span class="ident" id="1852793"><a href="/runtime/mprof.go.html#1852760">b</a></span><span class="op" id="1852794">.</span><span class="ident" id="1852795">typ</span>&nbsp;<span class="op" id="1852799">!=</span>&nbsp;<span class="ident" id="1852802"><a href="/runtime/mprof.go.html#1849854">memProfile</a></span>&nbsp;<span class="op" id="1852813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852817"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1852824">(</span><span class="string" id="1852825">&#34;bad&nbsp;use&nbsp;of&nbsp;bucket.mp&#34;</span><span class="op" id="1852847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1852850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1852853">data</span>&nbsp;<span class="op" id="1852858">:=</span>&nbsp;<span class="ident" id="1852861"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1852864">(</span><span class="ident" id="1852865"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1852871">.</span><span class="ident" id="1852872">Pointer</span><span class="op" id="1852879">(</span><span class="ident" id="1852880"><a href="/runtime/mprof.go.html#1852760">b</a></span><span class="op" id="1852881">)</span><span class="op" id="1852882">,</span>&nbsp;<span class="ident" id="1852884"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1852890">.</span><span class="ident" id="1852891">Sizeof</span><span class="op" id="1852897">(</span><span class="op" id="1852898">*</span><span class="ident" id="1852899"><a href="/runtime/mprof.go.html#1852760">b</a></span><span class="op" id="1852900">)</span><span class="op" id="1852901">+</span><span class="ident" id="1852902"><a href="/runtime/mprof.go.html#1852760">b</a></span><span class="op" id="1852903">.</span><span class="ident" id="1852904">nstk</span><span class="op" id="1852908">*</span><span class="ident" id="1852909"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1852915">.</span><span class="ident" id="1852916">Sizeof</span><span class="op" id="1852922">(</span><span class="builtintype" id="1852923">uintptr</span><span class="op" id="1852930">(</span><span class="num" id="1852931">0</span><span class="op" id="1852932">)</span><span class="op" id="1852933">)</span><span class="op" id="1852934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1852937">return</span>&nbsp;<span class="op" id="1852944">(</span><span class="op" id="1852945">*</span><span class="ident" id="1852946"><a href="/runtime/mprof.go.html#1850680">memRecord</a></span><span class="op" id="1852955">)</span><span class="op" id="1852956">(</span><span class="ident" id="1852957"><a href="/runtime/mprof.go.html#1852853">data</a></span><span class="op" id="1852961">)</span><br>
<span class="lineno">130</span><span class="op" id="1852963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1852966">//&nbsp;bp&nbsp;returns&nbsp;the&nbsp;blockRecord&nbsp;associated&nbsp;with&nbsp;the&nbsp;blockProfile&nbsp;bucket&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="1853039">func</span>&nbsp;<span class="op" id="1853044">(</span><span class="ident" id="1853045">b</span>&nbsp;<span class="op" id="1853047">*</span><span class="ident" id="1853048"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><span class="op" id="1853054">)</span>&nbsp;<span class="ident" id="1853056">bp</span><span class="op" id="1853058">(</span><span class="op" id="1853059">)</span>&nbsp;<span class="op" id="1853061">*</span><span class="ident" id="1853062"><a href="/runtime/mprof.go.html#1851773">blockRecord</a></span>&nbsp;<span class="op" id="1853074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853077">if</span>&nbsp;<span class="ident" id="1853080"><a href="/runtime/mprof.go.html#1853045">b</a></span><span class="op" id="1853081">.</span><span class="ident" id="1853082">typ</span>&nbsp;<span class="op" id="1853086">!=</span>&nbsp;<span class="ident" id="1853089"><a href="/runtime/mprof.go.html#1849888">blockProfile</a></span>&nbsp;<span class="op" id="1853102">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853106"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1853113">(</span><span class="string" id="1853114">&#34;bad&nbsp;use&nbsp;of&nbsp;bucket.bp&#34;</span><span class="op" id="1853136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853142">data</span>&nbsp;<span class="op" id="1853147">:=</span>&nbsp;<span class="ident" id="1853150"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1853153">(</span><span class="ident" id="1853154"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1853160">.</span><span class="ident" id="1853161">Pointer</span><span class="op" id="1853168">(</span><span class="ident" id="1853169"><a href="/runtime/mprof.go.html#1853045">b</a></span><span class="op" id="1853170">)</span><span class="op" id="1853171">,</span>&nbsp;<span class="ident" id="1853173"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1853179">.</span><span class="ident" id="1853180">Sizeof</span><span class="op" id="1853186">(</span><span class="op" id="1853187">*</span><span class="ident" id="1853188"><a href="/runtime/mprof.go.html#1853045">b</a></span><span class="op" id="1853189">)</span><span class="op" id="1853190">+</span><span class="ident" id="1853191"><a href="/runtime/mprof.go.html#1853045">b</a></span><span class="op" id="1853192">.</span><span class="ident" id="1853193">nstk</span><span class="op" id="1853197">*</span><span class="ident" id="1853198"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1853204">.</span><span class="ident" id="1853205">Sizeof</span><span class="op" id="1853211">(</span><span class="builtintype" id="1853212">uintptr</span><span class="op" id="1853219">(</span><span class="num" id="1853220">0</span><span class="op" id="1853221">)</span><span class="op" id="1853222">)</span><span class="op" id="1853223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853226">return</span>&nbsp;<span class="op" id="1853233">(</span><span class="op" id="1853234">*</span><span class="ident" id="1853235"><a href="/runtime/mprof.go.html#1851773">blockRecord</a></span><span class="op" id="1853246">)</span><span class="op" id="1853247">(</span><span class="ident" id="1853248"><a href="/runtime/mprof.go.html#1853142">data</a></span><span class="op" id="1853252">)</span><br>
<span class="lineno"></span><span class="op" id="1853254">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="1853257">//&nbsp;Return&nbsp;the&nbsp;bucket&nbsp;for&nbsp;stk[0:nstk],&nbsp;allocating&nbsp;new&nbsp;bucket&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="1853328">func</span>&nbsp;<span class="ident" id="1853333">stkbucket</span><span class="op" id="1853342">(</span><span class="ident" id="1853343">typ</span>&nbsp;<span class="ident" id="1853347"><a href="/runtime/mprof.go.html#1850022">bucketType</a></span><span class="op" id="1853357">,</span>&nbsp;<span class="ident" id="1853359">size</span>&nbsp;<span class="builtintype" id="1853364">uintptr</span><span class="op" id="1853371">,</span>&nbsp;<span class="ident" id="1853373">stk</span>&nbsp;<span class="op" id="1853377">[</span><span class="op" id="1853378">]</span><span class="builtintype" id="1853379">uintptr</span><span class="op" id="1853386">,</span>&nbsp;<span class="ident" id="1853388">alloc</span>&nbsp;<span class="builtintype" id="1853394">bool</span><span class="op" id="1853398">)</span>&nbsp;<span class="op" id="1853400">*</span><span class="ident" id="1853401"><a href="/runtime/mprof.go.html#1850425">bucket</a></span>&nbsp;<span class="op" id="1853408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853411">if</span>&nbsp;<span class="ident" id="1853414"><a href="/runtime/mprof.go.html#1851924">buckhash</a></span>&nbsp;<span class="op" id="1853423">==</span>&nbsp;<span class="ident" id="1853426">nil</span>&nbsp;<span class="op" id="1853430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853434"><a href="/runtime/mprof.go.html#1851924">buckhash</a></span>&nbsp;<span class="op" id="1853443">=</span>&nbsp;<span class="op" id="1853445">(</span><span class="op" id="1853446">*</span><span class="op" id="1853447">[</span><span class="ident" id="1853448"><a href="/runtime/mprof.go.html#1849933">buckHashSize</a></span><span class="op" id="1853460">]</span><span class="op" id="1853461">*</span><span class="ident" id="1853462"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><span class="op" id="1853468">)</span><span class="op" id="1853469">(</span><span class="ident" id="1853470"><a href="/runtime/mprof.go.html#1854275">sysAlloc</a></span><span class="op" id="1853478">(</span><span class="ident" id="1853479"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1853485">.</span><span class="ident" id="1853486">Sizeof</span><span class="op" id="1853492">(</span><span class="op" id="1853493">*</span><span class="ident" id="1853494"><a href="/runtime/mprof.go.html#1851924">buckhash</a></span><span class="op" id="1853502">)</span><span class="op" id="1853503">,</span>&nbsp;<span class="op" id="1853505">&amp;</span><span class="ident" id="1853506"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1853514">.</span><span class="ident" id="1853515">buckhash_sys</span><span class="op" id="1853527">)</span><span class="op" id="1853528">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853532">if</span>&nbsp;<span class="ident" id="1853535"><a href="/runtime/mprof.go.html#1851924">buckhash</a></span>&nbsp;<span class="op" id="1853544">==</span>&nbsp;<span class="ident" id="1853547">nil</span>&nbsp;<span class="op" id="1853551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853556"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1853563">(</span><span class="string" id="1853564">&#34;runtime:&nbsp;cannot&nbsp;allocate&nbsp;memory&#34;</span><span class="op" id="1853597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1853608">//&nbsp;Hash&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853624">var</span>&nbsp;<span class="ident" id="1853628">h</span>&nbsp;<span class="builtintype" id="1853630">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853639">for</span>&nbsp;<span class="ident" id="1853643">_</span><span class="op" id="1853644">,</span>&nbsp;<span class="ident" id="1853646">pc</span>&nbsp;<span class="op" id="1853649">:=</span>&nbsp;<span class="keyword" id="1853652">range</span>&nbsp;<span class="ident" id="1853658"><a href="/runtime/mprof.go.html#1853373">stk</a></span>&nbsp;<span class="op" id="1853662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853666"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853668">+=</span>&nbsp;<span class="ident" id="1853671"><a href="/runtime/mprof.go.html#1853646">pc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853676"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853678">+=</span>&nbsp;<span class="ident" id="1853681"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853683">&lt;&lt;</span>&nbsp;<span class="num" id="1853686">10</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853691"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853693">^=</span>&nbsp;<span class="ident" id="1853696"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853698">&gt;&gt;</span>&nbsp;<span class="num" id="1853701">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1853707">//&nbsp;hash&nbsp;in&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853724"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853726">+=</span>&nbsp;<span class="ident" id="1853729"><a href="/runtime/mprof.go.html#1853359">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853735"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853737">+=</span>&nbsp;<span class="ident" id="1853740"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853742">&lt;&lt;</span>&nbsp;<span class="num" id="1853745">10</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853749"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853751">^=</span>&nbsp;<span class="ident" id="1853754"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853756">&gt;&gt;</span>&nbsp;<span class="num" id="1853759">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1853762">//&nbsp;finalize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853775"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853777">+=</span>&nbsp;<span class="ident" id="1853780"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853782">&lt;&lt;</span>&nbsp;<span class="num" id="1853785">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853788"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853790">^=</span>&nbsp;<span class="ident" id="1853793"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853795">&gt;&gt;</span>&nbsp;<span class="num" id="1853798">11</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1853803">i</span>&nbsp;<span class="op" id="1853805">:=</span>&nbsp;<span class="builtintype" id="1853808">int</span><span class="op" id="1853811">(</span><span class="ident" id="1853812"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853814">%</span>&nbsp;<span class="ident" id="1853816"><a href="/runtime/mprof.go.html#1849933">buckHashSize</a></span><span class="op" id="1853828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853831">for</span>&nbsp;<span class="ident" id="1853835">b</span>&nbsp;<span class="op" id="1853837">:=</span>&nbsp;<span class="ident" id="1853840"><a href="/runtime/mprof.go.html#1851924">buckhash</a></span><span class="op" id="1853848">[</span><span class="ident" id="1853849"><a href="/runtime/mprof.go.html#1853803">i</a></span><span class="op" id="1853850">]</span><span class="op" id="1853851">;</span>&nbsp;<span class="ident" id="1853853"><a href="/runtime/mprof.go.html#1853835">b</a></span>&nbsp;<span class="op" id="1853855">!=</span>&nbsp;<span class="ident" id="1853858">nil</span><span class="op" id="1853861">;</span>&nbsp;<span class="ident" id="1853863"><a href="/runtime/mprof.go.html#1853835">b</a></span>&nbsp;<span class="op" id="1853865">=</span>&nbsp;<span class="ident" id="1853867"><a href="/runtime/mprof.go.html#1853835">b</a></span><span class="op" id="1853868">.</span><span class="ident" id="1853869">next</span>&nbsp;<span class="op" id="1853874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853878">if</span>&nbsp;<span class="ident" id="1853881"><a href="/runtime/mprof.go.html#1853835">b</a></span><span class="op" id="1853882">.</span><span class="ident" id="1853883">typ</span>&nbsp;<span class="op" id="1853887">==</span>&nbsp;<span class="ident" id="1853890"><a href="/runtime/mprof.go.html#1853343">typ</a></span>&nbsp;<span class="op" id="1853894">&amp;&amp;</span>&nbsp;<span class="ident" id="1853897"><a href="/runtime/mprof.go.html#1853835">b</a></span><span class="op" id="1853898">.</span><span class="ident" id="1853899">hash</span>&nbsp;<span class="op" id="1853904">==</span>&nbsp;<span class="ident" id="1853907"><a href="/runtime/mprof.go.html#1853628">h</a></span>&nbsp;<span class="op" id="1853909">&amp;&amp;</span>&nbsp;<span class="ident" id="1853912"><a href="/runtime/mprof.go.html#1853835">b</a></span><span class="op" id="1853913">.</span><span class="ident" id="1853914">size</span>&nbsp;<span class="op" id="1853919">==</span>&nbsp;<span class="ident" id="1853922"><a href="/runtime/mprof.go.html#1853359">size</a></span>&nbsp;<span class="op" id="1853927">&amp;&amp;</span>&nbsp;<span class="ident" id="1853930"><a href="/runtime/mprof.go.html#1854330">eqslice</a></span><span class="op" id="1853937">(</span><span class="ident" id="1853938"><a href="/runtime/mprof.go.html#1853835">b</a></span><span class="op" id="1853939">.</span><span class="ident" id="1853940">stk</span><span class="op" id="1853943">(</span><span class="op" id="1853944">)</span><span class="op" id="1853945">,</span>&nbsp;<span class="ident" id="1853947"><a href="/runtime/mprof.go.html#1853373">stk</a></span><span class="op" id="1853950">)</span>&nbsp;<span class="op" id="1853952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853957">return</span>&nbsp;<span class="ident" id="1853964"><a href="/runtime/mprof.go.html#1853835">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853968">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1853971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853975">if</span>&nbsp;<span class="op" id="1853978">!</span><span class="ident" id="1853979"><a href="/runtime/mprof.go.html#1853388">alloc</a></span>&nbsp;<span class="op" id="1853985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1853989">return</span>&nbsp;<span class="ident" id="1853996">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854001">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1854005">//&nbsp;Create&nbsp;new&nbsp;bucket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854028">b</span>&nbsp;<span class="op" id="1854030">:=</span>&nbsp;<span class="ident" id="1854033"><a href="/runtime/mprof.go.html#1852059">newBucket</a></span><span class="op" id="1854042">(</span><span class="ident" id="1854043"><a href="/runtime/mprof.go.html#1853343">typ</a></span><span class="op" id="1854046">,</span>&nbsp;<span class="builtinfunc" id="1854048">len</span><span class="op" id="1854051">(</span><span class="ident" id="1854052"><a href="/runtime/mprof.go.html#1853373">stk</a></span><span class="op" id="1854055">)</span><span class="op" id="1854056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1854059">copy</span><span class="op" id="1854063">(</span><span class="ident" id="1854064"><a href="/runtime/mprof.go.html#1854028">b</a></span><span class="op" id="1854065">.</span><span class="ident" id="1854066">stk</span><span class="op" id="1854069">(</span><span class="op" id="1854070">)</span><span class="op" id="1854071">,</span>&nbsp;<span class="ident" id="1854073"><a href="/runtime/mprof.go.html#1853373">stk</a></span><span class="op" id="1854076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854079"><a href="/runtime/mprof.go.html#1854028">b</a></span><span class="op" id="1854080">.</span><span class="ident" id="1854081">hash</span>&nbsp;<span class="op" id="1854086">=</span>&nbsp;<span class="ident" id="1854088"><a href="/runtime/mprof.go.html#1853628">h</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854091"><a href="/runtime/mprof.go.html#1854028">b</a></span><span class="op" id="1854092">.</span><span class="ident" id="1854093">size</span>&nbsp;<span class="op" id="1854098">=</span>&nbsp;<span class="ident" id="1854100"><a href="/runtime/mprof.go.html#1853359">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854106"><a href="/runtime/mprof.go.html#1854028">b</a></span><span class="op" id="1854107">.</span><span class="ident" id="1854108">next</span>&nbsp;<span class="op" id="1854113">=</span>&nbsp;<span class="ident" id="1854115"><a href="/runtime/mprof.go.html#1851924">buckhash</a></span><span class="op" id="1854123">[</span><span class="ident" id="1854124"><a href="/runtime/mprof.go.html#1853803">i</a></span><span class="op" id="1854125">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854128"><a href="/runtime/mprof.go.html#1851924">buckhash</a></span><span class="op" id="1854136">[</span><span class="ident" id="1854137"><a href="/runtime/mprof.go.html#1853803">i</a></span><span class="op" id="1854138">]</span>&nbsp;<span class="op" id="1854140">=</span>&nbsp;<span class="ident" id="1854142"><a href="/runtime/mprof.go.html#1854028">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854145">if</span>&nbsp;<span class="ident" id="1854148"><a href="/runtime/mprof.go.html#1853343">typ</a></span>&nbsp;<span class="op" id="1854152">==</span>&nbsp;<span class="ident" id="1854155"><a href="/runtime/mprof.go.html#1849854">memProfile</a></span>&nbsp;<span class="op" id="1854166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854170"><a href="/runtime/mprof.go.html#1854028">b</a></span><span class="op" id="1854171">.</span><span class="ident" id="1854172">allnext</span>&nbsp;<span class="op" id="1854180">=</span>&nbsp;<span class="ident" id="1854182"><a href="/runtime/mprof.go.html#1851832">mbuckets</a></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854193"><a href="/runtime/mprof.go.html#1851832">mbuckets</a></span>&nbsp;<span class="op" id="1854202">=</span>&nbsp;<span class="ident" id="1854204"><a href="/runtime/mprof.go.html#1854028">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854207">}</span>&nbsp;<span class="keyword" id="1854209">else</span>&nbsp;<span class="op" id="1854214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854218"><a href="/runtime/mprof.go.html#1854028">b</a></span><span class="op" id="1854219">.</span><span class="ident" id="1854220">allnext</span>&nbsp;<span class="op" id="1854228">=</span>&nbsp;<span class="ident" id="1854230"><a href="/runtime/mprof.go.html#1851877">bbuckets</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854241"><a href="/runtime/mprof.go.html#1851877">bbuckets</a></span>&nbsp;<span class="op" id="1854250">=</span>&nbsp;<span class="ident" id="1854252"><a href="/runtime/mprof.go.html#1854028">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854255">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854258">return</span>&nbsp;<span class="ident" id="1854265"><a href="/runtime/mprof.go.html#1854028">b</a></span><br>
<span class="lineno"></span><span class="op" id="1854267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1854270">func</span>&nbsp;<span class="ident" id="1854275">sysAlloc</span><span class="op" id="1854283">(</span><span class="ident" id="1854284">n</span>&nbsp;<span class="builtintype" id="1854286">uintptr</span><span class="op" id="1854293">,</span>&nbsp;<span class="ident" id="1854295">stat</span>&nbsp;<span class="op" id="1854300">*</span><span class="ident" id="1854301">uint64</span><span class="op" id="1854307">)</span>&nbsp;<span class="ident" id="1854309"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1854315">.</span><span class="ident" id="1854316">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="keyword" id="1854325">func</span>&nbsp;<span class="ident" id="1854330">eqslice</span><span class="op" id="1854337">(</span><span class="ident" id="1854338">x</span><span class="op" id="1854339">,</span>&nbsp;<span class="ident" id="1854341">y</span>&nbsp;<span class="op" id="1854343">[</span><span class="op" id="1854344">]</span><span class="builtintype" id="1854345">uintptr</span><span class="op" id="1854352">)</span>&nbsp;<span class="builtintype" id="1854354">bool</span>&nbsp;<span class="op" id="1854359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854362">if</span>&nbsp;<span class="builtinfunc" id="1854365">len</span><span class="op" id="1854368">(</span><span class="ident" id="1854369"><a href="/runtime/mprof.go.html#1854338">x</a></span><span class="op" id="1854370">)</span>&nbsp;<span class="op" id="1854372">!=</span>&nbsp;<span class="builtinfunc" id="1854375">len</span><span class="op" id="1854378">(</span><span class="ident" id="1854379"><a href="/runtime/mprof.go.html#1854341">y</a></span><span class="op" id="1854380">)</span>&nbsp;<span class="op" id="1854382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854386">return</span>&nbsp;<span class="ident" id="1854393">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854403">for</span>&nbsp;<span class="ident" id="1854407">i</span><span class="op" id="1854408">,</span>&nbsp;<span class="ident" id="1854410">xi</span>&nbsp;<span class="op" id="1854413">:=</span>&nbsp;<span class="keyword" id="1854416">range</span>&nbsp;<span class="ident" id="1854422"><a href="/runtime/mprof.go.html#1854338">x</a></span>&nbsp;<span class="op" id="1854424">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854428">if</span>&nbsp;<span class="ident" id="1854431"><a href="/runtime/mprof.go.html#1854410">xi</a></span>&nbsp;<span class="op" id="1854434">!=</span>&nbsp;<span class="ident" id="1854437"><a href="/runtime/mprof.go.html#1854341">y</a></span><span class="op" id="1854438">[</span><span class="ident" id="1854439"><a href="/runtime/mprof.go.html#1854407">i</a></span><span class="op" id="1854440">]</span>&nbsp;<span class="op" id="1854442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854447">return</span>&nbsp;<span class="ident" id="1854454">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854468">return</span>&nbsp;<span class="ident" id="1854475">true</span><br>
<span class="lineno">205</span><span class="op" id="1854480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1854483">func</span>&nbsp;<span class="ident" id="1854488">mprof_GC</span><span class="op" id="1854496">(</span><span class="op" id="1854497">)</span>&nbsp;<span class="op" id="1854499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1854502">for</span>&nbsp;<span class="ident" id="1854506">b</span>&nbsp;<span class="op" id="1854508">:=</span>&nbsp;<span class="ident" id="1854511"><a href="/runtime/mprof.go.html#1851832">mbuckets</a></span><span class="op" id="1854519">;</span>&nbsp;<span class="ident" id="1854521"><a href="/runtime/mprof.go.html#1854506">b</a></span>&nbsp;<span class="op" id="1854523">!=</span>&nbsp;<span class="ident" id="1854526">nil</span><span class="op" id="1854529">;</span>&nbsp;<span class="ident" id="1854531"><a href="/runtime/mprof.go.html#1854506">b</a></span>&nbsp;<span class="op" id="1854533">=</span>&nbsp;<span class="ident" id="1854535"><a href="/runtime/mprof.go.html#1854506">b</a></span><span class="op" id="1854536">.</span><span class="ident" id="1854537">allnext</span>&nbsp;<span class="op" id="1854545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854549">mp</span>&nbsp;<span class="op" id="1854552">:=</span>&nbsp;<span class="ident" id="1854555"><a href="/runtime/mprof.go.html#1854506">b</a></span><span class="op" id="1854556">.</span><span class="ident" id="1854557">mp</span><span class="op" id="1854559">(</span><span class="op" id="1854560">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854564"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854566">.</span><span class="ident" id="1854567">allocs</span>&nbsp;<span class="op" id="1854574">+=</span>&nbsp;<span class="ident" id="1854577"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854579">.</span><span class="ident" id="1854580">prev_allocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854594"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854596">.</span><span class="ident" id="1854597">frees</span>&nbsp;<span class="op" id="1854603">+=</span>&nbsp;<span class="ident" id="1854606"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854608">.</span><span class="ident" id="1854609">prev_frees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854622"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854624">.</span><span class="ident" id="1854625">alloc_bytes</span>&nbsp;<span class="op" id="1854637">+=</span>&nbsp;<span class="ident" id="1854640"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854642">.</span><span class="ident" id="1854643">prev_alloc_bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854662"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854664">.</span><span class="ident" id="1854665">free_bytes</span>&nbsp;<span class="op" id="1854676">+=</span>&nbsp;<span class="ident" id="1854679"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854681">.</span><span class="ident" id="1854682">prev_free_bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854701"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854703">.</span><span class="ident" id="1854704">prev_allocs</span>&nbsp;<span class="op" id="1854716">=</span>&nbsp;<span class="ident" id="1854718"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854720">.</span><span class="ident" id="1854721">recent_allocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854737"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854739">.</span><span class="ident" id="1854740">prev_frees</span>&nbsp;<span class="op" id="1854751">=</span>&nbsp;<span class="ident" id="1854753"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854755">.</span><span class="ident" id="1854756">recent_frees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854771"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854773">.</span><span class="ident" id="1854774">prev_alloc_bytes</span>&nbsp;<span class="op" id="1854791">=</span>&nbsp;<span class="ident" id="1854793"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854795">.</span><span class="ident" id="1854796">recent_alloc_bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854817"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854819">.</span><span class="ident" id="1854820">prev_free_bytes</span>&nbsp;<span class="op" id="1854836">=</span>&nbsp;<span class="ident" id="1854838"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854840">.</span><span class="ident" id="1854841">recent_free_bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854862"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854864">.</span><span class="ident" id="1854865">recent_allocs</span>&nbsp;<span class="op" id="1854879">=</span>&nbsp;<span class="num" id="1854881">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854885"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854887">.</span><span class="ident" id="1854888">recent_frees</span>&nbsp;<span class="op" id="1854901">=</span>&nbsp;<span class="num" id="1854903">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854907"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854909">.</span><span class="ident" id="1854910">recent_alloc_bytes</span>&nbsp;<span class="op" id="1854929">=</span>&nbsp;<span class="num" id="1854931">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1854935"><a href="/runtime/mprof.go.html#1854549">mp</a></span><span class="op" id="1854937">.</span><span class="ident" id="1854938">recent_free_bytes</span>&nbsp;<span class="op" id="1854956">=</span>&nbsp;<span class="num" id="1854958">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1854961">}</span><br>
<span class="lineno">225</span><span class="op" id="1854963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1854966">//&nbsp;Record&nbsp;that&nbsp;a&nbsp;gc&nbsp;just&nbsp;happened:&nbsp;all&nbsp;the&nbsp;&#39;recent&#39;&nbsp;statistics&nbsp;are&nbsp;now&nbsp;real.</span><br>
<span class="lineno"></span><span class="keyword" id="1855043">func</span>&nbsp;<span class="ident" id="1855048">mProf_GC</span><span class="op" id="1855056">(</span><span class="op" id="1855057">)</span>&nbsp;<span class="op" id="1855059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855062"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1855066">(</span><span class="op" id="1855067">&amp;</span><span class="ident" id="1855068"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1855076">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855079"><a href="/runtime/mprof.go.html#1854488">mprof_GC</a></span><span class="op" id="1855087">(</span><span class="op" id="1855088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855091"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1855097">(</span><span class="op" id="1855098">&amp;</span><span class="ident" id="1855099"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1855107">)</span><br>
<span class="lineno"></span><span class="op" id="1855109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1855112">//&nbsp;Called&nbsp;by&nbsp;malloc&nbsp;to&nbsp;record&nbsp;a&nbsp;profiled&nbsp;block.</span><br>
<span class="lineno">235</span><span class="keyword" id="1855160">func</span>&nbsp;<span class="ident" id="1855165">mProf_Malloc</span><span class="op" id="1855177">(</span><span class="ident" id="1855178">p</span>&nbsp;<span class="ident" id="1855180"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1855186">.</span><span class="ident" id="1855187">Pointer</span><span class="op" id="1855194">,</span>&nbsp;<span class="ident" id="1855196">size</span>&nbsp;<span class="builtintype" id="1855201">uintptr</span><span class="op" id="1855208">)</span>&nbsp;<span class="op" id="1855210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1855213">var</span>&nbsp;<span class="ident" id="1855217">stk</span>&nbsp;<span class="op" id="1855221">[</span><span class="ident" id="1855222"><a href="/runtime/mprof.go.html#1850000">maxStack</a></span><span class="op" id="1855230">]</span><span class="builtintype" id="1855231">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855240">nstk</span>&nbsp;<span class="op" id="1855245">:=</span>&nbsp;<span class="ident" id="1855248"><a href="/runtime/traceback.go.html#2010559">callers</a></span><span class="op" id="1855255">(</span><span class="num" id="1855256">4</span><span class="op" id="1855257">,</span>&nbsp;<span class="op" id="1855259">&amp;</span><span class="ident" id="1855260"><a href="/runtime/mprof.go.html#1855217">stk</a></span><span class="op" id="1855263">[</span><span class="num" id="1855264">0</span><span class="op" id="1855265">]</span><span class="op" id="1855266">,</span>&nbsp;<span class="builtinfunc" id="1855268">len</span><span class="op" id="1855271">(</span><span class="ident" id="1855272"><a href="/runtime/mprof.go.html#1855217">stk</a></span><span class="op" id="1855275">)</span><span class="op" id="1855276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855279"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1855283">(</span><span class="op" id="1855284">&amp;</span><span class="ident" id="1855285"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1855293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855296">b</span>&nbsp;<span class="op" id="1855298">:=</span>&nbsp;<span class="ident" id="1855301"><a href="/runtime/mprof.go.html#1853333">stkbucket</a></span><span class="op" id="1855310">(</span><span class="ident" id="1855311"><a href="/runtime/mprof.go.html#1849854">memProfile</a></span><span class="op" id="1855321">,</span>&nbsp;<span class="ident" id="1855323"><a href="/runtime/mprof.go.html#1855196">size</a></span><span class="op" id="1855327">,</span>&nbsp;<span class="ident" id="1855329"><a href="/runtime/mprof.go.html#1855217">stk</a></span><span class="op" id="1855332">[</span><span class="op" id="1855333">:</span><span class="ident" id="1855334"><a href="/runtime/mprof.go.html#1855240">nstk</a></span><span class="op" id="1855338">]</span><span class="op" id="1855339">,</span>&nbsp;<span class="ident" id="1855341">true</span><span class="op" id="1855345">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855348">mp</span>&nbsp;<span class="op" id="1855351">:=</span>&nbsp;<span class="ident" id="1855354"><a href="/runtime/mprof.go.html#1855296">b</a></span><span class="op" id="1855355">.</span><span class="ident" id="1855356">mp</span><span class="op" id="1855358">(</span><span class="op" id="1855359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855362"><a href="/runtime/mprof.go.html#1855348">mp</a></span><span class="op" id="1855364">.</span><span class="ident" id="1855365">recent_allocs</span><span class="op" id="1855378">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855382"><a href="/runtime/mprof.go.html#1855348">mp</a></span><span class="op" id="1855384">.</span><span class="ident" id="1855385">recent_alloc_bytes</span>&nbsp;<span class="op" id="1855404">+=</span>&nbsp;<span class="ident" id="1855407"><a href="/runtime/mprof.go.html#1855196">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855413"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1855419">(</span><span class="op" id="1855420">&amp;</span><span class="ident" id="1855421"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1855429">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1855433">//&nbsp;Setprofilebucket&nbsp;locks&nbsp;a&nbsp;bunch&nbsp;of&nbsp;other&nbsp;mutexes,&nbsp;so&nbsp;we&nbsp;call&nbsp;it&nbsp;outside&nbsp;of&nbsp;proflock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1855521">//&nbsp;This&nbsp;reduces&nbsp;potential&nbsp;contention&nbsp;and&nbsp;chances&nbsp;of&nbsp;deadlocks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1855585">//&nbsp;Since&nbsp;the&nbsp;object&nbsp;must&nbsp;be&nbsp;alive&nbsp;during&nbsp;call&nbsp;to&nbsp;mProf_Malloc,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1855649">//&nbsp;it&#39;s&nbsp;fine&nbsp;to&nbsp;do&nbsp;this&nbsp;non-atomically.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855690"><a href="/runtime/mprof.go.html#1855759">setprofilebucket</a></span><span class="op" id="1855706">(</span><span class="ident" id="1855707"><a href="/runtime/mprof.go.html#1855178">p</a></span><span class="op" id="1855708">,</span>&nbsp;<span class="ident" id="1855710"><a href="/runtime/mprof.go.html#1855296">b</a></span><span class="op" id="1855711">)</span><br>
<span class="lineno">250</span><span class="op" id="1855713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1855716">func</span>&nbsp;<span class="ident" id="1855721">setprofilebucket_m</span><span class="op" id="1855739">(</span><span class="op" id="1855740">)</span>&nbsp;<span class="comment" id="1855742">//&nbsp;mheap.c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1855754">func</span>&nbsp;<span class="ident" id="1855759">setprofilebucket</span><span class="op" id="1855775">(</span><span class="ident" id="1855776">p</span>&nbsp;<span class="ident" id="1855778"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1855784">.</span><span class="ident" id="1855785">Pointer</span><span class="op" id="1855792">,</span>&nbsp;<span class="ident" id="1855794">b</span>&nbsp;<span class="op" id="1855796">*</span><span class="ident" id="1855797"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><span class="op" id="1855803">)</span>&nbsp;<span class="op" id="1855805">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855808">g</span>&nbsp;<span class="op" id="1855810">:=</span>&nbsp;<span class="ident" id="1855813"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1855817">(</span><span class="op" id="1855818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855821"><a href="/runtime/mprof.go.html#1855808">g</a></span><span class="op" id="1855822">.</span><span class="ident" id="1855823">m</span><span class="op" id="1855824">.</span><span class="ident" id="1855825">ptrarg</span><span class="op" id="1855831">[</span><span class="num" id="1855832">0</span><span class="op" id="1855833">]</span>&nbsp;<span class="op" id="1855835">=</span>&nbsp;<span class="ident" id="1855837"><a href="/runtime/mprof.go.html#1855776">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855840"><a href="/runtime/mprof.go.html#1855808">g</a></span><span class="op" id="1855841">.</span><span class="ident" id="1855842">m</span><span class="op" id="1855843">.</span><span class="ident" id="1855844">ptrarg</span><span class="op" id="1855850">[</span><span class="num" id="1855851">1</span><span class="op" id="1855852">]</span>&nbsp;<span class="op" id="1855854">=</span>&nbsp;<span class="ident" id="1855856"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1855862">.</span><span class="ident" id="1855863">Pointer</span><span class="op" id="1855870">(</span><span class="ident" id="1855871"><a href="/runtime/mprof.go.html#1855794">b</a></span><span class="op" id="1855872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855875"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1855878">(</span><span class="ident" id="1855879"><a href="/runtime/mprof.go.html#1855721">setprofilebucket_m</a></span><span class="op" id="1855897">)</span><br>
<span class="lineno"></span><span class="op" id="1855899">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="1855902">//&nbsp;Called&nbsp;when&nbsp;freeing&nbsp;a&nbsp;profiled&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="1855943">func</span>&nbsp;<span class="ident" id="1855948">mProf_Free</span><span class="op" id="1855958">(</span><span class="ident" id="1855959">b</span>&nbsp;<span class="op" id="1855961">*</span><span class="ident" id="1855962"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><span class="op" id="1855968">,</span>&nbsp;<span class="ident" id="1855970">size</span>&nbsp;<span class="builtintype" id="1855975">uintptr</span><span class="op" id="1855982">,</span>&nbsp;<span class="ident" id="1855984">freed</span>&nbsp;<span class="builtintype" id="1855990">bool</span><span class="op" id="1855994">)</span>&nbsp;<span class="op" id="1855996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1855999"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1856003">(</span><span class="op" id="1856004">&amp;</span><span class="ident" id="1856005"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1856013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856016">mp</span>&nbsp;<span class="op" id="1856019">:=</span>&nbsp;<span class="ident" id="1856022"><a href="/runtime/mprof.go.html#1855959">b</a></span><span class="op" id="1856023">.</span><span class="ident" id="1856024">mp</span><span class="op" id="1856026">(</span><span class="op" id="1856027">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856030">if</span>&nbsp;<span class="ident" id="1856033"><a href="/runtime/mprof.go.html#1855984">freed</a></span>&nbsp;<span class="op" id="1856039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856043"><a href="/runtime/mprof.go.html#1856016">mp</a></span><span class="op" id="1856045">.</span><span class="ident" id="1856046">recent_frees</span><span class="op" id="1856058">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856063"><a href="/runtime/mprof.go.html#1856016">mp</a></span><span class="op" id="1856065">.</span><span class="ident" id="1856066">recent_free_bytes</span>&nbsp;<span class="op" id="1856084">+=</span>&nbsp;<span class="ident" id="1856087"><a href="/runtime/mprof.go.html#1855970">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856093">}</span>&nbsp;<span class="keyword" id="1856095">else</span>&nbsp;<span class="op" id="1856100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856104"><a href="/runtime/mprof.go.html#1856016">mp</a></span><span class="op" id="1856106">.</span><span class="ident" id="1856107">prev_frees</span><span class="op" id="1856117">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856122"><a href="/runtime/mprof.go.html#1856016">mp</a></span><span class="op" id="1856124">.</span><span class="ident" id="1856125">prev_free_bytes</span>&nbsp;<span class="op" id="1856141">+=</span>&nbsp;<span class="ident" id="1856144"><a href="/runtime/mprof.go.html#1855970">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856153"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1856159">(</span><span class="op" id="1856160">&amp;</span><span class="ident" id="1856161"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1856169">)</span><br>
<span class="lineno"></span><span class="op" id="1856171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="1856174">var</span>&nbsp;<span class="ident" id="1856178">blockprofilerate</span>&nbsp;<span class="ident" id="1856195">uint64</span>&nbsp;<span class="comment" id="1856202">//&nbsp;in&nbsp;CPU&nbsp;ticks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1856219">//&nbsp;SetBlockProfileRate&nbsp;controls&nbsp;the&nbsp;fraction&nbsp;of&nbsp;goroutine&nbsp;blocking&nbsp;events</span><br>
<span class="lineno"></span><span class="comment" id="1856293">//&nbsp;that&nbsp;are&nbsp;reported&nbsp;in&nbsp;the&nbsp;blocking&nbsp;profile.&nbsp;&nbsp;The&nbsp;profiler&nbsp;aims&nbsp;to&nbsp;sample</span><br>
<span class="lineno"></span><span class="comment" id="1856368">//&nbsp;an&nbsp;average&nbsp;of&nbsp;one&nbsp;blocking&nbsp;event&nbsp;per&nbsp;rate&nbsp;nanoseconds&nbsp;spent&nbsp;blocked.</span><br>
<span class="lineno">280</span><span class="comment" id="1856440">//</span><br>
<span class="lineno"></span><span class="comment" id="1856443">//&nbsp;To&nbsp;include&nbsp;every&nbsp;blocking&nbsp;event&nbsp;in&nbsp;the&nbsp;profile,&nbsp;pass&nbsp;rate&nbsp;=&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="1856509">//&nbsp;To&nbsp;turn&nbsp;off&nbsp;profiling&nbsp;entirely,&nbsp;pass&nbsp;rate&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="1856560">func</span>&nbsp;<span class="ident" id="1856565">SetBlockProfileRate</span><span class="op" id="1856584">(</span><span class="ident" id="1856585">rate</span>&nbsp;<span class="builtintype" id="1856590">int</span><span class="op" id="1856593">)</span>&nbsp;<span class="op" id="1856595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856598">var</span>&nbsp;<span class="ident" id="1856602">r</span>&nbsp;<span class="ident" id="1856604">int64</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856611">if</span>&nbsp;<span class="ident" id="1856614"><a href="/runtime/mprof.go.html#1856585">rate</a></span>&nbsp;<span class="op" id="1856619">&lt;=</span>&nbsp;<span class="num" id="1856622">0</span>&nbsp;<span class="op" id="1856624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856628"><a href="/runtime/mprof.go.html#1856602">r</a></span>&nbsp;<span class="op" id="1856630">=</span>&nbsp;<span class="num" id="1856632">0</span>&nbsp;<span class="comment" id="1856634">//&nbsp;disable&nbsp;profiling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856656">}</span>&nbsp;<span class="keyword" id="1856658">else</span>&nbsp;<span class="keyword" id="1856663">if</span>&nbsp;<span class="ident" id="1856666"><a href="/runtime/mprof.go.html#1856585">rate</a></span>&nbsp;<span class="op" id="1856671">==</span>&nbsp;<span class="num" id="1856674">1</span>&nbsp;<span class="op" id="1856676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856680"><a href="/runtime/mprof.go.html#1856602">r</a></span>&nbsp;<span class="op" id="1856682">=</span>&nbsp;<span class="num" id="1856684">1</span>&nbsp;<span class="comment" id="1856686">//&nbsp;profile&nbsp;everything</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856709">}</span>&nbsp;<span class="keyword" id="1856711">else</span>&nbsp;<span class="op" id="1856716">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1856720">//&nbsp;convert&nbsp;ns&nbsp;to&nbsp;cycles,&nbsp;use&nbsp;float64&nbsp;to&nbsp;prevent&nbsp;overflow&nbsp;during&nbsp;multiplication</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856801"><a href="/runtime/mprof.go.html#1856602">r</a></span>&nbsp;<span class="op" id="1856803">=</span>&nbsp;<span class="ident" id="1856805">int64</span><span class="op" id="1856810">(</span><span class="builtintype" id="1856811">float64</span><span class="op" id="1856818">(</span><span class="ident" id="1856819"><a href="/runtime/mprof.go.html#1856585">rate</a></span><span class="op" id="1856823">)</span>&nbsp;<span class="op" id="1856825">*</span>&nbsp;<span class="builtintype" id="1856827">float64</span><span class="op" id="1856834">(</span><span class="ident" id="1856835"><a href="/runtime/runtime.go.html#1915042">tickspersecond</a></span><span class="op" id="1856849">(</span><span class="op" id="1856850">)</span><span class="op" id="1856851">)</span>&nbsp;<span class="op" id="1856853">/</span>&nbsp;<span class="op" id="1856855">(</span><span class="num" id="1856856">1000</span>&nbsp;<span class="op" id="1856861">*</span>&nbsp;<span class="num" id="1856863">1000</span>&nbsp;<span class="op" id="1856868">*</span>&nbsp;<span class="num" id="1856870">1000</span><span class="op" id="1856874">)</span><span class="op" id="1856875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856879">if</span>&nbsp;<span class="ident" id="1856882"><a href="/runtime/mprof.go.html#1856602">r</a></span>&nbsp;<span class="op" id="1856884">==</span>&nbsp;<span class="num" id="1856887">0</span>&nbsp;<span class="op" id="1856889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856894"><a href="/runtime/mprof.go.html#1856602">r</a></span>&nbsp;<span class="op" id="1856896">=</span>&nbsp;<span class="num" id="1856898">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856902">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1856905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1856909"><a href="/runtime/atomic.go.html#1711639">atomicstore64</a></span><span class="op" id="1856922">(</span><span class="op" id="1856923">&amp;</span><span class="ident" id="1856924"><a href="/runtime/mprof.go.html#1856178">blockprofilerate</a></span><span class="op" id="1856940">,</span>&nbsp;<span class="ident" id="1856942">uint64</span><span class="op" id="1856948">(</span><span class="ident" id="1856949"><a href="/runtime/mprof.go.html#1856602">r</a></span><span class="op" id="1856950">)</span><span class="op" id="1856951">)</span><br>
<span class="lineno"></span><span class="op" id="1856953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="1856956">func</span>&nbsp;<span class="ident" id="1856961">blockevent</span><span class="op" id="1856971">(</span><span class="ident" id="1856972">cycles</span>&nbsp;<span class="ident" id="1856979">int64</span><span class="op" id="1856984">,</span>&nbsp;<span class="ident" id="1856986">skip</span>&nbsp;<span class="builtintype" id="1856991">int</span><span class="op" id="1856994">)</span>&nbsp;<span class="op" id="1856996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1856999">if</span>&nbsp;<span class="ident" id="1857002"><a href="/runtime/mprof.go.html#1856972">cycles</a></span>&nbsp;<span class="op" id="1857009">&lt;=</span>&nbsp;<span class="num" id="1857012">0</span>&nbsp;<span class="op" id="1857014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857018"><a href="/runtime/mprof.go.html#1856972">cycles</a></span>&nbsp;<span class="op" id="1857025">=</span>&nbsp;<span class="num" id="1857027">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1857030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857033">rate</span>&nbsp;<span class="op" id="1857038">:=</span>&nbsp;<span class="ident" id="1857041">int64</span><span class="op" id="1857046">(</span><span class="ident" id="1857047"><a href="/runtime/atomic.go.html#1711348">atomicload64</a></span><span class="op" id="1857059">(</span><span class="op" id="1857060">&amp;</span><span class="ident" id="1857061"><a href="/runtime/mprof.go.html#1856178">blockprofilerate</a></span><span class="op" id="1857077">)</span><span class="op" id="1857078">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857081">if</span>&nbsp;<span class="ident" id="1857084"><a href="/runtime/mprof.go.html#1857033">rate</a></span>&nbsp;<span class="op" id="1857089">&lt;=</span>&nbsp;<span class="num" id="1857092">0</span>&nbsp;<span class="op" id="1857094">||</span>&nbsp;<span class="op" id="1857097">(</span><span class="ident" id="1857098"><a href="/runtime/mprof.go.html#1857033">rate</a></span>&nbsp;<span class="op" id="1857103">&gt;</span>&nbsp;<span class="ident" id="1857105"><a href="/runtime/mprof.go.html#1856972">cycles</a></span>&nbsp;<span class="op" id="1857112">&amp;&amp;</span>&nbsp;<span class="ident" id="1857115">int64</span><span class="op" id="1857120">(</span><span class="ident" id="1857121"><a href="/runtime/stubs.go.html#1972912">fastrand1</a></span><span class="op" id="1857130">(</span><span class="op" id="1857131">)</span><span class="op" id="1857132">)</span><span class="op" id="1857133">%</span><span class="ident" id="1857134"><a href="/runtime/mprof.go.html#1857033">rate</a></span>&nbsp;<span class="op" id="1857139">&gt;</span>&nbsp;<span class="ident" id="1857141"><a href="/runtime/mprof.go.html#1856972">cycles</a></span><span class="op" id="1857147">)</span>&nbsp;<span class="op" id="1857149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857153">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1857161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857164">gp</span>&nbsp;<span class="op" id="1857167">:=</span>&nbsp;<span class="ident" id="1857170"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1857174">(</span><span class="op" id="1857175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857178">var</span>&nbsp;<span class="ident" id="1857182">nstk</span>&nbsp;<span class="builtintype" id="1857187">int</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857192">var</span>&nbsp;<span class="ident" id="1857196">stk</span>&nbsp;<span class="op" id="1857200">[</span><span class="ident" id="1857201"><a href="/runtime/mprof.go.html#1850000">maxStack</a></span><span class="op" id="1857209">]</span><span class="builtintype" id="1857210">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857219">if</span>&nbsp;<span class="ident" id="1857222"><a href="/runtime/mprof.go.html#1857164">gp</a></span><span class="op" id="1857224">.</span><span class="ident" id="1857225">m</span><span class="op" id="1857226">.</span><span class="ident" id="1857227">curg</span>&nbsp;<span class="op" id="1857232">==</span>&nbsp;<span class="ident" id="1857235">nil</span>&nbsp;<span class="op" id="1857239">||</span>&nbsp;<span class="ident" id="1857242"><a href="/runtime/mprof.go.html#1857164">gp</a></span><span class="op" id="1857244">.</span><span class="ident" id="1857245">m</span><span class="op" id="1857246">.</span><span class="ident" id="1857247">curg</span>&nbsp;<span class="op" id="1857252">==</span>&nbsp;<span class="ident" id="1857255"><a href="/runtime/mprof.go.html#1857164">gp</a></span>&nbsp;<span class="op" id="1857258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857262"><a href="/runtime/mprof.go.html#1857182">nstk</a></span>&nbsp;<span class="op" id="1857267">=</span>&nbsp;<span class="ident" id="1857269"><a href="/runtime/traceback.go.html#2010559">callers</a></span><span class="op" id="1857276">(</span><span class="ident" id="1857277"><a href="/runtime/mprof.go.html#1856986">skip</a></span><span class="op" id="1857281">,</span>&nbsp;<span class="op" id="1857283">&amp;</span><span class="ident" id="1857284"><a href="/runtime/mprof.go.html#1857196">stk</a></span><span class="op" id="1857287">[</span><span class="num" id="1857288">0</span><span class="op" id="1857289">]</span><span class="op" id="1857290">,</span>&nbsp;<span class="builtinfunc" id="1857292">len</span><span class="op" id="1857295">(</span><span class="ident" id="1857296"><a href="/runtime/mprof.go.html#1857196">stk</a></span><span class="op" id="1857299">)</span><span class="op" id="1857300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1857303">}</span>&nbsp;<span class="keyword" id="1857305">else</span>&nbsp;<span class="op" id="1857310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857314"><a href="/runtime/mprof.go.html#1857182">nstk</a></span>&nbsp;<span class="op" id="1857319">=</span>&nbsp;<span class="ident" id="1857321"><a href="/runtime/traceback.go.html#2010813">gcallers</a></span><span class="op" id="1857329">(</span><span class="ident" id="1857330"><a href="/runtime/mprof.go.html#1857164">gp</a></span><span class="op" id="1857332">.</span><span class="ident" id="1857333">m</span><span class="op" id="1857334">.</span><span class="ident" id="1857335">curg</span><span class="op" id="1857339">,</span>&nbsp;<span class="ident" id="1857341"><a href="/runtime/mprof.go.html#1856986">skip</a></span><span class="op" id="1857345">,</span>&nbsp;<span class="op" id="1857347">&amp;</span><span class="ident" id="1857348"><a href="/runtime/mprof.go.html#1857196">stk</a></span><span class="op" id="1857351">[</span><span class="num" id="1857352">0</span><span class="op" id="1857353">]</span><span class="op" id="1857354">,</span>&nbsp;<span class="builtinfunc" id="1857356">len</span><span class="op" id="1857359">(</span><span class="ident" id="1857360"><a href="/runtime/mprof.go.html#1857196">stk</a></span><span class="op" id="1857363">)</span><span class="op" id="1857364">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1857367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857370"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1857374">(</span><span class="op" id="1857375">&amp;</span><span class="ident" id="1857376"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1857384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857387">b</span>&nbsp;<span class="op" id="1857389">:=</span>&nbsp;<span class="ident" id="1857392"><a href="/runtime/mprof.go.html#1853333">stkbucket</a></span><span class="op" id="1857401">(</span><span class="ident" id="1857402"><a href="/runtime/mprof.go.html#1849888">blockProfile</a></span><span class="op" id="1857414">,</span>&nbsp;<span class="num" id="1857416">0</span><span class="op" id="1857417">,</span>&nbsp;<span class="ident" id="1857419"><a href="/runtime/mprof.go.html#1857196">stk</a></span><span class="op" id="1857422">[</span><span class="op" id="1857423">:</span><span class="ident" id="1857424"><a href="/runtime/mprof.go.html#1857182">nstk</a></span><span class="op" id="1857428">]</span><span class="op" id="1857429">,</span>&nbsp;<span class="ident" id="1857431">true</span><span class="op" id="1857435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857438"><a href="/runtime/mprof.go.html#1857387">b</a></span><span class="op" id="1857439">.</span><span class="ident" id="1857440">bp</span><span class="op" id="1857442">(</span><span class="op" id="1857443">)</span><span class="op" id="1857444">.</span><span class="ident" id="1857445">count</span><span class="op" id="1857450">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857454"><a href="/runtime/mprof.go.html#1857387">b</a></span><span class="op" id="1857455">.</span><span class="ident" id="1857456">bp</span><span class="op" id="1857458">(</span><span class="op" id="1857459">)</span><span class="op" id="1857460">.</span><span class="ident" id="1857461">cycles</span>&nbsp;<span class="op" id="1857468">+=</span>&nbsp;<span class="ident" id="1857471"><a href="/runtime/mprof.go.html#1856972">cycles</a></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857479"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1857485">(</span><span class="op" id="1857486">&amp;</span><span class="ident" id="1857487"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1857495">)</span><br>
<span class="lineno"></span><span class="op" id="1857497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1857500">//&nbsp;Go&nbsp;interface&nbsp;to&nbsp;profile&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="1857534">//&nbsp;A&nbsp;StackRecord&nbsp;describes&nbsp;a&nbsp;single&nbsp;execution&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="1857587">type</span>&nbsp;<span class="ident" id="1857592">StackRecord</span>&nbsp;<span class="keyword" id="1857604">struct</span>&nbsp;<span class="op" id="1857611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1857614">Stack0</span>&nbsp;<span class="op" id="1857621">[</span><span class="num" id="1857622">32</span><span class="op" id="1857624">]</span><span class="builtintype" id="1857625">uintptr</span>&nbsp;<span class="comment" id="1857633">//&nbsp;stack&nbsp;trace&nbsp;for&nbsp;this&nbsp;record;&nbsp;ends&nbsp;at&nbsp;first&nbsp;0&nbsp;entry</span><br>
<span class="lineno"></span><span class="op" id="1857687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span><span class="comment" id="1857690">//&nbsp;Stack&nbsp;returns&nbsp;the&nbsp;stack&nbsp;trace&nbsp;associated&nbsp;with&nbsp;the&nbsp;record,</span><br>
<span class="lineno"></span><span class="comment" id="1857751">//&nbsp;a&nbsp;prefix&nbsp;of&nbsp;r.Stack0.</span><br>
<span class="lineno"></span><span class="keyword" id="1857776">func</span>&nbsp;<span class="op" id="1857781">(</span><span class="ident" id="1857782">r</span>&nbsp;<span class="op" id="1857784">*</span><span class="ident" id="1857785"><a href="/runtime/mprof.go.html#1857592">StackRecord</a></span><span class="op" id="1857796">)</span>&nbsp;<span class="ident" id="1857798">Stack</span><span class="op" id="1857803">(</span><span class="op" id="1857804">)</span>&nbsp;<span class="op" id="1857806">[</span><span class="op" id="1857807">]</span><span class="builtintype" id="1857808">uintptr</span>&nbsp;<span class="op" id="1857816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857819">for</span>&nbsp;<span class="ident" id="1857823">i</span><span class="op" id="1857824">,</span>&nbsp;<span class="ident" id="1857826">v</span>&nbsp;<span class="op" id="1857828">:=</span>&nbsp;<span class="keyword" id="1857831">range</span>&nbsp;<span class="ident" id="1857837"><a href="/runtime/mprof.go.html#1857782">r</a></span><span class="op" id="1857838">.</span><span class="ident" id="1857839">Stack0</span>&nbsp;<span class="op" id="1857846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857850">if</span>&nbsp;<span class="ident" id="1857853"><a href="/runtime/mprof.go.html#1857826">v</a></span>&nbsp;<span class="op" id="1857855">==</span>&nbsp;<span class="num" id="1857858">0</span>&nbsp;<span class="op" id="1857860">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857865">return</span>&nbsp;<span class="ident" id="1857872"><a href="/runtime/mprof.go.html#1857782">r</a></span><span class="op" id="1857873">.</span><span class="ident" id="1857874">Stack0</span><span class="op" id="1857880">[</span><span class="num" id="1857881">0</span><span class="op" id="1857882">:</span><span class="ident" id="1857883"><a href="/runtime/mprof.go.html#1857823">i</a></span><span class="op" id="1857884">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1857888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1857891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1857894">return</span>&nbsp;<span class="ident" id="1857901"><a href="/runtime/mprof.go.html#1857782">r</a></span><span class="op" id="1857902">.</span><span class="ident" id="1857903">Stack0</span><span class="op" id="1857909">[</span><span class="num" id="1857910">0</span><span class="op" id="1857911">:</span><span class="op" id="1857912">]</span><br>
<span class="lineno"></span><span class="op" id="1857914">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="1857917">//&nbsp;MemProfileRate&nbsp;controls&nbsp;the&nbsp;fraction&nbsp;of&nbsp;memory&nbsp;allocations</span><br>
<span class="lineno"></span><span class="comment" id="1857979">//&nbsp;that&nbsp;are&nbsp;recorded&nbsp;and&nbsp;reported&nbsp;in&nbsp;the&nbsp;memory&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="1858036">//&nbsp;The&nbsp;profiler&nbsp;aims&nbsp;to&nbsp;sample&nbsp;an&nbsp;average&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1858081">//&nbsp;one&nbsp;allocation&nbsp;per&nbsp;MemProfileRate&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno">345</span><span class="comment" id="1858135">//</span><br>
<span class="lineno"></span><span class="comment" id="1858138">//&nbsp;To&nbsp;include&nbsp;every&nbsp;allocated&nbsp;block&nbsp;in&nbsp;the&nbsp;profile,&nbsp;set&nbsp;MemProfileRate&nbsp;to&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="1858215">//&nbsp;To&nbsp;turn&nbsp;off&nbsp;profiling&nbsp;entirely,&nbsp;set&nbsp;MemProfileRate&nbsp;to&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="1858275">//</span><br>
<span class="lineno"></span><span class="comment" id="1858278">//&nbsp;The&nbsp;tools&nbsp;that&nbsp;process&nbsp;the&nbsp;memory&nbsp;profiles&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno">350</span><span class="comment" id="1858340">//&nbsp;profile&nbsp;rate&nbsp;is&nbsp;constant&nbsp;across&nbsp;the&nbsp;lifetime&nbsp;of&nbsp;the&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="1858403">//&nbsp;and&nbsp;equal&nbsp;to&nbsp;the&nbsp;current&nbsp;value.&nbsp;&nbsp;Programs&nbsp;that&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1858464">//&nbsp;memory&nbsp;profiling&nbsp;rate&nbsp;should&nbsp;do&nbsp;so&nbsp;just&nbsp;once,&nbsp;as&nbsp;early&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1858525">//&nbsp;possible&nbsp;in&nbsp;the&nbsp;execution&nbsp;of&nbsp;the&nbsp;program&nbsp;(for&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="1858583">//&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;main).</span><br>
<span class="lineno">355</span><span class="keyword" id="1858613">var</span>&nbsp;<span class="ident" id="1858617">MemProfileRate</span>&nbsp;<span class="builtintype" id="1858632">int</span>&nbsp;<span class="op" id="1858636">=</span>&nbsp;<span class="num" id="1858638">512</span>&nbsp;<span class="op" id="1858642">*</span>&nbsp;<span class="num" id="1858644">1024</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1858650">//&nbsp;A&nbsp;MemProfileRecord&nbsp;describes&nbsp;the&nbsp;live&nbsp;objects&nbsp;allocated</span><br>
<span class="lineno"></span><span class="comment" id="1858709">//&nbsp;by&nbsp;a&nbsp;particular&nbsp;call&nbsp;sequence&nbsp;(stack&nbsp;trace).</span><br>
<span class="lineno"></span><span class="keyword" id="1858757">type</span>&nbsp;<span class="ident" id="1858762">MemProfileRecord</span>&nbsp;<span class="keyword" id="1858779">struct</span>&nbsp;<span class="op" id="1858786">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858789">AllocBytes</span><span class="op" id="1858799">,</span>&nbsp;<span class="ident" id="1858801">FreeBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1858815">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1858827">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated,&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858864">AllocObjects</span><span class="op" id="1858876">,</span>&nbsp;<span class="ident" id="1858878">FreeObjects</span>&nbsp;<span class="ident" id="1858890">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1858902">//&nbsp;number&nbsp;of&nbsp;objects&nbsp;allocated,&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1858941">Stack0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1858967">[</span><span class="num" id="1858968">32</span><span class="op" id="1858970">]</span><span class="builtintype" id="1858971">uintptr</span>&nbsp;<span class="comment" id="1858979">//&nbsp;stack&nbsp;trace&nbsp;for&nbsp;this&nbsp;record;&nbsp;ends&nbsp;at&nbsp;first&nbsp;0&nbsp;entry</span><br>
<span class="lineno"></span><span class="op" id="1859033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="1859036">//&nbsp;InUseBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;use&nbsp;(AllocBytes&nbsp;-&nbsp;FreeBytes).</span><br>
<span class="lineno"></span><span class="keyword" id="1859111">func</span>&nbsp;<span class="op" id="1859116">(</span><span class="ident" id="1859117">r</span>&nbsp;<span class="op" id="1859119">*</span><span class="ident" id="1859120"><a href="/runtime/mprof.go.html#1858762">MemProfileRecord</a></span><span class="op" id="1859136">)</span>&nbsp;<span class="ident" id="1859138">InUseBytes</span><span class="op" id="1859148">(</span><span class="op" id="1859149">)</span>&nbsp;<span class="ident" id="1859151">int64</span>&nbsp;<span class="op" id="1859157">{</span>&nbsp;<span class="keyword" id="1859159">return</span>&nbsp;<span class="ident" id="1859166"><a href="/runtime/mprof.go.html#1859117">r</a></span><span class="op" id="1859167">.</span><span class="ident" id="1859168">AllocBytes</span>&nbsp;<span class="op" id="1859179">-</span>&nbsp;<span class="ident" id="1859181"><a href="/runtime/mprof.go.html#1859117">r</a></span><span class="op" id="1859182">.</span><span class="ident" id="1859183">FreeBytes</span>&nbsp;<span class="op" id="1859193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1859196">//&nbsp;InUseObjects&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;objects&nbsp;in&nbsp;use&nbsp;(AllocObjects&nbsp;-&nbsp;FreeObjects).</span><br>
<span class="lineno"></span><span class="keyword" id="1859279">func</span>&nbsp;<span class="op" id="1859284">(</span><span class="ident" id="1859285">r</span>&nbsp;<span class="op" id="1859287">*</span><span class="ident" id="1859288"><a href="/runtime/mprof.go.html#1858762">MemProfileRecord</a></span><span class="op" id="1859304">)</span>&nbsp;<span class="ident" id="1859306">InUseObjects</span><span class="op" id="1859318">(</span><span class="op" id="1859319">)</span>&nbsp;<span class="ident" id="1859321">int64</span>&nbsp;<span class="op" id="1859327">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1859330">return</span>&nbsp;<span class="ident" id="1859337"><a href="/runtime/mprof.go.html#1859285">r</a></span><span class="op" id="1859338">.</span><span class="ident" id="1859339">AllocObjects</span>&nbsp;<span class="op" id="1859352">-</span>&nbsp;<span class="ident" id="1859354"><a href="/runtime/mprof.go.html#1859285">r</a></span><span class="op" id="1859355">.</span><span class="ident" id="1859356">FreeObjects</span><br>
<span class="lineno"></span><span class="op" id="1859368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1859371">//&nbsp;Stack&nbsp;returns&nbsp;the&nbsp;stack&nbsp;trace&nbsp;associated&nbsp;with&nbsp;the&nbsp;record,</span><br>
<span class="lineno"></span><span class="comment" id="1859432">//&nbsp;a&nbsp;prefix&nbsp;of&nbsp;r.Stack0.</span><br>
<span class="lineno">375</span><span class="keyword" id="1859457">func</span>&nbsp;<span class="op" id="1859462">(</span><span class="ident" id="1859463">r</span>&nbsp;<span class="op" id="1859465">*</span><span class="ident" id="1859466"><a href="/runtime/mprof.go.html#1858762">MemProfileRecord</a></span><span class="op" id="1859482">)</span>&nbsp;<span class="ident" id="1859484">Stack</span><span class="op" id="1859489">(</span><span class="op" id="1859490">)</span>&nbsp;<span class="op" id="1859492">[</span><span class="op" id="1859493">]</span><span class="builtintype" id="1859494">uintptr</span>&nbsp;<span class="op" id="1859502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1859505">for</span>&nbsp;<span class="ident" id="1859509">i</span><span class="op" id="1859510">,</span>&nbsp;<span class="ident" id="1859512">v</span>&nbsp;<span class="op" id="1859514">:=</span>&nbsp;<span class="keyword" id="1859517">range</span>&nbsp;<span class="ident" id="1859523"><a href="/runtime/mprof.go.html#1859463">r</a></span><span class="op" id="1859524">.</span><span class="ident" id="1859525">Stack0</span>&nbsp;<span class="op" id="1859532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1859536">if</span>&nbsp;<span class="ident" id="1859539"><a href="/runtime/mprof.go.html#1859512">v</a></span>&nbsp;<span class="op" id="1859541">==</span>&nbsp;<span class="num" id="1859544">0</span>&nbsp;<span class="op" id="1859546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1859551">return</span>&nbsp;<span class="ident" id="1859558"><a href="/runtime/mprof.go.html#1859463">r</a></span><span class="op" id="1859559">.</span><span class="ident" id="1859560">Stack0</span><span class="op" id="1859566">[</span><span class="num" id="1859567">0</span><span class="op" id="1859568">:</span><span class="ident" id="1859569"><a href="/runtime/mprof.go.html#1859509">i</a></span><span class="op" id="1859570">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1859574">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1859577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1859580">return</span>&nbsp;<span class="ident" id="1859587"><a href="/runtime/mprof.go.html#1859463">r</a></span><span class="op" id="1859588">.</span><span class="ident" id="1859589">Stack0</span><span class="op" id="1859595">[</span><span class="num" id="1859596">0</span><span class="op" id="1859597">:</span><span class="op" id="1859598">]</span><br>
<span class="lineno"></span><span class="op" id="1859600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1859603">//&nbsp;MemProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;current&nbsp;memory&nbsp;profile.</span><br>
<span class="lineno">385</span><span class="comment" id="1859681">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;MemProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="1859758">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;MemProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1859827">//</span><br>
<span class="lineno"></span><span class="comment" id="1859830">//&nbsp;If&nbsp;inuseZero&nbsp;is&nbsp;true,&nbsp;the&nbsp;profile&nbsp;includes&nbsp;allocation&nbsp;records</span><br>
<span class="lineno"></span><span class="comment" id="1859895">//&nbsp;where&nbsp;r.AllocBytes&nbsp;&gt;&nbsp;0&nbsp;but&nbsp;r.AllocBytes&nbsp;==&nbsp;r.FreeBytes.</span><br>
<span class="lineno">390</span><span class="comment" id="1859954">//&nbsp;These&nbsp;are&nbsp;sites&nbsp;where&nbsp;memory&nbsp;was&nbsp;allocated,&nbsp;but&nbsp;it&nbsp;has&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1860016">//&nbsp;been&nbsp;released&nbsp;back&nbsp;to&nbsp;the&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="comment" id="1860054">//</span><br>
<span class="lineno"></span><span class="comment" id="1860057">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1860113">//&nbsp;the&nbsp;testing&nbsp;package&#39;s&nbsp;-test.memprofile&nbsp;flag&nbsp;instead</span><br>
<span class="lineno">395</span><span class="comment" id="1860168">//&nbsp;of&nbsp;calling&nbsp;MemProfile&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="1860203">func</span>&nbsp;<span class="ident" id="1860208">MemProfile</span><span class="op" id="1860218">(</span><span class="ident" id="1860219">p</span>&nbsp;<span class="op" id="1860221">[</span><span class="op" id="1860222">]</span><span class="ident" id="1860223"><a href="/runtime/mprof.go.html#1858762">MemProfileRecord</a></span><span class="op" id="1860239">,</span>&nbsp;<span class="ident" id="1860241">inuseZero</span>&nbsp;<span class="builtintype" id="1860251">bool</span><span class="op" id="1860255">)</span>&nbsp;<span class="op" id="1860257">(</span><span class="ident" id="1860258">n</span>&nbsp;<span class="builtintype" id="1860260">int</span><span class="op" id="1860263">,</span>&nbsp;<span class="ident" id="1860265">ok</span>&nbsp;<span class="builtintype" id="1860268">bool</span><span class="op" id="1860272">)</span>&nbsp;<span class="op" id="1860274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860277"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1860281">(</span><span class="op" id="1860282">&amp;</span><span class="ident" id="1860283"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1860291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860294">clear</span>&nbsp;<span class="op" id="1860300">:=</span>&nbsp;<span class="ident" id="1860303">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860309">for</span>&nbsp;<span class="ident" id="1860313">b</span>&nbsp;<span class="op" id="1860315">:=</span>&nbsp;<span class="ident" id="1860318"><a href="/runtime/mprof.go.html#1851832">mbuckets</a></span><span class="op" id="1860326">;</span>&nbsp;<span class="ident" id="1860328"><a href="/runtime/mprof.go.html#1860313">b</a></span>&nbsp;<span class="op" id="1860330">!=</span>&nbsp;<span class="ident" id="1860333">nil</span><span class="op" id="1860336">;</span>&nbsp;<span class="ident" id="1860338"><a href="/runtime/mprof.go.html#1860313">b</a></span>&nbsp;<span class="op" id="1860340">=</span>&nbsp;<span class="ident" id="1860342"><a href="/runtime/mprof.go.html#1860313">b</a></span><span class="op" id="1860343">.</span><span class="ident" id="1860344">allnext</span>&nbsp;<span class="op" id="1860352">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860356">mp</span>&nbsp;<span class="op" id="1860359">:=</span>&nbsp;<span class="ident" id="1860362"><a href="/runtime/mprof.go.html#1860313">b</a></span><span class="op" id="1860363">.</span><span class="ident" id="1860364">mp</span><span class="op" id="1860366">(</span><span class="op" id="1860367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860371">if</span>&nbsp;<span class="ident" id="1860374"><a href="/runtime/mprof.go.html#1860241">inuseZero</a></span>&nbsp;<span class="op" id="1860384">||</span>&nbsp;<span class="ident" id="1860387"><a href="/runtime/mprof.go.html#1860356">mp</a></span><span class="op" id="1860389">.</span><span class="ident" id="1860390">alloc_bytes</span>&nbsp;<span class="op" id="1860402">!=</span>&nbsp;<span class="ident" id="1860405"><a href="/runtime/mprof.go.html#1860356">mp</a></span><span class="op" id="1860407">.</span><span class="ident" id="1860408">free_bytes</span>&nbsp;<span class="op" id="1860419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860424"><a href="/runtime/mprof.go.html#1860258">n</a></span><span class="op" id="1860425">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860434">if</span>&nbsp;<span class="ident" id="1860437"><a href="/runtime/mprof.go.html#1860356">mp</a></span><span class="op" id="1860439">.</span><span class="ident" id="1860440">allocs</span>&nbsp;<span class="op" id="1860447">!=</span>&nbsp;<span class="num" id="1860450">0</span>&nbsp;<span class="op" id="1860452">||</span>&nbsp;<span class="ident" id="1860455"><a href="/runtime/mprof.go.html#1860356">mp</a></span><span class="op" id="1860457">.</span><span class="ident" id="1860458">frees</span>&nbsp;<span class="op" id="1860464">!=</span>&nbsp;<span class="num" id="1860467">0</span>&nbsp;<span class="op" id="1860469">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860474"><a href="/runtime/mprof.go.html#1860294">clear</a></span>&nbsp;<span class="op" id="1860480">=</span>&nbsp;<span class="ident" id="1860482">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860496">if</span>&nbsp;<span class="ident" id="1860499"><a href="/runtime/mprof.go.html#1860294">clear</a></span>&nbsp;<span class="op" id="1860505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860509">//&nbsp;Absolutely&nbsp;no&nbsp;data,&nbsp;suggesting&nbsp;that&nbsp;a&nbsp;garbage&nbsp;collection</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860571">//&nbsp;has&nbsp;not&nbsp;yet&nbsp;happened.&nbsp;In&nbsp;order&nbsp;to&nbsp;allow&nbsp;profiling&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860631">//&nbsp;garbage&nbsp;collection&nbsp;is&nbsp;disabled&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;execution,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1860700">//&nbsp;accumulate&nbsp;stats&nbsp;as&nbsp;if&nbsp;a&nbsp;GC&nbsp;just&nbsp;happened,&nbsp;and&nbsp;recount&nbsp;buckets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860769"><a href="/runtime/mprof.go.html#1854488">mprof_GC</a></span><span class="op" id="1860777">(</span><span class="op" id="1860778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860782"><a href="/runtime/mprof.go.html#1854488">mprof_GC</a></span><span class="op" id="1860790">(</span><span class="op" id="1860791">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860795"><a href="/runtime/mprof.go.html#1860258">n</a></span>&nbsp;<span class="op" id="1860797">=</span>&nbsp;<span class="num" id="1860799">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860803">for</span>&nbsp;<span class="ident" id="1860807">b</span>&nbsp;<span class="op" id="1860809">:=</span>&nbsp;<span class="ident" id="1860812"><a href="/runtime/mprof.go.html#1851832">mbuckets</a></span><span class="op" id="1860820">;</span>&nbsp;<span class="ident" id="1860822"><a href="/runtime/mprof.go.html#1860807">b</a></span>&nbsp;<span class="op" id="1860824">!=</span>&nbsp;<span class="ident" id="1860827">nil</span><span class="op" id="1860830">;</span>&nbsp;<span class="ident" id="1860832"><a href="/runtime/mprof.go.html#1860807">b</a></span>&nbsp;<span class="op" id="1860834">=</span>&nbsp;<span class="ident" id="1860836"><a href="/runtime/mprof.go.html#1860807">b</a></span><span class="op" id="1860837">.</span><span class="ident" id="1860838">allnext</span>&nbsp;<span class="op" id="1860846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860851">mp</span>&nbsp;<span class="op" id="1860854">:=</span>&nbsp;<span class="ident" id="1860857"><a href="/runtime/mprof.go.html#1860807">b</a></span><span class="op" id="1860858">.</span><span class="ident" id="1860859">mp</span><span class="op" id="1860861">(</span><span class="op" id="1860862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860867">if</span>&nbsp;<span class="ident" id="1860870"><a href="/runtime/mprof.go.html#1860241">inuseZero</a></span>&nbsp;<span class="op" id="1860880">||</span>&nbsp;<span class="ident" id="1860883"><a href="/runtime/mprof.go.html#1860851">mp</a></span><span class="op" id="1860885">.</span><span class="ident" id="1860886">alloc_bytes</span>&nbsp;<span class="op" id="1860898">!=</span>&nbsp;<span class="ident" id="1860901"><a href="/runtime/mprof.go.html#1860851">mp</a></span><span class="op" id="1860903">.</span><span class="ident" id="1860904">free_bytes</span>&nbsp;<span class="op" id="1860915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860921"><a href="/runtime/mprof.go.html#1860258">n</a></span><span class="op" id="1860922">++</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1860935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860938">if</span>&nbsp;<span class="ident" id="1860941"><a href="/runtime/mprof.go.html#1860258">n</a></span>&nbsp;<span class="op" id="1860943">&lt;=</span>&nbsp;<span class="builtinfunc" id="1860946">len</span><span class="op" id="1860949">(</span><span class="ident" id="1860950"><a href="/runtime/mprof.go.html#1860219">p</a></span><span class="op" id="1860951">)</span>&nbsp;<span class="op" id="1860953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860957"><a href="/runtime/mprof.go.html#1860265">ok</a></span>&nbsp;<span class="op" id="1860960">=</span>&nbsp;<span class="ident" id="1860962">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1860969">idx</span>&nbsp;<span class="op" id="1860973">:=</span>&nbsp;<span class="num" id="1860976">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1860980">for</span>&nbsp;<span class="ident" id="1860984">b</span>&nbsp;<span class="op" id="1860986">:=</span>&nbsp;<span class="ident" id="1860989"><a href="/runtime/mprof.go.html#1851832">mbuckets</a></span><span class="op" id="1860997">;</span>&nbsp;<span class="ident" id="1860999"><a href="/runtime/mprof.go.html#1860984">b</a></span>&nbsp;<span class="op" id="1861001">!=</span>&nbsp;<span class="ident" id="1861004">nil</span><span class="op" id="1861007">;</span>&nbsp;<span class="ident" id="1861009"><a href="/runtime/mprof.go.html#1860984">b</a></span>&nbsp;<span class="op" id="1861011">=</span>&nbsp;<span class="ident" id="1861013"><a href="/runtime/mprof.go.html#1860984">b</a></span><span class="op" id="1861014">.</span><span class="ident" id="1861015">allnext</span>&nbsp;<span class="op" id="1861023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861028">mp</span>&nbsp;<span class="op" id="1861031">:=</span>&nbsp;<span class="ident" id="1861034"><a href="/runtime/mprof.go.html#1860984">b</a></span><span class="op" id="1861035">.</span><span class="ident" id="1861036">mp</span><span class="op" id="1861038">(</span><span class="op" id="1861039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1861044">if</span>&nbsp;<span class="ident" id="1861047"><a href="/runtime/mprof.go.html#1860241">inuseZero</a></span>&nbsp;<span class="op" id="1861057">||</span>&nbsp;<span class="ident" id="1861060"><a href="/runtime/mprof.go.html#1861028">mp</a></span><span class="op" id="1861062">.</span><span class="ident" id="1861063">alloc_bytes</span>&nbsp;<span class="op" id="1861075">!=</span>&nbsp;<span class="ident" id="1861078"><a href="/runtime/mprof.go.html#1861028">mp</a></span><span class="op" id="1861080">.</span><span class="ident" id="1861081">free_bytes</span>&nbsp;<span class="op" id="1861092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861098"><a href="/runtime/mprof.go.html#1861198">record</a></span><span class="op" id="1861104">(</span><span class="op" id="1861105">&amp;</span><span class="ident" id="1861106"><a href="/runtime/mprof.go.html#1860219">p</a></span><span class="op" id="1861107">[</span><span class="ident" id="1861108"><a href="/runtime/mprof.go.html#1860969">idx</a></span><span class="op" id="1861111">]</span><span class="op" id="1861112">,</span>&nbsp;<span class="ident" id="1861114"><a href="/runtime/mprof.go.html#1860984">b</a></span><span class="op" id="1861115">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861121"><a href="/runtime/mprof.go.html#1860969">idx</a></span><span class="op" id="1861124">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1861130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1861134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1861137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861140"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1861146">(</span><span class="op" id="1861147">&amp;</span><span class="ident" id="1861148"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1861156">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1861159">return</span><br>
<span class="lineno"></span><span class="op" id="1861166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1861169">//&nbsp;Write&nbsp;b&#39;s&nbsp;data&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="1861193">func</span>&nbsp;<span class="ident" id="1861198">record</span><span class="op" id="1861204">(</span><span class="ident" id="1861205">r</span>&nbsp;<span class="op" id="1861207">*</span><span class="ident" id="1861208"><a href="/runtime/mprof.go.html#1858762">MemProfileRecord</a></span><span class="op" id="1861224">,</span>&nbsp;<span class="ident" id="1861226">b</span>&nbsp;<span class="op" id="1861228">*</span><span class="ident" id="1861229"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><span class="op" id="1861235">)</span>&nbsp;<span class="op" id="1861237">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861240">mp</span>&nbsp;<span class="op" id="1861243">:=</span>&nbsp;<span class="ident" id="1861246"><a href="/runtime/mprof.go.html#1861226">b</a></span><span class="op" id="1861247">.</span><span class="ident" id="1861248">mp</span><span class="op" id="1861250">(</span><span class="op" id="1861251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861254"><a href="/runtime/mprof.go.html#1861205">r</a></span><span class="op" id="1861255">.</span><span class="ident" id="1861256">AllocBytes</span>&nbsp;<span class="op" id="1861267">=</span>&nbsp;<span class="ident" id="1861269">int64</span><span class="op" id="1861274">(</span><span class="ident" id="1861275"><a href="/runtime/mprof.go.html#1861240">mp</a></span><span class="op" id="1861277">.</span><span class="ident" id="1861278">alloc_bytes</span><span class="op" id="1861289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861292"><a href="/runtime/mprof.go.html#1861205">r</a></span><span class="op" id="1861293">.</span><span class="ident" id="1861294">FreeBytes</span>&nbsp;<span class="op" id="1861304">=</span>&nbsp;<span class="ident" id="1861306">int64</span><span class="op" id="1861311">(</span><span class="ident" id="1861312"><a href="/runtime/mprof.go.html#1861240">mp</a></span><span class="op" id="1861314">.</span><span class="ident" id="1861315">free_bytes</span><span class="op" id="1861325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861328"><a href="/runtime/mprof.go.html#1861205">r</a></span><span class="op" id="1861329">.</span><span class="ident" id="1861330">AllocObjects</span>&nbsp;<span class="op" id="1861343">=</span>&nbsp;<span class="ident" id="1861345">int64</span><span class="op" id="1861350">(</span><span class="ident" id="1861351"><a href="/runtime/mprof.go.html#1861240">mp</a></span><span class="op" id="1861353">.</span><span class="ident" id="1861354">allocs</span><span class="op" id="1861360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861363"><a href="/runtime/mprof.go.html#1861205">r</a></span><span class="op" id="1861364">.</span><span class="ident" id="1861365">FreeObjects</span>&nbsp;<span class="op" id="1861377">=</span>&nbsp;<span class="ident" id="1861379">int64</span><span class="op" id="1861384">(</span><span class="ident" id="1861385"><a href="/runtime/mprof.go.html#1861240">mp</a></span><span class="op" id="1861387">.</span><span class="ident" id="1861388">frees</span><span class="op" id="1861393">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1861396">copy</span><span class="op" id="1861400">(</span><span class="ident" id="1861401"><a href="/runtime/mprof.go.html#1861205">r</a></span><span class="op" id="1861402">.</span><span class="ident" id="1861403">Stack0</span><span class="op" id="1861409">[</span><span class="op" id="1861410">:</span><span class="op" id="1861411">]</span><span class="op" id="1861412">,</span>&nbsp;<span class="ident" id="1861414"><a href="/runtime/mprof.go.html#1861226">b</a></span><span class="op" id="1861415">.</span><span class="ident" id="1861416">stk</span><span class="op" id="1861419">(</span><span class="op" id="1861420">)</span><span class="op" id="1861421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1861424">for</span>&nbsp;<span class="ident" id="1861428">i</span>&nbsp;<span class="op" id="1861430">:=</span>&nbsp;<span class="builtintype" id="1861433">int</span><span class="op" id="1861436">(</span><span class="ident" id="1861437"><a href="/runtime/mprof.go.html#1861226">b</a></span><span class="op" id="1861438">.</span><span class="ident" id="1861439">nstk</span><span class="op" id="1861443">)</span><span class="op" id="1861444">;</span>&nbsp;<span class="ident" id="1861446"><a href="/runtime/mprof.go.html#1861428">i</a></span>&nbsp;<span class="op" id="1861448">&lt;</span>&nbsp;<span class="builtinfunc" id="1861450">len</span><span class="op" id="1861453">(</span><span class="ident" id="1861454"><a href="/runtime/mprof.go.html#1861205">r</a></span><span class="op" id="1861455">.</span><span class="ident" id="1861456">Stack0</span><span class="op" id="1861462">)</span><span class="op" id="1861463">;</span>&nbsp;<span class="ident" id="1861465"><a href="/runtime/mprof.go.html#1861428">i</a></span><span class="op" id="1861466">++</span>&nbsp;<span class="op" id="1861469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861473"><a href="/runtime/mprof.go.html#1861205">r</a></span><span class="op" id="1861474">.</span><span class="ident" id="1861475">Stack0</span><span class="op" id="1861481">[</span><span class="ident" id="1861482"><a href="/runtime/mprof.go.html#1861428">i</a></span><span class="op" id="1861483">]</span>&nbsp;<span class="op" id="1861485">=</span>&nbsp;<span class="num" id="1861487">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1861490">}</span><br>
<span class="lineno"></span><span class="op" id="1861492">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="keyword" id="1861495">func</span>&nbsp;<span class="ident" id="1861500">iterate_memprof</span><span class="op" id="1861515">(</span><span class="ident" id="1861516">fn</span>&nbsp;<span class="keyword" id="1861519">func</span><span class="op" id="1861523">(</span><span class="op" id="1861524">*</span><span class="ident" id="1861525"><a href="/runtime/mprof.go.html#1850425">bucket</a></span><span class="op" id="1861531">,</span>&nbsp;<span class="builtintype" id="1861533">uintptr</span><span class="op" id="1861540">,</span>&nbsp;<span class="op" id="1861542">*</span><span class="builtintype" id="1861543">uintptr</span><span class="op" id="1861550">,</span>&nbsp;<span class="builtintype" id="1861552">uintptr</span><span class="op" id="1861559">,</span>&nbsp;<span class="builtintype" id="1861561">uintptr</span><span class="op" id="1861568">,</span>&nbsp;<span class="builtintype" id="1861570">uintptr</span><span class="op" id="1861577">)</span><span class="op" id="1861578">)</span>&nbsp;<span class="op" id="1861580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861583"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1861587">(</span><span class="op" id="1861588">&amp;</span><span class="ident" id="1861589"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1861597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1861600">for</span>&nbsp;<span class="ident" id="1861604">b</span>&nbsp;<span class="op" id="1861606">:=</span>&nbsp;<span class="ident" id="1861609"><a href="/runtime/mprof.go.html#1851832">mbuckets</a></span><span class="op" id="1861617">;</span>&nbsp;<span class="ident" id="1861619"><a href="/runtime/mprof.go.html#1861604">b</a></span>&nbsp;<span class="op" id="1861621">!=</span>&nbsp;<span class="ident" id="1861624">nil</span><span class="op" id="1861627">;</span>&nbsp;<span class="ident" id="1861629"><a href="/runtime/mprof.go.html#1861604">b</a></span>&nbsp;<span class="op" id="1861631">=</span>&nbsp;<span class="ident" id="1861633"><a href="/runtime/mprof.go.html#1861604">b</a></span><span class="op" id="1861634">.</span><span class="ident" id="1861635">allnext</span>&nbsp;<span class="op" id="1861643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861647">mp</span>&nbsp;<span class="op" id="1861650">:=</span>&nbsp;<span class="ident" id="1861653"><a href="/runtime/mprof.go.html#1861604">b</a></span><span class="op" id="1861654">.</span><span class="ident" id="1861655">mp</span><span class="op" id="1861657">(</span><span class="op" id="1861658">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861662"><a href="/runtime/mprof.go.html#1861516">fn</a></span><span class="op" id="1861664">(</span><span class="ident" id="1861665"><a href="/runtime/mprof.go.html#1861604">b</a></span><span class="op" id="1861666">,</span>&nbsp;<span class="builtintype" id="1861668">uintptr</span><span class="op" id="1861675">(</span><span class="ident" id="1861676"><a href="/runtime/mprof.go.html#1861604">b</a></span><span class="op" id="1861677">.</span><span class="ident" id="1861678">nstk</span><span class="op" id="1861682">)</span><span class="op" id="1861683">,</span>&nbsp;<span class="op" id="1861685">&amp;</span><span class="ident" id="1861686"><a href="/runtime/mprof.go.html#1861604">b</a></span><span class="op" id="1861687">.</span><span class="ident" id="1861688">stk</span><span class="op" id="1861691">(</span><span class="op" id="1861692">)</span><span class="op" id="1861693">[</span><span class="num" id="1861694">0</span><span class="op" id="1861695">]</span><span class="op" id="1861696">,</span>&nbsp;<span class="ident" id="1861698"><a href="/runtime/mprof.go.html#1861604">b</a></span><span class="op" id="1861699">.</span><span class="ident" id="1861700">size</span><span class="op" id="1861704">,</span>&nbsp;<span class="ident" id="1861706"><a href="/runtime/mprof.go.html#1861647">mp</a></span><span class="op" id="1861708">.</span><span class="ident" id="1861709">allocs</span><span class="op" id="1861715">,</span>&nbsp;<span class="ident" id="1861717"><a href="/runtime/mprof.go.html#1861647">mp</a></span><span class="op" id="1861719">.</span><span class="ident" id="1861720">frees</span><span class="op" id="1861725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1861728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861731"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1861737">(</span><span class="op" id="1861738">&amp;</span><span class="ident" id="1861739"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1861747">)</span><br>
<span class="lineno"></span><span class="op" id="1861749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="1861752">//&nbsp;BlockProfileRecord&nbsp;describes&nbsp;blocking&nbsp;events&nbsp;originated</span><br>
<span class="lineno"></span><span class="comment" id="1861811">//&nbsp;at&nbsp;a&nbsp;particular&nbsp;call&nbsp;sequence&nbsp;(stack&nbsp;trace).</span><br>
<span class="lineno"></span><span class="keyword" id="1861859">type</span>&nbsp;<span class="ident" id="1861864">BlockProfileRecord</span>&nbsp;<span class="keyword" id="1861883">struct</span>&nbsp;<span class="op" id="1861890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861893">Count</span>&nbsp;&nbsp;<span class="ident" id="1861900">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861907">Cycles</span>&nbsp;<span class="ident" id="1861914">int64</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1861921"><a href="/runtime/mprof.go.html#1857592">StackRecord</a></span><br>
<span class="lineno"></span><span class="op" id="1861933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1861936">//&nbsp;BlockProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;current&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="1862018">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;BlockProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno">470</span><span class="comment" id="1862097">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;BlockProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1862168">//</span><br>
<span class="lineno"></span><span class="comment" id="1862171">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1862227">//&nbsp;the&nbsp;testing&nbsp;package&#39;s&nbsp;-test.blockprofile&nbsp;flag&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="1862284">//&nbsp;of&nbsp;calling&nbsp;BlockProfile&nbsp;directly.</span><br>
<span class="lineno">475</span><span class="keyword" id="1862321">func</span>&nbsp;<span class="ident" id="1862326">BlockProfile</span><span class="op" id="1862338">(</span><span class="ident" id="1862339">p</span>&nbsp;<span class="op" id="1862341">[</span><span class="op" id="1862342">]</span><span class="ident" id="1862343"><a href="/runtime/mprof.go.html#1861864">BlockProfileRecord</a></span><span class="op" id="1862361">)</span>&nbsp;<span class="op" id="1862363">(</span><span class="ident" id="1862364">n</span>&nbsp;<span class="builtintype" id="1862366">int</span><span class="op" id="1862369">,</span>&nbsp;<span class="ident" id="1862371">ok</span>&nbsp;<span class="builtintype" id="1862374">bool</span><span class="op" id="1862378">)</span>&nbsp;<span class="op" id="1862380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862383"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1862387">(</span><span class="op" id="1862388">&amp;</span><span class="ident" id="1862389"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1862397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862400">for</span>&nbsp;<span class="ident" id="1862404">b</span>&nbsp;<span class="op" id="1862406">:=</span>&nbsp;<span class="ident" id="1862409"><a href="/runtime/mprof.go.html#1851877">bbuckets</a></span><span class="op" id="1862417">;</span>&nbsp;<span class="ident" id="1862419"><a href="/runtime/mprof.go.html#1862404">b</a></span>&nbsp;<span class="op" id="1862421">!=</span>&nbsp;<span class="ident" id="1862424">nil</span><span class="op" id="1862427">;</span>&nbsp;<span class="ident" id="1862429"><a href="/runtime/mprof.go.html#1862404">b</a></span>&nbsp;<span class="op" id="1862431">=</span>&nbsp;<span class="ident" id="1862433"><a href="/runtime/mprof.go.html#1862404">b</a></span><span class="op" id="1862434">.</span><span class="ident" id="1862435">allnext</span>&nbsp;<span class="op" id="1862443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862447"><a href="/runtime/mprof.go.html#1862364">n</a></span><span class="op" id="1862448">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1862452">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862455">if</span>&nbsp;<span class="ident" id="1862458"><a href="/runtime/mprof.go.html#1862364">n</a></span>&nbsp;<span class="op" id="1862460">&lt;=</span>&nbsp;<span class="builtinfunc" id="1862463">len</span><span class="op" id="1862466">(</span><span class="ident" id="1862467"><a href="/runtime/mprof.go.html#1862339">p</a></span><span class="op" id="1862468">)</span>&nbsp;<span class="op" id="1862470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862474"><a href="/runtime/mprof.go.html#1862371">ok</a></span>&nbsp;<span class="op" id="1862477">=</span>&nbsp;<span class="ident" id="1862479">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862486">for</span>&nbsp;<span class="ident" id="1862490">b</span>&nbsp;<span class="op" id="1862492">:=</span>&nbsp;<span class="ident" id="1862495"><a href="/runtime/mprof.go.html#1851877">bbuckets</a></span><span class="op" id="1862503">;</span>&nbsp;<span class="ident" id="1862505"><a href="/runtime/mprof.go.html#1862490">b</a></span>&nbsp;<span class="op" id="1862507">!=</span>&nbsp;<span class="ident" id="1862510">nil</span><span class="op" id="1862513">;</span>&nbsp;<span class="ident" id="1862515"><a href="/runtime/mprof.go.html#1862490">b</a></span>&nbsp;<span class="op" id="1862517">=</span>&nbsp;<span class="ident" id="1862519"><a href="/runtime/mprof.go.html#1862490">b</a></span><span class="op" id="1862520">.</span><span class="ident" id="1862521">allnext</span>&nbsp;<span class="op" id="1862529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862534">bp</span>&nbsp;<span class="op" id="1862537">:=</span>&nbsp;<span class="ident" id="1862540"><a href="/runtime/mprof.go.html#1862490">b</a></span><span class="op" id="1862541">.</span><span class="ident" id="1862542">bp</span><span class="op" id="1862544">(</span><span class="op" id="1862545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862550">r</span>&nbsp;<span class="op" id="1862552">:=</span>&nbsp;<span class="op" id="1862555">&amp;</span><span class="ident" id="1862556"><a href="/runtime/mprof.go.html#1862339">p</a></span><span class="op" id="1862557">[</span><span class="num" id="1862558">0</span><span class="op" id="1862559">]</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862564"><a href="/runtime/mprof.go.html#1862550">r</a></span><span class="op" id="1862565">.</span><span class="ident" id="1862566">Count</span>&nbsp;<span class="op" id="1862572">=</span>&nbsp;<span class="ident" id="1862574">int64</span><span class="op" id="1862579">(</span><span class="ident" id="1862580"><a href="/runtime/mprof.go.html#1862534">bp</a></span><span class="op" id="1862582">.</span><span class="ident" id="1862583">count</span><span class="op" id="1862588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862593"><a href="/runtime/mprof.go.html#1862550">r</a></span><span class="op" id="1862594">.</span><span class="ident" id="1862595">Cycles</span>&nbsp;<span class="op" id="1862602">=</span>&nbsp;<span class="ident" id="1862604">int64</span><span class="op" id="1862609">(</span><span class="ident" id="1862610"><a href="/runtime/mprof.go.html#1862534">bp</a></span><span class="op" id="1862612">.</span><span class="ident" id="1862613">cycles</span><span class="op" id="1862619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862624">i</span>&nbsp;<span class="op" id="1862626">:=</span>&nbsp;<span class="builtinfunc" id="1862629">copy</span><span class="op" id="1862633">(</span><span class="ident" id="1862634"><a href="/runtime/mprof.go.html#1862550">r</a></span><span class="op" id="1862635">.</span><span class="ident" id="1862636">Stack0</span><span class="op" id="1862642">[</span><span class="op" id="1862643">:</span><span class="op" id="1862644">]</span><span class="op" id="1862645">,</span>&nbsp;<span class="ident" id="1862647"><a href="/runtime/mprof.go.html#1862490">b</a></span><span class="op" id="1862648">.</span><span class="ident" id="1862649">stk</span><span class="op" id="1862652">(</span><span class="op" id="1862653">)</span><span class="op" id="1862654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862659">for</span>&nbsp;<span class="op" id="1862663">;</span>&nbsp;<span class="ident" id="1862665"><a href="/runtime/mprof.go.html#1862624">i</a></span>&nbsp;<span class="op" id="1862667">&lt;</span>&nbsp;<span class="builtinfunc" id="1862669">len</span><span class="op" id="1862672">(</span><span class="ident" id="1862673"><a href="/runtime/mprof.go.html#1862550">r</a></span><span class="op" id="1862674">.</span><span class="ident" id="1862675">Stack0</span><span class="op" id="1862681">)</span><span class="op" id="1862682">;</span>&nbsp;<span class="ident" id="1862684"><a href="/runtime/mprof.go.html#1862624">i</a></span><span class="op" id="1862685">++</span>&nbsp;<span class="op" id="1862688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862694"><a href="/runtime/mprof.go.html#1862550">r</a></span><span class="op" id="1862695">.</span><span class="ident" id="1862696">Stack0</span><span class="op" id="1862702">[</span><span class="ident" id="1862703"><a href="/runtime/mprof.go.html#1862624">i</a></span><span class="op" id="1862704">]</span>&nbsp;<span class="op" id="1862706">=</span>&nbsp;<span class="num" id="1862708">0</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1862713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862718"><a href="/runtime/mprof.go.html#1862339">p</a></span>&nbsp;<span class="op" id="1862720">=</span>&nbsp;<span class="ident" id="1862722"><a href="/runtime/mprof.go.html#1862339">p</a></span><span class="op" id="1862723">[</span><span class="num" id="1862724">1</span><span class="op" id="1862725">:</span><span class="op" id="1862726">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1862730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1862733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1862736"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1862742">(</span><span class="op" id="1862743">&amp;</span><span class="ident" id="1862744"><a href="/runtime/mprof.go.html#1849658">proflock</a></span><span class="op" id="1862752">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1862755">return</span><br>
<span class="lineno"></span><span class="op" id="1862762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1862765">//&nbsp;ThreadCreateProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;thread&nbsp;creation&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="1862853">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;ThreadCreateProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno">500</span><span class="comment" id="1862939">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;ThreadCreateProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1863017">//</span><br>
<span class="lineno"></span><span class="comment" id="1863020">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="1863081">//&nbsp;of&nbsp;calling&nbsp;ThreadCreateProfile&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="1863125">func</span>&nbsp;<span class="ident" id="1863130">ThreadCreateProfile</span><span class="op" id="1863149">(</span><span class="ident" id="1863150">p</span>&nbsp;<span class="op" id="1863152">[</span><span class="op" id="1863153">]</span><span class="ident" id="1863154"><a href="/runtime/mprof.go.html#1857592">StackRecord</a></span><span class="op" id="1863165">)</span>&nbsp;<span class="op" id="1863167">(</span><span class="ident" id="1863168">n</span>&nbsp;<span class="builtintype" id="1863170">int</span><span class="op" id="1863173">,</span>&nbsp;<span class="ident" id="1863175">ok</span>&nbsp;<span class="builtintype" id="1863178">bool</span><span class="op" id="1863182">)</span>&nbsp;<span class="op" id="1863184">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863187">first</span>&nbsp;<span class="op" id="1863193">:=</span>&nbsp;<span class="op" id="1863196">(</span><span class="op" id="1863197">*</span><span class="ident" id="1863198"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017777">m</a></span><span class="op" id="1863199">)</span><span class="op" id="1863200">(</span><span class="ident" id="1863201"><a href="/runtime/atomic.go.html#1711401">atomicloadp</a></span><span class="op" id="1863212">(</span><span class="ident" id="1863213"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1863219">.</span><span class="ident" id="1863220">Pointer</span><span class="op" id="1863227">(</span><span class="op" id="1863228">&amp;</span><span class="ident" id="1863229"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021209">allm</a></span><span class="op" id="1863233">)</span><span class="op" id="1863234">)</span><span class="op" id="1863235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863238">for</span>&nbsp;<span class="ident" id="1863242">mp</span>&nbsp;<span class="op" id="1863245">:=</span>&nbsp;<span class="ident" id="1863248"><a href="/runtime/mprof.go.html#1863187">first</a></span><span class="op" id="1863253">;</span>&nbsp;<span class="ident" id="1863255"><a href="/runtime/mprof.go.html#1863242">mp</a></span>&nbsp;<span class="op" id="1863258">!=</span>&nbsp;<span class="ident" id="1863261">nil</span><span class="op" id="1863264">;</span>&nbsp;<span class="ident" id="1863266"><a href="/runtime/mprof.go.html#1863242">mp</a></span>&nbsp;<span class="op" id="1863269">=</span>&nbsp;<span class="ident" id="1863271"><a href="/runtime/mprof.go.html#1863242">mp</a></span><span class="op" id="1863273">.</span><span class="ident" id="1863274">alllink</span>&nbsp;<span class="op" id="1863282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863286"><a href="/runtime/mprof.go.html#1863168">n</a></span><span class="op" id="1863287">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863294">if</span>&nbsp;<span class="ident" id="1863297"><a href="/runtime/mprof.go.html#1863168">n</a></span>&nbsp;<span class="op" id="1863299">&lt;=</span>&nbsp;<span class="builtinfunc" id="1863302">len</span><span class="op" id="1863305">(</span><span class="ident" id="1863306"><a href="/runtime/mprof.go.html#1863150">p</a></span><span class="op" id="1863307">)</span>&nbsp;<span class="op" id="1863309">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863313"><a href="/runtime/mprof.go.html#1863175">ok</a></span>&nbsp;<span class="op" id="1863316">=</span>&nbsp;<span class="ident" id="1863318">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863325">i</span>&nbsp;<span class="op" id="1863327">:=</span>&nbsp;<span class="num" id="1863330">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863334">for</span>&nbsp;<span class="ident" id="1863338">mp</span>&nbsp;<span class="op" id="1863341">:=</span>&nbsp;<span class="ident" id="1863344"><a href="/runtime/mprof.go.html#1863187">first</a></span><span class="op" id="1863349">;</span>&nbsp;<span class="ident" id="1863351"><a href="/runtime/mprof.go.html#1863338">mp</a></span>&nbsp;<span class="op" id="1863354">!=</span>&nbsp;<span class="ident" id="1863357">nil</span><span class="op" id="1863360">;</span>&nbsp;<span class="ident" id="1863362"><a href="/runtime/mprof.go.html#1863338">mp</a></span>&nbsp;<span class="op" id="1863365">=</span>&nbsp;<span class="ident" id="1863367"><a href="/runtime/mprof.go.html#1863338">mp</a></span><span class="op" id="1863369">.</span><span class="ident" id="1863370">alllink</span>&nbsp;<span class="op" id="1863378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863383">for</span>&nbsp;<span class="ident" id="1863387">s</span>&nbsp;<span class="op" id="1863389">:=</span>&nbsp;<span class="keyword" id="1863392">range</span>&nbsp;<span class="ident" id="1863398"><a href="/runtime/mprof.go.html#1863338">mp</a></span><span class="op" id="1863400">.</span><span class="ident" id="1863401">createstack</span>&nbsp;<span class="op" id="1863413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863419"><a href="/runtime/mprof.go.html#1863150">p</a></span><span class="op" id="1863420">[</span><span class="ident" id="1863421"><a href="/runtime/mprof.go.html#1863325">i</a></span><span class="op" id="1863422">]</span><span class="op" id="1863423">.</span><span class="ident" id="1863424">Stack0</span><span class="op" id="1863430">[</span><span class="ident" id="1863431"><a href="/runtime/mprof.go.html#1863387">s</a></span><span class="op" id="1863432">]</span>&nbsp;<span class="op" id="1863434">=</span>&nbsp;<span class="builtintype" id="1863436">uintptr</span><span class="op" id="1863443">(</span><span class="ident" id="1863444"><a href="/runtime/mprof.go.html#1863338">mp</a></span><span class="op" id="1863446">.</span><span class="ident" id="1863447">createstack</span><span class="op" id="1863458">[</span><span class="ident" id="1863459"><a href="/runtime/mprof.go.html#1863387">s</a></span><span class="op" id="1863460">]</span><span class="op" id="1863461">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863471"><a href="/runtime/mprof.go.html#1863325">i</a></span><span class="op" id="1863472">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1863480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863483">return</span><br>
<span class="lineno">520</span><span class="op" id="1863490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1863493">var</span>&nbsp;<span class="ident" id="1863497">allgs</span>&nbsp;<span class="op" id="1863503">[</span><span class="op" id="1863504">]</span><span class="op" id="1863505">*</span><span class="ident" id="1863506"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span>&nbsp;<span class="comment" id="1863508">//&nbsp;proc.c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1863519">//&nbsp;GoroutineProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;active&nbsp;goroutine&nbsp;stack&nbsp;profile.</span><br>
<span class="lineno">525</span><span class="comment" id="1863611">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;GoroutineProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="1863694">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;GoroutineProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1863769">//</span><br>
<span class="lineno"></span><span class="comment" id="1863772">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="1863833">//&nbsp;of&nbsp;calling&nbsp;GoroutineProfile&nbsp;directly.</span><br>
<span class="lineno">530</span><span class="keyword" id="1863874">func</span>&nbsp;<span class="ident" id="1863879">GoroutineProfile</span><span class="op" id="1863895">(</span><span class="ident" id="1863896">p</span>&nbsp;<span class="op" id="1863898">[</span><span class="op" id="1863899">]</span><span class="ident" id="1863900"><a href="/runtime/mprof.go.html#1857592">StackRecord</a></span><span class="op" id="1863911">)</span>&nbsp;<span class="op" id="1863913">(</span><span class="ident" id="1863914">n</span>&nbsp;<span class="builtintype" id="1863916">int</span><span class="op" id="1863919">,</span>&nbsp;<span class="ident" id="1863921">ok</span>&nbsp;<span class="builtintype" id="1863924">bool</span><span class="op" id="1863928">)</span>&nbsp;<span class="op" id="1863930">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863934"><a href="/runtime/mprof.go.html#1863914">n</a></span>&nbsp;<span class="op" id="1863936">=</span>&nbsp;<span class="ident" id="1863938"><a href="/runtime/debug.go.html#1752153">NumGoroutine</a></span><span class="op" id="1863950">(</span><span class="op" id="1863951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1863954">if</span>&nbsp;<span class="ident" id="1863957"><a href="/runtime/mprof.go.html#1863914">n</a></span>&nbsp;<span class="op" id="1863959">&lt;=</span>&nbsp;<span class="builtinfunc" id="1863962">len</span><span class="op" id="1863965">(</span><span class="ident" id="1863966"><a href="/runtime/mprof.go.html#1863896">p</a></span><span class="op" id="1863967">)</span>&nbsp;<span class="op" id="1863969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863973">gp</span>&nbsp;<span class="op" id="1863976">:=</span>&nbsp;<span class="ident" id="1863979"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1863983">(</span><span class="op" id="1863984">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1863988"><a href="/runtime/sema.go.html#1932865">semacquire</a></span><span class="op" id="1863998">(</span><span class="op" id="1863999">&amp;</span><span class="ident" id="1864000"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021561">worldsema</a></span><span class="op" id="1864009">,</span>&nbsp;<span class="ident" id="1864011">false</span><span class="op" id="1864016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864020"><a href="/runtime/mprof.go.html#1863973">gp</a></span><span class="op" id="1864022">.</span><span class="ident" id="1864023">m</span><span class="op" id="1864024">.</span><span class="ident" id="1864025">gcing</span>&nbsp;<span class="op" id="1864031">=</span>&nbsp;<span class="num" id="1864033">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864037"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1864040">(</span><span class="ident" id="1864041"><a href="/runtime/stubs.go.html#1972761">stoptheworld</a></span><span class="op" id="1864053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864058"><a href="/runtime/mprof.go.html#1863914">n</a></span>&nbsp;<span class="op" id="1864060">=</span>&nbsp;<span class="ident" id="1864062"><a href="/runtime/debug.go.html#1752153">NumGoroutine</a></span><span class="op" id="1864074">(</span><span class="op" id="1864075">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864079">if</span>&nbsp;<span class="ident" id="1864082"><a href="/runtime/mprof.go.html#1863914">n</a></span>&nbsp;<span class="op" id="1864084">&lt;=</span>&nbsp;<span class="builtinfunc" id="1864087">len</span><span class="op" id="1864090">(</span><span class="ident" id="1864091"><a href="/runtime/mprof.go.html#1863896">p</a></span><span class="op" id="1864092">)</span>&nbsp;<span class="op" id="1864094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864099"><a href="/runtime/mprof.go.html#1863921">ok</a></span>&nbsp;<span class="op" id="1864102">=</span>&nbsp;<span class="ident" id="1864104">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864112">r</span>&nbsp;<span class="op" id="1864114">:=</span>&nbsp;<span class="ident" id="1864117"><a href="/runtime/mprof.go.html#1863896">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864122">sp</span>&nbsp;<span class="op" id="1864125">:=</span>&nbsp;<span class="ident" id="1864128"><a href="/runtime/stubs.go.html#1976425">getcallersp</a></span><span class="op" id="1864139">(</span><span class="ident" id="1864140"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1864146">.</span><span class="ident" id="1864147">Pointer</span><span class="op" id="1864154">(</span><span class="op" id="1864155">&amp;</span><span class="ident" id="1864156"><a href="/runtime/mprof.go.html#1863896">p</a></span><span class="op" id="1864157">)</span><span class="op" id="1864158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864163">pc</span>&nbsp;<span class="op" id="1864166">:=</span>&nbsp;<span class="ident" id="1864169"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1864180">(</span><span class="ident" id="1864181"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1864187">.</span><span class="ident" id="1864188">Pointer</span><span class="op" id="1864195">(</span><span class="op" id="1864196">&amp;</span><span class="ident" id="1864197"><a href="/runtime/mprof.go.html#1863896">p</a></span><span class="op" id="1864198">)</span><span class="op" id="1864199">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864204"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1864207">(</span><span class="keyword" id="1864208">func</span><span class="op" id="1864212">(</span><span class="op" id="1864213">)</span>&nbsp;<span class="op" id="1864215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864221"><a href="/runtime/mprof.go.html#1864526">saveg</a></span><span class="op" id="1864226">(</span><span class="ident" id="1864227"><a href="/runtime/mprof.go.html#1864163">pc</a></span><span class="op" id="1864229">,</span>&nbsp;<span class="ident" id="1864231"><a href="/runtime/mprof.go.html#1864122">sp</a></span><span class="op" id="1864233">,</span>&nbsp;<span class="ident" id="1864235"><a href="/runtime/mprof.go.html#1863973">gp</a></span><span class="op" id="1864237">,</span>&nbsp;<span class="op" id="1864239">&amp;</span><span class="ident" id="1864240"><a href="/runtime/mprof.go.html#1864112">r</a></span><span class="op" id="1864241">[</span><span class="num" id="1864242">0</span><span class="op" id="1864243">]</span><span class="op" id="1864244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864249">}</span><span class="op" id="1864250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864255"><a href="/runtime/mprof.go.html#1864112">r</a></span>&nbsp;<span class="op" id="1864257">=</span>&nbsp;<span class="ident" id="1864259"><a href="/runtime/mprof.go.html#1864112">r</a></span><span class="op" id="1864260">[</span><span class="num" id="1864261">1</span><span class="op" id="1864262">:</span><span class="op" id="1864263">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864268">for</span>&nbsp;<span class="ident" id="1864272">_</span><span class="op" id="1864273">,</span>&nbsp;<span class="ident" id="1864275">gp1</span>&nbsp;<span class="op" id="1864279">:=</span>&nbsp;<span class="keyword" id="1864282">range</span>&nbsp;<span class="ident" id="1864288"><a href="/runtime/mprof.go.html#1863497">allgs</a></span>&nbsp;<span class="op" id="1864294">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864300">if</span>&nbsp;<span class="ident" id="1864303"><a href="/runtime/mprof.go.html#1864275">gp1</a></span>&nbsp;<span class="op" id="1864307">==</span>&nbsp;<span class="ident" id="1864310"><a href="/runtime/mprof.go.html#1863973">gp</a></span>&nbsp;<span class="op" id="1864313">||</span>&nbsp;<span class="ident" id="1864316"><a href="/runtime/stubs.go.html#1968965">readgstatus</a></span><span class="op" id="1864327">(</span><span class="ident" id="1864328"><a href="/runtime/mprof.go.html#1864275">gp1</a></span><span class="op" id="1864331">)</span>&nbsp;<span class="op" id="1864333">==</span>&nbsp;<span class="ident" id="1864336"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2015849">_Gdead</a></span>&nbsp;<span class="op" id="1864343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864350">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864369"><a href="/runtime/mprof.go.html#1864526">saveg</a></span><span class="op" id="1864374">(</span><span class="op" id="1864375">^</span><span class="builtintype" id="1864376">uintptr</span><span class="op" id="1864383">(</span><span class="num" id="1864384">0</span><span class="op" id="1864385">)</span><span class="op" id="1864386">,</span>&nbsp;<span class="op" id="1864388">^</span><span class="builtintype" id="1864389">uintptr</span><span class="op" id="1864396">(</span><span class="num" id="1864397">0</span><span class="op" id="1864398">)</span><span class="op" id="1864399">,</span>&nbsp;<span class="ident" id="1864401"><a href="/runtime/mprof.go.html#1864275">gp1</a></span><span class="op" id="1864404">,</span>&nbsp;<span class="op" id="1864406">&amp;</span><span class="ident" id="1864407"><a href="/runtime/mprof.go.html#1864112">r</a></span><span class="op" id="1864408">[</span><span class="num" id="1864409">0</span><span class="op" id="1864410">]</span><span class="op" id="1864411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864417"><a href="/runtime/mprof.go.html#1864112">r</a></span>&nbsp;<span class="op" id="1864419">=</span>&nbsp;<span class="ident" id="1864421"><a href="/runtime/mprof.go.html#1864112">r</a></span><span class="op" id="1864422">[</span><span class="num" id="1864423">1</span><span class="op" id="1864424">:</span><span class="op" id="1864425">]</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864439"><a href="/runtime/mprof.go.html#1863973">gp</a></span><span class="op" id="1864441">.</span><span class="ident" id="1864442">m</span><span class="op" id="1864443">.</span><span class="ident" id="1864444">gcing</span>&nbsp;<span class="op" id="1864450">=</span>&nbsp;<span class="num" id="1864452">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864456"><a href="/runtime/sema.go.html#1933949">semrelease</a></span><span class="op" id="1864466">(</span><span class="op" id="1864467">&amp;</span><span class="ident" id="1864468"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021561">worldsema</a></span><span class="op" id="1864477">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864481"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1864484">(</span><span class="ident" id="1864485"><a href="/runtime/stubs.go.html#1972740">starttheworld</a></span><span class="op" id="1864498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864505">return</span>&nbsp;<span class="ident" id="1864512"><a href="/runtime/mprof.go.html#1863914">n</a></span><span class="op" id="1864513">,</span>&nbsp;<span class="ident" id="1864515"><a href="/runtime/mprof.go.html#1863921">ok</a></span><br>
<span class="lineno"></span><span class="op" id="1864518">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="keyword" id="1864521">func</span>&nbsp;<span class="ident" id="1864526">saveg</span><span class="op" id="1864531">(</span><span class="ident" id="1864532">pc</span><span class="op" id="1864534">,</span>&nbsp;<span class="ident" id="1864536">sp</span>&nbsp;<span class="builtintype" id="1864539">uintptr</span><span class="op" id="1864546">,</span>&nbsp;<span class="ident" id="1864548">gp</span>&nbsp;<span class="op" id="1864551">*</span><span class="ident" id="1864552"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1864553">,</span>&nbsp;<span class="ident" id="1864555">r</span>&nbsp;<span class="op" id="1864557">*</span><span class="ident" id="1864558"><a href="/runtime/mprof.go.html#1857592">StackRecord</a></span><span class="op" id="1864569">)</span>&nbsp;<span class="op" id="1864571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864574">n</span>&nbsp;<span class="op" id="1864576">:=</span>&nbsp;<span class="ident" id="1864579"><a href="/runtime/traceback.go.html#1996177">gentraceback</a></span><span class="op" id="1864591">(</span><span class="ident" id="1864592"><a href="/runtime/mprof.go.html#1864532">pc</a></span><span class="op" id="1864594">,</span>&nbsp;<span class="ident" id="1864596"><a href="/runtime/mprof.go.html#1864536">sp</a></span><span class="op" id="1864598">,</span>&nbsp;<span class="num" id="1864600">0</span><span class="op" id="1864601">,</span>&nbsp;<span class="ident" id="1864603"><a href="/runtime/mprof.go.html#1864548">gp</a></span><span class="op" id="1864605">,</span>&nbsp;<span class="num" id="1864607">0</span><span class="op" id="1864608">,</span>&nbsp;<span class="op" id="1864610">&amp;</span><span class="ident" id="1864611"><a href="/runtime/mprof.go.html#1864555">r</a></span><span class="op" id="1864612">.</span><span class="ident" id="1864613">Stack0</span><span class="op" id="1864619">[</span><span class="num" id="1864620">0</span><span class="op" id="1864621">]</span><span class="op" id="1864622">,</span>&nbsp;<span class="builtinfunc" id="1864624">len</span><span class="op" id="1864627">(</span><span class="ident" id="1864628"><a href="/runtime/mprof.go.html#1864555">r</a></span><span class="op" id="1864629">.</span><span class="ident" id="1864630">Stack0</span><span class="op" id="1864636">)</span><span class="op" id="1864637">,</span>&nbsp;<span class="ident" id="1864639">nil</span><span class="op" id="1864642">,</span>&nbsp;<span class="ident" id="1864644">nil</span><span class="op" id="1864647">,</span>&nbsp;<span class="num" id="1864649">0</span><span class="op" id="1864650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1864653">if</span>&nbsp;<span class="ident" id="1864656"><a href="/runtime/mprof.go.html#1864574">n</a></span>&nbsp;<span class="op" id="1864658">&lt;</span>&nbsp;<span class="builtinfunc" id="1864660">len</span><span class="op" id="1864663">(</span><span class="ident" id="1864664"><a href="/runtime/mprof.go.html#1864555">r</a></span><span class="op" id="1864665">.</span><span class="ident" id="1864666">Stack0</span><span class="op" id="1864672">)</span>&nbsp;<span class="op" id="1864674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864678"><a href="/runtime/mprof.go.html#1864555">r</a></span><span class="op" id="1864679">.</span><span class="ident" id="1864680">Stack0</span><span class="op" id="1864686">[</span><span class="ident" id="1864687"><a href="/runtime/mprof.go.html#1864574">n</a></span><span class="op" id="1864688">]</span>&nbsp;<span class="op" id="1864690">=</span>&nbsp;<span class="num" id="1864692">0</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1864695">}</span><br>
<span class="lineno"></span><span class="op" id="1864697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1864700">//&nbsp;Stack&nbsp;formats&nbsp;a&nbsp;stack&nbsp;trace&nbsp;of&nbsp;the&nbsp;calling&nbsp;goroutine&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span><span class="comment" id="1864765">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;buf.</span><br>
<span class="lineno">575</span><span class="comment" id="1864816">//&nbsp;If&nbsp;all&nbsp;is&nbsp;true,&nbsp;Stack&nbsp;formats&nbsp;stack&nbsp;traces&nbsp;of&nbsp;all&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="1864886">//&nbsp;into&nbsp;buf&nbsp;after&nbsp;the&nbsp;trace&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1864941">func</span>&nbsp;<span class="ident" id="1864946">Stack</span><span class="op" id="1864951">(</span><span class="ident" id="1864952">buf</span>&nbsp;<span class="op" id="1864956">[</span><span class="op" id="1864957">]</span><span class="builtintype" id="1864958">byte</span><span class="op" id="1864962">,</span>&nbsp;<span class="ident" id="1864964">all</span>&nbsp;<span class="builtintype" id="1864968">bool</span><span class="op" id="1864972">)</span>&nbsp;<span class="builtintype" id="1864974">int</span>&nbsp;<span class="op" id="1864978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864981">mp</span>&nbsp;<span class="op" id="1864984">:=</span>&nbsp;<span class="ident" id="1864987"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1864995">(</span><span class="op" id="1864996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1864999">gp</span>&nbsp;<span class="op" id="1865002">:=</span>&nbsp;<span class="ident" id="1865005"><a href="/runtime/mprof.go.html#1864981">mp</a></span><span class="op" id="1865007">.</span><span class="ident" id="1865008">curg</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865014">if</span>&nbsp;<span class="ident" id="1865017"><a href="/runtime/mprof.go.html#1864964">all</a></span>&nbsp;<span class="op" id="1865021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865025"><a href="/runtime/sema.go.html#1932865">semacquire</a></span><span class="op" id="1865035">(</span><span class="op" id="1865036">&amp;</span><span class="ident" id="1865037"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021561">worldsema</a></span><span class="op" id="1865046">,</span>&nbsp;<span class="ident" id="1865048">false</span><span class="op" id="1865053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865057"><a href="/runtime/mprof.go.html#1864981">mp</a></span><span class="op" id="1865059">.</span><span class="ident" id="1865060">gcing</span>&nbsp;<span class="op" id="1865066">=</span>&nbsp;<span class="num" id="1865068">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865072"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1865080">(</span><span class="ident" id="1865081"><a href="/runtime/mprof.go.html#1864981">mp</a></span><span class="op" id="1865083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865087"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1865090">(</span><span class="ident" id="1865091"><a href="/runtime/stubs.go.html#1972761">stoptheworld</a></span><span class="op" id="1865103">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865107">if</span>&nbsp;<span class="ident" id="1865110"><a href="/runtime/mprof.go.html#1864981">mp</a></span>&nbsp;<span class="op" id="1865113">!=</span>&nbsp;<span class="ident" id="1865116"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1865124">(</span><span class="op" id="1865125">)</span>&nbsp;<span class="op" id="1865127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865132"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1865139">(</span><span class="string" id="1865140">&#34;Stack:&nbsp;rescheduled&#34;</span><span class="op" id="1865160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865171">n</span>&nbsp;<span class="op" id="1865173">:=</span>&nbsp;<span class="num" id="1865176">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865179">if</span>&nbsp;<span class="builtinfunc" id="1865182">len</span><span class="op" id="1865185">(</span><span class="ident" id="1865186"><a href="/runtime/mprof.go.html#1864952">buf</a></span><span class="op" id="1865189">)</span>&nbsp;<span class="op" id="1865191">&gt;</span>&nbsp;<span class="num" id="1865193">0</span>&nbsp;<span class="op" id="1865195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865199">sp</span>&nbsp;<span class="op" id="1865202">:=</span>&nbsp;<span class="ident" id="1865205"><a href="/runtime/stubs.go.html#1976425">getcallersp</a></span><span class="op" id="1865216">(</span><span class="ident" id="1865217"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1865223">.</span><span class="ident" id="1865224">Pointer</span><span class="op" id="1865231">(</span><span class="op" id="1865232">&amp;</span><span class="ident" id="1865233"><a href="/runtime/mprof.go.html#1864952">buf</a></span><span class="op" id="1865236">)</span><span class="op" id="1865237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865241">pc</span>&nbsp;<span class="op" id="1865244">:=</span>&nbsp;<span class="ident" id="1865247"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1865258">(</span><span class="ident" id="1865259"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1865265">.</span><span class="ident" id="1865266">Pointer</span><span class="op" id="1865273">(</span><span class="op" id="1865274">&amp;</span><span class="ident" id="1865275"><a href="/runtime/mprof.go.html#1864952">buf</a></span><span class="op" id="1865278">)</span><span class="op" id="1865279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865283"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1865286">(</span><span class="keyword" id="1865287">func</span><span class="op" id="1865291">(</span><span class="op" id="1865292">)</span>&nbsp;<span class="op" id="1865294">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865299">g0</span>&nbsp;<span class="op" id="1865302">:=</span>&nbsp;<span class="ident" id="1865305"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1865309">(</span><span class="op" id="1865310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865315"><a href="/runtime/mprof.go.html#1865299">g0</a></span><span class="op" id="1865317">.</span><span class="ident" id="1865318">writebuf</span>&nbsp;<span class="op" id="1865327">=</span>&nbsp;<span class="ident" id="1865329"><a href="/runtime/mprof.go.html#1864952">buf</a></span><span class="op" id="1865332">[</span><span class="num" id="1865333">0</span><span class="op" id="1865334">:</span><span class="num" id="1865335">0</span><span class="op" id="1865336">:</span><span class="builtinfunc" id="1865337">len</span><span class="op" id="1865340">(</span><span class="ident" id="1865341"><a href="/runtime/mprof.go.html#1864952">buf</a></span><span class="op" id="1865344">)</span><span class="op" id="1865345">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865350"><a href="/runtime/traceback.go.html#2012257">goroutineheader</a></span><span class="op" id="1865365">(</span><span class="ident" id="1865366"><a href="/runtime/mprof.go.html#1864999">gp</a></span><span class="op" id="1865368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865373"><a href="/runtime/traceback.go.html#2009235">traceback</a></span><span class="op" id="1865382">(</span><span class="ident" id="1865383"><a href="/runtime/mprof.go.html#1865241">pc</a></span><span class="op" id="1865385">,</span>&nbsp;<span class="ident" id="1865387"><a href="/runtime/mprof.go.html#1865199">sp</a></span><span class="op" id="1865389">,</span>&nbsp;<span class="num" id="1865391">0</span><span class="op" id="1865392">,</span>&nbsp;<span class="ident" id="1865394"><a href="/runtime/mprof.go.html#1864999">gp</a></span><span class="op" id="1865396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865401">if</span>&nbsp;<span class="ident" id="1865404"><a href="/runtime/mprof.go.html#1864964">all</a></span>&nbsp;<span class="op" id="1865408">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865414"><a href="/runtime/traceback.go.html#2013175">tracebackothers</a></span><span class="op" id="1865429">(</span><span class="ident" id="1865430"><a href="/runtime/mprof.go.html#1864999">gp</a></span><span class="op" id="1865432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865442"><a href="/runtime/mprof.go.html#1865171">n</a></span>&nbsp;<span class="op" id="1865444">=</span>&nbsp;<span class="builtinfunc" id="1865446">len</span><span class="op" id="1865449">(</span><span class="ident" id="1865450"><a href="/runtime/mprof.go.html#1865299">g0</a></span><span class="op" id="1865452">.</span><span class="ident" id="1865453">writebuf</span><span class="op" id="1865461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865466"><a href="/runtime/mprof.go.html#1865299">g0</a></span><span class="op" id="1865468">.</span><span class="ident" id="1865469">writebuf</span>&nbsp;<span class="op" id="1865478">=</span>&nbsp;<span class="ident" id="1865480">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865486">}</span><span class="op" id="1865487">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865494">if</span>&nbsp;<span class="ident" id="1865497"><a href="/runtime/mprof.go.html#1864964">all</a></span>&nbsp;<span class="op" id="1865501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865505"><a href="/runtime/mprof.go.html#1864981">mp</a></span><span class="op" id="1865507">.</span><span class="ident" id="1865508">gcing</span>&nbsp;<span class="op" id="1865514">=</span>&nbsp;<span class="num" id="1865516">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865520"><a href="/runtime/sema.go.html#1933949">semrelease</a></span><span class="op" id="1865530">(</span><span class="op" id="1865531">&amp;</span><span class="ident" id="1865532"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021561">worldsema</a></span><span class="op" id="1865541">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865545"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1865548">(</span><span class="ident" id="1865549"><a href="/runtime/stubs.go.html#1972740">starttheworld</a></span><span class="op" id="1865562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865568"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1865576">(</span><span class="ident" id="1865577"><a href="/runtime/mprof.go.html#1864981">mp</a></span><span class="op" id="1865579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865582">return</span>&nbsp;<span class="ident" id="1865589"><a href="/runtime/mprof.go.html#1865171">n</a></span><br>
<span class="lineno"></span><span class="op" id="1865591">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="comment" id="1865594">//&nbsp;Tracing&nbsp;of&nbsp;alloc/free/gc.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1865624">var</span>&nbsp;<span class="ident" id="1865628">tracelock</span>&nbsp;<span class="ident" id="1865638"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016175">mutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span><span class="keyword" id="1865645">func</span>&nbsp;<span class="ident" id="1865650">tracealloc</span><span class="op" id="1865660">(</span><span class="ident" id="1865661">p</span>&nbsp;<span class="ident" id="1865663"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1865669">.</span><span class="ident" id="1865670">Pointer</span><span class="op" id="1865677">,</span>&nbsp;<span class="ident" id="1865679">size</span>&nbsp;<span class="builtintype" id="1865684">uintptr</span><span class="op" id="1865691">,</span>&nbsp;<span class="ident" id="1865693">typ</span>&nbsp;<span class="op" id="1865697">*</span><span class="ident" id="1865698"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025572">_type</a></span><span class="op" id="1865703">)</span>&nbsp;<span class="op" id="1865705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865708"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1865712">(</span><span class="op" id="1865713">&amp;</span><span class="ident" id="1865714"><a href="/runtime/mprof.go.html#1865628">tracelock</a></span><span class="op" id="1865723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865726">gp</span>&nbsp;<span class="op" id="1865729">:=</span>&nbsp;<span class="ident" id="1865732"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1865736">(</span><span class="op" id="1865737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865740"><a href="/runtime/mprof.go.html#1865726">gp</a></span><span class="op" id="1865742">.</span><span class="ident" id="1865743">m</span><span class="op" id="1865744">.</span><span class="ident" id="1865745">traceback</span>&nbsp;<span class="op" id="1865755">=</span>&nbsp;<span class="num" id="1865757">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865760">if</span>&nbsp;<span class="ident" id="1865763"><a href="/runtime/mprof.go.html#1865693">typ</a></span>&nbsp;<span class="op" id="1865767">==</span>&nbsp;<span class="ident" id="1865770">nil</span>&nbsp;<span class="op" id="1865774">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1865778">print</span><span class="op" id="1865783">(</span><span class="string" id="1865784">&#34;tracealloc(&#34;</span><span class="op" id="1865797">,</span>&nbsp;<span class="ident" id="1865799"><a href="/runtime/mprof.go.html#1865661">p</a></span><span class="op" id="1865800">,</span>&nbsp;<span class="string" id="1865802">&#34;,&nbsp;&#34;</span><span class="op" id="1865806">,</span>&nbsp;<span class="ident" id="1865808"><a href="/runtime/print1.go.html#1894784">hex</a></span><span class="op" id="1865811">(</span><span class="ident" id="1865812"><a href="/runtime/mprof.go.html#1865679">size</a></span><span class="op" id="1865816">)</span><span class="op" id="1865817">,</span>&nbsp;<span class="string" id="1865819">&#34;)\n&#34;</span><span class="op" id="1865824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865827">}</span>&nbsp;<span class="keyword" id="1865829">else</span>&nbsp;<span class="op" id="1865834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1865838">print</span><span class="op" id="1865843">(</span><span class="string" id="1865844">&#34;tracealloc(&#34;</span><span class="op" id="1865857">,</span>&nbsp;<span class="ident" id="1865859"><a href="/runtime/mprof.go.html#1865661">p</a></span><span class="op" id="1865860">,</span>&nbsp;<span class="string" id="1865862">&#34;,&nbsp;&#34;</span><span class="op" id="1865866">,</span>&nbsp;<span class="ident" id="1865868"><a href="/runtime/print1.go.html#1894784">hex</a></span><span class="op" id="1865871">(</span><span class="ident" id="1865872"><a href="/runtime/mprof.go.html#1865679">size</a></span><span class="op" id="1865876">)</span><span class="op" id="1865877">,</span>&nbsp;<span class="string" id="1865879">&#34;,&nbsp;&#34;</span><span class="op" id="1865883">,</span>&nbsp;<span class="op" id="1865885">*</span><span class="ident" id="1865886"><a href="/runtime/mprof.go.html#1865693">typ</a></span><span class="op" id="1865889">.</span><span class="ident" id="1865890">_string</span><span class="op" id="1865897">,</span>&nbsp;<span class="string" id="1865899">&#34;)\n&#34;</span><span class="op" id="1865904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1865907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1865910">if</span>&nbsp;<span class="ident" id="1865913"><a href="/runtime/mprof.go.html#1865726">gp</a></span><span class="op" id="1865915">.</span><span class="ident" id="1865916">m</span><span class="op" id="1865917">.</span><span class="ident" id="1865918">curg</span>&nbsp;<span class="op" id="1865923">==</span>&nbsp;<span class="ident" id="1865926">nil</span>&nbsp;<span class="op" id="1865930">||</span>&nbsp;<span class="ident" id="1865933"><a href="/runtime/mprof.go.html#1865726">gp</a></span>&nbsp;<span class="op" id="1865936">==</span>&nbsp;<span class="ident" id="1865939"><a href="/runtime/mprof.go.html#1865726">gp</a></span><span class="op" id="1865941">.</span><span class="ident" id="1865942">m</span><span class="op" id="1865943">.</span><span class="ident" id="1865944">curg</span>&nbsp;<span class="op" id="1865949">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865953"><a href="/runtime/traceback.go.html#2012257">goroutineheader</a></span><span class="op" id="1865968">(</span><span class="ident" id="1865969"><a href="/runtime/mprof.go.html#1865726">gp</a></span><span class="op" id="1865971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1865975">pc</span>&nbsp;<span class="op" id="1865978">:=</span>&nbsp;<span class="ident" id="1865981"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1865992">(</span><span class="ident" id="1865993"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1865999">.</span><span class="ident" id="1866000">Pointer</span><span class="op" id="1866007">(</span><span class="op" id="1866008">&amp;</span><span class="ident" id="1866009"><a href="/runtime/mprof.go.html#1865661">p</a></span><span class="op" id="1866010">)</span><span class="op" id="1866011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866015">sp</span>&nbsp;<span class="op" id="1866018">:=</span>&nbsp;<span class="ident" id="1866021"><a href="/runtime/stubs.go.html#1976425">getcallersp</a></span><span class="op" id="1866032">(</span><span class="ident" id="1866033"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1866039">.</span><span class="ident" id="1866040">Pointer</span><span class="op" id="1866047">(</span><span class="op" id="1866048">&amp;</span><span class="ident" id="1866049"><a href="/runtime/mprof.go.html#1865661">p</a></span><span class="op" id="1866050">)</span><span class="op" id="1866051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866055"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1866058">(</span><span class="keyword" id="1866059">func</span><span class="op" id="1866063">(</span><span class="op" id="1866064">)</span>&nbsp;<span class="op" id="1866066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866071"><a href="/runtime/traceback.go.html#2009235">traceback</a></span><span class="op" id="1866080">(</span><span class="ident" id="1866081"><a href="/runtime/mprof.go.html#1865975">pc</a></span><span class="op" id="1866083">,</span>&nbsp;<span class="ident" id="1866085"><a href="/runtime/mprof.go.html#1866015">sp</a></span><span class="op" id="1866087">,</span>&nbsp;<span class="num" id="1866089">0</span><span class="op" id="1866090">,</span>&nbsp;<span class="ident" id="1866092"><a href="/runtime/mprof.go.html#1865726">gp</a></span><span class="op" id="1866094">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1866098">}</span><span class="op" id="1866099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1866102">}</span>&nbsp;<span class="keyword" id="1866104">else</span>&nbsp;<span class="op" id="1866109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866113"><a href="/runtime/traceback.go.html#2012257">goroutineheader</a></span><span class="op" id="1866128">(</span><span class="ident" id="1866129"><a href="/runtime/mprof.go.html#1865726">gp</a></span><span class="op" id="1866131">.</span><span class="ident" id="1866132">m</span><span class="op" id="1866133">.</span><span class="ident" id="1866134">curg</span><span class="op" id="1866138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866142"><a href="/runtime/traceback.go.html#2009235">traceback</a></span><span class="op" id="1866151">(</span><span class="op" id="1866152">^</span><span class="builtintype" id="1866153">uintptr</span><span class="op" id="1866160">(</span><span class="num" id="1866161">0</span><span class="op" id="1866162">)</span><span class="op" id="1866163">,</span>&nbsp;<span class="op" id="1866165">^</span><span class="builtintype" id="1866166">uintptr</span><span class="op" id="1866173">(</span><span class="num" id="1866174">0</span><span class="op" id="1866175">)</span><span class="op" id="1866176">,</span>&nbsp;<span class="num" id="1866178">0</span><span class="op" id="1866179">,</span>&nbsp;<span class="ident" id="1866181"><a href="/runtime/mprof.go.html#1865726">gp</a></span><span class="op" id="1866183">.</span><span class="ident" id="1866184">m</span><span class="op" id="1866185">.</span><span class="ident" id="1866186">curg</span><span class="op" id="1866190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1866193">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1866196">print</span><span class="op" id="1866201">(</span><span class="string" id="1866202">&#34;\n&#34;</span><span class="op" id="1866206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866209"><a href="/runtime/mprof.go.html#1865726">gp</a></span><span class="op" id="1866211">.</span><span class="ident" id="1866212">m</span><span class="op" id="1866213">.</span><span class="ident" id="1866214">traceback</span>&nbsp;<span class="op" id="1866224">=</span>&nbsp;<span class="num" id="1866226">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866229"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1866235">(</span><span class="op" id="1866236">&amp;</span><span class="ident" id="1866237"><a href="/runtime/mprof.go.html#1865628">tracelock</a></span><span class="op" id="1866246">)</span><br>
<span class="lineno"></span><span class="op" id="1866248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span><span class="keyword" id="1866251">func</span>&nbsp;<span class="ident" id="1866256">tracefree</span><span class="op" id="1866265">(</span><span class="ident" id="1866266">p</span>&nbsp;<span class="ident" id="1866268"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1866274">.</span><span class="ident" id="1866275">Pointer</span><span class="op" id="1866282">,</span>&nbsp;<span class="ident" id="1866284">size</span>&nbsp;<span class="builtintype" id="1866289">uintptr</span><span class="op" id="1866296">)</span>&nbsp;<span class="op" id="1866298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866301"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1866305">(</span><span class="op" id="1866306">&amp;</span><span class="ident" id="1866307"><a href="/runtime/mprof.go.html#1865628">tracelock</a></span><span class="op" id="1866316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866319">gp</span>&nbsp;<span class="op" id="1866322">:=</span>&nbsp;<span class="ident" id="1866325"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1866329">(</span><span class="op" id="1866330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866333"><a href="/runtime/mprof.go.html#1866319">gp</a></span><span class="op" id="1866335">.</span><span class="ident" id="1866336">m</span><span class="op" id="1866337">.</span><span class="ident" id="1866338">traceback</span>&nbsp;<span class="op" id="1866348">=</span>&nbsp;<span class="num" id="1866350">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1866353">print</span><span class="op" id="1866358">(</span><span class="string" id="1866359">&#34;tracefree(&#34;</span><span class="op" id="1866371">,</span>&nbsp;<span class="ident" id="1866373"><a href="/runtime/mprof.go.html#1866266">p</a></span><span class="op" id="1866374">,</span>&nbsp;<span class="string" id="1866376">&#34;,&nbsp;&#34;</span><span class="op" id="1866380">,</span>&nbsp;<span class="ident" id="1866382"><a href="/runtime/print1.go.html#1894784">hex</a></span><span class="op" id="1866385">(</span><span class="ident" id="1866386"><a href="/runtime/mprof.go.html#1866284">size</a></span><span class="op" id="1866390">)</span><span class="op" id="1866391">,</span>&nbsp;<span class="string" id="1866393">&#34;)\n&#34;</span><span class="op" id="1866398">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866401"><a href="/runtime/traceback.go.html#2012257">goroutineheader</a></span><span class="op" id="1866416">(</span><span class="ident" id="1866417"><a href="/runtime/mprof.go.html#1866319">gp</a></span><span class="op" id="1866419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866422">pc</span>&nbsp;<span class="op" id="1866425">:=</span>&nbsp;<span class="ident" id="1866428"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1866439">(</span><span class="ident" id="1866440"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1866446">.</span><span class="ident" id="1866447">Pointer</span><span class="op" id="1866454">(</span><span class="op" id="1866455">&amp;</span><span class="ident" id="1866456"><a href="/runtime/mprof.go.html#1866266">p</a></span><span class="op" id="1866457">)</span><span class="op" id="1866458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866461">sp</span>&nbsp;<span class="op" id="1866464">:=</span>&nbsp;<span class="ident" id="1866467"><a href="/runtime/stubs.go.html#1976425">getcallersp</a></span><span class="op" id="1866478">(</span><span class="ident" id="1866479"><a href="/runtime/mprof.go.html#1849567">unsafe</a></span><span class="op" id="1866485">.</span><span class="ident" id="1866486">Pointer</span><span class="op" id="1866493">(</span><span class="op" id="1866494">&amp;</span><span class="ident" id="1866495"><a href="/runtime/mprof.go.html#1866266">p</a></span><span class="op" id="1866496">)</span><span class="op" id="1866497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866500"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1866503">(</span><span class="keyword" id="1866504">func</span><span class="op" id="1866508">(</span><span class="op" id="1866509">)</span>&nbsp;<span class="op" id="1866511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866515"><a href="/runtime/traceback.go.html#2009235">traceback</a></span><span class="op" id="1866524">(</span><span class="ident" id="1866525"><a href="/runtime/mprof.go.html#1866422">pc</a></span><span class="op" id="1866527">,</span>&nbsp;<span class="ident" id="1866529"><a href="/runtime/mprof.go.html#1866461">sp</a></span><span class="op" id="1866531">,</span>&nbsp;<span class="num" id="1866533">0</span><span class="op" id="1866534">,</span>&nbsp;<span class="ident" id="1866536"><a href="/runtime/mprof.go.html#1866319">gp</a></span><span class="op" id="1866538">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1866541">}</span><span class="op" id="1866542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1866545">print</span><span class="op" id="1866550">(</span><span class="string" id="1866551">&#34;\n&#34;</span><span class="op" id="1866555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866558"><a href="/runtime/mprof.go.html#1866319">gp</a></span><span class="op" id="1866560">.</span><span class="ident" id="1866561">m</span><span class="op" id="1866562">.</span><span class="ident" id="1866563">traceback</span>&nbsp;<span class="op" id="1866573">=</span>&nbsp;<span class="num" id="1866575">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866578"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1866584">(</span><span class="op" id="1866585">&amp;</span><span class="ident" id="1866586"><a href="/runtime/mprof.go.html#1865628">tracelock</a></span><span class="op" id="1866595">)</span><br>
<span class="lineno"></span><span class="op" id="1866597">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="keyword" id="1866600">func</span>&nbsp;<span class="ident" id="1866605">tracegc</span><span class="op" id="1866612">(</span><span class="op" id="1866613">)</span>&nbsp;<span class="op" id="1866615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866618"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1866622">(</span><span class="op" id="1866623">&amp;</span><span class="ident" id="1866624"><a href="/runtime/mprof.go.html#1865628">tracelock</a></span><span class="op" id="1866633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866636">gp</span>&nbsp;<span class="op" id="1866639">:=</span>&nbsp;<span class="ident" id="1866642"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1866646">(</span><span class="op" id="1866647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866650"><a href="/runtime/mprof.go.html#1866636">gp</a></span><span class="op" id="1866652">.</span><span class="ident" id="1866653">m</span><span class="op" id="1866654">.</span><span class="ident" id="1866655">traceback</span>&nbsp;<span class="op" id="1866665">=</span>&nbsp;<span class="num" id="1866667">2</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1866670">print</span><span class="op" id="1866675">(</span><span class="string" id="1866676">&#34;tracegc()\n&#34;</span><span class="op" id="1866689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1866692">//&nbsp;running&nbsp;on&nbsp;m-&gt;g0&nbsp;stack;&nbsp;show&nbsp;all&nbsp;non-g0&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866747"><a href="/runtime/traceback.go.html#2013175">tracebackothers</a></span><span class="op" id="1866762">(</span><span class="ident" id="1866763"><a href="/runtime/mprof.go.html#1866636">gp</a></span><span class="op" id="1866765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1866768">print</span><span class="op" id="1866773">(</span><span class="string" id="1866774">&#34;end&nbsp;tracegc\n&#34;</span><span class="op" id="1866789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1866792">print</span><span class="op" id="1866797">(</span><span class="string" id="1866798">&#34;\n&#34;</span><span class="op" id="1866802">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866805"><a href="/runtime/mprof.go.html#1866636">gp</a></span><span class="op" id="1866807">.</span><span class="ident" id="1866808">m</span><span class="op" id="1866809">.</span><span class="ident" id="1866810">traceback</span>&nbsp;<span class="op" id="1866820">=</span>&nbsp;<span class="num" id="1866822">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1866825"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1866831">(</span><span class="op" id="1866832">&amp;</span><span class="ident" id="1866833"><a href="/runtime/mprof.go.html#1865628">tracelock</a></span><span class="op" id="1866842">)</span><br>
<span class="lineno"></span><span class="op" id="1866844">}</span>
</div>
</body>
</html>
