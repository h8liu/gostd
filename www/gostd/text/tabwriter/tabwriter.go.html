<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/tabwriter</h2>
<ul>
<li><a href="/gostd/text/tabwriter/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter.go.html">tabwriter.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter_test.go.html">tabwriter_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5398657">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5398712">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5398766">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5398817">//&nbsp;Package&nbsp;tabwriter&nbsp;implements&nbsp;a&nbsp;write&nbsp;filter&nbsp;(tabwriter.Writer)&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5398888">//&nbsp;translates&nbsp;tabbed&nbsp;columns&nbsp;in&nbsp;input&nbsp;into&nbsp;properly&nbsp;aligned&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5398954">//</span><br>
<span class="lineno"></span><span class="comment" id="5398957">//&nbsp;The&nbsp;package&nbsp;is&nbsp;using&nbsp;the&nbsp;Elastic&nbsp;Tabstops&nbsp;algorithm&nbsp;described&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5399025">//&nbsp;http://nickgravgaard.com/elastictabstops/index.html.</span><br>
<span class="lineno">10</span><span class="comment" id="5399081">//</span><br>
<span class="lineno"></span><span class="keyword" id="5399084">package</span>&nbsp;<span class="ident" id="5399092">tabwriter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5399103">import</span>&nbsp;<span class="op" id="5399110">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5399113">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5399122">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5399128">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5399143">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5399146">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">20</span><span class="comment" id="5399226">//&nbsp;Filter&nbsp;implementation</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5399252">//&nbsp;A&nbsp;cell&nbsp;represents&nbsp;a&nbsp;segment&nbsp;of&nbsp;text&nbsp;terminated&nbsp;by&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks.</span><br>
<span class="lineno"></span><span class="comment" id="5399326">//&nbsp;The&nbsp;text&nbsp;itself&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;separate&nbsp;buffer;&nbsp;cell&nbsp;only&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5399401">//&nbsp;segment&#39;s&nbsp;size&nbsp;in&nbsp;bytes,&nbsp;its&nbsp;width&nbsp;in&nbsp;runes,&nbsp;and&nbsp;whether&nbsp;it&#39;s&nbsp;an&nbsp;htab</span><br>
<span class="lineno">25</span><span class="comment" id="5399474">//&nbsp;(&#39;\t&#39;)&nbsp;terminated&nbsp;cell.</span><br>
<span class="lineno"></span><span class="comment" id="5399501">//</span><br>
<span class="lineno"></span><span class="keyword" id="5399504">type</span>&nbsp;<span class="ident" id="5399509">cell</span>&nbsp;<span class="keyword" id="5399514">struct</span>&nbsp;<span class="op" id="5399521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399524">size</span>&nbsp;&nbsp;<span class="builtintype" id="5399530">int</span>&nbsp;&nbsp;<span class="comment" id="5399535">//&nbsp;cell&nbsp;size&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399558">width</span>&nbsp;<span class="builtintype" id="5399564">int</span>&nbsp;&nbsp;<span class="comment" id="5399569">//&nbsp;cell&nbsp;width&nbsp;in&nbsp;runes</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399593">htab</span>&nbsp;&nbsp;<span class="builtintype" id="5399599">bool</span>&nbsp;<span class="comment" id="5399604">//&nbsp;true&nbsp;if&nbsp;the&nbsp;cell&nbsp;is&nbsp;terminated&nbsp;by&nbsp;an&nbsp;htab&nbsp;(&#39;\t&#39;)</span><br>
<span class="lineno"></span><span class="op" id="5399656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5399659">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;filter&nbsp;that&nbsp;inserts&nbsp;padding&nbsp;around&nbsp;tab-delimited</span><br>
<span class="lineno"></span><span class="comment" id="5399725">//&nbsp;columns&nbsp;in&nbsp;its&nbsp;input&nbsp;to&nbsp;align&nbsp;them&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno">35</span><span class="comment" id="5399778">//</span><br>
<span class="lineno"></span><span class="comment" id="5399781">//&nbsp;The&nbsp;Writer&nbsp;treats&nbsp;incoming&nbsp;bytes&nbsp;as&nbsp;UTF-8&nbsp;encoded&nbsp;text&nbsp;consisting</span><br>
<span class="lineno"></span><span class="comment" id="5399850">//&nbsp;of&nbsp;cells&nbsp;terminated&nbsp;by&nbsp;(horizontal&nbsp;or&nbsp;vertical)&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5399914">//&nbsp;breaks&nbsp;(newline&nbsp;or&nbsp;formfeed&nbsp;characters).&nbsp;Cells&nbsp;in&nbsp;adjacent&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="5399982">//&nbsp;constitute&nbsp;a&nbsp;column.&nbsp;The&nbsp;Writer&nbsp;inserts&nbsp;padding&nbsp;as&nbsp;needed&nbsp;to</span><br>
<span class="lineno">40</span><span class="comment" id="5400046">//&nbsp;make&nbsp;all&nbsp;cells&nbsp;in&nbsp;a&nbsp;column&nbsp;have&nbsp;the&nbsp;same&nbsp;width,&nbsp;effectively</span><br>
<span class="lineno"></span><span class="comment" id="5400109">//&nbsp;aligning&nbsp;the&nbsp;columns.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;all&nbsp;characters&nbsp;have&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5400174">//&nbsp;same&nbsp;width&nbsp;except&nbsp;for&nbsp;tabs&nbsp;for&nbsp;which&nbsp;a&nbsp;tabwidth&nbsp;must&nbsp;be&nbsp;specified.</span><br>
<span class="lineno"></span><span class="comment" id="5400244">//&nbsp;Note&nbsp;that&nbsp;cells&nbsp;are&nbsp;tab-terminated,&nbsp;not&nbsp;tab-separated:&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="5400311">//&nbsp;non-tab&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;does&nbsp;not&nbsp;form&nbsp;a&nbsp;column&nbsp;cell.</span><br>
<span class="lineno">45</span><span class="comment" id="5400377">//</span><br>
<span class="lineno"></span><span class="comment" id="5400380">//&nbsp;The&nbsp;Writer&nbsp;assumes&nbsp;that&nbsp;all&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;have&nbsp;the&nbsp;same&nbsp;width;</span><br>
<span class="lineno"></span><span class="comment" id="5400452">//&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;true&nbsp;in&nbsp;some&nbsp;fonts.</span><br>
<span class="lineno"></span><span class="comment" id="5400491">//</span><br>
<span class="lineno"></span><span class="comment" id="5400494">//&nbsp;If&nbsp;DiscardEmptyColumns&nbsp;is&nbsp;set,&nbsp;empty&nbsp;columns&nbsp;that&nbsp;are&nbsp;terminated</span><br>
<span class="lineno">50</span><span class="comment" id="5400562">//&nbsp;entirely&nbsp;by&nbsp;vertical&nbsp;(or&nbsp;&#34;soft&#34;)&nbsp;tabs&nbsp;are&nbsp;discarded.&nbsp;Columns</span><br>
<span class="lineno"></span><span class="comment" id="5400626">//&nbsp;terminated&nbsp;by&nbsp;horizontal&nbsp;(or&nbsp;&#34;hard&#34;)&nbsp;tabs&nbsp;are&nbsp;not&nbsp;affected&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5400691">//&nbsp;this&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="5400705">//</span><br>
<span class="lineno"></span><span class="comment" id="5400708">//&nbsp;If&nbsp;a&nbsp;Writer&nbsp;is&nbsp;configured&nbsp;to&nbsp;filter&nbsp;HTML,&nbsp;HTML&nbsp;tags&nbsp;and&nbsp;entities</span><br>
<span class="lineno">55</span><span class="comment" id="5400776">//&nbsp;are&nbsp;passed&nbsp;through.&nbsp;The&nbsp;widths&nbsp;of&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5400835">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;(tags)&nbsp;and&nbsp;one&nbsp;(entities)&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5400908">//</span><br>
<span class="lineno"></span><span class="comment" id="5400911">//&nbsp;A&nbsp;segment&nbsp;of&nbsp;text&nbsp;may&nbsp;be&nbsp;escaped&nbsp;by&nbsp;bracketing&nbsp;it&nbsp;with&nbsp;Escape</span><br>
<span class="lineno"></span><span class="comment" id="5400976">//&nbsp;characters.&nbsp;The&nbsp;tabwriter&nbsp;passes&nbsp;escaped&nbsp;text&nbsp;segments&nbsp;through</span><br>
<span class="lineno">60</span><span class="comment" id="5401042">//&nbsp;unchanged.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;does&nbsp;not&nbsp;interpret&nbsp;any&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5401110">//&nbsp;breaks&nbsp;within&nbsp;the&nbsp;segment.&nbsp;If&nbsp;the&nbsp;StripEscape&nbsp;flag&nbsp;is&nbsp;set,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5401176">//&nbsp;Escape&nbsp;characters&nbsp;are&nbsp;stripped&nbsp;from&nbsp;the&nbsp;output;&nbsp;otherwise&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5401242">//&nbsp;are&nbsp;passed&nbsp;through&nbsp;as&nbsp;well.&nbsp;For&nbsp;the&nbsp;purpose&nbsp;of&nbsp;formatting,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5401308">//&nbsp;width&nbsp;of&nbsp;the&nbsp;escaped&nbsp;text&nbsp;is&nbsp;always&nbsp;computed&nbsp;excluding&nbsp;the&nbsp;Escape</span><br>
<span class="lineno">65</span><span class="comment" id="5401377">//&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="5401392">//</span><br>
<span class="lineno"></span><span class="comment" id="5401395">//&nbsp;The&nbsp;formfeed&nbsp;character&nbsp;(&#39;\f&#39;)&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline&nbsp;but&nbsp;it&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="5401460">//&nbsp;terminates&nbsp;all&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;line&nbsp;(effectively&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="5401527">//&nbsp;Flush).&nbsp;Cells&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;start&nbsp;new&nbsp;columns.&nbsp;Unless&nbsp;found</span><br>
<span class="lineno">70</span><span class="comment" id="5401593">//&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag&nbsp;or&nbsp;inside&nbsp;an&nbsp;escaped&nbsp;text&nbsp;segment,&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="5401659">//&nbsp;characters&nbsp;appear&nbsp;as&nbsp;newlines&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5401707">//</span><br>
<span class="lineno"></span><span class="comment" id="5401710">//&nbsp;The&nbsp;Writer&nbsp;must&nbsp;buffer&nbsp;input&nbsp;internally,&nbsp;because&nbsp;proper&nbsp;spacing</span><br>
<span class="lineno"></span><span class="comment" id="5401777">//&nbsp;of&nbsp;one&nbsp;line&nbsp;may&nbsp;depend&nbsp;on&nbsp;the&nbsp;cells&nbsp;in&nbsp;future&nbsp;lines.&nbsp;Clients&nbsp;must</span><br>
<span class="lineno">75</span><span class="comment" id="5401846">//&nbsp;call&nbsp;Flush&nbsp;when&nbsp;done&nbsp;calling&nbsp;Write.</span><br>
<span class="lineno"></span><span class="comment" id="5401885">//</span><br>
<span class="lineno"></span><span class="keyword" id="5401888">type</span>&nbsp;<span class="ident" id="5401893">Writer</span>&nbsp;<span class="keyword" id="5401900">struct</span>&nbsp;<span class="op" id="5401907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5401910">//&nbsp;configuration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401928">output</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5401937">io</span><span class="op" id="5401939">.</span><span class="ident" id="5401940">Writer</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401948">minwidth</span>&nbsp;<span class="builtintype" id="5401957">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401962">tabwidth</span>&nbsp;<span class="builtintype" id="5401971">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401976">padding</span>&nbsp;&nbsp;<span class="builtintype" id="5401985">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401990">padbytes</span>&nbsp;<span class="op" id="5401999">[</span><span class="num" id="5402000">8</span><span class="op" id="5402001">]</span><span class="builtintype" id="5402002">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402008">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5402017">uint</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5402024">//&nbsp;current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402042">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5402050">bytes</span><span class="op" id="5402055">.</span><span class="ident" id="5402056">Buffer</span>&nbsp;<span class="comment" id="5402063">//&nbsp;collected&nbsp;text&nbsp;excluding&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402112">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5402120">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5402133">//&nbsp;buffer&nbsp;position&nbsp;up&nbsp;to&nbsp;which&nbsp;cell.width&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;has&nbsp;been&nbsp;computed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402213">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5402221">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5402234">//&nbsp;current&nbsp;incomplete&nbsp;cell;&nbsp;cell.width&nbsp;is&nbsp;up&nbsp;to&nbsp;buf[pos]&nbsp;excluding&nbsp;ignored&nbsp;sections</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402319">endChar</span>&nbsp;<span class="builtintype" id="5402327">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5402340">//&nbsp;terminating&nbsp;char&nbsp;of&nbsp;escaped&nbsp;sequence&nbsp;(Escape&nbsp;for&nbsp;escapes,&nbsp;&#39;&gt;&#39;,&nbsp;&#39;;&#39;&nbsp;for&nbsp;HTML&nbsp;tags/entities,&nbsp;or&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402441">lines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5402449">[</span><span class="op" id="5402450">]</span><span class="op" id="5402451">[</span><span class="op" id="5402452">]</span><span class="ident" id="5402453">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5402462">//&nbsp;list&nbsp;of&nbsp;lines;&nbsp;each&nbsp;line&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402510">widths</span>&nbsp;&nbsp;<span class="op" id="5402518">[</span><span class="op" id="5402519">]</span><span class="builtintype" id="5402520">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5402531">//&nbsp;list&nbsp;of&nbsp;column&nbsp;widths&nbsp;in&nbsp;runes&nbsp;-&nbsp;re-used&nbsp;during&nbsp;formatting</span><br>
<span class="lineno"></span><span class="op" id="5402593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5402596">func</span>&nbsp;<span class="op" id="5402601">(</span><span class="ident" id="5402602">b</span>&nbsp;<span class="op" id="5402604">*</span><span class="ident" id="5402605">Writer</span><span class="op" id="5402611">)</span>&nbsp;<span class="ident" id="5402613">addLine</span><span class="op" id="5402620">(</span><span class="op" id="5402621">)</span>&nbsp;<span class="op" id="5402623">{</span>&nbsp;<span class="ident" id="5402625">b</span><span class="op" id="5402626">.</span><span class="ident" id="5402627">lines</span>&nbsp;<span class="op" id="5402633">=</span>&nbsp;<span class="builtinfunc" id="5402635">append</span><span class="op" id="5402641">(</span><span class="ident" id="5402642">b</span><span class="op" id="5402643">.</span><span class="ident" id="5402644">lines</span><span class="op" id="5402649">,</span>&nbsp;<span class="op" id="5402651">[</span><span class="op" id="5402652">]</span><span class="ident" id="5402653">cell</span><span class="op" id="5402657">{</span><span class="op" id="5402658">}</span><span class="op" id="5402659">)</span>&nbsp;<span class="op" id="5402661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5402664">//&nbsp;Reset&nbsp;the&nbsp;current&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5402692">func</span>&nbsp;<span class="op" id="5402697">(</span><span class="ident" id="5402698">b</span>&nbsp;<span class="op" id="5402700">*</span><span class="ident" id="5402701">Writer</span><span class="op" id="5402707">)</span>&nbsp;<span class="ident" id="5402709">reset</span><span class="op" id="5402714">(</span><span class="op" id="5402715">)</span>&nbsp;<span class="op" id="5402717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402720">b</span><span class="op" id="5402721">.</span><span class="ident" id="5402722">buf</span><span class="op" id="5402725">.</span><span class="ident" id="5402726">Reset</span><span class="op" id="5402731">(</span><span class="op" id="5402732">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402735">b</span><span class="op" id="5402736">.</span><span class="ident" id="5402737">pos</span>&nbsp;<span class="op" id="5402741">=</span>&nbsp;<span class="num" id="5402743">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402746">b</span><span class="op" id="5402747">.</span><span class="ident" id="5402748">cell</span>&nbsp;<span class="op" id="5402753">=</span>&nbsp;<span class="ident" id="5402755">cell</span><span class="op" id="5402759">{</span><span class="op" id="5402760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402763">b</span><span class="op" id="5402764">.</span><span class="ident" id="5402765">endChar</span>&nbsp;<span class="op" id="5402773">=</span>&nbsp;<span class="num" id="5402775">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402778">b</span><span class="op" id="5402779">.</span><span class="ident" id="5402780">lines</span>&nbsp;<span class="op" id="5402786">=</span>&nbsp;<span class="ident" id="5402788">b</span><span class="op" id="5402789">.</span><span class="ident" id="5402790">lines</span><span class="op" id="5402795">[</span><span class="num" id="5402796">0</span><span class="op" id="5402797">:</span><span class="num" id="5402798">0</span><span class="op" id="5402799">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402802">b</span><span class="op" id="5402803">.</span><span class="ident" id="5402804">widths</span>&nbsp;<span class="op" id="5402811">=</span>&nbsp;<span class="ident" id="5402813">b</span><span class="op" id="5402814">.</span><span class="ident" id="5402815">widths</span><span class="op" id="5402821">[</span><span class="num" id="5402822">0</span><span class="op" id="5402823">:</span><span class="num" id="5402824">0</span><span class="op" id="5402825">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402828">b</span><span class="op" id="5402829">.</span><span class="ident" id="5402830">addLine</span><span class="op" id="5402837">(</span><span class="op" id="5402838">)</span><br>
<span class="lineno"></span><span class="op" id="5402840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5402843">//&nbsp;Internal&nbsp;representation&nbsp;(current&nbsp;state):</span><br>
<span class="lineno"></span><span class="comment" id="5402887">//</span><br>
<span class="lineno">110</span><span class="comment" id="5402890">//&nbsp;-&nbsp;all&nbsp;text&nbsp;written&nbsp;is&nbsp;appended&nbsp;to&nbsp;buf;&nbsp;tabs&nbsp;and&nbsp;line&nbsp;breaks&nbsp;are&nbsp;stripped&nbsp;away</span><br>
<span class="lineno"></span><span class="comment" id="5402971">//&nbsp;-&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;empty)&nbsp;incomplete&nbsp;cell&nbsp;at&nbsp;the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="5403049">//&nbsp;&nbsp;&nbsp;(the&nbsp;cell&nbsp;starts&nbsp;after&nbsp;a&nbsp;tab&nbsp;or&nbsp;line&nbsp;break)</span><br>
<span class="lineno"></span><span class="comment" id="5403098">//&nbsp;-&nbsp;cell.size&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;belonging&nbsp;to&nbsp;the&nbsp;cell&nbsp;so&nbsp;far</span><br>
<span class="lineno"></span><span class="comment" id="5403165">//&nbsp;-&nbsp;cell.width&nbsp;is&nbsp;text&nbsp;width&nbsp;in&nbsp;runes&nbsp;of&nbsp;that&nbsp;cell&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;cell&nbsp;to</span><br>
<span class="lineno">115</span><span class="comment" id="5403247">//&nbsp;&nbsp;&nbsp;position&nbsp;pos;&nbsp;html&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are&nbsp;excluded&nbsp;from&nbsp;this&nbsp;width&nbsp;if&nbsp;html</span><br>
<span class="lineno"></span><span class="comment" id="5403326">//&nbsp;&nbsp;&nbsp;filtering&nbsp;is&nbsp;enabled</span><br>
<span class="lineno"></span><span class="comment" id="5403352">//&nbsp;-&nbsp;the&nbsp;sizes&nbsp;and&nbsp;widths&nbsp;of&nbsp;processed&nbsp;text&nbsp;are&nbsp;kept&nbsp;in&nbsp;the&nbsp;lines&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5403423">//&nbsp;&nbsp;&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;cells&nbsp;for&nbsp;each&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5403473">//&nbsp;-&nbsp;the&nbsp;widths&nbsp;list&nbsp;is&nbsp;a&nbsp;temporary&nbsp;list&nbsp;with&nbsp;current&nbsp;widths&nbsp;used&nbsp;during</span><br>
<span class="lineno">120</span><span class="comment" id="5403546">//&nbsp;&nbsp;&nbsp;formatting;&nbsp;it&nbsp;is&nbsp;kept&nbsp;in&nbsp;Writer&nbsp;because&nbsp;it&#39;s&nbsp;re-used</span><br>
<span class="lineno"></span><span class="comment" id="5403605">//</span><br>
<span class="lineno"></span><span class="comment" id="5403608">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;----------&nbsp;size&nbsp;----------&gt;|</span><br>
<span class="lineno"></span><span class="comment" id="5403661">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5403714">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;-&nbsp;width&nbsp;-&gt;|&lt;-&nbsp;ignored&nbsp;-&gt;|&nbsp;&nbsp;|</span><br>
<span class="lineno">125</span><span class="comment" id="5403767">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5403820">//&nbsp;[---processed---tab------------&lt;tag&gt;...&lt;/tag&gt;...]</span><br>
<span class="lineno"></span><span class="comment" id="5403873">//&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="5403923">//&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5403973">//&nbsp;buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;&nbsp;pos</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5404026">//&nbsp;Formatting&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;these&nbsp;flags.</span><br>
<span class="lineno"></span><span class="keyword" id="5404076">const</span>&nbsp;<span class="op" id="5404082">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404085">//&nbsp;Ignore&nbsp;html&nbsp;tags&nbsp;and&nbsp;treat&nbsp;entities&nbsp;(starting&nbsp;with&nbsp;&#39;&amp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404144">//&nbsp;and&nbsp;ending&nbsp;in&nbsp;&#39;;&#39;)&nbsp;as&nbsp;single&nbsp;characters&nbsp;(width&nbsp;=&nbsp;1).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404201">FilterHTML</span>&nbsp;<span class="builtintype" id="5404212">uint</span>&nbsp;<span class="op" id="5404217">=</span>&nbsp;<span class="num" id="5404219">1</span>&nbsp;<span class="op" id="5404221">&lt;&lt;</span>&nbsp;<span class="ident" id="5404224">iota</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404231">//&nbsp;Strip&nbsp;Escape&nbsp;characters&nbsp;bracketing&nbsp;escaped&nbsp;text&nbsp;segments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404292">//&nbsp;instead&nbsp;of&nbsp;passing&nbsp;them&nbsp;through&nbsp;unchanged&nbsp;with&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404353">StripEscape</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404367">//&nbsp;Force&nbsp;right-alignment&nbsp;of&nbsp;cell&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404410">//&nbsp;Default&nbsp;is&nbsp;left-alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404441">AlignRight</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404454">//&nbsp;Handle&nbsp;empty&nbsp;columns&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;not&nbsp;present&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404510">//&nbsp;the&nbsp;input&nbsp;in&nbsp;the&nbsp;first&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404544">DiscardEmptyColumns</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404566">//&nbsp;Always&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;columns&nbsp;(i.e.,&nbsp;padding&nbsp;of</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404628">//&nbsp;leading&nbsp;empty&nbsp;cells&nbsp;on&nbsp;the&nbsp;left)&nbsp;independent&nbsp;of&nbsp;padchar.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404689">TabIndent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404701">//&nbsp;Print&nbsp;a&nbsp;vertical&nbsp;bar&nbsp;(&#39;|&#39;)&nbsp;between&nbsp;columns&nbsp;(after&nbsp;formatting).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404768">//&nbsp;Discarded&nbsp;columns&nbsp;appear&nbsp;as&nbsp;zero-width&nbsp;columns&nbsp;(&#34;||&#34;).</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404827">Debug</span><br>
<span class="lineno"></span><span class="op" id="5404833">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5404836">//&nbsp;A&nbsp;Writer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Init.&nbsp;The&nbsp;first&nbsp;parameter&nbsp;(output)</span><br>
<span class="lineno"></span><span class="comment" id="5404918">//&nbsp;specifies&nbsp;the&nbsp;filter&nbsp;output.&nbsp;The&nbsp;remaining&nbsp;parameters&nbsp;control&nbsp;the&nbsp;formatting:</span><br>
<span class="lineno">160</span><span class="comment" id="5404999">//</span><br>
<span class="lineno"></span><span class="comment" id="5405002">//&nbsp;&nbsp;&nbsp;&nbspminwidth&nbsp;&nbsp;&nbsp;&nbspminimal&nbsp;cell&nbsp;width&nbsp;including&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span><span class="comment" id="5405055">//&nbsp;&nbsp;&nbsp;&nbsptabwidth&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;tab&nbsp;characters&nbsp;(equivalent&nbsp;number&nbsp;of&nbsp;spaces)</span><br>
<span class="lineno"></span><span class="comment" id="5405121">//&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;added&nbsp;to&nbsp;a&nbsp;cell&nbsp;before&nbsp;computing&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="5405184">//&nbsp;&nbsp;&nbsp;&nbsppadchar&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspASCII&nbsp;char&nbsp;used&nbsp;for&nbsp;padding</span><br>
<span class="lineno">165</span><span class="comment" id="5405224">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;padchar&nbsp;==&nbsp;&#39;\t&#39;,&nbsp;the&nbsp;Writer&nbsp;will&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5405281">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;a&nbsp;&#39;\t&#39;&nbsp;in&nbsp;the&nbsp;formatted&nbsp;output&nbsp;is&nbsp;tabwidth,</span><br>
<span class="lineno"></span><span class="comment" id="5405339">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspand&nbsp;cells&nbsp;are&nbsp;left-aligned&nbsp;independent&nbsp;of&nbsp;align_left</span><br>
<span class="lineno"></span><span class="comment" id="5405397">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(for&nbsp;correct-looking&nbsp;results,&nbsp;tabwidth&nbsp;must&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="5405457">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspto&nbsp;the&nbsp;tab&nbsp;width&nbsp;in&nbsp;the&nbsp;viewer&nbsp;displaying&nbsp;the&nbsp;result)</span><br>
<span class="lineno">170</span><span class="comment" id="5405516">//&nbsp;&nbsp;&nbsp;&nbspflags&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspformatting&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="5405545">//</span><br>
<span class="lineno"></span><span class="keyword" id="5405548">func</span>&nbsp;<span class="op" id="5405553">(</span><span class="ident" id="5405554">b</span>&nbsp;<span class="op" id="5405556">*</span><span class="ident" id="5405557">Writer</span><span class="op" id="5405563">)</span>&nbsp;<span class="ident" id="5405565">Init</span><span class="op" id="5405569">(</span><span class="ident" id="5405570">output</span>&nbsp;<span class="ident" id="5405577">io</span><span class="op" id="5405579">.</span><span class="ident" id="5405580">Writer</span><span class="op" id="5405586">,</span>&nbsp;<span class="ident" id="5405588">minwidth</span><span class="op" id="5405596">,</span>&nbsp;<span class="ident" id="5405598">tabwidth</span><span class="op" id="5405606">,</span>&nbsp;<span class="ident" id="5405608">padding</span>&nbsp;<span class="builtintype" id="5405616">int</span><span class="op" id="5405619">,</span>&nbsp;<span class="ident" id="5405621">padchar</span>&nbsp;<span class="builtintype" id="5405629">byte</span><span class="op" id="5405633">,</span>&nbsp;<span class="ident" id="5405635">flags</span>&nbsp;<span class="builtintype" id="5405641">uint</span><span class="op" id="5405645">)</span>&nbsp;<span class="op" id="5405647">*</span><span class="ident" id="5405648">Writer</span>&nbsp;<span class="op" id="5405655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405658">if</span>&nbsp;<span class="ident" id="5405661">minwidth</span>&nbsp;<span class="op" id="5405670">&lt;</span>&nbsp;<span class="num" id="5405672">0</span>&nbsp;<span class="op" id="5405674">||</span>&nbsp;<span class="ident" id="5405677">tabwidth</span>&nbsp;<span class="op" id="5405686">&lt;</span>&nbsp;<span class="num" id="5405688">0</span>&nbsp;<span class="op" id="5405690">||</span>&nbsp;<span class="ident" id="5405693">padding</span>&nbsp;<span class="op" id="5405701">&lt;</span>&nbsp;<span class="num" id="5405703">0</span>&nbsp;<span class="op" id="5405705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5405709">panic</span><span class="op" id="5405714">(</span><span class="string" id="5405715">&#34;negative&nbsp;minwidth,&nbsp;tabwidth,&nbsp;or&nbsp;padding&#34;</span><span class="op" id="5405756">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405762">b</span><span class="op" id="5405763">.</span><span class="ident" id="5405764">output</span>&nbsp;<span class="op" id="5405771">=</span>&nbsp;<span class="ident" id="5405773">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405781">b</span><span class="op" id="5405782">.</span><span class="ident" id="5405783">minwidth</span>&nbsp;<span class="op" id="5405792">=</span>&nbsp;<span class="ident" id="5405794">minwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405804">b</span><span class="op" id="5405805">.</span><span class="ident" id="5405806">tabwidth</span>&nbsp;<span class="op" id="5405815">=</span>&nbsp;<span class="ident" id="5405817">tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405827">b</span><span class="op" id="5405828">.</span><span class="ident" id="5405829">padding</span>&nbsp;<span class="op" id="5405837">=</span>&nbsp;<span class="ident" id="5405839">padding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405848">for</span>&nbsp;<span class="ident" id="5405852">i</span>&nbsp;<span class="op" id="5405854">:=</span>&nbsp;<span class="keyword" id="5405857">range</span>&nbsp;<span class="ident" id="5405863">b</span><span class="op" id="5405864">.</span><span class="ident" id="5405865">padbytes</span>&nbsp;<span class="op" id="5405874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405878">b</span><span class="op" id="5405879">.</span><span class="ident" id="5405880">padbytes</span><span class="op" id="5405888">[</span><span class="ident" id="5405889">i</span><span class="op" id="5405890">]</span>&nbsp;<span class="op" id="5405892">=</span>&nbsp;<span class="ident" id="5405894">padchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405906">if</span>&nbsp;<span class="ident" id="5405909">padchar</span>&nbsp;<span class="op" id="5405917">==</span>&nbsp;<span class="string" id="5405920">&#39;\t&#39;</span>&nbsp;<span class="op" id="5405925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405929">//&nbsp;tab&nbsp;padding&nbsp;enforces&nbsp;left-alignment</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405970">flags</span>&nbsp;<span class="op" id="5405976">&amp;^=</span>&nbsp;<span class="ident" id="5405980">AlignRight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405995">b</span><span class="op" id="5405996">.</span><span class="ident" id="5405997">flags</span>&nbsp;<span class="op" id="5406003">=</span>&nbsp;<span class="ident" id="5406005">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406013">b</span><span class="op" id="5406014">.</span><span class="ident" id="5406015">reset</span><span class="op" id="5406020">(</span><span class="op" id="5406021">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406025">return</span>&nbsp;<span class="ident" id="5406032">b</span><br>
<span class="lineno"></span><span class="op" id="5406034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5406037">//&nbsp;debugging&nbsp;support&nbsp;(keep&nbsp;code&nbsp;around)</span><br>
<span class="lineno">195</span><span class="keyword" id="5406077">func</span>&nbsp;<span class="op" id="5406082">(</span><span class="ident" id="5406083">b</span>&nbsp;<span class="op" id="5406085">*</span><span class="ident" id="5406086">Writer</span><span class="op" id="5406092">)</span>&nbsp;<span class="ident" id="5406094">dump</span><span class="op" id="5406098">(</span><span class="op" id="5406099">)</span>&nbsp;<span class="op" id="5406101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406104">pos</span>&nbsp;<span class="op" id="5406108">:=</span>&nbsp;<span class="num" id="5406111">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406114">for</span>&nbsp;<span class="ident" id="5406118">i</span><span class="op" id="5406119">,</span>&nbsp;<span class="ident" id="5406121">line</span>&nbsp;<span class="op" id="5406126">:=</span>&nbsp;<span class="keyword" id="5406129">range</span>&nbsp;<span class="ident" id="5406135">b</span><span class="op" id="5406136">.</span><span class="ident" id="5406137">lines</span>&nbsp;<span class="op" id="5406143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5406147">print</span><span class="op" id="5406152">(</span><span class="string" id="5406153">&#34;(&#34;</span><span class="op" id="5406156">,</span>&nbsp;<span class="ident" id="5406158">i</span><span class="op" id="5406159">,</span>&nbsp;<span class="string" id="5406161">&#34;)&nbsp;&#34;</span><span class="op" id="5406165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406169">for</span>&nbsp;<span class="ident" id="5406173">_</span><span class="op" id="5406174">,</span>&nbsp;<span class="ident" id="5406176">c</span>&nbsp;<span class="op" id="5406178">:=</span>&nbsp;<span class="keyword" id="5406181">range</span>&nbsp;<span class="ident" id="5406187">line</span>&nbsp;<span class="op" id="5406192">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5406197">print</span><span class="op" id="5406202">(</span><span class="string" id="5406203">&#34;[&#34;</span><span class="op" id="5406206">,</span>&nbsp;<span class="builtintype" id="5406208">string</span><span class="op" id="5406214">(</span><span class="ident" id="5406215">b</span><span class="op" id="5406216">.</span><span class="ident" id="5406217">buf</span><span class="op" id="5406220">.</span><span class="ident" id="5406221">Bytes</span><span class="op" id="5406226">(</span><span class="op" id="5406227">)</span><span class="op" id="5406228">[</span><span class="ident" id="5406229">pos</span><span class="op" id="5406232">:</span><span class="ident" id="5406233">pos</span><span class="op" id="5406236">+</span><span class="ident" id="5406237">c</span><span class="op" id="5406238">.</span><span class="ident" id="5406239">size</span><span class="op" id="5406243">]</span><span class="op" id="5406244">)</span><span class="op" id="5406245">,</span>&nbsp;<span class="string" id="5406247">&#34;]&#34;</span><span class="op" id="5406250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406255">pos</span>&nbsp;<span class="op" id="5406259">+=</span>&nbsp;<span class="ident" id="5406262">c</span><span class="op" id="5406263">.</span><span class="ident" id="5406264">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5406275">print</span><span class="op" id="5406280">(</span><span class="string" id="5406281">&#34;\n&#34;</span><span class="op" id="5406285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406288">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5406291">print</span><span class="op" id="5406296">(</span><span class="string" id="5406297">&#34;\n&#34;</span><span class="op" id="5406301">)</span><br>
<span class="lineno"></span><span class="op" id="5406303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5406306">//&nbsp;local&nbsp;error&nbsp;wrapper&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish&nbsp;errors&nbsp;we&nbsp;want&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5406376">//&nbsp;as&nbsp;errors&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;(which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors)</span><br>
<span class="lineno">210</span><span class="keyword" id="5406451">type</span>&nbsp;<span class="ident" id="5406456">osError</span>&nbsp;<span class="keyword" id="5406464">struct</span>&nbsp;<span class="op" id="5406471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406474">err</span>&nbsp;<span class="builtintype" id="5406478">error</span><br>
<span class="lineno"></span><span class="op" id="5406484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5406487">func</span>&nbsp;<span class="op" id="5406492">(</span><span class="ident" id="5406493">b</span>&nbsp;<span class="op" id="5406495">*</span><span class="ident" id="5406496">Writer</span><span class="op" id="5406502">)</span>&nbsp;<span class="ident" id="5406504">write0</span><span class="op" id="5406510">(</span><span class="ident" id="5406511">buf</span>&nbsp;<span class="op" id="5406515">[</span><span class="op" id="5406516">]</span><span class="builtintype" id="5406517">byte</span><span class="op" id="5406521">)</span>&nbsp;<span class="op" id="5406523">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406526">n</span><span class="op" id="5406527">,</span>&nbsp;<span class="ident" id="5406529">err</span>&nbsp;<span class="op" id="5406533">:=</span>&nbsp;<span class="ident" id="5406536">b</span><span class="op" id="5406537">.</span><span class="ident" id="5406538">output</span><span class="op" id="5406544">.</span><span class="ident" id="5406545">Write</span><span class="op" id="5406550">(</span><span class="ident" id="5406551">buf</span><span class="op" id="5406554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406557">if</span>&nbsp;<span class="ident" id="5406560">n</span>&nbsp;<span class="op" id="5406562">!=</span>&nbsp;<span class="builtinfunc" id="5406565">len</span><span class="op" id="5406568">(</span><span class="ident" id="5406569">buf</span><span class="op" id="5406572">)</span>&nbsp;<span class="op" id="5406574">&amp;&amp;</span>&nbsp;<span class="ident" id="5406577">err</span>&nbsp;<span class="op" id="5406581">==</span>&nbsp;<span class="ident" id="5406584">nil</span>&nbsp;<span class="op" id="5406588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406592">err</span>&nbsp;<span class="op" id="5406596">=</span>&nbsp;<span class="ident" id="5406598">io</span><span class="op" id="5406600">.</span><span class="ident" id="5406601">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406619">if</span>&nbsp;<span class="ident" id="5406622">err</span>&nbsp;<span class="op" id="5406626">!=</span>&nbsp;<span class="ident" id="5406629">nil</span>&nbsp;<span class="op" id="5406633">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5406637">panic</span><span class="op" id="5406642">(</span><span class="ident" id="5406643">osError</span><span class="op" id="5406650">{</span><span class="ident" id="5406651">err</span><span class="op" id="5406654">}</span><span class="op" id="5406655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406658">}</span><br>
<span class="lineno"></span><span class="op" id="5406660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5406663">func</span>&nbsp;<span class="op" id="5406668">(</span><span class="ident" id="5406669">b</span>&nbsp;<span class="op" id="5406671">*</span><span class="ident" id="5406672">Writer</span><span class="op" id="5406678">)</span>&nbsp;<span class="ident" id="5406680">writeN</span><span class="op" id="5406686">(</span><span class="ident" id="5406687">src</span>&nbsp;<span class="op" id="5406691">[</span><span class="op" id="5406692">]</span><span class="builtintype" id="5406693">byte</span><span class="op" id="5406697">,</span>&nbsp;<span class="ident" id="5406699">n</span>&nbsp;<span class="builtintype" id="5406701">int</span><span class="op" id="5406704">)</span>&nbsp;<span class="op" id="5406706">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406709">for</span>&nbsp;<span class="ident" id="5406713">n</span>&nbsp;<span class="op" id="5406715">&gt;</span>&nbsp;<span class="builtinfunc" id="5406717">len</span><span class="op" id="5406720">(</span><span class="ident" id="5406721">src</span><span class="op" id="5406724">)</span>&nbsp;<span class="op" id="5406726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406730">b</span><span class="op" id="5406731">.</span><span class="ident" id="5406732">write0</span><span class="op" id="5406738">(</span><span class="ident" id="5406739">src</span><span class="op" id="5406742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406746">n</span>&nbsp;<span class="op" id="5406748">-=</span>&nbsp;<span class="builtinfunc" id="5406751">len</span><span class="op" id="5406754">(</span><span class="ident" id="5406755">src</span><span class="op" id="5406758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406764">b</span><span class="op" id="5406765">.</span><span class="ident" id="5406766">write0</span><span class="op" id="5406772">(</span><span class="ident" id="5406773">src</span><span class="op" id="5406776">[</span><span class="num" id="5406777">0</span><span class="op" id="5406778">:</span><span class="ident" id="5406779">n</span><span class="op" id="5406780">]</span><span class="op" id="5406781">)</span><br>
<span class="lineno">230</span><span class="op" id="5406783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5406786">var</span>&nbsp;<span class="op" id="5406790">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406793">newline</span>&nbsp;<span class="op" id="5406801">=</span>&nbsp;<span class="op" id="5406803">[</span><span class="op" id="5406804">]</span><span class="builtintype" id="5406805">byte</span><span class="op" id="5406809">{</span><span class="string" id="5406810">&#39;\n&#39;</span><span class="op" id="5406814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406817">tabs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406825">=</span>&nbsp;<span class="op" id="5406827">[</span><span class="op" id="5406828">]</span><span class="builtintype" id="5406829">byte</span><span class="op" id="5406833">(</span><span class="string" id="5406834">&#34;\t\t\t\t\t\t\t\t&#34;</span><span class="op" id="5406852">)</span><br>
<span class="lineno">235</span><span class="op" id="5406854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5406857">func</span>&nbsp;<span class="op" id="5406862">(</span><span class="ident" id="5406863">b</span>&nbsp;<span class="op" id="5406865">*</span><span class="ident" id="5406866">Writer</span><span class="op" id="5406872">)</span>&nbsp;<span class="ident" id="5406874">writePadding</span><span class="op" id="5406886">(</span><span class="ident" id="5406887">textw</span><span class="op" id="5406892">,</span>&nbsp;<span class="ident" id="5406894">cellw</span>&nbsp;<span class="builtintype" id="5406900">int</span><span class="op" id="5406903">,</span>&nbsp;<span class="ident" id="5406905">useTabs</span>&nbsp;<span class="builtintype" id="5406913">bool</span><span class="op" id="5406917">)</span>&nbsp;<span class="op" id="5406919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406922">if</span>&nbsp;<span class="ident" id="5406925">b</span><span class="op" id="5406926">.</span><span class="ident" id="5406927">padbytes</span><span class="op" id="5406935">[</span><span class="num" id="5406936">0</span><span class="op" id="5406937">]</span>&nbsp;<span class="op" id="5406939">==</span>&nbsp;<span class="string" id="5406942">&#39;\t&#39;</span>&nbsp;<span class="op" id="5406947">||</span>&nbsp;<span class="ident" id="5406950">useTabs</span>&nbsp;<span class="op" id="5406958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5406962">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;tabs</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406993">if</span>&nbsp;<span class="ident" id="5406996">b</span><span class="op" id="5406997">.</span><span class="ident" id="5406998">tabwidth</span>&nbsp;<span class="op" id="5407007">==</span>&nbsp;<span class="num" id="5407010">0</span>&nbsp;<span class="op" id="5407012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407017">return</span>&nbsp;<span class="comment" id="5407024">//&nbsp;tabs&nbsp;have&nbsp;no&nbsp;width&nbsp;-&nbsp;can&#39;t&nbsp;do&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407075">//&nbsp;make&nbsp;cellw&nbsp;the&nbsp;smallest&nbsp;multiple&nbsp;of&nbsp;b.tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407127">cellw</span>&nbsp;<span class="op" id="5407133">=</span>&nbsp;<span class="op" id="5407135">(</span><span class="ident" id="5407136">cellw</span>&nbsp;<span class="op" id="5407142">+</span>&nbsp;<span class="ident" id="5407144">b</span><span class="op" id="5407145">.</span><span class="ident" id="5407146">tabwidth</span>&nbsp;<span class="op" id="5407155">-</span>&nbsp;<span class="num" id="5407157">1</span><span class="op" id="5407158">)</span>&nbsp;<span class="op" id="5407160">/</span>&nbsp;<span class="ident" id="5407162">b</span><span class="op" id="5407163">.</span><span class="ident" id="5407164">tabwidth</span>&nbsp;<span class="op" id="5407173">*</span>&nbsp;<span class="ident" id="5407175">b</span><span class="op" id="5407176">.</span><span class="ident" id="5407177">tabwidth</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407188">n</span>&nbsp;<span class="op" id="5407190">:=</span>&nbsp;<span class="ident" id="5407193">cellw</span>&nbsp;<span class="op" id="5407199">-</span>&nbsp;<span class="ident" id="5407201">textw</span>&nbsp;<span class="comment" id="5407207">//&nbsp;amount&nbsp;of&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407230">if</span>&nbsp;<span class="ident" id="5407233">n</span>&nbsp;<span class="op" id="5407235">&lt;</span>&nbsp;<span class="num" id="5407237">0</span>&nbsp;<span class="op" id="5407239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5407244">panic</span><span class="op" id="5407249">(</span><span class="string" id="5407250">&#34;internal&nbsp;error&#34;</span><span class="op" id="5407266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407274">b</span><span class="op" id="5407275">.</span><span class="ident" id="5407276">writeN</span><span class="op" id="5407282">(</span><span class="ident" id="5407283">tabs</span><span class="op" id="5407287">,</span>&nbsp;<span class="op" id="5407289">(</span><span class="ident" id="5407290">n</span><span class="op" id="5407291">+</span><span class="ident" id="5407292">b</span><span class="op" id="5407293">.</span><span class="ident" id="5407294">tabwidth</span><span class="op" id="5407302">-</span><span class="num" id="5407303">1</span><span class="op" id="5407304">)</span><span class="op" id="5407305">/</span><span class="ident" id="5407306">b</span><span class="op" id="5407307">.</span><span class="ident" id="5407308">tabwidth</span><span class="op" id="5407316">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407320">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407332">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;non-tab&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407376">b</span><span class="op" id="5407377">.</span><span class="ident" id="5407378">writeN</span><span class="op" id="5407384">(</span><span class="ident" id="5407385">b</span><span class="op" id="5407386">.</span><span class="ident" id="5407387">padbytes</span><span class="op" id="5407395">[</span><span class="num" id="5407396">0</span><span class="op" id="5407397">:</span><span class="op" id="5407398">]</span><span class="op" id="5407399">,</span>&nbsp;<span class="ident" id="5407401">cellw</span><span class="op" id="5407406">-</span><span class="ident" id="5407407">textw</span><span class="op" id="5407412">)</span><br>
<span class="lineno">255</span><span class="op" id="5407414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5407417">var</span>&nbsp;<span class="ident" id="5407421">vbar</span>&nbsp;<span class="op" id="5407426">=</span>&nbsp;<span class="op" id="5407428">[</span><span class="op" id="5407429">]</span><span class="builtintype" id="5407430">byte</span><span class="op" id="5407434">{</span><span class="string" id="5407435">&#39;|&#39;</span><span class="op" id="5407438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5407441">func</span>&nbsp;<span class="op" id="5407446">(</span><span class="ident" id="5407447">b</span>&nbsp;<span class="op" id="5407449">*</span><span class="ident" id="5407450">Writer</span><span class="op" id="5407456">)</span>&nbsp;<span class="ident" id="5407458">writeLines</span><span class="op" id="5407468">(</span><span class="ident" id="5407469">pos0</span>&nbsp;<span class="builtintype" id="5407474">int</span><span class="op" id="5407477">,</span>&nbsp;<span class="ident" id="5407479">line0</span><span class="op" id="5407484">,</span>&nbsp;<span class="ident" id="5407486">line1</span>&nbsp;<span class="builtintype" id="5407492">int</span><span class="op" id="5407495">)</span>&nbsp;<span class="op" id="5407497">(</span><span class="ident" id="5407498">pos</span>&nbsp;<span class="builtintype" id="5407502">int</span><span class="op" id="5407505">)</span>&nbsp;<span class="op" id="5407507">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407510">pos</span>&nbsp;<span class="op" id="5407514">=</span>&nbsp;<span class="ident" id="5407516">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407522">for</span>&nbsp;<span class="ident" id="5407526">i</span>&nbsp;<span class="op" id="5407528">:=</span>&nbsp;<span class="ident" id="5407531">line0</span><span class="op" id="5407536">;</span>&nbsp;<span class="ident" id="5407538">i</span>&nbsp;<span class="op" id="5407540">&lt;</span>&nbsp;<span class="ident" id="5407542">line1</span><span class="op" id="5407547">;</span>&nbsp;<span class="ident" id="5407549">i</span><span class="op" id="5407550">++</span>&nbsp;<span class="op" id="5407553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407557">line</span>&nbsp;<span class="op" id="5407562">:=</span>&nbsp;<span class="ident" id="5407565">b</span><span class="op" id="5407566">.</span><span class="ident" id="5407567">lines</span><span class="op" id="5407572">[</span><span class="ident" id="5407573">i</span><span class="op" id="5407574">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407579">//&nbsp;if&nbsp;TabIndent&nbsp;is&nbsp;set,&nbsp;use&nbsp;tabs&nbsp;to&nbsp;pad&nbsp;leading&nbsp;empty&nbsp;cells</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407641">useTabs</span>&nbsp;<span class="op" id="5407649">:=</span>&nbsp;<span class="ident" id="5407652">b</span><span class="op" id="5407653">.</span><span class="ident" id="5407654">flags</span><span class="op" id="5407659">&amp;</span><span class="ident" id="5407660">TabIndent</span>&nbsp;<span class="op" id="5407670">!=</span>&nbsp;<span class="num" id="5407673">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407678">for</span>&nbsp;<span class="ident" id="5407682">j</span><span class="op" id="5407683">,</span>&nbsp;<span class="ident" id="5407685">c</span>&nbsp;<span class="op" id="5407687">:=</span>&nbsp;<span class="keyword" id="5407690">range</span>&nbsp;<span class="ident" id="5407696">line</span>&nbsp;<span class="op" id="5407701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407706">if</span>&nbsp;<span class="ident" id="5407709">j</span>&nbsp;<span class="op" id="5407711">&gt;</span>&nbsp;<span class="num" id="5407713">0</span>&nbsp;<span class="op" id="5407715">&amp;&amp;</span>&nbsp;<span class="ident" id="5407718">b</span><span class="op" id="5407719">.</span><span class="ident" id="5407720">flags</span><span class="op" id="5407725">&amp;</span><span class="ident" id="5407726">Debug</span>&nbsp;<span class="op" id="5407732">!=</span>&nbsp;<span class="num" id="5407735">0</span>&nbsp;<span class="op" id="5407737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407743">//&nbsp;indicate&nbsp;column&nbsp;break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407772">b</span><span class="op" id="5407773">.</span><span class="ident" id="5407774">write0</span><span class="op" id="5407780">(</span><span class="ident" id="5407781">vbar</span><span class="op" id="5407785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407796">if</span>&nbsp;<span class="ident" id="5407799">c</span><span class="op" id="5407800">.</span><span class="ident" id="5407801">size</span>&nbsp;<span class="op" id="5407806">==</span>&nbsp;<span class="num" id="5407809">0</span>&nbsp;<span class="op" id="5407811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407817">//&nbsp;empty&nbsp;cell</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407835">if</span>&nbsp;<span class="ident" id="5407838">j</span>&nbsp;<span class="op" id="5407840">&lt;</span>&nbsp;<span class="builtinfunc" id="5407842">len</span><span class="op" id="5407845">(</span><span class="ident" id="5407846">b</span><span class="op" id="5407847">.</span><span class="ident" id="5407848">widths</span><span class="op" id="5407854">)</span>&nbsp;<span class="op" id="5407856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407863">b</span><span class="op" id="5407864">.</span><span class="ident" id="5407865">writePadding</span><span class="op" id="5407877">(</span><span class="ident" id="5407878">c</span><span class="op" id="5407879">.</span><span class="ident" id="5407880">width</span><span class="op" id="5407885">,</span>&nbsp;<span class="ident" id="5407887">b</span><span class="op" id="5407888">.</span><span class="ident" id="5407889">widths</span><span class="op" id="5407895">[</span><span class="ident" id="5407896">j</span><span class="op" id="5407897">]</span><span class="op" id="5407898">,</span>&nbsp;<span class="ident" id="5407900">useTabs</span><span class="op" id="5407907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407918">}</span>&nbsp;<span class="keyword" id="5407920">else</span>&nbsp;<span class="op" id="5407925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407931">//&nbsp;non-empty&nbsp;cell</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407953">useTabs</span>&nbsp;<span class="op" id="5407961">=</span>&nbsp;<span class="builtintype" id="5407963">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407973">if</span>&nbsp;<span class="ident" id="5407976">b</span><span class="op" id="5407977">.</span><span class="ident" id="5407978">flags</span><span class="op" id="5407983">&amp;</span><span class="ident" id="5407984">AlignRight</span>&nbsp;<span class="op" id="5407995">==</span>&nbsp;<span class="num" id="5407998">0</span>&nbsp;<span class="op" id="5408000">{</span>&nbsp;<span class="comment" id="5408002">//&nbsp;align&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408021">b</span><span class="op" id="5408022">.</span><span class="ident" id="5408023">write0</span><span class="op" id="5408029">(</span><span class="ident" id="5408030">b</span><span class="op" id="5408031">.</span><span class="ident" id="5408032">buf</span><span class="op" id="5408035">.</span><span class="ident" id="5408036">Bytes</span><span class="op" id="5408041">(</span><span class="op" id="5408042">)</span><span class="op" id="5408043">[</span><span class="ident" id="5408044">pos</span>&nbsp;<span class="op" id="5408048">:</span>&nbsp;<span class="ident" id="5408050">pos</span><span class="op" id="5408053">+</span><span class="ident" id="5408054">c</span><span class="op" id="5408055">.</span><span class="ident" id="5408056">size</span><span class="op" id="5408060">]</span><span class="op" id="5408061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408068">pos</span>&nbsp;<span class="op" id="5408072">+=</span>&nbsp;<span class="ident" id="5408075">c</span><span class="op" id="5408076">.</span><span class="ident" id="5408077">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408087">if</span>&nbsp;<span class="ident" id="5408090">j</span>&nbsp;<span class="op" id="5408092">&lt;</span>&nbsp;<span class="builtinfunc" id="5408094">len</span><span class="op" id="5408097">(</span><span class="ident" id="5408098">b</span><span class="op" id="5408099">.</span><span class="ident" id="5408100">widths</span><span class="op" id="5408106">)</span>&nbsp;<span class="op" id="5408108">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408116">b</span><span class="op" id="5408117">.</span><span class="ident" id="5408118">writePadding</span><span class="op" id="5408130">(</span><span class="ident" id="5408131">c</span><span class="op" id="5408132">.</span><span class="ident" id="5408133">width</span><span class="op" id="5408138">,</span>&nbsp;<span class="ident" id="5408140">b</span><span class="op" id="5408141">.</span><span class="ident" id="5408142">widths</span><span class="op" id="5408148">[</span><span class="ident" id="5408149">j</span><span class="op" id="5408150">]</span><span class="op" id="5408151">,</span>&nbsp;<span class="builtintype" id="5408153">false</span><span class="op" id="5408158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408171">}</span>&nbsp;<span class="keyword" id="5408173">else</span>&nbsp;<span class="op" id="5408178">{</span>&nbsp;<span class="comment" id="5408180">//&nbsp;align&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408200">if</span>&nbsp;<span class="ident" id="5408203">j</span>&nbsp;<span class="op" id="5408205">&lt;</span>&nbsp;<span class="builtinfunc" id="5408207">len</span><span class="op" id="5408210">(</span><span class="ident" id="5408211">b</span><span class="op" id="5408212">.</span><span class="ident" id="5408213">widths</span><span class="op" id="5408219">)</span>&nbsp;<span class="op" id="5408221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408229">b</span><span class="op" id="5408230">.</span><span class="ident" id="5408231">writePadding</span><span class="op" id="5408243">(</span><span class="ident" id="5408244">c</span><span class="op" id="5408245">.</span><span class="ident" id="5408246">width</span><span class="op" id="5408251">,</span>&nbsp;<span class="ident" id="5408253">b</span><span class="op" id="5408254">.</span><span class="ident" id="5408255">widths</span><span class="op" id="5408261">[</span><span class="ident" id="5408262">j</span><span class="op" id="5408263">]</span><span class="op" id="5408264">,</span>&nbsp;<span class="builtintype" id="5408266">false</span><span class="op" id="5408271">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408285">b</span><span class="op" id="5408286">.</span><span class="ident" id="5408287">write0</span><span class="op" id="5408293">(</span><span class="ident" id="5408294">b</span><span class="op" id="5408295">.</span><span class="ident" id="5408296">buf</span><span class="op" id="5408299">.</span><span class="ident" id="5408300">Bytes</span><span class="op" id="5408305">(</span><span class="op" id="5408306">)</span><span class="op" id="5408307">[</span><span class="ident" id="5408308">pos</span>&nbsp;<span class="op" id="5408312">:</span>&nbsp;<span class="ident" id="5408314">pos</span><span class="op" id="5408317">+</span><span class="ident" id="5408318">c</span><span class="op" id="5408319">.</span><span class="ident" id="5408320">size</span><span class="op" id="5408324">]</span><span class="op" id="5408325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408332">pos</span>&nbsp;<span class="op" id="5408336">+=</span>&nbsp;<span class="ident" id="5408339">c</span><span class="op" id="5408340">.</span><span class="ident" id="5408341">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408355">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408364">if</span>&nbsp;<span class="ident" id="5408367">i</span><span class="op" id="5408368">+</span><span class="num" id="5408369">1</span>&nbsp;<span class="op" id="5408371">==</span>&nbsp;<span class="builtinfunc" id="5408374">len</span><span class="op" id="5408377">(</span><span class="ident" id="5408378">b</span><span class="op" id="5408379">.</span><span class="ident" id="5408380">lines</span><span class="op" id="5408385">)</span>&nbsp;<span class="op" id="5408387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5408392">//&nbsp;last&nbsp;buffered&nbsp;line&nbsp;-&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;newline,&nbsp;so&nbsp;just&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5408458">//&nbsp;any&nbsp;outstanding&nbsp;buffered&nbsp;data</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408494">b</span><span class="op" id="5408495">.</span><span class="ident" id="5408496">write0</span><span class="op" id="5408502">(</span><span class="ident" id="5408503">b</span><span class="op" id="5408504">.</span><span class="ident" id="5408505">buf</span><span class="op" id="5408508">.</span><span class="ident" id="5408509">Bytes</span><span class="op" id="5408514">(</span><span class="op" id="5408515">)</span><span class="op" id="5408516">[</span><span class="ident" id="5408517">pos</span>&nbsp;<span class="op" id="5408521">:</span>&nbsp;<span class="ident" id="5408523">pos</span><span class="op" id="5408526">+</span><span class="ident" id="5408527">b</span><span class="op" id="5408528">.</span><span class="ident" id="5408529">cell</span><span class="op" id="5408533">.</span><span class="ident" id="5408534">size</span><span class="op" id="5408538">]</span><span class="op" id="5408539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408544">pos</span>&nbsp;<span class="op" id="5408548">+=</span>&nbsp;<span class="ident" id="5408551">b</span><span class="op" id="5408552">.</span><span class="ident" id="5408553">cell</span><span class="op" id="5408557">.</span><span class="ident" id="5408558">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408565">}</span>&nbsp;<span class="keyword" id="5408567">else</span>&nbsp;<span class="op" id="5408572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5408577">//&nbsp;not&nbsp;the&nbsp;last&nbsp;line&nbsp;-&nbsp;write&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408617">b</span><span class="op" id="5408618">.</span><span class="ident" id="5408619">write0</span><span class="op" id="5408625">(</span><span class="ident" id="5408626">newline</span><span class="op" id="5408633">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408643">return</span><br>
<span class="lineno"></span><span class="op" id="5408650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="5408653">//&nbsp;Format&nbsp;the&nbsp;text&nbsp;between&nbsp;line0&nbsp;and&nbsp;line1&nbsp;(excluding&nbsp;line1);&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="5408719">//&nbsp;is&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;line0.</span><br>
<span class="lineno"></span><span class="comment" id="5408786">//&nbsp;Returns&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5408851">//&nbsp;line1&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="5408882">//</span><br>
<span class="lineno">315</span><span class="keyword" id="5408885">func</span>&nbsp;<span class="op" id="5408890">(</span><span class="ident" id="5408891">b</span>&nbsp;<span class="op" id="5408893">*</span><span class="ident" id="5408894">Writer</span><span class="op" id="5408900">)</span>&nbsp;<span class="ident" id="5408902">format</span><span class="op" id="5408908">(</span><span class="ident" id="5408909">pos0</span>&nbsp;<span class="builtintype" id="5408914">int</span><span class="op" id="5408917">,</span>&nbsp;<span class="ident" id="5408919">line0</span><span class="op" id="5408924">,</span>&nbsp;<span class="ident" id="5408926">line1</span>&nbsp;<span class="builtintype" id="5408932">int</span><span class="op" id="5408935">)</span>&nbsp;<span class="op" id="5408937">(</span><span class="ident" id="5408938">pos</span>&nbsp;<span class="builtintype" id="5408942">int</span><span class="op" id="5408945">)</span>&nbsp;<span class="op" id="5408947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408950">pos</span>&nbsp;<span class="op" id="5408954">=</span>&nbsp;<span class="ident" id="5408956">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408962">column</span>&nbsp;<span class="op" id="5408969">:=</span>&nbsp;<span class="builtinfunc" id="5408972">len</span><span class="op" id="5408975">(</span><span class="ident" id="5408976">b</span><span class="op" id="5408977">.</span><span class="ident" id="5408978">widths</span><span class="op" id="5408984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408987">for</span>&nbsp;<span class="ident" id="5408991">this</span>&nbsp;<span class="op" id="5408996">:=</span>&nbsp;<span class="ident" id="5408999">line0</span><span class="op" id="5409004">;</span>&nbsp;<span class="ident" id="5409006">this</span>&nbsp;<span class="op" id="5409011">&lt;</span>&nbsp;<span class="ident" id="5409013">line1</span><span class="op" id="5409018">;</span>&nbsp;<span class="ident" id="5409020">this</span><span class="op" id="5409024">++</span>&nbsp;<span class="op" id="5409027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409031">line</span>&nbsp;<span class="op" id="5409036">:=</span>&nbsp;<span class="ident" id="5409039">b</span><span class="op" id="5409040">.</span><span class="ident" id="5409041">lines</span><span class="op" id="5409046">[</span><span class="ident" id="5409047">this</span><span class="op" id="5409051">]</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409056">if</span>&nbsp;<span class="ident" id="5409059">column</span>&nbsp;<span class="op" id="5409066">&lt;</span>&nbsp;<span class="builtinfunc" id="5409068">len</span><span class="op" id="5409071">(</span><span class="ident" id="5409072">line</span><span class="op" id="5409076">)</span><span class="op" id="5409077">-</span><span class="num" id="5409078">1</span>&nbsp;<span class="op" id="5409080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409085">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column&nbsp;=&gt;&nbsp;this&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409131">//&nbsp;has&nbsp;more&nbsp;cells&nbsp;than&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409175">//&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;is&nbsp;ignored&nbsp;because&nbsp;cells&nbsp;are</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409234">//&nbsp;tab-terminated;&nbsp;the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409293">//&nbsp;text&nbsp;before&nbsp;the&nbsp;newline/formfeed&nbsp;and&nbsp;does&nbsp;not&nbsp;belong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409352">//&nbsp;to&nbsp;a&nbsp;column)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409372">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;beginning&nbsp;of&nbsp;block</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409425">pos</span>&nbsp;<span class="op" id="5409429">=</span>&nbsp;<span class="ident" id="5409431">b</span><span class="op" id="5409432">.</span><span class="ident" id="5409433">writeLines</span><span class="op" id="5409443">(</span><span class="ident" id="5409444">pos</span><span class="op" id="5409447">,</span>&nbsp;<span class="ident" id="5409449">line0</span><span class="op" id="5409454">,</span>&nbsp;<span class="ident" id="5409456">this</span><span class="op" id="5409460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409465">line0</span>&nbsp;<span class="op" id="5409471">=</span>&nbsp;<span class="ident" id="5409473">this</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409482">//&nbsp;column&nbsp;block&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409507">width</span>&nbsp;<span class="op" id="5409513">:=</span>&nbsp;<span class="ident" id="5409516">b</span><span class="op" id="5409517">.</span><span class="ident" id="5409518">minwidth</span>&nbsp;<span class="comment" id="5409527">//&nbsp;minimal&nbsp;column&nbsp;width</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409554">discardable</span>&nbsp;<span class="op" id="5409566">:=</span>&nbsp;<span class="builtintype" id="5409569">true</span>&nbsp;<span class="comment" id="5409574">//&nbsp;true&nbsp;if&nbsp;all&nbsp;cells&nbsp;in&nbsp;this&nbsp;column&nbsp;are&nbsp;empty&nbsp;and&nbsp;&#34;soft&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409634">for</span>&nbsp;<span class="op" id="5409638">;</span>&nbsp;<span class="ident" id="5409640">this</span>&nbsp;<span class="op" id="5409645">&lt;</span>&nbsp;<span class="ident" id="5409647">line1</span><span class="op" id="5409652">;</span>&nbsp;<span class="ident" id="5409654">this</span><span class="op" id="5409658">++</span>&nbsp;<span class="op" id="5409661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409667">line</span>&nbsp;<span class="op" id="5409672">=</span>&nbsp;<span class="ident" id="5409674">b</span><span class="op" id="5409675">.</span><span class="ident" id="5409676">lines</span><span class="op" id="5409681">[</span><span class="ident" id="5409682">this</span><span class="op" id="5409686">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409692">if</span>&nbsp;<span class="ident" id="5409695">column</span>&nbsp;<span class="op" id="5409702">&lt;</span>&nbsp;<span class="builtinfunc" id="5409704">len</span><span class="op" id="5409707">(</span><span class="ident" id="5409708">line</span><span class="op" id="5409712">)</span><span class="op" id="5409713">-</span><span class="num" id="5409714">1</span>&nbsp;<span class="op" id="5409716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409723">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409758">c</span>&nbsp;<span class="op" id="5409760">:=</span>&nbsp;<span class="ident" id="5409763">line</span><span class="op" id="5409767">[</span><span class="ident" id="5409768">column</span><span class="op" id="5409774">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409781">//&nbsp;update&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409802">if</span>&nbsp;<span class="ident" id="5409805">w</span>&nbsp;<span class="op" id="5409807">:=</span>&nbsp;<span class="ident" id="5409810">c</span><span class="op" id="5409811">.</span><span class="ident" id="5409812">width</span>&nbsp;<span class="op" id="5409818">+</span>&nbsp;<span class="ident" id="5409820">b</span><span class="op" id="5409821">.</span><span class="ident" id="5409822">padding</span><span class="op" id="5409829">;</span>&nbsp;<span class="ident" id="5409831">w</span>&nbsp;<span class="op" id="5409833">&gt;</span>&nbsp;<span class="ident" id="5409835">width</span>&nbsp;<span class="op" id="5409841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409849">width</span>&nbsp;<span class="op" id="5409855">=</span>&nbsp;<span class="ident" id="5409857">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409864">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409871">//&nbsp;update&nbsp;discardable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409898">if</span>&nbsp;<span class="ident" id="5409901">c</span><span class="op" id="5409902">.</span><span class="ident" id="5409903">width</span>&nbsp;<span class="op" id="5409909">&gt;</span>&nbsp;<span class="num" id="5409911">0</span>&nbsp;<span class="op" id="5409913">||</span>&nbsp;<span class="ident" id="5409916">c</span><span class="op" id="5409917">.</span><span class="ident" id="5409918">htab</span>&nbsp;<span class="op" id="5409923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409931">discardable</span>&nbsp;<span class="op" id="5409943">=</span>&nbsp;<span class="builtintype" id="5409945">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409962">}</span>&nbsp;<span class="keyword" id="5409964">else</span>&nbsp;<span class="op" id="5409969">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409976">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409996">//&nbsp;column&nbsp;block&nbsp;end</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410020">//&nbsp;discard&nbsp;empty&nbsp;columns&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410061">if</span>&nbsp;<span class="ident" id="5410064">discardable</span>&nbsp;<span class="op" id="5410076">&amp;&amp;</span>&nbsp;<span class="ident" id="5410079">b</span><span class="op" id="5410080">.</span><span class="ident" id="5410081">flags</span><span class="op" id="5410086">&amp;</span><span class="ident" id="5410087">DiscardEmptyColumns</span>&nbsp;<span class="op" id="5410107">!=</span>&nbsp;<span class="num" id="5410110">0</span>&nbsp;<span class="op" id="5410112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410118">width</span>&nbsp;<span class="op" id="5410124">=</span>&nbsp;<span class="num" id="5410126">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410137">//&nbsp;format&nbsp;and&nbsp;print&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;right&nbsp;of&nbsp;this&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410200">//&nbsp;(we&nbsp;know&nbsp;the&nbsp;widths&nbsp;of&nbsp;this&nbsp;column&nbsp;and&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;left)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410270">b</span><span class="op" id="5410271">.</span><span class="ident" id="5410272">widths</span>&nbsp;<span class="op" id="5410279">=</span>&nbsp;<span class="builtinfunc" id="5410281">append</span><span class="op" id="5410287">(</span><span class="ident" id="5410288">b</span><span class="op" id="5410289">.</span><span class="ident" id="5410290">widths</span><span class="op" id="5410296">,</span>&nbsp;<span class="ident" id="5410298">width</span><span class="op" id="5410303">)</span>&nbsp;<span class="comment" id="5410305">//&nbsp;push&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410322">pos</span>&nbsp;<span class="op" id="5410326">=</span>&nbsp;<span class="ident" id="5410328">b</span><span class="op" id="5410329">.</span><span class="ident" id="5410330">format</span><span class="op" id="5410336">(</span><span class="ident" id="5410337">pos</span><span class="op" id="5410340">,</span>&nbsp;<span class="ident" id="5410342">line0</span><span class="op" id="5410347">,</span>&nbsp;<span class="ident" id="5410349">this</span><span class="op" id="5410353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410358">b</span><span class="op" id="5410359">.</span><span class="ident" id="5410360">widths</span>&nbsp;<span class="op" id="5410367">=</span>&nbsp;<span class="ident" id="5410369">b</span><span class="op" id="5410370">.</span><span class="ident" id="5410371">widths</span><span class="op" id="5410377">[</span><span class="num" id="5410378">0</span>&nbsp;<span class="op" id="5410380">:</span>&nbsp;<span class="builtinfunc" id="5410382">len</span><span class="op" id="5410385">(</span><span class="ident" id="5410386">b</span><span class="op" id="5410387">.</span><span class="ident" id="5410388">widths</span><span class="op" id="5410394">)</span><span class="op" id="5410395">-</span><span class="num" id="5410396">1</span><span class="op" id="5410397">]</span>&nbsp;<span class="comment" id="5410399">//&nbsp;pop&nbsp;width</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410415">line0</span>&nbsp;<span class="op" id="5410421">=</span>&nbsp;<span class="ident" id="5410423">this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410437">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;end</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410473">return</span>&nbsp;<span class="ident" id="5410480">b</span><span class="op" id="5410481">.</span><span class="ident" id="5410482">writeLines</span><span class="op" id="5410492">(</span><span class="ident" id="5410493">pos</span><span class="op" id="5410496">,</span>&nbsp;<span class="ident" id="5410498">line0</span><span class="op" id="5410503">,</span>&nbsp;<span class="ident" id="5410505">line1</span><span class="op" id="5410510">)</span><br>
<span class="lineno"></span><span class="op" id="5410512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5410515">//&nbsp;Append&nbsp;text&nbsp;to&nbsp;current&nbsp;cell.</span><br>
<span class="lineno"></span><span class="keyword" id="5410547">func</span>&nbsp;<span class="op" id="5410552">(</span><span class="ident" id="5410553">b</span>&nbsp;<span class="op" id="5410555">*</span><span class="ident" id="5410556">Writer</span><span class="op" id="5410562">)</span>&nbsp;<span class="builtinfunc" id="5410564">append</span><span class="op" id="5410570">(</span><span class="ident" id="5410571">text</span>&nbsp;<span class="op" id="5410576">[</span><span class="op" id="5410577">]</span><span class="builtintype" id="5410578">byte</span><span class="op" id="5410582">)</span>&nbsp;<span class="op" id="5410584">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410587">b</span><span class="op" id="5410588">.</span><span class="ident" id="5410589">buf</span><span class="op" id="5410592">.</span><span class="ident" id="5410593">Write</span><span class="op" id="5410598">(</span><span class="ident" id="5410599">text</span><span class="op" id="5410603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410606">b</span><span class="op" id="5410607">.</span><span class="ident" id="5410608">cell</span><span class="op" id="5410612">.</span><span class="ident" id="5410613">size</span>&nbsp;<span class="op" id="5410618">+=</span>&nbsp;<span class="builtinfunc" id="5410621">len</span><span class="op" id="5410624">(</span><span class="ident" id="5410625">text</span><span class="op" id="5410629">)</span><br>
<span class="lineno"></span><span class="op" id="5410631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5410634">//&nbsp;Update&nbsp;the&nbsp;cell&nbsp;width.</span><br>
<span class="lineno">380</span><span class="keyword" id="5410660">func</span>&nbsp;<span class="op" id="5410665">(</span><span class="ident" id="5410666">b</span>&nbsp;<span class="op" id="5410668">*</span><span class="ident" id="5410669">Writer</span><span class="op" id="5410675">)</span>&nbsp;<span class="ident" id="5410677">updateWidth</span><span class="op" id="5410688">(</span><span class="op" id="5410689">)</span>&nbsp;<span class="op" id="5410691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410694">b</span><span class="op" id="5410695">.</span><span class="ident" id="5410696">cell</span><span class="op" id="5410700">.</span><span class="ident" id="5410701">width</span>&nbsp;<span class="op" id="5410707">+=</span>&nbsp;<span class="ident" id="5410710">utf8</span><span class="op" id="5410714">.</span><span class="ident" id="5410715">RuneCount</span><span class="op" id="5410724">(</span><span class="ident" id="5410725">b</span><span class="op" id="5410726">.</span><span class="ident" id="5410727">buf</span><span class="op" id="5410730">.</span><span class="ident" id="5410731">Bytes</span><span class="op" id="5410736">(</span><span class="op" id="5410737">)</span><span class="op" id="5410738">[</span><span class="ident" id="5410739">b</span><span class="op" id="5410740">.</span><span class="ident" id="5410741">pos</span><span class="op" id="5410744">:</span><span class="ident" id="5410745">b</span><span class="op" id="5410746">.</span><span class="ident" id="5410747">buf</span><span class="op" id="5410750">.</span><span class="ident" id="5410751">Len</span><span class="op" id="5410754">(</span><span class="op" id="5410755">)</span><span class="op" id="5410756">]</span><span class="op" id="5410757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410760">b</span><span class="op" id="5410761">.</span><span class="ident" id="5410762">pos</span>&nbsp;<span class="op" id="5410766">=</span>&nbsp;<span class="ident" id="5410768">b</span><span class="op" id="5410769">.</span><span class="ident" id="5410770">buf</span><span class="op" id="5410773">.</span><span class="ident" id="5410774">Len</span><span class="op" id="5410777">(</span><span class="op" id="5410778">)</span><br>
<span class="lineno"></span><span class="op" id="5410780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5410783">//&nbsp;To&nbsp;escape&nbsp;a&nbsp;text&nbsp;segment,&nbsp;bracket&nbsp;it&nbsp;with&nbsp;Escape&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="5410847">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;tab&nbsp;in&nbsp;this&nbsp;string&nbsp;&#34;Ignore&nbsp;this&nbsp;tab:&nbsp;\xff\t\xff&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5410917">//&nbsp;does&nbsp;not&nbsp;terminate&nbsp;a&nbsp;cell&nbsp;and&nbsp;constitutes&nbsp;a&nbsp;single&nbsp;character&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5410984">//&nbsp;width&nbsp;one&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5411022">//</span><br>
<span class="lineno">390</span><span class="comment" id="5411025">//&nbsp;The&nbsp;value&nbsp;0xff&nbsp;was&nbsp;chosen&nbsp;because&nbsp;it&nbsp;cannot&nbsp;appear&nbsp;in&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="5411106">//</span><br>
<span class="lineno"></span><span class="keyword" id="5411109">const</span>&nbsp;<span class="ident" id="5411115">Escape</span>&nbsp;<span class="op" id="5411122">=</span>&nbsp;<span class="string" id="5411124">&#39;\xff&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5411132">//&nbsp;Start&nbsp;escaped&nbsp;mode.</span><br>
<span class="lineno">395</span><span class="keyword" id="5411155">func</span>&nbsp;<span class="op" id="5411160">(</span><span class="ident" id="5411161">b</span>&nbsp;<span class="op" id="5411163">*</span><span class="ident" id="5411164">Writer</span><span class="op" id="5411170">)</span>&nbsp;<span class="ident" id="5411172">startEscape</span><span class="op" id="5411183">(</span><span class="ident" id="5411184">ch</span>&nbsp;<span class="builtintype" id="5411187">byte</span><span class="op" id="5411191">)</span>&nbsp;<span class="op" id="5411193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411196">switch</span>&nbsp;<span class="ident" id="5411203">ch</span>&nbsp;<span class="op" id="5411206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411209">case</span>&nbsp;<span class="ident" id="5411214">Escape</span><span class="op" id="5411220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411224">b</span><span class="op" id="5411225">.</span><span class="ident" id="5411226">endChar</span>&nbsp;<span class="op" id="5411234">=</span>&nbsp;<span class="ident" id="5411236">Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411244">case</span>&nbsp;<span class="string" id="5411249">&#39;&lt;&#39;</span><span class="op" id="5411252">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411256">b</span><span class="op" id="5411257">.</span><span class="ident" id="5411258">endChar</span>&nbsp;<span class="op" id="5411266">=</span>&nbsp;<span class="string" id="5411268">&#39;&gt;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411273">case</span>&nbsp;<span class="string" id="5411278">&#39;&amp;&#39;</span><span class="op" id="5411281">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411285">b</span><span class="op" id="5411286">.</span><span class="ident" id="5411287">endChar</span>&nbsp;<span class="op" id="5411295">=</span>&nbsp;<span class="string" id="5411297">&#39;;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411302">}</span><br>
<span class="lineno"></span><span class="op" id="5411304">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="5411307">//&nbsp;Terminate&nbsp;escaped&nbsp;mode.&nbsp;If&nbsp;the&nbsp;escaped&nbsp;text&nbsp;was&nbsp;an&nbsp;HTML&nbsp;tag,&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="5411381">//&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;for&nbsp;formatting&nbsp;purposes;&nbsp;if&nbsp;it&nbsp;was&nbsp;an&nbsp;HTML&nbsp;entity,</span><br>
<span class="lineno"></span><span class="comment" id="5411457">//&nbsp;its&nbsp;width&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;one.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;the&nbsp;width&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5411529">//&nbsp;unicode&nbsp;width&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno">410</span><span class="comment" id="5411559">//</span><br>
<span class="lineno"></span><span class="keyword" id="5411562">func</span>&nbsp;<span class="op" id="5411567">(</span><span class="ident" id="5411568">b</span>&nbsp;<span class="op" id="5411570">*</span><span class="ident" id="5411571">Writer</span><span class="op" id="5411577">)</span>&nbsp;<span class="ident" id="5411579">endEscape</span><span class="op" id="5411588">(</span><span class="op" id="5411589">)</span>&nbsp;<span class="op" id="5411591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411594">switch</span>&nbsp;<span class="ident" id="5411601">b</span><span class="op" id="5411602">.</span><span class="ident" id="5411603">endChar</span>&nbsp;<span class="op" id="5411611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411614">case</span>&nbsp;<span class="ident" id="5411619">Escape</span><span class="op" id="5411625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411629">b</span><span class="op" id="5411630">.</span><span class="ident" id="5411631">updateWidth</span><span class="op" id="5411642">(</span><span class="op" id="5411643">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411647">if</span>&nbsp;<span class="ident" id="5411650">b</span><span class="op" id="5411651">.</span><span class="ident" id="5411652">flags</span><span class="op" id="5411657">&amp;</span><span class="ident" id="5411658">StripEscape</span>&nbsp;<span class="op" id="5411670">==</span>&nbsp;<span class="num" id="5411673">0</span>&nbsp;<span class="op" id="5411675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411680">b</span><span class="op" id="5411681">.</span><span class="ident" id="5411682">cell</span><span class="op" id="5411686">.</span><span class="ident" id="5411687">width</span>&nbsp;<span class="op" id="5411693">-=</span>&nbsp;<span class="num" id="5411696">2</span>&nbsp;<span class="comment" id="5411698">//&nbsp;don&#39;t&nbsp;count&nbsp;the&nbsp;Escape&nbsp;chars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411735">case</span>&nbsp;<span class="string" id="5411740">&#39;&gt;&#39;</span><span class="op" id="5411743">:</span>&nbsp;<span class="comment" id="5411745">//&nbsp;tag&nbsp;of&nbsp;zero&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411767">case</span>&nbsp;<span class="string" id="5411772">&#39;;&#39;</span><span class="op" id="5411775">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411779">b</span><span class="op" id="5411780">.</span><span class="ident" id="5411781">cell</span><span class="op" id="5411785">.</span><span class="ident" id="5411786">width</span><span class="op" id="5411791">++</span>&nbsp;<span class="comment" id="5411794">//&nbsp;entity,&nbsp;count&nbsp;as&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411827">b</span><span class="op" id="5411828">.</span><span class="ident" id="5411829">pos</span>&nbsp;<span class="op" id="5411833">=</span>&nbsp;<span class="ident" id="5411835">b</span><span class="op" id="5411836">.</span><span class="ident" id="5411837">buf</span><span class="op" id="5411840">.</span><span class="ident" id="5411841">Len</span><span class="op" id="5411844">(</span><span class="op" id="5411845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411848">b</span><span class="op" id="5411849">.</span><span class="ident" id="5411850">endChar</span>&nbsp;<span class="op" id="5411858">=</span>&nbsp;<span class="num" id="5411860">0</span><br>
<span class="lineno"></span><span class="op" id="5411862">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="5411865">//&nbsp;Terminate&nbsp;the&nbsp;current&nbsp;cell&nbsp;by&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;cells&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5411936">//&nbsp;current&nbsp;line.&nbsp;Returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cells&nbsp;in&nbsp;that&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="5411995">//</span><br>
<span class="lineno"></span><span class="keyword" id="5411998">func</span>&nbsp;<span class="op" id="5412003">(</span><span class="ident" id="5412004">b</span>&nbsp;<span class="op" id="5412006">*</span><span class="ident" id="5412007">Writer</span><span class="op" id="5412013">)</span>&nbsp;<span class="ident" id="5412015">terminateCell</span><span class="op" id="5412028">(</span><span class="ident" id="5412029">htab</span>&nbsp;<span class="builtintype" id="5412034">bool</span><span class="op" id="5412038">)</span>&nbsp;<span class="builtintype" id="5412040">int</span>&nbsp;<span class="op" id="5412044">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412047">b</span><span class="op" id="5412048">.</span><span class="ident" id="5412049">cell</span><span class="op" id="5412053">.</span><span class="ident" id="5412054">htab</span>&nbsp;<span class="op" id="5412059">=</span>&nbsp;<span class="ident" id="5412061">htab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412067">line</span>&nbsp;<span class="op" id="5412072">:=</span>&nbsp;<span class="op" id="5412075">&amp;</span><span class="ident" id="5412076">b</span><span class="op" id="5412077">.</span><span class="ident" id="5412078">lines</span><span class="op" id="5412083">[</span><span class="builtinfunc" id="5412084">len</span><span class="op" id="5412087">(</span><span class="ident" id="5412088">b</span><span class="op" id="5412089">.</span><span class="ident" id="5412090">lines</span><span class="op" id="5412095">)</span><span class="op" id="5412096">-</span><span class="num" id="5412097">1</span><span class="op" id="5412098">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412101">*</span><span class="ident" id="5412102">line</span>&nbsp;<span class="op" id="5412107">=</span>&nbsp;<span class="builtinfunc" id="5412109">append</span><span class="op" id="5412115">(</span><span class="op" id="5412116">*</span><span class="ident" id="5412117">line</span><span class="op" id="5412121">,</span>&nbsp;<span class="ident" id="5412123">b</span><span class="op" id="5412124">.</span><span class="ident" id="5412125">cell</span><span class="op" id="5412129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412132">b</span><span class="op" id="5412133">.</span><span class="ident" id="5412134">cell</span>&nbsp;<span class="op" id="5412139">=</span>&nbsp;<span class="ident" id="5412141">cell</span><span class="op" id="5412145">{</span><span class="op" id="5412146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412149">return</span>&nbsp;<span class="builtinfunc" id="5412156">len</span><span class="op" id="5412159">(</span><span class="op" id="5412160">*</span><span class="ident" id="5412161">line</span><span class="op" id="5412165">)</span><br>
<span class="lineno">435</span><span class="op" id="5412167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5412170">func</span>&nbsp;<span class="ident" id="5412175">handlePanic</span><span class="op" id="5412186">(</span><span class="ident" id="5412187">err</span>&nbsp;<span class="op" id="5412191">*</span><span class="builtintype" id="5412192">error</span><span class="op" id="5412197">,</span>&nbsp;<span class="ident" id="5412199">op</span>&nbsp;<span class="builtintype" id="5412202">string</span><span class="op" id="5412208">)</span>&nbsp;<span class="op" id="5412210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412213">if</span>&nbsp;<span class="ident" id="5412216">e</span>&nbsp;<span class="op" id="5412218">:=</span>&nbsp;<span class="builtinfunc" id="5412221">recover</span><span class="op" id="5412228">(</span><span class="op" id="5412229">)</span><span class="op" id="5412230">;</span>&nbsp;<span class="ident" id="5412232">e</span>&nbsp;<span class="op" id="5412234">!=</span>&nbsp;<span class="ident" id="5412237">nil</span>&nbsp;<span class="op" id="5412241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412245">if</span>&nbsp;<span class="ident" id="5412248">nerr</span><span class="op" id="5412252">,</span>&nbsp;<span class="ident" id="5412254">ok</span>&nbsp;<span class="op" id="5412257">:=</span>&nbsp;<span class="ident" id="5412260">e</span><span class="op" id="5412261">.</span><span class="op" id="5412262">(</span><span class="ident" id="5412263">osError</span><span class="op" id="5412270">)</span><span class="op" id="5412271">;</span>&nbsp;<span class="ident" id="5412273">ok</span>&nbsp;<span class="op" id="5412276">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412281">*</span><span class="ident" id="5412282">err</span>&nbsp;<span class="op" id="5412286">=</span>&nbsp;<span class="ident" id="5412288">nerr</span><span class="op" id="5412292">.</span><span class="ident" id="5412293">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412300">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5412313">panic</span><span class="op" id="5412318">(</span><span class="string" id="5412319">&#34;tabwriter:&nbsp;panic&nbsp;during&nbsp;&#34;</span>&nbsp;<span class="op" id="5412346">+</span>&nbsp;<span class="ident" id="5412348">op</span><span class="op" id="5412350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412353">}</span><br>
<span class="lineno">445</span><span class="op" id="5412355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5412358">//&nbsp;Flush&nbsp;should&nbsp;be&nbsp;called&nbsp;after&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Write&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5412423">//&nbsp;that&nbsp;any&nbsp;data&nbsp;buffered&nbsp;in&nbsp;the&nbsp;Writer&nbsp;is&nbsp;written&nbsp;to&nbsp;output.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5412489">//&nbsp;incomplete&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;end&nbsp;is&nbsp;considered</span><br>
<span class="lineno">450</span><span class="comment" id="5412544">//&nbsp;complete&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5412581">//</span><br>
<span class="lineno"></span><span class="keyword" id="5412584">func</span>&nbsp;<span class="op" id="5412589">(</span><span class="ident" id="5412590">b</span>&nbsp;<span class="op" id="5412592">*</span><span class="ident" id="5412593">Writer</span><span class="op" id="5412599">)</span>&nbsp;<span class="ident" id="5412601">Flush</span><span class="op" id="5412606">(</span><span class="op" id="5412607">)</span>&nbsp;<span class="op" id="5412609">(</span><span class="ident" id="5412610">err</span>&nbsp;<span class="builtintype" id="5412614">error</span><span class="op" id="5412619">)</span>&nbsp;<span class="op" id="5412621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412624">defer</span>&nbsp;<span class="ident" id="5412630">b</span><span class="op" id="5412631">.</span><span class="ident" id="5412632">reset</span><span class="op" id="5412637">(</span><span class="op" id="5412638">)</span>&nbsp;<span class="comment" id="5412640">//&nbsp;even&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412675">defer</span>&nbsp;<span class="ident" id="5412681">handlePanic</span><span class="op" id="5412692">(</span><span class="op" id="5412693">&amp;</span><span class="ident" id="5412694">err</span><span class="op" id="5412697">,</span>&nbsp;<span class="string" id="5412699">&#34;Flush&#34;</span><span class="op" id="5412706">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5412710">//&nbsp;add&nbsp;current&nbsp;cell&nbsp;if&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412744">if</span>&nbsp;<span class="ident" id="5412747">b</span><span class="op" id="5412748">.</span><span class="ident" id="5412749">cell</span><span class="op" id="5412753">.</span><span class="ident" id="5412754">size</span>&nbsp;<span class="op" id="5412759">&gt;</span>&nbsp;<span class="num" id="5412761">0</span>&nbsp;<span class="op" id="5412763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412767">if</span>&nbsp;<span class="ident" id="5412770">b</span><span class="op" id="5412771">.</span><span class="ident" id="5412772">endChar</span>&nbsp;<span class="op" id="5412780">!=</span>&nbsp;<span class="num" id="5412783">0</span>&nbsp;<span class="op" id="5412785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5412790">//&nbsp;inside&nbsp;escape&nbsp;-&nbsp;terminate&nbsp;it&nbsp;even&nbsp;if&nbsp;incomplete</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412844">b</span><span class="op" id="5412845">.</span><span class="ident" id="5412846">endEscape</span><span class="op" id="5412855">(</span><span class="op" id="5412856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412864">b</span><span class="op" id="5412865">.</span><span class="ident" id="5412866">terminateCell</span><span class="op" id="5412879">(</span><span class="builtintype" id="5412880">false</span><span class="op" id="5412885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5412892">//&nbsp;format&nbsp;contents&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412922">b</span><span class="op" id="5412923">.</span><span class="ident" id="5412924">format</span><span class="op" id="5412930">(</span><span class="num" id="5412931">0</span><span class="op" id="5412932">,</span>&nbsp;<span class="num" id="5412934">0</span><span class="op" id="5412935">,</span>&nbsp;<span class="builtinfunc" id="5412937">len</span><span class="op" id="5412940">(</span><span class="ident" id="5412941">b</span><span class="op" id="5412942">.</span><span class="ident" id="5412943">lines</span><span class="op" id="5412948">)</span><span class="op" id="5412949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412953">return</span><br>
<span class="lineno"></span><span class="op" id="5412960">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="5412963">var</span>&nbsp;<span class="ident" id="5412967">hbar</span>&nbsp;<span class="op" id="5412972">=</span>&nbsp;<span class="op" id="5412974">[</span><span class="op" id="5412975">]</span><span class="builtintype" id="5412976">byte</span><span class="op" id="5412980">(</span><span class="string" id="5412981">&#34;---\n&#34;</span><span class="op" id="5412988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5412991">//&nbsp;Write&nbsp;writes&nbsp;buf&nbsp;to&nbsp;the&nbsp;writer&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="5413028">//&nbsp;The&nbsp;only&nbsp;errors&nbsp;returned&nbsp;are&nbsp;ones&nbsp;encountered</span><br>
<span class="lineno">475</span><span class="comment" id="5413077">//&nbsp;while&nbsp;writing&nbsp;to&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="5413127">//</span><br>
<span class="lineno"></span><span class="keyword" id="5413130">func</span>&nbsp;<span class="op" id="5413135">(</span><span class="ident" id="5413136">b</span>&nbsp;<span class="op" id="5413138">*</span><span class="ident" id="5413139">Writer</span><span class="op" id="5413145">)</span>&nbsp;<span class="ident" id="5413147">Write</span><span class="op" id="5413152">(</span><span class="ident" id="5413153">buf</span>&nbsp;<span class="op" id="5413157">[</span><span class="op" id="5413158">]</span><span class="builtintype" id="5413159">byte</span><span class="op" id="5413163">)</span>&nbsp;<span class="op" id="5413165">(</span><span class="ident" id="5413166">n</span>&nbsp;<span class="builtintype" id="5413168">int</span><span class="op" id="5413171">,</span>&nbsp;<span class="ident" id="5413173">err</span>&nbsp;<span class="builtintype" id="5413177">error</span><span class="op" id="5413182">)</span>&nbsp;<span class="op" id="5413184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413187">defer</span>&nbsp;<span class="ident" id="5413193">handlePanic</span><span class="op" id="5413204">(</span><span class="op" id="5413205">&amp;</span><span class="ident" id="5413206">err</span><span class="op" id="5413209">,</span>&nbsp;<span class="string" id="5413211">&#34;Write&#34;</span><span class="op" id="5413218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413222">//&nbsp;split&nbsp;text&nbsp;into&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413248">n</span>&nbsp;<span class="op" id="5413250">=</span>&nbsp;<span class="num" id="5413252">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413255">for</span>&nbsp;<span class="ident" id="5413259">i</span><span class="op" id="5413260">,</span>&nbsp;<span class="ident" id="5413262">ch</span>&nbsp;<span class="op" id="5413265">:=</span>&nbsp;<span class="keyword" id="5413268">range</span>&nbsp;<span class="ident" id="5413274">buf</span>&nbsp;<span class="op" id="5413278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413282">if</span>&nbsp;<span class="ident" id="5413285">b</span><span class="op" id="5413286">.</span><span class="ident" id="5413287">endChar</span>&nbsp;<span class="op" id="5413295">==</span>&nbsp;<span class="num" id="5413298">0</span>&nbsp;<span class="op" id="5413300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413305">//&nbsp;outside&nbsp;escape</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413326">switch</span>&nbsp;<span class="ident" id="5413333">ch</span>&nbsp;<span class="op" id="5413336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413341">case</span>&nbsp;<span class="string" id="5413346">&#39;\t&#39;</span><span class="op" id="5413350">,</span>&nbsp;<span class="string" id="5413352">&#39;\v&#39;</span><span class="op" id="5413356">,</span>&nbsp;<span class="string" id="5413358">&#39;\n&#39;</span><span class="op" id="5413362">,</span>&nbsp;<span class="string" id="5413364">&#39;\f&#39;</span><span class="op" id="5413368">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413374">//&nbsp;end&nbsp;of&nbsp;cell</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413393">b</span><span class="op" id="5413394">.</span><span class="builtinfunc" id="5413395">append</span><span class="op" id="5413401">(</span><span class="ident" id="5413402">buf</span><span class="op" id="5413405">[</span><span class="ident" id="5413406">n</span><span class="op" id="5413407">:</span><span class="ident" id="5413408">i</span><span class="op" id="5413409">]</span><span class="op" id="5413410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413416">b</span><span class="op" id="5413417">.</span><span class="ident" id="5413418">updateWidth</span><span class="op" id="5413429">(</span><span class="op" id="5413430">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413436">n</span>&nbsp;<span class="op" id="5413438">=</span>&nbsp;<span class="ident" id="5413440">i</span>&nbsp;<span class="op" id="5413442">+</span>&nbsp;<span class="num" id="5413444">1</span>&nbsp;<span class="comment" id="5413446">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413465">ncells</span>&nbsp;<span class="op" id="5413472">:=</span>&nbsp;<span class="ident" id="5413475">b</span><span class="op" id="5413476">.</span><span class="ident" id="5413477">terminateCell</span><span class="op" id="5413490">(</span><span class="ident" id="5413491">ch</span>&nbsp;<span class="op" id="5413494">==</span>&nbsp;<span class="string" id="5413497">&#39;\t&#39;</span><span class="op" id="5413501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413507">if</span>&nbsp;<span class="ident" id="5413510">ch</span>&nbsp;<span class="op" id="5413513">==</span>&nbsp;<span class="string" id="5413516">&#39;\n&#39;</span>&nbsp;<span class="op" id="5413521">||</span>&nbsp;<span class="ident" id="5413524">ch</span>&nbsp;<span class="op" id="5413527">==</span>&nbsp;<span class="string" id="5413530">&#39;\f&#39;</span>&nbsp;<span class="op" id="5413535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413542">//&nbsp;terminate&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413565">b</span><span class="op" id="5413566">.</span><span class="ident" id="5413567">addLine</span><span class="op" id="5413574">(</span><span class="op" id="5413575">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413582">if</span>&nbsp;<span class="ident" id="5413585">ch</span>&nbsp;<span class="op" id="5413588">==</span>&nbsp;<span class="string" id="5413591">&#39;\f&#39;</span>&nbsp;<span class="op" id="5413596">||</span>&nbsp;<span class="ident" id="5413599">ncells</span>&nbsp;<span class="op" id="5413606">==</span>&nbsp;<span class="num" id="5413609">1</span>&nbsp;<span class="op" id="5413611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413619">//&nbsp;A&nbsp;&#39;\f&#39;&nbsp;always&nbsp;forces&nbsp;a&nbsp;flush.&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;previous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413685">//&nbsp;line&nbsp;has&nbsp;only&nbsp;one&nbsp;cell&nbsp;which&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;impact&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413750">//&nbsp;the&nbsp;formatting&nbsp;of&nbsp;the&nbsp;following&nbsp;lines&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413816">//&nbsp;line&nbsp;is&nbsp;ignored&nbsp;by&nbsp;format()),&nbsp;thus&nbsp;we&nbsp;can&nbsp;flush&nbsp;the</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413877">//&nbsp;Writer&nbsp;contents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413903">if</span>&nbsp;<span class="ident" id="5413906">err</span>&nbsp;<span class="op" id="5413910">=</span>&nbsp;<span class="ident" id="5413912">b</span><span class="op" id="5413913">.</span><span class="ident" id="5413914">Flush</span><span class="op" id="5413919">(</span><span class="op" id="5413920">)</span><span class="op" id="5413921">;</span>&nbsp;<span class="ident" id="5413923">err</span>&nbsp;<span class="op" id="5413927">!=</span>&nbsp;<span class="ident" id="5413930">nil</span>&nbsp;<span class="op" id="5413934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413943">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413964">if</span>&nbsp;<span class="ident" id="5413967">ch</span>&nbsp;<span class="op" id="5413970">==</span>&nbsp;<span class="string" id="5413973">&#39;\f&#39;</span>&nbsp;<span class="op" id="5413978">&amp;&amp;</span>&nbsp;<span class="ident" id="5413981">b</span><span class="op" id="5413982">.</span><span class="ident" id="5413983">flags</span><span class="op" id="5413988">&amp;</span><span class="ident" id="5413989">Debug</span>&nbsp;<span class="op" id="5413995">!=</span>&nbsp;<span class="num" id="5413998">0</span>&nbsp;<span class="op" id="5414000">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414009">//&nbsp;indicate&nbsp;section&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414042">b</span><span class="op" id="5414043">.</span><span class="ident" id="5414044">write0</span><span class="op" id="5414050">(</span><span class="ident" id="5414051">hbar</span><span class="op" id="5414055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414076">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414082">case</span>&nbsp;<span class="ident" id="5414087">Escape</span><span class="op" id="5414093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414099">//&nbsp;start&nbsp;of&nbsp;escaped&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414132">b</span><span class="op" id="5414133">.</span><span class="builtinfunc" id="5414134">append</span><span class="op" id="5414140">(</span><span class="ident" id="5414141">buf</span><span class="op" id="5414144">[</span><span class="ident" id="5414145">n</span><span class="op" id="5414146">:</span><span class="ident" id="5414147">i</span><span class="op" id="5414148">]</span><span class="op" id="5414149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414155">b</span><span class="op" id="5414156">.</span><span class="ident" id="5414157">updateWidth</span><span class="op" id="5414168">(</span><span class="op" id="5414169">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414175">n</span>&nbsp;<span class="op" id="5414177">=</span>&nbsp;<span class="ident" id="5414179">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414185">if</span>&nbsp;<span class="ident" id="5414188">b</span><span class="op" id="5414189">.</span><span class="ident" id="5414190">flags</span><span class="op" id="5414195">&amp;</span><span class="ident" id="5414196">StripEscape</span>&nbsp;<span class="op" id="5414208">!=</span>&nbsp;<span class="num" id="5414211">0</span>&nbsp;<span class="op" id="5414213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414220">n</span><span class="op" id="5414221">++</span>&nbsp;<span class="comment" id="5414224">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414250">b</span><span class="op" id="5414251">.</span><span class="ident" id="5414252">startEscape</span><span class="op" id="5414263">(</span><span class="ident" id="5414264">Escape</span><span class="op" id="5414270">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414276">case</span>&nbsp;<span class="string" id="5414281">&#39;&lt;&#39;</span><span class="op" id="5414284">,</span>&nbsp;<span class="string" id="5414286">&#39;&amp;&#39;</span><span class="op" id="5414289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414295">//&nbsp;possibly&nbsp;an&nbsp;html&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414330">if</span>&nbsp;<span class="ident" id="5414333">b</span><span class="op" id="5414334">.</span><span class="ident" id="5414335">flags</span><span class="op" id="5414340">&amp;</span><span class="ident" id="5414341">FilterHTML</span>&nbsp;<span class="op" id="5414352">!=</span>&nbsp;<span class="num" id="5414355">0</span>&nbsp;<span class="op" id="5414357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414364">//&nbsp;begin&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414392">b</span><span class="op" id="5414393">.</span><span class="builtinfunc" id="5414394">append</span><span class="op" id="5414400">(</span><span class="ident" id="5414401">buf</span><span class="op" id="5414404">[</span><span class="ident" id="5414405">n</span><span class="op" id="5414406">:</span><span class="ident" id="5414407">i</span><span class="op" id="5414408">]</span><span class="op" id="5414409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414416">b</span><span class="op" id="5414417">.</span><span class="ident" id="5414418">updateWidth</span><span class="op" id="5414429">(</span><span class="op" id="5414430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414437">n</span>&nbsp;<span class="op" id="5414439">=</span>&nbsp;<span class="ident" id="5414441">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414448">b</span><span class="op" id="5414449">.</span><span class="ident" id="5414450">startEscape</span><span class="op" id="5414461">(</span><span class="ident" id="5414462">ch</span><span class="op" id="5414464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414470">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414480">}</span>&nbsp;<span class="keyword" id="5414482">else</span>&nbsp;<span class="op" id="5414487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414492">//&nbsp;inside&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414512">if</span>&nbsp;<span class="ident" id="5414515">ch</span>&nbsp;<span class="op" id="5414518">==</span>&nbsp;<span class="ident" id="5414521">b</span><span class="op" id="5414522">.</span><span class="ident" id="5414523">endChar</span>&nbsp;<span class="op" id="5414531">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414537">//&nbsp;end&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414562">j</span>&nbsp;<span class="op" id="5414564">:=</span>&nbsp;<span class="ident" id="5414567">i</span>&nbsp;<span class="op" id="5414569">+</span>&nbsp;<span class="num" id="5414571">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414577">if</span>&nbsp;<span class="ident" id="5414580">ch</span>&nbsp;<span class="op" id="5414583">==</span>&nbsp;<span class="ident" id="5414586">Escape</span>&nbsp;<span class="op" id="5414593">&amp;&amp;</span>&nbsp;<span class="ident" id="5414596">b</span><span class="op" id="5414597">.</span><span class="ident" id="5414598">flags</span><span class="op" id="5414603">&amp;</span><span class="ident" id="5414604">StripEscape</span>&nbsp;<span class="op" id="5414616">!=</span>&nbsp;<span class="num" id="5414619">0</span>&nbsp;<span class="op" id="5414621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414628">j</span>&nbsp;<span class="op" id="5414630">=</span>&nbsp;<span class="ident" id="5414632">i</span>&nbsp;<span class="comment" id="5414634">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414654">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414660">b</span><span class="op" id="5414661">.</span><span class="builtinfunc" id="5414662">append</span><span class="op" id="5414668">(</span><span class="ident" id="5414669">buf</span><span class="op" id="5414672">[</span><span class="ident" id="5414673">n</span><span class="op" id="5414674">:</span><span class="ident" id="5414675">j</span><span class="op" id="5414676">]</span><span class="op" id="5414677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414683">n</span>&nbsp;<span class="op" id="5414685">=</span>&nbsp;<span class="ident" id="5414687">i</span>&nbsp;<span class="op" id="5414689">+</span>&nbsp;<span class="num" id="5414691">1</span>&nbsp;<span class="comment" id="5414693">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414712">b</span><span class="op" id="5414713">.</span><span class="ident" id="5414714">endEscape</span><span class="op" id="5414723">(</span><span class="op" id="5414724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414733">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414740">//&nbsp;append&nbsp;leftover&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414765">b</span><span class="op" id="5414766">.</span><span class="builtinfunc" id="5414767">append</span><span class="op" id="5414773">(</span><span class="ident" id="5414774">buf</span><span class="op" id="5414777">[</span><span class="ident" id="5414778">n</span><span class="op" id="5414779">:</span><span class="op" id="5414780">]</span><span class="op" id="5414781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414784">n</span>&nbsp;<span class="op" id="5414786">=</span>&nbsp;<span class="builtinfunc" id="5414788">len</span><span class="op" id="5414791">(</span><span class="ident" id="5414792">buf</span><span class="op" id="5414795">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414798">return</span><br>
<span class="lineno"></span><span class="op" id="5414805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5414808">//&nbsp;NewWriter&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;tabwriter.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5414871">//&nbsp;The&nbsp;parameters&nbsp;are&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;the&nbsp;Init&nbsp;function.</span><br>
<span class="lineno">555</span><span class="comment" id="5414928">//</span><br>
<span class="lineno"></span><span class="keyword" id="5414931">func</span>&nbsp;<span class="ident" id="5414936">NewWriter</span><span class="op" id="5414945">(</span><span class="ident" id="5414946">output</span>&nbsp;<span class="ident" id="5414953">io</span><span class="op" id="5414955">.</span><span class="ident" id="5414956">Writer</span><span class="op" id="5414962">,</span>&nbsp;<span class="ident" id="5414964">minwidth</span><span class="op" id="5414972">,</span>&nbsp;<span class="ident" id="5414974">tabwidth</span><span class="op" id="5414982">,</span>&nbsp;<span class="ident" id="5414984">padding</span>&nbsp;<span class="builtintype" id="5414992">int</span><span class="op" id="5414995">,</span>&nbsp;<span class="ident" id="5414997">padchar</span>&nbsp;<span class="builtintype" id="5415005">byte</span><span class="op" id="5415009">,</span>&nbsp;<span class="ident" id="5415011">flags</span>&nbsp;<span class="builtintype" id="5415017">uint</span><span class="op" id="5415021">)</span>&nbsp;<span class="op" id="5415023">*</span><span class="ident" id="5415024">Writer</span>&nbsp;<span class="op" id="5415031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415034">return</span>&nbsp;<span class="builtinfunc" id="5415041">new</span><span class="op" id="5415044">(</span><span class="ident" id="5415045">Writer</span><span class="op" id="5415051">)</span><span class="op" id="5415052">.</span><span class="ident" id="5415053">Init</span><span class="op" id="5415057">(</span><span class="ident" id="5415058">output</span><span class="op" id="5415064">,</span>&nbsp;<span class="ident" id="5415066">minwidth</span><span class="op" id="5415074">,</span>&nbsp;<span class="ident" id="5415076">tabwidth</span><span class="op" id="5415084">,</span>&nbsp;<span class="ident" id="5415086">padding</span><span class="op" id="5415093">,</span>&nbsp;<span class="ident" id="5415095">padchar</span><span class="op" id="5415102">,</span>&nbsp;<span class="ident" id="5415104">flags</span><span class="op" id="5415109">)</span><br>
<span class="lineno"></span><span class="op" id="5415111">}</span>
</div>
</body>
</html>
