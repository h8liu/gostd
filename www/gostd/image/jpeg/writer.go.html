<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5918660">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5918715">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5918769">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5918820">package</span>&nbsp;<span class="ident" id="5918828">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5918834">import</span>&nbsp;<span class="op" id="5918841">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5918844">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5918853">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5918863">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5918872">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5918887">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5918892">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5918895">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="5918939">func</span>&nbsp;<span class="ident" id="5918944">min</span><span class="op" id="5918947">(</span><span class="ident" id="5918948">x</span><span class="op" id="5918949">,</span>&nbsp;<span class="ident" id="5918951">y</span>&nbsp;<span class="builtintype" id="5918953">int</span><span class="op" id="5918956">)</span>&nbsp;<span class="builtintype" id="5918958">int</span>&nbsp;<span class="op" id="5918962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918965">if</span>&nbsp;<span class="ident" id="5918968">x</span>&nbsp;<span class="op" id="5918970">&lt;</span>&nbsp;<span class="ident" id="5918972">y</span>&nbsp;<span class="op" id="5918974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918978">return</span>&nbsp;<span class="ident" id="5918985">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918988">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918991">return</span>&nbsp;<span class="ident" id="5918998">y</span><br>
<span class="lineno"></span><span class="op" id="5919000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5919003">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="5919082">func</span>&nbsp;<span class="ident" id="5919087">div</span><span class="op" id="5919090">(</span><span class="ident" id="5919091">a</span><span class="op" id="5919092">,</span>&nbsp;<span class="ident" id="5919094">b</span>&nbsp;<span class="builtintype" id="5919096">int32</span><span class="op" id="5919101">)</span>&nbsp;<span class="builtintype" id="5919103">int32</span>&nbsp;<span class="op" id="5919109">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919112">if</span>&nbsp;<span class="ident" id="5919115">a</span>&nbsp;<span class="op" id="5919117">&gt;=</span>&nbsp;<span class="num" id="5919120">0</span>&nbsp;<span class="op" id="5919122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919126">return</span>&nbsp;<span class="op" id="5919133">(</span><span class="ident" id="5919134">a</span>&nbsp;<span class="op" id="5919136">+</span>&nbsp;<span class="op" id="5919138">(</span><span class="ident" id="5919139">b</span>&nbsp;<span class="op" id="5919141">&gt;&gt;</span>&nbsp;<span class="num" id="5919144">1</span><span class="op" id="5919145">)</span><span class="op" id="5919146">)</span>&nbsp;<span class="op" id="5919148">/</span>&nbsp;<span class="ident" id="5919150">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919156">return</span>&nbsp;<span class="op" id="5919163">-</span><span class="op" id="5919164">(</span><span class="op" id="5919165">(</span><span class="op" id="5919166">-</span><span class="ident" id="5919167">a</span>&nbsp;<span class="op" id="5919169">+</span>&nbsp;<span class="op" id="5919171">(</span><span class="ident" id="5919172">b</span>&nbsp;<span class="op" id="5919174">&gt;&gt;</span>&nbsp;<span class="num" id="5919177">1</span><span class="op" id="5919178">)</span><span class="op" id="5919179">)</span>&nbsp;<span class="op" id="5919181">/</span>&nbsp;<span class="ident" id="5919183">b</span><span class="op" id="5919184">)</span><br>
<span class="lineno"></span><span class="op" id="5919186">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5919189">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5919254">var</span>&nbsp;<span class="ident" id="5919258">bitCount</span>&nbsp;<span class="op" id="5919267">=</span>&nbsp;<span class="op" id="5919269">[</span><span class="num" id="5919270">256</span><span class="op" id="5919273">]</span><span class="builtintype" id="5919274">byte</span><span class="op" id="5919278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919281">0</span><span class="op" id="5919282">,</span>&nbsp;<span class="num" id="5919284">1</span><span class="op" id="5919285">,</span>&nbsp;<span class="num" id="5919287">2</span><span class="op" id="5919288">,</span>&nbsp;<span class="num" id="5919290">2</span><span class="op" id="5919291">,</span>&nbsp;<span class="num" id="5919293">3</span><span class="op" id="5919294">,</span>&nbsp;<span class="num" id="5919296">3</span><span class="op" id="5919297">,</span>&nbsp;<span class="num" id="5919299">3</span><span class="op" id="5919300">,</span>&nbsp;<span class="num" id="5919302">3</span><span class="op" id="5919303">,</span>&nbsp;<span class="num" id="5919305">4</span><span class="op" id="5919306">,</span>&nbsp;<span class="num" id="5919308">4</span><span class="op" id="5919309">,</span>&nbsp;<span class="num" id="5919311">4</span><span class="op" id="5919312">,</span>&nbsp;<span class="num" id="5919314">4</span><span class="op" id="5919315">,</span>&nbsp;<span class="num" id="5919317">4</span><span class="op" id="5919318">,</span>&nbsp;<span class="num" id="5919320">4</span><span class="op" id="5919321">,</span>&nbsp;<span class="num" id="5919323">4</span><span class="op" id="5919324">,</span>&nbsp;<span class="num" id="5919326">4</span><span class="op" id="5919327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919330">5</span><span class="op" id="5919331">,</span>&nbsp;<span class="num" id="5919333">5</span><span class="op" id="5919334">,</span>&nbsp;<span class="num" id="5919336">5</span><span class="op" id="5919337">,</span>&nbsp;<span class="num" id="5919339">5</span><span class="op" id="5919340">,</span>&nbsp;<span class="num" id="5919342">5</span><span class="op" id="5919343">,</span>&nbsp;<span class="num" id="5919345">5</span><span class="op" id="5919346">,</span>&nbsp;<span class="num" id="5919348">5</span><span class="op" id="5919349">,</span>&nbsp;<span class="num" id="5919351">5</span><span class="op" id="5919352">,</span>&nbsp;<span class="num" id="5919354">5</span><span class="op" id="5919355">,</span>&nbsp;<span class="num" id="5919357">5</span><span class="op" id="5919358">,</span>&nbsp;<span class="num" id="5919360">5</span><span class="op" id="5919361">,</span>&nbsp;<span class="num" id="5919363">5</span><span class="op" id="5919364">,</span>&nbsp;<span class="num" id="5919366">5</span><span class="op" id="5919367">,</span>&nbsp;<span class="num" id="5919369">5</span><span class="op" id="5919370">,</span>&nbsp;<span class="num" id="5919372">5</span><span class="op" id="5919373">,</span>&nbsp;<span class="num" id="5919375">5</span><span class="op" id="5919376">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919379">6</span><span class="op" id="5919380">,</span>&nbsp;<span class="num" id="5919382">6</span><span class="op" id="5919383">,</span>&nbsp;<span class="num" id="5919385">6</span><span class="op" id="5919386">,</span>&nbsp;<span class="num" id="5919388">6</span><span class="op" id="5919389">,</span>&nbsp;<span class="num" id="5919391">6</span><span class="op" id="5919392">,</span>&nbsp;<span class="num" id="5919394">6</span><span class="op" id="5919395">,</span>&nbsp;<span class="num" id="5919397">6</span><span class="op" id="5919398">,</span>&nbsp;<span class="num" id="5919400">6</span><span class="op" id="5919401">,</span>&nbsp;<span class="num" id="5919403">6</span><span class="op" id="5919404">,</span>&nbsp;<span class="num" id="5919406">6</span><span class="op" id="5919407">,</span>&nbsp;<span class="num" id="5919409">6</span><span class="op" id="5919410">,</span>&nbsp;<span class="num" id="5919412">6</span><span class="op" id="5919413">,</span>&nbsp;<span class="num" id="5919415">6</span><span class="op" id="5919416">,</span>&nbsp;<span class="num" id="5919418">6</span><span class="op" id="5919419">,</span>&nbsp;<span class="num" id="5919421">6</span><span class="op" id="5919422">,</span>&nbsp;<span class="num" id="5919424">6</span><span class="op" id="5919425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919428">6</span><span class="op" id="5919429">,</span>&nbsp;<span class="num" id="5919431">6</span><span class="op" id="5919432">,</span>&nbsp;<span class="num" id="5919434">6</span><span class="op" id="5919435">,</span>&nbsp;<span class="num" id="5919437">6</span><span class="op" id="5919438">,</span>&nbsp;<span class="num" id="5919440">6</span><span class="op" id="5919441">,</span>&nbsp;<span class="num" id="5919443">6</span><span class="op" id="5919444">,</span>&nbsp;<span class="num" id="5919446">6</span><span class="op" id="5919447">,</span>&nbsp;<span class="num" id="5919449">6</span><span class="op" id="5919450">,</span>&nbsp;<span class="num" id="5919452">6</span><span class="op" id="5919453">,</span>&nbsp;<span class="num" id="5919455">6</span><span class="op" id="5919456">,</span>&nbsp;<span class="num" id="5919458">6</span><span class="op" id="5919459">,</span>&nbsp;<span class="num" id="5919461">6</span><span class="op" id="5919462">,</span>&nbsp;<span class="num" id="5919464">6</span><span class="op" id="5919465">,</span>&nbsp;<span class="num" id="5919467">6</span><span class="op" id="5919468">,</span>&nbsp;<span class="num" id="5919470">6</span><span class="op" id="5919471">,</span>&nbsp;<span class="num" id="5919473">6</span><span class="op" id="5919474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919477">7</span><span class="op" id="5919478">,</span>&nbsp;<span class="num" id="5919480">7</span><span class="op" id="5919481">,</span>&nbsp;<span class="num" id="5919483">7</span><span class="op" id="5919484">,</span>&nbsp;<span class="num" id="5919486">7</span><span class="op" id="5919487">,</span>&nbsp;<span class="num" id="5919489">7</span><span class="op" id="5919490">,</span>&nbsp;<span class="num" id="5919492">7</span><span class="op" id="5919493">,</span>&nbsp;<span class="num" id="5919495">7</span><span class="op" id="5919496">,</span>&nbsp;<span class="num" id="5919498">7</span><span class="op" id="5919499">,</span>&nbsp;<span class="num" id="5919501">7</span><span class="op" id="5919502">,</span>&nbsp;<span class="num" id="5919504">7</span><span class="op" id="5919505">,</span>&nbsp;<span class="num" id="5919507">7</span><span class="op" id="5919508">,</span>&nbsp;<span class="num" id="5919510">7</span><span class="op" id="5919511">,</span>&nbsp;<span class="num" id="5919513">7</span><span class="op" id="5919514">,</span>&nbsp;<span class="num" id="5919516">7</span><span class="op" id="5919517">,</span>&nbsp;<span class="num" id="5919519">7</span><span class="op" id="5919520">,</span>&nbsp;<span class="num" id="5919522">7</span><span class="op" id="5919523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919526">7</span><span class="op" id="5919527">,</span>&nbsp;<span class="num" id="5919529">7</span><span class="op" id="5919530">,</span>&nbsp;<span class="num" id="5919532">7</span><span class="op" id="5919533">,</span>&nbsp;<span class="num" id="5919535">7</span><span class="op" id="5919536">,</span>&nbsp;<span class="num" id="5919538">7</span><span class="op" id="5919539">,</span>&nbsp;<span class="num" id="5919541">7</span><span class="op" id="5919542">,</span>&nbsp;<span class="num" id="5919544">7</span><span class="op" id="5919545">,</span>&nbsp;<span class="num" id="5919547">7</span><span class="op" id="5919548">,</span>&nbsp;<span class="num" id="5919550">7</span><span class="op" id="5919551">,</span>&nbsp;<span class="num" id="5919553">7</span><span class="op" id="5919554">,</span>&nbsp;<span class="num" id="5919556">7</span><span class="op" id="5919557">,</span>&nbsp;<span class="num" id="5919559">7</span><span class="op" id="5919560">,</span>&nbsp;<span class="num" id="5919562">7</span><span class="op" id="5919563">,</span>&nbsp;<span class="num" id="5919565">7</span><span class="op" id="5919566">,</span>&nbsp;<span class="num" id="5919568">7</span><span class="op" id="5919569">,</span>&nbsp;<span class="num" id="5919571">7</span><span class="op" id="5919572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919575">7</span><span class="op" id="5919576">,</span>&nbsp;<span class="num" id="5919578">7</span><span class="op" id="5919579">,</span>&nbsp;<span class="num" id="5919581">7</span><span class="op" id="5919582">,</span>&nbsp;<span class="num" id="5919584">7</span><span class="op" id="5919585">,</span>&nbsp;<span class="num" id="5919587">7</span><span class="op" id="5919588">,</span>&nbsp;<span class="num" id="5919590">7</span><span class="op" id="5919591">,</span>&nbsp;<span class="num" id="5919593">7</span><span class="op" id="5919594">,</span>&nbsp;<span class="num" id="5919596">7</span><span class="op" id="5919597">,</span>&nbsp;<span class="num" id="5919599">7</span><span class="op" id="5919600">,</span>&nbsp;<span class="num" id="5919602">7</span><span class="op" id="5919603">,</span>&nbsp;<span class="num" id="5919605">7</span><span class="op" id="5919606">,</span>&nbsp;<span class="num" id="5919608">7</span><span class="op" id="5919609">,</span>&nbsp;<span class="num" id="5919611">7</span><span class="op" id="5919612">,</span>&nbsp;<span class="num" id="5919614">7</span><span class="op" id="5919615">,</span>&nbsp;<span class="num" id="5919617">7</span><span class="op" id="5919618">,</span>&nbsp;<span class="num" id="5919620">7</span><span class="op" id="5919621">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919624">7</span><span class="op" id="5919625">,</span>&nbsp;<span class="num" id="5919627">7</span><span class="op" id="5919628">,</span>&nbsp;<span class="num" id="5919630">7</span><span class="op" id="5919631">,</span>&nbsp;<span class="num" id="5919633">7</span><span class="op" id="5919634">,</span>&nbsp;<span class="num" id="5919636">7</span><span class="op" id="5919637">,</span>&nbsp;<span class="num" id="5919639">7</span><span class="op" id="5919640">,</span>&nbsp;<span class="num" id="5919642">7</span><span class="op" id="5919643">,</span>&nbsp;<span class="num" id="5919645">7</span><span class="op" id="5919646">,</span>&nbsp;<span class="num" id="5919648">7</span><span class="op" id="5919649">,</span>&nbsp;<span class="num" id="5919651">7</span><span class="op" id="5919652">,</span>&nbsp;<span class="num" id="5919654">7</span><span class="op" id="5919655">,</span>&nbsp;<span class="num" id="5919657">7</span><span class="op" id="5919658">,</span>&nbsp;<span class="num" id="5919660">7</span><span class="op" id="5919661">,</span>&nbsp;<span class="num" id="5919663">7</span><span class="op" id="5919664">,</span>&nbsp;<span class="num" id="5919666">7</span><span class="op" id="5919667">,</span>&nbsp;<span class="num" id="5919669">7</span><span class="op" id="5919670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919673">8</span><span class="op" id="5919674">,</span>&nbsp;<span class="num" id="5919676">8</span><span class="op" id="5919677">,</span>&nbsp;<span class="num" id="5919679">8</span><span class="op" id="5919680">,</span>&nbsp;<span class="num" id="5919682">8</span><span class="op" id="5919683">,</span>&nbsp;<span class="num" id="5919685">8</span><span class="op" id="5919686">,</span>&nbsp;<span class="num" id="5919688">8</span><span class="op" id="5919689">,</span>&nbsp;<span class="num" id="5919691">8</span><span class="op" id="5919692">,</span>&nbsp;<span class="num" id="5919694">8</span><span class="op" id="5919695">,</span>&nbsp;<span class="num" id="5919697">8</span><span class="op" id="5919698">,</span>&nbsp;<span class="num" id="5919700">8</span><span class="op" id="5919701">,</span>&nbsp;<span class="num" id="5919703">8</span><span class="op" id="5919704">,</span>&nbsp;<span class="num" id="5919706">8</span><span class="op" id="5919707">,</span>&nbsp;<span class="num" id="5919709">8</span><span class="op" id="5919710">,</span>&nbsp;<span class="num" id="5919712">8</span><span class="op" id="5919713">,</span>&nbsp;<span class="num" id="5919715">8</span><span class="op" id="5919716">,</span>&nbsp;<span class="num" id="5919718">8</span><span class="op" id="5919719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919722">8</span><span class="op" id="5919723">,</span>&nbsp;<span class="num" id="5919725">8</span><span class="op" id="5919726">,</span>&nbsp;<span class="num" id="5919728">8</span><span class="op" id="5919729">,</span>&nbsp;<span class="num" id="5919731">8</span><span class="op" id="5919732">,</span>&nbsp;<span class="num" id="5919734">8</span><span class="op" id="5919735">,</span>&nbsp;<span class="num" id="5919737">8</span><span class="op" id="5919738">,</span>&nbsp;<span class="num" id="5919740">8</span><span class="op" id="5919741">,</span>&nbsp;<span class="num" id="5919743">8</span><span class="op" id="5919744">,</span>&nbsp;<span class="num" id="5919746">8</span><span class="op" id="5919747">,</span>&nbsp;<span class="num" id="5919749">8</span><span class="op" id="5919750">,</span>&nbsp;<span class="num" id="5919752">8</span><span class="op" id="5919753">,</span>&nbsp;<span class="num" id="5919755">8</span><span class="op" id="5919756">,</span>&nbsp;<span class="num" id="5919758">8</span><span class="op" id="5919759">,</span>&nbsp;<span class="num" id="5919761">8</span><span class="op" id="5919762">,</span>&nbsp;<span class="num" id="5919764">8</span><span class="op" id="5919765">,</span>&nbsp;<span class="num" id="5919767">8</span><span class="op" id="5919768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919771">8</span><span class="op" id="5919772">,</span>&nbsp;<span class="num" id="5919774">8</span><span class="op" id="5919775">,</span>&nbsp;<span class="num" id="5919777">8</span><span class="op" id="5919778">,</span>&nbsp;<span class="num" id="5919780">8</span><span class="op" id="5919781">,</span>&nbsp;<span class="num" id="5919783">8</span><span class="op" id="5919784">,</span>&nbsp;<span class="num" id="5919786">8</span><span class="op" id="5919787">,</span>&nbsp;<span class="num" id="5919789">8</span><span class="op" id="5919790">,</span>&nbsp;<span class="num" id="5919792">8</span><span class="op" id="5919793">,</span>&nbsp;<span class="num" id="5919795">8</span><span class="op" id="5919796">,</span>&nbsp;<span class="num" id="5919798">8</span><span class="op" id="5919799">,</span>&nbsp;<span class="num" id="5919801">8</span><span class="op" id="5919802">,</span>&nbsp;<span class="num" id="5919804">8</span><span class="op" id="5919805">,</span>&nbsp;<span class="num" id="5919807">8</span><span class="op" id="5919808">,</span>&nbsp;<span class="num" id="5919810">8</span><span class="op" id="5919811">,</span>&nbsp;<span class="num" id="5919813">8</span><span class="op" id="5919814">,</span>&nbsp;<span class="num" id="5919816">8</span><span class="op" id="5919817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919820">8</span><span class="op" id="5919821">,</span>&nbsp;<span class="num" id="5919823">8</span><span class="op" id="5919824">,</span>&nbsp;<span class="num" id="5919826">8</span><span class="op" id="5919827">,</span>&nbsp;<span class="num" id="5919829">8</span><span class="op" id="5919830">,</span>&nbsp;<span class="num" id="5919832">8</span><span class="op" id="5919833">,</span>&nbsp;<span class="num" id="5919835">8</span><span class="op" id="5919836">,</span>&nbsp;<span class="num" id="5919838">8</span><span class="op" id="5919839">,</span>&nbsp;<span class="num" id="5919841">8</span><span class="op" id="5919842">,</span>&nbsp;<span class="num" id="5919844">8</span><span class="op" id="5919845">,</span>&nbsp;<span class="num" id="5919847">8</span><span class="op" id="5919848">,</span>&nbsp;<span class="num" id="5919850">8</span><span class="op" id="5919851">,</span>&nbsp;<span class="num" id="5919853">8</span><span class="op" id="5919854">,</span>&nbsp;<span class="num" id="5919856">8</span><span class="op" id="5919857">,</span>&nbsp;<span class="num" id="5919859">8</span><span class="op" id="5919860">,</span>&nbsp;<span class="num" id="5919862">8</span><span class="op" id="5919863">,</span>&nbsp;<span class="num" id="5919865">8</span><span class="op" id="5919866">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919869">8</span><span class="op" id="5919870">,</span>&nbsp;<span class="num" id="5919872">8</span><span class="op" id="5919873">,</span>&nbsp;<span class="num" id="5919875">8</span><span class="op" id="5919876">,</span>&nbsp;<span class="num" id="5919878">8</span><span class="op" id="5919879">,</span>&nbsp;<span class="num" id="5919881">8</span><span class="op" id="5919882">,</span>&nbsp;<span class="num" id="5919884">8</span><span class="op" id="5919885">,</span>&nbsp;<span class="num" id="5919887">8</span><span class="op" id="5919888">,</span>&nbsp;<span class="num" id="5919890">8</span><span class="op" id="5919891">,</span>&nbsp;<span class="num" id="5919893">8</span><span class="op" id="5919894">,</span>&nbsp;<span class="num" id="5919896">8</span><span class="op" id="5919897">,</span>&nbsp;<span class="num" id="5919899">8</span><span class="op" id="5919900">,</span>&nbsp;<span class="num" id="5919902">8</span><span class="op" id="5919903">,</span>&nbsp;<span class="num" id="5919905">8</span><span class="op" id="5919906">,</span>&nbsp;<span class="num" id="5919908">8</span><span class="op" id="5919909">,</span>&nbsp;<span class="num" id="5919911">8</span><span class="op" id="5919912">,</span>&nbsp;<span class="num" id="5919914">8</span><span class="op" id="5919915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919918">8</span><span class="op" id="5919919">,</span>&nbsp;<span class="num" id="5919921">8</span><span class="op" id="5919922">,</span>&nbsp;<span class="num" id="5919924">8</span><span class="op" id="5919925">,</span>&nbsp;<span class="num" id="5919927">8</span><span class="op" id="5919928">,</span>&nbsp;<span class="num" id="5919930">8</span><span class="op" id="5919931">,</span>&nbsp;<span class="num" id="5919933">8</span><span class="op" id="5919934">,</span>&nbsp;<span class="num" id="5919936">8</span><span class="op" id="5919937">,</span>&nbsp;<span class="num" id="5919939">8</span><span class="op" id="5919940">,</span>&nbsp;<span class="num" id="5919942">8</span><span class="op" id="5919943">,</span>&nbsp;<span class="num" id="5919945">8</span><span class="op" id="5919946">,</span>&nbsp;<span class="num" id="5919948">8</span><span class="op" id="5919949">,</span>&nbsp;<span class="num" id="5919951">8</span><span class="op" id="5919952">,</span>&nbsp;<span class="num" id="5919954">8</span><span class="op" id="5919955">,</span>&nbsp;<span class="num" id="5919957">8</span><span class="op" id="5919958">,</span>&nbsp;<span class="num" id="5919960">8</span><span class="op" id="5919961">,</span>&nbsp;<span class="num" id="5919963">8</span><span class="op" id="5919964">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5919967">8</span><span class="op" id="5919968">,</span>&nbsp;<span class="num" id="5919970">8</span><span class="op" id="5919971">,</span>&nbsp;<span class="num" id="5919973">8</span><span class="op" id="5919974">,</span>&nbsp;<span class="num" id="5919976">8</span><span class="op" id="5919977">,</span>&nbsp;<span class="num" id="5919979">8</span><span class="op" id="5919980">,</span>&nbsp;<span class="num" id="5919982">8</span><span class="op" id="5919983">,</span>&nbsp;<span class="num" id="5919985">8</span><span class="op" id="5919986">,</span>&nbsp;<span class="num" id="5919988">8</span><span class="op" id="5919989">,</span>&nbsp;<span class="num" id="5919991">8</span><span class="op" id="5919992">,</span>&nbsp;<span class="num" id="5919994">8</span><span class="op" id="5919995">,</span>&nbsp;<span class="num" id="5919997">8</span><span class="op" id="5919998">,</span>&nbsp;<span class="num" id="5920000">8</span><span class="op" id="5920001">,</span>&nbsp;<span class="num" id="5920003">8</span><span class="op" id="5920004">,</span>&nbsp;<span class="num" id="5920006">8</span><span class="op" id="5920007">,</span>&nbsp;<span class="num" id="5920009">8</span><span class="op" id="5920010">,</span>&nbsp;<span class="num" id="5920012">8</span><span class="op" id="5920013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920016">8</span><span class="op" id="5920017">,</span>&nbsp;<span class="num" id="5920019">8</span><span class="op" id="5920020">,</span>&nbsp;<span class="num" id="5920022">8</span><span class="op" id="5920023">,</span>&nbsp;<span class="num" id="5920025">8</span><span class="op" id="5920026">,</span>&nbsp;<span class="num" id="5920028">8</span><span class="op" id="5920029">,</span>&nbsp;<span class="num" id="5920031">8</span><span class="op" id="5920032">,</span>&nbsp;<span class="num" id="5920034">8</span><span class="op" id="5920035">,</span>&nbsp;<span class="num" id="5920037">8</span><span class="op" id="5920038">,</span>&nbsp;<span class="num" id="5920040">8</span><span class="op" id="5920041">,</span>&nbsp;<span class="num" id="5920043">8</span><span class="op" id="5920044">,</span>&nbsp;<span class="num" id="5920046">8</span><span class="op" id="5920047">,</span>&nbsp;<span class="num" id="5920049">8</span><span class="op" id="5920050">,</span>&nbsp;<span class="num" id="5920052">8</span><span class="op" id="5920053">,</span>&nbsp;<span class="num" id="5920055">8</span><span class="op" id="5920056">,</span>&nbsp;<span class="num" id="5920058">8</span><span class="op" id="5920059">,</span>&nbsp;<span class="num" id="5920061">8</span><span class="op" id="5920062">,</span><br>
<span class="lineno"></span><span class="op" id="5920064">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5920067">type</span>&nbsp;<span class="ident" id="5920072">quantIndex</span>&nbsp;<span class="builtintype" id="5920083">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5920088">const</span>&nbsp;<span class="op" id="5920094">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920097">quantIndexLuminance</span>&nbsp;<span class="ident" id="5920117">quantIndex</span>&nbsp;<span class="op" id="5920128">=</span>&nbsp;<span class="ident" id="5920130">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920136">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920159">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="5920171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5920174">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="5920251">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5920327">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5920403">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5920421">var</span>&nbsp;<span class="ident" id="5920425">unscaledQuant</span>&nbsp;<span class="op" id="5920439">=</span>&nbsp;<span class="op" id="5920441">[</span><span class="ident" id="5920442">nQuantIndex</span><span class="op" id="5920453">]</span><span class="op" id="5920454">[</span><span class="ident" id="5920455">blockSize</span><span class="op" id="5920464">]</span><span class="builtintype" id="5920465">byte</span><span class="op" id="5920469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920472">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920491">16</span><span class="op" id="5920493">,</span>&nbsp;<span class="num" id="5920495">11</span><span class="op" id="5920497">,</span>&nbsp;<span class="num" id="5920499">12</span><span class="op" id="5920501">,</span>&nbsp;<span class="num" id="5920503">14</span><span class="op" id="5920505">,</span>&nbsp;<span class="num" id="5920507">12</span><span class="op" id="5920509">,</span>&nbsp;<span class="num" id="5920511">10</span><span class="op" id="5920513">,</span>&nbsp;<span class="num" id="5920515">16</span><span class="op" id="5920517">,</span>&nbsp;<span class="num" id="5920519">14</span><span class="op" id="5920521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920525">13</span><span class="op" id="5920527">,</span>&nbsp;<span class="num" id="5920529">14</span><span class="op" id="5920531">,</span>&nbsp;<span class="num" id="5920533">18</span><span class="op" id="5920535">,</span>&nbsp;<span class="num" id="5920537">17</span><span class="op" id="5920539">,</span>&nbsp;<span class="num" id="5920541">16</span><span class="op" id="5920543">,</span>&nbsp;<span class="num" id="5920545">19</span><span class="op" id="5920547">,</span>&nbsp;<span class="num" id="5920549">24</span><span class="op" id="5920551">,</span>&nbsp;<span class="num" id="5920553">40</span><span class="op" id="5920555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920559">26</span><span class="op" id="5920561">,</span>&nbsp;<span class="num" id="5920563">24</span><span class="op" id="5920565">,</span>&nbsp;<span class="num" id="5920567">22</span><span class="op" id="5920569">,</span>&nbsp;<span class="num" id="5920571">22</span><span class="op" id="5920573">,</span>&nbsp;<span class="num" id="5920575">24</span><span class="op" id="5920577">,</span>&nbsp;<span class="num" id="5920579">49</span><span class="op" id="5920581">,</span>&nbsp;<span class="num" id="5920583">35</span><span class="op" id="5920585">,</span>&nbsp;<span class="num" id="5920587">37</span><span class="op" id="5920589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920593">29</span><span class="op" id="5920595">,</span>&nbsp;<span class="num" id="5920597">40</span><span class="op" id="5920599">,</span>&nbsp;<span class="num" id="5920601">58</span><span class="op" id="5920603">,</span>&nbsp;<span class="num" id="5920605">51</span><span class="op" id="5920607">,</span>&nbsp;<span class="num" id="5920609">61</span><span class="op" id="5920611">,</span>&nbsp;<span class="num" id="5920613">60</span><span class="op" id="5920615">,</span>&nbsp;<span class="num" id="5920617">57</span><span class="op" id="5920619">,</span>&nbsp;<span class="num" id="5920621">51</span><span class="op" id="5920623">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920627">56</span><span class="op" id="5920629">,</span>&nbsp;<span class="num" id="5920631">55</span><span class="op" id="5920633">,</span>&nbsp;<span class="num" id="5920635">64</span><span class="op" id="5920637">,</span>&nbsp;<span class="num" id="5920639">72</span><span class="op" id="5920641">,</span>&nbsp;<span class="num" id="5920643">92</span><span class="op" id="5920645">,</span>&nbsp;<span class="num" id="5920647">78</span><span class="op" id="5920649">,</span>&nbsp;<span class="num" id="5920651">64</span><span class="op" id="5920653">,</span>&nbsp;<span class="num" id="5920655">68</span><span class="op" id="5920657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920661">87</span><span class="op" id="5920663">,</span>&nbsp;<span class="num" id="5920665">69</span><span class="op" id="5920667">,</span>&nbsp;<span class="num" id="5920669">55</span><span class="op" id="5920671">,</span>&nbsp;<span class="num" id="5920673">56</span><span class="op" id="5920675">,</span>&nbsp;<span class="num" id="5920677">80</span><span class="op" id="5920679">,</span>&nbsp;<span class="num" id="5920681">109</span><span class="op" id="5920684">,</span>&nbsp;<span class="num" id="5920686">81</span><span class="op" id="5920688">,</span>&nbsp;<span class="num" id="5920690">87</span><span class="op" id="5920692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920696">95</span><span class="op" id="5920698">,</span>&nbsp;<span class="num" id="5920700">98</span><span class="op" id="5920702">,</span>&nbsp;<span class="num" id="5920704">103</span><span class="op" id="5920707">,</span>&nbsp;<span class="num" id="5920709">104</span><span class="op" id="5920712">,</span>&nbsp;<span class="num" id="5920714">103</span><span class="op" id="5920717">,</span>&nbsp;<span class="num" id="5920719">62</span><span class="op" id="5920721">,</span>&nbsp;<span class="num" id="5920723">77</span><span class="op" id="5920725">,</span>&nbsp;<span class="num" id="5920727">113</span><span class="op" id="5920730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920734">121</span><span class="op" id="5920737">,</span>&nbsp;<span class="num" id="5920739">112</span><span class="op" id="5920742">,</span>&nbsp;<span class="num" id="5920744">100</span><span class="op" id="5920747">,</span>&nbsp;<span class="num" id="5920749">120</span><span class="op" id="5920752">,</span>&nbsp;<span class="num" id="5920754">92</span><span class="op" id="5920756">,</span>&nbsp;<span class="num" id="5920758">101</span><span class="op" id="5920761">,</span>&nbsp;<span class="num" id="5920763">103</span><span class="op" id="5920766">,</span>&nbsp;<span class="num" id="5920768">99</span><span class="op" id="5920770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920773">}</span><span class="op" id="5920774">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920777">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920798">17</span><span class="op" id="5920800">,</span>&nbsp;<span class="num" id="5920802">18</span><span class="op" id="5920804">,</span>&nbsp;<span class="num" id="5920806">18</span><span class="op" id="5920808">,</span>&nbsp;<span class="num" id="5920810">24</span><span class="op" id="5920812">,</span>&nbsp;<span class="num" id="5920814">21</span><span class="op" id="5920816">,</span>&nbsp;<span class="num" id="5920818">24</span><span class="op" id="5920820">,</span>&nbsp;<span class="num" id="5920822">47</span><span class="op" id="5920824">,</span>&nbsp;<span class="num" id="5920826">26</span><span class="op" id="5920828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920832">26</span><span class="op" id="5920834">,</span>&nbsp;<span class="num" id="5920836">47</span><span class="op" id="5920838">,</span>&nbsp;<span class="num" id="5920840">99</span><span class="op" id="5920842">,</span>&nbsp;<span class="num" id="5920844">66</span><span class="op" id="5920846">,</span>&nbsp;<span class="num" id="5920848">56</span><span class="op" id="5920850">,</span>&nbsp;<span class="num" id="5920852">66</span><span class="op" id="5920854">,</span>&nbsp;<span class="num" id="5920856">99</span><span class="op" id="5920858">,</span>&nbsp;<span class="num" id="5920860">99</span><span class="op" id="5920862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920866">99</span><span class="op" id="5920868">,</span>&nbsp;<span class="num" id="5920870">99</span><span class="op" id="5920872">,</span>&nbsp;<span class="num" id="5920874">99</span><span class="op" id="5920876">,</span>&nbsp;<span class="num" id="5920878">99</span><span class="op" id="5920880">,</span>&nbsp;<span class="num" id="5920882">99</span><span class="op" id="5920884">,</span>&nbsp;<span class="num" id="5920886">99</span><span class="op" id="5920888">,</span>&nbsp;<span class="num" id="5920890">99</span><span class="op" id="5920892">,</span>&nbsp;<span class="num" id="5920894">99</span><span class="op" id="5920896">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920900">99</span><span class="op" id="5920902">,</span>&nbsp;<span class="num" id="5920904">99</span><span class="op" id="5920906">,</span>&nbsp;<span class="num" id="5920908">99</span><span class="op" id="5920910">,</span>&nbsp;<span class="num" id="5920912">99</span><span class="op" id="5920914">,</span>&nbsp;<span class="num" id="5920916">99</span><span class="op" id="5920918">,</span>&nbsp;<span class="num" id="5920920">99</span><span class="op" id="5920922">,</span>&nbsp;<span class="num" id="5920924">99</span><span class="op" id="5920926">,</span>&nbsp;<span class="num" id="5920928">99</span><span class="op" id="5920930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920934">99</span><span class="op" id="5920936">,</span>&nbsp;<span class="num" id="5920938">99</span><span class="op" id="5920940">,</span>&nbsp;<span class="num" id="5920942">99</span><span class="op" id="5920944">,</span>&nbsp;<span class="num" id="5920946">99</span><span class="op" id="5920948">,</span>&nbsp;<span class="num" id="5920950">99</span><span class="op" id="5920952">,</span>&nbsp;<span class="num" id="5920954">99</span><span class="op" id="5920956">,</span>&nbsp;<span class="num" id="5920958">99</span><span class="op" id="5920960">,</span>&nbsp;<span class="num" id="5920962">99</span><span class="op" id="5920964">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5920968">99</span><span class="op" id="5920970">,</span>&nbsp;<span class="num" id="5920972">99</span><span class="op" id="5920974">,</span>&nbsp;<span class="num" id="5920976">99</span><span class="op" id="5920978">,</span>&nbsp;<span class="num" id="5920980">99</span><span class="op" id="5920982">,</span>&nbsp;<span class="num" id="5920984">99</span><span class="op" id="5920986">,</span>&nbsp;<span class="num" id="5920988">99</span><span class="op" id="5920990">,</span>&nbsp;<span class="num" id="5920992">99</span><span class="op" id="5920994">,</span>&nbsp;<span class="num" id="5920996">99</span><span class="op" id="5920998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5921002">99</span><span class="op" id="5921004">,</span>&nbsp;<span class="num" id="5921006">99</span><span class="op" id="5921008">,</span>&nbsp;<span class="num" id="5921010">99</span><span class="op" id="5921012">,</span>&nbsp;<span class="num" id="5921014">99</span><span class="op" id="5921016">,</span>&nbsp;<span class="num" id="5921018">99</span><span class="op" id="5921020">,</span>&nbsp;<span class="num" id="5921022">99</span><span class="op" id="5921024">,</span>&nbsp;<span class="num" id="5921026">99</span><span class="op" id="5921028">,</span>&nbsp;<span class="num" id="5921030">99</span><span class="op" id="5921032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5921036">99</span><span class="op" id="5921038">,</span>&nbsp;<span class="num" id="5921040">99</span><span class="op" id="5921042">,</span>&nbsp;<span class="num" id="5921044">99</span><span class="op" id="5921046">,</span>&nbsp;<span class="num" id="5921048">99</span><span class="op" id="5921050">,</span>&nbsp;<span class="num" id="5921052">99</span><span class="op" id="5921054">,</span>&nbsp;<span class="num" id="5921056">99</span><span class="op" id="5921058">,</span>&nbsp;<span class="num" id="5921060">99</span><span class="op" id="5921062">,</span>&nbsp;<span class="num" id="5921064">99</span><span class="op" id="5921066">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921069">}</span><span class="op" id="5921070">,</span><br>
<span class="lineno"></span><span class="op" id="5921072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5921075">type</span>&nbsp;<span class="ident" id="5921080">huffIndex</span>&nbsp;<span class="builtintype" id="5921090">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="5921095">const</span>&nbsp;<span class="op" id="5921101">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921104">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="5921125">huffIndex</span>&nbsp;<span class="op" id="5921135">=</span>&nbsp;<span class="ident" id="5921137">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921143">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921165">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921189">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921213">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="5921224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5921227">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5921272">type</span>&nbsp;<span class="ident" id="5921277">huffmanSpec</span>&nbsp;<span class="keyword" id="5921289">struct</span>&nbsp;<span class="op" id="5921296">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921299">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921353">count</span>&nbsp;<span class="op" id="5921359">[</span><span class="num" id="5921360">16</span><span class="op" id="5921362">]</span><span class="builtintype" id="5921363">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921369">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921425">value</span>&nbsp;<span class="op" id="5921431">[</span><span class="op" id="5921432">]</span><span class="builtintype" id="5921433">byte</span><br>
<span class="lineno"></span><span class="op" id="5921438">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="5921441">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="5921499">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="5921562">var</span>&nbsp;<span class="ident" id="5921566">theHuffmanSpec</span>&nbsp;<span class="op" id="5921581">=</span>&nbsp;<span class="op" id="5921583">[</span><span class="ident" id="5921584">nHuffIndex</span><span class="op" id="5921594">]</span><span class="ident" id="5921595">huffmanSpec</span><span class="op" id="5921606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921609">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921631">[</span><span class="num" id="5921632">16</span><span class="op" id="5921634">]</span><span class="builtintype" id="5921635">byte</span><span class="op" id="5921639">{</span><span class="num" id="5921640">0</span><span class="op" id="5921641">,</span>&nbsp;<span class="num" id="5921643">1</span><span class="op" id="5921644">,</span>&nbsp;<span class="num" id="5921646">5</span><span class="op" id="5921647">,</span>&nbsp;<span class="num" id="5921649">1</span><span class="op" id="5921650">,</span>&nbsp;<span class="num" id="5921652">1</span><span class="op" id="5921653">,</span>&nbsp;<span class="num" id="5921655">1</span><span class="op" id="5921656">,</span>&nbsp;<span class="num" id="5921658">1</span><span class="op" id="5921659">,</span>&nbsp;<span class="num" id="5921661">1</span><span class="op" id="5921662">,</span>&nbsp;<span class="num" id="5921664">1</span><span class="op" id="5921665">,</span>&nbsp;<span class="num" id="5921667">0</span><span class="op" id="5921668">,</span>&nbsp;<span class="num" id="5921670">0</span><span class="op" id="5921671">,</span>&nbsp;<span class="num" id="5921673">0</span><span class="op" id="5921674">,</span>&nbsp;<span class="num" id="5921676">0</span><span class="op" id="5921677">,</span>&nbsp;<span class="num" id="5921679">0</span><span class="op" id="5921680">,</span>&nbsp;<span class="num" id="5921682">0</span><span class="op" id="5921683">,</span>&nbsp;<span class="num" id="5921685">0</span><span class="op" id="5921686">}</span><span class="op" id="5921687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921691">[</span><span class="op" id="5921692">]</span><span class="builtintype" id="5921693">byte</span><span class="op" id="5921697">{</span><span class="num" id="5921698">0</span><span class="op" id="5921699">,</span>&nbsp;<span class="num" id="5921701">1</span><span class="op" id="5921702">,</span>&nbsp;<span class="num" id="5921704">2</span><span class="op" id="5921705">,</span>&nbsp;<span class="num" id="5921707">3</span><span class="op" id="5921708">,</span>&nbsp;<span class="num" id="5921710">4</span><span class="op" id="5921711">,</span>&nbsp;<span class="num" id="5921713">5</span><span class="op" id="5921714">,</span>&nbsp;<span class="num" id="5921716">6</span><span class="op" id="5921717">,</span>&nbsp;<span class="num" id="5921719">7</span><span class="op" id="5921720">,</span>&nbsp;<span class="num" id="5921722">8</span><span class="op" id="5921723">,</span>&nbsp;<span class="num" id="5921725">9</span><span class="op" id="5921726">,</span>&nbsp;<span class="num" id="5921728">10</span><span class="op" id="5921730">,</span>&nbsp;<span class="num" id="5921732">11</span><span class="op" id="5921734">}</span><span class="op" id="5921735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921738">}</span><span class="op" id="5921739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921742">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921764">[</span><span class="num" id="5921765">16</span><span class="op" id="5921767">]</span><span class="builtintype" id="5921768">byte</span><span class="op" id="5921772">{</span><span class="num" id="5921773">0</span><span class="op" id="5921774">,</span>&nbsp;<span class="num" id="5921776">2</span><span class="op" id="5921777">,</span>&nbsp;<span class="num" id="5921779">1</span><span class="op" id="5921780">,</span>&nbsp;<span class="num" id="5921782">3</span><span class="op" id="5921783">,</span>&nbsp;<span class="num" id="5921785">3</span><span class="op" id="5921786">,</span>&nbsp;<span class="num" id="5921788">2</span><span class="op" id="5921789">,</span>&nbsp;<span class="num" id="5921791">4</span><span class="op" id="5921792">,</span>&nbsp;<span class="num" id="5921794">3</span><span class="op" id="5921795">,</span>&nbsp;<span class="num" id="5921797">5</span><span class="op" id="5921798">,</span>&nbsp;<span class="num" id="5921800">5</span><span class="op" id="5921801">,</span>&nbsp;<span class="num" id="5921803">4</span><span class="op" id="5921804">,</span>&nbsp;<span class="num" id="5921806">4</span><span class="op" id="5921807">,</span>&nbsp;<span class="num" id="5921809">0</span><span class="op" id="5921810">,</span>&nbsp;<span class="num" id="5921812">0</span><span class="op" id="5921813">,</span>&nbsp;<span class="num" id="5921815">1</span><span class="op" id="5921816">,</span>&nbsp;<span class="num" id="5921818">125</span><span class="op" id="5921821">}</span><span class="op" id="5921822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921826">[</span><span class="op" id="5921827">]</span><span class="builtintype" id="5921828">byte</span><span class="op" id="5921832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5921837">0x01</span><span class="op" id="5921841">,</span>&nbsp;<span class="num" id="5921843">0x02</span><span class="op" id="5921847">,</span>&nbsp;<span class="num" id="5921849">0x03</span><span class="op" id="5921853">,</span>&nbsp;<span class="num" id="5921855">0x00</span><span class="op" id="5921859">,</span>&nbsp;<span class="num" id="5921861">0x04</span><span class="op" id="5921865">,</span>&nbsp;<span class="num" id="5921867">0x11</span><span class="op" id="5921871">,</span>&nbsp;<span class="num" id="5921873">0x05</span><span class="op" id="5921877">,</span>&nbsp;<span class="num" id="5921879">0x12</span><span class="op" id="5921883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5921888">0x21</span><span class="op" id="5921892">,</span>&nbsp;<span class="num" id="5921894">0x31</span><span class="op" id="5921898">,</span>&nbsp;<span class="num" id="5921900">0x41</span><span class="op" id="5921904">,</span>&nbsp;<span class="num" id="5921906">0x06</span><span class="op" id="5921910">,</span>&nbsp;<span class="num" id="5921912">0x13</span><span class="op" id="5921916">,</span>&nbsp;<span class="num" id="5921918">0x51</span><span class="op" id="5921922">,</span>&nbsp;<span class="num" id="5921924">0x61</span><span class="op" id="5921928">,</span>&nbsp;<span class="num" id="5921930">0x07</span><span class="op" id="5921934">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5921939">0x22</span><span class="op" id="5921943">,</span>&nbsp;<span class="num" id="5921945">0x71</span><span class="op" id="5921949">,</span>&nbsp;<span class="num" id="5921951">0x14</span><span class="op" id="5921955">,</span>&nbsp;<span class="num" id="5921957">0x32</span><span class="op" id="5921961">,</span>&nbsp;<span class="num" id="5921963">0x81</span><span class="op" id="5921967">,</span>&nbsp;<span class="num" id="5921969">0x91</span><span class="op" id="5921973">,</span>&nbsp;<span class="num" id="5921975">0xa1</span><span class="op" id="5921979">,</span>&nbsp;<span class="num" id="5921981">0x08</span><span class="op" id="5921985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5921990">0x23</span><span class="op" id="5921994">,</span>&nbsp;<span class="num" id="5921996">0x42</span><span class="op" id="5922000">,</span>&nbsp;<span class="num" id="5922002">0xb1</span><span class="op" id="5922006">,</span>&nbsp;<span class="num" id="5922008">0xc1</span><span class="op" id="5922012">,</span>&nbsp;<span class="num" id="5922014">0x15</span><span class="op" id="5922018">,</span>&nbsp;<span class="num" id="5922020">0x52</span><span class="op" id="5922024">,</span>&nbsp;<span class="num" id="5922026">0xd1</span><span class="op" id="5922030">,</span>&nbsp;<span class="num" id="5922032">0xf0</span><span class="op" id="5922036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922041">0x24</span><span class="op" id="5922045">,</span>&nbsp;<span class="num" id="5922047">0x33</span><span class="op" id="5922051">,</span>&nbsp;<span class="num" id="5922053">0x62</span><span class="op" id="5922057">,</span>&nbsp;<span class="num" id="5922059">0x72</span><span class="op" id="5922063">,</span>&nbsp;<span class="num" id="5922065">0x82</span><span class="op" id="5922069">,</span>&nbsp;<span class="num" id="5922071">0x09</span><span class="op" id="5922075">,</span>&nbsp;<span class="num" id="5922077">0x0a</span><span class="op" id="5922081">,</span>&nbsp;<span class="num" id="5922083">0x16</span><span class="op" id="5922087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922092">0x17</span><span class="op" id="5922096">,</span>&nbsp;<span class="num" id="5922098">0x18</span><span class="op" id="5922102">,</span>&nbsp;<span class="num" id="5922104">0x19</span><span class="op" id="5922108">,</span>&nbsp;<span class="num" id="5922110">0x1a</span><span class="op" id="5922114">,</span>&nbsp;<span class="num" id="5922116">0x25</span><span class="op" id="5922120">,</span>&nbsp;<span class="num" id="5922122">0x26</span><span class="op" id="5922126">,</span>&nbsp;<span class="num" id="5922128">0x27</span><span class="op" id="5922132">,</span>&nbsp;<span class="num" id="5922134">0x28</span><span class="op" id="5922138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922143">0x29</span><span class="op" id="5922147">,</span>&nbsp;<span class="num" id="5922149">0x2a</span><span class="op" id="5922153">,</span>&nbsp;<span class="num" id="5922155">0x34</span><span class="op" id="5922159">,</span>&nbsp;<span class="num" id="5922161">0x35</span><span class="op" id="5922165">,</span>&nbsp;<span class="num" id="5922167">0x36</span><span class="op" id="5922171">,</span>&nbsp;<span class="num" id="5922173">0x37</span><span class="op" id="5922177">,</span>&nbsp;<span class="num" id="5922179">0x38</span><span class="op" id="5922183">,</span>&nbsp;<span class="num" id="5922185">0x39</span><span class="op" id="5922189">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922194">0x3a</span><span class="op" id="5922198">,</span>&nbsp;<span class="num" id="5922200">0x43</span><span class="op" id="5922204">,</span>&nbsp;<span class="num" id="5922206">0x44</span><span class="op" id="5922210">,</span>&nbsp;<span class="num" id="5922212">0x45</span><span class="op" id="5922216">,</span>&nbsp;<span class="num" id="5922218">0x46</span><span class="op" id="5922222">,</span>&nbsp;<span class="num" id="5922224">0x47</span><span class="op" id="5922228">,</span>&nbsp;<span class="num" id="5922230">0x48</span><span class="op" id="5922234">,</span>&nbsp;<span class="num" id="5922236">0x49</span><span class="op" id="5922240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922245">0x4a</span><span class="op" id="5922249">,</span>&nbsp;<span class="num" id="5922251">0x53</span><span class="op" id="5922255">,</span>&nbsp;<span class="num" id="5922257">0x54</span><span class="op" id="5922261">,</span>&nbsp;<span class="num" id="5922263">0x55</span><span class="op" id="5922267">,</span>&nbsp;<span class="num" id="5922269">0x56</span><span class="op" id="5922273">,</span>&nbsp;<span class="num" id="5922275">0x57</span><span class="op" id="5922279">,</span>&nbsp;<span class="num" id="5922281">0x58</span><span class="op" id="5922285">,</span>&nbsp;<span class="num" id="5922287">0x59</span><span class="op" id="5922291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922296">0x5a</span><span class="op" id="5922300">,</span>&nbsp;<span class="num" id="5922302">0x63</span><span class="op" id="5922306">,</span>&nbsp;<span class="num" id="5922308">0x64</span><span class="op" id="5922312">,</span>&nbsp;<span class="num" id="5922314">0x65</span><span class="op" id="5922318">,</span>&nbsp;<span class="num" id="5922320">0x66</span><span class="op" id="5922324">,</span>&nbsp;<span class="num" id="5922326">0x67</span><span class="op" id="5922330">,</span>&nbsp;<span class="num" id="5922332">0x68</span><span class="op" id="5922336">,</span>&nbsp;<span class="num" id="5922338">0x69</span><span class="op" id="5922342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922347">0x6a</span><span class="op" id="5922351">,</span>&nbsp;<span class="num" id="5922353">0x73</span><span class="op" id="5922357">,</span>&nbsp;<span class="num" id="5922359">0x74</span><span class="op" id="5922363">,</span>&nbsp;<span class="num" id="5922365">0x75</span><span class="op" id="5922369">,</span>&nbsp;<span class="num" id="5922371">0x76</span><span class="op" id="5922375">,</span>&nbsp;<span class="num" id="5922377">0x77</span><span class="op" id="5922381">,</span>&nbsp;<span class="num" id="5922383">0x78</span><span class="op" id="5922387">,</span>&nbsp;<span class="num" id="5922389">0x79</span><span class="op" id="5922393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922398">0x7a</span><span class="op" id="5922402">,</span>&nbsp;<span class="num" id="5922404">0x83</span><span class="op" id="5922408">,</span>&nbsp;<span class="num" id="5922410">0x84</span><span class="op" id="5922414">,</span>&nbsp;<span class="num" id="5922416">0x85</span><span class="op" id="5922420">,</span>&nbsp;<span class="num" id="5922422">0x86</span><span class="op" id="5922426">,</span>&nbsp;<span class="num" id="5922428">0x87</span><span class="op" id="5922432">,</span>&nbsp;<span class="num" id="5922434">0x88</span><span class="op" id="5922438">,</span>&nbsp;<span class="num" id="5922440">0x89</span><span class="op" id="5922444">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922449">0x8a</span><span class="op" id="5922453">,</span>&nbsp;<span class="num" id="5922455">0x92</span><span class="op" id="5922459">,</span>&nbsp;<span class="num" id="5922461">0x93</span><span class="op" id="5922465">,</span>&nbsp;<span class="num" id="5922467">0x94</span><span class="op" id="5922471">,</span>&nbsp;<span class="num" id="5922473">0x95</span><span class="op" id="5922477">,</span>&nbsp;<span class="num" id="5922479">0x96</span><span class="op" id="5922483">,</span>&nbsp;<span class="num" id="5922485">0x97</span><span class="op" id="5922489">,</span>&nbsp;<span class="num" id="5922491">0x98</span><span class="op" id="5922495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922500">0x99</span><span class="op" id="5922504">,</span>&nbsp;<span class="num" id="5922506">0x9a</span><span class="op" id="5922510">,</span>&nbsp;<span class="num" id="5922512">0xa2</span><span class="op" id="5922516">,</span>&nbsp;<span class="num" id="5922518">0xa3</span><span class="op" id="5922522">,</span>&nbsp;<span class="num" id="5922524">0xa4</span><span class="op" id="5922528">,</span>&nbsp;<span class="num" id="5922530">0xa5</span><span class="op" id="5922534">,</span>&nbsp;<span class="num" id="5922536">0xa6</span><span class="op" id="5922540">,</span>&nbsp;<span class="num" id="5922542">0xa7</span><span class="op" id="5922546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922551">0xa8</span><span class="op" id="5922555">,</span>&nbsp;<span class="num" id="5922557">0xa9</span><span class="op" id="5922561">,</span>&nbsp;<span class="num" id="5922563">0xaa</span><span class="op" id="5922567">,</span>&nbsp;<span class="num" id="5922569">0xb2</span><span class="op" id="5922573">,</span>&nbsp;<span class="num" id="5922575">0xb3</span><span class="op" id="5922579">,</span>&nbsp;<span class="num" id="5922581">0xb4</span><span class="op" id="5922585">,</span>&nbsp;<span class="num" id="5922587">0xb5</span><span class="op" id="5922591">,</span>&nbsp;<span class="num" id="5922593">0xb6</span><span class="op" id="5922597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922602">0xb7</span><span class="op" id="5922606">,</span>&nbsp;<span class="num" id="5922608">0xb8</span><span class="op" id="5922612">,</span>&nbsp;<span class="num" id="5922614">0xb9</span><span class="op" id="5922618">,</span>&nbsp;<span class="num" id="5922620">0xba</span><span class="op" id="5922624">,</span>&nbsp;<span class="num" id="5922626">0xc2</span><span class="op" id="5922630">,</span>&nbsp;<span class="num" id="5922632">0xc3</span><span class="op" id="5922636">,</span>&nbsp;<span class="num" id="5922638">0xc4</span><span class="op" id="5922642">,</span>&nbsp;<span class="num" id="5922644">0xc5</span><span class="op" id="5922648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922653">0xc6</span><span class="op" id="5922657">,</span>&nbsp;<span class="num" id="5922659">0xc7</span><span class="op" id="5922663">,</span>&nbsp;<span class="num" id="5922665">0xc8</span><span class="op" id="5922669">,</span>&nbsp;<span class="num" id="5922671">0xc9</span><span class="op" id="5922675">,</span>&nbsp;<span class="num" id="5922677">0xca</span><span class="op" id="5922681">,</span>&nbsp;<span class="num" id="5922683">0xd2</span><span class="op" id="5922687">,</span>&nbsp;<span class="num" id="5922689">0xd3</span><span class="op" id="5922693">,</span>&nbsp;<span class="num" id="5922695">0xd4</span><span class="op" id="5922699">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922704">0xd5</span><span class="op" id="5922708">,</span>&nbsp;<span class="num" id="5922710">0xd6</span><span class="op" id="5922714">,</span>&nbsp;<span class="num" id="5922716">0xd7</span><span class="op" id="5922720">,</span>&nbsp;<span class="num" id="5922722">0xd8</span><span class="op" id="5922726">,</span>&nbsp;<span class="num" id="5922728">0xd9</span><span class="op" id="5922732">,</span>&nbsp;<span class="num" id="5922734">0xda</span><span class="op" id="5922738">,</span>&nbsp;<span class="num" id="5922740">0xe1</span><span class="op" id="5922744">,</span>&nbsp;<span class="num" id="5922746">0xe2</span><span class="op" id="5922750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922755">0xe3</span><span class="op" id="5922759">,</span>&nbsp;<span class="num" id="5922761">0xe4</span><span class="op" id="5922765">,</span>&nbsp;<span class="num" id="5922767">0xe5</span><span class="op" id="5922771">,</span>&nbsp;<span class="num" id="5922773">0xe6</span><span class="op" id="5922777">,</span>&nbsp;<span class="num" id="5922779">0xe7</span><span class="op" id="5922783">,</span>&nbsp;<span class="num" id="5922785">0xe8</span><span class="op" id="5922789">,</span>&nbsp;<span class="num" id="5922791">0xe9</span><span class="op" id="5922795">,</span>&nbsp;<span class="num" id="5922797">0xea</span><span class="op" id="5922801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922806">0xf1</span><span class="op" id="5922810">,</span>&nbsp;<span class="num" id="5922812">0xf2</span><span class="op" id="5922816">,</span>&nbsp;<span class="num" id="5922818">0xf3</span><span class="op" id="5922822">,</span>&nbsp;<span class="num" id="5922824">0xf4</span><span class="op" id="5922828">,</span>&nbsp;<span class="num" id="5922830">0xf5</span><span class="op" id="5922834">,</span>&nbsp;<span class="num" id="5922836">0xf6</span><span class="op" id="5922840">,</span>&nbsp;<span class="num" id="5922842">0xf7</span><span class="op" id="5922846">,</span>&nbsp;<span class="num" id="5922848">0xf8</span><span class="op" id="5922852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5922857">0xf9</span><span class="op" id="5922861">,</span>&nbsp;<span class="num" id="5922863">0xfa</span><span class="op" id="5922867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922871">}</span><span class="op" id="5922872">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922875">}</span><span class="op" id="5922876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922879">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922903">[</span><span class="num" id="5922904">16</span><span class="op" id="5922906">]</span><span class="builtintype" id="5922907">byte</span><span class="op" id="5922911">{</span><span class="num" id="5922912">0</span><span class="op" id="5922913">,</span>&nbsp;<span class="num" id="5922915">3</span><span class="op" id="5922916">,</span>&nbsp;<span class="num" id="5922918">1</span><span class="op" id="5922919">,</span>&nbsp;<span class="num" id="5922921">1</span><span class="op" id="5922922">,</span>&nbsp;<span class="num" id="5922924">1</span><span class="op" id="5922925">,</span>&nbsp;<span class="num" id="5922927">1</span><span class="op" id="5922928">,</span>&nbsp;<span class="num" id="5922930">1</span><span class="op" id="5922931">,</span>&nbsp;<span class="num" id="5922933">1</span><span class="op" id="5922934">,</span>&nbsp;<span class="num" id="5922936">1</span><span class="op" id="5922937">,</span>&nbsp;<span class="num" id="5922939">1</span><span class="op" id="5922940">,</span>&nbsp;<span class="num" id="5922942">1</span><span class="op" id="5922943">,</span>&nbsp;<span class="num" id="5922945">0</span><span class="op" id="5922946">,</span>&nbsp;<span class="num" id="5922948">0</span><span class="op" id="5922949">,</span>&nbsp;<span class="num" id="5922951">0</span><span class="op" id="5922952">,</span>&nbsp;<span class="num" id="5922954">0</span><span class="op" id="5922955">,</span>&nbsp;<span class="num" id="5922957">0</span><span class="op" id="5922958">}</span><span class="op" id="5922959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922963">[</span><span class="op" id="5922964">]</span><span class="builtintype" id="5922965">byte</span><span class="op" id="5922969">{</span><span class="num" id="5922970">0</span><span class="op" id="5922971">,</span>&nbsp;<span class="num" id="5922973">1</span><span class="op" id="5922974">,</span>&nbsp;<span class="num" id="5922976">2</span><span class="op" id="5922977">,</span>&nbsp;<span class="num" id="5922979">3</span><span class="op" id="5922980">,</span>&nbsp;<span class="num" id="5922982">4</span><span class="op" id="5922983">,</span>&nbsp;<span class="num" id="5922985">5</span><span class="op" id="5922986">,</span>&nbsp;<span class="num" id="5922988">6</span><span class="op" id="5922989">,</span>&nbsp;<span class="num" id="5922991">7</span><span class="op" id="5922992">,</span>&nbsp;<span class="num" id="5922994">8</span><span class="op" id="5922995">,</span>&nbsp;<span class="num" id="5922997">9</span><span class="op" id="5922998">,</span>&nbsp;<span class="num" id="5923000">10</span><span class="op" id="5923002">,</span>&nbsp;<span class="num" id="5923004">11</span><span class="op" id="5923006">}</span><span class="op" id="5923007">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923010">}</span><span class="op" id="5923011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923014">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923038">[</span><span class="num" id="5923039">16</span><span class="op" id="5923041">]</span><span class="builtintype" id="5923042">byte</span><span class="op" id="5923046">{</span><span class="num" id="5923047">0</span><span class="op" id="5923048">,</span>&nbsp;<span class="num" id="5923050">2</span><span class="op" id="5923051">,</span>&nbsp;<span class="num" id="5923053">1</span><span class="op" id="5923054">,</span>&nbsp;<span class="num" id="5923056">2</span><span class="op" id="5923057">,</span>&nbsp;<span class="num" id="5923059">4</span><span class="op" id="5923060">,</span>&nbsp;<span class="num" id="5923062">4</span><span class="op" id="5923063">,</span>&nbsp;<span class="num" id="5923065">3</span><span class="op" id="5923066">,</span>&nbsp;<span class="num" id="5923068">4</span><span class="op" id="5923069">,</span>&nbsp;<span class="num" id="5923071">7</span><span class="op" id="5923072">,</span>&nbsp;<span class="num" id="5923074">5</span><span class="op" id="5923075">,</span>&nbsp;<span class="num" id="5923077">4</span><span class="op" id="5923078">,</span>&nbsp;<span class="num" id="5923080">4</span><span class="op" id="5923081">,</span>&nbsp;<span class="num" id="5923083">0</span><span class="op" id="5923084">,</span>&nbsp;<span class="num" id="5923086">1</span><span class="op" id="5923087">,</span>&nbsp;<span class="num" id="5923089">2</span><span class="op" id="5923090">,</span>&nbsp;<span class="num" id="5923092">119</span><span class="op" id="5923095">}</span><span class="op" id="5923096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923100">[</span><span class="op" id="5923101">]</span><span class="builtintype" id="5923102">byte</span><span class="op" id="5923106">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923111">0x00</span><span class="op" id="5923115">,</span>&nbsp;<span class="num" id="5923117">0x01</span><span class="op" id="5923121">,</span>&nbsp;<span class="num" id="5923123">0x02</span><span class="op" id="5923127">,</span>&nbsp;<span class="num" id="5923129">0x03</span><span class="op" id="5923133">,</span>&nbsp;<span class="num" id="5923135">0x11</span><span class="op" id="5923139">,</span>&nbsp;<span class="num" id="5923141">0x04</span><span class="op" id="5923145">,</span>&nbsp;<span class="num" id="5923147">0x05</span><span class="op" id="5923151">,</span>&nbsp;<span class="num" id="5923153">0x21</span><span class="op" id="5923157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923162">0x31</span><span class="op" id="5923166">,</span>&nbsp;<span class="num" id="5923168">0x06</span><span class="op" id="5923172">,</span>&nbsp;<span class="num" id="5923174">0x12</span><span class="op" id="5923178">,</span>&nbsp;<span class="num" id="5923180">0x41</span><span class="op" id="5923184">,</span>&nbsp;<span class="num" id="5923186">0x51</span><span class="op" id="5923190">,</span>&nbsp;<span class="num" id="5923192">0x07</span><span class="op" id="5923196">,</span>&nbsp;<span class="num" id="5923198">0x61</span><span class="op" id="5923202">,</span>&nbsp;<span class="num" id="5923204">0x71</span><span class="op" id="5923208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923213">0x13</span><span class="op" id="5923217">,</span>&nbsp;<span class="num" id="5923219">0x22</span><span class="op" id="5923223">,</span>&nbsp;<span class="num" id="5923225">0x32</span><span class="op" id="5923229">,</span>&nbsp;<span class="num" id="5923231">0x81</span><span class="op" id="5923235">,</span>&nbsp;<span class="num" id="5923237">0x08</span><span class="op" id="5923241">,</span>&nbsp;<span class="num" id="5923243">0x14</span><span class="op" id="5923247">,</span>&nbsp;<span class="num" id="5923249">0x42</span><span class="op" id="5923253">,</span>&nbsp;<span class="num" id="5923255">0x91</span><span class="op" id="5923259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923264">0xa1</span><span class="op" id="5923268">,</span>&nbsp;<span class="num" id="5923270">0xb1</span><span class="op" id="5923274">,</span>&nbsp;<span class="num" id="5923276">0xc1</span><span class="op" id="5923280">,</span>&nbsp;<span class="num" id="5923282">0x09</span><span class="op" id="5923286">,</span>&nbsp;<span class="num" id="5923288">0x23</span><span class="op" id="5923292">,</span>&nbsp;<span class="num" id="5923294">0x33</span><span class="op" id="5923298">,</span>&nbsp;<span class="num" id="5923300">0x52</span><span class="op" id="5923304">,</span>&nbsp;<span class="num" id="5923306">0xf0</span><span class="op" id="5923310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923315">0x15</span><span class="op" id="5923319">,</span>&nbsp;<span class="num" id="5923321">0x62</span><span class="op" id="5923325">,</span>&nbsp;<span class="num" id="5923327">0x72</span><span class="op" id="5923331">,</span>&nbsp;<span class="num" id="5923333">0xd1</span><span class="op" id="5923337">,</span>&nbsp;<span class="num" id="5923339">0x0a</span><span class="op" id="5923343">,</span>&nbsp;<span class="num" id="5923345">0x16</span><span class="op" id="5923349">,</span>&nbsp;<span class="num" id="5923351">0x24</span><span class="op" id="5923355">,</span>&nbsp;<span class="num" id="5923357">0x34</span><span class="op" id="5923361">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923366">0xe1</span><span class="op" id="5923370">,</span>&nbsp;<span class="num" id="5923372">0x25</span><span class="op" id="5923376">,</span>&nbsp;<span class="num" id="5923378">0xf1</span><span class="op" id="5923382">,</span>&nbsp;<span class="num" id="5923384">0x17</span><span class="op" id="5923388">,</span>&nbsp;<span class="num" id="5923390">0x18</span><span class="op" id="5923394">,</span>&nbsp;<span class="num" id="5923396">0x19</span><span class="op" id="5923400">,</span>&nbsp;<span class="num" id="5923402">0x1a</span><span class="op" id="5923406">,</span>&nbsp;<span class="num" id="5923408">0x26</span><span class="op" id="5923412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923417">0x27</span><span class="op" id="5923421">,</span>&nbsp;<span class="num" id="5923423">0x28</span><span class="op" id="5923427">,</span>&nbsp;<span class="num" id="5923429">0x29</span><span class="op" id="5923433">,</span>&nbsp;<span class="num" id="5923435">0x2a</span><span class="op" id="5923439">,</span>&nbsp;<span class="num" id="5923441">0x35</span><span class="op" id="5923445">,</span>&nbsp;<span class="num" id="5923447">0x36</span><span class="op" id="5923451">,</span>&nbsp;<span class="num" id="5923453">0x37</span><span class="op" id="5923457">,</span>&nbsp;<span class="num" id="5923459">0x38</span><span class="op" id="5923463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923468">0x39</span><span class="op" id="5923472">,</span>&nbsp;<span class="num" id="5923474">0x3a</span><span class="op" id="5923478">,</span>&nbsp;<span class="num" id="5923480">0x43</span><span class="op" id="5923484">,</span>&nbsp;<span class="num" id="5923486">0x44</span><span class="op" id="5923490">,</span>&nbsp;<span class="num" id="5923492">0x45</span><span class="op" id="5923496">,</span>&nbsp;<span class="num" id="5923498">0x46</span><span class="op" id="5923502">,</span>&nbsp;<span class="num" id="5923504">0x47</span><span class="op" id="5923508">,</span>&nbsp;<span class="num" id="5923510">0x48</span><span class="op" id="5923514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923519">0x49</span><span class="op" id="5923523">,</span>&nbsp;<span class="num" id="5923525">0x4a</span><span class="op" id="5923529">,</span>&nbsp;<span class="num" id="5923531">0x53</span><span class="op" id="5923535">,</span>&nbsp;<span class="num" id="5923537">0x54</span><span class="op" id="5923541">,</span>&nbsp;<span class="num" id="5923543">0x55</span><span class="op" id="5923547">,</span>&nbsp;<span class="num" id="5923549">0x56</span><span class="op" id="5923553">,</span>&nbsp;<span class="num" id="5923555">0x57</span><span class="op" id="5923559">,</span>&nbsp;<span class="num" id="5923561">0x58</span><span class="op" id="5923565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923570">0x59</span><span class="op" id="5923574">,</span>&nbsp;<span class="num" id="5923576">0x5a</span><span class="op" id="5923580">,</span>&nbsp;<span class="num" id="5923582">0x63</span><span class="op" id="5923586">,</span>&nbsp;<span class="num" id="5923588">0x64</span><span class="op" id="5923592">,</span>&nbsp;<span class="num" id="5923594">0x65</span><span class="op" id="5923598">,</span>&nbsp;<span class="num" id="5923600">0x66</span><span class="op" id="5923604">,</span>&nbsp;<span class="num" id="5923606">0x67</span><span class="op" id="5923610">,</span>&nbsp;<span class="num" id="5923612">0x68</span><span class="op" id="5923616">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923621">0x69</span><span class="op" id="5923625">,</span>&nbsp;<span class="num" id="5923627">0x6a</span><span class="op" id="5923631">,</span>&nbsp;<span class="num" id="5923633">0x73</span><span class="op" id="5923637">,</span>&nbsp;<span class="num" id="5923639">0x74</span><span class="op" id="5923643">,</span>&nbsp;<span class="num" id="5923645">0x75</span><span class="op" id="5923649">,</span>&nbsp;<span class="num" id="5923651">0x76</span><span class="op" id="5923655">,</span>&nbsp;<span class="num" id="5923657">0x77</span><span class="op" id="5923661">,</span>&nbsp;<span class="num" id="5923663">0x78</span><span class="op" id="5923667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923672">0x79</span><span class="op" id="5923676">,</span>&nbsp;<span class="num" id="5923678">0x7a</span><span class="op" id="5923682">,</span>&nbsp;<span class="num" id="5923684">0x82</span><span class="op" id="5923688">,</span>&nbsp;<span class="num" id="5923690">0x83</span><span class="op" id="5923694">,</span>&nbsp;<span class="num" id="5923696">0x84</span><span class="op" id="5923700">,</span>&nbsp;<span class="num" id="5923702">0x85</span><span class="op" id="5923706">,</span>&nbsp;<span class="num" id="5923708">0x86</span><span class="op" id="5923712">,</span>&nbsp;<span class="num" id="5923714">0x87</span><span class="op" id="5923718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923723">0x88</span><span class="op" id="5923727">,</span>&nbsp;<span class="num" id="5923729">0x89</span><span class="op" id="5923733">,</span>&nbsp;<span class="num" id="5923735">0x8a</span><span class="op" id="5923739">,</span>&nbsp;<span class="num" id="5923741">0x92</span><span class="op" id="5923745">,</span>&nbsp;<span class="num" id="5923747">0x93</span><span class="op" id="5923751">,</span>&nbsp;<span class="num" id="5923753">0x94</span><span class="op" id="5923757">,</span>&nbsp;<span class="num" id="5923759">0x95</span><span class="op" id="5923763">,</span>&nbsp;<span class="num" id="5923765">0x96</span><span class="op" id="5923769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923774">0x97</span><span class="op" id="5923778">,</span>&nbsp;<span class="num" id="5923780">0x98</span><span class="op" id="5923784">,</span>&nbsp;<span class="num" id="5923786">0x99</span><span class="op" id="5923790">,</span>&nbsp;<span class="num" id="5923792">0x9a</span><span class="op" id="5923796">,</span>&nbsp;<span class="num" id="5923798">0xa2</span><span class="op" id="5923802">,</span>&nbsp;<span class="num" id="5923804">0xa3</span><span class="op" id="5923808">,</span>&nbsp;<span class="num" id="5923810">0xa4</span><span class="op" id="5923814">,</span>&nbsp;<span class="num" id="5923816">0xa5</span><span class="op" id="5923820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923825">0xa6</span><span class="op" id="5923829">,</span>&nbsp;<span class="num" id="5923831">0xa7</span><span class="op" id="5923835">,</span>&nbsp;<span class="num" id="5923837">0xa8</span><span class="op" id="5923841">,</span>&nbsp;<span class="num" id="5923843">0xa9</span><span class="op" id="5923847">,</span>&nbsp;<span class="num" id="5923849">0xaa</span><span class="op" id="5923853">,</span>&nbsp;<span class="num" id="5923855">0xb2</span><span class="op" id="5923859">,</span>&nbsp;<span class="num" id="5923861">0xb3</span><span class="op" id="5923865">,</span>&nbsp;<span class="num" id="5923867">0xb4</span><span class="op" id="5923871">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923876">0xb5</span><span class="op" id="5923880">,</span>&nbsp;<span class="num" id="5923882">0xb6</span><span class="op" id="5923886">,</span>&nbsp;<span class="num" id="5923888">0xb7</span><span class="op" id="5923892">,</span>&nbsp;<span class="num" id="5923894">0xb8</span><span class="op" id="5923898">,</span>&nbsp;<span class="num" id="5923900">0xb9</span><span class="op" id="5923904">,</span>&nbsp;<span class="num" id="5923906">0xba</span><span class="op" id="5923910">,</span>&nbsp;<span class="num" id="5923912">0xc2</span><span class="op" id="5923916">,</span>&nbsp;<span class="num" id="5923918">0xc3</span><span class="op" id="5923922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923927">0xc4</span><span class="op" id="5923931">,</span>&nbsp;<span class="num" id="5923933">0xc5</span><span class="op" id="5923937">,</span>&nbsp;<span class="num" id="5923939">0xc6</span><span class="op" id="5923943">,</span>&nbsp;<span class="num" id="5923945">0xc7</span><span class="op" id="5923949">,</span>&nbsp;<span class="num" id="5923951">0xc8</span><span class="op" id="5923955">,</span>&nbsp;<span class="num" id="5923957">0xc9</span><span class="op" id="5923961">,</span>&nbsp;<span class="num" id="5923963">0xca</span><span class="op" id="5923967">,</span>&nbsp;<span class="num" id="5923969">0xd2</span><span class="op" id="5923973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5923978">0xd3</span><span class="op" id="5923982">,</span>&nbsp;<span class="num" id="5923984">0xd4</span><span class="op" id="5923988">,</span>&nbsp;<span class="num" id="5923990">0xd5</span><span class="op" id="5923994">,</span>&nbsp;<span class="num" id="5923996">0xd6</span><span class="op" id="5924000">,</span>&nbsp;<span class="num" id="5924002">0xd7</span><span class="op" id="5924006">,</span>&nbsp;<span class="num" id="5924008">0xd8</span><span class="op" id="5924012">,</span>&nbsp;<span class="num" id="5924014">0xd9</span><span class="op" id="5924018">,</span>&nbsp;<span class="num" id="5924020">0xda</span><span class="op" id="5924024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5924029">0xe2</span><span class="op" id="5924033">,</span>&nbsp;<span class="num" id="5924035">0xe3</span><span class="op" id="5924039">,</span>&nbsp;<span class="num" id="5924041">0xe4</span><span class="op" id="5924045">,</span>&nbsp;<span class="num" id="5924047">0xe5</span><span class="op" id="5924051">,</span>&nbsp;<span class="num" id="5924053">0xe6</span><span class="op" id="5924057">,</span>&nbsp;<span class="num" id="5924059">0xe7</span><span class="op" id="5924063">,</span>&nbsp;<span class="num" id="5924065">0xe8</span><span class="op" id="5924069">,</span>&nbsp;<span class="num" id="5924071">0xe9</span><span class="op" id="5924075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5924080">0xea</span><span class="op" id="5924084">,</span>&nbsp;<span class="num" id="5924086">0xf2</span><span class="op" id="5924090">,</span>&nbsp;<span class="num" id="5924092">0xf3</span><span class="op" id="5924096">,</span>&nbsp;<span class="num" id="5924098">0xf4</span><span class="op" id="5924102">,</span>&nbsp;<span class="num" id="5924104">0xf5</span><span class="op" id="5924108">,</span>&nbsp;<span class="num" id="5924110">0xf6</span><span class="op" id="5924114">,</span>&nbsp;<span class="num" id="5924116">0xf7</span><span class="op" id="5924120">,</span>&nbsp;<span class="num" id="5924122">0xf8</span><span class="op" id="5924126">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5924131">0xf9</span><span class="op" id="5924135">,</span>&nbsp;<span class="num" id="5924137">0xfa</span><span class="op" id="5924141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924145">}</span><span class="op" id="5924146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924149">}</span><span class="op" id="5924150">,</span><br>
<span class="lineno"></span><span class="op" id="5924152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5924155">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="5924230">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5924307">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="5924385">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5924426">type</span>&nbsp;<span class="ident" id="5924431">huffmanLUT</span>&nbsp;<span class="op" id="5924442">[</span><span class="op" id="5924443">]</span><span class="builtintype" id="5924444">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="5924452">func</span>&nbsp;<span class="op" id="5924457">(</span><span class="ident" id="5924458">h</span>&nbsp;<span class="op" id="5924460">*</span><span class="ident" id="5924461">huffmanLUT</span><span class="op" id="5924471">)</span>&nbsp;<span class="ident" id="5924473">init</span><span class="op" id="5924477">(</span><span class="ident" id="5924478">s</span>&nbsp;<span class="ident" id="5924480">huffmanSpec</span><span class="op" id="5924491">)</span>&nbsp;<span class="op" id="5924493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924496">maxValue</span>&nbsp;<span class="op" id="5924505">:=</span>&nbsp;<span class="num" id="5924508">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924511">for</span>&nbsp;<span class="ident" id="5924515">_</span><span class="op" id="5924516">,</span>&nbsp;<span class="ident" id="5924518">v</span>&nbsp;<span class="op" id="5924520">:=</span>&nbsp;<span class="keyword" id="5924523">range</span>&nbsp;<span class="ident" id="5924529">s</span><span class="op" id="5924530">.</span><span class="ident" id="5924531">value</span>&nbsp;<span class="op" id="5924537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924541">if</span>&nbsp;<span class="builtintype" id="5924544">int</span><span class="op" id="5924547">(</span><span class="ident" id="5924548">v</span><span class="op" id="5924549">)</span>&nbsp;<span class="op" id="5924551">&gt;</span>&nbsp;<span class="ident" id="5924553">maxValue</span>&nbsp;<span class="op" id="5924562">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924567">maxValue</span>&nbsp;<span class="op" id="5924576">=</span>&nbsp;<span class="builtintype" id="5924578">int</span><span class="op" id="5924581">(</span><span class="ident" id="5924582">v</span><span class="op" id="5924583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924593">*</span><span class="ident" id="5924594">h</span>&nbsp;<span class="op" id="5924596">=</span>&nbsp;<span class="builtinfunc" id="5924598">make</span><span class="op" id="5924602">(</span><span class="op" id="5924603">[</span><span class="op" id="5924604">]</span><span class="builtintype" id="5924605">uint32</span><span class="op" id="5924611">,</span>&nbsp;<span class="ident" id="5924613">maxValue</span><span class="op" id="5924621">+</span><span class="num" id="5924622">1</span><span class="op" id="5924623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924626">code</span><span class="op" id="5924630">,</span>&nbsp;<span class="ident" id="5924632">k</span>&nbsp;<span class="op" id="5924634">:=</span>&nbsp;<span class="builtintype" id="5924637">uint32</span><span class="op" id="5924643">(</span><span class="num" id="5924644">0</span><span class="op" id="5924645">)</span><span class="op" id="5924646">,</span>&nbsp;<span class="num" id="5924648">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924651">for</span>&nbsp;<span class="ident" id="5924655">i</span>&nbsp;<span class="op" id="5924657">:=</span>&nbsp;<span class="num" id="5924660">0</span><span class="op" id="5924661">;</span>&nbsp;<span class="ident" id="5924663">i</span>&nbsp;<span class="op" id="5924665">&lt;</span>&nbsp;<span class="builtinfunc" id="5924667">len</span><span class="op" id="5924670">(</span><span class="ident" id="5924671">s</span><span class="op" id="5924672">.</span><span class="ident" id="5924673">count</span><span class="op" id="5924678">)</span><span class="op" id="5924679">;</span>&nbsp;<span class="ident" id="5924681">i</span><span class="op" id="5924682">++</span>&nbsp;<span class="op" id="5924685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924689">nBits</span>&nbsp;<span class="op" id="5924695">:=</span>&nbsp;<span class="builtintype" id="5924698">uint32</span><span class="op" id="5924704">(</span><span class="ident" id="5924705">i</span><span class="op" id="5924706">+</span><span class="num" id="5924707">1</span><span class="op" id="5924708">)</span>&nbsp;<span class="op" id="5924710">&lt;&lt;</span>&nbsp;<span class="num" id="5924713">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924718">for</span>&nbsp;<span class="ident" id="5924722">j</span>&nbsp;<span class="op" id="5924724">:=</span>&nbsp;<span class="builtintype" id="5924727">uint8</span><span class="op" id="5924732">(</span><span class="num" id="5924733">0</span><span class="op" id="5924734">)</span><span class="op" id="5924735">;</span>&nbsp;<span class="ident" id="5924737">j</span>&nbsp;<span class="op" id="5924739">&lt;</span>&nbsp;<span class="ident" id="5924741">s</span><span class="op" id="5924742">.</span><span class="ident" id="5924743">count</span><span class="op" id="5924748">[</span><span class="ident" id="5924749">i</span><span class="op" id="5924750">]</span><span class="op" id="5924751">;</span>&nbsp;<span class="ident" id="5924753">j</span><span class="op" id="5924754">++</span>&nbsp;<span class="op" id="5924757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924762">(</span><span class="op" id="5924763">*</span><span class="ident" id="5924764">h</span><span class="op" id="5924765">)</span><span class="op" id="5924766">[</span><span class="ident" id="5924767">s</span><span class="op" id="5924768">.</span><span class="ident" id="5924769">value</span><span class="op" id="5924774">[</span><span class="ident" id="5924775">k</span><span class="op" id="5924776">]</span><span class="op" id="5924777">]</span>&nbsp;<span class="op" id="5924779">=</span>&nbsp;<span class="ident" id="5924781">nBits</span>&nbsp;<span class="op" id="5924787">|</span>&nbsp;<span class="ident" id="5924789">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924797">code</span><span class="op" id="5924801">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924807">k</span><span class="op" id="5924808">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924817">code</span>&nbsp;<span class="op" id="5924822">&lt;&lt;=</span>&nbsp;<span class="num" id="5924826">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924829">}</span><br>
<span class="lineno"></span><span class="op" id="5924831">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5924834">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="5924899">var</span>&nbsp;<span class="ident" id="5924903">theHuffmanLUT</span>&nbsp;<span class="op" id="5924917">[</span><span class="num" id="5924918">4</span><span class="op" id="5924919">]</span><span class="ident" id="5924920">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5924932">func</span>&nbsp;<span class="ident" id="5924937">init</span><span class="op" id="5924941">(</span><span class="op" id="5924942">)</span>&nbsp;<span class="op" id="5924944">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924947">for</span>&nbsp;<span class="ident" id="5924951">i</span><span class="op" id="5924952">,</span>&nbsp;<span class="ident" id="5924954">s</span>&nbsp;<span class="op" id="5924956">:=</span>&nbsp;<span class="keyword" id="5924959">range</span>&nbsp;<span class="ident" id="5924965">theHuffmanSpec</span>&nbsp;<span class="op" id="5924980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924984">theHuffmanLUT</span><span class="op" id="5924997">[</span><span class="ident" id="5924998">i</span><span class="op" id="5924999">]</span><span class="op" id="5925000">.</span><span class="ident" id="5925001">init</span><span class="op" id="5925005">(</span><span class="ident" id="5925006">s</span><span class="op" id="5925007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925010">}</span><br>
<span class="lineno"></span><span class="op" id="5925012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="5925015">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5925047">type</span>&nbsp;<span class="ident" id="5925052">writer</span>&nbsp;<span class="keyword" id="5925059">interface</span>&nbsp;<span class="op" id="5925069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925072">Flush</span><span class="op" id="5925077">(</span><span class="op" id="5925078">)</span>&nbsp;<span class="builtintype" id="5925080">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925087">io</span><span class="op" id="5925089">.</span><span class="ident" id="5925090">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925098">io</span><span class="op" id="5925100">.</span><span class="ident" id="5925101">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="5925112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5925115">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5925163">type</span>&nbsp;<span class="ident" id="5925168">encoder</span>&nbsp;<span class="keyword" id="5925176">struct</span>&nbsp;<span class="op" id="5925183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925186">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925261">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925332">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5925336">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925344">err</span>&nbsp;<span class="builtintype" id="5925348">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925355">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925384">buf</span>&nbsp;<span class="op" id="5925388">[</span><span class="num" id="5925389">16</span><span class="op" id="5925391">]</span><span class="builtintype" id="5925392">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925398">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925453">bits</span><span class="op" id="5925457">,</span>&nbsp;<span class="ident" id="5925459">nBits</span>&nbsp;<span class="builtintype" id="5925465">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925473">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925536">quant</span>&nbsp;<span class="op" id="5925542">[</span><span class="ident" id="5925543">nQuantIndex</span><span class="op" id="5925554">]</span><span class="op" id="5925555">[</span><span class="ident" id="5925556">blockSize</span><span class="op" id="5925565">]</span><span class="builtintype" id="5925566">byte</span><br>
<span class="lineno"></span><span class="op" id="5925571">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5925574">func</span>&nbsp;<span class="op" id="5925579">(</span><span class="ident" id="5925580">e</span>&nbsp;<span class="op" id="5925582">*</span><span class="ident" id="5925583">encoder</span><span class="op" id="5925590">)</span>&nbsp;<span class="ident" id="5925592">flush</span><span class="op" id="5925597">(</span><span class="op" id="5925598">)</span>&nbsp;<span class="op" id="5925600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925603">if</span>&nbsp;<span class="ident" id="5925606">e</span><span class="op" id="5925607">.</span><span class="ident" id="5925608">err</span>&nbsp;<span class="op" id="5925612">!=</span>&nbsp;<span class="ident" id="5925615">nil</span>&nbsp;<span class="op" id="5925619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925623">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925631">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925634">e</span><span class="op" id="5925635">.</span><span class="ident" id="5925636">err</span>&nbsp;<span class="op" id="5925640">=</span>&nbsp;<span class="ident" id="5925642">e</span><span class="op" id="5925643">.</span><span class="ident" id="5925644">w</span><span class="op" id="5925645">.</span><span class="ident" id="5925646">Flush</span><span class="op" id="5925651">(</span><span class="op" id="5925652">)</span><br>
<span class="lineno"></span><span class="op" id="5925654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5925657">func</span>&nbsp;<span class="op" id="5925662">(</span><span class="ident" id="5925663">e</span>&nbsp;<span class="op" id="5925665">*</span><span class="ident" id="5925666">encoder</span><span class="op" id="5925673">)</span>&nbsp;<span class="ident" id="5925675">write</span><span class="op" id="5925680">(</span><span class="ident" id="5925681">p</span>&nbsp;<span class="op" id="5925683">[</span><span class="op" id="5925684">]</span><span class="builtintype" id="5925685">byte</span><span class="op" id="5925689">)</span>&nbsp;<span class="op" id="5925691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925694">if</span>&nbsp;<span class="ident" id="5925697">e</span><span class="op" id="5925698">.</span><span class="ident" id="5925699">err</span>&nbsp;<span class="op" id="5925703">!=</span>&nbsp;<span class="ident" id="5925706">nil</span>&nbsp;<span class="op" id="5925710">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925714">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925725">_</span><span class="op" id="5925726">,</span>&nbsp;<span class="ident" id="5925728">e</span><span class="op" id="5925729">.</span><span class="ident" id="5925730">err</span>&nbsp;<span class="op" id="5925734">=</span>&nbsp;<span class="ident" id="5925736">e</span><span class="op" id="5925737">.</span><span class="ident" id="5925738">w</span><span class="op" id="5925739">.</span><span class="ident" id="5925740">Write</span><span class="op" id="5925745">(</span><span class="ident" id="5925746">p</span><span class="op" id="5925747">)</span><br>
<span class="lineno"></span><span class="op" id="5925749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="5925752">func</span>&nbsp;<span class="op" id="5925757">(</span><span class="ident" id="5925758">e</span>&nbsp;<span class="op" id="5925760">*</span><span class="ident" id="5925761">encoder</span><span class="op" id="5925768">)</span>&nbsp;<span class="ident" id="5925770">writeByte</span><span class="op" id="5925779">(</span><span class="ident" id="5925780">b</span>&nbsp;<span class="builtintype" id="5925782">byte</span><span class="op" id="5925786">)</span>&nbsp;<span class="op" id="5925788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925791">if</span>&nbsp;<span class="ident" id="5925794">e</span><span class="op" id="5925795">.</span><span class="ident" id="5925796">err</span>&nbsp;<span class="op" id="5925800">!=</span>&nbsp;<span class="ident" id="5925803">nil</span>&nbsp;<span class="op" id="5925807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925811">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925822">e</span><span class="op" id="5925823">.</span><span class="ident" id="5925824">err</span>&nbsp;<span class="op" id="5925828">=</span>&nbsp;<span class="ident" id="5925830">e</span><span class="op" id="5925831">.</span><span class="ident" id="5925832">w</span><span class="op" id="5925833">.</span><span class="ident" id="5925834">WriteByte</span><span class="op" id="5925843">(</span><span class="ident" id="5925844">b</span><span class="op" id="5925845">)</span><br>
<span class="lineno">250</span><span class="op" id="5925847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5925850">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="5925924">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="5925979">func</span>&nbsp;<span class="op" id="5925984">(</span><span class="ident" id="5925985">e</span>&nbsp;<span class="op" id="5925987">*</span><span class="ident" id="5925988">encoder</span><span class="op" id="5925995">)</span>&nbsp;<span class="ident" id="5925997">emit</span><span class="op" id="5926001">(</span><span class="ident" id="5926002">bits</span><span class="op" id="5926006">,</span>&nbsp;<span class="ident" id="5926008">nBits</span>&nbsp;<span class="builtintype" id="5926014">uint32</span><span class="op" id="5926020">)</span>&nbsp;<span class="op" id="5926022">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926025">nBits</span>&nbsp;<span class="op" id="5926031">+=</span>&nbsp;<span class="ident" id="5926034">e</span><span class="op" id="5926035">.</span><span class="ident" id="5926036">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926043">bits</span>&nbsp;<span class="op" id="5926048">&lt;&lt;=</span>&nbsp;<span class="num" id="5926052">32</span>&nbsp;<span class="op" id="5926055">-</span>&nbsp;<span class="ident" id="5926057">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926064">bits</span>&nbsp;<span class="op" id="5926069">|=</span>&nbsp;<span class="ident" id="5926072">e</span><span class="op" id="5926073">.</span><span class="ident" id="5926074">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926080">for</span>&nbsp;<span class="ident" id="5926084">nBits</span>&nbsp;<span class="op" id="5926090">&gt;=</span>&nbsp;<span class="num" id="5926093">8</span>&nbsp;<span class="op" id="5926095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926099">b</span>&nbsp;<span class="op" id="5926101">:=</span>&nbsp;<span class="builtintype" id="5926104">uint8</span><span class="op" id="5926109">(</span><span class="ident" id="5926110">bits</span>&nbsp;<span class="op" id="5926115">&gt;&gt;</span>&nbsp;<span class="num" id="5926118">24</span><span class="op" id="5926120">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926124">e</span><span class="op" id="5926125">.</span><span class="ident" id="5926126">writeByte</span><span class="op" id="5926135">(</span><span class="ident" id="5926136">b</span><span class="op" id="5926137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926141">if</span>&nbsp;<span class="ident" id="5926144">b</span>&nbsp;<span class="op" id="5926146">==</span>&nbsp;<span class="num" id="5926149">0xff</span>&nbsp;<span class="op" id="5926154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926159">e</span><span class="op" id="5926160">.</span><span class="ident" id="5926161">writeByte</span><span class="op" id="5926170">(</span><span class="num" id="5926171">0x00</span><span class="op" id="5926175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926183">bits</span>&nbsp;<span class="op" id="5926188">&lt;&lt;=</span>&nbsp;<span class="num" id="5926192">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926196">nBits</span>&nbsp;<span class="op" id="5926202">-=</span>&nbsp;<span class="num" id="5926205">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926211">e</span><span class="op" id="5926212">.</span><span class="ident" id="5926213">bits</span><span class="op" id="5926217">,</span>&nbsp;<span class="ident" id="5926219">e</span><span class="op" id="5926220">.</span><span class="ident" id="5926221">nBits</span>&nbsp;<span class="op" id="5926227">=</span>&nbsp;<span class="ident" id="5926229">bits</span><span class="op" id="5926233">,</span>&nbsp;<span class="ident" id="5926235">nBits</span><br>
<span class="lineno"></span><span class="op" id="5926241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5926244">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5926310">func</span>&nbsp;<span class="op" id="5926315">(</span><span class="ident" id="5926316">e</span>&nbsp;<span class="op" id="5926318">*</span><span class="ident" id="5926319">encoder</span><span class="op" id="5926326">)</span>&nbsp;<span class="ident" id="5926328">emitHuff</span><span class="op" id="5926336">(</span><span class="ident" id="5926337">h</span>&nbsp;<span class="ident" id="5926339">huffIndex</span><span class="op" id="5926348">,</span>&nbsp;<span class="ident" id="5926350">value</span>&nbsp;<span class="builtintype" id="5926356">int32</span><span class="op" id="5926361">)</span>&nbsp;<span class="op" id="5926363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926366">x</span>&nbsp;<span class="op" id="5926368">:=</span>&nbsp;<span class="ident" id="5926371">theHuffmanLUT</span><span class="op" id="5926384">[</span><span class="ident" id="5926385">h</span><span class="op" id="5926386">]</span><span class="op" id="5926387">[</span><span class="ident" id="5926388">value</span><span class="op" id="5926393">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926396">e</span><span class="op" id="5926397">.</span><span class="ident" id="5926398">emit</span><span class="op" id="5926402">(</span><span class="ident" id="5926403">x</span><span class="op" id="5926404">&amp;</span><span class="op" id="5926405">(</span><span class="num" id="5926406">1</span><span class="op" id="5926407">&lt;&lt;</span><span class="num" id="5926409">24</span><span class="op" id="5926411">-</span><span class="num" id="5926412">1</span><span class="op" id="5926413">)</span><span class="op" id="5926414">,</span>&nbsp;<span class="ident" id="5926416">x</span><span class="op" id="5926417">&gt;&gt;</span><span class="num" id="5926419">24</span><span class="op" id="5926421">)</span><br>
<span class="lineno"></span><span class="op" id="5926423">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="5926426">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5926505">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5926525">func</span>&nbsp;<span class="op" id="5926530">(</span><span class="ident" id="5926531">e</span>&nbsp;<span class="op" id="5926533">*</span><span class="ident" id="5926534">encoder</span><span class="op" id="5926541">)</span>&nbsp;<span class="ident" id="5926543">emitHuffRLE</span><span class="op" id="5926554">(</span><span class="ident" id="5926555">h</span>&nbsp;<span class="ident" id="5926557">huffIndex</span><span class="op" id="5926566">,</span>&nbsp;<span class="ident" id="5926568">runLength</span><span class="op" id="5926577">,</span>&nbsp;<span class="ident" id="5926579">value</span>&nbsp;<span class="builtintype" id="5926585">int32</span><span class="op" id="5926590">)</span>&nbsp;<span class="op" id="5926592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926595">a</span><span class="op" id="5926596">,</span>&nbsp;<span class="ident" id="5926598">b</span>&nbsp;<span class="op" id="5926600">:=</span>&nbsp;<span class="ident" id="5926603">value</span><span class="op" id="5926608">,</span>&nbsp;<span class="ident" id="5926610">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926617">if</span>&nbsp;<span class="ident" id="5926620">a</span>&nbsp;<span class="op" id="5926622">&lt;</span>&nbsp;<span class="num" id="5926624">0</span>&nbsp;<span class="op" id="5926626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926630">a</span><span class="op" id="5926631">,</span>&nbsp;<span class="ident" id="5926633">b</span>&nbsp;<span class="op" id="5926635">=</span>&nbsp;<span class="op" id="5926637">-</span><span class="ident" id="5926638">value</span><span class="op" id="5926643">,</span>&nbsp;<span class="ident" id="5926645">value</span><span class="op" id="5926650">-</span><span class="num" id="5926651">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926657">var</span>&nbsp;<span class="ident" id="5926661">nBits</span>&nbsp;<span class="builtintype" id="5926667">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926675">if</span>&nbsp;<span class="ident" id="5926678">a</span>&nbsp;<span class="op" id="5926680">&lt;</span>&nbsp;<span class="num" id="5926682">0x100</span>&nbsp;<span class="op" id="5926688">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926692">nBits</span>&nbsp;<span class="op" id="5926698">=</span>&nbsp;<span class="builtintype" id="5926700">uint32</span><span class="op" id="5926706">(</span><span class="ident" id="5926707">bitCount</span><span class="op" id="5926715">[</span><span class="ident" id="5926716">a</span><span class="op" id="5926717">]</span><span class="op" id="5926718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926721">}</span>&nbsp;<span class="keyword" id="5926723">else</span>&nbsp;<span class="op" id="5926728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926732">nBits</span>&nbsp;<span class="op" id="5926738">=</span>&nbsp;<span class="num" id="5926740">8</span>&nbsp;<span class="op" id="5926742">+</span>&nbsp;<span class="builtintype" id="5926744">uint32</span><span class="op" id="5926750">(</span><span class="ident" id="5926751">bitCount</span><span class="op" id="5926759">[</span><span class="ident" id="5926760">a</span><span class="op" id="5926761">&gt;&gt;</span><span class="num" id="5926763">8</span><span class="op" id="5926764">]</span><span class="op" id="5926765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926771">e</span><span class="op" id="5926772">.</span><span class="ident" id="5926773">emitHuff</span><span class="op" id="5926781">(</span><span class="ident" id="5926782">h</span><span class="op" id="5926783">,</span>&nbsp;<span class="ident" id="5926785">runLength</span><span class="op" id="5926794">&lt;&lt;</span><span class="num" id="5926796">4</span><span class="op" id="5926797">|</span><span class="builtintype" id="5926798">int32</span><span class="op" id="5926803">(</span><span class="ident" id="5926804">nBits</span><span class="op" id="5926809">)</span><span class="op" id="5926810">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926813">if</span>&nbsp;<span class="ident" id="5926816">nBits</span>&nbsp;<span class="op" id="5926822">&gt;</span>&nbsp;<span class="num" id="5926824">0</span>&nbsp;<span class="op" id="5926826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926830">e</span><span class="op" id="5926831">.</span><span class="ident" id="5926832">emit</span><span class="op" id="5926836">(</span><span class="builtintype" id="5926837">uint32</span><span class="op" id="5926843">(</span><span class="ident" id="5926844">b</span><span class="op" id="5926845">)</span><span class="op" id="5926846">&amp;</span><span class="op" id="5926847">(</span><span class="num" id="5926848">1</span><span class="op" id="5926849">&lt;&lt;</span><span class="ident" id="5926851">nBits</span><span class="op" id="5926856">-</span><span class="num" id="5926857">1</span><span class="op" id="5926858">)</span><span class="op" id="5926859">,</span>&nbsp;<span class="ident" id="5926861">nBits</span><span class="op" id="5926866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926869">}</span><br>
<span class="lineno"></span><span class="op" id="5926871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="5926874">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5926949">func</span>&nbsp;<span class="op" id="5926954">(</span><span class="ident" id="5926955">e</span>&nbsp;<span class="op" id="5926957">*</span><span class="ident" id="5926958">encoder</span><span class="op" id="5926965">)</span>&nbsp;<span class="ident" id="5926967">writeMarkerHeader</span><span class="op" id="5926984">(</span><span class="ident" id="5926985">marker</span>&nbsp;<span class="builtintype" id="5926992">uint8</span><span class="op" id="5926997">,</span>&nbsp;<span class="ident" id="5926999">markerlen</span>&nbsp;<span class="builtintype" id="5927009">int</span><span class="op" id="5927012">)</span>&nbsp;<span class="op" id="5927014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927017">e</span><span class="op" id="5927018">.</span><span class="ident" id="5927019">buf</span><span class="op" id="5927022">[</span><span class="num" id="5927023">0</span><span class="op" id="5927024">]</span>&nbsp;<span class="op" id="5927026">=</span>&nbsp;<span class="num" id="5927028">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927034">e</span><span class="op" id="5927035">.</span><span class="ident" id="5927036">buf</span><span class="op" id="5927039">[</span><span class="num" id="5927040">1</span><span class="op" id="5927041">]</span>&nbsp;<span class="op" id="5927043">=</span>&nbsp;<span class="ident" id="5927045">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927053">e</span><span class="op" id="5927054">.</span><span class="ident" id="5927055">buf</span><span class="op" id="5927058">[</span><span class="num" id="5927059">2</span><span class="op" id="5927060">]</span>&nbsp;<span class="op" id="5927062">=</span>&nbsp;<span class="builtintype" id="5927064">uint8</span><span class="op" id="5927069">(</span><span class="ident" id="5927070">markerlen</span>&nbsp;<span class="op" id="5927080">&gt;&gt;</span>&nbsp;<span class="num" id="5927083">8</span><span class="op" id="5927084">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927087">e</span><span class="op" id="5927088">.</span><span class="ident" id="5927089">buf</span><span class="op" id="5927092">[</span><span class="num" id="5927093">3</span><span class="op" id="5927094">]</span>&nbsp;<span class="op" id="5927096">=</span>&nbsp;<span class="builtintype" id="5927098">uint8</span><span class="op" id="5927103">(</span><span class="ident" id="5927104">markerlen</span>&nbsp;<span class="op" id="5927114">&amp;</span>&nbsp;<span class="num" id="5927116">0xff</span><span class="op" id="5927120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927123">e</span><span class="op" id="5927124">.</span><span class="ident" id="5927125">write</span><span class="op" id="5927130">(</span><span class="ident" id="5927131">e</span><span class="op" id="5927132">.</span><span class="ident" id="5927133">buf</span><span class="op" id="5927136">[</span><span class="op" id="5927137">:</span><span class="num" id="5927138">4</span><span class="op" id="5927139">]</span><span class="op" id="5927140">)</span><br>
<span class="lineno"></span><span class="op" id="5927142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5927145">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="5927202">func</span>&nbsp;<span class="op" id="5927207">(</span><span class="ident" id="5927208">e</span>&nbsp;<span class="op" id="5927210">*</span><span class="ident" id="5927211">encoder</span><span class="op" id="5927218">)</span>&nbsp;<span class="ident" id="5927220">writeDQT</span><span class="op" id="5927228">(</span><span class="op" id="5927229">)</span>&nbsp;<span class="op" id="5927231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927234">const</span>&nbsp;<span class="ident" id="5927240">markerlen</span>&nbsp;<span class="op" id="5927250">=</span>&nbsp;<span class="num" id="5927252">2</span>&nbsp;<span class="op" id="5927254">+</span>&nbsp;<span class="builtintype" id="5927256">int</span><span class="op" id="5927259">(</span><span class="ident" id="5927260">nQuantIndex</span><span class="op" id="5927271">)</span><span class="op" id="5927272">*</span><span class="op" id="5927273">(</span><span class="num" id="5927274">1</span><span class="op" id="5927275">+</span><span class="ident" id="5927276">blockSize</span><span class="op" id="5927285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927288">e</span><span class="op" id="5927289">.</span><span class="ident" id="5927290">writeMarkerHeader</span><span class="op" id="5927307">(</span><span class="ident" id="5927308">dqtMarker</span><span class="op" id="5927317">,</span>&nbsp;<span class="ident" id="5927319">markerlen</span><span class="op" id="5927328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927331">for</span>&nbsp;<span class="ident" id="5927335">i</span>&nbsp;<span class="op" id="5927337">:=</span>&nbsp;<span class="keyword" id="5927340">range</span>&nbsp;<span class="ident" id="5927346">e</span><span class="op" id="5927347">.</span><span class="ident" id="5927348">quant</span>&nbsp;<span class="op" id="5927354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927358">e</span><span class="op" id="5927359">.</span><span class="ident" id="5927360">writeByte</span><span class="op" id="5927369">(</span><span class="builtintype" id="5927370">uint8</span><span class="op" id="5927375">(</span><span class="ident" id="5927376">i</span><span class="op" id="5927377">)</span><span class="op" id="5927378">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927382">e</span><span class="op" id="5927383">.</span><span class="ident" id="5927384">write</span><span class="op" id="5927389">(</span><span class="ident" id="5927390">e</span><span class="op" id="5927391">.</span><span class="ident" id="5927392">quant</span><span class="op" id="5927397">[</span><span class="ident" id="5927398">i</span><span class="op" id="5927399">]</span><span class="op" id="5927400">[</span><span class="op" id="5927401">:</span><span class="op" id="5927402">]</span><span class="op" id="5927403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927406">}</span><br>
<span class="lineno"></span><span class="op" id="5927408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5927411">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="5927469">func</span>&nbsp;<span class="op" id="5927474">(</span><span class="ident" id="5927475">e</span>&nbsp;<span class="op" id="5927477">*</span><span class="ident" id="5927478">encoder</span><span class="op" id="5927485">)</span>&nbsp;<span class="ident" id="5927487">writeSOF0</span><span class="op" id="5927496">(</span><span class="ident" id="5927497">size</span>&nbsp;<span class="ident" id="5927502">image</span><span class="op" id="5927507">.</span><span class="ident" id="5927508">Point</span><span class="op" id="5927513">,</span>&nbsp;<span class="ident" id="5927515">nComponent</span>&nbsp;<span class="builtintype" id="5927526">int</span><span class="op" id="5927529">)</span>&nbsp;<span class="op" id="5927531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927534">markerlen</span>&nbsp;<span class="op" id="5927544">:=</span>&nbsp;<span class="num" id="5927547">8</span>&nbsp;<span class="op" id="5927549">+</span>&nbsp;<span class="num" id="5927551">3</span><span class="op" id="5927552">*</span><span class="ident" id="5927553">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927565">e</span><span class="op" id="5927566">.</span><span class="ident" id="5927567">writeMarkerHeader</span><span class="op" id="5927584">(</span><span class="ident" id="5927585">sof0Marker</span><span class="op" id="5927595">,</span>&nbsp;<span class="ident" id="5927597">markerlen</span><span class="op" id="5927606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927609">e</span><span class="op" id="5927610">.</span><span class="ident" id="5927611">buf</span><span class="op" id="5927614">[</span><span class="num" id="5927615">0</span><span class="op" id="5927616">]</span>&nbsp;<span class="op" id="5927618">=</span>&nbsp;<span class="num" id="5927620">8</span>&nbsp;<span class="comment" id="5927622">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927639">e</span><span class="op" id="5927640">.</span><span class="ident" id="5927641">buf</span><span class="op" id="5927644">[</span><span class="num" id="5927645">1</span><span class="op" id="5927646">]</span>&nbsp;<span class="op" id="5927648">=</span>&nbsp;<span class="builtintype" id="5927650">uint8</span><span class="op" id="5927655">(</span><span class="ident" id="5927656">size</span><span class="op" id="5927660">.</span><span class="ident" id="5927661">Y</span>&nbsp;<span class="op" id="5927663">&gt;&gt;</span>&nbsp;<span class="num" id="5927666">8</span><span class="op" id="5927667">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927670">e</span><span class="op" id="5927671">.</span><span class="ident" id="5927672">buf</span><span class="op" id="5927675">[</span><span class="num" id="5927676">2</span><span class="op" id="5927677">]</span>&nbsp;<span class="op" id="5927679">=</span>&nbsp;<span class="builtintype" id="5927681">uint8</span><span class="op" id="5927686">(</span><span class="ident" id="5927687">size</span><span class="op" id="5927691">.</span><span class="ident" id="5927692">Y</span>&nbsp;<span class="op" id="5927694">&amp;</span>&nbsp;<span class="num" id="5927696">0xff</span><span class="op" id="5927700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927703">e</span><span class="op" id="5927704">.</span><span class="ident" id="5927705">buf</span><span class="op" id="5927708">[</span><span class="num" id="5927709">3</span><span class="op" id="5927710">]</span>&nbsp;<span class="op" id="5927712">=</span>&nbsp;<span class="builtintype" id="5927714">uint8</span><span class="op" id="5927719">(</span><span class="ident" id="5927720">size</span><span class="op" id="5927724">.</span><span class="ident" id="5927725">X</span>&nbsp;<span class="op" id="5927727">&gt;&gt;</span>&nbsp;<span class="num" id="5927730">8</span><span class="op" id="5927731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927734">e</span><span class="op" id="5927735">.</span><span class="ident" id="5927736">buf</span><span class="op" id="5927739">[</span><span class="num" id="5927740">4</span><span class="op" id="5927741">]</span>&nbsp;<span class="op" id="5927743">=</span>&nbsp;<span class="builtintype" id="5927745">uint8</span><span class="op" id="5927750">(</span><span class="ident" id="5927751">size</span><span class="op" id="5927755">.</span><span class="ident" id="5927756">X</span>&nbsp;<span class="op" id="5927758">&amp;</span>&nbsp;<span class="num" id="5927760">0xff</span><span class="op" id="5927764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927767">e</span><span class="op" id="5927768">.</span><span class="ident" id="5927769">buf</span><span class="op" id="5927772">[</span><span class="num" id="5927773">5</span><span class="op" id="5927774">]</span>&nbsp;<span class="op" id="5927776">=</span>&nbsp;<span class="builtintype" id="5927778">uint8</span><span class="op" id="5927783">(</span><span class="ident" id="5927784">nComponent</span><span class="op" id="5927794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927797">if</span>&nbsp;<span class="ident" id="5927800">nComponent</span>&nbsp;<span class="op" id="5927811">==</span>&nbsp;<span class="num" id="5927814">1</span>&nbsp;<span class="op" id="5927816">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927820">e</span><span class="op" id="5927821">.</span><span class="ident" id="5927822">buf</span><span class="op" id="5927825">[</span><span class="num" id="5927826">6</span><span class="op" id="5927827">]</span>&nbsp;<span class="op" id="5927829">=</span>&nbsp;<span class="num" id="5927831">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5927835">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927876">e</span><span class="op" id="5927877">.</span><span class="ident" id="5927878">buf</span><span class="op" id="5927881">[</span><span class="num" id="5927882">7</span><span class="op" id="5927883">]</span>&nbsp;<span class="op" id="5927885">=</span>&nbsp;<span class="num" id="5927887">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927894">e</span><span class="op" id="5927895">.</span><span class="ident" id="5927896">buf</span><span class="op" id="5927899">[</span><span class="num" id="5927900">8</span><span class="op" id="5927901">]</span>&nbsp;<span class="op" id="5927903">=</span>&nbsp;<span class="num" id="5927905">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927911">}</span>&nbsp;<span class="keyword" id="5927913">else</span>&nbsp;<span class="op" id="5927918">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927922">for</span>&nbsp;<span class="ident" id="5927926">i</span>&nbsp;<span class="op" id="5927928">:=</span>&nbsp;<span class="num" id="5927931">0</span><span class="op" id="5927932">;</span>&nbsp;<span class="ident" id="5927934">i</span>&nbsp;<span class="op" id="5927936">&lt;</span>&nbsp;<span class="ident" id="5927938">nComponent</span><span class="op" id="5927948">;</span>&nbsp;<span class="ident" id="5927950">i</span><span class="op" id="5927951">++</span>&nbsp;<span class="op" id="5927954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927959">e</span><span class="op" id="5927960">.</span><span class="ident" id="5927961">buf</span><span class="op" id="5927964">[</span><span class="num" id="5927965">3</span><span class="op" id="5927966">*</span><span class="ident" id="5927967">i</span><span class="op" id="5927968">+</span><span class="num" id="5927969">6</span><span class="op" id="5927970">]</span>&nbsp;<span class="op" id="5927972">=</span>&nbsp;<span class="builtintype" id="5927974">uint8</span><span class="op" id="5927979">(</span><span class="ident" id="5927980">i</span>&nbsp;<span class="op" id="5927982">+</span>&nbsp;<span class="num" id="5927984">1</span><span class="op" id="5927985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5927990">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928029">e</span><span class="op" id="5928030">.</span><span class="ident" id="5928031">buf</span><span class="op" id="5928034">[</span><span class="num" id="5928035">3</span><span class="op" id="5928036">*</span><span class="ident" id="5928037">i</span><span class="op" id="5928038">+</span><span class="num" id="5928039">7</span><span class="op" id="5928040">]</span>&nbsp;<span class="op" id="5928042">=</span>&nbsp;<span class="string" id="5928044">&#34;\x22\x11\x11&#34;</span><span class="op" id="5928058">[</span><span class="ident" id="5928059">i</span><span class="op" id="5928060">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928065">e</span><span class="op" id="5928066">.</span><span class="ident" id="5928067">buf</span><span class="op" id="5928070">[</span><span class="num" id="5928071">3</span><span class="op" id="5928072">*</span><span class="ident" id="5928073">i</span><span class="op" id="5928074">+</span><span class="num" id="5928075">8</span><span class="op" id="5928076">]</span>&nbsp;<span class="op" id="5928078">=</span>&nbsp;<span class="string" id="5928080">&#34;\x00\x01\x01&#34;</span><span class="op" id="5928094">[</span><span class="ident" id="5928095">i</span><span class="op" id="5928096">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928106">e</span><span class="op" id="5928107">.</span><span class="ident" id="5928108">write</span><span class="op" id="5928113">(</span><span class="ident" id="5928114">e</span><span class="op" id="5928115">.</span><span class="ident" id="5928116">buf</span><span class="op" id="5928119">[</span><span class="op" id="5928120">:</span><span class="num" id="5928121">3</span><span class="op" id="5928122">*</span><span class="op" id="5928123">(</span><span class="ident" id="5928124">nComponent</span><span class="op" id="5928134">-</span><span class="num" id="5928135">1</span><span class="op" id="5928136">)</span><span class="op" id="5928137">+</span><span class="num" id="5928138">9</span><span class="op" id="5928139">]</span><span class="op" id="5928140">)</span><br>
<span class="lineno"></span><span class="op" id="5928142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="5928145">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="5928197">func</span>&nbsp;<span class="op" id="5928202">(</span><span class="ident" id="5928203">e</span>&nbsp;<span class="op" id="5928205">*</span><span class="ident" id="5928206">encoder</span><span class="op" id="5928213">)</span>&nbsp;<span class="ident" id="5928215">writeDHT</span><span class="op" id="5928223">(</span><span class="ident" id="5928224">nComponent</span>&nbsp;<span class="builtintype" id="5928235">int</span><span class="op" id="5928238">)</span>&nbsp;<span class="op" id="5928240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928243">markerlen</span>&nbsp;<span class="op" id="5928253">:=</span>&nbsp;<span class="num" id="5928256">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928259">specs</span>&nbsp;<span class="op" id="5928265">:=</span>&nbsp;<span class="ident" id="5928268">theHuffmanSpec</span><span class="op" id="5928282">[</span><span class="op" id="5928283">:</span><span class="op" id="5928284">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928287">if</span>&nbsp;<span class="ident" id="5928290">nComponent</span>&nbsp;<span class="op" id="5928301">==</span>&nbsp;<span class="num" id="5928304">1</span>&nbsp;<span class="op" id="5928306">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928310">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928344">specs</span>&nbsp;<span class="op" id="5928350">=</span>&nbsp;<span class="ident" id="5928352">specs</span><span class="op" id="5928357">[</span><span class="op" id="5928358">:</span><span class="num" id="5928359">2</span><span class="op" id="5928360">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928366">for</span>&nbsp;<span class="ident" id="5928370">_</span><span class="op" id="5928371">,</span>&nbsp;<span class="ident" id="5928373">s</span>&nbsp;<span class="op" id="5928375">:=</span>&nbsp;<span class="keyword" id="5928378">range</span>&nbsp;<span class="ident" id="5928384">specs</span>&nbsp;<span class="op" id="5928390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928394">markerlen</span>&nbsp;<span class="op" id="5928404">+=</span>&nbsp;<span class="num" id="5928407">1</span>&nbsp;<span class="op" id="5928409">+</span>&nbsp;<span class="num" id="5928411">16</span>&nbsp;<span class="op" id="5928414">+</span>&nbsp;<span class="builtinfunc" id="5928416">len</span><span class="op" id="5928419">(</span><span class="ident" id="5928420">s</span><span class="op" id="5928421">.</span><span class="ident" id="5928422">value</span><span class="op" id="5928427">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928433">e</span><span class="op" id="5928434">.</span><span class="ident" id="5928435">writeMarkerHeader</span><span class="op" id="5928452">(</span><span class="ident" id="5928453">dhtMarker</span><span class="op" id="5928462">,</span>&nbsp;<span class="ident" id="5928464">markerlen</span><span class="op" id="5928473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928476">for</span>&nbsp;<span class="ident" id="5928480">i</span><span class="op" id="5928481">,</span>&nbsp;<span class="ident" id="5928483">s</span>&nbsp;<span class="op" id="5928485">:=</span>&nbsp;<span class="keyword" id="5928488">range</span>&nbsp;<span class="ident" id="5928494">specs</span>&nbsp;<span class="op" id="5928500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928504">e</span><span class="op" id="5928505">.</span><span class="ident" id="5928506">writeByte</span><span class="op" id="5928515">(</span><span class="string" id="5928516">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="5928534">[</span><span class="ident" id="5928535">i</span><span class="op" id="5928536">]</span><span class="op" id="5928537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928541">e</span><span class="op" id="5928542">.</span><span class="ident" id="5928543">write</span><span class="op" id="5928548">(</span><span class="ident" id="5928549">s</span><span class="op" id="5928550">.</span><span class="ident" id="5928551">count</span><span class="op" id="5928556">[</span><span class="op" id="5928557">:</span><span class="op" id="5928558">]</span><span class="op" id="5928559">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928563">e</span><span class="op" id="5928564">.</span><span class="ident" id="5928565">write</span><span class="op" id="5928570">(</span><span class="ident" id="5928571">s</span><span class="op" id="5928572">.</span><span class="ident" id="5928573">value</span><span class="op" id="5928578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928581">}</span><br>
<span class="lineno"></span><span class="op" id="5928583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5928586">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="5928665">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5928744">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5928776">func</span>&nbsp;<span class="op" id="5928781">(</span><span class="ident" id="5928782">e</span>&nbsp;<span class="op" id="5928784">*</span><span class="ident" id="5928785">encoder</span><span class="op" id="5928792">)</span>&nbsp;<span class="ident" id="5928794">writeBlock</span><span class="op" id="5928804">(</span><span class="ident" id="5928805">b</span>&nbsp;<span class="op" id="5928807">*</span><span class="ident" id="5928808">block</span><span class="op" id="5928813">,</span>&nbsp;<span class="ident" id="5928815">q</span>&nbsp;<span class="ident" id="5928817">quantIndex</span><span class="op" id="5928827">,</span>&nbsp;<span class="ident" id="5928829">prevDC</span>&nbsp;<span class="builtintype" id="5928836">int32</span><span class="op" id="5928841">)</span>&nbsp;<span class="builtintype" id="5928843">int32</span>&nbsp;<span class="op" id="5928849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928852">fdct</span><span class="op" id="5928856">(</span><span class="ident" id="5928857">b</span><span class="op" id="5928858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928861">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928884">dc</span>&nbsp;<span class="op" id="5928887">:=</span>&nbsp;<span class="ident" id="5928890">div</span><span class="op" id="5928893">(</span><span class="ident" id="5928894">b</span><span class="op" id="5928895">[</span><span class="num" id="5928896">0</span><span class="op" id="5928897">]</span><span class="op" id="5928898">,</span>&nbsp;<span class="num" id="5928900">8</span><span class="op" id="5928901">*</span><span class="builtintype" id="5928902">int32</span><span class="op" id="5928907">(</span><span class="ident" id="5928908">e</span><span class="op" id="5928909">.</span><span class="ident" id="5928910">quant</span><span class="op" id="5928915">[</span><span class="ident" id="5928916">q</span><span class="op" id="5928917">]</span><span class="op" id="5928918">[</span><span class="num" id="5928919">0</span><span class="op" id="5928920">]</span><span class="op" id="5928921">)</span><span class="op" id="5928922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928925">e</span><span class="op" id="5928926">.</span><span class="ident" id="5928927">emitHuffRLE</span><span class="op" id="5928938">(</span><span class="ident" id="5928939">huffIndex</span><span class="op" id="5928948">(</span><span class="num" id="5928949">2</span><span class="op" id="5928950">*</span><span class="ident" id="5928951">q</span><span class="op" id="5928952">+</span><span class="num" id="5928953">0</span><span class="op" id="5928954">)</span><span class="op" id="5928955">,</span>&nbsp;<span class="num" id="5928957">0</span><span class="op" id="5928958">,</span>&nbsp;<span class="ident" id="5928960">dc</span><span class="op" id="5928962">-</span><span class="ident" id="5928963">prevDC</span><span class="op" id="5928969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928972">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929000">h</span><span class="op" id="5929001">,</span>&nbsp;<span class="ident" id="5929003">runLength</span>&nbsp;<span class="op" id="5929013">:=</span>&nbsp;<span class="ident" id="5929016">huffIndex</span><span class="op" id="5929025">(</span><span class="num" id="5929026">2</span><span class="op" id="5929027">*</span><span class="ident" id="5929028">q</span><span class="op" id="5929029">+</span><span class="num" id="5929030">1</span><span class="op" id="5929031">)</span><span class="op" id="5929032">,</span>&nbsp;<span class="builtintype" id="5929034">int32</span><span class="op" id="5929039">(</span><span class="num" id="5929040">0</span><span class="op" id="5929041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929044">for</span>&nbsp;<span class="ident" id="5929048">zig</span>&nbsp;<span class="op" id="5929052">:=</span>&nbsp;<span class="num" id="5929055">1</span><span class="op" id="5929056">;</span>&nbsp;<span class="ident" id="5929058">zig</span>&nbsp;<span class="op" id="5929062">&lt;</span>&nbsp;<span class="ident" id="5929064">blockSize</span><span class="op" id="5929073">;</span>&nbsp;<span class="ident" id="5929075">zig</span><span class="op" id="5929078">++</span>&nbsp;<span class="op" id="5929081">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929085">ac</span>&nbsp;<span class="op" id="5929088">:=</span>&nbsp;<span class="ident" id="5929091">div</span><span class="op" id="5929094">(</span><span class="ident" id="5929095">b</span><span class="op" id="5929096">[</span><span class="ident" id="5929097">unzig</span><span class="op" id="5929102">[</span><span class="ident" id="5929103">zig</span><span class="op" id="5929106">]</span><span class="op" id="5929107">]</span><span class="op" id="5929108">,</span>&nbsp;<span class="num" id="5929110">8</span><span class="op" id="5929111">*</span><span class="builtintype" id="5929112">int32</span><span class="op" id="5929117">(</span><span class="ident" id="5929118">e</span><span class="op" id="5929119">.</span><span class="ident" id="5929120">quant</span><span class="op" id="5929125">[</span><span class="ident" id="5929126">q</span><span class="op" id="5929127">]</span><span class="op" id="5929128">[</span><span class="ident" id="5929129">zig</span><span class="op" id="5929132">]</span><span class="op" id="5929133">)</span><span class="op" id="5929134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929138">if</span>&nbsp;<span class="ident" id="5929141">ac</span>&nbsp;<span class="op" id="5929144">==</span>&nbsp;<span class="num" id="5929147">0</span>&nbsp;<span class="op" id="5929149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929154">runLength</span><span class="op" id="5929163">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929168">}</span>&nbsp;<span class="keyword" id="5929170">else</span>&nbsp;<span class="op" id="5929175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929180">for</span>&nbsp;<span class="ident" id="5929184">runLength</span>&nbsp;<span class="op" id="5929194">&gt;</span>&nbsp;<span class="num" id="5929196">15</span>&nbsp;<span class="op" id="5929199">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929205">e</span><span class="op" id="5929206">.</span><span class="ident" id="5929207">emitHuff</span><span class="op" id="5929215">(</span><span class="ident" id="5929216">h</span><span class="op" id="5929217">,</span>&nbsp;<span class="num" id="5929219">0xf0</span><span class="op" id="5929223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929229">runLength</span>&nbsp;<span class="op" id="5929239">-=</span>&nbsp;<span class="num" id="5929242">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929253">e</span><span class="op" id="5929254">.</span><span class="ident" id="5929255">emitHuffRLE</span><span class="op" id="5929266">(</span><span class="ident" id="5929267">h</span><span class="op" id="5929268">,</span>&nbsp;<span class="ident" id="5929270">runLength</span><span class="op" id="5929279">,</span>&nbsp;<span class="ident" id="5929281">ac</span><span class="op" id="5929283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929288">runLength</span>&nbsp;<span class="op" id="5929298">=</span>&nbsp;<span class="num" id="5929300">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929310">if</span>&nbsp;<span class="ident" id="5929313">runLength</span>&nbsp;<span class="op" id="5929323">&gt;</span>&nbsp;<span class="num" id="5929325">0</span>&nbsp;<span class="op" id="5929327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929331">e</span><span class="op" id="5929332">.</span><span class="ident" id="5929333">emitHuff</span><span class="op" id="5929341">(</span><span class="ident" id="5929342">h</span><span class="op" id="5929343">,</span>&nbsp;<span class="num" id="5929345">0x00</span><span class="op" id="5929349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929352">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929355">return</span>&nbsp;<span class="ident" id="5929362">dc</span><br>
<span class="lineno"></span><span class="op" id="5929365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5929368">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5929442">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="5929459">func</span>&nbsp;<span class="ident" id="5929464">toYCbCr</span><span class="op" id="5929471">(</span><span class="ident" id="5929472">m</span>&nbsp;<span class="ident" id="5929474">image</span><span class="op" id="5929479">.</span><span class="ident" id="5929480">Image</span><span class="op" id="5929485">,</span>&nbsp;<span class="ident" id="5929487">p</span>&nbsp;<span class="ident" id="5929489">image</span><span class="op" id="5929494">.</span><span class="ident" id="5929495">Point</span><span class="op" id="5929500">,</span>&nbsp;<span class="ident" id="5929502">yBlock</span><span class="op" id="5929508">,</span>&nbsp;<span class="ident" id="5929510">cbBlock</span><span class="op" id="5929517">,</span>&nbsp;<span class="ident" id="5929519">crBlock</span>&nbsp;<span class="op" id="5929527">*</span><span class="ident" id="5929528">block</span><span class="op" id="5929533">)</span>&nbsp;<span class="op" id="5929535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929538">b</span>&nbsp;<span class="op" id="5929540">:=</span>&nbsp;<span class="ident" id="5929543">m</span><span class="op" id="5929544">.</span><span class="ident" id="5929545">Bounds</span><span class="op" id="5929551">(</span><span class="op" id="5929552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929555">xmax</span>&nbsp;<span class="op" id="5929560">:=</span>&nbsp;<span class="ident" id="5929563">b</span><span class="op" id="5929564">.</span><span class="ident" id="5929565">Max</span><span class="op" id="5929568">.</span><span class="ident" id="5929569">X</span>&nbsp;<span class="op" id="5929571">-</span>&nbsp;<span class="num" id="5929573">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929576">ymax</span>&nbsp;<span class="op" id="5929581">:=</span>&nbsp;<span class="ident" id="5929584">b</span><span class="op" id="5929585">.</span><span class="ident" id="5929586">Max</span><span class="op" id="5929589">.</span><span class="ident" id="5929590">Y</span>&nbsp;<span class="op" id="5929592">-</span>&nbsp;<span class="num" id="5929594">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929597">for</span>&nbsp;<span class="ident" id="5929601">j</span>&nbsp;<span class="op" id="5929603">:=</span>&nbsp;<span class="num" id="5929606">0</span><span class="op" id="5929607">;</span>&nbsp;<span class="ident" id="5929609">j</span>&nbsp;<span class="op" id="5929611">&lt;</span>&nbsp;<span class="num" id="5929613">8</span><span class="op" id="5929614">;</span>&nbsp;<span class="ident" id="5929616">j</span><span class="op" id="5929617">++</span>&nbsp;<span class="op" id="5929620">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5929624">for</span>&nbsp;<span class="ident" id="5929628">i</span>&nbsp;<span class="op" id="5929630">:=</span>&nbsp;<span class="num" id="5929633">0</span><span class="op" id="5929634">;</span>&nbsp;<span class="ident" id="5929636">i</span>&nbsp;<span class="op" id="5929638">&lt;</span>&nbsp;<span class="num" id="5929640">8</span><span class="op" id="5929641">;</span>&nbsp;<span class="ident" id="5929643">i</span><span class="op" id="5929644">++</span>&nbsp;<span class="op" id="5929647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929652">r</span><span class="op" id="5929653">,</span>&nbsp;<span class="ident" id="5929655">g</span><span class="op" id="5929656">,</span>&nbsp;<span class="ident" id="5929658">b</span><span class="op" id="5929659">,</span>&nbsp;<span class="ident" id="5929661">_</span>&nbsp;<span class="op" id="5929663">:=</span>&nbsp;<span class="ident" id="5929666">m</span><span class="op" id="5929667">.</span><span class="ident" id="5929668">At</span><span class="op" id="5929670">(</span><span class="ident" id="5929671">min</span><span class="op" id="5929674">(</span><span class="ident" id="5929675">p</span><span class="op" id="5929676">.</span><span class="ident" id="5929677">X</span><span class="op" id="5929678">+</span><span class="ident" id="5929679">i</span><span class="op" id="5929680">,</span>&nbsp;<span class="ident" id="5929682">xmax</span><span class="op" id="5929686">)</span><span class="op" id="5929687">,</span>&nbsp;<span class="ident" id="5929689">min</span><span class="op" id="5929692">(</span><span class="ident" id="5929693">p</span><span class="op" id="5929694">.</span><span class="ident" id="5929695">Y</span><span class="op" id="5929696">+</span><span class="ident" id="5929697">j</span><span class="op" id="5929698">,</span>&nbsp;<span class="ident" id="5929700">ymax</span><span class="op" id="5929704">)</span><span class="op" id="5929705">)</span><span class="op" id="5929706">.</span><span class="ident" id="5929707">RGBA</span><span class="op" id="5929711">(</span><span class="op" id="5929712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929717">yy</span><span class="op" id="5929719">,</span>&nbsp;<span class="ident" id="5929721">cb</span><span class="op" id="5929723">,</span>&nbsp;<span class="ident" id="5929725">cr</span>&nbsp;<span class="op" id="5929728">:=</span>&nbsp;<span class="ident" id="5929731">color</span><span class="op" id="5929736">.</span><span class="ident" id="5929737">RGBToYCbCr</span><span class="op" id="5929747">(</span><span class="builtintype" id="5929748">uint8</span><span class="op" id="5929753">(</span><span class="ident" id="5929754">r</span><span class="op" id="5929755">&gt;&gt;</span><span class="num" id="5929757">8</span><span class="op" id="5929758">)</span><span class="op" id="5929759">,</span>&nbsp;<span class="builtintype" id="5929761">uint8</span><span class="op" id="5929766">(</span><span class="ident" id="5929767">g</span><span class="op" id="5929768">&gt;&gt;</span><span class="num" id="5929770">8</span><span class="op" id="5929771">)</span><span class="op" id="5929772">,</span>&nbsp;<span class="builtintype" id="5929774">uint8</span><span class="op" id="5929779">(</span><span class="ident" id="5929780">b</span><span class="op" id="5929781">&gt;&gt;</span><span class="num" id="5929783">8</span><span class="op" id="5929784">)</span><span class="op" id="5929785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929790">yBlock</span><span class="op" id="5929796">[</span><span class="num" id="5929797">8</span><span class="op" id="5929798">*</span><span class="ident" id="5929799">j</span><span class="op" id="5929800">+</span><span class="ident" id="5929801">i</span><span class="op" id="5929802">]</span>&nbsp;<span class="op" id="5929804">=</span>&nbsp;<span class="builtintype" id="5929806">int32</span><span class="op" id="5929811">(</span><span class="ident" id="5929812">yy</span><span class="op" id="5929814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929819">cbBlock</span><span class="op" id="5929826">[</span><span class="num" id="5929827">8</span><span class="op" id="5929828">*</span><span class="ident" id="5929829">j</span><span class="op" id="5929830">+</span><span class="ident" id="5929831">i</span><span class="op" id="5929832">]</span>&nbsp;<span class="op" id="5929834">=</span>&nbsp;<span class="builtintype" id="5929836">int32</span><span class="op" id="5929841">(</span><span class="ident" id="5929842">cb</span><span class="op" id="5929844">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5929849">crBlock</span><span class="op" id="5929856">[</span><span class="num" id="5929857">8</span><span class="op" id="5929858">*</span><span class="ident" id="5929859">j</span><span class="op" id="5929860">+</span><span class="ident" id="5929861">i</span><span class="op" id="5929862">]</span>&nbsp;<span class="op" id="5929864">=</span>&nbsp;<span class="builtintype" id="5929866">int32</span><span class="op" id="5929871">(</span><span class="ident" id="5929872">cr</span><span class="op" id="5929874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5929881">}</span><br>
<span class="lineno"></span><span class="op" id="5929883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="5929886">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="5929962">func</span>&nbsp;<span class="ident" id="5929967">grayToY</span><span class="op" id="5929974">(</span><span class="ident" id="5929975">m</span>&nbsp;<span class="op" id="5929977">*</span><span class="ident" id="5929978">image</span><span class="op" id="5929983">.</span><span class="ident" id="5929984">Gray</span><span class="op" id="5929988">,</span>&nbsp;<span class="ident" id="5929990">p</span>&nbsp;<span class="ident" id="5929992">image</span><span class="op" id="5929997">.</span><span class="ident" id="5929998">Point</span><span class="op" id="5930003">,</span>&nbsp;<span class="ident" id="5930005">yBlock</span>&nbsp;<span class="op" id="5930012">*</span><span class="ident" id="5930013">block</span><span class="op" id="5930018">)</span>&nbsp;<span class="op" id="5930020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930023">b</span>&nbsp;<span class="op" id="5930025">:=</span>&nbsp;<span class="ident" id="5930028">m</span><span class="op" id="5930029">.</span><span class="ident" id="5930030">Bounds</span><span class="op" id="5930036">(</span><span class="op" id="5930037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930040">xmax</span>&nbsp;<span class="op" id="5930045">:=</span>&nbsp;<span class="ident" id="5930048">b</span><span class="op" id="5930049">.</span><span class="ident" id="5930050">Max</span><span class="op" id="5930053">.</span><span class="ident" id="5930054">X</span>&nbsp;<span class="op" id="5930056">-</span>&nbsp;<span class="num" id="5930058">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930061">ymax</span>&nbsp;<span class="op" id="5930066">:=</span>&nbsp;<span class="ident" id="5930069">b</span><span class="op" id="5930070">.</span><span class="ident" id="5930071">Max</span><span class="op" id="5930074">.</span><span class="ident" id="5930075">Y</span>&nbsp;<span class="op" id="5930077">-</span>&nbsp;<span class="num" id="5930079">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930082">pix</span>&nbsp;<span class="op" id="5930086">:=</span>&nbsp;<span class="ident" id="5930089">m</span><span class="op" id="5930090">.</span><span class="ident" id="5930091">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930096">for</span>&nbsp;<span class="ident" id="5930100">j</span>&nbsp;<span class="op" id="5930102">:=</span>&nbsp;<span class="num" id="5930105">0</span><span class="op" id="5930106">;</span>&nbsp;<span class="ident" id="5930108">j</span>&nbsp;<span class="op" id="5930110">&lt;</span>&nbsp;<span class="num" id="5930112">8</span><span class="op" id="5930113">;</span>&nbsp;<span class="ident" id="5930115">j</span><span class="op" id="5930116">++</span>&nbsp;<span class="op" id="5930119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930123">for</span>&nbsp;<span class="ident" id="5930127">i</span>&nbsp;<span class="op" id="5930129">:=</span>&nbsp;<span class="num" id="5930132">0</span><span class="op" id="5930133">;</span>&nbsp;<span class="ident" id="5930135">i</span>&nbsp;<span class="op" id="5930137">&lt;</span>&nbsp;<span class="num" id="5930139">8</span><span class="op" id="5930140">;</span>&nbsp;<span class="ident" id="5930142">i</span><span class="op" id="5930143">++</span>&nbsp;<span class="op" id="5930146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930151">idx</span>&nbsp;<span class="op" id="5930155">:=</span>&nbsp;<span class="ident" id="5930158">m</span><span class="op" id="5930159">.</span><span class="ident" id="5930160">PixOffset</span><span class="op" id="5930169">(</span><span class="ident" id="5930170">min</span><span class="op" id="5930173">(</span><span class="ident" id="5930174">p</span><span class="op" id="5930175">.</span><span class="ident" id="5930176">X</span><span class="op" id="5930177">+</span><span class="ident" id="5930178">i</span><span class="op" id="5930179">,</span>&nbsp;<span class="ident" id="5930181">xmax</span><span class="op" id="5930185">)</span><span class="op" id="5930186">,</span>&nbsp;<span class="ident" id="5930188">min</span><span class="op" id="5930191">(</span><span class="ident" id="5930192">p</span><span class="op" id="5930193">.</span><span class="ident" id="5930194">Y</span><span class="op" id="5930195">+</span><span class="ident" id="5930196">j</span><span class="op" id="5930197">,</span>&nbsp;<span class="ident" id="5930199">ymax</span><span class="op" id="5930203">)</span><span class="op" id="5930204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930209">yBlock</span><span class="op" id="5930215">[</span><span class="num" id="5930216">8</span><span class="op" id="5930217">*</span><span class="ident" id="5930218">j</span><span class="op" id="5930219">+</span><span class="ident" id="5930220">i</span><span class="op" id="5930221">]</span>&nbsp;<span class="op" id="5930223">=</span>&nbsp;<span class="builtintype" id="5930225">int32</span><span class="op" id="5930230">(</span><span class="ident" id="5930231">pix</span><span class="op" id="5930234">[</span><span class="ident" id="5930235">idx</span><span class="op" id="5930238">]</span><span class="op" id="5930239">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930246">}</span><br>
<span class="lineno"></span><span class="op" id="5930248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5930251">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="5930325">func</span>&nbsp;<span class="ident" id="5930330">rgbaToYCbCr</span><span class="op" id="5930341">(</span><span class="ident" id="5930342">m</span>&nbsp;<span class="op" id="5930344">*</span><span class="ident" id="5930345">image</span><span class="op" id="5930350">.</span><span class="ident" id="5930351">RGBA</span><span class="op" id="5930355">,</span>&nbsp;<span class="ident" id="5930357">p</span>&nbsp;<span class="ident" id="5930359">image</span><span class="op" id="5930364">.</span><span class="ident" id="5930365">Point</span><span class="op" id="5930370">,</span>&nbsp;<span class="ident" id="5930372">yBlock</span><span class="op" id="5930378">,</span>&nbsp;<span class="ident" id="5930380">cbBlock</span><span class="op" id="5930387">,</span>&nbsp;<span class="ident" id="5930389">crBlock</span>&nbsp;<span class="op" id="5930397">*</span><span class="ident" id="5930398">block</span><span class="op" id="5930403">)</span>&nbsp;<span class="op" id="5930405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930408">b</span>&nbsp;<span class="op" id="5930410">:=</span>&nbsp;<span class="ident" id="5930413">m</span><span class="op" id="5930414">.</span><span class="ident" id="5930415">Bounds</span><span class="op" id="5930421">(</span><span class="op" id="5930422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930425">xmax</span>&nbsp;<span class="op" id="5930430">:=</span>&nbsp;<span class="ident" id="5930433">b</span><span class="op" id="5930434">.</span><span class="ident" id="5930435">Max</span><span class="op" id="5930438">.</span><span class="ident" id="5930439">X</span>&nbsp;<span class="op" id="5930441">-</span>&nbsp;<span class="num" id="5930443">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930446">ymax</span>&nbsp;<span class="op" id="5930451">:=</span>&nbsp;<span class="ident" id="5930454">b</span><span class="op" id="5930455">.</span><span class="ident" id="5930456">Max</span><span class="op" id="5930459">.</span><span class="ident" id="5930460">Y</span>&nbsp;<span class="op" id="5930462">-</span>&nbsp;<span class="num" id="5930464">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930467">for</span>&nbsp;<span class="ident" id="5930471">j</span>&nbsp;<span class="op" id="5930473">:=</span>&nbsp;<span class="num" id="5930476">0</span><span class="op" id="5930477">;</span>&nbsp;<span class="ident" id="5930479">j</span>&nbsp;<span class="op" id="5930481">&lt;</span>&nbsp;<span class="num" id="5930483">8</span><span class="op" id="5930484">;</span>&nbsp;<span class="ident" id="5930486">j</span><span class="op" id="5930487">++</span>&nbsp;<span class="op" id="5930490">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930494">sj</span>&nbsp;<span class="op" id="5930497">:=</span>&nbsp;<span class="ident" id="5930500">p</span><span class="op" id="5930501">.</span><span class="ident" id="5930502">Y</span>&nbsp;<span class="op" id="5930504">+</span>&nbsp;<span class="ident" id="5930506">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930510">if</span>&nbsp;<span class="ident" id="5930513">sj</span>&nbsp;<span class="op" id="5930516">&gt;</span>&nbsp;<span class="ident" id="5930518">ymax</span>&nbsp;<span class="op" id="5930523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930528">sj</span>&nbsp;<span class="op" id="5930531">=</span>&nbsp;<span class="ident" id="5930533">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930544">offset</span>&nbsp;<span class="op" id="5930551">:=</span>&nbsp;<span class="op" id="5930554">(</span><span class="ident" id="5930555">sj</span><span class="op" id="5930557">-</span><span class="ident" id="5930558">b</span><span class="op" id="5930559">.</span><span class="ident" id="5930560">Min</span><span class="op" id="5930563">.</span><span class="ident" id="5930564">Y</span><span class="op" id="5930565">)</span><span class="op" id="5930566">*</span><span class="ident" id="5930567">m</span><span class="op" id="5930568">.</span><span class="ident" id="5930569">Stride</span>&nbsp;<span class="op" id="5930576">-</span>&nbsp;<span class="ident" id="5930578">b</span><span class="op" id="5930579">.</span><span class="ident" id="5930580">Min</span><span class="op" id="5930583">.</span><span class="ident" id="5930584">X</span><span class="op" id="5930585">*</span><span class="num" id="5930586">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930590">for</span>&nbsp;<span class="ident" id="5930594">i</span>&nbsp;<span class="op" id="5930596">:=</span>&nbsp;<span class="num" id="5930599">0</span><span class="op" id="5930600">;</span>&nbsp;<span class="ident" id="5930602">i</span>&nbsp;<span class="op" id="5930604">&lt;</span>&nbsp;<span class="num" id="5930606">8</span><span class="op" id="5930607">;</span>&nbsp;<span class="ident" id="5930609">i</span><span class="op" id="5930610">++</span>&nbsp;<span class="op" id="5930613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930618">sx</span>&nbsp;<span class="op" id="5930621">:=</span>&nbsp;<span class="ident" id="5930624">p</span><span class="op" id="5930625">.</span><span class="ident" id="5930626">X</span>&nbsp;<span class="op" id="5930628">+</span>&nbsp;<span class="ident" id="5930630">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930635">if</span>&nbsp;<span class="ident" id="5930638">sx</span>&nbsp;<span class="op" id="5930641">&gt;</span>&nbsp;<span class="ident" id="5930643">xmax</span>&nbsp;<span class="op" id="5930648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930654">sx</span>&nbsp;<span class="op" id="5930657">=</span>&nbsp;<span class="ident" id="5930659">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930667">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930672">pix</span>&nbsp;<span class="op" id="5930676">:=</span>&nbsp;<span class="ident" id="5930679">m</span><span class="op" id="5930680">.</span><span class="ident" id="5930681">Pix</span><span class="op" id="5930684">[</span><span class="ident" id="5930685">offset</span><span class="op" id="5930691">+</span><span class="ident" id="5930692">sx</span><span class="op" id="5930694">*</span><span class="num" id="5930695">4</span><span class="op" id="5930696">:</span><span class="op" id="5930697">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930702">yy</span><span class="op" id="5930704">,</span>&nbsp;<span class="ident" id="5930706">cb</span><span class="op" id="5930708">,</span>&nbsp;<span class="ident" id="5930710">cr</span>&nbsp;<span class="op" id="5930713">:=</span>&nbsp;<span class="ident" id="5930716">color</span><span class="op" id="5930721">.</span><span class="ident" id="5930722">RGBToYCbCr</span><span class="op" id="5930732">(</span><span class="ident" id="5930733">pix</span><span class="op" id="5930736">[</span><span class="num" id="5930737">0</span><span class="op" id="5930738">]</span><span class="op" id="5930739">,</span>&nbsp;<span class="ident" id="5930741">pix</span><span class="op" id="5930744">[</span><span class="num" id="5930745">1</span><span class="op" id="5930746">]</span><span class="op" id="5930747">,</span>&nbsp;<span class="ident" id="5930749">pix</span><span class="op" id="5930752">[</span><span class="num" id="5930753">2</span><span class="op" id="5930754">]</span><span class="op" id="5930755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930760">yBlock</span><span class="op" id="5930766">[</span><span class="num" id="5930767">8</span><span class="op" id="5930768">*</span><span class="ident" id="5930769">j</span><span class="op" id="5930770">+</span><span class="ident" id="5930771">i</span><span class="op" id="5930772">]</span>&nbsp;<span class="op" id="5930774">=</span>&nbsp;<span class="builtintype" id="5930776">int32</span><span class="op" id="5930781">(</span><span class="ident" id="5930782">yy</span><span class="op" id="5930784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930789">cbBlock</span><span class="op" id="5930796">[</span><span class="num" id="5930797">8</span><span class="op" id="5930798">*</span><span class="ident" id="5930799">j</span><span class="op" id="5930800">+</span><span class="ident" id="5930801">i</span><span class="op" id="5930802">]</span>&nbsp;<span class="op" id="5930804">=</span>&nbsp;<span class="builtintype" id="5930806">int32</span><span class="op" id="5930811">(</span><span class="ident" id="5930812">cb</span><span class="op" id="5930814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5930819">crBlock</span><span class="op" id="5930826">[</span><span class="num" id="5930827">8</span><span class="op" id="5930828">*</span><span class="ident" id="5930829">j</span><span class="op" id="5930830">+</span><span class="ident" id="5930831">i</span><span class="op" id="5930832">]</span>&nbsp;<span class="op" id="5930834">=</span>&nbsp;<span class="builtintype" id="5930836">int32</span><span class="op" id="5930841">(</span><span class="ident" id="5930842">cr</span><span class="op" id="5930844">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5930851">}</span><br>
<span class="lineno"></span><span class="op" id="5930853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5930856">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="5930932">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5930946">func</span>&nbsp;<span class="ident" id="5930951">scale</span><span class="op" id="5930956">(</span><span class="ident" id="5930957">dst</span>&nbsp;<span class="op" id="5930961">*</span><span class="ident" id="5930962">block</span><span class="op" id="5930967">,</span>&nbsp;<span class="ident" id="5930969">src</span>&nbsp;<span class="op" id="5930973">*</span><span class="op" id="5930974">[</span><span class="num" id="5930975">4</span><span class="op" id="5930976">]</span><span class="ident" id="5930977">block</span><span class="op" id="5930982">)</span>&nbsp;<span class="op" id="5930984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5930987">for</span>&nbsp;<span class="ident" id="5930991">i</span>&nbsp;<span class="op" id="5930993">:=</span>&nbsp;<span class="num" id="5930996">0</span><span class="op" id="5930997">;</span>&nbsp;<span class="ident" id="5930999">i</span>&nbsp;<span class="op" id="5931001">&lt;</span>&nbsp;<span class="num" id="5931003">4</span><span class="op" id="5931004">;</span>&nbsp;<span class="ident" id="5931006">i</span><span class="op" id="5931007">++</span>&nbsp;<span class="op" id="5931010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931014">dstOff</span>&nbsp;<span class="op" id="5931021">:=</span>&nbsp;<span class="op" id="5931024">(</span><span class="ident" id="5931025">i</span><span class="op" id="5931026">&amp;</span><span class="num" id="5931027">2</span><span class="op" id="5931028">)</span><span class="op" id="5931029">&lt;&lt;</span><span class="num" id="5931031">4</span>&nbsp;<span class="op" id="5931033">|</span>&nbsp;<span class="op" id="5931035">(</span><span class="ident" id="5931036">i</span><span class="op" id="5931037">&amp;</span><span class="num" id="5931038">1</span><span class="op" id="5931039">)</span><span class="op" id="5931040">&lt;&lt;</span><span class="num" id="5931042">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931046">for</span>&nbsp;<span class="ident" id="5931050">y</span>&nbsp;<span class="op" id="5931052">:=</span>&nbsp;<span class="num" id="5931055">0</span><span class="op" id="5931056">;</span>&nbsp;<span class="ident" id="5931058">y</span>&nbsp;<span class="op" id="5931060">&lt;</span>&nbsp;<span class="num" id="5931062">4</span><span class="op" id="5931063">;</span>&nbsp;<span class="ident" id="5931065">y</span><span class="op" id="5931066">++</span>&nbsp;<span class="op" id="5931069">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5931074">for</span>&nbsp;<span class="ident" id="5931078">x</span>&nbsp;<span class="op" id="5931080">:=</span>&nbsp;<span class="num" id="5931083">0</span><span class="op" id="5931084">;</span>&nbsp;<span class="ident" id="5931086">x</span>&nbsp;<span class="op" id="5931088">&lt;</span>&nbsp;<span class="num" id="5931090">4</span><span class="op" id="5931091">;</span>&nbsp;<span class="ident" id="5931093">x</span><span class="op" id="5931094">++</span>&nbsp;<span class="op" id="5931097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931103">j</span>&nbsp;<span class="op" id="5931105">:=</span>&nbsp;<span class="num" id="5931108">16</span><span class="op" id="5931110">*</span><span class="ident" id="5931111">y</span>&nbsp;<span class="op" id="5931113">+</span>&nbsp;<span class="num" id="5931115">2</span><span class="op" id="5931116">*</span><span class="ident" id="5931117">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931123">sum</span>&nbsp;<span class="op" id="5931127">:=</span>&nbsp;<span class="ident" id="5931130">src</span><span class="op" id="5931133">[</span><span class="ident" id="5931134">i</span><span class="op" id="5931135">]</span><span class="op" id="5931136">[</span><span class="ident" id="5931137">j</span><span class="op" id="5931138">]</span>&nbsp;<span class="op" id="5931140">+</span>&nbsp;<span class="ident" id="5931142">src</span><span class="op" id="5931145">[</span><span class="ident" id="5931146">i</span><span class="op" id="5931147">]</span><span class="op" id="5931148">[</span><span class="ident" id="5931149">j</span><span class="op" id="5931150">+</span><span class="num" id="5931151">1</span><span class="op" id="5931152">]</span>&nbsp;<span class="op" id="5931154">+</span>&nbsp;<span class="ident" id="5931156">src</span><span class="op" id="5931159">[</span><span class="ident" id="5931160">i</span><span class="op" id="5931161">]</span><span class="op" id="5931162">[</span><span class="ident" id="5931163">j</span><span class="op" id="5931164">+</span><span class="num" id="5931165">8</span><span class="op" id="5931166">]</span>&nbsp;<span class="op" id="5931168">+</span>&nbsp;<span class="ident" id="5931170">src</span><span class="op" id="5931173">[</span><span class="ident" id="5931174">i</span><span class="op" id="5931175">]</span><span class="op" id="5931176">[</span><span class="ident" id="5931177">j</span><span class="op" id="5931178">+</span><span class="num" id="5931179">9</span><span class="op" id="5931180">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5931186">dst</span><span class="op" id="5931189">[</span><span class="num" id="5931190">8</span><span class="op" id="5931191">*</span><span class="ident" id="5931192">y</span><span class="op" id="5931193">+</span><span class="ident" id="5931194">x</span><span class="op" id="5931195">+</span><span class="ident" id="5931196">dstOff</span><span class="op" id="5931202">]</span>&nbsp;<span class="op" id="5931204">=</span>&nbsp;<span class="op" id="5931206">(</span><span class="ident" id="5931207">sum</span>&nbsp;<span class="op" id="5931211">+</span>&nbsp;<span class="num" id="5931213">2</span><span class="op" id="5931214">)</span>&nbsp;<span class="op" id="5931216">&gt;&gt;</span>&nbsp;<span class="num" id="5931219">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931224">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5931231">}</span><br>
<span class="lineno"></span><span class="op" id="5931233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5931236">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="5931300">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5931335">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5931373">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5931433">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5931504">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="5931579">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5931622">var</span>&nbsp;<span class="ident" id="5931626">sosHeaderY</span>&nbsp;<span class="op" id="5931637">=</span>&nbsp;<span class="op" id="5931639">[</span><span class="op" id="5931640">]</span><span class="builtintype" id="5931641">byte</span><span class="op" id="5931645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5931648">0xff</span><span class="op" id="5931652">,</span>&nbsp;<span class="num" id="5931654">0xda</span><span class="op" id="5931658">,</span>&nbsp;<span class="num" id="5931660">0x00</span><span class="op" id="5931664">,</span>&nbsp;<span class="num" id="5931666">0x08</span><span class="op" id="5931670">,</span>&nbsp;<span class="num" id="5931672">0x01</span><span class="op" id="5931676">,</span>&nbsp;<span class="num" id="5931678">0x01</span><span class="op" id="5931682">,</span>&nbsp;<span class="num" id="5931684">0x00</span><span class="op" id="5931688">,</span>&nbsp;<span class="num" id="5931690">0x00</span><span class="op" id="5931694">,</span>&nbsp;<span class="num" id="5931696">0x3f</span><span class="op" id="5931700">,</span>&nbsp;<span class="num" id="5931702">0x00</span><span class="op" id="5931706">,</span><br>
<span class="lineno"></span><span class="op" id="5931708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="5931711">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="5931780">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5931815">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5931853">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5931913">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="5931973">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5932033">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5932104">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="5932179">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5932222">var</span>&nbsp;<span class="ident" id="5932226">sosHeaderYCbCr</span>&nbsp;<span class="op" id="5932241">=</span>&nbsp;<span class="op" id="5932243">[</span><span class="op" id="5932244">]</span><span class="builtintype" id="5932245">byte</span><span class="op" id="5932249">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5932252">0xff</span><span class="op" id="5932256">,</span>&nbsp;<span class="num" id="5932258">0xda</span><span class="op" id="5932262">,</span>&nbsp;<span class="num" id="5932264">0x00</span><span class="op" id="5932268">,</span>&nbsp;<span class="num" id="5932270">0x0c</span><span class="op" id="5932274">,</span>&nbsp;<span class="num" id="5932276">0x03</span><span class="op" id="5932280">,</span>&nbsp;<span class="num" id="5932282">0x01</span><span class="op" id="5932286">,</span>&nbsp;<span class="num" id="5932288">0x00</span><span class="op" id="5932292">,</span>&nbsp;<span class="num" id="5932294">0x02</span><span class="op" id="5932298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5932301">0x11</span><span class="op" id="5932305">,</span>&nbsp;<span class="num" id="5932307">0x03</span><span class="op" id="5932311">,</span>&nbsp;<span class="num" id="5932313">0x11</span><span class="op" id="5932317">,</span>&nbsp;<span class="num" id="5932319">0x00</span><span class="op" id="5932323">,</span>&nbsp;<span class="num" id="5932325">0x3f</span><span class="op" id="5932329">,</span>&nbsp;<span class="num" id="5932331">0x00</span><span class="op" id="5932335">,</span><br>
<span class="lineno"></span><span class="op" id="5932337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5932340">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="5932383">func</span>&nbsp;<span class="op" id="5932388">(</span><span class="ident" id="5932389">e</span>&nbsp;<span class="op" id="5932391">*</span><span class="ident" id="5932392">encoder</span><span class="op" id="5932399">)</span>&nbsp;<span class="ident" id="5932401">writeSOS</span><span class="op" id="5932409">(</span><span class="ident" id="5932410">m</span>&nbsp;<span class="ident" id="5932412">image</span><span class="op" id="5932417">.</span><span class="ident" id="5932418">Image</span><span class="op" id="5932423">)</span>&nbsp;<span class="op" id="5932425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932428">switch</span>&nbsp;<span class="ident" id="5932435">m</span><span class="op" id="5932436">.</span><span class="op" id="5932437">(</span><span class="keyword" id="5932438">type</span><span class="op" id="5932442">)</span>&nbsp;<span class="op" id="5932444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932447">case</span>&nbsp;<span class="op" id="5932452">*</span><span class="ident" id="5932453">image</span><span class="op" id="5932458">.</span><span class="ident" id="5932459">Gray</span><span class="op" id="5932463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932467">e</span><span class="op" id="5932468">.</span><span class="ident" id="5932469">write</span><span class="op" id="5932474">(</span><span class="ident" id="5932475">sosHeaderY</span><span class="op" id="5932485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932488">default</span><span class="op" id="5932495">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932499">e</span><span class="op" id="5932500">.</span><span class="ident" id="5932501">write</span><span class="op" id="5932506">(</span><span class="ident" id="5932507">sosHeaderYCbCr</span><span class="op" id="5932521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932527">var</span>&nbsp;<span class="op" id="5932531">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5932535">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5932582">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932634">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5932641">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932649">cb</span><span class="op" id="5932651">,</span>&nbsp;<span class="ident" id="5932653">cr</span>&nbsp;<span class="op" id="5932656">[</span><span class="num" id="5932657">4</span><span class="op" id="5932658">]</span><span class="ident" id="5932659">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5932667">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932705">prevDCY</span><span class="op" id="5932712">,</span>&nbsp;<span class="ident" id="5932714">prevDCCb</span><span class="op" id="5932722">,</span>&nbsp;<span class="ident" id="5932724">prevDCCr</span>&nbsp;<span class="builtintype" id="5932733">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5932740">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932743">bounds</span>&nbsp;<span class="op" id="5932750">:=</span>&nbsp;<span class="ident" id="5932753">m</span><span class="op" id="5932754">.</span><span class="ident" id="5932755">Bounds</span><span class="op" id="5932761">(</span><span class="op" id="5932762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932765">switch</span>&nbsp;<span class="ident" id="5932772">m</span>&nbsp;<span class="op" id="5932774">:=</span>&nbsp;<span class="ident" id="5932777">m</span><span class="op" id="5932778">.</span><span class="op" id="5932779">(</span><span class="keyword" id="5932780">type</span><span class="op" id="5932784">)</span>&nbsp;<span class="op" id="5932786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5932789">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932851">case</span>&nbsp;<span class="op" id="5932856">*</span><span class="ident" id="5932857">image</span><span class="op" id="5932862">.</span><span class="ident" id="5932863">Gray</span><span class="op" id="5932867">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932871">for</span>&nbsp;<span class="ident" id="5932875">y</span>&nbsp;<span class="op" id="5932877">:=</span>&nbsp;<span class="ident" id="5932880">bounds</span><span class="op" id="5932886">.</span><span class="ident" id="5932887">Min</span><span class="op" id="5932890">.</span><span class="ident" id="5932891">Y</span><span class="op" id="5932892">;</span>&nbsp;<span class="ident" id="5932894">y</span>&nbsp;<span class="op" id="5932896">&lt;</span>&nbsp;<span class="ident" id="5932898">bounds</span><span class="op" id="5932904">.</span><span class="ident" id="5932905">Max</span><span class="op" id="5932908">.</span><span class="ident" id="5932909">Y</span><span class="op" id="5932910">;</span>&nbsp;<span class="ident" id="5932912">y</span>&nbsp;<span class="op" id="5932914">+=</span>&nbsp;<span class="num" id="5932917">8</span>&nbsp;<span class="op" id="5932919">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5932924">for</span>&nbsp;<span class="ident" id="5932928">x</span>&nbsp;<span class="op" id="5932930">:=</span>&nbsp;<span class="ident" id="5932933">bounds</span><span class="op" id="5932939">.</span><span class="ident" id="5932940">Min</span><span class="op" id="5932943">.</span><span class="ident" id="5932944">X</span><span class="op" id="5932945">;</span>&nbsp;<span class="ident" id="5932947">x</span>&nbsp;<span class="op" id="5932949">&lt;</span>&nbsp;<span class="ident" id="5932951">bounds</span><span class="op" id="5932957">.</span><span class="ident" id="5932958">Max</span><span class="op" id="5932961">.</span><span class="ident" id="5932962">X</span><span class="op" id="5932963">;</span>&nbsp;<span class="ident" id="5932965">x</span>&nbsp;<span class="op" id="5932967">+=</span>&nbsp;<span class="num" id="5932970">8</span>&nbsp;<span class="op" id="5932972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932978">p</span>&nbsp;<span class="op" id="5932980">:=</span>&nbsp;<span class="ident" id="5932983">image</span><span class="op" id="5932988">.</span><span class="ident" id="5932989">Pt</span><span class="op" id="5932991">(</span><span class="ident" id="5932992">x</span><span class="op" id="5932993">,</span>&nbsp;<span class="ident" id="5932995">y</span><span class="op" id="5932996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933002">grayToY</span><span class="op" id="5933009">(</span><span class="ident" id="5933010">m</span><span class="op" id="5933011">,</span>&nbsp;<span class="ident" id="5933013">p</span><span class="op" id="5933014">,</span>&nbsp;<span class="op" id="5933016">&amp;</span><span class="ident" id="5933017">b</span><span class="op" id="5933018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933024">prevDCY</span>&nbsp;<span class="op" id="5933032">=</span>&nbsp;<span class="ident" id="5933034">e</span><span class="op" id="5933035">.</span><span class="ident" id="5933036">writeBlock</span><span class="op" id="5933046">(</span><span class="op" id="5933047">&amp;</span><span class="ident" id="5933048">b</span><span class="op" id="5933049">,</span>&nbsp;<span class="num" id="5933051">0</span><span class="op" id="5933052">,</span>&nbsp;<span class="ident" id="5933054">prevDCY</span><span class="op" id="5933061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933066">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933073">default</span><span class="op" id="5933080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933084">rgba</span><span class="op" id="5933088">,</span>&nbsp;<span class="ident" id="5933090">_</span>&nbsp;<span class="op" id="5933092">:=</span>&nbsp;<span class="ident" id="5933095">m</span><span class="op" id="5933096">.</span><span class="op" id="5933097">(</span><span class="op" id="5933098">*</span><span class="ident" id="5933099">image</span><span class="op" id="5933104">.</span><span class="ident" id="5933105">RGBA</span><span class="op" id="5933109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933113">for</span>&nbsp;<span class="ident" id="5933117">y</span>&nbsp;<span class="op" id="5933119">:=</span>&nbsp;<span class="ident" id="5933122">bounds</span><span class="op" id="5933128">.</span><span class="ident" id="5933129">Min</span><span class="op" id="5933132">.</span><span class="ident" id="5933133">Y</span><span class="op" id="5933134">;</span>&nbsp;<span class="ident" id="5933136">y</span>&nbsp;<span class="op" id="5933138">&lt;</span>&nbsp;<span class="ident" id="5933140">bounds</span><span class="op" id="5933146">.</span><span class="ident" id="5933147">Max</span><span class="op" id="5933150">.</span><span class="ident" id="5933151">Y</span><span class="op" id="5933152">;</span>&nbsp;<span class="ident" id="5933154">y</span>&nbsp;<span class="op" id="5933156">+=</span>&nbsp;<span class="num" id="5933159">16</span>&nbsp;<span class="op" id="5933162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933167">for</span>&nbsp;<span class="ident" id="5933171">x</span>&nbsp;<span class="op" id="5933173">:=</span>&nbsp;<span class="ident" id="5933176">bounds</span><span class="op" id="5933182">.</span><span class="ident" id="5933183">Min</span><span class="op" id="5933186">.</span><span class="ident" id="5933187">X</span><span class="op" id="5933188">;</span>&nbsp;<span class="ident" id="5933190">x</span>&nbsp;<span class="op" id="5933192">&lt;</span>&nbsp;<span class="ident" id="5933194">bounds</span><span class="op" id="5933200">.</span><span class="ident" id="5933201">Max</span><span class="op" id="5933204">.</span><span class="ident" id="5933205">X</span><span class="op" id="5933206">;</span>&nbsp;<span class="ident" id="5933208">x</span>&nbsp;<span class="op" id="5933210">+=</span>&nbsp;<span class="num" id="5933213">16</span>&nbsp;<span class="op" id="5933216">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933222">for</span>&nbsp;<span class="ident" id="5933226">i</span>&nbsp;<span class="op" id="5933228">:=</span>&nbsp;<span class="num" id="5933231">0</span><span class="op" id="5933232">;</span>&nbsp;<span class="ident" id="5933234">i</span>&nbsp;<span class="op" id="5933236">&lt;</span>&nbsp;<span class="num" id="5933238">4</span><span class="op" id="5933239">;</span>&nbsp;<span class="ident" id="5933241">i</span><span class="op" id="5933242">++</span>&nbsp;<span class="op" id="5933245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933252">xOff</span>&nbsp;<span class="op" id="5933257">:=</span>&nbsp;<span class="op" id="5933260">(</span><span class="ident" id="5933261">i</span>&nbsp;<span class="op" id="5933263">&amp;</span>&nbsp;<span class="num" id="5933265">1</span><span class="op" id="5933266">)</span>&nbsp;<span class="op" id="5933268">*</span>&nbsp;<span class="num" id="5933270">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933277">yOff</span>&nbsp;<span class="op" id="5933282">:=</span>&nbsp;<span class="op" id="5933285">(</span><span class="ident" id="5933286">i</span>&nbsp;<span class="op" id="5933288">&amp;</span>&nbsp;<span class="num" id="5933290">2</span><span class="op" id="5933291">)</span>&nbsp;<span class="op" id="5933293">*</span>&nbsp;<span class="num" id="5933295">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933302">p</span>&nbsp;<span class="op" id="5933304">:=</span>&nbsp;<span class="ident" id="5933307">image</span><span class="op" id="5933312">.</span><span class="ident" id="5933313">Pt</span><span class="op" id="5933315">(</span><span class="ident" id="5933316">x</span><span class="op" id="5933317">+</span><span class="ident" id="5933318">xOff</span><span class="op" id="5933322">,</span>&nbsp;<span class="ident" id="5933324">y</span><span class="op" id="5933325">+</span><span class="ident" id="5933326">yOff</span><span class="op" id="5933330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933337">if</span>&nbsp;<span class="ident" id="5933340">rgba</span>&nbsp;<span class="op" id="5933345">!=</span>&nbsp;<span class="ident" id="5933348">nil</span>&nbsp;<span class="op" id="5933352">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933360">rgbaToYCbCr</span><span class="op" id="5933371">(</span><span class="ident" id="5933372">rgba</span><span class="op" id="5933376">,</span>&nbsp;<span class="ident" id="5933378">p</span><span class="op" id="5933379">,</span>&nbsp;<span class="op" id="5933381">&amp;</span><span class="ident" id="5933382">b</span><span class="op" id="5933383">,</span>&nbsp;<span class="op" id="5933385">&amp;</span><span class="ident" id="5933386">cb</span><span class="op" id="5933388">[</span><span class="ident" id="5933389">i</span><span class="op" id="5933390">]</span><span class="op" id="5933391">,</span>&nbsp;<span class="op" id="5933393">&amp;</span><span class="ident" id="5933394">cr</span><span class="op" id="5933396">[</span><span class="ident" id="5933397">i</span><span class="op" id="5933398">]</span><span class="op" id="5933399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933406">}</span>&nbsp;<span class="keyword" id="5933408">else</span>&nbsp;<span class="op" id="5933413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933421">toYCbCr</span><span class="op" id="5933428">(</span><span class="ident" id="5933429">m</span><span class="op" id="5933430">,</span>&nbsp;<span class="ident" id="5933432">p</span><span class="op" id="5933433">,</span>&nbsp;<span class="op" id="5933435">&amp;</span><span class="ident" id="5933436">b</span><span class="op" id="5933437">,</span>&nbsp;<span class="op" id="5933439">&amp;</span><span class="ident" id="5933440">cb</span><span class="op" id="5933442">[</span><span class="ident" id="5933443">i</span><span class="op" id="5933444">]</span><span class="op" id="5933445">,</span>&nbsp;<span class="op" id="5933447">&amp;</span><span class="ident" id="5933448">cr</span><span class="op" id="5933450">[</span><span class="ident" id="5933451">i</span><span class="op" id="5933452">]</span><span class="op" id="5933453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933467">prevDCY</span>&nbsp;<span class="op" id="5933475">=</span>&nbsp;<span class="ident" id="5933477">e</span><span class="op" id="5933478">.</span><span class="ident" id="5933479">writeBlock</span><span class="op" id="5933489">(</span><span class="op" id="5933490">&amp;</span><span class="ident" id="5933491">b</span><span class="op" id="5933492">,</span>&nbsp;<span class="num" id="5933494">0</span><span class="op" id="5933495">,</span>&nbsp;<span class="ident" id="5933497">prevDCY</span><span class="op" id="5933504">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933516">scale</span><span class="op" id="5933521">(</span><span class="op" id="5933522">&amp;</span><span class="ident" id="5933523">b</span><span class="op" id="5933524">,</span>&nbsp;<span class="op" id="5933526">&amp;</span><span class="ident" id="5933527">cb</span><span class="op" id="5933529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933535">prevDCCb</span>&nbsp;<span class="op" id="5933544">=</span>&nbsp;<span class="ident" id="5933546">e</span><span class="op" id="5933547">.</span><span class="ident" id="5933548">writeBlock</span><span class="op" id="5933558">(</span><span class="op" id="5933559">&amp;</span><span class="ident" id="5933560">b</span><span class="op" id="5933561">,</span>&nbsp;<span class="num" id="5933563">1</span><span class="op" id="5933564">,</span>&nbsp;<span class="ident" id="5933566">prevDCCb</span><span class="op" id="5933574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933580">scale</span><span class="op" id="5933585">(</span><span class="op" id="5933586">&amp;</span><span class="ident" id="5933587">b</span><span class="op" id="5933588">,</span>&nbsp;<span class="op" id="5933590">&amp;</span><span class="ident" id="5933591">cr</span><span class="op" id="5933593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933599">prevDCCr</span>&nbsp;<span class="op" id="5933608">=</span>&nbsp;<span class="ident" id="5933610">e</span><span class="op" id="5933611">.</span><span class="ident" id="5933612">writeBlock</span><span class="op" id="5933622">(</span><span class="op" id="5933623">&amp;</span><span class="ident" id="5933624">b</span><span class="op" id="5933625">,</span>&nbsp;<span class="num" id="5933627">1</span><span class="op" id="5933628">,</span>&nbsp;<span class="ident" id="5933630">prevDCCr</span><span class="op" id="5933638">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5933653">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933685">e</span><span class="op" id="5933686">.</span><span class="ident" id="5933687">emit</span><span class="op" id="5933691">(</span><span class="num" id="5933692">0x7f</span><span class="op" id="5933696">,</span>&nbsp;<span class="num" id="5933698">7</span><span class="op" id="5933699">)</span><br>
<span class="lineno">535</span><span class="op" id="5933701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5933704">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5933765">const</span>&nbsp;<span class="ident" id="5933771">DefaultQuality</span>&nbsp;<span class="op" id="5933786">=</span>&nbsp;<span class="num" id="5933788">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5933792">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="5933832">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="5933893">type</span>&nbsp;<span class="ident" id="5933898">Options</span>&nbsp;<span class="keyword" id="5933906">struct</span>&nbsp;<span class="op" id="5933913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933916">Quality</span>&nbsp;<span class="builtintype" id="5933924">int</span><br>
<span class="lineno"></span><span class="op" id="5933928">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="5933931">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5934010">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="5934079">func</span>&nbsp;<span class="ident" id="5934084">Encode</span><span class="op" id="5934090">(</span><span class="ident" id="5934091">w</span>&nbsp;<span class="ident" id="5934093">io</span><span class="op" id="5934095">.</span><span class="ident" id="5934096">Writer</span><span class="op" id="5934102">,</span>&nbsp;<span class="ident" id="5934104">m</span>&nbsp;<span class="ident" id="5934106">image</span><span class="op" id="5934111">.</span><span class="ident" id="5934112">Image</span><span class="op" id="5934117">,</span>&nbsp;<span class="ident" id="5934119">o</span>&nbsp;<span class="op" id="5934121">*</span><span class="ident" id="5934122">Options</span><span class="op" id="5934129">)</span>&nbsp;<span class="builtintype" id="5934131">error</span>&nbsp;<span class="op" id="5934137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934140">b</span>&nbsp;<span class="op" id="5934142">:=</span>&nbsp;<span class="ident" id="5934145">m</span><span class="op" id="5934146">.</span><span class="ident" id="5934147">Bounds</span><span class="op" id="5934153">(</span><span class="op" id="5934154">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934157">if</span>&nbsp;<span class="ident" id="5934160">b</span><span class="op" id="5934161">.</span><span class="ident" id="5934162">Dx</span><span class="op" id="5934164">(</span><span class="op" id="5934165">)</span>&nbsp;<span class="op" id="5934167">&gt;=</span>&nbsp;<span class="num" id="5934170">1</span><span class="op" id="5934171">&lt;&lt;</span><span class="num" id="5934173">16</span>&nbsp;<span class="op" id="5934176">||</span>&nbsp;<span class="ident" id="5934179">b</span><span class="op" id="5934180">.</span><span class="ident" id="5934181">Dy</span><span class="op" id="5934183">(</span><span class="op" id="5934184">)</span>&nbsp;<span class="op" id="5934186">&gt;=</span>&nbsp;<span class="num" id="5934189">1</span><span class="op" id="5934190">&lt;&lt;</span><span class="num" id="5934192">16</span>&nbsp;<span class="op" id="5934195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934199">return</span>&nbsp;<span class="ident" id="5934206">errors</span><span class="op" id="5934212">.</span><span class="ident" id="5934213">New</span><span class="op" id="5934216">(</span><span class="string" id="5934217">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5934253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934259">var</span>&nbsp;<span class="ident" id="5934263">e</span>&nbsp;<span class="ident" id="5934265">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934274">if</span>&nbsp;<span class="ident" id="5934277">ww</span><span class="op" id="5934279">,</span>&nbsp;<span class="ident" id="5934281">ok</span>&nbsp;<span class="op" id="5934284">:=</span>&nbsp;<span class="ident" id="5934287">w</span><span class="op" id="5934288">.</span><span class="op" id="5934289">(</span><span class="ident" id="5934290">writer</span><span class="op" id="5934296">)</span><span class="op" id="5934297">;</span>&nbsp;<span class="ident" id="5934299">ok</span>&nbsp;<span class="op" id="5934302">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934306">e</span><span class="op" id="5934307">.</span><span class="ident" id="5934308">w</span>&nbsp;<span class="op" id="5934310">=</span>&nbsp;<span class="ident" id="5934312">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934316">}</span>&nbsp;<span class="keyword" id="5934318">else</span>&nbsp;<span class="op" id="5934323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934327">e</span><span class="op" id="5934328">.</span><span class="ident" id="5934329">w</span>&nbsp;<span class="op" id="5934331">=</span>&nbsp;<span class="ident" id="5934333">bufio</span><span class="op" id="5934338">.</span><span class="ident" id="5934339">NewWriter</span><span class="op" id="5934348">(</span><span class="ident" id="5934349">w</span><span class="op" id="5934350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934356">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934386">quality</span>&nbsp;<span class="op" id="5934394">:=</span>&nbsp;<span class="ident" id="5934397">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934413">if</span>&nbsp;<span class="ident" id="5934416">o</span>&nbsp;<span class="op" id="5934418">!=</span>&nbsp;<span class="ident" id="5934421">nil</span>&nbsp;<span class="op" id="5934425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934429">quality</span>&nbsp;<span class="op" id="5934437">=</span>&nbsp;<span class="ident" id="5934439">o</span><span class="op" id="5934440">.</span><span class="ident" id="5934441">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934451">if</span>&nbsp;<span class="ident" id="5934454">quality</span>&nbsp;<span class="op" id="5934462">&lt;</span>&nbsp;<span class="num" id="5934464">1</span>&nbsp;<span class="op" id="5934466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934471">quality</span>&nbsp;<span class="op" id="5934479">=</span>&nbsp;<span class="num" id="5934481">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934485">}</span>&nbsp;<span class="keyword" id="5934487">else</span>&nbsp;<span class="keyword" id="5934492">if</span>&nbsp;<span class="ident" id="5934495">quality</span>&nbsp;<span class="op" id="5934503">&gt;</span>&nbsp;<span class="num" id="5934505">100</span>&nbsp;<span class="op" id="5934509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934514">quality</span>&nbsp;<span class="op" id="5934522">=</span>&nbsp;<span class="num" id="5934524">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934536">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934591">var</span>&nbsp;<span class="ident" id="5934595">scale</span>&nbsp;<span class="builtintype" id="5934601">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934606">if</span>&nbsp;<span class="ident" id="5934609">quality</span>&nbsp;<span class="op" id="5934617">&lt;</span>&nbsp;<span class="num" id="5934619">50</span>&nbsp;<span class="op" id="5934622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934626">scale</span>&nbsp;<span class="op" id="5934632">=</span>&nbsp;<span class="num" id="5934634">5000</span>&nbsp;<span class="op" id="5934639">/</span>&nbsp;<span class="ident" id="5934641">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934650">}</span>&nbsp;<span class="keyword" id="5934652">else</span>&nbsp;<span class="op" id="5934657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934661">scale</span>&nbsp;<span class="op" id="5934667">=</span>&nbsp;<span class="num" id="5934669">200</span>&nbsp;<span class="op" id="5934673">-</span>&nbsp;<span class="ident" id="5934675">quality</span><span class="op" id="5934682">*</span><span class="num" id="5934683">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934689">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934729">for</span>&nbsp;<span class="ident" id="5934733">i</span>&nbsp;<span class="op" id="5934735">:=</span>&nbsp;<span class="keyword" id="5934738">range</span>&nbsp;<span class="ident" id="5934744">e</span><span class="op" id="5934745">.</span><span class="ident" id="5934746">quant</span>&nbsp;<span class="op" id="5934752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934756">for</span>&nbsp;<span class="ident" id="5934760">j</span>&nbsp;<span class="op" id="5934762">:=</span>&nbsp;<span class="keyword" id="5934765">range</span>&nbsp;<span class="ident" id="5934771">e</span><span class="op" id="5934772">.</span><span class="ident" id="5934773">quant</span><span class="op" id="5934778">[</span><span class="ident" id="5934779">i</span><span class="op" id="5934780">]</span>&nbsp;<span class="op" id="5934782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934787">x</span>&nbsp;<span class="op" id="5934789">:=</span>&nbsp;<span class="builtintype" id="5934792">int</span><span class="op" id="5934795">(</span><span class="ident" id="5934796">unscaledQuant</span><span class="op" id="5934809">[</span><span class="ident" id="5934810">i</span><span class="op" id="5934811">]</span><span class="op" id="5934812">[</span><span class="ident" id="5934813">j</span><span class="op" id="5934814">]</span><span class="op" id="5934815">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934820">x</span>&nbsp;<span class="op" id="5934822">=</span>&nbsp;<span class="op" id="5934824">(</span><span class="ident" id="5934825">x</span><span class="op" id="5934826">*</span><span class="ident" id="5934827">scale</span>&nbsp;<span class="op" id="5934833">+</span>&nbsp;<span class="num" id="5934835">50</span><span class="op" id="5934837">)</span>&nbsp;<span class="op" id="5934839">/</span>&nbsp;<span class="num" id="5934841">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934848">if</span>&nbsp;<span class="ident" id="5934851">x</span>&nbsp;<span class="op" id="5934853">&lt;</span>&nbsp;<span class="num" id="5934855">1</span>&nbsp;<span class="op" id="5934857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934863">x</span>&nbsp;<span class="op" id="5934865">=</span>&nbsp;<span class="num" id="5934867">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934872">}</span>&nbsp;<span class="keyword" id="5934874">else</span>&nbsp;<span class="keyword" id="5934879">if</span>&nbsp;<span class="ident" id="5934882">x</span>&nbsp;<span class="op" id="5934884">&gt;</span>&nbsp;<span class="num" id="5934886">255</span>&nbsp;<span class="op" id="5934890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934896">x</span>&nbsp;<span class="op" id="5934898">=</span>&nbsp;<span class="num" id="5934900">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5934912">e</span><span class="op" id="5934913">.</span><span class="ident" id="5934914">quant</span><span class="op" id="5934919">[</span><span class="ident" id="5934920">i</span><span class="op" id="5934921">]</span><span class="op" id="5934922">[</span><span class="ident" id="5934923">j</span><span class="op" id="5934924">]</span>&nbsp;<span class="op" id="5934926">=</span>&nbsp;<span class="builtintype" id="5934928">uint8</span><span class="op" id="5934933">(</span><span class="ident" id="5934934">x</span><span class="op" id="5934935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5934942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5934945">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935005">nComponent</span>&nbsp;<span class="op" id="5935016">:=</span>&nbsp;<span class="num" id="5935019">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935022">switch</span>&nbsp;<span class="ident" id="5935029">m</span><span class="op" id="5935030">.</span><span class="op" id="5935031">(</span><span class="keyword" id="5935032">type</span><span class="op" id="5935036">)</span>&nbsp;<span class="op" id="5935038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935041">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935103">case</span>&nbsp;<span class="op" id="5935108">*</span><span class="ident" id="5935109">image</span><span class="op" id="5935114">.</span><span class="ident" id="5935115">Gray</span><span class="op" id="5935119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935123">nComponent</span>&nbsp;<span class="op" id="5935134">=</span>&nbsp;<span class="num" id="5935136">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5935139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935142">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935179">e</span><span class="op" id="5935180">.</span><span class="ident" id="5935181">buf</span><span class="op" id="5935184">[</span><span class="num" id="5935185">0</span><span class="op" id="5935186">]</span>&nbsp;<span class="op" id="5935188">=</span>&nbsp;<span class="num" id="5935190">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935196">e</span><span class="op" id="5935197">.</span><span class="ident" id="5935198">buf</span><span class="op" id="5935201">[</span><span class="num" id="5935202">1</span><span class="op" id="5935203">]</span>&nbsp;<span class="op" id="5935205">=</span>&nbsp;<span class="num" id="5935207">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935213">e</span><span class="op" id="5935214">.</span><span class="ident" id="5935215">write</span><span class="op" id="5935220">(</span><span class="ident" id="5935221">e</span><span class="op" id="5935222">.</span><span class="ident" id="5935223">buf</span><span class="op" id="5935226">[</span><span class="op" id="5935227">:</span><span class="num" id="5935228">2</span><span class="op" id="5935229">]</span><span class="op" id="5935230">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935233">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935268">e</span><span class="op" id="5935269">.</span><span class="ident" id="5935270">writeDQT</span><span class="op" id="5935278">(</span><span class="op" id="5935279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935282">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935314">e</span><span class="op" id="5935315">.</span><span class="ident" id="5935316">writeSOF0</span><span class="op" id="5935325">(</span><span class="ident" id="5935326">b</span><span class="op" id="5935327">.</span><span class="ident" id="5935328">Size</span><span class="op" id="5935332">(</span><span class="op" id="5935333">)</span><span class="op" id="5935334">,</span>&nbsp;<span class="ident" id="5935336">nComponent</span><span class="op" id="5935346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935349">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935379">e</span><span class="op" id="5935380">.</span><span class="ident" id="5935381">writeDHT</span><span class="op" id="5935389">(</span><span class="ident" id="5935390">nComponent</span><span class="op" id="5935400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935403">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935429">e</span><span class="op" id="5935430">.</span><span class="ident" id="5935431">writeSOS</span><span class="op" id="5935439">(</span><span class="ident" id="5935440">m</span><span class="op" id="5935441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935444">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935479">e</span><span class="op" id="5935480">.</span><span class="ident" id="5935481">buf</span><span class="op" id="5935484">[</span><span class="num" id="5935485">0</span><span class="op" id="5935486">]</span>&nbsp;<span class="op" id="5935488">=</span>&nbsp;<span class="num" id="5935490">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935496">e</span><span class="op" id="5935497">.</span><span class="ident" id="5935498">buf</span><span class="op" id="5935501">[</span><span class="num" id="5935502">1</span><span class="op" id="5935503">]</span>&nbsp;<span class="op" id="5935505">=</span>&nbsp;<span class="num" id="5935507">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935513">e</span><span class="op" id="5935514">.</span><span class="ident" id="5935515">write</span><span class="op" id="5935520">(</span><span class="ident" id="5935521">e</span><span class="op" id="5935522">.</span><span class="ident" id="5935523">buf</span><span class="op" id="5935526">[</span><span class="op" id="5935527">:</span><span class="num" id="5935528">2</span><span class="op" id="5935529">]</span><span class="op" id="5935530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935533">e</span><span class="op" id="5935534">.</span><span class="ident" id="5935535">flush</span><span class="op" id="5935540">(</span><span class="op" id="5935541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935544">return</span>&nbsp;<span class="ident" id="5935551">e</span><span class="op" id="5935552">.</span><span class="ident" id="5935553">err</span><br>
<span class="lineno"></span><span class="op" id="5935557">}</span>
</div>
</body>
</html>
