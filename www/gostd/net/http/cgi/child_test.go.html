<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html" class="current">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8399496">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8399551">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8399605">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8399656">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8399706">package</span>&nbsp;<span class="ident" id="8399714">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8399719">import</span>&nbsp;<span class="op" id="8399726">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399729">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8399739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8399742">func</span>&nbsp;<span class="ident" id="8399747">TestRequest</span><span class="op" id="8399758">(</span><span class="ident" id="8399759">t</span>&nbsp;<span class="op" id="8399761">*</span><span class="ident" id="8399762">testing</span><span class="op" id="8399769">.</span><span class="ident" id="8399770">T</span><span class="op" id="8399771">)</span>&nbsp;<span class="op" id="8399773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8399776">env</span>&nbsp;<span class="op" id="8399780">:=</span>&nbsp;<span class="keyword" id="8399783">map</span><span class="op" id="8399786">[</span><span class="builtintype" id="8399787">string</span><span class="op" id="8399793">]</span><span class="builtintype" id="8399794">string</span><span class="op" id="8399800">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399804">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8399821">:</span>&nbsp;<span class="string" id="8399823">&#34;HTTP/1.1&#34;</span><span class="op" id="8399833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399837">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8399853">:</span>&nbsp;&nbsp;<span class="string" id="8399856">&#34;GET&#34;</span><span class="op" id="8399861">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399865">&#34;HTTP_HOST&#34;</span><span class="op" id="8399876">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399884">&#34;example.com&#34;</span><span class="op" id="8399897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399901">&#34;HTTP_REFERER&#34;</span><span class="op" id="8399915">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399920">&#34;elsewhere&#34;</span><span class="op" id="8399931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399935">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="8399952">:</span>&nbsp;<span class="string" id="8399954">&#34;goclient&#34;</span><span class="op" id="8399964">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399968">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="8399982">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399987">&#34;baz&#34;</span><span class="op" id="8399992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399996">&#34;REQUEST_URI&#34;</span><span class="op" id="8400009">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400015">&#34;/path?a=b&#34;</span><span class="op" id="8400026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400030">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="8400046">:</span>&nbsp;&nbsp;<span class="string" id="8400049">&#34;123&#34;</span><span class="op" id="8400054">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400058">&#34;CONTENT_TYPE&#34;</span><span class="op" id="8400072">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400077">&#34;text/xml&#34;</span><span class="op" id="8400087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400091">&#34;REMOTE_ADDR&#34;</span><span class="op" id="8400104">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400110">&#34;5.6.7.8&#34;</span><span class="op" id="8400119">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8400122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8400125">req</span><span class="op" id="8400128">,</span>&nbsp;<span class="ident" id="8400130">err</span>&nbsp;<span class="op" id="8400134">:=</span>&nbsp;<span class="ident" id="8400137">RequestFromMap</span><span class="op" id="8400151">(</span><span class="ident" id="8400152">env</span><span class="op" id="8400155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8400158">if</span>&nbsp;<span class="ident" id="8400161">err</span>&nbsp;<span class="op" id="8400165">!=</span>&nbsp;<span class="ident" id="8400168">nil</span>&nbsp;<span class="op" id="8400172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8400176">t</span><span class="op" id="8400177">.</span><span class="ident" id="8400178">Fatalf</span><span class="op" id="8400184">(</span><span class="string" id="8400185">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8400205">,</span>&nbsp;<span class="ident" id="8400207">err</span><span class="op" id="8400210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8400213">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8400216">if</span>&nbsp;<span class="ident" id="8400219">g</span><span class="op" id="8400220">,</span>&nbsp;<span class="ident" id="8400222">e</span>&nbsp;<span class="op" id="8400224">:=</span>&nbsp;<span class="ident" id="8400227">req</span><span class="op" id="8400230">.</span><span class="ident" id="8400231">UserAgent</span><span class="op" id="8400240">(</span><span class="op" id="8400241">)</span><span class="op" id="8400242">,</span>&nbsp;<span class="string" id="8400244">&#34;goclient&#34;</span><span class="op" id="8400254">;</span>&nbsp;<span class="ident" id="8400256">e</span>&nbsp;<span class="op" id="8400258">!=</span>&nbsp;<span class="ident" id="8400261">g</span>&nbsp;<span class="op" id="8400263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8400267">t</span><span class="op" id="8400268">.</span><span class="ident" id="8400269">Errorf</span><span class="op" id="8400275">(</span><span class="string" id="8400276">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8400307">,</span>&nbsp;<span class="ident" id="8400309">e</span><span class="op" id="8400310">,</span>&nbsp;<span class="ident" id="8400312">g</span><span class="op" id="8400313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8400316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8400319">if</span>&nbsp;<span class="ident" id="8400322">g</span><span class="op" id="8400323">,</span>&nbsp;<span class="ident" id="8400325">e</span>&nbsp;<span class="op" id="8400327">:=</span>&nbsp;<span class="ident" id="8400330">req</span><span class="op" id="8400333">.</span><span class="ident" id="8400334">Method</span><span class="op" id="8400340">,</span>&nbsp;<span class="string" id="8400342">&#34;GET&#34;</span><span class="op" id="8400347">;</span>&nbsp;<span class="ident" id="8400349">e</span>&nbsp;<span class="op" id="8400351">!=</span>&nbsp;<span class="ident" id="8400354">g</span>&nbsp;<span class="op" id="8400356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8400360">t</span><span class="op" id="8400361">.</span><span class="ident" id="8400362">Errorf</span><span class="op" id="8400368">(</span><span class="string" id="8400369">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8400397">,</span>&nbsp;<span class="ident" id="8400399">e</span><span class="op" id="8400400">,</span>&nbsp;<span class="ident" id="8400402">g</span><span class="op" id="8400403">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8400406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8400409">if</span>&nbsp;<span class="ident" id="8400412">g</span><span class="op" id="8400413">,</span>&nbsp;<span class="ident" id="8400415">e</span>&nbsp;<span class="op" id="8400417">:=</span>&nbsp;<span class="ident" id="8400420">req</span><span class="op" id="8400423">.</span><span class="ident" id="8400424">Header</span><span class="op" id="8400430">.</span><span class="ident" id="8400431">Get</span><span class="op" id="8400434">(</span><span class="string" id="8400435">&#34;Content-Type&#34;</span><span class="op" id="8400449">)</span><span class="op" id="8400450">,</span>&nbsp;<span class="string" id="8400452">&#34;text/xml&#34;</span><span class="op" id="8400462">;</span>&nbsp;<span class="ident" id="8400464">e</span>&nbsp;<span class="op" id="8400466">!=</span>&nbsp;<span class="ident" id="8400469">g</span>&nbsp;<span class="op" id="8400471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8400475">t</span><span class="op" id="8400476">.</span><span class="ident" id="8400477">Errorf</span><span class="op" id="8400483">(</span><span class="string" id="8400484">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8400518">,</span>&nbsp;<span class="ident" id="8400520">e</span><span class="op" id="8400521">,</span>&nbsp;<span class="ident" id="8400523">g</span><span class="op" id="8400524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8400527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8400530">if</span>&nbsp;<span class="ident" id="8400533">g</span><span class="op" id="8400534">,</span>&nbsp;<span class="ident" id="8400536">e</span>&nbsp;<span class="op" id="8400538">:=</span>&nbsp;<span class="ident" id="8400541">req</span><span class="op" id="8400544">.</span><span class="ident" id="8400545">ContentLength</span><span class="op" id="8400558">,</span>&nbsp;<span class="ident" id="8400560">int64</span><span class="op" id="8400565">(</span><span class="num" id="8400566">123</span><span class="op" id="8400569">)</span><span class="op" id="8400570">;</span>&nbsp;<span class="ident" id="8400572">e</span>&nbsp;<span class="op" id="8400574">!=</span>&nbsp;<span class="ident" id="8400577">g</span>&nbsp;<span class="op" id="8400579">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8400583">t</span><span class="op" id="8400584">.</span><span class="ident" id="8400585">Errorf</span><span class="op" id="8400591">(</span><span class="string" id="8400592">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8400627">,</span>&nbsp;<span class="ident" id="8400629">e</span><span class="op" id="8400630">,</span>&nbsp;<span class="ident" id="8400632">g</span><span class="op" id="8400633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8400636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8400639">if</span>&nbsp;<span class="ident" id="8400642">g</span><span class="op" id="8400643">,</span>&nbsp;<span class="ident" id="8400645">e</span>&nbsp;<span class="op" id="8400647">:=</span>&nbsp;<span class="ident" id="8400650">req</span><span class="op" id="8400653">.</span><span class="ident" id="8400654">Referer</span><span class="op" id="8400661">(</span><span class="op" id="8400662">)</span><span class="op" id="8400663">,</span>&nbsp;<span class="string" id="8400665">&#34;elsewhere&#34;</span><span class="op" id="8400676">;</span>&nbsp;<span class="ident" id="8400678">e</span>&nbsp;<span class="op" id="8400680">!=</span>&nbsp;<span class="ident" id="8400683">g</span>&nbsp;<span class="op" id="8400685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8400689">t</span><span class="op" id="8400690">.</span><span class="ident" id="8400691">Errorf</span><span class="op" id="8400697">(</span><span class="string" id="8400698">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8400727">,</span>&nbsp;<span class="ident" id="8400729">e</span><span class="op" id="8400730">,</span>&nbsp;<span class="ident" id="8400732">g</span><span class="op" id="8400733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8400736">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8400739">if</span>&nbsp;<span class="ident" id="8400742">req</span><span class="op" id="8400745">.</span><span class="ident" id="8400746">Header</span>&nbsp;<span class="op" id="8400753">==</span>&nbsp;<span class="ident" id="8400756">nil</span>&nbsp;<span class="op" id="8400760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8400764">t</span><span class="op" id="8400765">.</span><span class="ident" id="8400766">Fatalf</span><span class="op" id="8400772">(</span><span class="string" id="8400773">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="8400796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8400799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8400802">if</span>&nbsp;<span class="ident" id="8400805">g</span><span class="op" id="8400806">,</span>&nbsp;<span class="ident" id="8400808">e</span>&nbsp;<span class="op" id="8400810">:=</span>&nbsp;<span class="ident" id="8400813">req</span><span class="op" id="8400816">.</span><span class="ident" id="8400817">Header</span><span class="op" id="8400823">.</span><span class="ident" id="8400824">Get</span><span class="op" id="8400827">(</span><span class="string" id="8400828">&#34;Foo-Bar&#34;</span><span class="op" id="8400837">)</span><span class="op" id="8400838">,</span>&nbsp;<span class="string" id="8400840">&#34;baz&#34;</span><span class="op" id="8400845">;</span>&nbsp;<span class="ident" id="8400847">e</span>&nbsp;<span class="op" id="8400849">!=</span>&nbsp;<span class="ident" id="8400852">g</span>&nbsp;<span class="op" id="8400854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8400858">t</span><span class="op" id="8400859">.</span><span class="ident" id="8400860">Errorf</span><span class="op" id="8400866">(</span><span class="string" id="8400867">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8400896">,</span>&nbsp;<span class="ident" id="8400898">e</span><span class="op" id="8400899">,</span>&nbsp;<span class="ident" id="8400901">g</span><span class="op" id="8400902">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8400905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8400908">if</span>&nbsp;<span class="ident" id="8400911">g</span><span class="op" id="8400912">,</span>&nbsp;<span class="ident" id="8400914">e</span>&nbsp;<span class="op" id="8400916">:=</span>&nbsp;<span class="ident" id="8400919">req</span><span class="op" id="8400922">.</span><span class="ident" id="8400923">URL</span><span class="op" id="8400926">.</span><span class="ident" id="8400927">String</span><span class="op" id="8400933">(</span><span class="op" id="8400934">)</span><span class="op" id="8400935">,</span>&nbsp;<span class="string" id="8400937">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="8400966">;</span>&nbsp;<span class="ident" id="8400968">e</span>&nbsp;<span class="op" id="8400970">!=</span>&nbsp;<span class="ident" id="8400973">g</span>&nbsp;<span class="op" id="8400975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8400979">t</span><span class="op" id="8400980">.</span><span class="ident" id="8400981">Errorf</span><span class="op" id="8400987">(</span><span class="string" id="8400988">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8401013">,</span>&nbsp;<span class="ident" id="8401015">e</span><span class="op" id="8401016">,</span>&nbsp;<span class="ident" id="8401018">g</span><span class="op" id="8401019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8401022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8401025">if</span>&nbsp;<span class="ident" id="8401028">g</span><span class="op" id="8401029">,</span>&nbsp;<span class="ident" id="8401031">e</span>&nbsp;<span class="op" id="8401033">:=</span>&nbsp;<span class="ident" id="8401036">req</span><span class="op" id="8401039">.</span><span class="ident" id="8401040">FormValue</span><span class="op" id="8401049">(</span><span class="string" id="8401050">&#34;a&#34;</span><span class="op" id="8401053">)</span><span class="op" id="8401054">,</span>&nbsp;<span class="string" id="8401056">&#34;b&#34;</span><span class="op" id="8401059">;</span>&nbsp;<span class="ident" id="8401061">e</span>&nbsp;<span class="op" id="8401063">!=</span>&nbsp;<span class="ident" id="8401066">g</span>&nbsp;<span class="op" id="8401068">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8401072">t</span><span class="op" id="8401073">.</span><span class="ident" id="8401074">Errorf</span><span class="op" id="8401080">(</span><span class="string" id="8401081">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8401115">,</span>&nbsp;<span class="ident" id="8401117">e</span><span class="op" id="8401118">,</span>&nbsp;<span class="ident" id="8401120">g</span><span class="op" id="8401121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8401124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8401127">if</span>&nbsp;<span class="ident" id="8401130">req</span><span class="op" id="8401133">.</span><span class="ident" id="8401134">Trailer</span>&nbsp;<span class="op" id="8401142">==</span>&nbsp;<span class="ident" id="8401145">nil</span>&nbsp;<span class="op" id="8401149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8401153">t</span><span class="op" id="8401154">.</span><span class="ident" id="8401155">Errorf</span><span class="op" id="8401161">(</span><span class="string" id="8401162">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="8401186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8401189">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8401192">if</span>&nbsp;<span class="ident" id="8401195">req</span><span class="op" id="8401198">.</span><span class="ident" id="8401199">TLS</span>&nbsp;<span class="op" id="8401203">!=</span>&nbsp;<span class="ident" id="8401206">nil</span>&nbsp;<span class="op" id="8401210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8401214">t</span><span class="op" id="8401215">.</span><span class="ident" id="8401216">Errorf</span><span class="op" id="8401222">(</span><span class="string" id="8401223">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="8401241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8401244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8401247">if</span>&nbsp;<span class="ident" id="8401250">e</span><span class="op" id="8401251">,</span>&nbsp;<span class="ident" id="8401253">g</span>&nbsp;<span class="op" id="8401255">:=</span>&nbsp;<span class="string" id="8401258">&#34;5.6.7.8:0&#34;</span><span class="op" id="8401269">,</span>&nbsp;<span class="ident" id="8401271">req</span><span class="op" id="8401274">.</span><span class="ident" id="8401275">RemoteAddr</span><span class="op" id="8401285">;</span>&nbsp;<span class="ident" id="8401287">e</span>&nbsp;<span class="op" id="8401289">!=</span>&nbsp;<span class="ident" id="8401292">g</span>&nbsp;<span class="op" id="8401294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8401298">t</span><span class="op" id="8401299">.</span><span class="ident" id="8401300">Errorf</span><span class="op" id="8401306">(</span><span class="string" id="8401307">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8401336">,</span>&nbsp;<span class="ident" id="8401338">g</span><span class="op" id="8401339">,</span>&nbsp;<span class="ident" id="8401341">e</span><span class="op" id="8401342">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8401345">}</span><br>
<span class="lineno"></span><span class="op" id="8401347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8401350">func</span>&nbsp;<span class="ident" id="8401355">TestRequestWithTLS</span><span class="op" id="8401373">(</span><span class="ident" id="8401374">t</span>&nbsp;<span class="op" id="8401376">*</span><span class="ident" id="8401377">testing</span><span class="op" id="8401384">.</span><span class="ident" id="8401385">T</span><span class="op" id="8401386">)</span>&nbsp;<span class="op" id="8401388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8401391">env</span>&nbsp;<span class="op" id="8401395">:=</span>&nbsp;<span class="keyword" id="8401398">map</span><span class="op" id="8401401">[</span><span class="builtintype" id="8401402">string</span><span class="op" id="8401408">]</span><span class="builtintype" id="8401409">string</span><span class="op" id="8401415">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401419">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8401436">:</span>&nbsp;<span class="string" id="8401438">&#34;HTTP/1.1&#34;</span><span class="op" id="8401448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401452">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8401468">:</span>&nbsp;&nbsp;<span class="string" id="8401471">&#34;GET&#34;</span><span class="op" id="8401476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401480">&#34;HTTP_HOST&#34;</span><span class="op" id="8401491">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401499">&#34;example.com&#34;</span><span class="op" id="8401512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401516">&#34;HTTP_REFERER&#34;</span><span class="op" id="8401530">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401535">&#34;elsewhere&#34;</span><span class="op" id="8401546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401550">&#34;REQUEST_URI&#34;</span><span class="op" id="8401563">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401569">&#34;/path?a=b&#34;</span><span class="op" id="8401580">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401584">&#34;CONTENT_TYPE&#34;</span><span class="op" id="8401598">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401603">&#34;text/xml&#34;</span><span class="op" id="8401613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401617">&#34;HTTPS&#34;</span><span class="op" id="8401624">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401636">&#34;1&#34;</span><span class="op" id="8401639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401643">&#34;REMOTE_ADDR&#34;</span><span class="op" id="8401656">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401662">&#34;5.6.7.8&#34;</span><span class="op" id="8401671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8401674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8401677">req</span><span class="op" id="8401680">,</span>&nbsp;<span class="ident" id="8401682">err</span>&nbsp;<span class="op" id="8401686">:=</span>&nbsp;<span class="ident" id="8401689">RequestFromMap</span><span class="op" id="8401703">(</span><span class="ident" id="8401704">env</span><span class="op" id="8401707">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8401710">if</span>&nbsp;<span class="ident" id="8401713">err</span>&nbsp;<span class="op" id="8401717">!=</span>&nbsp;<span class="ident" id="8401720">nil</span>&nbsp;<span class="op" id="8401724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8401728">t</span><span class="op" id="8401729">.</span><span class="ident" id="8401730">Fatalf</span><span class="op" id="8401736">(</span><span class="string" id="8401737">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8401757">,</span>&nbsp;<span class="ident" id="8401759">err</span><span class="op" id="8401762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8401765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8401768">if</span>&nbsp;<span class="ident" id="8401771">g</span><span class="op" id="8401772">,</span>&nbsp;<span class="ident" id="8401774">e</span>&nbsp;<span class="op" id="8401776">:=</span>&nbsp;<span class="ident" id="8401779">req</span><span class="op" id="8401782">.</span><span class="ident" id="8401783">URL</span><span class="op" id="8401786">.</span><span class="ident" id="8401787">String</span><span class="op" id="8401793">(</span><span class="op" id="8401794">)</span><span class="op" id="8401795">,</span>&nbsp;<span class="string" id="8401797">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="8401827">;</span>&nbsp;<span class="ident" id="8401829">e</span>&nbsp;<span class="op" id="8401831">!=</span>&nbsp;<span class="ident" id="8401834">g</span>&nbsp;<span class="op" id="8401836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8401840">t</span><span class="op" id="8401841">.</span><span class="ident" id="8401842">Errorf</span><span class="op" id="8401848">(</span><span class="string" id="8401849">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8401874">,</span>&nbsp;<span class="ident" id="8401876">e</span><span class="op" id="8401877">,</span>&nbsp;<span class="ident" id="8401879">g</span><span class="op" id="8401880">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8401883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8401886">if</span>&nbsp;<span class="ident" id="8401889">req</span><span class="op" id="8401892">.</span><span class="ident" id="8401893">TLS</span>&nbsp;<span class="op" id="8401897">==</span>&nbsp;<span class="ident" id="8401900">nil</span>&nbsp;<span class="op" id="8401904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8401908">t</span><span class="op" id="8401909">.</span><span class="ident" id="8401910">Errorf</span><span class="op" id="8401916">(</span><span class="string" id="8401917">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="8401939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8401942">}</span><br>
<span class="lineno"></span><span class="op" id="8401944">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="8401947">func</span>&nbsp;<span class="ident" id="8401952">TestRequestWithoutHost</span><span class="op" id="8401974">(</span><span class="ident" id="8401975">t</span>&nbsp;<span class="op" id="8401977">*</span><span class="ident" id="8401978">testing</span><span class="op" id="8401985">.</span><span class="ident" id="8401986">T</span><span class="op" id="8401987">)</span>&nbsp;<span class="op" id="8401989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8401992">env</span>&nbsp;<span class="op" id="8401996">:=</span>&nbsp;<span class="keyword" id="8401999">map</span><span class="op" id="8402002">[</span><span class="builtintype" id="8402003">string</span><span class="op" id="8402009">]</span><span class="builtintype" id="8402010">string</span><span class="op" id="8402016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402020">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8402037">:</span>&nbsp;<span class="string" id="8402039">&#34;HTTP/1.1&#34;</span><span class="op" id="8402049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402053">&#34;HTTP_HOST&#34;</span><span class="op" id="8402064">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402072">&#34;&#34;</span><span class="op" id="8402074">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402078">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8402094">:</span>&nbsp;&nbsp;<span class="string" id="8402097">&#34;GET&#34;</span><span class="op" id="8402102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402106">&#34;REQUEST_URI&#34;</span><span class="op" id="8402119">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402125">&#34;/path?a=b&#34;</span><span class="op" id="8402136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402140">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="8402156">:</span>&nbsp;&nbsp;<span class="string" id="8402159">&#34;123&#34;</span><span class="op" id="8402164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8402167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8402170">req</span><span class="op" id="8402173">,</span>&nbsp;<span class="ident" id="8402175">err</span>&nbsp;<span class="op" id="8402179">:=</span>&nbsp;<span class="ident" id="8402182">RequestFromMap</span><span class="op" id="8402196">(</span><span class="ident" id="8402197">env</span><span class="op" id="8402200">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8402203">if</span>&nbsp;<span class="ident" id="8402206">err</span>&nbsp;<span class="op" id="8402210">!=</span>&nbsp;<span class="ident" id="8402213">nil</span>&nbsp;<span class="op" id="8402217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8402221">t</span><span class="op" id="8402222">.</span><span class="ident" id="8402223">Fatalf</span><span class="op" id="8402229">(</span><span class="string" id="8402230">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8402250">,</span>&nbsp;<span class="ident" id="8402252">err</span><span class="op" id="8402255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8402258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8402261">if</span>&nbsp;<span class="ident" id="8402264">req</span><span class="op" id="8402267">.</span><span class="ident" id="8402268">URL</span>&nbsp;<span class="op" id="8402272">==</span>&nbsp;<span class="ident" id="8402275">nil</span>&nbsp;<span class="op" id="8402279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8402283">t</span><span class="op" id="8402284">.</span><span class="ident" id="8402285">Fatalf</span><span class="op" id="8402291">(</span><span class="string" id="8402292">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="8402312">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8402315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8402318">if</span>&nbsp;<span class="ident" id="8402321">g</span><span class="op" id="8402322">,</span>&nbsp;<span class="ident" id="8402324">e</span>&nbsp;<span class="op" id="8402326">:=</span>&nbsp;<span class="ident" id="8402329">req</span><span class="op" id="8402332">.</span><span class="ident" id="8402333">URL</span><span class="op" id="8402336">.</span><span class="ident" id="8402337">String</span><span class="op" id="8402343">(</span><span class="op" id="8402344">)</span><span class="op" id="8402345">,</span>&nbsp;<span class="string" id="8402347">&#34;/path?a=b&#34;</span><span class="op" id="8402358">;</span>&nbsp;<span class="ident" id="8402360">e</span>&nbsp;<span class="op" id="8402362">!=</span>&nbsp;<span class="ident" id="8402365">g</span>&nbsp;<span class="op" id="8402367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8402371">t</span><span class="op" id="8402372">.</span><span class="ident" id="8402373">Errorf</span><span class="op" id="8402379">(</span><span class="string" id="8402380">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8402399">,</span>&nbsp;<span class="ident" id="8402401">g</span><span class="op" id="8402402">,</span>&nbsp;<span class="ident" id="8402404">e</span><span class="op" id="8402405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8402408">}</span><br>
<span class="lineno"></span><span class="op" id="8402410">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="8402413">func</span>&nbsp;<span class="ident" id="8402418">TestRequestWithoutRequestURI</span><span class="op" id="8402446">(</span><span class="ident" id="8402447">t</span>&nbsp;<span class="op" id="8402449">*</span><span class="ident" id="8402450">testing</span><span class="op" id="8402457">.</span><span class="ident" id="8402458">T</span><span class="op" id="8402459">)</span>&nbsp;<span class="op" id="8402461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8402464">env</span>&nbsp;<span class="op" id="8402468">:=</span>&nbsp;<span class="keyword" id="8402471">map</span><span class="op" id="8402474">[</span><span class="builtintype" id="8402475">string</span><span class="op" id="8402481">]</span><span class="builtintype" id="8402482">string</span><span class="op" id="8402488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402492">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8402509">:</span>&nbsp;<span class="string" id="8402511">&#34;HTTP/1.1&#34;</span><span class="op" id="8402521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402525">&#34;HTTP_HOST&#34;</span><span class="op" id="8402536">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402544">&#34;example.com&#34;</span><span class="op" id="8402557">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402561">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8402577">:</span>&nbsp;&nbsp;<span class="string" id="8402580">&#34;GET&#34;</span><span class="op" id="8402585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402589">&#34;SCRIPT_NAME&#34;</span><span class="op" id="8402602">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402608">&#34;/dir/scriptname&#34;</span><span class="op" id="8402625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402629">&#34;PATH_INFO&#34;</span><span class="op" id="8402640">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402648">&#34;/p1/p2&#34;</span><span class="op" id="8402656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402660">&#34;QUERY_STRING&#34;</span><span class="op" id="8402674">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402679">&#34;a=1&amp;b=2&#34;</span><span class="op" id="8402688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402692">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="8402708">:</span>&nbsp;&nbsp;<span class="string" id="8402711">&#34;123&#34;</span><span class="op" id="8402716">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8402719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8402722">req</span><span class="op" id="8402725">,</span>&nbsp;<span class="ident" id="8402727">err</span>&nbsp;<span class="op" id="8402731">:=</span>&nbsp;<span class="ident" id="8402734">RequestFromMap</span><span class="op" id="8402748">(</span><span class="ident" id="8402749">env</span><span class="op" id="8402752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8402755">if</span>&nbsp;<span class="ident" id="8402758">err</span>&nbsp;<span class="op" id="8402762">!=</span>&nbsp;<span class="ident" id="8402765">nil</span>&nbsp;<span class="op" id="8402769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8402773">t</span><span class="op" id="8402774">.</span><span class="ident" id="8402775">Fatalf</span><span class="op" id="8402781">(</span><span class="string" id="8402782">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8402802">,</span>&nbsp;<span class="ident" id="8402804">err</span><span class="op" id="8402807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8402810">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8402813">if</span>&nbsp;<span class="ident" id="8402816">req</span><span class="op" id="8402819">.</span><span class="ident" id="8402820">URL</span>&nbsp;<span class="op" id="8402824">==</span>&nbsp;<span class="ident" id="8402827">nil</span>&nbsp;<span class="op" id="8402831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8402835">t</span><span class="op" id="8402836">.</span><span class="ident" id="8402837">Fatalf</span><span class="op" id="8402843">(</span><span class="string" id="8402844">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="8402864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8402867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8402870">if</span>&nbsp;<span class="ident" id="8402873">g</span><span class="op" id="8402874">,</span>&nbsp;<span class="ident" id="8402876">e</span>&nbsp;<span class="op" id="8402878">:=</span>&nbsp;<span class="ident" id="8402881">req</span><span class="op" id="8402884">.</span><span class="ident" id="8402885">URL</span><span class="op" id="8402888">.</span><span class="ident" id="8402889">String</span><span class="op" id="8402895">(</span><span class="op" id="8402896">)</span><span class="op" id="8402897">,</span>&nbsp;<span class="string" id="8402899">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="8402948">;</span>&nbsp;<span class="ident" id="8402950">e</span>&nbsp;<span class="op" id="8402952">!=</span>&nbsp;<span class="ident" id="8402955">g</span>&nbsp;<span class="op" id="8402957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8402961">t</span><span class="op" id="8402962">.</span><span class="ident" id="8402963">Errorf</span><span class="op" id="8402969">(</span><span class="string" id="8402970">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8402989">,</span>&nbsp;<span class="ident" id="8402991">g</span><span class="op" id="8402992">,</span>&nbsp;<span class="ident" id="8402994">e</span><span class="op" id="8402995">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8402998">}</span><br>
<span class="lineno"></span><span class="op" id="8403000">}</span>
</div>
</body>
</html>
