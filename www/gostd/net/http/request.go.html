<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html" class="current">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3514893">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3514948">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3515002">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3515053">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3515091">package</span>&nbsp;<span class="ident" id="3515099">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3515105">import</span>&nbsp;<span class="op" id="3515112">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515115">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515124">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515133">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515147">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515166">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515176">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515183">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515189">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515202">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515210">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515228">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515245">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515256">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515267">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3515278">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="3515285">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3515288">const</span>&nbsp;<span class="op" id="3515294">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515297">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3515314">=</span>&nbsp;<span class="num" id="3515316">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515322">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3515339">=</span>&nbsp;<span class="num" id="3515341">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515347">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3515364">=</span>&nbsp;<span class="num" id="3515366">4</span>&nbsp;<span class="op" id="3515368">&lt;&lt;</span>&nbsp;<span class="num" id="3515371">10</span>&nbsp;&nbsp;<span class="comment" id="3515375">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515391">defaultMaxMemory</span>&nbsp;<span class="op" id="3515408">=</span>&nbsp;<span class="num" id="3515410">32</span>&nbsp;<span class="op" id="3515413">&lt;&lt;</span>&nbsp;<span class="num" id="3515416">20</span>&nbsp;<span class="comment" id="3515419">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="3515428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3515431">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="3515507">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="3515568">var</span>&nbsp;<span class="ident" id="3515572">ErrMissingFile</span>&nbsp;<span class="op" id="3515587">=</span>&nbsp;<span class="ident" id="3515589">errors</span><span class="op" id="3515595">.</span><span class="ident" id="3515596">New</span><span class="op" id="3515599">(</span><span class="string" id="3515600">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="3515620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3515623">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="3515655">type</span>&nbsp;<span class="ident" id="3515660">ProtocolError</span>&nbsp;<span class="keyword" id="3515674">struct</span>&nbsp;<span class="op" id="3515681">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515684">ErrorString</span>&nbsp;<span class="builtintype" id="3515696">string</span><br>
<span class="lineno"></span><span class="op" id="3515703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3515706">func</span>&nbsp;<span class="op" id="3515711">(</span><span class="ident" id="3515712">err</span>&nbsp;<span class="op" id="3515716">*</span><span class="ident" id="3515717">ProtocolError</span><span class="op" id="3515730">)</span>&nbsp;<span class="ident" id="3515732">Error</span><span class="op" id="3515737">(</span><span class="op" id="3515738">)</span>&nbsp;<span class="builtintype" id="3515740">string</span>&nbsp;<span class="op" id="3515747">{</span>&nbsp;<span class="keyword" id="3515749">return</span>&nbsp;<span class="ident" id="3515756">err</span><span class="op" id="3515759">.</span><span class="ident" id="3515760">ErrorString</span>&nbsp;<span class="op" id="3515772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="3515775">var</span>&nbsp;<span class="op" id="3515779">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515782">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3515806">=</span>&nbsp;<span class="op" id="3515808">&amp;</span><span class="ident" id="3515809">ProtocolError</span><span class="op" id="3515822">{</span><span class="string" id="3515823">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="3515840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515843">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3515867">=</span>&nbsp;<span class="op" id="3515869">&amp;</span><span class="ident" id="3515870">ProtocolError</span><span class="op" id="3515883">{</span><span class="string" id="3515884">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="3515907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515910">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3515934">=</span>&nbsp;<span class="op" id="3515936">&amp;</span><span class="ident" id="3515937">ProtocolError</span><span class="op" id="3515950">{</span><span class="string" id="3515951">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3515974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3515977">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3516001">=</span>&nbsp;<span class="op" id="3516003">&amp;</span><span class="ident" id="3516004">ProtocolError</span><span class="op" id="3516017">{</span><span class="string" id="3516018">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="3516068">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516071">ErrMissingContentLength</span>&nbsp;<span class="op" id="3516095">=</span>&nbsp;<span class="op" id="3516097">&amp;</span><span class="ident" id="3516098">ProtocolError</span><span class="op" id="3516111">{</span><span class="string" id="3516112">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="3516152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516155">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3516179">=</span>&nbsp;<span class="op" id="3516181">&amp;</span><span class="ident" id="3516182">ProtocolError</span><span class="op" id="3516195">{</span><span class="string" id="3516196">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="3516244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516247">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3516271">=</span>&nbsp;<span class="op" id="3516273">&amp;</span><span class="ident" id="3516274">ProtocolError</span><span class="op" id="3516287">{</span><span class="string" id="3516288">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="3516333">}</span><br>
<span class="lineno"></span><span class="op" id="3516335">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3516338">type</span>&nbsp;<span class="ident" id="3516343">badStringError</span>&nbsp;<span class="keyword" id="3516358">struct</span>&nbsp;<span class="op" id="3516365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516368">what</span>&nbsp;<span class="builtintype" id="3516373">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3516381">str</span>&nbsp;&nbsp;<span class="builtintype" id="3516386">string</span><br>
<span class="lineno"></span><span class="op" id="3516393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3516396">func</span>&nbsp;<span class="op" id="3516401">(</span><span class="ident" id="3516402">e</span>&nbsp;<span class="op" id="3516404">*</span><span class="ident" id="3516405">badStringError</span><span class="op" id="3516419">)</span>&nbsp;<span class="ident" id="3516421">Error</span><span class="op" id="3516426">(</span><span class="op" id="3516427">)</span>&nbsp;<span class="builtintype" id="3516429">string</span>&nbsp;<span class="op" id="3516436">{</span>&nbsp;<span class="keyword" id="3516438">return</span>&nbsp;<span class="ident" id="3516445">fmt</span><span class="op" id="3516448">.</span><span class="ident" id="3516449">Sprintf</span><span class="op" id="3516456">(</span><span class="string" id="3516457">&#34;%s&nbsp;%q&#34;</span><span class="op" id="3516464">,</span>&nbsp;<span class="ident" id="3516466">e</span><span class="op" id="3516467">.</span><span class="ident" id="3516468">what</span><span class="op" id="3516472">,</span>&nbsp;<span class="ident" id="3516474">e</span><span class="op" id="3516475">.</span><span class="ident" id="3516476">str</span><span class="op" id="3516479">)</span>&nbsp;<span class="op" id="3516481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3516484">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3516552">var</span>&nbsp;<span class="ident" id="3516556">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="3516578">=</span>&nbsp;<span class="keyword" id="3516580">map</span><span class="op" id="3516583">[</span><span class="builtintype" id="3516584">string</span><span class="op" id="3516590">]</span><span class="builtintype" id="3516591">bool</span><span class="op" id="3516595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3516598">&#34;Host&#34;</span><span class="op" id="3516604">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3516619">true</span><span class="op" id="3516623">,</span>&nbsp;<span class="comment" id="3516625">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3516654">&#34;User-Agent&#34;</span><span class="op" id="3516666">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3516675">true</span><span class="op" id="3516679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3516682">&#34;Content-Length&#34;</span><span class="op" id="3516698">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3516703">true</span><span class="op" id="3516707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3516710">&#34;Transfer-Encoding&#34;</span><span class="op" id="3516729">:</span>&nbsp;<span class="builtintype" id="3516731">true</span><span class="op" id="3516735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3516738">&#34;Trailer&#34;</span><span class="op" id="3516747">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3516759">true</span><span class="op" id="3516763">,</span><br>
<span class="lineno"></span><span class="op" id="3516765">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3516768">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="3516829">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3516859">//</span><br>
<span class="lineno"></span><span class="comment" id="3516862">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="3516927">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3516991">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="3517044">type</span>&nbsp;<span class="ident" id="3517049">Request</span>&nbsp;<span class="keyword" id="3517057">struct</span>&nbsp;<span class="op" id="3517064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517067">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517128">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517179">Method</span>&nbsp;<span class="builtintype" id="3517186">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517195">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517256">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517314">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517318">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517373">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517436">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517499">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517540">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517544">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517608">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517666">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517722">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517735">URL</span>&nbsp;<span class="op" id="3517739">*</span><span class="ident" id="3517740">url</span><span class="op" id="3517743">.</span><span class="ident" id="3517744">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517750">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517798">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517839">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3517850">string</span>&nbsp;<span class="comment" id="3517857">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517872">ProtoMajor</span>&nbsp;<span class="builtintype" id="3517883">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517890">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3517896">ProtoMinor</span>&nbsp;<span class="builtintype" id="3517907">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517914">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517921">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517970">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517993">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3517997">//&nbsp;&nbsp;&nbsp;&nbsp;accept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518032">//&nbsp;&nbsp;&nbsp;&nbsp;Accept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518059">//&nbsp;&nbsp;&nbsp;&nbsp;Connection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518086">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518090">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518099">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518103">//&nbsp;&nbsp;&nbsp;&nbsp;Header&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518137">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518180">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518215">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518250">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518256">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518260">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518317">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518378">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518434">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518491">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518495">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518553">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518598">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518602">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3518658">Header</span>&nbsp;<span class="ident" id="3518665">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518674">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518706">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518710">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518770">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518831">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518880">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518884">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3518943">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519004">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519062">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3519092">Body</span>&nbsp;<span class="ident" id="3519097">io</span><span class="op" id="3519099">.</span><span class="ident" id="3519100">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519113">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519177">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519232">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519292">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519315">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3519387">ContentLength</span>&nbsp;<span class="builtintype" id="3519401">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519409">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519477">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519539">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519604">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519670">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3519694">TransferEncoding</span>&nbsp;<span class="op" id="3519711">[</span><span class="op" id="3519712">]</span><span class="builtintype" id="3519713">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519722">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519780">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519840">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3519871">Close</span>&nbsp;<span class="builtintype" id="3519877">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519884">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3519945">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520006">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520070">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520109">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520113">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520172">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520232">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3520259">Host</span>&nbsp;<span class="builtintype" id="3520264">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520273">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520336">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520396">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520456">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3520512">Form</span>&nbsp;<span class="ident" id="3520517">url</span><span class="op" id="3520520">.</span><span class="ident" id="3520521">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520530">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520590">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520611">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520671">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3520731">PostForm</span>&nbsp;<span class="ident" id="3520740">url</span><span class="op" id="3520743">.</span><span class="ident" id="3520744">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520753">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520825">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520894">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3520959">MultipartForm</span>&nbsp;<span class="op" id="3520973">*</span><span class="ident" id="3520974">multipart</span><span class="op" id="3520983">.</span><span class="ident" id="3520984">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3520991">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521064">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521074">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521078">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521146">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521220">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521291">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521363">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521436">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521455">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521459">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521531">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521604">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521678">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521749">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521822">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521846">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521850">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3521915">Trailer</span>&nbsp;<span class="ident" id="3521923">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521932">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3521996">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522055">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522115">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522174">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522236">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522249">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3522295">RemoteAddr</span>&nbsp;<span class="builtintype" id="3522306">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522315">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522367">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522430">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522493">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3522557">RequestURI</span>&nbsp;<span class="builtintype" id="3522568">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522577">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522634">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522696">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522758">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522813">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522868">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3522907">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3522953">TLS</span>&nbsp;<span class="op" id="3522957">*</span><span class="ident" id="3522958">tls</span><span class="op" id="3522961">.</span><span class="ident" id="3522962">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3522978">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3522981">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3523036">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3523079">func</span>&nbsp;<span class="op" id="3523084">(</span><span class="ident" id="3523085">r</span>&nbsp;<span class="op" id="3523087">*</span><span class="ident" id="3523088">Request</span><span class="op" id="3523095">)</span>&nbsp;<span class="ident" id="3523097">ProtoAtLeast</span><span class="op" id="3523109">(</span><span class="ident" id="3523110">major</span><span class="op" id="3523115">,</span>&nbsp;<span class="ident" id="3523117">minor</span>&nbsp;<span class="builtintype" id="3523123">int</span><span class="op" id="3523126">)</span>&nbsp;<span class="builtintype" id="3523128">bool</span>&nbsp;<span class="op" id="3523133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523136">return</span>&nbsp;<span class="ident" id="3523143">r</span><span class="op" id="3523144">.</span><span class="ident" id="3523145">ProtoMajor</span>&nbsp;<span class="op" id="3523156">&gt;</span>&nbsp;<span class="ident" id="3523158">major</span>&nbsp;<span class="op" id="3523164">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3523169">r</span><span class="op" id="3523170">.</span><span class="ident" id="3523171">ProtoMajor</span>&nbsp;<span class="op" id="3523182">==</span>&nbsp;<span class="ident" id="3523185">major</span>&nbsp;<span class="op" id="3523191">&amp;&amp;</span>&nbsp;<span class="ident" id="3523194">r</span><span class="op" id="3523195">.</span><span class="ident" id="3523196">ProtoMinor</span>&nbsp;<span class="op" id="3523207">&gt;=</span>&nbsp;<span class="ident" id="3523210">minor</span><br>
<span class="lineno"></span><span class="op" id="3523216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3523219">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3523289">func</span>&nbsp;<span class="op" id="3523294">(</span><span class="ident" id="3523295">r</span>&nbsp;<span class="op" id="3523297">*</span><span class="ident" id="3523298">Request</span><span class="op" id="3523305">)</span>&nbsp;<span class="ident" id="3523307">UserAgent</span><span class="op" id="3523316">(</span><span class="op" id="3523317">)</span>&nbsp;<span class="builtintype" id="3523319">string</span>&nbsp;<span class="op" id="3523326">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523329">return</span>&nbsp;<span class="ident" id="3523336">r</span><span class="op" id="3523337">.</span><span class="ident" id="3523338">Header</span><span class="op" id="3523344">.</span><span class="ident" id="3523345">Get</span><span class="op" id="3523348">(</span><span class="string" id="3523349">&#34;User-Agent&#34;</span><span class="op" id="3523361">)</span><br>
<span class="lineno"></span><span class="op" id="3523363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3523366">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3523436">func</span>&nbsp;<span class="op" id="3523441">(</span><span class="ident" id="3523442">r</span>&nbsp;<span class="op" id="3523444">*</span><span class="ident" id="3523445">Request</span><span class="op" id="3523452">)</span>&nbsp;<span class="ident" id="3523454">Cookies</span><span class="op" id="3523461">(</span><span class="op" id="3523462">)</span>&nbsp;<span class="op" id="3523464">[</span><span class="op" id="3523465">]</span><span class="op" id="3523466">*</span><span class="ident" id="3523467">Cookie</span>&nbsp;<span class="op" id="3523474">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523477">return</span>&nbsp;<span class="ident" id="3523484">readCookies</span><span class="op" id="3523495">(</span><span class="ident" id="3523496">r</span><span class="op" id="3523497">.</span><span class="ident" id="3523498">Header</span><span class="op" id="3523504">,</span>&nbsp;<span class="string" id="3523506">&#34;&#34;</span><span class="op" id="3523508">)</span><br>
<span class="lineno"></span><span class="op" id="3523510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3523513">var</span>&nbsp;<span class="ident" id="3523517">ErrNoCookie</span>&nbsp;<span class="op" id="3523529">=</span>&nbsp;<span class="ident" id="3523531">errors</span><span class="op" id="3523537">.</span><span class="ident" id="3523538">New</span><span class="op" id="3523541">(</span><span class="string" id="3523542">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="3523574">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3523577">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3523639">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3523668">func</span>&nbsp;<span class="op" id="3523673">(</span><span class="ident" id="3523674">r</span>&nbsp;<span class="op" id="3523676">*</span><span class="ident" id="3523677">Request</span><span class="op" id="3523684">)</span>&nbsp;<span class="ident" id="3523686">Cookie</span><span class="op" id="3523692">(</span><span class="ident" id="3523693">name</span>&nbsp;<span class="builtintype" id="3523698">string</span><span class="op" id="3523704">)</span>&nbsp;<span class="op" id="3523706">(</span><span class="op" id="3523707">*</span><span class="ident" id="3523708">Cookie</span><span class="op" id="3523714">,</span>&nbsp;<span class="builtintype" id="3523716">error</span><span class="op" id="3523721">)</span>&nbsp;<span class="op" id="3523723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523726">for</span>&nbsp;<span class="ident" id="3523730">_</span><span class="op" id="3523731">,</span>&nbsp;<span class="ident" id="3523733">c</span>&nbsp;<span class="op" id="3523735">:=</span>&nbsp;<span class="keyword" id="3523738">range</span>&nbsp;<span class="ident" id="3523744">readCookies</span><span class="op" id="3523755">(</span><span class="ident" id="3523756">r</span><span class="op" id="3523757">.</span><span class="ident" id="3523758">Header</span><span class="op" id="3523764">,</span>&nbsp;<span class="ident" id="3523766">name</span><span class="op" id="3523770">)</span>&nbsp;<span class="op" id="3523772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523776">return</span>&nbsp;<span class="ident" id="3523783">c</span><span class="op" id="3523784">,</span>&nbsp;<span class="builtintype" id="3523786">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3523791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523794">return</span>&nbsp;<span class="builtintype" id="3523801">nil</span><span class="op" id="3523804">,</span>&nbsp;<span class="ident" id="3523806">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="3523818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3523821">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="3523891">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="3523961">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="3524023">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="3524050">func</span>&nbsp;<span class="op" id="3524055">(</span><span class="ident" id="3524056">r</span>&nbsp;<span class="op" id="3524058">*</span><span class="ident" id="3524059">Request</span><span class="op" id="3524066">)</span>&nbsp;<span class="ident" id="3524068">AddCookie</span><span class="op" id="3524077">(</span><span class="ident" id="3524078">c</span>&nbsp;<span class="op" id="3524080">*</span><span class="ident" id="3524081">Cookie</span><span class="op" id="3524087">)</span>&nbsp;<span class="op" id="3524089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3524092">s</span>&nbsp;<span class="op" id="3524094">:=</span>&nbsp;<span class="ident" id="3524097">fmt</span><span class="op" id="3524100">.</span><span class="ident" id="3524101">Sprintf</span><span class="op" id="3524108">(</span><span class="string" id="3524109">&#34;%s=%s&#34;</span><span class="op" id="3524116">,</span>&nbsp;<span class="ident" id="3524118">sanitizeCookieName</span><span class="op" id="3524136">(</span><span class="ident" id="3524137">c</span><span class="op" id="3524138">.</span><span class="ident" id="3524139">Name</span><span class="op" id="3524143">)</span><span class="op" id="3524144">,</span>&nbsp;<span class="ident" id="3524146">sanitizeCookieValue</span><span class="op" id="3524165">(</span><span class="ident" id="3524166">c</span><span class="op" id="3524167">.</span><span class="ident" id="3524168">Value</span><span class="op" id="3524173">)</span><span class="op" id="3524174">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3524177">if</span>&nbsp;<span class="ident" id="3524180">c</span>&nbsp;<span class="op" id="3524182">:=</span>&nbsp;<span class="ident" id="3524185">r</span><span class="op" id="3524186">.</span><span class="ident" id="3524187">Header</span><span class="op" id="3524193">.</span><span class="ident" id="3524194">Get</span><span class="op" id="3524197">(</span><span class="string" id="3524198">&#34;Cookie&#34;</span><span class="op" id="3524206">)</span><span class="op" id="3524207">;</span>&nbsp;<span class="ident" id="3524209">c</span>&nbsp;<span class="op" id="3524211">!=</span>&nbsp;<span class="string" id="3524214">&#34;&#34;</span>&nbsp;<span class="op" id="3524217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3524221">r</span><span class="op" id="3524222">.</span><span class="ident" id="3524223">Header</span><span class="op" id="3524229">.</span><span class="ident" id="3524230">Set</span><span class="op" id="3524233">(</span><span class="string" id="3524234">&#34;Cookie&#34;</span><span class="op" id="3524242">,</span>&nbsp;<span class="ident" id="3524244">c</span><span class="op" id="3524245">+</span><span class="string" id="3524246">&#34;;&nbsp;&#34;</span><span class="op" id="3524250">+</span><span class="ident" id="3524251">s</span><span class="op" id="3524252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3524255">}</span>&nbsp;<span class="keyword" id="3524257">else</span>&nbsp;<span class="op" id="3524262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3524266">r</span><span class="op" id="3524267">.</span><span class="ident" id="3524268">Header</span><span class="op" id="3524274">.</span><span class="ident" id="3524275">Set</span><span class="op" id="3524278">(</span><span class="string" id="3524279">&#34;Cookie&#34;</span><span class="op" id="3524287">,</span>&nbsp;<span class="ident" id="3524289">s</span><span class="op" id="3524290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3524293">}</span><br>
<span class="lineno">270</span><span class="op" id="3524295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3524298">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3524360">//</span><br>
<span class="lineno"></span><span class="comment" id="3524363">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="3524433">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3524500">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="3524571">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3524642">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="3524708">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="3524758">func</span>&nbsp;<span class="op" id="3524763">(</span><span class="ident" id="3524764">r</span>&nbsp;<span class="op" id="3524766">*</span><span class="ident" id="3524767">Request</span><span class="op" id="3524774">)</span>&nbsp;<span class="ident" id="3524776">Referer</span><span class="op" id="3524783">(</span><span class="op" id="3524784">)</span>&nbsp;<span class="builtintype" id="3524786">string</span>&nbsp;<span class="op" id="3524793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3524796">return</span>&nbsp;<span class="ident" id="3524803">r</span><span class="op" id="3524804">.</span><span class="ident" id="3524805">Header</span><span class="op" id="3524811">.</span><span class="ident" id="3524812">Get</span><span class="op" id="3524815">(</span><span class="string" id="3524816">&#34;Referer&#34;</span><span class="op" id="3524825">)</span><br>
<span class="lineno"></span><span class="op" id="3524827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3524830">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="3524872">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="3524951">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="3525031">var</span>&nbsp;<span class="ident" id="3525035">multipartByReader</span>&nbsp;<span class="op" id="3525053">=</span>&nbsp;<span class="op" id="3525055">&amp;</span><span class="ident" id="3525056">multipart</span><span class="op" id="3525065">.</span><span class="ident" id="3525066">Form</span><span class="op" id="3525070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525073">Value</span><span class="op" id="3525078">:</span>&nbsp;<span class="builtinfunc" id="3525080">make</span><span class="op" id="3525084">(</span><span class="keyword" id="3525085">map</span><span class="op" id="3525088">[</span><span class="builtintype" id="3525089">string</span><span class="op" id="3525095">]</span><span class="op" id="3525096">[</span><span class="op" id="3525097">]</span><span class="builtintype" id="3525098">string</span><span class="op" id="3525104">)</span><span class="op" id="3525105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525108">File</span><span class="op" id="3525112">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3525115">make</span><span class="op" id="3525119">(</span><span class="keyword" id="3525120">map</span><span class="op" id="3525123">[</span><span class="builtintype" id="3525124">string</span><span class="op" id="3525130">]</span><span class="op" id="3525131">[</span><span class="op" id="3525132">]</span><span class="op" id="3525133">*</span><span class="ident" id="3525134">multipart</span><span class="op" id="3525143">.</span><span class="ident" id="3525144">FileHeader</span><span class="op" id="3525154">)</span><span class="op" id="3525155">,</span><br>
<span class="lineno">290</span><span class="op" id="3525157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3525160">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3525224">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3525292">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="3525346">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="3525387">func</span>&nbsp;<span class="op" id="3525392">(</span><span class="ident" id="3525393">r</span>&nbsp;<span class="op" id="3525395">*</span><span class="ident" id="3525396">Request</span><span class="op" id="3525403">)</span>&nbsp;<span class="ident" id="3525405">MultipartReader</span><span class="op" id="3525420">(</span><span class="op" id="3525421">)</span>&nbsp;<span class="op" id="3525423">(</span><span class="op" id="3525424">*</span><span class="ident" id="3525425">multipart</span><span class="op" id="3525434">.</span><span class="ident" id="3525435">Reader</span><span class="op" id="3525441">,</span>&nbsp;<span class="builtintype" id="3525443">error</span><span class="op" id="3525448">)</span>&nbsp;<span class="op" id="3525450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525453">if</span>&nbsp;<span class="ident" id="3525456">r</span><span class="op" id="3525457">.</span><span class="ident" id="3525458">MultipartForm</span>&nbsp;<span class="op" id="3525472">==</span>&nbsp;<span class="ident" id="3525475">multipartByReader</span>&nbsp;<span class="op" id="3525493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525497">return</span>&nbsp;<span class="builtintype" id="3525504">nil</span><span class="op" id="3525507">,</span>&nbsp;<span class="ident" id="3525509">errors</span><span class="op" id="3525515">.</span><span class="ident" id="3525516">New</span><span class="op" id="3525519">(</span><span class="string" id="3525520">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="3525556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525559">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525562">if</span>&nbsp;<span class="ident" id="3525565">r</span><span class="op" id="3525566">.</span><span class="ident" id="3525567">MultipartForm</span>&nbsp;<span class="op" id="3525581">!=</span>&nbsp;<span class="builtintype" id="3525584">nil</span>&nbsp;<span class="op" id="3525588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525592">return</span>&nbsp;<span class="builtintype" id="3525599">nil</span><span class="op" id="3525602">,</span>&nbsp;<span class="ident" id="3525604">errors</span><span class="op" id="3525610">.</span><span class="ident" id="3525611">New</span><span class="op" id="3525614">(</span><span class="string" id="3525615">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="3525662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525668">r</span><span class="op" id="3525669">.</span><span class="ident" id="3525670">MultipartForm</span>&nbsp;<span class="op" id="3525684">=</span>&nbsp;<span class="ident" id="3525686">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525705">return</span>&nbsp;<span class="ident" id="3525712">r</span><span class="op" id="3525713">.</span><span class="ident" id="3525714">multipartReader</span><span class="op" id="3525729">(</span><span class="op" id="3525730">)</span><br>
<span class="lineno">305</span><span class="op" id="3525732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3525735">func</span>&nbsp;<span class="op" id="3525740">(</span><span class="ident" id="3525741">r</span>&nbsp;<span class="op" id="3525743">*</span><span class="ident" id="3525744">Request</span><span class="op" id="3525751">)</span>&nbsp;<span class="ident" id="3525753">multipartReader</span><span class="op" id="3525768">(</span><span class="op" id="3525769">)</span>&nbsp;<span class="op" id="3525771">(</span><span class="op" id="3525772">*</span><span class="ident" id="3525773">multipart</span><span class="op" id="3525782">.</span><span class="ident" id="3525783">Reader</span><span class="op" id="3525789">,</span>&nbsp;<span class="builtintype" id="3525791">error</span><span class="op" id="3525796">)</span>&nbsp;<span class="op" id="3525798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525801">v</span>&nbsp;<span class="op" id="3525803">:=</span>&nbsp;<span class="ident" id="3525806">r</span><span class="op" id="3525807">.</span><span class="ident" id="3525808">Header</span><span class="op" id="3525814">.</span><span class="ident" id="3525815">Get</span><span class="op" id="3525818">(</span><span class="string" id="3525819">&#34;Content-Type&#34;</span><span class="op" id="3525833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525836">if</span>&nbsp;<span class="ident" id="3525839">v</span>&nbsp;<span class="op" id="3525841">==</span>&nbsp;<span class="string" id="3525844">&#34;&#34;</span>&nbsp;<span class="op" id="3525847">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525851">return</span>&nbsp;<span class="builtintype" id="3525858">nil</span><span class="op" id="3525861">,</span>&nbsp;<span class="ident" id="3525863">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3525880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3525883">d</span><span class="op" id="3525884">,</span>&nbsp;<span class="ident" id="3525886">params</span><span class="op" id="3525892">,</span>&nbsp;<span class="ident" id="3525894">err</span>&nbsp;<span class="op" id="3525898">:=</span>&nbsp;<span class="ident" id="3525901">mime</span><span class="op" id="3525905">.</span><span class="ident" id="3525906">ParseMediaType</span><span class="op" id="3525920">(</span><span class="ident" id="3525921">v</span><span class="op" id="3525922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525925">if</span>&nbsp;<span class="ident" id="3525928">err</span>&nbsp;<span class="op" id="3525932">!=</span>&nbsp;<span class="builtintype" id="3525935">nil</span>&nbsp;<span class="op" id="3525939">||</span>&nbsp;<span class="ident" id="3525942">d</span>&nbsp;<span class="op" id="3525944">!=</span>&nbsp;<span class="string" id="3525947">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="3525969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3525973">return</span>&nbsp;<span class="builtintype" id="3525980">nil</span><span class="op" id="3525983">,</span>&nbsp;<span class="ident" id="3525985">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3526002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3526005">boundary</span><span class="op" id="3526013">,</span>&nbsp;<span class="ident" id="3526015">ok</span>&nbsp;<span class="op" id="3526018">:=</span>&nbsp;<span class="ident" id="3526021">params</span><span class="op" id="3526027">[</span><span class="string" id="3526028">&#34;boundary&#34;</span><span class="op" id="3526038">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526041">if</span>&nbsp;<span class="op" id="3526044">!</span><span class="ident" id="3526045">ok</span>&nbsp;<span class="op" id="3526048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526052">return</span>&nbsp;<span class="builtintype" id="3526059">nil</span><span class="op" id="3526062">,</span>&nbsp;<span class="ident" id="3526064">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3526084">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526087">return</span>&nbsp;<span class="ident" id="3526094">multipart</span><span class="op" id="3526103">.</span><span class="ident" id="3526104">NewReader</span><span class="op" id="3526113">(</span><span class="ident" id="3526114">r</span><span class="op" id="3526115">.</span><span class="ident" id="3526116">Body</span><span class="op" id="3526120">,</span>&nbsp;<span class="ident" id="3526122">boundary</span><span class="op" id="3526130">)</span><span class="op" id="3526131">,</span>&nbsp;<span class="builtintype" id="3526133">nil</span><br>
<span class="lineno"></span><span class="op" id="3526137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3526140">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3526184">func</span>&nbsp;<span class="ident" id="3526189">valueOrDefault</span><span class="op" id="3526203">(</span><span class="ident" id="3526204">value</span><span class="op" id="3526209">,</span>&nbsp;<span class="ident" id="3526211">def</span>&nbsp;<span class="builtintype" id="3526215">string</span><span class="op" id="3526221">)</span>&nbsp;<span class="builtintype" id="3526223">string</span>&nbsp;<span class="op" id="3526230">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526233">if</span>&nbsp;<span class="ident" id="3526236">value</span>&nbsp;<span class="op" id="3526242">!=</span>&nbsp;<span class="string" id="3526245">&#34;&#34;</span>&nbsp;<span class="op" id="3526248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526252">return</span>&nbsp;<span class="ident" id="3526259">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3526266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3526269">return</span>&nbsp;<span class="ident" id="3526276">def</span><br>
<span class="lineno"></span><span class="op" id="3526280">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3526283">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="3526358">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3526431">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="3526504">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="3526560">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="3526607">const</span>&nbsp;<span class="ident" id="3526613">defaultUserAgent</span>&nbsp;<span class="op" id="3526630">=</span>&nbsp;<span class="string" id="3526632">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3526655">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="3526729">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="3526790">//&nbsp;&nbsp;&nbsp;&nbsp;Host</span><br>
<span class="lineno"></span><span class="comment" id="3526798">//&nbsp;&nbsp;&nbsp;&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3526805">//&nbsp;&nbsp;&nbsp;&nbsp;Method&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3526835">//&nbsp;&nbsp;&nbsp;&nbsp;Header</span><br>
<span class="lineno"></span><span class="comment" id="3526845">//&nbsp;&nbsp;&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="3526862">//&nbsp;&nbsp;&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3526882">//&nbsp;&nbsp;&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="3526890">//</span><br>
<span class="lineno"></span><span class="comment" id="3526893">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3526960">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="3527025">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3527085">func</span>&nbsp;<span class="op" id="3527090">(</span><span class="ident" id="3527091">r</span>&nbsp;<span class="op" id="3527093">*</span><span class="ident" id="3527094">Request</span><span class="op" id="3527101">)</span>&nbsp;<span class="ident" id="3527103">Write</span><span class="op" id="3527108">(</span><span class="ident" id="3527109">w</span>&nbsp;<span class="ident" id="3527111">io</span><span class="op" id="3527113">.</span><span class="ident" id="3527114">Writer</span><span class="op" id="3527120">)</span>&nbsp;<span class="builtintype" id="3527122">error</span>&nbsp;<span class="op" id="3527128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3527131">return</span>&nbsp;<span class="ident" id="3527138">r</span><span class="op" id="3527139">.</span><span class="ident" id="3527140">write</span><span class="op" id="3527145">(</span><span class="ident" id="3527146">w</span><span class="op" id="3527147">,</span>&nbsp;<span class="builtintype" id="3527149">false</span><span class="op" id="3527154">,</span>&nbsp;<span class="builtintype" id="3527156">nil</span><span class="op" id="3527159">)</span><br>
<span class="lineno"></span><span class="op" id="3527161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="3527164">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3527227">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3527295">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="3527364">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="3527425">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="3527488">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="3527520">func</span>&nbsp;<span class="op" id="3527525">(</span><span class="ident" id="3527526">r</span>&nbsp;<span class="op" id="3527528">*</span><span class="ident" id="3527529">Request</span><span class="op" id="3527536">)</span>&nbsp;<span class="ident" id="3527538">WriteProxy</span><span class="op" id="3527548">(</span><span class="ident" id="3527549">w</span>&nbsp;<span class="ident" id="3527551">io</span><span class="op" id="3527553">.</span><span class="ident" id="3527554">Writer</span><span class="op" id="3527560">)</span>&nbsp;<span class="builtintype" id="3527562">error</span>&nbsp;<span class="op" id="3527568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3527571">return</span>&nbsp;<span class="ident" id="3527578">r</span><span class="op" id="3527579">.</span><span class="ident" id="3527580">write</span><span class="op" id="3527585">(</span><span class="ident" id="3527586">w</span><span class="op" id="3527587">,</span>&nbsp;<span class="builtintype" id="3527589">true</span><span class="op" id="3527593">,</span>&nbsp;<span class="builtintype" id="3527595">nil</span><span class="op" id="3527598">)</span><br>
<span class="lineno"></span><span class="op" id="3527600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3527603">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="3527630">func</span>&nbsp;<span class="op" id="3527635">(</span><span class="ident" id="3527636">req</span>&nbsp;<span class="op" id="3527640">*</span><span class="ident" id="3527641">Request</span><span class="op" id="3527648">)</span>&nbsp;<span class="ident" id="3527650">write</span><span class="op" id="3527655">(</span><span class="ident" id="3527656">w</span>&nbsp;<span class="ident" id="3527658">io</span><span class="op" id="3527660">.</span><span class="ident" id="3527661">Writer</span><span class="op" id="3527667">,</span>&nbsp;<span class="ident" id="3527669">usingProxy</span>&nbsp;<span class="builtintype" id="3527680">bool</span><span class="op" id="3527684">,</span>&nbsp;<span class="ident" id="3527686">extraHeaders</span>&nbsp;<span class="ident" id="3527699">Header</span><span class="op" id="3527705">)</span>&nbsp;<span class="builtintype" id="3527707">error</span>&nbsp;<span class="op" id="3527713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3527716">host</span>&nbsp;<span class="op" id="3527721">:=</span>&nbsp;<span class="ident" id="3527724">req</span><span class="op" id="3527727">.</span><span class="ident" id="3527728">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3527734">if</span>&nbsp;<span class="ident" id="3527737">host</span>&nbsp;<span class="op" id="3527742">==</span>&nbsp;<span class="string" id="3527745">&#34;&#34;</span>&nbsp;<span class="op" id="3527748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3527752">if</span>&nbsp;<span class="ident" id="3527755">req</span><span class="op" id="3527758">.</span><span class="ident" id="3527759">URL</span>&nbsp;<span class="op" id="3527763">==</span>&nbsp;<span class="builtintype" id="3527766">nil</span>&nbsp;<span class="op" id="3527770">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3527775">return</span>&nbsp;<span class="ident" id="3527782">errors</span><span class="op" id="3527788">.</span><span class="ident" id="3527789">New</span><span class="op" id="3527792">(</span><span class="string" id="3527793">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="3527849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3527853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3527857">host</span>&nbsp;<span class="op" id="3527862">=</span>&nbsp;<span class="ident" id="3527864">req</span><span class="op" id="3527867">.</span><span class="ident" id="3527868">URL</span><span class="op" id="3527871">.</span><span class="ident" id="3527872">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3527878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3527882">ruri</span>&nbsp;<span class="op" id="3527887">:=</span>&nbsp;<span class="ident" id="3527890">req</span><span class="op" id="3527893">.</span><span class="ident" id="3527894">URL</span><span class="op" id="3527897">.</span><span class="ident" id="3527898">RequestURI</span><span class="op" id="3527908">(</span><span class="op" id="3527909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3527912">if</span>&nbsp;<span class="ident" id="3527915">usingProxy</span>&nbsp;<span class="op" id="3527926">&amp;&amp;</span>&nbsp;<span class="ident" id="3527929">req</span><span class="op" id="3527932">.</span><span class="ident" id="3527933">URL</span><span class="op" id="3527936">.</span><span class="ident" id="3527937">Scheme</span>&nbsp;<span class="op" id="3527944">!=</span>&nbsp;<span class="string" id="3527947">&#34;&#34;</span>&nbsp;<span class="op" id="3527950">&amp;&amp;</span>&nbsp;<span class="ident" id="3527953">req</span><span class="op" id="3527956">.</span><span class="ident" id="3527957">URL</span><span class="op" id="3527960">.</span><span class="ident" id="3527961">Opaque</span>&nbsp;<span class="op" id="3527968">==</span>&nbsp;<span class="string" id="3527971">&#34;&#34;</span>&nbsp;<span class="op" id="3527974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3527978">ruri</span>&nbsp;<span class="op" id="3527983">=</span>&nbsp;<span class="ident" id="3527985">req</span><span class="op" id="3527988">.</span><span class="ident" id="3527989">URL</span><span class="op" id="3527992">.</span><span class="ident" id="3527993">Scheme</span>&nbsp;<span class="op" id="3528000">+</span>&nbsp;<span class="string" id="3528002">&#34;://&#34;</span>&nbsp;<span class="op" id="3528008">+</span>&nbsp;<span class="ident" id="3528010">host</span>&nbsp;<span class="op" id="3528015">+</span>&nbsp;<span class="ident" id="3528017">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3528023">}</span>&nbsp;<span class="keyword" id="3528025">else</span>&nbsp;<span class="keyword" id="3528030">if</span>&nbsp;<span class="ident" id="3528033">req</span><span class="op" id="3528036">.</span><span class="ident" id="3528037">Method</span>&nbsp;<span class="op" id="3528044">==</span>&nbsp;<span class="string" id="3528047">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3528057">&amp;&amp;</span>&nbsp;<span class="ident" id="3528060">req</span><span class="op" id="3528063">.</span><span class="ident" id="3528064">URL</span><span class="op" id="3528067">.</span><span class="ident" id="3528068">Path</span>&nbsp;<span class="op" id="3528073">==</span>&nbsp;<span class="string" id="3528076">&#34;&#34;</span>&nbsp;<span class="op" id="3528079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3528083">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3528159">ruri</span>&nbsp;<span class="op" id="3528164">=</span>&nbsp;<span class="ident" id="3528166">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3528172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3528175">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3528230">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3528298">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3528361">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3528423">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3528433">var</span>&nbsp;<span class="ident" id="3528437">bw</span>&nbsp;<span class="op" id="3528440">*</span><span class="ident" id="3528441">bufio</span><span class="op" id="3528446">.</span><span class="ident" id="3528447">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3528455">if</span>&nbsp;<span class="ident" id="3528458">_</span><span class="op" id="3528459">,</span>&nbsp;<span class="ident" id="3528461">ok</span>&nbsp;<span class="op" id="3528464">:=</span>&nbsp;<span class="ident" id="3528467">w</span><span class="op" id="3528468">.</span><span class="op" id="3528469">(</span><span class="ident" id="3528470">io</span><span class="op" id="3528472">.</span><span class="ident" id="3528473">ByteWriter</span><span class="op" id="3528483">)</span><span class="op" id="3528484">;</span>&nbsp;<span class="op" id="3528486">!</span><span class="ident" id="3528487">ok</span>&nbsp;<span class="op" id="3528490">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3528494">bw</span>&nbsp;<span class="op" id="3528497">=</span>&nbsp;<span class="ident" id="3528499">bufio</span><span class="op" id="3528504">.</span><span class="ident" id="3528505">NewWriter</span><span class="op" id="3528514">(</span><span class="ident" id="3528515">w</span><span class="op" id="3528516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3528520">w</span>&nbsp;<span class="op" id="3528522">=</span>&nbsp;<span class="ident" id="3528524">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3528528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3528532">_</span><span class="op" id="3528533">,</span>&nbsp;<span class="ident" id="3528535">err</span>&nbsp;<span class="op" id="3528539">:=</span>&nbsp;<span class="ident" id="3528542">fmt</span><span class="op" id="3528545">.</span><span class="ident" id="3528546">Fprintf</span><span class="op" id="3528553">(</span><span class="ident" id="3528554">w</span><span class="op" id="3528555">,</span>&nbsp;<span class="string" id="3528557">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="3528577">,</span>&nbsp;<span class="ident" id="3528579">valueOrDefault</span><span class="op" id="3528593">(</span><span class="ident" id="3528594">req</span><span class="op" id="3528597">.</span><span class="ident" id="3528598">Method</span><span class="op" id="3528604">,</span>&nbsp;<span class="string" id="3528606">&#34;GET&#34;</span><span class="op" id="3528611">)</span><span class="op" id="3528612">,</span>&nbsp;<span class="ident" id="3528614">ruri</span><span class="op" id="3528618">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3528621">if</span>&nbsp;<span class="ident" id="3528624">err</span>&nbsp;<span class="op" id="3528628">!=</span>&nbsp;<span class="builtintype" id="3528631">nil</span>&nbsp;<span class="op" id="3528635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3528639">return</span>&nbsp;<span class="ident" id="3528646">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3528651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3528655">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3528672">_</span><span class="op" id="3528673">,</span>&nbsp;<span class="ident" id="3528675">err</span>&nbsp;<span class="op" id="3528679">=</span>&nbsp;<span class="ident" id="3528681">fmt</span><span class="op" id="3528684">.</span><span class="ident" id="3528685">Fprintf</span><span class="op" id="3528692">(</span><span class="ident" id="3528693">w</span><span class="op" id="3528694">,</span>&nbsp;<span class="string" id="3528696">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="3528710">,</span>&nbsp;<span class="ident" id="3528712">host</span><span class="op" id="3528716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3528719">if</span>&nbsp;<span class="ident" id="3528722">err</span>&nbsp;<span class="op" id="3528726">!=</span>&nbsp;<span class="builtintype" id="3528729">nil</span>&nbsp;<span class="op" id="3528733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3528737">return</span>&nbsp;<span class="ident" id="3528744">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3528749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3528753">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3528820">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3528861">userAgent</span>&nbsp;<span class="op" id="3528871">:=</span>&nbsp;<span class="ident" id="3528874">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3528892">if</span>&nbsp;<span class="ident" id="3528895">req</span><span class="op" id="3528898">.</span><span class="ident" id="3528899">Header</span>&nbsp;<span class="op" id="3528906">!=</span>&nbsp;<span class="builtintype" id="3528909">nil</span>&nbsp;<span class="op" id="3528913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3528917">if</span>&nbsp;<span class="ident" id="3528920">ua</span>&nbsp;<span class="op" id="3528923">:=</span>&nbsp;<span class="ident" id="3528926">req</span><span class="op" id="3528929">.</span><span class="ident" id="3528930">Header</span><span class="op" id="3528936">[</span><span class="string" id="3528937">&#34;User-Agent&#34;</span><span class="op" id="3528949">]</span><span class="op" id="3528950">;</span>&nbsp;<span class="builtinfunc" id="3528952">len</span><span class="op" id="3528955">(</span><span class="ident" id="3528956">ua</span><span class="op" id="3528958">)</span>&nbsp;<span class="op" id="3528960">&gt;</span>&nbsp;<span class="num" id="3528962">0</span>&nbsp;<span class="op" id="3528964">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3528969">userAgent</span>&nbsp;<span class="op" id="3528979">=</span>&nbsp;<span class="ident" id="3528981">ua</span><span class="op" id="3528983">[</span><span class="num" id="3528984">0</span><span class="op" id="3528985">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3528989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3528992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3528995">if</span>&nbsp;<span class="ident" id="3528998">userAgent</span>&nbsp;<span class="op" id="3529008">!=</span>&nbsp;<span class="string" id="3529011">&#34;&#34;</span>&nbsp;<span class="op" id="3529014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3529018">_</span><span class="op" id="3529019">,</span>&nbsp;<span class="ident" id="3529021">err</span>&nbsp;<span class="op" id="3529025">=</span>&nbsp;<span class="ident" id="3529027">fmt</span><span class="op" id="3529030">.</span><span class="ident" id="3529031">Fprintf</span><span class="op" id="3529038">(</span><span class="ident" id="3529039">w</span><span class="op" id="3529040">,</span>&nbsp;<span class="string" id="3529042">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="3529062">,</span>&nbsp;<span class="ident" id="3529064">userAgent</span><span class="op" id="3529073">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529077">if</span>&nbsp;<span class="ident" id="3529080">err</span>&nbsp;<span class="op" id="3529084">!=</span>&nbsp;<span class="builtintype" id="3529087">nil</span>&nbsp;<span class="op" id="3529091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529096">return</span>&nbsp;<span class="ident" id="3529103">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3529116">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3529161">tw</span><span class="op" id="3529163">,</span>&nbsp;<span class="ident" id="3529165">err</span>&nbsp;<span class="op" id="3529169">:=</span>&nbsp;<span class="ident" id="3529172">newTransferWriter</span><span class="op" id="3529189">(</span><span class="ident" id="3529190">req</span><span class="op" id="3529193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529196">if</span>&nbsp;<span class="ident" id="3529199">err</span>&nbsp;<span class="op" id="3529203">!=</span>&nbsp;<span class="builtintype" id="3529206">nil</span>&nbsp;<span class="op" id="3529210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529214">return</span>&nbsp;<span class="ident" id="3529221">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529226">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3529229">err</span>&nbsp;<span class="op" id="3529233">=</span>&nbsp;<span class="ident" id="3529235">tw</span><span class="op" id="3529237">.</span><span class="ident" id="3529238">WriteHeader</span><span class="op" id="3529249">(</span><span class="ident" id="3529250">w</span><span class="op" id="3529251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529254">if</span>&nbsp;<span class="ident" id="3529257">err</span>&nbsp;<span class="op" id="3529261">!=</span>&nbsp;<span class="builtintype" id="3529264">nil</span>&nbsp;<span class="op" id="3529268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529272">return</span>&nbsp;<span class="ident" id="3529279">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3529288">err</span>&nbsp;<span class="op" id="3529292">=</span>&nbsp;<span class="ident" id="3529294">req</span><span class="op" id="3529297">.</span><span class="ident" id="3529298">Header</span><span class="op" id="3529304">.</span><span class="ident" id="3529305">WriteSubset</span><span class="op" id="3529316">(</span><span class="ident" id="3529317">w</span><span class="op" id="3529318">,</span>&nbsp;<span class="ident" id="3529320">reqWriteExcludeHeader</span><span class="op" id="3529341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529344">if</span>&nbsp;<span class="ident" id="3529347">err</span>&nbsp;<span class="op" id="3529351">!=</span>&nbsp;<span class="builtintype" id="3529354">nil</span>&nbsp;<span class="op" id="3529358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529362">return</span>&nbsp;<span class="ident" id="3529369">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529378">if</span>&nbsp;<span class="ident" id="3529381">extraHeaders</span>&nbsp;<span class="op" id="3529394">!=</span>&nbsp;<span class="builtintype" id="3529397">nil</span>&nbsp;<span class="op" id="3529401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3529405">err</span>&nbsp;<span class="op" id="3529409">=</span>&nbsp;<span class="ident" id="3529411">extraHeaders</span><span class="op" id="3529423">.</span><span class="ident" id="3529424">Write</span><span class="op" id="3529429">(</span><span class="ident" id="3529430">w</span><span class="op" id="3529431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529435">if</span>&nbsp;<span class="ident" id="3529438">err</span>&nbsp;<span class="op" id="3529442">!=</span>&nbsp;<span class="builtintype" id="3529445">nil</span>&nbsp;<span class="op" id="3529449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529454">return</span>&nbsp;<span class="ident" id="3529461">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529467">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3529474">_</span><span class="op" id="3529475">,</span>&nbsp;<span class="ident" id="3529477">err</span>&nbsp;<span class="op" id="3529481">=</span>&nbsp;<span class="ident" id="3529483">io</span><span class="op" id="3529485">.</span><span class="ident" id="3529486">WriteString</span><span class="op" id="3529497">(</span><span class="ident" id="3529498">w</span><span class="op" id="3529499">,</span>&nbsp;<span class="string" id="3529501">&#34;\r\n&#34;</span><span class="op" id="3529507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529510">if</span>&nbsp;<span class="ident" id="3529513">err</span>&nbsp;<span class="op" id="3529517">!=</span>&nbsp;<span class="builtintype" id="3529520">nil</span>&nbsp;<span class="op" id="3529524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529528">return</span>&nbsp;<span class="ident" id="3529535">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3529544">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3529571">err</span>&nbsp;<span class="op" id="3529575">=</span>&nbsp;<span class="ident" id="3529577">tw</span><span class="op" id="3529579">.</span><span class="ident" id="3529580">WriteBody</span><span class="op" id="3529589">(</span><span class="ident" id="3529590">w</span><span class="op" id="3529591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529594">if</span>&nbsp;<span class="ident" id="3529597">err</span>&nbsp;<span class="op" id="3529601">!=</span>&nbsp;<span class="builtintype" id="3529604">nil</span>&nbsp;<span class="op" id="3529608">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529612">return</span>&nbsp;<span class="ident" id="3529619">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529628">if</span>&nbsp;<span class="ident" id="3529631">bw</span>&nbsp;<span class="op" id="3529634">!=</span>&nbsp;<span class="builtintype" id="3529637">nil</span>&nbsp;<span class="op" id="3529641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529645">return</span>&nbsp;<span class="ident" id="3529652">bw</span><span class="op" id="3529654">.</span><span class="ident" id="3529655">Flush</span><span class="op" id="3529660">(</span><span class="op" id="3529661">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529667">return</span>&nbsp;<span class="builtintype" id="3529674">nil</span><br>
<span class="lineno"></span><span class="op" id="3529678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3529681">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="3529731">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3529767">func</span>&nbsp;<span class="ident" id="3529772">ParseHTTPVersion</span><span class="op" id="3529788">(</span><span class="ident" id="3529789">vers</span>&nbsp;<span class="builtintype" id="3529794">string</span><span class="op" id="3529800">)</span>&nbsp;<span class="op" id="3529802">(</span><span class="ident" id="3529803">major</span><span class="op" id="3529808">,</span>&nbsp;<span class="ident" id="3529810">minor</span>&nbsp;<span class="builtintype" id="3529816">int</span><span class="op" id="3529819">,</span>&nbsp;<span class="ident" id="3529821">ok</span>&nbsp;<span class="builtintype" id="3529824">bool</span><span class="op" id="3529828">)</span>&nbsp;<span class="op" id="3529830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529833">const</span>&nbsp;<span class="ident" id="3529839">Big</span>&nbsp;<span class="op" id="3529843">=</span>&nbsp;<span class="num" id="3529845">1000000</span>&nbsp;<span class="comment" id="3529853">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529879">switch</span>&nbsp;<span class="ident" id="3529886">vers</span>&nbsp;<span class="op" id="3529891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529894">case</span>&nbsp;<span class="string" id="3529899">&#34;HTTP/1.1&#34;</span><span class="op" id="3529909">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529913">return</span>&nbsp;<span class="num" id="3529920">1</span><span class="op" id="3529921">,</span>&nbsp;<span class="num" id="3529923">1</span><span class="op" id="3529924">,</span>&nbsp;<span class="builtintype" id="3529926">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529932">case</span>&nbsp;<span class="string" id="3529937">&#34;HTTP/1.0&#34;</span><span class="op" id="3529947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529951">return</span>&nbsp;<span class="num" id="3529958">1</span><span class="op" id="3529959">,</span>&nbsp;<span class="num" id="3529961">0</span><span class="op" id="3529962">,</span>&nbsp;<span class="builtintype" id="3529964">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3529970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3529973">if</span>&nbsp;<span class="op" id="3529976">!</span><span class="ident" id="3529977">strings</span><span class="op" id="3529984">.</span><span class="ident" id="3529985">HasPrefix</span><span class="op" id="3529994">(</span><span class="ident" id="3529995">vers</span><span class="op" id="3529999">,</span>&nbsp;<span class="string" id="3530001">&#34;HTTP/&#34;</span><span class="op" id="3530008">)</span>&nbsp;<span class="op" id="3530010">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530014">return</span>&nbsp;<span class="num" id="3530021">0</span><span class="op" id="3530022">,</span>&nbsp;<span class="num" id="3530024">0</span><span class="op" id="3530025">,</span>&nbsp;<span class="builtintype" id="3530027">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530037">dot</span>&nbsp;<span class="op" id="3530041">:=</span>&nbsp;<span class="ident" id="3530044">strings</span><span class="op" id="3530051">.</span><span class="ident" id="3530052">Index</span><span class="op" id="3530057">(</span><span class="ident" id="3530058">vers</span><span class="op" id="3530062">,</span>&nbsp;<span class="string" id="3530064">&#34;.&#34;</span><span class="op" id="3530067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530070">if</span>&nbsp;<span class="ident" id="3530073">dot</span>&nbsp;<span class="op" id="3530077">&lt;</span>&nbsp;<span class="num" id="3530079">0</span>&nbsp;<span class="op" id="3530081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530085">return</span>&nbsp;<span class="num" id="3530092">0</span><span class="op" id="3530093">,</span>&nbsp;<span class="num" id="3530095">0</span><span class="op" id="3530096">,</span>&nbsp;<span class="builtintype" id="3530098">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530108">major</span><span class="op" id="3530113">,</span>&nbsp;<span class="ident" id="3530115">err</span>&nbsp;<span class="op" id="3530119">:=</span>&nbsp;<span class="ident" id="3530122">strconv</span><span class="op" id="3530129">.</span><span class="ident" id="3530130">Atoi</span><span class="op" id="3530134">(</span><span class="ident" id="3530135">vers</span><span class="op" id="3530139">[</span><span class="num" id="3530140">5</span><span class="op" id="3530141">:</span><span class="ident" id="3530142">dot</span><span class="op" id="3530145">]</span><span class="op" id="3530146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530149">if</span>&nbsp;<span class="ident" id="3530152">err</span>&nbsp;<span class="op" id="3530156">!=</span>&nbsp;<span class="builtintype" id="3530159">nil</span>&nbsp;<span class="op" id="3530163">||</span>&nbsp;<span class="ident" id="3530166">major</span>&nbsp;<span class="op" id="3530172">&lt;</span>&nbsp;<span class="num" id="3530174">0</span>&nbsp;<span class="op" id="3530176">||</span>&nbsp;<span class="ident" id="3530179">major</span>&nbsp;<span class="op" id="3530185">&gt;</span>&nbsp;<span class="ident" id="3530187">Big</span>&nbsp;<span class="op" id="3530191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530195">return</span>&nbsp;<span class="num" id="3530202">0</span><span class="op" id="3530203">,</span>&nbsp;<span class="num" id="3530205">0</span><span class="op" id="3530206">,</span>&nbsp;<span class="builtintype" id="3530208">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530215">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530218">minor</span><span class="op" id="3530223">,</span>&nbsp;<span class="ident" id="3530225">err</span>&nbsp;<span class="op" id="3530229">=</span>&nbsp;<span class="ident" id="3530231">strconv</span><span class="op" id="3530238">.</span><span class="ident" id="3530239">Atoi</span><span class="op" id="3530243">(</span><span class="ident" id="3530244">vers</span><span class="op" id="3530248">[</span><span class="ident" id="3530249">dot</span><span class="op" id="3530252">+</span><span class="num" id="3530253">1</span><span class="op" id="3530254">:</span><span class="op" id="3530255">]</span><span class="op" id="3530256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530259">if</span>&nbsp;<span class="ident" id="3530262">err</span>&nbsp;<span class="op" id="3530266">!=</span>&nbsp;<span class="builtintype" id="3530269">nil</span>&nbsp;<span class="op" id="3530273">||</span>&nbsp;<span class="ident" id="3530276">minor</span>&nbsp;<span class="op" id="3530282">&lt;</span>&nbsp;<span class="num" id="3530284">0</span>&nbsp;<span class="op" id="3530286">||</span>&nbsp;<span class="ident" id="3530289">minor</span>&nbsp;<span class="op" id="3530295">&gt;</span>&nbsp;<span class="ident" id="3530297">Big</span>&nbsp;<span class="op" id="3530301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530305">return</span>&nbsp;<span class="num" id="3530312">0</span><span class="op" id="3530313">,</span>&nbsp;<span class="num" id="3530315">0</span><span class="op" id="3530316">,</span>&nbsp;<span class="builtintype" id="3530318">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530328">return</span>&nbsp;<span class="ident" id="3530335">major</span><span class="op" id="3530340">,</span>&nbsp;<span class="ident" id="3530342">minor</span><span class="op" id="3530347">,</span>&nbsp;<span class="builtintype" id="3530349">true</span><br>
<span class="lineno">485</span><span class="op" id="3530354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3530357">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3530433">//</span><br>
<span class="lineno"></span><span class="comment" id="3530436">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="3530495">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="3530559">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="3530619">func</span>&nbsp;<span class="ident" id="3530624">NewRequest</span><span class="op" id="3530634">(</span><span class="ident" id="3530635">method</span><span class="op" id="3530641">,</span>&nbsp;<span class="ident" id="3530643">urlStr</span>&nbsp;<span class="builtintype" id="3530650">string</span><span class="op" id="3530656">,</span>&nbsp;<span class="ident" id="3530658">body</span>&nbsp;<span class="ident" id="3530663">io</span><span class="op" id="3530665">.</span><span class="ident" id="3530666">Reader</span><span class="op" id="3530672">)</span>&nbsp;<span class="op" id="3530674">(</span><span class="op" id="3530675">*</span><span class="ident" id="3530676">Request</span><span class="op" id="3530683">,</span>&nbsp;<span class="builtintype" id="3530685">error</span><span class="op" id="3530690">)</span>&nbsp;<span class="op" id="3530692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530695">u</span><span class="op" id="3530696">,</span>&nbsp;<span class="ident" id="3530698">err</span>&nbsp;<span class="op" id="3530702">:=</span>&nbsp;<span class="ident" id="3530705">url</span><span class="op" id="3530708">.</span><span class="ident" id="3530709">Parse</span><span class="op" id="3530714">(</span><span class="ident" id="3530715">urlStr</span><span class="op" id="3530721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530724">if</span>&nbsp;<span class="ident" id="3530727">err</span>&nbsp;<span class="op" id="3530731">!=</span>&nbsp;<span class="builtintype" id="3530734">nil</span>&nbsp;<span class="op" id="3530738">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530742">return</span>&nbsp;<span class="builtintype" id="3530749">nil</span><span class="op" id="3530752">,</span>&nbsp;<span class="ident" id="3530754">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530762">rc</span><span class="op" id="3530764">,</span>&nbsp;<span class="ident" id="3530766">ok</span>&nbsp;<span class="op" id="3530769">:=</span>&nbsp;<span class="ident" id="3530772">body</span><span class="op" id="3530776">.</span><span class="op" id="3530777">(</span><span class="ident" id="3530778">io</span><span class="op" id="3530780">.</span><span class="ident" id="3530781">ReadCloser</span><span class="op" id="3530791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3530794">if</span>&nbsp;<span class="op" id="3530797">!</span><span class="ident" id="3530798">ok</span>&nbsp;<span class="op" id="3530801">&amp;&amp;</span>&nbsp;<span class="ident" id="3530804">body</span>&nbsp;<span class="op" id="3530809">!=</span>&nbsp;<span class="builtintype" id="3530812">nil</span>&nbsp;<span class="op" id="3530816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530820">rc</span>&nbsp;<span class="op" id="3530823">=</span>&nbsp;<span class="ident" id="3530825">ioutil</span><span class="op" id="3530831">.</span><span class="ident" id="3530832">NopCloser</span><span class="op" id="3530841">(</span><span class="ident" id="3530842">body</span><span class="op" id="3530846">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530852">req</span>&nbsp;<span class="op" id="3530856">:=</span>&nbsp;<span class="op" id="3530859">&amp;</span><span class="ident" id="3530860">Request</span><span class="op" id="3530867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530871">Method</span><span class="op" id="3530877">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530883">method</span><span class="op" id="3530889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530893">URL</span><span class="op" id="3530896">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530905">u</span><span class="op" id="3530906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530910">Proto</span><span class="op" id="3530915">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3530922">&#34;HTTP/1.1&#34;</span><span class="op" id="3530932">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530936">ProtoMajor</span><span class="op" id="3530946">:</span>&nbsp;<span class="num" id="3530948">1</span><span class="op" id="3530949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530953">ProtoMinor</span><span class="op" id="3530963">:</span>&nbsp;<span class="num" id="3530965">1</span><span class="op" id="3530966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530970">Header</span><span class="op" id="3530976">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3530982">make</span><span class="op" id="3530986">(</span><span class="ident" id="3530987">Header</span><span class="op" id="3530993">)</span><span class="op" id="3530994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3530998">Body</span><span class="op" id="3531002">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531010">rc</span><span class="op" id="3531012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531016">Host</span><span class="op" id="3531020">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531028">u</span><span class="op" id="3531029">.</span><span class="ident" id="3531030">Host</span><span class="op" id="3531034">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531040">if</span>&nbsp;<span class="ident" id="3531043">body</span>&nbsp;<span class="op" id="3531048">!=</span>&nbsp;<span class="builtintype" id="3531051">nil</span>&nbsp;<span class="op" id="3531055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531059">switch</span>&nbsp;<span class="ident" id="3531066">v</span>&nbsp;<span class="op" id="3531068">:=</span>&nbsp;<span class="ident" id="3531071">body</span><span class="op" id="3531075">.</span><span class="op" id="3531076">(</span><span class="keyword" id="3531077">type</span><span class="op" id="3531081">)</span>&nbsp;<span class="op" id="3531083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531087">case</span>&nbsp;<span class="op" id="3531092">*</span><span class="ident" id="3531093">bytes</span><span class="op" id="3531098">.</span><span class="ident" id="3531099">Buffer</span><span class="op" id="3531105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531110">req</span><span class="op" id="3531113">.</span><span class="ident" id="3531114">ContentLength</span>&nbsp;<span class="op" id="3531128">=</span>&nbsp;<span class="builtintype" id="3531130">int64</span><span class="op" id="3531135">(</span><span class="ident" id="3531136">v</span><span class="op" id="3531137">.</span><span class="ident" id="3531138">Len</span><span class="op" id="3531141">(</span><span class="op" id="3531142">)</span><span class="op" id="3531143">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531147">case</span>&nbsp;<span class="op" id="3531152">*</span><span class="ident" id="3531153">bytes</span><span class="op" id="3531158">.</span><span class="ident" id="3531159">Reader</span><span class="op" id="3531165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531170">req</span><span class="op" id="3531173">.</span><span class="ident" id="3531174">ContentLength</span>&nbsp;<span class="op" id="3531188">=</span>&nbsp;<span class="builtintype" id="3531190">int64</span><span class="op" id="3531195">(</span><span class="ident" id="3531196">v</span><span class="op" id="3531197">.</span><span class="ident" id="3531198">Len</span><span class="op" id="3531201">(</span><span class="op" id="3531202">)</span><span class="op" id="3531203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531207">case</span>&nbsp;<span class="op" id="3531212">*</span><span class="ident" id="3531213">strings</span><span class="op" id="3531220">.</span><span class="ident" id="3531221">Reader</span><span class="op" id="3531227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531232">req</span><span class="op" id="3531235">.</span><span class="ident" id="3531236">ContentLength</span>&nbsp;<span class="op" id="3531250">=</span>&nbsp;<span class="builtintype" id="3531252">int64</span><span class="op" id="3531257">(</span><span class="ident" id="3531258">v</span><span class="op" id="3531259">.</span><span class="ident" id="3531260">Len</span><span class="op" id="3531263">(</span><span class="op" id="3531264">)</span><span class="op" id="3531265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531269">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531276">return</span>&nbsp;<span class="ident" id="3531283">req</span><span class="op" id="3531286">,</span>&nbsp;<span class="builtintype" id="3531288">nil</span><br>
<span class="lineno"></span><span class="op" id="3531292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="3531295">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3531368">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="3531440">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="3531468">func</span>&nbsp;<span class="op" id="3531473">(</span><span class="ident" id="3531474">r</span>&nbsp;<span class="op" id="3531476">*</span><span class="ident" id="3531477">Request</span><span class="op" id="3531484">)</span>&nbsp;<span class="ident" id="3531486">BasicAuth</span><span class="op" id="3531495">(</span><span class="op" id="3531496">)</span>&nbsp;<span class="op" id="3531498">(</span><span class="ident" id="3531499">username</span><span class="op" id="3531507">,</span>&nbsp;<span class="ident" id="3531509">password</span>&nbsp;<span class="builtintype" id="3531518">string</span><span class="op" id="3531524">,</span>&nbsp;<span class="ident" id="3531526">ok</span>&nbsp;<span class="builtintype" id="3531529">bool</span><span class="op" id="3531533">)</span>&nbsp;<span class="op" id="3531535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531538">auth</span>&nbsp;<span class="op" id="3531543">:=</span>&nbsp;<span class="ident" id="3531546">r</span><span class="op" id="3531547">.</span><span class="ident" id="3531548">Header</span><span class="op" id="3531554">.</span><span class="ident" id="3531555">Get</span><span class="op" id="3531558">(</span><span class="string" id="3531559">&#34;Authorization&#34;</span><span class="op" id="3531574">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531577">if</span>&nbsp;<span class="ident" id="3531580">auth</span>&nbsp;<span class="op" id="3531585">==</span>&nbsp;<span class="string" id="3531588">&#34;&#34;</span>&nbsp;<span class="op" id="3531591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531595">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531606">return</span>&nbsp;<span class="ident" id="3531613">parseBasicAuth</span><span class="op" id="3531627">(</span><span class="ident" id="3531628">auth</span><span class="op" id="3531632">)</span><br>
<span class="lineno"></span><span class="op" id="3531634">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="3531637">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3531699">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3531781">func</span>&nbsp;<span class="ident" id="3531786">parseBasicAuth</span><span class="op" id="3531800">(</span><span class="ident" id="3531801">auth</span>&nbsp;<span class="builtintype" id="3531806">string</span><span class="op" id="3531812">)</span>&nbsp;<span class="op" id="3531814">(</span><span class="ident" id="3531815">username</span><span class="op" id="3531823">,</span>&nbsp;<span class="ident" id="3531825">password</span>&nbsp;<span class="builtintype" id="3531834">string</span><span class="op" id="3531840">,</span>&nbsp;<span class="ident" id="3531842">ok</span>&nbsp;<span class="builtintype" id="3531845">bool</span><span class="op" id="3531849">)</span>&nbsp;<span class="op" id="3531851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531854">if</span>&nbsp;<span class="op" id="3531857">!</span><span class="ident" id="3531858">strings</span><span class="op" id="3531865">.</span><span class="ident" id="3531866">HasPrefix</span><span class="op" id="3531875">(</span><span class="ident" id="3531876">auth</span><span class="op" id="3531880">,</span>&nbsp;<span class="string" id="3531882">&#34;Basic&nbsp;&#34;</span><span class="op" id="3531890">)</span>&nbsp;<span class="op" id="3531892">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531896">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3531904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3531907">c</span><span class="op" id="3531908">,</span>&nbsp;<span class="ident" id="3531910">err</span>&nbsp;<span class="op" id="3531914">:=</span>&nbsp;<span class="ident" id="3531917">base64</span><span class="op" id="3531923">.</span><span class="ident" id="3531924">StdEncoding</span><span class="op" id="3531935">.</span><span class="ident" id="3531936">DecodeString</span><span class="op" id="3531948">(</span><span class="ident" id="3531949">strings</span><span class="op" id="3531956">.</span><span class="ident" id="3531957">TrimPrefix</span><span class="op" id="3531967">(</span><span class="ident" id="3531968">auth</span><span class="op" id="3531972">,</span>&nbsp;<span class="string" id="3531974">&#34;Basic&nbsp;&#34;</span><span class="op" id="3531982">)</span><span class="op" id="3531983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3531986">if</span>&nbsp;<span class="ident" id="3531989">err</span>&nbsp;<span class="op" id="3531993">!=</span>&nbsp;<span class="builtintype" id="3531996">nil</span>&nbsp;<span class="op" id="3532000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532004">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3532012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3532015">cs</span>&nbsp;<span class="op" id="3532018">:=</span>&nbsp;<span class="builtintype" id="3532021">string</span><span class="op" id="3532027">(</span><span class="ident" id="3532028">c</span><span class="op" id="3532029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3532032">s</span>&nbsp;<span class="op" id="3532034">:=</span>&nbsp;<span class="ident" id="3532037">strings</span><span class="op" id="3532044">.</span><span class="ident" id="3532045">IndexByte</span><span class="op" id="3532054">(</span><span class="ident" id="3532055">cs</span><span class="op" id="3532057">,</span>&nbsp;<span class="string" id="3532059">&#39;:&#39;</span><span class="op" id="3532062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532065">if</span>&nbsp;<span class="ident" id="3532068">s</span>&nbsp;<span class="op" id="3532070">&lt;</span>&nbsp;<span class="num" id="3532072">0</span>&nbsp;<span class="op" id="3532074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532078">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3532086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532089">return</span>&nbsp;<span class="ident" id="3532096">cs</span><span class="op" id="3532098">[</span><span class="op" id="3532099">:</span><span class="ident" id="3532100">s</span><span class="op" id="3532101">]</span><span class="op" id="3532102">,</span>&nbsp;<span class="ident" id="3532104">cs</span><span class="op" id="3532106">[</span><span class="ident" id="3532107">s</span><span class="op" id="3532108">+</span><span class="num" id="3532109">1</span><span class="op" id="3532110">:</span><span class="op" id="3532111">]</span><span class="op" id="3532112">,</span>&nbsp;<span class="builtintype" id="3532114">true</span><br>
<span class="lineno"></span><span class="op" id="3532119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3532122">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="3532190">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3532255">//</span><br>
<span class="lineno"></span><span class="comment" id="3532258">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="3532327">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="3532349">func</span>&nbsp;<span class="op" id="3532354">(</span><span class="ident" id="3532355">r</span>&nbsp;<span class="op" id="3532357">*</span><span class="ident" id="3532358">Request</span><span class="op" id="3532365">)</span>&nbsp;<span class="ident" id="3532367">SetBasicAuth</span><span class="op" id="3532379">(</span><span class="ident" id="3532380">username</span><span class="op" id="3532388">,</span>&nbsp;<span class="ident" id="3532390">password</span>&nbsp;<span class="builtintype" id="3532399">string</span><span class="op" id="3532405">)</span>&nbsp;<span class="op" id="3532407">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3532410">r</span><span class="op" id="3532411">.</span><span class="ident" id="3532412">Header</span><span class="op" id="3532418">.</span><span class="ident" id="3532419">Set</span><span class="op" id="3532422">(</span><span class="string" id="3532423">&#34;Authorization&#34;</span><span class="op" id="3532438">,</span>&nbsp;<span class="string" id="3532440">&#34;Basic&nbsp;&#34;</span><span class="op" id="3532448">+</span><span class="ident" id="3532449">basicAuth</span><span class="op" id="3532458">(</span><span class="ident" id="3532459">username</span><span class="op" id="3532467">,</span>&nbsp;<span class="ident" id="3532469">password</span><span class="op" id="3532477">)</span><span class="op" id="3532478">)</span><br>
<span class="lineno"></span><span class="op" id="3532480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3532483">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="3532552">func</span>&nbsp;<span class="ident" id="3532557">parseRequestLine</span><span class="op" id="3532573">(</span><span class="ident" id="3532574">line</span>&nbsp;<span class="builtintype" id="3532579">string</span><span class="op" id="3532585">)</span>&nbsp;<span class="op" id="3532587">(</span><span class="ident" id="3532588">method</span><span class="op" id="3532594">,</span>&nbsp;<span class="ident" id="3532596">requestURI</span><span class="op" id="3532606">,</span>&nbsp;<span class="ident" id="3532608">proto</span>&nbsp;<span class="builtintype" id="3532614">string</span><span class="op" id="3532620">,</span>&nbsp;<span class="ident" id="3532622">ok</span>&nbsp;<span class="builtintype" id="3532625">bool</span><span class="op" id="3532629">)</span>&nbsp;<span class="op" id="3532631">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3532634">s1</span>&nbsp;<span class="op" id="3532637">:=</span>&nbsp;<span class="ident" id="3532640">strings</span><span class="op" id="3532647">.</span><span class="ident" id="3532648">Index</span><span class="op" id="3532653">(</span><span class="ident" id="3532654">line</span><span class="op" id="3532658">,</span>&nbsp;<span class="string" id="3532660">&#34;&nbsp;&#34;</span><span class="op" id="3532663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3532666">s2</span>&nbsp;<span class="op" id="3532669">:=</span>&nbsp;<span class="ident" id="3532672">strings</span><span class="op" id="3532679">.</span><span class="ident" id="3532680">Index</span><span class="op" id="3532685">(</span><span class="ident" id="3532686">line</span><span class="op" id="3532690">[</span><span class="ident" id="3532691">s1</span><span class="op" id="3532693">+</span><span class="num" id="3532694">1</span><span class="op" id="3532695">:</span><span class="op" id="3532696">]</span><span class="op" id="3532697">,</span>&nbsp;<span class="string" id="3532699">&#34;&nbsp;&#34;</span><span class="op" id="3532702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532705">if</span>&nbsp;<span class="ident" id="3532708">s1</span>&nbsp;<span class="op" id="3532711">&lt;</span>&nbsp;<span class="num" id="3532713">0</span>&nbsp;<span class="op" id="3532715">||</span>&nbsp;<span class="ident" id="3532718">s2</span>&nbsp;<span class="op" id="3532721">&lt;</span>&nbsp;<span class="num" id="3532723">0</span>&nbsp;<span class="op" id="3532725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532729">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3532737">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3532740">s2</span>&nbsp;<span class="op" id="3532743">+=</span>&nbsp;<span class="ident" id="3532746">s1</span>&nbsp;<span class="op" id="3532749">+</span>&nbsp;<span class="num" id="3532751">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532754">return</span>&nbsp;<span class="ident" id="3532761">line</span><span class="op" id="3532765">[</span><span class="op" id="3532766">:</span><span class="ident" id="3532767">s1</span><span class="op" id="3532769">]</span><span class="op" id="3532770">,</span>&nbsp;<span class="ident" id="3532772">line</span><span class="op" id="3532776">[</span><span class="ident" id="3532777">s1</span><span class="op" id="3532779">+</span><span class="num" id="3532780">1</span>&nbsp;<span class="op" id="3532782">:</span>&nbsp;<span class="ident" id="3532784">s2</span><span class="op" id="3532786">]</span><span class="op" id="3532787">,</span>&nbsp;<span class="ident" id="3532789">line</span><span class="op" id="3532793">[</span><span class="ident" id="3532794">s2</span><span class="op" id="3532796">+</span><span class="num" id="3532797">1</span><span class="op" id="3532798">:</span><span class="op" id="3532799">]</span><span class="op" id="3532800">,</span>&nbsp;<span class="builtintype" id="3532802">true</span><br>
<span class="lineno"></span><span class="op" id="3532807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3532810">var</span>&nbsp;<span class="ident" id="3532814">textprotoReaderPool</span>&nbsp;<span class="ident" id="3532834">sync</span><span class="op" id="3532838">.</span><span class="ident" id="3532839">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="3532845">func</span>&nbsp;<span class="ident" id="3532850">newTextprotoReader</span><span class="op" id="3532868">(</span><span class="ident" id="3532869">br</span>&nbsp;<span class="op" id="3532872">*</span><span class="ident" id="3532873">bufio</span><span class="op" id="3532878">.</span><span class="ident" id="3532879">Reader</span><span class="op" id="3532885">)</span>&nbsp;<span class="op" id="3532887">*</span><span class="ident" id="3532888">textproto</span><span class="op" id="3532897">.</span><span class="ident" id="3532898">Reader</span>&nbsp;<span class="op" id="3532905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532908">if</span>&nbsp;<span class="ident" id="3532911">v</span>&nbsp;<span class="op" id="3532913">:=</span>&nbsp;<span class="ident" id="3532916">textprotoReaderPool</span><span class="op" id="3532935">.</span><span class="ident" id="3532936">Get</span><span class="op" id="3532939">(</span><span class="op" id="3532940">)</span><span class="op" id="3532941">;</span>&nbsp;<span class="ident" id="3532943">v</span>&nbsp;<span class="op" id="3532945">!=</span>&nbsp;<span class="builtintype" id="3532948">nil</span>&nbsp;<span class="op" id="3532952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3532956">tr</span>&nbsp;<span class="op" id="3532959">:=</span>&nbsp;<span class="ident" id="3532962">v</span><span class="op" id="3532963">.</span><span class="op" id="3532964">(</span><span class="op" id="3532965">*</span><span class="ident" id="3532966">textproto</span><span class="op" id="3532975">.</span><span class="ident" id="3532976">Reader</span><span class="op" id="3532982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3532986">tr</span><span class="op" id="3532988">.</span><span class="ident" id="3532989">R</span>&nbsp;<span class="op" id="3532991">=</span>&nbsp;<span class="ident" id="3532993">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3532998">return</span>&nbsp;<span class="ident" id="3533005">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3533009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533012">return</span>&nbsp;<span class="ident" id="3533019">textproto</span><span class="op" id="3533028">.</span><span class="ident" id="3533029">NewReader</span><span class="op" id="3533038">(</span><span class="ident" id="3533039">br</span><span class="op" id="3533041">)</span><br>
<span class="lineno"></span><span class="op" id="3533043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="3533046">func</span>&nbsp;<span class="ident" id="3533051">putTextprotoReader</span><span class="op" id="3533069">(</span><span class="ident" id="3533070">r</span>&nbsp;<span class="op" id="3533072">*</span><span class="ident" id="3533073">textproto</span><span class="op" id="3533082">.</span><span class="ident" id="3533083">Reader</span><span class="op" id="3533089">)</span>&nbsp;<span class="op" id="3533091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3533094">r</span><span class="op" id="3533095">.</span><span class="ident" id="3533096">R</span>&nbsp;<span class="op" id="3533098">=</span>&nbsp;<span class="builtintype" id="3533100">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3533105">textprotoReaderPool</span><span class="op" id="3533124">.</span><span class="ident" id="3533125">Put</span><span class="op" id="3533128">(</span><span class="ident" id="3533129">r</span><span class="op" id="3533130">)</span><br>
<span class="lineno"></span><span class="op" id="3533132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3533135">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3533185">func</span>&nbsp;<span class="ident" id="3533190">ReadRequest</span><span class="op" id="3533201">(</span><span class="ident" id="3533202">b</span>&nbsp;<span class="op" id="3533204">*</span><span class="ident" id="3533205">bufio</span><span class="op" id="3533210">.</span><span class="ident" id="3533211">Reader</span><span class="op" id="3533217">)</span>&nbsp;<span class="op" id="3533219">(</span><span class="ident" id="3533220">req</span>&nbsp;<span class="op" id="3533224">*</span><span class="ident" id="3533225">Request</span><span class="op" id="3533232">,</span>&nbsp;<span class="ident" id="3533234">err</span>&nbsp;<span class="builtintype" id="3533238">error</span><span class="op" id="3533243">)</span>&nbsp;<span class="op" id="3533245">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3533249">tp</span>&nbsp;<span class="op" id="3533252">:=</span>&nbsp;<span class="ident" id="3533255">newTextprotoReader</span><span class="op" id="3533273">(</span><span class="ident" id="3533274">b</span><span class="op" id="3533275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3533278">req</span>&nbsp;<span class="op" id="3533282">=</span>&nbsp;<span class="builtinfunc" id="3533284">new</span><span class="op" id="3533287">(</span><span class="ident" id="3533288">Request</span><span class="op" id="3533295">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3533299">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533340">var</span>&nbsp;<span class="ident" id="3533344">s</span>&nbsp;<span class="builtintype" id="3533346">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533354">if</span>&nbsp;<span class="ident" id="3533357">s</span><span class="op" id="3533358">,</span>&nbsp;<span class="ident" id="3533360">err</span>&nbsp;<span class="op" id="3533364">=</span>&nbsp;<span class="ident" id="3533366">tp</span><span class="op" id="3533368">.</span><span class="ident" id="3533369">ReadLine</span><span class="op" id="3533377">(</span><span class="op" id="3533378">)</span><span class="op" id="3533379">;</span>&nbsp;<span class="ident" id="3533381">err</span>&nbsp;<span class="op" id="3533385">!=</span>&nbsp;<span class="builtintype" id="3533388">nil</span>&nbsp;<span class="op" id="3533392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533396">return</span>&nbsp;<span class="builtintype" id="3533403">nil</span><span class="op" id="3533406">,</span>&nbsp;<span class="ident" id="3533408">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3533413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533416">defer</span>&nbsp;<span class="keyword" id="3533422">func</span><span class="op" id="3533426">(</span><span class="op" id="3533427">)</span>&nbsp;<span class="op" id="3533429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3533433">putTextprotoReader</span><span class="op" id="3533451">(</span><span class="ident" id="3533452">tp</span><span class="op" id="3533454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533458">if</span>&nbsp;<span class="ident" id="3533461">err</span>&nbsp;<span class="op" id="3533465">==</span>&nbsp;<span class="ident" id="3533468">io</span><span class="op" id="3533470">.</span><span class="ident" id="3533471">EOF</span>&nbsp;<span class="op" id="3533475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3533480">err</span>&nbsp;<span class="op" id="3533484">=</span>&nbsp;<span class="ident" id="3533486">io</span><span class="op" id="3533488">.</span><span class="ident" id="3533489">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3533508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3533511">}</span><span class="op" id="3533512">(</span><span class="op" id="3533513">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533517">var</span>&nbsp;<span class="ident" id="3533521">ok</span>&nbsp;<span class="builtintype" id="3533524">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3533530">req</span><span class="op" id="3533533">.</span><span class="ident" id="3533534">Method</span><span class="op" id="3533540">,</span>&nbsp;<span class="ident" id="3533542">req</span><span class="op" id="3533545">.</span><span class="ident" id="3533546">RequestURI</span><span class="op" id="3533556">,</span>&nbsp;<span class="ident" id="3533558">req</span><span class="op" id="3533561">.</span><span class="ident" id="3533562">Proto</span><span class="op" id="3533567">,</span>&nbsp;<span class="ident" id="3533569">ok</span>&nbsp;<span class="op" id="3533572">=</span>&nbsp;<span class="ident" id="3533574">parseRequestLine</span><span class="op" id="3533590">(</span><span class="ident" id="3533591">s</span><span class="op" id="3533592">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533595">if</span>&nbsp;<span class="op" id="3533598">!</span><span class="ident" id="3533599">ok</span>&nbsp;<span class="op" id="3533602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533606">return</span>&nbsp;<span class="builtintype" id="3533613">nil</span><span class="op" id="3533616">,</span>&nbsp;<span class="op" id="3533618">&amp;</span><span class="ident" id="3533619">badStringError</span><span class="op" id="3533633">{</span><span class="string" id="3533634">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="3533658">,</span>&nbsp;<span class="ident" id="3533660">s</span><span class="op" id="3533661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3533664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3533667">rawurl</span>&nbsp;<span class="op" id="3533674">:=</span>&nbsp;<span class="ident" id="3533677">req</span><span class="op" id="3533680">.</span><span class="ident" id="3533681">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533693">if</span>&nbsp;<span class="ident" id="3533696">req</span><span class="op" id="3533699">.</span><span class="ident" id="3533700">ProtoMajor</span><span class="op" id="3533710">,</span>&nbsp;<span class="ident" id="3533712">req</span><span class="op" id="3533715">.</span><span class="ident" id="3533716">ProtoMinor</span><span class="op" id="3533726">,</span>&nbsp;<span class="ident" id="3533728">ok</span>&nbsp;<span class="op" id="3533731">=</span>&nbsp;<span class="ident" id="3533733">ParseHTTPVersion</span><span class="op" id="3533749">(</span><span class="ident" id="3533750">req</span><span class="op" id="3533753">.</span><span class="ident" id="3533754">Proto</span><span class="op" id="3533759">)</span><span class="op" id="3533760">;</span>&nbsp;<span class="op" id="3533762">!</span><span class="ident" id="3533763">ok</span>&nbsp;<span class="op" id="3533766">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3533770">return</span>&nbsp;<span class="builtintype" id="3533777">nil</span><span class="op" id="3533780">,</span>&nbsp;<span class="op" id="3533782">&amp;</span><span class="ident" id="3533783">badStringError</span><span class="op" id="3533797">{</span><span class="string" id="3533798">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3533822">,</span>&nbsp;<span class="ident" id="3533824">req</span><span class="op" id="3533827">.</span><span class="ident" id="3533828">Proto</span><span class="op" id="3533833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3533836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3533840">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3533919">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3533982">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534060">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534145">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534149">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534226">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534302">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534382">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3534399">justAuthority</span>&nbsp;<span class="op" id="3534413">:=</span>&nbsp;<span class="ident" id="3534416">req</span><span class="op" id="3534419">.</span><span class="ident" id="3534420">Method</span>&nbsp;<span class="op" id="3534427">==</span>&nbsp;<span class="string" id="3534430">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3534440">&amp;&amp;</span>&nbsp;<span class="op" id="3534443">!</span><span class="ident" id="3534444">strings</span><span class="op" id="3534451">.</span><span class="ident" id="3534452">HasPrefix</span><span class="op" id="3534461">(</span><span class="ident" id="3534462">rawurl</span><span class="op" id="3534468">,</span>&nbsp;<span class="string" id="3534470">&#34;/&#34;</span><span class="op" id="3534473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3534476">if</span>&nbsp;<span class="ident" id="3534479">justAuthority</span>&nbsp;<span class="op" id="3534493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3534497">rawurl</span>&nbsp;<span class="op" id="3534504">=</span>&nbsp;<span class="string" id="3534506">&#34;http://&#34;</span>&nbsp;<span class="op" id="3534516">+</span>&nbsp;<span class="ident" id="3534518">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3534526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3534530">if</span>&nbsp;<span class="ident" id="3534533">req</span><span class="op" id="3534536">.</span><span class="ident" id="3534537">URL</span><span class="op" id="3534540">,</span>&nbsp;<span class="ident" id="3534542">err</span>&nbsp;<span class="op" id="3534546">=</span>&nbsp;<span class="ident" id="3534548">url</span><span class="op" id="3534551">.</span><span class="ident" id="3534552">ParseRequestURI</span><span class="op" id="3534567">(</span><span class="ident" id="3534568">rawurl</span><span class="op" id="3534574">)</span><span class="op" id="3534575">;</span>&nbsp;<span class="ident" id="3534577">err</span>&nbsp;<span class="op" id="3534581">!=</span>&nbsp;<span class="builtintype" id="3534584">nil</span>&nbsp;<span class="op" id="3534588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3534592">return</span>&nbsp;<span class="builtintype" id="3534599">nil</span><span class="op" id="3534602">,</span>&nbsp;<span class="ident" id="3534604">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3534609">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3534613">if</span>&nbsp;<span class="ident" id="3534616">justAuthority</span>&nbsp;<span class="op" id="3534630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534634">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3534675">req</span><span class="op" id="3534678">.</span><span class="ident" id="3534679">URL</span><span class="op" id="3534682">.</span><span class="ident" id="3534683">Scheme</span>&nbsp;<span class="op" id="3534690">=</span>&nbsp;<span class="string" id="3534692">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3534696">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534700">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3534734">mimeHeader</span><span class="op" id="3534744">,</span>&nbsp;<span class="ident" id="3534746">err</span>&nbsp;<span class="op" id="3534750">:=</span>&nbsp;<span class="ident" id="3534753">tp</span><span class="op" id="3534755">.</span><span class="ident" id="3534756">ReadMIMEHeader</span><span class="op" id="3534770">(</span><span class="op" id="3534771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3534774">if</span>&nbsp;<span class="ident" id="3534777">err</span>&nbsp;<span class="op" id="3534781">!=</span>&nbsp;<span class="builtintype" id="3534784">nil</span>&nbsp;<span class="op" id="3534788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3534792">return</span>&nbsp;<span class="builtintype" id="3534799">nil</span><span class="op" id="3534802">,</span>&nbsp;<span class="ident" id="3534804">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3534809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3534812">req</span><span class="op" id="3534815">.</span><span class="ident" id="3534816">Header</span>&nbsp;<span class="op" id="3534823">=</span>&nbsp;<span class="ident" id="3534825">Header</span><span class="op" id="3534831">(</span><span class="ident" id="3534832">mimeHeader</span><span class="op" id="3534842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534846">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534870">//&nbsp;&nbsp;&nbsp;&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534899">//&nbsp;&nbsp;&nbsp;&nbsp;Host:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534924">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534932">//&nbsp;&nbsp;&nbsp;&nbsp;GET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3534982">//&nbsp;&nbsp;&nbsp;&nbsp;Host:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3535005">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3535066">req</span><span class="op" id="3535069">.</span><span class="ident" id="3535070">Host</span>&nbsp;<span class="op" id="3535075">=</span>&nbsp;<span class="ident" id="3535077">req</span><span class="op" id="3535080">.</span><span class="ident" id="3535081">URL</span><span class="op" id="3535084">.</span><span class="ident" id="3535085">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3535091">if</span>&nbsp;<span class="ident" id="3535094">req</span><span class="op" id="3535097">.</span><span class="ident" id="3535098">Host</span>&nbsp;<span class="op" id="3535103">==</span>&nbsp;<span class="string" id="3535106">&#34;&#34;</span>&nbsp;<span class="op" id="3535109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3535113">req</span><span class="op" id="3535116">.</span><span class="ident" id="3535117">Host</span>&nbsp;<span class="op" id="3535122">=</span>&nbsp;<span class="ident" id="3535124">req</span><span class="op" id="3535127">.</span><span class="ident" id="3535128">Header</span><span class="op" id="3535134">.</span><span class="ident" id="3535135">get</span><span class="op" id="3535138">(</span><span class="string" id="3535139">&#34;Host&#34;</span><span class="op" id="3535145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3535148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3535151">delete</span><span class="op" id="3535157">(</span><span class="ident" id="3535158">req</span><span class="op" id="3535161">.</span><span class="ident" id="3535162">Header</span><span class="op" id="3535168">,</span>&nbsp;<span class="string" id="3535170">&#34;Host&#34;</span><span class="op" id="3535176">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3535180">fixPragmaCacheControl</span><span class="op" id="3535201">(</span><span class="ident" id="3535202">req</span><span class="op" id="3535205">.</span><span class="ident" id="3535206">Header</span><span class="op" id="3535212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3535216">err</span>&nbsp;<span class="op" id="3535220">=</span>&nbsp;<span class="ident" id="3535222">readTransfer</span><span class="op" id="3535234">(</span><span class="ident" id="3535235">req</span><span class="op" id="3535238">,</span>&nbsp;<span class="ident" id="3535240">b</span><span class="op" id="3535241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3535244">if</span>&nbsp;<span class="ident" id="3535247">err</span>&nbsp;<span class="op" id="3535251">!=</span>&nbsp;<span class="builtintype" id="3535254">nil</span>&nbsp;<span class="op" id="3535258">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3535262">return</span>&nbsp;<span class="builtintype" id="3535269">nil</span><span class="op" id="3535272">,</span>&nbsp;<span class="ident" id="3535274">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3535279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3535283">req</span><span class="op" id="3535286">.</span><span class="ident" id="3535287">Close</span>&nbsp;<span class="op" id="3535293">=</span>&nbsp;<span class="ident" id="3535295">shouldClose</span><span class="op" id="3535306">(</span><span class="ident" id="3535307">req</span><span class="op" id="3535310">.</span><span class="ident" id="3535311">ProtoMajor</span><span class="op" id="3535321">,</span>&nbsp;<span class="ident" id="3535323">req</span><span class="op" id="3535326">.</span><span class="ident" id="3535327">ProtoMinor</span><span class="op" id="3535337">,</span>&nbsp;<span class="ident" id="3535339">req</span><span class="op" id="3535342">.</span><span class="ident" id="3535343">Header</span><span class="op" id="3535349">,</span>&nbsp;<span class="builtintype" id="3535351">false</span><span class="op" id="3535356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3535359">return</span>&nbsp;<span class="ident" id="3535366">req</span><span class="op" id="3535369">,</span>&nbsp;<span class="builtintype" id="3535371">nil</span><br>
<span class="lineno">670</span><span class="op" id="3535375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3535378">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3535445">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3535509">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="3535579">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3535640">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="3535694">//</span><br>
<span class="lineno"></span><span class="comment" id="3535697">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="3535765">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="3535822">func</span>&nbsp;<span class="ident" id="3535827">MaxBytesReader</span><span class="op" id="3535841">(</span><span class="ident" id="3535842">w</span>&nbsp;<span class="ident" id="3535844">ResponseWriter</span><span class="op" id="3535858">,</span>&nbsp;<span class="ident" id="3535860">r</span>&nbsp;<span class="ident" id="3535862">io</span><span class="op" id="3535864">.</span><span class="ident" id="3535865">ReadCloser</span><span class="op" id="3535875">,</span>&nbsp;<span class="ident" id="3535877">n</span>&nbsp;<span class="builtintype" id="3535879">int64</span><span class="op" id="3535884">)</span>&nbsp;<span class="ident" id="3535886">io</span><span class="op" id="3535888">.</span><span class="ident" id="3535889">ReadCloser</span>&nbsp;<span class="op" id="3535900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3535903">return</span>&nbsp;<span class="op" id="3535910">&amp;</span><span class="ident" id="3535911">maxBytesReader</span><span class="op" id="3535925">{</span><span class="ident" id="3535926">w</span><span class="op" id="3535927">:</span>&nbsp;<span class="ident" id="3535929">w</span><span class="op" id="3535930">,</span>&nbsp;<span class="ident" id="3535932">r</span><span class="op" id="3535933">:</span>&nbsp;<span class="ident" id="3535935">r</span><span class="op" id="3535936">,</span>&nbsp;<span class="ident" id="3535938">n</span><span class="op" id="3535939">:</span>&nbsp;<span class="ident" id="3535941">n</span><span class="op" id="3535942">}</span><br>
<span class="lineno"></span><span class="op" id="3535944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3535947">type</span>&nbsp;<span class="ident" id="3535952">maxBytesReader</span>&nbsp;<span class="keyword" id="3535967">struct</span>&nbsp;<span class="op" id="3535974">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3535977">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3535985">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536001">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536009">io</span><span class="op" id="3536011">.</span><span class="ident" id="3536012">ReadCloser</span>&nbsp;<span class="comment" id="3536023">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536045">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3536053">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3536067">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536091">stopped</span>&nbsp;<span class="builtintype" id="3536099">bool</span><br>
<span class="lineno"></span><span class="op" id="3536104">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="3536107">func</span>&nbsp;<span class="op" id="3536112">(</span><span class="ident" id="3536113">l</span>&nbsp;<span class="op" id="3536115">*</span><span class="ident" id="3536116">maxBytesReader</span><span class="op" id="3536130">)</span>&nbsp;<span class="ident" id="3536132">Read</span><span class="op" id="3536136">(</span><span class="ident" id="3536137">p</span>&nbsp;<span class="op" id="3536139">[</span><span class="op" id="3536140">]</span><span class="builtintype" id="3536141">byte</span><span class="op" id="3536145">)</span>&nbsp;<span class="op" id="3536147">(</span><span class="ident" id="3536148">n</span>&nbsp;<span class="builtintype" id="3536150">int</span><span class="op" id="3536153">,</span>&nbsp;<span class="ident" id="3536155">err</span>&nbsp;<span class="builtintype" id="3536159">error</span><span class="op" id="3536164">)</span>&nbsp;<span class="op" id="3536166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536169">if</span>&nbsp;<span class="ident" id="3536172">l</span><span class="op" id="3536173">.</span><span class="ident" id="3536174">n</span>&nbsp;<span class="op" id="3536176">&lt;=</span>&nbsp;<span class="num" id="3536179">0</span>&nbsp;<span class="op" id="3536181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536185">if</span>&nbsp;<span class="op" id="3536188">!</span><span class="ident" id="3536189">l</span><span class="op" id="3536190">.</span><span class="ident" id="3536191">stopped</span>&nbsp;<span class="op" id="3536199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536204">l</span><span class="op" id="3536205">.</span><span class="ident" id="3536206">stopped</span>&nbsp;<span class="op" id="3536214">=</span>&nbsp;<span class="builtintype" id="3536216">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536224">if</span>&nbsp;<span class="ident" id="3536227">res</span><span class="op" id="3536230">,</span>&nbsp;<span class="ident" id="3536232">ok</span>&nbsp;<span class="op" id="3536235">:=</span>&nbsp;<span class="ident" id="3536238">l</span><span class="op" id="3536239">.</span><span class="ident" id="3536240">w</span><span class="op" id="3536241">.</span><span class="op" id="3536242">(</span><span class="op" id="3536243">*</span><span class="ident" id="3536244">response</span><span class="op" id="3536252">)</span><span class="op" id="3536253">;</span>&nbsp;<span class="ident" id="3536255">ok</span>&nbsp;<span class="op" id="3536258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536264">res</span><span class="op" id="3536267">.</span><span class="ident" id="3536268">requestTooLarge</span><span class="op" id="3536283">(</span><span class="op" id="3536284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3536289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3536293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536297">return</span>&nbsp;<span class="num" id="3536304">0</span><span class="op" id="3536305">,</span>&nbsp;<span class="ident" id="3536307">errors</span><span class="op" id="3536313">.</span><span class="ident" id="3536314">New</span><span class="op" id="3536317">(</span><span class="string" id="3536318">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="3536348">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3536351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536354">if</span>&nbsp;<span class="builtintype" id="3536357">int64</span><span class="op" id="3536362">(</span><span class="builtinfunc" id="3536363">len</span><span class="op" id="3536366">(</span><span class="ident" id="3536367">p</span><span class="op" id="3536368">)</span><span class="op" id="3536369">)</span>&nbsp;<span class="op" id="3536371">&gt;</span>&nbsp;<span class="ident" id="3536373">l</span><span class="op" id="3536374">.</span><span class="ident" id="3536375">n</span>&nbsp;<span class="op" id="3536377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536381">p</span>&nbsp;<span class="op" id="3536383">=</span>&nbsp;<span class="ident" id="3536385">p</span><span class="op" id="3536386">[</span><span class="op" id="3536387">:</span><span class="ident" id="3536388">l</span><span class="op" id="3536389">.</span><span class="ident" id="3536390">n</span><span class="op" id="3536391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3536394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536397">n</span><span class="op" id="3536398">,</span>&nbsp;<span class="ident" id="3536400">err</span>&nbsp;<span class="op" id="3536404">=</span>&nbsp;<span class="ident" id="3536406">l</span><span class="op" id="3536407">.</span><span class="ident" id="3536408">r</span><span class="op" id="3536409">.</span><span class="ident" id="3536410">Read</span><span class="op" id="3536414">(</span><span class="ident" id="3536415">p</span><span class="op" id="3536416">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536419">l</span><span class="op" id="3536420">.</span><span class="ident" id="3536421">n</span>&nbsp;<span class="op" id="3536423">-=</span>&nbsp;<span class="builtintype" id="3536426">int64</span><span class="op" id="3536431">(</span><span class="ident" id="3536432">n</span><span class="op" id="3536433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536436">return</span><br>
<span class="lineno"></span><span class="op" id="3536443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3536446">func</span>&nbsp;<span class="op" id="3536451">(</span><span class="ident" id="3536452">l</span>&nbsp;<span class="op" id="3536454">*</span><span class="ident" id="3536455">maxBytesReader</span><span class="op" id="3536469">)</span>&nbsp;<span class="ident" id="3536471">Close</span><span class="op" id="3536476">(</span><span class="op" id="3536477">)</span>&nbsp;<span class="builtintype" id="3536479">error</span>&nbsp;<span class="op" id="3536485">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536488">return</span>&nbsp;<span class="ident" id="3536495">l</span><span class="op" id="3536496">.</span><span class="ident" id="3536497">r</span><span class="op" id="3536498">.</span><span class="ident" id="3536499">Close</span><span class="op" id="3536504">(</span><span class="op" id="3536505">)</span><br>
<span class="lineno"></span><span class="op" id="3536507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3536510">func</span>&nbsp;<span class="ident" id="3536515">copyValues</span><span class="op" id="3536525">(</span><span class="ident" id="3536526">dst</span><span class="op" id="3536529">,</span>&nbsp;<span class="ident" id="3536531">src</span>&nbsp;<span class="ident" id="3536535">url</span><span class="op" id="3536538">.</span><span class="ident" id="3536539">Values</span><span class="op" id="3536545">)</span>&nbsp;<span class="op" id="3536547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536550">for</span>&nbsp;<span class="ident" id="3536554">k</span><span class="op" id="3536555">,</span>&nbsp;<span class="ident" id="3536557">vs</span>&nbsp;<span class="op" id="3536560">:=</span>&nbsp;<span class="keyword" id="3536563">range</span>&nbsp;<span class="ident" id="3536569">src</span>&nbsp;<span class="op" id="3536573">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536577">for</span>&nbsp;<span class="ident" id="3536581">_</span><span class="op" id="3536582">,</span>&nbsp;<span class="ident" id="3536584">value</span>&nbsp;<span class="op" id="3536590">:=</span>&nbsp;<span class="keyword" id="3536593">range</span>&nbsp;<span class="ident" id="3536599">vs</span>&nbsp;<span class="op" id="3536602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536607">dst</span><span class="op" id="3536610">.</span><span class="ident" id="3536611">Add</span><span class="op" id="3536614">(</span><span class="ident" id="3536615">k</span><span class="op" id="3536616">,</span>&nbsp;<span class="ident" id="3536618">value</span><span class="op" id="3536623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3536627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3536630">}</span><br>
<span class="lineno"></span><span class="op" id="3536632">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="3536635">func</span>&nbsp;<span class="ident" id="3536640">parsePostForm</span><span class="op" id="3536653">(</span><span class="ident" id="3536654">r</span>&nbsp;<span class="op" id="3536656">*</span><span class="ident" id="3536657">Request</span><span class="op" id="3536664">)</span>&nbsp;<span class="op" id="3536666">(</span><span class="ident" id="3536667">vs</span>&nbsp;<span class="ident" id="3536670">url</span><span class="op" id="3536673">.</span><span class="ident" id="3536674">Values</span><span class="op" id="3536680">,</span>&nbsp;<span class="ident" id="3536682">err</span>&nbsp;<span class="builtintype" id="3536686">error</span><span class="op" id="3536691">)</span>&nbsp;<span class="op" id="3536693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536696">if</span>&nbsp;<span class="ident" id="3536699">r</span><span class="op" id="3536700">.</span><span class="ident" id="3536701">Body</span>&nbsp;<span class="op" id="3536706">==</span>&nbsp;<span class="builtintype" id="3536709">nil</span>&nbsp;<span class="op" id="3536713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536717">err</span>&nbsp;<span class="op" id="3536721">=</span>&nbsp;<span class="ident" id="3536723">errors</span><span class="op" id="3536729">.</span><span class="ident" id="3536730">New</span><span class="op" id="3536733">(</span><span class="string" id="3536734">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="3536753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536757">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3536765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536768">ct</span>&nbsp;<span class="op" id="3536771">:=</span>&nbsp;<span class="ident" id="3536774">r</span><span class="op" id="3536775">.</span><span class="ident" id="3536776">Header</span><span class="op" id="3536782">.</span><span class="ident" id="3536783">Get</span><span class="op" id="3536786">(</span><span class="string" id="3536787">&#34;Content-Type&#34;</span><span class="op" id="3536801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3536804">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3536845">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536897">if</span>&nbsp;<span class="ident" id="3536900">ct</span>&nbsp;<span class="op" id="3536903">==</span>&nbsp;<span class="string" id="3536906">&#34;&#34;</span>&nbsp;<span class="op" id="3536909">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536913">ct</span>&nbsp;<span class="op" id="3536916">=</span>&nbsp;<span class="string" id="3536918">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3536946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3536949">ct</span><span class="op" id="3536951">,</span>&nbsp;<span class="ident" id="3536953">_</span><span class="op" id="3536954">,</span>&nbsp;<span class="ident" id="3536956">err</span>&nbsp;<span class="op" id="3536960">=</span>&nbsp;<span class="ident" id="3536962">mime</span><span class="op" id="3536966">.</span><span class="ident" id="3536967">ParseMediaType</span><span class="op" id="3536981">(</span><span class="ident" id="3536982">ct</span><span class="op" id="3536984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536987">switch</span>&nbsp;<span class="op" id="3536994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3536997">case</span>&nbsp;<span class="ident" id="3537002">ct</span>&nbsp;<span class="op" id="3537005">==</span>&nbsp;<span class="string" id="3537008">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="3537043">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3537047">var</span>&nbsp;<span class="ident" id="3537051">reader</span>&nbsp;<span class="ident" id="3537058">io</span><span class="op" id="3537060">.</span><span class="ident" id="3537061">Reader</span>&nbsp;<span class="op" id="3537068">=</span>&nbsp;<span class="ident" id="3537070">r</span><span class="op" id="3537071">.</span><span class="ident" id="3537072">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3537079">maxFormSize</span>&nbsp;<span class="op" id="3537091">:=</span>&nbsp;<span class="builtintype" id="3537094">int64</span><span class="op" id="3537099">(</span><span class="num" id="3537100">1</span><span class="op" id="3537101">&lt;&lt;</span><span class="num" id="3537103">63</span>&nbsp;<span class="op" id="3537106">-</span>&nbsp;<span class="num" id="3537108">1</span><span class="op" id="3537109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3537113">if</span>&nbsp;<span class="ident" id="3537116">_</span><span class="op" id="3537117">,</span>&nbsp;<span class="ident" id="3537119">ok</span>&nbsp;<span class="op" id="3537122">:=</span>&nbsp;<span class="ident" id="3537125">r</span><span class="op" id="3537126">.</span><span class="ident" id="3537127">Body</span><span class="op" id="3537131">.</span><span class="op" id="3537132">(</span><span class="op" id="3537133">*</span><span class="ident" id="3537134">maxBytesReader</span><span class="op" id="3537148">)</span><span class="op" id="3537149">;</span>&nbsp;<span class="op" id="3537151">!</span><span class="ident" id="3537152">ok</span>&nbsp;<span class="op" id="3537155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3537160">maxFormSize</span>&nbsp;<span class="op" id="3537172">=</span>&nbsp;<span class="builtintype" id="3537174">int64</span><span class="op" id="3537179">(</span><span class="num" id="3537180">10</span>&nbsp;<span class="op" id="3537183">&lt;&lt;</span>&nbsp;<span class="num" id="3537186">20</span><span class="op" id="3537188">)</span>&nbsp;<span class="comment" id="3537190">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3537220">reader</span>&nbsp;<span class="op" id="3537227">=</span>&nbsp;<span class="ident" id="3537229">io</span><span class="op" id="3537231">.</span><span class="ident" id="3537232">LimitReader</span><span class="op" id="3537243">(</span><span class="ident" id="3537244">r</span><span class="op" id="3537245">.</span><span class="ident" id="3537246">Body</span><span class="op" id="3537250">,</span>&nbsp;<span class="ident" id="3537252">maxFormSize</span><span class="op" id="3537263">+</span><span class="num" id="3537264">1</span><span class="op" id="3537265">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3537273">b</span><span class="op" id="3537274">,</span>&nbsp;<span class="ident" id="3537276">e</span>&nbsp;<span class="op" id="3537278">:=</span>&nbsp;<span class="ident" id="3537281">ioutil</span><span class="op" id="3537287">.</span><span class="ident" id="3537288">ReadAll</span><span class="op" id="3537295">(</span><span class="ident" id="3537296">reader</span><span class="op" id="3537302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3537306">if</span>&nbsp;<span class="ident" id="3537309">e</span>&nbsp;<span class="op" id="3537311">!=</span>&nbsp;<span class="builtintype" id="3537314">nil</span>&nbsp;<span class="op" id="3537318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3537323">if</span>&nbsp;<span class="ident" id="3537326">err</span>&nbsp;<span class="op" id="3537330">==</span>&nbsp;<span class="builtintype" id="3537333">nil</span>&nbsp;<span class="op" id="3537337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3537343">err</span>&nbsp;<span class="op" id="3537347">=</span>&nbsp;<span class="ident" id="3537349">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3537359">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3537371">if</span>&nbsp;<span class="builtintype" id="3537374">int64</span><span class="op" id="3537379">(</span><span class="builtinfunc" id="3537380">len</span><span class="op" id="3537383">(</span><span class="ident" id="3537384">b</span><span class="op" id="3537385">)</span><span class="op" id="3537386">)</span>&nbsp;<span class="op" id="3537388">&gt;</span>&nbsp;<span class="ident" id="3537390">maxFormSize</span>&nbsp;<span class="op" id="3537402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3537407">err</span>&nbsp;<span class="op" id="3537411">=</span>&nbsp;<span class="ident" id="3537413">errors</span><span class="op" id="3537419">.</span><span class="ident" id="3537420">New</span><span class="op" id="3537423">(</span><span class="string" id="3537424">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="3537446">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3537451">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3537464">vs</span><span class="op" id="3537466">,</span>&nbsp;<span class="ident" id="3537468">e</span>&nbsp;<span class="op" id="3537470">=</span>&nbsp;<span class="ident" id="3537472">url</span><span class="op" id="3537475">.</span><span class="ident" id="3537476">ParseQuery</span><span class="op" id="3537486">(</span><span class="builtintype" id="3537487">string</span><span class="op" id="3537493">(</span><span class="ident" id="3537494">b</span><span class="op" id="3537495">)</span><span class="op" id="3537496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3537500">if</span>&nbsp;<span class="ident" id="3537503">err</span>&nbsp;<span class="op" id="3537507">==</span>&nbsp;<span class="builtintype" id="3537510">nil</span>&nbsp;<span class="op" id="3537514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3537519">err</span>&nbsp;<span class="op" id="3537523">=</span>&nbsp;<span class="ident" id="3537525">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3537532">case</span>&nbsp;<span class="ident" id="3537537">ct</span>&nbsp;<span class="op" id="3537540">==</span>&nbsp;<span class="string" id="3537543">&#34;multipart/form-data&#34;</span><span class="op" id="3537564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3537568">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3537639">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3537688">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3537733">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3537774">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3537823">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3537870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3537873">return</span><br>
<span class="lineno">765</span><span class="op" id="3537880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3537883">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3537950">//</span><br>
<span class="lineno"></span><span class="comment" id="3537953">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="3538028">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3538080">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="3538157">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3538171">//</span><br>
<span class="lineno"></span><span class="comment" id="3538174">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="3538252">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="3538283">//</span><br>
<span class="lineno"></span><span class="comment" id="3538286">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="3538339">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="3538360">func</span>&nbsp;<span class="op" id="3538365">(</span><span class="ident" id="3538366">r</span>&nbsp;<span class="op" id="3538368">*</span><span class="ident" id="3538369">Request</span><span class="op" id="3538376">)</span>&nbsp;<span class="ident" id="3538378">ParseForm</span><span class="op" id="3538387">(</span><span class="op" id="3538388">)</span>&nbsp;<span class="builtintype" id="3538390">error</span>&nbsp;<span class="op" id="3538396">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538399">var</span>&nbsp;<span class="ident" id="3538403">err</span>&nbsp;<span class="builtintype" id="3538407">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538414">if</span>&nbsp;<span class="ident" id="3538417">r</span><span class="op" id="3538418">.</span><span class="ident" id="3538419">PostForm</span>&nbsp;<span class="op" id="3538428">==</span>&nbsp;<span class="builtintype" id="3538431">nil</span>&nbsp;<span class="op" id="3538435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538439">if</span>&nbsp;<span class="ident" id="3538442">r</span><span class="op" id="3538443">.</span><span class="ident" id="3538444">Method</span>&nbsp;<span class="op" id="3538451">==</span>&nbsp;<span class="string" id="3538454">&#34;POST&#34;</span>&nbsp;<span class="op" id="3538461">||</span>&nbsp;<span class="ident" id="3538464">r</span><span class="op" id="3538465">.</span><span class="ident" id="3538466">Method</span>&nbsp;<span class="op" id="3538473">==</span>&nbsp;<span class="string" id="3538476">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3538482">||</span>&nbsp;<span class="ident" id="3538485">r</span><span class="op" id="3538486">.</span><span class="ident" id="3538487">Method</span>&nbsp;<span class="op" id="3538494">==</span>&nbsp;<span class="string" id="3538497">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="3538505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538510">r</span><span class="op" id="3538511">.</span><span class="ident" id="3538512">PostForm</span><span class="op" id="3538520">,</span>&nbsp;<span class="ident" id="3538522">err</span>&nbsp;<span class="op" id="3538526">=</span>&nbsp;<span class="ident" id="3538528">parsePostForm</span><span class="op" id="3538541">(</span><span class="ident" id="3538542">r</span><span class="op" id="3538543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3538547">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538551">if</span>&nbsp;<span class="ident" id="3538554">r</span><span class="op" id="3538555">.</span><span class="ident" id="3538556">PostForm</span>&nbsp;<span class="op" id="3538565">==</span>&nbsp;<span class="builtintype" id="3538568">nil</span>&nbsp;<span class="op" id="3538572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538577">r</span><span class="op" id="3538578">.</span><span class="ident" id="3538579">PostForm</span>&nbsp;<span class="op" id="3538588">=</span>&nbsp;<span class="builtinfunc" id="3538590">make</span><span class="op" id="3538594">(</span><span class="ident" id="3538595">url</span><span class="op" id="3538598">.</span><span class="ident" id="3538599">Values</span><span class="op" id="3538605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3538609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3538612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538615">if</span>&nbsp;<span class="ident" id="3538618">r</span><span class="op" id="3538619">.</span><span class="ident" id="3538620">Form</span>&nbsp;<span class="op" id="3538625">==</span>&nbsp;<span class="builtintype" id="3538628">nil</span>&nbsp;<span class="op" id="3538632">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538636">if</span>&nbsp;<span class="builtinfunc" id="3538639">len</span><span class="op" id="3538642">(</span><span class="ident" id="3538643">r</span><span class="op" id="3538644">.</span><span class="ident" id="3538645">PostForm</span><span class="op" id="3538653">)</span>&nbsp;<span class="op" id="3538655">&gt;</span>&nbsp;<span class="num" id="3538657">0</span>&nbsp;<span class="op" id="3538659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538664">r</span><span class="op" id="3538665">.</span><span class="ident" id="3538666">Form</span>&nbsp;<span class="op" id="3538671">=</span>&nbsp;<span class="builtinfunc" id="3538673">make</span><span class="op" id="3538677">(</span><span class="ident" id="3538678">url</span><span class="op" id="3538681">.</span><span class="ident" id="3538682">Values</span><span class="op" id="3538688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538693">copyValues</span><span class="op" id="3538703">(</span><span class="ident" id="3538704">r</span><span class="op" id="3538705">.</span><span class="ident" id="3538706">Form</span><span class="op" id="3538710">,</span>&nbsp;<span class="ident" id="3538712">r</span><span class="op" id="3538713">.</span><span class="ident" id="3538714">PostForm</span><span class="op" id="3538722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3538726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538730">var</span>&nbsp;<span class="ident" id="3538734">newValues</span>&nbsp;<span class="ident" id="3538744">url</span><span class="op" id="3538747">.</span><span class="ident" id="3538748">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538757">if</span>&nbsp;<span class="ident" id="3538760">r</span><span class="op" id="3538761">.</span><span class="ident" id="3538762">URL</span>&nbsp;<span class="op" id="3538766">!=</span>&nbsp;<span class="builtintype" id="3538769">nil</span>&nbsp;<span class="op" id="3538773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538778">var</span>&nbsp;<span class="ident" id="3538782">e</span>&nbsp;<span class="builtintype" id="3538784">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538793">newValues</span><span class="op" id="3538802">,</span>&nbsp;<span class="ident" id="3538804">e</span>&nbsp;<span class="op" id="3538806">=</span>&nbsp;<span class="ident" id="3538808">url</span><span class="op" id="3538811">.</span><span class="ident" id="3538812">ParseQuery</span><span class="op" id="3538822">(</span><span class="ident" id="3538823">r</span><span class="op" id="3538824">.</span><span class="ident" id="3538825">URL</span><span class="op" id="3538828">.</span><span class="ident" id="3538829">RawQuery</span><span class="op" id="3538837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538842">if</span>&nbsp;<span class="ident" id="3538845">err</span>&nbsp;<span class="op" id="3538849">==</span>&nbsp;<span class="builtintype" id="3538852">nil</span>&nbsp;<span class="op" id="3538856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538862">err</span>&nbsp;<span class="op" id="3538866">=</span>&nbsp;<span class="ident" id="3538868">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3538873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3538877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538881">if</span>&nbsp;<span class="ident" id="3538884">newValues</span>&nbsp;<span class="op" id="3538894">==</span>&nbsp;<span class="builtintype" id="3538897">nil</span>&nbsp;<span class="op" id="3538901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538906">newValues</span>&nbsp;<span class="op" id="3538916">=</span>&nbsp;<span class="builtinfunc" id="3538918">make</span><span class="op" id="3538922">(</span><span class="ident" id="3538923">url</span><span class="op" id="3538926">.</span><span class="ident" id="3538927">Values</span><span class="op" id="3538933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3538937">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538941">if</span>&nbsp;<span class="ident" id="3538944">r</span><span class="op" id="3538945">.</span><span class="ident" id="3538946">Form</span>&nbsp;<span class="op" id="3538951">==</span>&nbsp;<span class="builtintype" id="3538954">nil</span>&nbsp;<span class="op" id="3538958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538963">r</span><span class="op" id="3538964">.</span><span class="ident" id="3538965">Form</span>&nbsp;<span class="op" id="3538970">=</span>&nbsp;<span class="ident" id="3538972">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3538984">}</span>&nbsp;<span class="keyword" id="3538986">else</span>&nbsp;<span class="op" id="3538991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538996">copyValues</span><span class="op" id="3539006">(</span><span class="ident" id="3539007">r</span><span class="op" id="3539008">.</span><span class="ident" id="3539009">Form</span><span class="op" id="3539013">,</span>&nbsp;<span class="ident" id="3539015">newValues</span><span class="op" id="3539024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3539028">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3539031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539034">return</span>&nbsp;<span class="ident" id="3539041">err</span><br>
<span class="lineno"></span><span class="op" id="3539045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3539048">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="3539116">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3539192">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3539261">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3539289">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="3539341">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="3539415">func</span>&nbsp;<span class="op" id="3539420">(</span><span class="ident" id="3539421">r</span>&nbsp;<span class="op" id="3539423">*</span><span class="ident" id="3539424">Request</span><span class="op" id="3539431">)</span>&nbsp;<span class="ident" id="3539433">ParseMultipartForm</span><span class="op" id="3539451">(</span><span class="ident" id="3539452">maxMemory</span>&nbsp;<span class="builtintype" id="3539462">int64</span><span class="op" id="3539467">)</span>&nbsp;<span class="builtintype" id="3539469">error</span>&nbsp;<span class="op" id="3539475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539478">if</span>&nbsp;<span class="ident" id="3539481">r</span><span class="op" id="3539482">.</span><span class="ident" id="3539483">MultipartForm</span>&nbsp;<span class="op" id="3539497">==</span>&nbsp;<span class="ident" id="3539500">multipartByReader</span>&nbsp;<span class="op" id="3539518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539522">return</span>&nbsp;<span class="ident" id="3539529">errors</span><span class="op" id="3539535">.</span><span class="ident" id="3539536">New</span><span class="op" id="3539539">(</span><span class="string" id="3539540">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3539584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3539587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539590">if</span>&nbsp;<span class="ident" id="3539593">r</span><span class="op" id="3539594">.</span><span class="ident" id="3539595">Form</span>&nbsp;<span class="op" id="3539600">==</span>&nbsp;<span class="builtintype" id="3539603">nil</span>&nbsp;<span class="op" id="3539607">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539611">err</span>&nbsp;<span class="op" id="3539615">:=</span>&nbsp;<span class="ident" id="3539618">r</span><span class="op" id="3539619">.</span><span class="ident" id="3539620">ParseForm</span><span class="op" id="3539629">(</span><span class="op" id="3539630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539634">if</span>&nbsp;<span class="ident" id="3539637">err</span>&nbsp;<span class="op" id="3539641">!=</span>&nbsp;<span class="builtintype" id="3539644">nil</span>&nbsp;<span class="op" id="3539648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539653">return</span>&nbsp;<span class="ident" id="3539660">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3539666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3539669">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539672">if</span>&nbsp;<span class="ident" id="3539675">r</span><span class="op" id="3539676">.</span><span class="ident" id="3539677">MultipartForm</span>&nbsp;<span class="op" id="3539691">!=</span>&nbsp;<span class="builtintype" id="3539694">nil</span>&nbsp;<span class="op" id="3539698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539702">return</span>&nbsp;<span class="builtintype" id="3539709">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3539714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539718">mr</span><span class="op" id="3539720">,</span>&nbsp;<span class="ident" id="3539722">err</span>&nbsp;<span class="op" id="3539726">:=</span>&nbsp;<span class="ident" id="3539729">r</span><span class="op" id="3539730">.</span><span class="ident" id="3539731">multipartReader</span><span class="op" id="3539746">(</span><span class="op" id="3539747">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539750">if</span>&nbsp;<span class="ident" id="3539753">err</span>&nbsp;<span class="op" id="3539757">!=</span>&nbsp;<span class="builtintype" id="3539760">nil</span>&nbsp;<span class="op" id="3539764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539768">return</span>&nbsp;<span class="ident" id="3539775">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3539780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539784">f</span><span class="op" id="3539785">,</span>&nbsp;<span class="ident" id="3539787">err</span>&nbsp;<span class="op" id="3539791">:=</span>&nbsp;<span class="ident" id="3539794">mr</span><span class="op" id="3539796">.</span><span class="ident" id="3539797">ReadForm</span><span class="op" id="3539805">(</span><span class="ident" id="3539806">maxMemory</span><span class="op" id="3539815">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539818">if</span>&nbsp;<span class="ident" id="3539821">err</span>&nbsp;<span class="op" id="3539825">!=</span>&nbsp;<span class="builtintype" id="3539828">nil</span>&nbsp;<span class="op" id="3539832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539836">return</span>&nbsp;<span class="ident" id="3539843">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3539848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539851">for</span>&nbsp;<span class="ident" id="3539855">k</span><span class="op" id="3539856">,</span>&nbsp;<span class="ident" id="3539858">v</span>&nbsp;<span class="op" id="3539860">:=</span>&nbsp;<span class="keyword" id="3539863">range</span>&nbsp;<span class="ident" id="3539869">f</span><span class="op" id="3539870">.</span><span class="ident" id="3539871">Value</span>&nbsp;<span class="op" id="3539877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539881">r</span><span class="op" id="3539882">.</span><span class="ident" id="3539883">Form</span><span class="op" id="3539887">[</span><span class="ident" id="3539888">k</span><span class="op" id="3539889">]</span>&nbsp;<span class="op" id="3539891">=</span>&nbsp;<span class="builtinfunc" id="3539893">append</span><span class="op" id="3539899">(</span><span class="ident" id="3539900">r</span><span class="op" id="3539901">.</span><span class="ident" id="3539902">Form</span><span class="op" id="3539906">[</span><span class="ident" id="3539907">k</span><span class="op" id="3539908">]</span><span class="op" id="3539909">,</span>&nbsp;<span class="ident" id="3539911">v</span><span class="op" id="3539912">...</span><span class="op" id="3539915">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3539918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539921">r</span><span class="op" id="3539922">.</span><span class="ident" id="3539923">MultipartForm</span>&nbsp;<span class="op" id="3539937">=</span>&nbsp;<span class="ident" id="3539939">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3539943">return</span>&nbsp;<span class="builtintype" id="3539950">nil</span><br>
<span class="lineno"></span><span class="op" id="3539954">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="3539957">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="3540032">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3540110">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="3540187">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="3540230">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3540295">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3540334">func</span>&nbsp;<span class="op" id="3540339">(</span><span class="ident" id="3540340">r</span>&nbsp;<span class="op" id="3540342">*</span><span class="ident" id="3540343">Request</span><span class="op" id="3540350">)</span>&nbsp;<span class="ident" id="3540352">FormValue</span><span class="op" id="3540361">(</span><span class="ident" id="3540362">key</span>&nbsp;<span class="builtintype" id="3540366">string</span><span class="op" id="3540372">)</span>&nbsp;<span class="builtintype" id="3540374">string</span>&nbsp;<span class="op" id="3540381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3540384">if</span>&nbsp;<span class="ident" id="3540387">r</span><span class="op" id="3540388">.</span><span class="ident" id="3540389">Form</span>&nbsp;<span class="op" id="3540394">==</span>&nbsp;<span class="builtintype" id="3540397">nil</span>&nbsp;<span class="op" id="3540401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540405">r</span><span class="op" id="3540406">.</span><span class="ident" id="3540407">ParseMultipartForm</span><span class="op" id="3540425">(</span><span class="ident" id="3540426">defaultMaxMemory</span><span class="op" id="3540442">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3540445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3540448">if</span>&nbsp;<span class="ident" id="3540451">vs</span>&nbsp;<span class="op" id="3540454">:=</span>&nbsp;<span class="ident" id="3540457">r</span><span class="op" id="3540458">.</span><span class="ident" id="3540459">Form</span><span class="op" id="3540463">[</span><span class="ident" id="3540464">key</span><span class="op" id="3540467">]</span><span class="op" id="3540468">;</span>&nbsp;<span class="builtinfunc" id="3540470">len</span><span class="op" id="3540473">(</span><span class="ident" id="3540474">vs</span><span class="op" id="3540476">)</span>&nbsp;<span class="op" id="3540478">&gt;</span>&nbsp;<span class="num" id="3540480">0</span>&nbsp;<span class="op" id="3540482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3540486">return</span>&nbsp;<span class="ident" id="3540493">vs</span><span class="op" id="3540495">[</span><span class="num" id="3540496">0</span><span class="op" id="3540497">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3540500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3540503">return</span>&nbsp;<span class="string" id="3540510">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="3540513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3540516">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="3540593">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3540651">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="3540732">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="3540775">func</span>&nbsp;<span class="op" id="3540780">(</span><span class="ident" id="3540781">r</span>&nbsp;<span class="op" id="3540783">*</span><span class="ident" id="3540784">Request</span><span class="op" id="3540791">)</span>&nbsp;<span class="ident" id="3540793">PostFormValue</span><span class="op" id="3540806">(</span><span class="ident" id="3540807">key</span>&nbsp;<span class="builtintype" id="3540811">string</span><span class="op" id="3540817">)</span>&nbsp;<span class="builtintype" id="3540819">string</span>&nbsp;<span class="op" id="3540826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3540829">if</span>&nbsp;<span class="ident" id="3540832">r</span><span class="op" id="3540833">.</span><span class="ident" id="3540834">PostForm</span>&nbsp;<span class="op" id="3540843">==</span>&nbsp;<span class="builtintype" id="3540846">nil</span>&nbsp;<span class="op" id="3540850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540854">r</span><span class="op" id="3540855">.</span><span class="ident" id="3540856">ParseMultipartForm</span><span class="op" id="3540874">(</span><span class="ident" id="3540875">defaultMaxMemory</span><span class="op" id="3540891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3540894">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3540897">if</span>&nbsp;<span class="ident" id="3540900">vs</span>&nbsp;<span class="op" id="3540903">:=</span>&nbsp;<span class="ident" id="3540906">r</span><span class="op" id="3540907">.</span><span class="ident" id="3540908">PostForm</span><span class="op" id="3540916">[</span><span class="ident" id="3540917">key</span><span class="op" id="3540920">]</span><span class="op" id="3540921">;</span>&nbsp;<span class="builtinfunc" id="3540923">len</span><span class="op" id="3540926">(</span><span class="ident" id="3540927">vs</span><span class="op" id="3540929">)</span>&nbsp;<span class="op" id="3540931">&gt;</span>&nbsp;<span class="num" id="3540933">0</span>&nbsp;<span class="op" id="3540935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3540939">return</span>&nbsp;<span class="ident" id="3540946">vs</span><span class="op" id="3540948">[</span><span class="num" id="3540949">0</span><span class="op" id="3540950">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3540953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3540956">return</span>&nbsp;<span class="string" id="3540963">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3540966">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="3540969">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3541031">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="3541096">func</span>&nbsp;<span class="op" id="3541101">(</span><span class="ident" id="3541102">r</span>&nbsp;<span class="op" id="3541104">*</span><span class="ident" id="3541105">Request</span><span class="op" id="3541112">)</span>&nbsp;<span class="ident" id="3541114">FormFile</span><span class="op" id="3541122">(</span><span class="ident" id="3541123">key</span>&nbsp;<span class="builtintype" id="3541127">string</span><span class="op" id="3541133">)</span>&nbsp;<span class="op" id="3541135">(</span><span class="ident" id="3541136">multipart</span><span class="op" id="3541145">.</span><span class="ident" id="3541146">File</span><span class="op" id="3541150">,</span>&nbsp;<span class="op" id="3541152">*</span><span class="ident" id="3541153">multipart</span><span class="op" id="3541162">.</span><span class="ident" id="3541163">FileHeader</span><span class="op" id="3541173">,</span>&nbsp;<span class="builtintype" id="3541175">error</span><span class="op" id="3541180">)</span>&nbsp;<span class="op" id="3541182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541185">if</span>&nbsp;<span class="ident" id="3541188">r</span><span class="op" id="3541189">.</span><span class="ident" id="3541190">MultipartForm</span>&nbsp;<span class="op" id="3541204">==</span>&nbsp;<span class="ident" id="3541207">multipartByReader</span>&nbsp;<span class="op" id="3541225">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541229">return</span>&nbsp;<span class="builtintype" id="3541236">nil</span><span class="op" id="3541239">,</span>&nbsp;<span class="builtintype" id="3541241">nil</span><span class="op" id="3541244">,</span>&nbsp;<span class="ident" id="3541246">errors</span><span class="op" id="3541252">.</span><span class="ident" id="3541253">New</span><span class="op" id="3541256">(</span><span class="string" id="3541257">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3541301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3541304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541307">if</span>&nbsp;<span class="ident" id="3541310">r</span><span class="op" id="3541311">.</span><span class="ident" id="3541312">MultipartForm</span>&nbsp;<span class="op" id="3541326">==</span>&nbsp;<span class="builtintype" id="3541329">nil</span>&nbsp;<span class="op" id="3541333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541337">err</span>&nbsp;<span class="op" id="3541341">:=</span>&nbsp;<span class="ident" id="3541344">r</span><span class="op" id="3541345">.</span><span class="ident" id="3541346">ParseMultipartForm</span><span class="op" id="3541364">(</span><span class="ident" id="3541365">defaultMaxMemory</span><span class="op" id="3541381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541385">if</span>&nbsp;<span class="ident" id="3541388">err</span>&nbsp;<span class="op" id="3541392">!=</span>&nbsp;<span class="builtintype" id="3541395">nil</span>&nbsp;<span class="op" id="3541399">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541404">return</span>&nbsp;<span class="builtintype" id="3541411">nil</span><span class="op" id="3541414">,</span>&nbsp;<span class="builtintype" id="3541416">nil</span><span class="op" id="3541419">,</span>&nbsp;<span class="ident" id="3541421">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3541427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3541430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541433">if</span>&nbsp;<span class="ident" id="3541436">r</span><span class="op" id="3541437">.</span><span class="ident" id="3541438">MultipartForm</span>&nbsp;<span class="op" id="3541452">!=</span>&nbsp;<span class="builtintype" id="3541455">nil</span>&nbsp;<span class="op" id="3541459">&amp;&amp;</span>&nbsp;<span class="ident" id="3541462">r</span><span class="op" id="3541463">.</span><span class="ident" id="3541464">MultipartForm</span><span class="op" id="3541477">.</span><span class="ident" id="3541478">File</span>&nbsp;<span class="op" id="3541483">!=</span>&nbsp;<span class="builtintype" id="3541486">nil</span>&nbsp;<span class="op" id="3541490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541494">if</span>&nbsp;<span class="ident" id="3541497">fhs</span>&nbsp;<span class="op" id="3541501">:=</span>&nbsp;<span class="ident" id="3541504">r</span><span class="op" id="3541505">.</span><span class="ident" id="3541506">MultipartForm</span><span class="op" id="3541519">.</span><span class="ident" id="3541520">File</span><span class="op" id="3541524">[</span><span class="ident" id="3541525">key</span><span class="op" id="3541528">]</span><span class="op" id="3541529">;</span>&nbsp;<span class="builtinfunc" id="3541531">len</span><span class="op" id="3541534">(</span><span class="ident" id="3541535">fhs</span><span class="op" id="3541538">)</span>&nbsp;<span class="op" id="3541540">&gt;</span>&nbsp;<span class="num" id="3541542">0</span>&nbsp;<span class="op" id="3541544">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541549">f</span><span class="op" id="3541550">,</span>&nbsp;<span class="ident" id="3541552">err</span>&nbsp;<span class="op" id="3541556">:=</span>&nbsp;<span class="ident" id="3541559">fhs</span><span class="op" id="3541562">[</span><span class="num" id="3541563">0</span><span class="op" id="3541564">]</span><span class="op" id="3541565">.</span><span class="ident" id="3541566">Open</span><span class="op" id="3541570">(</span><span class="op" id="3541571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541576">return</span>&nbsp;<span class="ident" id="3541583">f</span><span class="op" id="3541584">,</span>&nbsp;<span class="ident" id="3541586">fhs</span><span class="op" id="3541589">[</span><span class="num" id="3541590">0</span><span class="op" id="3541591">]</span><span class="op" id="3541592">,</span>&nbsp;<span class="ident" id="3541594">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3541600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3541603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541606">return</span>&nbsp;<span class="builtintype" id="3541613">nil</span><span class="op" id="3541616">,</span>&nbsp;<span class="builtintype" id="3541618">nil</span><span class="op" id="3541621">,</span>&nbsp;<span class="ident" id="3541623">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="3541638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3541641">func</span>&nbsp;<span class="op" id="3541646">(</span><span class="ident" id="3541647">r</span>&nbsp;<span class="op" id="3541649">*</span><span class="ident" id="3541650">Request</span><span class="op" id="3541657">)</span>&nbsp;<span class="ident" id="3541659">expectsContinue</span><span class="op" id="3541674">(</span><span class="op" id="3541675">)</span>&nbsp;<span class="builtintype" id="3541677">bool</span>&nbsp;<span class="op" id="3541682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541685">return</span>&nbsp;<span class="ident" id="3541692">hasToken</span><span class="op" id="3541700">(</span><span class="ident" id="3541701">r</span><span class="op" id="3541702">.</span><span class="ident" id="3541703">Header</span><span class="op" id="3541709">.</span><span class="ident" id="3541710">get</span><span class="op" id="3541713">(</span><span class="string" id="3541714">&#34;Expect&#34;</span><span class="op" id="3541722">)</span><span class="op" id="3541723">,</span>&nbsp;<span class="string" id="3541725">&#34;100-continue&#34;</span><span class="op" id="3541739">)</span><br>
<span class="lineno"></span><span class="op" id="3541741">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="3541744">func</span>&nbsp;<span class="op" id="3541749">(</span><span class="ident" id="3541750">r</span>&nbsp;<span class="op" id="3541752">*</span><span class="ident" id="3541753">Request</span><span class="op" id="3541760">)</span>&nbsp;<span class="ident" id="3541762">wantsHttp10KeepAlive</span><span class="op" id="3541782">(</span><span class="op" id="3541783">)</span>&nbsp;<span class="builtintype" id="3541785">bool</span>&nbsp;<span class="op" id="3541790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541793">if</span>&nbsp;<span class="ident" id="3541796">r</span><span class="op" id="3541797">.</span><span class="ident" id="3541798">ProtoMajor</span>&nbsp;<span class="op" id="3541809">!=</span>&nbsp;<span class="num" id="3541812">1</span>&nbsp;<span class="op" id="3541814">||</span>&nbsp;<span class="ident" id="3541817">r</span><span class="op" id="3541818">.</span><span class="ident" id="3541819">ProtoMinor</span>&nbsp;<span class="op" id="3541830">!=</span>&nbsp;<span class="num" id="3541833">0</span>&nbsp;<span class="op" id="3541835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541839">return</span>&nbsp;<span class="builtintype" id="3541846">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3541853">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541856">return</span>&nbsp;<span class="ident" id="3541863">hasToken</span><span class="op" id="3541871">(</span><span class="ident" id="3541872">r</span><span class="op" id="3541873">.</span><span class="ident" id="3541874">Header</span><span class="op" id="3541880">.</span><span class="ident" id="3541881">get</span><span class="op" id="3541884">(</span><span class="string" id="3541885">&#34;Connection&#34;</span><span class="op" id="3541897">)</span><span class="op" id="3541898">,</span>&nbsp;<span class="string" id="3541900">&#34;keep-alive&#34;</span><span class="op" id="3541912">)</span><br>
<span class="lineno"></span><span class="op" id="3541914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3541917">func</span>&nbsp;<span class="op" id="3541922">(</span><span class="ident" id="3541923">r</span>&nbsp;<span class="op" id="3541925">*</span><span class="ident" id="3541926">Request</span><span class="op" id="3541933">)</span>&nbsp;<span class="ident" id="3541935">wantsClose</span><span class="op" id="3541945">(</span><span class="op" id="3541946">)</span>&nbsp;<span class="builtintype" id="3541948">bool</span>&nbsp;<span class="op" id="3541953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3541956">return</span>&nbsp;<span class="ident" id="3541963">hasToken</span><span class="op" id="3541971">(</span><span class="ident" id="3541972">r</span><span class="op" id="3541973">.</span><span class="ident" id="3541974">Header</span><span class="op" id="3541980">.</span><span class="ident" id="3541981">get</span><span class="op" id="3541984">(</span><span class="string" id="3541985">&#34;Connection&#34;</span><span class="op" id="3541997">)</span><span class="op" id="3541998">,</span>&nbsp;<span class="string" id="3542000">&#34;close&#34;</span><span class="op" id="3542007">)</span><br>
<span class="lineno">915</span><span class="op" id="3542009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3542012">func</span>&nbsp;<span class="op" id="3542017">(</span><span class="ident" id="3542018">r</span>&nbsp;<span class="op" id="3542020">*</span><span class="ident" id="3542021">Request</span><span class="op" id="3542028">)</span>&nbsp;<span class="ident" id="3542030">closeBody</span><span class="op" id="3542039">(</span><span class="op" id="3542040">)</span>&nbsp;<span class="op" id="3542042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3542045">if</span>&nbsp;<span class="ident" id="3542048">r</span><span class="op" id="3542049">.</span><span class="ident" id="3542050">Body</span>&nbsp;<span class="op" id="3542055">!=</span>&nbsp;<span class="builtintype" id="3542058">nil</span>&nbsp;<span class="op" id="3542062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542066">r</span><span class="op" id="3542067">.</span><span class="ident" id="3542068">Body</span><span class="op" id="3542072">.</span><span class="ident" id="3542073">Close</span><span class="op" id="3542078">(</span><span class="op" id="3542079">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3542082">}</span><br>
<span class="lineno"></span><span class="op" id="3542084">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
