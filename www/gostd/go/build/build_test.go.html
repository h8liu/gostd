<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/build</h2>
<ul>
<li><a href="/gostd/go/build/build.go.html">build.go</a></li>
<li><a href="/gostd/go/build/build_test.go.html">build_test.go</a></li>
<li><a href="/gostd/go/build/deps_test.go.html">deps_test.go</a></li>
<li><a href="/gostd/go/build/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/build/read.go.html">read.go</a></li>
<li><a href="/gostd/go/build/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/go/build/syslist.go.html">syslist.go</a></li>
<li><a href="/gostd/go/build/syslist_test.go.html">syslist_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6897867">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6897923">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6897977">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6898028">package</span>&nbsp;<span class="ident" id="6898036">build</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6898043">import</span>&nbsp;<span class="op" id="6898050">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6898053">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6898059">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6898065">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6898082">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6898093">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6898104">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6898115">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6898125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6898128">func</span>&nbsp;<span class="ident" id="6898133">TestMatch</span><span class="op" id="6898142">(</span><span class="ident" id="6898143">t</span>&nbsp;<span class="op" id="6898145">*</span><span class="ident" id="6898146">testing</span><span class="op" id="6898153">.</span><span class="ident" id="6898154">T</span><span class="op" id="6898155">)</span>&nbsp;<span class="op" id="6898157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898160">ctxt</span>&nbsp;<span class="op" id="6898165">:=</span>&nbsp;<span class="ident" id="6898168">Default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898177">what</span>&nbsp;<span class="op" id="6898182">:=</span>&nbsp;<span class="string" id="6898185">&#34;default&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898196">match</span>&nbsp;<span class="op" id="6898202">:=</span>&nbsp;<span class="keyword" id="6898205">func</span><span class="op" id="6898209">(</span><span class="ident" id="6898210">tag</span>&nbsp;<span class="builtintype" id="6898214">string</span><span class="op" id="6898220">,</span>&nbsp;<span class="ident" id="6898222">want</span>&nbsp;<span class="keyword" id="6898227">map</span><span class="op" id="6898230">[</span><span class="builtintype" id="6898231">string</span><span class="op" id="6898237">]</span><span class="builtintype" id="6898238">bool</span><span class="op" id="6898242">)</span>&nbsp;<span class="op" id="6898244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898248">m</span>&nbsp;<span class="op" id="6898250">:=</span>&nbsp;<span class="builtinfunc" id="6898253">make</span><span class="op" id="6898257">(</span><span class="keyword" id="6898258">map</span><span class="op" id="6898261">[</span><span class="builtintype" id="6898262">string</span><span class="op" id="6898268">]</span><span class="builtintype" id="6898269">bool</span><span class="op" id="6898273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898277">if</span>&nbsp;<span class="op" id="6898280">!</span><span class="ident" id="6898281">ctxt</span><span class="op" id="6898285">.</span><span class="ident" id="6898286">match</span><span class="op" id="6898291">(</span><span class="ident" id="6898292">tag</span><span class="op" id="6898295">,</span>&nbsp;<span class="ident" id="6898297">m</span><span class="op" id="6898298">)</span>&nbsp;<span class="op" id="6898300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898305">t</span><span class="op" id="6898306">.</span><span class="ident" id="6898307">Errorf</span><span class="op" id="6898313">(</span><span class="string" id="6898314">&#34;%s&nbsp;context&nbsp;should&nbsp;match&nbsp;%s,&nbsp;does&nbsp;not&#34;</span><span class="op" id="6898352">,</span>&nbsp;<span class="ident" id="6898354">what</span><span class="op" id="6898358">,</span>&nbsp;<span class="ident" id="6898360">tag</span><span class="op" id="6898363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6898367">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898371">if</span>&nbsp;<span class="op" id="6898374">!</span><span class="ident" id="6898375">reflect</span><span class="op" id="6898382">.</span><span class="ident" id="6898383">DeepEqual</span><span class="op" id="6898392">(</span><span class="ident" id="6898393">m</span><span class="op" id="6898394">,</span>&nbsp;<span class="ident" id="6898396">want</span><span class="op" id="6898400">)</span>&nbsp;<span class="op" id="6898402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898407">t</span><span class="op" id="6898408">.</span><span class="ident" id="6898409">Errorf</span><span class="op" id="6898415">(</span><span class="string" id="6898416">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6898439">,</span>&nbsp;<span class="ident" id="6898441">tag</span><span class="op" id="6898444">,</span>&nbsp;<span class="ident" id="6898446">m</span><span class="op" id="6898447">,</span>&nbsp;<span class="ident" id="6898449">want</span><span class="op" id="6898453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6898457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6898460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898463">nomatch</span>&nbsp;<span class="op" id="6898471">:=</span>&nbsp;<span class="keyword" id="6898474">func</span><span class="op" id="6898478">(</span><span class="ident" id="6898479">tag</span>&nbsp;<span class="builtintype" id="6898483">string</span><span class="op" id="6898489">,</span>&nbsp;<span class="ident" id="6898491">want</span>&nbsp;<span class="keyword" id="6898496">map</span><span class="op" id="6898499">[</span><span class="builtintype" id="6898500">string</span><span class="op" id="6898506">]</span><span class="builtintype" id="6898507">bool</span><span class="op" id="6898511">)</span>&nbsp;<span class="op" id="6898513">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898517">m</span>&nbsp;<span class="op" id="6898519">:=</span>&nbsp;<span class="builtinfunc" id="6898522">make</span><span class="op" id="6898526">(</span><span class="keyword" id="6898527">map</span><span class="op" id="6898530">[</span><span class="builtintype" id="6898531">string</span><span class="op" id="6898537">]</span><span class="builtintype" id="6898538">bool</span><span class="op" id="6898542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898546">if</span>&nbsp;<span class="ident" id="6898549">ctxt</span><span class="op" id="6898553">.</span><span class="ident" id="6898554">match</span><span class="op" id="6898559">(</span><span class="ident" id="6898560">tag</span><span class="op" id="6898563">,</span>&nbsp;<span class="ident" id="6898565">m</span><span class="op" id="6898566">)</span>&nbsp;<span class="op" id="6898568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898573">t</span><span class="op" id="6898574">.</span><span class="ident" id="6898575">Errorf</span><span class="op" id="6898581">(</span><span class="string" id="6898582">&#34;%s&nbsp;context&nbsp;should&nbsp;NOT&nbsp;match&nbsp;%s,&nbsp;does&#34;</span><span class="op" id="6898620">,</span>&nbsp;<span class="ident" id="6898622">what</span><span class="op" id="6898626">,</span>&nbsp;<span class="ident" id="6898628">tag</span><span class="op" id="6898631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6898635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6898639">if</span>&nbsp;<span class="op" id="6898642">!</span><span class="ident" id="6898643">reflect</span><span class="op" id="6898650">.</span><span class="ident" id="6898651">DeepEqual</span><span class="op" id="6898660">(</span><span class="ident" id="6898661">m</span><span class="op" id="6898662">,</span>&nbsp;<span class="ident" id="6898664">want</span><span class="op" id="6898668">)</span>&nbsp;<span class="op" id="6898670">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898675">t</span><span class="op" id="6898676">.</span><span class="ident" id="6898677">Errorf</span><span class="op" id="6898683">(</span><span class="string" id="6898684">&#34;%s&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6898707">,</span>&nbsp;<span class="ident" id="6898709">tag</span><span class="op" id="6898712">,</span>&nbsp;<span class="ident" id="6898714">m</span><span class="op" id="6898715">,</span>&nbsp;<span class="ident" id="6898717">want</span><span class="op" id="6898721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6898725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6898728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898732">match</span><span class="op" id="6898737">(</span><span class="ident" id="6898738">runtime</span><span class="op" id="6898745">.</span><span class="ident" id="6898746">GOOS</span><span class="op" id="6898750">+</span><span class="string" id="6898751">&#34;,&#34;</span><span class="op" id="6898754">+</span><span class="ident" id="6898755">runtime</span><span class="op" id="6898762">.</span><span class="ident" id="6898763">GOARCH</span><span class="op" id="6898769">,</span>&nbsp;<span class="keyword" id="6898771">map</span><span class="op" id="6898774">[</span><span class="builtintype" id="6898775">string</span><span class="op" id="6898781">]</span><span class="builtintype" id="6898782">bool</span><span class="op" id="6898786">{</span><span class="ident" id="6898787">runtime</span><span class="op" id="6898794">.</span><span class="ident" id="6898795">GOOS</span><span class="op" id="6898799">:</span>&nbsp;<span class="builtintype" id="6898801">true</span><span class="op" id="6898805">,</span>&nbsp;<span class="ident" id="6898807">runtime</span><span class="op" id="6898814">.</span><span class="ident" id="6898815">GOARCH</span><span class="op" id="6898821">:</span>&nbsp;<span class="builtintype" id="6898823">true</span><span class="op" id="6898827">}</span><span class="op" id="6898828">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898831">match</span><span class="op" id="6898836">(</span><span class="ident" id="6898837">runtime</span><span class="op" id="6898844">.</span><span class="ident" id="6898845">GOOS</span><span class="op" id="6898849">+</span><span class="string" id="6898850">&#34;,&#34;</span><span class="op" id="6898853">+</span><span class="ident" id="6898854">runtime</span><span class="op" id="6898861">.</span><span class="ident" id="6898862">GOARCH</span><span class="op" id="6898868">+</span><span class="string" id="6898869">&#34;,!foo&#34;</span><span class="op" id="6898876">,</span>&nbsp;<span class="keyword" id="6898878">map</span><span class="op" id="6898881">[</span><span class="builtintype" id="6898882">string</span><span class="op" id="6898888">]</span><span class="builtintype" id="6898889">bool</span><span class="op" id="6898893">{</span><span class="ident" id="6898894">runtime</span><span class="op" id="6898901">.</span><span class="ident" id="6898902">GOOS</span><span class="op" id="6898906">:</span>&nbsp;<span class="builtintype" id="6898908">true</span><span class="op" id="6898912">,</span>&nbsp;<span class="ident" id="6898914">runtime</span><span class="op" id="6898921">.</span><span class="ident" id="6898922">GOARCH</span><span class="op" id="6898928">:</span>&nbsp;<span class="builtintype" id="6898930">true</span><span class="op" id="6898934">,</span>&nbsp;<span class="string" id="6898936">&#34;foo&#34;</span><span class="op" id="6898941">:</span>&nbsp;<span class="builtintype" id="6898943">true</span><span class="op" id="6898947">}</span><span class="op" id="6898948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6898951">nomatch</span><span class="op" id="6898958">(</span><span class="ident" id="6898959">runtime</span><span class="op" id="6898966">.</span><span class="ident" id="6898967">GOOS</span><span class="op" id="6898971">+</span><span class="string" id="6898972">&#34;,&#34;</span><span class="op" id="6898975">+</span><span class="ident" id="6898976">runtime</span><span class="op" id="6898983">.</span><span class="ident" id="6898984">GOARCH</span><span class="op" id="6898990">+</span><span class="string" id="6898991">&#34;,foo&#34;</span><span class="op" id="6898997">,</span>&nbsp;<span class="keyword" id="6898999">map</span><span class="op" id="6899002">[</span><span class="builtintype" id="6899003">string</span><span class="op" id="6899009">]</span><span class="builtintype" id="6899010">bool</span><span class="op" id="6899014">{</span><span class="ident" id="6899015">runtime</span><span class="op" id="6899022">.</span><span class="ident" id="6899023">GOOS</span><span class="op" id="6899027">:</span>&nbsp;<span class="builtintype" id="6899029">true</span><span class="op" id="6899033">,</span>&nbsp;<span class="ident" id="6899035">runtime</span><span class="op" id="6899042">.</span><span class="ident" id="6899043">GOARCH</span><span class="op" id="6899049">:</span>&nbsp;<span class="builtintype" id="6899051">true</span><span class="op" id="6899055">,</span>&nbsp;<span class="string" id="6899057">&#34;foo&#34;</span><span class="op" id="6899062">:</span>&nbsp;<span class="builtintype" id="6899064">true</span><span class="op" id="6899068">}</span><span class="op" id="6899069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899073">what</span>&nbsp;<span class="op" id="6899078">=</span>&nbsp;<span class="string" id="6899080">&#34;modified&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899092">ctxt</span><span class="op" id="6899096">.</span><span class="ident" id="6899097">BuildTags</span>&nbsp;<span class="op" id="6899107">=</span>&nbsp;<span class="op" id="6899109">[</span><span class="op" id="6899110">]</span><span class="builtintype" id="6899111">string</span><span class="op" id="6899117">{</span><span class="string" id="6899118">&#34;foo&#34;</span><span class="op" id="6899123">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899126">match</span><span class="op" id="6899131">(</span><span class="ident" id="6899132">runtime</span><span class="op" id="6899139">.</span><span class="ident" id="6899140">GOOS</span><span class="op" id="6899144">+</span><span class="string" id="6899145">&#34;,&#34;</span><span class="op" id="6899148">+</span><span class="ident" id="6899149">runtime</span><span class="op" id="6899156">.</span><span class="ident" id="6899157">GOARCH</span><span class="op" id="6899163">,</span>&nbsp;<span class="keyword" id="6899165">map</span><span class="op" id="6899168">[</span><span class="builtintype" id="6899169">string</span><span class="op" id="6899175">]</span><span class="builtintype" id="6899176">bool</span><span class="op" id="6899180">{</span><span class="ident" id="6899181">runtime</span><span class="op" id="6899188">.</span><span class="ident" id="6899189">GOOS</span><span class="op" id="6899193">:</span>&nbsp;<span class="builtintype" id="6899195">true</span><span class="op" id="6899199">,</span>&nbsp;<span class="ident" id="6899201">runtime</span><span class="op" id="6899208">.</span><span class="ident" id="6899209">GOARCH</span><span class="op" id="6899215">:</span>&nbsp;<span class="builtintype" id="6899217">true</span><span class="op" id="6899221">}</span><span class="op" id="6899222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899225">match</span><span class="op" id="6899230">(</span><span class="ident" id="6899231">runtime</span><span class="op" id="6899238">.</span><span class="ident" id="6899239">GOOS</span><span class="op" id="6899243">+</span><span class="string" id="6899244">&#34;,&#34;</span><span class="op" id="6899247">+</span><span class="ident" id="6899248">runtime</span><span class="op" id="6899255">.</span><span class="ident" id="6899256">GOARCH</span><span class="op" id="6899262">+</span><span class="string" id="6899263">&#34;,foo&#34;</span><span class="op" id="6899269">,</span>&nbsp;<span class="keyword" id="6899271">map</span><span class="op" id="6899274">[</span><span class="builtintype" id="6899275">string</span><span class="op" id="6899281">]</span><span class="builtintype" id="6899282">bool</span><span class="op" id="6899286">{</span><span class="ident" id="6899287">runtime</span><span class="op" id="6899294">.</span><span class="ident" id="6899295">GOOS</span><span class="op" id="6899299">:</span>&nbsp;<span class="builtintype" id="6899301">true</span><span class="op" id="6899305">,</span>&nbsp;<span class="ident" id="6899307">runtime</span><span class="op" id="6899314">.</span><span class="ident" id="6899315">GOARCH</span><span class="op" id="6899321">:</span>&nbsp;<span class="builtintype" id="6899323">true</span><span class="op" id="6899327">,</span>&nbsp;<span class="string" id="6899329">&#34;foo&#34;</span><span class="op" id="6899334">:</span>&nbsp;<span class="builtintype" id="6899336">true</span><span class="op" id="6899340">}</span><span class="op" id="6899341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899344">nomatch</span><span class="op" id="6899351">(</span><span class="ident" id="6899352">runtime</span><span class="op" id="6899359">.</span><span class="ident" id="6899360">GOOS</span><span class="op" id="6899364">+</span><span class="string" id="6899365">&#34;,&#34;</span><span class="op" id="6899368">+</span><span class="ident" id="6899369">runtime</span><span class="op" id="6899376">.</span><span class="ident" id="6899377">GOARCH</span><span class="op" id="6899383">+</span><span class="string" id="6899384">&#34;,!foo&#34;</span><span class="op" id="6899391">,</span>&nbsp;<span class="keyword" id="6899393">map</span><span class="op" id="6899396">[</span><span class="builtintype" id="6899397">string</span><span class="op" id="6899403">]</span><span class="builtintype" id="6899404">bool</span><span class="op" id="6899408">{</span><span class="ident" id="6899409">runtime</span><span class="op" id="6899416">.</span><span class="ident" id="6899417">GOOS</span><span class="op" id="6899421">:</span>&nbsp;<span class="builtintype" id="6899423">true</span><span class="op" id="6899427">,</span>&nbsp;<span class="ident" id="6899429">runtime</span><span class="op" id="6899436">.</span><span class="ident" id="6899437">GOARCH</span><span class="op" id="6899443">:</span>&nbsp;<span class="builtintype" id="6899445">true</span><span class="op" id="6899449">,</span>&nbsp;<span class="string" id="6899451">&#34;foo&#34;</span><span class="op" id="6899456">:</span>&nbsp;<span class="builtintype" id="6899458">true</span><span class="op" id="6899462">}</span><span class="op" id="6899463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899466">match</span><span class="op" id="6899471">(</span><span class="ident" id="6899472">runtime</span><span class="op" id="6899479">.</span><span class="ident" id="6899480">GOOS</span><span class="op" id="6899484">+</span><span class="string" id="6899485">&#34;,&#34;</span><span class="op" id="6899488">+</span><span class="ident" id="6899489">runtime</span><span class="op" id="6899496">.</span><span class="ident" id="6899497">GOARCH</span><span class="op" id="6899503">+</span><span class="string" id="6899504">&#34;,!bar&#34;</span><span class="op" id="6899511">,</span>&nbsp;<span class="keyword" id="6899513">map</span><span class="op" id="6899516">[</span><span class="builtintype" id="6899517">string</span><span class="op" id="6899523">]</span><span class="builtintype" id="6899524">bool</span><span class="op" id="6899528">{</span><span class="ident" id="6899529">runtime</span><span class="op" id="6899536">.</span><span class="ident" id="6899537">GOOS</span><span class="op" id="6899541">:</span>&nbsp;<span class="builtintype" id="6899543">true</span><span class="op" id="6899547">,</span>&nbsp;<span class="ident" id="6899549">runtime</span><span class="op" id="6899556">.</span><span class="ident" id="6899557">GOARCH</span><span class="op" id="6899563">:</span>&nbsp;<span class="builtintype" id="6899565">true</span><span class="op" id="6899569">,</span>&nbsp;<span class="string" id="6899571">&#34;bar&#34;</span><span class="op" id="6899576">:</span>&nbsp;<span class="builtintype" id="6899578">true</span><span class="op" id="6899582">}</span><span class="op" id="6899583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899586">nomatch</span><span class="op" id="6899593">(</span><span class="ident" id="6899594">runtime</span><span class="op" id="6899601">.</span><span class="ident" id="6899602">GOOS</span><span class="op" id="6899606">+</span><span class="string" id="6899607">&#34;,&#34;</span><span class="op" id="6899610">+</span><span class="ident" id="6899611">runtime</span><span class="op" id="6899618">.</span><span class="ident" id="6899619">GOARCH</span><span class="op" id="6899625">+</span><span class="string" id="6899626">&#34;,bar&#34;</span><span class="op" id="6899632">,</span>&nbsp;<span class="keyword" id="6899634">map</span><span class="op" id="6899637">[</span><span class="builtintype" id="6899638">string</span><span class="op" id="6899644">]</span><span class="builtintype" id="6899645">bool</span><span class="op" id="6899649">{</span><span class="ident" id="6899650">runtime</span><span class="op" id="6899657">.</span><span class="ident" id="6899658">GOOS</span><span class="op" id="6899662">:</span>&nbsp;<span class="builtintype" id="6899664">true</span><span class="op" id="6899668">,</span>&nbsp;<span class="ident" id="6899670">runtime</span><span class="op" id="6899677">.</span><span class="ident" id="6899678">GOARCH</span><span class="op" id="6899684">:</span>&nbsp;<span class="builtintype" id="6899686">true</span><span class="op" id="6899690">,</span>&nbsp;<span class="string" id="6899692">&#34;bar&#34;</span><span class="op" id="6899697">:</span>&nbsp;<span class="builtintype" id="6899699">true</span><span class="op" id="6899703">}</span><span class="op" id="6899704">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899707">nomatch</span><span class="op" id="6899714">(</span><span class="string" id="6899715">&#34;!&#34;</span><span class="op" id="6899718">,</span>&nbsp;<span class="keyword" id="6899720">map</span><span class="op" id="6899723">[</span><span class="builtintype" id="6899724">string</span><span class="op" id="6899730">]</span><span class="builtintype" id="6899731">bool</span><span class="op" id="6899735">{</span><span class="op" id="6899736">}</span><span class="op" id="6899737">)</span><br>
<span class="lineno"></span><span class="op" id="6899739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6899742">func</span>&nbsp;<span class="ident" id="6899747">TestDotSlashImport</span><span class="op" id="6899765">(</span><span class="ident" id="6899766">t</span>&nbsp;<span class="op" id="6899768">*</span><span class="ident" id="6899769">testing</span><span class="op" id="6899776">.</span><span class="ident" id="6899777">T</span><span class="op" id="6899778">)</span>&nbsp;<span class="op" id="6899780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899783">p</span><span class="op" id="6899784">,</span>&nbsp;<span class="ident" id="6899786">err</span>&nbsp;<span class="op" id="6899790">:=</span>&nbsp;<span class="ident" id="6899793">ImportDir</span><span class="op" id="6899802">(</span><span class="string" id="6899803">&#34;testdata/other&#34;</span><span class="op" id="6899819">,</span>&nbsp;<span class="num" id="6899821">0</span><span class="op" id="6899822">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6899825">if</span>&nbsp;<span class="ident" id="6899828">err</span>&nbsp;<span class="op" id="6899832">!=</span>&nbsp;<span class="ident" id="6899835">nil</span>&nbsp;<span class="op" id="6899839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899843">t</span><span class="op" id="6899844">.</span><span class="ident" id="6899845">Fatal</span><span class="op" id="6899850">(</span><span class="ident" id="6899851">err</span><span class="op" id="6899854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6899857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6899860">if</span>&nbsp;<span class="builtinfunc" id="6899863">len</span><span class="op" id="6899866">(</span><span class="ident" id="6899867">p</span><span class="op" id="6899868">.</span><span class="ident" id="6899869">Imports</span><span class="op" id="6899876">)</span>&nbsp;<span class="op" id="6899878">!=</span>&nbsp;<span class="num" id="6899881">1</span>&nbsp;<span class="op" id="6899883">||</span>&nbsp;<span class="ident" id="6899886">p</span><span class="op" id="6899887">.</span><span class="ident" id="6899888">Imports</span><span class="op" id="6899895">[</span><span class="num" id="6899896">0</span><span class="op" id="6899897">]</span>&nbsp;<span class="op" id="6899899">!=</span>&nbsp;<span class="string" id="6899902">&#34;./file&#34;</span>&nbsp;<span class="op" id="6899911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899915">t</span><span class="op" id="6899916">.</span><span class="ident" id="6899917">Fatalf</span><span class="op" id="6899923">(</span><span class="string" id="6899924">&#34;testdata/other:&nbsp;Imports=%v,&nbsp;want&nbsp;[./file]&#34;</span><span class="op" id="6899967">,</span>&nbsp;<span class="ident" id="6899969">p</span><span class="op" id="6899970">.</span><span class="ident" id="6899971">Imports</span><span class="op" id="6899978">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6899981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6899985">p1</span><span class="op" id="6899987">,</span>&nbsp;<span class="ident" id="6899989">err</span>&nbsp;<span class="op" id="6899993">:=</span>&nbsp;<span class="ident" id="6899996">Import</span><span class="op" id="6900002">(</span><span class="string" id="6900003">&#34;./file&#34;</span><span class="op" id="6900011">,</span>&nbsp;<span class="string" id="6900013">&#34;testdata/other&#34;</span><span class="op" id="6900029">,</span>&nbsp;<span class="num" id="6900031">0</span><span class="op" id="6900032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6900035">if</span>&nbsp;<span class="ident" id="6900038">err</span>&nbsp;<span class="op" id="6900042">!=</span>&nbsp;<span class="ident" id="6900045">nil</span>&nbsp;<span class="op" id="6900049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900053">t</span><span class="op" id="6900054">.</span><span class="ident" id="6900055">Fatal</span><span class="op" id="6900060">(</span><span class="ident" id="6900061">err</span><span class="op" id="6900064">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6900067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6900070">if</span>&nbsp;<span class="ident" id="6900073">p1</span><span class="op" id="6900075">.</span><span class="ident" id="6900076">Name</span>&nbsp;<span class="op" id="6900081">!=</span>&nbsp;<span class="string" id="6900084">&#34;file&#34;</span>&nbsp;<span class="op" id="6900091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900095">t</span><span class="op" id="6900096">.</span><span class="ident" id="6900097">Fatalf</span><span class="op" id="6900103">(</span><span class="string" id="6900104">&#34;./file:&nbsp;Name=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6900130">,</span>&nbsp;<span class="ident" id="6900132">p1</span><span class="op" id="6900134">.</span><span class="ident" id="6900135">Name</span><span class="op" id="6900139">,</span>&nbsp;<span class="string" id="6900141">&#34;file&#34;</span><span class="op" id="6900147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6900150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900153">dir</span>&nbsp;<span class="op" id="6900157">:=</span>&nbsp;<span class="ident" id="6900160">filepath</span><span class="op" id="6900168">.</span><span class="ident" id="6900169">Clean</span><span class="op" id="6900174">(</span><span class="string" id="6900175">&#34;testdata/other/file&#34;</span><span class="op" id="6900196">)</span>&nbsp;<span class="comment" id="6900198">//&nbsp;Clean&nbsp;to&nbsp;use&nbsp;\&nbsp;on&nbsp;Windows</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6900228">if</span>&nbsp;<span class="ident" id="6900231">p1</span><span class="op" id="6900233">.</span><span class="ident" id="6900234">Dir</span>&nbsp;<span class="op" id="6900238">!=</span>&nbsp;<span class="ident" id="6900241">dir</span>&nbsp;<span class="op" id="6900245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900249">t</span><span class="op" id="6900250">.</span><span class="ident" id="6900251">Fatalf</span><span class="op" id="6900257">(</span><span class="string" id="6900258">&#34;./file:&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6900283">,</span>&nbsp;<span class="ident" id="6900285">p1</span><span class="op" id="6900287">.</span><span class="ident" id="6900288">Name</span><span class="op" id="6900292">,</span>&nbsp;<span class="ident" id="6900294">dir</span><span class="op" id="6900297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6900300">}</span><br>
<span class="lineno"></span><span class="op" id="6900302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6900305">func</span>&nbsp;<span class="ident" id="6900310">TestEmptyImport</span><span class="op" id="6900325">(</span><span class="ident" id="6900326">t</span>&nbsp;<span class="op" id="6900328">*</span><span class="ident" id="6900329">testing</span><span class="op" id="6900336">.</span><span class="ident" id="6900337">T</span><span class="op" id="6900338">)</span>&nbsp;<span class="op" id="6900340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900343">p</span><span class="op" id="6900344">,</span>&nbsp;<span class="ident" id="6900346">err</span>&nbsp;<span class="op" id="6900350">:=</span>&nbsp;<span class="ident" id="6900353">Import</span><span class="op" id="6900359">(</span><span class="string" id="6900360">&#34;&#34;</span><span class="op" id="6900362">,</span>&nbsp;<span class="ident" id="6900364">Default</span><span class="op" id="6900371">.</span><span class="ident" id="6900372">GOROOT</span><span class="op" id="6900378">,</span>&nbsp;<span class="ident" id="6900380">FindOnly</span><span class="op" id="6900388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6900391">if</span>&nbsp;<span class="ident" id="6900394">err</span>&nbsp;<span class="op" id="6900398">==</span>&nbsp;<span class="ident" id="6900401">nil</span>&nbsp;<span class="op" id="6900405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900409">t</span><span class="op" id="6900410">.</span><span class="ident" id="6900411">Fatal</span><span class="op" id="6900416">(</span><span class="string" id="6900417">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;error.`</span><span class="op" id="6900449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6900452">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6900455">if</span>&nbsp;<span class="ident" id="6900458">p</span>&nbsp;<span class="op" id="6900460">==</span>&nbsp;<span class="ident" id="6900463">nil</span>&nbsp;<span class="op" id="6900467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900471">t</span><span class="op" id="6900472">.</span><span class="ident" id="6900473">Fatal</span><span class="op" id="6900478">(</span><span class="string" id="6900479">`Import(&#34;&#34;)&nbsp;returned&nbsp;nil&nbsp;package.`</span><span class="op" id="6900513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6900516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6900519">if</span>&nbsp;<span class="ident" id="6900522">p</span><span class="op" id="6900523">.</span><span class="ident" id="6900524">ImportPath</span>&nbsp;<span class="op" id="6900535">!=</span>&nbsp;<span class="string" id="6900538">&#34;&#34;</span>&nbsp;<span class="op" id="6900541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900545">t</span><span class="op" id="6900546">.</span><span class="ident" id="6900547">Fatalf</span><span class="op" id="6900553">(</span><span class="string" id="6900554">&#34;ImportPath=%q,&nbsp;want&nbsp;%q.&#34;</span><span class="op" id="6900579">,</span>&nbsp;<span class="ident" id="6900581">p</span><span class="op" id="6900582">.</span><span class="ident" id="6900583">ImportPath</span><span class="op" id="6900593">,</span>&nbsp;<span class="string" id="6900595">&#34;&#34;</span><span class="op" id="6900597">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6900600">}</span><br>
<span class="lineno"></span><span class="op" id="6900602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6900605">func</span>&nbsp;<span class="ident" id="6900610">TestEmptyFolderImport</span><span class="op" id="6900631">(</span><span class="ident" id="6900632">t</span>&nbsp;<span class="op" id="6900634">*</span><span class="ident" id="6900635">testing</span><span class="op" id="6900642">.</span><span class="ident" id="6900643">T</span><span class="op" id="6900644">)</span>&nbsp;<span class="op" id="6900646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900649">_</span><span class="op" id="6900650">,</span>&nbsp;<span class="ident" id="6900652">err</span>&nbsp;<span class="op" id="6900656">:=</span>&nbsp;<span class="ident" id="6900659">Import</span><span class="op" id="6900665">(</span><span class="string" id="6900666">&#34;.&#34;</span><span class="op" id="6900669">,</span>&nbsp;<span class="string" id="6900671">&#34;testdata/empty&#34;</span><span class="op" id="6900687">,</span>&nbsp;<span class="num" id="6900689">0</span><span class="op" id="6900690">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6900693">if</span>&nbsp;<span class="ident" id="6900696">_</span><span class="op" id="6900697">,</span>&nbsp;<span class="ident" id="6900699">ok</span>&nbsp;<span class="op" id="6900702">:=</span>&nbsp;<span class="ident" id="6900705">err</span><span class="op" id="6900708">.</span><span class="op" id="6900709">(</span><span class="op" id="6900710">*</span><span class="ident" id="6900711">NoGoError</span><span class="op" id="6900720">)</span><span class="op" id="6900721">;</span>&nbsp;<span class="op" id="6900723">!</span><span class="ident" id="6900724">ok</span>&nbsp;<span class="op" id="6900727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900731">t</span><span class="op" id="6900732">.</span><span class="ident" id="6900733">Fatal</span><span class="op" id="6900738">(</span><span class="string" id="6900739">`Import(&#34;testdata/empty&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;NoGoError.`</span><span class="op" id="6900791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6900794">}</span><br>
<span class="lineno"></span><span class="op" id="6900796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6900799">func</span>&nbsp;<span class="ident" id="6900804">TestMultiplePackageImport</span><span class="op" id="6900829">(</span><span class="ident" id="6900830">t</span>&nbsp;<span class="op" id="6900832">*</span><span class="ident" id="6900833">testing</span><span class="op" id="6900840">.</span><span class="ident" id="6900841">T</span><span class="op" id="6900842">)</span>&nbsp;<span class="op" id="6900844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900847">_</span><span class="op" id="6900848">,</span>&nbsp;<span class="ident" id="6900850">err</span>&nbsp;<span class="op" id="6900854">:=</span>&nbsp;<span class="ident" id="6900857">Import</span><span class="op" id="6900863">(</span><span class="string" id="6900864">&#34;.&#34;</span><span class="op" id="6900867">,</span>&nbsp;<span class="string" id="6900869">&#34;testdata/multi&#34;</span><span class="op" id="6900885">,</span>&nbsp;<span class="num" id="6900887">0</span><span class="op" id="6900888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6900891">if</span>&nbsp;<span class="ident" id="6900894">_</span><span class="op" id="6900895">,</span>&nbsp;<span class="ident" id="6900897">ok</span>&nbsp;<span class="op" id="6900900">:=</span>&nbsp;<span class="ident" id="6900903">err</span><span class="op" id="6900906">.</span><span class="op" id="6900907">(</span><span class="op" id="6900908">*</span><span class="ident" id="6900909">MultiplePackageError</span><span class="op" id="6900929">)</span><span class="op" id="6900930">;</span>&nbsp;<span class="op" id="6900932">!</span><span class="ident" id="6900933">ok</span>&nbsp;<span class="op" id="6900936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6900940">t</span><span class="op" id="6900941">.</span><span class="ident" id="6900942">Fatal</span><span class="op" id="6900947">(</span><span class="string" id="6900948">`Import(&#34;testdata/multi&#34;)&nbsp;did&nbsp;not&nbsp;return&nbsp;MultiplePackageError.`</span><span class="op" id="6901011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6901014">}</span><br>
<span class="lineno">100</span><span class="op" id="6901016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6901019">func</span>&nbsp;<span class="ident" id="6901024">TestLocalDirectory</span><span class="op" id="6901042">(</span><span class="ident" id="6901043">t</span>&nbsp;<span class="op" id="6901045">*</span><span class="ident" id="6901046">testing</span><span class="op" id="6901053">.</span><span class="ident" id="6901054">T</span><span class="op" id="6901055">)</span>&nbsp;<span class="op" id="6901057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6901060">cwd</span><span class="op" id="6901063">,</span>&nbsp;<span class="ident" id="6901065">err</span>&nbsp;<span class="op" id="6901069">:=</span>&nbsp;<span class="ident" id="6901072">os</span><span class="op" id="6901074">.</span><span class="ident" id="6901075">Getwd</span><span class="op" id="6901080">(</span><span class="op" id="6901081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6901084">if</span>&nbsp;<span class="ident" id="6901087">err</span>&nbsp;<span class="op" id="6901091">!=</span>&nbsp;<span class="ident" id="6901094">nil</span>&nbsp;<span class="op" id="6901098">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6901102">t</span><span class="op" id="6901103">.</span><span class="ident" id="6901104">Fatal</span><span class="op" id="6901109">(</span><span class="ident" id="6901110">err</span><span class="op" id="6901113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6901116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6901120">p</span><span class="op" id="6901121">,</span>&nbsp;<span class="ident" id="6901123">err</span>&nbsp;<span class="op" id="6901127">:=</span>&nbsp;<span class="ident" id="6901130">ImportDir</span><span class="op" id="6901139">(</span><span class="ident" id="6901140">cwd</span><span class="op" id="6901143">,</span>&nbsp;<span class="num" id="6901145">0</span><span class="op" id="6901146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6901149">if</span>&nbsp;<span class="ident" id="6901152">err</span>&nbsp;<span class="op" id="6901156">!=</span>&nbsp;<span class="ident" id="6901159">nil</span>&nbsp;<span class="op" id="6901163">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6901167">t</span><span class="op" id="6901168">.</span><span class="ident" id="6901169">Fatal</span><span class="op" id="6901174">(</span><span class="ident" id="6901175">err</span><span class="op" id="6901178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6901181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6901184">if</span>&nbsp;<span class="ident" id="6901187">p</span><span class="op" id="6901188">.</span><span class="ident" id="6901189">ImportPath</span>&nbsp;<span class="op" id="6901200">!=</span>&nbsp;<span class="string" id="6901203">&#34;go/build&#34;</span>&nbsp;<span class="op" id="6901214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6901218">t</span><span class="op" id="6901219">.</span><span class="ident" id="6901220">Fatalf</span><span class="op" id="6901226">(</span><span class="string" id="6901227">&#34;ImportPath=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6901251">,</span>&nbsp;<span class="ident" id="6901253">p</span><span class="op" id="6901254">.</span><span class="ident" id="6901255">ImportPath</span><span class="op" id="6901265">,</span>&nbsp;<span class="string" id="6901267">&#34;go/build&#34;</span><span class="op" id="6901277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6901280">}</span><br>
<span class="lineno">115</span><span class="op" id="6901282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6901285">func</span>&nbsp;<span class="ident" id="6901290">TestShouldBuild</span><span class="op" id="6901305">(</span><span class="ident" id="6901306">t</span>&nbsp;<span class="op" id="6901308">*</span><span class="ident" id="6901309">testing</span><span class="op" id="6901316">.</span><span class="ident" id="6901317">T</span><span class="op" id="6901318">)</span>&nbsp;<span class="op" id="6901320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6901323">const</span>&nbsp;<span class="ident" id="6901329">file1</span>&nbsp;<span class="op" id="6901335">=</span>&nbsp;<span class="string" id="6901337">&#34;//&nbsp;+build&nbsp;tag1\n\n&#34;</span>&nbsp;<span class="op" id="6901358">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6901362">&#34;package&nbsp;main\n&#34;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6901380">want1</span>&nbsp;<span class="op" id="6901386">:=</span>&nbsp;<span class="keyword" id="6901389">map</span><span class="op" id="6901392">[</span><span class="builtintype" id="6901393">string</span><span class="op" id="6901399">]</span><span class="builtintype" id="6901400">bool</span><span class="op" id="6901404">{</span><span class="string" id="6901405">&#34;tag1&#34;</span><span class="op" id="6901411">:</span>&nbsp;<span class="builtintype" id="6901413">true</span><span class="op" id="6901417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6901421">const</span>&nbsp;<span class="ident" id="6901427">file2</span>&nbsp;<span class="op" id="6901433">=</span>&nbsp;<span class="string" id="6901435">&#34;//&nbsp;+build&nbsp;cgo\n\n&#34;</span>&nbsp;<span class="op" id="6901455">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6901459">&#34;//&nbsp;This&nbsp;package&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;tags&nbsp;like\n&#34;</span>&nbsp;<span class="op" id="6901511">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6901515">&#34;//&nbsp;+build&nbsp;tag1\n&#34;</span>&nbsp;<span class="op" id="6901534">+</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6901538">&#34;package&nbsp;build&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6901555">want2</span>&nbsp;<span class="op" id="6901561">:=</span>&nbsp;<span class="keyword" id="6901564">map</span><span class="op" id="6901567">[</span><span class="builtintype" id="6901568">string</span><span class="op" id="6901574">]</span><span class="builtintype" id="6901575">bool</span><span class="op" id="6901579">{</span><span class="string" id="6901580">&#34;cgo&#34;</span><span class="op" id="6901585">:</span>&nbsp;<span class="builtintype" id="6901587">true</span><span class="op" id="6901591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6901595">const</span>&nbsp;<span class="ident" id="6901601">file3</span>&nbsp;<span class="op" id="6901607">=</span>&nbsp;<span class="string" id="6901609">&#34;//&nbsp;Copyright&nbsp;The&nbsp;Go&nbsp;Authors.\n\n&#34;</span>&nbsp;<span class="op" id="6901644">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6901648">&#34;package&nbsp;build\n\n&#34;</span>&nbsp;<span class="op" id="6901668">+</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6901672">&#34;//&nbsp;shouldBuild&nbsp;checks&nbsp;tags&nbsp;given&nbsp;by&nbsp;lines&nbsp;of&nbsp;the&nbsp;form\n&#34;</span>&nbsp;<span class="op" id="6901730">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6901734">&#34;//&nbsp;+build&nbsp;tag\n&#34;</span>&nbsp;<span class="op" id="6901752">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6901756">&#34;func&nbsp;shouldBuild(content&nbsp;[]byte)\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6901794">want3</span>&nbsp;<span class="op" id="6901800">:=</span>&nbsp;<span class="keyword" id="6901803">map</span><span class="op" id="6901806">[</span><span class="builtintype" id="6901807">string</span><span class="op" id="6901813">]</span><span class="builtintype" id="6901814">bool</span><span class="op" id="6901818">{</span><span class="op" id="6901819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6901823">ctx</span>&nbsp;<span class="op" id="6901827">:=</span>&nbsp;<span class="op" id="6901830">&amp;</span><span class="ident" id="6901831">Context</span><span class="op" id="6901838">{</span><span class="ident" id="6901839">BuildTags</span><span class="op" id="6901848">:</span>&nbsp;<span class="op" id="6901850">[</span><span class="op" id="6901851">]</span><span class="builtintype" id="6901852">string</span><span class="op" id="6901858">{</span><span class="string" id="6901859">&#34;tag1&#34;</span><span class="op" id="6901865">}</span><span class="op" id="6901866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6901869">m</span>&nbsp;<span class="op" id="6901871">:=</span>&nbsp;<span class="keyword" id="6901874">map</span><span class="op" id="6901877">[</span><span class="builtintype" id="6901878">string</span><span class="op" id="6901884">]</span><span class="builtintype" id="6901885">bool</span><span class="op" id="6901889">{</span><span class="op" id="6901890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6901893">if</span>&nbsp;<span class="op" id="6901896">!</span><span class="ident" id="6901897">ctx</span><span class="op" id="6901900">.</span><span class="ident" id="6901901">shouldBuild</span><span class="op" id="6901912">(</span><span class="op" id="6901913">[</span><span class="op" id="6901914">]</span><span class="builtintype" id="6901915">byte</span><span class="op" id="6901919">(</span><span class="ident" id="6901920">file1</span><span class="op" id="6901925">)</span><span class="op" id="6901926">,</span>&nbsp;<span class="ident" id="6901928">m</span><span class="op" id="6901929">)</span>&nbsp;<span class="op" id="6901931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6901935">t</span><span class="op" id="6901936">.</span><span class="ident" id="6901937">Errorf</span><span class="op" id="6901943">(</span><span class="string" id="6901944">&#34;shouldBuild(file1)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="6901983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6901986">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6901989">if</span>&nbsp;<span class="op" id="6901992">!</span><span class="ident" id="6901993">reflect</span><span class="op" id="6902000">.</span><span class="ident" id="6902001">DeepEqual</span><span class="op" id="6902010">(</span><span class="ident" id="6902011">m</span><span class="op" id="6902012">,</span>&nbsp;<span class="ident" id="6902014">want1</span><span class="op" id="6902019">)</span>&nbsp;<span class="op" id="6902021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902025">t</span><span class="op" id="6902026">.</span><span class="ident" id="6902027">Errorf</span><span class="op" id="6902033">(</span><span class="string" id="6902034">&#34;shoudBuild(file1)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6902072">,</span>&nbsp;<span class="ident" id="6902074">m</span><span class="op" id="6902075">,</span>&nbsp;<span class="ident" id="6902077">want1</span><span class="op" id="6902082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6902085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902089">m</span>&nbsp;<span class="op" id="6902091">=</span>&nbsp;<span class="keyword" id="6902093">map</span><span class="op" id="6902096">[</span><span class="builtintype" id="6902097">string</span><span class="op" id="6902103">]</span><span class="builtintype" id="6902104">bool</span><span class="op" id="6902108">{</span><span class="op" id="6902109">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6902112">if</span>&nbsp;<span class="ident" id="6902115">ctx</span><span class="op" id="6902118">.</span><span class="ident" id="6902119">shouldBuild</span><span class="op" id="6902130">(</span><span class="op" id="6902131">[</span><span class="op" id="6902132">]</span><span class="builtintype" id="6902133">byte</span><span class="op" id="6902137">(</span><span class="ident" id="6902138">file2</span><span class="op" id="6902143">)</span><span class="op" id="6902144">,</span>&nbsp;<span class="ident" id="6902146">m</span><span class="op" id="6902147">)</span>&nbsp;<span class="op" id="6902149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902153">t</span><span class="op" id="6902154">.</span><span class="ident" id="6902155">Errorf</span><span class="op" id="6902161">(</span><span class="string" id="6902162">&#34;shouldBuild(file2)&nbsp;=&nbsp;true,&nbsp;want&nbsp;fakse&#34;</span><span class="op" id="6902201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6902204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6902207">if</span>&nbsp;<span class="op" id="6902210">!</span><span class="ident" id="6902211">reflect</span><span class="op" id="6902218">.</span><span class="ident" id="6902219">DeepEqual</span><span class="op" id="6902228">(</span><span class="ident" id="6902229">m</span><span class="op" id="6902230">,</span>&nbsp;<span class="ident" id="6902232">want2</span><span class="op" id="6902237">)</span>&nbsp;<span class="op" id="6902239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902243">t</span><span class="op" id="6902244">.</span><span class="ident" id="6902245">Errorf</span><span class="op" id="6902251">(</span><span class="string" id="6902252">&#34;shoudBuild(file2)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6902290">,</span>&nbsp;<span class="ident" id="6902292">m</span><span class="op" id="6902293">,</span>&nbsp;<span class="ident" id="6902295">want2</span><span class="op" id="6902300">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6902303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902307">m</span>&nbsp;<span class="op" id="6902309">=</span>&nbsp;<span class="keyword" id="6902311">map</span><span class="op" id="6902314">[</span><span class="builtintype" id="6902315">string</span><span class="op" id="6902321">]</span><span class="builtintype" id="6902322">bool</span><span class="op" id="6902326">{</span><span class="op" id="6902327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902330">ctx</span>&nbsp;<span class="op" id="6902334">=</span>&nbsp;<span class="op" id="6902336">&amp;</span><span class="ident" id="6902337">Context</span><span class="op" id="6902344">{</span><span class="ident" id="6902345">BuildTags</span><span class="op" id="6902354">:</span>&nbsp;<span class="ident" id="6902356">nil</span><span class="op" id="6902359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6902362">if</span>&nbsp;<span class="op" id="6902365">!</span><span class="ident" id="6902366">ctx</span><span class="op" id="6902369">.</span><span class="ident" id="6902370">shouldBuild</span><span class="op" id="6902381">(</span><span class="op" id="6902382">[</span><span class="op" id="6902383">]</span><span class="builtintype" id="6902384">byte</span><span class="op" id="6902388">(</span><span class="ident" id="6902389">file3</span><span class="op" id="6902394">)</span><span class="op" id="6902395">,</span>&nbsp;<span class="ident" id="6902397">m</span><span class="op" id="6902398">)</span>&nbsp;<span class="op" id="6902400">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902404">t</span><span class="op" id="6902405">.</span><span class="ident" id="6902406">Errorf</span><span class="op" id="6902412">(</span><span class="string" id="6902413">&#34;shouldBuild(file3)&nbsp;=&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="6902452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6902455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6902458">if</span>&nbsp;<span class="op" id="6902461">!</span><span class="ident" id="6902462">reflect</span><span class="op" id="6902469">.</span><span class="ident" id="6902470">DeepEqual</span><span class="op" id="6902479">(</span><span class="ident" id="6902480">m</span><span class="op" id="6902481">,</span>&nbsp;<span class="ident" id="6902483">want3</span><span class="op" id="6902488">)</span>&nbsp;<span class="op" id="6902490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902494">t</span><span class="op" id="6902495">.</span><span class="ident" id="6902496">Errorf</span><span class="op" id="6902502">(</span><span class="string" id="6902503">&#34;shoudBuild(file3)&nbsp;tags&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6902541">,</span>&nbsp;<span class="ident" id="6902543">m</span><span class="op" id="6902544">,</span>&nbsp;<span class="ident" id="6902546">want3</span><span class="op" id="6902551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6902554">}</span><br>
<span class="lineno">160</span><span class="op" id="6902556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6902559">type</span>&nbsp;<span class="ident" id="6902564">readNopCloser</span>&nbsp;<span class="keyword" id="6902578">struct</span>&nbsp;<span class="op" id="6902585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902588">io</span><span class="op" id="6902590">.</span><span class="ident" id="6902591">Reader</span><br>
<span class="lineno"></span><span class="op" id="6902598">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6902601">func</span>&nbsp;<span class="op" id="6902606">(</span><span class="ident" id="6902607">r</span>&nbsp;<span class="ident" id="6902609">readNopCloser</span><span class="op" id="6902622">)</span>&nbsp;<span class="ident" id="6902624">Close</span><span class="op" id="6902629">(</span><span class="op" id="6902630">)</span>&nbsp;<span class="builtintype" id="6902632">error</span>&nbsp;<span class="op" id="6902638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6902641">return</span>&nbsp;<span class="ident" id="6902648">nil</span><br>
<span class="lineno"></span><span class="op" id="6902652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6902655">var</span>&nbsp;<span class="op" id="6902659">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902662">ctxtP9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6902674">=</span>&nbsp;<span class="ident" id="6902676">Context</span><span class="op" id="6902683">{</span><span class="ident" id="6902684">GOARCH</span><span class="op" id="6902690">:</span>&nbsp;<span class="string" id="6902692">&#34;arm&#34;</span><span class="op" id="6902697">,</span>&nbsp;<span class="ident" id="6902699">GOOS</span><span class="op" id="6902703">:</span>&nbsp;<span class="string" id="6902705">&#34;plan9&#34;</span><span class="op" id="6902712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902715">ctxtAndroid</span>&nbsp;<span class="op" id="6902727">=</span>&nbsp;<span class="ident" id="6902729">Context</span><span class="op" id="6902736">{</span><span class="ident" id="6902737">GOARCH</span><span class="op" id="6902743">:</span>&nbsp;<span class="string" id="6902745">&#34;arm&#34;</span><span class="op" id="6902750">,</span>&nbsp;<span class="ident" id="6902752">GOOS</span><span class="op" id="6902756">:</span>&nbsp;<span class="string" id="6902758">&#34;android&#34;</span><span class="op" id="6902767">}</span><br>
<span class="lineno"></span><span class="op" id="6902769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="6902772">var</span>&nbsp;<span class="ident" id="6902776">matchFileTests</span>&nbsp;<span class="op" id="6902791">=</span>&nbsp;<span class="op" id="6902793">[</span><span class="op" id="6902794">]</span><span class="keyword" id="6902795">struct</span>&nbsp;<span class="op" id="6902802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902805">ctxt</span>&nbsp;&nbsp;<span class="ident" id="6902811">Context</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902820">name</span>&nbsp;&nbsp;<span class="builtintype" id="6902826">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902834">data</span>&nbsp;&nbsp;<span class="builtintype" id="6902840">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6902848">match</span>&nbsp;<span class="builtintype" id="6902854">bool</span><br>
<span class="lineno">180</span><span class="op" id="6902859">}</span><span class="op" id="6902860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6902863">{</span><span class="ident" id="6902864">ctxtP9</span><span class="op" id="6902870">,</span>&nbsp;<span class="string" id="6902872">&#34;foo_arm.go&#34;</span><span class="op" id="6902884">,</span>&nbsp;<span class="string" id="6902886">&#34;&#34;</span><span class="op" id="6902888">,</span>&nbsp;<span class="builtintype" id="6902890">true</span><span class="op" id="6902894">}</span><span class="op" id="6902895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6902898">{</span><span class="ident" id="6902899">ctxtP9</span><span class="op" id="6902905">,</span>&nbsp;<span class="string" id="6902907">&#34;foo1_arm.go&#34;</span><span class="op" id="6902920">,</span>&nbsp;<span class="string" id="6902922">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="6902957">,</span>&nbsp;<span class="builtintype" id="6902959">false</span><span class="op" id="6902964">}</span><span class="op" id="6902965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6902968">{</span><span class="ident" id="6902969">ctxtP9</span><span class="op" id="6902975">,</span>&nbsp;<span class="string" id="6902977">&#34;foo_darwin.go&#34;</span><span class="op" id="6902992">,</span>&nbsp;<span class="string" id="6902994">&#34;&#34;</span><span class="op" id="6902996">,</span>&nbsp;<span class="builtintype" id="6902998">false</span><span class="op" id="6903003">}</span><span class="op" id="6903004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903007">{</span><span class="ident" id="6903008">ctxtP9</span><span class="op" id="6903014">,</span>&nbsp;<span class="string" id="6903016">&#34;foo.go&#34;</span><span class="op" id="6903024">,</span>&nbsp;<span class="string" id="6903026">&#34;&#34;</span><span class="op" id="6903028">,</span>&nbsp;<span class="builtintype" id="6903030">true</span><span class="op" id="6903034">}</span><span class="op" id="6903035">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903038">{</span><span class="ident" id="6903039">ctxtP9</span><span class="op" id="6903045">,</span>&nbsp;<span class="string" id="6903047">&#34;foo1.go&#34;</span><span class="op" id="6903056">,</span>&nbsp;<span class="string" id="6903058">&#34;//&nbsp;+build&nbsp;linux\n\npackage&nbsp;main\n&#34;</span><span class="op" id="6903093">,</span>&nbsp;<span class="builtintype" id="6903095">false</span><span class="op" id="6903100">}</span><span class="op" id="6903101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903104">{</span><span class="ident" id="6903105">ctxtP9</span><span class="op" id="6903111">,</span>&nbsp;<span class="string" id="6903113">&#34;foo.badsuffix&#34;</span><span class="op" id="6903128">,</span>&nbsp;<span class="string" id="6903130">&#34;&#34;</span><span class="op" id="6903132">,</span>&nbsp;<span class="builtintype" id="6903134">false</span><span class="op" id="6903139">}</span><span class="op" id="6903140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903143">{</span><span class="ident" id="6903144">ctxtAndroid</span><span class="op" id="6903155">,</span>&nbsp;<span class="string" id="6903157">&#34;foo_linux.go&#34;</span><span class="op" id="6903171">,</span>&nbsp;<span class="string" id="6903173">&#34;&#34;</span><span class="op" id="6903175">,</span>&nbsp;<span class="builtintype" id="6903177">true</span><span class="op" id="6903181">}</span><span class="op" id="6903182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903185">{</span><span class="ident" id="6903186">ctxtAndroid</span><span class="op" id="6903197">,</span>&nbsp;<span class="string" id="6903199">&#34;foo_android.go&#34;</span><span class="op" id="6903215">,</span>&nbsp;<span class="string" id="6903217">&#34;&#34;</span><span class="op" id="6903219">,</span>&nbsp;<span class="builtintype" id="6903221">true</span><span class="op" id="6903225">}</span><span class="op" id="6903226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903229">{</span><span class="ident" id="6903230">ctxtAndroid</span><span class="op" id="6903241">,</span>&nbsp;<span class="string" id="6903243">&#34;foo_plan9.go&#34;</span><span class="op" id="6903257">,</span>&nbsp;<span class="string" id="6903259">&#34;&#34;</span><span class="op" id="6903261">,</span>&nbsp;<span class="builtintype" id="6903263">false</span><span class="op" id="6903268">}</span><span class="op" id="6903269">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903272">{</span><span class="ident" id="6903273">ctxtAndroid</span><span class="op" id="6903284">,</span>&nbsp;<span class="string" id="6903286">&#34;android.go&#34;</span><span class="op" id="6903298">,</span>&nbsp;<span class="string" id="6903300">&#34;&#34;</span><span class="op" id="6903302">,</span>&nbsp;<span class="builtintype" id="6903304">true</span><span class="op" id="6903308">}</span><span class="op" id="6903309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903312">{</span><span class="ident" id="6903313">ctxtAndroid</span><span class="op" id="6903324">,</span>&nbsp;<span class="string" id="6903326">&#34;plan9.go&#34;</span><span class="op" id="6903336">,</span>&nbsp;<span class="string" id="6903338">&#34;&#34;</span><span class="op" id="6903340">,</span>&nbsp;<span class="builtintype" id="6903342">true</span><span class="op" id="6903346">}</span><span class="op" id="6903347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903350">{</span><span class="ident" id="6903351">ctxtAndroid</span><span class="op" id="6903362">,</span>&nbsp;<span class="string" id="6903364">&#34;plan9_test.go&#34;</span><span class="op" id="6903379">,</span>&nbsp;<span class="string" id="6903381">&#34;&#34;</span><span class="op" id="6903383">,</span>&nbsp;<span class="builtintype" id="6903385">true</span><span class="op" id="6903389">}</span><span class="op" id="6903390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903393">{</span><span class="ident" id="6903394">ctxtAndroid</span><span class="op" id="6903405">,</span>&nbsp;<span class="string" id="6903407">&#34;arm.s&#34;</span><span class="op" id="6903414">,</span>&nbsp;<span class="string" id="6903416">&#34;&#34;</span><span class="op" id="6903418">,</span>&nbsp;<span class="builtintype" id="6903420">true</span><span class="op" id="6903424">}</span><span class="op" id="6903425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903428">{</span><span class="ident" id="6903429">ctxtAndroid</span><span class="op" id="6903440">,</span>&nbsp;<span class="string" id="6903442">&#34;amd64.s&#34;</span><span class="op" id="6903451">,</span>&nbsp;<span class="string" id="6903453">&#34;&#34;</span><span class="op" id="6903455">,</span>&nbsp;<span class="builtintype" id="6903457">true</span><span class="op" id="6903461">}</span><span class="op" id="6903462">,</span><br>
<span class="lineno">195</span><span class="op" id="6903464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6903467">func</span>&nbsp;<span class="ident" id="6903472">TestMatchFile</span><span class="op" id="6903485">(</span><span class="ident" id="6903486">t</span>&nbsp;<span class="op" id="6903488">*</span><span class="ident" id="6903489">testing</span><span class="op" id="6903496">.</span><span class="ident" id="6903497">T</span><span class="op" id="6903498">)</span>&nbsp;<span class="op" id="6903500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6903503">for</span>&nbsp;<span class="ident" id="6903507">_</span><span class="op" id="6903508">,</span>&nbsp;<span class="ident" id="6903510">tt</span>&nbsp;<span class="op" id="6903513">:=</span>&nbsp;<span class="keyword" id="6903516">range</span>&nbsp;<span class="ident" id="6903522">matchFileTests</span>&nbsp;<span class="op" id="6903537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6903541">ctxt</span>&nbsp;<span class="op" id="6903546">:=</span>&nbsp;<span class="ident" id="6903549">tt</span><span class="op" id="6903551">.</span><span class="ident" id="6903552">ctxt</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6903559">ctxt</span><span class="op" id="6903563">.</span><span class="ident" id="6903564">OpenFile</span>&nbsp;<span class="op" id="6903573">=</span>&nbsp;<span class="keyword" id="6903575">func</span><span class="op" id="6903579">(</span><span class="ident" id="6903580">path</span>&nbsp;<span class="builtintype" id="6903585">string</span><span class="op" id="6903591">)</span>&nbsp;<span class="op" id="6903593">(</span><span class="ident" id="6903594">r</span>&nbsp;<span class="ident" id="6903596">io</span><span class="op" id="6903598">.</span><span class="ident" id="6903599">ReadCloser</span><span class="op" id="6903609">,</span>&nbsp;<span class="ident" id="6903611">err</span>&nbsp;<span class="builtintype" id="6903615">error</span><span class="op" id="6903620">)</span>&nbsp;<span class="op" id="6903622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6903627">if</span>&nbsp;<span class="ident" id="6903630">path</span>&nbsp;<span class="op" id="6903635">!=</span>&nbsp;<span class="string" id="6903638">&#34;x+&#34;</span><span class="op" id="6903642">+</span><span class="ident" id="6903643">tt</span><span class="op" id="6903645">.</span><span class="ident" id="6903646">name</span>&nbsp;<span class="op" id="6903651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6903657">t</span><span class="op" id="6903658">.</span><span class="ident" id="6903659">Fatalf</span><span class="op" id="6903665">(</span><span class="string" id="6903666">&#34;OpenFile&nbsp;asked&nbsp;for&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6903702">,</span>&nbsp;<span class="ident" id="6903704">path</span><span class="op" id="6903708">,</span>&nbsp;<span class="string" id="6903710">&#34;x+&#34;</span><span class="op" id="6903714">+</span><span class="ident" id="6903715">tt</span><span class="op" id="6903717">.</span><span class="ident" id="6903718">name</span><span class="op" id="6903722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6903732">return</span>&nbsp;<span class="op" id="6903739">&amp;</span><span class="ident" id="6903740">readNopCloser</span><span class="op" id="6903753">{</span><span class="ident" id="6903754">strings</span><span class="op" id="6903761">.</span><span class="ident" id="6903762">NewReader</span><span class="op" id="6903771">(</span><span class="ident" id="6903772">tt</span><span class="op" id="6903774">.</span><span class="ident" id="6903775">data</span><span class="op" id="6903779">)</span><span class="op" id="6903780">}</span><span class="op" id="6903781">,</span>&nbsp;<span class="ident" id="6903783">nil</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6903793">ctxt</span><span class="op" id="6903797">.</span><span class="ident" id="6903798">JoinPath</span>&nbsp;<span class="op" id="6903807">=</span>&nbsp;<span class="keyword" id="6903809">func</span><span class="op" id="6903813">(</span><span class="ident" id="6903814">elem</span>&nbsp;<span class="op" id="6903819">...</span><span class="builtintype" id="6903822">string</span><span class="op" id="6903828">)</span>&nbsp;<span class="builtintype" id="6903830">string</span>&nbsp;<span class="op" id="6903837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6903842">return</span>&nbsp;<span class="ident" id="6903849">strings</span><span class="op" id="6903856">.</span><span class="ident" id="6903857">Join</span><span class="op" id="6903861">(</span><span class="ident" id="6903862">elem</span><span class="op" id="6903866">,</span>&nbsp;<span class="string" id="6903868">&#34;+&#34;</span><span class="op" id="6903871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6903875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6903879">match</span><span class="op" id="6903884">,</span>&nbsp;<span class="ident" id="6903886">err</span>&nbsp;<span class="op" id="6903890">:=</span>&nbsp;<span class="ident" id="6903893">ctxt</span><span class="op" id="6903897">.</span><span class="ident" id="6903898">MatchFile</span><span class="op" id="6903907">(</span><span class="string" id="6903908">&#34;x&#34;</span><span class="op" id="6903911">,</span>&nbsp;<span class="ident" id="6903913">tt</span><span class="op" id="6903915">.</span><span class="ident" id="6903916">name</span><span class="op" id="6903920">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6903924">if</span>&nbsp;<span class="ident" id="6903927">match</span>&nbsp;<span class="op" id="6903933">!=</span>&nbsp;<span class="ident" id="6903936">tt</span><span class="op" id="6903938">.</span><span class="ident" id="6903939">match</span>&nbsp;<span class="op" id="6903945">||</span>&nbsp;<span class="ident" id="6903948">err</span>&nbsp;<span class="op" id="6903952">!=</span>&nbsp;<span class="ident" id="6903955">nil</span>&nbsp;<span class="op" id="6903959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6903964">t</span><span class="op" id="6903965">.</span><span class="ident" id="6903966">Fatalf</span><span class="op" id="6903972">(</span><span class="string" id="6903973">&#34;MatchFile(%q)&nbsp;=&nbsp;%v,&nbsp;%v,&nbsp;want&nbsp;%v,&nbsp;nil&#34;</span><span class="op" id="6904011">,</span>&nbsp;<span class="ident" id="6904013">tt</span><span class="op" id="6904015">.</span><span class="ident" id="6904016">name</span><span class="op" id="6904020">,</span>&nbsp;<span class="ident" id="6904022">match</span><span class="op" id="6904027">,</span>&nbsp;<span class="ident" id="6904029">err</span><span class="op" id="6904032">,</span>&nbsp;<span class="ident" id="6904034">tt</span><span class="op" id="6904036">.</span><span class="ident" id="6904037">match</span><span class="op" id="6904042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6904046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6904049">}</span><br>
<span class="lineno"></span><span class="op" id="6904051">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="6904054">func</span>&nbsp;<span class="ident" id="6904059">TestImportCmd</span><span class="op" id="6904072">(</span><span class="ident" id="6904073">t</span>&nbsp;<span class="op" id="6904075">*</span><span class="ident" id="6904076">testing</span><span class="op" id="6904083">.</span><span class="ident" id="6904084">T</span><span class="op" id="6904085">)</span>&nbsp;<span class="op" id="6904087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6904090">p</span><span class="op" id="6904091">,</span>&nbsp;<span class="ident" id="6904093">err</span>&nbsp;<span class="op" id="6904097">:=</span>&nbsp;<span class="ident" id="6904100">Import</span><span class="op" id="6904106">(</span><span class="string" id="6904107">&#34;cmd/internal/objfile&#34;</span><span class="op" id="6904129">,</span>&nbsp;<span class="string" id="6904131">&#34;&#34;</span><span class="op" id="6904133">,</span>&nbsp;<span class="num" id="6904135">0</span><span class="op" id="6904136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6904139">if</span>&nbsp;<span class="ident" id="6904142">err</span>&nbsp;<span class="op" id="6904146">!=</span>&nbsp;<span class="ident" id="6904149">nil</span>&nbsp;<span class="op" id="6904153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6904157">t</span><span class="op" id="6904158">.</span><span class="ident" id="6904159">Fatal</span><span class="op" id="6904164">(</span><span class="ident" id="6904165">err</span><span class="op" id="6904168">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6904171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6904174">if</span>&nbsp;<span class="op" id="6904177">!</span><span class="ident" id="6904178">strings</span><span class="op" id="6904185">.</span><span class="ident" id="6904186">HasSuffix</span><span class="op" id="6904195">(</span><span class="ident" id="6904196">filepath</span><span class="op" id="6904204">.</span><span class="ident" id="6904205">ToSlash</span><span class="op" id="6904212">(</span><span class="ident" id="6904213">p</span><span class="op" id="6904214">.</span><span class="ident" id="6904215">Dir</span><span class="op" id="6904218">)</span><span class="op" id="6904219">,</span>&nbsp;<span class="string" id="6904221">&#34;src/cmd/internal/objfile&#34;</span><span class="op" id="6904247">)</span>&nbsp;<span class="op" id="6904249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6904253">t</span><span class="op" id="6904254">.</span><span class="ident" id="6904255">Fatalf</span><span class="op" id="6904261">(</span><span class="string" id="6904262">&#34;Import&nbsp;cmd/internal/objfile&nbsp;returned&nbsp;Dir=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6904316">,</span>&nbsp;<span class="ident" id="6904318">filepath</span><span class="op" id="6904326">.</span><span class="ident" id="6904327">ToSlash</span><span class="op" id="6904334">(</span><span class="ident" id="6904335">p</span><span class="op" id="6904336">.</span><span class="ident" id="6904337">Dir</span><span class="op" id="6904340">)</span><span class="op" id="6904341">,</span>&nbsp;<span class="string" id="6904343">&#34;.../src/cmd/internal/objfile&#34;</span><span class="op" id="6904373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6904376">}</span><br>
<span class="lineno"></span><span class="op" id="6904378">}</span>
</div>
</body>
</html>
