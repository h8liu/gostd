<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8440320">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8440375">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8440429">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8440480">package</span>&nbsp;<span class="ident" id="8440488">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8440494">import</span>&nbsp;<span class="op" id="8440501">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440504">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440513">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440520">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440529">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440544">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440550">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440563">&#34;math/rand&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440576">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440582">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440593">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8440603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="8440606">//&nbsp;TestDecodeProgressive&nbsp;tests&nbsp;that&nbsp;decoding&nbsp;the&nbsp;baseline&nbsp;and&nbsp;progressive</span><br>
<span class="lineno"></span><span class="comment" id="8440680">//&nbsp;versions&nbsp;of&nbsp;the&nbsp;same&nbsp;image&nbsp;result&nbsp;in&nbsp;exactly&nbsp;the&nbsp;same&nbsp;pixel&nbsp;data,&nbsp;in&nbsp;YCbCr</span><br>
<span class="lineno"></span><span class="comment" id="8440758">//&nbsp;space&nbsp;for&nbsp;color&nbsp;images,&nbsp;and&nbsp;Y&nbsp;space&nbsp;for&nbsp;grayscale&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="8440819">func</span>&nbsp;<span class="ident" id="8440824">TestDecodeProgressive</span><span class="op" id="8440845">(</span><span class="ident" id="8440846">t</span>&nbsp;<span class="op" id="8440848">*</span><span class="ident" id="8440849">testing</span><span class="op" id="8440856">.</span><span class="ident" id="8440857">T</span><span class="op" id="8440858">)</span>&nbsp;<span class="op" id="8440860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8440863">testCases</span>&nbsp;<span class="op" id="8440873">:=</span>&nbsp;<span class="op" id="8440876">[</span><span class="op" id="8440877">]</span><span class="builtintype" id="8440878">string</span><span class="op" id="8440884">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440888">&#34;../testdata/video-001&#34;</span><span class="op" id="8440911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440915">&#34;../testdata/video-001.q50.420&#34;</span><span class="op" id="8440946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440950">&#34;../testdata/video-001.q50.422&#34;</span><span class="op" id="8440981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8440985">&#34;../testdata/video-001.q50.440&#34;</span><span class="op" id="8441016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8441020">&#34;../testdata/video-001.q50.444&#34;</span><span class="op" id="8441051">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8441055">&#34;../testdata/video-005.gray.q50&#34;</span><span class="op" id="8441087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8441091">&#34;../testdata/video-005.gray.q50.2x2&#34;</span><span class="op" id="8441127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8441131">&#34;../testdata/video-001.separate.dc.progression&#34;</span><span class="op" id="8441178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8441181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441184">for</span>&nbsp;<span class="ident" id="8441188">_</span><span class="op" id="8441189">,</span>&nbsp;<span class="ident" id="8441191">tc</span>&nbsp;<span class="op" id="8441194">:=</span>&nbsp;<span class="keyword" id="8441197">range</span>&nbsp;<span class="ident" id="8441203">testCases</span>&nbsp;<span class="op" id="8441213">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8441217">m0</span><span class="op" id="8441219">,</span>&nbsp;<span class="ident" id="8441221">err</span>&nbsp;<span class="op" id="8441225">:=</span>&nbsp;<span class="ident" id="8441228">decodeFile</span><span class="op" id="8441238">(</span><span class="ident" id="8441239">tc</span>&nbsp;<span class="op" id="8441242">+</span>&nbsp;<span class="string" id="8441244">&#34;.jpeg&#34;</span><span class="op" id="8441251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441255">if</span>&nbsp;<span class="ident" id="8441258">err</span>&nbsp;<span class="op" id="8441262">!=</span>&nbsp;<span class="builtintype" id="8441265">nil</span>&nbsp;<span class="op" id="8441269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8441274">t</span><span class="op" id="8441275">.</span><span class="ident" id="8441276">Errorf</span><span class="op" id="8441282">(</span><span class="string" id="8441283">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8441291">,</span>&nbsp;<span class="ident" id="8441293">tc</span><span class="op" id="8441295">+</span><span class="string" id="8441296">&#34;.jpeg&#34;</span><span class="op" id="8441303">,</span>&nbsp;<span class="ident" id="8441305">err</span><span class="op" id="8441308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441313">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8441324">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8441328">m1</span><span class="op" id="8441330">,</span>&nbsp;<span class="ident" id="8441332">err</span>&nbsp;<span class="op" id="8441336">:=</span>&nbsp;<span class="ident" id="8441339">decodeFile</span><span class="op" id="8441349">(</span><span class="ident" id="8441350">tc</span>&nbsp;<span class="op" id="8441353">+</span>&nbsp;<span class="string" id="8441355">&#34;.progressive.jpeg&#34;</span><span class="op" id="8441374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441378">if</span>&nbsp;<span class="ident" id="8441381">err</span>&nbsp;<span class="op" id="8441385">!=</span>&nbsp;<span class="builtintype" id="8441388">nil</span>&nbsp;<span class="op" id="8441392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8441397">t</span><span class="op" id="8441398">.</span><span class="ident" id="8441399">Errorf</span><span class="op" id="8441405">(</span><span class="string" id="8441406">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8441414">,</span>&nbsp;<span class="ident" id="8441416">tc</span><span class="op" id="8441418">+</span><span class="string" id="8441419">&#34;.progressive.jpeg&#34;</span><span class="op" id="8441438">,</span>&nbsp;<span class="ident" id="8441440">err</span><span class="op" id="8441443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441448">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8441459">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441463">if</span>&nbsp;<span class="ident" id="8441466">m0</span><span class="op" id="8441468">.</span><span class="ident" id="8441469">Bounds</span><span class="op" id="8441475">(</span><span class="op" id="8441476">)</span>&nbsp;<span class="op" id="8441478">!=</span>&nbsp;<span class="ident" id="8441481">m1</span><span class="op" id="8441483">.</span><span class="ident" id="8441484">Bounds</span><span class="op" id="8441490">(</span><span class="op" id="8441491">)</span>&nbsp;<span class="op" id="8441493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8441498">t</span><span class="op" id="8441499">.</span><span class="ident" id="8441500">Errorf</span><span class="op" id="8441506">(</span><span class="string" id="8441507">&#34;%s:&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8441537">,</span>&nbsp;<span class="ident" id="8441539">tc</span><span class="op" id="8441541">,</span>&nbsp;<span class="ident" id="8441543">m0</span><span class="op" id="8441545">.</span><span class="ident" id="8441546">Bounds</span><span class="op" id="8441552">(</span><span class="op" id="8441553">)</span><span class="op" id="8441554">,</span>&nbsp;<span class="ident" id="8441556">m1</span><span class="op" id="8441558">.</span><span class="ident" id="8441559">Bounds</span><span class="op" id="8441565">(</span><span class="op" id="8441566">)</span><span class="op" id="8441567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441572">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8441583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8441587">//&nbsp;All&nbsp;of&nbsp;the&nbsp;video-*.jpeg&nbsp;files&nbsp;are&nbsp;150x103.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441635">if</span>&nbsp;<span class="ident" id="8441638">m0</span><span class="op" id="8441640">.</span><span class="ident" id="8441641">Bounds</span><span class="op" id="8441647">(</span><span class="op" id="8441648">)</span>&nbsp;<span class="op" id="8441650">!=</span>&nbsp;<span class="ident" id="8441653">image</span><span class="op" id="8441658">.</span><span class="ident" id="8441659">Rect</span><span class="op" id="8441663">(</span><span class="num" id="8441664">0</span><span class="op" id="8441665">,</span>&nbsp;<span class="num" id="8441667">0</span><span class="op" id="8441668">,</span>&nbsp;<span class="num" id="8441670">150</span><span class="op" id="8441673">,</span>&nbsp;<span class="num" id="8441675">103</span><span class="op" id="8441678">)</span>&nbsp;<span class="op" id="8441680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8441685">t</span><span class="op" id="8441686">.</span><span class="ident" id="8441687">Errorf</span><span class="op" id="8441693">(</span><span class="string" id="8441694">&#34;%s:&nbsp;bad&nbsp;bounds:&nbsp;%v&#34;</span><span class="op" id="8441714">,</span>&nbsp;<span class="ident" id="8441716">tc</span><span class="op" id="8441718">,</span>&nbsp;<span class="ident" id="8441720">m0</span><span class="op" id="8441722">.</span><span class="ident" id="8441723">Bounds</span><span class="op" id="8441729">(</span><span class="op" id="8441730">)</span><span class="op" id="8441731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441736">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8441747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441752">switch</span>&nbsp;<span class="ident" id="8441759">m0</span>&nbsp;<span class="op" id="8441762">:=</span>&nbsp;<span class="ident" id="8441765">m0</span><span class="op" id="8441767">.</span><span class="op" id="8441768">(</span><span class="keyword" id="8441769">type</span><span class="op" id="8441773">)</span>&nbsp;<span class="op" id="8441775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441779">case</span>&nbsp;<span class="op" id="8441784">*</span><span class="ident" id="8441785">image</span><span class="op" id="8441790">.</span><span class="ident" id="8441791">YCbCr</span><span class="op" id="8441796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8441801">m1</span>&nbsp;<span class="op" id="8441804">:=</span>&nbsp;<span class="ident" id="8441807">m1</span><span class="op" id="8441809">.</span><span class="op" id="8441810">(</span><span class="op" id="8441811">*</span><span class="ident" id="8441812">image</span><span class="op" id="8441817">.</span><span class="ident" id="8441818">YCbCr</span><span class="op" id="8441823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441828">if</span>&nbsp;<span class="ident" id="8441831">err</span>&nbsp;<span class="op" id="8441835">:=</span>&nbsp;<span class="ident" id="8441838">check</span><span class="op" id="8441843">(</span><span class="ident" id="8441844">m0</span><span class="op" id="8441846">.</span><span class="ident" id="8441847">Bounds</span><span class="op" id="8441853">(</span><span class="op" id="8441854">)</span><span class="op" id="8441855">,</span>&nbsp;<span class="ident" id="8441857">m0</span><span class="op" id="8441859">.</span><span class="ident" id="8441860">Y</span><span class="op" id="8441861">,</span>&nbsp;<span class="ident" id="8441863">m1</span><span class="op" id="8441865">.</span><span class="ident" id="8441866">Y</span><span class="op" id="8441867">,</span>&nbsp;<span class="ident" id="8441869">m0</span><span class="op" id="8441871">.</span><span class="ident" id="8441872">YStride</span><span class="op" id="8441879">,</span>&nbsp;<span class="ident" id="8441881">m1</span><span class="op" id="8441883">.</span><span class="ident" id="8441884">YStride</span><span class="op" id="8441891">)</span><span class="op" id="8441892">;</span>&nbsp;<span class="ident" id="8441894">err</span>&nbsp;<span class="op" id="8441898">!=</span>&nbsp;<span class="builtintype" id="8441901">nil</span>&nbsp;<span class="op" id="8441905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8441911">t</span><span class="op" id="8441912">.</span><span class="ident" id="8441913">Errorf</span><span class="op" id="8441919">(</span><span class="string" id="8441920">&#34;%s&nbsp;(Y):&nbsp;%v&#34;</span><span class="op" id="8441932">,</span>&nbsp;<span class="ident" id="8441934">tc</span><span class="op" id="8441936">,</span>&nbsp;<span class="ident" id="8441938">err</span><span class="op" id="8441941">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441947">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8441959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8441964">if</span>&nbsp;<span class="ident" id="8441967">err</span>&nbsp;<span class="op" id="8441971">:=</span>&nbsp;<span class="ident" id="8441974">check</span><span class="op" id="8441979">(</span><span class="ident" id="8441980">m0</span><span class="op" id="8441982">.</span><span class="ident" id="8441983">Bounds</span><span class="op" id="8441989">(</span><span class="op" id="8441990">)</span><span class="op" id="8441991">,</span>&nbsp;<span class="ident" id="8441993">m0</span><span class="op" id="8441995">.</span><span class="ident" id="8441996">Cb</span><span class="op" id="8441998">,</span>&nbsp;<span class="ident" id="8442000">m1</span><span class="op" id="8442002">.</span><span class="ident" id="8442003">Cb</span><span class="op" id="8442005">,</span>&nbsp;<span class="ident" id="8442007">m0</span><span class="op" id="8442009">.</span><span class="ident" id="8442010">CStride</span><span class="op" id="8442017">,</span>&nbsp;<span class="ident" id="8442019">m1</span><span class="op" id="8442021">.</span><span class="ident" id="8442022">CStride</span><span class="op" id="8442029">)</span><span class="op" id="8442030">;</span>&nbsp;<span class="ident" id="8442032">err</span>&nbsp;<span class="op" id="8442036">!=</span>&nbsp;<span class="builtintype" id="8442039">nil</span>&nbsp;<span class="op" id="8442043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442049">t</span><span class="op" id="8442050">.</span><span class="ident" id="8442051">Errorf</span><span class="op" id="8442057">(</span><span class="string" id="8442058">&#34;%s&nbsp;(Cb):&nbsp;%v&#34;</span><span class="op" id="8442071">,</span>&nbsp;<span class="ident" id="8442073">tc</span><span class="op" id="8442075">,</span>&nbsp;<span class="ident" id="8442077">err</span><span class="op" id="8442080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442086">continue</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8442098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442103">if</span>&nbsp;<span class="ident" id="8442106">err</span>&nbsp;<span class="op" id="8442110">:=</span>&nbsp;<span class="ident" id="8442113">check</span><span class="op" id="8442118">(</span><span class="ident" id="8442119">m0</span><span class="op" id="8442121">.</span><span class="ident" id="8442122">Bounds</span><span class="op" id="8442128">(</span><span class="op" id="8442129">)</span><span class="op" id="8442130">,</span>&nbsp;<span class="ident" id="8442132">m0</span><span class="op" id="8442134">.</span><span class="ident" id="8442135">Cr</span><span class="op" id="8442137">,</span>&nbsp;<span class="ident" id="8442139">m1</span><span class="op" id="8442141">.</span><span class="ident" id="8442142">Cr</span><span class="op" id="8442144">,</span>&nbsp;<span class="ident" id="8442146">m0</span><span class="op" id="8442148">.</span><span class="ident" id="8442149">CStride</span><span class="op" id="8442156">,</span>&nbsp;<span class="ident" id="8442158">m1</span><span class="op" id="8442160">.</span><span class="ident" id="8442161">CStride</span><span class="op" id="8442168">)</span><span class="op" id="8442169">;</span>&nbsp;<span class="ident" id="8442171">err</span>&nbsp;<span class="op" id="8442175">!=</span>&nbsp;<span class="builtintype" id="8442178">nil</span>&nbsp;<span class="op" id="8442182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442188">t</span><span class="op" id="8442189">.</span><span class="ident" id="8442190">Errorf</span><span class="op" id="8442196">(</span><span class="string" id="8442197">&#34;%s&nbsp;(Cr):&nbsp;%v&#34;</span><span class="op" id="8442210">,</span>&nbsp;<span class="ident" id="8442212">tc</span><span class="op" id="8442214">,</span>&nbsp;<span class="ident" id="8442216">err</span><span class="op" id="8442219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442225">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8442237">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442241">case</span>&nbsp;<span class="op" id="8442246">*</span><span class="ident" id="8442247">image</span><span class="op" id="8442252">.</span><span class="ident" id="8442253">Gray</span><span class="op" id="8442257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442262">m1</span>&nbsp;<span class="op" id="8442265">:=</span>&nbsp;<span class="ident" id="8442268">m1</span><span class="op" id="8442270">.</span><span class="op" id="8442271">(</span><span class="op" id="8442272">*</span><span class="ident" id="8442273">image</span><span class="op" id="8442278">.</span><span class="ident" id="8442279">Gray</span><span class="op" id="8442283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442288">if</span>&nbsp;<span class="ident" id="8442291">err</span>&nbsp;<span class="op" id="8442295">:=</span>&nbsp;<span class="ident" id="8442298">check</span><span class="op" id="8442303">(</span><span class="ident" id="8442304">m0</span><span class="op" id="8442306">.</span><span class="ident" id="8442307">Bounds</span><span class="op" id="8442313">(</span><span class="op" id="8442314">)</span><span class="op" id="8442315">,</span>&nbsp;<span class="ident" id="8442317">m0</span><span class="op" id="8442319">.</span><span class="ident" id="8442320">Pix</span><span class="op" id="8442323">,</span>&nbsp;<span class="ident" id="8442325">m1</span><span class="op" id="8442327">.</span><span class="ident" id="8442328">Pix</span><span class="op" id="8442331">,</span>&nbsp;<span class="ident" id="8442333">m0</span><span class="op" id="8442335">.</span><span class="ident" id="8442336">Stride</span><span class="op" id="8442342">,</span>&nbsp;<span class="ident" id="8442344">m1</span><span class="op" id="8442346">.</span><span class="ident" id="8442347">Stride</span><span class="op" id="8442353">)</span><span class="op" id="8442354">;</span>&nbsp;<span class="ident" id="8442356">err</span>&nbsp;<span class="op" id="8442360">!=</span>&nbsp;<span class="builtintype" id="8442363">nil</span>&nbsp;<span class="op" id="8442367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442373">t</span><span class="op" id="8442374">.</span><span class="ident" id="8442375">Errorf</span><span class="op" id="8442381">(</span><span class="string" id="8442382">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8442390">,</span>&nbsp;<span class="ident" id="8442392">tc</span><span class="op" id="8442394">,</span>&nbsp;<span class="ident" id="8442396">err</span><span class="op" id="8442399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442405">continue</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8442417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442421">default</span><span class="op" id="8442428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442433">t</span><span class="op" id="8442434">.</span><span class="ident" id="8442435">Errorf</span><span class="op" id="8442441">(</span><span class="string" id="8442442">&#34;%s:&nbsp;unexpected&nbsp;image&nbsp;type&nbsp;%T&#34;</span><span class="op" id="8442472">,</span>&nbsp;<span class="ident" id="8442474">tc</span><span class="op" id="8442476">,</span>&nbsp;<span class="ident" id="8442478">m0</span><span class="op" id="8442480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442485">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8442496">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8442499">}</span><br>
<span class="lineno"></span><span class="op" id="8442501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8442504">func</span>&nbsp;<span class="ident" id="8442509">decodeFile</span><span class="op" id="8442519">(</span><span class="ident" id="8442520">filename</span>&nbsp;<span class="builtintype" id="8442529">string</span><span class="op" id="8442535">)</span>&nbsp;<span class="op" id="8442537">(</span><span class="ident" id="8442538">image</span><span class="op" id="8442543">.</span><span class="ident" id="8442544">Image</span><span class="op" id="8442549">,</span>&nbsp;<span class="builtintype" id="8442551">error</span><span class="op" id="8442556">)</span>&nbsp;<span class="op" id="8442558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442561">f</span><span class="op" id="8442562">,</span>&nbsp;<span class="ident" id="8442564">err</span>&nbsp;<span class="op" id="8442568">:=</span>&nbsp;<span class="ident" id="8442571">os</span><span class="op" id="8442573">.</span><span class="ident" id="8442574">Open</span><span class="op" id="8442578">(</span><span class="ident" id="8442579">filename</span><span class="op" id="8442587">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442590">if</span>&nbsp;<span class="ident" id="8442593">err</span>&nbsp;<span class="op" id="8442597">!=</span>&nbsp;<span class="builtintype" id="8442600">nil</span>&nbsp;<span class="op" id="8442604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442608">return</span>&nbsp;<span class="builtintype" id="8442615">nil</span><span class="op" id="8442618">,</span>&nbsp;<span class="ident" id="8442620">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8442625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442628">defer</span>&nbsp;<span class="ident" id="8442634">f</span><span class="op" id="8442635">.</span><span class="ident" id="8442636">Close</span><span class="op" id="8442641">(</span><span class="op" id="8442642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442645">return</span>&nbsp;<span class="ident" id="8442652">Decode</span><span class="op" id="8442658">(</span><span class="ident" id="8442659">f</span><span class="op" id="8442660">)</span><br>
<span class="lineno">90</span><span class="op" id="8442662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8442665">type</span>&nbsp;<span class="ident" id="8442670">eofReader</span>&nbsp;<span class="keyword" id="8442680">struct</span>&nbsp;<span class="op" id="8442687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442690">data</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8442699">[</span><span class="op" id="8442700">]</span><span class="builtintype" id="8442701">byte</span>&nbsp;<span class="comment" id="8442706">//&nbsp;deliver&nbsp;from&nbsp;Read&nbsp;without&nbsp;EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442740">dataEOF</span>&nbsp;&nbsp;<span class="op" id="8442749">[</span><span class="op" id="8442750">]</span><span class="builtintype" id="8442751">byte</span>&nbsp;<span class="comment" id="8442756">//&nbsp;then&nbsp;deliver&nbsp;from&nbsp;Read&nbsp;with&nbsp;EOF&nbsp;on&nbsp;last&nbsp;chunk</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442806">lenAtEOF</span>&nbsp;<span class="builtintype" id="8442815">int</span><br>
<span class="lineno"></span><span class="op" id="8442819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8442822">func</span>&nbsp;<span class="op" id="8442827">(</span><span class="ident" id="8442828">r</span>&nbsp;<span class="op" id="8442830">*</span><span class="ident" id="8442831">eofReader</span><span class="op" id="8442840">)</span>&nbsp;<span class="ident" id="8442842">Read</span><span class="op" id="8442846">(</span><span class="ident" id="8442847">b</span>&nbsp;<span class="op" id="8442849">[</span><span class="op" id="8442850">]</span><span class="builtintype" id="8442851">byte</span><span class="op" id="8442855">)</span>&nbsp;<span class="op" id="8442857">(</span><span class="ident" id="8442858">n</span>&nbsp;<span class="builtintype" id="8442860">int</span><span class="op" id="8442863">,</span>&nbsp;<span class="ident" id="8442865">err</span>&nbsp;<span class="builtintype" id="8442869">error</span><span class="op" id="8442874">)</span>&nbsp;<span class="op" id="8442876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8442879">if</span>&nbsp;<span class="builtinfunc" id="8442882">len</span><span class="op" id="8442885">(</span><span class="ident" id="8442886">r</span><span class="op" id="8442887">.</span><span class="ident" id="8442888">data</span><span class="op" id="8442892">)</span>&nbsp;<span class="op" id="8442894">&gt;</span>&nbsp;<span class="num" id="8442896">0</span>&nbsp;<span class="op" id="8442898">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442902">n</span>&nbsp;<span class="op" id="8442904">=</span>&nbsp;<span class="builtinfunc" id="8442906">copy</span><span class="op" id="8442910">(</span><span class="ident" id="8442911">b</span><span class="op" id="8442912">,</span>&nbsp;<span class="ident" id="8442914">r</span><span class="op" id="8442915">.</span><span class="ident" id="8442916">data</span><span class="op" id="8442920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442924">r</span><span class="op" id="8442925">.</span><span class="ident" id="8442926">data</span>&nbsp;<span class="op" id="8442931">=</span>&nbsp;<span class="ident" id="8442933">r</span><span class="op" id="8442934">.</span><span class="ident" id="8442935">data</span><span class="op" id="8442939">[</span><span class="ident" id="8442940">n</span><span class="op" id="8442941">:</span><span class="op" id="8442942">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8442945">}</span>&nbsp;<span class="keyword" id="8442947">else</span>&nbsp;<span class="op" id="8442952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442956">n</span>&nbsp;<span class="op" id="8442958">=</span>&nbsp;<span class="builtinfunc" id="8442960">copy</span><span class="op" id="8442964">(</span><span class="ident" id="8442965">b</span><span class="op" id="8442966">,</span>&nbsp;<span class="ident" id="8442968">r</span><span class="op" id="8442969">.</span><span class="ident" id="8442970">dataEOF</span><span class="op" id="8442977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8442981">r</span><span class="op" id="8442982">.</span><span class="ident" id="8442983">dataEOF</span>&nbsp;<span class="op" id="8442991">=</span>&nbsp;<span class="ident" id="8442993">r</span><span class="op" id="8442994">.</span><span class="ident" id="8442995">dataEOF</span><span class="op" id="8443002">[</span><span class="ident" id="8443003">n</span><span class="op" id="8443004">:</span><span class="op" id="8443005">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443009">if</span>&nbsp;<span class="builtinfunc" id="8443012">len</span><span class="op" id="8443015">(</span><span class="ident" id="8443016">r</span><span class="op" id="8443017">.</span><span class="ident" id="8443018">dataEOF</span><span class="op" id="8443025">)</span>&nbsp;<span class="op" id="8443027">==</span>&nbsp;<span class="num" id="8443030">0</span>&nbsp;<span class="op" id="8443032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443037">err</span>&nbsp;<span class="op" id="8443041">=</span>&nbsp;<span class="ident" id="8443043">io</span><span class="op" id="8443045">.</span><span class="ident" id="8443046">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443053">if</span>&nbsp;<span class="ident" id="8443056">r</span><span class="op" id="8443057">.</span><span class="ident" id="8443058">lenAtEOF</span>&nbsp;<span class="op" id="8443067">==</span>&nbsp;<span class="op" id="8443070">-</span><span class="num" id="8443071">1</span>&nbsp;<span class="op" id="8443073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443079">r</span><span class="op" id="8443080">.</span><span class="ident" id="8443081">lenAtEOF</span>&nbsp;<span class="op" id="8443090">=</span>&nbsp;<span class="ident" id="8443092">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443097">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443107">return</span><br>
<span class="lineno"></span><span class="op" id="8443114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="8443117">func</span>&nbsp;<span class="ident" id="8443122">TestDecodeEOF</span><span class="op" id="8443135">(</span><span class="ident" id="8443136">t</span>&nbsp;<span class="op" id="8443138">*</span><span class="ident" id="8443139">testing</span><span class="op" id="8443146">.</span><span class="ident" id="8443147">T</span><span class="op" id="8443148">)</span>&nbsp;<span class="op" id="8443150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8443153">//&nbsp;Check&nbsp;that&nbsp;if&nbsp;reader&nbsp;returns&nbsp;final&nbsp;data&nbsp;and&nbsp;EOF&nbsp;at&nbsp;same&nbsp;time,&nbsp;jpeg&nbsp;handles&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443236">data</span><span class="op" id="8443240">,</span>&nbsp;<span class="ident" id="8443242">err</span>&nbsp;<span class="op" id="8443246">:=</span>&nbsp;<span class="ident" id="8443249">ioutil</span><span class="op" id="8443255">.</span><span class="ident" id="8443256">ReadFile</span><span class="op" id="8443264">(</span><span class="string" id="8443265">&#34;../testdata/video-001.jpeg&#34;</span><span class="op" id="8443293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443296">if</span>&nbsp;<span class="ident" id="8443299">err</span>&nbsp;<span class="op" id="8443303">!=</span>&nbsp;<span class="builtintype" id="8443306">nil</span>&nbsp;<span class="op" id="8443310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443314">t</span><span class="op" id="8443315">.</span><span class="ident" id="8443316">Fatal</span><span class="op" id="8443321">(</span><span class="ident" id="8443322">err</span><span class="op" id="8443325">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443332">n</span>&nbsp;<span class="op" id="8443334">:=</span>&nbsp;<span class="builtinfunc" id="8443337">len</span><span class="op" id="8443340">(</span><span class="ident" id="8443341">data</span><span class="op" id="8443345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443348">for</span>&nbsp;<span class="ident" id="8443352">i</span>&nbsp;<span class="op" id="8443354">:=</span>&nbsp;<span class="num" id="8443357">0</span><span class="op" id="8443358">;</span>&nbsp;<span class="ident" id="8443360">i</span>&nbsp;<span class="op" id="8443362">&lt;</span>&nbsp;<span class="ident" id="8443364">n</span><span class="op" id="8443365">;</span>&nbsp;<span class="op" id="8443367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443371">r</span>&nbsp;<span class="op" id="8443373">:=</span>&nbsp;<span class="op" id="8443376">&amp;</span><span class="ident" id="8443377">eofReader</span><span class="op" id="8443386">{</span><span class="ident" id="8443387">data</span><span class="op" id="8443391">[</span><span class="op" id="8443392">:</span><span class="ident" id="8443393">n</span><span class="op" id="8443394">-</span><span class="ident" id="8443395">i</span><span class="op" id="8443396">]</span><span class="op" id="8443397">,</span>&nbsp;<span class="ident" id="8443399">data</span><span class="op" id="8443403">[</span><span class="ident" id="8443404">n</span><span class="op" id="8443405">-</span><span class="ident" id="8443406">i</span><span class="op" id="8443407">:</span><span class="op" id="8443408">]</span><span class="op" id="8443409">,</span>&nbsp;<span class="op" id="8443411">-</span><span class="num" id="8443412">1</span><span class="op" id="8443413">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443417">_</span><span class="op" id="8443418">,</span>&nbsp;<span class="ident" id="8443420">err</span>&nbsp;<span class="op" id="8443424">:=</span>&nbsp;<span class="ident" id="8443427">Decode</span><span class="op" id="8443433">(</span><span class="ident" id="8443434">r</span><span class="op" id="8443435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443439">if</span>&nbsp;<span class="ident" id="8443442">err</span>&nbsp;<span class="op" id="8443446">!=</span>&nbsp;<span class="builtintype" id="8443449">nil</span>&nbsp;<span class="op" id="8443453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443458">t</span><span class="op" id="8443459">.</span><span class="ident" id="8443460">Errorf</span><span class="op" id="8443466">(</span><span class="string" id="8443467">&#34;Decode&nbsp;with&nbsp;Read()&nbsp;=&nbsp;%d,&nbsp;EOF:&nbsp;%v&#34;</span><span class="op" id="8443501">,</span>&nbsp;<span class="ident" id="8443503">r</span><span class="op" id="8443504">.</span><span class="ident" id="8443505">lenAtEOF</span><span class="op" id="8443513">,</span>&nbsp;<span class="ident" id="8443515">err</span><span class="op" id="8443518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443526">if</span>&nbsp;<span class="ident" id="8443529">i</span>&nbsp;<span class="op" id="8443531">==</span>&nbsp;<span class="num" id="8443534">0</span>&nbsp;<span class="op" id="8443536">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443541">i</span>&nbsp;<span class="op" id="8443543">=</span>&nbsp;<span class="num" id="8443545">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443549">}</span>&nbsp;<span class="keyword" id="8443551">else</span>&nbsp;<span class="op" id="8443556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8443561">i</span>&nbsp;<span class="op" id="8443563">*=</span>&nbsp;<span class="num" id="8443566">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443573">}</span><br>
<span class="lineno">135</span><span class="op" id="8443575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8443578">//&nbsp;check&nbsp;checks&nbsp;that&nbsp;the&nbsp;two&nbsp;pix&nbsp;data&nbsp;are&nbsp;equal,&nbsp;within&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="8443652">func</span>&nbsp;<span class="ident" id="8443657">check</span><span class="op" id="8443662">(</span><span class="ident" id="8443663">bounds</span>&nbsp;<span class="ident" id="8443670">image</span><span class="op" id="8443675">.</span><span class="ident" id="8443676">Rectangle</span><span class="op" id="8443685">,</span>&nbsp;<span class="ident" id="8443687">pix0</span><span class="op" id="8443691">,</span>&nbsp;<span class="ident" id="8443693">pix1</span>&nbsp;<span class="op" id="8443698">[</span><span class="op" id="8443699">]</span><span class="builtintype" id="8443700">byte</span><span class="op" id="8443704">,</span>&nbsp;<span class="ident" id="8443706">stride0</span><span class="op" id="8443713">,</span>&nbsp;<span class="ident" id="8443715">stride1</span>&nbsp;<span class="builtintype" id="8443723">int</span><span class="op" id="8443726">)</span>&nbsp;<span class="builtintype" id="8443728">error</span>&nbsp;<span class="op" id="8443734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443737">if</span>&nbsp;<span class="ident" id="8443740">stride0</span>&nbsp;<span class="op" id="8443748">&lt;=</span>&nbsp;<span class="num" id="8443751">0</span>&nbsp;<span class="op" id="8443753">||</span>&nbsp;<span class="ident" id="8443756">stride0</span><span class="op" id="8443763">%</span><span class="num" id="8443764">8</span>&nbsp;<span class="op" id="8443766">!=</span>&nbsp;<span class="num" id="8443769">0</span>&nbsp;<span class="op" id="8443771">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443775">return</span>&nbsp;<span class="ident" id="8443782">fmt</span><span class="op" id="8443785">.</span><span class="ident" id="8443786">Errorf</span><span class="op" id="8443792">(</span><span class="string" id="8443793">&#34;bad&nbsp;stride&nbsp;%d&#34;</span><span class="op" id="8443808">,</span>&nbsp;<span class="ident" id="8443810">stride0</span><span class="op" id="8443817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443823">if</span>&nbsp;<span class="ident" id="8443826">stride1</span>&nbsp;<span class="op" id="8443834">&lt;=</span>&nbsp;<span class="num" id="8443837">0</span>&nbsp;<span class="op" id="8443839">||</span>&nbsp;<span class="ident" id="8443842">stride1</span><span class="op" id="8443849">%</span><span class="num" id="8443850">8</span>&nbsp;<span class="op" id="8443852">!=</span>&nbsp;<span class="num" id="8443855">0</span>&nbsp;<span class="op" id="8443857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443861">return</span>&nbsp;<span class="ident" id="8443868">fmt</span><span class="op" id="8443871">.</span><span class="ident" id="8443872">Errorf</span><span class="op" id="8443878">(</span><span class="string" id="8443879">&#34;bad&nbsp;stride&nbsp;%d&#34;</span><span class="op" id="8443894">,</span>&nbsp;<span class="ident" id="8443896">stride1</span><span class="op" id="8443903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8443906">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8443909">//&nbsp;Compare&nbsp;the&nbsp;two&nbsp;pix&nbsp;data,&nbsp;one&nbsp;8x8&nbsp;block&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8443964">for</span>&nbsp;<span class="ident" id="8443968">y</span>&nbsp;<span class="op" id="8443970">:=</span>&nbsp;<span class="num" id="8443973">0</span><span class="op" id="8443974">;</span>&nbsp;<span class="ident" id="8443976">y</span>&nbsp;<span class="op" id="8443978">&lt;</span>&nbsp;<span class="builtinfunc" id="8443980">len</span><span class="op" id="8443983">(</span><span class="ident" id="8443984">pix0</span><span class="op" id="8443988">)</span><span class="op" id="8443989">/</span><span class="ident" id="8443990">stride0</span>&nbsp;<span class="op" id="8443998">&amp;&amp;</span>&nbsp;<span class="ident" id="8444001">y</span>&nbsp;<span class="op" id="8444003">&lt;</span>&nbsp;<span class="builtinfunc" id="8444005">len</span><span class="op" id="8444008">(</span><span class="ident" id="8444009">pix1</span><span class="op" id="8444013">)</span><span class="op" id="8444014">/</span><span class="ident" id="8444015">stride1</span><span class="op" id="8444022">;</span>&nbsp;<span class="ident" id="8444024">y</span>&nbsp;<span class="op" id="8444026">+=</span>&nbsp;<span class="num" id="8444029">8</span>&nbsp;<span class="op" id="8444031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444035">for</span>&nbsp;<span class="ident" id="8444039">x</span>&nbsp;<span class="op" id="8444041">:=</span>&nbsp;<span class="num" id="8444044">0</span><span class="op" id="8444045">;</span>&nbsp;<span class="ident" id="8444047">x</span>&nbsp;<span class="op" id="8444049">&lt;</span>&nbsp;<span class="ident" id="8444051">stride0</span>&nbsp;<span class="op" id="8444059">&amp;&amp;</span>&nbsp;<span class="ident" id="8444062">x</span>&nbsp;<span class="op" id="8444064">&lt;</span>&nbsp;<span class="ident" id="8444066">stride1</span><span class="op" id="8444073">;</span>&nbsp;<span class="ident" id="8444075">x</span>&nbsp;<span class="op" id="8444077">+=</span>&nbsp;<span class="num" id="8444080">8</span>&nbsp;<span class="op" id="8444082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444087">if</span>&nbsp;<span class="ident" id="8444090">x</span>&nbsp;<span class="op" id="8444092">&gt;=</span>&nbsp;<span class="ident" id="8444095">bounds</span><span class="op" id="8444101">.</span><span class="ident" id="8444102">Max</span><span class="op" id="8444105">.</span><span class="ident" id="8444106">X</span>&nbsp;<span class="op" id="8444108">||</span>&nbsp;<span class="ident" id="8444111">y</span>&nbsp;<span class="op" id="8444113">&gt;=</span>&nbsp;<span class="ident" id="8444116">bounds</span><span class="op" id="8444122">.</span><span class="ident" id="8444123">Max</span><span class="op" id="8444126">.</span><span class="ident" id="8444127">Y</span>&nbsp;<span class="op" id="8444129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8444135">//&nbsp;We&nbsp;don&#39;t&nbsp;care&nbsp;if&nbsp;the&nbsp;two&nbsp;pix&nbsp;data&nbsp;differ&nbsp;if&nbsp;the&nbsp;8x8&nbsp;block&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8444203">//&nbsp;entirely&nbsp;outside&nbsp;of&nbsp;the&nbsp;image&#39;s&nbsp;bounds.&nbsp;For&nbsp;example,&nbsp;this&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8444272">//&nbsp;occur&nbsp;with&nbsp;a&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling&nbsp;and&nbsp;a&nbsp;1x1&nbsp;image.&nbsp;Baseline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8444343">//&nbsp;decoding&nbsp;works&nbsp;on&nbsp;the&nbsp;one&nbsp;16x16&nbsp;MCU&nbsp;as&nbsp;a&nbsp;whole;&nbsp;progressive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8444410">//&nbsp;decoding&#39;s&nbsp;first&nbsp;pass&nbsp;works&nbsp;on&nbsp;that&nbsp;16x16&nbsp;MCU&nbsp;as&nbsp;a&nbsp;whole&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8444478">//&nbsp;refinement&nbsp;passes&nbsp;only&nbsp;process&nbsp;one&nbsp;8x8&nbsp;block&nbsp;within&nbsp;the&nbsp;MCU.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444546">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444564">for</span>&nbsp;<span class="ident" id="8444568">j</span>&nbsp;<span class="op" id="8444570">:=</span>&nbsp;<span class="num" id="8444573">0</span><span class="op" id="8444574">;</span>&nbsp;<span class="ident" id="8444576">j</span>&nbsp;<span class="op" id="8444578">&lt;</span>&nbsp;<span class="num" id="8444580">8</span><span class="op" id="8444581">;</span>&nbsp;<span class="ident" id="8444583">j</span><span class="op" id="8444584">++</span>&nbsp;<span class="op" id="8444587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444593">for</span>&nbsp;<span class="ident" id="8444597">i</span>&nbsp;<span class="op" id="8444599">:=</span>&nbsp;<span class="num" id="8444602">0</span><span class="op" id="8444603">;</span>&nbsp;<span class="ident" id="8444605">i</span>&nbsp;<span class="op" id="8444607">&lt;</span>&nbsp;<span class="num" id="8444609">8</span><span class="op" id="8444610">;</span>&nbsp;<span class="ident" id="8444612">i</span><span class="op" id="8444613">++</span>&nbsp;<span class="op" id="8444616">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444623">index0</span>&nbsp;<span class="op" id="8444630">:=</span>&nbsp;<span class="op" id="8444633">(</span><span class="ident" id="8444634">y</span><span class="op" id="8444635">+</span><span class="ident" id="8444636">j</span><span class="op" id="8444637">)</span><span class="op" id="8444638">*</span><span class="ident" id="8444639">stride0</span>&nbsp;<span class="op" id="8444647">+</span>&nbsp;<span class="op" id="8444649">(</span><span class="ident" id="8444650">x</span>&nbsp;<span class="op" id="8444652">+</span>&nbsp;<span class="ident" id="8444654">i</span><span class="op" id="8444655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444662">index1</span>&nbsp;<span class="op" id="8444669">:=</span>&nbsp;<span class="op" id="8444672">(</span><span class="ident" id="8444673">y</span><span class="op" id="8444674">+</span><span class="ident" id="8444675">j</span><span class="op" id="8444676">)</span><span class="op" id="8444677">*</span><span class="ident" id="8444678">stride1</span>&nbsp;<span class="op" id="8444686">+</span>&nbsp;<span class="op" id="8444688">(</span><span class="ident" id="8444689">x</span>&nbsp;<span class="op" id="8444691">+</span>&nbsp;<span class="ident" id="8444693">i</span><span class="op" id="8444694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444701">if</span>&nbsp;<span class="ident" id="8444704">pix0</span><span class="op" id="8444708">[</span><span class="ident" id="8444709">index0</span><span class="op" id="8444715">]</span>&nbsp;<span class="op" id="8444717">!=</span>&nbsp;<span class="ident" id="8444720">pix1</span><span class="op" id="8444724">[</span><span class="ident" id="8444725">index1</span><span class="op" id="8444731">]</span>&nbsp;<span class="op" id="8444733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444741">return</span>&nbsp;<span class="ident" id="8444748">fmt</span><span class="op" id="8444751">.</span><span class="ident" id="8444752">Errorf</span><span class="op" id="8444758">(</span><span class="string" id="8444759">&#34;blocks&nbsp;at&nbsp;(%d,&nbsp;%d)&nbsp;differ:\n%sand\n%s&#34;</span><span class="op" id="8444798">,</span>&nbsp;<span class="ident" id="8444800">x</span><span class="op" id="8444801">,</span>&nbsp;<span class="ident" id="8444803">y</span><span class="op" id="8444804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444813">pixString</span><span class="op" id="8444822">(</span><span class="ident" id="8444823">pix0</span><span class="op" id="8444827">,</span>&nbsp;<span class="ident" id="8444829">stride0</span><span class="op" id="8444836">,</span>&nbsp;<span class="ident" id="8444838">x</span><span class="op" id="8444839">,</span>&nbsp;<span class="ident" id="8444841">y</span><span class="op" id="8444842">)</span><span class="op" id="8444843">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444852">pixString</span><span class="op" id="8444861">(</span><span class="ident" id="8444862">pix1</span><span class="op" id="8444866">,</span>&nbsp;<span class="ident" id="8444868">stride1</span><span class="op" id="8444875">,</span>&nbsp;<span class="ident" id="8444877">x</span><span class="op" id="8444878">,</span>&nbsp;<span class="ident" id="8444880">y</span><span class="op" id="8444881">)</span><span class="op" id="8444882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444908">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8444915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8444918">return</span>&nbsp;<span class="builtintype" id="8444925">nil</span><br>
<span class="lineno"></span><span class="op" id="8444929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="8444932">func</span>&nbsp;<span class="ident" id="8444937">pixString</span><span class="op" id="8444946">(</span><span class="ident" id="8444947">pix</span>&nbsp;<span class="op" id="8444951">[</span><span class="op" id="8444952">]</span><span class="builtintype" id="8444953">byte</span><span class="op" id="8444957">,</span>&nbsp;<span class="ident" id="8444959">stride</span><span class="op" id="8444965">,</span>&nbsp;<span class="ident" id="8444967">x</span><span class="op" id="8444968">,</span>&nbsp;<span class="ident" id="8444970">y</span>&nbsp;<span class="builtintype" id="8444972">int</span><span class="op" id="8444975">)</span>&nbsp;<span class="builtintype" id="8444977">string</span>&nbsp;<span class="op" id="8444984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8444987">s</span>&nbsp;<span class="op" id="8444989">:=</span>&nbsp;<span class="ident" id="8444992">bytes</span><span class="op" id="8444997">.</span><span class="ident" id="8444998">NewBuffer</span><span class="op" id="8445007">(</span><span class="builtintype" id="8445008">nil</span><span class="op" id="8445011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8445014">for</span>&nbsp;<span class="ident" id="8445018">j</span>&nbsp;<span class="op" id="8445020">:=</span>&nbsp;<span class="num" id="8445023">0</span><span class="op" id="8445024">;</span>&nbsp;<span class="ident" id="8445026">j</span>&nbsp;<span class="op" id="8445028">&lt;</span>&nbsp;<span class="num" id="8445030">8</span><span class="op" id="8445031">;</span>&nbsp;<span class="ident" id="8445033">j</span><span class="op" id="8445034">++</span>&nbsp;<span class="op" id="8445037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445041">fmt</span><span class="op" id="8445044">.</span><span class="ident" id="8445045">Fprintf</span><span class="op" id="8445052">(</span><span class="ident" id="8445053">s</span><span class="op" id="8445054">,</span>&nbsp;<span class="string" id="8445056">&#34;\t&#34;</span><span class="op" id="8445060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8445064">for</span>&nbsp;<span class="ident" id="8445068">i</span>&nbsp;<span class="op" id="8445070">:=</span>&nbsp;<span class="num" id="8445073">0</span><span class="op" id="8445074">;</span>&nbsp;<span class="ident" id="8445076">i</span>&nbsp;<span class="op" id="8445078">&lt;</span>&nbsp;<span class="num" id="8445080">8</span><span class="op" id="8445081">;</span>&nbsp;<span class="ident" id="8445083">i</span><span class="op" id="8445084">++</span>&nbsp;<span class="op" id="8445087">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445092">fmt</span><span class="op" id="8445095">.</span><span class="ident" id="8445096">Fprintf</span><span class="op" id="8445103">(</span><span class="ident" id="8445104">s</span><span class="op" id="8445105">,</span>&nbsp;<span class="string" id="8445107">&#34;%02x&nbsp;&#34;</span><span class="op" id="8445114">,</span>&nbsp;<span class="ident" id="8445116">pix</span><span class="op" id="8445119">[</span><span class="op" id="8445120">(</span><span class="ident" id="8445121">y</span><span class="op" id="8445122">+</span><span class="ident" id="8445123">j</span><span class="op" id="8445124">)</span><span class="op" id="8445125">*</span><span class="ident" id="8445126">stride</span><span class="op" id="8445132">+</span><span class="op" id="8445133">(</span><span class="ident" id="8445134">x</span><span class="op" id="8445135">+</span><span class="ident" id="8445136">i</span><span class="op" id="8445137">)</span><span class="op" id="8445138">]</span><span class="op" id="8445139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8445143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445147">fmt</span><span class="op" id="8445150">.</span><span class="ident" id="8445151">Fprintf</span><span class="op" id="8445158">(</span><span class="ident" id="8445159">s</span><span class="op" id="8445160">,</span>&nbsp;<span class="string" id="8445162">&#34;\n&#34;</span><span class="op" id="8445166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8445169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8445172">return</span>&nbsp;<span class="ident" id="8445179">s</span><span class="op" id="8445180">.</span><span class="ident" id="8445181">String</span><span class="op" id="8445187">(</span><span class="op" id="8445188">)</span><br>
<span class="lineno">185</span><span class="op" id="8445190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8445193">func</span>&nbsp;<span class="ident" id="8445198">TestExtraneousData</span><span class="op" id="8445216">(</span><span class="ident" id="8445217">t</span>&nbsp;<span class="op" id="8445219">*</span><span class="ident" id="8445220">testing</span><span class="op" id="8445227">.</span><span class="ident" id="8445228">T</span><span class="op" id="8445229">)</span>&nbsp;<span class="op" id="8445231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8445234">//&nbsp;Encode&nbsp;a&nbsp;1x1&nbsp;red&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445262">src</span>&nbsp;<span class="op" id="8445266">:=</span>&nbsp;<span class="ident" id="8445269">image</span><span class="op" id="8445274">.</span><span class="ident" id="8445275">NewRGBA</span><span class="op" id="8445282">(</span><span class="ident" id="8445283">image</span><span class="op" id="8445288">.</span><span class="ident" id="8445289">Rect</span><span class="op" id="8445293">(</span><span class="num" id="8445294">0</span><span class="op" id="8445295">,</span>&nbsp;<span class="num" id="8445297">0</span><span class="op" id="8445298">,</span>&nbsp;<span class="num" id="8445300">1</span><span class="op" id="8445301">,</span>&nbsp;<span class="num" id="8445303">1</span><span class="op" id="8445304">)</span><span class="op" id="8445305">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445308">src</span><span class="op" id="8445311">.</span><span class="ident" id="8445312">Set</span><span class="op" id="8445315">(</span><span class="num" id="8445316">0</span><span class="op" id="8445317">,</span>&nbsp;<span class="num" id="8445319">0</span><span class="op" id="8445320">,</span>&nbsp;<span class="ident" id="8445322">color</span><span class="op" id="8445327">.</span><span class="ident" id="8445328">RGBA</span><span class="op" id="8445332">{</span><span class="num" id="8445333">0xff</span><span class="op" id="8445337">,</span>&nbsp;<span class="num" id="8445339">0x00</span><span class="op" id="8445343">,</span>&nbsp;<span class="num" id="8445345">0x00</span><span class="op" id="8445349">,</span>&nbsp;<span class="num" id="8445351">0xff</span><span class="op" id="8445355">}</span><span class="op" id="8445356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445359">buf</span>&nbsp;<span class="op" id="8445363">:=</span>&nbsp;<span class="builtinfunc" id="8445366">new</span><span class="op" id="8445369">(</span><span class="ident" id="8445370">bytes</span><span class="op" id="8445375">.</span><span class="ident" id="8445376">Buffer</span><span class="op" id="8445382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8445385">if</span>&nbsp;<span class="ident" id="8445388">err</span>&nbsp;<span class="op" id="8445392">:=</span>&nbsp;<span class="ident" id="8445395">Encode</span><span class="op" id="8445401">(</span><span class="ident" id="8445402">buf</span><span class="op" id="8445405">,</span>&nbsp;<span class="ident" id="8445407">src</span><span class="op" id="8445410">,</span>&nbsp;<span class="builtintype" id="8445412">nil</span><span class="op" id="8445415">)</span><span class="op" id="8445416">;</span>&nbsp;<span class="ident" id="8445418">err</span>&nbsp;<span class="op" id="8445422">!=</span>&nbsp;<span class="builtintype" id="8445425">nil</span>&nbsp;<span class="op" id="8445429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445433">t</span><span class="op" id="8445434">.</span><span class="ident" id="8445435">Fatalf</span><span class="op" id="8445441">(</span><span class="string" id="8445442">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="8445454">,</span>&nbsp;<span class="ident" id="8445456">err</span><span class="op" id="8445459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8445462">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445465">enc</span>&nbsp;<span class="op" id="8445469">:=</span>&nbsp;<span class="ident" id="8445472">buf</span><span class="op" id="8445475">.</span><span class="ident" id="8445476">String</span><span class="op" id="8445482">(</span><span class="op" id="8445483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8445486">//&nbsp;Sanity&nbsp;check&nbsp;that&nbsp;the&nbsp;encoded&nbsp;JPEG&nbsp;is&nbsp;long&nbsp;enough,&nbsp;that&nbsp;it&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8445559">//&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker,&nbsp;and&nbsp;that&nbsp;it&nbsp;contains&nbsp;a&nbsp;&#34;\xff\xda&#34;&nbsp;SOS&nbsp;marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8445631">//&nbsp;somewhere&nbsp;in&nbsp;the&nbsp;final&nbsp;64&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8445668">if</span>&nbsp;<span class="builtinfunc" id="8445671">len</span><span class="op" id="8445674">(</span><span class="ident" id="8445675">enc</span><span class="op" id="8445678">)</span>&nbsp;<span class="op" id="8445680">&lt;</span>&nbsp;<span class="num" id="8445682">64</span>&nbsp;<span class="op" id="8445685">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445689">t</span><span class="op" id="8445690">.</span><span class="ident" id="8445691">Fatalf</span><span class="op" id="8445697">(</span><span class="string" id="8445698">&#34;encoded&nbsp;JPEG&nbsp;is&nbsp;too&nbsp;short:&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8445735">,</span>&nbsp;<span class="builtinfunc" id="8445737">len</span><span class="op" id="8445740">(</span><span class="ident" id="8445741">enc</span><span class="op" id="8445744">)</span><span class="op" id="8445745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8445748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8445751">if</span>&nbsp;<span class="ident" id="8445754">got</span><span class="op" id="8445757">,</span>&nbsp;<span class="ident" id="8445759">want</span>&nbsp;<span class="op" id="8445764">:=</span>&nbsp;<span class="ident" id="8445767">enc</span><span class="op" id="8445770">[</span><span class="builtinfunc" id="8445771">len</span><span class="op" id="8445774">(</span><span class="ident" id="8445775">enc</span><span class="op" id="8445778">)</span><span class="op" id="8445779">-</span><span class="num" id="8445780">2</span><span class="op" id="8445781">:</span><span class="op" id="8445782">]</span><span class="op" id="8445783">,</span>&nbsp;<span class="string" id="8445785">&#34;\xff\xd9&#34;</span><span class="op" id="8445795">;</span>&nbsp;<span class="ident" id="8445797">got</span>&nbsp;<span class="op" id="8445801">!=</span>&nbsp;<span class="ident" id="8445804">want</span>&nbsp;<span class="op" id="8445809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445813">t</span><span class="op" id="8445814">.</span><span class="ident" id="8445815">Fatalf</span><span class="op" id="8445821">(</span><span class="string" id="8445822">&#34;encoded&nbsp;JPEG&nbsp;ends&nbsp;with&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8445858">,</span>&nbsp;<span class="ident" id="8445860">got</span><span class="op" id="8445863">,</span>&nbsp;<span class="ident" id="8445865">want</span><span class="op" id="8445869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8445872">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8445875">if</span>&nbsp;<span class="ident" id="8445878">s</span>&nbsp;<span class="op" id="8445880">:=</span>&nbsp;<span class="ident" id="8445883">enc</span><span class="op" id="8445886">[</span><span class="builtinfunc" id="8445887">len</span><span class="op" id="8445890">(</span><span class="ident" id="8445891">enc</span><span class="op" id="8445894">)</span><span class="op" id="8445895">-</span><span class="num" id="8445896">64</span><span class="op" id="8445898">:</span><span class="op" id="8445899">]</span><span class="op" id="8445900">;</span>&nbsp;<span class="op" id="8445902">!</span><span class="ident" id="8445903">strings</span><span class="op" id="8445910">.</span><span class="ident" id="8445911">Contains</span><span class="op" id="8445919">(</span><span class="ident" id="8445920">s</span><span class="op" id="8445921">,</span>&nbsp;<span class="string" id="8445923">&#34;\xff\xda&#34;</span><span class="op" id="8445933">)</span>&nbsp;<span class="op" id="8445935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8445939">t</span><span class="op" id="8445940">.</span><span class="ident" id="8445941">Fatalf</span><span class="op" id="8445947">(</span><span class="string" id="8445948">&#34;encoded&nbsp;JPEG&nbsp;does&nbsp;not&nbsp;contain&nbsp;a&nbsp;SOS&nbsp;marker&nbsp;(ff&nbsp;da)&nbsp;near&nbsp;the&nbsp;end:&nbsp;%&nbsp;x&#34;</span><span class="op" id="8446018">,</span>&nbsp;<span class="ident" id="8446020">s</span><span class="op" id="8446021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8446024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8446027">//&nbsp;Test&nbsp;that&nbsp;adding&nbsp;some&nbsp;random&nbsp;junk&nbsp;between&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8446096">//&nbsp;EOI&nbsp;marker&nbsp;does&nbsp;not&nbsp;affect&nbsp;the&nbsp;decoding.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8446141">rnd</span>&nbsp;<span class="op" id="8446145">:=</span>&nbsp;<span class="ident" id="8446148">rand</span><span class="op" id="8446152">.</span><span class="ident" id="8446153">New</span><span class="op" id="8446156">(</span><span class="ident" id="8446157">rand</span><span class="op" id="8446161">.</span><span class="ident" id="8446162">NewSource</span><span class="op" id="8446171">(</span><span class="num" id="8446172">1</span><span class="op" id="8446173">)</span><span class="op" id="8446174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8446177">for</span>&nbsp;<span class="ident" id="8446181">i</span><span class="op" id="8446182">,</span>&nbsp;<span class="ident" id="8446184">nerr</span>&nbsp;<span class="op" id="8446189">:=</span>&nbsp;<span class="num" id="8446192">0</span><span class="op" id="8446193">,</span>&nbsp;<span class="num" id="8446195">0</span><span class="op" id="8446196">;</span>&nbsp;<span class="ident" id="8446198">i</span>&nbsp;<span class="op" id="8446200">&lt;</span>&nbsp;<span class="num" id="8446202">1000</span>&nbsp;<span class="op" id="8446207">&amp;&amp;</span>&nbsp;<span class="ident" id="8446210">nerr</span>&nbsp;<span class="op" id="8446215">&lt;</span>&nbsp;<span class="num" id="8446217">10</span><span class="op" id="8446219">;</span>&nbsp;<span class="ident" id="8446221">i</span><span class="op" id="8446222">++</span>&nbsp;<span class="op" id="8446225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8446229">buf</span><span class="op" id="8446232">.</span><span class="ident" id="8446233">Reset</span><span class="op" id="8446238">(</span><span class="op" id="8446239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8446243">//&nbsp;Write&nbsp;all&nbsp;but&nbsp;the&nbsp;trailing&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8446298">buf</span><span class="op" id="8446301">.</span><span class="ident" id="8446302">WriteString</span><span class="op" id="8446313">(</span><span class="ident" id="8446314">enc</span><span class="op" id="8446317">[</span><span class="op" id="8446318">:</span><span class="builtinfunc" id="8446319">len</span><span class="op" id="8446322">(</span><span class="ident" id="8446323">enc</span><span class="op" id="8446326">)</span><span class="op" id="8446327">-</span><span class="num" id="8446328">2</span><span class="op" id="8446329">]</span><span class="op" id="8446330">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8446334">//&nbsp;Write&nbsp;some&nbsp;random&nbsp;extraneous&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8446374">for</span>&nbsp;<span class="ident" id="8446378">n</span>&nbsp;<span class="op" id="8446380">:=</span>&nbsp;<span class="ident" id="8446383">rnd</span><span class="op" id="8446386">.</span><span class="ident" id="8446387">Intn</span><span class="op" id="8446391">(</span><span class="num" id="8446392">10</span><span class="op" id="8446394">)</span><span class="op" id="8446395">;</span>&nbsp;<span class="ident" id="8446397">n</span>&nbsp;<span class="op" id="8446399">&gt;</span>&nbsp;<span class="num" id="8446401">0</span><span class="op" id="8446402">;</span>&nbsp;<span class="ident" id="8446404">n</span><span class="op" id="8446405">--</span>&nbsp;<span class="op" id="8446408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8446413">if</span>&nbsp;<span class="ident" id="8446416">x</span>&nbsp;<span class="op" id="8446418">:=</span>&nbsp;<span class="builtintype" id="8446421">byte</span><span class="op" id="8446425">(</span><span class="ident" id="8446426">rnd</span><span class="op" id="8446429">.</span><span class="ident" id="8446430">Intn</span><span class="op" id="8446434">(</span><span class="num" id="8446435">256</span><span class="op" id="8446438">)</span><span class="op" id="8446439">)</span><span class="op" id="8446440">;</span>&nbsp;<span class="ident" id="8446442">x</span>&nbsp;<span class="op" id="8446444">!=</span>&nbsp;<span class="num" id="8446447">0xff</span>&nbsp;<span class="op" id="8446452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8446458">buf</span><span class="op" id="8446461">.</span><span class="ident" id="8446462">WriteByte</span><span class="op" id="8446471">(</span><span class="ident" id="8446472">x</span><span class="op" id="8446473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8446478">}</span>&nbsp;<span class="keyword" id="8446480">else</span>&nbsp;<span class="op" id="8446485">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8446491">//&nbsp;The&nbsp;JPEG&nbsp;format&nbsp;escapes&nbsp;a&nbsp;SOS&nbsp;0xff&nbsp;data&nbsp;byte&nbsp;as&nbsp;&#34;\xff\x00&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8446558">buf</span><span class="op" id="8446561">.</span><span class="ident" id="8446562">WriteString</span><span class="op" id="8446573">(</span><span class="string" id="8446574">&#34;\xff\x00&#34;</span><span class="op" id="8446584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8446589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8446593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8446597">//&nbsp;Write&nbsp;the&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8446635">buf</span><span class="op" id="8446638">.</span><span class="ident" id="8446639">WriteString</span><span class="op" id="8446650">(</span><span class="string" id="8446651">&#34;\xff\xd9&#34;</span><span class="op" id="8446661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8446666">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;can&nbsp;still&nbsp;decode&nbsp;the&nbsp;resultant&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8446723">got</span><span class="op" id="8446726">,</span>&nbsp;<span class="ident" id="8446728">err</span>&nbsp;<span class="op" id="8446732">:=</span>&nbsp;<span class="ident" id="8446735">Decode</span><span class="op" id="8446741">(</span><span class="ident" id="8446742">buf</span><span class="op" id="8446745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8446749">if</span>&nbsp;<span class="ident" id="8446752">err</span>&nbsp;<span class="op" id="8446756">!=</span>&nbsp;<span class="builtintype" id="8446759">nil</span>&nbsp;<span class="op" id="8446763">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8446768">t</span><span class="op" id="8446769">.</span><span class="ident" id="8446770">Errorf</span><span class="op" id="8446776">(</span><span class="string" id="8446777">&#34;could&nbsp;not&nbsp;decode&nbsp;image&nbsp;#%d:&nbsp;%v&#34;</span><span class="op" id="8446809">,</span>&nbsp;<span class="ident" id="8446811">i</span><span class="op" id="8446812">,</span>&nbsp;<span class="ident" id="8446814">err</span><span class="op" id="8446817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8446822">nerr</span><span class="op" id="8446826">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8446832">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8446843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8446847">if</span>&nbsp;<span class="ident" id="8446850">got</span><span class="op" id="8446853">.</span><span class="ident" id="8446854">Bounds</span><span class="op" id="8446860">(</span><span class="op" id="8446861">)</span>&nbsp;<span class="op" id="8446863">!=</span>&nbsp;<span class="ident" id="8446866">src</span><span class="op" id="8446869">.</span><span class="ident" id="8446870">Bounds</span><span class="op" id="8446876">(</span><span class="op" id="8446877">)</span>&nbsp;<span class="op" id="8446879">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8446884">t</span><span class="op" id="8446885">.</span><span class="ident" id="8446886">Errorf</span><span class="op" id="8446892">(</span><span class="string" id="8446893">&#34;image&nbsp;#%d,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8446930">,</span>&nbsp;<span class="ident" id="8446932">i</span><span class="op" id="8446933">,</span>&nbsp;<span class="ident" id="8446935">got</span><span class="op" id="8446938">.</span><span class="ident" id="8446939">Bounds</span><span class="op" id="8446945">(</span><span class="op" id="8446946">)</span><span class="op" id="8446947">,</span>&nbsp;<span class="ident" id="8446949">src</span><span class="op" id="8446952">.</span><span class="ident" id="8446953">Bounds</span><span class="op" id="8446959">(</span><span class="op" id="8446960">)</span><span class="op" id="8446961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8446966">nerr</span><span class="op" id="8446970">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8446976">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8446987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8446991">if</span>&nbsp;<span class="ident" id="8446994">averageDelta</span><span class="op" id="8447006">(</span><span class="ident" id="8447007">got</span><span class="op" id="8447010">,</span>&nbsp;<span class="ident" id="8447012">src</span><span class="op" id="8447015">)</span>&nbsp;<span class="op" id="8447017">&gt;</span>&nbsp;<span class="num" id="8447019">2</span><span class="op" id="8447020">&lt;&lt;</span><span class="num" id="8447022">8</span>&nbsp;<span class="op" id="8447024">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447029">t</span><span class="op" id="8447030">.</span><span class="ident" id="8447031">Errorf</span><span class="op" id="8447037">(</span><span class="string" id="8447038">&#34;image&nbsp;#%d&nbsp;changed&nbsp;too&nbsp;much&nbsp;after&nbsp;a&nbsp;round&nbsp;trip&#34;</span><span class="op" id="8447085">,</span>&nbsp;<span class="ident" id="8447087">i</span><span class="op" id="8447088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447093">nerr</span><span class="op" id="8447097">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8447103">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8447114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8447117">}</span><br>
<span class="lineno">245</span><span class="op" id="8447119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8447122">func</span>&nbsp;<span class="ident" id="8447127">benchmarkDecode</span><span class="op" id="8447142">(</span><span class="ident" id="8447143">b</span>&nbsp;<span class="op" id="8447145">*</span><span class="ident" id="8447146">testing</span><span class="op" id="8447153">.</span><span class="ident" id="8447154">B</span><span class="op" id="8447155">,</span>&nbsp;<span class="ident" id="8447157">filename</span>&nbsp;<span class="builtintype" id="8447166">string</span><span class="op" id="8447172">)</span>&nbsp;<span class="op" id="8447174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447177">b</span><span class="op" id="8447178">.</span><span class="ident" id="8447179">StopTimer</span><span class="op" id="8447188">(</span><span class="op" id="8447189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447192">data</span><span class="op" id="8447196">,</span>&nbsp;<span class="ident" id="8447198">err</span>&nbsp;<span class="op" id="8447202">:=</span>&nbsp;<span class="ident" id="8447205">ioutil</span><span class="op" id="8447211">.</span><span class="ident" id="8447212">ReadFile</span><span class="op" id="8447220">(</span><span class="ident" id="8447221">filename</span><span class="op" id="8447229">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8447232">if</span>&nbsp;<span class="ident" id="8447235">err</span>&nbsp;<span class="op" id="8447239">!=</span>&nbsp;<span class="builtintype" id="8447242">nil</span>&nbsp;<span class="op" id="8447246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447250">b</span><span class="op" id="8447251">.</span><span class="ident" id="8447252">Fatal</span><span class="op" id="8447257">(</span><span class="ident" id="8447258">err</span><span class="op" id="8447261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8447264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447267">cfg</span><span class="op" id="8447270">,</span>&nbsp;<span class="ident" id="8447272">err</span>&nbsp;<span class="op" id="8447276">:=</span>&nbsp;<span class="ident" id="8447279">DecodeConfig</span><span class="op" id="8447291">(</span><span class="ident" id="8447292">bytes</span><span class="op" id="8447297">.</span><span class="ident" id="8447298">NewReader</span><span class="op" id="8447307">(</span><span class="ident" id="8447308">data</span><span class="op" id="8447312">)</span><span class="op" id="8447313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8447316">if</span>&nbsp;<span class="ident" id="8447319">err</span>&nbsp;<span class="op" id="8447323">!=</span>&nbsp;<span class="builtintype" id="8447326">nil</span>&nbsp;<span class="op" id="8447330">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447334">b</span><span class="op" id="8447335">.</span><span class="ident" id="8447336">Fatal</span><span class="op" id="8447341">(</span><span class="ident" id="8447342">err</span><span class="op" id="8447345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8447348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447351">b</span><span class="op" id="8447352">.</span><span class="ident" id="8447353">SetBytes</span><span class="op" id="8447361">(</span><span class="builtintype" id="8447362">int64</span><span class="op" id="8447367">(</span><span class="ident" id="8447368">cfg</span><span class="op" id="8447371">.</span><span class="ident" id="8447372">Width</span>&nbsp;<span class="op" id="8447378">*</span>&nbsp;<span class="ident" id="8447380">cfg</span><span class="op" id="8447383">.</span><span class="ident" id="8447384">Height</span>&nbsp;<span class="op" id="8447391">*</span>&nbsp;<span class="num" id="8447393">4</span><span class="op" id="8447394">)</span><span class="op" id="8447395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447398">b</span><span class="op" id="8447399">.</span><span class="ident" id="8447400">StartTimer</span><span class="op" id="8447410">(</span><span class="op" id="8447411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8447414">for</span>&nbsp;<span class="ident" id="8447418">i</span>&nbsp;<span class="op" id="8447420">:=</span>&nbsp;<span class="num" id="8447423">0</span><span class="op" id="8447424">;</span>&nbsp;<span class="ident" id="8447426">i</span>&nbsp;<span class="op" id="8447428">&lt;</span>&nbsp;<span class="ident" id="8447430">b</span><span class="op" id="8447431">.</span><span class="ident" id="8447432">N</span><span class="op" id="8447433">;</span>&nbsp;<span class="ident" id="8447435">i</span><span class="op" id="8447436">++</span>&nbsp;<span class="op" id="8447439">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447443">Decode</span><span class="op" id="8447449">(</span><span class="ident" id="8447450">bytes</span><span class="op" id="8447455">.</span><span class="ident" id="8447456">NewReader</span><span class="op" id="8447465">(</span><span class="ident" id="8447466">data</span><span class="op" id="8447470">)</span><span class="op" id="8447471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8447474">}</span><br>
<span class="lineno"></span><span class="op" id="8447476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8447479">func</span>&nbsp;<span class="ident" id="8447484">BenchmarkDecodeBaseline</span><span class="op" id="8447507">(</span><span class="ident" id="8447508">b</span>&nbsp;<span class="op" id="8447510">*</span><span class="ident" id="8447511">testing</span><span class="op" id="8447518">.</span><span class="ident" id="8447519">B</span><span class="op" id="8447520">)</span>&nbsp;<span class="op" id="8447522">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447525">benchmarkDecode</span><span class="op" id="8447540">(</span><span class="ident" id="8447541">b</span><span class="op" id="8447542">,</span>&nbsp;<span class="string" id="8447544">&#34;../testdata/video-001.jpeg&#34;</span><span class="op" id="8447572">)</span><br>
<span class="lineno"></span><span class="op" id="8447574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8447577">func</span>&nbsp;<span class="ident" id="8447582">BenchmarkDecodeProgressive</span><span class="op" id="8447608">(</span><span class="ident" id="8447609">b</span>&nbsp;<span class="op" id="8447611">*</span><span class="ident" id="8447612">testing</span><span class="op" id="8447619">.</span><span class="ident" id="8447620">B</span><span class="op" id="8447621">)</span>&nbsp;<span class="op" id="8447623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8447626">benchmarkDecode</span><span class="op" id="8447641">(</span><span class="ident" id="8447642">b</span><span class="op" id="8447643">,</span>&nbsp;<span class="string" id="8447645">&#34;../testdata/video-001.progressive.jpeg&#34;</span><span class="op" id="8447685">)</span><br>
<span class="lineno">270</span><span class="op" id="8447687">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
