<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6304444">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6304499">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6304553">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6304604">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6304637">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="6304701">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="6304766">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="6304797">//</span><br>
<span class="lineno"></span><span class="comment" id="6304800">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="6304858">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="6304919">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="6304939">package</span>&nbsp;<span class="ident" id="6304947">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6304955">import</span>&nbsp;<span class="op" id="6304962">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6304965">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6304975">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6304982">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6304989">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6304996">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6305002">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6305013">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6305021">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6305028">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6305031">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6305091">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6305161">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="6305230">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="6305267">type</span>&nbsp;<span class="ident" id="6305272">Priority</span>&nbsp;<span class="builtintype" id="6305281">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6305286">const</span>&nbsp;<span class="ident" id="6305292">severityMask</span>&nbsp;<span class="op" id="6305305">=</span>&nbsp;<span class="num" id="6305307">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="6305312">const</span>&nbsp;<span class="ident" id="6305318">facilityMask</span>&nbsp;<span class="op" id="6305331">=</span>&nbsp;<span class="num" id="6305333">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6305339">const</span>&nbsp;<span class="op" id="6305345">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305348">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305363">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305399">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305447">LOG_EMERG</span>&nbsp;<span class="ident" id="6305457">Priority</span>&nbsp;<span class="op" id="6305466">=</span>&nbsp;<span class="ident" id="6305468">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305474">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305485">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305495">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305504">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305517">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305529">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305539">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="6305549">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6305552">const</span>&nbsp;<span class="op" id="6305558">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305561">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305576">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305612">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305674">LOG_KERN</span>&nbsp;<span class="ident" id="6305683">Priority</span>&nbsp;<span class="op" id="6305692">=</span>&nbsp;<span class="ident" id="6305694">iota</span>&nbsp;<span class="op" id="6305699">&lt;&lt;</span>&nbsp;<span class="num" id="6305702">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305705">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305715">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305725">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305737">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305747">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305759">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305768">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305778">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305788">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305798">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305812">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305821">_</span>&nbsp;<span class="comment" id="6305823">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305834">_</span>&nbsp;<span class="comment" id="6305836">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305847">_</span>&nbsp;<span class="comment" id="6305849">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305860">_</span>&nbsp;<span class="comment" id="6305862">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305873">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305885">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305897">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305909">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305921">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305933">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305945">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305957">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="6305968">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6305971">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6306019">type</span>&nbsp;<span class="ident" id="6306024">Writer</span>&nbsp;<span class="keyword" id="6306031">struct</span>&nbsp;<span class="op" id="6306038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306041">priority</span>&nbsp;<span class="ident" id="6306050">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306060">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6306069">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306077">hostname</span>&nbsp;<span class="builtintype" id="6306086">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306094">network</span>&nbsp;&nbsp;<span class="builtintype" id="6306103">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306111">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6306120">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306129">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6306134">sync</span><span class="op" id="6306138">.</span><span class="ident" id="6306139">Mutex</span>&nbsp;<span class="comment" id="6306145">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306161">conn</span>&nbsp;<span class="ident" id="6306166">serverConn</span><br>
<span class="lineno"></span><span class="op" id="6306177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6306180">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="6306245">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6306313">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="6306378">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6306449">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="6306519">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="6306547">type</span>&nbsp;<span class="ident" id="6306552">serverConn</span>&nbsp;<span class="keyword" id="6306563">interface</span>&nbsp;<span class="op" id="6306573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306576">writeString</span><span class="op" id="6306587">(</span><span class="ident" id="6306588">p</span>&nbsp;<span class="ident" id="6306590">Priority</span><span class="op" id="6306598">,</span>&nbsp;<span class="ident" id="6306600">hostname</span><span class="op" id="6306608">,</span>&nbsp;<span class="ident" id="6306610">tag</span><span class="op" id="6306613">,</span>&nbsp;<span class="ident" id="6306615">s</span><span class="op" id="6306616">,</span>&nbsp;<span class="ident" id="6306618">nl</span>&nbsp;<span class="builtintype" id="6306621">string</span><span class="op" id="6306627">)</span>&nbsp;<span class="builtintype" id="6306629">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6306636">close</span><span class="op" id="6306641">(</span><span class="op" id="6306642">)</span>&nbsp;<span class="builtintype" id="6306644">error</span><br>
<span class="lineno"></span><span class="op" id="6306650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6306653">type</span>&nbsp;<span class="ident" id="6306658">netConn</span>&nbsp;<span class="keyword" id="6306666">struct</span>&nbsp;<span class="op" id="6306673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306676">local</span>&nbsp;<span class="builtintype" id="6306682">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306688">conn</span>&nbsp;&nbsp;<span class="ident" id="6306694">net</span><span class="op" id="6306697">.</span><span class="ident" id="6306698">Conn</span><br>
<span class="lineno"></span><span class="op" id="6306703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6306706">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="6306774">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6306841">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6306865">func</span>&nbsp;<span class="ident" id="6306870">New</span><span class="op" id="6306873">(</span><span class="ident" id="6306874">priority</span>&nbsp;<span class="ident" id="6306883">Priority</span><span class="op" id="6306891">,</span>&nbsp;<span class="ident" id="6306893">tag</span>&nbsp;<span class="builtintype" id="6306897">string</span><span class="op" id="6306903">)</span>&nbsp;<span class="op" id="6306905">(</span><span class="ident" id="6306906">w</span>&nbsp;<span class="op" id="6306908">*</span><span class="ident" id="6306909">Writer</span><span class="op" id="6306915">,</span>&nbsp;<span class="ident" id="6306917">err</span>&nbsp;<span class="builtintype" id="6306921">error</span><span class="op" id="6306926">)</span>&nbsp;<span class="op" id="6306928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306931">return</span>&nbsp;<span class="ident" id="6306938">Dial</span><span class="op" id="6306942">(</span><span class="string" id="6306943">&#34;&#34;</span><span class="op" id="6306945">,</span>&nbsp;<span class="string" id="6306947">&#34;&#34;</span><span class="op" id="6306949">,</span>&nbsp;<span class="ident" id="6306951">priority</span><span class="op" id="6306959">,</span>&nbsp;<span class="ident" id="6306961">tag</span><span class="op" id="6306964">)</span><br>
<span class="lineno">115</span><span class="op" id="6306966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6306969">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6307035">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6307106">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="6307174">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="6307182">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6307252">func</span>&nbsp;<span class="ident" id="6307257">Dial</span><span class="op" id="6307261">(</span><span class="ident" id="6307262">network</span><span class="op" id="6307269">,</span>&nbsp;<span class="ident" id="6307271">raddr</span>&nbsp;<span class="builtintype" id="6307277">string</span><span class="op" id="6307283">,</span>&nbsp;<span class="ident" id="6307285">priority</span>&nbsp;<span class="ident" id="6307294">Priority</span><span class="op" id="6307302">,</span>&nbsp;<span class="ident" id="6307304">tag</span>&nbsp;<span class="builtintype" id="6307308">string</span><span class="op" id="6307314">)</span>&nbsp;<span class="op" id="6307316">(</span><span class="op" id="6307317">*</span><span class="ident" id="6307318">Writer</span><span class="op" id="6307324">,</span>&nbsp;<span class="builtintype" id="6307326">error</span><span class="op" id="6307331">)</span>&nbsp;<span class="op" id="6307333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307336">if</span>&nbsp;<span class="ident" id="6307339">priority</span>&nbsp;<span class="op" id="6307348">&lt;</span>&nbsp;<span class="num" id="6307350">0</span>&nbsp;<span class="op" id="6307352">||</span>&nbsp;<span class="ident" id="6307355">priority</span>&nbsp;<span class="op" id="6307364">&gt;</span>&nbsp;<span class="ident" id="6307366">LOG_LOCAL7</span><span class="op" id="6307376">|</span><span class="ident" id="6307377">LOG_DEBUG</span>&nbsp;<span class="op" id="6307387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307391">return</span>&nbsp;<span class="ident" id="6307398">nil</span><span class="op" id="6307401">,</span>&nbsp;<span class="ident" id="6307403">errors</span><span class="op" id="6307409">.</span><span class="ident" id="6307410">New</span><span class="op" id="6307413">(</span><span class="string" id="6307414">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="6307444">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307451">if</span>&nbsp;<span class="ident" id="6307454">tag</span>&nbsp;<span class="op" id="6307458">==</span>&nbsp;<span class="string" id="6307461">&#34;&#34;</span>&nbsp;<span class="op" id="6307464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307468">tag</span>&nbsp;<span class="op" id="6307472">=</span>&nbsp;<span class="ident" id="6307474">os</span><span class="op" id="6307476">.</span><span class="ident" id="6307477">Args</span><span class="op" id="6307481">[</span><span class="num" id="6307482">0</span><span class="op" id="6307483">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307486">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307489">hostname</span><span class="op" id="6307497">,</span>&nbsp;<span class="ident" id="6307499">_</span>&nbsp;<span class="op" id="6307501">:=</span>&nbsp;<span class="ident" id="6307504">os</span><span class="op" id="6307506">.</span><span class="ident" id="6307507">Hostname</span><span class="op" id="6307515">(</span><span class="op" id="6307516">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307520">w</span>&nbsp;<span class="op" id="6307522">:=</span>&nbsp;<span class="op" id="6307525">&amp;</span><span class="ident" id="6307526">Writer</span><span class="op" id="6307532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307536">priority</span><span class="op" id="6307544">:</span>&nbsp;<span class="ident" id="6307546">priority</span><span class="op" id="6307554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307558">tag</span><span class="op" id="6307561">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307568">tag</span><span class="op" id="6307571">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307575">hostname</span><span class="op" id="6307583">:</span>&nbsp;<span class="ident" id="6307585">hostname</span><span class="op" id="6307593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307597">network</span><span class="op" id="6307604">:</span>&nbsp;&nbsp;<span class="ident" id="6307607">network</span><span class="op" id="6307614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307618">raddr</span><span class="op" id="6307623">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307628">raddr</span><span class="op" id="6307633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307640">w</span><span class="op" id="6307641">.</span><span class="ident" id="6307642">mu</span><span class="op" id="6307644">.</span><span class="ident" id="6307645">Lock</span><span class="op" id="6307649">(</span><span class="op" id="6307650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307653">defer</span>&nbsp;<span class="ident" id="6307659">w</span><span class="op" id="6307660">.</span><span class="ident" id="6307661">mu</span><span class="op" id="6307663">.</span><span class="ident" id="6307664">Unlock</span><span class="op" id="6307670">(</span><span class="op" id="6307671">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307675">err</span>&nbsp;<span class="op" id="6307679">:=</span>&nbsp;<span class="ident" id="6307682">w</span><span class="op" id="6307683">.</span><span class="ident" id="6307684">connect</span><span class="op" id="6307691">(</span><span class="op" id="6307692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307695">if</span>&nbsp;<span class="ident" id="6307698">err</span>&nbsp;<span class="op" id="6307702">!=</span>&nbsp;<span class="ident" id="6307705">nil</span>&nbsp;<span class="op" id="6307709">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307713">return</span>&nbsp;<span class="ident" id="6307720">nil</span><span class="op" id="6307723">,</span>&nbsp;<span class="ident" id="6307725">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307733">return</span>&nbsp;<span class="ident" id="6307740">w</span><span class="op" id="6307741">,</span>&nbsp;<span class="ident" id="6307743">err</span><br>
<span class="lineno"></span><span class="op" id="6307747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6307750">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6307802">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="6307839">func</span>&nbsp;<span class="op" id="6307844">(</span><span class="ident" id="6307845">w</span>&nbsp;<span class="op" id="6307847">*</span><span class="ident" id="6307848">Writer</span><span class="op" id="6307854">)</span>&nbsp;<span class="ident" id="6307856">connect</span><span class="op" id="6307863">(</span><span class="op" id="6307864">)</span>&nbsp;<span class="op" id="6307866">(</span><span class="ident" id="6307867">err</span>&nbsp;<span class="builtintype" id="6307871">error</span><span class="op" id="6307876">)</span>&nbsp;<span class="op" id="6307878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307881">if</span>&nbsp;<span class="ident" id="6307884">w</span><span class="op" id="6307885">.</span><span class="ident" id="6307886">conn</span>&nbsp;<span class="op" id="6307891">!=</span>&nbsp;<span class="ident" id="6307894">nil</span>&nbsp;<span class="op" id="6307898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6307902">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307964">w</span><span class="op" id="6307965">.</span><span class="ident" id="6307966">conn</span><span class="op" id="6307970">.</span><span class="builtinfunc" id="6307971">close</span><span class="op" id="6307976">(</span><span class="op" id="6307977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307981">w</span><span class="op" id="6307982">.</span><span class="ident" id="6307983">conn</span>&nbsp;<span class="op" id="6307988">=</span>&nbsp;<span class="ident" id="6307990">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307999">if</span>&nbsp;<span class="ident" id="6308002">w</span><span class="op" id="6308003">.</span><span class="ident" id="6308004">network</span>&nbsp;<span class="op" id="6308012">==</span>&nbsp;<span class="string" id="6308015">&#34;&#34;</span>&nbsp;<span class="op" id="6308018">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308022">w</span><span class="op" id="6308023">.</span><span class="ident" id="6308024">conn</span><span class="op" id="6308028">,</span>&nbsp;<span class="ident" id="6308030">err</span>&nbsp;<span class="op" id="6308034">=</span>&nbsp;<span class="ident" id="6308036">unixSyslog</span><span class="op" id="6308046">(</span><span class="op" id="6308047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308051">if</span>&nbsp;<span class="ident" id="6308054">w</span><span class="op" id="6308055">.</span><span class="ident" id="6308056">hostname</span>&nbsp;<span class="op" id="6308065">==</span>&nbsp;<span class="string" id="6308068">&#34;&#34;</span>&nbsp;<span class="op" id="6308071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308076">w</span><span class="op" id="6308077">.</span><span class="ident" id="6308078">hostname</span>&nbsp;<span class="op" id="6308087">=</span>&nbsp;<span class="string" id="6308089">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308106">}</span>&nbsp;<span class="keyword" id="6308108">else</span>&nbsp;<span class="op" id="6308113">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308117">var</span>&nbsp;<span class="ident" id="6308121">c</span>&nbsp;<span class="ident" id="6308123">net</span><span class="op" id="6308126">.</span><span class="ident" id="6308127">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308134">c</span><span class="op" id="6308135">,</span>&nbsp;<span class="ident" id="6308137">err</span>&nbsp;<span class="op" id="6308141">=</span>&nbsp;<span class="ident" id="6308143">net</span><span class="op" id="6308146">.</span><span class="ident" id="6308147">Dial</span><span class="op" id="6308151">(</span><span class="ident" id="6308152">w</span><span class="op" id="6308153">.</span><span class="ident" id="6308154">network</span><span class="op" id="6308161">,</span>&nbsp;<span class="ident" id="6308163">w</span><span class="op" id="6308164">.</span><span class="ident" id="6308165">raddr</span><span class="op" id="6308170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308174">if</span>&nbsp;<span class="ident" id="6308177">err</span>&nbsp;<span class="op" id="6308181">==</span>&nbsp;<span class="ident" id="6308184">nil</span>&nbsp;<span class="op" id="6308188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308193">w</span><span class="op" id="6308194">.</span><span class="ident" id="6308195">conn</span>&nbsp;<span class="op" id="6308200">=</span>&nbsp;<span class="op" id="6308202">&amp;</span><span class="ident" id="6308203">netConn</span><span class="op" id="6308210">{</span><span class="ident" id="6308211">conn</span><span class="op" id="6308215">:</span>&nbsp;<span class="ident" id="6308217">c</span><span class="op" id="6308218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308223">if</span>&nbsp;<span class="ident" id="6308226">w</span><span class="op" id="6308227">.</span><span class="ident" id="6308228">hostname</span>&nbsp;<span class="op" id="6308237">==</span>&nbsp;<span class="string" id="6308240">&#34;&#34;</span>&nbsp;<span class="op" id="6308243">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308249">w</span><span class="op" id="6308250">.</span><span class="ident" id="6308251">hostname</span>&nbsp;<span class="op" id="6308260">=</span>&nbsp;<span class="ident" id="6308262">c</span><span class="op" id="6308263">.</span><span class="ident" id="6308264">LocalAddr</span><span class="op" id="6308273">(</span><span class="op" id="6308274">)</span><span class="op" id="6308275">.</span><span class="ident" id="6308276">String</span><span class="op" id="6308282">(</span><span class="op" id="6308283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308298">return</span><br>
<span class="lineno">175</span><span class="op" id="6308305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6308308">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6308359">func</span>&nbsp;<span class="op" id="6308364">(</span><span class="ident" id="6308365">w</span>&nbsp;<span class="op" id="6308367">*</span><span class="ident" id="6308368">Writer</span><span class="op" id="6308374">)</span>&nbsp;<span class="ident" id="6308376">Write</span><span class="op" id="6308381">(</span><span class="ident" id="6308382">b</span>&nbsp;<span class="op" id="6308384">[</span><span class="op" id="6308385">]</span><span class="builtintype" id="6308386">byte</span><span class="op" id="6308390">)</span>&nbsp;<span class="op" id="6308392">(</span><span class="builtintype" id="6308393">int</span><span class="op" id="6308396">,</span>&nbsp;<span class="builtintype" id="6308398">error</span><span class="op" id="6308403">)</span>&nbsp;<span class="op" id="6308405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308408">return</span>&nbsp;<span class="ident" id="6308415">w</span><span class="op" id="6308416">.</span><span class="ident" id="6308417">writeAndRetry</span><span class="op" id="6308430">(</span><span class="ident" id="6308431">w</span><span class="op" id="6308432">.</span><span class="ident" id="6308433">priority</span><span class="op" id="6308441">,</span>&nbsp;<span class="builtintype" id="6308443">string</span><span class="op" id="6308449">(</span><span class="ident" id="6308450">b</span><span class="op" id="6308451">)</span><span class="op" id="6308452">)</span><br>
<span class="lineno">180</span><span class="op" id="6308454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6308457">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6308508">func</span>&nbsp;<span class="op" id="6308513">(</span><span class="ident" id="6308514">w</span>&nbsp;<span class="op" id="6308516">*</span><span class="ident" id="6308517">Writer</span><span class="op" id="6308523">)</span>&nbsp;<span class="ident" id="6308525">Close</span><span class="op" id="6308530">(</span><span class="op" id="6308531">)</span>&nbsp;<span class="builtintype" id="6308533">error</span>&nbsp;<span class="op" id="6308539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308542">w</span><span class="op" id="6308543">.</span><span class="ident" id="6308544">mu</span><span class="op" id="6308546">.</span><span class="ident" id="6308547">Lock</span><span class="op" id="6308551">(</span><span class="op" id="6308552">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308555">defer</span>&nbsp;<span class="ident" id="6308561">w</span><span class="op" id="6308562">.</span><span class="ident" id="6308563">mu</span><span class="op" id="6308565">.</span><span class="ident" id="6308566">Unlock</span><span class="op" id="6308572">(</span><span class="op" id="6308573">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308577">if</span>&nbsp;<span class="ident" id="6308580">w</span><span class="op" id="6308581">.</span><span class="ident" id="6308582">conn</span>&nbsp;<span class="op" id="6308587">!=</span>&nbsp;<span class="ident" id="6308590">nil</span>&nbsp;<span class="op" id="6308594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308598">err</span>&nbsp;<span class="op" id="6308602">:=</span>&nbsp;<span class="ident" id="6308605">w</span><span class="op" id="6308606">.</span><span class="ident" id="6308607">conn</span><span class="op" id="6308611">.</span><span class="builtinfunc" id="6308612">close</span><span class="op" id="6308617">(</span><span class="op" id="6308618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308622">w</span><span class="op" id="6308623">.</span><span class="ident" id="6308624">conn</span>&nbsp;<span class="op" id="6308629">=</span>&nbsp;<span class="ident" id="6308631">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308637">return</span>&nbsp;<span class="ident" id="6308644">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308652">return</span>&nbsp;<span class="ident" id="6308659">nil</span><br>
<span class="lineno"></span><span class="op" id="6308663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="6308666">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6308737">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6308755">func</span>&nbsp;<span class="op" id="6308760">(</span><span class="ident" id="6308761">w</span>&nbsp;<span class="op" id="6308763">*</span><span class="ident" id="6308764">Writer</span><span class="op" id="6308770">)</span>&nbsp;<span class="ident" id="6308772">Emerg</span><span class="op" id="6308777">(</span><span class="ident" id="6308778">m</span>&nbsp;<span class="builtintype" id="6308780">string</span><span class="op" id="6308786">)</span>&nbsp;<span class="op" id="6308788">(</span><span class="ident" id="6308789">err</span>&nbsp;<span class="builtintype" id="6308793">error</span><span class="op" id="6308798">)</span>&nbsp;<span class="op" id="6308800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308803">_</span><span class="op" id="6308804">,</span>&nbsp;<span class="ident" id="6308806">err</span>&nbsp;<span class="op" id="6308810">=</span>&nbsp;<span class="ident" id="6308812">w</span><span class="op" id="6308813">.</span><span class="ident" id="6308814">writeAndRetry</span><span class="op" id="6308827">(</span><span class="ident" id="6308828">LOG_EMERG</span><span class="op" id="6308837">,</span>&nbsp;<span class="ident" id="6308839">m</span><span class="op" id="6308840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308843">return</span>&nbsp;<span class="ident" id="6308850">err</span><br>
<span class="lineno">200</span><span class="op" id="6308854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6308857">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6308928">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6308946">func</span>&nbsp;<span class="op" id="6308951">(</span><span class="ident" id="6308952">w</span>&nbsp;<span class="op" id="6308954">*</span><span class="ident" id="6308955">Writer</span><span class="op" id="6308961">)</span>&nbsp;<span class="ident" id="6308963">Alert</span><span class="op" id="6308968">(</span><span class="ident" id="6308969">m</span>&nbsp;<span class="builtintype" id="6308971">string</span><span class="op" id="6308977">)</span>&nbsp;<span class="op" id="6308979">(</span><span class="ident" id="6308980">err</span>&nbsp;<span class="builtintype" id="6308984">error</span><span class="op" id="6308989">)</span>&nbsp;<span class="op" id="6308991">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308994">_</span><span class="op" id="6308995">,</span>&nbsp;<span class="ident" id="6308997">err</span>&nbsp;<span class="op" id="6309001">=</span>&nbsp;<span class="ident" id="6309003">w</span><span class="op" id="6309004">.</span><span class="ident" id="6309005">writeAndRetry</span><span class="op" id="6309018">(</span><span class="ident" id="6309019">LOG_ALERT</span><span class="op" id="6309028">,</span>&nbsp;<span class="ident" id="6309030">m</span><span class="op" id="6309031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309034">return</span>&nbsp;<span class="ident" id="6309041">err</span><br>
<span class="lineno"></span><span class="op" id="6309045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6309048">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="6309117">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6309135">func</span>&nbsp;<span class="op" id="6309140">(</span><span class="ident" id="6309141">w</span>&nbsp;<span class="op" id="6309143">*</span><span class="ident" id="6309144">Writer</span><span class="op" id="6309150">)</span>&nbsp;<span class="ident" id="6309152">Crit</span><span class="op" id="6309156">(</span><span class="ident" id="6309157">m</span>&nbsp;<span class="builtintype" id="6309159">string</span><span class="op" id="6309165">)</span>&nbsp;<span class="op" id="6309167">(</span><span class="ident" id="6309168">err</span>&nbsp;<span class="builtintype" id="6309172">error</span><span class="op" id="6309177">)</span>&nbsp;<span class="op" id="6309179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309182">_</span><span class="op" id="6309183">,</span>&nbsp;<span class="ident" id="6309185">err</span>&nbsp;<span class="op" id="6309189">=</span>&nbsp;<span class="ident" id="6309191">w</span><span class="op" id="6309192">.</span><span class="ident" id="6309193">writeAndRetry</span><span class="op" id="6309206">(</span><span class="ident" id="6309207">LOG_CRIT</span><span class="op" id="6309215">,</span>&nbsp;<span class="ident" id="6309217">m</span><span class="op" id="6309218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309221">return</span>&nbsp;<span class="ident" id="6309228">err</span><br>
<span class="lineno"></span><span class="op" id="6309232">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6309235">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6309302">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6309320">func</span>&nbsp;<span class="op" id="6309325">(</span><span class="ident" id="6309326">w</span>&nbsp;<span class="op" id="6309328">*</span><span class="ident" id="6309329">Writer</span><span class="op" id="6309335">)</span>&nbsp;<span class="ident" id="6309337">Err</span><span class="op" id="6309340">(</span><span class="ident" id="6309341">m</span>&nbsp;<span class="builtintype" id="6309343">string</span><span class="op" id="6309349">)</span>&nbsp;<span class="op" id="6309351">(</span><span class="ident" id="6309352">err</span>&nbsp;<span class="builtintype" id="6309356">error</span><span class="op" id="6309361">)</span>&nbsp;<span class="op" id="6309363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309366">_</span><span class="op" id="6309367">,</span>&nbsp;<span class="ident" id="6309369">err</span>&nbsp;<span class="op" id="6309373">=</span>&nbsp;<span class="ident" id="6309375">w</span><span class="op" id="6309376">.</span><span class="ident" id="6309377">writeAndRetry</span><span class="op" id="6309390">(</span><span class="ident" id="6309391">LOG_ERR</span><span class="op" id="6309398">,</span>&nbsp;<span class="ident" id="6309400">m</span><span class="op" id="6309401">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309404">return</span>&nbsp;<span class="ident" id="6309411">err</span><br>
<span class="lineno"></span><span class="op" id="6309415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6309418">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6309484">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="6309511">func</span>&nbsp;<span class="op" id="6309516">(</span><span class="ident" id="6309517">w</span>&nbsp;<span class="op" id="6309519">*</span><span class="ident" id="6309520">Writer</span><span class="op" id="6309526">)</span>&nbsp;<span class="ident" id="6309528">Warning</span><span class="op" id="6309535">(</span><span class="ident" id="6309536">m</span>&nbsp;<span class="builtintype" id="6309538">string</span><span class="op" id="6309544">)</span>&nbsp;<span class="op" id="6309546">(</span><span class="ident" id="6309547">err</span>&nbsp;<span class="builtintype" id="6309551">error</span><span class="op" id="6309556">)</span>&nbsp;<span class="op" id="6309558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309561">_</span><span class="op" id="6309562">,</span>&nbsp;<span class="ident" id="6309564">err</span>&nbsp;<span class="op" id="6309568">=</span>&nbsp;<span class="ident" id="6309570">w</span><span class="op" id="6309571">.</span><span class="ident" id="6309572">writeAndRetry</span><span class="op" id="6309585">(</span><span class="ident" id="6309586">LOG_WARNING</span><span class="op" id="6309597">,</span>&nbsp;<span class="ident" id="6309599">m</span><span class="op" id="6309600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309603">return</span>&nbsp;<span class="ident" id="6309610">err</span><br>
<span class="lineno"></span><span class="op" id="6309614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="6309617">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6309681">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6309708">func</span>&nbsp;<span class="op" id="6309713">(</span><span class="ident" id="6309714">w</span>&nbsp;<span class="op" id="6309716">*</span><span class="ident" id="6309717">Writer</span><span class="op" id="6309723">)</span>&nbsp;<span class="ident" id="6309725">Notice</span><span class="op" id="6309731">(</span><span class="ident" id="6309732">m</span>&nbsp;<span class="builtintype" id="6309734">string</span><span class="op" id="6309740">)</span>&nbsp;<span class="op" id="6309742">(</span><span class="ident" id="6309743">err</span>&nbsp;<span class="builtintype" id="6309747">error</span><span class="op" id="6309752">)</span>&nbsp;<span class="op" id="6309754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309757">_</span><span class="op" id="6309758">,</span>&nbsp;<span class="ident" id="6309760">err</span>&nbsp;<span class="op" id="6309764">=</span>&nbsp;<span class="ident" id="6309766">w</span><span class="op" id="6309767">.</span><span class="ident" id="6309768">writeAndRetry</span><span class="op" id="6309781">(</span><span class="ident" id="6309782">LOG_NOTICE</span><span class="op" id="6309792">,</span>&nbsp;<span class="ident" id="6309794">m</span><span class="op" id="6309795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309798">return</span>&nbsp;<span class="ident" id="6309805">err</span><br>
<span class="lineno">235</span><span class="op" id="6309809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6309812">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6309881">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6309899">func</span>&nbsp;<span class="op" id="6309904">(</span><span class="ident" id="6309905">w</span>&nbsp;<span class="op" id="6309907">*</span><span class="ident" id="6309908">Writer</span><span class="op" id="6309914">)</span>&nbsp;<span class="ident" id="6309916">Info</span><span class="op" id="6309920">(</span><span class="ident" id="6309921">m</span>&nbsp;<span class="builtintype" id="6309923">string</span><span class="op" id="6309929">)</span>&nbsp;<span class="op" id="6309931">(</span><span class="ident" id="6309932">err</span>&nbsp;<span class="builtintype" id="6309936">error</span><span class="op" id="6309941">)</span>&nbsp;<span class="op" id="6309943">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309946">_</span><span class="op" id="6309947">,</span>&nbsp;<span class="ident" id="6309949">err</span>&nbsp;<span class="op" id="6309953">=</span>&nbsp;<span class="ident" id="6309955">w</span><span class="op" id="6309956">.</span><span class="ident" id="6309957">writeAndRetry</span><span class="op" id="6309970">(</span><span class="ident" id="6309971">LOG_INFO</span><span class="op" id="6309979">,</span>&nbsp;<span class="ident" id="6309981">m</span><span class="op" id="6309982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309985">return</span>&nbsp;<span class="ident" id="6309992">err</span><br>
<span class="lineno"></span><span class="op" id="6309996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6309999">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="6310070">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6310088">func</span>&nbsp;<span class="op" id="6310093">(</span><span class="ident" id="6310094">w</span>&nbsp;<span class="op" id="6310096">*</span><span class="ident" id="6310097">Writer</span><span class="op" id="6310103">)</span>&nbsp;<span class="ident" id="6310105">Debug</span><span class="op" id="6310110">(</span><span class="ident" id="6310111">m</span>&nbsp;<span class="builtintype" id="6310113">string</span><span class="op" id="6310119">)</span>&nbsp;<span class="op" id="6310121">(</span><span class="ident" id="6310122">err</span>&nbsp;<span class="builtintype" id="6310126">error</span><span class="op" id="6310131">)</span>&nbsp;<span class="op" id="6310133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310136">_</span><span class="op" id="6310137">,</span>&nbsp;<span class="ident" id="6310139">err</span>&nbsp;<span class="op" id="6310143">=</span>&nbsp;<span class="ident" id="6310145">w</span><span class="op" id="6310146">.</span><span class="ident" id="6310147">writeAndRetry</span><span class="op" id="6310160">(</span><span class="ident" id="6310161">LOG_DEBUG</span><span class="op" id="6310170">,</span>&nbsp;<span class="ident" id="6310172">m</span><span class="op" id="6310173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310176">return</span>&nbsp;<span class="ident" id="6310183">err</span><br>
<span class="lineno"></span><span class="op" id="6310187">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6310190">func</span>&nbsp;<span class="op" id="6310195">(</span><span class="ident" id="6310196">w</span>&nbsp;<span class="op" id="6310198">*</span><span class="ident" id="6310199">Writer</span><span class="op" id="6310205">)</span>&nbsp;<span class="ident" id="6310207">writeAndRetry</span><span class="op" id="6310220">(</span><span class="ident" id="6310221">p</span>&nbsp;<span class="ident" id="6310223">Priority</span><span class="op" id="6310231">,</span>&nbsp;<span class="ident" id="6310233">s</span>&nbsp;<span class="builtintype" id="6310235">string</span><span class="op" id="6310241">)</span>&nbsp;<span class="op" id="6310243">(</span><span class="builtintype" id="6310244">int</span><span class="op" id="6310247">,</span>&nbsp;<span class="builtintype" id="6310249">error</span><span class="op" id="6310254">)</span>&nbsp;<span class="op" id="6310256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310259">pr</span>&nbsp;<span class="op" id="6310262">:=</span>&nbsp;<span class="op" id="6310265">(</span><span class="ident" id="6310266">w</span><span class="op" id="6310267">.</span><span class="ident" id="6310268">priority</span>&nbsp;<span class="op" id="6310277">&amp;</span>&nbsp;<span class="ident" id="6310279">facilityMask</span><span class="op" id="6310291">)</span>&nbsp;<span class="op" id="6310293">|</span>&nbsp;<span class="op" id="6310295">(</span><span class="ident" id="6310296">p</span>&nbsp;<span class="op" id="6310298">&amp;</span>&nbsp;<span class="ident" id="6310300">severityMask</span><span class="op" id="6310312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310316">w</span><span class="op" id="6310317">.</span><span class="ident" id="6310318">mu</span><span class="op" id="6310320">.</span><span class="ident" id="6310321">Lock</span><span class="op" id="6310325">(</span><span class="op" id="6310326">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310329">defer</span>&nbsp;<span class="ident" id="6310335">w</span><span class="op" id="6310336">.</span><span class="ident" id="6310337">mu</span><span class="op" id="6310339">.</span><span class="ident" id="6310340">Unlock</span><span class="op" id="6310346">(</span><span class="op" id="6310347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310351">if</span>&nbsp;<span class="ident" id="6310354">w</span><span class="op" id="6310355">.</span><span class="ident" id="6310356">conn</span>&nbsp;<span class="op" id="6310361">!=</span>&nbsp;<span class="ident" id="6310364">nil</span>&nbsp;<span class="op" id="6310368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310372">if</span>&nbsp;<span class="ident" id="6310375">n</span><span class="op" id="6310376">,</span>&nbsp;<span class="ident" id="6310378">err</span>&nbsp;<span class="op" id="6310382">:=</span>&nbsp;<span class="ident" id="6310385">w</span><span class="op" id="6310386">.</span><span class="ident" id="6310387">write</span><span class="op" id="6310392">(</span><span class="ident" id="6310393">pr</span><span class="op" id="6310395">,</span>&nbsp;<span class="ident" id="6310397">s</span><span class="op" id="6310398">)</span><span class="op" id="6310399">;</span>&nbsp;<span class="ident" id="6310401">err</span>&nbsp;<span class="op" id="6310405">==</span>&nbsp;<span class="ident" id="6310408">nil</span>&nbsp;<span class="op" id="6310412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310417">return</span>&nbsp;<span class="ident" id="6310424">n</span><span class="op" id="6310425">,</span>&nbsp;<span class="ident" id="6310427">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310439">if</span>&nbsp;<span class="ident" id="6310442">err</span>&nbsp;<span class="op" id="6310446">:=</span>&nbsp;<span class="ident" id="6310449">w</span><span class="op" id="6310450">.</span><span class="ident" id="6310451">connect</span><span class="op" id="6310458">(</span><span class="op" id="6310459">)</span><span class="op" id="6310460">;</span>&nbsp;<span class="ident" id="6310462">err</span>&nbsp;<span class="op" id="6310466">!=</span>&nbsp;<span class="ident" id="6310469">nil</span>&nbsp;<span class="op" id="6310473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310477">return</span>&nbsp;<span class="num" id="6310484">0</span><span class="op" id="6310485">,</span>&nbsp;<span class="ident" id="6310487">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310492">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310495">return</span>&nbsp;<span class="ident" id="6310502">w</span><span class="op" id="6310503">.</span><span class="ident" id="6310504">write</span><span class="op" id="6310509">(</span><span class="ident" id="6310510">pr</span><span class="op" id="6310512">,</span>&nbsp;<span class="ident" id="6310514">s</span><span class="op" id="6310515">)</span><br>
<span class="lineno"></span><span class="op" id="6310517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6310520">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6310581">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="6310644">func</span>&nbsp;<span class="op" id="6310649">(</span><span class="ident" id="6310650">w</span>&nbsp;<span class="op" id="6310652">*</span><span class="ident" id="6310653">Writer</span><span class="op" id="6310659">)</span>&nbsp;<span class="ident" id="6310661">write</span><span class="op" id="6310666">(</span><span class="ident" id="6310667">p</span>&nbsp;<span class="ident" id="6310669">Priority</span><span class="op" id="6310677">,</span>&nbsp;<span class="ident" id="6310679">msg</span>&nbsp;<span class="builtintype" id="6310683">string</span><span class="op" id="6310689">)</span>&nbsp;<span class="op" id="6310691">(</span><span class="builtintype" id="6310692">int</span><span class="op" id="6310695">,</span>&nbsp;<span class="builtintype" id="6310697">error</span><span class="op" id="6310702">)</span>&nbsp;<span class="op" id="6310704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310707">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310734">nl</span>&nbsp;<span class="op" id="6310737">:=</span>&nbsp;<span class="string" id="6310740">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310744">if</span>&nbsp;<span class="op" id="6310747">!</span><span class="ident" id="6310748">strings</span><span class="op" id="6310755">.</span><span class="ident" id="6310756">HasSuffix</span><span class="op" id="6310765">(</span><span class="ident" id="6310766">msg</span><span class="op" id="6310769">,</span>&nbsp;<span class="string" id="6310771">&#34;\n&#34;</span><span class="op" id="6310775">)</span>&nbsp;<span class="op" id="6310777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310781">nl</span>&nbsp;<span class="op" id="6310784">=</span>&nbsp;<span class="string" id="6310786">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310796">err</span>&nbsp;<span class="op" id="6310800">:=</span>&nbsp;<span class="ident" id="6310803">w</span><span class="op" id="6310804">.</span><span class="ident" id="6310805">conn</span><span class="op" id="6310809">.</span><span class="ident" id="6310810">writeString</span><span class="op" id="6310821">(</span><span class="ident" id="6310822">p</span><span class="op" id="6310823">,</span>&nbsp;<span class="ident" id="6310825">w</span><span class="op" id="6310826">.</span><span class="ident" id="6310827">hostname</span><span class="op" id="6310835">,</span>&nbsp;<span class="ident" id="6310837">w</span><span class="op" id="6310838">.</span><span class="ident" id="6310839">tag</span><span class="op" id="6310842">,</span>&nbsp;<span class="ident" id="6310844">msg</span><span class="op" id="6310847">,</span>&nbsp;<span class="ident" id="6310849">nl</span><span class="op" id="6310851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310854">if</span>&nbsp;<span class="ident" id="6310857">err</span>&nbsp;<span class="op" id="6310861">!=</span>&nbsp;<span class="ident" id="6310864">nil</span>&nbsp;<span class="op" id="6310868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310872">return</span>&nbsp;<span class="num" id="6310879">0</span><span class="op" id="6310880">,</span>&nbsp;<span class="ident" id="6310882">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310890">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310950">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311010">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311028">return</span>&nbsp;<span class="builtinfunc" id="6311035">len</span><span class="op" id="6311038">(</span><span class="ident" id="6311039">msg</span><span class="op" id="6311042">)</span><span class="op" id="6311043">,</span>&nbsp;<span class="ident" id="6311045">nil</span><br>
<span class="lineno">285</span><span class="op" id="6311049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6311052">func</span>&nbsp;<span class="op" id="6311057">(</span><span class="ident" id="6311058">n</span>&nbsp;<span class="op" id="6311060">*</span><span class="ident" id="6311061">netConn</span><span class="op" id="6311068">)</span>&nbsp;<span class="ident" id="6311070">writeString</span><span class="op" id="6311081">(</span><span class="ident" id="6311082">p</span>&nbsp;<span class="ident" id="6311084">Priority</span><span class="op" id="6311092">,</span>&nbsp;<span class="ident" id="6311094">hostname</span><span class="op" id="6311102">,</span>&nbsp;<span class="ident" id="6311104">tag</span><span class="op" id="6311107">,</span>&nbsp;<span class="ident" id="6311109">msg</span><span class="op" id="6311112">,</span>&nbsp;<span class="ident" id="6311114">nl</span>&nbsp;<span class="builtintype" id="6311117">string</span><span class="op" id="6311123">)</span>&nbsp;<span class="builtintype" id="6311125">error</span>&nbsp;<span class="op" id="6311131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311134">if</span>&nbsp;<span class="ident" id="6311137">n</span><span class="op" id="6311138">.</span><span class="ident" id="6311139">local</span>&nbsp;<span class="op" id="6311145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311149">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311207">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311255">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311305">timestamp</span>&nbsp;<span class="op" id="6311315">:=</span>&nbsp;<span class="ident" id="6311318">time</span><span class="op" id="6311322">.</span><span class="ident" id="6311323">Now</span><span class="op" id="6311326">(</span><span class="op" id="6311327">)</span><span class="op" id="6311328">.</span><span class="ident" id="6311329">Format</span><span class="op" id="6311335">(</span><span class="ident" id="6311336">time</span><span class="op" id="6311340">.</span><span class="ident" id="6311341">Stamp</span><span class="op" id="6311346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311350">_</span><span class="op" id="6311351">,</span>&nbsp;<span class="ident" id="6311353">err</span>&nbsp;<span class="op" id="6311357">:=</span>&nbsp;<span class="ident" id="6311360">fmt</span><span class="op" id="6311363">.</span><span class="ident" id="6311364">Fprintf</span><span class="op" id="6311371">(</span><span class="ident" id="6311372">n</span><span class="op" id="6311373">.</span><span class="ident" id="6311374">conn</span><span class="op" id="6311378">,</span>&nbsp;<span class="string" id="6311380">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6311401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311406">p</span><span class="op" id="6311407">,</span>&nbsp;<span class="ident" id="6311409">timestamp</span><span class="op" id="6311418">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311423">tag</span><span class="op" id="6311426">,</span>&nbsp;<span class="ident" id="6311428">os</span><span class="op" id="6311430">.</span><span class="ident" id="6311431">Getpid</span><span class="op" id="6311437">(</span><span class="op" id="6311438">)</span><span class="op" id="6311439">,</span>&nbsp;<span class="ident" id="6311441">msg</span><span class="op" id="6311444">,</span>&nbsp;<span class="ident" id="6311446">nl</span><span class="op" id="6311448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311452">return</span>&nbsp;<span class="ident" id="6311459">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311467">timestamp</span>&nbsp;<span class="op" id="6311477">:=</span>&nbsp;<span class="ident" id="6311480">time</span><span class="op" id="6311484">.</span><span class="ident" id="6311485">Now</span><span class="op" id="6311488">(</span><span class="op" id="6311489">)</span><span class="op" id="6311490">.</span><span class="ident" id="6311491">Format</span><span class="op" id="6311497">(</span><span class="ident" id="6311498">time</span><span class="op" id="6311502">.</span><span class="ident" id="6311503">RFC3339</span><span class="op" id="6311510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311513">_</span><span class="op" id="6311514">,</span>&nbsp;<span class="ident" id="6311516">err</span>&nbsp;<span class="op" id="6311520">:=</span>&nbsp;<span class="ident" id="6311523">fmt</span><span class="op" id="6311526">.</span><span class="ident" id="6311527">Fprintf</span><span class="op" id="6311534">(</span><span class="ident" id="6311535">n</span><span class="op" id="6311536">.</span><span class="ident" id="6311537">conn</span><span class="op" id="6311541">,</span>&nbsp;<span class="string" id="6311543">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6311567">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311571">p</span><span class="op" id="6311572">,</span>&nbsp;<span class="ident" id="6311574">timestamp</span><span class="op" id="6311583">,</span>&nbsp;<span class="ident" id="6311585">hostname</span><span class="op" id="6311593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311597">tag</span><span class="op" id="6311600">,</span>&nbsp;<span class="ident" id="6311602">os</span><span class="op" id="6311604">.</span><span class="ident" id="6311605">Getpid</span><span class="op" id="6311611">(</span><span class="op" id="6311612">)</span><span class="op" id="6311613">,</span>&nbsp;<span class="ident" id="6311615">msg</span><span class="op" id="6311618">,</span>&nbsp;<span class="ident" id="6311620">nl</span><span class="op" id="6311622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311625">return</span>&nbsp;<span class="ident" id="6311632">err</span><br>
<span class="lineno"></span><span class="op" id="6311636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6311639">func</span>&nbsp;<span class="op" id="6311644">(</span><span class="ident" id="6311645">n</span>&nbsp;<span class="op" id="6311647">*</span><span class="ident" id="6311648">netConn</span><span class="op" id="6311655">)</span>&nbsp;<span class="builtinfunc" id="6311657">close</span><span class="op" id="6311662">(</span><span class="op" id="6311663">)</span>&nbsp;<span class="builtintype" id="6311665">error</span>&nbsp;<span class="op" id="6311671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311674">return</span>&nbsp;<span class="ident" id="6311681">n</span><span class="op" id="6311682">.</span><span class="ident" id="6311683">conn</span><span class="op" id="6311687">.</span><span class="ident" id="6311688">Close</span><span class="op" id="6311693">(</span><span class="op" id="6311694">)</span><br>
<span class="lineno"></span><span class="op" id="6311696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6311699">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="6311760">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="6311827">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6311891">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="6311906">func</span>&nbsp;<span class="ident" id="6311911">NewLogger</span><span class="op" id="6311920">(</span><span class="ident" id="6311921">p</span>&nbsp;<span class="ident" id="6311923">Priority</span><span class="op" id="6311931">,</span>&nbsp;<span class="ident" id="6311933">logFlag</span>&nbsp;<span class="builtintype" id="6311941">int</span><span class="op" id="6311944">)</span>&nbsp;<span class="op" id="6311946">(</span><span class="op" id="6311947">*</span><span class="ident" id="6311948">log</span><span class="op" id="6311951">.</span><span class="ident" id="6311952">Logger</span><span class="op" id="6311958">,</span>&nbsp;<span class="builtintype" id="6311960">error</span><span class="op" id="6311965">)</span>&nbsp;<span class="op" id="6311967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311970">s</span><span class="op" id="6311971">,</span>&nbsp;<span class="ident" id="6311973">err</span>&nbsp;<span class="op" id="6311977">:=</span>&nbsp;<span class="ident" id="6311980">New</span><span class="op" id="6311983">(</span><span class="ident" id="6311984">p</span><span class="op" id="6311985">,</span>&nbsp;<span class="string" id="6311987">&#34;&#34;</span><span class="op" id="6311989">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311992">if</span>&nbsp;<span class="ident" id="6311995">err</span>&nbsp;<span class="op" id="6311999">!=</span>&nbsp;<span class="ident" id="6312002">nil</span>&nbsp;<span class="op" id="6312006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312010">return</span>&nbsp;<span class="ident" id="6312017">nil</span><span class="op" id="6312020">,</span>&nbsp;<span class="ident" id="6312022">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6312027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312030">return</span>&nbsp;<span class="ident" id="6312037">log</span><span class="op" id="6312040">.</span><span class="ident" id="6312041">New</span><span class="op" id="6312044">(</span><span class="ident" id="6312045">s</span><span class="op" id="6312046">,</span>&nbsp;<span class="string" id="6312048">&#34;&#34;</span><span class="op" id="6312050">,</span>&nbsp;<span class="ident" id="6312052">logFlag</span><span class="op" id="6312059">)</span><span class="op" id="6312060">,</span>&nbsp;<span class="ident" id="6312062">nil</span><br>
<span class="lineno"></span><span class="op" id="6312066">}</span>
</div>
</body>
</html>
