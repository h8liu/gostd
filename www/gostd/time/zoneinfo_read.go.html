<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>time</h2>
<ul>
<li><a href="/gostd/time/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/time/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/time/format.go.html">format.go</a></li>
<li><a href="/gostd/time/format_test.go.html">format_test.go</a></li>
<li><a href="/gostd/time/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/time/sleep.go.html">sleep.go</a></li>
<li><a href="/gostd/time/sleep_test.go.html">sleep_test.go</a></li>
<li><a href="/gostd/time/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/time/tick.go.html">tick.go</a></li>
<li><a href="/gostd/time/tick_test.go.html">tick_test.go</a></li>
<li><a href="/gostd/time/time.go.html">time.go</a></li>
<li><a href="/gostd/time/time_test.go.html">time_test.go</a></li>
<li><a href="/gostd/time/zoneinfo.go.html">zoneinfo.go</a></li>
<li><a href="/gostd/time/zoneinfo_read.go.html" class="current">zoneinfo_read.go</a></li>
<li><a href="/gostd/time/zoneinfo_test.go.html">zoneinfo_test.go</a></li>
<li><a href="/gostd/time/zoneinfo_unix.go.html">zoneinfo_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2819393">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2819448">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2819502">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2819553">//&nbsp;Parse&nbsp;&#34;zoneinfo&#34;&nbsp;time&nbsp;zone&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2819589">//&nbsp;This&nbsp;is&nbsp;a&nbsp;fairly&nbsp;standard&nbsp;file&nbsp;format&nbsp;used&nbsp;on&nbsp;OS&nbsp;X,&nbsp;Linux,&nbsp;BSD,&nbsp;Sun,&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span><span class="comment" id="2819673">//&nbsp;See&nbsp;tzfile(5),&nbsp;http://en.wikipedia.org/wiki/Zoneinfo,</span><br>
<span class="lineno"></span><span class="comment" id="2819730">//&nbsp;and&nbsp;ftp://munnari.oz.au/pub/oldtz/</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="2819769">package</span>&nbsp;<span class="ident" id="2819777">time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2819783">import</span>&nbsp;<span class="string" id="2819790">&#34;errors&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2819800">//&nbsp;Simple&nbsp;I/O&nbsp;interface&nbsp;to&nbsp;binary&nbsp;blob&nbsp;of&nbsp;data.</span><br>
<span class="lineno">15</span><span class="keyword" id="2819848">type</span>&nbsp;<span class="ident" id="2819853">data</span>&nbsp;<span class="keyword" id="2819858">struct</span>&nbsp;<span class="op" id="2819865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819868">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2819874">[</span><span class="op" id="2819875">]</span><span class="builtintype" id="2819876">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2819882">error</span>&nbsp;<span class="builtintype" id="2819888">bool</span><br>
<span class="lineno"></span><span class="op" id="2819893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="2819896">func</span>&nbsp;<span class="op" id="2819901">(</span><span class="ident" id="2819902">d</span>&nbsp;<span class="op" id="2819904">*</span><span class="ident" id="2819905">data</span><span class="op" id="2819909">)</span>&nbsp;<span class="ident" id="2819911">read</span><span class="op" id="2819915">(</span><span class="ident" id="2819916">n</span>&nbsp;<span class="builtintype" id="2819918">int</span><span class="op" id="2819921">)</span>&nbsp;<span class="op" id="2819923">[</span><span class="op" id="2819924">]</span><span class="builtintype" id="2819925">byte</span>&nbsp;<span class="op" id="2819930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2819933">if</span>&nbsp;<span class="builtinfunc" id="2819936">len</span><span class="op" id="2819939">(</span><span class="ident" id="2819940">d</span><span class="op" id="2819941">.</span><span class="ident" id="2819942">p</span><span class="op" id="2819943">)</span>&nbsp;<span class="op" id="2819945">&lt;</span>&nbsp;<span class="ident" id="2819947">n</span>&nbsp;<span class="op" id="2819949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819953">d</span><span class="op" id="2819954">.</span><span class="ident" id="2819955">p</span>&nbsp;<span class="op" id="2819957">=</span>&nbsp;<span class="ident" id="2819959">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819965">d</span><span class="op" id="2819966">.</span><span class="builtintype" id="2819967">error</span>&nbsp;<span class="op" id="2819973">=</span>&nbsp;<span class="builtintype" id="2819975">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2819982">return</span>&nbsp;<span class="ident" id="2819989">nil</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2819994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819997">p</span>&nbsp;<span class="op" id="2819999">:=</span>&nbsp;<span class="ident" id="2820002">d</span><span class="op" id="2820003">.</span><span class="ident" id="2820004">p</span><span class="op" id="2820005">[</span><span class="num" id="2820006">0</span><span class="op" id="2820007">:</span><span class="ident" id="2820008">n</span><span class="op" id="2820009">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820012">d</span><span class="op" id="2820013">.</span><span class="ident" id="2820014">p</span>&nbsp;<span class="op" id="2820016">=</span>&nbsp;<span class="ident" id="2820018">d</span><span class="op" id="2820019">.</span><span class="ident" id="2820020">p</span><span class="op" id="2820021">[</span><span class="ident" id="2820022">n</span><span class="op" id="2820023">:</span><span class="op" id="2820024">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820027">return</span>&nbsp;<span class="ident" id="2820034">p</span><br>
<span class="lineno"></span><span class="op" id="2820036">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="2820039">func</span>&nbsp;<span class="op" id="2820044">(</span><span class="ident" id="2820045">d</span>&nbsp;<span class="op" id="2820047">*</span><span class="ident" id="2820048">data</span><span class="op" id="2820052">)</span>&nbsp;<span class="ident" id="2820054">big4</span><span class="op" id="2820058">(</span><span class="op" id="2820059">)</span>&nbsp;<span class="op" id="2820061">(</span><span class="ident" id="2820062">n</span>&nbsp;<span class="builtintype" id="2820064">uint32</span><span class="op" id="2820070">,</span>&nbsp;<span class="ident" id="2820072">ok</span>&nbsp;<span class="builtintype" id="2820075">bool</span><span class="op" id="2820079">)</span>&nbsp;<span class="op" id="2820081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820084">p</span>&nbsp;<span class="op" id="2820086">:=</span>&nbsp;<span class="ident" id="2820089">d</span><span class="op" id="2820090">.</span><span class="ident" id="2820091">read</span><span class="op" id="2820095">(</span><span class="num" id="2820096">4</span><span class="op" id="2820097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820100">if</span>&nbsp;<span class="builtinfunc" id="2820103">len</span><span class="op" id="2820106">(</span><span class="ident" id="2820107">p</span><span class="op" id="2820108">)</span>&nbsp;<span class="op" id="2820110">&lt;</span>&nbsp;<span class="num" id="2820112">4</span>&nbsp;<span class="op" id="2820114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820118">d</span><span class="op" id="2820119">.</span><span class="builtintype" id="2820120">error</span>&nbsp;<span class="op" id="2820126">=</span>&nbsp;<span class="builtintype" id="2820128">true</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820135">return</span>&nbsp;<span class="num" id="2820142">0</span><span class="op" id="2820143">,</span>&nbsp;<span class="builtintype" id="2820145">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2820152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820155">return</span>&nbsp;<span class="builtintype" id="2820162">uint32</span><span class="op" id="2820168">(</span><span class="ident" id="2820169">p</span><span class="op" id="2820170">[</span><span class="num" id="2820171">0</span><span class="op" id="2820172">]</span><span class="op" id="2820173">)</span><span class="op" id="2820174">&lt;&lt;</span><span class="num" id="2820176">24</span>&nbsp;<span class="op" id="2820179">|</span>&nbsp;<span class="builtintype" id="2820181">uint32</span><span class="op" id="2820187">(</span><span class="ident" id="2820188">p</span><span class="op" id="2820189">[</span><span class="num" id="2820190">1</span><span class="op" id="2820191">]</span><span class="op" id="2820192">)</span><span class="op" id="2820193">&lt;&lt;</span><span class="num" id="2820195">16</span>&nbsp;<span class="op" id="2820198">|</span>&nbsp;<span class="builtintype" id="2820200">uint32</span><span class="op" id="2820206">(</span><span class="ident" id="2820207">p</span><span class="op" id="2820208">[</span><span class="num" id="2820209">2</span><span class="op" id="2820210">]</span><span class="op" id="2820211">)</span><span class="op" id="2820212">&lt;&lt;</span><span class="num" id="2820214">8</span>&nbsp;<span class="op" id="2820216">|</span>&nbsp;<span class="builtintype" id="2820218">uint32</span><span class="op" id="2820224">(</span><span class="ident" id="2820225">p</span><span class="op" id="2820226">[</span><span class="num" id="2820227">3</span><span class="op" id="2820228">]</span><span class="op" id="2820229">)</span><span class="op" id="2820230">,</span>&nbsp;<span class="builtintype" id="2820232">true</span><br>
<span class="lineno"></span><span class="op" id="2820237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2820240">func</span>&nbsp;<span class="op" id="2820245">(</span><span class="ident" id="2820246">d</span>&nbsp;<span class="op" id="2820248">*</span><span class="ident" id="2820249">data</span><span class="op" id="2820253">)</span>&nbsp;<span class="builtintype" id="2820255">byte</span><span class="op" id="2820259">(</span><span class="op" id="2820260">)</span>&nbsp;<span class="op" id="2820262">(</span><span class="ident" id="2820263">n</span>&nbsp;<span class="builtintype" id="2820265">byte</span><span class="op" id="2820269">,</span>&nbsp;<span class="ident" id="2820271">ok</span>&nbsp;<span class="builtintype" id="2820274">bool</span><span class="op" id="2820278">)</span>&nbsp;<span class="op" id="2820280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820283">p</span>&nbsp;<span class="op" id="2820285">:=</span>&nbsp;<span class="ident" id="2820288">d</span><span class="op" id="2820289">.</span><span class="ident" id="2820290">read</span><span class="op" id="2820294">(</span><span class="num" id="2820295">1</span><span class="op" id="2820296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820299">if</span>&nbsp;<span class="builtinfunc" id="2820302">len</span><span class="op" id="2820305">(</span><span class="ident" id="2820306">p</span><span class="op" id="2820307">)</span>&nbsp;<span class="op" id="2820309">&lt;</span>&nbsp;<span class="num" id="2820311">1</span>&nbsp;<span class="op" id="2820313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820317">d</span><span class="op" id="2820318">.</span><span class="builtintype" id="2820319">error</span>&nbsp;<span class="op" id="2820325">=</span>&nbsp;<span class="builtintype" id="2820327">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820334">return</span>&nbsp;<span class="num" id="2820341">0</span><span class="op" id="2820342">,</span>&nbsp;<span class="builtintype" id="2820344">false</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2820351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820354">return</span>&nbsp;<span class="ident" id="2820361">p</span><span class="op" id="2820362">[</span><span class="num" id="2820363">0</span><span class="op" id="2820364">]</span><span class="op" id="2820365">,</span>&nbsp;<span class="builtintype" id="2820367">true</span><br>
<span class="lineno"></span><span class="op" id="2820372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2820375">//&nbsp;Make&nbsp;a&nbsp;string&nbsp;by&nbsp;stopping&nbsp;at&nbsp;the&nbsp;first&nbsp;NUL</span><br>
<span class="lineno">50</span><span class="keyword" id="2820421">func</span>&nbsp;<span class="ident" id="2820426">byteString</span><span class="op" id="2820436">(</span><span class="ident" id="2820437">p</span>&nbsp;<span class="op" id="2820439">[</span><span class="op" id="2820440">]</span><span class="builtintype" id="2820441">byte</span><span class="op" id="2820445">)</span>&nbsp;<span class="builtintype" id="2820447">string</span>&nbsp;<span class="op" id="2820454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820457">for</span>&nbsp;<span class="ident" id="2820461">i</span>&nbsp;<span class="op" id="2820463">:=</span>&nbsp;<span class="num" id="2820466">0</span><span class="op" id="2820467">;</span>&nbsp;<span class="ident" id="2820469">i</span>&nbsp;<span class="op" id="2820471">&lt;</span>&nbsp;<span class="builtinfunc" id="2820473">len</span><span class="op" id="2820476">(</span><span class="ident" id="2820477">p</span><span class="op" id="2820478">)</span><span class="op" id="2820479">;</span>&nbsp;<span class="ident" id="2820481">i</span><span class="op" id="2820482">++</span>&nbsp;<span class="op" id="2820485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820489">if</span>&nbsp;<span class="ident" id="2820492">p</span><span class="op" id="2820493">[</span><span class="ident" id="2820494">i</span><span class="op" id="2820495">]</span>&nbsp;<span class="op" id="2820497">==</span>&nbsp;<span class="num" id="2820500">0</span>&nbsp;<span class="op" id="2820502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820507">return</span>&nbsp;<span class="builtintype" id="2820514">string</span><span class="op" id="2820520">(</span><span class="ident" id="2820521">p</span><span class="op" id="2820522">[</span><span class="num" id="2820523">0</span><span class="op" id="2820524">:</span><span class="ident" id="2820525">i</span><span class="op" id="2820526">]</span><span class="op" id="2820527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2820531">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2820534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820537">return</span>&nbsp;<span class="builtintype" id="2820544">string</span><span class="op" id="2820550">(</span><span class="ident" id="2820551">p</span><span class="op" id="2820552">)</span><br>
<span class="lineno"></span><span class="op" id="2820554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2820557">var</span>&nbsp;<span class="ident" id="2820561">badData</span>&nbsp;<span class="op" id="2820569">=</span>&nbsp;<span class="ident" id="2820571">errors</span><span class="op" id="2820577">.</span><span class="ident" id="2820578">New</span><span class="op" id="2820581">(</span><span class="string" id="2820582">&#34;malformed&nbsp;time&nbsp;zone&nbsp;information&#34;</span><span class="op" id="2820615">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="2820618">func</span>&nbsp;<span class="ident" id="2820623">loadZoneData</span><span class="op" id="2820635">(</span><span class="ident" id="2820636">bytes</span>&nbsp;<span class="op" id="2820642">[</span><span class="op" id="2820643">]</span><span class="builtintype" id="2820644">byte</span><span class="op" id="2820648">)</span>&nbsp;<span class="op" id="2820650">(</span><span class="ident" id="2820651">l</span>&nbsp;<span class="op" id="2820653">*</span><span class="ident" id="2820654">Location</span><span class="op" id="2820662">,</span>&nbsp;<span class="ident" id="2820664">err</span>&nbsp;<span class="builtintype" id="2820668">error</span><span class="op" id="2820673">)</span>&nbsp;<span class="op" id="2820675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820678">d</span>&nbsp;<span class="op" id="2820680">:=</span>&nbsp;<span class="ident" id="2820683">data</span><span class="op" id="2820687">{</span><span class="ident" id="2820688">bytes</span><span class="op" id="2820693">,</span>&nbsp;<span class="builtintype" id="2820695">false</span><span class="op" id="2820700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2820704">//&nbsp;4-byte&nbsp;magic&nbsp;&#34;TZif&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820728">if</span>&nbsp;<span class="ident" id="2820731">magic</span>&nbsp;<span class="op" id="2820737">:=</span>&nbsp;<span class="ident" id="2820740">d</span><span class="op" id="2820741">.</span><span class="ident" id="2820742">read</span><span class="op" id="2820746">(</span><span class="num" id="2820747">4</span><span class="op" id="2820748">)</span><span class="op" id="2820749">;</span>&nbsp;<span class="builtintype" id="2820751">string</span><span class="op" id="2820757">(</span><span class="ident" id="2820758">magic</span><span class="op" id="2820763">)</span>&nbsp;<span class="op" id="2820765">!=</span>&nbsp;<span class="string" id="2820768">&#34;TZif&#34;</span>&nbsp;<span class="op" id="2820775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820779">return</span>&nbsp;<span class="ident" id="2820786">nil</span><span class="op" id="2820789">,</span>&nbsp;<span class="ident" id="2820791">badData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2820800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2820804">//&nbsp;1-byte&nbsp;version,&nbsp;then&nbsp;15&nbsp;bytes&nbsp;of&nbsp;padding</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820849">var</span>&nbsp;<span class="ident" id="2820853">p</span>&nbsp;<span class="op" id="2820855">[</span><span class="op" id="2820856">]</span><span class="builtintype" id="2820857">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820863">if</span>&nbsp;<span class="ident" id="2820866">p</span>&nbsp;<span class="op" id="2820868">=</span>&nbsp;<span class="ident" id="2820870">d</span><span class="op" id="2820871">.</span><span class="ident" id="2820872">read</span><span class="op" id="2820876">(</span><span class="num" id="2820877">16</span><span class="op" id="2820879">)</span><span class="op" id="2820880">;</span>&nbsp;<span class="builtinfunc" id="2820882">len</span><span class="op" id="2820885">(</span><span class="ident" id="2820886">p</span><span class="op" id="2820887">)</span>&nbsp;<span class="op" id="2820889">!=</span>&nbsp;<span class="num" id="2820892">16</span>&nbsp;<span class="op" id="2820895">||</span>&nbsp;<span class="ident" id="2820898">p</span><span class="op" id="2820899">[</span><span class="num" id="2820900">0</span><span class="op" id="2820901">]</span>&nbsp;<span class="op" id="2820903">!=</span>&nbsp;<span class="num" id="2820906">0</span>&nbsp;<span class="op" id="2820908">&amp;&amp;</span>&nbsp;<span class="ident" id="2820911">p</span><span class="op" id="2820912">[</span><span class="num" id="2820913">0</span><span class="op" id="2820914">]</span>&nbsp;<span class="op" id="2820916">!=</span>&nbsp;<span class="string" id="2820919">&#39;2&#39;</span>&nbsp;<span class="op" id="2820923">&amp;&amp;</span>&nbsp;<span class="ident" id="2820926">p</span><span class="op" id="2820927">[</span><span class="num" id="2820928">0</span><span class="op" id="2820929">]</span>&nbsp;<span class="op" id="2820931">!=</span>&nbsp;<span class="string" id="2820934">&#39;3&#39;</span>&nbsp;<span class="op" id="2820938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820942">return</span>&nbsp;<span class="ident" id="2820949">nil</span><span class="op" id="2820952">,</span>&nbsp;<span class="ident" id="2820954">badData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2820963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2820967">//&nbsp;six&nbsp;big-endian&nbsp;32-bit&nbsp;integers:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821003">//&nbsp;&nbsp;&nbsp;&nbsp;number&nbsp;of&nbsp;UTC/local&nbsp;indicators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821038">//&nbsp;&nbsp;&nbsp;&nbsp;number&nbsp;of&nbsp;standard/wall&nbsp;indicators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821077">//&nbsp;&nbsp;&nbsp;&nbsp;number&nbsp;of&nbsp;leap&nbsp;seconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821104">//&nbsp;&nbsp;&nbsp;&nbsp;number&nbsp;of&nbsp;transition&nbsp;times</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821135">//&nbsp;&nbsp;&nbsp;&nbsp;number&nbsp;of&nbsp;local&nbsp;time&nbsp;zones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821166">//&nbsp;&nbsp;&nbsp;&nbsp;number&nbsp;of&nbsp;characters&nbsp;of&nbsp;time&nbsp;zone&nbsp;abbrev&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821219">const</span>&nbsp;<span class="op" id="2821225">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821229">NUTCLocal</span>&nbsp;<span class="op" id="2821239">=</span>&nbsp;<span class="ident" id="2821241">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821248">NStdWall</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821259">NLeap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821267">NTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821275">NZone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821283">NChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2821290">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821293">var</span>&nbsp;<span class="ident" id="2821297">n</span>&nbsp;<span class="op" id="2821299">[</span><span class="num" id="2821300">6</span><span class="op" id="2821301">]</span><span class="builtintype" id="2821302">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821307">for</span>&nbsp;<span class="ident" id="2821311">i</span>&nbsp;<span class="op" id="2821313">:=</span>&nbsp;<span class="num" id="2821316">0</span><span class="op" id="2821317">;</span>&nbsp;<span class="ident" id="2821319">i</span>&nbsp;<span class="op" id="2821321">&lt;</span>&nbsp;<span class="num" id="2821323">6</span><span class="op" id="2821324">;</span>&nbsp;<span class="ident" id="2821326">i</span><span class="op" id="2821327">++</span>&nbsp;<span class="op" id="2821330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821334">nn</span><span class="op" id="2821336">,</span>&nbsp;<span class="ident" id="2821338">ok</span>&nbsp;<span class="op" id="2821341">:=</span>&nbsp;<span class="ident" id="2821344">d</span><span class="op" id="2821345">.</span><span class="ident" id="2821346">big4</span><span class="op" id="2821350">(</span><span class="op" id="2821351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821355">if</span>&nbsp;<span class="op" id="2821358">!</span><span class="ident" id="2821359">ok</span>&nbsp;<span class="op" id="2821362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821367">return</span>&nbsp;<span class="ident" id="2821374">nil</span><span class="op" id="2821377">,</span>&nbsp;<span class="ident" id="2821379">badData</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2821389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821393">n</span><span class="op" id="2821394">[</span><span class="ident" id="2821395">i</span><span class="op" id="2821396">]</span>&nbsp;<span class="op" id="2821398">=</span>&nbsp;<span class="builtintype" id="2821400">int</span><span class="op" id="2821403">(</span><span class="ident" id="2821404">nn</span><span class="op" id="2821406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2821409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821413">//&nbsp;Transition&nbsp;times.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821435">txtimes</span>&nbsp;<span class="op" id="2821443">:=</span>&nbsp;<span class="ident" id="2821446">data</span><span class="op" id="2821450">{</span><span class="ident" id="2821451">d</span><span class="op" id="2821452">.</span><span class="ident" id="2821453">read</span><span class="op" id="2821457">(</span><span class="ident" id="2821458">n</span><span class="op" id="2821459">[</span><span class="ident" id="2821460">NTime</span><span class="op" id="2821465">]</span>&nbsp;<span class="op" id="2821467">*</span>&nbsp;<span class="num" id="2821469">4</span><span class="op" id="2821470">)</span><span class="op" id="2821471">,</span>&nbsp;<span class="builtintype" id="2821473">false</span><span class="op" id="2821478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821482">//&nbsp;Time&nbsp;zone&nbsp;indices&nbsp;for&nbsp;transition&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821526">txzones</span>&nbsp;<span class="op" id="2821534">:=</span>&nbsp;<span class="ident" id="2821537">d</span><span class="op" id="2821538">.</span><span class="ident" id="2821539">read</span><span class="op" id="2821543">(</span><span class="ident" id="2821544">n</span><span class="op" id="2821545">[</span><span class="ident" id="2821546">NTime</span><span class="op" id="2821551">]</span><span class="op" id="2821552">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821556">//&nbsp;Zone&nbsp;info&nbsp;structures</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821581">zonedata</span>&nbsp;<span class="op" id="2821590">:=</span>&nbsp;<span class="ident" id="2821593">data</span><span class="op" id="2821597">{</span><span class="ident" id="2821598">d</span><span class="op" id="2821599">.</span><span class="ident" id="2821600">read</span><span class="op" id="2821604">(</span><span class="ident" id="2821605">n</span><span class="op" id="2821606">[</span><span class="ident" id="2821607">NZone</span><span class="op" id="2821612">]</span>&nbsp;<span class="op" id="2821614">*</span>&nbsp;<span class="num" id="2821616">6</span><span class="op" id="2821617">)</span><span class="op" id="2821618">,</span>&nbsp;<span class="builtintype" id="2821620">false</span><span class="op" id="2821625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821629">//&nbsp;Time&nbsp;zone&nbsp;abbreviations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821658">abbrev</span>&nbsp;<span class="op" id="2821665">:=</span>&nbsp;<span class="ident" id="2821668">d</span><span class="op" id="2821669">.</span><span class="ident" id="2821670">read</span><span class="op" id="2821674">(</span><span class="ident" id="2821675">n</span><span class="op" id="2821676">[</span><span class="ident" id="2821677">NChar</span><span class="op" id="2821682">]</span><span class="op" id="2821683">)</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821687">//&nbsp;Leap-second&nbsp;time&nbsp;pairs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821714">d</span><span class="op" id="2821715">.</span><span class="ident" id="2821716">read</span><span class="op" id="2821720">(</span><span class="ident" id="2821721">n</span><span class="op" id="2821722">[</span><span class="ident" id="2821723">NLeap</span><span class="op" id="2821728">]</span>&nbsp;<span class="op" id="2821730">*</span>&nbsp;<span class="num" id="2821732">8</span><span class="op" id="2821733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821737">//&nbsp;Whether&nbsp;tx&nbsp;times&nbsp;associated&nbsp;with&nbsp;local&nbsp;time&nbsp;types</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821791">//&nbsp;are&nbsp;specified&nbsp;as&nbsp;standard&nbsp;time&nbsp;or&nbsp;wall&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821840">isstd</span>&nbsp;<span class="op" id="2821846">:=</span>&nbsp;<span class="ident" id="2821849">d</span><span class="op" id="2821850">.</span><span class="ident" id="2821851">read</span><span class="op" id="2821855">(</span><span class="ident" id="2821856">n</span><span class="op" id="2821857">[</span><span class="ident" id="2821858">NStdWall</span><span class="op" id="2821866">]</span><span class="op" id="2821867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821871">//&nbsp;Whether&nbsp;tx&nbsp;times&nbsp;associated&nbsp;with&nbsp;local&nbsp;time&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821925">//&nbsp;are&nbsp;specified&nbsp;as&nbsp;UTC&nbsp;or&nbsp;local&nbsp;time.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821965">isutc</span>&nbsp;<span class="op" id="2821971">:=</span>&nbsp;<span class="ident" id="2821974">d</span><span class="op" id="2821975">.</span><span class="ident" id="2821976">read</span><span class="op" id="2821980">(</span><span class="ident" id="2821981">n</span><span class="op" id="2821982">[</span><span class="ident" id="2821983">NUTCLocal</span><span class="op" id="2821992">]</span><span class="op" id="2821993">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821997">if</span>&nbsp;<span class="ident" id="2822000">d</span><span class="op" id="2822001">.</span><span class="builtintype" id="2822002">error</span>&nbsp;<span class="op" id="2822008">{</span>&nbsp;<span class="comment" id="2822010">//&nbsp;ran&nbsp;out&nbsp;of&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822031">return</span>&nbsp;<span class="ident" id="2822038">nil</span><span class="op" id="2822041">,</span>&nbsp;<span class="ident" id="2822043">badData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2822052">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2822056">//&nbsp;If&nbsp;version&nbsp;==&nbsp;2&nbsp;or&nbsp;3,&nbsp;the&nbsp;entire&nbsp;file&nbsp;repeats,&nbsp;this&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2822123">//&nbsp;8-byte&nbsp;ints&nbsp;for&nbsp;txtimes&nbsp;and&nbsp;leap&nbsp;seconds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2822169">//&nbsp;We&nbsp;won&#39;t&nbsp;need&nbsp;those&nbsp;until&nbsp;2106.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2822206">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;build&nbsp;up&nbsp;a&nbsp;useful&nbsp;data&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2822255">//&nbsp;First&nbsp;the&nbsp;zone&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2822287">//&nbsp;&nbsp;&nbsp;&nbsp;utcoff[4]&nbsp;isdst[1]&nbsp;nameindex[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822323">zone</span>&nbsp;<span class="op" id="2822328">:=</span>&nbsp;<span class="builtinfunc" id="2822331">make</span><span class="op" id="2822335">(</span><span class="op" id="2822336">[</span><span class="op" id="2822337">]</span><span class="ident" id="2822338">zone</span><span class="op" id="2822342">,</span>&nbsp;<span class="ident" id="2822344">n</span><span class="op" id="2822345">[</span><span class="ident" id="2822346">NZone</span><span class="op" id="2822351">]</span><span class="op" id="2822352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822355">for</span>&nbsp;<span class="ident" id="2822359">i</span>&nbsp;<span class="op" id="2822361">:=</span>&nbsp;<span class="keyword" id="2822364">range</span>&nbsp;<span class="ident" id="2822370">zone</span>&nbsp;<span class="op" id="2822375">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822379">var</span>&nbsp;<span class="ident" id="2822383">ok</span>&nbsp;<span class="builtintype" id="2822386">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822393">var</span>&nbsp;<span class="ident" id="2822397">n</span>&nbsp;<span class="builtintype" id="2822399">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822408">if</span>&nbsp;<span class="ident" id="2822411">n</span><span class="op" id="2822412">,</span>&nbsp;<span class="ident" id="2822414">ok</span>&nbsp;<span class="op" id="2822417">=</span>&nbsp;<span class="ident" id="2822419">zonedata</span><span class="op" id="2822427">.</span><span class="ident" id="2822428">big4</span><span class="op" id="2822432">(</span><span class="op" id="2822433">)</span><span class="op" id="2822434">;</span>&nbsp;<span class="op" id="2822436">!</span><span class="ident" id="2822437">ok</span>&nbsp;<span class="op" id="2822440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822445">return</span>&nbsp;<span class="ident" id="2822452">nil</span><span class="op" id="2822455">,</span>&nbsp;<span class="ident" id="2822457">badData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2822467">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822471">zone</span><span class="op" id="2822475">[</span><span class="ident" id="2822476">i</span><span class="op" id="2822477">]</span><span class="op" id="2822478">.</span><span class="ident" id="2822479">offset</span>&nbsp;<span class="op" id="2822486">=</span>&nbsp;<span class="builtintype" id="2822488">int</span><span class="op" id="2822491">(</span><span class="builtintype" id="2822492">int32</span><span class="op" id="2822497">(</span><span class="ident" id="2822498">n</span><span class="op" id="2822499">)</span><span class="op" id="2822500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822504">var</span>&nbsp;<span class="ident" id="2822508">b</span>&nbsp;<span class="builtintype" id="2822510">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822517">if</span>&nbsp;<span class="ident" id="2822520">b</span><span class="op" id="2822521">,</span>&nbsp;<span class="ident" id="2822523">ok</span>&nbsp;<span class="op" id="2822526">=</span>&nbsp;<span class="ident" id="2822528">zonedata</span><span class="op" id="2822536">.</span><span class="builtintype" id="2822537">byte</span><span class="op" id="2822541">(</span><span class="op" id="2822542">)</span><span class="op" id="2822543">;</span>&nbsp;<span class="op" id="2822545">!</span><span class="ident" id="2822546">ok</span>&nbsp;<span class="op" id="2822549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822554">return</span>&nbsp;<span class="ident" id="2822561">nil</span><span class="op" id="2822564">,</span>&nbsp;<span class="ident" id="2822566">badData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2822576">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822580">zone</span><span class="op" id="2822584">[</span><span class="ident" id="2822585">i</span><span class="op" id="2822586">]</span><span class="op" id="2822587">.</span><span class="ident" id="2822588">isDST</span>&nbsp;<span class="op" id="2822594">=</span>&nbsp;<span class="ident" id="2822596">b</span>&nbsp;<span class="op" id="2822598">!=</span>&nbsp;<span class="num" id="2822601">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822605">if</span>&nbsp;<span class="ident" id="2822608">b</span><span class="op" id="2822609">,</span>&nbsp;<span class="ident" id="2822611">ok</span>&nbsp;<span class="op" id="2822614">=</span>&nbsp;<span class="ident" id="2822616">zonedata</span><span class="op" id="2822624">.</span><span class="builtintype" id="2822625">byte</span><span class="op" id="2822629">(</span><span class="op" id="2822630">)</span><span class="op" id="2822631">;</span>&nbsp;<span class="op" id="2822633">!</span><span class="ident" id="2822634">ok</span>&nbsp;<span class="op" id="2822637">||</span>&nbsp;<span class="builtintype" id="2822640">int</span><span class="op" id="2822643">(</span><span class="ident" id="2822644">b</span><span class="op" id="2822645">)</span>&nbsp;<span class="op" id="2822647">&gt;=</span>&nbsp;<span class="builtinfunc" id="2822650">len</span><span class="op" id="2822653">(</span><span class="ident" id="2822654">abbrev</span><span class="op" id="2822660">)</span>&nbsp;<span class="op" id="2822662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822667">return</span>&nbsp;<span class="ident" id="2822674">nil</span><span class="op" id="2822677">,</span>&nbsp;<span class="ident" id="2822679">badData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2822689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822693">zone</span><span class="op" id="2822697">[</span><span class="ident" id="2822698">i</span><span class="op" id="2822699">]</span><span class="op" id="2822700">.</span><span class="ident" id="2822701">name</span>&nbsp;<span class="op" id="2822706">=</span>&nbsp;<span class="ident" id="2822708">byteString</span><span class="op" id="2822718">(</span><span class="ident" id="2822719">abbrev</span><span class="op" id="2822725">[</span><span class="ident" id="2822726">b</span><span class="op" id="2822727">:</span><span class="op" id="2822728">]</span><span class="op" id="2822729">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2822732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2822736">//&nbsp;Now&nbsp;the&nbsp;transition&nbsp;time&nbsp;info.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822770">tx</span>&nbsp;<span class="op" id="2822773">:=</span>&nbsp;<span class="builtinfunc" id="2822776">make</span><span class="op" id="2822780">(</span><span class="op" id="2822781">[</span><span class="op" id="2822782">]</span><span class="ident" id="2822783">zoneTrans</span><span class="op" id="2822792">,</span>&nbsp;<span class="ident" id="2822794">n</span><span class="op" id="2822795">[</span><span class="ident" id="2822796">NTime</span><span class="op" id="2822801">]</span><span class="op" id="2822802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822805">for</span>&nbsp;<span class="ident" id="2822809">i</span>&nbsp;<span class="op" id="2822811">:=</span>&nbsp;<span class="keyword" id="2822814">range</span>&nbsp;<span class="ident" id="2822820">tx</span>&nbsp;<span class="op" id="2822823">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822827">var</span>&nbsp;<span class="ident" id="2822831">ok</span>&nbsp;<span class="builtintype" id="2822834">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822841">var</span>&nbsp;<span class="ident" id="2822845">n</span>&nbsp;<span class="builtintype" id="2822847">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822856">if</span>&nbsp;<span class="ident" id="2822859">n</span><span class="op" id="2822860">,</span>&nbsp;<span class="ident" id="2822862">ok</span>&nbsp;<span class="op" id="2822865">=</span>&nbsp;<span class="ident" id="2822867">txtimes</span><span class="op" id="2822874">.</span><span class="ident" id="2822875">big4</span><span class="op" id="2822879">(</span><span class="op" id="2822880">)</span><span class="op" id="2822881">;</span>&nbsp;<span class="op" id="2822883">!</span><span class="ident" id="2822884">ok</span>&nbsp;<span class="op" id="2822887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822892">return</span>&nbsp;<span class="ident" id="2822899">nil</span><span class="op" id="2822902">,</span>&nbsp;<span class="ident" id="2822904">badData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2822914">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822918">tx</span><span class="op" id="2822920">[</span><span class="ident" id="2822921">i</span><span class="op" id="2822922">]</span><span class="op" id="2822923">.</span><span class="ident" id="2822924">when</span>&nbsp;<span class="op" id="2822929">=</span>&nbsp;<span class="ident" id="2822931">int64</span><span class="op" id="2822936">(</span><span class="builtintype" id="2822937">int32</span><span class="op" id="2822942">(</span><span class="ident" id="2822943">n</span><span class="op" id="2822944">)</span><span class="op" id="2822945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822949">if</span>&nbsp;<span class="builtintype" id="2822952">int</span><span class="op" id="2822955">(</span><span class="ident" id="2822956">txzones</span><span class="op" id="2822963">[</span><span class="ident" id="2822964">i</span><span class="op" id="2822965">]</span><span class="op" id="2822966">)</span>&nbsp;<span class="op" id="2822968">&gt;=</span>&nbsp;<span class="builtinfunc" id="2822971">len</span><span class="op" id="2822974">(</span><span class="ident" id="2822975">zone</span><span class="op" id="2822979">)</span>&nbsp;<span class="op" id="2822981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822986">return</span>&nbsp;<span class="ident" id="2822993">nil</span><span class="op" id="2822996">,</span>&nbsp;<span class="ident" id="2822998">badData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823012">tx</span><span class="op" id="2823014">[</span><span class="ident" id="2823015">i</span><span class="op" id="2823016">]</span><span class="op" id="2823017">.</span><span class="ident" id="2823018">index</span>&nbsp;<span class="op" id="2823024">=</span>&nbsp;<span class="ident" id="2823026">txzones</span><span class="op" id="2823033">[</span><span class="ident" id="2823034">i</span><span class="op" id="2823035">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823039">if</span>&nbsp;<span class="ident" id="2823042">i</span>&nbsp;<span class="op" id="2823044">&lt;</span>&nbsp;<span class="builtinfunc" id="2823046">len</span><span class="op" id="2823049">(</span><span class="ident" id="2823050">isstd</span><span class="op" id="2823055">)</span>&nbsp;<span class="op" id="2823057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823062">tx</span><span class="op" id="2823064">[</span><span class="ident" id="2823065">i</span><span class="op" id="2823066">]</span><span class="op" id="2823067">.</span><span class="ident" id="2823068">isstd</span>&nbsp;<span class="op" id="2823074">=</span>&nbsp;<span class="ident" id="2823076">isstd</span><span class="op" id="2823081">[</span><span class="ident" id="2823082">i</span><span class="op" id="2823083">]</span>&nbsp;<span class="op" id="2823085">!=</span>&nbsp;<span class="num" id="2823088">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823096">if</span>&nbsp;<span class="ident" id="2823099">i</span>&nbsp;<span class="op" id="2823101">&lt;</span>&nbsp;<span class="builtinfunc" id="2823103">len</span><span class="op" id="2823106">(</span><span class="ident" id="2823107">isutc</span><span class="op" id="2823112">)</span>&nbsp;<span class="op" id="2823114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823119">tx</span><span class="op" id="2823121">[</span><span class="ident" id="2823122">i</span><span class="op" id="2823123">]</span><span class="op" id="2823124">.</span><span class="ident" id="2823125">isutc</span>&nbsp;<span class="op" id="2823131">=</span>&nbsp;<span class="ident" id="2823133">isutc</span><span class="op" id="2823138">[</span><span class="ident" id="2823139">i</span><span class="op" id="2823140">]</span>&nbsp;<span class="op" id="2823142">!=</span>&nbsp;<span class="num" id="2823145">0</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823156">if</span>&nbsp;<span class="builtinfunc" id="2823159">len</span><span class="op" id="2823162">(</span><span class="ident" id="2823163">tx</span><span class="op" id="2823165">)</span>&nbsp;<span class="op" id="2823167">==</span>&nbsp;<span class="num" id="2823170">0</span>&nbsp;<span class="op" id="2823172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2823176">//&nbsp;Build&nbsp;fake&nbsp;transition&nbsp;to&nbsp;cover&nbsp;all&nbsp;time.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2823222">//&nbsp;This&nbsp;happens&nbsp;in&nbsp;fixed&nbsp;locations&nbsp;like&nbsp;&#34;Etc/GMT0&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823276">tx</span>&nbsp;<span class="op" id="2823279">=</span>&nbsp;<span class="builtinfunc" id="2823281">append</span><span class="op" id="2823287">(</span><span class="ident" id="2823288">tx</span><span class="op" id="2823290">,</span>&nbsp;<span class="ident" id="2823292">zoneTrans</span><span class="op" id="2823301">{</span><span class="ident" id="2823302">when</span><span class="op" id="2823306">:</span>&nbsp;<span class="ident" id="2823308">alpha</span><span class="op" id="2823313">,</span>&nbsp;<span class="ident" id="2823315">index</span><span class="op" id="2823320">:</span>&nbsp;<span class="num" id="2823322">0</span><span class="op" id="2823323">}</span><span class="op" id="2823324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2823331">//&nbsp;Committed&nbsp;to&nbsp;succeed.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823357">l</span>&nbsp;<span class="op" id="2823359">=</span>&nbsp;<span class="op" id="2823361">&amp;</span><span class="ident" id="2823362">Location</span><span class="op" id="2823370">{</span><span class="ident" id="2823371">zone</span><span class="op" id="2823375">:</span>&nbsp;<span class="ident" id="2823377">zone</span><span class="op" id="2823381">,</span>&nbsp;<span class="ident" id="2823383">tx</span><span class="op" id="2823385">:</span>&nbsp;<span class="ident" id="2823387">tx</span><span class="op" id="2823389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2823393">//&nbsp;Fill&nbsp;in&nbsp;the&nbsp;cache&nbsp;with&nbsp;information&nbsp;about&nbsp;right&nbsp;now,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2823449">//&nbsp;since&nbsp;that&nbsp;will&nbsp;be&nbsp;the&nbsp;most&nbsp;common&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823496">sec</span><span class="op" id="2823499">,</span>&nbsp;<span class="ident" id="2823501">_</span>&nbsp;<span class="op" id="2823503">:=</span>&nbsp;<span class="ident" id="2823506">now</span><span class="op" id="2823509">(</span><span class="op" id="2823510">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823513">for</span>&nbsp;<span class="ident" id="2823517">i</span>&nbsp;<span class="op" id="2823519">:=</span>&nbsp;<span class="keyword" id="2823522">range</span>&nbsp;<span class="ident" id="2823528">tx</span>&nbsp;<span class="op" id="2823531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823535">if</span>&nbsp;<span class="ident" id="2823538">tx</span><span class="op" id="2823540">[</span><span class="ident" id="2823541">i</span><span class="op" id="2823542">]</span><span class="op" id="2823543">.</span><span class="ident" id="2823544">when</span>&nbsp;<span class="op" id="2823549">&lt;=</span>&nbsp;<span class="ident" id="2823552">sec</span>&nbsp;<span class="op" id="2823556">&amp;&amp;</span>&nbsp;<span class="op" id="2823559">(</span><span class="ident" id="2823560">i</span><span class="op" id="2823561">+</span><span class="num" id="2823562">1</span>&nbsp;<span class="op" id="2823564">==</span>&nbsp;<span class="builtinfunc" id="2823567">len</span><span class="op" id="2823570">(</span><span class="ident" id="2823571">tx</span><span class="op" id="2823573">)</span>&nbsp;<span class="op" id="2823575">||</span>&nbsp;<span class="ident" id="2823578">sec</span>&nbsp;<span class="op" id="2823582">&lt;</span>&nbsp;<span class="ident" id="2823584">tx</span><span class="op" id="2823586">[</span><span class="ident" id="2823587">i</span><span class="op" id="2823588">+</span><span class="num" id="2823589">1</span><span class="op" id="2823590">]</span><span class="op" id="2823591">.</span><span class="ident" id="2823592">when</span><span class="op" id="2823596">)</span>&nbsp;<span class="op" id="2823598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823603">l</span><span class="op" id="2823604">.</span><span class="ident" id="2823605">cacheStart</span>&nbsp;<span class="op" id="2823616">=</span>&nbsp;<span class="ident" id="2823618">tx</span><span class="op" id="2823620">[</span><span class="ident" id="2823621">i</span><span class="op" id="2823622">]</span><span class="op" id="2823623">.</span><span class="ident" id="2823624">when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823632">l</span><span class="op" id="2823633">.</span><span class="ident" id="2823634">cacheEnd</span>&nbsp;<span class="op" id="2823643">=</span>&nbsp;<span class="ident" id="2823645">omega</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823654">if</span>&nbsp;<span class="ident" id="2823657">i</span><span class="op" id="2823658">+</span><span class="num" id="2823659">1</span>&nbsp;<span class="op" id="2823661">&lt;</span>&nbsp;<span class="builtinfunc" id="2823663">len</span><span class="op" id="2823666">(</span><span class="ident" id="2823667">tx</span><span class="op" id="2823669">)</span>&nbsp;<span class="op" id="2823671">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823677">l</span><span class="op" id="2823678">.</span><span class="ident" id="2823679">cacheEnd</span>&nbsp;<span class="op" id="2823688">=</span>&nbsp;<span class="ident" id="2823690">tx</span><span class="op" id="2823692">[</span><span class="ident" id="2823693">i</span><span class="op" id="2823694">+</span><span class="num" id="2823695">1</span><span class="op" id="2823696">]</span><span class="op" id="2823697">.</span><span class="ident" id="2823698">when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823711">l</span><span class="op" id="2823712">.</span><span class="ident" id="2823713">cacheZone</span>&nbsp;<span class="op" id="2823723">=</span>&nbsp;<span class="op" id="2823725">&amp;</span><span class="ident" id="2823726">l</span><span class="op" id="2823727">.</span><span class="ident" id="2823728">zone</span><span class="op" id="2823732">[</span><span class="ident" id="2823733">tx</span><span class="op" id="2823735">[</span><span class="ident" id="2823736">i</span><span class="op" id="2823737">]</span><span class="op" id="2823738">.</span><span class="ident" id="2823739">index</span><span class="op" id="2823744">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823751">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823755">return</span>&nbsp;<span class="ident" id="2823762">l</span><span class="op" id="2823763">,</span>&nbsp;<span class="ident" id="2823765">nil</span><br>
<span class="lineno"></span><span class="op" id="2823769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2823772">func</span>&nbsp;<span class="ident" id="2823777">loadZoneFile</span><span class="op" id="2823789">(</span><span class="ident" id="2823790">dir</span><span class="op" id="2823793">,</span>&nbsp;<span class="ident" id="2823795">name</span>&nbsp;<span class="builtintype" id="2823800">string</span><span class="op" id="2823806">)</span>&nbsp;<span class="op" id="2823808">(</span><span class="ident" id="2823809">l</span>&nbsp;<span class="op" id="2823811">*</span><span class="ident" id="2823812">Location</span><span class="op" id="2823820">,</span>&nbsp;<span class="ident" id="2823822">err</span>&nbsp;<span class="builtintype" id="2823826">error</span><span class="op" id="2823831">)</span>&nbsp;<span class="op" id="2823833">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823836">if</span>&nbsp;<span class="builtinfunc" id="2823839">len</span><span class="op" id="2823842">(</span><span class="ident" id="2823843">dir</span><span class="op" id="2823846">)</span>&nbsp;<span class="op" id="2823848">&gt;</span>&nbsp;<span class="num" id="2823850">4</span>&nbsp;<span class="op" id="2823852">&amp;&amp;</span>&nbsp;<span class="ident" id="2823855">dir</span><span class="op" id="2823858">[</span><span class="builtinfunc" id="2823859">len</span><span class="op" id="2823862">(</span><span class="ident" id="2823863">dir</span><span class="op" id="2823866">)</span><span class="op" id="2823867">-</span><span class="num" id="2823868">4</span><span class="op" id="2823869">:</span><span class="op" id="2823870">]</span>&nbsp;<span class="op" id="2823872">==</span>&nbsp;<span class="string" id="2823875">&#34;.zip&#34;</span>&nbsp;<span class="op" id="2823882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823886">return</span>&nbsp;<span class="ident" id="2823893">loadZoneZip</span><span class="op" id="2823904">(</span><span class="ident" id="2823905">dir</span><span class="op" id="2823908">,</span>&nbsp;<span class="ident" id="2823910">name</span><span class="op" id="2823914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823920">if</span>&nbsp;<span class="ident" id="2823923">dir</span>&nbsp;<span class="op" id="2823927">!=</span>&nbsp;<span class="string" id="2823930">&#34;&#34;</span>&nbsp;<span class="op" id="2823933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823937">name</span>&nbsp;<span class="op" id="2823942">=</span>&nbsp;<span class="ident" id="2823944">dir</span>&nbsp;<span class="op" id="2823948">+</span>&nbsp;<span class="string" id="2823950">&#34;/&#34;</span>&nbsp;<span class="op" id="2823954">+</span>&nbsp;<span class="ident" id="2823956">name</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823965">buf</span><span class="op" id="2823968">,</span>&nbsp;<span class="ident" id="2823970">err</span>&nbsp;<span class="op" id="2823974">:=</span>&nbsp;<span class="ident" id="2823977">readFile</span><span class="op" id="2823985">(</span><span class="ident" id="2823986">name</span><span class="op" id="2823990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823993">if</span>&nbsp;<span class="ident" id="2823996">err</span>&nbsp;<span class="op" id="2824000">!=</span>&nbsp;<span class="ident" id="2824003">nil</span>&nbsp;<span class="op" id="2824007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824011">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2824019">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824022">return</span>&nbsp;<span class="ident" id="2824029">loadZoneData</span><span class="op" id="2824041">(</span><span class="ident" id="2824042">buf</span><span class="op" id="2824045">)</span><br>
<span class="lineno"></span><span class="op" id="2824047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2824050">//&nbsp;There&nbsp;are&nbsp;500+&nbsp;zoneinfo&nbsp;files.&nbsp;&nbsp;Rather&nbsp;than&nbsp;distribute&nbsp;them&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="2824117">//&nbsp;individually,&nbsp;we&nbsp;ship&nbsp;them&nbsp;in&nbsp;an&nbsp;uncompressed&nbsp;zip&nbsp;file.</span><br>
<span class="lineno">215</span><span class="comment" id="2824176">//&nbsp;Used&nbsp;this&nbsp;way,&nbsp;the&nbsp;zip&nbsp;file&nbsp;format&nbsp;serves&nbsp;as&nbsp;a&nbsp;commonly&nbsp;readable</span><br>
<span class="lineno"></span><span class="comment" id="2824244">//&nbsp;container&nbsp;for&nbsp;the&nbsp;individual&nbsp;small&nbsp;files.&nbsp;&nbsp;We&nbsp;choose&nbsp;zip&nbsp;over&nbsp;tar</span><br>
<span class="lineno"></span><span class="comment" id="2824313">//&nbsp;because&nbsp;zip&nbsp;files&nbsp;have&nbsp;a&nbsp;contiguous&nbsp;table&nbsp;of&nbsp;contents,&nbsp;making</span><br>
<span class="lineno"></span><span class="comment" id="2824378">//&nbsp;individual&nbsp;file&nbsp;lookups&nbsp;faster,&nbsp;and&nbsp;because&nbsp;the&nbsp;per-file&nbsp;overhead</span><br>
<span class="lineno"></span><span class="comment" id="2824447">//&nbsp;in&nbsp;a&nbsp;zip&nbsp;file&nbsp;is&nbsp;considerably&nbsp;less&nbsp;than&nbsp;tar&#39;s&nbsp;512&nbsp;bytes.</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="2824508">//&nbsp;get4&nbsp;returns&nbsp;the&nbsp;little-endian&nbsp;32-bit&nbsp;value&nbsp;in&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="2824561">func</span>&nbsp;<span class="ident" id="2824566">get4</span><span class="op" id="2824570">(</span><span class="ident" id="2824571">b</span>&nbsp;<span class="op" id="2824573">[</span><span class="op" id="2824574">]</span><span class="builtintype" id="2824575">byte</span><span class="op" id="2824579">)</span>&nbsp;<span class="builtintype" id="2824581">int</span>&nbsp;<span class="op" id="2824585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824588">if</span>&nbsp;<span class="builtinfunc" id="2824591">len</span><span class="op" id="2824594">(</span><span class="ident" id="2824595">b</span><span class="op" id="2824596">)</span>&nbsp;<span class="op" id="2824598">&lt;</span>&nbsp;<span class="num" id="2824600">4</span>&nbsp;<span class="op" id="2824602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824606">return</span>&nbsp;<span class="num" id="2824613">0</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2824616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824619">return</span>&nbsp;<span class="builtintype" id="2824626">int</span><span class="op" id="2824629">(</span><span class="ident" id="2824630">b</span><span class="op" id="2824631">[</span><span class="num" id="2824632">0</span><span class="op" id="2824633">]</span><span class="op" id="2824634">)</span>&nbsp;<span class="op" id="2824636">|</span>&nbsp;<span class="builtintype" id="2824638">int</span><span class="op" id="2824641">(</span><span class="ident" id="2824642">b</span><span class="op" id="2824643">[</span><span class="num" id="2824644">1</span><span class="op" id="2824645">]</span><span class="op" id="2824646">)</span><span class="op" id="2824647">&lt;&lt;</span><span class="num" id="2824649">8</span>&nbsp;<span class="op" id="2824651">|</span>&nbsp;<span class="builtintype" id="2824653">int</span><span class="op" id="2824656">(</span><span class="ident" id="2824657">b</span><span class="op" id="2824658">[</span><span class="num" id="2824659">2</span><span class="op" id="2824660">]</span><span class="op" id="2824661">)</span><span class="op" id="2824662">&lt;&lt;</span><span class="num" id="2824664">16</span>&nbsp;<span class="op" id="2824667">|</span>&nbsp;<span class="builtintype" id="2824669">int</span><span class="op" id="2824672">(</span><span class="ident" id="2824673">b</span><span class="op" id="2824674">[</span><span class="num" id="2824675">3</span><span class="op" id="2824676">]</span><span class="op" id="2824677">)</span><span class="op" id="2824678">&lt;&lt;</span><span class="num" id="2824680">24</span><br>
<span class="lineno"></span><span class="op" id="2824683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2824686">//&nbsp;get2&nbsp;returns&nbsp;the&nbsp;little-endian&nbsp;16-bit&nbsp;value&nbsp;in&nbsp;b.</span><br>
<span class="lineno">230</span><span class="keyword" id="2824739">func</span>&nbsp;<span class="ident" id="2824744">get2</span><span class="op" id="2824748">(</span><span class="ident" id="2824749">b</span>&nbsp;<span class="op" id="2824751">[</span><span class="op" id="2824752">]</span><span class="builtintype" id="2824753">byte</span><span class="op" id="2824757">)</span>&nbsp;<span class="builtintype" id="2824759">int</span>&nbsp;<span class="op" id="2824763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824766">if</span>&nbsp;<span class="builtinfunc" id="2824769">len</span><span class="op" id="2824772">(</span><span class="ident" id="2824773">b</span><span class="op" id="2824774">)</span>&nbsp;<span class="op" id="2824776">&lt;</span>&nbsp;<span class="num" id="2824778">2</span>&nbsp;<span class="op" id="2824780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824784">return</span>&nbsp;<span class="num" id="2824791">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2824794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824797">return</span>&nbsp;<span class="builtintype" id="2824804">int</span><span class="op" id="2824807">(</span><span class="ident" id="2824808">b</span><span class="op" id="2824809">[</span><span class="num" id="2824810">0</span><span class="op" id="2824811">]</span><span class="op" id="2824812">)</span>&nbsp;<span class="op" id="2824814">|</span>&nbsp;<span class="builtintype" id="2824816">int</span><span class="op" id="2824819">(</span><span class="ident" id="2824820">b</span><span class="op" id="2824821">[</span><span class="num" id="2824822">1</span><span class="op" id="2824823">]</span><span class="op" id="2824824">)</span><span class="op" id="2824825">&lt;&lt;</span><span class="num" id="2824827">8</span><br>
<span class="lineno">235</span><span class="op" id="2824829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2824832">func</span>&nbsp;<span class="ident" id="2824837">loadZoneZip</span><span class="op" id="2824848">(</span><span class="ident" id="2824849">zipfile</span><span class="op" id="2824856">,</span>&nbsp;<span class="ident" id="2824858">name</span>&nbsp;<span class="builtintype" id="2824863">string</span><span class="op" id="2824869">)</span>&nbsp;<span class="op" id="2824871">(</span><span class="ident" id="2824872">l</span>&nbsp;<span class="op" id="2824874">*</span><span class="ident" id="2824875">Location</span><span class="op" id="2824883">,</span>&nbsp;<span class="ident" id="2824885">err</span>&nbsp;<span class="builtintype" id="2824889">error</span><span class="op" id="2824894">)</span>&nbsp;<span class="op" id="2824896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2824899">fd</span><span class="op" id="2824901">,</span>&nbsp;<span class="ident" id="2824903">err</span>&nbsp;<span class="op" id="2824907">:=</span>&nbsp;<span class="ident" id="2824910">open</span><span class="op" id="2824914">(</span><span class="ident" id="2824915">zipfile</span><span class="op" id="2824922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824925">if</span>&nbsp;<span class="ident" id="2824928">err</span>&nbsp;<span class="op" id="2824932">!=</span>&nbsp;<span class="ident" id="2824935">nil</span>&nbsp;<span class="op" id="2824939">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824943">return</span>&nbsp;<span class="ident" id="2824950">nil</span><span class="op" id="2824953">,</span>&nbsp;<span class="ident" id="2824955">errors</span><span class="op" id="2824961">.</span><span class="ident" id="2824962">New</span><span class="op" id="2824965">(</span><span class="string" id="2824966">&#34;open&nbsp;&#34;</span>&nbsp;<span class="op" id="2824974">+</span>&nbsp;<span class="ident" id="2824976">zipfile</span>&nbsp;<span class="op" id="2824984">+</span>&nbsp;<span class="string" id="2824986">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="2824991">+</span>&nbsp;<span class="ident" id="2824993">err</span><span class="op" id="2824996">.</span><span class="ident" id="2824997">Error</span><span class="op" id="2825002">(</span><span class="op" id="2825003">)</span><span class="op" id="2825004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2825007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825010">defer</span>&nbsp;<span class="ident" id="2825016">closefd</span><span class="op" id="2825023">(</span><span class="ident" id="2825024">fd</span><span class="op" id="2825026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825030">const</span>&nbsp;<span class="op" id="2825036">(</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825040">zecheader</span>&nbsp;<span class="op" id="2825050">=</span>&nbsp;<span class="num" id="2825052">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825065">zcheader</span>&nbsp;&nbsp;<span class="op" id="2825075">=</span>&nbsp;<span class="num" id="2825077">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825090">ztailsize</span>&nbsp;<span class="op" id="2825100">=</span>&nbsp;<span class="num" id="2825102">22</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825108">zheadersize</span>&nbsp;<span class="op" id="2825120">=</span>&nbsp;<span class="num" id="2825122">30</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825127">zheader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2825139">=</span>&nbsp;<span class="num" id="2825141">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2825153">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825157">buf</span>&nbsp;<span class="op" id="2825161">:=</span>&nbsp;<span class="builtinfunc" id="2825164">make</span><span class="op" id="2825168">(</span><span class="op" id="2825169">[</span><span class="op" id="2825170">]</span><span class="builtintype" id="2825171">byte</span><span class="op" id="2825175">,</span>&nbsp;<span class="ident" id="2825177">ztailsize</span><span class="op" id="2825186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825189">if</span>&nbsp;<span class="ident" id="2825192">err</span>&nbsp;<span class="op" id="2825196">:=</span>&nbsp;<span class="ident" id="2825199">preadn</span><span class="op" id="2825205">(</span><span class="ident" id="2825206">fd</span><span class="op" id="2825208">,</span>&nbsp;<span class="ident" id="2825210">buf</span><span class="op" id="2825213">,</span>&nbsp;<span class="op" id="2825215">-</span><span class="ident" id="2825216">ztailsize</span><span class="op" id="2825225">)</span><span class="op" id="2825226">;</span>&nbsp;<span class="ident" id="2825228">err</span>&nbsp;<span class="op" id="2825232">!=</span>&nbsp;<span class="ident" id="2825235">nil</span>&nbsp;<span class="op" id="2825239">||</span>&nbsp;<span class="ident" id="2825242">get4</span><span class="op" id="2825246">(</span><span class="ident" id="2825247">buf</span><span class="op" id="2825250">)</span>&nbsp;<span class="op" id="2825252">!=</span>&nbsp;<span class="ident" id="2825255">zecheader</span>&nbsp;<span class="op" id="2825265">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825269">return</span>&nbsp;<span class="ident" id="2825276">nil</span><span class="op" id="2825279">,</span>&nbsp;<span class="ident" id="2825281">errors</span><span class="op" id="2825287">.</span><span class="ident" id="2825288">New</span><span class="op" id="2825291">(</span><span class="string" id="2825292">&#34;corrupt&nbsp;zip&nbsp;file&nbsp;&#34;</span>&nbsp;<span class="op" id="2825312">+</span>&nbsp;<span class="ident" id="2825314">zipfile</span><span class="op" id="2825321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2825324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825327">n</span>&nbsp;<span class="op" id="2825329">:=</span>&nbsp;<span class="ident" id="2825332">get2</span><span class="op" id="2825336">(</span><span class="ident" id="2825337">buf</span><span class="op" id="2825340">[</span><span class="num" id="2825341">10</span><span class="op" id="2825343">:</span><span class="op" id="2825344">]</span><span class="op" id="2825345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825348">size</span>&nbsp;<span class="op" id="2825353">:=</span>&nbsp;<span class="ident" id="2825356">get4</span><span class="op" id="2825360">(</span><span class="ident" id="2825361">buf</span><span class="op" id="2825364">[</span><span class="num" id="2825365">12</span><span class="op" id="2825367">:</span><span class="op" id="2825368">]</span><span class="op" id="2825369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825372">off</span>&nbsp;<span class="op" id="2825376">:=</span>&nbsp;<span class="ident" id="2825379">get4</span><span class="op" id="2825383">(</span><span class="ident" id="2825384">buf</span><span class="op" id="2825387">[</span><span class="num" id="2825388">16</span><span class="op" id="2825390">:</span><span class="op" id="2825391">]</span><span class="op" id="2825392">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825396">buf</span>&nbsp;<span class="op" id="2825400">=</span>&nbsp;<span class="builtinfunc" id="2825402">make</span><span class="op" id="2825406">(</span><span class="op" id="2825407">[</span><span class="op" id="2825408">]</span><span class="builtintype" id="2825409">byte</span><span class="op" id="2825413">,</span>&nbsp;<span class="ident" id="2825415">size</span><span class="op" id="2825419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825422">if</span>&nbsp;<span class="ident" id="2825425">err</span>&nbsp;<span class="op" id="2825429">:=</span>&nbsp;<span class="ident" id="2825432">preadn</span><span class="op" id="2825438">(</span><span class="ident" id="2825439">fd</span><span class="op" id="2825441">,</span>&nbsp;<span class="ident" id="2825443">buf</span><span class="op" id="2825446">,</span>&nbsp;<span class="ident" id="2825448">off</span><span class="op" id="2825451">)</span><span class="op" id="2825452">;</span>&nbsp;<span class="ident" id="2825454">err</span>&nbsp;<span class="op" id="2825458">!=</span>&nbsp;<span class="ident" id="2825461">nil</span>&nbsp;<span class="op" id="2825465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825469">return</span>&nbsp;<span class="ident" id="2825476">nil</span><span class="op" id="2825479">,</span>&nbsp;<span class="ident" id="2825481">errors</span><span class="op" id="2825487">.</span><span class="ident" id="2825488">New</span><span class="op" id="2825491">(</span><span class="string" id="2825492">&#34;corrupt&nbsp;zip&nbsp;file&nbsp;&#34;</span>&nbsp;<span class="op" id="2825512">+</span>&nbsp;<span class="ident" id="2825514">zipfile</span><span class="op" id="2825521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2825524">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825528">for</span>&nbsp;<span class="ident" id="2825532">i</span>&nbsp;<span class="op" id="2825534">:=</span>&nbsp;<span class="num" id="2825537">0</span><span class="op" id="2825538">;</span>&nbsp;<span class="ident" id="2825540">i</span>&nbsp;<span class="op" id="2825542">&lt;</span>&nbsp;<span class="ident" id="2825544">n</span><span class="op" id="2825545">;</span>&nbsp;<span class="ident" id="2825547">i</span><span class="op" id="2825548">++</span>&nbsp;<span class="op" id="2825551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825555">//&nbsp;zip&nbsp;entry&nbsp;layout:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825578">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;magic[4]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825594">//&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;madevers[1]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825613">//&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;madeos[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825630">//&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;extvers[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825648">//&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;extos[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825664">//&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;flags[2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825680">//&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;meth[2]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825696">//&nbsp;&nbsp;&nbsp;&nbsp;12&nbsp;&nbsp;&nbsp;&nbsp;modtime[2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825715">//&nbsp;&nbsp;&nbsp;&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp;moddate[2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825734">//&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;crc[4]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825749">//&nbsp;&nbsp;&nbsp;&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;csize[4]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825766">//&nbsp;&nbsp;&nbsp;&nbsp;24&nbsp;&nbsp;&nbsp;&nbsp;uncsize[4]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825785">//&nbsp;&nbsp;&nbsp;&nbsp;28&nbsp;&nbsp;&nbsp;&nbsp;namelen[2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825804">//&nbsp;&nbsp;&nbsp;&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;xlen[2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825820">//&nbsp;&nbsp;&nbsp;&nbsp;32&nbsp;&nbsp;&nbsp;&nbsp;fclen[2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825837">//&nbsp;&nbsp;&nbsp;&nbsp;34&nbsp;&nbsp;&nbsp;&nbsp;disknum[2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825856">//&nbsp;&nbsp;&nbsp;&nbsp;36&nbsp;&nbsp;&nbsp;&nbsp;iattr[2]</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825873">//&nbsp;&nbsp;&nbsp;&nbsp;38&nbsp;&nbsp;&nbsp;&nbsp;eattr[4]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825890">//&nbsp;&nbsp;&nbsp;&nbsp;42&nbsp;&nbsp;&nbsp;&nbsp;off[4]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825905">//&nbsp;&nbsp;&nbsp;&nbsp;46&nbsp;&nbsp;&nbsp;&nbsp;name[namelen]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825927">//&nbsp;&nbsp;&nbsp;&nbsp;46+namelen+xlen+fclen&nbsp;-&nbsp;next&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825968">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825973">if</span>&nbsp;<span class="ident" id="2825976">get4</span><span class="op" id="2825980">(</span><span class="ident" id="2825981">buf</span><span class="op" id="2825984">)</span>&nbsp;<span class="op" id="2825986">!=</span>&nbsp;<span class="ident" id="2825989">zcheader</span>&nbsp;<span class="op" id="2825998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826003">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826015">meth</span>&nbsp;<span class="op" id="2826020">:=</span>&nbsp;<span class="ident" id="2826023">get2</span><span class="op" id="2826027">(</span><span class="ident" id="2826028">buf</span><span class="op" id="2826031">[</span><span class="num" id="2826032">10</span><span class="op" id="2826034">:</span><span class="op" id="2826035">]</span><span class="op" id="2826036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826040">size</span>&nbsp;<span class="op" id="2826045">:=</span>&nbsp;<span class="ident" id="2826048">get4</span><span class="op" id="2826052">(</span><span class="ident" id="2826053">buf</span><span class="op" id="2826056">[</span><span class="num" id="2826057">24</span><span class="op" id="2826059">:</span><span class="op" id="2826060">]</span><span class="op" id="2826061">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826065">namelen</span>&nbsp;<span class="op" id="2826073">:=</span>&nbsp;<span class="ident" id="2826076">get2</span><span class="op" id="2826080">(</span><span class="ident" id="2826081">buf</span><span class="op" id="2826084">[</span><span class="num" id="2826085">28</span><span class="op" id="2826087">:</span><span class="op" id="2826088">]</span><span class="op" id="2826089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826093">xlen</span>&nbsp;<span class="op" id="2826098">:=</span>&nbsp;<span class="ident" id="2826101">get2</span><span class="op" id="2826105">(</span><span class="ident" id="2826106">buf</span><span class="op" id="2826109">[</span><span class="num" id="2826110">30</span><span class="op" id="2826112">:</span><span class="op" id="2826113">]</span><span class="op" id="2826114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826118">fclen</span>&nbsp;<span class="op" id="2826124">:=</span>&nbsp;<span class="ident" id="2826127">get2</span><span class="op" id="2826131">(</span><span class="ident" id="2826132">buf</span><span class="op" id="2826135">[</span><span class="num" id="2826136">32</span><span class="op" id="2826138">:</span><span class="op" id="2826139">]</span><span class="op" id="2826140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826144">off</span>&nbsp;<span class="op" id="2826148">:=</span>&nbsp;<span class="ident" id="2826151">get4</span><span class="op" id="2826155">(</span><span class="ident" id="2826156">buf</span><span class="op" id="2826159">[</span><span class="num" id="2826160">42</span><span class="op" id="2826162">:</span><span class="op" id="2826163">]</span><span class="op" id="2826164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826168">zname</span>&nbsp;<span class="op" id="2826174">:=</span>&nbsp;<span class="ident" id="2826177">buf</span><span class="op" id="2826180">[</span><span class="num" id="2826181">46</span>&nbsp;<span class="op" id="2826184">:</span>&nbsp;<span class="num" id="2826186">46</span><span class="op" id="2826188">+</span><span class="ident" id="2826189">namelen</span><span class="op" id="2826196">]</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826200">buf</span>&nbsp;<span class="op" id="2826204">=</span>&nbsp;<span class="ident" id="2826206">buf</span><span class="op" id="2826209">[</span><span class="num" id="2826210">46</span><span class="op" id="2826212">+</span><span class="ident" id="2826213">namelen</span><span class="op" id="2826220">+</span><span class="ident" id="2826221">xlen</span><span class="op" id="2826225">+</span><span class="ident" id="2826226">fclen</span><span class="op" id="2826231">:</span><span class="op" id="2826232">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826236">if</span>&nbsp;<span class="builtintype" id="2826239">string</span><span class="op" id="2826245">(</span><span class="ident" id="2826246">zname</span><span class="op" id="2826251">)</span>&nbsp;<span class="op" id="2826253">!=</span>&nbsp;<span class="ident" id="2826256">name</span>&nbsp;<span class="op" id="2826261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826266">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826281">if</span>&nbsp;<span class="ident" id="2826284">meth</span>&nbsp;<span class="op" id="2826289">!=</span>&nbsp;<span class="num" id="2826292">0</span>&nbsp;<span class="op" id="2826294">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826299">return</span>&nbsp;<span class="ident" id="2826306">nil</span><span class="op" id="2826309">,</span>&nbsp;<span class="ident" id="2826311">errors</span><span class="op" id="2826317">.</span><span class="ident" id="2826318">New</span><span class="op" id="2826321">(</span><span class="string" id="2826322">&#34;unsupported&nbsp;compression&nbsp;for&nbsp;&#34;</span>&nbsp;<span class="op" id="2826353">+</span>&nbsp;<span class="ident" id="2826355">name</span>&nbsp;<span class="op" id="2826360">+</span>&nbsp;<span class="string" id="2826362">&#34;&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="2826369">+</span>&nbsp;<span class="ident" id="2826371">zipfile</span><span class="op" id="2826378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826387">//&nbsp;zip&nbsp;per-file&nbsp;header&nbsp;layout:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826420">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;magic[4]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826436">//&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;extvers[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826454">//&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;extos[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826470">//&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;flags[2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826486">//&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;meth[2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826501">//&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;modtime[2]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826520">//&nbsp;&nbsp;&nbsp;&nbsp;12&nbsp;&nbsp;&nbsp;&nbsp;moddate[2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826539">//&nbsp;&nbsp;&nbsp;&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp;crc[4]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826554">//&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;csize[4]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826571">//&nbsp;&nbsp;&nbsp;&nbsp;22&nbsp;&nbsp;&nbsp;&nbsp;uncsize[4]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826590">//&nbsp;&nbsp;&nbsp;&nbsp;26&nbsp;&nbsp;&nbsp;&nbsp;namelen[2]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826609">//&nbsp;&nbsp;&nbsp;&nbsp;28&nbsp;&nbsp;&nbsp;&nbsp;xlen[2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826625">//&nbsp;&nbsp;&nbsp;&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;name[namelen]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826647">//&nbsp;&nbsp;&nbsp;&nbsp;30+namelen+xlen&nbsp;-&nbsp;file&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826680">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826685">buf</span>&nbsp;<span class="op" id="2826689">=</span>&nbsp;<span class="builtinfunc" id="2826691">make</span><span class="op" id="2826695">(</span><span class="op" id="2826696">[</span><span class="op" id="2826697">]</span><span class="builtintype" id="2826698">byte</span><span class="op" id="2826702">,</span>&nbsp;<span class="ident" id="2826704">zheadersize</span><span class="op" id="2826715">+</span><span class="ident" id="2826716">namelen</span><span class="op" id="2826723">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826727">if</span>&nbsp;<span class="ident" id="2826730">err</span>&nbsp;<span class="op" id="2826734">:=</span>&nbsp;<span class="ident" id="2826737">preadn</span><span class="op" id="2826743">(</span><span class="ident" id="2826744">fd</span><span class="op" id="2826746">,</span>&nbsp;<span class="ident" id="2826748">buf</span><span class="op" id="2826751">,</span>&nbsp;<span class="ident" id="2826753">off</span><span class="op" id="2826756">)</span><span class="op" id="2826757">;</span>&nbsp;<span class="ident" id="2826759">err</span>&nbsp;<span class="op" id="2826763">!=</span>&nbsp;<span class="ident" id="2826766">nil</span>&nbsp;<span class="op" id="2826770">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826776">get4</span><span class="op" id="2826780">(</span><span class="ident" id="2826781">buf</span><span class="op" id="2826784">)</span>&nbsp;<span class="op" id="2826786">!=</span>&nbsp;<span class="ident" id="2826789">zheader</span>&nbsp;<span class="op" id="2826797">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826803">get2</span><span class="op" id="2826807">(</span><span class="ident" id="2826808">buf</span><span class="op" id="2826811">[</span><span class="num" id="2826812">8</span><span class="op" id="2826813">:</span><span class="op" id="2826814">]</span><span class="op" id="2826815">)</span>&nbsp;<span class="op" id="2826817">!=</span>&nbsp;<span class="ident" id="2826820">meth</span>&nbsp;<span class="op" id="2826825">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826831">get2</span><span class="op" id="2826835">(</span><span class="ident" id="2826836">buf</span><span class="op" id="2826839">[</span><span class="num" id="2826840">26</span><span class="op" id="2826842">:</span><span class="op" id="2826843">]</span><span class="op" id="2826844">)</span>&nbsp;<span class="op" id="2826846">!=</span>&nbsp;<span class="ident" id="2826849">namelen</span>&nbsp;<span class="op" id="2826857">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2826863">string</span><span class="op" id="2826869">(</span><span class="ident" id="2826870">buf</span><span class="op" id="2826873">[</span><span class="num" id="2826874">30</span><span class="op" id="2826876">:</span><span class="num" id="2826877">30</span><span class="op" id="2826879">+</span><span class="ident" id="2826880">namelen</span><span class="op" id="2826887">]</span><span class="op" id="2826888">)</span>&nbsp;<span class="op" id="2826890">!=</span>&nbsp;<span class="ident" id="2826893">name</span>&nbsp;<span class="op" id="2826898">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826903">return</span>&nbsp;<span class="ident" id="2826910">nil</span><span class="op" id="2826913">,</span>&nbsp;<span class="ident" id="2826915">errors</span><span class="op" id="2826921">.</span><span class="ident" id="2826922">New</span><span class="op" id="2826925">(</span><span class="string" id="2826926">&#34;corrupt&nbsp;zip&nbsp;file&nbsp;&#34;</span>&nbsp;<span class="op" id="2826946">+</span>&nbsp;<span class="ident" id="2826948">zipfile</span><span class="op" id="2826955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826963">xlen</span>&nbsp;<span class="op" id="2826968">=</span>&nbsp;<span class="ident" id="2826970">get2</span><span class="op" id="2826974">(</span><span class="ident" id="2826975">buf</span><span class="op" id="2826978">[</span><span class="num" id="2826979">28</span><span class="op" id="2826981">:</span><span class="op" id="2826982">]</span><span class="op" id="2826983">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826988">buf</span>&nbsp;<span class="op" id="2826992">=</span>&nbsp;<span class="builtinfunc" id="2826994">make</span><span class="op" id="2826998">(</span><span class="op" id="2826999">[</span><span class="op" id="2827000">]</span><span class="builtintype" id="2827001">byte</span><span class="op" id="2827005">,</span>&nbsp;<span class="ident" id="2827007">size</span><span class="op" id="2827011">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2827015">if</span>&nbsp;<span class="ident" id="2827018">err</span>&nbsp;<span class="op" id="2827022">:=</span>&nbsp;<span class="ident" id="2827025">preadn</span><span class="op" id="2827031">(</span><span class="ident" id="2827032">fd</span><span class="op" id="2827034">,</span>&nbsp;<span class="ident" id="2827036">buf</span><span class="op" id="2827039">,</span>&nbsp;<span class="ident" id="2827041">off</span><span class="op" id="2827044">+</span><span class="num" id="2827045">30</span><span class="op" id="2827047">+</span><span class="ident" id="2827048">namelen</span><span class="op" id="2827055">+</span><span class="ident" id="2827056">xlen</span><span class="op" id="2827060">)</span><span class="op" id="2827061">;</span>&nbsp;<span class="ident" id="2827063">err</span>&nbsp;<span class="op" id="2827067">!=</span>&nbsp;<span class="ident" id="2827070">nil</span>&nbsp;<span class="op" id="2827074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2827079">return</span>&nbsp;<span class="ident" id="2827086">nil</span><span class="op" id="2827089">,</span>&nbsp;<span class="ident" id="2827091">errors</span><span class="op" id="2827097">.</span><span class="ident" id="2827098">New</span><span class="op" id="2827101">(</span><span class="string" id="2827102">&#34;corrupt&nbsp;zip&nbsp;file&nbsp;&#34;</span>&nbsp;<span class="op" id="2827122">+</span>&nbsp;<span class="ident" id="2827124">zipfile</span><span class="op" id="2827131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2827135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2827140">return</span>&nbsp;<span class="ident" id="2827147">loadZoneData</span><span class="op" id="2827159">(</span><span class="ident" id="2827160">buf</span><span class="op" id="2827163">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2827166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2827170">return</span>&nbsp;<span class="ident" id="2827177">nil</span><span class="op" id="2827180">,</span>&nbsp;<span class="ident" id="2827182">errors</span><span class="op" id="2827188">.</span><span class="ident" id="2827189">New</span><span class="op" id="2827192">(</span><span class="string" id="2827193">&#34;cannot&nbsp;find&nbsp;&#34;</span>&nbsp;<span class="op" id="2827208">+</span>&nbsp;<span class="ident" id="2827210">name</span>&nbsp;<span class="op" id="2827215">+</span>&nbsp;<span class="string" id="2827217">&#34;&nbsp;in&nbsp;zip&nbsp;file&nbsp;&#34;</span>&nbsp;<span class="op" id="2827233">+</span>&nbsp;<span class="ident" id="2827235">zipfile</span><span class="op" id="2827242">)</span><br>
<span class="lineno"></span><span class="op" id="2827244">}</span>
</div>
</body>
</html>
