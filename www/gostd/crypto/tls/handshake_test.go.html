<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html" class="current">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7111276">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7111331">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7111385">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7111436">package</span>&nbsp;<span class="ident" id="7111444">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7111449">import</span>&nbsp;<span class="op" id="7111456">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7111459">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7111468">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7111484">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7111494">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7111502">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7111509">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7111515">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7111528">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7111535">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7111546">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7111557">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="7111564">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="7111567">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="7111642">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="7111719">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7111798">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="7111857">//</span><br>
<span class="lineno"></span><span class="comment" id="7111860">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7111934">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7112012">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="7112088">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="7112155">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="7112174">//</span><br>
<span class="lineno"></span><span class="comment" id="7112177">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="7112256">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="7112336">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="7112414">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="7112493">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7112512">var</span>&nbsp;<span class="ident" id="7112516">update</span>&nbsp;<span class="op" id="7112523">=</span>&nbsp;<span class="ident" id="7112525">flag</span><span class="op" id="7112529">.</span><span class="ident" id="7112530">Bool</span><span class="op" id="7112534">(</span><span class="string" id="7112535">&#34;update&#34;</span><span class="op" id="7112543">,</span>&nbsp;<span class="builtintype" id="7112545">false</span><span class="op" id="7112550">,</span>&nbsp;<span class="string" id="7112552">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="7112581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="7112584">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="7112664">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="7112738">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="7112756">type</span>&nbsp;<span class="ident" id="7112761">recordingConn</span>&nbsp;<span class="keyword" id="7112775">struct</span>&nbsp;<span class="op" id="7112782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7112785">net</span><span class="op" id="7112788">.</span><span class="ident" id="7112789">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7112795">sync</span><span class="op" id="7112799">.</span><span class="ident" id="7112800">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7112807">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7112815">[</span><span class="op" id="7112816">]</span><span class="op" id="7112817">[</span><span class="op" id="7112818">]</span><span class="builtintype" id="7112819">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7112825">reading</span>&nbsp;<span class="builtintype" id="7112833">bool</span><br>
<span class="lineno"></span><span class="op" id="7112838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7112841">func</span>&nbsp;<span class="op" id="7112846">(</span><span class="ident" id="7112847">r</span>&nbsp;<span class="op" id="7112849">*</span><span class="ident" id="7112850">recordingConn</span><span class="op" id="7112863">)</span>&nbsp;<span class="ident" id="7112865">Read</span><span class="op" id="7112869">(</span><span class="ident" id="7112870">b</span>&nbsp;<span class="op" id="7112872">[</span><span class="op" id="7112873">]</span><span class="builtintype" id="7112874">byte</span><span class="op" id="7112878">)</span>&nbsp;<span class="op" id="7112880">(</span><span class="ident" id="7112881">n</span>&nbsp;<span class="builtintype" id="7112883">int</span><span class="op" id="7112886">,</span>&nbsp;<span class="ident" id="7112888">err</span>&nbsp;<span class="builtintype" id="7112892">error</span><span class="op" id="7112897">)</span>&nbsp;<span class="op" id="7112899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7112902">if</span>&nbsp;<span class="ident" id="7112905">n</span><span class="op" id="7112906">,</span>&nbsp;<span class="ident" id="7112908">err</span>&nbsp;<span class="op" id="7112912">=</span>&nbsp;<span class="ident" id="7112914">r</span><span class="op" id="7112915">.</span><span class="ident" id="7112916">Conn</span><span class="op" id="7112920">.</span><span class="ident" id="7112921">Read</span><span class="op" id="7112925">(</span><span class="ident" id="7112926">b</span><span class="op" id="7112927">)</span><span class="op" id="7112928">;</span>&nbsp;<span class="ident" id="7112930">n</span>&nbsp;<span class="op" id="7112932">==</span>&nbsp;<span class="num" id="7112935">0</span>&nbsp;<span class="op" id="7112937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7112941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7112949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7112952">b</span>&nbsp;<span class="op" id="7112954">=</span>&nbsp;<span class="ident" id="7112956">b</span><span class="op" id="7112957">[</span><span class="op" id="7112958">:</span><span class="ident" id="7112959">n</span><span class="op" id="7112960">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7112964">r</span><span class="op" id="7112965">.</span><span class="ident" id="7112966">Lock</span><span class="op" id="7112970">(</span><span class="op" id="7112971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7112974">defer</span>&nbsp;<span class="ident" id="7112980">r</span><span class="op" id="7112981">.</span><span class="ident" id="7112982">Unlock</span><span class="op" id="7112988">(</span><span class="op" id="7112989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7112993">if</span>&nbsp;<span class="ident" id="7112996">l</span>&nbsp;<span class="op" id="7112998">:=</span>&nbsp;<span class="builtinfunc" id="7113001">len</span><span class="op" id="7113004">(</span><span class="ident" id="7113005">r</span><span class="op" id="7113006">.</span><span class="ident" id="7113007">flows</span><span class="op" id="7113012">)</span><span class="op" id="7113013">;</span>&nbsp;<span class="ident" id="7113015">l</span>&nbsp;<span class="op" id="7113017">==</span>&nbsp;<span class="num" id="7113020">0</span>&nbsp;<span class="op" id="7113022">||</span>&nbsp;<span class="op" id="7113025">!</span><span class="ident" id="7113026">r</span><span class="op" id="7113027">.</span><span class="ident" id="7113028">reading</span>&nbsp;<span class="op" id="7113036">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113040">buf</span>&nbsp;<span class="op" id="7113044">:=</span>&nbsp;<span class="builtinfunc" id="7113047">make</span><span class="op" id="7113051">(</span><span class="op" id="7113052">[</span><span class="op" id="7113053">]</span><span class="builtintype" id="7113054">byte</span><span class="op" id="7113058">,</span>&nbsp;<span class="builtinfunc" id="7113060">len</span><span class="op" id="7113063">(</span><span class="ident" id="7113064">b</span><span class="op" id="7113065">)</span><span class="op" id="7113066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7113070">copy</span><span class="op" id="7113074">(</span><span class="ident" id="7113075">buf</span><span class="op" id="7113078">,</span>&nbsp;<span class="ident" id="7113080">b</span><span class="op" id="7113081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113085">r</span><span class="op" id="7113086">.</span><span class="ident" id="7113087">flows</span>&nbsp;<span class="op" id="7113093">=</span>&nbsp;<span class="builtinfunc" id="7113095">append</span><span class="op" id="7113101">(</span><span class="ident" id="7113102">r</span><span class="op" id="7113103">.</span><span class="ident" id="7113104">flows</span><span class="op" id="7113109">,</span>&nbsp;<span class="ident" id="7113111">buf</span><span class="op" id="7113114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7113117">}</span>&nbsp;<span class="keyword" id="7113119">else</span>&nbsp;<span class="op" id="7113124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113128">r</span><span class="op" id="7113129">.</span><span class="ident" id="7113130">flows</span><span class="op" id="7113135">[</span><span class="ident" id="7113136">l</span><span class="op" id="7113137">-</span><span class="num" id="7113138">1</span><span class="op" id="7113139">]</span>&nbsp;<span class="op" id="7113141">=</span>&nbsp;<span class="builtinfunc" id="7113143">append</span><span class="op" id="7113149">(</span><span class="ident" id="7113150">r</span><span class="op" id="7113151">.</span><span class="ident" id="7113152">flows</span><span class="op" id="7113157">[</span><span class="ident" id="7113158">l</span><span class="op" id="7113159">-</span><span class="num" id="7113160">1</span><span class="op" id="7113161">]</span><span class="op" id="7113162">,</span>&nbsp;<span class="ident" id="7113164">b</span><span class="op" id="7113165">[</span><span class="op" id="7113166">:</span><span class="ident" id="7113167">n</span><span class="op" id="7113168">]</span><span class="op" id="7113169">...</span><span class="op" id="7113172">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7113175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113178">r</span><span class="op" id="7113179">.</span><span class="ident" id="7113180">reading</span>&nbsp;<span class="op" id="7113188">=</span>&nbsp;<span class="builtintype" id="7113190">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7113196">return</span><br>
<span class="lineno"></span><span class="op" id="7113203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7113206">func</span>&nbsp;<span class="op" id="7113211">(</span><span class="ident" id="7113212">r</span>&nbsp;<span class="op" id="7113214">*</span><span class="ident" id="7113215">recordingConn</span><span class="op" id="7113228">)</span>&nbsp;<span class="ident" id="7113230">Write</span><span class="op" id="7113235">(</span><span class="ident" id="7113236">b</span>&nbsp;<span class="op" id="7113238">[</span><span class="op" id="7113239">]</span><span class="builtintype" id="7113240">byte</span><span class="op" id="7113244">)</span>&nbsp;<span class="op" id="7113246">(</span><span class="ident" id="7113247">n</span>&nbsp;<span class="builtintype" id="7113249">int</span><span class="op" id="7113252">,</span>&nbsp;<span class="ident" id="7113254">err</span>&nbsp;<span class="builtintype" id="7113258">error</span><span class="op" id="7113263">)</span>&nbsp;<span class="op" id="7113265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7113268">if</span>&nbsp;<span class="ident" id="7113271">n</span><span class="op" id="7113272">,</span>&nbsp;<span class="ident" id="7113274">err</span>&nbsp;<span class="op" id="7113278">=</span>&nbsp;<span class="ident" id="7113280">r</span><span class="op" id="7113281">.</span><span class="ident" id="7113282">Conn</span><span class="op" id="7113286">.</span><span class="ident" id="7113287">Write</span><span class="op" id="7113292">(</span><span class="ident" id="7113293">b</span><span class="op" id="7113294">)</span><span class="op" id="7113295">;</span>&nbsp;<span class="ident" id="7113297">n</span>&nbsp;<span class="op" id="7113299">==</span>&nbsp;<span class="num" id="7113302">0</span>&nbsp;<span class="op" id="7113304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7113308">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7113316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113319">b</span>&nbsp;<span class="op" id="7113321">=</span>&nbsp;<span class="ident" id="7113323">b</span><span class="op" id="7113324">[</span><span class="op" id="7113325">:</span><span class="ident" id="7113326">n</span><span class="op" id="7113327">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113331">r</span><span class="op" id="7113332">.</span><span class="ident" id="7113333">Lock</span><span class="op" id="7113337">(</span><span class="op" id="7113338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7113341">defer</span>&nbsp;<span class="ident" id="7113347">r</span><span class="op" id="7113348">.</span><span class="ident" id="7113349">Unlock</span><span class="op" id="7113355">(</span><span class="op" id="7113356">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7113360">if</span>&nbsp;<span class="ident" id="7113363">l</span>&nbsp;<span class="op" id="7113365">:=</span>&nbsp;<span class="builtinfunc" id="7113368">len</span><span class="op" id="7113371">(</span><span class="ident" id="7113372">r</span><span class="op" id="7113373">.</span><span class="ident" id="7113374">flows</span><span class="op" id="7113379">)</span><span class="op" id="7113380">;</span>&nbsp;<span class="ident" id="7113382">l</span>&nbsp;<span class="op" id="7113384">==</span>&nbsp;<span class="num" id="7113387">0</span>&nbsp;<span class="op" id="7113389">||</span>&nbsp;<span class="ident" id="7113392">r</span><span class="op" id="7113393">.</span><span class="ident" id="7113394">reading</span>&nbsp;<span class="op" id="7113402">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113406">buf</span>&nbsp;<span class="op" id="7113410">:=</span>&nbsp;<span class="builtinfunc" id="7113413">make</span><span class="op" id="7113417">(</span><span class="op" id="7113418">[</span><span class="op" id="7113419">]</span><span class="builtintype" id="7113420">byte</span><span class="op" id="7113424">,</span>&nbsp;<span class="builtinfunc" id="7113426">len</span><span class="op" id="7113429">(</span><span class="ident" id="7113430">b</span><span class="op" id="7113431">)</span><span class="op" id="7113432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7113436">copy</span><span class="op" id="7113440">(</span><span class="ident" id="7113441">buf</span><span class="op" id="7113444">,</span>&nbsp;<span class="ident" id="7113446">b</span><span class="op" id="7113447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113451">r</span><span class="op" id="7113452">.</span><span class="ident" id="7113453">flows</span>&nbsp;<span class="op" id="7113459">=</span>&nbsp;<span class="builtinfunc" id="7113461">append</span><span class="op" id="7113467">(</span><span class="ident" id="7113468">r</span><span class="op" id="7113469">.</span><span class="ident" id="7113470">flows</span><span class="op" id="7113475">,</span>&nbsp;<span class="ident" id="7113477">buf</span><span class="op" id="7113480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7113483">}</span>&nbsp;<span class="keyword" id="7113485">else</span>&nbsp;<span class="op" id="7113490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113494">r</span><span class="op" id="7113495">.</span><span class="ident" id="7113496">flows</span><span class="op" id="7113501">[</span><span class="ident" id="7113502">l</span><span class="op" id="7113503">-</span><span class="num" id="7113504">1</span><span class="op" id="7113505">]</span>&nbsp;<span class="op" id="7113507">=</span>&nbsp;<span class="builtinfunc" id="7113509">append</span><span class="op" id="7113515">(</span><span class="ident" id="7113516">r</span><span class="op" id="7113517">.</span><span class="ident" id="7113518">flows</span><span class="op" id="7113523">[</span><span class="ident" id="7113524">l</span><span class="op" id="7113525">-</span><span class="num" id="7113526">1</span><span class="op" id="7113527">]</span><span class="op" id="7113528">,</span>&nbsp;<span class="ident" id="7113530">b</span><span class="op" id="7113531">[</span><span class="op" id="7113532">:</span><span class="ident" id="7113533">n</span><span class="op" id="7113534">]</span><span class="op" id="7113535">...</span><span class="op" id="7113538">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7113541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113544">r</span><span class="op" id="7113545">.</span><span class="ident" id="7113546">reading</span>&nbsp;<span class="op" id="7113554">=</span>&nbsp;<span class="builtintype" id="7113556">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7113563">return</span><br>
<span class="lineno"></span><span class="op" id="7113570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="7113573">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="7113647">func</span>&nbsp;<span class="op" id="7113652">(</span><span class="ident" id="7113653">r</span>&nbsp;<span class="op" id="7113655">*</span><span class="ident" id="7113656">recordingConn</span><span class="op" id="7113669">)</span>&nbsp;<span class="ident" id="7113671">WriteTo</span><span class="op" id="7113678">(</span><span class="ident" id="7113679">w</span>&nbsp;<span class="ident" id="7113681">io</span><span class="op" id="7113683">.</span><span class="ident" id="7113684">Writer</span><span class="op" id="7113690">)</span>&nbsp;<span class="op" id="7113692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7113695">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113747">clientToServer</span>&nbsp;<span class="op" id="7113762">:=</span>&nbsp;<span class="builtintype" id="7113765">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7113772">for</span>&nbsp;<span class="ident" id="7113776">i</span><span class="op" id="7113777">,</span>&nbsp;<span class="ident" id="7113779">flow</span>&nbsp;<span class="op" id="7113784">:=</span>&nbsp;<span class="keyword" id="7113787">range</span>&nbsp;<span class="ident" id="7113793">r</span><span class="op" id="7113794">.</span><span class="ident" id="7113795">flows</span>&nbsp;<span class="op" id="7113801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113805">source</span><span class="op" id="7113811">,</span>&nbsp;<span class="ident" id="7113813">dest</span>&nbsp;<span class="op" id="7113818">:=</span>&nbsp;<span class="string" id="7113821">&#34;client&#34;</span><span class="op" id="7113829">,</span>&nbsp;<span class="string" id="7113831">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7113842">if</span>&nbsp;<span class="op" id="7113845">!</span><span class="ident" id="7113846">clientToServer</span>&nbsp;<span class="op" id="7113861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113866">source</span><span class="op" id="7113872">,</span>&nbsp;<span class="ident" id="7113874">dest</span>&nbsp;<span class="op" id="7113879">=</span>&nbsp;<span class="ident" id="7113881">dest</span><span class="op" id="7113885">,</span>&nbsp;<span class="ident" id="7113887">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7113896">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113900">fmt</span><span class="op" id="7113903">.</span><span class="ident" id="7113904">Fprintf</span><span class="op" id="7113911">(</span><span class="ident" id="7113912">w</span><span class="op" id="7113913">,</span>&nbsp;<span class="string" id="7113915">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="7113941">,</span>&nbsp;<span class="ident" id="7113943">i</span><span class="op" id="7113944">+</span><span class="num" id="7113945">1</span><span class="op" id="7113946">,</span>&nbsp;<span class="ident" id="7113948">source</span><span class="op" id="7113954">,</span>&nbsp;<span class="ident" id="7113956">dest</span><span class="op" id="7113960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113964">dumper</span>&nbsp;<span class="op" id="7113971">:=</span>&nbsp;<span class="ident" id="7113974">hex</span><span class="op" id="7113977">.</span><span class="ident" id="7113978">Dumper</span><span class="op" id="7113984">(</span><span class="ident" id="7113985">w</span><span class="op" id="7113986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7113990">dumper</span><span class="op" id="7113996">.</span><span class="ident" id="7113997">Write</span><span class="op" id="7114002">(</span><span class="ident" id="7114003">flow</span><span class="op" id="7114007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7114011">dumper</span><span class="op" id="7114017">.</span><span class="ident" id="7114018">Close</span><span class="op" id="7114023">(</span><span class="op" id="7114024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7114028">clientToServer</span>&nbsp;<span class="op" id="7114043">=</span>&nbsp;<span class="op" id="7114045">!</span><span class="ident" id="7114046">clientToServer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7114062">}</span><br>
<span class="lineno"></span><span class="op" id="7114064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7114067">func</span>&nbsp;<span class="ident" id="7114072">parseTestData</span><span class="op" id="7114085">(</span><span class="ident" id="7114086">r</span>&nbsp;<span class="ident" id="7114088">io</span><span class="op" id="7114090">.</span><span class="ident" id="7114091">Reader</span><span class="op" id="7114097">)</span>&nbsp;<span class="op" id="7114099">(</span><span class="ident" id="7114100">flows</span>&nbsp;<span class="op" id="7114106">[</span><span class="op" id="7114107">]</span><span class="op" id="7114108">[</span><span class="op" id="7114109">]</span><span class="builtintype" id="7114110">byte</span><span class="op" id="7114114">,</span>&nbsp;<span class="ident" id="7114116">err</span>&nbsp;<span class="builtintype" id="7114120">error</span><span class="op" id="7114125">)</span>&nbsp;<span class="op" id="7114127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7114130">var</span>&nbsp;<span class="ident" id="7114134">currentFlow</span>&nbsp;<span class="op" id="7114146">[</span><span class="op" id="7114147">]</span><span class="builtintype" id="7114148">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7114155">scanner</span>&nbsp;<span class="op" id="7114163">:=</span>&nbsp;<span class="ident" id="7114166">bufio</span><span class="op" id="7114171">.</span><span class="ident" id="7114172">NewScanner</span><span class="op" id="7114182">(</span><span class="ident" id="7114183">r</span><span class="op" id="7114184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7114187">for</span>&nbsp;<span class="ident" id="7114191">scanner</span><span class="op" id="7114198">.</span><span class="ident" id="7114199">Scan</span><span class="op" id="7114203">(</span><span class="op" id="7114204">)</span>&nbsp;<span class="op" id="7114206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7114210">line</span>&nbsp;<span class="op" id="7114215">:=</span>&nbsp;<span class="ident" id="7114218">scanner</span><span class="op" id="7114225">.</span><span class="ident" id="7114226">Text</span><span class="op" id="7114230">(</span><span class="op" id="7114231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7114235">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7114299">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7114319">if</span>&nbsp;<span class="ident" id="7114322">strings</span><span class="op" id="7114329">.</span><span class="ident" id="7114330">HasPrefix</span><span class="op" id="7114339">(</span><span class="ident" id="7114340">line</span><span class="op" id="7114344">,</span>&nbsp;<span class="string" id="7114346">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="7114352">)</span>&nbsp;<span class="op" id="7114354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7114359">if</span>&nbsp;<span class="builtinfunc" id="7114362">len</span><span class="op" id="7114365">(</span><span class="ident" id="7114366">currentFlow</span><span class="op" id="7114377">)</span>&nbsp;<span class="op" id="7114379">&gt;</span>&nbsp;<span class="num" id="7114381">0</span>&nbsp;<span class="op" id="7114383">||</span>&nbsp;<span class="builtinfunc" id="7114386">len</span><span class="op" id="7114389">(</span><span class="ident" id="7114390">flows</span><span class="op" id="7114395">)</span>&nbsp;<span class="op" id="7114397">&gt;</span>&nbsp;<span class="num" id="7114399">0</span>&nbsp;<span class="op" id="7114401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7114407">flows</span>&nbsp;<span class="op" id="7114413">=</span>&nbsp;<span class="builtinfunc" id="7114415">append</span><span class="op" id="7114421">(</span><span class="ident" id="7114422">flows</span><span class="op" id="7114427">,</span>&nbsp;<span class="ident" id="7114429">currentFlow</span><span class="op" id="7114440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7114446">currentFlow</span>&nbsp;<span class="op" id="7114458">=</span>&nbsp;<span class="builtintype" id="7114460">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7114467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7114472">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7114483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7114488">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7114551">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7114604">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7114666">if</span>&nbsp;<span class="ident" id="7114669">i</span>&nbsp;<span class="op" id="7114671">:=</span>&nbsp;<span class="ident" id="7114674">strings</span><span class="op" id="7114681">.</span><span class="ident" id="7114682">IndexByte</span><span class="op" id="7114691">(</span><span class="ident" id="7114692">line</span><span class="op" id="7114696">,</span>&nbsp;<span class="string" id="7114698">&#39;&nbsp;&#39;</span><span class="op" id="7114701">)</span><span class="op" id="7114702">;</span>&nbsp;<span class="ident" id="7114704">i</span>&nbsp;<span class="op" id="7114706">&gt;=</span>&nbsp;<span class="num" id="7114709">0</span>&nbsp;<span class="op" id="7114711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7114716">line</span>&nbsp;<span class="op" id="7114721">=</span>&nbsp;<span class="ident" id="7114723">line</span><span class="op" id="7114727">[</span><span class="ident" id="7114728">i</span><span class="op" id="7114729">:</span><span class="op" id="7114730">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7114734">}</span>&nbsp;<span class="keyword" id="7114736">else</span>&nbsp;<span class="op" id="7114741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7114746">return</span>&nbsp;<span class="builtintype" id="7114753">nil</span><span class="op" id="7114756">,</span>&nbsp;<span class="ident" id="7114758">errors</span><span class="op" id="7114764">.</span><span class="ident" id="7114765">New</span><span class="op" id="7114768">(</span><span class="string" id="7114769">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7114788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7114792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7114797">if</span>&nbsp;<span class="ident" id="7114800">i</span>&nbsp;<span class="op" id="7114802">:=</span>&nbsp;<span class="ident" id="7114805">strings</span><span class="op" id="7114812">.</span><span class="ident" id="7114813">IndexByte</span><span class="op" id="7114822">(</span><span class="ident" id="7114823">line</span><span class="op" id="7114827">,</span>&nbsp;<span class="string" id="7114829">&#39;|&#39;</span><span class="op" id="7114832">)</span><span class="op" id="7114833">;</span>&nbsp;<span class="ident" id="7114835">i</span>&nbsp;<span class="op" id="7114837">&gt;=</span>&nbsp;<span class="num" id="7114840">0</span>&nbsp;<span class="op" id="7114842">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7114847">line</span>&nbsp;<span class="op" id="7114852">=</span>&nbsp;<span class="ident" id="7114854">line</span><span class="op" id="7114858">[</span><span class="op" id="7114859">:</span><span class="ident" id="7114860">i</span><span class="op" id="7114861">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7114865">}</span>&nbsp;<span class="keyword" id="7114867">else</span>&nbsp;<span class="op" id="7114872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7114877">return</span>&nbsp;<span class="builtintype" id="7114884">nil</span><span class="op" id="7114887">,</span>&nbsp;<span class="ident" id="7114889">errors</span><span class="op" id="7114895">.</span><span class="ident" id="7114896">New</span><span class="op" id="7114899">(</span><span class="string" id="7114900">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7114919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7114923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7114928">hexBytes</span>&nbsp;<span class="op" id="7114937">:=</span>&nbsp;<span class="ident" id="7114940">strings</span><span class="op" id="7114947">.</span><span class="ident" id="7114948">Fields</span><span class="op" id="7114954">(</span><span class="ident" id="7114955">line</span><span class="op" id="7114959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7114963">for</span>&nbsp;<span class="ident" id="7114967">_</span><span class="op" id="7114968">,</span>&nbsp;<span class="ident" id="7114970">hexByte</span>&nbsp;<span class="op" id="7114978">:=</span>&nbsp;<span class="keyword" id="7114981">range</span>&nbsp;<span class="ident" id="7114987">hexBytes</span>&nbsp;<span class="op" id="7114996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7115001">val</span><span class="op" id="7115004">,</span>&nbsp;<span class="ident" id="7115006">err</span>&nbsp;<span class="op" id="7115010">:=</span>&nbsp;<span class="ident" id="7115013">strconv</span><span class="op" id="7115020">.</span><span class="ident" id="7115021">ParseUint</span><span class="op" id="7115030">(</span><span class="ident" id="7115031">hexByte</span><span class="op" id="7115038">,</span>&nbsp;<span class="num" id="7115040">16</span><span class="op" id="7115042">,</span>&nbsp;<span class="num" id="7115044">8</span><span class="op" id="7115045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7115050">if</span>&nbsp;<span class="ident" id="7115053">err</span>&nbsp;<span class="op" id="7115057">!=</span>&nbsp;<span class="builtintype" id="7115060">nil</span>&nbsp;<span class="op" id="7115064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7115070">return</span>&nbsp;<span class="builtintype" id="7115077">nil</span><span class="op" id="7115080">,</span>&nbsp;<span class="ident" id="7115082">errors</span><span class="op" id="7115088">.</span><span class="ident" id="7115089">New</span><span class="op" id="7115092">(</span><span class="string" id="7115093">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="7115127">+</span>&nbsp;<span class="ident" id="7115129">err</span><span class="op" id="7115132">.</span><span class="ident" id="7115133">Error</span><span class="op" id="7115138">(</span><span class="op" id="7115139">)</span><span class="op" id="7115140">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7115145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7115150">currentFlow</span>&nbsp;<span class="op" id="7115162">=</span>&nbsp;<span class="builtinfunc" id="7115164">append</span><span class="op" id="7115170">(</span><span class="ident" id="7115171">currentFlow</span><span class="op" id="7115182">,</span>&nbsp;<span class="builtintype" id="7115184">byte</span><span class="op" id="7115188">(</span><span class="ident" id="7115189">val</span><span class="op" id="7115192">)</span><span class="op" id="7115193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7115197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7115200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7115204">if</span>&nbsp;<span class="builtinfunc" id="7115207">len</span><span class="op" id="7115210">(</span><span class="ident" id="7115211">currentFlow</span><span class="op" id="7115222">)</span>&nbsp;<span class="op" id="7115224">&gt;</span>&nbsp;<span class="num" id="7115226">0</span>&nbsp;<span class="op" id="7115228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7115232">flows</span>&nbsp;<span class="op" id="7115238">=</span>&nbsp;<span class="builtinfunc" id="7115240">append</span><span class="op" id="7115246">(</span><span class="ident" id="7115247">flows</span><span class="op" id="7115252">,</span>&nbsp;<span class="ident" id="7115254">currentFlow</span><span class="op" id="7115265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7115268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7115272">return</span>&nbsp;<span class="ident" id="7115279">flows</span><span class="op" id="7115284">,</span>&nbsp;<span class="builtintype" id="7115286">nil</span><br>
<span class="lineno">155</span><span class="op" id="7115290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7115293">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="7115367">func</span>&nbsp;<span class="ident" id="7115372">tempFile</span><span class="op" id="7115380">(</span><span class="ident" id="7115381">contents</span>&nbsp;<span class="builtintype" id="7115390">string</span><span class="op" id="7115396">)</span>&nbsp;<span class="builtintype" id="7115398">string</span>&nbsp;<span class="op" id="7115405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7115408">file</span><span class="op" id="7115412">,</span>&nbsp;<span class="ident" id="7115414">err</span>&nbsp;<span class="op" id="7115418">:=</span>&nbsp;<span class="ident" id="7115421">ioutil</span><span class="op" id="7115427">.</span><span class="ident" id="7115428">TempFile</span><span class="op" id="7115436">(</span><span class="string" id="7115437">&#34;&#34;</span><span class="op" id="7115439">,</span>&nbsp;<span class="string" id="7115441">&#34;go-tls-test&#34;</span><span class="op" id="7115454">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7115457">if</span>&nbsp;<span class="ident" id="7115460">err</span>&nbsp;<span class="op" id="7115464">!=</span>&nbsp;<span class="builtintype" id="7115467">nil</span>&nbsp;<span class="op" id="7115471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7115475">panic</span><span class="op" id="7115480">(</span><span class="string" id="7115481">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="7115512">+</span>&nbsp;<span class="ident" id="7115514">err</span><span class="op" id="7115517">.</span><span class="ident" id="7115518">Error</span><span class="op" id="7115523">(</span><span class="op" id="7115524">)</span><span class="op" id="7115525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7115528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7115531">path</span>&nbsp;<span class="op" id="7115536">:=</span>&nbsp;<span class="ident" id="7115539">file</span><span class="op" id="7115543">.</span><span class="ident" id="7115544">Name</span><span class="op" id="7115548">(</span><span class="op" id="7115549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7115552">file</span><span class="op" id="7115556">.</span><span class="ident" id="7115557">WriteString</span><span class="op" id="7115568">(</span><span class="ident" id="7115569">contents</span><span class="op" id="7115577">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7115580">file</span><span class="op" id="7115584">.</span><span class="ident" id="7115585">Close</span><span class="op" id="7115590">(</span><span class="op" id="7115591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7115594">return</span>&nbsp;<span class="ident" id="7115601">path</span><br>
<span class="lineno"></span><span class="op" id="7115606">}</span>
</div>
</body>
</html>
