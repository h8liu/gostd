<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5941235">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5941290">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5941344">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5941395">//&nbsp;Package&nbsp;format&nbsp;implements&nbsp;standard&nbsp;formatting&nbsp;of&nbsp;Go&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="5941458">package</span>&nbsp;<span class="ident" id="5941466">format</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5941474">import</span>&nbsp;<span class="op" id="5941481">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941484">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941493">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941500">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941510">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941523">&#34;go/printer&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941537">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941549">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5941555">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5941565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5941568">var</span>&nbsp;<span class="ident" id="5941572">config</span>&nbsp;<span class="op" id="5941579">=</span>&nbsp;<span class="ident" id="5941581">printer</span><span class="op" id="5941588">.</span><span class="ident" id="5941589">Config</span><span class="op" id="5941595">{</span><span class="ident" id="5941596">Mode</span><span class="op" id="5941600">:</span>&nbsp;<span class="ident" id="5941602">printer</span><span class="op" id="5941609">.</span><span class="ident" id="5941610">UseSpaces</span>&nbsp;<span class="op" id="5941620">|</span>&nbsp;<span class="ident" id="5941622">printer</span><span class="op" id="5941629">.</span><span class="ident" id="5941630">TabIndent</span><span class="op" id="5941639">,</span>&nbsp;<span class="ident" id="5941641">Tabwidth</span><span class="op" id="5941649">:</span>&nbsp;<span class="num" id="5941651">8</span><span class="op" id="5941652">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5941655">const</span>&nbsp;<span class="ident" id="5941661">parserMode</span>&nbsp;<span class="op" id="5941672">=</span>&nbsp;<span class="ident" id="5941674">parser</span><span class="op" id="5941680">.</span><span class="ident" id="5941681">ParseComments</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5941696">//&nbsp;Node&nbsp;formats&nbsp;node&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="5941772">//</span><br>
<span class="lineno">25</span><span class="comment" id="5941775">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*printer.CommentedNode,&nbsp;[]ast.Decl,</span><br>
<span class="lineno"></span><span class="comment" id="5941847">//&nbsp;[]ast.Stmt,&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,</span><br>
<span class="lineno"></span><span class="comment" id="5941920">//&nbsp;or&nbsp;ast.Stmt.&nbsp;Node&nbsp;does&nbsp;not&nbsp;modify&nbsp;node.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5941990">//&nbsp;nodes&nbsp;representing&nbsp;partial&nbsp;source&nbsp;files&nbsp;(i.e.,&nbsp;if&nbsp;the&nbsp;node&nbsp;is&nbsp;not&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5942062">//&nbsp;*ast.File&nbsp;or&nbsp;a&nbsp;*printer.CommentedNode&nbsp;not&nbsp;wrapping&nbsp;an&nbsp;*ast.File).</span><br>
<span class="lineno">30</span><span class="comment" id="5942131">//</span><br>
<span class="lineno"></span><span class="comment" id="5942134">//&nbsp;The&nbsp;function&nbsp;may&nbsp;return&nbsp;early&nbsp;(before&nbsp;the&nbsp;entire&nbsp;result&nbsp;is&nbsp;written)</span><br>
<span class="lineno"></span><span class="comment" id="5942205">//&nbsp;and&nbsp;return&nbsp;a&nbsp;formatting&nbsp;error,&nbsp;for&nbsp;instance&nbsp;due&nbsp;to&nbsp;an&nbsp;incorrect&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="5942277">//</span><br>
<span class="lineno"></span><span class="keyword" id="5942280">func</span>&nbsp;<span class="ident" id="5942285">Node</span><span class="op" id="5942289">(</span><span class="ident" id="5942290">dst</span>&nbsp;<span class="ident" id="5942294">io</span><span class="op" id="5942296">.</span><span class="ident" id="5942297">Writer</span><span class="op" id="5942303">,</span>&nbsp;<span class="ident" id="5942305">fset</span>&nbsp;<span class="op" id="5942310">*</span><span class="ident" id="5942311">token</span><span class="op" id="5942316">.</span><span class="ident" id="5942317">FileSet</span><span class="op" id="5942324">,</span>&nbsp;<span class="ident" id="5942326">node</span>&nbsp;<span class="keyword" id="5942331">interface</span><span class="op" id="5942340">{</span><span class="op" id="5942341">}</span><span class="op" id="5942342">)</span>&nbsp;<span class="builtintype" id="5942344">error</span>&nbsp;<span class="op" id="5942350">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5942353">//&nbsp;Determine&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;complete&nbsp;source&nbsp;file&nbsp;(file&nbsp;!=&nbsp;nil).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942416">var</span>&nbsp;<span class="ident" id="5942420">file</span>&nbsp;<span class="op" id="5942425">*</span><span class="ident" id="5942426">ast</span><span class="op" id="5942429">.</span><span class="ident" id="5942430">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942436">var</span>&nbsp;<span class="ident" id="5942440">cnode</span>&nbsp;<span class="op" id="5942446">*</span><span class="ident" id="5942447">printer</span><span class="op" id="5942454">.</span><span class="ident" id="5942455">CommentedNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942470">switch</span>&nbsp;<span class="ident" id="5942477">n</span>&nbsp;<span class="op" id="5942479">:=</span>&nbsp;<span class="ident" id="5942482">node</span><span class="op" id="5942486">.</span><span class="op" id="5942487">(</span><span class="keyword" id="5942488">type</span><span class="op" id="5942492">)</span>&nbsp;<span class="op" id="5942494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942497">case</span>&nbsp;<span class="op" id="5942502">*</span><span class="ident" id="5942503">ast</span><span class="op" id="5942506">.</span><span class="ident" id="5942507">File</span><span class="op" id="5942511">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942515">file</span>&nbsp;<span class="op" id="5942520">=</span>&nbsp;<span class="ident" id="5942522">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942525">case</span>&nbsp;<span class="op" id="5942530">*</span><span class="ident" id="5942531">printer</span><span class="op" id="5942538">.</span><span class="ident" id="5942539">CommentedNode</span><span class="op" id="5942552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942556">if</span>&nbsp;<span class="ident" id="5942559">f</span><span class="op" id="5942560">,</span>&nbsp;<span class="ident" id="5942562">ok</span>&nbsp;<span class="op" id="5942565">:=</span>&nbsp;<span class="ident" id="5942568">n</span><span class="op" id="5942569">.</span><span class="ident" id="5942570">Node</span><span class="op" id="5942574">.</span><span class="op" id="5942575">(</span><span class="op" id="5942576">*</span><span class="ident" id="5942577">ast</span><span class="op" id="5942580">.</span><span class="ident" id="5942581">File</span><span class="op" id="5942585">)</span><span class="op" id="5942586">;</span>&nbsp;<span class="ident" id="5942588">ok</span>&nbsp;<span class="op" id="5942591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942596">file</span>&nbsp;<span class="op" id="5942601">=</span>&nbsp;<span class="ident" id="5942603">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942608">cnode</span>&nbsp;<span class="op" id="5942614">=</span>&nbsp;<span class="ident" id="5942616">n</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5942627">//&nbsp;Sort&nbsp;imports&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942658">if</span>&nbsp;<span class="ident" id="5942661">file</span>&nbsp;<span class="op" id="5942666">!=</span>&nbsp;<span class="ident" id="5942669">nil</span>&nbsp;<span class="op" id="5942673">&amp;&amp;</span>&nbsp;<span class="ident" id="5942676">hasUnsortedImports</span><span class="op" id="5942694">(</span><span class="ident" id="5942695">file</span><span class="op" id="5942699">)</span>&nbsp;<span class="op" id="5942701">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5942705">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;AST&nbsp;because&nbsp;ast.SortImports&nbsp;is&nbsp;destructive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5942773">//&nbsp;TODO(gri)&nbsp;Do&nbsp;this&nbsp;more&nbsp;efficiently.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942814">var</span>&nbsp;<span class="ident" id="5942818">buf</span>&nbsp;<span class="ident" id="5942822">bytes</span><span class="op" id="5942827">.</span><span class="ident" id="5942828">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942837">err</span>&nbsp;<span class="op" id="5942841">:=</span>&nbsp;<span class="ident" id="5942844">config</span><span class="op" id="5942850">.</span><span class="ident" id="5942851">Fprint</span><span class="op" id="5942857">(</span><span class="op" id="5942858">&amp;</span><span class="ident" id="5942859">buf</span><span class="op" id="5942862">,</span>&nbsp;<span class="ident" id="5942864">fset</span><span class="op" id="5942868">,</span>&nbsp;<span class="ident" id="5942870">file</span><span class="op" id="5942874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942878">if</span>&nbsp;<span class="ident" id="5942881">err</span>&nbsp;<span class="op" id="5942885">!=</span>&nbsp;<span class="ident" id="5942888">nil</span>&nbsp;<span class="op" id="5942892">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942897">return</span>&nbsp;<span class="ident" id="5942904">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942914">file</span><span class="op" id="5942918">,</span>&nbsp;<span class="ident" id="5942920">err</span>&nbsp;<span class="op" id="5942924">=</span>&nbsp;<span class="ident" id="5942926">parser</span><span class="op" id="5942932">.</span><span class="ident" id="5942933">ParseFile</span><span class="op" id="5942942">(</span><span class="ident" id="5942943">fset</span><span class="op" id="5942947">,</span>&nbsp;<span class="string" id="5942949">&#34;&#34;</span><span class="op" id="5942951">,</span>&nbsp;<span class="ident" id="5942953">buf</span><span class="op" id="5942956">.</span><span class="ident" id="5942957">Bytes</span><span class="op" id="5942962">(</span><span class="op" id="5942963">)</span><span class="op" id="5942964">,</span>&nbsp;<span class="ident" id="5942966">parserMode</span><span class="op" id="5942976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942980">if</span>&nbsp;<span class="ident" id="5942983">err</span>&nbsp;<span class="op" id="5942987">!=</span>&nbsp;<span class="ident" id="5942990">nil</span>&nbsp;<span class="op" id="5942994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5942999">//&nbsp;We&nbsp;should&nbsp;never&nbsp;get&nbsp;here.&nbsp;If&nbsp;we&nbsp;do,&nbsp;provide&nbsp;good&nbsp;diagnostic.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943066">return</span>&nbsp;<span class="ident" id="5943073">fmt</span><span class="op" id="5943076">.</span><span class="ident" id="5943077">Errorf</span><span class="op" id="5943083">(</span><span class="string" id="5943084">&#34;format.Node&nbsp;internal&nbsp;error&nbsp;(%s)&#34;</span><span class="op" id="5943117">,</span>&nbsp;<span class="ident" id="5943119">err</span><span class="op" id="5943122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943130">ast</span><span class="op" id="5943133">.</span><span class="ident" id="5943134">SortImports</span><span class="op" id="5943145">(</span><span class="ident" id="5943146">fset</span><span class="op" id="5943150">,</span>&nbsp;<span class="ident" id="5943152">file</span><span class="op" id="5943156">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943161">//&nbsp;Use&nbsp;new&nbsp;file&nbsp;with&nbsp;sorted&nbsp;imports.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943200">node</span>&nbsp;<span class="op" id="5943205">=</span>&nbsp;<span class="ident" id="5943207">file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943214">if</span>&nbsp;<span class="ident" id="5943217">cnode</span>&nbsp;<span class="op" id="5943223">!=</span>&nbsp;<span class="ident" id="5943226">nil</span>&nbsp;<span class="op" id="5943230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943235">node</span>&nbsp;<span class="op" id="5943240">=</span>&nbsp;<span class="op" id="5943242">&amp;</span><span class="ident" id="5943243">printer</span><span class="op" id="5943250">.</span><span class="ident" id="5943251">CommentedNode</span><span class="op" id="5943264">{</span><span class="ident" id="5943265">Node</span><span class="op" id="5943269">:</span>&nbsp;<span class="ident" id="5943271">file</span><span class="op" id="5943275">,</span>&nbsp;<span class="ident" id="5943277">Comments</span><span class="op" id="5943285">:</span>&nbsp;<span class="ident" id="5943287">cnode</span><span class="op" id="5943292">.</span><span class="ident" id="5943293">Comments</span><span class="op" id="5943301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943308">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943312">return</span>&nbsp;<span class="ident" id="5943319">config</span><span class="op" id="5943325">.</span><span class="ident" id="5943326">Fprint</span><span class="op" id="5943332">(</span><span class="ident" id="5943333">dst</span><span class="op" id="5943336">,</span>&nbsp;<span class="ident" id="5943338">fset</span><span class="op" id="5943342">,</span>&nbsp;<span class="ident" id="5943344">node</span><span class="op" id="5943348">)</span><br>
<span class="lineno"></span><span class="op" id="5943350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5943353">//&nbsp;Source&nbsp;formats&nbsp;src&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;returns&nbsp;the&nbsp;result</span><br>
<span class="lineno">75</span><span class="comment" id="5943423">//&nbsp;or&nbsp;an&nbsp;(I/O&nbsp;or&nbsp;syntax)&nbsp;error.&nbsp;src&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;a&nbsp;syntactically</span><br>
<span class="lineno"></span><span class="comment" id="5943493">//&nbsp;correct&nbsp;Go&nbsp;source&nbsp;file,&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;Go&nbsp;declarations&nbsp;or&nbsp;statements.</span><br>
<span class="lineno"></span><span class="comment" id="5943564">//</span><br>
<span class="lineno"></span><span class="comment" id="5943567">//&nbsp;If&nbsp;src&nbsp;is&nbsp;a&nbsp;partial&nbsp;source&nbsp;file,&nbsp;the&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space&nbsp;of&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="5943641">//&nbsp;is&nbsp;applied&nbsp;to&nbsp;the&nbsp;result&nbsp;(such&nbsp;that&nbsp;it&nbsp;has&nbsp;the&nbsp;same&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno">80</span><span class="comment" id="5943717">//&nbsp;space&nbsp;as&nbsp;src),&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;indented&nbsp;by&nbsp;the&nbsp;same&nbsp;amount&nbsp;as&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5943794">//&nbsp;line&nbsp;of&nbsp;src&nbsp;containing&nbsp;code.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for&nbsp;partial&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5943875">//</span><br>
<span class="lineno"></span><span class="keyword" id="5943878">func</span>&nbsp;<span class="ident" id="5943883">Source</span><span class="op" id="5943889">(</span><span class="ident" id="5943890">src</span>&nbsp;<span class="op" id="5943894">[</span><span class="op" id="5943895">]</span><span class="builtintype" id="5943896">byte</span><span class="op" id="5943900">)</span>&nbsp;<span class="op" id="5943902">(</span><span class="op" id="5943903">[</span><span class="op" id="5943904">]</span><span class="builtintype" id="5943905">byte</span><span class="op" id="5943909">,</span>&nbsp;<span class="builtintype" id="5943911">error</span><span class="op" id="5943916">)</span>&nbsp;<span class="op" id="5943918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943921">fset</span>&nbsp;<span class="op" id="5943926">:=</span>&nbsp;<span class="ident" id="5943929">token</span><span class="op" id="5943934">.</span><span class="ident" id="5943935">NewFileSet</span><span class="op" id="5943945">(</span><span class="op" id="5943946">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943949">file</span><span class="op" id="5943953">,</span>&nbsp;<span class="ident" id="5943955">sourceAdj</span><span class="op" id="5943964">,</span>&nbsp;<span class="ident" id="5943966">indentAdj</span><span class="op" id="5943975">,</span>&nbsp;<span class="ident" id="5943977">err</span>&nbsp;<span class="op" id="5943981">:=</span>&nbsp;<span class="ident" id="5943984">parse</span><span class="op" id="5943989">(</span><span class="ident" id="5943990">fset</span><span class="op" id="5943994">,</span>&nbsp;<span class="string" id="5943996">&#34;&#34;</span><span class="op" id="5943998">,</span>&nbsp;<span class="ident" id="5944000">src</span><span class="op" id="5944003">,</span>&nbsp;<span class="builtintype" id="5944005">true</span><span class="op" id="5944009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944012">if</span>&nbsp;<span class="ident" id="5944015">err</span>&nbsp;<span class="op" id="5944019">!=</span>&nbsp;<span class="ident" id="5944022">nil</span>&nbsp;<span class="op" id="5944026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944030">return</span>&nbsp;<span class="ident" id="5944037">nil</span><span class="op" id="5944040">,</span>&nbsp;<span class="ident" id="5944042">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944051">if</span>&nbsp;<span class="ident" id="5944054">sourceAdj</span>&nbsp;<span class="op" id="5944064">==</span>&nbsp;<span class="ident" id="5944067">nil</span>&nbsp;<span class="op" id="5944071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944075">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944102">//&nbsp;TODO(gri)&nbsp;consider&nbsp;doing&nbsp;this&nbsp;always.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944145">ast</span><span class="op" id="5944148">.</span><span class="ident" id="5944149">SortImports</span><span class="op" id="5944160">(</span><span class="ident" id="5944161">fset</span><span class="op" id="5944165">,</span>&nbsp;<span class="ident" id="5944167">file</span><span class="op" id="5944171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944174">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944178">return</span>&nbsp;<span class="ident" id="5944185">format</span><span class="op" id="5944191">(</span><span class="ident" id="5944192">fset</span><span class="op" id="5944196">,</span>&nbsp;<span class="ident" id="5944198">file</span><span class="op" id="5944202">,</span>&nbsp;<span class="ident" id="5944204">sourceAdj</span><span class="op" id="5944213">,</span>&nbsp;<span class="ident" id="5944215">indentAdj</span><span class="op" id="5944224">,</span>&nbsp;<span class="ident" id="5944226">src</span><span class="op" id="5944229">,</span>&nbsp;<span class="ident" id="5944231">config</span><span class="op" id="5944237">)</span><br>
<span class="lineno"></span><span class="op" id="5944239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5944242">func</span>&nbsp;<span class="ident" id="5944247">hasUnsortedImports</span><span class="op" id="5944265">(</span><span class="ident" id="5944266">file</span>&nbsp;<span class="op" id="5944271">*</span><span class="ident" id="5944272">ast</span><span class="op" id="5944275">.</span><span class="ident" id="5944276">File</span><span class="op" id="5944280">)</span>&nbsp;<span class="builtintype" id="5944282">bool</span>&nbsp;<span class="op" id="5944287">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944290">for</span>&nbsp;<span class="ident" id="5944294">_</span><span class="op" id="5944295">,</span>&nbsp;<span class="ident" id="5944297">d</span>&nbsp;<span class="op" id="5944299">:=</span>&nbsp;<span class="keyword" id="5944302">range</span>&nbsp;<span class="ident" id="5944308">file</span><span class="op" id="5944312">.</span><span class="ident" id="5944313">Decls</span>&nbsp;<span class="op" id="5944319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944323">d</span><span class="op" id="5944324">,</span>&nbsp;<span class="ident" id="5944326">ok</span>&nbsp;<span class="op" id="5944329">:=</span>&nbsp;<span class="ident" id="5944332">d</span><span class="op" id="5944333">.</span><span class="op" id="5944334">(</span><span class="op" id="5944335">*</span><span class="ident" id="5944336">ast</span><span class="op" id="5944339">.</span><span class="ident" id="5944340">GenDecl</span><span class="op" id="5944347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944351">if</span>&nbsp;<span class="op" id="5944354">!</span><span class="ident" id="5944355">ok</span>&nbsp;<span class="op" id="5944358">||</span>&nbsp;<span class="ident" id="5944361">d</span><span class="op" id="5944362">.</span><span class="ident" id="5944363">Tok</span>&nbsp;<span class="op" id="5944367">!=</span>&nbsp;<span class="ident" id="5944370">token</span><span class="op" id="5944375">.</span><span class="ident" id="5944376">IMPORT</span>&nbsp;<span class="op" id="5944383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944388">//&nbsp;Not&nbsp;an&nbsp;import&nbsp;declaration,&nbsp;so&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944436">//&nbsp;Imports&nbsp;are&nbsp;always&nbsp;first.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944468">return</span>&nbsp;<span class="builtintype" id="5944475">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944487">if</span>&nbsp;<span class="ident" id="5944490">d</span><span class="op" id="5944491">.</span><span class="ident" id="5944492">Lparen</span><span class="op" id="5944498">.</span><span class="ident" id="5944499">IsValid</span><span class="op" id="5944506">(</span><span class="op" id="5944507">)</span>&nbsp;<span class="op" id="5944509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944514">//&nbsp;For&nbsp;now&nbsp;assume&nbsp;all&nbsp;grouped&nbsp;imports&nbsp;are&nbsp;unsorted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944569">//&nbsp;TODO(gri)&nbsp;Should&nbsp;check&nbsp;if&nbsp;they&nbsp;are&nbsp;sorted&nbsp;already.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944626">return</span>&nbsp;<span class="builtintype" id="5944633">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944644">//&nbsp;Ungrouped&nbsp;imports&nbsp;are&nbsp;sorted&nbsp;by&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944692">return</span>&nbsp;<span class="builtintype" id="5944699">false</span><br>
<span class="lineno">115</span><span class="op" id="5944705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5944708">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5944788">//&nbsp;Support&nbsp;functions</span><br>
<span class="lineno"></span><span class="comment" id="5944809">//</span><br>
<span class="lineno">120</span><span class="comment" id="5944812">//&nbsp;The&nbsp;functions&nbsp;parse,&nbsp;format,&nbsp;and&nbsp;isSpace&nbsp;below&nbsp;are&nbsp;identical&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5944883">//&nbsp;respective&nbsp;functions&nbsp;in&nbsp;cmd/gofmt/gofmt.go&nbsp;-&nbsp;keep&nbsp;them&nbsp;in&nbsp;sync!</span><br>
<span class="lineno"></span><span class="comment" id="5944950">//</span><br>
<span class="lineno"></span><span class="comment" id="5944953">//&nbsp;TODO(gri)&nbsp;Factor&nbsp;out&nbsp;this&nbsp;functionality,&nbsp;eventually.</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5945010">//&nbsp;parse&nbsp;parses&nbsp;src,&nbsp;which&nbsp;was&nbsp;read&nbsp;from&nbsp;the&nbsp;named&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="5945067">//&nbsp;as&nbsp;a&nbsp;Go&nbsp;source&nbsp;file,&nbsp;declaration,&nbsp;or&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5945123">func</span>&nbsp;<span class="ident" id="5945128">parse</span><span class="op" id="5945133">(</span><span class="ident" id="5945134">fset</span>&nbsp;<span class="op" id="5945139">*</span><span class="ident" id="5945140">token</span><span class="op" id="5945145">.</span><span class="ident" id="5945146">FileSet</span><span class="op" id="5945153">,</span>&nbsp;<span class="ident" id="5945155">filename</span>&nbsp;<span class="builtintype" id="5945164">string</span><span class="op" id="5945170">,</span>&nbsp;<span class="ident" id="5945172">src</span>&nbsp;<span class="op" id="5945176">[</span><span class="op" id="5945177">]</span><span class="builtintype" id="5945178">byte</span><span class="op" id="5945182">,</span>&nbsp;<span class="ident" id="5945184">fragmentOk</span>&nbsp;<span class="builtintype" id="5945195">bool</span><span class="op" id="5945199">)</span>&nbsp;<span class="op" id="5945201">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945204">file</span>&nbsp;<span class="op" id="5945209">*</span><span class="ident" id="5945210">ast</span><span class="op" id="5945213">.</span><span class="ident" id="5945214">File</span><span class="op" id="5945218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945221">sourceAdj</span>&nbsp;<span class="keyword" id="5945231">func</span><span class="op" id="5945235">(</span><span class="ident" id="5945236">src</span>&nbsp;<span class="op" id="5945240">[</span><span class="op" id="5945241">]</span><span class="builtintype" id="5945242">byte</span><span class="op" id="5945246">,</span>&nbsp;<span class="ident" id="5945248">indent</span>&nbsp;<span class="builtintype" id="5945255">int</span><span class="op" id="5945258">)</span>&nbsp;<span class="op" id="5945260">[</span><span class="op" id="5945261">]</span><span class="builtintype" id="5945262">byte</span><span class="op" id="5945266">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945269">indentAdj</span>&nbsp;<span class="builtintype" id="5945279">int</span><span class="op" id="5945282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945285">err</span>&nbsp;<span class="builtintype" id="5945289">error</span><span class="op" id="5945294">,</span><br>
<span class="lineno"></span><span class="op" id="5945296">)</span>&nbsp;<span class="op" id="5945298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945301">//&nbsp;Try&nbsp;as&nbsp;whole&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945331">file</span><span class="op" id="5945335">,</span>&nbsp;<span class="ident" id="5945337">err</span>&nbsp;<span class="op" id="5945341">=</span>&nbsp;<span class="ident" id="5945343">parser</span><span class="op" id="5945349">.</span><span class="ident" id="5945350">ParseFile</span><span class="op" id="5945359">(</span><span class="ident" id="5945360">fset</span><span class="op" id="5945364">,</span>&nbsp;<span class="ident" id="5945366">filename</span><span class="op" id="5945374">,</span>&nbsp;<span class="ident" id="5945376">src</span><span class="op" id="5945379">,</span>&nbsp;<span class="ident" id="5945381">parserMode</span><span class="op" id="5945391">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945394">//&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;error,&nbsp;return.&nbsp;&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945485">//&nbsp;package&nbsp;line&nbsp;and&nbsp;source&nbsp;fragments&nbsp;are&nbsp;ok,&nbsp;fall&nbsp;through&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945547">//&nbsp;try&nbsp;as&nbsp;a&nbsp;source&nbsp;fragment.&nbsp;&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945614">if</span>&nbsp;<span class="ident" id="5945617">err</span>&nbsp;<span class="op" id="5945621">==</span>&nbsp;<span class="ident" id="5945624">nil</span>&nbsp;<span class="op" id="5945628">||</span>&nbsp;<span class="op" id="5945631">!</span><span class="ident" id="5945632">fragmentOk</span>&nbsp;<span class="op" id="5945643">||</span>&nbsp;<span class="op" id="5945646">!</span><span class="ident" id="5945647">strings</span><span class="op" id="5945654">.</span><span class="ident" id="5945655">Contains</span><span class="op" id="5945663">(</span><span class="ident" id="5945664">err</span><span class="op" id="5945667">.</span><span class="ident" id="5945668">Error</span><span class="op" id="5945673">(</span><span class="op" id="5945674">)</span><span class="op" id="5945675">,</span>&nbsp;<span class="string" id="5945677">&#34;expected&nbsp;&#39;package&#39;&#34;</span><span class="op" id="5945697">)</span>&nbsp;<span class="op" id="5945699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945703">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945715">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;declaration&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945772">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945807">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945869">//&nbsp;in&nbsp;psrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945904">psrc</span>&nbsp;<span class="op" id="5945909">:=</span>&nbsp;<span class="builtinfunc" id="5945912">append</span><span class="op" id="5945918">(</span><span class="op" id="5945919">[</span><span class="op" id="5945920">]</span><span class="builtintype" id="5945921">byte</span><span class="op" id="5945925">(</span><span class="string" id="5945926">&#34;package&nbsp;p;&#34;</span><span class="op" id="5945938">)</span><span class="op" id="5945939">,</span>&nbsp;<span class="ident" id="5945941">src</span><span class="op" id="5945944">...</span><span class="op" id="5945947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945950">file</span><span class="op" id="5945954">,</span>&nbsp;<span class="ident" id="5945956">err</span>&nbsp;<span class="op" id="5945960">=</span>&nbsp;<span class="ident" id="5945962">parser</span><span class="op" id="5945968">.</span><span class="ident" id="5945969">ParseFile</span><span class="op" id="5945978">(</span><span class="ident" id="5945979">fset</span><span class="op" id="5945983">,</span>&nbsp;<span class="ident" id="5945985">filename</span><span class="op" id="5945993">,</span>&nbsp;<span class="ident" id="5945995">psrc</span><span class="op" id="5945999">,</span>&nbsp;<span class="ident" id="5946001">parserMode</span><span class="op" id="5946011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946014">if</span>&nbsp;<span class="ident" id="5946017">err</span>&nbsp;<span class="op" id="5946021">==</span>&nbsp;<span class="ident" id="5946024">nil</span>&nbsp;<span class="op" id="5946028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946032">sourceAdj</span>&nbsp;<span class="op" id="5946042">=</span>&nbsp;<span class="keyword" id="5946044">func</span><span class="op" id="5946048">(</span><span class="ident" id="5946049">src</span>&nbsp;<span class="op" id="5946053">[</span><span class="op" id="5946054">]</span><span class="builtintype" id="5946055">byte</span><span class="op" id="5946059">,</span>&nbsp;<span class="ident" id="5946061">indent</span>&nbsp;<span class="builtintype" id="5946068">int</span><span class="op" id="5946071">)</span>&nbsp;<span class="op" id="5946073">[</span><span class="op" id="5946074">]</span><span class="builtintype" id="5946075">byte</span>&nbsp;<span class="op" id="5946080">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946085">//&nbsp;Remove&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946118">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946158">src</span>&nbsp;<span class="op" id="5946162">=</span>&nbsp;<span class="ident" id="5946164">src</span><span class="op" id="5946167">[</span><span class="ident" id="5946168">indent</span><span class="op" id="5946174">+</span><span class="builtinfunc" id="5946175">len</span><span class="op" id="5946178">(</span><span class="string" id="5946179">&#34;package&nbsp;p\n&#34;</span><span class="op" id="5946192">)</span><span class="op" id="5946193">:</span><span class="op" id="5946194">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946199">return</span>&nbsp;<span class="ident" id="5946206">bytes</span><span class="op" id="5946211">.</span><span class="ident" id="5946212">TrimSpace</span><span class="op" id="5946221">(</span><span class="ident" id="5946222">src</span><span class="op" id="5946225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946229">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946233">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946244">//&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946305">//&nbsp;declaration,&nbsp;fall&nbsp;through&nbsp;to&nbsp;try&nbsp;as&nbsp;a&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946363">//&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946403">if</span>&nbsp;<span class="op" id="5946406">!</span><span class="ident" id="5946407">strings</span><span class="op" id="5946414">.</span><span class="ident" id="5946415">Contains</span><span class="op" id="5946423">(</span><span class="ident" id="5946424">err</span><span class="op" id="5946427">.</span><span class="ident" id="5946428">Error</span><span class="op" id="5946433">(</span><span class="op" id="5946434">)</span><span class="op" id="5946435">,</span>&nbsp;<span class="string" id="5946437">&#34;expected&nbsp;declaration&#34;</span><span class="op" id="5946459">)</span>&nbsp;<span class="op" id="5946461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946465">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946477">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;statement&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946532">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause&nbsp;and&nbsp;turning&nbsp;the&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946587">//&nbsp;into&nbsp;a&nbsp;function&nbsp;body.&nbsp;&nbsp;This&nbsp;handles&nbsp;expressions&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946644">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946706">//&nbsp;in&nbsp;fsrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946741">fsrc</span>&nbsp;<span class="op" id="5946746">:=</span>&nbsp;<span class="builtinfunc" id="5946749">append</span><span class="op" id="5946755">(</span><span class="builtinfunc" id="5946756">append</span><span class="op" id="5946762">(</span><span class="op" id="5946763">[</span><span class="op" id="5946764">]</span><span class="builtintype" id="5946765">byte</span><span class="op" id="5946769">(</span><span class="string" id="5946770">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="5946793">)</span><span class="op" id="5946794">,</span>&nbsp;<span class="ident" id="5946796">src</span><span class="op" id="5946799">...</span><span class="op" id="5946802">)</span><span class="op" id="5946803">,</span>&nbsp;<span class="string" id="5946805">&#39;\n&#39;</span><span class="op" id="5946809">,</span>&nbsp;<span class="string" id="5946811">&#39;}&#39;</span><span class="op" id="5946814">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946817">file</span><span class="op" id="5946821">,</span>&nbsp;<span class="ident" id="5946823">err</span>&nbsp;<span class="op" id="5946827">=</span>&nbsp;<span class="ident" id="5946829">parser</span><span class="op" id="5946835">.</span><span class="ident" id="5946836">ParseFile</span><span class="op" id="5946845">(</span><span class="ident" id="5946846">fset</span><span class="op" id="5946850">,</span>&nbsp;<span class="ident" id="5946852">filename</span><span class="op" id="5946860">,</span>&nbsp;<span class="ident" id="5946862">fsrc</span><span class="op" id="5946866">,</span>&nbsp;<span class="ident" id="5946868">parserMode</span><span class="op" id="5946878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946881">if</span>&nbsp;<span class="ident" id="5946884">err</span>&nbsp;<span class="op" id="5946888">==</span>&nbsp;<span class="ident" id="5946891">nil</span>&nbsp;<span class="op" id="5946895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946899">sourceAdj</span>&nbsp;<span class="op" id="5946909">=</span>&nbsp;<span class="keyword" id="5946911">func</span><span class="op" id="5946915">(</span><span class="ident" id="5946916">src</span>&nbsp;<span class="op" id="5946920">[</span><span class="op" id="5946921">]</span><span class="builtintype" id="5946922">byte</span><span class="op" id="5946926">,</span>&nbsp;<span class="ident" id="5946928">indent</span>&nbsp;<span class="builtintype" id="5946935">int</span><span class="op" id="5946938">)</span>&nbsp;<span class="op" id="5946940">[</span><span class="op" id="5946941">]</span><span class="builtintype" id="5946942">byte</span>&nbsp;<span class="op" id="5946947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946952">//&nbsp;Cap&nbsp;adjusted&nbsp;indent&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946987">if</span>&nbsp;<span class="ident" id="5946990">indent</span>&nbsp;<span class="op" id="5946997">&lt;</span>&nbsp;<span class="num" id="5946999">0</span>&nbsp;<span class="op" id="5947001">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947007">indent</span>&nbsp;<span class="op" id="5947014">=</span>&nbsp;<span class="num" id="5947016">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947026">//&nbsp;Remove&nbsp;the&nbsp;wrapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947053">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947095">//&nbsp;There&nbsp;will&nbsp;be&nbsp;two&nbsp;non-blank&nbsp;lines&nbsp;with&nbsp;indent,&nbsp;hence&nbsp;2*indent.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947164">src</span>&nbsp;<span class="op" id="5947168">=</span>&nbsp;<span class="ident" id="5947170">src</span><span class="op" id="5947173">[</span><span class="num" id="5947174">2</span><span class="op" id="5947175">*</span><span class="ident" id="5947176">indent</span><span class="op" id="5947182">+</span><span class="builtinfunc" id="5947183">len</span><span class="op" id="5947186">(</span><span class="string" id="5947187">&#34;package&nbsp;p\n\nfunc&nbsp;_()&nbsp;{&#34;</span><span class="op" id="5947212">)</span><span class="op" id="5947213">:</span><span class="op" id="5947214">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947219">src</span>&nbsp;<span class="op" id="5947223">=</span>&nbsp;<span class="ident" id="5947225">src</span><span class="op" id="5947228">[</span><span class="op" id="5947229">:</span><span class="builtinfunc" id="5947230">len</span><span class="op" id="5947233">(</span><span class="ident" id="5947234">src</span><span class="op" id="5947237">)</span><span class="op" id="5947238">-</span><span class="op" id="5947239">(</span><span class="ident" id="5947240">indent</span><span class="op" id="5947246">+</span><span class="builtinfunc" id="5947247">len</span><span class="op" id="5947250">(</span><span class="string" id="5947251">&#34;\n}\n&#34;</span><span class="op" id="5947258">)</span><span class="op" id="5947259">)</span><span class="op" id="5947260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947265">return</span>&nbsp;<span class="ident" id="5947272">bytes</span><span class="op" id="5947277">.</span><span class="ident" id="5947278">TrimSpace</span><span class="op" id="5947287">(</span><span class="ident" id="5947288">src</span><span class="op" id="5947291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947299">//&nbsp;Gofmt&nbsp;has&nbsp;also&nbsp;indented&nbsp;the&nbsp;function&nbsp;body&nbsp;one&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947357">//&nbsp;Adjust&nbsp;that&nbsp;with&nbsp;indentAdj.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947390">indentAdj</span>&nbsp;<span class="op" id="5947400">=</span>&nbsp;<span class="op" id="5947402">-</span><span class="num" id="5947403">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947410">//&nbsp;Succeeded,&nbsp;or&nbsp;out&nbsp;of&nbsp;options.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947444">return</span><br>
<span class="lineno"></span><span class="op" id="5947451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5947454">//&nbsp;format&nbsp;formats&nbsp;the&nbsp;given&nbsp;package&nbsp;file&nbsp;originally&nbsp;obtained&nbsp;from&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="5947524">//&nbsp;and&nbsp;adjusts&nbsp;the&nbsp;result&nbsp;based&nbsp;on&nbsp;the&nbsp;original&nbsp;source&nbsp;via&nbsp;sourceAdj</span><br>
<span class="lineno">195</span><span class="comment" id="5947593">//&nbsp;and&nbsp;indentAdj.</span><br>
<span class="lineno"></span><span class="keyword" id="5947611">func</span>&nbsp;<span class="ident" id="5947616">format</span><span class="op" id="5947622">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947625">fset</span>&nbsp;<span class="op" id="5947630">*</span><span class="ident" id="5947631">token</span><span class="op" id="5947636">.</span><span class="ident" id="5947637">FileSet</span><span class="op" id="5947644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947647">file</span>&nbsp;<span class="op" id="5947652">*</span><span class="ident" id="5947653">ast</span><span class="op" id="5947656">.</span><span class="ident" id="5947657">File</span><span class="op" id="5947661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947664">sourceAdj</span>&nbsp;<span class="keyword" id="5947674">func</span><span class="op" id="5947678">(</span><span class="ident" id="5947679">src</span>&nbsp;<span class="op" id="5947683">[</span><span class="op" id="5947684">]</span><span class="builtintype" id="5947685">byte</span><span class="op" id="5947689">,</span>&nbsp;<span class="ident" id="5947691">indent</span>&nbsp;<span class="builtintype" id="5947698">int</span><span class="op" id="5947701">)</span>&nbsp;<span class="op" id="5947703">[</span><span class="op" id="5947704">]</span><span class="builtintype" id="5947705">byte</span><span class="op" id="5947709">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947712">indentAdj</span>&nbsp;<span class="builtintype" id="5947722">int</span><span class="op" id="5947725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947728">src</span>&nbsp;<span class="op" id="5947732">[</span><span class="op" id="5947733">]</span><span class="builtintype" id="5947734">byte</span><span class="op" id="5947738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947741">cfg</span>&nbsp;<span class="ident" id="5947745">printer</span><span class="op" id="5947752">.</span><span class="ident" id="5947753">Config</span><span class="op" id="5947759">,</span><br>
<span class="lineno"></span><span class="op" id="5947761">)</span>&nbsp;<span class="op" id="5947763">(</span><span class="op" id="5947764">[</span><span class="op" id="5947765">]</span><span class="builtintype" id="5947766">byte</span><span class="op" id="5947770">,</span>&nbsp;<span class="builtintype" id="5947772">error</span><span class="op" id="5947777">)</span>&nbsp;<span class="op" id="5947779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947782">if</span>&nbsp;<span class="ident" id="5947785">sourceAdj</span>&nbsp;<span class="op" id="5947795">==</span>&nbsp;<span class="ident" id="5947798">nil</span>&nbsp;<span class="op" id="5947802">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947806">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947833">var</span>&nbsp;<span class="ident" id="5947837">buf</span>&nbsp;<span class="ident" id="5947841">bytes</span><span class="op" id="5947846">.</span><span class="ident" id="5947847">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947856">err</span>&nbsp;<span class="op" id="5947860">:=</span>&nbsp;<span class="ident" id="5947863">cfg</span><span class="op" id="5947866">.</span><span class="ident" id="5947867">Fprint</span><span class="op" id="5947873">(</span><span class="op" id="5947874">&amp;</span><span class="ident" id="5947875">buf</span><span class="op" id="5947878">,</span>&nbsp;<span class="ident" id="5947880">fset</span><span class="op" id="5947884">,</span>&nbsp;<span class="ident" id="5947886">file</span><span class="op" id="5947890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947894">if</span>&nbsp;<span class="ident" id="5947897">err</span>&nbsp;<span class="op" id="5947901">!=</span>&nbsp;<span class="ident" id="5947904">nil</span>&nbsp;<span class="op" id="5947908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947913">return</span>&nbsp;<span class="ident" id="5947920">nil</span><span class="op" id="5947923">,</span>&nbsp;<span class="ident" id="5947925">err</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947935">return</span>&nbsp;<span class="ident" id="5947942">buf</span><span class="op" id="5947945">.</span><span class="ident" id="5947946">Bytes</span><span class="op" id="5947951">(</span><span class="op" id="5947952">)</span><span class="op" id="5947953">,</span>&nbsp;<span class="ident" id="5947955">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947964">//&nbsp;Partial&nbsp;source&nbsp;file.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5947989">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;leading&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948030">i</span><span class="op" id="5948031">,</span>&nbsp;<span class="ident" id="5948033">j</span>&nbsp;<span class="op" id="5948035">:=</span>&nbsp;<span class="num" id="5948038">0</span><span class="op" id="5948039">,</span>&nbsp;<span class="num" id="5948041">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948044">for</span>&nbsp;<span class="ident" id="5948048">j</span>&nbsp;<span class="op" id="5948050">&lt;</span>&nbsp;<span class="builtinfunc" id="5948052">len</span><span class="op" id="5948055">(</span><span class="ident" id="5948056">src</span><span class="op" id="5948059">)</span>&nbsp;<span class="op" id="5948061">&amp;&amp;</span>&nbsp;<span class="ident" id="5948064">isSpace</span><span class="op" id="5948071">(</span><span class="ident" id="5948072">src</span><span class="op" id="5948075">[</span><span class="ident" id="5948076">j</span><span class="op" id="5948077">]</span><span class="op" id="5948078">)</span>&nbsp;<span class="op" id="5948080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948084">if</span>&nbsp;<span class="ident" id="5948087">src</span><span class="op" id="5948090">[</span><span class="ident" id="5948091">j</span><span class="op" id="5948092">]</span>&nbsp;<span class="op" id="5948094">==</span>&nbsp;<span class="string" id="5948097">&#39;\n&#39;</span>&nbsp;<span class="op" id="5948102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948107">i</span>&nbsp;<span class="op" id="5948109">=</span>&nbsp;<span class="ident" id="5948111">j</span>&nbsp;<span class="op" id="5948113">+</span>&nbsp;<span class="num" id="5948115">1</span>&nbsp;<span class="comment" id="5948117">//&nbsp;byte&nbsp;offset&nbsp;of&nbsp;last&nbsp;line&nbsp;in&nbsp;leading&nbsp;space</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948168">j</span><span class="op" id="5948169">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948176">var</span>&nbsp;<span class="ident" id="5948180">res</span>&nbsp;<span class="op" id="5948184">[</span><span class="op" id="5948185">]</span><span class="builtintype" id="5948186">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948192">res</span>&nbsp;<span class="op" id="5948196">=</span>&nbsp;<span class="builtinfunc" id="5948198">append</span><span class="op" id="5948204">(</span><span class="ident" id="5948205">res</span><span class="op" id="5948208">,</span>&nbsp;<span class="ident" id="5948210">src</span><span class="op" id="5948213">[</span><span class="op" id="5948214">:</span><span class="ident" id="5948215">i</span><span class="op" id="5948216">]</span><span class="op" id="5948217">...</span><span class="op" id="5948220">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948224">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;indentation&nbsp;of&nbsp;first&nbsp;code&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948282">//&nbsp;Spaces&nbsp;are&nbsp;ignored&nbsp;unless&nbsp;there&nbsp;are&nbsp;no&nbsp;tabs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948331">//&nbsp;in&nbsp;which&nbsp;case&nbsp;spaces&nbsp;count&nbsp;as&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948374">indent</span>&nbsp;<span class="op" id="5948381">:=</span>&nbsp;<span class="num" id="5948384">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948387">hasSpace</span>&nbsp;<span class="op" id="5948396">:=</span>&nbsp;<span class="builtintype" id="5948399">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948406">for</span>&nbsp;<span class="ident" id="5948410">_</span><span class="op" id="5948411">,</span>&nbsp;<span class="ident" id="5948413">b</span>&nbsp;<span class="op" id="5948415">:=</span>&nbsp;<span class="keyword" id="5948418">range</span>&nbsp;<span class="ident" id="5948424">src</span><span class="op" id="5948427">[</span><span class="ident" id="5948428">i</span><span class="op" id="5948429">:</span><span class="ident" id="5948430">j</span><span class="op" id="5948431">]</span>&nbsp;<span class="op" id="5948433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948437">switch</span>&nbsp;<span class="ident" id="5948444">b</span>&nbsp;<span class="op" id="5948446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948450">case</span>&nbsp;<span class="string" id="5948455">&#39;&nbsp;&#39;</span><span class="op" id="5948458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948463">hasSpace</span>&nbsp;<span class="op" id="5948472">=</span>&nbsp;<span class="builtintype" id="5948474">true</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948481">case</span>&nbsp;<span class="string" id="5948486">&#39;\t&#39;</span><span class="op" id="5948490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948495">indent</span><span class="op" id="5948501">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948512">if</span>&nbsp;<span class="ident" id="5948515">indent</span>&nbsp;<span class="op" id="5948522">==</span>&nbsp;<span class="num" id="5948525">0</span>&nbsp;<span class="op" id="5948527">&amp;&amp;</span>&nbsp;<span class="ident" id="5948530">hasSpace</span>&nbsp;<span class="op" id="5948539">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948543">indent</span>&nbsp;<span class="op" id="5948550">=</span>&nbsp;<span class="num" id="5948552">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948558">for</span>&nbsp;<span class="ident" id="5948562">i</span>&nbsp;<span class="op" id="5948564">:=</span>&nbsp;<span class="num" id="5948567">0</span><span class="op" id="5948568">;</span>&nbsp;<span class="ident" id="5948570">i</span>&nbsp;<span class="op" id="5948572">&lt;</span>&nbsp;<span class="ident" id="5948574">indent</span><span class="op" id="5948580">;</span>&nbsp;<span class="ident" id="5948582">i</span><span class="op" id="5948583">++</span>&nbsp;<span class="op" id="5948586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948590">res</span>&nbsp;<span class="op" id="5948594">=</span>&nbsp;<span class="builtinfunc" id="5948596">append</span><span class="op" id="5948602">(</span><span class="ident" id="5948603">res</span><span class="op" id="5948606">,</span>&nbsp;<span class="string" id="5948608">&#39;\t&#39;</span><span class="op" id="5948612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948615">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948619">//&nbsp;Format&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948642">//&nbsp;Write&nbsp;it&nbsp;without&nbsp;any&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948695">cfg</span><span class="op" id="5948698">.</span><span class="ident" id="5948699">Indent</span>&nbsp;<span class="op" id="5948706">=</span>&nbsp;<span class="ident" id="5948708">indent</span>&nbsp;<span class="op" id="5948715">+</span>&nbsp;<span class="ident" id="5948717">indentAdj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948728">var</span>&nbsp;<span class="ident" id="5948732">buf</span>&nbsp;<span class="ident" id="5948736">bytes</span><span class="op" id="5948741">.</span><span class="ident" id="5948742">Buffer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948750">err</span>&nbsp;<span class="op" id="5948754">:=</span>&nbsp;<span class="ident" id="5948757">cfg</span><span class="op" id="5948760">.</span><span class="ident" id="5948761">Fprint</span><span class="op" id="5948767">(</span><span class="op" id="5948768">&amp;</span><span class="ident" id="5948769">buf</span><span class="op" id="5948772">,</span>&nbsp;<span class="ident" id="5948774">fset</span><span class="op" id="5948778">,</span>&nbsp;<span class="ident" id="5948780">file</span><span class="op" id="5948784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948787">if</span>&nbsp;<span class="ident" id="5948790">err</span>&nbsp;<span class="op" id="5948794">!=</span>&nbsp;<span class="ident" id="5948797">nil</span>&nbsp;<span class="op" id="5948801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948805">return</span>&nbsp;<span class="ident" id="5948812">nil</span><span class="op" id="5948815">,</span>&nbsp;<span class="ident" id="5948817">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948825">res</span>&nbsp;<span class="op" id="5948829">=</span>&nbsp;<span class="builtinfunc" id="5948831">append</span><span class="op" id="5948837">(</span><span class="ident" id="5948838">res</span><span class="op" id="5948841">,</span>&nbsp;<span class="ident" id="5948843">sourceAdj</span><span class="op" id="5948852">(</span><span class="ident" id="5948853">buf</span><span class="op" id="5948856">.</span><span class="ident" id="5948857">Bytes</span><span class="op" id="5948862">(</span><span class="op" id="5948863">)</span><span class="op" id="5948864">,</span>&nbsp;<span class="ident" id="5948866">cfg</span><span class="op" id="5948869">.</span><span class="ident" id="5948870">Indent</span><span class="op" id="5948876">)</span><span class="op" id="5948877">...</span><span class="op" id="5948880">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5948884">//&nbsp;Determine&nbsp;and&nbsp;append&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948925">i</span>&nbsp;<span class="op" id="5948927">=</span>&nbsp;<span class="builtinfunc" id="5948929">len</span><span class="op" id="5948932">(</span><span class="ident" id="5948933">src</span><span class="op" id="5948936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948939">for</span>&nbsp;<span class="ident" id="5948943">i</span>&nbsp;<span class="op" id="5948945">&gt;</span>&nbsp;<span class="num" id="5948947">0</span>&nbsp;<span class="op" id="5948949">&amp;&amp;</span>&nbsp;<span class="ident" id="5948952">isSpace</span><span class="op" id="5948959">(</span><span class="ident" id="5948960">src</span><span class="op" id="5948963">[</span><span class="ident" id="5948964">i</span><span class="op" id="5948965">-</span><span class="num" id="5948966">1</span><span class="op" id="5948967">]</span><span class="op" id="5948968">)</span>&nbsp;<span class="op" id="5948970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948974">i</span><span class="op" id="5948975">--</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948982">return</span>&nbsp;<span class="builtinfunc" id="5948989">append</span><span class="op" id="5948995">(</span><span class="ident" id="5948996">res</span><span class="op" id="5948999">,</span>&nbsp;<span class="ident" id="5949001">src</span><span class="op" id="5949004">[</span><span class="ident" id="5949005">i</span><span class="op" id="5949006">:</span><span class="op" id="5949007">]</span><span class="op" id="5949008">...</span><span class="op" id="5949011">)</span><span class="op" id="5949012">,</span>&nbsp;<span class="ident" id="5949014">nil</span><br>
<span class="lineno"></span><span class="op" id="5949018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5949021">func</span>&nbsp;<span class="ident" id="5949026">isSpace</span><span class="op" id="5949033">(</span><span class="ident" id="5949034">b</span>&nbsp;<span class="builtintype" id="5949036">byte</span><span class="op" id="5949040">)</span>&nbsp;<span class="builtintype" id="5949042">bool</span>&nbsp;<span class="op" id="5949047">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5949050">return</span>&nbsp;<span class="ident" id="5949057">b</span>&nbsp;<span class="op" id="5949059">==</span>&nbsp;<span class="string" id="5949062">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5949066">||</span>&nbsp;<span class="ident" id="5949069">b</span>&nbsp;<span class="op" id="5949071">==</span>&nbsp;<span class="string" id="5949074">&#39;\t&#39;</span>&nbsp;<span class="op" id="5949079">||</span>&nbsp;<span class="ident" id="5949082">b</span>&nbsp;<span class="op" id="5949084">==</span>&nbsp;<span class="string" id="5949087">&#39;\n&#39;</span>&nbsp;<span class="op" id="5949092">||</span>&nbsp;<span class="ident" id="5949095">b</span>&nbsp;<span class="op" id="5949097">==</span>&nbsp;<span class="string" id="5949100">&#39;\r&#39;</span><br>
<span class="lineno"></span><span class="op" id="5949105">}</span>
</div>
</body>
</html>
