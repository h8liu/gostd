<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7955340">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7955395">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7955449">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7955500">package</span>&nbsp;<span class="ident" id="7955508">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7955516">import</span>&nbsp;<span class="op" id="7955523">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7955526">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7955537">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="7955553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7955556">type</span>&nbsp;<span class="ident" id="7955561">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="7955591">struct</span>&nbsp;<span class="op" id="7955598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955601">a</span><span class="op" id="7955602">,</span>&nbsp;<span class="ident" id="7955604">b</span>&nbsp;<span class="op" id="7955606">[</span><span class="op" id="7955607">]</span><span class="builtintype" id="7955608">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955614">out</span>&nbsp;&nbsp;<span class="builtintype" id="7955619">int</span><br>
<span class="lineno">15</span><span class="op" id="7955623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7955626">var</span>&nbsp;<span class="ident" id="7955630">testConstantTimeCompareData</span>&nbsp;<span class="op" id="7955658">=</span>&nbsp;<span class="op" id="7955660">[</span><span class="op" id="7955661">]</span><span class="ident" id="7955662">TestConstantTimeCompareStruct</span><span class="op" id="7955691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955694">{</span><span class="op" id="7955695">[</span><span class="op" id="7955696">]</span><span class="builtintype" id="7955697">byte</span><span class="op" id="7955701">{</span><span class="op" id="7955702">}</span><span class="op" id="7955703">,</span>&nbsp;<span class="op" id="7955705">[</span><span class="op" id="7955706">]</span><span class="builtintype" id="7955707">byte</span><span class="op" id="7955711">{</span><span class="op" id="7955712">}</span><span class="op" id="7955713">,</span>&nbsp;<span class="num" id="7955715">1</span><span class="op" id="7955716">}</span><span class="op" id="7955717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955720">{</span><span class="op" id="7955721">[</span><span class="op" id="7955722">]</span><span class="builtintype" id="7955723">byte</span><span class="op" id="7955727">{</span><span class="num" id="7955728">0x11</span><span class="op" id="7955732">}</span><span class="op" id="7955733">,</span>&nbsp;<span class="op" id="7955735">[</span><span class="op" id="7955736">]</span><span class="builtintype" id="7955737">byte</span><span class="op" id="7955741">{</span><span class="num" id="7955742">0x11</span><span class="op" id="7955746">}</span><span class="op" id="7955747">,</span>&nbsp;<span class="num" id="7955749">1</span><span class="op" id="7955750">}</span><span class="op" id="7955751">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955754">{</span><span class="op" id="7955755">[</span><span class="op" id="7955756">]</span><span class="builtintype" id="7955757">byte</span><span class="op" id="7955761">{</span><span class="num" id="7955762">0x12</span><span class="op" id="7955766">}</span><span class="op" id="7955767">,</span>&nbsp;<span class="op" id="7955769">[</span><span class="op" id="7955770">]</span><span class="builtintype" id="7955771">byte</span><span class="op" id="7955775">{</span><span class="num" id="7955776">0x11</span><span class="op" id="7955780">}</span><span class="op" id="7955781">,</span>&nbsp;<span class="num" id="7955783">0</span><span class="op" id="7955784">}</span><span class="op" id="7955785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955788">{</span><span class="op" id="7955789">[</span><span class="op" id="7955790">]</span><span class="builtintype" id="7955791">byte</span><span class="op" id="7955795">{</span><span class="num" id="7955796">0x11</span><span class="op" id="7955800">}</span><span class="op" id="7955801">,</span>&nbsp;<span class="op" id="7955803">[</span><span class="op" id="7955804">]</span><span class="builtintype" id="7955805">byte</span><span class="op" id="7955809">{</span><span class="num" id="7955810">0x11</span><span class="op" id="7955814">,</span>&nbsp;<span class="num" id="7955816">0x12</span><span class="op" id="7955820">}</span><span class="op" id="7955821">,</span>&nbsp;<span class="num" id="7955823">0</span><span class="op" id="7955824">}</span><span class="op" id="7955825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955828">{</span><span class="op" id="7955829">[</span><span class="op" id="7955830">]</span><span class="builtintype" id="7955831">byte</span><span class="op" id="7955835">{</span><span class="num" id="7955836">0x11</span><span class="op" id="7955840">,</span>&nbsp;<span class="num" id="7955842">0x12</span><span class="op" id="7955846">}</span><span class="op" id="7955847">,</span>&nbsp;<span class="op" id="7955849">[</span><span class="op" id="7955850">]</span><span class="builtintype" id="7955851">byte</span><span class="op" id="7955855">{</span><span class="num" id="7955856">0x11</span><span class="op" id="7955860">}</span><span class="op" id="7955861">,</span>&nbsp;<span class="num" id="7955863">0</span><span class="op" id="7955864">}</span><span class="op" id="7955865">,</span><br>
<span class="lineno"></span><span class="op" id="7955867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7955870">func</span>&nbsp;<span class="ident" id="7955875">TestConstantTimeCompare</span><span class="op" id="7955898">(</span><span class="ident" id="7955899">t</span>&nbsp;<span class="op" id="7955901">*</span><span class="ident" id="7955902">testing</span><span class="op" id="7955909">.</span><span class="ident" id="7955910">T</span><span class="op" id="7955911">)</span>&nbsp;<span class="op" id="7955913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955916">for</span>&nbsp;<span class="ident" id="7955920">i</span><span class="op" id="7955921">,</span>&nbsp;<span class="ident" id="7955923">test</span>&nbsp;<span class="op" id="7955928">:=</span>&nbsp;<span class="keyword" id="7955931">range</span>&nbsp;<span class="ident" id="7955937">testConstantTimeCompareData</span>&nbsp;<span class="op" id="7955965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955969">if</span>&nbsp;<span class="ident" id="7955972">r</span>&nbsp;<span class="op" id="7955974">:=</span>&nbsp;<span class="ident" id="7955977">ConstantTimeCompare</span><span class="op" id="7955996">(</span><span class="ident" id="7955997">test</span><span class="op" id="7956001">.</span><span class="ident" id="7956002">a</span><span class="op" id="7956003">,</span>&nbsp;<span class="ident" id="7956005">test</span><span class="op" id="7956009">.</span><span class="ident" id="7956010">b</span><span class="op" id="7956011">)</span><span class="op" id="7956012">;</span>&nbsp;<span class="ident" id="7956014">r</span>&nbsp;<span class="op" id="7956016">!=</span>&nbsp;<span class="ident" id="7956019">test</span><span class="op" id="7956023">.</span><span class="ident" id="7956024">out</span>&nbsp;<span class="op" id="7956028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956033">t</span><span class="op" id="7956034">.</span><span class="ident" id="7956035">Errorf</span><span class="op" id="7956041">(</span><span class="string" id="7956042">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="7956076">,</span>&nbsp;<span class="ident" id="7956078">i</span><span class="op" id="7956079">,</span>&nbsp;<span class="ident" id="7956081">r</span><span class="op" id="7956082">,</span>&nbsp;<span class="ident" id="7956084">test</span><span class="op" id="7956088">.</span><span class="ident" id="7956089">out</span><span class="op" id="7956092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956096">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956099">}</span><br>
<span class="lineno"></span><span class="op" id="7956101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7956104">type</span>&nbsp;<span class="ident" id="7956109">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="7956138">struct</span>&nbsp;<span class="op" id="7956145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956148">a</span><span class="op" id="7956149">,</span>&nbsp;<span class="ident" id="7956151">b</span>&nbsp;<span class="builtintype" id="7956153">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956160">out</span>&nbsp;&nbsp;<span class="builtintype" id="7956165">int</span><br>
<span class="lineno"></span><span class="op" id="7956169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7956172">var</span>&nbsp;<span class="ident" id="7956176">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="7956203">=</span>&nbsp;<span class="op" id="7956205">[</span><span class="op" id="7956206">]</span><span class="ident" id="7956207">TestConstantTimeByteEqStruct</span><span class="op" id="7956235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956238">{</span><span class="num" id="7956239">0</span><span class="op" id="7956240">,</span>&nbsp;<span class="num" id="7956242">0</span><span class="op" id="7956243">,</span>&nbsp;<span class="num" id="7956245">1</span><span class="op" id="7956246">}</span><span class="op" id="7956247">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956250">{</span><span class="num" id="7956251">0</span><span class="op" id="7956252">,</span>&nbsp;<span class="num" id="7956254">1</span><span class="op" id="7956255">,</span>&nbsp;<span class="num" id="7956257">0</span><span class="op" id="7956258">}</span><span class="op" id="7956259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956262">{</span><span class="num" id="7956263">1</span><span class="op" id="7956264">,</span>&nbsp;<span class="num" id="7956266">0</span><span class="op" id="7956267">,</span>&nbsp;<span class="num" id="7956269">0</span><span class="op" id="7956270">}</span><span class="op" id="7956271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956274">{</span><span class="num" id="7956275">0xff</span><span class="op" id="7956279">,</span>&nbsp;<span class="num" id="7956281">0xff</span><span class="op" id="7956285">,</span>&nbsp;<span class="num" id="7956287">1</span><span class="op" id="7956288">}</span><span class="op" id="7956289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956292">{</span><span class="num" id="7956293">0xff</span><span class="op" id="7956297">,</span>&nbsp;<span class="num" id="7956299">0xfe</span><span class="op" id="7956303">,</span>&nbsp;<span class="num" id="7956305">0</span><span class="op" id="7956306">}</span><span class="op" id="7956307">,</span><br>
<span class="lineno"></span><span class="op" id="7956309">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7956312">func</span>&nbsp;<span class="ident" id="7956317">byteEq</span><span class="op" id="7956323">(</span><span class="ident" id="7956324">a</span><span class="op" id="7956325">,</span>&nbsp;<span class="ident" id="7956327">b</span>&nbsp;<span class="builtintype" id="7956329">uint8</span><span class="op" id="7956334">)</span>&nbsp;<span class="builtintype" id="7956336">int</span>&nbsp;<span class="op" id="7956340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956343">if</span>&nbsp;<span class="ident" id="7956346">a</span>&nbsp;<span class="op" id="7956348">==</span>&nbsp;<span class="ident" id="7956351">b</span>&nbsp;<span class="op" id="7956353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956357">return</span>&nbsp;<span class="num" id="7956364">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956367">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956370">return</span>&nbsp;<span class="num" id="7956377">0</span><br>
<span class="lineno"></span><span class="op" id="7956379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7956382">func</span>&nbsp;<span class="ident" id="7956387">TestConstantTimeByteEq</span><span class="op" id="7956409">(</span><span class="ident" id="7956410">t</span>&nbsp;<span class="op" id="7956412">*</span><span class="ident" id="7956413">testing</span><span class="op" id="7956420">.</span><span class="ident" id="7956421">T</span><span class="op" id="7956422">)</span>&nbsp;<span class="op" id="7956424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956427">for</span>&nbsp;<span class="ident" id="7956431">i</span><span class="op" id="7956432">,</span>&nbsp;<span class="ident" id="7956434">test</span>&nbsp;<span class="op" id="7956439">:=</span>&nbsp;<span class="keyword" id="7956442">range</span>&nbsp;<span class="ident" id="7956448">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="7956475">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956479">if</span>&nbsp;<span class="ident" id="7956482">r</span>&nbsp;<span class="op" id="7956484">:=</span>&nbsp;<span class="ident" id="7956487">ConstantTimeByteEq</span><span class="op" id="7956505">(</span><span class="ident" id="7956506">test</span><span class="op" id="7956510">.</span><span class="ident" id="7956511">a</span><span class="op" id="7956512">,</span>&nbsp;<span class="ident" id="7956514">test</span><span class="op" id="7956518">.</span><span class="ident" id="7956519">b</span><span class="op" id="7956520">)</span><span class="op" id="7956521">;</span>&nbsp;<span class="ident" id="7956523">r</span>&nbsp;<span class="op" id="7956525">!=</span>&nbsp;<span class="ident" id="7956528">test</span><span class="op" id="7956532">.</span><span class="ident" id="7956533">out</span>&nbsp;<span class="op" id="7956537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956542">t</span><span class="op" id="7956543">.</span><span class="ident" id="7956544">Errorf</span><span class="op" id="7956550">(</span><span class="string" id="7956551">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="7956585">,</span>&nbsp;<span class="ident" id="7956587">i</span><span class="op" id="7956588">,</span>&nbsp;<span class="ident" id="7956590">r</span><span class="op" id="7956591">,</span>&nbsp;<span class="ident" id="7956593">test</span><span class="op" id="7956597">.</span><span class="ident" id="7956598">out</span><span class="op" id="7956601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956611">err</span>&nbsp;<span class="op" id="7956615">:=</span>&nbsp;<span class="ident" id="7956618">quick</span><span class="op" id="7956623">.</span><span class="ident" id="7956624">CheckEqual</span><span class="op" id="7956634">(</span><span class="ident" id="7956635">ConstantTimeByteEq</span><span class="op" id="7956653">,</span>&nbsp;<span class="ident" id="7956655">byteEq</span><span class="op" id="7956661">,</span>&nbsp;<span class="ident" id="7956663">nil</span><span class="op" id="7956666">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956669">if</span>&nbsp;<span class="ident" id="7956672">err</span>&nbsp;<span class="op" id="7956676">!=</span>&nbsp;<span class="ident" id="7956679">nil</span>&nbsp;<span class="op" id="7956683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956687">t</span><span class="op" id="7956688">.</span><span class="ident" id="7956689">Error</span><span class="op" id="7956694">(</span><span class="ident" id="7956695">err</span><span class="op" id="7956698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956701">}</span><br>
<span class="lineno"></span><span class="op" id="7956703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7956706">func</span>&nbsp;<span class="ident" id="7956711">eq</span><span class="op" id="7956713">(</span><span class="ident" id="7956714">a</span><span class="op" id="7956715">,</span>&nbsp;<span class="ident" id="7956717">b</span>&nbsp;<span class="builtintype" id="7956719">int32</span><span class="op" id="7956724">)</span>&nbsp;<span class="builtintype" id="7956726">int</span>&nbsp;<span class="op" id="7956730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956733">if</span>&nbsp;<span class="ident" id="7956736">a</span>&nbsp;<span class="op" id="7956738">==</span>&nbsp;<span class="ident" id="7956741">b</span>&nbsp;<span class="op" id="7956743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956747">return</span>&nbsp;<span class="num" id="7956754">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956760">return</span>&nbsp;<span class="num" id="7956767">0</span><br>
<span class="lineno">70</span><span class="op" id="7956769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7956772">func</span>&nbsp;<span class="ident" id="7956777">TestConstantTimeEq</span><span class="op" id="7956795">(</span><span class="ident" id="7956796">t</span>&nbsp;<span class="op" id="7956798">*</span><span class="ident" id="7956799">testing</span><span class="op" id="7956806">.</span><span class="ident" id="7956807">T</span><span class="op" id="7956808">)</span>&nbsp;<span class="op" id="7956810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956813">err</span>&nbsp;<span class="op" id="7956817">:=</span>&nbsp;<span class="ident" id="7956820">quick</span><span class="op" id="7956825">.</span><span class="ident" id="7956826">CheckEqual</span><span class="op" id="7956836">(</span><span class="ident" id="7956837">ConstantTimeEq</span><span class="op" id="7956851">,</span>&nbsp;<span class="ident" id="7956853">eq</span><span class="op" id="7956855">,</span>&nbsp;<span class="ident" id="7956857">nil</span><span class="op" id="7956860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956863">if</span>&nbsp;<span class="ident" id="7956866">err</span>&nbsp;<span class="op" id="7956870">!=</span>&nbsp;<span class="ident" id="7956873">nil</span>&nbsp;<span class="op" id="7956877">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956881">t</span><span class="op" id="7956882">.</span><span class="ident" id="7956883">Error</span><span class="op" id="7956888">(</span><span class="ident" id="7956889">err</span><span class="op" id="7956892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956895">}</span><br>
<span class="lineno"></span><span class="op" id="7956897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7956900">func</span>&nbsp;<span class="ident" id="7956905">makeCopy</span><span class="op" id="7956913">(</span><span class="ident" id="7956914">v</span>&nbsp;<span class="builtintype" id="7956916">int</span><span class="op" id="7956919">,</span>&nbsp;<span class="ident" id="7956921">x</span><span class="op" id="7956922">,</span>&nbsp;<span class="ident" id="7956924">y</span>&nbsp;<span class="op" id="7956926">[</span><span class="op" id="7956927">]</span><span class="builtintype" id="7956928">byte</span><span class="op" id="7956932">)</span>&nbsp;<span class="op" id="7956934">[</span><span class="op" id="7956935">]</span><span class="builtintype" id="7956936">byte</span>&nbsp;<span class="op" id="7956941">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956944">if</span>&nbsp;<span class="builtinfunc" id="7956947">len</span><span class="op" id="7956950">(</span><span class="ident" id="7956951">x</span><span class="op" id="7956952">)</span>&nbsp;<span class="op" id="7956954">&gt;</span>&nbsp;<span class="builtinfunc" id="7956956">len</span><span class="op" id="7956959">(</span><span class="ident" id="7956960">y</span><span class="op" id="7956961">)</span>&nbsp;<span class="op" id="7956963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956967">x</span>&nbsp;<span class="op" id="7956969">=</span>&nbsp;<span class="ident" id="7956971">x</span><span class="op" id="7956972">[</span><span class="num" id="7956973">0</span><span class="op" id="7956974">:</span><span class="builtinfunc" id="7956975">len</span><span class="op" id="7956978">(</span><span class="ident" id="7956979">y</span><span class="op" id="7956980">)</span><span class="op" id="7956981">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956984">}</span>&nbsp;<span class="keyword" id="7956986">else</span>&nbsp;<span class="op" id="7956991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956995">y</span>&nbsp;<span class="op" id="7956997">=</span>&nbsp;<span class="ident" id="7956999">y</span><span class="op" id="7957000">[</span><span class="num" id="7957001">0</span><span class="op" id="7957002">:</span><span class="builtinfunc" id="7957003">len</span><span class="op" id="7957006">(</span><span class="ident" id="7957007">x</span><span class="op" id="7957008">)</span><span class="op" id="7957009">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957012">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957015">if</span>&nbsp;<span class="ident" id="7957018">v</span>&nbsp;<span class="op" id="7957020">==</span>&nbsp;<span class="num" id="7957023">1</span>&nbsp;<span class="op" id="7957025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7957029">copy</span><span class="op" id="7957033">(</span><span class="ident" id="7957034">x</span><span class="op" id="7957035">,</span>&nbsp;<span class="ident" id="7957037">y</span><span class="op" id="7957038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957044">return</span>&nbsp;<span class="ident" id="7957051">x</span><br>
<span class="lineno"></span><span class="op" id="7957053">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="7957056">func</span>&nbsp;<span class="ident" id="7957061">constantTimeCopyWrapper</span><span class="op" id="7957084">(</span><span class="ident" id="7957085">v</span>&nbsp;<span class="builtintype" id="7957087">int</span><span class="op" id="7957090">,</span>&nbsp;<span class="ident" id="7957092">x</span><span class="op" id="7957093">,</span>&nbsp;<span class="ident" id="7957095">y</span>&nbsp;<span class="op" id="7957097">[</span><span class="op" id="7957098">]</span><span class="builtintype" id="7957099">byte</span><span class="op" id="7957103">)</span>&nbsp;<span class="op" id="7957105">[</span><span class="op" id="7957106">]</span><span class="builtintype" id="7957107">byte</span>&nbsp;<span class="op" id="7957112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957115">if</span>&nbsp;<span class="builtinfunc" id="7957118">len</span><span class="op" id="7957121">(</span><span class="ident" id="7957122">x</span><span class="op" id="7957123">)</span>&nbsp;<span class="op" id="7957125">&gt;</span>&nbsp;<span class="builtinfunc" id="7957127">len</span><span class="op" id="7957130">(</span><span class="ident" id="7957131">y</span><span class="op" id="7957132">)</span>&nbsp;<span class="op" id="7957134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957138">x</span>&nbsp;<span class="op" id="7957140">=</span>&nbsp;<span class="ident" id="7957142">x</span><span class="op" id="7957143">[</span><span class="num" id="7957144">0</span><span class="op" id="7957145">:</span><span class="builtinfunc" id="7957146">len</span><span class="op" id="7957149">(</span><span class="ident" id="7957150">y</span><span class="op" id="7957151">)</span><span class="op" id="7957152">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957155">}</span>&nbsp;<span class="keyword" id="7957157">else</span>&nbsp;<span class="op" id="7957162">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957166">y</span>&nbsp;<span class="op" id="7957168">=</span>&nbsp;<span class="ident" id="7957170">y</span><span class="op" id="7957171">[</span><span class="num" id="7957172">0</span><span class="op" id="7957173">:</span><span class="builtinfunc" id="7957174">len</span><span class="op" id="7957177">(</span><span class="ident" id="7957178">x</span><span class="op" id="7957179">)</span><span class="op" id="7957180">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957186">v</span>&nbsp;<span class="op" id="7957188">&amp;=</span>&nbsp;<span class="num" id="7957191">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957194">ConstantTimeCopy</span><span class="op" id="7957210">(</span><span class="ident" id="7957211">v</span><span class="op" id="7957212">,</span>&nbsp;<span class="ident" id="7957214">x</span><span class="op" id="7957215">,</span>&nbsp;<span class="ident" id="7957217">y</span><span class="op" id="7957218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957221">return</span>&nbsp;<span class="ident" id="7957228">x</span><br>
<span class="lineno">100</span><span class="op" id="7957230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7957233">func</span>&nbsp;<span class="ident" id="7957238">TestConstantTimeCopy</span><span class="op" id="7957258">(</span><span class="ident" id="7957259">t</span>&nbsp;<span class="op" id="7957261">*</span><span class="ident" id="7957262">testing</span><span class="op" id="7957269">.</span><span class="ident" id="7957270">T</span><span class="op" id="7957271">)</span>&nbsp;<span class="op" id="7957273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957276">err</span>&nbsp;<span class="op" id="7957280">:=</span>&nbsp;<span class="ident" id="7957283">quick</span><span class="op" id="7957288">.</span><span class="ident" id="7957289">CheckEqual</span><span class="op" id="7957299">(</span><span class="ident" id="7957300">constantTimeCopyWrapper</span><span class="op" id="7957323">,</span>&nbsp;<span class="ident" id="7957325">makeCopy</span><span class="op" id="7957333">,</span>&nbsp;<span class="ident" id="7957335">nil</span><span class="op" id="7957338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957341">if</span>&nbsp;<span class="ident" id="7957344">err</span>&nbsp;<span class="op" id="7957348">!=</span>&nbsp;<span class="ident" id="7957351">nil</span>&nbsp;<span class="op" id="7957355">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957359">t</span><span class="op" id="7957360">.</span><span class="ident" id="7957361">Error</span><span class="op" id="7957366">(</span><span class="ident" id="7957367">err</span><span class="op" id="7957370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957373">}</span><br>
<span class="lineno"></span><span class="op" id="7957375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7957378">var</span>&nbsp;<span class="ident" id="7957382">lessOrEqTests</span>&nbsp;<span class="op" id="7957396">=</span>&nbsp;<span class="op" id="7957398">[</span><span class="op" id="7957399">]</span><span class="keyword" id="7957400">struct</span>&nbsp;<span class="op" id="7957407">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957410">x</span><span class="op" id="7957411">,</span>&nbsp;<span class="ident" id="7957413">y</span><span class="op" id="7957414">,</span>&nbsp;<span class="ident" id="7957416">result</span>&nbsp;<span class="builtintype" id="7957423">int</span><br>
<span class="lineno"></span><span class="op" id="7957427">}</span><span class="op" id="7957428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957431">{</span><span class="num" id="7957432">0</span><span class="op" id="7957433">,</span>&nbsp;<span class="num" id="7957435">0</span><span class="op" id="7957436">,</span>&nbsp;<span class="num" id="7957438">1</span><span class="op" id="7957439">}</span><span class="op" id="7957440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957443">{</span><span class="num" id="7957444">1</span><span class="op" id="7957445">,</span>&nbsp;<span class="num" id="7957447">0</span><span class="op" id="7957448">,</span>&nbsp;<span class="num" id="7957450">0</span><span class="op" id="7957451">}</span><span class="op" id="7957452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957455">{</span><span class="num" id="7957456">0</span><span class="op" id="7957457">,</span>&nbsp;<span class="num" id="7957459">1</span><span class="op" id="7957460">,</span>&nbsp;<span class="num" id="7957462">1</span><span class="op" id="7957463">}</span><span class="op" id="7957464">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957467">{</span><span class="num" id="7957468">10</span><span class="op" id="7957470">,</span>&nbsp;<span class="num" id="7957472">20</span><span class="op" id="7957474">,</span>&nbsp;<span class="num" id="7957476">1</span><span class="op" id="7957477">}</span><span class="op" id="7957478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957481">{</span><span class="num" id="7957482">20</span><span class="op" id="7957484">,</span>&nbsp;<span class="num" id="7957486">10</span><span class="op" id="7957488">,</span>&nbsp;<span class="num" id="7957490">0</span><span class="op" id="7957491">}</span><span class="op" id="7957492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957495">{</span><span class="num" id="7957496">10</span><span class="op" id="7957498">,</span>&nbsp;<span class="num" id="7957500">10</span><span class="op" id="7957502">,</span>&nbsp;<span class="num" id="7957504">1</span><span class="op" id="7957505">}</span><span class="op" id="7957506">,</span><br>
<span class="lineno"></span><span class="op" id="7957508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7957511">func</span>&nbsp;<span class="ident" id="7957516">TestConstantTimeLessOrEq</span><span class="op" id="7957540">(</span><span class="ident" id="7957541">t</span>&nbsp;<span class="op" id="7957543">*</span><span class="ident" id="7957544">testing</span><span class="op" id="7957551">.</span><span class="ident" id="7957552">T</span><span class="op" id="7957553">)</span>&nbsp;<span class="op" id="7957555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957558">for</span>&nbsp;<span class="ident" id="7957562">i</span><span class="op" id="7957563">,</span>&nbsp;<span class="ident" id="7957565">test</span>&nbsp;<span class="op" id="7957570">:=</span>&nbsp;<span class="keyword" id="7957573">range</span>&nbsp;<span class="ident" id="7957579">lessOrEqTests</span>&nbsp;<span class="op" id="7957593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957597">result</span>&nbsp;<span class="op" id="7957604">:=</span>&nbsp;<span class="ident" id="7957607">ConstantTimeLessOrEq</span><span class="op" id="7957627">(</span><span class="ident" id="7957628">test</span><span class="op" id="7957632">.</span><span class="ident" id="7957633">x</span><span class="op" id="7957634">,</span>&nbsp;<span class="ident" id="7957636">test</span><span class="op" id="7957640">.</span><span class="ident" id="7957641">y</span><span class="op" id="7957642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957646">if</span>&nbsp;<span class="ident" id="7957649">result</span>&nbsp;<span class="op" id="7957656">!=</span>&nbsp;<span class="ident" id="7957659">test</span><span class="op" id="7957663">.</span><span class="ident" id="7957664">result</span>&nbsp;<span class="op" id="7957671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957676">t</span><span class="op" id="7957677">.</span><span class="ident" id="7957678">Errorf</span><span class="op" id="7957684">(</span><span class="string" id="7957685">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7957721">,</span>&nbsp;<span class="ident" id="7957723">i</span><span class="op" id="7957724">,</span>&nbsp;<span class="ident" id="7957726">test</span><span class="op" id="7957730">.</span><span class="ident" id="7957731">x</span><span class="op" id="7957732">,</span>&nbsp;<span class="ident" id="7957734">test</span><span class="op" id="7957738">.</span><span class="ident" id="7957739">y</span><span class="op" id="7957740">,</span>&nbsp;<span class="ident" id="7957742">result</span><span class="op" id="7957748">,</span>&nbsp;<span class="ident" id="7957750">test</span><span class="op" id="7957754">.</span><span class="ident" id="7957755">result</span><span class="op" id="7957761">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957768">}</span><br>
<span class="lineno"></span><span class="op" id="7957770">}</span>
</div>
</body>
</html>
