<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4271425">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4271480">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4271534">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4271585">package</span>&nbsp;<span class="ident" id="4271593">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4271600">import</span>&nbsp;<span class="op" id="4271607">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4271610">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4271616">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4271623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4271626">const</span>&nbsp;<span class="op" id="4271632">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4271635">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271664">offsetCodeCount</span>&nbsp;<span class="op" id="4271680">=</span>&nbsp;<span class="num" id="4271682">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4271687">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271741">endBlockMarker</span>&nbsp;<span class="op" id="4271756">=</span>&nbsp;<span class="num" id="4271758">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4271764">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271791">lengthCodesStart</span>&nbsp;<span class="op" id="4271808">=</span>&nbsp;<span class="num" id="4271810">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4271816">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271849">codegenCodeCount</span>&nbsp;<span class="op" id="4271866">=</span>&nbsp;<span class="num" id="4271868">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271872">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4271889">=</span>&nbsp;<span class="num" id="4271891">255</span><br>
<span class="lineno">25</span><span class="op" id="4271895">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4271898">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4271972">var</span>&nbsp;<span class="ident" id="4271976">lengthExtraBits</span>&nbsp;<span class="op" id="4271992">=</span>&nbsp;<span class="op" id="4271994">[</span><span class="op" id="4271995">]</span><span class="builtintype" id="4271996">int8</span><span class="op" id="4272000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4272003">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="4272013">0</span><span class="op" id="4272014">,</span>&nbsp;<span class="num" id="4272016">0</span><span class="op" id="4272017">,</span>&nbsp;<span class="num" id="4272019">0</span><span class="op" id="4272020">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4272023">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="4272033">0</span><span class="op" id="4272034">,</span>&nbsp;<span class="num" id="4272036">0</span><span class="op" id="4272037">,</span>&nbsp;<span class="num" id="4272039">0</span><span class="op" id="4272040">,</span>&nbsp;<span class="num" id="4272042">0</span><span class="op" id="4272043">,</span>&nbsp;<span class="num" id="4272045">0</span><span class="op" id="4272046">,</span>&nbsp;<span class="num" id="4272048">1</span><span class="op" id="4272049">,</span>&nbsp;<span class="num" id="4272051">1</span><span class="op" id="4272052">,</span>&nbsp;<span class="num" id="4272054">1</span><span class="op" id="4272055">,</span>&nbsp;<span class="num" id="4272057">1</span><span class="op" id="4272058">,</span>&nbsp;<span class="num" id="4272060">2</span><span class="op" id="4272061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4272064">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="4272074">2</span><span class="op" id="4272075">,</span>&nbsp;<span class="num" id="4272077">2</span><span class="op" id="4272078">,</span>&nbsp;<span class="num" id="4272080">2</span><span class="op" id="4272081">,</span>&nbsp;<span class="num" id="4272083">3</span><span class="op" id="4272084">,</span>&nbsp;<span class="num" id="4272086">3</span><span class="op" id="4272087">,</span>&nbsp;<span class="num" id="4272089">3</span><span class="op" id="4272090">,</span>&nbsp;<span class="num" id="4272092">3</span><span class="op" id="4272093">,</span>&nbsp;<span class="num" id="4272095">4</span><span class="op" id="4272096">,</span>&nbsp;<span class="num" id="4272098">4</span><span class="op" id="4272099">,</span>&nbsp;<span class="num" id="4272101">4</span><span class="op" id="4272102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4272105">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="4272115">4</span><span class="op" id="4272116">,</span>&nbsp;<span class="num" id="4272118">5</span><span class="op" id="4272119">,</span>&nbsp;<span class="num" id="4272121">5</span><span class="op" id="4272122">,</span>&nbsp;<span class="num" id="4272124">5</span><span class="op" id="4272125">,</span>&nbsp;<span class="num" id="4272127">5</span><span class="op" id="4272128">,</span>&nbsp;<span class="num" id="4272130">0</span><span class="op" id="4272131">,</span><br>
<span class="lineno"></span><span class="op" id="4272133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4272136">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4272199">var</span>&nbsp;<span class="ident" id="4272203">lengthBase</span>&nbsp;<span class="op" id="4272214">=</span>&nbsp;<span class="op" id="4272216">[</span><span class="op" id="4272217">]</span><span class="builtintype" id="4272218">uint32</span><span class="op" id="4272224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272227">0</span><span class="op" id="4272228">,</span>&nbsp;<span class="num" id="4272230">1</span><span class="op" id="4272231">,</span>&nbsp;<span class="num" id="4272233">2</span><span class="op" id="4272234">,</span>&nbsp;<span class="num" id="4272236">3</span><span class="op" id="4272237">,</span>&nbsp;<span class="num" id="4272239">4</span><span class="op" id="4272240">,</span>&nbsp;<span class="num" id="4272242">5</span><span class="op" id="4272243">,</span>&nbsp;<span class="num" id="4272245">6</span><span class="op" id="4272246">,</span>&nbsp;<span class="num" id="4272248">7</span><span class="op" id="4272249">,</span>&nbsp;<span class="num" id="4272251">8</span><span class="op" id="4272252">,</span>&nbsp;<span class="num" id="4272254">10</span><span class="op" id="4272256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272259">12</span><span class="op" id="4272261">,</span>&nbsp;<span class="num" id="4272263">14</span><span class="op" id="4272265">,</span>&nbsp;<span class="num" id="4272267">16</span><span class="op" id="4272269">,</span>&nbsp;<span class="num" id="4272271">20</span><span class="op" id="4272273">,</span>&nbsp;<span class="num" id="4272275">24</span><span class="op" id="4272277">,</span>&nbsp;<span class="num" id="4272279">28</span><span class="op" id="4272281">,</span>&nbsp;<span class="num" id="4272283">32</span><span class="op" id="4272285">,</span>&nbsp;<span class="num" id="4272287">40</span><span class="op" id="4272289">,</span>&nbsp;<span class="num" id="4272291">48</span><span class="op" id="4272293">,</span>&nbsp;<span class="num" id="4272295">56</span><span class="op" id="4272297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272300">64</span><span class="op" id="4272302">,</span>&nbsp;<span class="num" id="4272304">80</span><span class="op" id="4272306">,</span>&nbsp;<span class="num" id="4272308">96</span><span class="op" id="4272310">,</span>&nbsp;<span class="num" id="4272312">112</span><span class="op" id="4272315">,</span>&nbsp;<span class="num" id="4272317">128</span><span class="op" id="4272320">,</span>&nbsp;<span class="num" id="4272322">160</span><span class="op" id="4272325">,</span>&nbsp;<span class="num" id="4272327">192</span><span class="op" id="4272330">,</span>&nbsp;<span class="num" id="4272332">224</span><span class="op" id="4272335">,</span>&nbsp;<span class="num" id="4272337">255</span><span class="op" id="4272340">,</span><br>
<span class="lineno">40</span><span class="op" id="4272342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4272345">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4272377">var</span>&nbsp;<span class="ident" id="4272381">offsetExtraBits</span>&nbsp;<span class="op" id="4272397">=</span>&nbsp;<span class="op" id="4272399">[</span><span class="op" id="4272400">]</span><span class="builtintype" id="4272401">int8</span><span class="op" id="4272405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272408">0</span><span class="op" id="4272409">,</span>&nbsp;<span class="num" id="4272411">0</span><span class="op" id="4272412">,</span>&nbsp;<span class="num" id="4272414">0</span><span class="op" id="4272415">,</span>&nbsp;<span class="num" id="4272417">0</span><span class="op" id="4272418">,</span>&nbsp;<span class="num" id="4272420">1</span><span class="op" id="4272421">,</span>&nbsp;<span class="num" id="4272423">1</span><span class="op" id="4272424">,</span>&nbsp;<span class="num" id="4272426">2</span><span class="op" id="4272427">,</span>&nbsp;<span class="num" id="4272429">2</span><span class="op" id="4272430">,</span>&nbsp;<span class="num" id="4272432">3</span><span class="op" id="4272433">,</span>&nbsp;<span class="num" id="4272435">3</span><span class="op" id="4272436">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272439">4</span><span class="op" id="4272440">,</span>&nbsp;<span class="num" id="4272442">4</span><span class="op" id="4272443">,</span>&nbsp;<span class="num" id="4272445">5</span><span class="op" id="4272446">,</span>&nbsp;<span class="num" id="4272448">5</span><span class="op" id="4272449">,</span>&nbsp;<span class="num" id="4272451">6</span><span class="op" id="4272452">,</span>&nbsp;<span class="num" id="4272454">6</span><span class="op" id="4272455">,</span>&nbsp;<span class="num" id="4272457">7</span><span class="op" id="4272458">,</span>&nbsp;<span class="num" id="4272460">7</span><span class="op" id="4272461">,</span>&nbsp;<span class="num" id="4272463">8</span><span class="op" id="4272464">,</span>&nbsp;<span class="num" id="4272466">8</span><span class="op" id="4272467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272470">9</span><span class="op" id="4272471">,</span>&nbsp;<span class="num" id="4272473">9</span><span class="op" id="4272474">,</span>&nbsp;<span class="num" id="4272476">10</span><span class="op" id="4272478">,</span>&nbsp;<span class="num" id="4272480">10</span><span class="op" id="4272482">,</span>&nbsp;<span class="num" id="4272484">11</span><span class="op" id="4272486">,</span>&nbsp;<span class="num" id="4272488">11</span><span class="op" id="4272490">,</span>&nbsp;<span class="num" id="4272492">12</span><span class="op" id="4272494">,</span>&nbsp;<span class="num" id="4272496">12</span><span class="op" id="4272498">,</span>&nbsp;<span class="num" id="4272500">13</span><span class="op" id="4272502">,</span>&nbsp;<span class="num" id="4272504">13</span><span class="op" id="4272506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4272509">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272532">14</span><span class="op" id="4272534">,</span>&nbsp;<span class="num" id="4272536">14</span><span class="op" id="4272538">,</span>&nbsp;<span class="num" id="4272540">15</span><span class="op" id="4272542">,</span>&nbsp;<span class="num" id="4272544">15</span><span class="op" id="4272546">,</span>&nbsp;<span class="num" id="4272548">16</span><span class="op" id="4272550">,</span>&nbsp;<span class="num" id="4272552">16</span><span class="op" id="4272554">,</span>&nbsp;<span class="num" id="4272556">17</span><span class="op" id="4272558">,</span>&nbsp;<span class="num" id="4272560">17</span><span class="op" id="4272562">,</span>&nbsp;<span class="num" id="4272564">18</span><span class="op" id="4272566">,</span>&nbsp;<span class="num" id="4272568">18</span><span class="op" id="4272570">,</span>&nbsp;<span class="num" id="4272572">19</span><span class="op" id="4272574">,</span>&nbsp;<span class="num" id="4272576">19</span><span class="op" id="4272578">,</span>&nbsp;<span class="num" id="4272580">20</span><span class="op" id="4272582">,</span>&nbsp;<span class="num" id="4272584">20</span><span class="op" id="4272586">,</span><br>
<span class="lineno"></span><span class="op" id="4272588">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4272591">var</span>&nbsp;<span class="ident" id="4272595">offsetBase</span>&nbsp;<span class="op" id="4272606">=</span>&nbsp;<span class="op" id="4272608">[</span><span class="op" id="4272609">]</span><span class="builtintype" id="4272610">uint32</span><span class="op" id="4272616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4272619">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272641">0x000000</span><span class="op" id="4272649">,</span>&nbsp;<span class="num" id="4272651">0x000001</span><span class="op" id="4272659">,</span>&nbsp;<span class="num" id="4272661">0x000002</span><span class="op" id="4272669">,</span>&nbsp;<span class="num" id="4272671">0x000003</span><span class="op" id="4272679">,</span>&nbsp;<span class="num" id="4272681">0x000004</span><span class="op" id="4272689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272692">0x000006</span><span class="op" id="4272700">,</span>&nbsp;<span class="num" id="4272702">0x000008</span><span class="op" id="4272710">,</span>&nbsp;<span class="num" id="4272712">0x00000c</span><span class="op" id="4272720">,</span>&nbsp;<span class="num" id="4272722">0x000010</span><span class="op" id="4272730">,</span>&nbsp;<span class="num" id="4272732">0x000018</span><span class="op" id="4272740">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272743">0x000020</span><span class="op" id="4272751">,</span>&nbsp;<span class="num" id="4272753">0x000030</span><span class="op" id="4272761">,</span>&nbsp;<span class="num" id="4272763">0x000040</span><span class="op" id="4272771">,</span>&nbsp;<span class="num" id="4272773">0x000060</span><span class="op" id="4272781">,</span>&nbsp;<span class="num" id="4272783">0x000080</span><span class="op" id="4272791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272794">0x0000c0</span><span class="op" id="4272802">,</span>&nbsp;<span class="num" id="4272804">0x000100</span><span class="op" id="4272812">,</span>&nbsp;<span class="num" id="4272814">0x000180</span><span class="op" id="4272822">,</span>&nbsp;<span class="num" id="4272824">0x000200</span><span class="op" id="4272832">,</span>&nbsp;<span class="num" id="4272834">0x000300</span><span class="op" id="4272842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272845">0x000400</span><span class="op" id="4272853">,</span>&nbsp;<span class="num" id="4272855">0x000600</span><span class="op" id="4272863">,</span>&nbsp;<span class="num" id="4272865">0x000800</span><span class="op" id="4272873">,</span>&nbsp;<span class="num" id="4272875">0x000c00</span><span class="op" id="4272883">,</span>&nbsp;<span class="num" id="4272885">0x001000</span><span class="op" id="4272893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272896">0x001800</span><span class="op" id="4272904">,</span>&nbsp;<span class="num" id="4272906">0x002000</span><span class="op" id="4272914">,</span>&nbsp;<span class="num" id="4272916">0x003000</span><span class="op" id="4272924">,</span>&nbsp;<span class="num" id="4272926">0x004000</span><span class="op" id="4272934">,</span>&nbsp;<span class="num" id="4272936">0x006000</span><span class="op" id="4272944">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4272948">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4272971">0x008000</span><span class="op" id="4272979">,</span>&nbsp;<span class="num" id="4272981">0x00c000</span><span class="op" id="4272989">,</span>&nbsp;<span class="num" id="4272991">0x010000</span><span class="op" id="4272999">,</span>&nbsp;<span class="num" id="4273001">0x018000</span><span class="op" id="4273009">,</span>&nbsp;<span class="num" id="4273011">0x020000</span><span class="op" id="4273019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4273022">0x030000</span><span class="op" id="4273030">,</span>&nbsp;<span class="num" id="4273032">0x040000</span><span class="op" id="4273040">,</span>&nbsp;<span class="num" id="4273042">0x060000</span><span class="op" id="4273050">,</span>&nbsp;<span class="num" id="4273052">0x080000</span><span class="op" id="4273060">,</span>&nbsp;<span class="num" id="4273062">0x0c0000</span><span class="op" id="4273070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4273073">0x100000</span><span class="op" id="4273081">,</span>&nbsp;<span class="num" id="4273083">0x180000</span><span class="op" id="4273091">,</span>&nbsp;<span class="num" id="4273093">0x200000</span><span class="op" id="4273101">,</span>&nbsp;<span class="num" id="4273103">0x300000</span><span class="op" id="4273111">,</span><br>
<span class="lineno"></span><span class="op" id="4273113">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4273116">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="4273178">var</span>&nbsp;<span class="ident" id="4273182">codegenOrder</span>&nbsp;<span class="op" id="4273195">=</span>&nbsp;<span class="op" id="4273197">[</span><span class="op" id="4273198">]</span><span class="builtintype" id="4273199">uint32</span><span class="op" id="4273205">{</span><span class="num" id="4273206">16</span><span class="op" id="4273208">,</span>&nbsp;<span class="num" id="4273210">17</span><span class="op" id="4273212">,</span>&nbsp;<span class="num" id="4273214">18</span><span class="op" id="4273216">,</span>&nbsp;<span class="num" id="4273218">0</span><span class="op" id="4273219">,</span>&nbsp;<span class="num" id="4273221">8</span><span class="op" id="4273222">,</span>&nbsp;<span class="num" id="4273224">7</span><span class="op" id="4273225">,</span>&nbsp;<span class="num" id="4273227">9</span><span class="op" id="4273228">,</span>&nbsp;<span class="num" id="4273230">6</span><span class="op" id="4273231">,</span>&nbsp;<span class="num" id="4273233">10</span><span class="op" id="4273235">,</span>&nbsp;<span class="num" id="4273237">5</span><span class="op" id="4273238">,</span>&nbsp;<span class="num" id="4273240">11</span><span class="op" id="4273242">,</span>&nbsp;<span class="num" id="4273244">4</span><span class="op" id="4273245">,</span>&nbsp;<span class="num" id="4273247">12</span><span class="op" id="4273249">,</span>&nbsp;<span class="num" id="4273251">3</span><span class="op" id="4273252">,</span>&nbsp;<span class="num" id="4273254">13</span><span class="op" id="4273256">,</span>&nbsp;<span class="num" id="4273258">2</span><span class="op" id="4273259">,</span>&nbsp;<span class="num" id="4273261">14</span><span class="op" id="4273263">,</span>&nbsp;<span class="num" id="4273265">1</span><span class="op" id="4273266">,</span>&nbsp;<span class="num" id="4273268">15</span><span class="op" id="4273270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4273273">type</span>&nbsp;<span class="ident" id="4273278">huffmanBitWriter</span>&nbsp;<span class="keyword" id="4273295">struct</span>&nbsp;<span class="op" id="4273302">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273305">w</span>&nbsp;<span class="ident" id="4273307">io</span><span class="op" id="4273309">.</span><span class="ident" id="4273310">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4273318">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4273368">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273404">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4273420">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273428">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4273444">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273452">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273468">[</span><span class="num" id="4273469">64</span><span class="op" id="4273471">]</span><span class="builtintype" id="4273472">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273478">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4273494">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273499">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273515">[</span><span class="op" id="4273516">]</span><span class="builtintype" id="4273517">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273524">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273540">[</span><span class="op" id="4273541">]</span><span class="builtintype" id="4273542">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273549">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273565">[</span><span class="op" id="4273566">]</span><span class="builtintype" id="4273567">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273574">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273590">[</span><span class="op" id="4273591">]</span><span class="builtintype" id="4273592">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273599">literalEncoding</span>&nbsp;<span class="op" id="4273615">*</span><span class="ident" id="4273616">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273632">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="4273648">*</span><span class="ident" id="4273649">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273665">codegenEncoding</span>&nbsp;<span class="op" id="4273681">*</span><span class="ident" id="4273682">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273698">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4273714">error</span><br>
<span class="lineno">85</span><span class="op" id="4273720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4273723">func</span>&nbsp;<span class="ident" id="4273728">newHuffmanBitWriter</span><span class="op" id="4273747">(</span><span class="ident" id="4273748">w</span>&nbsp;<span class="ident" id="4273750">io</span><span class="op" id="4273752">.</span><span class="ident" id="4273753">Writer</span><span class="op" id="4273759">)</span>&nbsp;<span class="op" id="4273761">*</span><span class="ident" id="4273762">huffmanBitWriter</span>&nbsp;<span class="op" id="4273779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273782">return</span>&nbsp;<span class="op" id="4273789">&amp;</span><span class="ident" id="4273790">huffmanBitWriter</span><span class="op" id="4273806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273810">w</span><span class="op" id="4273811">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273827">w</span><span class="op" id="4273828">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273832">literalFreq</span><span class="op" id="4273843">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4273849">make</span><span class="op" id="4273853">(</span><span class="op" id="4273854">[</span><span class="op" id="4273855">]</span><span class="builtintype" id="4273856">int32</span><span class="op" id="4273861">,</span>&nbsp;<span class="ident" id="4273863">maxLit</span><span class="op" id="4273869">)</span><span class="op" id="4273870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273874">offsetFreq</span><span class="op" id="4273884">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4273891">make</span><span class="op" id="4273895">(</span><span class="op" id="4273896">[</span><span class="op" id="4273897">]</span><span class="builtintype" id="4273898">int32</span><span class="op" id="4273903">,</span>&nbsp;<span class="ident" id="4273905">offsetCodeCount</span><span class="op" id="4273920">)</span><span class="op" id="4273921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273925">codegen</span><span class="op" id="4273932">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4273942">make</span><span class="op" id="4273946">(</span><span class="op" id="4273947">[</span><span class="op" id="4273948">]</span><span class="builtintype" id="4273949">uint8</span><span class="op" id="4273954">,</span>&nbsp;<span class="ident" id="4273956">maxLit</span><span class="op" id="4273962">+</span><span class="ident" id="4273963">offsetCodeCount</span><span class="op" id="4273978">+</span><span class="num" id="4273979">1</span><span class="op" id="4273980">)</span><span class="op" id="4273981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273985">codegenFreq</span><span class="op" id="4273996">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4274002">make</span><span class="op" id="4274006">(</span><span class="op" id="4274007">[</span><span class="op" id="4274008">]</span><span class="builtintype" id="4274009">int32</span><span class="op" id="4274014">,</span>&nbsp;<span class="ident" id="4274016">codegenCodeCount</span><span class="op" id="4274032">)</span><span class="op" id="4274033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274037">literalEncoding</span><span class="op" id="4274052">:</span>&nbsp;<span class="ident" id="4274054">newHuffmanEncoder</span><span class="op" id="4274071">(</span><span class="ident" id="4274072">maxLit</span><span class="op" id="4274078">)</span><span class="op" id="4274079">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274083">offsetEncoding</span><span class="op" id="4274097">:</span>&nbsp;&nbsp;<span class="ident" id="4274100">newHuffmanEncoder</span><span class="op" id="4274117">(</span><span class="ident" id="4274118">offsetCodeCount</span><span class="op" id="4274133">)</span><span class="op" id="4274134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274138">codegenEncoding</span><span class="op" id="4274153">:</span>&nbsp;<span class="ident" id="4274155">newHuffmanEncoder</span><span class="op" id="4274172">(</span><span class="ident" id="4274173">codegenCodeCount</span><span class="op" id="4274189">)</span><span class="op" id="4274190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274193">}</span><br>
<span class="lineno"></span><span class="op" id="4274195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4274198">func</span>&nbsp;<span class="op" id="4274203">(</span><span class="ident" id="4274204">w</span>&nbsp;<span class="op" id="4274206">*</span><span class="ident" id="4274207">huffmanBitWriter</span><span class="op" id="4274223">)</span>&nbsp;<span class="ident" id="4274225">reset</span><span class="op" id="4274230">(</span><span class="ident" id="4274231">writer</span>&nbsp;<span class="ident" id="4274238">io</span><span class="op" id="4274240">.</span><span class="ident" id="4274241">Writer</span><span class="op" id="4274247">)</span>&nbsp;<span class="op" id="4274249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274252">w</span><span class="op" id="4274253">.</span><span class="ident" id="4274254">w</span>&nbsp;<span class="op" id="4274256">=</span>&nbsp;<span class="ident" id="4274258">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274266">w</span><span class="op" id="4274267">.</span><span class="ident" id="4274268">bits</span><span class="op" id="4274272">,</span>&nbsp;<span class="ident" id="4274274">w</span><span class="op" id="4274275">.</span><span class="ident" id="4274276">nbits</span><span class="op" id="4274281">,</span>&nbsp;<span class="ident" id="4274283">w</span><span class="op" id="4274284">.</span><span class="ident" id="4274285">nbytes</span><span class="op" id="4274291">,</span>&nbsp;<span class="ident" id="4274293">w</span><span class="op" id="4274294">.</span><span class="ident" id="4274295">err</span>&nbsp;<span class="op" id="4274299">=</span>&nbsp;<span class="num" id="4274301">0</span><span class="op" id="4274302">,</span>&nbsp;<span class="num" id="4274304">0</span><span class="op" id="4274305">,</span>&nbsp;<span class="num" id="4274307">0</span><span class="op" id="4274308">,</span>&nbsp;<span class="ident" id="4274310">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274315">w</span><span class="op" id="4274316">.</span><span class="ident" id="4274317">bytes</span>&nbsp;<span class="op" id="4274323">=</span>&nbsp;<span class="op" id="4274325">[</span><span class="num" id="4274326">64</span><span class="op" id="4274328">]</span><span class="builtintype" id="4274329">byte</span><span class="op" id="4274333">{</span><span class="op" id="4274334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274337">for</span>&nbsp;<span class="ident" id="4274341">i</span>&nbsp;<span class="op" id="4274343">:=</span>&nbsp;<span class="keyword" id="4274346">range</span>&nbsp;<span class="ident" id="4274352">w</span><span class="op" id="4274353">.</span><span class="ident" id="4274354">codegen</span>&nbsp;<span class="op" id="4274362">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274366">w</span><span class="op" id="4274367">.</span><span class="ident" id="4274368">codegen</span><span class="op" id="4274375">[</span><span class="ident" id="4274376">i</span><span class="op" id="4274377">]</span>&nbsp;<span class="op" id="4274379">=</span>&nbsp;<span class="num" id="4274381">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274387">for</span>&nbsp;<span class="ident" id="4274391">_</span><span class="op" id="4274392">,</span>&nbsp;<span class="ident" id="4274394">s</span>&nbsp;<span class="op" id="4274396">:=</span>&nbsp;<span class="keyword" id="4274399">range</span>&nbsp;<span class="op" id="4274405">[</span><span class="op" id="4274406">...</span><span class="op" id="4274409">]</span><span class="op" id="4274410">[</span><span class="op" id="4274411">]</span><span class="builtintype" id="4274412">int32</span><span class="op" id="4274417">{</span><span class="ident" id="4274418">w</span><span class="op" id="4274419">.</span><span class="ident" id="4274420">literalFreq</span><span class="op" id="4274431">,</span>&nbsp;<span class="ident" id="4274433">w</span><span class="op" id="4274434">.</span><span class="ident" id="4274435">offsetFreq</span><span class="op" id="4274445">,</span>&nbsp;<span class="ident" id="4274447">w</span><span class="op" id="4274448">.</span><span class="ident" id="4274449">codegenFreq</span><span class="op" id="4274460">}</span>&nbsp;<span class="op" id="4274462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274466">for</span>&nbsp;<span class="ident" id="4274470">i</span>&nbsp;<span class="op" id="4274472">:=</span>&nbsp;<span class="keyword" id="4274475">range</span>&nbsp;<span class="ident" id="4274481">s</span>&nbsp;<span class="op" id="4274483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274488">s</span><span class="op" id="4274489">[</span><span class="ident" id="4274490">i</span><span class="op" id="4274491">]</span>&nbsp;<span class="op" id="4274493">=</span>&nbsp;<span class="num" id="4274495">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274505">for</span>&nbsp;<span class="ident" id="4274509">_</span><span class="op" id="4274510">,</span>&nbsp;<span class="ident" id="4274512">enc</span>&nbsp;<span class="op" id="4274516">:=</span>&nbsp;<span class="keyword" id="4274519">range</span>&nbsp;<span class="op" id="4274525">[</span><span class="op" id="4274526">...</span><span class="op" id="4274529">]</span><span class="op" id="4274530">*</span><span class="ident" id="4274531">huffmanEncoder</span><span class="op" id="4274545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274549">w</span><span class="op" id="4274550">.</span><span class="ident" id="4274551">literalEncoding</span><span class="op" id="4274566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274570">w</span><span class="op" id="4274571">.</span><span class="ident" id="4274572">offsetEncoding</span><span class="op" id="4274586">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274590">w</span><span class="op" id="4274591">.</span><span class="ident" id="4274592">codegenEncoding</span><span class="op" id="4274607">}</span>&nbsp;<span class="op" id="4274609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274613">for</span>&nbsp;<span class="ident" id="4274617">i</span>&nbsp;<span class="op" id="4274619">:=</span>&nbsp;<span class="keyword" id="4274622">range</span>&nbsp;<span class="ident" id="4274628">enc</span><span class="op" id="4274631">.</span><span class="ident" id="4274632">code</span>&nbsp;<span class="op" id="4274637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274642">enc</span><span class="op" id="4274645">.</span><span class="ident" id="4274646">code</span><span class="op" id="4274650">[</span><span class="ident" id="4274651">i</span><span class="op" id="4274652">]</span>&nbsp;<span class="op" id="4274654">=</span>&nbsp;<span class="num" id="4274656">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274664">for</span>&nbsp;<span class="ident" id="4274668">i</span>&nbsp;<span class="op" id="4274670">:=</span>&nbsp;<span class="keyword" id="4274673">range</span>&nbsp;<span class="ident" id="4274679">enc</span><span class="op" id="4274682">.</span><span class="ident" id="4274683">codeBits</span>&nbsp;<span class="op" id="4274692">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274697">enc</span><span class="op" id="4274700">.</span><span class="ident" id="4274701">codeBits</span><span class="op" id="4274709">[</span><span class="ident" id="4274710">i</span><span class="op" id="4274711">]</span>&nbsp;<span class="op" id="4274713">=</span>&nbsp;<span class="num" id="4274715">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274722">}</span><br>
<span class="lineno"></span><span class="op" id="4274724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4274727">func</span>&nbsp;<span class="op" id="4274732">(</span><span class="ident" id="4274733">w</span>&nbsp;<span class="op" id="4274735">*</span><span class="ident" id="4274736">huffmanBitWriter</span><span class="op" id="4274752">)</span>&nbsp;<span class="ident" id="4274754">flushBits</span><span class="op" id="4274763">(</span><span class="op" id="4274764">)</span>&nbsp;<span class="op" id="4274766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274769">if</span>&nbsp;<span class="ident" id="4274772">w</span><span class="op" id="4274773">.</span><span class="ident" id="4274774">err</span>&nbsp;<span class="op" id="4274778">!=</span>&nbsp;<span class="ident" id="4274781">nil</span>&nbsp;<span class="op" id="4274785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274789">w</span><span class="op" id="4274790">.</span><span class="ident" id="4274791">nbits</span>&nbsp;<span class="op" id="4274797">=</span>&nbsp;<span class="num" id="4274799">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274803">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274811">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274814">bits</span>&nbsp;<span class="op" id="4274819">:=</span>&nbsp;<span class="ident" id="4274822">w</span><span class="op" id="4274823">.</span><span class="ident" id="4274824">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274830">w</span><span class="op" id="4274831">.</span><span class="ident" id="4274832">bits</span>&nbsp;<span class="op" id="4274837">&gt;&gt;=</span>&nbsp;<span class="num" id="4274841">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274845">w</span><span class="op" id="4274846">.</span><span class="ident" id="4274847">nbits</span>&nbsp;<span class="op" id="4274853">-=</span>&nbsp;<span class="num" id="4274856">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274860">n</span>&nbsp;<span class="op" id="4274862">:=</span>&nbsp;<span class="ident" id="4274865">w</span><span class="op" id="4274866">.</span><span class="ident" id="4274867">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274875">w</span><span class="op" id="4274876">.</span><span class="ident" id="4274877">bytes</span><span class="op" id="4274882">[</span><span class="ident" id="4274883">n</span><span class="op" id="4274884">]</span>&nbsp;<span class="op" id="4274886">=</span>&nbsp;<span class="builtintype" id="4274888">byte</span><span class="op" id="4274892">(</span><span class="ident" id="4274893">bits</span><span class="op" id="4274897">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274900">w</span><span class="op" id="4274901">.</span><span class="ident" id="4274902">bytes</span><span class="op" id="4274907">[</span><span class="ident" id="4274908">n</span><span class="op" id="4274909">+</span><span class="num" id="4274910">1</span><span class="op" id="4274911">]</span>&nbsp;<span class="op" id="4274913">=</span>&nbsp;<span class="builtintype" id="4274915">byte</span><span class="op" id="4274919">(</span><span class="ident" id="4274920">bits</span>&nbsp;<span class="op" id="4274925">&gt;&gt;</span>&nbsp;<span class="num" id="4274928">8</span><span class="op" id="4274929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274932">if</span>&nbsp;<span class="ident" id="4274935">n</span>&nbsp;<span class="op" id="4274937">+=</span>&nbsp;<span class="num" id="4274940">2</span><span class="op" id="4274941">;</span>&nbsp;<span class="ident" id="4274943">n</span>&nbsp;<span class="op" id="4274945">&gt;=</span>&nbsp;<span class="builtinfunc" id="4274948">len</span><span class="op" id="4274951">(</span><span class="ident" id="4274952">w</span><span class="op" id="4274953">.</span><span class="ident" id="4274954">bytes</span><span class="op" id="4274959">)</span>&nbsp;<span class="op" id="4274961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274965">_</span><span class="op" id="4274966">,</span>&nbsp;<span class="ident" id="4274968">w</span><span class="op" id="4274969">.</span><span class="ident" id="4274970">err</span>&nbsp;<span class="op" id="4274974">=</span>&nbsp;<span class="ident" id="4274976">w</span><span class="op" id="4274977">.</span><span class="ident" id="4274978">w</span><span class="op" id="4274979">.</span><span class="ident" id="4274980">Write</span><span class="op" id="4274985">(</span><span class="ident" id="4274986">w</span><span class="op" id="4274987">.</span><span class="ident" id="4274988">bytes</span><span class="op" id="4274993">[</span><span class="num" id="4274994">0</span><span class="op" id="4274995">:</span><span class="op" id="4274996">]</span><span class="op" id="4274997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275001">n</span>&nbsp;<span class="op" id="4275003">=</span>&nbsp;<span class="num" id="4275005">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275008">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275011">w</span><span class="op" id="4275012">.</span><span class="ident" id="4275013">nbytes</span>&nbsp;<span class="op" id="4275020">=</span>&nbsp;<span class="ident" id="4275022">n</span><br>
<span class="lineno"></span><span class="op" id="4275024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4275027">func</span>&nbsp;<span class="op" id="4275032">(</span><span class="ident" id="4275033">w</span>&nbsp;<span class="op" id="4275035">*</span><span class="ident" id="4275036">huffmanBitWriter</span><span class="op" id="4275052">)</span>&nbsp;<span class="ident" id="4275054">flush</span><span class="op" id="4275059">(</span><span class="op" id="4275060">)</span>&nbsp;<span class="op" id="4275062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275065">if</span>&nbsp;<span class="ident" id="4275068">w</span><span class="op" id="4275069">.</span><span class="ident" id="4275070">err</span>&nbsp;<span class="op" id="4275074">!=</span>&nbsp;<span class="ident" id="4275077">nil</span>&nbsp;<span class="op" id="4275081">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275085">w</span><span class="op" id="4275086">.</span><span class="ident" id="4275087">nbits</span>&nbsp;<span class="op" id="4275093">=</span>&nbsp;<span class="num" id="4275095">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275099">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275110">n</span>&nbsp;<span class="op" id="4275112">:=</span>&nbsp;<span class="ident" id="4275115">w</span><span class="op" id="4275116">.</span><span class="ident" id="4275117">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275125">if</span>&nbsp;<span class="ident" id="4275128">w</span><span class="op" id="4275129">.</span><span class="ident" id="4275130">nbits</span>&nbsp;<span class="op" id="4275136">&gt;</span>&nbsp;<span class="num" id="4275138">8</span>&nbsp;<span class="op" id="4275140">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275144">w</span><span class="op" id="4275145">.</span><span class="ident" id="4275146">bytes</span><span class="op" id="4275151">[</span><span class="ident" id="4275152">n</span><span class="op" id="4275153">]</span>&nbsp;<span class="op" id="4275155">=</span>&nbsp;<span class="builtintype" id="4275157">byte</span><span class="op" id="4275161">(</span><span class="ident" id="4275162">w</span><span class="op" id="4275163">.</span><span class="ident" id="4275164">bits</span><span class="op" id="4275168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275172">w</span><span class="op" id="4275173">.</span><span class="ident" id="4275174">bits</span>&nbsp;<span class="op" id="4275179">&gt;&gt;=</span>&nbsp;<span class="num" id="4275183">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275187">w</span><span class="op" id="4275188">.</span><span class="ident" id="4275189">nbits</span>&nbsp;<span class="op" id="4275195">-=</span>&nbsp;<span class="num" id="4275198">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275202">n</span><span class="op" id="4275203">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275207">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275210">if</span>&nbsp;<span class="ident" id="4275213">w</span><span class="op" id="4275214">.</span><span class="ident" id="4275215">nbits</span>&nbsp;<span class="op" id="4275221">&gt;</span>&nbsp;<span class="num" id="4275223">0</span>&nbsp;<span class="op" id="4275225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275229">w</span><span class="op" id="4275230">.</span><span class="ident" id="4275231">bytes</span><span class="op" id="4275236">[</span><span class="ident" id="4275237">n</span><span class="op" id="4275238">]</span>&nbsp;<span class="op" id="4275240">=</span>&nbsp;<span class="builtintype" id="4275242">byte</span><span class="op" id="4275246">(</span><span class="ident" id="4275247">w</span><span class="op" id="4275248">.</span><span class="ident" id="4275249">bits</span><span class="op" id="4275253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275257">w</span><span class="op" id="4275258">.</span><span class="ident" id="4275259">nbits</span>&nbsp;<span class="op" id="4275265">=</span>&nbsp;<span class="num" id="4275267">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275271">n</span><span class="op" id="4275272">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275276">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275279">w</span><span class="op" id="4275280">.</span><span class="ident" id="4275281">bits</span>&nbsp;<span class="op" id="4275286">=</span>&nbsp;<span class="num" id="4275288">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275291">_</span><span class="op" id="4275292">,</span>&nbsp;<span class="ident" id="4275294">w</span><span class="op" id="4275295">.</span><span class="ident" id="4275296">err</span>&nbsp;<span class="op" id="4275300">=</span>&nbsp;<span class="ident" id="4275302">w</span><span class="op" id="4275303">.</span><span class="ident" id="4275304">w</span><span class="op" id="4275305">.</span><span class="ident" id="4275306">Write</span><span class="op" id="4275311">(</span><span class="ident" id="4275312">w</span><span class="op" id="4275313">.</span><span class="ident" id="4275314">bytes</span><span class="op" id="4275319">[</span><span class="num" id="4275320">0</span><span class="op" id="4275321">:</span><span class="ident" id="4275322">n</span><span class="op" id="4275323">]</span><span class="op" id="4275324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275327">w</span><span class="op" id="4275328">.</span><span class="ident" id="4275329">nbytes</span>&nbsp;<span class="op" id="4275336">=</span>&nbsp;<span class="num" id="4275338">0</span><br>
<span class="lineno"></span><span class="op" id="4275340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4275343">func</span>&nbsp;<span class="op" id="4275348">(</span><span class="ident" id="4275349">w</span>&nbsp;<span class="op" id="4275351">*</span><span class="ident" id="4275352">huffmanBitWriter</span><span class="op" id="4275368">)</span>&nbsp;<span class="ident" id="4275370">writeBits</span><span class="op" id="4275379">(</span><span class="ident" id="4275380">b</span><span class="op" id="4275381">,</span>&nbsp;<span class="ident" id="4275383">nb</span>&nbsp;<span class="builtintype" id="4275386">int32</span><span class="op" id="4275391">)</span>&nbsp;<span class="op" id="4275393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275396">w</span><span class="op" id="4275397">.</span><span class="ident" id="4275398">bits</span>&nbsp;<span class="op" id="4275403">|=</span>&nbsp;<span class="builtintype" id="4275406">uint32</span><span class="op" id="4275412">(</span><span class="ident" id="4275413">b</span><span class="op" id="4275414">)</span>&nbsp;<span class="op" id="4275416">&lt;&lt;</span>&nbsp;<span class="ident" id="4275419">w</span><span class="op" id="4275420">.</span><span class="ident" id="4275421">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275428">if</span>&nbsp;<span class="ident" id="4275431">w</span><span class="op" id="4275432">.</span><span class="ident" id="4275433">nbits</span>&nbsp;<span class="op" id="4275439">+=</span>&nbsp;<span class="builtintype" id="4275442">uint32</span><span class="op" id="4275448">(</span><span class="ident" id="4275449">nb</span><span class="op" id="4275451">)</span><span class="op" id="4275452">;</span>&nbsp;<span class="ident" id="4275454">w</span><span class="op" id="4275455">.</span><span class="ident" id="4275456">nbits</span>&nbsp;<span class="op" id="4275462">&gt;=</span>&nbsp;<span class="num" id="4275465">16</span>&nbsp;<span class="op" id="4275468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275472">w</span><span class="op" id="4275473">.</span><span class="ident" id="4275474">flushBits</span><span class="op" id="4275483">(</span><span class="op" id="4275484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275487">}</span><br>
<span class="lineno">170</span><span class="op" id="4275489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4275492">func</span>&nbsp;<span class="op" id="4275497">(</span><span class="ident" id="4275498">w</span>&nbsp;<span class="op" id="4275500">*</span><span class="ident" id="4275501">huffmanBitWriter</span><span class="op" id="4275517">)</span>&nbsp;<span class="ident" id="4275519">writeBytes</span><span class="op" id="4275529">(</span><span class="ident" id="4275530">bytes</span>&nbsp;<span class="op" id="4275536">[</span><span class="op" id="4275537">]</span><span class="builtintype" id="4275538">byte</span><span class="op" id="4275542">)</span>&nbsp;<span class="op" id="4275544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275547">if</span>&nbsp;<span class="ident" id="4275550">w</span><span class="op" id="4275551">.</span><span class="ident" id="4275552">err</span>&nbsp;<span class="op" id="4275556">!=</span>&nbsp;<span class="ident" id="4275559">nil</span>&nbsp;<span class="op" id="4275563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275567">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275578">n</span>&nbsp;<span class="op" id="4275580">:=</span>&nbsp;<span class="ident" id="4275583">w</span><span class="op" id="4275584">.</span><span class="ident" id="4275585">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275593">if</span>&nbsp;<span class="ident" id="4275596">w</span><span class="op" id="4275597">.</span><span class="ident" id="4275598">nbits</span>&nbsp;<span class="op" id="4275604">==</span>&nbsp;<span class="num" id="4275607">8</span>&nbsp;<span class="op" id="4275609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275613">w</span><span class="op" id="4275614">.</span><span class="ident" id="4275615">bytes</span><span class="op" id="4275620">[</span><span class="ident" id="4275621">n</span><span class="op" id="4275622">]</span>&nbsp;<span class="op" id="4275624">=</span>&nbsp;<span class="builtintype" id="4275626">byte</span><span class="op" id="4275630">(</span><span class="ident" id="4275631">w</span><span class="op" id="4275632">.</span><span class="ident" id="4275633">bits</span><span class="op" id="4275637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275641">w</span><span class="op" id="4275642">.</span><span class="ident" id="4275643">nbits</span>&nbsp;<span class="op" id="4275649">=</span>&nbsp;<span class="num" id="4275651">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275655">n</span><span class="op" id="4275656">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275663">if</span>&nbsp;<span class="ident" id="4275666">w</span><span class="op" id="4275667">.</span><span class="ident" id="4275668">nbits</span>&nbsp;<span class="op" id="4275674">!=</span>&nbsp;<span class="num" id="4275677">0</span>&nbsp;<span class="op" id="4275679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275683">w</span><span class="op" id="4275684">.</span><span class="ident" id="4275685">err</span>&nbsp;<span class="op" id="4275689">=</span>&nbsp;<span class="ident" id="4275691">InternalError</span><span class="op" id="4275704">(</span><span class="string" id="4275705">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="4275738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275742">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275753">if</span>&nbsp;<span class="ident" id="4275756">n</span>&nbsp;<span class="op" id="4275758">!=</span>&nbsp;<span class="num" id="4275761">0</span>&nbsp;<span class="op" id="4275763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275767">_</span><span class="op" id="4275768">,</span>&nbsp;<span class="ident" id="4275770">w</span><span class="op" id="4275771">.</span><span class="ident" id="4275772">err</span>&nbsp;<span class="op" id="4275776">=</span>&nbsp;<span class="ident" id="4275778">w</span><span class="op" id="4275779">.</span><span class="ident" id="4275780">w</span><span class="op" id="4275781">.</span><span class="ident" id="4275782">Write</span><span class="op" id="4275787">(</span><span class="ident" id="4275788">w</span><span class="op" id="4275789">.</span><span class="ident" id="4275790">bytes</span><span class="op" id="4275795">[</span><span class="num" id="4275796">0</span><span class="op" id="4275797">:</span><span class="ident" id="4275798">n</span><span class="op" id="4275799">]</span><span class="op" id="4275800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275804">if</span>&nbsp;<span class="ident" id="4275807">w</span><span class="op" id="4275808">.</span><span class="ident" id="4275809">err</span>&nbsp;<span class="op" id="4275813">!=</span>&nbsp;<span class="ident" id="4275816">nil</span>&nbsp;<span class="op" id="4275820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275825">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275840">w</span><span class="op" id="4275841">.</span><span class="ident" id="4275842">nbytes</span>&nbsp;<span class="op" id="4275849">=</span>&nbsp;<span class="num" id="4275851">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275854">_</span><span class="op" id="4275855">,</span>&nbsp;<span class="ident" id="4275857">w</span><span class="op" id="4275858">.</span><span class="ident" id="4275859">err</span>&nbsp;<span class="op" id="4275863">=</span>&nbsp;<span class="ident" id="4275865">w</span><span class="op" id="4275866">.</span><span class="ident" id="4275867">w</span><span class="op" id="4275868">.</span><span class="ident" id="4275869">Write</span><span class="op" id="4275874">(</span><span class="ident" id="4275875">bytes</span><span class="op" id="4275880">)</span><br>
<span class="lineno"></span><span class="op" id="4275882">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4275885">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="4275958">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="4276037">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4276097">//</span><br>
<span class="lineno">200</span><span class="comment" id="4276100">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4276169">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4276224">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="4276300">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="4276347">//</span><br>
<span class="lineno">205</span><span class="comment" id="4276350">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4276413">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="4276474">func</span>&nbsp;<span class="op" id="4276479">(</span><span class="ident" id="4276480">w</span>&nbsp;<span class="op" id="4276482">*</span><span class="ident" id="4276483">huffmanBitWriter</span><span class="op" id="4276499">)</span>&nbsp;<span class="ident" id="4276501">generateCodegen</span><span class="op" id="4276516">(</span><span class="ident" id="4276517">numLiterals</span>&nbsp;<span class="builtintype" id="4276529">int</span><span class="op" id="4276532">,</span>&nbsp;<span class="ident" id="4276534">numOffsets</span>&nbsp;<span class="builtintype" id="4276545">int</span><span class="op" id="4276548">)</span>&nbsp;<span class="op" id="4276550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276553">for</span>&nbsp;<span class="ident" id="4276557">i</span>&nbsp;<span class="op" id="4276559">:=</span>&nbsp;<span class="keyword" id="4276562">range</span>&nbsp;<span class="ident" id="4276568">w</span><span class="op" id="4276569">.</span><span class="ident" id="4276570">codegenFreq</span>&nbsp;<span class="op" id="4276582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276586">w</span><span class="op" id="4276587">.</span><span class="ident" id="4276588">codegenFreq</span><span class="op" id="4276599">[</span><span class="ident" id="4276600">i</span><span class="op" id="4276601">]</span>&nbsp;<span class="op" id="4276603">=</span>&nbsp;<span class="num" id="4276605">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276611">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276687">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276760">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276834">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276846">codegen</span>&nbsp;<span class="op" id="4276854">:=</span>&nbsp;<span class="ident" id="4276857">w</span><span class="op" id="4276858">.</span><span class="ident" id="4276859">codegen</span>&nbsp;<span class="comment" id="4276867">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276877">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4276952">copy</span><span class="op" id="4276956">(</span><span class="ident" id="4276957">codegen</span><span class="op" id="4276964">[</span><span class="num" id="4276965">0</span><span class="op" id="4276966">:</span><span class="ident" id="4276967">numLiterals</span><span class="op" id="4276978">]</span><span class="op" id="4276979">,</span>&nbsp;<span class="ident" id="4276981">w</span><span class="op" id="4276982">.</span><span class="ident" id="4276983">literalEncoding</span><span class="op" id="4276998">.</span><span class="ident" id="4276999">codeBits</span><span class="op" id="4277007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4277010">copy</span><span class="op" id="4277014">(</span><span class="ident" id="4277015">codegen</span><span class="op" id="4277022">[</span><span class="ident" id="4277023">numLiterals</span><span class="op" id="4277034">:</span><span class="ident" id="4277035">numLiterals</span><span class="op" id="4277046">+</span><span class="ident" id="4277047">numOffsets</span><span class="op" id="4277057">]</span><span class="op" id="4277058">,</span>&nbsp;<span class="ident" id="4277060">w</span><span class="op" id="4277061">.</span><span class="ident" id="4277062">offsetEncoding</span><span class="op" id="4277076">.</span><span class="ident" id="4277077">codeBits</span><span class="op" id="4277085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277088">codegen</span><span class="op" id="4277095">[</span><span class="ident" id="4277096">numLiterals</span><span class="op" id="4277107">+</span><span class="ident" id="4277108">numOffsets</span><span class="op" id="4277118">]</span>&nbsp;<span class="op" id="4277120">=</span>&nbsp;<span class="ident" id="4277122">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277132">size</span>&nbsp;<span class="op" id="4277137">:=</span>&nbsp;<span class="ident" id="4277140">codegen</span><span class="op" id="4277147">[</span><span class="num" id="4277148">0</span><span class="op" id="4277149">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277152">count</span>&nbsp;<span class="op" id="4277158">:=</span>&nbsp;<span class="num" id="4277161">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277164">outIndex</span>&nbsp;<span class="op" id="4277173">:=</span>&nbsp;<span class="num" id="4277176">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277179">for</span>&nbsp;<span class="ident" id="4277183">inIndex</span>&nbsp;<span class="op" id="4277191">:=</span>&nbsp;<span class="num" id="4277194">1</span><span class="op" id="4277195">;</span>&nbsp;<span class="ident" id="4277197">size</span>&nbsp;<span class="op" id="4277202">!=</span>&nbsp;<span class="ident" id="4277205">badCode</span><span class="op" id="4277212">;</span>&nbsp;<span class="ident" id="4277214">inIndex</span><span class="op" id="4277221">++</span>&nbsp;<span class="op" id="4277224">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277228">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277298">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277334">nextSize</span>&nbsp;<span class="op" id="4277343">:=</span>&nbsp;<span class="ident" id="4277346">codegen</span><span class="op" id="4277353">[</span><span class="ident" id="4277354">inIndex</span><span class="op" id="4277361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277365">if</span>&nbsp;<span class="ident" id="4277368">nextSize</span>&nbsp;<span class="op" id="4277377">==</span>&nbsp;<span class="ident" id="4277380">size</span>&nbsp;<span class="op" id="4277385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277390">count</span><span class="op" id="4277395">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277401">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277416">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277477">if</span>&nbsp;<span class="ident" id="4277480">size</span>&nbsp;<span class="op" id="4277485">!=</span>&nbsp;<span class="num" id="4277488">0</span>&nbsp;<span class="op" id="4277490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277495">codegen</span><span class="op" id="4277502">[</span><span class="ident" id="4277503">outIndex</span><span class="op" id="4277511">]</span>&nbsp;<span class="op" id="4277513">=</span>&nbsp;<span class="ident" id="4277515">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277523">outIndex</span><span class="op" id="4277531">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277537">w</span><span class="op" id="4277538">.</span><span class="ident" id="4277539">codegenFreq</span><span class="op" id="4277550">[</span><span class="ident" id="4277551">size</span><span class="op" id="4277555">]</span><span class="op" id="4277556">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277562">count</span><span class="op" id="4277567">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277573">for</span>&nbsp;<span class="ident" id="4277577">count</span>&nbsp;<span class="op" id="4277583">&gt;=</span>&nbsp;<span class="num" id="4277586">3</span>&nbsp;<span class="op" id="4277588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277594">n</span>&nbsp;<span class="op" id="4277596">:=</span>&nbsp;<span class="num" id="4277599">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277605">if</span>&nbsp;<span class="ident" id="4277608">n</span>&nbsp;<span class="op" id="4277610">&gt;</span>&nbsp;<span class="ident" id="4277612">count</span>&nbsp;<span class="op" id="4277618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277625">n</span>&nbsp;<span class="op" id="4277627">=</span>&nbsp;<span class="ident" id="4277629">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277645">codegen</span><span class="op" id="4277652">[</span><span class="ident" id="4277653">outIndex</span><span class="op" id="4277661">]</span>&nbsp;<span class="op" id="4277663">=</span>&nbsp;<span class="num" id="4277665">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277672">outIndex</span><span class="op" id="4277680">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277687">codegen</span><span class="op" id="4277694">[</span><span class="ident" id="4277695">outIndex</span><span class="op" id="4277703">]</span>&nbsp;<span class="op" id="4277705">=</span>&nbsp;<span class="builtintype" id="4277707">uint8</span><span class="op" id="4277712">(</span><span class="ident" id="4277713">n</span>&nbsp;<span class="op" id="4277715">-</span>&nbsp;<span class="num" id="4277717">3</span><span class="op" id="4277718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277724">outIndex</span><span class="op" id="4277732">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277739">w</span><span class="op" id="4277740">.</span><span class="ident" id="4277741">codegenFreq</span><span class="op" id="4277752">[</span><span class="num" id="4277753">16</span><span class="op" id="4277755">]</span><span class="op" id="4277756">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277763">count</span>&nbsp;<span class="op" id="4277769">-=</span>&nbsp;<span class="ident" id="4277772">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277777">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277781">}</span>&nbsp;<span class="keyword" id="4277783">else</span>&nbsp;<span class="op" id="4277788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277793">for</span>&nbsp;<span class="ident" id="4277797">count</span>&nbsp;<span class="op" id="4277803">&gt;=</span>&nbsp;<span class="num" id="4277806">11</span>&nbsp;<span class="op" id="4277809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277815">n</span>&nbsp;<span class="op" id="4277817">:=</span>&nbsp;<span class="num" id="4277820">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277828">if</span>&nbsp;<span class="ident" id="4277831">n</span>&nbsp;<span class="op" id="4277833">&gt;</span>&nbsp;<span class="ident" id="4277835">count</span>&nbsp;<span class="op" id="4277841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277848">n</span>&nbsp;<span class="op" id="4277850">=</span>&nbsp;<span class="ident" id="4277852">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277868">codegen</span><span class="op" id="4277875">[</span><span class="ident" id="4277876">outIndex</span><span class="op" id="4277884">]</span>&nbsp;<span class="op" id="4277886">=</span>&nbsp;<span class="num" id="4277888">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277895">outIndex</span><span class="op" id="4277903">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277910">codegen</span><span class="op" id="4277917">[</span><span class="ident" id="4277918">outIndex</span><span class="op" id="4277926">]</span>&nbsp;<span class="op" id="4277928">=</span>&nbsp;<span class="builtintype" id="4277930">uint8</span><span class="op" id="4277935">(</span><span class="ident" id="4277936">n</span>&nbsp;<span class="op" id="4277938">-</span>&nbsp;<span class="num" id="4277940">11</span><span class="op" id="4277942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277948">outIndex</span><span class="op" id="4277956">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277963">w</span><span class="op" id="4277964">.</span><span class="ident" id="4277965">codegenFreq</span><span class="op" id="4277976">[</span><span class="num" id="4277977">18</span><span class="op" id="4277979">]</span><span class="op" id="4277980">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277987">count</span>&nbsp;<span class="op" id="4277993">-=</span>&nbsp;<span class="ident" id="4277996">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278006">if</span>&nbsp;<span class="ident" id="4278009">count</span>&nbsp;<span class="op" id="4278015">&gt;=</span>&nbsp;<span class="num" id="4278018">3</span>&nbsp;<span class="op" id="4278020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278026">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278059">codegen</span><span class="op" id="4278066">[</span><span class="ident" id="4278067">outIndex</span><span class="op" id="4278075">]</span>&nbsp;<span class="op" id="4278077">=</span>&nbsp;<span class="num" id="4278079">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278086">outIndex</span><span class="op" id="4278094">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278101">codegen</span><span class="op" id="4278108">[</span><span class="ident" id="4278109">outIndex</span><span class="op" id="4278117">]</span>&nbsp;<span class="op" id="4278119">=</span>&nbsp;<span class="builtintype" id="4278121">uint8</span><span class="op" id="4278126">(</span><span class="ident" id="4278127">count</span>&nbsp;<span class="op" id="4278133">-</span>&nbsp;<span class="num" id="4278135">3</span><span class="op" id="4278136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278142">outIndex</span><span class="op" id="4278150">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278157">w</span><span class="op" id="4278158">.</span><span class="ident" id="4278159">codegenFreq</span><span class="op" id="4278170">[</span><span class="num" id="4278171">17</span><span class="op" id="4278173">]</span><span class="op" id="4278174">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278181">count</span>&nbsp;<span class="op" id="4278187">=</span>&nbsp;<span class="num" id="4278189">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278202">count</span><span class="op" id="4278207">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278212">for</span>&nbsp;<span class="op" id="4278216">;</span>&nbsp;<span class="ident" id="4278218">count</span>&nbsp;<span class="op" id="4278224">&gt;=</span>&nbsp;<span class="num" id="4278227">0</span><span class="op" id="4278228">;</span>&nbsp;<span class="ident" id="4278230">count</span><span class="op" id="4278235">--</span>&nbsp;<span class="op" id="4278238">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278243">codegen</span><span class="op" id="4278250">[</span><span class="ident" id="4278251">outIndex</span><span class="op" id="4278259">]</span>&nbsp;<span class="op" id="4278261">=</span>&nbsp;<span class="ident" id="4278263">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278271">outIndex</span><span class="op" id="4278279">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278285">w</span><span class="op" id="4278286">.</span><span class="ident" id="4278287">codegenFreq</span><span class="op" id="4278298">[</span><span class="ident" id="4278299">size</span><span class="op" id="4278303">]</span><span class="op" id="4278304">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278313">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278367">size</span>&nbsp;<span class="op" id="4278372">=</span>&nbsp;<span class="ident" id="4278374">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278385">count</span>&nbsp;<span class="op" id="4278391">=</span>&nbsp;<span class="num" id="4278393">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278399">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278445">codegen</span><span class="op" id="4278452">[</span><span class="ident" id="4278453">outIndex</span><span class="op" id="4278461">]</span>&nbsp;<span class="op" id="4278463">=</span>&nbsp;<span class="ident" id="4278465">badCode</span><br>
<span class="lineno">285</span><span class="op" id="4278473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4278476">func</span>&nbsp;<span class="op" id="4278481">(</span><span class="ident" id="4278482">w</span>&nbsp;<span class="op" id="4278484">*</span><span class="ident" id="4278485">huffmanBitWriter</span><span class="op" id="4278501">)</span>&nbsp;<span class="ident" id="4278503">writeCode</span><span class="op" id="4278512">(</span><span class="ident" id="4278513">code</span>&nbsp;<span class="op" id="4278518">*</span><span class="ident" id="4278519">huffmanEncoder</span><span class="op" id="4278533">,</span>&nbsp;<span class="ident" id="4278535">literal</span>&nbsp;<span class="builtintype" id="4278543">uint32</span><span class="op" id="4278549">)</span>&nbsp;<span class="op" id="4278551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278554">if</span>&nbsp;<span class="ident" id="4278557">w</span><span class="op" id="4278558">.</span><span class="ident" id="4278559">err</span>&nbsp;<span class="op" id="4278563">!=</span>&nbsp;<span class="ident" id="4278566">nil</span>&nbsp;<span class="op" id="4278570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278574">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278585">w</span><span class="op" id="4278586">.</span><span class="ident" id="4278587">writeBits</span><span class="op" id="4278596">(</span><span class="builtintype" id="4278597">int32</span><span class="op" id="4278602">(</span><span class="ident" id="4278603">code</span><span class="op" id="4278607">.</span><span class="ident" id="4278608">code</span><span class="op" id="4278612">[</span><span class="ident" id="4278613">literal</span><span class="op" id="4278620">]</span><span class="op" id="4278621">)</span><span class="op" id="4278622">,</span>&nbsp;<span class="builtintype" id="4278624">int32</span><span class="op" id="4278629">(</span><span class="ident" id="4278630">code</span><span class="op" id="4278634">.</span><span class="ident" id="4278635">codeBits</span><span class="op" id="4278643">[</span><span class="ident" id="4278644">literal</span><span class="op" id="4278651">]</span><span class="op" id="4278652">)</span><span class="op" id="4278653">)</span><br>
<span class="lineno"></span><span class="op" id="4278655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4278658">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="4278727">//</span><br>
<span class="lineno"></span><span class="comment" id="4278730">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4278791">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4278851">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="4278907">func</span>&nbsp;<span class="op" id="4278912">(</span><span class="ident" id="4278913">w</span>&nbsp;<span class="op" id="4278915">*</span><span class="ident" id="4278916">huffmanBitWriter</span><span class="op" id="4278932">)</span>&nbsp;<span class="ident" id="4278934">writeDynamicHeader</span><span class="op" id="4278952">(</span><span class="ident" id="4278953">numLiterals</span>&nbsp;<span class="builtintype" id="4278965">int</span><span class="op" id="4278968">,</span>&nbsp;<span class="ident" id="4278970">numOffsets</span>&nbsp;<span class="builtintype" id="4278981">int</span><span class="op" id="4278984">,</span>&nbsp;<span class="ident" id="4278986">numCodegens</span>&nbsp;<span class="builtintype" id="4278998">int</span><span class="op" id="4279001">,</span>&nbsp;<span class="ident" id="4279003">isEof</span>&nbsp;<span class="builtintype" id="4279009">bool</span><span class="op" id="4279013">)</span>&nbsp;<span class="op" id="4279015">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279018">if</span>&nbsp;<span class="ident" id="4279021">w</span><span class="op" id="4279022">.</span><span class="ident" id="4279023">err</span>&nbsp;<span class="op" id="4279027">!=</span>&nbsp;<span class="ident" id="4279030">nil</span>&nbsp;<span class="op" id="4279034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279038">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279049">var</span>&nbsp;<span class="ident" id="4279053">firstBits</span>&nbsp;<span class="builtintype" id="4279063">int32</span>&nbsp;<span class="op" id="4279069">=</span>&nbsp;<span class="num" id="4279071">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279074">if</span>&nbsp;<span class="ident" id="4279077">isEof</span>&nbsp;<span class="op" id="4279083">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279087">firstBits</span>&nbsp;<span class="op" id="4279097">=</span>&nbsp;<span class="num" id="4279099">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279105">w</span><span class="op" id="4279106">.</span><span class="ident" id="4279107">writeBits</span><span class="op" id="4279116">(</span><span class="ident" id="4279117">firstBits</span><span class="op" id="4279126">,</span>&nbsp;<span class="num" id="4279128">3</span><span class="op" id="4279129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279132">w</span><span class="op" id="4279133">.</span><span class="ident" id="4279134">writeBits</span><span class="op" id="4279143">(</span><span class="builtintype" id="4279144">int32</span><span class="op" id="4279149">(</span><span class="ident" id="4279150">numLiterals</span><span class="op" id="4279161">-</span><span class="num" id="4279162">257</span><span class="op" id="4279165">)</span><span class="op" id="4279166">,</span>&nbsp;<span class="num" id="4279168">5</span><span class="op" id="4279169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279172">w</span><span class="op" id="4279173">.</span><span class="ident" id="4279174">writeBits</span><span class="op" id="4279183">(</span><span class="builtintype" id="4279184">int32</span><span class="op" id="4279189">(</span><span class="ident" id="4279190">numOffsets</span><span class="op" id="4279200">-</span><span class="num" id="4279201">1</span><span class="op" id="4279202">)</span><span class="op" id="4279203">,</span>&nbsp;<span class="num" id="4279205">5</span><span class="op" id="4279206">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279209">w</span><span class="op" id="4279210">.</span><span class="ident" id="4279211">writeBits</span><span class="op" id="4279220">(</span><span class="builtintype" id="4279221">int32</span><span class="op" id="4279226">(</span><span class="ident" id="4279227">numCodegens</span><span class="op" id="4279238">-</span><span class="num" id="4279239">4</span><span class="op" id="4279240">)</span><span class="op" id="4279241">,</span>&nbsp;<span class="num" id="4279243">4</span><span class="op" id="4279244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279248">for</span>&nbsp;<span class="ident" id="4279252">i</span>&nbsp;<span class="op" id="4279254">:=</span>&nbsp;<span class="num" id="4279257">0</span><span class="op" id="4279258">;</span>&nbsp;<span class="ident" id="4279260">i</span>&nbsp;<span class="op" id="4279262">&lt;</span>&nbsp;<span class="ident" id="4279264">numCodegens</span><span class="op" id="4279275">;</span>&nbsp;<span class="ident" id="4279277">i</span><span class="op" id="4279278">++</span>&nbsp;<span class="op" id="4279281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279285">value</span>&nbsp;<span class="op" id="4279291">:=</span>&nbsp;<span class="ident" id="4279294">w</span><span class="op" id="4279295">.</span><span class="ident" id="4279296">codegenEncoding</span><span class="op" id="4279311">.</span><span class="ident" id="4279312">codeBits</span><span class="op" id="4279320">[</span><span class="ident" id="4279321">codegenOrder</span><span class="op" id="4279333">[</span><span class="ident" id="4279334">i</span><span class="op" id="4279335">]</span><span class="op" id="4279336">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279340">w</span><span class="op" id="4279341">.</span><span class="ident" id="4279342">writeBits</span><span class="op" id="4279351">(</span><span class="builtintype" id="4279352">int32</span><span class="op" id="4279357">(</span><span class="ident" id="4279358">value</span><span class="op" id="4279363">)</span><span class="op" id="4279364">,</span>&nbsp;<span class="num" id="4279366">3</span><span class="op" id="4279367">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279374">i</span>&nbsp;<span class="op" id="4279376">:=</span>&nbsp;<span class="num" id="4279379">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279382">for</span>&nbsp;<span class="op" id="4279386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279390">var</span>&nbsp;<span class="ident" id="4279394">codeWord</span>&nbsp;<span class="builtintype" id="4279403">int</span>&nbsp;<span class="op" id="4279407">=</span>&nbsp;<span class="builtintype" id="4279409">int</span><span class="op" id="4279412">(</span><span class="ident" id="4279413">w</span><span class="op" id="4279414">.</span><span class="ident" id="4279415">codegen</span><span class="op" id="4279422">[</span><span class="ident" id="4279423">i</span><span class="op" id="4279424">]</span><span class="op" id="4279425">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279429">i</span><span class="op" id="4279430">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279435">if</span>&nbsp;<span class="ident" id="4279438">codeWord</span>&nbsp;<span class="op" id="4279447">==</span>&nbsp;<span class="ident" id="4279450">badCode</span>&nbsp;<span class="op" id="4279458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279463">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4279475">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279531">w</span><span class="op" id="4279532">.</span><span class="ident" id="4279533">writeCode</span><span class="op" id="4279542">(</span><span class="ident" id="4279543">w</span><span class="op" id="4279544">.</span><span class="ident" id="4279545">codegenEncoding</span><span class="op" id="4279560">,</span>&nbsp;<span class="builtintype" id="4279562">uint32</span><span class="op" id="4279568">(</span><span class="ident" id="4279569">codeWord</span><span class="op" id="4279577">)</span><span class="op" id="4279578">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279583">switch</span>&nbsp;<span class="ident" id="4279590">codeWord</span>&nbsp;<span class="op" id="4279599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279603">case</span>&nbsp;<span class="num" id="4279608">16</span><span class="op" id="4279610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279615">w</span><span class="op" id="4279616">.</span><span class="ident" id="4279617">writeBits</span><span class="op" id="4279626">(</span><span class="builtintype" id="4279627">int32</span><span class="op" id="4279632">(</span><span class="ident" id="4279633">w</span><span class="op" id="4279634">.</span><span class="ident" id="4279635">codegen</span><span class="op" id="4279642">[</span><span class="ident" id="4279643">i</span><span class="op" id="4279644">]</span><span class="op" id="4279645">)</span><span class="op" id="4279646">,</span>&nbsp;<span class="num" id="4279648">2</span><span class="op" id="4279649">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279654">i</span><span class="op" id="4279655">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279661">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279669">case</span>&nbsp;<span class="num" id="4279674">17</span><span class="op" id="4279676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279681">w</span><span class="op" id="4279682">.</span><span class="ident" id="4279683">writeBits</span><span class="op" id="4279692">(</span><span class="builtintype" id="4279693">int32</span><span class="op" id="4279698">(</span><span class="ident" id="4279699">w</span><span class="op" id="4279700">.</span><span class="ident" id="4279701">codegen</span><span class="op" id="4279708">[</span><span class="ident" id="4279709">i</span><span class="op" id="4279710">]</span><span class="op" id="4279711">)</span><span class="op" id="4279712">,</span>&nbsp;<span class="num" id="4279714">3</span><span class="op" id="4279715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279720">i</span><span class="op" id="4279721">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279727">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279735">case</span>&nbsp;<span class="num" id="4279740">18</span><span class="op" id="4279742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279747">w</span><span class="op" id="4279748">.</span><span class="ident" id="4279749">writeBits</span><span class="op" id="4279758">(</span><span class="builtintype" id="4279759">int32</span><span class="op" id="4279764">(</span><span class="ident" id="4279765">w</span><span class="op" id="4279766">.</span><span class="ident" id="4279767">codegen</span><span class="op" id="4279774">[</span><span class="ident" id="4279775">i</span><span class="op" id="4279776">]</span><span class="op" id="4279777">)</span><span class="op" id="4279778">,</span>&nbsp;<span class="num" id="4279780">7</span><span class="op" id="4279781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279786">i</span><span class="op" id="4279787">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279793">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279804">}</span><br>
<span class="lineno"></span><span class="op" id="4279806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279809">func</span>&nbsp;<span class="op" id="4279814">(</span><span class="ident" id="4279815">w</span>&nbsp;<span class="op" id="4279817">*</span><span class="ident" id="4279818">huffmanBitWriter</span><span class="op" id="4279834">)</span>&nbsp;<span class="ident" id="4279836">writeStoredHeader</span><span class="op" id="4279853">(</span><span class="ident" id="4279854">length</span>&nbsp;<span class="builtintype" id="4279861">int</span><span class="op" id="4279864">,</span>&nbsp;<span class="ident" id="4279866">isEof</span>&nbsp;<span class="builtintype" id="4279872">bool</span><span class="op" id="4279876">)</span>&nbsp;<span class="op" id="4279878">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279881">if</span>&nbsp;<span class="ident" id="4279884">w</span><span class="op" id="4279885">.</span><span class="ident" id="4279886">err</span>&nbsp;<span class="op" id="4279890">!=</span>&nbsp;<span class="ident" id="4279893">nil</span>&nbsp;<span class="op" id="4279897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279901">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279912">var</span>&nbsp;<span class="ident" id="4279916">flag</span>&nbsp;<span class="builtintype" id="4279921">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279928">if</span>&nbsp;<span class="ident" id="4279931">isEof</span>&nbsp;<span class="op" id="4279937">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279941">flag</span>&nbsp;<span class="op" id="4279946">=</span>&nbsp;<span class="num" id="4279948">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279954">w</span><span class="op" id="4279955">.</span><span class="ident" id="4279956">writeBits</span><span class="op" id="4279965">(</span><span class="ident" id="4279966">flag</span><span class="op" id="4279970">,</span>&nbsp;<span class="num" id="4279972">3</span><span class="op" id="4279973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279976">w</span><span class="op" id="4279977">.</span><span class="ident" id="4279978">flush</span><span class="op" id="4279983">(</span><span class="op" id="4279984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279987">w</span><span class="op" id="4279988">.</span><span class="ident" id="4279989">writeBits</span><span class="op" id="4279998">(</span><span class="builtintype" id="4279999">int32</span><span class="op" id="4280004">(</span><span class="ident" id="4280005">length</span><span class="op" id="4280011">)</span><span class="op" id="4280012">,</span>&nbsp;<span class="num" id="4280014">16</span><span class="op" id="4280016">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280019">w</span><span class="op" id="4280020">.</span><span class="ident" id="4280021">writeBits</span><span class="op" id="4280030">(</span><span class="builtintype" id="4280031">int32</span><span class="op" id="4280036">(</span><span class="op" id="4280037">^</span><span class="builtintype" id="4280038">uint16</span><span class="op" id="4280044">(</span><span class="ident" id="4280045">length</span><span class="op" id="4280051">)</span><span class="op" id="4280052">)</span><span class="op" id="4280053">,</span>&nbsp;<span class="num" id="4280055">16</span><span class="op" id="4280057">)</span><br>
<span class="lineno"></span><span class="op" id="4280059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4280062">func</span>&nbsp;<span class="op" id="4280067">(</span><span class="ident" id="4280068">w</span>&nbsp;<span class="op" id="4280070">*</span><span class="ident" id="4280071">huffmanBitWriter</span><span class="op" id="4280087">)</span>&nbsp;<span class="ident" id="4280089">writeFixedHeader</span><span class="op" id="4280105">(</span><span class="ident" id="4280106">isEof</span>&nbsp;<span class="builtintype" id="4280112">bool</span><span class="op" id="4280116">)</span>&nbsp;<span class="op" id="4280118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280121">if</span>&nbsp;<span class="ident" id="4280124">w</span><span class="op" id="4280125">.</span><span class="ident" id="4280126">err</span>&nbsp;<span class="op" id="4280130">!=</span>&nbsp;<span class="ident" id="4280133">nil</span>&nbsp;<span class="op" id="4280137">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280141">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4280152">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280199">var</span>&nbsp;<span class="ident" id="4280203">value</span>&nbsp;<span class="builtintype" id="4280209">int32</span>&nbsp;<span class="op" id="4280215">=</span>&nbsp;<span class="num" id="4280217">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280220">if</span>&nbsp;<span class="ident" id="4280223">isEof</span>&nbsp;<span class="op" id="4280229">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280233">value</span>&nbsp;<span class="op" id="4280239">=</span>&nbsp;<span class="num" id="4280241">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280247">w</span><span class="op" id="4280248">.</span><span class="ident" id="4280249">writeBits</span><span class="op" id="4280258">(</span><span class="ident" id="4280259">value</span><span class="op" id="4280264">,</span>&nbsp;<span class="num" id="4280266">3</span><span class="op" id="4280267">)</span><br>
<span class="lineno"></span><span class="op" id="4280269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="4280272">func</span>&nbsp;<span class="op" id="4280277">(</span><span class="ident" id="4280278">w</span>&nbsp;<span class="op" id="4280280">*</span><span class="ident" id="4280281">huffmanBitWriter</span><span class="op" id="4280297">)</span>&nbsp;<span class="ident" id="4280299">writeBlock</span><span class="op" id="4280309">(</span><span class="ident" id="4280310">tokens</span>&nbsp;<span class="op" id="4280317">[</span><span class="op" id="4280318">]</span><span class="ident" id="4280319">token</span><span class="op" id="4280324">,</span>&nbsp;<span class="ident" id="4280326">eof</span>&nbsp;<span class="builtintype" id="4280330">bool</span><span class="op" id="4280334">,</span>&nbsp;<span class="ident" id="4280336">input</span>&nbsp;<span class="op" id="4280342">[</span><span class="op" id="4280343">]</span><span class="builtintype" id="4280344">byte</span><span class="op" id="4280348">)</span>&nbsp;<span class="op" id="4280350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280353">if</span>&nbsp;<span class="ident" id="4280356">w</span><span class="op" id="4280357">.</span><span class="ident" id="4280358">err</span>&nbsp;<span class="op" id="4280362">!=</span>&nbsp;<span class="ident" id="4280365">nil</span>&nbsp;<span class="op" id="4280369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280373">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280384">for</span>&nbsp;<span class="ident" id="4280388">i</span>&nbsp;<span class="op" id="4280390">:=</span>&nbsp;<span class="keyword" id="4280393">range</span>&nbsp;<span class="ident" id="4280399">w</span><span class="op" id="4280400">.</span><span class="ident" id="4280401">literalFreq</span>&nbsp;<span class="op" id="4280413">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280417">w</span><span class="op" id="4280418">.</span><span class="ident" id="4280419">literalFreq</span><span class="op" id="4280430">[</span><span class="ident" id="4280431">i</span><span class="op" id="4280432">]</span>&nbsp;<span class="op" id="4280434">=</span>&nbsp;<span class="num" id="4280436">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280442">for</span>&nbsp;<span class="ident" id="4280446">i</span>&nbsp;<span class="op" id="4280448">:=</span>&nbsp;<span class="keyword" id="4280451">range</span>&nbsp;<span class="ident" id="4280457">w</span><span class="op" id="4280458">.</span><span class="ident" id="4280459">offsetFreq</span>&nbsp;<span class="op" id="4280470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280474">w</span><span class="op" id="4280475">.</span><span class="ident" id="4280476">offsetFreq</span><span class="op" id="4280486">[</span><span class="ident" id="4280487">i</span><span class="op" id="4280488">]</span>&nbsp;<span class="op" id="4280490">=</span>&nbsp;<span class="num" id="4280492">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280495">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280499">n</span>&nbsp;<span class="op" id="4280501">:=</span>&nbsp;<span class="builtinfunc" id="4280504">len</span><span class="op" id="4280507">(</span><span class="ident" id="4280508">tokens</span><span class="op" id="4280514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280517">tokens</span>&nbsp;<span class="op" id="4280524">=</span>&nbsp;<span class="ident" id="4280526">tokens</span><span class="op" id="4280532">[</span><span class="num" id="4280533">0</span>&nbsp;<span class="op" id="4280535">:</span>&nbsp;<span class="ident" id="4280537">n</span><span class="op" id="4280538">+</span><span class="num" id="4280539">1</span><span class="op" id="4280540">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280543">tokens</span><span class="op" id="4280549">[</span><span class="ident" id="4280550">n</span><span class="op" id="4280551">]</span>&nbsp;<span class="op" id="4280553">=</span>&nbsp;<span class="ident" id="4280555">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280572">for</span>&nbsp;<span class="ident" id="4280576">_</span><span class="op" id="4280577">,</span>&nbsp;<span class="ident" id="4280579">t</span>&nbsp;<span class="op" id="4280581">:=</span>&nbsp;<span class="keyword" id="4280584">range</span>&nbsp;<span class="ident" id="4280590">tokens</span>&nbsp;<span class="op" id="4280597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280601">switch</span>&nbsp;<span class="ident" id="4280608">t</span><span class="op" id="4280609">.</span><span class="ident" id="4280610">typ</span><span class="op" id="4280613">(</span><span class="op" id="4280614">)</span>&nbsp;<span class="op" id="4280616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280620">case</span>&nbsp;<span class="ident" id="4280625">literalType</span><span class="op" id="4280636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280641">w</span><span class="op" id="4280642">.</span><span class="ident" id="4280643">literalFreq</span><span class="op" id="4280654">[</span><span class="ident" id="4280655">t</span><span class="op" id="4280656">.</span><span class="ident" id="4280657">literal</span><span class="op" id="4280664">(</span><span class="op" id="4280665">)</span><span class="op" id="4280666">]</span><span class="op" id="4280667">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280672">case</span>&nbsp;<span class="ident" id="4280677">matchType</span><span class="op" id="4280686">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280691">length</span>&nbsp;<span class="op" id="4280698">:=</span>&nbsp;<span class="ident" id="4280701">t</span><span class="op" id="4280702">.</span><span class="ident" id="4280703">length</span><span class="op" id="4280709">(</span><span class="op" id="4280710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280715">offset</span>&nbsp;<span class="op" id="4280722">:=</span>&nbsp;<span class="ident" id="4280725">t</span><span class="op" id="4280726">.</span><span class="ident" id="4280727">offset</span><span class="op" id="4280733">(</span><span class="op" id="4280734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280739">w</span><span class="op" id="4280740">.</span><span class="ident" id="4280741">literalFreq</span><span class="op" id="4280752">[</span><span class="ident" id="4280753">lengthCodesStart</span><span class="op" id="4280769">+</span><span class="ident" id="4280770">lengthCode</span><span class="op" id="4280780">(</span><span class="ident" id="4280781">length</span><span class="op" id="4280787">)</span><span class="op" id="4280788">]</span><span class="op" id="4280789">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280795">w</span><span class="op" id="4280796">.</span><span class="ident" id="4280797">offsetFreq</span><span class="op" id="4280807">[</span><span class="ident" id="4280808">offsetCode</span><span class="op" id="4280818">(</span><span class="ident" id="4280819">offset</span><span class="op" id="4280825">)</span><span class="op" id="4280826">]</span><span class="op" id="4280827">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280832">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4280839">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280870">numLiterals</span>&nbsp;<span class="op" id="4280882">:=</span>&nbsp;<span class="builtinfunc" id="4280885">len</span><span class="op" id="4280888">(</span><span class="ident" id="4280889">w</span><span class="op" id="4280890">.</span><span class="ident" id="4280891">literalFreq</span><span class="op" id="4280902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280905">for</span>&nbsp;<span class="ident" id="4280909">w</span><span class="op" id="4280910">.</span><span class="ident" id="4280911">literalFreq</span><span class="op" id="4280922">[</span><span class="ident" id="4280923">numLiterals</span><span class="op" id="4280934">-</span><span class="num" id="4280935">1</span><span class="op" id="4280936">]</span>&nbsp;<span class="op" id="4280938">==</span>&nbsp;<span class="num" id="4280941">0</span>&nbsp;<span class="op" id="4280943">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280947">numLiterals</span><span class="op" id="4280958">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4280965">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280995">numOffsets</span>&nbsp;<span class="op" id="4281006">:=</span>&nbsp;<span class="builtinfunc" id="4281009">len</span><span class="op" id="4281012">(</span><span class="ident" id="4281013">w</span><span class="op" id="4281014">.</span><span class="ident" id="4281015">offsetFreq</span><span class="op" id="4281025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281028">for</span>&nbsp;<span class="ident" id="4281032">numOffsets</span>&nbsp;<span class="op" id="4281043">&gt;</span>&nbsp;<span class="num" id="4281045">0</span>&nbsp;<span class="op" id="4281047">&amp;&amp;</span>&nbsp;<span class="ident" id="4281050">w</span><span class="op" id="4281051">.</span><span class="ident" id="4281052">offsetFreq</span><span class="op" id="4281062">[</span><span class="ident" id="4281063">numOffsets</span><span class="op" id="4281073">-</span><span class="num" id="4281074">1</span><span class="op" id="4281075">]</span>&nbsp;<span class="op" id="4281077">==</span>&nbsp;<span class="num" id="4281080">0</span>&nbsp;<span class="op" id="4281082">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281086">numOffsets</span><span class="op" id="4281096">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281103">if</span>&nbsp;<span class="ident" id="4281106">numOffsets</span>&nbsp;<span class="op" id="4281117">==</span>&nbsp;<span class="num" id="4281120">0</span>&nbsp;<span class="op" id="4281122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4281126">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4281208">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281307">w</span><span class="op" id="4281308">.</span><span class="ident" id="4281309">offsetFreq</span><span class="op" id="4281319">[</span><span class="num" id="4281320">0</span><span class="op" id="4281321">]</span>&nbsp;<span class="op" id="4281323">=</span>&nbsp;<span class="num" id="4281325">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281329">numOffsets</span>&nbsp;<span class="op" id="4281340">=</span>&nbsp;<span class="num" id="4281342">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281349">w</span><span class="op" id="4281350">.</span><span class="ident" id="4281351">literalEncoding</span><span class="op" id="4281366">.</span><span class="ident" id="4281367">generate</span><span class="op" id="4281375">(</span><span class="ident" id="4281376">w</span><span class="op" id="4281377">.</span><span class="ident" id="4281378">literalFreq</span><span class="op" id="4281389">,</span>&nbsp;<span class="num" id="4281391">15</span><span class="op" id="4281393">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281396">w</span><span class="op" id="4281397">.</span><span class="ident" id="4281398">offsetEncoding</span><span class="op" id="4281412">.</span><span class="ident" id="4281413">generate</span><span class="op" id="4281421">(</span><span class="ident" id="4281422">w</span><span class="op" id="4281423">.</span><span class="ident" id="4281424">offsetFreq</span><span class="op" id="4281434">,</span>&nbsp;<span class="num" id="4281436">15</span><span class="op" id="4281438">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281442">storedBytes</span>&nbsp;<span class="op" id="4281454">:=</span>&nbsp;<span class="num" id="4281457">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281460">if</span>&nbsp;<span class="ident" id="4281463">input</span>&nbsp;<span class="op" id="4281469">!=</span>&nbsp;<span class="ident" id="4281472">nil</span>&nbsp;<span class="op" id="4281476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281480">storedBytes</span>&nbsp;<span class="op" id="4281492">=</span>&nbsp;<span class="builtinfunc" id="4281494">len</span><span class="op" id="4281497">(</span><span class="ident" id="4281498">input</span><span class="op" id="4281503">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281509">var</span>&nbsp;<span class="ident" id="4281513">extraBits</span>&nbsp;<span class="ident" id="4281523">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281530">var</span>&nbsp;<span class="ident" id="4281534">storedSize</span>&nbsp;<span class="ident" id="4281545">int64</span>&nbsp;<span class="op" id="4281551">=</span>&nbsp;<span class="ident" id="4281553">math</span><span class="op" id="4281557">.</span><span class="ident" id="4281558">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281568">if</span>&nbsp;<span class="ident" id="4281571">storedBytes</span>&nbsp;<span class="op" id="4281583">&lt;=</span>&nbsp;<span class="ident" id="4281586">maxStoreBlockSize</span>&nbsp;<span class="op" id="4281604">&amp;&amp;</span>&nbsp;<span class="ident" id="4281607">input</span>&nbsp;<span class="op" id="4281613">!=</span>&nbsp;<span class="ident" id="4281616">nil</span>&nbsp;<span class="op" id="4281620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281624">storedSize</span>&nbsp;<span class="op" id="4281635">=</span>&nbsp;<span class="ident" id="4281637">int64</span><span class="op" id="4281642">(</span><span class="op" id="4281643">(</span><span class="ident" id="4281644">storedBytes</span>&nbsp;<span class="op" id="4281656">+</span>&nbsp;<span class="num" id="4281658">5</span><span class="op" id="4281659">)</span>&nbsp;<span class="op" id="4281661">*</span>&nbsp;<span class="num" id="4281663">8</span><span class="op" id="4281664">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4281668">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4281740">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4281812">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4281882">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281912">for</span>&nbsp;<span class="ident" id="4281916">lengthCode</span>&nbsp;<span class="op" id="4281927">:=</span>&nbsp;<span class="ident" id="4281930">lengthCodesStart</span>&nbsp;<span class="op" id="4281947">+</span>&nbsp;<span class="num" id="4281949">8</span><span class="op" id="4281950">;</span>&nbsp;<span class="ident" id="4281952">lengthCode</span>&nbsp;<span class="op" id="4281963">&lt;</span>&nbsp;<span class="ident" id="4281965">numLiterals</span><span class="op" id="4281976">;</span>&nbsp;<span class="ident" id="4281978">lengthCode</span><span class="op" id="4281988">++</span>&nbsp;<span class="op" id="4281991">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4281996">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282048">extraBits</span>&nbsp;<span class="op" id="4282058">+=</span>&nbsp;<span class="ident" id="4282061">int64</span><span class="op" id="4282066">(</span><span class="ident" id="4282067">w</span><span class="op" id="4282068">.</span><span class="ident" id="4282069">literalFreq</span><span class="op" id="4282080">[</span><span class="ident" id="4282081">lengthCode</span><span class="op" id="4282091">]</span><span class="op" id="4282092">)</span>&nbsp;<span class="op" id="4282094">*</span>&nbsp;<span class="ident" id="4282096">int64</span><span class="op" id="4282101">(</span><span class="ident" id="4282102">lengthExtraBits</span><span class="op" id="4282117">[</span><span class="ident" id="4282118">lengthCode</span><span class="op" id="4282128">-</span><span class="ident" id="4282129">lengthCodesStart</span><span class="op" id="4282145">]</span><span class="op" id="4282146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4282150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282154">for</span>&nbsp;<span class="ident" id="4282158">offsetCode</span>&nbsp;<span class="op" id="4282169">:=</span>&nbsp;<span class="num" id="4282172">4</span><span class="op" id="4282173">;</span>&nbsp;<span class="ident" id="4282175">offsetCode</span>&nbsp;<span class="op" id="4282186">&lt;</span>&nbsp;<span class="ident" id="4282188">numOffsets</span><span class="op" id="4282198">;</span>&nbsp;<span class="ident" id="4282200">offsetCode</span><span class="op" id="4282210">++</span>&nbsp;<span class="op" id="4282213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282218">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282269">extraBits</span>&nbsp;<span class="op" id="4282279">+=</span>&nbsp;<span class="ident" id="4282282">int64</span><span class="op" id="4282287">(</span><span class="ident" id="4282288">w</span><span class="op" id="4282289">.</span><span class="ident" id="4282290">offsetFreq</span><span class="op" id="4282300">[</span><span class="ident" id="4282301">offsetCode</span><span class="op" id="4282311">]</span><span class="op" id="4282312">)</span>&nbsp;<span class="op" id="4282314">*</span>&nbsp;<span class="ident" id="4282316">int64</span><span class="op" id="4282321">(</span><span class="ident" id="4282322">offsetExtraBits</span><span class="op" id="4282337">[</span><span class="ident" id="4282338">offsetCode</span><span class="op" id="4282348">]</span><span class="op" id="4282349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4282353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4282356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282360">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282390">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282418">var</span>&nbsp;<span class="ident" id="4282422">size</span>&nbsp;<span class="op" id="4282427">=</span>&nbsp;<span class="ident" id="4282429">int64</span><span class="op" id="4282434">(</span><span class="num" id="4282435">3</span><span class="op" id="4282436">)</span>&nbsp;<span class="op" id="4282438">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282442">fixedLiteralEncoding</span><span class="op" id="4282462">.</span><span class="ident" id="4282463">bitLength</span><span class="op" id="4282472">(</span><span class="ident" id="4282473">w</span><span class="op" id="4282474">.</span><span class="ident" id="4282475">literalFreq</span><span class="op" id="4282486">)</span>&nbsp;<span class="op" id="4282488">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282492">fixedOffsetEncoding</span><span class="op" id="4282511">.</span><span class="ident" id="4282512">bitLength</span><span class="op" id="4282521">(</span><span class="ident" id="4282522">w</span><span class="op" id="4282523">.</span><span class="ident" id="4282524">offsetFreq</span><span class="op" id="4282534">)</span>&nbsp;<span class="op" id="4282536">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282540">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282551">var</span>&nbsp;<span class="ident" id="4282555">literalEncoding</span>&nbsp;<span class="op" id="4282571">=</span>&nbsp;<span class="ident" id="4282573">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282595">var</span>&nbsp;<span class="ident" id="4282599">offsetEncoding</span>&nbsp;<span class="op" id="4282614">=</span>&nbsp;<span class="ident" id="4282616">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282638">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282659">var</span>&nbsp;<span class="ident" id="4282663">numCodegens</span>&nbsp;<span class="builtintype" id="4282675">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282681">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282756">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282804">w</span><span class="op" id="4282805">.</span><span class="ident" id="4282806">generateCodegen</span><span class="op" id="4282821">(</span><span class="ident" id="4282822">numLiterals</span><span class="op" id="4282833">,</span>&nbsp;<span class="ident" id="4282835">numOffsets</span><span class="op" id="4282845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282848">w</span><span class="op" id="4282849">.</span><span class="ident" id="4282850">codegenEncoding</span><span class="op" id="4282865">.</span><span class="ident" id="4282866">generate</span><span class="op" id="4282874">(</span><span class="ident" id="4282875">w</span><span class="op" id="4282876">.</span><span class="ident" id="4282877">codegenFreq</span><span class="op" id="4282888">,</span>&nbsp;<span class="num" id="4282890">7</span><span class="op" id="4282891">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282894">numCodegens</span>&nbsp;<span class="op" id="4282906">=</span>&nbsp;<span class="builtinfunc" id="4282908">len</span><span class="op" id="4282911">(</span><span class="ident" id="4282912">w</span><span class="op" id="4282913">.</span><span class="ident" id="4282914">codegenFreq</span><span class="op" id="4282925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282928">for</span>&nbsp;<span class="ident" id="4282932">numCodegens</span>&nbsp;<span class="op" id="4282944">&gt;</span>&nbsp;<span class="num" id="4282946">4</span>&nbsp;<span class="op" id="4282948">&amp;&amp;</span>&nbsp;<span class="ident" id="4282951">w</span><span class="op" id="4282952">.</span><span class="ident" id="4282953">codegenFreq</span><span class="op" id="4282964">[</span><span class="ident" id="4282965">codegenOrder</span><span class="op" id="4282977">[</span><span class="ident" id="4282978">numCodegens</span><span class="op" id="4282989">-</span><span class="num" id="4282990">1</span><span class="op" id="4282991">]</span><span class="op" id="4282992">]</span>&nbsp;<span class="op" id="4282994">==</span>&nbsp;<span class="num" id="4282997">0</span>&nbsp;<span class="op" id="4282999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283003">numCodegens</span><span class="op" id="4283014">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283021">dynamicHeader</span>&nbsp;<span class="op" id="4283035">:=</span>&nbsp;<span class="ident" id="4283038">int64</span><span class="op" id="4283043">(</span><span class="num" id="4283044">3</span><span class="op" id="4283045">+</span><span class="num" id="4283046">5</span><span class="op" id="4283047">+</span><span class="num" id="4283048">5</span><span class="op" id="4283049">+</span><span class="num" id="4283050">4</span><span class="op" id="4283051">+</span><span class="op" id="4283052">(</span><span class="num" id="4283053">3</span><span class="op" id="4283054">*</span><span class="ident" id="4283055">numCodegens</span><span class="op" id="4283066">)</span><span class="op" id="4283067">)</span>&nbsp;<span class="op" id="4283069">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283073">w</span><span class="op" id="4283074">.</span><span class="ident" id="4283075">codegenEncoding</span><span class="op" id="4283090">.</span><span class="ident" id="4283091">bitLength</span><span class="op" id="4283100">(</span><span class="ident" id="4283101">w</span><span class="op" id="4283102">.</span><span class="ident" id="4283103">codegenFreq</span><span class="op" id="4283114">)</span>&nbsp;<span class="op" id="4283116">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283120">int64</span><span class="op" id="4283125">(</span><span class="ident" id="4283126">extraBits</span><span class="op" id="4283135">)</span>&nbsp;<span class="op" id="4283137">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283141">int64</span><span class="op" id="4283146">(</span><span class="ident" id="4283147">w</span><span class="op" id="4283148">.</span><span class="ident" id="4283149">codegenFreq</span><span class="op" id="4283160">[</span><span class="num" id="4283161">16</span><span class="op" id="4283163">]</span><span class="op" id="4283164">*</span><span class="num" id="4283165">2</span><span class="op" id="4283166">)</span>&nbsp;<span class="op" id="4283168">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283172">int64</span><span class="op" id="4283177">(</span><span class="ident" id="4283178">w</span><span class="op" id="4283179">.</span><span class="ident" id="4283180">codegenFreq</span><span class="op" id="4283191">[</span><span class="num" id="4283192">17</span><span class="op" id="4283194">]</span><span class="op" id="4283195">*</span><span class="num" id="4283196">3</span><span class="op" id="4283197">)</span>&nbsp;<span class="op" id="4283199">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283203">int64</span><span class="op" id="4283208">(</span><span class="ident" id="4283209">w</span><span class="op" id="4283210">.</span><span class="ident" id="4283211">codegenFreq</span><span class="op" id="4283222">[</span><span class="num" id="4283223">18</span><span class="op" id="4283225">]</span><span class="op" id="4283226">*</span><span class="num" id="4283227">7</span><span class="op" id="4283228">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283231">dynamicSize</span>&nbsp;<span class="op" id="4283243">:=</span>&nbsp;<span class="ident" id="4283246">dynamicHeader</span>&nbsp;<span class="op" id="4283260">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283264">w</span><span class="op" id="4283265">.</span><span class="ident" id="4283266">literalEncoding</span><span class="op" id="4283281">.</span><span class="ident" id="4283282">bitLength</span><span class="op" id="4283291">(</span><span class="ident" id="4283292">w</span><span class="op" id="4283293">.</span><span class="ident" id="4283294">literalFreq</span><span class="op" id="4283305">)</span>&nbsp;<span class="op" id="4283307">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283311">w</span><span class="op" id="4283312">.</span><span class="ident" id="4283313">offsetEncoding</span><span class="op" id="4283327">.</span><span class="ident" id="4283328">bitLength</span><span class="op" id="4283337">(</span><span class="ident" id="4283338">w</span><span class="op" id="4283339">.</span><span class="ident" id="4283340">offsetFreq</span><span class="op" id="4283350">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283354">if</span>&nbsp;<span class="ident" id="4283357">dynamicSize</span>&nbsp;<span class="op" id="4283369">&lt;</span>&nbsp;<span class="ident" id="4283371">size</span>&nbsp;<span class="op" id="4283376">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283380">size</span>&nbsp;<span class="op" id="4283385">=</span>&nbsp;<span class="ident" id="4283387">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283401">literalEncoding</span>&nbsp;<span class="op" id="4283417">=</span>&nbsp;<span class="ident" id="4283419">w</span><span class="op" id="4283420">.</span><span class="ident" id="4283421">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283439">offsetEncoding</span>&nbsp;<span class="op" id="4283454">=</span>&nbsp;<span class="ident" id="4283456">w</span><span class="op" id="4283457">.</span><span class="ident" id="4283458">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4283478">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283496">if</span>&nbsp;<span class="ident" id="4283499">storedSize</span>&nbsp;<span class="op" id="4283510">&lt;</span>&nbsp;<span class="ident" id="4283512">size</span>&nbsp;<span class="op" id="4283517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283521">w</span><span class="op" id="4283522">.</span><span class="ident" id="4283523">writeStoredHeader</span><span class="op" id="4283540">(</span><span class="ident" id="4283541">storedBytes</span><span class="op" id="4283552">,</span>&nbsp;<span class="ident" id="4283554">eof</span><span class="op" id="4283557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283561">w</span><span class="op" id="4283562">.</span><span class="ident" id="4283563">writeBytes</span><span class="op" id="4283573">(</span><span class="ident" id="4283574">input</span><span class="op" id="4283579">[</span><span class="num" id="4283580">0</span><span class="op" id="4283581">:</span><span class="ident" id="4283582">storedBytes</span><span class="op" id="4283593">]</span><span class="op" id="4283594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283598">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4283610">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283623">if</span>&nbsp;<span class="ident" id="4283626">literalEncoding</span>&nbsp;<span class="op" id="4283642">==</span>&nbsp;<span class="ident" id="4283645">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4283666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283670">w</span><span class="op" id="4283671">.</span><span class="ident" id="4283672">writeFixedHeader</span><span class="op" id="4283688">(</span><span class="ident" id="4283689">eof</span><span class="op" id="4283692">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283695">}</span>&nbsp;<span class="keyword" id="4283697">else</span>&nbsp;<span class="op" id="4283702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283706">w</span><span class="op" id="4283707">.</span><span class="ident" id="4283708">writeDynamicHeader</span><span class="op" id="4283726">(</span><span class="ident" id="4283727">numLiterals</span><span class="op" id="4283738">,</span>&nbsp;<span class="ident" id="4283740">numOffsets</span><span class="op" id="4283750">,</span>&nbsp;<span class="ident" id="4283752">numCodegens</span><span class="op" id="4283763">,</span>&nbsp;<span class="ident" id="4283765">eof</span><span class="op" id="4283768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283774">for</span>&nbsp;<span class="ident" id="4283778">_</span><span class="op" id="4283779">,</span>&nbsp;<span class="ident" id="4283781">t</span>&nbsp;<span class="op" id="4283783">:=</span>&nbsp;<span class="keyword" id="4283786">range</span>&nbsp;<span class="ident" id="4283792">tokens</span>&nbsp;<span class="op" id="4283799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283803">switch</span>&nbsp;<span class="ident" id="4283810">t</span><span class="op" id="4283811">.</span><span class="ident" id="4283812">typ</span><span class="op" id="4283815">(</span><span class="op" id="4283816">)</span>&nbsp;<span class="op" id="4283818">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283822">case</span>&nbsp;<span class="ident" id="4283827">literalType</span><span class="op" id="4283838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283843">w</span><span class="op" id="4283844">.</span><span class="ident" id="4283845">writeCode</span><span class="op" id="4283854">(</span><span class="ident" id="4283855">literalEncoding</span><span class="op" id="4283870">,</span>&nbsp;<span class="ident" id="4283872">t</span><span class="op" id="4283873">.</span><span class="ident" id="4283874">literal</span><span class="op" id="4283881">(</span><span class="op" id="4283882">)</span><span class="op" id="4283883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283888">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283896">case</span>&nbsp;<span class="ident" id="4283901">matchType</span><span class="op" id="4283910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4283915">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283938">length</span>&nbsp;<span class="op" id="4283945">:=</span>&nbsp;<span class="ident" id="4283948">t</span><span class="op" id="4283949">.</span><span class="ident" id="4283950">length</span><span class="op" id="4283956">(</span><span class="op" id="4283957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283962">lengthCode</span>&nbsp;<span class="op" id="4283973">:=</span>&nbsp;<span class="ident" id="4283976">lengthCode</span><span class="op" id="4283986">(</span><span class="ident" id="4283987">length</span><span class="op" id="4283993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283998">w</span><span class="op" id="4283999">.</span><span class="ident" id="4284000">writeCode</span><span class="op" id="4284009">(</span><span class="ident" id="4284010">literalEncoding</span><span class="op" id="4284025">,</span>&nbsp;<span class="ident" id="4284027">lengthCode</span><span class="op" id="4284037">+</span><span class="ident" id="4284038">lengthCodesStart</span><span class="op" id="4284054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284059">extraLengthBits</span>&nbsp;<span class="op" id="4284075">:=</span>&nbsp;<span class="builtintype" id="4284078">int32</span><span class="op" id="4284083">(</span><span class="ident" id="4284084">lengthExtraBits</span><span class="op" id="4284099">[</span><span class="ident" id="4284100">lengthCode</span><span class="op" id="4284110">]</span><span class="op" id="4284111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284116">if</span>&nbsp;<span class="ident" id="4284119">extraLengthBits</span>&nbsp;<span class="op" id="4284135">&gt;</span>&nbsp;<span class="num" id="4284137">0</span>&nbsp;<span class="op" id="4284139">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284145">extraLength</span>&nbsp;<span class="op" id="4284157">:=</span>&nbsp;<span class="builtintype" id="4284160">int32</span><span class="op" id="4284165">(</span><span class="ident" id="4284166">length</span>&nbsp;<span class="op" id="4284173">-</span>&nbsp;<span class="ident" id="4284175">lengthBase</span><span class="op" id="4284185">[</span><span class="ident" id="4284186">lengthCode</span><span class="op" id="4284196">]</span><span class="op" id="4284197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284203">w</span><span class="op" id="4284204">.</span><span class="ident" id="4284205">writeBits</span><span class="op" id="4284214">(</span><span class="ident" id="4284215">extraLength</span><span class="op" id="4284226">,</span>&nbsp;<span class="ident" id="4284228">extraLengthBits</span><span class="op" id="4284243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284253">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284276">offset</span>&nbsp;<span class="op" id="4284283">:=</span>&nbsp;<span class="ident" id="4284286">t</span><span class="op" id="4284287">.</span><span class="ident" id="4284288">offset</span><span class="op" id="4284294">(</span><span class="op" id="4284295">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284300">offsetCode</span>&nbsp;<span class="op" id="4284311">:=</span>&nbsp;<span class="ident" id="4284314">offsetCode</span><span class="op" id="4284324">(</span><span class="ident" id="4284325">offset</span><span class="op" id="4284331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284336">w</span><span class="op" id="4284337">.</span><span class="ident" id="4284338">writeCode</span><span class="op" id="4284347">(</span><span class="ident" id="4284348">offsetEncoding</span><span class="op" id="4284362">,</span>&nbsp;<span class="ident" id="4284364">offsetCode</span><span class="op" id="4284374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284379">extraOffsetBits</span>&nbsp;<span class="op" id="4284395">:=</span>&nbsp;<span class="builtintype" id="4284398">int32</span><span class="op" id="4284403">(</span><span class="ident" id="4284404">offsetExtraBits</span><span class="op" id="4284419">[</span><span class="ident" id="4284420">offsetCode</span><span class="op" id="4284430">]</span><span class="op" id="4284431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284436">if</span>&nbsp;<span class="ident" id="4284439">extraOffsetBits</span>&nbsp;<span class="op" id="4284455">&gt;</span>&nbsp;<span class="num" id="4284457">0</span>&nbsp;<span class="op" id="4284459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284465">extraOffset</span>&nbsp;<span class="op" id="4284477">:=</span>&nbsp;<span class="builtintype" id="4284480">int32</span><span class="op" id="4284485">(</span><span class="ident" id="4284486">offset</span>&nbsp;<span class="op" id="4284493">-</span>&nbsp;<span class="ident" id="4284495">offsetBase</span><span class="op" id="4284505">[</span><span class="ident" id="4284506">offsetCode</span><span class="op" id="4284516">]</span><span class="op" id="4284517">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284523">w</span><span class="op" id="4284524">.</span><span class="ident" id="4284525">writeBits</span><span class="op" id="4284534">(</span><span class="ident" id="4284535">extraOffset</span><span class="op" id="4284546">,</span>&nbsp;<span class="ident" id="4284548">extraOffsetBits</span><span class="op" id="4284563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284573">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284581">default</span><span class="op" id="4284588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4284593">panic</span><span class="op" id="4284598">(</span><span class="string" id="4284599">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4284622">+</span>&nbsp;<span class="builtintype" id="4284624">string</span><span class="op" id="4284630">(</span><span class="ident" id="4284631">t</span><span class="op" id="4284632">)</span><span class="op" id="4284633">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284640">}</span><br>
<span class="lineno"></span><span class="op" id="4284642">}</span>
</div>
</body>
</html>
