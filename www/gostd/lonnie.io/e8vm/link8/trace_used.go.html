<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4819764">package</span>&nbsp;<span class="ident" id="4819772">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4819779">type</span>&nbsp;<span class="ident" id="4819784">tracer</span>&nbsp;<span class="keyword" id="4819791">struct</span>&nbsp;<span class="op" id="4819798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819801">lnk</span>&nbsp;&nbsp;<span class="op" id="4819806">*</span><span class="ident" id="4819807">Linker</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819815">hits</span>&nbsp;<span class="op" id="4819820">[</span><span class="op" id="4819821">]</span><span class="op" id="4819822">[</span><span class="op" id="4819823">]</span><span class="builtintype" id="4819824">bool</span><br>
<span class="lineno"></span><span class="op" id="4819829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4819832">func</span>&nbsp;<span class="ident" id="4819837">newTracer</span><span class="op" id="4819846">(</span><span class="ident" id="4819847">lnk</span>&nbsp;<span class="op" id="4819851">*</span><span class="ident" id="4819852">Linker</span><span class="op" id="4819858">)</span>&nbsp;<span class="op" id="4819860">*</span><span class="ident" id="4819861">tracer</span>&nbsp;<span class="op" id="4819868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819871">npkg</span>&nbsp;<span class="op" id="4819876">:=</span>&nbsp;<span class="ident" id="4819879">lnk</span><span class="op" id="4819882">.</span><span class="ident" id="4819883">Npkg</span><span class="op" id="4819887">(</span><span class="op" id="4819888">)</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819891">ret</span>&nbsp;<span class="op" id="4819895">:=</span>&nbsp;<span class="builtinfunc" id="4819898">new</span><span class="op" id="4819901">(</span><span class="ident" id="4819902">tracer</span><span class="op" id="4819908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819911">ret</span><span class="op" id="4819914">.</span><span class="ident" id="4819915">lnk</span>&nbsp;<span class="op" id="4819919">=</span>&nbsp;<span class="ident" id="4819921">lnk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819926">ret</span><span class="op" id="4819929">.</span><span class="ident" id="4819930">hits</span>&nbsp;<span class="op" id="4819935">=</span>&nbsp;<span class="builtinfunc" id="4819937">make</span><span class="op" id="4819941">(</span><span class="op" id="4819942">[</span><span class="op" id="4819943">]</span><span class="op" id="4819944">[</span><span class="op" id="4819945">]</span><span class="builtintype" id="4819946">bool</span><span class="op" id="4819950">,</span>&nbsp;<span class="ident" id="4819952">npkg</span><span class="op" id="4819956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819959">for</span>&nbsp;<span class="ident" id="4819963">i</span>&nbsp;<span class="op" id="4819965">:=</span>&nbsp;<span class="num" id="4819968">0</span><span class="op" id="4819969">;</span>&nbsp;<span class="ident" id="4819971">i</span>&nbsp;<span class="op" id="4819973">&lt;</span>&nbsp;<span class="ident" id="4819975">npkg</span><span class="op" id="4819979">;</span>&nbsp;<span class="ident" id="4819981">i</span><span class="op" id="4819982">++</span>&nbsp;<span class="op" id="4819985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819989">p</span>&nbsp;<span class="op" id="4819991">:=</span>&nbsp;<span class="ident" id="4819994">lnk</span><span class="op" id="4819997">.</span><span class="ident" id="4819998">Pkg</span><span class="op" id="4820001">(</span><span class="ident" id="4820002">i</span><span class="op" id="4820003">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820007">ret</span><span class="op" id="4820010">.</span><span class="ident" id="4820011">hits</span><span class="op" id="4820015">[</span><span class="ident" id="4820016">i</span><span class="op" id="4820017">]</span>&nbsp;<span class="op" id="4820019">=</span>&nbsp;<span class="builtinfunc" id="4820021">make</span><span class="op" id="4820025">(</span><span class="op" id="4820026">[</span><span class="op" id="4820027">]</span><span class="builtintype" id="4820028">bool</span><span class="op" id="4820032">,</span>&nbsp;<span class="builtinfunc" id="4820034">len</span><span class="op" id="4820037">(</span><span class="ident" id="4820038">p</span><span class="op" id="4820039">.</span><span class="ident" id="4820040">symbols</span><span class="op" id="4820047">)</span><span class="op" id="4820048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820055">return</span>&nbsp;<span class="ident" id="4820062">ret</span><br>
<span class="lineno"></span><span class="op" id="4820066">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4820069">func</span>&nbsp;<span class="op" id="4820074">(</span><span class="ident" id="4820075">t</span>&nbsp;<span class="op" id="4820077">*</span><span class="ident" id="4820078">tracer</span><span class="op" id="4820084">)</span>&nbsp;<span class="ident" id="4820086">hit</span><span class="op" id="4820089">(</span><span class="ident" id="4820090">pkg</span>&nbsp;<span class="op" id="4820094">*</span><span class="ident" id="4820095">Package</span><span class="op" id="4820102">,</span>&nbsp;<span class="ident" id="4820104">sym</span>&nbsp;<span class="builtintype" id="4820108">uint32</span><span class="op" id="4820114">)</span>&nbsp;<span class="builtintype" id="4820116">bool</span>&nbsp;<span class="op" id="4820121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820124">i</span>&nbsp;<span class="op" id="4820126">:=</span>&nbsp;<span class="ident" id="4820129">t</span><span class="op" id="4820130">.</span><span class="ident" id="4820131">lnk</span><span class="op" id="4820134">.</span><span class="ident" id="4820135">PkgIndex</span><span class="op" id="4820143">(</span><span class="ident" id="4820144">pkg</span><span class="op" id="4820147">.</span><span class="ident" id="4820148">path</span><span class="op" id="4820152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820155">pt</span>&nbsp;<span class="op" id="4820158">:=</span>&nbsp;<span class="op" id="4820161">&amp;</span><span class="ident" id="4820162">t</span><span class="op" id="4820163">.</span><span class="ident" id="4820164">hits</span><span class="op" id="4820168">[</span><span class="ident" id="4820169">i</span><span class="op" id="4820170">]</span><span class="op" id="4820171">[</span><span class="ident" id="4820172">sym</span><span class="op" id="4820175">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820178">ret</span>&nbsp;<span class="op" id="4820182">:=</span>&nbsp;<span class="op" id="4820185">*</span><span class="ident" id="4820186">pt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820190">*</span><span class="ident" id="4820191">pt</span>&nbsp;<span class="op" id="4820194">=</span>&nbsp;<span class="builtintype" id="4820196">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820202">return</span>&nbsp;<span class="ident" id="4820209">ret</span><br>
<span class="lineno"></span><span class="op" id="4820213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4820216">func</span>&nbsp;<span class="ident" id="4820221">traceUsed</span><span class="op" id="4820230">(</span><span class="ident" id="4820231">lnk</span>&nbsp;<span class="op" id="4820235">*</span><span class="ident" id="4820236">Linker</span><span class="op" id="4820242">,</span>&nbsp;<span class="ident" id="4820244">p</span>&nbsp;<span class="op" id="4820246">*</span><span class="ident" id="4820247">Package</span><span class="op" id="4820254">,</span>&nbsp;<span class="ident" id="4820256">index</span>&nbsp;<span class="builtintype" id="4820262">uint32</span><span class="op" id="4820268">)</span>&nbsp;<span class="op" id="4820270">[</span><span class="op" id="4820271">]</span><span class="ident" id="4820272">pkgSym</span>&nbsp;<span class="op" id="4820279">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820282">t</span>&nbsp;<span class="op" id="4820284">:=</span>&nbsp;<span class="ident" id="4820287">newTracer</span><span class="op" id="4820296">(</span><span class="ident" id="4820297">lnk</span><span class="op" id="4820300">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820304">cur</span>&nbsp;<span class="op" id="4820308">:=</span>&nbsp;<span class="op" id="4820311">[</span><span class="op" id="4820312">]</span><span class="ident" id="4820313">pkgSym</span><span class="op" id="4820319">{</span><span class="op" id="4820320">{</span><span class="ident" id="4820321">p</span><span class="op" id="4820322">,</span>&nbsp;<span class="ident" id="4820324">index</span><span class="op" id="4820329">}</span><span class="op" id="4820330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820333">var</span>&nbsp;<span class="ident" id="4820337">next</span>&nbsp;<span class="op" id="4820342">[</span><span class="op" id="4820343">]</span><span class="ident" id="4820344">pkgSym</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820352">var</span>&nbsp;<span class="ident" id="4820356">ret</span>&nbsp;<span class="op" id="4820360">[</span><span class="op" id="4820361">]</span><span class="ident" id="4820362">pkgSym</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4820371">//&nbsp;BFS&nbsp;traverse&nbsp;all&nbsp;the&nbsp;symbols&nbsp;used&nbsp;by&nbsp;the&nbsp;symbol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820423">for</span>&nbsp;<span class="builtinfunc" id="4820427">len</span><span class="op" id="4820430">(</span><span class="ident" id="4820431">cur</span><span class="op" id="4820434">)</span>&nbsp;<span class="op" id="4820436">&gt;</span>&nbsp;<span class="num" id="4820438">0</span>&nbsp;<span class="op" id="4820440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820444">for</span>&nbsp;<span class="ident" id="4820448">_</span><span class="op" id="4820449">,</span>&nbsp;<span class="ident" id="4820451">ps</span>&nbsp;<span class="op" id="4820454">:=</span>&nbsp;<span class="keyword" id="4820457">range</span>&nbsp;<span class="ident" id="4820463">cur</span>&nbsp;<span class="op" id="4820467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820472">ret</span>&nbsp;<span class="op" id="4820476">=</span>&nbsp;<span class="builtinfunc" id="4820478">append</span><span class="op" id="4820484">(</span><span class="ident" id="4820485">ret</span><span class="op" id="4820488">,</span>&nbsp;<span class="ident" id="4820490">ps</span><span class="op" id="4820492">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820498">typ</span>&nbsp;<span class="op" id="4820502">:=</span>&nbsp;<span class="ident" id="4820505">ps</span><span class="op" id="4820507">.</span><span class="ident" id="4820508">Type</span><span class="op" id="4820512">(</span><span class="op" id="4820513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820518">if</span>&nbsp;<span class="ident" id="4820521">typ</span>&nbsp;<span class="op" id="4820525">==</span>&nbsp;<span class="ident" id="4820528">SymFunc</span>&nbsp;<span class="op" id="4820536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820542">f</span>&nbsp;<span class="op" id="4820544">:=</span>&nbsp;<span class="ident" id="4820547">ps</span><span class="op" id="4820549">.</span><span class="ident" id="4820550">Func</span><span class="op" id="4820554">(</span><span class="op" id="4820555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820562">for</span>&nbsp;<span class="ident" id="4820566">_</span><span class="op" id="4820567">,</span>&nbsp;<span class="ident" id="4820569">link</span>&nbsp;<span class="op" id="4820574">:=</span>&nbsp;<span class="keyword" id="4820577">range</span>&nbsp;<span class="ident" id="4820583">f</span><span class="op" id="4820584">.</span><span class="ident" id="4820585">links</span>&nbsp;<span class="op" id="4820591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820598">pkg</span>&nbsp;<span class="op" id="4820602">:=</span>&nbsp;<span class="ident" id="4820605">ps</span><span class="op" id="4820607">.</span><span class="ident" id="4820608">Import</span><span class="op" id="4820614">(</span><span class="ident" id="4820615">link</span><span class="op" id="4820619">.</span><span class="ident" id="4820620">pkg</span><span class="op" id="4820623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820630">if</span>&nbsp;<span class="ident" id="4820633">t</span><span class="op" id="4820634">.</span><span class="ident" id="4820635">hit</span><span class="op" id="4820638">(</span><span class="ident" id="4820639">pkg</span><span class="op" id="4820642">,</span>&nbsp;<span class="ident" id="4820644">link</span><span class="op" id="4820648">.</span><span class="ident" id="4820649">sym</span><span class="op" id="4820652">)</span>&nbsp;<span class="op" id="4820654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820662">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820676">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820684">item</span>&nbsp;<span class="op" id="4820689">:=</span>&nbsp;<span class="ident" id="4820692">pkgSym</span><span class="op" id="4820698">{</span><span class="ident" id="4820699">pkg</span><span class="op" id="4820702">,</span>&nbsp;<span class="ident" id="4820704">link</span><span class="op" id="4820708">.</span><span class="ident" id="4820709">sym</span><span class="op" id="4820712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820719">next</span>&nbsp;<span class="op" id="4820724">=</span>&nbsp;<span class="builtinfunc" id="4820726">append</span><span class="op" id="4820732">(</span><span class="ident" id="4820733">next</span><span class="op" id="4820737">,</span>&nbsp;<span class="ident" id="4820739">item</span><span class="op" id="4820743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820754">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820763">cur</span>&nbsp;<span class="op" id="4820767">=</span>&nbsp;<span class="ident" id="4820769">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820776">next</span>&nbsp;<span class="op" id="4820781">=</span>&nbsp;<span class="ident" id="4820783">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820788">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820792">return</span>&nbsp;<span class="ident" id="4820799">ret</span><br>
<span class="lineno"></span><span class="op" id="4820803">}</span>
</div>
</body>
</html>
