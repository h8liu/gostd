<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6389067">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6389122">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6389176">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6389227">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="6389304">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="6389334">//</span><br>
<span class="lineno"></span><span class="comment" id="6389337">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="6389353">//</span><br>
<span class="lineno">10</span><span class="comment" id="6389356">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6389389">//&nbsp;&nbsp;&nbsp;&nbspindex&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="6389423">//</span><br>
<span class="lineno"></span><span class="comment" id="6389426">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="6389452">//&nbsp;&nbsp;&nbsp;&nbspoffsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="6389537">//&nbsp;&nbsp;&nbsp;&nbspoffsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6389628">//</span><br>
<span class="lineno"></span><span class="keyword" id="6389631">package</span>&nbsp;<span class="ident" id="6389639">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6389652">import</span>&nbsp;<span class="op" id="6389659">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6389662">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6389671">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6389690">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6389696">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6389706">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6389713">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6389716">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="6389778">type</span>&nbsp;<span class="ident" id="6389783">Index</span>&nbsp;<span class="keyword" id="6389789">struct</span>&nbsp;<span class="op" id="6389796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389799">data</span>&nbsp;<span class="op" id="6389804">[</span><span class="op" id="6389805">]</span><span class="builtintype" id="6389806">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389812">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6389817">[</span><span class="op" id="6389818">]</span><span class="builtintype" id="6389819">int</span>&nbsp;<span class="comment" id="6389823">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="6389870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6389873">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6389910">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="6389967">func</span>&nbsp;<span class="ident" id="6389972">New</span><span class="op" id="6389975">(</span><span class="ident" id="6389976">data</span>&nbsp;<span class="op" id="6389981">[</span><span class="op" id="6389982">]</span><span class="builtintype" id="6389983">byte</span><span class="op" id="6389987">)</span>&nbsp;<span class="op" id="6389989">*</span><span class="ident" id="6389990">Index</span>&nbsp;<span class="op" id="6389996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389999">return</span>&nbsp;<span class="op" id="6390006">&amp;</span><span class="ident" id="6390007">Index</span><span class="op" id="6390012">{</span><span class="ident" id="6390013">data</span><span class="op" id="6390017">,</span>&nbsp;<span class="ident" id="6390019">qsufsort</span><span class="op" id="6390027">(</span><span class="ident" id="6390028">data</span><span class="op" id="6390032">)</span><span class="op" id="6390033">}</span><br>
<span class="lineno"></span><span class="op" id="6390035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6390038">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="6390102">func</span>&nbsp;<span class="ident" id="6390107">writeInt</span><span class="op" id="6390115">(</span><span class="ident" id="6390116">w</span>&nbsp;<span class="ident" id="6390118">io</span><span class="op" id="6390120">.</span><span class="ident" id="6390121">Writer</span><span class="op" id="6390127">,</span>&nbsp;<span class="ident" id="6390129">buf</span>&nbsp;<span class="op" id="6390133">[</span><span class="op" id="6390134">]</span><span class="builtintype" id="6390135">byte</span><span class="op" id="6390139">,</span>&nbsp;<span class="ident" id="6390141">x</span>&nbsp;<span class="builtintype" id="6390143">int</span><span class="op" id="6390146">)</span>&nbsp;<span class="builtintype" id="6390148">error</span>&nbsp;<span class="op" id="6390154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390157">binary</span><span class="op" id="6390163">.</span><span class="ident" id="6390164">PutVarint</span><span class="op" id="6390173">(</span><span class="ident" id="6390174">buf</span><span class="op" id="6390177">,</span>&nbsp;<span class="ident" id="6390179">int64</span><span class="op" id="6390184">(</span><span class="ident" id="6390185">x</span><span class="op" id="6390186">)</span><span class="op" id="6390187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390190">_</span><span class="op" id="6390191">,</span>&nbsp;<span class="ident" id="6390193">err</span>&nbsp;<span class="op" id="6390197">:=</span>&nbsp;<span class="ident" id="6390200">w</span><span class="op" id="6390201">.</span><span class="ident" id="6390202">Write</span><span class="op" id="6390207">(</span><span class="ident" id="6390208">buf</span><span class="op" id="6390211">[</span><span class="num" id="6390212">0</span><span class="op" id="6390213">:</span><span class="ident" id="6390214">binary</span><span class="op" id="6390220">.</span><span class="ident" id="6390221">MaxVarintLen64</span><span class="op" id="6390235">]</span><span class="op" id="6390236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390239">return</span>&nbsp;<span class="ident" id="6390246">err</span><br>
<span class="lineno"></span><span class="op" id="6390250">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6390253">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="6390330">func</span>&nbsp;<span class="ident" id="6390335">readInt</span><span class="op" id="6390342">(</span><span class="ident" id="6390343">r</span>&nbsp;<span class="ident" id="6390345">io</span><span class="op" id="6390347">.</span><span class="ident" id="6390348">Reader</span><span class="op" id="6390354">,</span>&nbsp;<span class="ident" id="6390356">buf</span>&nbsp;<span class="op" id="6390360">[</span><span class="op" id="6390361">]</span><span class="builtintype" id="6390362">byte</span><span class="op" id="6390366">)</span>&nbsp;<span class="op" id="6390368">(</span><span class="builtintype" id="6390369">int</span><span class="op" id="6390372">,</span>&nbsp;<span class="builtintype" id="6390374">error</span><span class="op" id="6390379">)</span>&nbsp;<span class="op" id="6390381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390384">_</span><span class="op" id="6390385">,</span>&nbsp;<span class="ident" id="6390387">err</span>&nbsp;<span class="op" id="6390391">:=</span>&nbsp;<span class="ident" id="6390394">io</span><span class="op" id="6390396">.</span><span class="ident" id="6390397">ReadFull</span><span class="op" id="6390405">(</span><span class="ident" id="6390406">r</span><span class="op" id="6390407">,</span>&nbsp;<span class="ident" id="6390409">buf</span><span class="op" id="6390412">[</span><span class="num" id="6390413">0</span><span class="op" id="6390414">:</span><span class="ident" id="6390415">binary</span><span class="op" id="6390421">.</span><span class="ident" id="6390422">MaxVarintLen64</span><span class="op" id="6390436">]</span><span class="op" id="6390437">)</span>&nbsp;<span class="comment" id="6390439">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390469">x</span><span class="op" id="6390470">,</span>&nbsp;<span class="ident" id="6390472">_</span>&nbsp;<span class="op" id="6390474">:=</span>&nbsp;<span class="ident" id="6390477">binary</span><span class="op" id="6390483">.</span><span class="ident" id="6390484">Varint</span><span class="op" id="6390490">(</span><span class="ident" id="6390491">buf</span><span class="op" id="6390494">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390497">return</span>&nbsp;<span class="builtintype" id="6390504">int</span><span class="op" id="6390507">(</span><span class="ident" id="6390508">x</span><span class="op" id="6390509">)</span><span class="op" id="6390510">,</span>&nbsp;<span class="ident" id="6390512">err</span><br>
<span class="lineno"></span><span class="op" id="6390516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6390519">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="6390569">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="6390605">func</span>&nbsp;<span class="ident" id="6390610">writeSlice</span><span class="op" id="6390620">(</span><span class="ident" id="6390621">w</span>&nbsp;<span class="ident" id="6390623">io</span><span class="op" id="6390625">.</span><span class="ident" id="6390626">Writer</span><span class="op" id="6390632">,</span>&nbsp;<span class="ident" id="6390634">buf</span>&nbsp;<span class="op" id="6390638">[</span><span class="op" id="6390639">]</span><span class="builtintype" id="6390640">byte</span><span class="op" id="6390644">,</span>&nbsp;<span class="ident" id="6390646">data</span>&nbsp;<span class="op" id="6390651">[</span><span class="op" id="6390652">]</span><span class="builtintype" id="6390653">int</span><span class="op" id="6390656">)</span>&nbsp;<span class="op" id="6390658">(</span><span class="ident" id="6390659">n</span>&nbsp;<span class="builtintype" id="6390661">int</span><span class="op" id="6390664">,</span>&nbsp;<span class="ident" id="6390666">err</span>&nbsp;<span class="builtintype" id="6390670">error</span><span class="op" id="6390675">)</span>&nbsp;<span class="op" id="6390677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390680">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390724">p</span>&nbsp;<span class="op" id="6390726">:=</span>&nbsp;<span class="ident" id="6390729">binary</span><span class="op" id="6390735">.</span><span class="ident" id="6390736">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390752">for</span>&nbsp;<span class="op" id="6390756">;</span>&nbsp;<span class="ident" id="6390758">n</span>&nbsp;<span class="op" id="6390760">&lt;</span>&nbsp;<span class="builtinfunc" id="6390762">len</span><span class="op" id="6390765">(</span><span class="ident" id="6390766">data</span><span class="op" id="6390770">)</span>&nbsp;<span class="op" id="6390772">&amp;&amp;</span>&nbsp;<span class="ident" id="6390775">p</span><span class="op" id="6390776">+</span><span class="ident" id="6390777">binary</span><span class="op" id="6390783">.</span><span class="ident" id="6390784">MaxVarintLen64</span>&nbsp;<span class="op" id="6390799">&lt;=</span>&nbsp;<span class="builtinfunc" id="6390802">len</span><span class="op" id="6390805">(</span><span class="ident" id="6390806">buf</span><span class="op" id="6390809">)</span><span class="op" id="6390810">;</span>&nbsp;<span class="ident" id="6390812">n</span><span class="op" id="6390813">++</span>&nbsp;<span class="op" id="6390816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390820">p</span>&nbsp;<span class="op" id="6390822">+=</span>&nbsp;<span class="ident" id="6390825">binary</span><span class="op" id="6390831">.</span><span class="ident" id="6390832">PutUvarint</span><span class="op" id="6390842">(</span><span class="ident" id="6390843">buf</span><span class="op" id="6390846">[</span><span class="ident" id="6390847">p</span><span class="op" id="6390848">:</span><span class="op" id="6390849">]</span><span class="op" id="6390850">,</span>&nbsp;<span class="ident" id="6390852">uint64</span><span class="op" id="6390858">(</span><span class="ident" id="6390859">data</span><span class="op" id="6390863">[</span><span class="ident" id="6390864">n</span><span class="op" id="6390865">]</span><span class="op" id="6390866">)</span><span class="op" id="6390867">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390874">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390897">binary</span><span class="op" id="6390903">.</span><span class="ident" id="6390904">PutVarint</span><span class="op" id="6390913">(</span><span class="ident" id="6390914">buf</span><span class="op" id="6390917">,</span>&nbsp;<span class="ident" id="6390919">int64</span><span class="op" id="6390924">(</span><span class="ident" id="6390925">p</span><span class="op" id="6390926">)</span><span class="op" id="6390927">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390931">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390948">_</span><span class="op" id="6390949">,</span>&nbsp;<span class="ident" id="6390951">err</span>&nbsp;<span class="op" id="6390955">=</span>&nbsp;<span class="ident" id="6390957">w</span><span class="op" id="6390958">.</span><span class="ident" id="6390959">Write</span><span class="op" id="6390964">(</span><span class="ident" id="6390965">buf</span><span class="op" id="6390968">[</span><span class="num" id="6390969">0</span><span class="op" id="6390970">:</span><span class="ident" id="6390971">p</span><span class="op" id="6390972">]</span><span class="op" id="6390973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390976">return</span><br>
<span class="lineno"></span><span class="op" id="6390983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="6390986">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="6391036">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="6391071">func</span>&nbsp;<span class="ident" id="6391076">readSlice</span><span class="op" id="6391085">(</span><span class="ident" id="6391086">r</span>&nbsp;<span class="ident" id="6391088">io</span><span class="op" id="6391090">.</span><span class="ident" id="6391091">Reader</span><span class="op" id="6391097">,</span>&nbsp;<span class="ident" id="6391099">buf</span>&nbsp;<span class="op" id="6391103">[</span><span class="op" id="6391104">]</span><span class="builtintype" id="6391105">byte</span><span class="op" id="6391109">,</span>&nbsp;<span class="ident" id="6391111">data</span>&nbsp;<span class="op" id="6391116">[</span><span class="op" id="6391117">]</span><span class="builtintype" id="6391118">int</span><span class="op" id="6391121">)</span>&nbsp;<span class="op" id="6391123">(</span><span class="ident" id="6391124">n</span>&nbsp;<span class="builtintype" id="6391126">int</span><span class="op" id="6391129">,</span>&nbsp;<span class="ident" id="6391131">err</span>&nbsp;<span class="builtintype" id="6391135">error</span><span class="op" id="6391140">)</span>&nbsp;<span class="op" id="6391142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391145">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391166">var</span>&nbsp;<span class="ident" id="6391170">size</span>&nbsp;<span class="builtintype" id="6391175">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391180">size</span><span class="op" id="6391184">,</span>&nbsp;<span class="ident" id="6391186">err</span>&nbsp;<span class="op" id="6391190">=</span>&nbsp;<span class="ident" id="6391192">readInt</span><span class="op" id="6391199">(</span><span class="ident" id="6391200">r</span><span class="op" id="6391201">,</span>&nbsp;<span class="ident" id="6391203">buf</span><span class="op" id="6391206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391209">if</span>&nbsp;<span class="ident" id="6391212">err</span>&nbsp;<span class="op" id="6391216">!=</span>&nbsp;<span class="ident" id="6391219">nil</span>&nbsp;<span class="op" id="6391223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391227">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391239">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391268">if</span>&nbsp;<span class="ident" id="6391271">_</span><span class="op" id="6391272">,</span>&nbsp;<span class="ident" id="6391274">err</span>&nbsp;<span class="op" id="6391278">=</span>&nbsp;<span class="ident" id="6391280">io</span><span class="op" id="6391282">.</span><span class="ident" id="6391283">ReadFull</span><span class="op" id="6391291">(</span><span class="ident" id="6391292">r</span><span class="op" id="6391293">,</span>&nbsp;<span class="ident" id="6391295">buf</span><span class="op" id="6391298">[</span><span class="ident" id="6391299">binary</span><span class="op" id="6391305">.</span><span class="ident" id="6391306">MaxVarintLen64</span><span class="op" id="6391320">:</span><span class="ident" id="6391321">size</span><span class="op" id="6391325">]</span><span class="op" id="6391326">)</span><span class="op" id="6391327">;</span>&nbsp;<span class="ident" id="6391329">err</span>&nbsp;<span class="op" id="6391333">!=</span>&nbsp;<span class="ident" id="6391336">nil</span>&nbsp;<span class="op" id="6391340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391344">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391356">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391402">for</span>&nbsp;<span class="ident" id="6391406">p</span>&nbsp;<span class="op" id="6391408">:=</span>&nbsp;<span class="ident" id="6391411">binary</span><span class="op" id="6391417">.</span><span class="ident" id="6391418">MaxVarintLen64</span><span class="op" id="6391432">;</span>&nbsp;<span class="ident" id="6391434">p</span>&nbsp;<span class="op" id="6391436">&lt;</span>&nbsp;<span class="ident" id="6391438">size</span><span class="op" id="6391442">;</span>&nbsp;<span class="ident" id="6391444">n</span><span class="op" id="6391445">++</span>&nbsp;<span class="op" id="6391448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391452">x</span><span class="op" id="6391453">,</span>&nbsp;<span class="ident" id="6391455">w</span>&nbsp;<span class="op" id="6391457">:=</span>&nbsp;<span class="ident" id="6391460">binary</span><span class="op" id="6391466">.</span><span class="ident" id="6391467">Uvarint</span><span class="op" id="6391474">(</span><span class="ident" id="6391475">buf</span><span class="op" id="6391478">[</span><span class="ident" id="6391479">p</span><span class="op" id="6391480">:</span><span class="op" id="6391481">]</span><span class="op" id="6391482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391486">data</span><span class="op" id="6391490">[</span><span class="ident" id="6391491">n</span><span class="op" id="6391492">]</span>&nbsp;<span class="op" id="6391494">=</span>&nbsp;<span class="builtintype" id="6391496">int</span><span class="op" id="6391499">(</span><span class="ident" id="6391500">x</span><span class="op" id="6391501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391505">p</span>&nbsp;<span class="op" id="6391507">+=</span>&nbsp;<span class="ident" id="6391510">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391517">return</span><br>
<span class="lineno"></span><span class="op" id="6391524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6391527">const</span>&nbsp;<span class="ident" id="6391533">bufSize</span>&nbsp;<span class="op" id="6391541">=</span>&nbsp;<span class="num" id="6391543">16</span>&nbsp;<span class="op" id="6391546">&lt;&lt;</span>&nbsp;<span class="num" id="6391549">10</span>&nbsp;<span class="comment" id="6391552">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6391592">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="6391650">func</span>&nbsp;<span class="op" id="6391655">(</span><span class="ident" id="6391656">x</span>&nbsp;<span class="op" id="6391658">*</span><span class="ident" id="6391659">Index</span><span class="op" id="6391664">)</span>&nbsp;<span class="ident" id="6391666">Read</span><span class="op" id="6391670">(</span><span class="ident" id="6391671">r</span>&nbsp;<span class="ident" id="6391673">io</span><span class="op" id="6391675">.</span><span class="ident" id="6391676">Reader</span><span class="op" id="6391682">)</span>&nbsp;<span class="builtintype" id="6391684">error</span>&nbsp;<span class="op" id="6391690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391693">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391718">buf</span>&nbsp;<span class="op" id="6391722">:=</span>&nbsp;<span class="builtinfunc" id="6391725">make</span><span class="op" id="6391729">(</span><span class="op" id="6391730">[</span><span class="op" id="6391731">]</span><span class="builtintype" id="6391732">byte</span><span class="op" id="6391736">,</span>&nbsp;<span class="ident" id="6391738">bufSize</span><span class="op" id="6391745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391749">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391765">n</span><span class="op" id="6391766">,</span>&nbsp;<span class="ident" id="6391768">err</span>&nbsp;<span class="op" id="6391772">:=</span>&nbsp;<span class="ident" id="6391775">readInt</span><span class="op" id="6391782">(</span><span class="ident" id="6391783">r</span><span class="op" id="6391784">,</span>&nbsp;<span class="ident" id="6391786">buf</span><span class="op" id="6391789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391792">if</span>&nbsp;<span class="ident" id="6391795">err</span>&nbsp;<span class="op" id="6391799">!=</span>&nbsp;<span class="ident" id="6391802">nil</span>&nbsp;<span class="op" id="6391806">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391810">return</span>&nbsp;<span class="ident" id="6391817">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391826">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391845">if</span>&nbsp;<span class="num" id="6391848">2</span><span class="op" id="6391849">*</span><span class="ident" id="6391850">n</span>&nbsp;<span class="op" id="6391852">&lt;</span>&nbsp;<span class="builtinfunc" id="6391854">cap</span><span class="op" id="6391857">(</span><span class="ident" id="6391858">x</span><span class="op" id="6391859">.</span><span class="ident" id="6391860">data</span><span class="op" id="6391864">)</span>&nbsp;<span class="op" id="6391866">||</span>&nbsp;<span class="builtinfunc" id="6391869">cap</span><span class="op" id="6391872">(</span><span class="ident" id="6391873">x</span><span class="op" id="6391874">.</span><span class="ident" id="6391875">data</span><span class="op" id="6391879">)</span>&nbsp;<span class="op" id="6391881">&lt;</span>&nbsp;<span class="ident" id="6391883">n</span>&nbsp;<span class="op" id="6391885">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391889">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391943">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391985">x</span><span class="op" id="6391986">.</span><span class="ident" id="6391987">data</span>&nbsp;<span class="op" id="6391992">=</span>&nbsp;<span class="builtinfunc" id="6391994">make</span><span class="op" id="6391998">(</span><span class="op" id="6391999">[</span><span class="op" id="6392000">]</span><span class="builtintype" id="6392001">byte</span><span class="op" id="6392005">,</span>&nbsp;<span class="ident" id="6392007">n</span><span class="op" id="6392008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392012">x</span><span class="op" id="6392013">.</span><span class="ident" id="6392014">sa</span>&nbsp;<span class="op" id="6392017">=</span>&nbsp;<span class="builtinfunc" id="6392019">make</span><span class="op" id="6392023">(</span><span class="op" id="6392024">[</span><span class="op" id="6392025">]</span><span class="builtintype" id="6392026">int</span><span class="op" id="6392029">,</span>&nbsp;<span class="ident" id="6392031">n</span><span class="op" id="6392032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392035">}</span>&nbsp;<span class="keyword" id="6392037">else</span>&nbsp;<span class="op" id="6392042">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392046">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392075">x</span><span class="op" id="6392076">.</span><span class="ident" id="6392077">data</span>&nbsp;<span class="op" id="6392082">=</span>&nbsp;<span class="ident" id="6392084">x</span><span class="op" id="6392085">.</span><span class="ident" id="6392086">data</span><span class="op" id="6392090">[</span><span class="num" id="6392091">0</span><span class="op" id="6392092">:</span><span class="ident" id="6392093">n</span><span class="op" id="6392094">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392098">x</span><span class="op" id="6392099">.</span><span class="ident" id="6392100">sa</span>&nbsp;<span class="op" id="6392103">=</span>&nbsp;<span class="ident" id="6392105">x</span><span class="op" id="6392106">.</span><span class="ident" id="6392107">sa</span><span class="op" id="6392109">[</span><span class="num" id="6392110">0</span><span class="op" id="6392111">:</span><span class="ident" id="6392112">n</span><span class="op" id="6392113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392120">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392134">if</span>&nbsp;<span class="ident" id="6392137">_</span><span class="op" id="6392138">,</span>&nbsp;<span class="ident" id="6392140">err</span>&nbsp;<span class="op" id="6392144">:=</span>&nbsp;<span class="ident" id="6392147">io</span><span class="op" id="6392149">.</span><span class="ident" id="6392150">ReadFull</span><span class="op" id="6392158">(</span><span class="ident" id="6392159">r</span><span class="op" id="6392160">,</span>&nbsp;<span class="ident" id="6392162">x</span><span class="op" id="6392163">.</span><span class="ident" id="6392164">data</span><span class="op" id="6392168">)</span><span class="op" id="6392169">;</span>&nbsp;<span class="ident" id="6392171">err</span>&nbsp;<span class="op" id="6392175">!=</span>&nbsp;<span class="ident" id="6392178">nil</span>&nbsp;<span class="op" id="6392182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392186">return</span>&nbsp;<span class="ident" id="6392193">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392202">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392217">for</span>&nbsp;<span class="ident" id="6392221">sa</span>&nbsp;<span class="op" id="6392224">:=</span>&nbsp;<span class="ident" id="6392227">x</span><span class="op" id="6392228">.</span><span class="ident" id="6392229">sa</span><span class="op" id="6392231">;</span>&nbsp;<span class="builtinfunc" id="6392233">len</span><span class="op" id="6392236">(</span><span class="ident" id="6392237">sa</span><span class="op" id="6392239">)</span>&nbsp;<span class="op" id="6392241">&gt;</span>&nbsp;<span class="num" id="6392243">0</span><span class="op" id="6392244">;</span>&nbsp;<span class="op" id="6392246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392250">n</span><span class="op" id="6392251">,</span>&nbsp;<span class="ident" id="6392253">err</span>&nbsp;<span class="op" id="6392257">:=</span>&nbsp;<span class="ident" id="6392260">readSlice</span><span class="op" id="6392269">(</span><span class="ident" id="6392270">r</span><span class="op" id="6392271">,</span>&nbsp;<span class="ident" id="6392273">buf</span><span class="op" id="6392276">,</span>&nbsp;<span class="ident" id="6392278">sa</span><span class="op" id="6392280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392284">if</span>&nbsp;<span class="ident" id="6392287">err</span>&nbsp;<span class="op" id="6392291">!=</span>&nbsp;<span class="ident" id="6392294">nil</span>&nbsp;<span class="op" id="6392298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392303">return</span>&nbsp;<span class="ident" id="6392310">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392320">sa</span>&nbsp;<span class="op" id="6392323">=</span>&nbsp;<span class="ident" id="6392325">sa</span><span class="op" id="6392327">[</span><span class="ident" id="6392328">n</span><span class="op" id="6392329">:</span><span class="op" id="6392330">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392336">return</span>&nbsp;<span class="ident" id="6392343">nil</span><br>
<span class="lineno"></span><span class="op" id="6392347">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="6392350">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6392384">func</span>&nbsp;<span class="op" id="6392389">(</span><span class="ident" id="6392390">x</span>&nbsp;<span class="op" id="6392392">*</span><span class="ident" id="6392393">Index</span><span class="op" id="6392398">)</span>&nbsp;<span class="ident" id="6392400">Write</span><span class="op" id="6392405">(</span><span class="ident" id="6392406">w</span>&nbsp;<span class="ident" id="6392408">io</span><span class="op" id="6392410">.</span><span class="ident" id="6392411">Writer</span><span class="op" id="6392417">)</span>&nbsp;<span class="builtintype" id="6392419">error</span>&nbsp;<span class="op" id="6392425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392428">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392454">buf</span>&nbsp;<span class="op" id="6392458">:=</span>&nbsp;<span class="builtinfunc" id="6392461">make</span><span class="op" id="6392465">(</span><span class="op" id="6392466">[</span><span class="op" id="6392467">]</span><span class="builtintype" id="6392468">byte</span><span class="op" id="6392472">,</span>&nbsp;<span class="ident" id="6392474">bufSize</span><span class="op" id="6392481">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392485">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392502">if</span>&nbsp;<span class="ident" id="6392505">err</span>&nbsp;<span class="op" id="6392509">:=</span>&nbsp;<span class="ident" id="6392512">writeInt</span><span class="op" id="6392520">(</span><span class="ident" id="6392521">w</span><span class="op" id="6392522">,</span>&nbsp;<span class="ident" id="6392524">buf</span><span class="op" id="6392527">,</span>&nbsp;<span class="builtinfunc" id="6392529">len</span><span class="op" id="6392532">(</span><span class="ident" id="6392533">x</span><span class="op" id="6392534">.</span><span class="ident" id="6392535">data</span><span class="op" id="6392539">)</span><span class="op" id="6392540">)</span><span class="op" id="6392541">;</span>&nbsp;<span class="ident" id="6392543">err</span>&nbsp;<span class="op" id="6392547">!=</span>&nbsp;<span class="ident" id="6392550">nil</span>&nbsp;<span class="op" id="6392554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392558">return</span>&nbsp;<span class="ident" id="6392565">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392570">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392574">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392589">if</span>&nbsp;<span class="ident" id="6392592">_</span><span class="op" id="6392593">,</span>&nbsp;<span class="ident" id="6392595">err</span>&nbsp;<span class="op" id="6392599">:=</span>&nbsp;<span class="ident" id="6392602">w</span><span class="op" id="6392603">.</span><span class="ident" id="6392604">Write</span><span class="op" id="6392609">(</span><span class="ident" id="6392610">x</span><span class="op" id="6392611">.</span><span class="ident" id="6392612">data</span><span class="op" id="6392616">)</span><span class="op" id="6392617">;</span>&nbsp;<span class="ident" id="6392619">err</span>&nbsp;<span class="op" id="6392623">!=</span>&nbsp;<span class="ident" id="6392626">nil</span>&nbsp;<span class="op" id="6392630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392634">return</span>&nbsp;<span class="ident" id="6392641">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392646">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392650">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392666">for</span>&nbsp;<span class="ident" id="6392670">sa</span>&nbsp;<span class="op" id="6392673">:=</span>&nbsp;<span class="ident" id="6392676">x</span><span class="op" id="6392677">.</span><span class="ident" id="6392678">sa</span><span class="op" id="6392680">;</span>&nbsp;<span class="builtinfunc" id="6392682">len</span><span class="op" id="6392685">(</span><span class="ident" id="6392686">sa</span><span class="op" id="6392688">)</span>&nbsp;<span class="op" id="6392690">&gt;</span>&nbsp;<span class="num" id="6392692">0</span><span class="op" id="6392693">;</span>&nbsp;<span class="op" id="6392695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392699">n</span><span class="op" id="6392700">,</span>&nbsp;<span class="ident" id="6392702">err</span>&nbsp;<span class="op" id="6392706">:=</span>&nbsp;<span class="ident" id="6392709">writeSlice</span><span class="op" id="6392719">(</span><span class="ident" id="6392720">w</span><span class="op" id="6392721">,</span>&nbsp;<span class="ident" id="6392723">buf</span><span class="op" id="6392726">,</span>&nbsp;<span class="ident" id="6392728">sa</span><span class="op" id="6392730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392734">if</span>&nbsp;<span class="ident" id="6392737">err</span>&nbsp;<span class="op" id="6392741">!=</span>&nbsp;<span class="ident" id="6392744">nil</span>&nbsp;<span class="op" id="6392748">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392753">return</span>&nbsp;<span class="ident" id="6392760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392770">sa</span>&nbsp;<span class="op" id="6392773">=</span>&nbsp;<span class="ident" id="6392775">sa</span><span class="op" id="6392777">[</span><span class="ident" id="6392778">n</span><span class="op" id="6392779">:</span><span class="op" id="6392780">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392786">return</span>&nbsp;<span class="ident" id="6392793">nil</span><br>
<span class="lineno">160</span><span class="op" id="6392797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6392800">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="6392860">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="6392888">//</span><br>
<span class="lineno">165</span><span class="keyword" id="6392891">func</span>&nbsp;<span class="op" id="6392896">(</span><span class="ident" id="6392897">x</span>&nbsp;<span class="op" id="6392899">*</span><span class="ident" id="6392900">Index</span><span class="op" id="6392905">)</span>&nbsp;<span class="ident" id="6392907">Bytes</span><span class="op" id="6392912">(</span><span class="op" id="6392913">)</span>&nbsp;<span class="op" id="6392915">[</span><span class="op" id="6392916">]</span><span class="builtintype" id="6392917">byte</span>&nbsp;<span class="op" id="6392922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392925">return</span>&nbsp;<span class="ident" id="6392932">x</span><span class="op" id="6392933">.</span><span class="ident" id="6392934">data</span><br>
<span class="lineno"></span><span class="op" id="6392939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6392942">func</span>&nbsp;<span class="op" id="6392947">(</span><span class="ident" id="6392948">x</span>&nbsp;<span class="op" id="6392950">*</span><span class="ident" id="6392951">Index</span><span class="op" id="6392956">)</span>&nbsp;<span class="ident" id="6392958">at</span><span class="op" id="6392960">(</span><span class="ident" id="6392961">i</span>&nbsp;<span class="builtintype" id="6392963">int</span><span class="op" id="6392966">)</span>&nbsp;<span class="op" id="6392968">[</span><span class="op" id="6392969">]</span><span class="builtintype" id="6392970">byte</span>&nbsp;<span class="op" id="6392975">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392978">return</span>&nbsp;<span class="ident" id="6392985">x</span><span class="op" id="6392986">.</span><span class="ident" id="6392987">data</span><span class="op" id="6392991">[</span><span class="ident" id="6392992">x</span><span class="op" id="6392993">.</span><span class="ident" id="6392994">sa</span><span class="op" id="6392996">[</span><span class="ident" id="6392997">i</span><span class="op" id="6392998">]</span><span class="op" id="6392999">:</span><span class="op" id="6393000">]</span><br>
<span class="lineno"></span><span class="op" id="6393002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6393005">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="6393073">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="6393109">func</span>&nbsp;<span class="op" id="6393114">(</span><span class="ident" id="6393115">x</span>&nbsp;<span class="op" id="6393117">*</span><span class="ident" id="6393118">Index</span><span class="op" id="6393123">)</span>&nbsp;<span class="ident" id="6393125">lookupAll</span><span class="op" id="6393134">(</span><span class="ident" id="6393135">s</span>&nbsp;<span class="op" id="6393137">[</span><span class="op" id="6393138">]</span><span class="builtintype" id="6393139">byte</span><span class="op" id="6393143">)</span>&nbsp;<span class="op" id="6393145">[</span><span class="op" id="6393146">]</span><span class="builtintype" id="6393147">int</span>&nbsp;<span class="op" id="6393151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393154">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393197">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393250">i</span>&nbsp;<span class="op" id="6393252">:=</span>&nbsp;<span class="ident" id="6393255">sort</span><span class="op" id="6393259">.</span><span class="ident" id="6393260">Search</span><span class="op" id="6393266">(</span><span class="builtinfunc" id="6393267">len</span><span class="op" id="6393270">(</span><span class="ident" id="6393271">x</span><span class="op" id="6393272">.</span><span class="ident" id="6393273">sa</span><span class="op" id="6393275">)</span><span class="op" id="6393276">,</span>&nbsp;<span class="keyword" id="6393278">func</span><span class="op" id="6393282">(</span><span class="ident" id="6393283">i</span>&nbsp;<span class="builtintype" id="6393285">int</span><span class="op" id="6393288">)</span>&nbsp;<span class="builtintype" id="6393290">bool</span>&nbsp;<span class="op" id="6393295">{</span>&nbsp;<span class="keyword" id="6393297">return</span>&nbsp;<span class="ident" id="6393304">bytes</span><span class="op" id="6393309">.</span><span class="ident" id="6393310">Compare</span><span class="op" id="6393317">(</span><span class="ident" id="6393318">x</span><span class="op" id="6393319">.</span><span class="ident" id="6393320">at</span><span class="op" id="6393322">(</span><span class="ident" id="6393323">i</span><span class="op" id="6393324">)</span><span class="op" id="6393325">,</span>&nbsp;<span class="ident" id="6393327">s</span><span class="op" id="6393328">)</span>&nbsp;<span class="op" id="6393330">&gt;=</span>&nbsp;<span class="num" id="6393333">0</span>&nbsp;<span class="op" id="6393335">}</span><span class="op" id="6393336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393339">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393406">j</span>&nbsp;<span class="op" id="6393408">:=</span>&nbsp;<span class="ident" id="6393411">i</span>&nbsp;<span class="op" id="6393413">+</span>&nbsp;<span class="ident" id="6393415">sort</span><span class="op" id="6393419">.</span><span class="ident" id="6393420">Search</span><span class="op" id="6393426">(</span><span class="builtinfunc" id="6393427">len</span><span class="op" id="6393430">(</span><span class="ident" id="6393431">x</span><span class="op" id="6393432">.</span><span class="ident" id="6393433">sa</span><span class="op" id="6393435">)</span><span class="op" id="6393436">-</span><span class="ident" id="6393437">i</span><span class="op" id="6393438">,</span>&nbsp;<span class="keyword" id="6393440">func</span><span class="op" id="6393444">(</span><span class="ident" id="6393445">j</span>&nbsp;<span class="builtintype" id="6393447">int</span><span class="op" id="6393450">)</span>&nbsp;<span class="builtintype" id="6393452">bool</span>&nbsp;<span class="op" id="6393457">{</span>&nbsp;<span class="keyword" id="6393459">return</span>&nbsp;<span class="op" id="6393466">!</span><span class="ident" id="6393467">bytes</span><span class="op" id="6393472">.</span><span class="ident" id="6393473">HasPrefix</span><span class="op" id="6393482">(</span><span class="ident" id="6393483">x</span><span class="op" id="6393484">.</span><span class="ident" id="6393485">at</span><span class="op" id="6393487">(</span><span class="ident" id="6393488">j</span><span class="op" id="6393489">+</span><span class="ident" id="6393490">i</span><span class="op" id="6393491">)</span><span class="op" id="6393492">,</span>&nbsp;<span class="ident" id="6393494">s</span><span class="op" id="6393495">)</span>&nbsp;<span class="op" id="6393497">}</span><span class="op" id="6393498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393501">return</span>&nbsp;<span class="ident" id="6393508">x</span><span class="op" id="6393509">.</span><span class="ident" id="6393510">sa</span><span class="op" id="6393512">[</span><span class="ident" id="6393513">i</span><span class="op" id="6393514">:</span><span class="ident" id="6393515">j</span><span class="op" id="6393516">]</span><br>
<span class="lineno"></span><span class="op" id="6393518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6393521">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="6393601">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="6393672">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="6393735">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6393799">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6393828">//</span><br>
<span class="lineno">190</span><span class="keyword" id="6393831">func</span>&nbsp;<span class="op" id="6393836">(</span><span class="ident" id="6393837">x</span>&nbsp;<span class="op" id="6393839">*</span><span class="ident" id="6393840">Index</span><span class="op" id="6393845">)</span>&nbsp;<span class="ident" id="6393847">Lookup</span><span class="op" id="6393853">(</span><span class="ident" id="6393854">s</span>&nbsp;<span class="op" id="6393856">[</span><span class="op" id="6393857">]</span><span class="builtintype" id="6393858">byte</span><span class="op" id="6393862">,</span>&nbsp;<span class="ident" id="6393864">n</span>&nbsp;<span class="builtintype" id="6393866">int</span><span class="op" id="6393869">)</span>&nbsp;<span class="op" id="6393871">(</span><span class="ident" id="6393872">result</span>&nbsp;<span class="op" id="6393879">[</span><span class="op" id="6393880">]</span><span class="builtintype" id="6393881">int</span><span class="op" id="6393884">)</span>&nbsp;<span class="op" id="6393886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393889">if</span>&nbsp;<span class="builtinfunc" id="6393892">len</span><span class="op" id="6393895">(</span><span class="ident" id="6393896">s</span><span class="op" id="6393897">)</span>&nbsp;<span class="op" id="6393899">&gt;</span>&nbsp;<span class="num" id="6393901">0</span>&nbsp;<span class="op" id="6393903">&amp;&amp;</span>&nbsp;<span class="ident" id="6393906">n</span>&nbsp;<span class="op" id="6393908">!=</span>&nbsp;<span class="num" id="6393911">0</span>&nbsp;<span class="op" id="6393913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393917">matches</span>&nbsp;<span class="op" id="6393925">:=</span>&nbsp;<span class="ident" id="6393928">x</span><span class="op" id="6393929">.</span><span class="ident" id="6393930">lookupAll</span><span class="op" id="6393939">(</span><span class="ident" id="6393940">s</span><span class="op" id="6393941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393945">if</span>&nbsp;<span class="ident" id="6393948">n</span>&nbsp;<span class="op" id="6393950">&lt;</span>&nbsp;<span class="num" id="6393952">0</span>&nbsp;<span class="op" id="6393954">||</span>&nbsp;<span class="builtinfunc" id="6393957">len</span><span class="op" id="6393960">(</span><span class="ident" id="6393961">matches</span><span class="op" id="6393968">)</span>&nbsp;<span class="op" id="6393970">&lt;</span>&nbsp;<span class="ident" id="6393972">n</span>&nbsp;<span class="op" id="6393974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393979">n</span>&nbsp;<span class="op" id="6393981">=</span>&nbsp;<span class="builtinfunc" id="6393983">len</span><span class="op" id="6393986">(</span><span class="ident" id="6393987">matches</span><span class="op" id="6393994">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394002">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394030">if</span>&nbsp;<span class="ident" id="6394033">n</span>&nbsp;<span class="op" id="6394035">&gt;</span>&nbsp;<span class="num" id="6394037">0</span>&nbsp;<span class="op" id="6394039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394044">result</span>&nbsp;<span class="op" id="6394051">=</span>&nbsp;<span class="builtinfunc" id="6394053">make</span><span class="op" id="6394057">(</span><span class="op" id="6394058">[</span><span class="op" id="6394059">]</span><span class="builtintype" id="6394060">int</span><span class="op" id="6394063">,</span>&nbsp;<span class="ident" id="6394065">n</span><span class="op" id="6394066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6394071">copy</span><span class="op" id="6394075">(</span><span class="ident" id="6394076">result</span><span class="op" id="6394082">,</span>&nbsp;<span class="ident" id="6394084">matches</span><span class="op" id="6394091">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394101">return</span><br>
<span class="lineno"></span><span class="op" id="6394108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="6394111">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6394183">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="6394254">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6394324">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6394394">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="6394468">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="6394485">//</span><br>
<span class="lineno"></span><span class="keyword" id="6394488">func</span>&nbsp;<span class="op" id="6394493">(</span><span class="ident" id="6394494">x</span>&nbsp;<span class="op" id="6394496">*</span><span class="ident" id="6394497">Index</span><span class="op" id="6394502">)</span>&nbsp;<span class="ident" id="6394504">FindAllIndex</span><span class="op" id="6394516">(</span><span class="ident" id="6394517">r</span>&nbsp;<span class="op" id="6394519">*</span><span class="ident" id="6394520">regexp</span><span class="op" id="6394526">.</span><span class="ident" id="6394527">Regexp</span><span class="op" id="6394533">,</span>&nbsp;<span class="ident" id="6394535">n</span>&nbsp;<span class="builtintype" id="6394537">int</span><span class="op" id="6394540">)</span>&nbsp;<span class="op" id="6394542">(</span><span class="ident" id="6394543">result</span>&nbsp;<span class="op" id="6394550">[</span><span class="op" id="6394551">]</span><span class="op" id="6394552">[</span><span class="op" id="6394553">]</span><span class="builtintype" id="6394554">int</span><span class="op" id="6394557">)</span>&nbsp;<span class="op" id="6394559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394562">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394623">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394659">prefix</span><span class="op" id="6394665">,</span>&nbsp;<span class="ident" id="6394667">complete</span>&nbsp;<span class="op" id="6394676">:=</span>&nbsp;<span class="ident" id="6394679">r</span><span class="op" id="6394680">.</span><span class="ident" id="6394681">LiteralPrefix</span><span class="op" id="6394694">(</span><span class="op" id="6394695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394698">lit</span>&nbsp;<span class="op" id="6394702">:=</span>&nbsp;<span class="op" id="6394705">[</span><span class="op" id="6394706">]</span><span class="builtintype" id="6394707">byte</span><span class="op" id="6394711">(</span><span class="ident" id="6394712">prefix</span><span class="op" id="6394718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394722">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394765">if</span>&nbsp;<span class="ident" id="6394768">prefix</span>&nbsp;<span class="op" id="6394775">==</span>&nbsp;<span class="string" id="6394778">&#34;&#34;</span>&nbsp;<span class="op" id="6394781">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394785">return</span>&nbsp;<span class="ident" id="6394792">r</span><span class="op" id="6394793">.</span><span class="ident" id="6394794">FindAllIndex</span><span class="op" id="6394806">(</span><span class="ident" id="6394807">x</span><span class="op" id="6394808">.</span><span class="ident" id="6394809">data</span><span class="op" id="6394813">,</span>&nbsp;<span class="ident" id="6394815">n</span><span class="op" id="6394816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394823">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394882">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394910">if</span>&nbsp;<span class="ident" id="6394913">complete</span>&nbsp;<span class="op" id="6394922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394926">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394994">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395064">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395129">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395200">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395269">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395297">for</span>&nbsp;<span class="ident" id="6395301">n1</span>&nbsp;<span class="op" id="6395304">:=</span>&nbsp;<span class="ident" id="6395307">n</span><span class="op" id="6395308">;</span>&nbsp;<span class="op" id="6395310">;</span>&nbsp;<span class="ident" id="6395312">n1</span>&nbsp;<span class="op" id="6395315">+=</span>&nbsp;<span class="num" id="6395318">2</span>&nbsp;<span class="op" id="6395320">*</span>&nbsp;<span class="op" id="6395322">(</span><span class="ident" id="6395323">n</span>&nbsp;<span class="op" id="6395325">-</span>&nbsp;<span class="builtinfunc" id="6395327">len</span><span class="op" id="6395330">(</span><span class="ident" id="6395331">result</span><span class="op" id="6395337">)</span><span class="op" id="6395338">)</span>&nbsp;<span class="comment" id="6395340">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="6395358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395363">indices</span>&nbsp;<span class="op" id="6395371">:=</span>&nbsp;<span class="ident" id="6395374">x</span><span class="op" id="6395375">.</span><span class="ident" id="6395376">Lookup</span><span class="op" id="6395382">(</span><span class="ident" id="6395383">lit</span><span class="op" id="6395386">,</span>&nbsp;<span class="ident" id="6395388">n1</span><span class="op" id="6395390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395395">if</span>&nbsp;<span class="builtinfunc" id="6395398">len</span><span class="op" id="6395401">(</span><span class="ident" id="6395402">indices</span><span class="op" id="6395409">)</span>&nbsp;<span class="op" id="6395411">==</span>&nbsp;<span class="num" id="6395414">0</span>&nbsp;<span class="op" id="6395416">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395422">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395437">sort</span><span class="op" id="6395441">.</span><span class="ident" id="6395442">Ints</span><span class="op" id="6395446">(</span><span class="ident" id="6395447">indices</span><span class="op" id="6395454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395459">pairs</span>&nbsp;<span class="op" id="6395465">:=</span>&nbsp;<span class="builtinfunc" id="6395468">make</span><span class="op" id="6395472">(</span><span class="op" id="6395473">[</span><span class="op" id="6395474">]</span><span class="builtintype" id="6395475">int</span><span class="op" id="6395478">,</span>&nbsp;<span class="num" id="6395480">2</span><span class="op" id="6395481">*</span><span class="builtinfunc" id="6395482">len</span><span class="op" id="6395485">(</span><span class="ident" id="6395486">indices</span><span class="op" id="6395493">)</span><span class="op" id="6395494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395499">result</span>&nbsp;<span class="op" id="6395506">=</span>&nbsp;<span class="builtinfunc" id="6395508">make</span><span class="op" id="6395512">(</span><span class="op" id="6395513">[</span><span class="op" id="6395514">]</span><span class="op" id="6395515">[</span><span class="op" id="6395516">]</span><span class="builtintype" id="6395517">int</span><span class="op" id="6395520">,</span>&nbsp;<span class="builtinfunc" id="6395522">len</span><span class="op" id="6395525">(</span><span class="ident" id="6395526">indices</span><span class="op" id="6395533">)</span><span class="op" id="6395534">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395539">count</span>&nbsp;<span class="op" id="6395545">:=</span>&nbsp;<span class="num" id="6395548">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395553">prev</span>&nbsp;<span class="op" id="6395558">:=</span>&nbsp;<span class="num" id="6395561">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395566">for</span>&nbsp;<span class="ident" id="6395570">_</span><span class="op" id="6395571">,</span>&nbsp;<span class="ident" id="6395573">i</span>&nbsp;<span class="op" id="6395575">:=</span>&nbsp;<span class="keyword" id="6395578">range</span>&nbsp;<span class="ident" id="6395584">indices</span>&nbsp;<span class="op" id="6395592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395598">if</span>&nbsp;<span class="ident" id="6395601">count</span>&nbsp;<span class="op" id="6395607">==</span>&nbsp;<span class="ident" id="6395610">n</span>&nbsp;<span class="op" id="6395612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395619">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395635">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395688">if</span>&nbsp;<span class="ident" id="6395691">prev</span>&nbsp;<span class="op" id="6395696">&lt;=</span>&nbsp;<span class="ident" id="6395699">i</span>&nbsp;<span class="op" id="6395701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395708">j</span>&nbsp;<span class="op" id="6395710">:=</span>&nbsp;<span class="num" id="6395713">2</span>&nbsp;<span class="op" id="6395715">*</span>&nbsp;<span class="ident" id="6395717">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395728">pairs</span><span class="op" id="6395733">[</span><span class="ident" id="6395734">j</span><span class="op" id="6395735">+</span><span class="num" id="6395736">0</span><span class="op" id="6395737">]</span>&nbsp;<span class="op" id="6395739">=</span>&nbsp;<span class="ident" id="6395741">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395748">pairs</span><span class="op" id="6395753">[</span><span class="ident" id="6395754">j</span><span class="op" id="6395755">+</span><span class="num" id="6395756">1</span><span class="op" id="6395757">]</span>&nbsp;<span class="op" id="6395759">=</span>&nbsp;<span class="ident" id="6395761">i</span>&nbsp;<span class="op" id="6395763">+</span>&nbsp;<span class="builtinfunc" id="6395765">len</span><span class="op" id="6395768">(</span><span class="ident" id="6395769">lit</span><span class="op" id="6395772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395779">result</span><span class="op" id="6395785">[</span><span class="ident" id="6395786">count</span><span class="op" id="6395791">]</span>&nbsp;<span class="op" id="6395793">=</span>&nbsp;<span class="ident" id="6395795">pairs</span><span class="op" id="6395800">[</span><span class="ident" id="6395801">j</span>&nbsp;<span class="op" id="6395803">:</span>&nbsp;<span class="ident" id="6395805">j</span><span class="op" id="6395806">+</span><span class="num" id="6395807">2</span><span class="op" id="6395808">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395815">count</span><span class="op" id="6395820">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395828">prev</span>&nbsp;<span class="op" id="6395833">=</span>&nbsp;<span class="ident" id="6395835">i</span>&nbsp;<span class="op" id="6395837">+</span>&nbsp;<span class="builtinfunc" id="6395839">len</span><span class="op" id="6395842">(</span><span class="ident" id="6395843">lit</span><span class="op" id="6395846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395852">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395862">result</span>&nbsp;<span class="op" id="6395869">=</span>&nbsp;<span class="ident" id="6395871">result</span><span class="op" id="6395877">[</span><span class="num" id="6395878">0</span><span class="op" id="6395879">:</span><span class="ident" id="6395880">count</span><span class="op" id="6395885">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395890">if</span>&nbsp;<span class="builtinfunc" id="6395893">len</span><span class="op" id="6395896">(</span><span class="ident" id="6395897">result</span><span class="op" id="6395903">)</span>&nbsp;<span class="op" id="6395905">&gt;=</span>&nbsp;<span class="ident" id="6395908">n</span>&nbsp;<span class="op" id="6395910">||</span>&nbsp;<span class="builtinfunc" id="6395913">len</span><span class="op" id="6395916">(</span><span class="ident" id="6395917">indices</span><span class="op" id="6395924">)</span>&nbsp;<span class="op" id="6395926">!=</span>&nbsp;<span class="ident" id="6395929">n1</span>&nbsp;<span class="op" id="6395932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395938">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395997">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396031">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396048">if</span>&nbsp;<span class="builtinfunc" id="6396051">len</span><span class="op" id="6396054">(</span><span class="ident" id="6396055">result</span><span class="op" id="6396061">)</span>&nbsp;<span class="op" id="6396063">==</span>&nbsp;<span class="num" id="6396066">0</span>&nbsp;<span class="op" id="6396068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396073">result</span>&nbsp;<span class="op" id="6396080">=</span>&nbsp;<span class="ident" id="6396082">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396092">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396104">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396168">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396236">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396269">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396336">r</span>&nbsp;<span class="op" id="6396338">=</span>&nbsp;<span class="ident" id="6396340">regexp</span><span class="op" id="6396346">.</span><span class="ident" id="6396347">MustCompile</span><span class="op" id="6396358">(</span><span class="string" id="6396359">&#34;^&#34;</span>&nbsp;<span class="op" id="6396363">+</span>&nbsp;<span class="ident" id="6396365">r</span><span class="op" id="6396366">.</span><span class="ident" id="6396367">String</span><span class="op" id="6396373">(</span><span class="op" id="6396374">)</span><span class="op" id="6396375">)</span>&nbsp;<span class="comment" id="6396377">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396410">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396474">for</span>&nbsp;<span class="ident" id="6396478">n1</span>&nbsp;<span class="op" id="6396481">:=</span>&nbsp;<span class="ident" id="6396484">n</span><span class="op" id="6396485">;</span>&nbsp;<span class="op" id="6396487">;</span>&nbsp;<span class="ident" id="6396489">n1</span>&nbsp;<span class="op" id="6396492">+=</span>&nbsp;<span class="num" id="6396495">2</span>&nbsp;<span class="op" id="6396497">*</span>&nbsp;<span class="op" id="6396499">(</span><span class="ident" id="6396500">n</span>&nbsp;<span class="op" id="6396502">-</span>&nbsp;<span class="builtinfunc" id="6396504">len</span><span class="op" id="6396507">(</span><span class="ident" id="6396508">result</span><span class="op" id="6396514">)</span><span class="op" id="6396515">)</span>&nbsp;<span class="comment" id="6396517">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="6396535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396539">indices</span>&nbsp;<span class="op" id="6396547">:=</span>&nbsp;<span class="ident" id="6396550">x</span><span class="op" id="6396551">.</span><span class="ident" id="6396552">Lookup</span><span class="op" id="6396558">(</span><span class="ident" id="6396559">lit</span><span class="op" id="6396562">,</span>&nbsp;<span class="ident" id="6396564">n1</span><span class="op" id="6396566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396570">if</span>&nbsp;<span class="builtinfunc" id="6396573">len</span><span class="op" id="6396576">(</span><span class="ident" id="6396577">indices</span><span class="op" id="6396584">)</span>&nbsp;<span class="op" id="6396586">==</span>&nbsp;<span class="num" id="6396589">0</span>&nbsp;<span class="op" id="6396591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396596">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396609">sort</span><span class="op" id="6396613">.</span><span class="ident" id="6396614">Ints</span><span class="op" id="6396618">(</span><span class="ident" id="6396619">indices</span><span class="op" id="6396626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396630">result</span>&nbsp;<span class="op" id="6396637">=</span>&nbsp;<span class="ident" id="6396639">result</span><span class="op" id="6396645">[</span><span class="num" id="6396646">0</span><span class="op" id="6396647">:</span><span class="num" id="6396648">0</span><span class="op" id="6396649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396653">prev</span>&nbsp;<span class="op" id="6396658">:=</span>&nbsp;<span class="num" id="6396661">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396665">for</span>&nbsp;<span class="ident" id="6396669">_</span><span class="op" id="6396670">,</span>&nbsp;<span class="ident" id="6396672">i</span>&nbsp;<span class="op" id="6396674">:=</span>&nbsp;<span class="keyword" id="6396677">range</span>&nbsp;<span class="ident" id="6396683">indices</span>&nbsp;<span class="op" id="6396691">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396696">if</span>&nbsp;<span class="builtinfunc" id="6396699">len</span><span class="op" id="6396702">(</span><span class="ident" id="6396703">result</span><span class="op" id="6396709">)</span>&nbsp;<span class="op" id="6396711">==</span>&nbsp;<span class="ident" id="6396714">n</span>&nbsp;<span class="op" id="6396716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396722">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396736">m</span>&nbsp;<span class="op" id="6396738">:=</span>&nbsp;<span class="ident" id="6396741">r</span><span class="op" id="6396742">.</span><span class="ident" id="6396743">FindIndex</span><span class="op" id="6396752">(</span><span class="ident" id="6396753">x</span><span class="op" id="6396754">.</span><span class="ident" id="6396755">data</span><span class="op" id="6396759">[</span><span class="ident" id="6396760">i</span><span class="op" id="6396761">:</span><span class="op" id="6396762">]</span><span class="op" id="6396763">)</span>&nbsp;<span class="comment" id="6396765">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6396806">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396858">if</span>&nbsp;<span class="ident" id="6396861">m</span>&nbsp;<span class="op" id="6396863">!=</span>&nbsp;<span class="ident" id="6396866">nil</span>&nbsp;<span class="op" id="6396870">&amp;&amp;</span>&nbsp;<span class="ident" id="6396873">prev</span>&nbsp;<span class="op" id="6396878">&lt;=</span>&nbsp;<span class="ident" id="6396881">i</span>&nbsp;<span class="op" id="6396883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396889">m</span><span class="op" id="6396890">[</span><span class="num" id="6396891">0</span><span class="op" id="6396892">]</span>&nbsp;<span class="op" id="6396894">=</span>&nbsp;<span class="ident" id="6396896">i</span>&nbsp;<span class="comment" id="6396898">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396915">m</span><span class="op" id="6396916">[</span><span class="num" id="6396917">1</span><span class="op" id="6396918">]</span>&nbsp;<span class="op" id="6396920">+=</span>&nbsp;<span class="ident" id="6396923">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396929">result</span>&nbsp;<span class="op" id="6396936">=</span>&nbsp;<span class="builtinfunc" id="6396938">append</span><span class="op" id="6396944">(</span><span class="ident" id="6396945">result</span><span class="op" id="6396951">,</span>&nbsp;<span class="ident" id="6396953">m</span><span class="op" id="6396954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396960">prev</span>&nbsp;<span class="op" id="6396965">=</span>&nbsp;<span class="ident" id="6396967">m</span><span class="op" id="6396968">[</span><span class="num" id="6396969">1</span><span class="op" id="6396970">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396983">if</span>&nbsp;<span class="builtinfunc" id="6396986">len</span><span class="op" id="6396989">(</span><span class="ident" id="6396990">result</span><span class="op" id="6396996">)</span>&nbsp;<span class="op" id="6396998">&gt;=</span>&nbsp;<span class="ident" id="6397001">n</span>&nbsp;<span class="op" id="6397003">||</span>&nbsp;<span class="builtinfunc" id="6397006">len</span><span class="op" id="6397009">(</span><span class="ident" id="6397010">indices</span><span class="op" id="6397017">)</span>&nbsp;<span class="op" id="6397019">!=</span>&nbsp;<span class="ident" id="6397022">n1</span>&nbsp;<span class="op" id="6397025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397030">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397088">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397121">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397135">if</span>&nbsp;<span class="builtinfunc" id="6397138">len</span><span class="op" id="6397141">(</span><span class="ident" id="6397142">result</span><span class="op" id="6397148">)</span>&nbsp;<span class="op" id="6397150">==</span>&nbsp;<span class="num" id="6397153">0</span>&nbsp;<span class="op" id="6397155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397159">result</span>&nbsp;<span class="op" id="6397166">=</span>&nbsp;<span class="ident" id="6397168">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397176">return</span><br>
<span class="lineno"></span><span class="op" id="6397183">}</span>
</div>
</body>
</html>
