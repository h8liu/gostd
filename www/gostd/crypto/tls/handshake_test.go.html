<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html" class="current">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6545480">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6545535">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6545589">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6545640">package</span>&nbsp;<span class="ident" id="6545648">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6545653">import</span>&nbsp;<span class="op" id="6545660">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6545663">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6545672">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6545688">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6545698">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6545706">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6545713">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6545719">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6545732">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6545739">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6545750">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6545761">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6545768">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6545771">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6545846">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="6545923">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6546002">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="6546061">//</span><br>
<span class="lineno"></span><span class="comment" id="6546064">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6546138">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6546216">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="6546292">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="6546359">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="6546378">//</span><br>
<span class="lineno"></span><span class="comment" id="6546381">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="6546460">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="6546540">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="6546618">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="6546697">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6546716">var</span>&nbsp;<span class="ident" id="6546720">update</span>&nbsp;<span class="op" id="6546727">=</span>&nbsp;<span class="ident" id="6546729">flag</span><span class="op" id="6546733">.</span><span class="ident" id="6546734">Bool</span><span class="op" id="6546738">(</span><span class="string" id="6546739">&#34;update&#34;</span><span class="op" id="6546747">,</span>&nbsp;<span class="builtintype" id="6546749">false</span><span class="op" id="6546754">,</span>&nbsp;<span class="string" id="6546756">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="6546785">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="6546788">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="6546868">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6546942">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="6546960">type</span>&nbsp;<span class="ident" id="6546965">recordingConn</span>&nbsp;<span class="keyword" id="6546979">struct</span>&nbsp;<span class="op" id="6546986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6546989">net</span><span class="op" id="6546992">.</span><span class="ident" id="6546993">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6546999">sync</span><span class="op" id="6547003">.</span><span class="ident" id="6547004">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547011">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6547019">[</span><span class="op" id="6547020">]</span><span class="op" id="6547021">[</span><span class="op" id="6547022">]</span><span class="builtintype" id="6547023">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547029">reading</span>&nbsp;<span class="builtintype" id="6547037">bool</span><br>
<span class="lineno"></span><span class="op" id="6547042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6547045">func</span>&nbsp;<span class="op" id="6547050">(</span><span class="ident" id="6547051">r</span>&nbsp;<span class="op" id="6547053">*</span><span class="ident" id="6547054">recordingConn</span><span class="op" id="6547067">)</span>&nbsp;<span class="ident" id="6547069">Read</span><span class="op" id="6547073">(</span><span class="ident" id="6547074">b</span>&nbsp;<span class="op" id="6547076">[</span><span class="op" id="6547077">]</span><span class="builtintype" id="6547078">byte</span><span class="op" id="6547082">)</span>&nbsp;<span class="op" id="6547084">(</span><span class="ident" id="6547085">n</span>&nbsp;<span class="builtintype" id="6547087">int</span><span class="op" id="6547090">,</span>&nbsp;<span class="ident" id="6547092">err</span>&nbsp;<span class="builtintype" id="6547096">error</span><span class="op" id="6547101">)</span>&nbsp;<span class="op" id="6547103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6547106">if</span>&nbsp;<span class="ident" id="6547109">n</span><span class="op" id="6547110">,</span>&nbsp;<span class="ident" id="6547112">err</span>&nbsp;<span class="op" id="6547116">=</span>&nbsp;<span class="ident" id="6547118">r</span><span class="op" id="6547119">.</span><span class="ident" id="6547120">Conn</span><span class="op" id="6547124">.</span><span class="ident" id="6547125">Read</span><span class="op" id="6547129">(</span><span class="ident" id="6547130">b</span><span class="op" id="6547131">)</span><span class="op" id="6547132">;</span>&nbsp;<span class="ident" id="6547134">n</span>&nbsp;<span class="op" id="6547136">==</span>&nbsp;<span class="num" id="6547139">0</span>&nbsp;<span class="op" id="6547141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6547145">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6547153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547156">b</span>&nbsp;<span class="op" id="6547158">=</span>&nbsp;<span class="ident" id="6547160">b</span><span class="op" id="6547161">[</span><span class="op" id="6547162">:</span><span class="ident" id="6547163">n</span><span class="op" id="6547164">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547168">r</span><span class="op" id="6547169">.</span><span class="ident" id="6547170">Lock</span><span class="op" id="6547174">(</span><span class="op" id="6547175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6547178">defer</span>&nbsp;<span class="ident" id="6547184">r</span><span class="op" id="6547185">.</span><span class="ident" id="6547186">Unlock</span><span class="op" id="6547192">(</span><span class="op" id="6547193">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6547197">if</span>&nbsp;<span class="ident" id="6547200">l</span>&nbsp;<span class="op" id="6547202">:=</span>&nbsp;<span class="builtinfunc" id="6547205">len</span><span class="op" id="6547208">(</span><span class="ident" id="6547209">r</span><span class="op" id="6547210">.</span><span class="ident" id="6547211">flows</span><span class="op" id="6547216">)</span><span class="op" id="6547217">;</span>&nbsp;<span class="ident" id="6547219">l</span>&nbsp;<span class="op" id="6547221">==</span>&nbsp;<span class="num" id="6547224">0</span>&nbsp;<span class="op" id="6547226">||</span>&nbsp;<span class="op" id="6547229">!</span><span class="ident" id="6547230">r</span><span class="op" id="6547231">.</span><span class="ident" id="6547232">reading</span>&nbsp;<span class="op" id="6547240">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547244">buf</span>&nbsp;<span class="op" id="6547248">:=</span>&nbsp;<span class="builtinfunc" id="6547251">make</span><span class="op" id="6547255">(</span><span class="op" id="6547256">[</span><span class="op" id="6547257">]</span><span class="builtintype" id="6547258">byte</span><span class="op" id="6547262">,</span>&nbsp;<span class="builtinfunc" id="6547264">len</span><span class="op" id="6547267">(</span><span class="ident" id="6547268">b</span><span class="op" id="6547269">)</span><span class="op" id="6547270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6547274">copy</span><span class="op" id="6547278">(</span><span class="ident" id="6547279">buf</span><span class="op" id="6547282">,</span>&nbsp;<span class="ident" id="6547284">b</span><span class="op" id="6547285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547289">r</span><span class="op" id="6547290">.</span><span class="ident" id="6547291">flows</span>&nbsp;<span class="op" id="6547297">=</span>&nbsp;<span class="builtinfunc" id="6547299">append</span><span class="op" id="6547305">(</span><span class="ident" id="6547306">r</span><span class="op" id="6547307">.</span><span class="ident" id="6547308">flows</span><span class="op" id="6547313">,</span>&nbsp;<span class="ident" id="6547315">buf</span><span class="op" id="6547318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6547321">}</span>&nbsp;<span class="keyword" id="6547323">else</span>&nbsp;<span class="op" id="6547328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547332">r</span><span class="op" id="6547333">.</span><span class="ident" id="6547334">flows</span><span class="op" id="6547339">[</span><span class="ident" id="6547340">l</span><span class="op" id="6547341">-</span><span class="num" id="6547342">1</span><span class="op" id="6547343">]</span>&nbsp;<span class="op" id="6547345">=</span>&nbsp;<span class="builtinfunc" id="6547347">append</span><span class="op" id="6547353">(</span><span class="ident" id="6547354">r</span><span class="op" id="6547355">.</span><span class="ident" id="6547356">flows</span><span class="op" id="6547361">[</span><span class="ident" id="6547362">l</span><span class="op" id="6547363">-</span><span class="num" id="6547364">1</span><span class="op" id="6547365">]</span><span class="op" id="6547366">,</span>&nbsp;<span class="ident" id="6547368">b</span><span class="op" id="6547369">[</span><span class="op" id="6547370">:</span><span class="ident" id="6547371">n</span><span class="op" id="6547372">]</span><span class="op" id="6547373">...</span><span class="op" id="6547376">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6547379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547382">r</span><span class="op" id="6547383">.</span><span class="ident" id="6547384">reading</span>&nbsp;<span class="op" id="6547392">=</span>&nbsp;<span class="builtintype" id="6547394">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6547400">return</span><br>
<span class="lineno"></span><span class="op" id="6547407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="6547410">func</span>&nbsp;<span class="op" id="6547415">(</span><span class="ident" id="6547416">r</span>&nbsp;<span class="op" id="6547418">*</span><span class="ident" id="6547419">recordingConn</span><span class="op" id="6547432">)</span>&nbsp;<span class="ident" id="6547434">Write</span><span class="op" id="6547439">(</span><span class="ident" id="6547440">b</span>&nbsp;<span class="op" id="6547442">[</span><span class="op" id="6547443">]</span><span class="builtintype" id="6547444">byte</span><span class="op" id="6547448">)</span>&nbsp;<span class="op" id="6547450">(</span><span class="ident" id="6547451">n</span>&nbsp;<span class="builtintype" id="6547453">int</span><span class="op" id="6547456">,</span>&nbsp;<span class="ident" id="6547458">err</span>&nbsp;<span class="builtintype" id="6547462">error</span><span class="op" id="6547467">)</span>&nbsp;<span class="op" id="6547469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6547472">if</span>&nbsp;<span class="ident" id="6547475">n</span><span class="op" id="6547476">,</span>&nbsp;<span class="ident" id="6547478">err</span>&nbsp;<span class="op" id="6547482">=</span>&nbsp;<span class="ident" id="6547484">r</span><span class="op" id="6547485">.</span><span class="ident" id="6547486">Conn</span><span class="op" id="6547490">.</span><span class="ident" id="6547491">Write</span><span class="op" id="6547496">(</span><span class="ident" id="6547497">b</span><span class="op" id="6547498">)</span><span class="op" id="6547499">;</span>&nbsp;<span class="ident" id="6547501">n</span>&nbsp;<span class="op" id="6547503">==</span>&nbsp;<span class="num" id="6547506">0</span>&nbsp;<span class="op" id="6547508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6547512">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6547520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547523">b</span>&nbsp;<span class="op" id="6547525">=</span>&nbsp;<span class="ident" id="6547527">b</span><span class="op" id="6547528">[</span><span class="op" id="6547529">:</span><span class="ident" id="6547530">n</span><span class="op" id="6547531">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547535">r</span><span class="op" id="6547536">.</span><span class="ident" id="6547537">Lock</span><span class="op" id="6547541">(</span><span class="op" id="6547542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6547545">defer</span>&nbsp;<span class="ident" id="6547551">r</span><span class="op" id="6547552">.</span><span class="ident" id="6547553">Unlock</span><span class="op" id="6547559">(</span><span class="op" id="6547560">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6547564">if</span>&nbsp;<span class="ident" id="6547567">l</span>&nbsp;<span class="op" id="6547569">:=</span>&nbsp;<span class="builtinfunc" id="6547572">len</span><span class="op" id="6547575">(</span><span class="ident" id="6547576">r</span><span class="op" id="6547577">.</span><span class="ident" id="6547578">flows</span><span class="op" id="6547583">)</span><span class="op" id="6547584">;</span>&nbsp;<span class="ident" id="6547586">l</span>&nbsp;<span class="op" id="6547588">==</span>&nbsp;<span class="num" id="6547591">0</span>&nbsp;<span class="op" id="6547593">||</span>&nbsp;<span class="ident" id="6547596">r</span><span class="op" id="6547597">.</span><span class="ident" id="6547598">reading</span>&nbsp;<span class="op" id="6547606">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547610">buf</span>&nbsp;<span class="op" id="6547614">:=</span>&nbsp;<span class="builtinfunc" id="6547617">make</span><span class="op" id="6547621">(</span><span class="op" id="6547622">[</span><span class="op" id="6547623">]</span><span class="builtintype" id="6547624">byte</span><span class="op" id="6547628">,</span>&nbsp;<span class="builtinfunc" id="6547630">len</span><span class="op" id="6547633">(</span><span class="ident" id="6547634">b</span><span class="op" id="6547635">)</span><span class="op" id="6547636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6547640">copy</span><span class="op" id="6547644">(</span><span class="ident" id="6547645">buf</span><span class="op" id="6547648">,</span>&nbsp;<span class="ident" id="6547650">b</span><span class="op" id="6547651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547655">r</span><span class="op" id="6547656">.</span><span class="ident" id="6547657">flows</span>&nbsp;<span class="op" id="6547663">=</span>&nbsp;<span class="builtinfunc" id="6547665">append</span><span class="op" id="6547671">(</span><span class="ident" id="6547672">r</span><span class="op" id="6547673">.</span><span class="ident" id="6547674">flows</span><span class="op" id="6547679">,</span>&nbsp;<span class="ident" id="6547681">buf</span><span class="op" id="6547684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6547687">}</span>&nbsp;<span class="keyword" id="6547689">else</span>&nbsp;<span class="op" id="6547694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547698">r</span><span class="op" id="6547699">.</span><span class="ident" id="6547700">flows</span><span class="op" id="6547705">[</span><span class="ident" id="6547706">l</span><span class="op" id="6547707">-</span><span class="num" id="6547708">1</span><span class="op" id="6547709">]</span>&nbsp;<span class="op" id="6547711">=</span>&nbsp;<span class="builtinfunc" id="6547713">append</span><span class="op" id="6547719">(</span><span class="ident" id="6547720">r</span><span class="op" id="6547721">.</span><span class="ident" id="6547722">flows</span><span class="op" id="6547727">[</span><span class="ident" id="6547728">l</span><span class="op" id="6547729">-</span><span class="num" id="6547730">1</span><span class="op" id="6547731">]</span><span class="op" id="6547732">,</span>&nbsp;<span class="ident" id="6547734">b</span><span class="op" id="6547735">[</span><span class="op" id="6547736">:</span><span class="ident" id="6547737">n</span><span class="op" id="6547738">]</span><span class="op" id="6547739">...</span><span class="op" id="6547742">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6547745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547748">r</span><span class="op" id="6547749">.</span><span class="ident" id="6547750">reading</span>&nbsp;<span class="op" id="6547758">=</span>&nbsp;<span class="builtintype" id="6547760">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6547767">return</span><br>
<span class="lineno"></span><span class="op" id="6547774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6547777">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="6547851">func</span>&nbsp;<span class="op" id="6547856">(</span><span class="ident" id="6547857">r</span>&nbsp;<span class="op" id="6547859">*</span><span class="ident" id="6547860">recordingConn</span><span class="op" id="6547873">)</span>&nbsp;<span class="ident" id="6547875">WriteTo</span><span class="op" id="6547882">(</span><span class="ident" id="6547883">w</span>&nbsp;<span class="ident" id="6547885">io</span><span class="op" id="6547887">.</span><span class="ident" id="6547888">Writer</span><span class="op" id="6547894">)</span>&nbsp;<span class="op" id="6547896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6547899">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6547951">clientToServer</span>&nbsp;<span class="op" id="6547966">:=</span>&nbsp;<span class="builtintype" id="6547969">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6547976">for</span>&nbsp;<span class="ident" id="6547980">i</span><span class="op" id="6547981">,</span>&nbsp;<span class="ident" id="6547983">flow</span>&nbsp;<span class="op" id="6547988">:=</span>&nbsp;<span class="keyword" id="6547991">range</span>&nbsp;<span class="ident" id="6547997">r</span><span class="op" id="6547998">.</span><span class="ident" id="6547999">flows</span>&nbsp;<span class="op" id="6548005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548009">source</span><span class="op" id="6548015">,</span>&nbsp;<span class="ident" id="6548017">dest</span>&nbsp;<span class="op" id="6548022">:=</span>&nbsp;<span class="string" id="6548025">&#34;client&#34;</span><span class="op" id="6548033">,</span>&nbsp;<span class="string" id="6548035">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6548046">if</span>&nbsp;<span class="op" id="6548049">!</span><span class="ident" id="6548050">clientToServer</span>&nbsp;<span class="op" id="6548065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548070">source</span><span class="op" id="6548076">,</span>&nbsp;<span class="ident" id="6548078">dest</span>&nbsp;<span class="op" id="6548083">=</span>&nbsp;<span class="ident" id="6548085">dest</span><span class="op" id="6548089">,</span>&nbsp;<span class="ident" id="6548091">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6548100">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548104">fmt</span><span class="op" id="6548107">.</span><span class="ident" id="6548108">Fprintf</span><span class="op" id="6548115">(</span><span class="ident" id="6548116">w</span><span class="op" id="6548117">,</span>&nbsp;<span class="string" id="6548119">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="6548145">,</span>&nbsp;<span class="ident" id="6548147">i</span><span class="op" id="6548148">+</span><span class="num" id="6548149">1</span><span class="op" id="6548150">,</span>&nbsp;<span class="ident" id="6548152">source</span><span class="op" id="6548158">,</span>&nbsp;<span class="ident" id="6548160">dest</span><span class="op" id="6548164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548168">dumper</span>&nbsp;<span class="op" id="6548175">:=</span>&nbsp;<span class="ident" id="6548178">hex</span><span class="op" id="6548181">.</span><span class="ident" id="6548182">Dumper</span><span class="op" id="6548188">(</span><span class="ident" id="6548189">w</span><span class="op" id="6548190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548194">dumper</span><span class="op" id="6548200">.</span><span class="ident" id="6548201">Write</span><span class="op" id="6548206">(</span><span class="ident" id="6548207">flow</span><span class="op" id="6548211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548215">dumper</span><span class="op" id="6548221">.</span><span class="ident" id="6548222">Close</span><span class="op" id="6548227">(</span><span class="op" id="6548228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548232">clientToServer</span>&nbsp;<span class="op" id="6548247">=</span>&nbsp;<span class="op" id="6548249">!</span><span class="ident" id="6548250">clientToServer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6548266">}</span><br>
<span class="lineno"></span><span class="op" id="6548268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6548271">func</span>&nbsp;<span class="ident" id="6548276">parseTestData</span><span class="op" id="6548289">(</span><span class="ident" id="6548290">r</span>&nbsp;<span class="ident" id="6548292">io</span><span class="op" id="6548294">.</span><span class="ident" id="6548295">Reader</span><span class="op" id="6548301">)</span>&nbsp;<span class="op" id="6548303">(</span><span class="ident" id="6548304">flows</span>&nbsp;<span class="op" id="6548310">[</span><span class="op" id="6548311">]</span><span class="op" id="6548312">[</span><span class="op" id="6548313">]</span><span class="builtintype" id="6548314">byte</span><span class="op" id="6548318">,</span>&nbsp;<span class="ident" id="6548320">err</span>&nbsp;<span class="builtintype" id="6548324">error</span><span class="op" id="6548329">)</span>&nbsp;<span class="op" id="6548331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6548334">var</span>&nbsp;<span class="ident" id="6548338">currentFlow</span>&nbsp;<span class="op" id="6548350">[</span><span class="op" id="6548351">]</span><span class="builtintype" id="6548352">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548359">scanner</span>&nbsp;<span class="op" id="6548367">:=</span>&nbsp;<span class="ident" id="6548370">bufio</span><span class="op" id="6548375">.</span><span class="ident" id="6548376">NewScanner</span><span class="op" id="6548386">(</span><span class="ident" id="6548387">r</span><span class="op" id="6548388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6548391">for</span>&nbsp;<span class="ident" id="6548395">scanner</span><span class="op" id="6548402">.</span><span class="ident" id="6548403">Scan</span><span class="op" id="6548407">(</span><span class="op" id="6548408">)</span>&nbsp;<span class="op" id="6548410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548414">line</span>&nbsp;<span class="op" id="6548419">:=</span>&nbsp;<span class="ident" id="6548422">scanner</span><span class="op" id="6548429">.</span><span class="ident" id="6548430">Text</span><span class="op" id="6548434">(</span><span class="op" id="6548435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6548439">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6548503">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6548523">if</span>&nbsp;<span class="ident" id="6548526">strings</span><span class="op" id="6548533">.</span><span class="ident" id="6548534">HasPrefix</span><span class="op" id="6548543">(</span><span class="ident" id="6548544">line</span><span class="op" id="6548548">,</span>&nbsp;<span class="string" id="6548550">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="6548556">)</span>&nbsp;<span class="op" id="6548558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6548563">if</span>&nbsp;<span class="builtinfunc" id="6548566">len</span><span class="op" id="6548569">(</span><span class="ident" id="6548570">currentFlow</span><span class="op" id="6548581">)</span>&nbsp;<span class="op" id="6548583">&gt;</span>&nbsp;<span class="num" id="6548585">0</span>&nbsp;<span class="op" id="6548587">||</span>&nbsp;<span class="builtinfunc" id="6548590">len</span><span class="op" id="6548593">(</span><span class="ident" id="6548594">flows</span><span class="op" id="6548599">)</span>&nbsp;<span class="op" id="6548601">&gt;</span>&nbsp;<span class="num" id="6548603">0</span>&nbsp;<span class="op" id="6548605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548611">flows</span>&nbsp;<span class="op" id="6548617">=</span>&nbsp;<span class="builtinfunc" id="6548619">append</span><span class="op" id="6548625">(</span><span class="ident" id="6548626">flows</span><span class="op" id="6548631">,</span>&nbsp;<span class="ident" id="6548633">currentFlow</span><span class="op" id="6548644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548650">currentFlow</span>&nbsp;<span class="op" id="6548662">=</span>&nbsp;<span class="ident" id="6548664">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6548671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6548676">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6548687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6548692">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6548755">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6548808">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6548870">if</span>&nbsp;<span class="ident" id="6548873">i</span>&nbsp;<span class="op" id="6548875">:=</span>&nbsp;<span class="ident" id="6548878">strings</span><span class="op" id="6548885">.</span><span class="ident" id="6548886">IndexByte</span><span class="op" id="6548895">(</span><span class="ident" id="6548896">line</span><span class="op" id="6548900">,</span>&nbsp;<span class="string" id="6548902">&#39;&nbsp;&#39;</span><span class="op" id="6548905">)</span><span class="op" id="6548906">;</span>&nbsp;<span class="ident" id="6548908">i</span>&nbsp;<span class="op" id="6548910">&gt;=</span>&nbsp;<span class="num" id="6548913">0</span>&nbsp;<span class="op" id="6548915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6548920">line</span>&nbsp;<span class="op" id="6548925">=</span>&nbsp;<span class="ident" id="6548927">line</span><span class="op" id="6548931">[</span><span class="ident" id="6548932">i</span><span class="op" id="6548933">:</span><span class="op" id="6548934">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6548938">}</span>&nbsp;<span class="keyword" id="6548940">else</span>&nbsp;<span class="op" id="6548945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6548950">return</span>&nbsp;<span class="ident" id="6548957">nil</span><span class="op" id="6548960">,</span>&nbsp;<span class="ident" id="6548962">errors</span><span class="op" id="6548968">.</span><span class="ident" id="6548969">New</span><span class="op" id="6548972">(</span><span class="string" id="6548973">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="6548992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6548996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6549001">if</span>&nbsp;<span class="ident" id="6549004">i</span>&nbsp;<span class="op" id="6549006">:=</span>&nbsp;<span class="ident" id="6549009">strings</span><span class="op" id="6549016">.</span><span class="ident" id="6549017">IndexByte</span><span class="op" id="6549026">(</span><span class="ident" id="6549027">line</span><span class="op" id="6549031">,</span>&nbsp;<span class="string" id="6549033">&#39;|&#39;</span><span class="op" id="6549036">)</span><span class="op" id="6549037">;</span>&nbsp;<span class="ident" id="6549039">i</span>&nbsp;<span class="op" id="6549041">&gt;=</span>&nbsp;<span class="num" id="6549044">0</span>&nbsp;<span class="op" id="6549046">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6549051">line</span>&nbsp;<span class="op" id="6549056">=</span>&nbsp;<span class="ident" id="6549058">line</span><span class="op" id="6549062">[</span><span class="op" id="6549063">:</span><span class="ident" id="6549064">i</span><span class="op" id="6549065">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6549069">}</span>&nbsp;<span class="keyword" id="6549071">else</span>&nbsp;<span class="op" id="6549076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6549081">return</span>&nbsp;<span class="ident" id="6549088">nil</span><span class="op" id="6549091">,</span>&nbsp;<span class="ident" id="6549093">errors</span><span class="op" id="6549099">.</span><span class="ident" id="6549100">New</span><span class="op" id="6549103">(</span><span class="string" id="6549104">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="6549123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6549127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6549132">hexBytes</span>&nbsp;<span class="op" id="6549141">:=</span>&nbsp;<span class="ident" id="6549144">strings</span><span class="op" id="6549151">.</span><span class="ident" id="6549152">Fields</span><span class="op" id="6549158">(</span><span class="ident" id="6549159">line</span><span class="op" id="6549163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6549167">for</span>&nbsp;<span class="ident" id="6549171">_</span><span class="op" id="6549172">,</span>&nbsp;<span class="ident" id="6549174">hexByte</span>&nbsp;<span class="op" id="6549182">:=</span>&nbsp;<span class="keyword" id="6549185">range</span>&nbsp;<span class="ident" id="6549191">hexBytes</span>&nbsp;<span class="op" id="6549200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6549205">val</span><span class="op" id="6549208">,</span>&nbsp;<span class="ident" id="6549210">err</span>&nbsp;<span class="op" id="6549214">:=</span>&nbsp;<span class="ident" id="6549217">strconv</span><span class="op" id="6549224">.</span><span class="ident" id="6549225">ParseUint</span><span class="op" id="6549234">(</span><span class="ident" id="6549235">hexByte</span><span class="op" id="6549242">,</span>&nbsp;<span class="num" id="6549244">16</span><span class="op" id="6549246">,</span>&nbsp;<span class="num" id="6549248">8</span><span class="op" id="6549249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6549254">if</span>&nbsp;<span class="ident" id="6549257">err</span>&nbsp;<span class="op" id="6549261">!=</span>&nbsp;<span class="ident" id="6549264">nil</span>&nbsp;<span class="op" id="6549268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6549274">return</span>&nbsp;<span class="ident" id="6549281">nil</span><span class="op" id="6549284">,</span>&nbsp;<span class="ident" id="6549286">errors</span><span class="op" id="6549292">.</span><span class="ident" id="6549293">New</span><span class="op" id="6549296">(</span><span class="string" id="6549297">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="6549331">+</span>&nbsp;<span class="ident" id="6549333">err</span><span class="op" id="6549336">.</span><span class="ident" id="6549337">Error</span><span class="op" id="6549342">(</span><span class="op" id="6549343">)</span><span class="op" id="6549344">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6549349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6549354">currentFlow</span>&nbsp;<span class="op" id="6549366">=</span>&nbsp;<span class="builtinfunc" id="6549368">append</span><span class="op" id="6549374">(</span><span class="ident" id="6549375">currentFlow</span><span class="op" id="6549386">,</span>&nbsp;<span class="builtintype" id="6549388">byte</span><span class="op" id="6549392">(</span><span class="ident" id="6549393">val</span><span class="op" id="6549396">)</span><span class="op" id="6549397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6549401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6549404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6549408">if</span>&nbsp;<span class="builtinfunc" id="6549411">len</span><span class="op" id="6549414">(</span><span class="ident" id="6549415">currentFlow</span><span class="op" id="6549426">)</span>&nbsp;<span class="op" id="6549428">&gt;</span>&nbsp;<span class="num" id="6549430">0</span>&nbsp;<span class="op" id="6549432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6549436">flows</span>&nbsp;<span class="op" id="6549442">=</span>&nbsp;<span class="builtinfunc" id="6549444">append</span><span class="op" id="6549450">(</span><span class="ident" id="6549451">flows</span><span class="op" id="6549456">,</span>&nbsp;<span class="ident" id="6549458">currentFlow</span><span class="op" id="6549469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6549472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6549476">return</span>&nbsp;<span class="ident" id="6549483">flows</span><span class="op" id="6549488">,</span>&nbsp;<span class="ident" id="6549490">nil</span><br>
<span class="lineno">155</span><span class="op" id="6549494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6549497">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="6549571">func</span>&nbsp;<span class="ident" id="6549576">tempFile</span><span class="op" id="6549584">(</span><span class="ident" id="6549585">contents</span>&nbsp;<span class="builtintype" id="6549594">string</span><span class="op" id="6549600">)</span>&nbsp;<span class="builtintype" id="6549602">string</span>&nbsp;<span class="op" id="6549609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6549612">file</span><span class="op" id="6549616">,</span>&nbsp;<span class="ident" id="6549618">err</span>&nbsp;<span class="op" id="6549622">:=</span>&nbsp;<span class="ident" id="6549625">ioutil</span><span class="op" id="6549631">.</span><span class="ident" id="6549632">TempFile</span><span class="op" id="6549640">(</span><span class="string" id="6549641">&#34;&#34;</span><span class="op" id="6549643">,</span>&nbsp;<span class="string" id="6549645">&#34;go-tls-test&#34;</span><span class="op" id="6549658">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6549661">if</span>&nbsp;<span class="ident" id="6549664">err</span>&nbsp;<span class="op" id="6549668">!=</span>&nbsp;<span class="ident" id="6549671">nil</span>&nbsp;<span class="op" id="6549675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6549679">panic</span><span class="op" id="6549684">(</span><span class="string" id="6549685">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="6549716">+</span>&nbsp;<span class="ident" id="6549718">err</span><span class="op" id="6549721">.</span><span class="ident" id="6549722">Error</span><span class="op" id="6549727">(</span><span class="op" id="6549728">)</span><span class="op" id="6549729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6549732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6549735">path</span>&nbsp;<span class="op" id="6549740">:=</span>&nbsp;<span class="ident" id="6549743">file</span><span class="op" id="6549747">.</span><span class="ident" id="6549748">Name</span><span class="op" id="6549752">(</span><span class="op" id="6549753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6549756">file</span><span class="op" id="6549760">.</span><span class="ident" id="6549761">WriteString</span><span class="op" id="6549772">(</span><span class="ident" id="6549773">contents</span><span class="op" id="6549781">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6549784">file</span><span class="op" id="6549788">.</span><span class="ident" id="6549789">Close</span><span class="op" id="6549794">(</span><span class="op" id="6549795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6549798">return</span>&nbsp;<span class="ident" id="6549805">path</span><br>
<span class="lineno"></span><span class="op" id="6549810">}</span>
</div>
</body>
</html>
