<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4965232">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4965287">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4965341">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4965392">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4965464">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4965538">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4965613">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="4965671">//</span><br>
<span class="lineno">10</span><span class="keyword" id="4965674">package</span>&nbsp;<span class="ident" id="4965682">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4965690">import</span>&nbsp;<span class="op" id="4965697">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4965700">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4965707">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4965717">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4965731">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4965743">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4965754">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4965765">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="4965775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4965778">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4965837">type</span>&nbsp;<span class="ident" id="4965842">parser</span>&nbsp;<span class="keyword" id="4965849">struct</span>&nbsp;<span class="op" id="4965856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965859">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4965867">*</span><span class="ident" id="4965868">token</span><span class="op" id="4965873">.</span><span class="ident" id="4965874">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965880">errors</span>&nbsp;&nbsp;<span class="ident" id="4965888">scanner</span><span class="op" id="4965895">.</span><span class="ident" id="4965896">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965907">scanner</span>&nbsp;<span class="ident" id="4965915">scanner</span><span class="op" id="4965922">.</span><span class="ident" id="4965923">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4965933">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965955">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4965962">Mode</span>&nbsp;<span class="comment" id="4965967">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965984">trace</span>&nbsp;&nbsp;<span class="builtintype" id="4965991">bool</span>&nbsp;<span class="comment" id="4965996">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966023">indent</span>&nbsp;<span class="builtintype" id="4966030">int</span>&nbsp;&nbsp;<span class="comment" id="4966035">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4966076">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966089">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4966101">[</span><span class="op" id="4966102">]</span><span class="op" id="4966103">*</span><span class="ident" id="4966104">ast</span><span class="op" id="4966107">.</span><span class="ident" id="4966108">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966122">leadComment</span>&nbsp;<span class="op" id="4966134">*</span><span class="ident" id="4966135">ast</span><span class="op" id="4966138">.</span><span class="ident" id="4966139">CommentGroup</span>&nbsp;<span class="comment" id="4966152">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966174">lineComment</span>&nbsp;<span class="op" id="4966186">*</span><span class="ident" id="4966187">ast</span><span class="op" id="4966190">.</span><span class="ident" id="4966191">CommentGroup</span>&nbsp;<span class="comment" id="4966204">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4966227">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966242">pos</span>&nbsp;<span class="ident" id="4966246">token</span><span class="op" id="4966251">.</span><span class="ident" id="4966252">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4966258">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966277">tok</span>&nbsp;<span class="ident" id="4966281">token</span><span class="op" id="4966286">.</span><span class="ident" id="4966287">Token</span>&nbsp;<span class="comment" id="4966293">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966318">lit</span>&nbsp;<span class="builtintype" id="4966322">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4966334">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4966353">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4966372">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4966432">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4966492">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966558">syncPos</span>&nbsp;<span class="ident" id="4966566">token</span><span class="op" id="4966571">.</span><span class="ident" id="4966572">Pos</span>&nbsp;<span class="comment" id="4966576">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966610">syncCnt</span>&nbsp;<span class="builtintype" id="4966618">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4966628">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4966677">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966710">exprLev</span>&nbsp;<span class="builtintype" id="4966718">int</span>&nbsp;&nbsp;<span class="comment" id="4966723">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966771">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4966779">bool</span>&nbsp;<span class="comment" id="4966784">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4966836">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966867">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4966878">*</span><span class="ident" id="4966879">ast</span><span class="op" id="4966882">.</span><span class="ident" id="4966883">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4966896">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966922">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4966933">*</span><span class="ident" id="4966934">ast</span><span class="op" id="4966937">.</span><span class="ident" id="4966938">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4966951">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966987">unresolved</span>&nbsp;<span class="op" id="4966998">[</span><span class="op" id="4966999">]</span><span class="op" id="4967000">*</span><span class="ident" id="4967001">ast</span><span class="op" id="4967004">.</span><span class="ident" id="4967005">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4967016">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967043">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4967054">[</span><span class="op" id="4967055">]</span><span class="op" id="4967056">*</span><span class="ident" id="4967057">ast</span><span class="op" id="4967060">.</span><span class="ident" id="4967061">ImportSpec</span>&nbsp;<span class="comment" id="4967072">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4967093">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4967110">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967152">labelScope</span>&nbsp;&nbsp;<span class="op" id="4967164">*</span><span class="ident" id="4967165">ast</span><span class="op" id="4967168">.</span><span class="ident" id="4967169">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4967179">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967216">targetStack</span>&nbsp;<span class="op" id="4967228">[</span><span class="op" id="4967229">]</span><span class="op" id="4967230">[</span><span class="op" id="4967231">]</span><span class="op" id="4967232">*</span><span class="ident" id="4967233">ast</span><span class="op" id="4967236">.</span><span class="ident" id="4967237">Ident</span>&nbsp;<span class="comment" id="4967243">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="4967273">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="4967276">func</span>&nbsp;<span class="op" id="4967281">(</span><span class="ident" id="4967282">p</span>&nbsp;<span class="op" id="4967284">*</span><span class="ident" id="4967285">parser</span><span class="op" id="4967291">)</span>&nbsp;<span class="ident" id="4967293">init</span><span class="op" id="4967297">(</span><span class="ident" id="4967298">fset</span>&nbsp;<span class="op" id="4967303">*</span><span class="ident" id="4967304">token</span><span class="op" id="4967309">.</span><span class="ident" id="4967310">FileSet</span><span class="op" id="4967317">,</span>&nbsp;<span class="ident" id="4967319">filename</span>&nbsp;<span class="builtintype" id="4967328">string</span><span class="op" id="4967334">,</span>&nbsp;<span class="ident" id="4967336">src</span>&nbsp;<span class="op" id="4967340">[</span><span class="op" id="4967341">]</span><span class="builtintype" id="4967342">byte</span><span class="op" id="4967346">,</span>&nbsp;<span class="ident" id="4967348">mode</span>&nbsp;<span class="ident" id="4967353">Mode</span><span class="op" id="4967357">)</span>&nbsp;<span class="op" id="4967359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967362">p</span><span class="op" id="4967363">.</span><span class="ident" id="4967364">file</span>&nbsp;<span class="op" id="4967369">=</span>&nbsp;<span class="ident" id="4967371">fset</span><span class="op" id="4967375">.</span><span class="ident" id="4967376">AddFile</span><span class="op" id="4967383">(</span><span class="ident" id="4967384">filename</span><span class="op" id="4967392">,</span>&nbsp;<span class="op" id="4967394">-</span><span class="num" id="4967395">1</span><span class="op" id="4967396">,</span>&nbsp;<span class="builtinfunc" id="4967398">len</span><span class="op" id="4967401">(</span><span class="ident" id="4967402">src</span><span class="op" id="4967405">)</span><span class="op" id="4967406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967409">var</span>&nbsp;<span class="ident" id="4967413">m</span>&nbsp;<span class="ident" id="4967415">scanner</span><span class="op" id="4967422">.</span><span class="ident" id="4967423">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967429">if</span>&nbsp;<span class="ident" id="4967432">mode</span><span class="op" id="4967436">&amp;</span><span class="ident" id="4967437">ParseComments</span>&nbsp;<span class="op" id="4967451">!=</span>&nbsp;<span class="num" id="4967454">0</span>&nbsp;<span class="op" id="4967456">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967460">m</span>&nbsp;<span class="op" id="4967462">=</span>&nbsp;<span class="ident" id="4967464">scanner</span><span class="op" id="4967471">.</span><span class="ident" id="4967472">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967489">eh</span>&nbsp;<span class="op" id="4967492">:=</span>&nbsp;<span class="keyword" id="4967495">func</span><span class="op" id="4967499">(</span><span class="ident" id="4967500">pos</span>&nbsp;<span class="ident" id="4967504">token</span><span class="op" id="4967509">.</span><span class="ident" id="4967510">Position</span><span class="op" id="4967518">,</span>&nbsp;<span class="ident" id="4967520">msg</span>&nbsp;<span class="builtintype" id="4967524">string</span><span class="op" id="4967530">)</span>&nbsp;<span class="op" id="4967532">{</span>&nbsp;<span class="ident" id="4967534">p</span><span class="op" id="4967535">.</span><span class="ident" id="4967536">errors</span><span class="op" id="4967542">.</span><span class="ident" id="4967543">Add</span><span class="op" id="4967546">(</span><span class="ident" id="4967547">pos</span><span class="op" id="4967550">,</span>&nbsp;<span class="ident" id="4967552">msg</span><span class="op" id="4967555">)</span>&nbsp;<span class="op" id="4967557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967560">p</span><span class="op" id="4967561">.</span><span class="ident" id="4967562">scanner</span><span class="op" id="4967569">.</span><span class="ident" id="4967570">Init</span><span class="op" id="4967574">(</span><span class="ident" id="4967575">p</span><span class="op" id="4967576">.</span><span class="ident" id="4967577">file</span><span class="op" id="4967581">,</span>&nbsp;<span class="ident" id="4967583">src</span><span class="op" id="4967586">,</span>&nbsp;<span class="ident" id="4967588">eh</span><span class="op" id="4967590">,</span>&nbsp;<span class="ident" id="4967592">m</span><span class="op" id="4967593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967597">p</span><span class="op" id="4967598">.</span><span class="ident" id="4967599">mode</span>&nbsp;<span class="op" id="4967604">=</span>&nbsp;<span class="ident" id="4967606">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967612">p</span><span class="op" id="4967613">.</span><span class="ident" id="4967614">trace</span>&nbsp;<span class="op" id="4967620">=</span>&nbsp;<span class="ident" id="4967622">mode</span><span class="op" id="4967626">&amp;</span><span class="ident" id="4967627">Trace</span>&nbsp;<span class="op" id="4967633">!=</span>&nbsp;<span class="num" id="4967636">0</span>&nbsp;<span class="comment" id="4967638">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967688">p</span><span class="op" id="4967689">.</span><span class="ident" id="4967690">next</span><span class="op" id="4967694">(</span><span class="op" id="4967695">)</span><br>
<span class="lineno"></span><span class="op" id="4967697">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4967700">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4967780">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4967800">func</span>&nbsp;<span class="op" id="4967805">(</span><span class="ident" id="4967806">p</span>&nbsp;<span class="op" id="4967808">*</span><span class="ident" id="4967809">parser</span><span class="op" id="4967815">)</span>&nbsp;<span class="ident" id="4967817">openScope</span><span class="op" id="4967826">(</span><span class="op" id="4967827">)</span>&nbsp;<span class="op" id="4967829">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967832">p</span><span class="op" id="4967833">.</span><span class="ident" id="4967834">topScope</span>&nbsp;<span class="op" id="4967843">=</span>&nbsp;<span class="ident" id="4967845">ast</span><span class="op" id="4967848">.</span><span class="ident" id="4967849">NewScope</span><span class="op" id="4967857">(</span><span class="ident" id="4967858">p</span><span class="op" id="4967859">.</span><span class="ident" id="4967860">topScope</span><span class="op" id="4967868">)</span><br>
<span class="lineno"></span><span class="op" id="4967870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4967873">func</span>&nbsp;<span class="op" id="4967878">(</span><span class="ident" id="4967879">p</span>&nbsp;<span class="op" id="4967881">*</span><span class="ident" id="4967882">parser</span><span class="op" id="4967888">)</span>&nbsp;<span class="ident" id="4967890">closeScope</span><span class="op" id="4967900">(</span><span class="op" id="4967901">)</span>&nbsp;<span class="op" id="4967903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967906">p</span><span class="op" id="4967907">.</span><span class="ident" id="4967908">topScope</span>&nbsp;<span class="op" id="4967917">=</span>&nbsp;<span class="ident" id="4967919">p</span><span class="op" id="4967920">.</span><span class="ident" id="4967921">topScope</span><span class="op" id="4967929">.</span><span class="ident" id="4967930">Outer</span><br>
<span class="lineno">90</span><span class="op" id="4967936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4967939">func</span>&nbsp;<span class="op" id="4967944">(</span><span class="ident" id="4967945">p</span>&nbsp;<span class="op" id="4967947">*</span><span class="ident" id="4967948">parser</span><span class="op" id="4967954">)</span>&nbsp;<span class="ident" id="4967956">openLabelScope</span><span class="op" id="4967970">(</span><span class="op" id="4967971">)</span>&nbsp;<span class="op" id="4967973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967976">p</span><span class="op" id="4967977">.</span><span class="ident" id="4967978">labelScope</span>&nbsp;<span class="op" id="4967989">=</span>&nbsp;<span class="ident" id="4967991">ast</span><span class="op" id="4967994">.</span><span class="ident" id="4967995">NewScope</span><span class="op" id="4968003">(</span><span class="ident" id="4968004">p</span><span class="op" id="4968005">.</span><span class="ident" id="4968006">labelScope</span><span class="op" id="4968016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968019">p</span><span class="op" id="4968020">.</span><span class="ident" id="4968021">targetStack</span>&nbsp;<span class="op" id="4968033">=</span>&nbsp;<span class="builtinfunc" id="4968035">append</span><span class="op" id="4968041">(</span><span class="ident" id="4968042">p</span><span class="op" id="4968043">.</span><span class="ident" id="4968044">targetStack</span><span class="op" id="4968055">,</span>&nbsp;<span class="ident" id="4968057">nil</span><span class="op" id="4968060">)</span><br>
<span class="lineno">95</span><span class="op" id="4968062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4968065">func</span>&nbsp;<span class="op" id="4968070">(</span><span class="ident" id="4968071">p</span>&nbsp;<span class="op" id="4968073">*</span><span class="ident" id="4968074">parser</span><span class="op" id="4968080">)</span>&nbsp;<span class="ident" id="4968082">closeLabelScope</span><span class="op" id="4968097">(</span><span class="op" id="4968098">)</span>&nbsp;<span class="op" id="4968100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968103">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968122">n</span>&nbsp;<span class="op" id="4968124">:=</span>&nbsp;<span class="builtinfunc" id="4968127">len</span><span class="op" id="4968130">(</span><span class="ident" id="4968131">p</span><span class="op" id="4968132">.</span><span class="ident" id="4968133">targetStack</span><span class="op" id="4968144">)</span>&nbsp;<span class="op" id="4968146">-</span>&nbsp;<span class="num" id="4968148">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968151">scope</span>&nbsp;<span class="op" id="4968157">:=</span>&nbsp;<span class="ident" id="4968160">p</span><span class="op" id="4968161">.</span><span class="ident" id="4968162">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968174">for</span>&nbsp;<span class="ident" id="4968178">_</span><span class="op" id="4968179">,</span>&nbsp;<span class="ident" id="4968181">ident</span>&nbsp;<span class="op" id="4968187">:=</span>&nbsp;<span class="keyword" id="4968190">range</span>&nbsp;<span class="ident" id="4968196">p</span><span class="op" id="4968197">.</span><span class="ident" id="4968198">targetStack</span><span class="op" id="4968209">[</span><span class="ident" id="4968210">n</span><span class="op" id="4968211">]</span>&nbsp;<span class="op" id="4968213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968217">ident</span><span class="op" id="4968222">.</span><span class="ident" id="4968223">Obj</span>&nbsp;<span class="op" id="4968227">=</span>&nbsp;<span class="ident" id="4968229">scope</span><span class="op" id="4968234">.</span><span class="ident" id="4968235">Lookup</span><span class="op" id="4968241">(</span><span class="ident" id="4968242">ident</span><span class="op" id="4968247">.</span><span class="ident" id="4968248">Name</span><span class="op" id="4968252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968256">if</span>&nbsp;<span class="ident" id="4968259">ident</span><span class="op" id="4968264">.</span><span class="ident" id="4968265">Obj</span>&nbsp;<span class="op" id="4968269">==</span>&nbsp;<span class="ident" id="4968272">nil</span>&nbsp;<span class="op" id="4968276">&amp;&amp;</span>&nbsp;<span class="ident" id="4968279">p</span><span class="op" id="4968280">.</span><span class="ident" id="4968281">mode</span><span class="op" id="4968285">&amp;</span><span class="ident" id="4968286">DeclarationErrors</span>&nbsp;<span class="op" id="4968304">!=</span>&nbsp;<span class="num" id="4968307">0</span>&nbsp;<span class="op" id="4968309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968314">p</span><span class="op" id="4968315">.</span><span class="builtintype" id="4968316">error</span><span class="op" id="4968321">(</span><span class="ident" id="4968322">ident</span><span class="op" id="4968327">.</span><span class="ident" id="4968328">Pos</span><span class="op" id="4968331">(</span><span class="op" id="4968332">)</span><span class="op" id="4968333">,</span>&nbsp;<span class="ident" id="4968335">fmt</span><span class="op" id="4968338">.</span><span class="ident" id="4968339">Sprintf</span><span class="op" id="4968346">(</span><span class="string" id="4968347">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="4968367">,</span>&nbsp;<span class="ident" id="4968369">ident</span><span class="op" id="4968374">.</span><span class="ident" id="4968375">Name</span><span class="op" id="4968379">)</span><span class="op" id="4968380">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4968384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4968387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968390">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968410">p</span><span class="op" id="4968411">.</span><span class="ident" id="4968412">targetStack</span>&nbsp;<span class="op" id="4968424">=</span>&nbsp;<span class="ident" id="4968426">p</span><span class="op" id="4968427">.</span><span class="ident" id="4968428">targetStack</span><span class="op" id="4968439">[</span><span class="num" id="4968440">0</span><span class="op" id="4968441">:</span><span class="ident" id="4968442">n</span><span class="op" id="4968443">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968446">p</span><span class="op" id="4968447">.</span><span class="ident" id="4968448">labelScope</span>&nbsp;<span class="op" id="4968459">=</span>&nbsp;<span class="ident" id="4968461">p</span><span class="op" id="4968462">.</span><span class="ident" id="4968463">labelScope</span><span class="op" id="4968473">.</span><span class="ident" id="4968474">Outer</span><br>
<span class="lineno">110</span><span class="op" id="4968480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4968483">func</span>&nbsp;<span class="op" id="4968488">(</span><span class="ident" id="4968489">p</span>&nbsp;<span class="op" id="4968491">*</span><span class="ident" id="4968492">parser</span><span class="op" id="4968498">)</span>&nbsp;<span class="ident" id="4968500">declare</span><span class="op" id="4968507">(</span><span class="ident" id="4968508">decl</span><span class="op" id="4968512">,</span>&nbsp;<span class="ident" id="4968514">data</span>&nbsp;<span class="keyword" id="4968519">interface</span><span class="op" id="4968528">{</span><span class="op" id="4968529">}</span><span class="op" id="4968530">,</span>&nbsp;<span class="ident" id="4968532">scope</span>&nbsp;<span class="op" id="4968538">*</span><span class="ident" id="4968539">ast</span><span class="op" id="4968542">.</span><span class="ident" id="4968543">Scope</span><span class="op" id="4968548">,</span>&nbsp;<span class="ident" id="4968550">kind</span>&nbsp;<span class="ident" id="4968555">ast</span><span class="op" id="4968558">.</span><span class="ident" id="4968559">ObjKind</span><span class="op" id="4968566">,</span>&nbsp;<span class="ident" id="4968568">idents</span>&nbsp;<span class="op" id="4968575">...</span><span class="op" id="4968578">*</span><span class="ident" id="4968579">ast</span><span class="op" id="4968582">.</span><span class="ident" id="4968583">Ident</span><span class="op" id="4968588">)</span>&nbsp;<span class="op" id="4968590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968593">for</span>&nbsp;<span class="ident" id="4968597">_</span><span class="op" id="4968598">,</span>&nbsp;<span class="ident" id="4968600">ident</span>&nbsp;<span class="op" id="4968606">:=</span>&nbsp;<span class="keyword" id="4968609">range</span>&nbsp;<span class="ident" id="4968615">idents</span>&nbsp;<span class="op" id="4968622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968626">assert</span><span class="op" id="4968632">(</span><span class="ident" id="4968633">ident</span><span class="op" id="4968638">.</span><span class="ident" id="4968639">Obj</span>&nbsp;<span class="op" id="4968643">==</span>&nbsp;<span class="ident" id="4968646">nil</span><span class="op" id="4968649">,</span>&nbsp;<span class="string" id="4968651">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4968692">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968696">obj</span>&nbsp;<span class="op" id="4968700">:=</span>&nbsp;<span class="ident" id="4968703">ast</span><span class="op" id="4968706">.</span><span class="ident" id="4968707">NewObj</span><span class="op" id="4968713">(</span><span class="ident" id="4968714">kind</span><span class="op" id="4968718">,</span>&nbsp;<span class="ident" id="4968720">ident</span><span class="op" id="4968725">.</span><span class="ident" id="4968726">Name</span><span class="op" id="4968730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968734">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968796">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968858">obj</span><span class="op" id="4968861">.</span><span class="ident" id="4968862">Decl</span>&nbsp;<span class="op" id="4968867">=</span>&nbsp;<span class="ident" id="4968869">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968876">obj</span><span class="op" id="4968879">.</span><span class="ident" id="4968880">Data</span>&nbsp;<span class="op" id="4968885">=</span>&nbsp;<span class="ident" id="4968887">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968894">ident</span><span class="op" id="4968899">.</span><span class="ident" id="4968900">Obj</span>&nbsp;<span class="op" id="4968904">=</span>&nbsp;<span class="ident" id="4968906">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968912">if</span>&nbsp;<span class="ident" id="4968915">ident</span><span class="op" id="4968920">.</span><span class="ident" id="4968921">Name</span>&nbsp;<span class="op" id="4968926">!=</span>&nbsp;<span class="string" id="4968929">&#34;_&#34;</span>&nbsp;<span class="op" id="4968933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4968938">if</span>&nbsp;<span class="ident" id="4968941">alt</span>&nbsp;<span class="op" id="4968945">:=</span>&nbsp;<span class="ident" id="4968948">scope</span><span class="op" id="4968953">.</span><span class="ident" id="4968954">Insert</span><span class="op" id="4968960">(</span><span class="ident" id="4968961">obj</span><span class="op" id="4968964">)</span><span class="op" id="4968965">;</span>&nbsp;<span class="ident" id="4968967">alt</span>&nbsp;<span class="op" id="4968971">!=</span>&nbsp;<span class="ident" id="4968974">nil</span>&nbsp;<span class="op" id="4968978">&amp;&amp;</span>&nbsp;<span class="ident" id="4968981">p</span><span class="op" id="4968982">.</span><span class="ident" id="4968983">mode</span><span class="op" id="4968987">&amp;</span><span class="ident" id="4968988">DeclarationErrors</span>&nbsp;<span class="op" id="4969006">!=</span>&nbsp;<span class="num" id="4969009">0</span>&nbsp;<span class="op" id="4969011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969017">prevDecl</span>&nbsp;<span class="op" id="4969026">:=</span>&nbsp;<span class="string" id="4969029">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969036">if</span>&nbsp;<span class="ident" id="4969039">pos</span>&nbsp;<span class="op" id="4969043">:=</span>&nbsp;<span class="ident" id="4969046">alt</span><span class="op" id="4969049">.</span><span class="ident" id="4969050">Pos</span><span class="op" id="4969053">(</span><span class="op" id="4969054">)</span><span class="op" id="4969055">;</span>&nbsp;<span class="ident" id="4969057">pos</span><span class="op" id="4969060">.</span><span class="ident" id="4969061">IsValid</span><span class="op" id="4969068">(</span><span class="op" id="4969069">)</span>&nbsp;<span class="op" id="4969071">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969078">prevDecl</span>&nbsp;<span class="op" id="4969087">=</span>&nbsp;<span class="ident" id="4969089">fmt</span><span class="op" id="4969092">.</span><span class="ident" id="4969093">Sprintf</span><span class="op" id="4969100">(</span><span class="string" id="4969101">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="4969133">,</span>&nbsp;<span class="ident" id="4969135">p</span><span class="op" id="4969136">.</span><span class="ident" id="4969137">file</span><span class="op" id="4969141">.</span><span class="ident" id="4969142">Position</span><span class="op" id="4969150">(</span><span class="ident" id="4969151">pos</span><span class="op" id="4969154">)</span><span class="op" id="4969155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969167">p</span><span class="op" id="4969168">.</span><span class="builtintype" id="4969169">error</span><span class="op" id="4969174">(</span><span class="ident" id="4969175">ident</span><span class="op" id="4969180">.</span><span class="ident" id="4969181">Pos</span><span class="op" id="4969184">(</span><span class="op" id="4969185">)</span><span class="op" id="4969186">,</span>&nbsp;<span class="ident" id="4969188">fmt</span><span class="op" id="4969191">.</span><span class="ident" id="4969192">Sprintf</span><span class="op" id="4969199">(</span><span class="string" id="4969200">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="4969231">,</span>&nbsp;<span class="ident" id="4969233">ident</span><span class="op" id="4969238">.</span><span class="ident" id="4969239">Name</span><span class="op" id="4969243">,</span>&nbsp;<span class="ident" id="4969245">prevDecl</span><span class="op" id="4969253">)</span><span class="op" id="4969254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969263">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969266">}</span><br>
<span class="lineno"></span><span class="op" id="4969268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4969271">func</span>&nbsp;<span class="op" id="4969276">(</span><span class="ident" id="4969277">p</span>&nbsp;<span class="op" id="4969279">*</span><span class="ident" id="4969280">parser</span><span class="op" id="4969286">)</span>&nbsp;<span class="ident" id="4969288">shortVarDecl</span><span class="op" id="4969300">(</span><span class="ident" id="4969301">decl</span>&nbsp;<span class="op" id="4969306">*</span><span class="ident" id="4969307">ast</span><span class="op" id="4969310">.</span><span class="ident" id="4969311">AssignStmt</span><span class="op" id="4969321">,</span>&nbsp;<span class="ident" id="4969323">list</span>&nbsp;<span class="op" id="4969328">[</span><span class="op" id="4969329">]</span><span class="ident" id="4969330">ast</span><span class="op" id="4969333">.</span><span class="ident" id="4969334">Expr</span><span class="op" id="4969338">)</span>&nbsp;<span class="op" id="4969340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969343">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969409">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969475">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969546">n</span>&nbsp;<span class="op" id="4969548">:=</span>&nbsp;<span class="num" id="4969551">0</span>&nbsp;<span class="comment" id="4969553">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969581">for</span>&nbsp;<span class="ident" id="4969585">_</span><span class="op" id="4969586">,</span>&nbsp;<span class="ident" id="4969588">x</span>&nbsp;<span class="op" id="4969590">:=</span>&nbsp;<span class="keyword" id="4969593">range</span>&nbsp;<span class="ident" id="4969599">list</span>&nbsp;<span class="op" id="4969604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969608">if</span>&nbsp;<span class="ident" id="4969611">ident</span><span class="op" id="4969616">,</span>&nbsp;<span class="ident" id="4969618">isIdent</span>&nbsp;<span class="op" id="4969626">:=</span>&nbsp;<span class="ident" id="4969629">x</span><span class="op" id="4969630">.</span><span class="op" id="4969631">(</span><span class="op" id="4969632">*</span><span class="ident" id="4969633">ast</span><span class="op" id="4969636">.</span><span class="ident" id="4969637">Ident</span><span class="op" id="4969642">)</span><span class="op" id="4969643">;</span>&nbsp;<span class="ident" id="4969645">isIdent</span>&nbsp;<span class="op" id="4969653">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969658">assert</span><span class="op" id="4969664">(</span><span class="ident" id="4969665">ident</span><span class="op" id="4969670">.</span><span class="ident" id="4969671">Obj</span>&nbsp;<span class="op" id="4969675">==</span>&nbsp;<span class="ident" id="4969678">nil</span><span class="op" id="4969681">,</span>&nbsp;<span class="string" id="4969683">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4969724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969729">obj</span>&nbsp;<span class="op" id="4969733">:=</span>&nbsp;<span class="ident" id="4969736">ast</span><span class="op" id="4969739">.</span><span class="ident" id="4969740">NewObj</span><span class="op" id="4969746">(</span><span class="ident" id="4969747">ast</span><span class="op" id="4969750">.</span><span class="ident" id="4969751">Var</span><span class="op" id="4969754">,</span>&nbsp;<span class="ident" id="4969756">ident</span><span class="op" id="4969761">.</span><span class="ident" id="4969762">Name</span><span class="op" id="4969766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969771">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969827">obj</span><span class="op" id="4969830">.</span><span class="ident" id="4969831">Decl</span>&nbsp;<span class="op" id="4969836">=</span>&nbsp;<span class="ident" id="4969838">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969846">ident</span><span class="op" id="4969851">.</span><span class="ident" id="4969852">Obj</span>&nbsp;<span class="op" id="4969856">=</span>&nbsp;<span class="ident" id="4969858">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969865">if</span>&nbsp;<span class="ident" id="4969868">ident</span><span class="op" id="4969873">.</span><span class="ident" id="4969874">Name</span>&nbsp;<span class="op" id="4969879">!=</span>&nbsp;<span class="string" id="4969882">&#34;_&#34;</span>&nbsp;<span class="op" id="4969886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969892">if</span>&nbsp;<span class="ident" id="4969895">alt</span>&nbsp;<span class="op" id="4969899">:=</span>&nbsp;<span class="ident" id="4969902">p</span><span class="op" id="4969903">.</span><span class="ident" id="4969904">topScope</span><span class="op" id="4969912">.</span><span class="ident" id="4969913">Insert</span><span class="op" id="4969919">(</span><span class="ident" id="4969920">obj</span><span class="op" id="4969923">)</span><span class="op" id="4969924">;</span>&nbsp;<span class="ident" id="4969926">alt</span>&nbsp;<span class="op" id="4969930">!=</span>&nbsp;<span class="ident" id="4969933">nil</span>&nbsp;<span class="op" id="4969937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969944">ident</span><span class="op" id="4969949">.</span><span class="ident" id="4969950">Obj</span>&nbsp;<span class="op" id="4969954">=</span>&nbsp;<span class="ident" id="4969956">alt</span>&nbsp;<span class="comment" id="4969960">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969981">}</span>&nbsp;<span class="keyword" id="4969983">else</span>&nbsp;<span class="op" id="4969988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969995">n</span><span class="op" id="4969996">++</span>&nbsp;<span class="comment" id="4969999">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970031">}</span>&nbsp;<span class="keyword" id="4970033">else</span>&nbsp;<span class="op" id="4970038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970043">p</span><span class="op" id="4970044">.</span><span class="ident" id="4970045">errorExpected</span><span class="op" id="4970058">(</span><span class="ident" id="4970059">x</span><span class="op" id="4970060">.</span><span class="ident" id="4970061">Pos</span><span class="op" id="4970064">(</span><span class="op" id="4970065">)</span><span class="op" id="4970066">,</span>&nbsp;<span class="string" id="4970068">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="4970099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970103">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970109">if</span>&nbsp;<span class="ident" id="4970112">n</span>&nbsp;<span class="op" id="4970114">==</span>&nbsp;<span class="num" id="4970117">0</span>&nbsp;<span class="op" id="4970119">&amp;&amp;</span>&nbsp;<span class="ident" id="4970122">p</span><span class="op" id="4970123">.</span><span class="ident" id="4970124">mode</span><span class="op" id="4970128">&amp;</span><span class="ident" id="4970129">DeclarationErrors</span>&nbsp;<span class="op" id="4970147">!=</span>&nbsp;<span class="num" id="4970150">0</span>&nbsp;<span class="op" id="4970152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970156">p</span><span class="op" id="4970157">.</span><span class="builtintype" id="4970158">error</span><span class="op" id="4970163">(</span><span class="ident" id="4970164">list</span><span class="op" id="4970168">[</span><span class="num" id="4970169">0</span><span class="op" id="4970170">]</span><span class="op" id="4970171">.</span><span class="ident" id="4970172">Pos</span><span class="op" id="4970175">(</span><span class="op" id="4970176">)</span><span class="op" id="4970177">,</span>&nbsp;<span class="string" id="4970179">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="4970216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970219">}</span><br>
<span class="lineno"></span><span class="op" id="4970221">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="4970224">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="4970304">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="4970386">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="4970411">var</span>&nbsp;<span class="ident" id="4970415">unresolved</span>&nbsp;<span class="op" id="4970426">=</span>&nbsp;<span class="builtinfunc" id="4970428">new</span><span class="op" id="4970431">(</span><span class="ident" id="4970432">ast</span><span class="op" id="4970435">.</span><span class="ident" id="4970436">Object</span><span class="op" id="4970442">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="4970445">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="4970518">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4970591">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="4970665">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="4970681">//</span><br>
<span class="lineno"></span><span class="keyword" id="4970684">func</span>&nbsp;<span class="op" id="4970689">(</span><span class="ident" id="4970690">p</span>&nbsp;<span class="op" id="4970692">*</span><span class="ident" id="4970693">parser</span><span class="op" id="4970699">)</span>&nbsp;<span class="ident" id="4970701">tryResolve</span><span class="op" id="4970711">(</span><span class="ident" id="4970712">x</span>&nbsp;<span class="ident" id="4970714">ast</span><span class="op" id="4970717">.</span><span class="ident" id="4970718">Expr</span><span class="op" id="4970722">,</span>&nbsp;<span class="ident" id="4970724">collectUnresolved</span>&nbsp;<span class="builtintype" id="4970742">bool</span><span class="op" id="4970746">)</span>&nbsp;<span class="op" id="4970748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4970751">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970819">ident</span><span class="op" id="4970824">,</span>&nbsp;<span class="ident" id="4970826">_</span>&nbsp;<span class="op" id="4970828">:=</span>&nbsp;<span class="ident" id="4970831">x</span><span class="op" id="4970832">.</span><span class="op" id="4970833">(</span><span class="op" id="4970834">*</span><span class="ident" id="4970835">ast</span><span class="op" id="4970838">.</span><span class="ident" id="4970839">Ident</span><span class="op" id="4970844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970847">if</span>&nbsp;<span class="ident" id="4970850">ident</span>&nbsp;<span class="op" id="4970856">==</span>&nbsp;<span class="ident" id="4970859">nil</span>&nbsp;<span class="op" id="4970863">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970867">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970878">assert</span><span class="op" id="4970884">(</span><span class="ident" id="4970885">ident</span><span class="op" id="4970890">.</span><span class="ident" id="4970891">Obj</span>&nbsp;<span class="op" id="4970895">==</span>&nbsp;<span class="ident" id="4970898">nil</span><span class="op" id="4970901">,</span>&nbsp;<span class="string" id="4970903">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="4970944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970947">if</span>&nbsp;<span class="ident" id="4970950">ident</span><span class="op" id="4970955">.</span><span class="ident" id="4970956">Name</span>&nbsp;<span class="op" id="4970961">==</span>&nbsp;<span class="string" id="4970964">&#34;_&#34;</span>&nbsp;<span class="op" id="4970968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970972">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4970983">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971017">for</span>&nbsp;<span class="ident" id="4971021">s</span>&nbsp;<span class="op" id="4971023">:=</span>&nbsp;<span class="ident" id="4971026">p</span><span class="op" id="4971027">.</span><span class="ident" id="4971028">topScope</span><span class="op" id="4971036">;</span>&nbsp;<span class="ident" id="4971038">s</span>&nbsp;<span class="op" id="4971040">!=</span>&nbsp;<span class="ident" id="4971043">nil</span><span class="op" id="4971046">;</span>&nbsp;<span class="ident" id="4971048">s</span>&nbsp;<span class="op" id="4971050">=</span>&nbsp;<span class="ident" id="4971052">s</span><span class="op" id="4971053">.</span><span class="ident" id="4971054">Outer</span>&nbsp;<span class="op" id="4971060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971064">if</span>&nbsp;<span class="ident" id="4971067">obj</span>&nbsp;<span class="op" id="4971071">:=</span>&nbsp;<span class="ident" id="4971074">s</span><span class="op" id="4971075">.</span><span class="ident" id="4971076">Lookup</span><span class="op" id="4971082">(</span><span class="ident" id="4971083">ident</span><span class="op" id="4971088">.</span><span class="ident" id="4971089">Name</span><span class="op" id="4971093">)</span><span class="op" id="4971094">;</span>&nbsp;<span class="ident" id="4971096">obj</span>&nbsp;<span class="op" id="4971100">!=</span>&nbsp;<span class="ident" id="4971103">nil</span>&nbsp;<span class="op" id="4971107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971112">ident</span><span class="op" id="4971117">.</span><span class="ident" id="4971118">Obj</span>&nbsp;<span class="op" id="4971122">=</span>&nbsp;<span class="ident" id="4971124">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971131">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971146">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971207">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971265">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971326">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971370">if</span>&nbsp;<span class="ident" id="4971373">collectUnresolved</span>&nbsp;<span class="op" id="4971391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971395">ident</span><span class="op" id="4971400">.</span><span class="ident" id="4971401">Obj</span>&nbsp;<span class="op" id="4971405">=</span>&nbsp;<span class="ident" id="4971407">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971420">p</span><span class="op" id="4971421">.</span><span class="ident" id="4971422">unresolved</span>&nbsp;<span class="op" id="4971433">=</span>&nbsp;<span class="builtinfunc" id="4971435">append</span><span class="op" id="4971441">(</span><span class="ident" id="4971442">p</span><span class="op" id="4971443">.</span><span class="ident" id="4971444">unresolved</span><span class="op" id="4971454">,</span>&nbsp;<span class="ident" id="4971456">ident</span><span class="op" id="4971461">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971464">}</span><br>
<span class="lineno"></span><span class="op" id="4971466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4971469">func</span>&nbsp;<span class="op" id="4971474">(</span><span class="ident" id="4971475">p</span>&nbsp;<span class="op" id="4971477">*</span><span class="ident" id="4971478">parser</span><span class="op" id="4971484">)</span>&nbsp;<span class="ident" id="4971486">resolve</span><span class="op" id="4971493">(</span><span class="ident" id="4971494">x</span>&nbsp;<span class="ident" id="4971496">ast</span><span class="op" id="4971499">.</span><span class="ident" id="4971500">Expr</span><span class="op" id="4971504">)</span>&nbsp;<span class="op" id="4971506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971509">p</span><span class="op" id="4971510">.</span><span class="ident" id="4971511">tryResolve</span><span class="op" id="4971521">(</span><span class="ident" id="4971522">x</span><span class="op" id="4971523">,</span>&nbsp;<span class="builtintype" id="4971525">true</span><span class="op" id="4971529">)</span><br>
<span class="lineno">200</span><span class="op" id="4971531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4971534">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4971614">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="4971634">func</span>&nbsp;<span class="op" id="4971639">(</span><span class="ident" id="4971640">p</span>&nbsp;<span class="op" id="4971642">*</span><span class="ident" id="4971643">parser</span><span class="op" id="4971649">)</span>&nbsp;<span class="ident" id="4971651">printTrace</span><span class="op" id="4971661">(</span><span class="ident" id="4971662">a</span>&nbsp;<span class="op" id="4971664">...</span><span class="keyword" id="4971667">interface</span><span class="op" id="4971676">{</span><span class="op" id="4971677">}</span><span class="op" id="4971678">)</span>&nbsp;<span class="op" id="4971680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971683">const</span>&nbsp;<span class="ident" id="4971689">dots</span>&nbsp;<span class="op" id="4971694">=</span>&nbsp;<span class="string" id="4971696">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971764">const</span>&nbsp;<span class="ident" id="4971770">n</span>&nbsp;<span class="op" id="4971772">=</span>&nbsp;<span class="builtinfunc" id="4971774">len</span><span class="op" id="4971777">(</span><span class="ident" id="4971778">dots</span><span class="op" id="4971782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971785">pos</span>&nbsp;<span class="op" id="4971789">:=</span>&nbsp;<span class="ident" id="4971792">p</span><span class="op" id="4971793">.</span><span class="ident" id="4971794">file</span><span class="op" id="4971798">.</span><span class="ident" id="4971799">Position</span><span class="op" id="4971807">(</span><span class="ident" id="4971808">p</span><span class="op" id="4971809">.</span><span class="ident" id="4971810">pos</span><span class="op" id="4971813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971816">fmt</span><span class="op" id="4971819">.</span><span class="ident" id="4971820">Printf</span><span class="op" id="4971826">(</span><span class="string" id="4971827">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="4971838">,</span>&nbsp;<span class="ident" id="4971840">pos</span><span class="op" id="4971843">.</span><span class="ident" id="4971844">Line</span><span class="op" id="4971848">,</span>&nbsp;<span class="ident" id="4971850">pos</span><span class="op" id="4971853">.</span><span class="ident" id="4971854">Column</span><span class="op" id="4971860">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971863">i</span>&nbsp;<span class="op" id="4971865">:=</span>&nbsp;<span class="num" id="4971868">2</span>&nbsp;<span class="op" id="4971870">*</span>&nbsp;<span class="ident" id="4971872">p</span><span class="op" id="4971873">.</span><span class="ident" id="4971874">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971882">for</span>&nbsp;<span class="ident" id="4971886">i</span>&nbsp;<span class="op" id="4971888">&gt;</span>&nbsp;<span class="ident" id="4971890">n</span>&nbsp;<span class="op" id="4971892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971896">fmt</span><span class="op" id="4971899">.</span><span class="ident" id="4971900">Print</span><span class="op" id="4971905">(</span><span class="ident" id="4971906">dots</span><span class="op" id="4971910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971914">i</span>&nbsp;<span class="op" id="4971916">-=</span>&nbsp;<span class="ident" id="4971919">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971922">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971925">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971936">fmt</span><span class="op" id="4971939">.</span><span class="ident" id="4971940">Print</span><span class="op" id="4971945">(</span><span class="ident" id="4971946">dots</span><span class="op" id="4971950">[</span><span class="num" id="4971951">0</span><span class="op" id="4971952">:</span><span class="ident" id="4971953">i</span><span class="op" id="4971954">]</span><span class="op" id="4971955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971958">fmt</span><span class="op" id="4971961">.</span><span class="ident" id="4971962">Println</span><span class="op" id="4971969">(</span><span class="ident" id="4971970">a</span><span class="op" id="4971971">...</span><span class="op" id="4971974">)</span><br>
<span class="lineno"></span><span class="op" id="4971976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="4971979">func</span>&nbsp;<span class="ident" id="4971984">trace</span><span class="op" id="4971989">(</span><span class="ident" id="4971990">p</span>&nbsp;<span class="op" id="4971992">*</span><span class="ident" id="4971993">parser</span><span class="op" id="4971999">,</span>&nbsp;<span class="ident" id="4972001">msg</span>&nbsp;<span class="builtintype" id="4972005">string</span><span class="op" id="4972011">)</span>&nbsp;<span class="op" id="4972013">*</span><span class="ident" id="4972014">parser</span>&nbsp;<span class="op" id="4972021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972024">p</span><span class="op" id="4972025">.</span><span class="ident" id="4972026">printTrace</span><span class="op" id="4972036">(</span><span class="ident" id="4972037">msg</span><span class="op" id="4972040">,</span>&nbsp;<span class="string" id="4972042">&#34;(&#34;</span><span class="op" id="4972045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972048">p</span><span class="op" id="4972049">.</span><span class="ident" id="4972050">indent</span><span class="op" id="4972056">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972060">return</span>&nbsp;<span class="ident" id="4972067">p</span><br>
<span class="lineno"></span><span class="op" id="4972069">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="4972072">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="4972116">func</span>&nbsp;<span class="ident" id="4972121">un</span><span class="op" id="4972123">(</span><span class="ident" id="4972124">p</span>&nbsp;<span class="op" id="4972126">*</span><span class="ident" id="4972127">parser</span><span class="op" id="4972133">)</span>&nbsp;<span class="op" id="4972135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972138">p</span><span class="op" id="4972139">.</span><span class="ident" id="4972140">indent</span><span class="op" id="4972146">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972150">p</span><span class="op" id="4972151">.</span><span class="ident" id="4972152">printTrace</span><span class="op" id="4972162">(</span><span class="string" id="4972163">&#34;)&#34;</span><span class="op" id="4972166">)</span><br>
<span class="lineno">230</span><span class="op" id="4972168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4972171">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="4972201">func</span>&nbsp;<span class="op" id="4972206">(</span><span class="ident" id="4972207">p</span>&nbsp;<span class="op" id="4972209">*</span><span class="ident" id="4972210">parser</span><span class="op" id="4972216">)</span>&nbsp;<span class="ident" id="4972218">next0</span><span class="op" id="4972223">(</span><span class="op" id="4972224">)</span>&nbsp;<span class="op" id="4972226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4972229">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4972291">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4972351">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4972410">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972457">if</span>&nbsp;<span class="ident" id="4972460">p</span><span class="op" id="4972461">.</span><span class="ident" id="4972462">trace</span>&nbsp;<span class="op" id="4972468">&amp;&amp;</span>&nbsp;<span class="ident" id="4972471">p</span><span class="op" id="4972472">.</span><span class="ident" id="4972473">pos</span><span class="op" id="4972476">.</span><span class="ident" id="4972477">IsValid</span><span class="op" id="4972484">(</span><span class="op" id="4972485">)</span>&nbsp;<span class="op" id="4972487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972491">s</span>&nbsp;<span class="op" id="4972493">:=</span>&nbsp;<span class="ident" id="4972496">p</span><span class="op" id="4972497">.</span><span class="ident" id="4972498">tok</span><span class="op" id="4972501">.</span><span class="ident" id="4972502">String</span><span class="op" id="4972508">(</span><span class="op" id="4972509">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972513">switch</span>&nbsp;<span class="op" id="4972520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972524">case</span>&nbsp;<span class="ident" id="4972529">p</span><span class="op" id="4972530">.</span><span class="ident" id="4972531">tok</span><span class="op" id="4972534">.</span><span class="ident" id="4972535">IsLiteral</span><span class="op" id="4972544">(</span><span class="op" id="4972545">)</span><span class="op" id="4972546">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972551">p</span><span class="op" id="4972552">.</span><span class="ident" id="4972553">printTrace</span><span class="op" id="4972563">(</span><span class="ident" id="4972564">s</span><span class="op" id="4972565">,</span>&nbsp;<span class="ident" id="4972567">p</span><span class="op" id="4972568">.</span><span class="ident" id="4972569">lit</span><span class="op" id="4972572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972576">case</span>&nbsp;<span class="ident" id="4972581">p</span><span class="op" id="4972582">.</span><span class="ident" id="4972583">tok</span><span class="op" id="4972586">.</span><span class="ident" id="4972587">IsOperator</span><span class="op" id="4972597">(</span><span class="op" id="4972598">)</span><span class="op" id="4972599">,</span>&nbsp;<span class="ident" id="4972601">p</span><span class="op" id="4972602">.</span><span class="ident" id="4972603">tok</span><span class="op" id="4972606">.</span><span class="ident" id="4972607">IsKeyword</span><span class="op" id="4972616">(</span><span class="op" id="4972617">)</span><span class="op" id="4972618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972623">p</span><span class="op" id="4972624">.</span><span class="ident" id="4972625">printTrace</span><span class="op" id="4972635">(</span><span class="string" id="4972636">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="4972641">+</span>&nbsp;<span class="ident" id="4972643">s</span>&nbsp;<span class="op" id="4972645">+</span>&nbsp;<span class="string" id="4972647">&#34;\&#34;&#34;</span><span class="op" id="4972651">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972655">default</span><span class="op" id="4972662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972667">p</span><span class="op" id="4972668">.</span><span class="ident" id="4972669">printTrace</span><span class="op" id="4972679">(</span><span class="ident" id="4972680">s</span><span class="op" id="4972681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972692">p</span><span class="op" id="4972693">.</span><span class="ident" id="4972694">pos</span><span class="op" id="4972697">,</span>&nbsp;<span class="ident" id="4972699">p</span><span class="op" id="4972700">.</span><span class="ident" id="4972701">tok</span><span class="op" id="4972704">,</span>&nbsp;<span class="ident" id="4972706">p</span><span class="op" id="4972707">.</span><span class="ident" id="4972708">lit</span>&nbsp;<span class="op" id="4972712">=</span>&nbsp;<span class="ident" id="4972714">p</span><span class="op" id="4972715">.</span><span class="ident" id="4972716">scanner</span><span class="op" id="4972723">.</span><span class="ident" id="4972724">Scan</span><span class="op" id="4972728">(</span><span class="op" id="4972729">)</span><br>
<span class="lineno"></span><span class="op" id="4972731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4972734">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="4972800">func</span>&nbsp;<span class="op" id="4972805">(</span><span class="ident" id="4972806">p</span>&nbsp;<span class="op" id="4972808">*</span><span class="ident" id="4972809">parser</span><span class="op" id="4972815">)</span>&nbsp;<span class="ident" id="4972817">consumeComment</span><span class="op" id="4972831">(</span><span class="op" id="4972832">)</span>&nbsp;<span class="op" id="4972834">(</span><span class="ident" id="4972835">comment</span>&nbsp;<span class="op" id="4972843">*</span><span class="ident" id="4972844">ast</span><span class="op" id="4972847">.</span><span class="ident" id="4972848">Comment</span><span class="op" id="4972855">,</span>&nbsp;<span class="ident" id="4972857">endline</span>&nbsp;<span class="builtintype" id="4972865">int</span><span class="op" id="4972868">)</span>&nbsp;<span class="op" id="4972870">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4972873">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4972946">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973014">endline</span>&nbsp;<span class="op" id="4973022">=</span>&nbsp;<span class="ident" id="4973024">p</span><span class="op" id="4973025">.</span><span class="ident" id="4973026">file</span><span class="op" id="4973030">.</span><span class="ident" id="4973031">Line</span><span class="op" id="4973035">(</span><span class="ident" id="4973036">p</span><span class="op" id="4973037">.</span><span class="ident" id="4973038">pos</span><span class="op" id="4973041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973044">if</span>&nbsp;<span class="ident" id="4973047">p</span><span class="op" id="4973048">.</span><span class="ident" id="4973049">lit</span><span class="op" id="4973052">[</span><span class="num" id="4973053">1</span><span class="op" id="4973054">]</span>&nbsp;<span class="op" id="4973056">==</span>&nbsp;<span class="string" id="4973059">&#39;*&#39;</span>&nbsp;<span class="op" id="4973063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4973067">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973133">for</span>&nbsp;<span class="ident" id="4973137">i</span>&nbsp;<span class="op" id="4973139">:=</span>&nbsp;<span class="num" id="4973142">0</span><span class="op" id="4973143">;</span>&nbsp;<span class="ident" id="4973145">i</span>&nbsp;<span class="op" id="4973147">&lt;</span>&nbsp;<span class="builtinfunc" id="4973149">len</span><span class="op" id="4973152">(</span><span class="ident" id="4973153">p</span><span class="op" id="4973154">.</span><span class="ident" id="4973155">lit</span><span class="op" id="4973158">)</span><span class="op" id="4973159">;</span>&nbsp;<span class="ident" id="4973161">i</span><span class="op" id="4973162">++</span>&nbsp;<span class="op" id="4973165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973170">if</span>&nbsp;<span class="ident" id="4973173">p</span><span class="op" id="4973174">.</span><span class="ident" id="4973175">lit</span><span class="op" id="4973178">[</span><span class="ident" id="4973179">i</span><span class="op" id="4973180">]</span>&nbsp;<span class="op" id="4973182">==</span>&nbsp;<span class="string" id="4973185">&#39;\n&#39;</span>&nbsp;<span class="op" id="4973190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973196">endline</span><span class="op" id="4973203">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973213">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973220">comment</span>&nbsp;<span class="op" id="4973228">=</span>&nbsp;<span class="op" id="4973230">&amp;</span><span class="ident" id="4973231">ast</span><span class="op" id="4973234">.</span><span class="ident" id="4973235">Comment</span><span class="op" id="4973242">{</span><span class="ident" id="4973243">Slash</span><span class="op" id="4973248">:</span>&nbsp;<span class="ident" id="4973250">p</span><span class="op" id="4973251">.</span><span class="ident" id="4973252">pos</span><span class="op" id="4973255">,</span>&nbsp;<span class="ident" id="4973257">Text</span><span class="op" id="4973261">:</span>&nbsp;<span class="ident" id="4973263">p</span><span class="op" id="4973264">.</span><span class="ident" id="4973265">lit</span><span class="op" id="4973268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973271">p</span><span class="op" id="4973272">.</span><span class="ident" id="4973273">next0</span><span class="op" id="4973278">(</span><span class="op" id="4973279">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973283">return</span><br>
<span class="lineno"></span><span class="op" id="4973290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4973293">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4973357">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="4973421">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4973485">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="4973527">//</span><br>
<span class="lineno"></span><span class="keyword" id="4973530">func</span>&nbsp;<span class="op" id="4973535">(</span><span class="ident" id="4973536">p</span>&nbsp;<span class="op" id="4973538">*</span><span class="ident" id="4973539">parser</span><span class="op" id="4973545">)</span>&nbsp;<span class="ident" id="4973547">consumeCommentGroup</span><span class="op" id="4973566">(</span><span class="ident" id="4973567">n</span>&nbsp;<span class="builtintype" id="4973569">int</span><span class="op" id="4973572">)</span>&nbsp;<span class="op" id="4973574">(</span><span class="ident" id="4973575">comments</span>&nbsp;<span class="op" id="4973584">*</span><span class="ident" id="4973585">ast</span><span class="op" id="4973588">.</span><span class="ident" id="4973589">CommentGroup</span><span class="op" id="4973601">,</span>&nbsp;<span class="ident" id="4973603">endline</span>&nbsp;<span class="builtintype" id="4973611">int</span><span class="op" id="4973614">)</span>&nbsp;<span class="op" id="4973616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973619">var</span>&nbsp;<span class="ident" id="4973623">list</span>&nbsp;<span class="op" id="4973628">[</span><span class="op" id="4973629">]</span><span class="op" id="4973630">*</span><span class="ident" id="4973631">ast</span><span class="op" id="4973634">.</span><span class="ident" id="4973635">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973644">endline</span>&nbsp;<span class="op" id="4973652">=</span>&nbsp;<span class="ident" id="4973654">p</span><span class="op" id="4973655">.</span><span class="ident" id="4973656">file</span><span class="op" id="4973660">.</span><span class="ident" id="4973661">Line</span><span class="op" id="4973665">(</span><span class="ident" id="4973666">p</span><span class="op" id="4973667">.</span><span class="ident" id="4973668">pos</span><span class="op" id="4973671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973674">for</span>&nbsp;<span class="ident" id="4973678">p</span><span class="op" id="4973679">.</span><span class="ident" id="4973680">tok</span>&nbsp;<span class="op" id="4973684">==</span>&nbsp;<span class="ident" id="4973687">token</span><span class="op" id="4973692">.</span><span class="ident" id="4973693">COMMENT</span>&nbsp;<span class="op" id="4973701">&amp;&amp;</span>&nbsp;<span class="ident" id="4973704">p</span><span class="op" id="4973705">.</span><span class="ident" id="4973706">file</span><span class="op" id="4973710">.</span><span class="ident" id="4973711">Line</span><span class="op" id="4973715">(</span><span class="ident" id="4973716">p</span><span class="op" id="4973717">.</span><span class="ident" id="4973718">pos</span><span class="op" id="4973721">)</span>&nbsp;<span class="op" id="4973723">&lt;=</span>&nbsp;<span class="ident" id="4973726">endline</span><span class="op" id="4973733">+</span><span class="ident" id="4973734">n</span>&nbsp;<span class="op" id="4973736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973740">var</span>&nbsp;<span class="ident" id="4973744">comment</span>&nbsp;<span class="op" id="4973752">*</span><span class="ident" id="4973753">ast</span><span class="op" id="4973756">.</span><span class="ident" id="4973757">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973767">comment</span><span class="op" id="4973774">,</span>&nbsp;<span class="ident" id="4973776">endline</span>&nbsp;<span class="op" id="4973784">=</span>&nbsp;<span class="ident" id="4973786">p</span><span class="op" id="4973787">.</span><span class="ident" id="4973788">consumeComment</span><span class="op" id="4973802">(</span><span class="op" id="4973803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973807">list</span>&nbsp;<span class="op" id="4973812">=</span>&nbsp;<span class="builtinfunc" id="4973814">append</span><span class="op" id="4973820">(</span><span class="ident" id="4973821">list</span><span class="op" id="4973825">,</span>&nbsp;<span class="ident" id="4973827">comment</span><span class="op" id="4973834">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4973841">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973884">comments</span>&nbsp;<span class="op" id="4973893">=</span>&nbsp;<span class="op" id="4973895">&amp;</span><span class="ident" id="4973896">ast</span><span class="op" id="4973899">.</span><span class="ident" id="4973900">CommentGroup</span><span class="op" id="4973912">{</span><span class="ident" id="4973913">List</span><span class="op" id="4973917">:</span>&nbsp;<span class="ident" id="4973919">list</span><span class="op" id="4973923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973926">p</span><span class="op" id="4973927">.</span><span class="ident" id="4973928">comments</span>&nbsp;<span class="op" id="4973937">=</span>&nbsp;<span class="builtinfunc" id="4973939">append</span><span class="op" id="4973945">(</span><span class="ident" id="4973946">p</span><span class="op" id="4973947">.</span><span class="ident" id="4973948">comments</span><span class="op" id="4973956">,</span>&nbsp;<span class="ident" id="4973958">comments</span><span class="op" id="4973966">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973970">return</span><br>
<span class="lineno"></span><span class="op" id="4973977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4973980">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="4974046">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4974112">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4974134">//</span><br>
<span class="lineno"></span><span class="comment" id="4974137">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4974200">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="4974271">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="4974329">//</span><br>
<span class="lineno"></span><span class="comment" id="4974332">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="4974396">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4974467">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="4974485">//</span><br>
<span class="lineno"></span><span class="comment" id="4974488">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4974554">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="4974576">//</span><br>
<span class="lineno"></span><span class="keyword" id="4974579">func</span>&nbsp;<span class="op" id="4974584">(</span><span class="ident" id="4974585">p</span>&nbsp;<span class="op" id="4974587">*</span><span class="ident" id="4974588">parser</span><span class="op" id="4974594">)</span>&nbsp;<span class="ident" id="4974596">next</span><span class="op" id="4974600">(</span><span class="op" id="4974601">)</span>&nbsp;<span class="op" id="4974603">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974606">p</span><span class="op" id="4974607">.</span><span class="ident" id="4974608">leadComment</span>&nbsp;<span class="op" id="4974620">=</span>&nbsp;<span class="ident" id="4974622">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974627">p</span><span class="op" id="4974628">.</span><span class="ident" id="4974629">lineComment</span>&nbsp;<span class="op" id="4974641">=</span>&nbsp;<span class="ident" id="4974643">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974648">prev</span>&nbsp;<span class="op" id="4974653">:=</span>&nbsp;<span class="ident" id="4974656">p</span><span class="op" id="4974657">.</span><span class="ident" id="4974658">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974663">p</span><span class="op" id="4974664">.</span><span class="ident" id="4974665">next0</span><span class="op" id="4974670">(</span><span class="op" id="4974671">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974675">if</span>&nbsp;<span class="ident" id="4974678">p</span><span class="op" id="4974679">.</span><span class="ident" id="4974680">tok</span>&nbsp;<span class="op" id="4974684">==</span>&nbsp;<span class="ident" id="4974687">token</span><span class="op" id="4974692">.</span><span class="ident" id="4974693">COMMENT</span>&nbsp;<span class="op" id="4974701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974705">var</span>&nbsp;<span class="ident" id="4974709">comment</span>&nbsp;<span class="op" id="4974717">*</span><span class="ident" id="4974718">ast</span><span class="op" id="4974721">.</span><span class="ident" id="4974722">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974737">var</span>&nbsp;<span class="ident" id="4974741">endline</span>&nbsp;<span class="builtintype" id="4974749">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974756">if</span>&nbsp;<span class="ident" id="4974759">p</span><span class="op" id="4974760">.</span><span class="ident" id="4974761">file</span><span class="op" id="4974765">.</span><span class="ident" id="4974766">Line</span><span class="op" id="4974770">(</span><span class="ident" id="4974771">p</span><span class="op" id="4974772">.</span><span class="ident" id="4974773">pos</span><span class="op" id="4974776">)</span>&nbsp;<span class="op" id="4974778">==</span>&nbsp;<span class="ident" id="4974781">p</span><span class="op" id="4974782">.</span><span class="ident" id="4974783">file</span><span class="op" id="4974787">.</span><span class="ident" id="4974788">Line</span><span class="op" id="4974792">(</span><span class="ident" id="4974793">prev</span><span class="op" id="4974797">)</span>&nbsp;<span class="op" id="4974799">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4974804">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4974864">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4974922">comment</span><span class="op" id="4974929">,</span>&nbsp;<span class="ident" id="4974931">endline</span>&nbsp;<span class="op" id="4974939">=</span>&nbsp;<span class="ident" id="4974941">p</span><span class="op" id="4974942">.</span><span class="ident" id="4974943">consumeCommentGroup</span><span class="op" id="4974962">(</span><span class="num" id="4974963">0</span><span class="op" id="4974964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974969">if</span>&nbsp;<span class="ident" id="4974972">p</span><span class="op" id="4974973">.</span><span class="ident" id="4974974">file</span><span class="op" id="4974978">.</span><span class="ident" id="4974979">Line</span><span class="op" id="4974983">(</span><span class="ident" id="4974984">p</span><span class="op" id="4974985">.</span><span class="ident" id="4974986">pos</span><span class="op" id="4974989">)</span>&nbsp;<span class="op" id="4974991">!=</span>&nbsp;<span class="ident" id="4974994">endline</span>&nbsp;<span class="op" id="4975002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975008">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975059">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975108">p</span><span class="op" id="4975109">.</span><span class="ident" id="4975110">lineComment</span>&nbsp;<span class="op" id="4975122">=</span>&nbsp;<span class="ident" id="4975124">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975144">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975184">endline</span>&nbsp;<span class="op" id="4975192">=</span>&nbsp;<span class="op" id="4975194">-</span><span class="num" id="4975195">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975199">for</span>&nbsp;<span class="ident" id="4975203">p</span><span class="op" id="4975204">.</span><span class="ident" id="4975205">tok</span>&nbsp;<span class="op" id="4975209">==</span>&nbsp;<span class="ident" id="4975212">token</span><span class="op" id="4975217">.</span><span class="ident" id="4975218">COMMENT</span>&nbsp;<span class="op" id="4975226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975231">comment</span><span class="op" id="4975238">,</span>&nbsp;<span class="ident" id="4975240">endline</span>&nbsp;<span class="op" id="4975248">=</span>&nbsp;<span class="ident" id="4975250">p</span><span class="op" id="4975251">.</span><span class="ident" id="4975252">consumeCommentGroup</span><span class="op" id="4975271">(</span><span class="num" id="4975272">1</span><span class="op" id="4975273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975277">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975282">if</span>&nbsp;<span class="ident" id="4975285">endline</span><span class="op" id="4975292">+</span><span class="num" id="4975293">1</span>&nbsp;<span class="op" id="4975295">==</span>&nbsp;<span class="ident" id="4975298">p</span><span class="op" id="4975299">.</span><span class="ident" id="4975300">file</span><span class="op" id="4975304">.</span><span class="ident" id="4975305">Line</span><span class="op" id="4975309">(</span><span class="ident" id="4975310">p</span><span class="op" id="4975311">.</span><span class="ident" id="4975312">pos</span><span class="op" id="4975315">)</span>&nbsp;<span class="op" id="4975317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975322">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975390">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975458">p</span><span class="op" id="4975459">.</span><span class="ident" id="4975460">leadComment</span>&nbsp;<span class="op" id="4975472">=</span>&nbsp;<span class="ident" id="4975474">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975487">}</span><br>
<span class="lineno"></span><span class="op" id="4975489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4975492">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="4975552">type</span>&nbsp;<span class="ident" id="4975557">bailout</span>&nbsp;<span class="keyword" id="4975565">struct</span><span class="op" id="4975571">{</span><span class="op" id="4975572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4975575">func</span>&nbsp;<span class="op" id="4975580">(</span><span class="ident" id="4975581">p</span>&nbsp;<span class="op" id="4975583">*</span><span class="ident" id="4975584">parser</span><span class="op" id="4975590">)</span>&nbsp;<span class="builtintype" id="4975592">error</span><span class="op" id="4975597">(</span><span class="ident" id="4975598">pos</span>&nbsp;<span class="ident" id="4975602">token</span><span class="op" id="4975607">.</span><span class="ident" id="4975608">Pos</span><span class="op" id="4975611">,</span>&nbsp;<span class="ident" id="4975613">msg</span>&nbsp;<span class="builtintype" id="4975617">string</span><span class="op" id="4975623">)</span>&nbsp;<span class="op" id="4975625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975628">epos</span>&nbsp;<span class="op" id="4975633">:=</span>&nbsp;<span class="ident" id="4975636">p</span><span class="op" id="4975637">.</span><span class="ident" id="4975638">file</span><span class="op" id="4975642">.</span><span class="ident" id="4975643">Position</span><span class="op" id="4975651">(</span><span class="ident" id="4975652">pos</span><span class="op" id="4975655">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975659">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975729">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4975800">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975815">if</span>&nbsp;<span class="ident" id="4975818">p</span><span class="op" id="4975819">.</span><span class="ident" id="4975820">mode</span><span class="op" id="4975824">&amp;</span><span class="ident" id="4975825">AllErrors</span>&nbsp;<span class="op" id="4975835">==</span>&nbsp;<span class="num" id="4975838">0</span>&nbsp;<span class="op" id="4975840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975844">n</span>&nbsp;<span class="op" id="4975846">:=</span>&nbsp;<span class="builtinfunc" id="4975849">len</span><span class="op" id="4975852">(</span><span class="ident" id="4975853">p</span><span class="op" id="4975854">.</span><span class="ident" id="4975855">errors</span><span class="op" id="4975861">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975865">if</span>&nbsp;<span class="ident" id="4975868">n</span>&nbsp;<span class="op" id="4975870">&gt;</span>&nbsp;<span class="num" id="4975872">0</span>&nbsp;<span class="op" id="4975874">&amp;&amp;</span>&nbsp;<span class="ident" id="4975877">p</span><span class="op" id="4975878">.</span><span class="ident" id="4975879">errors</span><span class="op" id="4975885">[</span><span class="ident" id="4975886">n</span><span class="op" id="4975887">-</span><span class="num" id="4975888">1</span><span class="op" id="4975889">]</span><span class="op" id="4975890">.</span><span class="ident" id="4975891">Pos</span><span class="op" id="4975894">.</span><span class="ident" id="4975895">Line</span>&nbsp;<span class="op" id="4975900">==</span>&nbsp;<span class="ident" id="4975903">epos</span><span class="op" id="4975907">.</span><span class="ident" id="4975908">Line</span>&nbsp;<span class="op" id="4975913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975918">return</span>&nbsp;<span class="comment" id="4975925">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4975964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4975968">if</span>&nbsp;<span class="ident" id="4975971">n</span>&nbsp;<span class="op" id="4975973">&gt;</span>&nbsp;<span class="num" id="4975975">10</span>&nbsp;<span class="op" id="4975978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4975983">panic</span><span class="op" id="4975988">(</span><span class="ident" id="4975989">bailout</span><span class="op" id="4975996">{</span><span class="op" id="4975997">}</span><span class="op" id="4975998">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976009">p</span><span class="op" id="4976010">.</span><span class="ident" id="4976011">errors</span><span class="op" id="4976017">.</span><span class="ident" id="4976018">Add</span><span class="op" id="4976021">(</span><span class="ident" id="4976022">epos</span><span class="op" id="4976026">,</span>&nbsp;<span class="ident" id="4976028">msg</span><span class="op" id="4976031">)</span><br>
<span class="lineno"></span><span class="op" id="4976033">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="4976036">func</span>&nbsp;<span class="op" id="4976041">(</span><span class="ident" id="4976042">p</span>&nbsp;<span class="op" id="4976044">*</span><span class="ident" id="4976045">parser</span><span class="op" id="4976051">)</span>&nbsp;<span class="ident" id="4976053">errorExpected</span><span class="op" id="4976066">(</span><span class="ident" id="4976067">pos</span>&nbsp;<span class="ident" id="4976071">token</span><span class="op" id="4976076">.</span><span class="ident" id="4976077">Pos</span><span class="op" id="4976080">,</span>&nbsp;<span class="ident" id="4976082">msg</span>&nbsp;<span class="builtintype" id="4976086">string</span><span class="op" id="4976092">)</span>&nbsp;<span class="op" id="4976094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976097">msg</span>&nbsp;<span class="op" id="4976101">=</span>&nbsp;<span class="string" id="4976103">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="4976115">+</span>&nbsp;<span class="ident" id="4976117">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976122">if</span>&nbsp;<span class="ident" id="4976125">pos</span>&nbsp;<span class="op" id="4976129">==</span>&nbsp;<span class="ident" id="4976132">p</span><span class="op" id="4976133">.</span><span class="ident" id="4976134">pos</span>&nbsp;<span class="op" id="4976138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4976142">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4976191">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976233">if</span>&nbsp;<span class="ident" id="4976236">p</span><span class="op" id="4976237">.</span><span class="ident" id="4976238">tok</span>&nbsp;<span class="op" id="4976242">==</span>&nbsp;<span class="ident" id="4976245">token</span><span class="op" id="4976250">.</span><span class="ident" id="4976251">SEMICOLON</span>&nbsp;<span class="op" id="4976261">&amp;&amp;</span>&nbsp;<span class="ident" id="4976264">p</span><span class="op" id="4976265">.</span><span class="ident" id="4976266">lit</span>&nbsp;<span class="op" id="4976270">==</span>&nbsp;<span class="string" id="4976273">&#34;\n&#34;</span>&nbsp;<span class="op" id="4976278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976283">msg</span>&nbsp;<span class="op" id="4976287">+=</span>&nbsp;<span class="string" id="4976290">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976310">}</span>&nbsp;<span class="keyword" id="4976312">else</span>&nbsp;<span class="op" id="4976317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976322">msg</span>&nbsp;<span class="op" id="4976326">+=</span>&nbsp;<span class="string" id="4976329">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="4976341">+</span>&nbsp;<span class="ident" id="4976343">p</span><span class="op" id="4976344">.</span><span class="ident" id="4976345">tok</span><span class="op" id="4976348">.</span><span class="ident" id="4976349">String</span><span class="op" id="4976355">(</span><span class="op" id="4976356">)</span>&nbsp;<span class="op" id="4976358">+</span>&nbsp;<span class="string" id="4976360">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976367">if</span>&nbsp;<span class="ident" id="4976370">p</span><span class="op" id="4976371">.</span><span class="ident" id="4976372">tok</span><span class="op" id="4976375">.</span><span class="ident" id="4976376">IsLiteral</span><span class="op" id="4976385">(</span><span class="op" id="4976386">)</span>&nbsp;<span class="op" id="4976388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976394">msg</span>&nbsp;<span class="op" id="4976398">+=</span>&nbsp;<span class="string" id="4976401">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4976405">+</span>&nbsp;<span class="ident" id="4976407">p</span><span class="op" id="4976408">.</span><span class="ident" id="4976409">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976423">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976426">p</span><span class="op" id="4976427">.</span><span class="builtintype" id="4976428">error</span><span class="op" id="4976433">(</span><span class="ident" id="4976434">pos</span><span class="op" id="4976437">,</span>&nbsp;<span class="ident" id="4976439">msg</span><span class="op" id="4976442">)</span><br>
<span class="lineno"></span><span class="op" id="4976444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4976447">func</span>&nbsp;<span class="op" id="4976452">(</span><span class="ident" id="4976453">p</span>&nbsp;<span class="op" id="4976455">*</span><span class="ident" id="4976456">parser</span><span class="op" id="4976462">)</span>&nbsp;<span class="ident" id="4976464">expect</span><span class="op" id="4976470">(</span><span class="ident" id="4976471">tok</span>&nbsp;<span class="ident" id="4976475">token</span><span class="op" id="4976480">.</span><span class="ident" id="4976481">Token</span><span class="op" id="4976486">)</span>&nbsp;<span class="ident" id="4976488">token</span><span class="op" id="4976493">.</span><span class="ident" id="4976494">Pos</span>&nbsp;<span class="op" id="4976498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976501">pos</span>&nbsp;<span class="op" id="4976505">:=</span>&nbsp;<span class="ident" id="4976508">p</span><span class="op" id="4976509">.</span><span class="ident" id="4976510">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976515">if</span>&nbsp;<span class="ident" id="4976518">p</span><span class="op" id="4976519">.</span><span class="ident" id="4976520">tok</span>&nbsp;<span class="op" id="4976524">!=</span>&nbsp;<span class="ident" id="4976527">tok</span>&nbsp;<span class="op" id="4976531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976535">p</span><span class="op" id="4976536">.</span><span class="ident" id="4976537">errorExpected</span><span class="op" id="4976550">(</span><span class="ident" id="4976551">pos</span><span class="op" id="4976554">,</span>&nbsp;<span class="string" id="4976556">&#34;&#39;&#34;</span><span class="op" id="4976559">+</span><span class="ident" id="4976560">tok</span><span class="op" id="4976563">.</span><span class="ident" id="4976564">String</span><span class="op" id="4976570">(</span><span class="op" id="4976571">)</span><span class="op" id="4976572">+</span><span class="string" id="4976573">&#34;&#39;&#34;</span><span class="op" id="4976576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976582">p</span><span class="op" id="4976583">.</span><span class="ident" id="4976584">next</span><span class="op" id="4976588">(</span><span class="op" id="4976589">)</span>&nbsp;<span class="comment" id="4976591">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976609">return</span>&nbsp;<span class="ident" id="4976616">pos</span><br>
<span class="lineno">390</span><span class="op" id="4976620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4976623">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="4976691">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="4976751">//</span><br>
<span class="lineno">395</span><span class="keyword" id="4976754">func</span>&nbsp;<span class="op" id="4976759">(</span><span class="ident" id="4976760">p</span>&nbsp;<span class="op" id="4976762">*</span><span class="ident" id="4976763">parser</span><span class="op" id="4976769">)</span>&nbsp;<span class="ident" id="4976771">expectClosing</span><span class="op" id="4976784">(</span><span class="ident" id="4976785">tok</span>&nbsp;<span class="ident" id="4976789">token</span><span class="op" id="4976794">.</span><span class="ident" id="4976795">Token</span><span class="op" id="4976800">,</span>&nbsp;<span class="ident" id="4976802">context</span>&nbsp;<span class="builtintype" id="4976810">string</span><span class="op" id="4976816">)</span>&nbsp;<span class="ident" id="4976818">token</span><span class="op" id="4976823">.</span><span class="ident" id="4976824">Pos</span>&nbsp;<span class="op" id="4976828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976831">if</span>&nbsp;<span class="ident" id="4976834">p</span><span class="op" id="4976835">.</span><span class="ident" id="4976836">tok</span>&nbsp;<span class="op" id="4976840">!=</span>&nbsp;<span class="ident" id="4976843">tok</span>&nbsp;<span class="op" id="4976847">&amp;&amp;</span>&nbsp;<span class="ident" id="4976850">p</span><span class="op" id="4976851">.</span><span class="ident" id="4976852">tok</span>&nbsp;<span class="op" id="4976856">==</span>&nbsp;<span class="ident" id="4976859">token</span><span class="op" id="4976864">.</span><span class="ident" id="4976865">SEMICOLON</span>&nbsp;<span class="op" id="4976875">&amp;&amp;</span>&nbsp;<span class="ident" id="4976878">p</span><span class="op" id="4976879">.</span><span class="ident" id="4976880">lit</span>&nbsp;<span class="op" id="4976884">==</span>&nbsp;<span class="string" id="4976887">&#34;\n&#34;</span>&nbsp;<span class="op" id="4976892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976896">p</span><span class="op" id="4976897">.</span><span class="builtintype" id="4976898">error</span><span class="op" id="4976903">(</span><span class="ident" id="4976904">p</span><span class="op" id="4976905">.</span><span class="ident" id="4976906">pos</span><span class="op" id="4976909">,</span>&nbsp;<span class="string" id="4976911">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="4976943">+</span><span class="ident" id="4976944">context</span><span class="op" id="4976951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976955">p</span><span class="op" id="4976956">.</span><span class="ident" id="4976957">next</span><span class="op" id="4976961">(</span><span class="op" id="4976962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976965">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976968">return</span>&nbsp;<span class="ident" id="4976975">p</span><span class="op" id="4976976">.</span><span class="ident" id="4976977">expect</span><span class="op" id="4976983">(</span><span class="ident" id="4976984">tok</span><span class="op" id="4976987">)</span><br>
<span class="lineno"></span><span class="op" id="4976989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4976992">func</span>&nbsp;<span class="op" id="4976997">(</span><span class="ident" id="4976998">p</span>&nbsp;<span class="op" id="4977000">*</span><span class="ident" id="4977001">parser</span><span class="op" id="4977007">)</span>&nbsp;<span class="ident" id="4977009">expectSemi</span><span class="op" id="4977019">(</span><span class="op" id="4977020">)</span>&nbsp;<span class="op" id="4977022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977025">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977079">if</span>&nbsp;<span class="ident" id="4977082">p</span><span class="op" id="4977083">.</span><span class="ident" id="4977084">tok</span>&nbsp;<span class="op" id="4977088">!=</span>&nbsp;<span class="ident" id="4977091">token</span><span class="op" id="4977096">.</span><span class="ident" id="4977097">RPAREN</span>&nbsp;<span class="op" id="4977104">&amp;&amp;</span>&nbsp;<span class="ident" id="4977107">p</span><span class="op" id="4977108">.</span><span class="ident" id="4977109">tok</span>&nbsp;<span class="op" id="4977113">!=</span>&nbsp;<span class="ident" id="4977116">token</span><span class="op" id="4977121">.</span><span class="ident" id="4977122">RBRACE</span>&nbsp;<span class="op" id="4977129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977133">if</span>&nbsp;<span class="ident" id="4977136">p</span><span class="op" id="4977137">.</span><span class="ident" id="4977138">tok</span>&nbsp;<span class="op" id="4977142">==</span>&nbsp;<span class="ident" id="4977145">token</span><span class="op" id="4977150">.</span><span class="ident" id="4977151">SEMICOLON</span>&nbsp;<span class="op" id="4977161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977166">p</span><span class="op" id="4977167">.</span><span class="ident" id="4977168">next</span><span class="op" id="4977172">(</span><span class="op" id="4977173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977177">}</span>&nbsp;<span class="keyword" id="4977179">else</span>&nbsp;<span class="op" id="4977184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977189">p</span><span class="op" id="4977190">.</span><span class="ident" id="4977191">errorExpected</span><span class="op" id="4977204">(</span><span class="ident" id="4977205">p</span><span class="op" id="4977206">.</span><span class="ident" id="4977207">pos</span><span class="op" id="4977210">,</span>&nbsp;<span class="string" id="4977212">&#34;&#39;;&#39;&#34;</span><span class="op" id="4977217">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977222">syncStmt</span><span class="op" id="4977230">(</span><span class="ident" id="4977231">p</span><span class="op" id="4977232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977239">}</span><br>
<span class="lineno"></span><span class="op" id="4977241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="4977244">func</span>&nbsp;<span class="op" id="4977249">(</span><span class="ident" id="4977250">p</span>&nbsp;<span class="op" id="4977252">*</span><span class="ident" id="4977253">parser</span><span class="op" id="4977259">)</span>&nbsp;<span class="ident" id="4977261">atComma</span><span class="op" id="4977268">(</span><span class="ident" id="4977269">context</span>&nbsp;<span class="builtintype" id="4977277">string</span><span class="op" id="4977283">)</span>&nbsp;<span class="builtintype" id="4977285">bool</span>&nbsp;<span class="op" id="4977290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977293">if</span>&nbsp;<span class="ident" id="4977296">p</span><span class="op" id="4977297">.</span><span class="ident" id="4977298">tok</span>&nbsp;<span class="op" id="4977302">==</span>&nbsp;<span class="ident" id="4977305">token</span><span class="op" id="4977310">.</span><span class="ident" id="4977311">COMMA</span>&nbsp;<span class="op" id="4977317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977321">return</span>&nbsp;<span class="builtintype" id="4977328">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977337">if</span>&nbsp;<span class="ident" id="4977340">p</span><span class="op" id="4977341">.</span><span class="ident" id="4977342">tok</span>&nbsp;<span class="op" id="4977346">==</span>&nbsp;<span class="ident" id="4977349">token</span><span class="op" id="4977354">.</span><span class="ident" id="4977355">SEMICOLON</span>&nbsp;<span class="op" id="4977365">&amp;&amp;</span>&nbsp;<span class="ident" id="4977368">p</span><span class="op" id="4977369">.</span><span class="ident" id="4977370">lit</span>&nbsp;<span class="op" id="4977374">==</span>&nbsp;<span class="string" id="4977377">&#34;\n&#34;</span>&nbsp;<span class="op" id="4977382">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977386">p</span><span class="op" id="4977387">.</span><span class="builtintype" id="4977388">error</span><span class="op" id="4977393">(</span><span class="ident" id="4977394">p</span><span class="op" id="4977395">.</span><span class="ident" id="4977396">pos</span><span class="op" id="4977399">,</span>&nbsp;<span class="string" id="4977401">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="4977433">+</span><span class="ident" id="4977434">context</span><span class="op" id="4977441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977445">return</span>&nbsp;<span class="builtintype" id="4977452">true</span>&nbsp;<span class="comment" id="4977457">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977497">return</span>&nbsp;<span class="builtintype" id="4977504">false</span><br>
<span class="lineno">425</span><span class="op" id="4977510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4977513">func</span>&nbsp;<span class="ident" id="4977518">assert</span><span class="op" id="4977524">(</span><span class="ident" id="4977525">cond</span>&nbsp;<span class="builtintype" id="4977530">bool</span><span class="op" id="4977534">,</span>&nbsp;<span class="ident" id="4977536">msg</span>&nbsp;<span class="builtintype" id="4977540">string</span><span class="op" id="4977546">)</span>&nbsp;<span class="op" id="4977548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977551">if</span>&nbsp;<span class="op" id="4977554">!</span><span class="ident" id="4977555">cond</span>&nbsp;<span class="op" id="4977560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4977564">panic</span><span class="op" id="4977569">(</span><span class="string" id="4977570">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4977599">+</span>&nbsp;<span class="ident" id="4977601">msg</span><span class="op" id="4977604">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977607">}</span><br>
<span class="lineno"></span><span class="op" id="4977609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4977612">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="4977656">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="4977700">//</span><br>
<span class="lineno"></span><span class="keyword" id="4977703">func</span>&nbsp;<span class="ident" id="4977708">syncStmt</span><span class="op" id="4977716">(</span><span class="ident" id="4977717">p</span>&nbsp;<span class="op" id="4977719">*</span><span class="ident" id="4977720">parser</span><span class="op" id="4977726">)</span>&nbsp;<span class="op" id="4977728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977731">for</span>&nbsp;<span class="op" id="4977735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977739">switch</span>&nbsp;<span class="ident" id="4977746">p</span><span class="op" id="4977747">.</span><span class="ident" id="4977748">tok</span>&nbsp;<span class="op" id="4977752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977756">case</span>&nbsp;<span class="ident" id="4977761">token</span><span class="op" id="4977766">.</span><span class="ident" id="4977767">BREAK</span><span class="op" id="4977772">,</span>&nbsp;<span class="ident" id="4977774">token</span><span class="op" id="4977779">.</span><span class="ident" id="4977780">CONST</span><span class="op" id="4977785">,</span>&nbsp;<span class="ident" id="4977787">token</span><span class="op" id="4977792">.</span><span class="ident" id="4977793">CONTINUE</span><span class="op" id="4977801">,</span>&nbsp;<span class="ident" id="4977803">token</span><span class="op" id="4977808">.</span><span class="ident" id="4977809">DEFER</span><span class="op" id="4977814">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977819">token</span><span class="op" id="4977824">.</span><span class="ident" id="4977825">FALLTHROUGH</span><span class="op" id="4977836">,</span>&nbsp;<span class="ident" id="4977838">token</span><span class="op" id="4977843">.</span><span class="ident" id="4977844">FOR</span><span class="op" id="4977847">,</span>&nbsp;<span class="ident" id="4977849">token</span><span class="op" id="4977854">.</span><span class="ident" id="4977855">GO</span><span class="op" id="4977857">,</span>&nbsp;<span class="ident" id="4977859">token</span><span class="op" id="4977864">.</span><span class="ident" id="4977865">GOTO</span><span class="op" id="4977869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977874">token</span><span class="op" id="4977879">.</span><span class="ident" id="4977880">IF</span><span class="op" id="4977882">,</span>&nbsp;<span class="ident" id="4977884">token</span><span class="op" id="4977889">.</span><span class="ident" id="4977890">RETURN</span><span class="op" id="4977896">,</span>&nbsp;<span class="ident" id="4977898">token</span><span class="op" id="4977903">.</span><span class="ident" id="4977904">SELECT</span><span class="op" id="4977910">,</span>&nbsp;<span class="ident" id="4977912">token</span><span class="op" id="4977917">.</span><span class="ident" id="4977918">SWITCH</span><span class="op" id="4977924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977929">token</span><span class="op" id="4977934">.</span><span class="ident" id="4977935">TYPE</span><span class="op" id="4977939">,</span>&nbsp;<span class="ident" id="4977941">token</span><span class="op" id="4977946">.</span><span class="ident" id="4977947">VAR</span><span class="op" id="4977950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977955">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978013">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978071">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978127">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978183">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978239">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978293">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978328">if</span>&nbsp;<span class="ident" id="4978331">p</span><span class="op" id="4978332">.</span><span class="ident" id="4978333">pos</span>&nbsp;<span class="op" id="4978337">==</span>&nbsp;<span class="ident" id="4978340">p</span><span class="op" id="4978341">.</span><span class="ident" id="4978342">syncPos</span>&nbsp;<span class="op" id="4978350">&amp;&amp;</span>&nbsp;<span class="ident" id="4978353">p</span><span class="op" id="4978354">.</span><span class="ident" id="4978355">syncCnt</span>&nbsp;<span class="op" id="4978363">&lt;</span>&nbsp;<span class="num" id="4978365">10</span>&nbsp;<span class="op" id="4978368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978374">p</span><span class="op" id="4978375">.</span><span class="ident" id="4978376">syncCnt</span><span class="op" id="4978383">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978390">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978405">if</span>&nbsp;<span class="ident" id="4978408">p</span><span class="op" id="4978409">.</span><span class="ident" id="4978410">pos</span>&nbsp;<span class="op" id="4978414">&gt;</span>&nbsp;<span class="ident" id="4978416">p</span><span class="op" id="4978417">.</span><span class="ident" id="4978418">syncPos</span>&nbsp;<span class="op" id="4978426">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978432">p</span><span class="op" id="4978433">.</span><span class="ident" id="4978434">syncPos</span>&nbsp;<span class="op" id="4978442">=</span>&nbsp;<span class="ident" id="4978444">p</span><span class="op" id="4978445">.</span><span class="ident" id="4978446">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978454">p</span><span class="op" id="4978455">.</span><span class="ident" id="4978456">syncCnt</span>&nbsp;<span class="op" id="4978464">=</span>&nbsp;<span class="num" id="4978466">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978472">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978487">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978541">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978598">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978652">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978707">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978742">case</span>&nbsp;<span class="ident" id="4978747">token</span><span class="op" id="4978752">.</span><span class="ident" id="4978753">EOF</span><span class="op" id="4978756">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978761">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978774">p</span><span class="op" id="4978775">.</span><span class="ident" id="4978776">next</span><span class="op" id="4978780">(</span><span class="op" id="4978781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978784">}</span><br>
<span class="lineno"></span><span class="op" id="4978786">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="4978789">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="4978835">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4978879">//</span><br>
<span class="lineno"></span><span class="keyword" id="4978882">func</span>&nbsp;<span class="ident" id="4978887">syncDecl</span><span class="op" id="4978895">(</span><span class="ident" id="4978896">p</span>&nbsp;<span class="op" id="4978898">*</span><span class="ident" id="4978899">parser</span><span class="op" id="4978905">)</span>&nbsp;<span class="op" id="4978907">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978910">for</span>&nbsp;<span class="op" id="4978914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978918">switch</span>&nbsp;<span class="ident" id="4978925">p</span><span class="op" id="4978926">.</span><span class="ident" id="4978927">tok</span>&nbsp;<span class="op" id="4978931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978935">case</span>&nbsp;<span class="ident" id="4978940">token</span><span class="op" id="4978945">.</span><span class="ident" id="4978946">CONST</span><span class="op" id="4978951">,</span>&nbsp;<span class="ident" id="4978953">token</span><span class="op" id="4978958">.</span><span class="ident" id="4978959">TYPE</span><span class="op" id="4978963">,</span>&nbsp;<span class="ident" id="4978965">token</span><span class="op" id="4978970">.</span><span class="ident" id="4978971">VAR</span><span class="op" id="4978974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978979">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979010">if</span>&nbsp;<span class="ident" id="4979013">p</span><span class="op" id="4979014">.</span><span class="ident" id="4979015">pos</span>&nbsp;<span class="op" id="4979019">==</span>&nbsp;<span class="ident" id="4979022">p</span><span class="op" id="4979023">.</span><span class="ident" id="4979024">syncPos</span>&nbsp;<span class="op" id="4979032">&amp;&amp;</span>&nbsp;<span class="ident" id="4979035">p</span><span class="op" id="4979036">.</span><span class="ident" id="4979037">syncCnt</span>&nbsp;<span class="op" id="4979045">&lt;</span>&nbsp;<span class="num" id="4979047">10</span>&nbsp;<span class="op" id="4979050">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979056">p</span><span class="op" id="4979057">.</span><span class="ident" id="4979058">syncCnt</span><span class="op" id="4979065">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979072">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979087">if</span>&nbsp;<span class="ident" id="4979090">p</span><span class="op" id="4979091">.</span><span class="ident" id="4979092">pos</span>&nbsp;<span class="op" id="4979096">&gt;</span>&nbsp;<span class="ident" id="4979098">p</span><span class="op" id="4979099">.</span><span class="ident" id="4979100">syncPos</span>&nbsp;<span class="op" id="4979108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979114">p</span><span class="op" id="4979115">.</span><span class="ident" id="4979116">syncPos</span>&nbsp;<span class="op" id="4979124">=</span>&nbsp;<span class="ident" id="4979126">p</span><span class="op" id="4979127">.</span><span class="ident" id="4979128">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979136">p</span><span class="op" id="4979137">.</span><span class="ident" id="4979138">syncCnt</span>&nbsp;<span class="op" id="4979146">=</span>&nbsp;<span class="num" id="4979148">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979154">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979168">case</span>&nbsp;<span class="ident" id="4979173">token</span><span class="op" id="4979178">.</span><span class="ident" id="4979179">EOF</span><span class="op" id="4979182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979187">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979200">p</span><span class="op" id="4979201">.</span><span class="ident" id="4979202">next</span><span class="op" id="4979206">(</span><span class="op" id="4979207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979210">}</span><br>
<span class="lineno"></span><span class="op" id="4979212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="4979215">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4979285">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="4979357">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="4979394">//</span><br>
<span class="lineno"></span><span class="comment" id="4979397">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="4979472">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4979546">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4979625">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4979700">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="4979713">//</span><br>
<span class="lineno">505</span><span class="keyword" id="4979716">func</span>&nbsp;<span class="op" id="4979721">(</span><span class="ident" id="4979722">p</span>&nbsp;<span class="op" id="4979724">*</span><span class="ident" id="4979725">parser</span><span class="op" id="4979731">)</span>&nbsp;<span class="ident" id="4979733">safePos</span><span class="op" id="4979740">(</span><span class="ident" id="4979741">pos</span>&nbsp;<span class="ident" id="4979745">token</span><span class="op" id="4979750">.</span><span class="ident" id="4979751">Pos</span><span class="op" id="4979754">)</span>&nbsp;<span class="op" id="4979756">(</span><span class="ident" id="4979757">res</span>&nbsp;<span class="ident" id="4979761">token</span><span class="op" id="4979766">.</span><span class="ident" id="4979767">Pos</span><span class="op" id="4979770">)</span>&nbsp;<span class="op" id="4979772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979775">defer</span>&nbsp;<span class="keyword" id="4979781">func</span><span class="op" id="4979785">(</span><span class="op" id="4979786">)</span>&nbsp;<span class="op" id="4979788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979792">if</span>&nbsp;<span class="builtinfunc" id="4979795">recover</span><span class="op" id="4979802">(</span><span class="op" id="4979803">)</span>&nbsp;<span class="op" id="4979805">!=</span>&nbsp;<span class="ident" id="4979808">nil</span>&nbsp;<span class="op" id="4979812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979817">res</span>&nbsp;<span class="op" id="4979821">=</span>&nbsp;<span class="ident" id="4979823">token</span><span class="op" id="4979828">.</span><span class="ident" id="4979829">Pos</span><span class="op" id="4979832">(</span><span class="ident" id="4979833">p</span><span class="op" id="4979834">.</span><span class="ident" id="4979835">file</span><span class="op" id="4979839">.</span><span class="ident" id="4979840">Base</span><span class="op" id="4979844">(</span><span class="op" id="4979845">)</span>&nbsp;<span class="op" id="4979847">+</span>&nbsp;<span class="ident" id="4979849">p</span><span class="op" id="4979850">.</span><span class="ident" id="4979851">file</span><span class="op" id="4979855">.</span><span class="ident" id="4979856">Size</span><span class="op" id="4979860">(</span><span class="op" id="4979861">)</span><span class="op" id="4979862">)</span>&nbsp;<span class="comment" id="4979864">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979882">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979885">}</span><span class="op" id="4979886">(</span><span class="op" id="4979887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979890">_</span>&nbsp;<span class="op" id="4979892">=</span>&nbsp;<span class="ident" id="4979894">p</span><span class="op" id="4979895">.</span><span class="ident" id="4979896">file</span><span class="op" id="4979900">.</span><span class="ident" id="4979901">Offset</span><span class="op" id="4979907">(</span><span class="ident" id="4979908">pos</span><span class="op" id="4979911">)</span>&nbsp;<span class="comment" id="4979913">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979961">return</span>&nbsp;<span class="ident" id="4979968">pos</span><br>
<span class="lineno"></span><span class="op" id="4979972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="4979975">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4980055">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4980071">func</span>&nbsp;<span class="op" id="4980076">(</span><span class="ident" id="4980077">p</span>&nbsp;<span class="op" id="4980079">*</span><span class="ident" id="4980080">parser</span><span class="op" id="4980086">)</span>&nbsp;<span class="ident" id="4980088">parseIdent</span><span class="op" id="4980098">(</span><span class="op" id="4980099">)</span>&nbsp;<span class="op" id="4980101">*</span><span class="ident" id="4980102">ast</span><span class="op" id="4980105">.</span><span class="ident" id="4980106">Ident</span>&nbsp;<span class="op" id="4980112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980115">pos</span>&nbsp;<span class="op" id="4980119">:=</span>&nbsp;<span class="ident" id="4980122">p</span><span class="op" id="4980123">.</span><span class="ident" id="4980124">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980129">name</span>&nbsp;<span class="op" id="4980134">:=</span>&nbsp;<span class="string" id="4980137">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980142">if</span>&nbsp;<span class="ident" id="4980145">p</span><span class="op" id="4980146">.</span><span class="ident" id="4980147">tok</span>&nbsp;<span class="op" id="4980151">==</span>&nbsp;<span class="ident" id="4980154">token</span><span class="op" id="4980159">.</span><span class="ident" id="4980160">IDENT</span>&nbsp;<span class="op" id="4980166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980170">name</span>&nbsp;<span class="op" id="4980175">=</span>&nbsp;<span class="ident" id="4980177">p</span><span class="op" id="4980178">.</span><span class="ident" id="4980179">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980185">p</span><span class="op" id="4980186">.</span><span class="ident" id="4980187">next</span><span class="op" id="4980191">(</span><span class="op" id="4980192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980195">}</span>&nbsp;<span class="keyword" id="4980197">else</span>&nbsp;<span class="op" id="4980202">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980206">p</span><span class="op" id="4980207">.</span><span class="ident" id="4980208">expect</span><span class="op" id="4980214">(</span><span class="ident" id="4980215">token</span><span class="op" id="4980220">.</span><span class="ident" id="4980221">IDENT</span><span class="op" id="4980226">)</span>&nbsp;<span class="comment" id="4980228">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980263">return</span>&nbsp;<span class="op" id="4980270">&amp;</span><span class="ident" id="4980271">ast</span><span class="op" id="4980274">.</span><span class="ident" id="4980275">Ident</span><span class="op" id="4980280">{</span><span class="ident" id="4980281">NamePos</span><span class="op" id="4980288">:</span>&nbsp;<span class="ident" id="4980290">pos</span><span class="op" id="4980293">,</span>&nbsp;<span class="ident" id="4980295">Name</span><span class="op" id="4980299">:</span>&nbsp;<span class="ident" id="4980301">name</span><span class="op" id="4980305">}</span><br>
<span class="lineno"></span><span class="op" id="4980307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="4980310">func</span>&nbsp;<span class="op" id="4980315">(</span><span class="ident" id="4980316">p</span>&nbsp;<span class="op" id="4980318">*</span><span class="ident" id="4980319">parser</span><span class="op" id="4980325">)</span>&nbsp;<span class="ident" id="4980327">parseIdentList</span><span class="op" id="4980341">(</span><span class="op" id="4980342">)</span>&nbsp;<span class="op" id="4980344">(</span><span class="ident" id="4980345">list</span>&nbsp;<span class="op" id="4980350">[</span><span class="op" id="4980351">]</span><span class="op" id="4980352">*</span><span class="ident" id="4980353">ast</span><span class="op" id="4980356">.</span><span class="ident" id="4980357">Ident</span><span class="op" id="4980362">)</span>&nbsp;<span class="op" id="4980364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980367">if</span>&nbsp;<span class="ident" id="4980370">p</span><span class="op" id="4980371">.</span><span class="ident" id="4980372">trace</span>&nbsp;<span class="op" id="4980378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980382">defer</span>&nbsp;<span class="ident" id="4980388">un</span><span class="op" id="4980390">(</span><span class="ident" id="4980391">trace</span><span class="op" id="4980396">(</span><span class="ident" id="4980397">p</span><span class="op" id="4980398">,</span>&nbsp;<span class="string" id="4980400">&#34;IdentList&#34;</span><span class="op" id="4980411">)</span><span class="op" id="4980412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980419">list</span>&nbsp;<span class="op" id="4980424">=</span>&nbsp;<span class="builtinfunc" id="4980426">append</span><span class="op" id="4980432">(</span><span class="ident" id="4980433">list</span><span class="op" id="4980437">,</span>&nbsp;<span class="ident" id="4980439">p</span><span class="op" id="4980440">.</span><span class="ident" id="4980441">parseIdent</span><span class="op" id="4980451">(</span><span class="op" id="4980452">)</span><span class="op" id="4980453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980456">for</span>&nbsp;<span class="ident" id="4980460">p</span><span class="op" id="4980461">.</span><span class="ident" id="4980462">tok</span>&nbsp;<span class="op" id="4980466">==</span>&nbsp;<span class="ident" id="4980469">token</span><span class="op" id="4980474">.</span><span class="ident" id="4980475">COMMA</span>&nbsp;<span class="op" id="4980481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980485">p</span><span class="op" id="4980486">.</span><span class="ident" id="4980487">next</span><span class="op" id="4980491">(</span><span class="op" id="4980492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980496">list</span>&nbsp;<span class="op" id="4980501">=</span>&nbsp;<span class="builtinfunc" id="4980503">append</span><span class="op" id="4980509">(</span><span class="ident" id="4980510">list</span><span class="op" id="4980514">,</span>&nbsp;<span class="ident" id="4980516">p</span><span class="op" id="4980517">.</span><span class="ident" id="4980518">parseIdent</span><span class="op" id="4980528">(</span><span class="op" id="4980529">)</span><span class="op" id="4980530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980533">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980537">return</span><br>
<span class="lineno"></span><span class="op" id="4980544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4980547">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="4980627">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4980650">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4980729">func</span>&nbsp;<span class="op" id="4980734">(</span><span class="ident" id="4980735">p</span>&nbsp;<span class="op" id="4980737">*</span><span class="ident" id="4980738">parser</span><span class="op" id="4980744">)</span>&nbsp;<span class="ident" id="4980746">parseExprList</span><span class="op" id="4980759">(</span><span class="ident" id="4980760">lhs</span>&nbsp;<span class="builtintype" id="4980764">bool</span><span class="op" id="4980768">)</span>&nbsp;<span class="op" id="4980770">(</span><span class="ident" id="4980771">list</span>&nbsp;<span class="op" id="4980776">[</span><span class="op" id="4980777">]</span><span class="ident" id="4980778">ast</span><span class="op" id="4980781">.</span><span class="ident" id="4980782">Expr</span><span class="op" id="4980786">)</span>&nbsp;<span class="op" id="4980788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980791">if</span>&nbsp;<span class="ident" id="4980794">p</span><span class="op" id="4980795">.</span><span class="ident" id="4980796">trace</span>&nbsp;<span class="op" id="4980802">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980806">defer</span>&nbsp;<span class="ident" id="4980812">un</span><span class="op" id="4980814">(</span><span class="ident" id="4980815">trace</span><span class="op" id="4980820">(</span><span class="ident" id="4980821">p</span><span class="op" id="4980822">,</span>&nbsp;<span class="string" id="4980824">&#34;ExpressionList&#34;</span><span class="op" id="4980840">)</span><span class="op" id="4980841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980848">list</span>&nbsp;<span class="op" id="4980853">=</span>&nbsp;<span class="builtinfunc" id="4980855">append</span><span class="op" id="4980861">(</span><span class="ident" id="4980862">list</span><span class="op" id="4980866">,</span>&nbsp;<span class="ident" id="4980868">p</span><span class="op" id="4980869">.</span><span class="ident" id="4980870">checkExpr</span><span class="op" id="4980879">(</span><span class="ident" id="4980880">p</span><span class="op" id="4980881">.</span><span class="ident" id="4980882">parseExpr</span><span class="op" id="4980891">(</span><span class="ident" id="4980892">lhs</span><span class="op" id="4980895">)</span><span class="op" id="4980896">)</span><span class="op" id="4980897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980900">for</span>&nbsp;<span class="ident" id="4980904">p</span><span class="op" id="4980905">.</span><span class="ident" id="4980906">tok</span>&nbsp;<span class="op" id="4980910">==</span>&nbsp;<span class="ident" id="4980913">token</span><span class="op" id="4980918">.</span><span class="ident" id="4980919">COMMA</span>&nbsp;<span class="op" id="4980925">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980929">p</span><span class="op" id="4980930">.</span><span class="ident" id="4980931">next</span><span class="op" id="4980935">(</span><span class="op" id="4980936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980940">list</span>&nbsp;<span class="op" id="4980945">=</span>&nbsp;<span class="builtinfunc" id="4980947">append</span><span class="op" id="4980953">(</span><span class="ident" id="4980954">list</span><span class="op" id="4980958">,</span>&nbsp;<span class="ident" id="4980960">p</span><span class="op" id="4980961">.</span><span class="ident" id="4980962">checkExpr</span><span class="op" id="4980971">(</span><span class="ident" id="4980972">p</span><span class="op" id="4980973">.</span><span class="ident" id="4980974">parseExpr</span><span class="op" id="4980983">(</span><span class="ident" id="4980984">lhs</span><span class="op" id="4980987">)</span><span class="op" id="4980988">)</span><span class="op" id="4980989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980996">return</span><br>
<span class="lineno">560</span><span class="op" id="4981003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4981006">func</span>&nbsp;<span class="op" id="4981011">(</span><span class="ident" id="4981012">p</span>&nbsp;<span class="op" id="4981014">*</span><span class="ident" id="4981015">parser</span><span class="op" id="4981021">)</span>&nbsp;<span class="ident" id="4981023">parseLhsList</span><span class="op" id="4981035">(</span><span class="op" id="4981036">)</span>&nbsp;<span class="op" id="4981038">[</span><span class="op" id="4981039">]</span><span class="ident" id="4981040">ast</span><span class="op" id="4981043">.</span><span class="ident" id="4981044">Expr</span>&nbsp;<span class="op" id="4981049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981052">old</span>&nbsp;<span class="op" id="4981056">:=</span>&nbsp;<span class="ident" id="4981059">p</span><span class="op" id="4981060">.</span><span class="ident" id="4981061">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981068">p</span><span class="op" id="4981069">.</span><span class="ident" id="4981070">inRhs</span>&nbsp;<span class="op" id="4981076">=</span>&nbsp;<span class="builtintype" id="4981078">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981085">list</span>&nbsp;<span class="op" id="4981090">:=</span>&nbsp;<span class="ident" id="4981093">p</span><span class="op" id="4981094">.</span><span class="ident" id="4981095">parseExprList</span><span class="op" id="4981108">(</span><span class="builtintype" id="4981109">true</span><span class="op" id="4981113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981116">switch</span>&nbsp;<span class="ident" id="4981123">p</span><span class="op" id="4981124">.</span><span class="ident" id="4981125">tok</span>&nbsp;<span class="op" id="4981129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981132">case</span>&nbsp;<span class="ident" id="4981137">token</span><span class="op" id="4981142">.</span><span class="ident" id="4981143">DEFINE</span><span class="op" id="4981149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981153">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981194">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981236">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981296">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981321">case</span>&nbsp;<span class="ident" id="4981326">token</span><span class="op" id="4981331">.</span><span class="ident" id="4981332">COLON</span><span class="op" id="4981337">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981341">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981411">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981483">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981512">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981569">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981640">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981709">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981754">default</span><span class="op" id="4981761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981765">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981809">for</span>&nbsp;<span class="ident" id="4981813">_</span><span class="op" id="4981814">,</span>&nbsp;<span class="ident" id="4981816">x</span>&nbsp;<span class="op" id="4981818">:=</span>&nbsp;<span class="keyword" id="4981821">range</span>&nbsp;<span class="ident" id="4981827">list</span>&nbsp;<span class="op" id="4981832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981837">p</span><span class="op" id="4981838">.</span><span class="ident" id="4981839">resolve</span><span class="op" id="4981846">(</span><span class="ident" id="4981847">x</span><span class="op" id="4981848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981852">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981858">p</span><span class="op" id="4981859">.</span><span class="ident" id="4981860">inRhs</span>&nbsp;<span class="op" id="4981866">=</span>&nbsp;<span class="ident" id="4981868">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981873">return</span>&nbsp;<span class="ident" id="4981880">list</span><br>
<span class="lineno"></span><span class="op" id="4981885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="4981888">func</span>&nbsp;<span class="op" id="4981893">(</span><span class="ident" id="4981894">p</span>&nbsp;<span class="op" id="4981896">*</span><span class="ident" id="4981897">parser</span><span class="op" id="4981903">)</span>&nbsp;<span class="ident" id="4981905">parseRhsList</span><span class="op" id="4981917">(</span><span class="op" id="4981918">)</span>&nbsp;<span class="op" id="4981920">[</span><span class="op" id="4981921">]</span><span class="ident" id="4981922">ast</span><span class="op" id="4981925">.</span><span class="ident" id="4981926">Expr</span>&nbsp;<span class="op" id="4981931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981934">old</span>&nbsp;<span class="op" id="4981938">:=</span>&nbsp;<span class="ident" id="4981941">p</span><span class="op" id="4981942">.</span><span class="ident" id="4981943">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981950">p</span><span class="op" id="4981951">.</span><span class="ident" id="4981952">inRhs</span>&nbsp;<span class="op" id="4981958">=</span>&nbsp;<span class="builtintype" id="4981960">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981966">list</span>&nbsp;<span class="op" id="4981971">:=</span>&nbsp;<span class="ident" id="4981974">p</span><span class="op" id="4981975">.</span><span class="ident" id="4981976">parseExprList</span><span class="op" id="4981989">(</span><span class="builtintype" id="4981990">false</span><span class="op" id="4981995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981998">p</span><span class="op" id="4981999">.</span><span class="ident" id="4982000">inRhs</span>&nbsp;<span class="op" id="4982006">=</span>&nbsp;<span class="ident" id="4982008">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982013">return</span>&nbsp;<span class="ident" id="4982020">list</span><br>
<span class="lineno"></span><span class="op" id="4982025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4982028">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4982108">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="4982118">func</span>&nbsp;<span class="op" id="4982123">(</span><span class="ident" id="4982124">p</span>&nbsp;<span class="op" id="4982126">*</span><span class="ident" id="4982127">parser</span><span class="op" id="4982133">)</span>&nbsp;<span class="ident" id="4982135">parseType</span><span class="op" id="4982144">(</span><span class="op" id="4982145">)</span>&nbsp;<span class="ident" id="4982147">ast</span><span class="op" id="4982150">.</span><span class="ident" id="4982151">Expr</span>&nbsp;<span class="op" id="4982156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982159">if</span>&nbsp;<span class="ident" id="4982162">p</span><span class="op" id="4982163">.</span><span class="ident" id="4982164">trace</span>&nbsp;<span class="op" id="4982170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982174">defer</span>&nbsp;<span class="ident" id="4982180">un</span><span class="op" id="4982182">(</span><span class="ident" id="4982183">trace</span><span class="op" id="4982188">(</span><span class="ident" id="4982189">p</span><span class="op" id="4982190">,</span>&nbsp;<span class="string" id="4982192">&#34;Type&#34;</span><span class="op" id="4982198">)</span><span class="op" id="4982199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982202">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982206">typ</span>&nbsp;<span class="op" id="4982210">:=</span>&nbsp;<span class="ident" id="4982213">p</span><span class="op" id="4982214">.</span><span class="ident" id="4982215">tryType</span><span class="op" id="4982222">(</span><span class="op" id="4982223">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982227">if</span>&nbsp;<span class="ident" id="4982230">typ</span>&nbsp;<span class="op" id="4982234">==</span>&nbsp;<span class="ident" id="4982237">nil</span>&nbsp;<span class="op" id="4982241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982245">pos</span>&nbsp;<span class="op" id="4982249">:=</span>&nbsp;<span class="ident" id="4982252">p</span><span class="op" id="4982253">.</span><span class="ident" id="4982254">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982260">p</span><span class="op" id="4982261">.</span><span class="ident" id="4982262">errorExpected</span><span class="op" id="4982275">(</span><span class="ident" id="4982276">pos</span><span class="op" id="4982279">,</span>&nbsp;<span class="string" id="4982281">&#34;type&#34;</span><span class="op" id="4982287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982291">p</span><span class="op" id="4982292">.</span><span class="ident" id="4982293">next</span><span class="op" id="4982297">(</span><span class="op" id="4982298">)</span>&nbsp;<span class="comment" id="4982300">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982319">return</span>&nbsp;<span class="op" id="4982326">&amp;</span><span class="ident" id="4982327">ast</span><span class="op" id="4982330">.</span><span class="ident" id="4982331">BadExpr</span><span class="op" id="4982338">{</span><span class="ident" id="4982339">From</span><span class="op" id="4982343">:</span>&nbsp;<span class="ident" id="4982345">pos</span><span class="op" id="4982348">,</span>&nbsp;<span class="ident" id="4982350">To</span><span class="op" id="4982352">:</span>&nbsp;<span class="ident" id="4982354">p</span><span class="op" id="4982355">.</span><span class="ident" id="4982356">pos</span><span class="op" id="4982359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982366">return</span>&nbsp;<span class="ident" id="4982373">typ</span><br>
<span class="lineno"></span><span class="op" id="4982377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4982380">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4982435">func</span>&nbsp;<span class="op" id="4982440">(</span><span class="ident" id="4982441">p</span>&nbsp;<span class="op" id="4982443">*</span><span class="ident" id="4982444">parser</span><span class="op" id="4982450">)</span>&nbsp;<span class="ident" id="4982452">parseTypeName</span><span class="op" id="4982465">(</span><span class="op" id="4982466">)</span>&nbsp;<span class="ident" id="4982468">ast</span><span class="op" id="4982471">.</span><span class="ident" id="4982472">Expr</span>&nbsp;<span class="op" id="4982477">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982480">if</span>&nbsp;<span class="ident" id="4982483">p</span><span class="op" id="4982484">.</span><span class="ident" id="4982485">trace</span>&nbsp;<span class="op" id="4982491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982495">defer</span>&nbsp;<span class="ident" id="4982501">un</span><span class="op" id="4982503">(</span><span class="ident" id="4982504">trace</span><span class="op" id="4982509">(</span><span class="ident" id="4982510">p</span><span class="op" id="4982511">,</span>&nbsp;<span class="string" id="4982513">&#34;TypeName&#34;</span><span class="op" id="4982523">)</span><span class="op" id="4982524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982531">ident</span>&nbsp;<span class="op" id="4982537">:=</span>&nbsp;<span class="ident" id="4982540">p</span><span class="op" id="4982541">.</span><span class="ident" id="4982542">parseIdent</span><span class="op" id="4982552">(</span><span class="op" id="4982553">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4982556">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982623">if</span>&nbsp;<span class="ident" id="4982626">p</span><span class="op" id="4982627">.</span><span class="ident" id="4982628">tok</span>&nbsp;<span class="op" id="4982632">==</span>&nbsp;<span class="ident" id="4982635">token</span><span class="op" id="4982640">.</span><span class="ident" id="4982641">PERIOD</span>&nbsp;<span class="op" id="4982648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4982652">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982681">p</span><span class="op" id="4982682">.</span><span class="ident" id="4982683">next</span><span class="op" id="4982687">(</span><span class="op" id="4982688">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982692">p</span><span class="op" id="4982693">.</span><span class="ident" id="4982694">resolve</span><span class="op" id="4982701">(</span><span class="ident" id="4982702">ident</span><span class="op" id="4982707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982711">sel</span>&nbsp;<span class="op" id="4982715">:=</span>&nbsp;<span class="ident" id="4982718">p</span><span class="op" id="4982719">.</span><span class="ident" id="4982720">parseIdent</span><span class="op" id="4982730">(</span><span class="op" id="4982731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982735">return</span>&nbsp;<span class="op" id="4982742">&amp;</span><span class="ident" id="4982743">ast</span><span class="op" id="4982746">.</span><span class="ident" id="4982747">SelectorExpr</span><span class="op" id="4982759">{</span><span class="ident" id="4982760">X</span><span class="op" id="4982761">:</span>&nbsp;<span class="ident" id="4982763">ident</span><span class="op" id="4982768">,</span>&nbsp;<span class="ident" id="4982770">Sel</span><span class="op" id="4982773">:</span>&nbsp;<span class="ident" id="4982775">sel</span><span class="op" id="4982778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982785">return</span>&nbsp;<span class="ident" id="4982792">ident</span><br>
<span class="lineno"></span><span class="op" id="4982798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4982801">func</span>&nbsp;<span class="op" id="4982806">(</span><span class="ident" id="4982807">p</span>&nbsp;<span class="op" id="4982809">*</span><span class="ident" id="4982810">parser</span><span class="op" id="4982816">)</span>&nbsp;<span class="ident" id="4982818">parseArrayType</span><span class="op" id="4982832">(</span><span class="op" id="4982833">)</span>&nbsp;<span class="ident" id="4982835">ast</span><span class="op" id="4982838">.</span><span class="ident" id="4982839">Expr</span>&nbsp;<span class="op" id="4982844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982847">if</span>&nbsp;<span class="ident" id="4982850">p</span><span class="op" id="4982851">.</span><span class="ident" id="4982852">trace</span>&nbsp;<span class="op" id="4982858">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982862">defer</span>&nbsp;<span class="ident" id="4982868">un</span><span class="op" id="4982870">(</span><span class="ident" id="4982871">trace</span><span class="op" id="4982876">(</span><span class="ident" id="4982877">p</span><span class="op" id="4982878">,</span>&nbsp;<span class="string" id="4982880">&#34;ArrayType&#34;</span><span class="op" id="4982891">)</span><span class="op" id="4982892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982899">lbrack</span>&nbsp;<span class="op" id="4982906">:=</span>&nbsp;<span class="ident" id="4982909">p</span><span class="op" id="4982910">.</span><span class="ident" id="4982911">expect</span><span class="op" id="4982917">(</span><span class="ident" id="4982918">token</span><span class="op" id="4982923">.</span><span class="ident" id="4982924">LBRACK</span><span class="op" id="4982930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982933">p</span><span class="op" id="4982934">.</span><span class="ident" id="4982935">exprLev</span><span class="op" id="4982942">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982946">var</span>&nbsp;<span class="builtinfunc" id="4982950">len</span>&nbsp;<span class="ident" id="4982954">ast</span><span class="op" id="4982957">.</span><span class="ident" id="4982958">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4982964">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983023">if</span>&nbsp;<span class="ident" id="4983026">p</span><span class="op" id="4983027">.</span><span class="ident" id="4983028">tok</span>&nbsp;<span class="op" id="4983032">==</span>&nbsp;<span class="ident" id="4983035">token</span><span class="op" id="4983040">.</span><span class="ident" id="4983041">ELLIPSIS</span>&nbsp;<span class="op" id="4983050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4983054">len</span>&nbsp;<span class="op" id="4983058">=</span>&nbsp;<span class="op" id="4983060">&amp;</span><span class="ident" id="4983061">ast</span><span class="op" id="4983064">.</span><span class="ident" id="4983065">Ellipsis</span><span class="op" id="4983073">{</span><span class="ident" id="4983074">Ellipsis</span><span class="op" id="4983082">:</span>&nbsp;<span class="ident" id="4983084">p</span><span class="op" id="4983085">.</span><span class="ident" id="4983086">pos</span><span class="op" id="4983089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983093">p</span><span class="op" id="4983094">.</span><span class="ident" id="4983095">next</span><span class="op" id="4983099">(</span><span class="op" id="4983100">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983103">}</span>&nbsp;<span class="keyword" id="4983105">else</span>&nbsp;<span class="keyword" id="4983110">if</span>&nbsp;<span class="ident" id="4983113">p</span><span class="op" id="4983114">.</span><span class="ident" id="4983115">tok</span>&nbsp;<span class="op" id="4983119">!=</span>&nbsp;<span class="ident" id="4983122">token</span><span class="op" id="4983127">.</span><span class="ident" id="4983128">RBRACK</span>&nbsp;<span class="op" id="4983135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4983139">len</span>&nbsp;<span class="op" id="4983143">=</span>&nbsp;<span class="ident" id="4983145">p</span><span class="op" id="4983146">.</span><span class="ident" id="4983147">parseRhs</span><span class="op" id="4983155">(</span><span class="op" id="4983156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983162">p</span><span class="op" id="4983163">.</span><span class="ident" id="4983164">exprLev</span><span class="op" id="4983171">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983175">p</span><span class="op" id="4983176">.</span><span class="ident" id="4983177">expect</span><span class="op" id="4983183">(</span><span class="ident" id="4983184">token</span><span class="op" id="4983189">.</span><span class="ident" id="4983190">RBRACK</span><span class="op" id="4983196">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983199">elt</span>&nbsp;<span class="op" id="4983203">:=</span>&nbsp;<span class="ident" id="4983206">p</span><span class="op" id="4983207">.</span><span class="ident" id="4983208">parseType</span><span class="op" id="4983217">(</span><span class="op" id="4983218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983222">return</span>&nbsp;<span class="op" id="4983229">&amp;</span><span class="ident" id="4983230">ast</span><span class="op" id="4983233">.</span><span class="ident" id="4983234">ArrayType</span><span class="op" id="4983243">{</span><span class="ident" id="4983244">Lbrack</span><span class="op" id="4983250">:</span>&nbsp;<span class="ident" id="4983252">lbrack</span><span class="op" id="4983258">,</span>&nbsp;<span class="ident" id="4983260">Len</span><span class="op" id="4983263">:</span>&nbsp;<span class="builtinfunc" id="4983265">len</span><span class="op" id="4983268">,</span>&nbsp;<span class="ident" id="4983270">Elt</span><span class="op" id="4983273">:</span>&nbsp;<span class="ident" id="4983275">elt</span><span class="op" id="4983278">}</span><br>
<span class="lineno"></span><span class="op" id="4983280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="4983283">func</span>&nbsp;<span class="op" id="4983288">(</span><span class="ident" id="4983289">p</span>&nbsp;<span class="op" id="4983291">*</span><span class="ident" id="4983292">parser</span><span class="op" id="4983298">)</span>&nbsp;<span class="ident" id="4983300">makeIdentList</span><span class="op" id="4983313">(</span><span class="ident" id="4983314">list</span>&nbsp;<span class="op" id="4983319">[</span><span class="op" id="4983320">]</span><span class="ident" id="4983321">ast</span><span class="op" id="4983324">.</span><span class="ident" id="4983325">Expr</span><span class="op" id="4983329">)</span>&nbsp;<span class="op" id="4983331">[</span><span class="op" id="4983332">]</span><span class="op" id="4983333">*</span><span class="ident" id="4983334">ast</span><span class="op" id="4983337">.</span><span class="ident" id="4983338">Ident</span>&nbsp;<span class="op" id="4983344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983347">idents</span>&nbsp;<span class="op" id="4983354">:=</span>&nbsp;<span class="builtinfunc" id="4983357">make</span><span class="op" id="4983361">(</span><span class="op" id="4983362">[</span><span class="op" id="4983363">]</span><span class="op" id="4983364">*</span><span class="ident" id="4983365">ast</span><span class="op" id="4983368">.</span><span class="ident" id="4983369">Ident</span><span class="op" id="4983374">,</span>&nbsp;<span class="builtinfunc" id="4983376">len</span><span class="op" id="4983379">(</span><span class="ident" id="4983380">list</span><span class="op" id="4983384">)</span><span class="op" id="4983385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983388">for</span>&nbsp;<span class="ident" id="4983392">i</span><span class="op" id="4983393">,</span>&nbsp;<span class="ident" id="4983395">x</span>&nbsp;<span class="op" id="4983397">:=</span>&nbsp;<span class="keyword" id="4983400">range</span>&nbsp;<span class="ident" id="4983406">list</span>&nbsp;<span class="op" id="4983411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983415">ident</span><span class="op" id="4983420">,</span>&nbsp;<span class="ident" id="4983422">isIdent</span>&nbsp;<span class="op" id="4983430">:=</span>&nbsp;<span class="ident" id="4983433">x</span><span class="op" id="4983434">.</span><span class="op" id="4983435">(</span><span class="op" id="4983436">*</span><span class="ident" id="4983437">ast</span><span class="op" id="4983440">.</span><span class="ident" id="4983441">Ident</span><span class="op" id="4983446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983450">if</span>&nbsp;<span class="op" id="4983453">!</span><span class="ident" id="4983454">isIdent</span>&nbsp;<span class="op" id="4983462">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983467">if</span>&nbsp;<span class="ident" id="4983470">_</span><span class="op" id="4983471">,</span>&nbsp;<span class="ident" id="4983473">isBad</span>&nbsp;<span class="op" id="4983479">:=</span>&nbsp;<span class="ident" id="4983482">x</span><span class="op" id="4983483">.</span><span class="op" id="4983484">(</span><span class="op" id="4983485">*</span><span class="ident" id="4983486">ast</span><span class="op" id="4983489">.</span><span class="ident" id="4983490">BadExpr</span><span class="op" id="4983497">)</span><span class="op" id="4983498">;</span>&nbsp;<span class="op" id="4983500">!</span><span class="ident" id="4983501">isBad</span>&nbsp;<span class="op" id="4983507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4983513">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983556">p</span><span class="op" id="4983557">.</span><span class="ident" id="4983558">errorExpected</span><span class="op" id="4983571">(</span><span class="ident" id="4983572">x</span><span class="op" id="4983573">.</span><span class="ident" id="4983574">Pos</span><span class="op" id="4983577">(</span><span class="op" id="4983578">)</span><span class="op" id="4983579">,</span>&nbsp;<span class="string" id="4983581">&#34;identifier&#34;</span><span class="op" id="4983593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983603">ident</span>&nbsp;<span class="op" id="4983609">=</span>&nbsp;<span class="op" id="4983611">&amp;</span><span class="ident" id="4983612">ast</span><span class="op" id="4983615">.</span><span class="ident" id="4983616">Ident</span><span class="op" id="4983621">{</span><span class="ident" id="4983622">NamePos</span><span class="op" id="4983629">:</span>&nbsp;<span class="ident" id="4983631">x</span><span class="op" id="4983632">.</span><span class="ident" id="4983633">Pos</span><span class="op" id="4983636">(</span><span class="op" id="4983637">)</span><span class="op" id="4983638">,</span>&nbsp;<span class="ident" id="4983640">Name</span><span class="op" id="4983644">:</span>&nbsp;<span class="string" id="4983646">&#34;_&#34;</span><span class="op" id="4983649">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983657">idents</span><span class="op" id="4983663">[</span><span class="ident" id="4983664">i</span><span class="op" id="4983665">]</span>&nbsp;<span class="op" id="4983667">=</span>&nbsp;<span class="ident" id="4983669">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983679">return</span>&nbsp;<span class="ident" id="4983686">idents</span><br>
<span class="lineno"></span><span class="op" id="4983693">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="4983696">func</span>&nbsp;<span class="op" id="4983701">(</span><span class="ident" id="4983702">p</span>&nbsp;<span class="op" id="4983704">*</span><span class="ident" id="4983705">parser</span><span class="op" id="4983711">)</span>&nbsp;<span class="ident" id="4983713">parseFieldDecl</span><span class="op" id="4983727">(</span><span class="ident" id="4983728">scope</span>&nbsp;<span class="op" id="4983734">*</span><span class="ident" id="4983735">ast</span><span class="op" id="4983738">.</span><span class="ident" id="4983739">Scope</span><span class="op" id="4983744">)</span>&nbsp;<span class="op" id="4983746">*</span><span class="ident" id="4983747">ast</span><span class="op" id="4983750">.</span><span class="ident" id="4983751">Field</span>&nbsp;<span class="op" id="4983757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983760">if</span>&nbsp;<span class="ident" id="4983763">p</span><span class="op" id="4983764">.</span><span class="ident" id="4983765">trace</span>&nbsp;<span class="op" id="4983771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983775">defer</span>&nbsp;<span class="ident" id="4983781">un</span><span class="op" id="4983783">(</span><span class="ident" id="4983784">trace</span><span class="op" id="4983789">(</span><span class="ident" id="4983790">p</span><span class="op" id="4983791">,</span>&nbsp;<span class="string" id="4983793">&#34;FieldDecl&#34;</span><span class="op" id="4983804">)</span><span class="op" id="4983805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983808">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983812">doc</span>&nbsp;<span class="op" id="4983816">:=</span>&nbsp;<span class="ident" id="4983819">p</span><span class="op" id="4983820">.</span><span class="ident" id="4983821">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4983835">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983849">list</span><span class="op" id="4983853">,</span>&nbsp;<span class="ident" id="4983855">typ</span>&nbsp;<span class="op" id="4983859">:=</span>&nbsp;<span class="ident" id="4983862">p</span><span class="op" id="4983863">.</span><span class="ident" id="4983864">parseVarList</span><span class="op" id="4983876">(</span><span class="builtintype" id="4983877">false</span><span class="op" id="4983882">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4983886">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983894">var</span>&nbsp;<span class="ident" id="4983898">tag</span>&nbsp;<span class="op" id="4983902">*</span><span class="ident" id="4983903">ast</span><span class="op" id="4983906">.</span><span class="ident" id="4983907">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983917">if</span>&nbsp;<span class="ident" id="4983920">p</span><span class="op" id="4983921">.</span><span class="ident" id="4983922">tok</span>&nbsp;<span class="op" id="4983926">==</span>&nbsp;<span class="ident" id="4983929">token</span><span class="op" id="4983934">.</span><span class="ident" id="4983935">STRING</span>&nbsp;<span class="op" id="4983942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983946">tag</span>&nbsp;<span class="op" id="4983950">=</span>&nbsp;<span class="op" id="4983952">&amp;</span><span class="ident" id="4983953">ast</span><span class="op" id="4983956">.</span><span class="ident" id="4983957">BasicLit</span><span class="op" id="4983965">{</span><span class="ident" id="4983966">ValuePos</span><span class="op" id="4983974">:</span>&nbsp;<span class="ident" id="4983976">p</span><span class="op" id="4983977">.</span><span class="ident" id="4983978">pos</span><span class="op" id="4983981">,</span>&nbsp;<span class="ident" id="4983983">Kind</span><span class="op" id="4983987">:</span>&nbsp;<span class="ident" id="4983989">p</span><span class="op" id="4983990">.</span><span class="ident" id="4983991">tok</span><span class="op" id="4983994">,</span>&nbsp;<span class="ident" id="4983996">Value</span><span class="op" id="4984001">:</span>&nbsp;<span class="ident" id="4984003">p</span><span class="op" id="4984004">.</span><span class="ident" id="4984005">lit</span><span class="op" id="4984008">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984012">p</span><span class="op" id="4984013">.</span><span class="ident" id="4984014">next</span><span class="op" id="4984018">(</span><span class="op" id="4984019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4984026">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984043">var</span>&nbsp;<span class="ident" id="4984047">idents</span>&nbsp;<span class="op" id="4984054">[</span><span class="op" id="4984055">]</span><span class="op" id="4984056">*</span><span class="ident" id="4984057">ast</span><span class="op" id="4984060">.</span><span class="ident" id="4984061">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984068">if</span>&nbsp;<span class="ident" id="4984071">typ</span>&nbsp;<span class="op" id="4984075">!=</span>&nbsp;<span class="ident" id="4984078">nil</span>&nbsp;<span class="op" id="4984082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4984086">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984111">idents</span>&nbsp;<span class="op" id="4984118">=</span>&nbsp;<span class="ident" id="4984120">p</span><span class="op" id="4984121">.</span><span class="ident" id="4984122">makeIdentList</span><span class="op" id="4984135">(</span><span class="ident" id="4984136">list</span><span class="op" id="4984140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984143">}</span>&nbsp;<span class="keyword" id="4984145">else</span>&nbsp;<span class="op" id="4984150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4984154">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984191">typ</span>&nbsp;<span class="op" id="4984195">=</span>&nbsp;<span class="ident" id="4984197">list</span><span class="op" id="4984201">[</span><span class="num" id="4984202">0</span><span class="op" id="4984203">]</span>&nbsp;<span class="comment" id="4984205">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984246">if</span>&nbsp;<span class="ident" id="4984249">n</span>&nbsp;<span class="op" id="4984251">:=</span>&nbsp;<span class="builtinfunc" id="4984254">len</span><span class="op" id="4984257">(</span><span class="ident" id="4984258">list</span><span class="op" id="4984262">)</span><span class="op" id="4984263">;</span>&nbsp;<span class="ident" id="4984265">n</span>&nbsp;<span class="op" id="4984267">&gt;</span>&nbsp;<span class="num" id="4984269">1</span>&nbsp;<span class="op" id="4984271">||</span>&nbsp;<span class="op" id="4984274">!</span><span class="ident" id="4984275">isTypeName</span><span class="op" id="4984285">(</span><span class="ident" id="4984286">deref</span><span class="op" id="4984291">(</span><span class="ident" id="4984292">typ</span><span class="op" id="4984295">)</span><span class="op" id="4984296">)</span>&nbsp;<span class="op" id="4984298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984303">pos</span>&nbsp;<span class="op" id="4984307">:=</span>&nbsp;<span class="ident" id="4984310">typ</span><span class="op" id="4984313">.</span><span class="ident" id="4984314">Pos</span><span class="op" id="4984317">(</span><span class="op" id="4984318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984323">p</span><span class="op" id="4984324">.</span><span class="ident" id="4984325">errorExpected</span><span class="op" id="4984338">(</span><span class="ident" id="4984339">pos</span><span class="op" id="4984342">,</span>&nbsp;<span class="string" id="4984344">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="4984361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984366">typ</span>&nbsp;<span class="op" id="4984370">=</span>&nbsp;<span class="op" id="4984372">&amp;</span><span class="ident" id="4984373">ast</span><span class="op" id="4984376">.</span><span class="ident" id="4984377">BadExpr</span><span class="op" id="4984384">{</span><span class="ident" id="4984385">From</span><span class="op" id="4984389">:</span>&nbsp;<span class="ident" id="4984391">pos</span><span class="op" id="4984394">,</span>&nbsp;<span class="ident" id="4984396">To</span><span class="op" id="4984398">:</span>&nbsp;<span class="ident" id="4984400">p</span><span class="op" id="4984401">.</span><span class="ident" id="4984402">safePos</span><span class="op" id="4984409">(</span><span class="ident" id="4984410">list</span><span class="op" id="4984414">[</span><span class="ident" id="4984415">n</span><span class="op" id="4984416">-</span><span class="num" id="4984417">1</span><span class="op" id="4984418">]</span><span class="op" id="4984419">.</span><span class="ident" id="4984420">End</span><span class="op" id="4984423">(</span><span class="op" id="4984424">)</span><span class="op" id="4984425">)</span><span class="op" id="4984426">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984437">p</span><span class="op" id="4984438">.</span><span class="ident" id="4984439">expectSemi</span><span class="op" id="4984449">(</span><span class="op" id="4984450">)</span>&nbsp;<span class="comment" id="4984452">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984493">field</span>&nbsp;<span class="op" id="4984499">:=</span>&nbsp;<span class="op" id="4984502">&amp;</span><span class="ident" id="4984503">ast</span><span class="op" id="4984506">.</span><span class="ident" id="4984507">Field</span><span class="op" id="4984512">{</span><span class="ident" id="4984513">Doc</span><span class="op" id="4984516">:</span>&nbsp;<span class="ident" id="4984518">doc</span><span class="op" id="4984521">,</span>&nbsp;<span class="ident" id="4984523">Names</span><span class="op" id="4984528">:</span>&nbsp;<span class="ident" id="4984530">idents</span><span class="op" id="4984536">,</span>&nbsp;<span class="ident" id="4984538">Type</span><span class="op" id="4984542">:</span>&nbsp;<span class="ident" id="4984544">typ</span><span class="op" id="4984547">,</span>&nbsp;<span class="ident" id="4984549">Tag</span><span class="op" id="4984552">:</span>&nbsp;<span class="ident" id="4984554">tag</span><span class="op" id="4984557">,</span>&nbsp;<span class="ident" id="4984559">Comment</span><span class="op" id="4984566">:</span>&nbsp;<span class="ident" id="4984568">p</span><span class="op" id="4984569">.</span><span class="ident" id="4984570">lineComment</span><span class="op" id="4984581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984584">p</span><span class="op" id="4984585">.</span><span class="ident" id="4984586">declare</span><span class="op" id="4984593">(</span><span class="ident" id="4984594">field</span><span class="op" id="4984599">,</span>&nbsp;<span class="ident" id="4984601">nil</span><span class="op" id="4984604">,</span>&nbsp;<span class="ident" id="4984606">scope</span><span class="op" id="4984611">,</span>&nbsp;<span class="ident" id="4984613">ast</span><span class="op" id="4984616">.</span><span class="ident" id="4984617">Var</span><span class="op" id="4984620">,</span>&nbsp;<span class="ident" id="4984622">idents</span><span class="op" id="4984628">...</span><span class="op" id="4984631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984634">p</span><span class="op" id="4984635">.</span><span class="ident" id="4984636">resolve</span><span class="op" id="4984643">(</span><span class="ident" id="4984644">typ</span><span class="op" id="4984647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984651">return</span>&nbsp;<span class="ident" id="4984658">field</span><br>
<span class="lineno">715</span><span class="op" id="4984664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4984667">func</span>&nbsp;<span class="op" id="4984672">(</span><span class="ident" id="4984673">p</span>&nbsp;<span class="op" id="4984675">*</span><span class="ident" id="4984676">parser</span><span class="op" id="4984682">)</span>&nbsp;<span class="ident" id="4984684">parseStructType</span><span class="op" id="4984699">(</span><span class="op" id="4984700">)</span>&nbsp;<span class="op" id="4984702">*</span><span class="ident" id="4984703">ast</span><span class="op" id="4984706">.</span><span class="ident" id="4984707">StructType</span>&nbsp;<span class="op" id="4984718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984721">if</span>&nbsp;<span class="ident" id="4984724">p</span><span class="op" id="4984725">.</span><span class="ident" id="4984726">trace</span>&nbsp;<span class="op" id="4984732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984736">defer</span>&nbsp;<span class="ident" id="4984742">un</span><span class="op" id="4984744">(</span><span class="ident" id="4984745">trace</span><span class="op" id="4984750">(</span><span class="ident" id="4984751">p</span><span class="op" id="4984752">,</span>&nbsp;<span class="string" id="4984754">&#34;StructType&#34;</span><span class="op" id="4984766">)</span><span class="op" id="4984767">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4984770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984774">pos</span>&nbsp;<span class="op" id="4984778">:=</span>&nbsp;<span class="ident" id="4984781">p</span><span class="op" id="4984782">.</span><span class="ident" id="4984783">expect</span><span class="op" id="4984789">(</span><span class="ident" id="4984790">token</span><span class="op" id="4984795">.</span><span class="ident" id="4984796">STRUCT</span><span class="op" id="4984802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984805">lbrace</span>&nbsp;<span class="op" id="4984812">:=</span>&nbsp;<span class="ident" id="4984815">p</span><span class="op" id="4984816">.</span><span class="ident" id="4984817">expect</span><span class="op" id="4984823">(</span><span class="ident" id="4984824">token</span><span class="op" id="4984829">.</span><span class="ident" id="4984830">LBRACE</span><span class="op" id="4984836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984839">scope</span>&nbsp;<span class="op" id="4984845">:=</span>&nbsp;<span class="ident" id="4984848">ast</span><span class="op" id="4984851">.</span><span class="ident" id="4984852">NewScope</span><span class="op" id="4984860">(</span><span class="ident" id="4984861">nil</span><span class="op" id="4984864">)</span>&nbsp;<span class="comment" id="4984866">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984883">var</span>&nbsp;<span class="ident" id="4984887">list</span>&nbsp;<span class="op" id="4984892">[</span><span class="op" id="4984893">]</span><span class="op" id="4984894">*</span><span class="ident" id="4984895">ast</span><span class="op" id="4984898">.</span><span class="ident" id="4984899">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984906">for</span>&nbsp;<span class="ident" id="4984910">p</span><span class="op" id="4984911">.</span><span class="ident" id="4984912">tok</span>&nbsp;<span class="op" id="4984916">==</span>&nbsp;<span class="ident" id="4984919">token</span><span class="op" id="4984924">.</span><span class="ident" id="4984925">IDENT</span>&nbsp;<span class="op" id="4984931">||</span>&nbsp;<span class="ident" id="4984934">p</span><span class="op" id="4984935">.</span><span class="ident" id="4984936">tok</span>&nbsp;<span class="op" id="4984940">==</span>&nbsp;<span class="ident" id="4984943">token</span><span class="op" id="4984948">.</span><span class="ident" id="4984949">MUL</span>&nbsp;<span class="op" id="4984953">||</span>&nbsp;<span class="ident" id="4984956">p</span><span class="op" id="4984957">.</span><span class="ident" id="4984958">tok</span>&nbsp;<span class="op" id="4984962">==</span>&nbsp;<span class="ident" id="4984965">token</span><span class="op" id="4984970">.</span><span class="ident" id="4984971">LPAREN</span>&nbsp;<span class="op" id="4984978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4984982">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4985045">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4985108">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985167">list</span>&nbsp;<span class="op" id="4985172">=</span>&nbsp;<span class="builtinfunc" id="4985174">append</span><span class="op" id="4985180">(</span><span class="ident" id="4985181">list</span><span class="op" id="4985185">,</span>&nbsp;<span class="ident" id="4985187">p</span><span class="op" id="4985188">.</span><span class="ident" id="4985189">parseFieldDecl</span><span class="op" id="4985203">(</span><span class="ident" id="4985204">scope</span><span class="op" id="4985209">)</span><span class="op" id="4985210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985216">rbrace</span>&nbsp;<span class="op" id="4985223">:=</span>&nbsp;<span class="ident" id="4985226">p</span><span class="op" id="4985227">.</span><span class="ident" id="4985228">expect</span><span class="op" id="4985234">(</span><span class="ident" id="4985235">token</span><span class="op" id="4985240">.</span><span class="ident" id="4985241">RBRACE</span><span class="op" id="4985247">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985251">return</span>&nbsp;<span class="op" id="4985258">&amp;</span><span class="ident" id="4985259">ast</span><span class="op" id="4985262">.</span><span class="ident" id="4985263">StructType</span><span class="op" id="4985273">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985277">Struct</span><span class="op" id="4985283">:</span>&nbsp;<span class="ident" id="4985285">pos</span><span class="op" id="4985288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985292">Fields</span><span class="op" id="4985298">:</span>&nbsp;<span class="op" id="4985300">&amp;</span><span class="ident" id="4985301">ast</span><span class="op" id="4985304">.</span><span class="ident" id="4985305">FieldList</span><span class="op" id="4985314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985319">Opening</span><span class="op" id="4985326">:</span>&nbsp;<span class="ident" id="4985328">lbrace</span><span class="op" id="4985334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985339">List</span><span class="op" id="4985343">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4985348">list</span><span class="op" id="4985352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985357">Closing</span><span class="op" id="4985364">:</span>&nbsp;<span class="ident" id="4985366">rbrace</span><span class="op" id="4985372">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985376">}</span><span class="op" id="4985377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985380">}</span><br>
<span class="lineno"></span><span class="op" id="4985382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4985385">func</span>&nbsp;<span class="op" id="4985390">(</span><span class="ident" id="4985391">p</span>&nbsp;<span class="op" id="4985393">*</span><span class="ident" id="4985394">parser</span><span class="op" id="4985400">)</span>&nbsp;<span class="ident" id="4985402">parsePointerType</span><span class="op" id="4985418">(</span><span class="op" id="4985419">)</span>&nbsp;<span class="op" id="4985421">*</span><span class="ident" id="4985422">ast</span><span class="op" id="4985425">.</span><span class="ident" id="4985426">StarExpr</span>&nbsp;<span class="op" id="4985435">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985438">if</span>&nbsp;<span class="ident" id="4985441">p</span><span class="op" id="4985442">.</span><span class="ident" id="4985443">trace</span>&nbsp;<span class="op" id="4985449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985453">defer</span>&nbsp;<span class="ident" id="4985459">un</span><span class="op" id="4985461">(</span><span class="ident" id="4985462">trace</span><span class="op" id="4985467">(</span><span class="ident" id="4985468">p</span><span class="op" id="4985469">,</span>&nbsp;<span class="string" id="4985471">&#34;PointerType&#34;</span><span class="op" id="4985484">)</span><span class="op" id="4985485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985492">star</span>&nbsp;<span class="op" id="4985497">:=</span>&nbsp;<span class="ident" id="4985500">p</span><span class="op" id="4985501">.</span><span class="ident" id="4985502">expect</span><span class="op" id="4985508">(</span><span class="ident" id="4985509">token</span><span class="op" id="4985514">.</span><span class="ident" id="4985515">MUL</span><span class="op" id="4985518">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985521">base</span>&nbsp;<span class="op" id="4985526">:=</span>&nbsp;<span class="ident" id="4985529">p</span><span class="op" id="4985530">.</span><span class="ident" id="4985531">parseType</span><span class="op" id="4985540">(</span><span class="op" id="4985541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985545">return</span>&nbsp;<span class="op" id="4985552">&amp;</span><span class="ident" id="4985553">ast</span><span class="op" id="4985556">.</span><span class="ident" id="4985557">StarExpr</span><span class="op" id="4985565">{</span><span class="ident" id="4985566">Star</span><span class="op" id="4985570">:</span>&nbsp;<span class="ident" id="4985572">star</span><span class="op" id="4985576">,</span>&nbsp;<span class="ident" id="4985578">X</span><span class="op" id="4985579">:</span>&nbsp;<span class="ident" id="4985581">base</span><span class="op" id="4985585">}</span><br>
<span class="lineno"></span><span class="op" id="4985587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="4985590">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4985645">func</span>&nbsp;<span class="op" id="4985650">(</span><span class="ident" id="4985651">p</span>&nbsp;<span class="op" id="4985653">*</span><span class="ident" id="4985654">parser</span><span class="op" id="4985660">)</span>&nbsp;<span class="ident" id="4985662">tryVarType</span><span class="op" id="4985672">(</span><span class="ident" id="4985673">isParam</span>&nbsp;<span class="builtintype" id="4985681">bool</span><span class="op" id="4985685">)</span>&nbsp;<span class="ident" id="4985687">ast</span><span class="op" id="4985690">.</span><span class="ident" id="4985691">Expr</span>&nbsp;<span class="op" id="4985696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985699">if</span>&nbsp;<span class="ident" id="4985702">isParam</span>&nbsp;<span class="op" id="4985710">&amp;&amp;</span>&nbsp;<span class="ident" id="4985713">p</span><span class="op" id="4985714">.</span><span class="ident" id="4985715">tok</span>&nbsp;<span class="op" id="4985719">==</span>&nbsp;<span class="ident" id="4985722">token</span><span class="op" id="4985727">.</span><span class="ident" id="4985728">ELLIPSIS</span>&nbsp;<span class="op" id="4985737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985741">pos</span>&nbsp;<span class="op" id="4985745">:=</span>&nbsp;<span class="ident" id="4985748">p</span><span class="op" id="4985749">.</span><span class="ident" id="4985750">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985756">p</span><span class="op" id="4985757">.</span><span class="ident" id="4985758">next</span><span class="op" id="4985762">(</span><span class="op" id="4985763">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985767">typ</span>&nbsp;<span class="op" id="4985771">:=</span>&nbsp;<span class="ident" id="4985774">p</span><span class="op" id="4985775">.</span><span class="ident" id="4985776">tryIdentOrType</span><span class="op" id="4985790">(</span><span class="op" id="4985791">)</span>&nbsp;<span class="comment" id="4985793">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4985857">if</span>&nbsp;<span class="ident" id="4985860">typ</span>&nbsp;<span class="op" id="4985864">!=</span>&nbsp;<span class="ident" id="4985867">nil</span>&nbsp;<span class="op" id="4985871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985876">p</span><span class="op" id="4985877">.</span><span class="ident" id="4985878">resolve</span><span class="op" id="4985885">(</span><span class="ident" id="4985886">typ</span><span class="op" id="4985889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985893">}</span>&nbsp;<span class="keyword" id="4985895">else</span>&nbsp;<span class="op" id="4985900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985905">p</span><span class="op" id="4985906">.</span><span class="builtintype" id="4985907">error</span><span class="op" id="4985912">(</span><span class="ident" id="4985913">pos</span><span class="op" id="4985916">,</span>&nbsp;<span class="string" id="4985918">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="4985951">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4985956">typ</span>&nbsp;<span class="op" id="4985960">=</span>&nbsp;<span class="op" id="4985962">&amp;</span><span class="ident" id="4985963">ast</span><span class="op" id="4985966">.</span><span class="ident" id="4985967">BadExpr</span><span class="op" id="4985974">{</span><span class="ident" id="4985975">From</span><span class="op" id="4985979">:</span>&nbsp;<span class="ident" id="4985981">pos</span><span class="op" id="4985984">,</span>&nbsp;<span class="ident" id="4985986">To</span><span class="op" id="4985988">:</span>&nbsp;<span class="ident" id="4985990">p</span><span class="op" id="4985991">.</span><span class="ident" id="4985992">pos</span><span class="op" id="4985995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4985999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986003">return</span>&nbsp;<span class="op" id="4986010">&amp;</span><span class="ident" id="4986011">ast</span><span class="op" id="4986014">.</span><span class="ident" id="4986015">Ellipsis</span><span class="op" id="4986023">{</span><span class="ident" id="4986024">Ellipsis</span><span class="op" id="4986032">:</span>&nbsp;<span class="ident" id="4986034">pos</span><span class="op" id="4986037">,</span>&nbsp;<span class="ident" id="4986039">Elt</span><span class="op" id="4986042">:</span>&nbsp;<span class="ident" id="4986044">typ</span><span class="op" id="4986047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4986050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986053">return</span>&nbsp;<span class="ident" id="4986060">p</span><span class="op" id="4986061">.</span><span class="ident" id="4986062">tryIdentOrType</span><span class="op" id="4986076">(</span><span class="op" id="4986077">)</span><br>
<span class="lineno">770</span><span class="op" id="4986079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4986082">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4986137">func</span>&nbsp;<span class="op" id="4986142">(</span><span class="ident" id="4986143">p</span>&nbsp;<span class="op" id="4986145">*</span><span class="ident" id="4986146">parser</span><span class="op" id="4986152">)</span>&nbsp;<span class="ident" id="4986154">parseVarType</span><span class="op" id="4986166">(</span><span class="ident" id="4986167">isParam</span>&nbsp;<span class="builtintype" id="4986175">bool</span><span class="op" id="4986179">)</span>&nbsp;<span class="ident" id="4986181">ast</span><span class="op" id="4986184">.</span><span class="ident" id="4986185">Expr</span>&nbsp;<span class="op" id="4986190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986193">typ</span>&nbsp;<span class="op" id="4986197">:=</span>&nbsp;<span class="ident" id="4986200">p</span><span class="op" id="4986201">.</span><span class="ident" id="4986202">tryVarType</span><span class="op" id="4986212">(</span><span class="ident" id="4986213">isParam</span><span class="op" id="4986220">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986223">if</span>&nbsp;<span class="ident" id="4986226">typ</span>&nbsp;<span class="op" id="4986230">==</span>&nbsp;<span class="ident" id="4986233">nil</span>&nbsp;<span class="op" id="4986237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986241">pos</span>&nbsp;<span class="op" id="4986245">:=</span>&nbsp;<span class="ident" id="4986248">p</span><span class="op" id="4986249">.</span><span class="ident" id="4986250">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986256">p</span><span class="op" id="4986257">.</span><span class="ident" id="4986258">errorExpected</span><span class="op" id="4986271">(</span><span class="ident" id="4986272">pos</span><span class="op" id="4986275">,</span>&nbsp;<span class="string" id="4986277">&#34;type&#34;</span><span class="op" id="4986283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986287">p</span><span class="op" id="4986288">.</span><span class="ident" id="4986289">next</span><span class="op" id="4986293">(</span><span class="op" id="4986294">)</span>&nbsp;<span class="comment" id="4986296">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986315">typ</span>&nbsp;<span class="op" id="4986319">=</span>&nbsp;<span class="op" id="4986321">&amp;</span><span class="ident" id="4986322">ast</span><span class="op" id="4986325">.</span><span class="ident" id="4986326">BadExpr</span><span class="op" id="4986333">{</span><span class="ident" id="4986334">From</span><span class="op" id="4986338">:</span>&nbsp;<span class="ident" id="4986340">pos</span><span class="op" id="4986343">,</span>&nbsp;<span class="ident" id="4986345">To</span><span class="op" id="4986347">:</span>&nbsp;<span class="ident" id="4986349">p</span><span class="op" id="4986350">.</span><span class="ident" id="4986351">pos</span><span class="op" id="4986354">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4986357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986360">return</span>&nbsp;<span class="ident" id="4986367">typ</span><br>
<span class="lineno"></span><span class="op" id="4986371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4986374">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="4986439">func</span>&nbsp;<span class="op" id="4986444">(</span><span class="ident" id="4986445">p</span>&nbsp;<span class="op" id="4986447">*</span><span class="ident" id="4986448">parser</span><span class="op" id="4986454">)</span>&nbsp;<span class="ident" id="4986456">parseVarList</span><span class="op" id="4986468">(</span><span class="ident" id="4986469">isParam</span>&nbsp;<span class="builtintype" id="4986477">bool</span><span class="op" id="4986481">)</span>&nbsp;<span class="op" id="4986483">(</span><span class="ident" id="4986484">list</span>&nbsp;<span class="op" id="4986489">[</span><span class="op" id="4986490">]</span><span class="ident" id="4986491">ast</span><span class="op" id="4986494">.</span><span class="ident" id="4986495">Expr</span><span class="op" id="4986499">,</span>&nbsp;<span class="ident" id="4986501">typ</span>&nbsp;<span class="ident" id="4986505">ast</span><span class="op" id="4986508">.</span><span class="ident" id="4986509">Expr</span><span class="op" id="4986513">)</span>&nbsp;<span class="op" id="4986515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986518">if</span>&nbsp;<span class="ident" id="4986521">p</span><span class="op" id="4986522">.</span><span class="ident" id="4986523">trace</span>&nbsp;<span class="op" id="4986529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986533">defer</span>&nbsp;<span class="ident" id="4986539">un</span><span class="op" id="4986541">(</span><span class="ident" id="4986542">trace</span><span class="op" id="4986547">(</span><span class="ident" id="4986548">p</span><span class="op" id="4986549">,</span>&nbsp;<span class="string" id="4986551">&#34;VarList&#34;</span><span class="op" id="4986560">)</span><span class="op" id="4986561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4986564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4986568">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4986626">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4986630">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4986693">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4986756">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986819">for</span>&nbsp;<span class="ident" id="4986823">typ</span>&nbsp;<span class="op" id="4986827">:=</span>&nbsp;<span class="ident" id="4986830">p</span><span class="op" id="4986831">.</span><span class="ident" id="4986832">parseVarType</span><span class="op" id="4986844">(</span><span class="ident" id="4986845">isParam</span><span class="op" id="4986852">)</span><span class="op" id="4986853">;</span>&nbsp;<span class="ident" id="4986855">typ</span>&nbsp;<span class="op" id="4986859">!=</span>&nbsp;<span class="ident" id="4986862">nil</span><span class="op" id="4986865">;</span>&nbsp;<span class="op" id="4986867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986871">list</span>&nbsp;<span class="op" id="4986876">=</span>&nbsp;<span class="builtinfunc" id="4986878">append</span><span class="op" id="4986884">(</span><span class="ident" id="4986885">list</span><span class="op" id="4986889">,</span>&nbsp;<span class="ident" id="4986891">typ</span><span class="op" id="4986894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986898">if</span>&nbsp;<span class="ident" id="4986901">p</span><span class="op" id="4986902">.</span><span class="ident" id="4986903">tok</span>&nbsp;<span class="op" id="4986907">!=</span>&nbsp;<span class="ident" id="4986910">token</span><span class="op" id="4986915">.</span><span class="ident" id="4986916">COMMA</span>&nbsp;<span class="op" id="4986922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4986927">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4986935">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986939">p</span><span class="op" id="4986940">.</span><span class="ident" id="4986941">next</span><span class="op" id="4986945">(</span><span class="op" id="4986946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4986950">typ</span>&nbsp;<span class="op" id="4986954">=</span>&nbsp;<span class="ident" id="4986956">p</span><span class="op" id="4986957">.</span><span class="ident" id="4986958">tryVarType</span><span class="op" id="4986968">(</span><span class="ident" id="4986969">isParam</span><span class="op" id="4986976">)</span>&nbsp;<span class="comment" id="4986978">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4987019">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987086">typ</span>&nbsp;<span class="op" id="4987090">=</span>&nbsp;<span class="ident" id="4987092">p</span><span class="op" id="4987093">.</span><span class="ident" id="4987094">tryVarType</span><span class="op" id="4987104">(</span><span class="ident" id="4987105">isParam</span><span class="op" id="4987112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987116">return</span><br>
<span class="lineno"></span><span class="op" id="4987123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="4987126">func</span>&nbsp;<span class="op" id="4987131">(</span><span class="ident" id="4987132">p</span>&nbsp;<span class="op" id="4987134">*</span><span class="ident" id="4987135">parser</span><span class="op" id="4987141">)</span>&nbsp;<span class="ident" id="4987143">parseParameterList</span><span class="op" id="4987161">(</span><span class="ident" id="4987162">scope</span>&nbsp;<span class="op" id="4987168">*</span><span class="ident" id="4987169">ast</span><span class="op" id="4987172">.</span><span class="ident" id="4987173">Scope</span><span class="op" id="4987178">,</span>&nbsp;<span class="ident" id="4987180">ellipsisOk</span>&nbsp;<span class="builtintype" id="4987191">bool</span><span class="op" id="4987195">)</span>&nbsp;<span class="op" id="4987197">(</span><span class="ident" id="4987198">params</span>&nbsp;<span class="op" id="4987205">[</span><span class="op" id="4987206">]</span><span class="op" id="4987207">*</span><span class="ident" id="4987208">ast</span><span class="op" id="4987211">.</span><span class="ident" id="4987212">Field</span><span class="op" id="4987217">)</span>&nbsp;<span class="op" id="4987219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987222">if</span>&nbsp;<span class="ident" id="4987225">p</span><span class="op" id="4987226">.</span><span class="ident" id="4987227">trace</span>&nbsp;<span class="op" id="4987233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987237">defer</span>&nbsp;<span class="ident" id="4987243">un</span><span class="op" id="4987245">(</span><span class="ident" id="4987246">trace</span><span class="op" id="4987251">(</span><span class="ident" id="4987252">p</span><span class="op" id="4987253">,</span>&nbsp;<span class="string" id="4987255">&#34;ParameterList&#34;</span><span class="op" id="4987270">)</span><span class="op" id="4987271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4987278">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987296">list</span><span class="op" id="4987300">,</span>&nbsp;<span class="ident" id="4987302">typ</span>&nbsp;<span class="op" id="4987306">:=</span>&nbsp;<span class="ident" id="4987309">p</span><span class="op" id="4987310">.</span><span class="ident" id="4987311">parseVarList</span><span class="op" id="4987323">(</span><span class="ident" id="4987324">ellipsisOk</span><span class="op" id="4987334">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4987338">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987355">if</span>&nbsp;<span class="ident" id="4987358">typ</span>&nbsp;<span class="op" id="4987362">!=</span>&nbsp;<span class="ident" id="4987365">nil</span>&nbsp;<span class="op" id="4987369">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4987373">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987398">idents</span>&nbsp;<span class="op" id="4987405">:=</span>&nbsp;<span class="ident" id="4987408">p</span><span class="op" id="4987409">.</span><span class="ident" id="4987410">makeIdentList</span><span class="op" id="4987423">(</span><span class="ident" id="4987424">list</span><span class="op" id="4987428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987432">field</span>&nbsp;<span class="op" id="4987438">:=</span>&nbsp;<span class="op" id="4987441">&amp;</span><span class="ident" id="4987442">ast</span><span class="op" id="4987445">.</span><span class="ident" id="4987446">Field</span><span class="op" id="4987451">{</span><span class="ident" id="4987452">Names</span><span class="op" id="4987457">:</span>&nbsp;<span class="ident" id="4987459">idents</span><span class="op" id="4987465">,</span>&nbsp;<span class="ident" id="4987467">Type</span><span class="op" id="4987471">:</span>&nbsp;<span class="ident" id="4987473">typ</span><span class="op" id="4987476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987480">params</span>&nbsp;<span class="op" id="4987487">=</span>&nbsp;<span class="builtinfunc" id="4987489">append</span><span class="op" id="4987495">(</span><span class="ident" id="4987496">params</span><span class="op" id="4987502">,</span>&nbsp;<span class="ident" id="4987504">field</span><span class="op" id="4987509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4987513">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4987574">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987630">p</span><span class="op" id="4987631">.</span><span class="ident" id="4987632">declare</span><span class="op" id="4987639">(</span><span class="ident" id="4987640">field</span><span class="op" id="4987645">,</span>&nbsp;<span class="ident" id="4987647">nil</span><span class="op" id="4987650">,</span>&nbsp;<span class="ident" id="4987652">scope</span><span class="op" id="4987657">,</span>&nbsp;<span class="ident" id="4987659">ast</span><span class="op" id="4987662">.</span><span class="ident" id="4987663">Var</span><span class="op" id="4987666">,</span>&nbsp;<span class="ident" id="4987668">idents</span><span class="op" id="4987674">...</span><span class="op" id="4987677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987681">p</span><span class="op" id="4987682">.</span><span class="ident" id="4987683">resolve</span><span class="op" id="4987690">(</span><span class="ident" id="4987691">typ</span><span class="op" id="4987694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987698">if</span>&nbsp;<span class="op" id="4987701">!</span><span class="ident" id="4987702">p</span><span class="op" id="4987703">.</span><span class="ident" id="4987704">atComma</span><span class="op" id="4987711">(</span><span class="string" id="4987712">&#34;parameter&nbsp;list&#34;</span><span class="op" id="4987728">)</span>&nbsp;<span class="op" id="4987730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987735">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4987744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987748">p</span><span class="op" id="4987749">.</span><span class="ident" id="4987750">next</span><span class="op" id="4987754">(</span><span class="op" id="4987755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4987759">for</span>&nbsp;<span class="ident" id="4987763">p</span><span class="op" id="4987764">.</span><span class="ident" id="4987765">tok</span>&nbsp;<span class="op" id="4987769">!=</span>&nbsp;<span class="ident" id="4987772">token</span><span class="op" id="4987777">.</span><span class="ident" id="4987778">RPAREN</span>&nbsp;<span class="op" id="4987785">&amp;&amp;</span>&nbsp;<span class="ident" id="4987788">p</span><span class="op" id="4987789">.</span><span class="ident" id="4987790">tok</span>&nbsp;<span class="op" id="4987794">!=</span>&nbsp;<span class="ident" id="4987797">token</span><span class="op" id="4987802">.</span><span class="ident" id="4987803">EOF</span>&nbsp;<span class="op" id="4987807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987812">idents</span>&nbsp;<span class="op" id="4987819">:=</span>&nbsp;<span class="ident" id="4987822">p</span><span class="op" id="4987823">.</span><span class="ident" id="4987824">parseIdentList</span><span class="op" id="4987838">(</span><span class="op" id="4987839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987844">typ</span>&nbsp;<span class="op" id="4987848">:=</span>&nbsp;<span class="ident" id="4987851">p</span><span class="op" id="4987852">.</span><span class="ident" id="4987853">parseVarType</span><span class="op" id="4987865">(</span><span class="ident" id="4987866">ellipsisOk</span><span class="op" id="4987876">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987881">field</span>&nbsp;<span class="op" id="4987887">:=</span>&nbsp;<span class="op" id="4987890">&amp;</span><span class="ident" id="4987891">ast</span><span class="op" id="4987894">.</span><span class="ident" id="4987895">Field</span><span class="op" id="4987900">{</span><span class="ident" id="4987901">Names</span><span class="op" id="4987906">:</span>&nbsp;<span class="ident" id="4987908">idents</span><span class="op" id="4987914">,</span>&nbsp;<span class="ident" id="4987916">Type</span><span class="op" id="4987920">:</span>&nbsp;<span class="ident" id="4987922">typ</span><span class="op" id="4987925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4987930">params</span>&nbsp;<span class="op" id="4987937">=</span>&nbsp;<span class="builtinfunc" id="4987939">append</span><span class="op" id="4987945">(</span><span class="ident" id="4987946">params</span><span class="op" id="4987952">,</span>&nbsp;<span class="ident" id="4987954">field</span><span class="op" id="4987959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4987964">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4988026">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988083">p</span><span class="op" id="4988084">.</span><span class="ident" id="4988085">declare</span><span class="op" id="4988092">(</span><span class="ident" id="4988093">field</span><span class="op" id="4988098">,</span>&nbsp;<span class="ident" id="4988100">nil</span><span class="op" id="4988103">,</span>&nbsp;<span class="ident" id="4988105">scope</span><span class="op" id="4988110">,</span>&nbsp;<span class="ident" id="4988112">ast</span><span class="op" id="4988115">.</span><span class="ident" id="4988116">Var</span><span class="op" id="4988119">,</span>&nbsp;<span class="ident" id="4988121">idents</span><span class="op" id="4988127">...</span><span class="op" id="4988130">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988135">p</span><span class="op" id="4988136">.</span><span class="ident" id="4988137">resolve</span><span class="op" id="4988144">(</span><span class="ident" id="4988145">typ</span><span class="op" id="4988148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988153">if</span>&nbsp;<span class="op" id="4988156">!</span><span class="ident" id="4988157">p</span><span class="op" id="4988158">.</span><span class="ident" id="4988159">atComma</span><span class="op" id="4988166">(</span><span class="string" id="4988167">&#34;parameter&nbsp;list&#34;</span><span class="op" id="4988183">)</span>&nbsp;<span class="op" id="4988185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988191">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988205">p</span><span class="op" id="4988206">.</span><span class="ident" id="4988207">next</span><span class="op" id="4988211">(</span><span class="op" id="4988212">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988220">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4988232">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988277">params</span>&nbsp;<span class="op" id="4988284">=</span>&nbsp;<span class="builtinfunc" id="4988286">make</span><span class="op" id="4988290">(</span><span class="op" id="4988291">[</span><span class="op" id="4988292">]</span><span class="op" id="4988293">*</span><span class="ident" id="4988294">ast</span><span class="op" id="4988297">.</span><span class="ident" id="4988298">Field</span><span class="op" id="4988303">,</span>&nbsp;<span class="builtinfunc" id="4988305">len</span><span class="op" id="4988308">(</span><span class="ident" id="4988309">list</span><span class="op" id="4988313">)</span><span class="op" id="4988314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988317">for</span>&nbsp;<span class="ident" id="4988321">i</span><span class="op" id="4988322">,</span>&nbsp;<span class="ident" id="4988324">typ</span>&nbsp;<span class="op" id="4988328">:=</span>&nbsp;<span class="keyword" id="4988331">range</span>&nbsp;<span class="ident" id="4988337">list</span>&nbsp;<span class="op" id="4988342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988346">p</span><span class="op" id="4988347">.</span><span class="ident" id="4988348">resolve</span><span class="op" id="4988355">(</span><span class="ident" id="4988356">typ</span><span class="op" id="4988359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988363">params</span><span class="op" id="4988369">[</span><span class="ident" id="4988370">i</span><span class="op" id="4988371">]</span>&nbsp;<span class="op" id="4988373">=</span>&nbsp;<span class="op" id="4988375">&amp;</span><span class="ident" id="4988376">ast</span><span class="op" id="4988379">.</span><span class="ident" id="4988380">Field</span><span class="op" id="4988385">{</span><span class="ident" id="4988386">Type</span><span class="op" id="4988390">:</span>&nbsp;<span class="ident" id="4988392">typ</span><span class="op" id="4988395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988398">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988401">return</span><br>
<span class="lineno"></span><span class="op" id="4988408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4988411">func</span>&nbsp;<span class="op" id="4988416">(</span><span class="ident" id="4988417">p</span>&nbsp;<span class="op" id="4988419">*</span><span class="ident" id="4988420">parser</span><span class="op" id="4988426">)</span>&nbsp;<span class="ident" id="4988428">parseParameters</span><span class="op" id="4988443">(</span><span class="ident" id="4988444">scope</span>&nbsp;<span class="op" id="4988450">*</span><span class="ident" id="4988451">ast</span><span class="op" id="4988454">.</span><span class="ident" id="4988455">Scope</span><span class="op" id="4988460">,</span>&nbsp;<span class="ident" id="4988462">ellipsisOk</span>&nbsp;<span class="builtintype" id="4988473">bool</span><span class="op" id="4988477">)</span>&nbsp;<span class="op" id="4988479">*</span><span class="ident" id="4988480">ast</span><span class="op" id="4988483">.</span><span class="ident" id="4988484">FieldList</span>&nbsp;<span class="op" id="4988494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988497">if</span>&nbsp;<span class="ident" id="4988500">p</span><span class="op" id="4988501">.</span><span class="ident" id="4988502">trace</span>&nbsp;<span class="op" id="4988508">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988512">defer</span>&nbsp;<span class="ident" id="4988518">un</span><span class="op" id="4988520">(</span><span class="ident" id="4988521">trace</span><span class="op" id="4988526">(</span><span class="ident" id="4988527">p</span><span class="op" id="4988528">,</span>&nbsp;<span class="string" id="4988530">&#34;Parameters&#34;</span><span class="op" id="4988542">)</span><span class="op" id="4988543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988550">var</span>&nbsp;<span class="ident" id="4988554">params</span>&nbsp;<span class="op" id="4988561">[</span><span class="op" id="4988562">]</span><span class="op" id="4988563">*</span><span class="ident" id="4988564">ast</span><span class="op" id="4988567">.</span><span class="ident" id="4988568">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988575">lparen</span>&nbsp;<span class="op" id="4988582">:=</span>&nbsp;<span class="ident" id="4988585">p</span><span class="op" id="4988586">.</span><span class="ident" id="4988587">expect</span><span class="op" id="4988593">(</span><span class="ident" id="4988594">token</span><span class="op" id="4988599">.</span><span class="ident" id="4988600">LPAREN</span><span class="op" id="4988606">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988609">if</span>&nbsp;<span class="ident" id="4988612">p</span><span class="op" id="4988613">.</span><span class="ident" id="4988614">tok</span>&nbsp;<span class="op" id="4988618">!=</span>&nbsp;<span class="ident" id="4988621">token</span><span class="op" id="4988626">.</span><span class="ident" id="4988627">RPAREN</span>&nbsp;<span class="op" id="4988634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988638">params</span>&nbsp;<span class="op" id="4988645">=</span>&nbsp;<span class="ident" id="4988647">p</span><span class="op" id="4988648">.</span><span class="ident" id="4988649">parseParameterList</span><span class="op" id="4988667">(</span><span class="ident" id="4988668">scope</span><span class="op" id="4988673">,</span>&nbsp;<span class="ident" id="4988675">ellipsisOk</span><span class="op" id="4988685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988691">rparen</span>&nbsp;<span class="op" id="4988698">:=</span>&nbsp;<span class="ident" id="4988701">p</span><span class="op" id="4988702">.</span><span class="ident" id="4988703">expect</span><span class="op" id="4988709">(</span><span class="ident" id="4988710">token</span><span class="op" id="4988715">.</span><span class="ident" id="4988716">RPAREN</span><span class="op" id="4988722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988726">return</span>&nbsp;<span class="op" id="4988733">&amp;</span><span class="ident" id="4988734">ast</span><span class="op" id="4988737">.</span><span class="ident" id="4988738">FieldList</span><span class="op" id="4988747">{</span><span class="ident" id="4988748">Opening</span><span class="op" id="4988755">:</span>&nbsp;<span class="ident" id="4988757">lparen</span><span class="op" id="4988763">,</span>&nbsp;<span class="ident" id="4988765">List</span><span class="op" id="4988769">:</span>&nbsp;<span class="ident" id="4988771">params</span><span class="op" id="4988777">,</span>&nbsp;<span class="ident" id="4988779">Closing</span><span class="op" id="4988786">:</span>&nbsp;<span class="ident" id="4988788">rparen</span><span class="op" id="4988794">}</span><br>
<span class="lineno"></span><span class="op" id="4988796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4988799">func</span>&nbsp;<span class="op" id="4988804">(</span><span class="ident" id="4988805">p</span>&nbsp;<span class="op" id="4988807">*</span><span class="ident" id="4988808">parser</span><span class="op" id="4988814">)</span>&nbsp;<span class="ident" id="4988816">parseResult</span><span class="op" id="4988827">(</span><span class="ident" id="4988828">scope</span>&nbsp;<span class="op" id="4988834">*</span><span class="ident" id="4988835">ast</span><span class="op" id="4988838">.</span><span class="ident" id="4988839">Scope</span><span class="op" id="4988844">)</span>&nbsp;<span class="op" id="4988846">*</span><span class="ident" id="4988847">ast</span><span class="op" id="4988850">.</span><span class="ident" id="4988851">FieldList</span>&nbsp;<span class="op" id="4988861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988864">if</span>&nbsp;<span class="ident" id="4988867">p</span><span class="op" id="4988868">.</span><span class="ident" id="4988869">trace</span>&nbsp;<span class="op" id="4988875">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988879">defer</span>&nbsp;<span class="ident" id="4988885">un</span><span class="op" id="4988887">(</span><span class="ident" id="4988888">trace</span><span class="op" id="4988893">(</span><span class="ident" id="4988894">p</span><span class="op" id="4988895">,</span>&nbsp;<span class="string" id="4988897">&#34;Result&#34;</span><span class="op" id="4988905">)</span><span class="op" id="4988906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988913">if</span>&nbsp;<span class="ident" id="4988916">p</span><span class="op" id="4988917">.</span><span class="ident" id="4988918">tok</span>&nbsp;<span class="op" id="4988922">==</span>&nbsp;<span class="ident" id="4988925">token</span><span class="op" id="4988930">.</span><span class="ident" id="4988931">LPAREN</span>&nbsp;<span class="op" id="4988938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4988942">return</span>&nbsp;<span class="ident" id="4988949">p</span><span class="op" id="4988950">.</span><span class="ident" id="4988951">parseParameters</span><span class="op" id="4988966">(</span><span class="ident" id="4988967">scope</span><span class="op" id="4988972">,</span>&nbsp;<span class="builtintype" id="4988974">false</span><span class="op" id="4988979">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4988982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4988986">typ</span>&nbsp;<span class="op" id="4988990">:=</span>&nbsp;<span class="ident" id="4988993">p</span><span class="op" id="4988994">.</span><span class="ident" id="4988995">tryType</span><span class="op" id="4989002">(</span><span class="op" id="4989003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989006">if</span>&nbsp;<span class="ident" id="4989009">typ</span>&nbsp;<span class="op" id="4989013">!=</span>&nbsp;<span class="ident" id="4989016">nil</span>&nbsp;<span class="op" id="4989020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989024">list</span>&nbsp;<span class="op" id="4989029">:=</span>&nbsp;<span class="builtinfunc" id="4989032">make</span><span class="op" id="4989036">(</span><span class="op" id="4989037">[</span><span class="op" id="4989038">]</span><span class="op" id="4989039">*</span><span class="ident" id="4989040">ast</span><span class="op" id="4989043">.</span><span class="ident" id="4989044">Field</span><span class="op" id="4989049">,</span>&nbsp;<span class="num" id="4989051">1</span><span class="op" id="4989052">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989056">list</span><span class="op" id="4989060">[</span><span class="num" id="4989061">0</span><span class="op" id="4989062">]</span>&nbsp;<span class="op" id="4989064">=</span>&nbsp;<span class="op" id="4989066">&amp;</span><span class="ident" id="4989067">ast</span><span class="op" id="4989070">.</span><span class="ident" id="4989071">Field</span><span class="op" id="4989076">{</span><span class="ident" id="4989077">Type</span><span class="op" id="4989081">:</span>&nbsp;<span class="ident" id="4989083">typ</span><span class="op" id="4989086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989090">return</span>&nbsp;<span class="op" id="4989097">&amp;</span><span class="ident" id="4989098">ast</span><span class="op" id="4989101">.</span><span class="ident" id="4989102">FieldList</span><span class="op" id="4989111">{</span><span class="ident" id="4989112">List</span><span class="op" id="4989116">:</span>&nbsp;<span class="ident" id="4989118">list</span><span class="op" id="4989122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989129">return</span>&nbsp;<span class="ident" id="4989136">nil</span><br>
<span class="lineno">890</span><span class="op" id="4989140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4989143">func</span>&nbsp;<span class="op" id="4989148">(</span><span class="ident" id="4989149">p</span>&nbsp;<span class="op" id="4989151">*</span><span class="ident" id="4989152">parser</span><span class="op" id="4989158">)</span>&nbsp;<span class="ident" id="4989160">parseSignature</span><span class="op" id="4989174">(</span><span class="ident" id="4989175">scope</span>&nbsp;<span class="op" id="4989181">*</span><span class="ident" id="4989182">ast</span><span class="op" id="4989185">.</span><span class="ident" id="4989186">Scope</span><span class="op" id="4989191">)</span>&nbsp;<span class="op" id="4989193">(</span><span class="ident" id="4989194">params</span><span class="op" id="4989200">,</span>&nbsp;<span class="ident" id="4989202">results</span>&nbsp;<span class="op" id="4989210">*</span><span class="ident" id="4989211">ast</span><span class="op" id="4989214">.</span><span class="ident" id="4989215">FieldList</span><span class="op" id="4989224">)</span>&nbsp;<span class="op" id="4989226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989229">if</span>&nbsp;<span class="ident" id="4989232">p</span><span class="op" id="4989233">.</span><span class="ident" id="4989234">trace</span>&nbsp;<span class="op" id="4989240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989244">defer</span>&nbsp;<span class="ident" id="4989250">un</span><span class="op" id="4989252">(</span><span class="ident" id="4989253">trace</span><span class="op" id="4989258">(</span><span class="ident" id="4989259">p</span><span class="op" id="4989260">,</span>&nbsp;<span class="string" id="4989262">&#34;Signature&#34;</span><span class="op" id="4989273">)</span><span class="op" id="4989274">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989281">params</span>&nbsp;<span class="op" id="4989288">=</span>&nbsp;<span class="ident" id="4989290">p</span><span class="op" id="4989291">.</span><span class="ident" id="4989292">parseParameters</span><span class="op" id="4989307">(</span><span class="ident" id="4989308">scope</span><span class="op" id="4989313">,</span>&nbsp;<span class="builtintype" id="4989315">true</span><span class="op" id="4989319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989322">results</span>&nbsp;<span class="op" id="4989330">=</span>&nbsp;<span class="ident" id="4989332">p</span><span class="op" id="4989333">.</span><span class="ident" id="4989334">parseResult</span><span class="op" id="4989345">(</span><span class="ident" id="4989346">scope</span><span class="op" id="4989351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989355">return</span><br>
<span class="lineno"></span><span class="op" id="4989362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4989365">func</span>&nbsp;<span class="op" id="4989370">(</span><span class="ident" id="4989371">p</span>&nbsp;<span class="op" id="4989373">*</span><span class="ident" id="4989374">parser</span><span class="op" id="4989380">)</span>&nbsp;<span class="ident" id="4989382">parseFuncType</span><span class="op" id="4989395">(</span><span class="op" id="4989396">)</span>&nbsp;<span class="op" id="4989398">(</span><span class="op" id="4989399">*</span><span class="ident" id="4989400">ast</span><span class="op" id="4989403">.</span><span class="ident" id="4989404">FuncType</span><span class="op" id="4989412">,</span>&nbsp;<span class="op" id="4989414">*</span><span class="ident" id="4989415">ast</span><span class="op" id="4989418">.</span><span class="ident" id="4989419">Scope</span><span class="op" id="4989424">)</span>&nbsp;<span class="op" id="4989426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989429">if</span>&nbsp;<span class="ident" id="4989432">p</span><span class="op" id="4989433">.</span><span class="ident" id="4989434">trace</span>&nbsp;<span class="op" id="4989440">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989444">defer</span>&nbsp;<span class="ident" id="4989450">un</span><span class="op" id="4989452">(</span><span class="ident" id="4989453">trace</span><span class="op" id="4989458">(</span><span class="ident" id="4989459">p</span><span class="op" id="4989460">,</span>&nbsp;<span class="string" id="4989462">&#34;FuncType&#34;</span><span class="op" id="4989472">)</span><span class="op" id="4989473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989480">pos</span>&nbsp;<span class="op" id="4989484">:=</span>&nbsp;<span class="ident" id="4989487">p</span><span class="op" id="4989488">.</span><span class="ident" id="4989489">expect</span><span class="op" id="4989495">(</span><span class="ident" id="4989496">token</span><span class="op" id="4989501">.</span><span class="ident" id="4989502">FUNC</span><span class="op" id="4989506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989509">scope</span>&nbsp;<span class="op" id="4989515">:=</span>&nbsp;<span class="ident" id="4989518">ast</span><span class="op" id="4989521">.</span><span class="ident" id="4989522">NewScope</span><span class="op" id="4989530">(</span><span class="ident" id="4989531">p</span><span class="op" id="4989532">.</span><span class="ident" id="4989533">topScope</span><span class="op" id="4989541">)</span>&nbsp;<span class="comment" id="4989543">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989562">params</span><span class="op" id="4989568">,</span>&nbsp;<span class="ident" id="4989570">results</span>&nbsp;<span class="op" id="4989578">:=</span>&nbsp;<span class="ident" id="4989581">p</span><span class="op" id="4989582">.</span><span class="ident" id="4989583">parseSignature</span><span class="op" id="4989597">(</span><span class="ident" id="4989598">scope</span><span class="op" id="4989603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989607">return</span>&nbsp;<span class="op" id="4989614">&amp;</span><span class="ident" id="4989615">ast</span><span class="op" id="4989618">.</span><span class="ident" id="4989619">FuncType</span><span class="op" id="4989627">{</span><span class="ident" id="4989628">Func</span><span class="op" id="4989632">:</span>&nbsp;<span class="ident" id="4989634">pos</span><span class="op" id="4989637">,</span>&nbsp;<span class="ident" id="4989639">Params</span><span class="op" id="4989645">:</span>&nbsp;<span class="ident" id="4989647">params</span><span class="op" id="4989653">,</span>&nbsp;<span class="ident" id="4989655">Results</span><span class="op" id="4989662">:</span>&nbsp;<span class="ident" id="4989664">results</span><span class="op" id="4989671">}</span><span class="op" id="4989672">,</span>&nbsp;<span class="ident" id="4989674">scope</span><br>
<span class="lineno"></span><span class="op" id="4989680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="4989683">func</span>&nbsp;<span class="op" id="4989688">(</span><span class="ident" id="4989689">p</span>&nbsp;<span class="op" id="4989691">*</span><span class="ident" id="4989692">parser</span><span class="op" id="4989698">)</span>&nbsp;<span class="ident" id="4989700">parseMethodSpec</span><span class="op" id="4989715">(</span><span class="ident" id="4989716">scope</span>&nbsp;<span class="op" id="4989722">*</span><span class="ident" id="4989723">ast</span><span class="op" id="4989726">.</span><span class="ident" id="4989727">Scope</span><span class="op" id="4989732">)</span>&nbsp;<span class="op" id="4989734">*</span><span class="ident" id="4989735">ast</span><span class="op" id="4989738">.</span><span class="ident" id="4989739">Field</span>&nbsp;<span class="op" id="4989745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989748">if</span>&nbsp;<span class="ident" id="4989751">p</span><span class="op" id="4989752">.</span><span class="ident" id="4989753">trace</span>&nbsp;<span class="op" id="4989759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989763">defer</span>&nbsp;<span class="ident" id="4989769">un</span><span class="op" id="4989771">(</span><span class="ident" id="4989772">trace</span><span class="op" id="4989777">(</span><span class="ident" id="4989778">p</span><span class="op" id="4989779">,</span>&nbsp;<span class="string" id="4989781">&#34;MethodSpec&#34;</span><span class="op" id="4989793">)</span><span class="op" id="4989794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4989797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989801">doc</span>&nbsp;<span class="op" id="4989805">:=</span>&nbsp;<span class="ident" id="4989808">p</span><span class="op" id="4989809">.</span><span class="ident" id="4989810">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989823">var</span>&nbsp;<span class="ident" id="4989827">idents</span>&nbsp;<span class="op" id="4989834">[</span><span class="op" id="4989835">]</span><span class="op" id="4989836">*</span><span class="ident" id="4989837">ast</span><span class="op" id="4989840">.</span><span class="ident" id="4989841">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989848">var</span>&nbsp;<span class="ident" id="4989852">typ</span>&nbsp;<span class="ident" id="4989856">ast</span><span class="op" id="4989859">.</span><span class="ident" id="4989860">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989866">x</span>&nbsp;<span class="op" id="4989868">:=</span>&nbsp;<span class="ident" id="4989871">p</span><span class="op" id="4989872">.</span><span class="ident" id="4989873">parseTypeName</span><span class="op" id="4989886">(</span><span class="op" id="4989887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4989890">if</span>&nbsp;<span class="ident" id="4989893">ident</span><span class="op" id="4989898">,</span>&nbsp;<span class="ident" id="4989900">isIdent</span>&nbsp;<span class="op" id="4989908">:=</span>&nbsp;<span class="ident" id="4989911">x</span><span class="op" id="4989912">.</span><span class="op" id="4989913">(</span><span class="op" id="4989914">*</span><span class="ident" id="4989915">ast</span><span class="op" id="4989918">.</span><span class="ident" id="4989919">Ident</span><span class="op" id="4989924">)</span><span class="op" id="4989925">;</span>&nbsp;<span class="ident" id="4989927">isIdent</span>&nbsp;<span class="op" id="4989935">&amp;&amp;</span>&nbsp;<span class="ident" id="4989938">p</span><span class="op" id="4989939">.</span><span class="ident" id="4989940">tok</span>&nbsp;<span class="op" id="4989944">==</span>&nbsp;<span class="ident" id="4989947">token</span><span class="op" id="4989952">.</span><span class="ident" id="4989953">LPAREN</span>&nbsp;<span class="op" id="4989960">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4989964">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4989976">idents</span>&nbsp;<span class="op" id="4989983">=</span>&nbsp;<span class="op" id="4989985">[</span><span class="op" id="4989986">]</span><span class="op" id="4989987">*</span><span class="ident" id="4989988">ast</span><span class="op" id="4989991">.</span><span class="ident" id="4989992">Ident</span><span class="op" id="4989997">{</span><span class="ident" id="4989998">ident</span><span class="op" id="4990003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990007">scope</span>&nbsp;<span class="op" id="4990013">:=</span>&nbsp;<span class="ident" id="4990016">ast</span><span class="op" id="4990019">.</span><span class="ident" id="4990020">NewScope</span><span class="op" id="4990028">(</span><span class="ident" id="4990029">nil</span><span class="op" id="4990032">)</span>&nbsp;<span class="comment" id="4990034">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990052">params</span><span class="op" id="4990058">,</span>&nbsp;<span class="ident" id="4990060">results</span>&nbsp;<span class="op" id="4990068">:=</span>&nbsp;<span class="ident" id="4990071">p</span><span class="op" id="4990072">.</span><span class="ident" id="4990073">parseSignature</span><span class="op" id="4990087">(</span><span class="ident" id="4990088">scope</span><span class="op" id="4990093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990097">typ</span>&nbsp;<span class="op" id="4990101">=</span>&nbsp;<span class="op" id="4990103">&amp;</span><span class="ident" id="4990104">ast</span><span class="op" id="4990107">.</span><span class="ident" id="4990108">FuncType</span><span class="op" id="4990116">{</span><span class="ident" id="4990117">Func</span><span class="op" id="4990121">:</span>&nbsp;<span class="ident" id="4990123">token</span><span class="op" id="4990128">.</span><span class="ident" id="4990129">NoPos</span><span class="op" id="4990134">,</span>&nbsp;<span class="ident" id="4990136">Params</span><span class="op" id="4990142">:</span>&nbsp;<span class="ident" id="4990144">params</span><span class="op" id="4990150">,</span>&nbsp;<span class="ident" id="4990152">Results</span><span class="op" id="4990159">:</span>&nbsp;<span class="ident" id="4990161">results</span><span class="op" id="4990168">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4990171">}</span>&nbsp;<span class="keyword" id="4990173">else</span>&nbsp;<span class="op" id="4990178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4990182">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990206">typ</span>&nbsp;<span class="op" id="4990210">=</span>&nbsp;<span class="ident" id="4990212">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990216">p</span><span class="op" id="4990217">.</span><span class="ident" id="4990218">resolve</span><span class="op" id="4990225">(</span><span class="ident" id="4990226">typ</span><span class="op" id="4990229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4990232">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990235">p</span><span class="op" id="4990236">.</span><span class="ident" id="4990237">expectSemi</span><span class="op" id="4990247">(</span><span class="op" id="4990248">)</span>&nbsp;<span class="comment" id="4990250">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990291">spec</span>&nbsp;<span class="op" id="4990296">:=</span>&nbsp;<span class="op" id="4990299">&amp;</span><span class="ident" id="4990300">ast</span><span class="op" id="4990303">.</span><span class="ident" id="4990304">Field</span><span class="op" id="4990309">{</span><span class="ident" id="4990310">Doc</span><span class="op" id="4990313">:</span>&nbsp;<span class="ident" id="4990315">doc</span><span class="op" id="4990318">,</span>&nbsp;<span class="ident" id="4990320">Names</span><span class="op" id="4990325">:</span>&nbsp;<span class="ident" id="4990327">idents</span><span class="op" id="4990333">,</span>&nbsp;<span class="ident" id="4990335">Type</span><span class="op" id="4990339">:</span>&nbsp;<span class="ident" id="4990341">typ</span><span class="op" id="4990344">,</span>&nbsp;<span class="ident" id="4990346">Comment</span><span class="op" id="4990353">:</span>&nbsp;<span class="ident" id="4990355">p</span><span class="op" id="4990356">.</span><span class="ident" id="4990357">lineComment</span><span class="op" id="4990368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990371">p</span><span class="op" id="4990372">.</span><span class="ident" id="4990373">declare</span><span class="op" id="4990380">(</span><span class="ident" id="4990381">spec</span><span class="op" id="4990385">,</span>&nbsp;<span class="ident" id="4990387">nil</span><span class="op" id="4990390">,</span>&nbsp;<span class="ident" id="4990392">scope</span><span class="op" id="4990397">,</span>&nbsp;<span class="ident" id="4990399">ast</span><span class="op" id="4990402">.</span><span class="ident" id="4990403">Fun</span><span class="op" id="4990406">,</span>&nbsp;<span class="ident" id="4990408">idents</span><span class="op" id="4990414">...</span><span class="op" id="4990417">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990421">return</span>&nbsp;<span class="ident" id="4990428">spec</span><br>
<span class="lineno"></span><span class="op" id="4990433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4990436">func</span>&nbsp;<span class="op" id="4990441">(</span><span class="ident" id="4990442">p</span>&nbsp;<span class="op" id="4990444">*</span><span class="ident" id="4990445">parser</span><span class="op" id="4990451">)</span>&nbsp;<span class="ident" id="4990453">parseInterfaceType</span><span class="op" id="4990471">(</span><span class="op" id="4990472">)</span>&nbsp;<span class="op" id="4990474">*</span><span class="ident" id="4990475">ast</span><span class="op" id="4990478">.</span><span class="ident" id="4990479">InterfaceType</span>&nbsp;<span class="op" id="4990493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990496">if</span>&nbsp;<span class="ident" id="4990499">p</span><span class="op" id="4990500">.</span><span class="ident" id="4990501">trace</span>&nbsp;<span class="op" id="4990507">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990511">defer</span>&nbsp;<span class="ident" id="4990517">un</span><span class="op" id="4990519">(</span><span class="ident" id="4990520">trace</span><span class="op" id="4990525">(</span><span class="ident" id="4990526">p</span><span class="op" id="4990527">,</span>&nbsp;<span class="string" id="4990529">&#34;InterfaceType&#34;</span><span class="op" id="4990544">)</span><span class="op" id="4990545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4990548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990552">pos</span>&nbsp;<span class="op" id="4990556">:=</span>&nbsp;<span class="ident" id="4990559">p</span><span class="op" id="4990560">.</span><span class="ident" id="4990561">expect</span><span class="op" id="4990567">(</span><span class="ident" id="4990568">token</span><span class="op" id="4990573">.</span><span class="ident" id="4990574">INTERFACE</span><span class="op" id="4990583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990586">lbrace</span>&nbsp;<span class="op" id="4990593">:=</span>&nbsp;<span class="ident" id="4990596">p</span><span class="op" id="4990597">.</span><span class="ident" id="4990598">expect</span><span class="op" id="4990604">(</span><span class="ident" id="4990605">token</span><span class="op" id="4990610">.</span><span class="ident" id="4990611">LBRACE</span><span class="op" id="4990617">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990620">scope</span>&nbsp;<span class="op" id="4990626">:=</span>&nbsp;<span class="ident" id="4990629">ast</span><span class="op" id="4990632">.</span><span class="ident" id="4990633">NewScope</span><span class="op" id="4990641">(</span><span class="ident" id="4990642">nil</span><span class="op" id="4990645">)</span>&nbsp;<span class="comment" id="4990647">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990667">var</span>&nbsp;<span class="ident" id="4990671">list</span>&nbsp;<span class="op" id="4990676">[</span><span class="op" id="4990677">]</span><span class="op" id="4990678">*</span><span class="ident" id="4990679">ast</span><span class="op" id="4990682">.</span><span class="ident" id="4990683">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990690">for</span>&nbsp;<span class="ident" id="4990694">p</span><span class="op" id="4990695">.</span><span class="ident" id="4990696">tok</span>&nbsp;<span class="op" id="4990700">==</span>&nbsp;<span class="ident" id="4990703">token</span><span class="op" id="4990708">.</span><span class="ident" id="4990709">IDENT</span>&nbsp;<span class="op" id="4990715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990719">list</span>&nbsp;<span class="op" id="4990724">=</span>&nbsp;<span class="builtinfunc" id="4990726">append</span><span class="op" id="4990732">(</span><span class="ident" id="4990733">list</span><span class="op" id="4990737">,</span>&nbsp;<span class="ident" id="4990739">p</span><span class="op" id="4990740">.</span><span class="ident" id="4990741">parseMethodSpec</span><span class="op" id="4990756">(</span><span class="ident" id="4990757">scope</span><span class="op" id="4990762">)</span><span class="op" id="4990763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4990766">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990769">rbrace</span>&nbsp;<span class="op" id="4990776">:=</span>&nbsp;<span class="ident" id="4990779">p</span><span class="op" id="4990780">.</span><span class="ident" id="4990781">expect</span><span class="op" id="4990787">(</span><span class="ident" id="4990788">token</span><span class="op" id="4990793">.</span><span class="ident" id="4990794">RBRACE</span><span class="op" id="4990800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990804">return</span>&nbsp;<span class="op" id="4990811">&amp;</span><span class="ident" id="4990812">ast</span><span class="op" id="4990815">.</span><span class="ident" id="4990816">InterfaceType</span><span class="op" id="4990829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990833">Interface</span><span class="op" id="4990842">:</span>&nbsp;<span class="ident" id="4990844">pos</span><span class="op" id="4990847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990851">Methods</span><span class="op" id="4990858">:</span>&nbsp;<span class="op" id="4990860">&amp;</span><span class="ident" id="4990861">ast</span><span class="op" id="4990864">.</span><span class="ident" id="4990865">FieldList</span><span class="op" id="4990874">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990879">Opening</span><span class="op" id="4990886">:</span>&nbsp;<span class="ident" id="4990888">lbrace</span><span class="op" id="4990894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990899">List</span><span class="op" id="4990903">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990908">list</span><span class="op" id="4990912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4990917">Closing</span><span class="op" id="4990924">:</span>&nbsp;<span class="ident" id="4990926">rbrace</span><span class="op" id="4990932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4990936">}</span><span class="op" id="4990937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4990940">}</span><br>
<span class="lineno">965</span><span class="op" id="4990942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4990945">func</span>&nbsp;<span class="op" id="4990950">(</span><span class="ident" id="4990951">p</span>&nbsp;<span class="op" id="4990953">*</span><span class="ident" id="4990954">parser</span><span class="op" id="4990960">)</span>&nbsp;<span class="ident" id="4990962">parseMapType</span><span class="op" id="4990974">(</span><span class="op" id="4990975">)</span>&nbsp;<span class="op" id="4990977">*</span><span class="ident" id="4990978">ast</span><span class="op" id="4990981">.</span><span class="ident" id="4990982">MapType</span>&nbsp;<span class="op" id="4990990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4990993">if</span>&nbsp;<span class="ident" id="4990996">p</span><span class="op" id="4990997">.</span><span class="ident" id="4990998">trace</span>&nbsp;<span class="op" id="4991004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991008">defer</span>&nbsp;<span class="ident" id="4991014">un</span><span class="op" id="4991016">(</span><span class="ident" id="4991017">trace</span><span class="op" id="4991022">(</span><span class="ident" id="4991023">p</span><span class="op" id="4991024">,</span>&nbsp;<span class="string" id="4991026">&#34;MapType&#34;</span><span class="op" id="4991035">)</span><span class="op" id="4991036">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991043">pos</span>&nbsp;<span class="op" id="4991047">:=</span>&nbsp;<span class="ident" id="4991050">p</span><span class="op" id="4991051">.</span><span class="ident" id="4991052">expect</span><span class="op" id="4991058">(</span><span class="ident" id="4991059">token</span><span class="op" id="4991064">.</span><span class="ident" id="4991065">MAP</span><span class="op" id="4991068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991071">p</span><span class="op" id="4991072">.</span><span class="ident" id="4991073">expect</span><span class="op" id="4991079">(</span><span class="ident" id="4991080">token</span><span class="op" id="4991085">.</span><span class="ident" id="4991086">LBRACK</span><span class="op" id="4991092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991095">key</span>&nbsp;<span class="op" id="4991099">:=</span>&nbsp;<span class="ident" id="4991102">p</span><span class="op" id="4991103">.</span><span class="ident" id="4991104">parseType</span><span class="op" id="4991113">(</span><span class="op" id="4991114">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991117">p</span><span class="op" id="4991118">.</span><span class="ident" id="4991119">expect</span><span class="op" id="4991125">(</span><span class="ident" id="4991126">token</span><span class="op" id="4991131">.</span><span class="ident" id="4991132">RBRACK</span><span class="op" id="4991138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991141">value</span>&nbsp;<span class="op" id="4991147">:=</span>&nbsp;<span class="ident" id="4991150">p</span><span class="op" id="4991151">.</span><span class="ident" id="4991152">parseType</span><span class="op" id="4991161">(</span><span class="op" id="4991162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991166">return</span>&nbsp;<span class="op" id="4991173">&amp;</span><span class="ident" id="4991174">ast</span><span class="op" id="4991177">.</span><span class="ident" id="4991178">MapType</span><span class="op" id="4991185">{</span><span class="ident" id="4991186">Map</span><span class="op" id="4991189">:</span>&nbsp;<span class="ident" id="4991191">pos</span><span class="op" id="4991194">,</span>&nbsp;<span class="ident" id="4991196">Key</span><span class="op" id="4991199">:</span>&nbsp;<span class="ident" id="4991201">key</span><span class="op" id="4991204">,</span>&nbsp;<span class="ident" id="4991206">Value</span><span class="op" id="4991211">:</span>&nbsp;<span class="ident" id="4991213">value</span><span class="op" id="4991218">}</span><br>
<span class="lineno"></span><span class="op" id="4991220">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="4991223">func</span>&nbsp;<span class="op" id="4991228">(</span><span class="ident" id="4991229">p</span>&nbsp;<span class="op" id="4991231">*</span><span class="ident" id="4991232">parser</span><span class="op" id="4991238">)</span>&nbsp;<span class="ident" id="4991240">parseChanType</span><span class="op" id="4991253">(</span><span class="op" id="4991254">)</span>&nbsp;<span class="op" id="4991256">*</span><span class="ident" id="4991257">ast</span><span class="op" id="4991260">.</span><span class="ident" id="4991261">ChanType</span>&nbsp;<span class="op" id="4991270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991273">if</span>&nbsp;<span class="ident" id="4991276">p</span><span class="op" id="4991277">.</span><span class="ident" id="4991278">trace</span>&nbsp;<span class="op" id="4991284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991288">defer</span>&nbsp;<span class="ident" id="4991294">un</span><span class="op" id="4991296">(</span><span class="ident" id="4991297">trace</span><span class="op" id="4991302">(</span><span class="ident" id="4991303">p</span><span class="op" id="4991304">,</span>&nbsp;<span class="string" id="4991306">&#34;ChanType&#34;</span><span class="op" id="4991316">)</span><span class="op" id="4991317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991320">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991324">pos</span>&nbsp;<span class="op" id="4991328">:=</span>&nbsp;<span class="ident" id="4991331">p</span><span class="op" id="4991332">.</span><span class="ident" id="4991333">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991338">dir</span>&nbsp;<span class="op" id="4991342">:=</span>&nbsp;<span class="ident" id="4991345">ast</span><span class="op" id="4991348">.</span><span class="ident" id="4991349">SEND</span>&nbsp;<span class="op" id="4991354">|</span>&nbsp;<span class="ident" id="4991356">ast</span><span class="op" id="4991359">.</span><span class="ident" id="4991360">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991366">var</span>&nbsp;<span class="ident" id="4991370">arrow</span>&nbsp;<span class="ident" id="4991376">token</span><span class="op" id="4991381">.</span><span class="ident" id="4991382">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991387">if</span>&nbsp;<span class="ident" id="4991390">p</span><span class="op" id="4991391">.</span><span class="ident" id="4991392">tok</span>&nbsp;<span class="op" id="4991396">==</span>&nbsp;<span class="ident" id="4991399">token</span><span class="op" id="4991404">.</span><span class="ident" id="4991405">CHAN</span>&nbsp;<span class="op" id="4991410">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991414">p</span><span class="op" id="4991415">.</span><span class="ident" id="4991416">next</span><span class="op" id="4991420">(</span><span class="op" id="4991421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991425">if</span>&nbsp;<span class="ident" id="4991428">p</span><span class="op" id="4991429">.</span><span class="ident" id="4991430">tok</span>&nbsp;<span class="op" id="4991434">==</span>&nbsp;<span class="ident" id="4991437">token</span><span class="op" id="4991442">.</span><span class="ident" id="4991443">ARROW</span>&nbsp;<span class="op" id="4991449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991454">arrow</span>&nbsp;<span class="op" id="4991460">=</span>&nbsp;<span class="ident" id="4991462">p</span><span class="op" id="4991463">.</span><span class="ident" id="4991464">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991471">p</span><span class="op" id="4991472">.</span><span class="ident" id="4991473">next</span><span class="op" id="4991477">(</span><span class="op" id="4991478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991483">dir</span>&nbsp;<span class="op" id="4991487">=</span>&nbsp;<span class="ident" id="4991489">ast</span><span class="op" id="4991492">.</span><span class="ident" id="4991493">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991503">}</span>&nbsp;<span class="keyword" id="4991505">else</span>&nbsp;<span class="op" id="4991510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991514">arrow</span>&nbsp;<span class="op" id="4991520">=</span>&nbsp;<span class="ident" id="4991522">p</span><span class="op" id="4991523">.</span><span class="ident" id="4991524">expect</span><span class="op" id="4991530">(</span><span class="ident" id="4991531">token</span><span class="op" id="4991536">.</span><span class="ident" id="4991537">ARROW</span><span class="op" id="4991542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991546">p</span><span class="op" id="4991547">.</span><span class="ident" id="4991548">expect</span><span class="op" id="4991554">(</span><span class="ident" id="4991555">token</span><span class="op" id="4991560">.</span><span class="ident" id="4991561">CHAN</span><span class="op" id="4991565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991569">dir</span>&nbsp;<span class="op" id="4991573">=</span>&nbsp;<span class="ident" id="4991575">ast</span><span class="op" id="4991578">.</span><span class="ident" id="4991579">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4991585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4991588">value</span>&nbsp;<span class="op" id="4991594">:=</span>&nbsp;<span class="ident" id="4991597">p</span><span class="op" id="4991598">.</span><span class="ident" id="4991599">parseType</span><span class="op" id="4991608">(</span><span class="op" id="4991609">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991613">return</span>&nbsp;<span class="op" id="4991620">&amp;</span><span class="ident" id="4991621">ast</span><span class="op" id="4991624">.</span><span class="ident" id="4991625">ChanType</span><span class="op" id="4991633">{</span><span class="ident" id="4991634">Begin</span><span class="op" id="4991639">:</span>&nbsp;<span class="ident" id="4991641">pos</span><span class="op" id="4991644">,</span>&nbsp;<span class="ident" id="4991646">Arrow</span><span class="op" id="4991651">:</span>&nbsp;<span class="ident" id="4991653">arrow</span><span class="op" id="4991658">,</span>&nbsp;<span class="ident" id="4991660">Dir</span><span class="op" id="4991663">:</span>&nbsp;<span class="ident" id="4991665">dir</span><span class="op" id="4991668">,</span>&nbsp;<span class="ident" id="4991670">Value</span><span class="op" id="4991675">:</span>&nbsp;<span class="ident" id="4991677">value</span><span class="op" id="4991682">}</span><br>
<span class="lineno"></span><span class="op" id="4991684">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="4991687">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="4991742">func</span>&nbsp;<span class="op" id="4991747">(</span><span class="ident" id="4991748">p</span>&nbsp;<span class="op" id="4991750">*</span><span class="ident" id="4991751">parser</span><span class="op" id="4991757">)</span>&nbsp;<span class="ident" id="4991759">tryIdentOrType</span><span class="op" id="4991773">(</span><span class="op" id="4991774">)</span>&nbsp;<span class="ident" id="4991776">ast</span><span class="op" id="4991779">.</span><span class="ident" id="4991780">Expr</span>&nbsp;<span class="op" id="4991785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991788">switch</span>&nbsp;<span class="ident" id="4991795">p</span><span class="op" id="4991796">.</span><span class="ident" id="4991797">tok</span>&nbsp;<span class="op" id="4991801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991804">case</span>&nbsp;<span class="ident" id="4991809">token</span><span class="op" id="4991814">.</span><span class="ident" id="4991815">IDENT</span><span class="op" id="4991820">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991824">return</span>&nbsp;<span class="ident" id="4991831">p</span><span class="op" id="4991832">.</span><span class="ident" id="4991833">parseTypeName</span><span class="op" id="4991846">(</span><span class="op" id="4991847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991850">case</span>&nbsp;<span class="ident" id="4991855">token</span><span class="op" id="4991860">.</span><span class="ident" id="4991861">LBRACK</span><span class="op" id="4991867">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991871">return</span>&nbsp;<span class="ident" id="4991878">p</span><span class="op" id="4991879">.</span><span class="ident" id="4991880">parseArrayType</span><span class="op" id="4991894">(</span><span class="op" id="4991895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991898">case</span>&nbsp;<span class="ident" id="4991903">token</span><span class="op" id="4991908">.</span><span class="ident" id="4991909">STRUCT</span><span class="op" id="4991915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991919">return</span>&nbsp;<span class="ident" id="4991926">p</span><span class="op" id="4991927">.</span><span class="ident" id="4991928">parseStructType</span><span class="op" id="4991943">(</span><span class="op" id="4991944">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991947">case</span>&nbsp;<span class="ident" id="4991952">token</span><span class="op" id="4991957">.</span><span class="ident" id="4991958">MUL</span><span class="op" id="4991961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991965">return</span>&nbsp;<span class="ident" id="4991972">p</span><span class="op" id="4991973">.</span><span class="ident" id="4991974">parsePointerType</span><span class="op" id="4991990">(</span><span class="op" id="4991991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4991994">case</span>&nbsp;<span class="ident" id="4991999">token</span><span class="op" id="4992004">.</span><span class="ident" id="4992005">FUNC</span><span class="op" id="4992009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992013">typ</span><span class="op" id="4992016">,</span>&nbsp;<span class="ident" id="4992018">_</span>&nbsp;<span class="op" id="4992020">:=</span>&nbsp;<span class="ident" id="4992023">p</span><span class="op" id="4992024">.</span><span class="ident" id="4992025">parseFuncType</span><span class="op" id="4992038">(</span><span class="op" id="4992039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992043">return</span>&nbsp;<span class="ident" id="4992050">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992055">case</span>&nbsp;<span class="ident" id="4992060">token</span><span class="op" id="4992065">.</span><span class="ident" id="4992066">INTERFACE</span><span class="op" id="4992075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992079">return</span>&nbsp;<span class="ident" id="4992086">p</span><span class="op" id="4992087">.</span><span class="ident" id="4992088">parseInterfaceType</span><span class="op" id="4992106">(</span><span class="op" id="4992107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992110">case</span>&nbsp;<span class="ident" id="4992115">token</span><span class="op" id="4992120">.</span><span class="ident" id="4992121">MAP</span><span class="op" id="4992124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992128">return</span>&nbsp;<span class="ident" id="4992135">p</span><span class="op" id="4992136">.</span><span class="ident" id="4992137">parseMapType</span><span class="op" id="4992149">(</span><span class="op" id="4992150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992153">case</span>&nbsp;<span class="ident" id="4992158">token</span><span class="op" id="4992163">.</span><span class="ident" id="4992164">CHAN</span><span class="op" id="4992168">,</span>&nbsp;<span class="ident" id="4992170">token</span><span class="op" id="4992175">.</span><span class="ident" id="4992176">ARROW</span><span class="op" id="4992181">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992185">return</span>&nbsp;<span class="ident" id="4992192">p</span><span class="op" id="4992193">.</span><span class="ident" id="4992194">parseChanType</span><span class="op" id="4992207">(</span><span class="op" id="4992208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992211">case</span>&nbsp;<span class="ident" id="4992216">token</span><span class="op" id="4992221">.</span><span class="ident" id="4992222">LPAREN</span><span class="op" id="4992228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992232">lparen</span>&nbsp;<span class="op" id="4992239">:=</span>&nbsp;<span class="ident" id="4992242">p</span><span class="op" id="4992243">.</span><span class="ident" id="4992244">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992250">p</span><span class="op" id="4992251">.</span><span class="ident" id="4992252">next</span><span class="op" id="4992256">(</span><span class="op" id="4992257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992261">typ</span>&nbsp;<span class="op" id="4992265">:=</span>&nbsp;<span class="ident" id="4992268">p</span><span class="op" id="4992269">.</span><span class="ident" id="4992270">parseType</span><span class="op" id="4992279">(</span><span class="op" id="4992280">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992284">rparen</span>&nbsp;<span class="op" id="4992291">:=</span>&nbsp;<span class="ident" id="4992294">p</span><span class="op" id="4992295">.</span><span class="ident" id="4992296">expect</span><span class="op" id="4992302">(</span><span class="ident" id="4992303">token</span><span class="op" id="4992308">.</span><span class="ident" id="4992309">RPAREN</span><span class="op" id="4992315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992319">return</span>&nbsp;<span class="op" id="4992326">&amp;</span><span class="ident" id="4992327">ast</span><span class="op" id="4992330">.</span><span class="ident" id="4992331">ParenExpr</span><span class="op" id="4992340">{</span><span class="ident" id="4992341">Lparen</span><span class="op" id="4992347">:</span>&nbsp;<span class="ident" id="4992349">lparen</span><span class="op" id="4992355">,</span>&nbsp;<span class="ident" id="4992357">X</span><span class="op" id="4992358">:</span>&nbsp;<span class="ident" id="4992360">typ</span><span class="op" id="4992363">,</span>&nbsp;<span class="ident" id="4992365">Rparen</span><span class="op" id="4992371">:</span>&nbsp;<span class="ident" id="4992373">rparen</span><span class="op" id="4992379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4992386">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992404">return</span>&nbsp;<span class="ident" id="4992411">nil</span><br>
<span class="lineno"></span><span class="op" id="4992415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4992418">func</span>&nbsp;<span class="op" id="4992423">(</span><span class="ident" id="4992424">p</span>&nbsp;<span class="op" id="4992426">*</span><span class="ident" id="4992427">parser</span><span class="op" id="4992433">)</span>&nbsp;<span class="ident" id="4992435">tryType</span><span class="op" id="4992442">(</span><span class="op" id="4992443">)</span>&nbsp;<span class="ident" id="4992445">ast</span><span class="op" id="4992448">.</span><span class="ident" id="4992449">Expr</span>&nbsp;<span class="op" id="4992454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992457">typ</span>&nbsp;<span class="op" id="4992461">:=</span>&nbsp;<span class="ident" id="4992464">p</span><span class="op" id="4992465">.</span><span class="ident" id="4992466">tryIdentOrType</span><span class="op" id="4992480">(</span><span class="op" id="4992481">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992484">if</span>&nbsp;<span class="ident" id="4992487">typ</span>&nbsp;<span class="op" id="4992491">!=</span>&nbsp;<span class="ident" id="4992494">nil</span>&nbsp;<span class="op" id="4992498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992502">p</span><span class="op" id="4992503">.</span><span class="ident" id="4992504">resolve</span><span class="op" id="4992511">(</span><span class="ident" id="4992512">typ</span><span class="op" id="4992515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992521">return</span>&nbsp;<span class="ident" id="4992528">typ</span><br>
<span class="lineno"></span><span class="op" id="4992532">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="4992535">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4992615">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4992626">func</span>&nbsp;<span class="op" id="4992631">(</span><span class="ident" id="4992632">p</span>&nbsp;<span class="op" id="4992634">*</span><span class="ident" id="4992635">parser</span><span class="op" id="4992641">)</span>&nbsp;<span class="ident" id="4992643">parseStmtList</span><span class="op" id="4992656">(</span><span class="op" id="4992657">)</span>&nbsp;<span class="op" id="4992659">(</span><span class="ident" id="4992660">list</span>&nbsp;<span class="op" id="4992665">[</span><span class="op" id="4992666">]</span><span class="ident" id="4992667">ast</span><span class="op" id="4992670">.</span><span class="ident" id="4992671">Stmt</span><span class="op" id="4992675">)</span>&nbsp;<span class="op" id="4992677">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992680">if</span>&nbsp;<span class="ident" id="4992683">p</span><span class="op" id="4992684">.</span><span class="ident" id="4992685">trace</span>&nbsp;<span class="op" id="4992691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992695">defer</span>&nbsp;<span class="ident" id="4992701">un</span><span class="op" id="4992703">(</span><span class="ident" id="4992704">trace</span><span class="op" id="4992709">(</span><span class="ident" id="4992710">p</span><span class="op" id="4992711">,</span>&nbsp;<span class="string" id="4992713">&#34;StatementList&#34;</span><span class="op" id="4992728">)</span><span class="op" id="4992729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992736">for</span>&nbsp;<span class="ident" id="4992740">p</span><span class="op" id="4992741">.</span><span class="ident" id="4992742">tok</span>&nbsp;<span class="op" id="4992746">!=</span>&nbsp;<span class="ident" id="4992749">token</span><span class="op" id="4992754">.</span><span class="ident" id="4992755">CASE</span>&nbsp;<span class="op" id="4992760">&amp;&amp;</span>&nbsp;<span class="ident" id="4992763">p</span><span class="op" id="4992764">.</span><span class="ident" id="4992765">tok</span>&nbsp;<span class="op" id="4992769">!=</span>&nbsp;<span class="ident" id="4992772">token</span><span class="op" id="4992777">.</span><span class="ident" id="4992778">DEFAULT</span>&nbsp;<span class="op" id="4992786">&amp;&amp;</span>&nbsp;<span class="ident" id="4992789">p</span><span class="op" id="4992790">.</span><span class="ident" id="4992791">tok</span>&nbsp;<span class="op" id="4992795">!=</span>&nbsp;<span class="ident" id="4992798">token</span><span class="op" id="4992803">.</span><span class="ident" id="4992804">RBRACE</span>&nbsp;<span class="op" id="4992811">&amp;&amp;</span>&nbsp;<span class="ident" id="4992814">p</span><span class="op" id="4992815">.</span><span class="ident" id="4992816">tok</span>&nbsp;<span class="op" id="4992820">!=</span>&nbsp;<span class="ident" id="4992823">token</span><span class="op" id="4992828">.</span><span class="ident" id="4992829">EOF</span>&nbsp;<span class="op" id="4992833">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992837">list</span>&nbsp;<span class="op" id="4992842">=</span>&nbsp;<span class="builtinfunc" id="4992844">append</span><span class="op" id="4992850">(</span><span class="ident" id="4992851">list</span><span class="op" id="4992855">,</span>&nbsp;<span class="ident" id="4992857">p</span><span class="op" id="4992858">.</span><span class="ident" id="4992859">parseStmt</span><span class="op" id="4992868">(</span><span class="op" id="4992869">)</span><span class="op" id="4992870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992877">return</span><br>
<span class="lineno"></span><span class="op" id="4992884">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="4992887">func</span>&nbsp;<span class="op" id="4992892">(</span><span class="ident" id="4992893">p</span>&nbsp;<span class="op" id="4992895">*</span><span class="ident" id="4992896">parser</span><span class="op" id="4992902">)</span>&nbsp;<span class="ident" id="4992904">parseBody</span><span class="op" id="4992913">(</span><span class="ident" id="4992914">scope</span>&nbsp;<span class="op" id="4992920">*</span><span class="ident" id="4992921">ast</span><span class="op" id="4992924">.</span><span class="ident" id="4992925">Scope</span><span class="op" id="4992930">)</span>&nbsp;<span class="op" id="4992932">*</span><span class="ident" id="4992933">ast</span><span class="op" id="4992936">.</span><span class="ident" id="4992937">BlockStmt</span>&nbsp;<span class="op" id="4992947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992950">if</span>&nbsp;<span class="ident" id="4992953">p</span><span class="op" id="4992954">.</span><span class="ident" id="4992955">trace</span>&nbsp;<span class="op" id="4992961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992965">defer</span>&nbsp;<span class="ident" id="4992971">un</span><span class="op" id="4992973">(</span><span class="ident" id="4992974">trace</span><span class="op" id="4992979">(</span><span class="ident" id="4992980">p</span><span class="op" id="4992981">,</span>&nbsp;<span class="string" id="4992983">&#34;Body&#34;</span><span class="op" id="4992989">)</span><span class="op" id="4992990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4992993">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992997">lbrace</span>&nbsp;<span class="op" id="4993004">:=</span>&nbsp;<span class="ident" id="4993007">p</span><span class="op" id="4993008">.</span><span class="ident" id="4993009">expect</span><span class="op" id="4993015">(</span><span class="ident" id="4993016">token</span><span class="op" id="4993021">.</span><span class="ident" id="4993022">LBRACE</span><span class="op" id="4993028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993031">p</span><span class="op" id="4993032">.</span><span class="ident" id="4993033">topScope</span>&nbsp;<span class="op" id="4993042">=</span>&nbsp;<span class="ident" id="4993044">scope</span>&nbsp;<span class="comment" id="4993050">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993074">p</span><span class="op" id="4993075">.</span><span class="ident" id="4993076">openLabelScope</span><span class="op" id="4993090">(</span><span class="op" id="4993091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993094">list</span>&nbsp;<span class="op" id="4993099">:=</span>&nbsp;<span class="ident" id="4993102">p</span><span class="op" id="4993103">.</span><span class="ident" id="4993104">parseStmtList</span><span class="op" id="4993117">(</span><span class="op" id="4993118">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993121">p</span><span class="op" id="4993122">.</span><span class="ident" id="4993123">closeLabelScope</span><span class="op" id="4993138">(</span><span class="op" id="4993139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993142">p</span><span class="op" id="4993143">.</span><span class="ident" id="4993144">closeScope</span><span class="op" id="4993154">(</span><span class="op" id="4993155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993158">rbrace</span>&nbsp;<span class="op" id="4993165">:=</span>&nbsp;<span class="ident" id="4993168">p</span><span class="op" id="4993169">.</span><span class="ident" id="4993170">expect</span><span class="op" id="4993176">(</span><span class="ident" id="4993177">token</span><span class="op" id="4993182">.</span><span class="ident" id="4993183">RBRACE</span><span class="op" id="4993189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993193">return</span>&nbsp;<span class="op" id="4993200">&amp;</span><span class="ident" id="4993201">ast</span><span class="op" id="4993204">.</span><span class="ident" id="4993205">BlockStmt</span><span class="op" id="4993214">{</span><span class="ident" id="4993215">Lbrace</span><span class="op" id="4993221">:</span>&nbsp;<span class="ident" id="4993223">lbrace</span><span class="op" id="4993229">,</span>&nbsp;<span class="ident" id="4993231">List</span><span class="op" id="4993235">:</span>&nbsp;<span class="ident" id="4993237">list</span><span class="op" id="4993241">,</span>&nbsp;<span class="ident" id="4993243">Rbrace</span><span class="op" id="4993249">:</span>&nbsp;<span class="ident" id="4993251">rbrace</span><span class="op" id="4993257">}</span><br>
<span class="lineno">1075</span><span class="op" id="4993259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4993262">func</span>&nbsp;<span class="op" id="4993267">(</span><span class="ident" id="4993268">p</span>&nbsp;<span class="op" id="4993270">*</span><span class="ident" id="4993271">parser</span><span class="op" id="4993277">)</span>&nbsp;<span class="ident" id="4993279">parseBlockStmt</span><span class="op" id="4993293">(</span><span class="op" id="4993294">)</span>&nbsp;<span class="op" id="4993296">*</span><span class="ident" id="4993297">ast</span><span class="op" id="4993300">.</span><span class="ident" id="4993301">BlockStmt</span>&nbsp;<span class="op" id="4993311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993314">if</span>&nbsp;<span class="ident" id="4993317">p</span><span class="op" id="4993318">.</span><span class="ident" id="4993319">trace</span>&nbsp;<span class="op" id="4993325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993329">defer</span>&nbsp;<span class="ident" id="4993335">un</span><span class="op" id="4993337">(</span><span class="ident" id="4993338">trace</span><span class="op" id="4993343">(</span><span class="ident" id="4993344">p</span><span class="op" id="4993345">,</span>&nbsp;<span class="string" id="4993347">&#34;BlockStmt&#34;</span><span class="op" id="4993358">)</span><span class="op" id="4993359">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4993362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993366">lbrace</span>&nbsp;<span class="op" id="4993373">:=</span>&nbsp;<span class="ident" id="4993376">p</span><span class="op" id="4993377">.</span><span class="ident" id="4993378">expect</span><span class="op" id="4993384">(</span><span class="ident" id="4993385">token</span><span class="op" id="4993390">.</span><span class="ident" id="4993391">LBRACE</span><span class="op" id="4993397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993400">p</span><span class="op" id="4993401">.</span><span class="ident" id="4993402">openScope</span><span class="op" id="4993411">(</span><span class="op" id="4993412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993415">list</span>&nbsp;<span class="op" id="4993420">:=</span>&nbsp;<span class="ident" id="4993423">p</span><span class="op" id="4993424">.</span><span class="ident" id="4993425">parseStmtList</span><span class="op" id="4993438">(</span><span class="op" id="4993439">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993442">p</span><span class="op" id="4993443">.</span><span class="ident" id="4993444">closeScope</span><span class="op" id="4993454">(</span><span class="op" id="4993455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993458">rbrace</span>&nbsp;<span class="op" id="4993465">:=</span>&nbsp;<span class="ident" id="4993468">p</span><span class="op" id="4993469">.</span><span class="ident" id="4993470">expect</span><span class="op" id="4993476">(</span><span class="ident" id="4993477">token</span><span class="op" id="4993482">.</span><span class="ident" id="4993483">RBRACE</span><span class="op" id="4993489">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993493">return</span>&nbsp;<span class="op" id="4993500">&amp;</span><span class="ident" id="4993501">ast</span><span class="op" id="4993504">.</span><span class="ident" id="4993505">BlockStmt</span><span class="op" id="4993514">{</span><span class="ident" id="4993515">Lbrace</span><span class="op" id="4993521">:</span>&nbsp;<span class="ident" id="4993523">lbrace</span><span class="op" id="4993529">,</span>&nbsp;<span class="ident" id="4993531">List</span><span class="op" id="4993535">:</span>&nbsp;<span class="ident" id="4993537">list</span><span class="op" id="4993541">,</span>&nbsp;<span class="ident" id="4993543">Rbrace</span><span class="op" id="4993549">:</span>&nbsp;<span class="ident" id="4993551">rbrace</span><span class="op" id="4993557">}</span><br>
<span class="lineno"></span><span class="op" id="4993559">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="4993562">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4993642">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4993658">func</span>&nbsp;<span class="op" id="4993663">(</span><span class="ident" id="4993664">p</span>&nbsp;<span class="op" id="4993666">*</span><span class="ident" id="4993667">parser</span><span class="op" id="4993673">)</span>&nbsp;<span class="ident" id="4993675">parseFuncTypeOrLit</span><span class="op" id="4993693">(</span><span class="op" id="4993694">)</span>&nbsp;<span class="ident" id="4993696">ast</span><span class="op" id="4993699">.</span><span class="ident" id="4993700">Expr</span>&nbsp;<span class="op" id="4993705">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993708">if</span>&nbsp;<span class="ident" id="4993711">p</span><span class="op" id="4993712">.</span><span class="ident" id="4993713">trace</span>&nbsp;<span class="op" id="4993719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993723">defer</span>&nbsp;<span class="ident" id="4993729">un</span><span class="op" id="4993731">(</span><span class="ident" id="4993732">trace</span><span class="op" id="4993737">(</span><span class="ident" id="4993738">p</span><span class="op" id="4993739">,</span>&nbsp;<span class="string" id="4993741">&#34;FuncTypeOrLit&#34;</span><span class="op" id="4993756">)</span><span class="op" id="4993757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4993760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993764">typ</span><span class="op" id="4993767">,</span>&nbsp;<span class="ident" id="4993769">scope</span>&nbsp;<span class="op" id="4993775">:=</span>&nbsp;<span class="ident" id="4993778">p</span><span class="op" id="4993779">.</span><span class="ident" id="4993780">parseFuncType</span><span class="op" id="4993793">(</span><span class="op" id="4993794">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993797">if</span>&nbsp;<span class="ident" id="4993800">p</span><span class="op" id="4993801">.</span><span class="ident" id="4993802">tok</span>&nbsp;<span class="op" id="4993806">!=</span>&nbsp;<span class="ident" id="4993809">token</span><span class="op" id="4993814">.</span><span class="ident" id="4993815">LBRACE</span>&nbsp;<span class="op" id="4993822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4993826">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993850">return</span>&nbsp;<span class="ident" id="4993857">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4993862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993866">p</span><span class="op" id="4993867">.</span><span class="ident" id="4993868">exprLev</span><span class="op" id="4993875">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993879">body</span>&nbsp;<span class="op" id="4993884">:=</span>&nbsp;<span class="ident" id="4993887">p</span><span class="op" id="4993888">.</span><span class="ident" id="4993889">parseBody</span><span class="op" id="4993898">(</span><span class="ident" id="4993899">scope</span><span class="op" id="4993904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993907">p</span><span class="op" id="4993908">.</span><span class="ident" id="4993909">exprLev</span><span class="op" id="4993916">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993921">return</span>&nbsp;<span class="op" id="4993928">&amp;</span><span class="ident" id="4993929">ast</span><span class="op" id="4993932">.</span><span class="ident" id="4993933">FuncLit</span><span class="op" id="4993940">{</span><span class="ident" id="4993941">Type</span><span class="op" id="4993945">:</span>&nbsp;<span class="ident" id="4993947">typ</span><span class="op" id="4993950">,</span>&nbsp;<span class="ident" id="4993952">Body</span><span class="op" id="4993956">:</span>&nbsp;<span class="ident" id="4993958">body</span><span class="op" id="4993962">}</span><br>
<span class="lineno">1110</span><span class="op" id="4993964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4993967">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="4994035">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="4994096">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="4994166">//</span><br>
<span class="lineno"></span><span class="keyword" id="4994169">func</span>&nbsp;<span class="op" id="4994174">(</span><span class="ident" id="4994175">p</span>&nbsp;<span class="op" id="4994177">*</span><span class="ident" id="4994178">parser</span><span class="op" id="4994184">)</span>&nbsp;<span class="ident" id="4994186">parseOperand</span><span class="op" id="4994198">(</span><span class="ident" id="4994199">lhs</span>&nbsp;<span class="builtintype" id="4994203">bool</span><span class="op" id="4994207">)</span>&nbsp;<span class="ident" id="4994209">ast</span><span class="op" id="4994212">.</span><span class="ident" id="4994213">Expr</span>&nbsp;<span class="op" id="4994218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994221">if</span>&nbsp;<span class="ident" id="4994224">p</span><span class="op" id="4994225">.</span><span class="ident" id="4994226">trace</span>&nbsp;<span class="op" id="4994232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994236">defer</span>&nbsp;<span class="ident" id="4994242">un</span><span class="op" id="4994244">(</span><span class="ident" id="4994245">trace</span><span class="op" id="4994250">(</span><span class="ident" id="4994251">p</span><span class="op" id="4994252">,</span>&nbsp;<span class="string" id="4994254">&#34;Operand&#34;</span><span class="op" id="4994263">)</span><span class="op" id="4994264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4994267">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994271">switch</span>&nbsp;<span class="ident" id="4994278">p</span><span class="op" id="4994279">.</span><span class="ident" id="4994280">tok</span>&nbsp;<span class="op" id="4994284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994287">case</span>&nbsp;<span class="ident" id="4994292">token</span><span class="op" id="4994297">.</span><span class="ident" id="4994298">IDENT</span><span class="op" id="4994303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994307">x</span>&nbsp;<span class="op" id="4994309">:=</span>&nbsp;<span class="ident" id="4994312">p</span><span class="op" id="4994313">.</span><span class="ident" id="4994314">parseIdent</span><span class="op" id="4994324">(</span><span class="op" id="4994325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994329">if</span>&nbsp;<span class="op" id="4994332">!</span><span class="ident" id="4994333">lhs</span>&nbsp;<span class="op" id="4994337">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994342">p</span><span class="op" id="4994343">.</span><span class="ident" id="4994344">resolve</span><span class="op" id="4994351">(</span><span class="ident" id="4994352">x</span><span class="op" id="4994353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4994357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994361">return</span>&nbsp;<span class="ident" id="4994368">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994372">case</span>&nbsp;<span class="ident" id="4994377">token</span><span class="op" id="4994382">.</span><span class="ident" id="4994383">INT</span><span class="op" id="4994386">,</span>&nbsp;<span class="ident" id="4994388">token</span><span class="op" id="4994393">.</span><span class="ident" id="4994394">FLOAT</span><span class="op" id="4994399">,</span>&nbsp;<span class="ident" id="4994401">token</span><span class="op" id="4994406">.</span><span class="ident" id="4994407">IMAG</span><span class="op" id="4994411">,</span>&nbsp;<span class="ident" id="4994413">token</span><span class="op" id="4994418">.</span><span class="ident" id="4994419">CHAR</span><span class="op" id="4994423">,</span>&nbsp;<span class="ident" id="4994425">token</span><span class="op" id="4994430">.</span><span class="ident" id="4994431">STRING</span><span class="op" id="4994437">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994441">x</span>&nbsp;<span class="op" id="4994443">:=</span>&nbsp;<span class="op" id="4994446">&amp;</span><span class="ident" id="4994447">ast</span><span class="op" id="4994450">.</span><span class="ident" id="4994451">BasicLit</span><span class="op" id="4994459">{</span><span class="ident" id="4994460">ValuePos</span><span class="op" id="4994468">:</span>&nbsp;<span class="ident" id="4994470">p</span><span class="op" id="4994471">.</span><span class="ident" id="4994472">pos</span><span class="op" id="4994475">,</span>&nbsp;<span class="ident" id="4994477">Kind</span><span class="op" id="4994481">:</span>&nbsp;<span class="ident" id="4994483">p</span><span class="op" id="4994484">.</span><span class="ident" id="4994485">tok</span><span class="op" id="4994488">,</span>&nbsp;<span class="ident" id="4994490">Value</span><span class="op" id="4994495">:</span>&nbsp;<span class="ident" id="4994497">p</span><span class="op" id="4994498">.</span><span class="ident" id="4994499">lit</span><span class="op" id="4994502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994506">p</span><span class="op" id="4994507">.</span><span class="ident" id="4994508">next</span><span class="op" id="4994512">(</span><span class="op" id="4994513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994517">return</span>&nbsp;<span class="ident" id="4994524">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994528">case</span>&nbsp;<span class="ident" id="4994533">token</span><span class="op" id="4994538">.</span><span class="ident" id="4994539">LPAREN</span><span class="op" id="4994545">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994549">lparen</span>&nbsp;<span class="op" id="4994556">:=</span>&nbsp;<span class="ident" id="4994559">p</span><span class="op" id="4994560">.</span><span class="ident" id="4994561">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994567">p</span><span class="op" id="4994568">.</span><span class="ident" id="4994569">next</span><span class="op" id="4994573">(</span><span class="op" id="4994574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994578">p</span><span class="op" id="4994579">.</span><span class="ident" id="4994580">exprLev</span><span class="op" id="4994587">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994592">x</span>&nbsp;<span class="op" id="4994594">:=</span>&nbsp;<span class="ident" id="4994597">p</span><span class="op" id="4994598">.</span><span class="ident" id="4994599">parseRhsOrType</span><span class="op" id="4994613">(</span><span class="op" id="4994614">)</span>&nbsp;<span class="comment" id="4994616">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994661">p</span><span class="op" id="4994662">.</span><span class="ident" id="4994663">exprLev</span><span class="op" id="4994670">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994675">rparen</span>&nbsp;<span class="op" id="4994682">:=</span>&nbsp;<span class="ident" id="4994685">p</span><span class="op" id="4994686">.</span><span class="ident" id="4994687">expect</span><span class="op" id="4994693">(</span><span class="ident" id="4994694">token</span><span class="op" id="4994699">.</span><span class="ident" id="4994700">RPAREN</span><span class="op" id="4994706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994710">return</span>&nbsp;<span class="op" id="4994717">&amp;</span><span class="ident" id="4994718">ast</span><span class="op" id="4994721">.</span><span class="ident" id="4994722">ParenExpr</span><span class="op" id="4994731">{</span><span class="ident" id="4994732">Lparen</span><span class="op" id="4994738">:</span>&nbsp;<span class="ident" id="4994740">lparen</span><span class="op" id="4994746">,</span>&nbsp;<span class="ident" id="4994748">X</span><span class="op" id="4994749">:</span>&nbsp;<span class="ident" id="4994751">x</span><span class="op" id="4994752">,</span>&nbsp;<span class="ident" id="4994754">Rparen</span><span class="op" id="4994760">:</span>&nbsp;<span class="ident" id="4994762">rparen</span><span class="op" id="4994768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994772">case</span>&nbsp;<span class="ident" id="4994777">token</span><span class="op" id="4994782">.</span><span class="ident" id="4994783">FUNC</span><span class="op" id="4994787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994791">return</span>&nbsp;<span class="ident" id="4994798">p</span><span class="op" id="4994799">.</span><span class="ident" id="4994800">parseFuncTypeOrLit</span><span class="op" id="4994818">(</span><span class="op" id="4994819">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4994822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994826">if</span>&nbsp;<span class="ident" id="4994829">typ</span>&nbsp;<span class="op" id="4994833">:=</span>&nbsp;<span class="ident" id="4994836">p</span><span class="op" id="4994837">.</span><span class="ident" id="4994838">tryIdentOrType</span><span class="op" id="4994852">(</span><span class="op" id="4994853">)</span><span class="op" id="4994854">;</span>&nbsp;<span class="ident" id="4994856">typ</span>&nbsp;<span class="op" id="4994860">!=</span>&nbsp;<span class="ident" id="4994863">nil</span>&nbsp;<span class="op" id="4994867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4994871">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994926">_</span><span class="op" id="4994927">,</span>&nbsp;<span class="ident" id="4994929">isIdent</span>&nbsp;<span class="op" id="4994937">:=</span>&nbsp;<span class="ident" id="4994940">typ</span><span class="op" id="4994943">.</span><span class="op" id="4994944">(</span><span class="op" id="4994945">*</span><span class="ident" id="4994946">ast</span><span class="op" id="4994949">.</span><span class="ident" id="4994950">Ident</span><span class="op" id="4994955">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994959">assert</span><span class="op" id="4994965">(</span><span class="op" id="4994966">!</span><span class="ident" id="4994967">isIdent</span><span class="op" id="4994974">,</span>&nbsp;<span class="string" id="4994976">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="4995003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995007">return</span>&nbsp;<span class="ident" id="4995014">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4995023">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995044">pos</span>&nbsp;<span class="op" id="4995048">:=</span>&nbsp;<span class="ident" id="4995051">p</span><span class="op" id="4995052">.</span><span class="ident" id="4995053">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995058">p</span><span class="op" id="4995059">.</span><span class="ident" id="4995060">errorExpected</span><span class="op" id="4995073">(</span><span class="ident" id="4995074">pos</span><span class="op" id="4995077">,</span>&nbsp;<span class="string" id="4995079">&#34;operand&#34;</span><span class="op" id="4995088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995091">syncStmt</span><span class="op" id="4995099">(</span><span class="ident" id="4995100">p</span><span class="op" id="4995101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995104">return</span>&nbsp;<span class="op" id="4995111">&amp;</span><span class="ident" id="4995112">ast</span><span class="op" id="4995115">.</span><span class="ident" id="4995116">BadExpr</span><span class="op" id="4995123">{</span><span class="ident" id="4995124">From</span><span class="op" id="4995128">:</span>&nbsp;<span class="ident" id="4995130">pos</span><span class="op" id="4995133">,</span>&nbsp;<span class="ident" id="4995135">To</span><span class="op" id="4995137">:</span>&nbsp;<span class="ident" id="4995139">p</span><span class="op" id="4995140">.</span><span class="ident" id="4995141">pos</span><span class="op" id="4995144">}</span><br>
<span class="lineno"></span><span class="op" id="4995146">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="4995149">func</span>&nbsp;<span class="op" id="4995154">(</span><span class="ident" id="4995155">p</span>&nbsp;<span class="op" id="4995157">*</span><span class="ident" id="4995158">parser</span><span class="op" id="4995164">)</span>&nbsp;<span class="ident" id="4995166">parseSelector</span><span class="op" id="4995179">(</span><span class="ident" id="4995180">x</span>&nbsp;<span class="ident" id="4995182">ast</span><span class="op" id="4995185">.</span><span class="ident" id="4995186">Expr</span><span class="op" id="4995190">)</span>&nbsp;<span class="ident" id="4995192">ast</span><span class="op" id="4995195">.</span><span class="ident" id="4995196">Expr</span>&nbsp;<span class="op" id="4995201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995204">if</span>&nbsp;<span class="ident" id="4995207">p</span><span class="op" id="4995208">.</span><span class="ident" id="4995209">trace</span>&nbsp;<span class="op" id="4995215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995219">defer</span>&nbsp;<span class="ident" id="4995225">un</span><span class="op" id="4995227">(</span><span class="ident" id="4995228">trace</span><span class="op" id="4995233">(</span><span class="ident" id="4995234">p</span><span class="op" id="4995235">,</span>&nbsp;<span class="string" id="4995237">&#34;Selector&#34;</span><span class="op" id="4995247">)</span><span class="op" id="4995248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995251">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995255">sel</span>&nbsp;<span class="op" id="4995259">:=</span>&nbsp;<span class="ident" id="4995262">p</span><span class="op" id="4995263">.</span><span class="ident" id="4995264">parseIdent</span><span class="op" id="4995274">(</span><span class="op" id="4995275">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995279">return</span>&nbsp;<span class="op" id="4995286">&amp;</span><span class="ident" id="4995287">ast</span><span class="op" id="4995290">.</span><span class="ident" id="4995291">SelectorExpr</span><span class="op" id="4995303">{</span><span class="ident" id="4995304">X</span><span class="op" id="4995305">:</span>&nbsp;<span class="ident" id="4995307">x</span><span class="op" id="4995308">,</span>&nbsp;<span class="ident" id="4995310">Sel</span><span class="op" id="4995313">:</span>&nbsp;<span class="ident" id="4995315">sel</span><span class="op" id="4995318">}</span><br>
<span class="lineno"></span><span class="op" id="4995320">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="4995323">func</span>&nbsp;<span class="op" id="4995328">(</span><span class="ident" id="4995329">p</span>&nbsp;<span class="op" id="4995331">*</span><span class="ident" id="4995332">parser</span><span class="op" id="4995338">)</span>&nbsp;<span class="ident" id="4995340">parseTypeAssertion</span><span class="op" id="4995358">(</span><span class="ident" id="4995359">x</span>&nbsp;<span class="ident" id="4995361">ast</span><span class="op" id="4995364">.</span><span class="ident" id="4995365">Expr</span><span class="op" id="4995369">)</span>&nbsp;<span class="ident" id="4995371">ast</span><span class="op" id="4995374">.</span><span class="ident" id="4995375">Expr</span>&nbsp;<span class="op" id="4995380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995383">if</span>&nbsp;<span class="ident" id="4995386">p</span><span class="op" id="4995387">.</span><span class="ident" id="4995388">trace</span>&nbsp;<span class="op" id="4995394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995398">defer</span>&nbsp;<span class="ident" id="4995404">un</span><span class="op" id="4995406">(</span><span class="ident" id="4995407">trace</span><span class="op" id="4995412">(</span><span class="ident" id="4995413">p</span><span class="op" id="4995414">,</span>&nbsp;<span class="string" id="4995416">&#34;TypeAssertion&#34;</span><span class="op" id="4995431">)</span><span class="op" id="4995432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995435">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995439">lparen</span>&nbsp;<span class="op" id="4995446">:=</span>&nbsp;<span class="ident" id="4995449">p</span><span class="op" id="4995450">.</span><span class="ident" id="4995451">expect</span><span class="op" id="4995457">(</span><span class="ident" id="4995458">token</span><span class="op" id="4995463">.</span><span class="ident" id="4995464">LPAREN</span><span class="op" id="4995470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995473">var</span>&nbsp;<span class="ident" id="4995477">typ</span>&nbsp;<span class="ident" id="4995481">ast</span><span class="op" id="4995484">.</span><span class="ident" id="4995485">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995491">if</span>&nbsp;<span class="ident" id="4995494">p</span><span class="op" id="4995495">.</span><span class="ident" id="4995496">tok</span>&nbsp;<span class="op" id="4995500">==</span>&nbsp;<span class="ident" id="4995503">token</span><span class="op" id="4995508">.</span><span class="ident" id="4995509">TYPE</span>&nbsp;<span class="op" id="4995514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4995518">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995547">p</span><span class="op" id="4995548">.</span><span class="ident" id="4995549">next</span><span class="op" id="4995553">(</span><span class="op" id="4995554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995557">}</span>&nbsp;<span class="keyword" id="4995559">else</span>&nbsp;<span class="op" id="4995564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995568">typ</span>&nbsp;<span class="op" id="4995572">=</span>&nbsp;<span class="ident" id="4995574">p</span><span class="op" id="4995575">.</span><span class="ident" id="4995576">parseType</span><span class="op" id="4995585">(</span><span class="op" id="4995586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995592">rparen</span>&nbsp;<span class="op" id="4995599">:=</span>&nbsp;<span class="ident" id="4995602">p</span><span class="op" id="4995603">.</span><span class="ident" id="4995604">expect</span><span class="op" id="4995610">(</span><span class="ident" id="4995611">token</span><span class="op" id="4995616">.</span><span class="ident" id="4995617">RPAREN</span><span class="op" id="4995623">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995627">return</span>&nbsp;<span class="op" id="4995634">&amp;</span><span class="ident" id="4995635">ast</span><span class="op" id="4995638">.</span><span class="ident" id="4995639">TypeAssertExpr</span><span class="op" id="4995653">{</span><span class="ident" id="4995654">X</span><span class="op" id="4995655">:</span>&nbsp;<span class="ident" id="4995657">x</span><span class="op" id="4995658">,</span>&nbsp;<span class="ident" id="4995660">Type</span><span class="op" id="4995664">:</span>&nbsp;<span class="ident" id="4995666">typ</span><span class="op" id="4995669">,</span>&nbsp;<span class="ident" id="4995671">Lparen</span><span class="op" id="4995677">:</span>&nbsp;<span class="ident" id="4995679">lparen</span><span class="op" id="4995685">,</span>&nbsp;<span class="ident" id="4995687">Rparen</span><span class="op" id="4995693">:</span>&nbsp;<span class="ident" id="4995695">rparen</span><span class="op" id="4995701">}</span><br>
<span class="lineno"></span><span class="op" id="4995703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4995706">func</span>&nbsp;<span class="op" id="4995711">(</span><span class="ident" id="4995712">p</span>&nbsp;<span class="op" id="4995714">*</span><span class="ident" id="4995715">parser</span><span class="op" id="4995721">)</span>&nbsp;<span class="ident" id="4995723">parseIndexOrSlice</span><span class="op" id="4995740">(</span><span class="ident" id="4995741">x</span>&nbsp;<span class="ident" id="4995743">ast</span><span class="op" id="4995746">.</span><span class="ident" id="4995747">Expr</span><span class="op" id="4995751">)</span>&nbsp;<span class="ident" id="4995753">ast</span><span class="op" id="4995756">.</span><span class="ident" id="4995757">Expr</span>&nbsp;<span class="op" id="4995762">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995765">if</span>&nbsp;<span class="ident" id="4995768">p</span><span class="op" id="4995769">.</span><span class="ident" id="4995770">trace</span>&nbsp;<span class="op" id="4995776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995780">defer</span>&nbsp;<span class="ident" id="4995786">un</span><span class="op" id="4995788">(</span><span class="ident" id="4995789">trace</span><span class="op" id="4995794">(</span><span class="ident" id="4995795">p</span><span class="op" id="4995796">,</span>&nbsp;<span class="string" id="4995798">&#34;IndexOrSlice&#34;</span><span class="op" id="4995812">)</span><span class="op" id="4995813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995820">const</span>&nbsp;<span class="ident" id="4995826">N</span>&nbsp;<span class="op" id="4995828">=</span>&nbsp;<span class="num" id="4995830">3</span>&nbsp;<span class="comment" id="4995832">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995880">lbrack</span>&nbsp;<span class="op" id="4995887">:=</span>&nbsp;<span class="ident" id="4995890">p</span><span class="op" id="4995891">.</span><span class="ident" id="4995892">expect</span><span class="op" id="4995898">(</span><span class="ident" id="4995899">token</span><span class="op" id="4995904">.</span><span class="ident" id="4995905">LBRACK</span><span class="op" id="4995911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995914">p</span><span class="op" id="4995915">.</span><span class="ident" id="4995916">exprLev</span><span class="op" id="4995923">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995927">var</span>&nbsp;<span class="ident" id="4995931">index</span>&nbsp;<span class="op" id="4995937">[</span><span class="ident" id="4995938">N</span><span class="op" id="4995939">]</span><span class="ident" id="4995940">ast</span><span class="op" id="4995943">.</span><span class="ident" id="4995944">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995950">var</span>&nbsp;<span class="ident" id="4995954">colons</span>&nbsp;<span class="op" id="4995961">[</span><span class="ident" id="4995962">N</span>&nbsp;<span class="op" id="4995964">-</span>&nbsp;<span class="num" id="4995966">1</span><span class="op" id="4995967">]</span><span class="ident" id="4995968">token</span><span class="op" id="4995973">.</span><span class="ident" id="4995974">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995979">if</span>&nbsp;<span class="ident" id="4995982">p</span><span class="op" id="4995983">.</span><span class="ident" id="4995984">tok</span>&nbsp;<span class="op" id="4995988">!=</span>&nbsp;<span class="ident" id="4995991">token</span><span class="op" id="4995996">.</span><span class="ident" id="4995997">COLON</span>&nbsp;<span class="op" id="4996003">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996007">index</span><span class="op" id="4996012">[</span><span class="num" id="4996013">0</span><span class="op" id="4996014">]</span>&nbsp;<span class="op" id="4996016">=</span>&nbsp;<span class="ident" id="4996018">p</span><span class="op" id="4996019">.</span><span class="ident" id="4996020">parseRhs</span><span class="op" id="4996028">(</span><span class="op" id="4996029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996035">ncolons</span>&nbsp;<span class="op" id="4996043">:=</span>&nbsp;<span class="num" id="4996046">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996049">for</span>&nbsp;<span class="ident" id="4996053">p</span><span class="op" id="4996054">.</span><span class="ident" id="4996055">tok</span>&nbsp;<span class="op" id="4996059">==</span>&nbsp;<span class="ident" id="4996062">token</span><span class="op" id="4996067">.</span><span class="ident" id="4996068">COLON</span>&nbsp;<span class="op" id="4996074">&amp;&amp;</span>&nbsp;<span class="ident" id="4996077">ncolons</span>&nbsp;<span class="op" id="4996085">&lt;</span>&nbsp;<span class="builtinfunc" id="4996087">len</span><span class="op" id="4996090">(</span><span class="ident" id="4996091">colons</span><span class="op" id="4996097">)</span>&nbsp;<span class="op" id="4996099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996103">colons</span><span class="op" id="4996109">[</span><span class="ident" id="4996110">ncolons</span><span class="op" id="4996117">]</span>&nbsp;<span class="op" id="4996119">=</span>&nbsp;<span class="ident" id="4996121">p</span><span class="op" id="4996122">.</span><span class="ident" id="4996123">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996129">ncolons</span><span class="op" id="4996136">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996141">p</span><span class="op" id="4996142">.</span><span class="ident" id="4996143">next</span><span class="op" id="4996147">(</span><span class="op" id="4996148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996152">if</span>&nbsp;<span class="ident" id="4996155">p</span><span class="op" id="4996156">.</span><span class="ident" id="4996157">tok</span>&nbsp;<span class="op" id="4996161">!=</span>&nbsp;<span class="ident" id="4996164">token</span><span class="op" id="4996169">.</span><span class="ident" id="4996170">COLON</span>&nbsp;<span class="op" id="4996176">&amp;&amp;</span>&nbsp;<span class="ident" id="4996179">p</span><span class="op" id="4996180">.</span><span class="ident" id="4996181">tok</span>&nbsp;<span class="op" id="4996185">!=</span>&nbsp;<span class="ident" id="4996188">token</span><span class="op" id="4996193">.</span><span class="ident" id="4996194">RBRACK</span>&nbsp;<span class="op" id="4996201">&amp;&amp;</span>&nbsp;<span class="ident" id="4996204">p</span><span class="op" id="4996205">.</span><span class="ident" id="4996206">tok</span>&nbsp;<span class="op" id="4996210">!=</span>&nbsp;<span class="ident" id="4996213">token</span><span class="op" id="4996218">.</span><span class="ident" id="4996219">EOF</span>&nbsp;<span class="op" id="4996223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996228">index</span><span class="op" id="4996233">[</span><span class="ident" id="4996234">ncolons</span><span class="op" id="4996241">]</span>&nbsp;<span class="op" id="4996243">=</span>&nbsp;<span class="ident" id="4996245">p</span><span class="op" id="4996246">.</span><span class="ident" id="4996247">parseRhs</span><span class="op" id="4996255">(</span><span class="op" id="4996256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996260">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996266">p</span><span class="op" id="4996267">.</span><span class="ident" id="4996268">exprLev</span><span class="op" id="4996275">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996279">rbrack</span>&nbsp;<span class="op" id="4996286">:=</span>&nbsp;<span class="ident" id="4996289">p</span><span class="op" id="4996290">.</span><span class="ident" id="4996291">expect</span><span class="op" id="4996297">(</span><span class="ident" id="4996298">token</span><span class="op" id="4996303">.</span><span class="ident" id="4996304">RBRACK</span><span class="op" id="4996310">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996314">if</span>&nbsp;<span class="ident" id="4996317">ncolons</span>&nbsp;<span class="op" id="4996325">&gt;</span>&nbsp;<span class="num" id="4996327">0</span>&nbsp;<span class="op" id="4996329">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4996333">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996355">slice3</span>&nbsp;<span class="op" id="4996362">:=</span>&nbsp;<span class="builtintype" id="4996365">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996373">if</span>&nbsp;<span class="ident" id="4996376">ncolons</span>&nbsp;<span class="op" id="4996384">==</span>&nbsp;<span class="num" id="4996387">2</span>&nbsp;<span class="op" id="4996389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996394">slice3</span>&nbsp;<span class="op" id="4996401">=</span>&nbsp;<span class="builtintype" id="4996403">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4996411">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4996491">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996572">if</span>&nbsp;<span class="ident" id="4996575">index</span><span class="op" id="4996580">[</span><span class="num" id="4996581">1</span><span class="op" id="4996582">]</span>&nbsp;<span class="op" id="4996584">==</span>&nbsp;<span class="ident" id="4996587">nil</span>&nbsp;<span class="op" id="4996591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996597">p</span><span class="op" id="4996598">.</span><span class="builtintype" id="4996599">error</span><span class="op" id="4996604">(</span><span class="ident" id="4996605">colons</span><span class="op" id="4996611">[</span><span class="num" id="4996612">0</span><span class="op" id="4996613">]</span><span class="op" id="4996614">,</span>&nbsp;<span class="string" id="4996616">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="4996653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996659">index</span><span class="op" id="4996664">[</span><span class="num" id="4996665">1</span><span class="op" id="4996666">]</span>&nbsp;<span class="op" id="4996668">=</span>&nbsp;<span class="op" id="4996670">&amp;</span><span class="ident" id="4996671">ast</span><span class="op" id="4996674">.</span><span class="ident" id="4996675">BadExpr</span><span class="op" id="4996682">{</span><span class="ident" id="4996683">From</span><span class="op" id="4996687">:</span>&nbsp;<span class="ident" id="4996689">colons</span><span class="op" id="4996695">[</span><span class="num" id="4996696">0</span><span class="op" id="4996697">]</span>&nbsp;<span class="op" id="4996699">+</span>&nbsp;<span class="num" id="4996701">1</span><span class="op" id="4996702">,</span>&nbsp;<span class="ident" id="4996704">To</span><span class="op" id="4996706">:</span>&nbsp;<span class="ident" id="4996708">colons</span><span class="op" id="4996714">[</span><span class="num" id="4996715">1</span><span class="op" id="4996716">]</span><span class="op" id="4996717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996722">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996727">if</span>&nbsp;<span class="ident" id="4996730">index</span><span class="op" id="4996735">[</span><span class="num" id="4996736">2</span><span class="op" id="4996737">]</span>&nbsp;<span class="op" id="4996739">==</span>&nbsp;<span class="ident" id="4996742">nil</span>&nbsp;<span class="op" id="4996746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996752">p</span><span class="op" id="4996753">.</span><span class="builtintype" id="4996754">error</span><span class="op" id="4996759">(</span><span class="ident" id="4996760">colons</span><span class="op" id="4996766">[</span><span class="num" id="4996767">1</span><span class="op" id="4996768">]</span><span class="op" id="4996769">,</span>&nbsp;<span class="string" id="4996771">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="4996808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996814">index</span><span class="op" id="4996819">[</span><span class="num" id="4996820">2</span><span class="op" id="4996821">]</span>&nbsp;<span class="op" id="4996823">=</span>&nbsp;<span class="op" id="4996825">&amp;</span><span class="ident" id="4996826">ast</span><span class="op" id="4996829">.</span><span class="ident" id="4996830">BadExpr</span><span class="op" id="4996837">{</span><span class="ident" id="4996838">From</span><span class="op" id="4996842">:</span>&nbsp;<span class="ident" id="4996844">colons</span><span class="op" id="4996850">[</span><span class="num" id="4996851">1</span><span class="op" id="4996852">]</span>&nbsp;<span class="op" id="4996854">+</span>&nbsp;<span class="num" id="4996856">1</span><span class="op" id="4996857">,</span>&nbsp;<span class="ident" id="4996859">To</span><span class="op" id="4996861">:</span>&nbsp;<span class="ident" id="4996863">rbrack</span><span class="op" id="4996869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996878">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996882">return</span>&nbsp;<span class="op" id="4996889">&amp;</span><span class="ident" id="4996890">ast</span><span class="op" id="4996893">.</span><span class="ident" id="4996894">SliceExpr</span><span class="op" id="4996903">{</span><span class="ident" id="4996904">X</span><span class="op" id="4996905">:</span>&nbsp;<span class="ident" id="4996907">x</span><span class="op" id="4996908">,</span>&nbsp;<span class="ident" id="4996910">Lbrack</span><span class="op" id="4996916">:</span>&nbsp;<span class="ident" id="4996918">lbrack</span><span class="op" id="4996924">,</span>&nbsp;<span class="ident" id="4996926">Low</span><span class="op" id="4996929">:</span>&nbsp;<span class="ident" id="4996931">index</span><span class="op" id="4996936">[</span><span class="num" id="4996937">0</span><span class="op" id="4996938">]</span><span class="op" id="4996939">,</span>&nbsp;<span class="ident" id="4996941">High</span><span class="op" id="4996945">:</span>&nbsp;<span class="ident" id="4996947">index</span><span class="op" id="4996952">[</span><span class="num" id="4996953">1</span><span class="op" id="4996954">]</span><span class="op" id="4996955">,</span>&nbsp;<span class="ident" id="4996957">Max</span><span class="op" id="4996960">:</span>&nbsp;<span class="ident" id="4996962">index</span><span class="op" id="4996967">[</span><span class="num" id="4996968">2</span><span class="op" id="4996969">]</span><span class="op" id="4996970">,</span>&nbsp;<span class="ident" id="4996972">Slice3</span><span class="op" id="4996978">:</span>&nbsp;<span class="ident" id="4996980">slice3</span><span class="op" id="4996986">,</span>&nbsp;<span class="ident" id="4996988">Rbrack</span><span class="op" id="4996994">:</span>&nbsp;<span class="ident" id="4996996">rbrack</span><span class="op" id="4997002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4997005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997009">return</span>&nbsp;<span class="op" id="4997016">&amp;</span><span class="ident" id="4997017">ast</span><span class="op" id="4997020">.</span><span class="ident" id="4997021">IndexExpr</span><span class="op" id="4997030">{</span><span class="ident" id="4997031">X</span><span class="op" id="4997032">:</span>&nbsp;<span class="ident" id="4997034">x</span><span class="op" id="4997035">,</span>&nbsp;<span class="ident" id="4997037">Lbrack</span><span class="op" id="4997043">:</span>&nbsp;<span class="ident" id="4997045">lbrack</span><span class="op" id="4997051">,</span>&nbsp;<span class="ident" id="4997053">Index</span><span class="op" id="4997058">:</span>&nbsp;<span class="ident" id="4997060">index</span><span class="op" id="4997065">[</span><span class="num" id="4997066">0</span><span class="op" id="4997067">]</span><span class="op" id="4997068">,</span>&nbsp;<span class="ident" id="4997070">Rbrack</span><span class="op" id="4997076">:</span>&nbsp;<span class="ident" id="4997078">rbrack</span><span class="op" id="4997084">}</span><br>
<span class="lineno"></span><span class="op" id="4997086">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="4997089">func</span>&nbsp;<span class="op" id="4997094">(</span><span class="ident" id="4997095">p</span>&nbsp;<span class="op" id="4997097">*</span><span class="ident" id="4997098">parser</span><span class="op" id="4997104">)</span>&nbsp;<span class="ident" id="4997106">parseCallOrConversion</span><span class="op" id="4997127">(</span><span class="ident" id="4997128">fun</span>&nbsp;<span class="ident" id="4997132">ast</span><span class="op" id="4997135">.</span><span class="ident" id="4997136">Expr</span><span class="op" id="4997140">)</span>&nbsp;<span class="op" id="4997142">*</span><span class="ident" id="4997143">ast</span><span class="op" id="4997146">.</span><span class="ident" id="4997147">CallExpr</span>&nbsp;<span class="op" id="4997156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997159">if</span>&nbsp;<span class="ident" id="4997162">p</span><span class="op" id="4997163">.</span><span class="ident" id="4997164">trace</span>&nbsp;<span class="op" id="4997170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997174">defer</span>&nbsp;<span class="ident" id="4997180">un</span><span class="op" id="4997182">(</span><span class="ident" id="4997183">trace</span><span class="op" id="4997188">(</span><span class="ident" id="4997189">p</span><span class="op" id="4997190">,</span>&nbsp;<span class="string" id="4997192">&#34;CallOrConversion&#34;</span><span class="op" id="4997210">)</span><span class="op" id="4997211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4997214">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997218">lparen</span>&nbsp;<span class="op" id="4997225">:=</span>&nbsp;<span class="ident" id="4997228">p</span><span class="op" id="4997229">.</span><span class="ident" id="4997230">expect</span><span class="op" id="4997236">(</span><span class="ident" id="4997237">token</span><span class="op" id="4997242">.</span><span class="ident" id="4997243">LPAREN</span><span class="op" id="4997249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997252">p</span><span class="op" id="4997253">.</span><span class="ident" id="4997254">exprLev</span><span class="op" id="4997261">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997265">var</span>&nbsp;<span class="ident" id="4997269">list</span>&nbsp;<span class="op" id="4997274">[</span><span class="op" id="4997275">]</span><span class="ident" id="4997276">ast</span><span class="op" id="4997279">.</span><span class="ident" id="4997280">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997286">var</span>&nbsp;<span class="ident" id="4997290">ellipsis</span>&nbsp;<span class="ident" id="4997299">token</span><span class="op" id="4997304">.</span><span class="ident" id="4997305">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997310">for</span>&nbsp;<span class="ident" id="4997314">p</span><span class="op" id="4997315">.</span><span class="ident" id="4997316">tok</span>&nbsp;<span class="op" id="4997320">!=</span>&nbsp;<span class="ident" id="4997323">token</span><span class="op" id="4997328">.</span><span class="ident" id="4997329">RPAREN</span>&nbsp;<span class="op" id="4997336">&amp;&amp;</span>&nbsp;<span class="ident" id="4997339">p</span><span class="op" id="4997340">.</span><span class="ident" id="4997341">tok</span>&nbsp;<span class="op" id="4997345">!=</span>&nbsp;<span class="ident" id="4997348">token</span><span class="op" id="4997353">.</span><span class="ident" id="4997354">EOF</span>&nbsp;<span class="op" id="4997358">&amp;&amp;</span>&nbsp;<span class="op" id="4997361">!</span><span class="ident" id="4997362">ellipsis</span><span class="op" id="4997370">.</span><span class="ident" id="4997371">IsValid</span><span class="op" id="4997378">(</span><span class="op" id="4997379">)</span>&nbsp;<span class="op" id="4997381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997385">list</span>&nbsp;<span class="op" id="4997390">=</span>&nbsp;<span class="builtinfunc" id="4997392">append</span><span class="op" id="4997398">(</span><span class="ident" id="4997399">list</span><span class="op" id="4997403">,</span>&nbsp;<span class="ident" id="4997405">p</span><span class="op" id="4997406">.</span><span class="ident" id="4997407">parseRhsOrType</span><span class="op" id="4997421">(</span><span class="op" id="4997422">)</span><span class="op" id="4997423">)</span>&nbsp;<span class="comment" id="4997425">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997479">if</span>&nbsp;<span class="ident" id="4997482">p</span><span class="op" id="4997483">.</span><span class="ident" id="4997484">tok</span>&nbsp;<span class="op" id="4997488">==</span>&nbsp;<span class="ident" id="4997491">token</span><span class="op" id="4997496">.</span><span class="ident" id="4997497">ELLIPSIS</span>&nbsp;<span class="op" id="4997506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997511">ellipsis</span>&nbsp;<span class="op" id="4997520">=</span>&nbsp;<span class="ident" id="4997522">p</span><span class="op" id="4997523">.</span><span class="ident" id="4997524">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997531">p</span><span class="op" id="4997532">.</span><span class="ident" id="4997533">next</span><span class="op" id="4997537">(</span><span class="op" id="4997538">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4997542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997546">if</span>&nbsp;<span class="op" id="4997549">!</span><span class="ident" id="4997550">p</span><span class="op" id="4997551">.</span><span class="ident" id="4997552">atComma</span><span class="op" id="4997559">(</span><span class="string" id="4997560">&#34;argument&nbsp;list&#34;</span><span class="op" id="4997575">)</span>&nbsp;<span class="op" id="4997577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997582">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4997590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997594">p</span><span class="op" id="4997595">.</span><span class="ident" id="4997596">next</span><span class="op" id="4997600">(</span><span class="op" id="4997601">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4997604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997607">p</span><span class="op" id="4997608">.</span><span class="ident" id="4997609">exprLev</span><span class="op" id="4997616">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997620">rparen</span>&nbsp;<span class="op" id="4997627">:=</span>&nbsp;<span class="ident" id="4997630">p</span><span class="op" id="4997631">.</span><span class="ident" id="4997632">expectClosing</span><span class="op" id="4997645">(</span><span class="ident" id="4997646">token</span><span class="op" id="4997651">.</span><span class="ident" id="4997652">RPAREN</span><span class="op" id="4997658">,</span>&nbsp;<span class="string" id="4997660">&#34;argument&nbsp;list&#34;</span><span class="op" id="4997675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997679">return</span>&nbsp;<span class="op" id="4997686">&amp;</span><span class="ident" id="4997687">ast</span><span class="op" id="4997690">.</span><span class="ident" id="4997691">CallExpr</span><span class="op" id="4997699">{</span><span class="ident" id="4997700">Fun</span><span class="op" id="4997703">:</span>&nbsp;<span class="ident" id="4997705">fun</span><span class="op" id="4997708">,</span>&nbsp;<span class="ident" id="4997710">Lparen</span><span class="op" id="4997716">:</span>&nbsp;<span class="ident" id="4997718">lparen</span><span class="op" id="4997724">,</span>&nbsp;<span class="ident" id="4997726">Args</span><span class="op" id="4997730">:</span>&nbsp;<span class="ident" id="4997732">list</span><span class="op" id="4997736">,</span>&nbsp;<span class="ident" id="4997738">Ellipsis</span><span class="op" id="4997746">:</span>&nbsp;<span class="ident" id="4997748">ellipsis</span><span class="op" id="4997756">,</span>&nbsp;<span class="ident" id="4997758">Rparen</span><span class="op" id="4997764">:</span>&nbsp;<span class="ident" id="4997766">rparen</span><span class="op" id="4997772">}</span><br>
<span class="lineno">1260</span><span class="op" id="4997774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4997777">func</span>&nbsp;<span class="op" id="4997782">(</span><span class="ident" id="4997783">p</span>&nbsp;<span class="op" id="4997785">*</span><span class="ident" id="4997786">parser</span><span class="op" id="4997792">)</span>&nbsp;<span class="ident" id="4997794">parseElement</span><span class="op" id="4997806">(</span><span class="ident" id="4997807">keyOk</span>&nbsp;<span class="builtintype" id="4997813">bool</span><span class="op" id="4997817">)</span>&nbsp;<span class="ident" id="4997819">ast</span><span class="op" id="4997822">.</span><span class="ident" id="4997823">Expr</span>&nbsp;<span class="op" id="4997828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997831">if</span>&nbsp;<span class="ident" id="4997834">p</span><span class="op" id="4997835">.</span><span class="ident" id="4997836">trace</span>&nbsp;<span class="op" id="4997842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997846">defer</span>&nbsp;<span class="ident" id="4997852">un</span><span class="op" id="4997854">(</span><span class="ident" id="4997855">trace</span><span class="op" id="4997860">(</span><span class="ident" id="4997861">p</span><span class="op" id="4997862">,</span>&nbsp;<span class="string" id="4997864">&#34;Element&#34;</span><span class="op" id="4997873">)</span><span class="op" id="4997874">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4997877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997881">if</span>&nbsp;<span class="ident" id="4997884">p</span><span class="op" id="4997885">.</span><span class="ident" id="4997886">tok</span>&nbsp;<span class="op" id="4997890">==</span>&nbsp;<span class="ident" id="4997893">token</span><span class="op" id="4997898">.</span><span class="ident" id="4997899">LBRACE</span>&nbsp;<span class="op" id="4997906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997910">return</span>&nbsp;<span class="ident" id="4997917">p</span><span class="op" id="4997918">.</span><span class="ident" id="4997919">parseLiteralValue</span><span class="op" id="4997936">(</span><span class="ident" id="4997937">nil</span><span class="op" id="4997940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4997943">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4997947">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998021">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998093">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998163">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998177">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998181">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998251">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998320">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998391">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998459">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998526">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998530">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998596">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998669">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998742">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998815">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998844">x</span>&nbsp;<span class="op" id="4998846">:=</span>&nbsp;<span class="ident" id="4998849">p</span><span class="op" id="4998850">.</span><span class="ident" id="4998851">checkExpr</span><span class="op" id="4998860">(</span><span class="ident" id="4998861">p</span><span class="op" id="4998862">.</span><span class="ident" id="4998863">parseExpr</span><span class="op" id="4998872">(</span><span class="ident" id="4998873">keyOk</span><span class="op" id="4998878">)</span><span class="op" id="4998879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4998882">if</span>&nbsp;<span class="ident" id="4998885">keyOk</span>&nbsp;<span class="op" id="4998891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4998895">if</span>&nbsp;<span class="ident" id="4998898">p</span><span class="op" id="4998899">.</span><span class="ident" id="4998900">tok</span>&nbsp;<span class="op" id="4998904">==</span>&nbsp;<span class="ident" id="4998907">token</span><span class="op" id="4998912">.</span><span class="ident" id="4998913">COLON</span>&nbsp;<span class="op" id="4998919">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998924">colon</span>&nbsp;<span class="op" id="4998930">:=</span>&nbsp;<span class="ident" id="4998933">p</span><span class="op" id="4998934">.</span><span class="ident" id="4998935">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998942">p</span><span class="op" id="4998943">.</span><span class="ident" id="4998944">next</span><span class="op" id="4998948">(</span><span class="op" id="4998949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998954">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4999004">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4999055">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4999104">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999128">p</span><span class="op" id="4999129">.</span><span class="ident" id="4999130">tryResolve</span><span class="op" id="4999140">(</span><span class="ident" id="4999141">x</span><span class="op" id="4999142">,</span>&nbsp;<span class="builtintype" id="4999144">false</span><span class="op" id="4999149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999154">return</span>&nbsp;<span class="op" id="4999161">&amp;</span><span class="ident" id="4999162">ast</span><span class="op" id="4999165">.</span><span class="ident" id="4999166">KeyValueExpr</span><span class="op" id="4999178">{</span><span class="ident" id="4999179">Key</span><span class="op" id="4999182">:</span>&nbsp;<span class="ident" id="4999184">x</span><span class="op" id="4999185">,</span>&nbsp;<span class="ident" id="4999187">Colon</span><span class="op" id="4999192">:</span>&nbsp;<span class="ident" id="4999194">colon</span><span class="op" id="4999199">,</span>&nbsp;<span class="ident" id="4999201">Value</span><span class="op" id="4999206">:</span>&nbsp;<span class="ident" id="4999208">p</span><span class="op" id="4999209">.</span><span class="ident" id="4999210">parseElement</span><span class="op" id="4999222">(</span><span class="builtintype" id="4999223">false</span><span class="op" id="4999228">)</span><span class="op" id="4999229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999237">p</span><span class="op" id="4999238">.</span><span class="ident" id="4999239">resolve</span><span class="op" id="4999246">(</span><span class="ident" id="4999247">x</span><span class="op" id="4999248">)</span>&nbsp;<span class="comment" id="4999250">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999268">return</span>&nbsp;<span class="ident" id="4999275">x</span><br>
<span class="lineno"></span><span class="op" id="4999277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="4999280">func</span>&nbsp;<span class="op" id="4999285">(</span><span class="ident" id="4999286">p</span>&nbsp;<span class="op" id="4999288">*</span><span class="ident" id="4999289">parser</span><span class="op" id="4999295">)</span>&nbsp;<span class="ident" id="4999297">parseElementList</span><span class="op" id="4999313">(</span><span class="op" id="4999314">)</span>&nbsp;<span class="op" id="4999316">(</span><span class="ident" id="4999317">list</span>&nbsp;<span class="op" id="4999322">[</span><span class="op" id="4999323">]</span><span class="ident" id="4999324">ast</span><span class="op" id="4999327">.</span><span class="ident" id="4999328">Expr</span><span class="op" id="4999332">)</span>&nbsp;<span class="op" id="4999334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999337">if</span>&nbsp;<span class="ident" id="4999340">p</span><span class="op" id="4999341">.</span><span class="ident" id="4999342">trace</span>&nbsp;<span class="op" id="4999348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999352">defer</span>&nbsp;<span class="ident" id="4999358">un</span><span class="op" id="4999360">(</span><span class="ident" id="4999361">trace</span><span class="op" id="4999366">(</span><span class="ident" id="4999367">p</span><span class="op" id="4999368">,</span>&nbsp;<span class="string" id="4999370">&#34;ElementList&#34;</span><span class="op" id="4999383">)</span><span class="op" id="4999384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999391">for</span>&nbsp;<span class="ident" id="4999395">p</span><span class="op" id="4999396">.</span><span class="ident" id="4999397">tok</span>&nbsp;<span class="op" id="4999401">!=</span>&nbsp;<span class="ident" id="4999404">token</span><span class="op" id="4999409">.</span><span class="ident" id="4999410">RBRACE</span>&nbsp;<span class="op" id="4999417">&amp;&amp;</span>&nbsp;<span class="ident" id="4999420">p</span><span class="op" id="4999421">.</span><span class="ident" id="4999422">tok</span>&nbsp;<span class="op" id="4999426">!=</span>&nbsp;<span class="ident" id="4999429">token</span><span class="op" id="4999434">.</span><span class="ident" id="4999435">EOF</span>&nbsp;<span class="op" id="4999439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999443">list</span>&nbsp;<span class="op" id="4999448">=</span>&nbsp;<span class="builtinfunc" id="4999450">append</span><span class="op" id="4999456">(</span><span class="ident" id="4999457">list</span><span class="op" id="4999461">,</span>&nbsp;<span class="ident" id="4999463">p</span><span class="op" id="4999464">.</span><span class="ident" id="4999465">parseElement</span><span class="op" id="4999477">(</span><span class="builtintype" id="4999478">true</span><span class="op" id="4999482">)</span><span class="op" id="4999483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999487">if</span>&nbsp;<span class="op" id="4999490">!</span><span class="ident" id="4999491">p</span><span class="op" id="4999492">.</span><span class="ident" id="4999493">atComma</span><span class="op" id="4999500">(</span><span class="string" id="4999501">&#34;composite&nbsp;literal&#34;</span><span class="op" id="4999520">)</span>&nbsp;<span class="op" id="4999522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999527">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999535">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999539">p</span><span class="op" id="4999540">.</span><span class="ident" id="4999541">next</span><span class="op" id="4999545">(</span><span class="op" id="4999546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999553">return</span><br>
<span class="lineno"></span><span class="op" id="4999560">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="4999563">func</span>&nbsp;<span class="op" id="4999568">(</span><span class="ident" id="4999569">p</span>&nbsp;<span class="op" id="4999571">*</span><span class="ident" id="4999572">parser</span><span class="op" id="4999578">)</span>&nbsp;<span class="ident" id="4999580">parseLiteralValue</span><span class="op" id="4999597">(</span><span class="ident" id="4999598">typ</span>&nbsp;<span class="ident" id="4999602">ast</span><span class="op" id="4999605">.</span><span class="ident" id="4999606">Expr</span><span class="op" id="4999610">)</span>&nbsp;<span class="ident" id="4999612">ast</span><span class="op" id="4999615">.</span><span class="ident" id="4999616">Expr</span>&nbsp;<span class="op" id="4999621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999624">if</span>&nbsp;<span class="ident" id="4999627">p</span><span class="op" id="4999628">.</span><span class="ident" id="4999629">trace</span>&nbsp;<span class="op" id="4999635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999639">defer</span>&nbsp;<span class="ident" id="4999645">un</span><span class="op" id="4999647">(</span><span class="ident" id="4999648">trace</span><span class="op" id="4999653">(</span><span class="ident" id="4999654">p</span><span class="op" id="4999655">,</span>&nbsp;<span class="string" id="4999657">&#34;LiteralValue&#34;</span><span class="op" id="4999671">)</span><span class="op" id="4999672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999675">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999679">lbrace</span>&nbsp;<span class="op" id="4999686">:=</span>&nbsp;<span class="ident" id="4999689">p</span><span class="op" id="4999690">.</span><span class="ident" id="4999691">expect</span><span class="op" id="4999697">(</span><span class="ident" id="4999698">token</span><span class="op" id="4999703">.</span><span class="ident" id="4999704">LBRACE</span><span class="op" id="4999710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999713">var</span>&nbsp;<span class="ident" id="4999717">elts</span>&nbsp;<span class="op" id="4999722">[</span><span class="op" id="4999723">]</span><span class="ident" id="4999724">ast</span><span class="op" id="4999727">.</span><span class="ident" id="4999728">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999734">p</span><span class="op" id="4999735">.</span><span class="ident" id="4999736">exprLev</span><span class="op" id="4999743">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999747">if</span>&nbsp;<span class="ident" id="4999750">p</span><span class="op" id="4999751">.</span><span class="ident" id="4999752">tok</span>&nbsp;<span class="op" id="4999756">!=</span>&nbsp;<span class="ident" id="4999759">token</span><span class="op" id="4999764">.</span><span class="ident" id="4999765">RBRACE</span>&nbsp;<span class="op" id="4999772">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999776">elts</span>&nbsp;<span class="op" id="4999781">=</span>&nbsp;<span class="ident" id="4999783">p</span><span class="op" id="4999784">.</span><span class="ident" id="4999785">parseElementList</span><span class="op" id="4999801">(</span><span class="op" id="4999802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999808">p</span><span class="op" id="4999809">.</span><span class="ident" id="4999810">exprLev</span><span class="op" id="4999817">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999821">rbrace</span>&nbsp;<span class="op" id="4999828">:=</span>&nbsp;<span class="ident" id="4999831">p</span><span class="op" id="4999832">.</span><span class="ident" id="4999833">expectClosing</span><span class="op" id="4999846">(</span><span class="ident" id="4999847">token</span><span class="op" id="4999852">.</span><span class="ident" id="4999853">RBRACE</span><span class="op" id="4999859">,</span>&nbsp;<span class="string" id="4999861">&#34;composite&nbsp;literal&#34;</span><span class="op" id="4999880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999883">return</span>&nbsp;<span class="op" id="4999890">&amp;</span><span class="ident" id="4999891">ast</span><span class="op" id="4999894">.</span><span class="ident" id="4999895">CompositeLit</span><span class="op" id="4999907">{</span><span class="ident" id="4999908">Type</span><span class="op" id="4999912">:</span>&nbsp;<span class="ident" id="4999914">typ</span><span class="op" id="4999917">,</span>&nbsp;<span class="ident" id="4999919">Lbrace</span><span class="op" id="4999925">:</span>&nbsp;<span class="ident" id="4999927">lbrace</span><span class="op" id="4999933">,</span>&nbsp;<span class="ident" id="4999935">Elts</span><span class="op" id="4999939">:</span>&nbsp;<span class="ident" id="4999941">elts</span><span class="op" id="4999945">,</span>&nbsp;<span class="ident" id="4999947">Rbrace</span><span class="op" id="4999953">:</span>&nbsp;<span class="ident" id="4999955">rbrace</span><span class="op" id="4999961">}</span><br>
<span class="lineno">1335</span><span class="op" id="4999963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4999966">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="5000028">func</span>&nbsp;<span class="op" id="5000033">(</span><span class="ident" id="5000034">p</span>&nbsp;<span class="op" id="5000036">*</span><span class="ident" id="5000037">parser</span><span class="op" id="5000043">)</span>&nbsp;<span class="ident" id="5000045">checkExpr</span><span class="op" id="5000054">(</span><span class="ident" id="5000055">x</span>&nbsp;<span class="ident" id="5000057">ast</span><span class="op" id="5000060">.</span><span class="ident" id="5000061">Expr</span><span class="op" id="5000065">)</span>&nbsp;<span class="ident" id="5000067">ast</span><span class="op" id="5000070">.</span><span class="ident" id="5000071">Expr</span>&nbsp;<span class="op" id="5000076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000079">switch</span>&nbsp;<span class="ident" id="5000086">unparen</span><span class="op" id="5000093">(</span><span class="ident" id="5000094">x</span><span class="op" id="5000095">)</span><span class="op" id="5000096">.</span><span class="op" id="5000097">(</span><span class="keyword" id="5000098">type</span><span class="op" id="5000102">)</span>&nbsp;<span class="op" id="5000104">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000107">case</span>&nbsp;<span class="op" id="5000112">*</span><span class="ident" id="5000113">ast</span><span class="op" id="5000116">.</span><span class="ident" id="5000117">BadExpr</span><span class="op" id="5000124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000127">case</span>&nbsp;<span class="op" id="5000132">*</span><span class="ident" id="5000133">ast</span><span class="op" id="5000136">.</span><span class="ident" id="5000137">Ident</span><span class="op" id="5000142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000145">case</span>&nbsp;<span class="op" id="5000150">*</span><span class="ident" id="5000151">ast</span><span class="op" id="5000154">.</span><span class="ident" id="5000155">BasicLit</span><span class="op" id="5000163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000166">case</span>&nbsp;<span class="op" id="5000171">*</span><span class="ident" id="5000172">ast</span><span class="op" id="5000175">.</span><span class="ident" id="5000176">FuncLit</span><span class="op" id="5000183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000186">case</span>&nbsp;<span class="op" id="5000191">*</span><span class="ident" id="5000192">ast</span><span class="op" id="5000195">.</span><span class="ident" id="5000196">CompositeLit</span><span class="op" id="5000208">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000211">case</span>&nbsp;<span class="op" id="5000216">*</span><span class="ident" id="5000217">ast</span><span class="op" id="5000220">.</span><span class="ident" id="5000221">ParenExpr</span><span class="op" id="5000230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5000234">panic</span><span class="op" id="5000239">(</span><span class="string" id="5000240">&#34;unreachable&#34;</span><span class="op" id="5000253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000256">case</span>&nbsp;<span class="op" id="5000261">*</span><span class="ident" id="5000262">ast</span><span class="op" id="5000265">.</span><span class="ident" id="5000266">SelectorExpr</span><span class="op" id="5000278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000281">case</span>&nbsp;<span class="op" id="5000286">*</span><span class="ident" id="5000287">ast</span><span class="op" id="5000290">.</span><span class="ident" id="5000291">IndexExpr</span><span class="op" id="5000300">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000303">case</span>&nbsp;<span class="op" id="5000308">*</span><span class="ident" id="5000309">ast</span><span class="op" id="5000312">.</span><span class="ident" id="5000313">SliceExpr</span><span class="op" id="5000322">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000325">case</span>&nbsp;<span class="op" id="5000330">*</span><span class="ident" id="5000331">ast</span><span class="op" id="5000334">.</span><span class="ident" id="5000335">TypeAssertExpr</span><span class="op" id="5000349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5000353">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5000412">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5000477">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5000542">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5000607">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000620">case</span>&nbsp;<span class="op" id="5000625">*</span><span class="ident" id="5000626">ast</span><span class="op" id="5000629">.</span><span class="ident" id="5000630">CallExpr</span><span class="op" id="5000638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000641">case</span>&nbsp;<span class="op" id="5000646">*</span><span class="ident" id="5000647">ast</span><span class="op" id="5000650">.</span><span class="ident" id="5000651">StarExpr</span><span class="op" id="5000659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000662">case</span>&nbsp;<span class="op" id="5000667">*</span><span class="ident" id="5000668">ast</span><span class="op" id="5000671">.</span><span class="ident" id="5000672">UnaryExpr</span><span class="op" id="5000681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000684">case</span>&nbsp;<span class="op" id="5000689">*</span><span class="ident" id="5000690">ast</span><span class="op" id="5000693">.</span><span class="ident" id="5000694">BinaryExpr</span><span class="op" id="5000704">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000707">default</span><span class="op" id="5000714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5000718">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000766">p</span><span class="op" id="5000767">.</span><span class="ident" id="5000768">errorExpected</span><span class="op" id="5000781">(</span><span class="ident" id="5000782">x</span><span class="op" id="5000783">.</span><span class="ident" id="5000784">Pos</span><span class="op" id="5000787">(</span><span class="op" id="5000788">)</span><span class="op" id="5000789">,</span>&nbsp;<span class="string" id="5000791">&#34;expression&#34;</span><span class="op" id="5000803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000807">x</span>&nbsp;<span class="op" id="5000809">=</span>&nbsp;<span class="op" id="5000811">&amp;</span><span class="ident" id="5000812">ast</span><span class="op" id="5000815">.</span><span class="ident" id="5000816">BadExpr</span><span class="op" id="5000823">{</span><span class="ident" id="5000824">From</span><span class="op" id="5000828">:</span>&nbsp;<span class="ident" id="5000830">x</span><span class="op" id="5000831">.</span><span class="ident" id="5000832">Pos</span><span class="op" id="5000835">(</span><span class="op" id="5000836">)</span><span class="op" id="5000837">,</span>&nbsp;<span class="ident" id="5000839">To</span><span class="op" id="5000841">:</span>&nbsp;<span class="ident" id="5000843">p</span><span class="op" id="5000844">.</span><span class="ident" id="5000845">safePos</span><span class="op" id="5000852">(</span><span class="ident" id="5000853">x</span><span class="op" id="5000854">.</span><span class="ident" id="5000855">End</span><span class="op" id="5000858">(</span><span class="op" id="5000859">)</span><span class="op" id="5000860">)</span><span class="op" id="5000861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5000864">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000867">return</span>&nbsp;<span class="ident" id="5000874">x</span><br>
<span class="lineno"></span><span class="op" id="5000876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5000879">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="5000939">func</span>&nbsp;<span class="ident" id="5000944">isTypeName</span><span class="op" id="5000954">(</span><span class="ident" id="5000955">x</span>&nbsp;<span class="ident" id="5000957">ast</span><span class="op" id="5000960">.</span><span class="ident" id="5000961">Expr</span><span class="op" id="5000965">)</span>&nbsp;<span class="builtintype" id="5000967">bool</span>&nbsp;<span class="op" id="5000972">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000975">switch</span>&nbsp;<span class="ident" id="5000982">t</span>&nbsp;<span class="op" id="5000984">:=</span>&nbsp;<span class="ident" id="5000987">x</span><span class="op" id="5000988">.</span><span class="op" id="5000989">(</span><span class="keyword" id="5000990">type</span><span class="op" id="5000994">)</span>&nbsp;<span class="op" id="5000996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000999">case</span>&nbsp;<span class="op" id="5001004">*</span><span class="ident" id="5001005">ast</span><span class="op" id="5001008">.</span><span class="ident" id="5001009">BadExpr</span><span class="op" id="5001016">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001019">case</span>&nbsp;<span class="op" id="5001024">*</span><span class="ident" id="5001025">ast</span><span class="op" id="5001028">.</span><span class="ident" id="5001029">Ident</span><span class="op" id="5001034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001037">case</span>&nbsp;<span class="op" id="5001042">*</span><span class="ident" id="5001043">ast</span><span class="op" id="5001046">.</span><span class="ident" id="5001047">SelectorExpr</span><span class="op" id="5001059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001063">_</span><span class="op" id="5001064">,</span>&nbsp;<span class="ident" id="5001066">isIdent</span>&nbsp;<span class="op" id="5001074">:=</span>&nbsp;<span class="ident" id="5001077">t</span><span class="op" id="5001078">.</span><span class="ident" id="5001079">X</span><span class="op" id="5001080">.</span><span class="op" id="5001081">(</span><span class="op" id="5001082">*</span><span class="ident" id="5001083">ast</span><span class="op" id="5001086">.</span><span class="ident" id="5001087">Ident</span><span class="op" id="5001092">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001096">return</span>&nbsp;<span class="ident" id="5001103">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001112">default</span><span class="op" id="5001119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001123">return</span>&nbsp;<span class="builtintype" id="5001130">false</span>&nbsp;<span class="comment" id="5001136">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5001175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001178">return</span>&nbsp;<span class="builtintype" id="5001185">true</span><br>
<span class="lineno">1380</span><span class="op" id="5001190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5001193">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5001264">func</span>&nbsp;<span class="ident" id="5001269">isLiteralType</span><span class="op" id="5001282">(</span><span class="ident" id="5001283">x</span>&nbsp;<span class="ident" id="5001285">ast</span><span class="op" id="5001288">.</span><span class="ident" id="5001289">Expr</span><span class="op" id="5001293">)</span>&nbsp;<span class="builtintype" id="5001295">bool</span>&nbsp;<span class="op" id="5001300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001303">switch</span>&nbsp;<span class="ident" id="5001310">t</span>&nbsp;<span class="op" id="5001312">:=</span>&nbsp;<span class="ident" id="5001315">x</span><span class="op" id="5001316">.</span><span class="op" id="5001317">(</span><span class="keyword" id="5001318">type</span><span class="op" id="5001322">)</span>&nbsp;<span class="op" id="5001324">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001327">case</span>&nbsp;<span class="op" id="5001332">*</span><span class="ident" id="5001333">ast</span><span class="op" id="5001336">.</span><span class="ident" id="5001337">BadExpr</span><span class="op" id="5001344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001347">case</span>&nbsp;<span class="op" id="5001352">*</span><span class="ident" id="5001353">ast</span><span class="op" id="5001356">.</span><span class="ident" id="5001357">Ident</span><span class="op" id="5001362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001365">case</span>&nbsp;<span class="op" id="5001370">*</span><span class="ident" id="5001371">ast</span><span class="op" id="5001374">.</span><span class="ident" id="5001375">SelectorExpr</span><span class="op" id="5001387">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001391">_</span><span class="op" id="5001392">,</span>&nbsp;<span class="ident" id="5001394">isIdent</span>&nbsp;<span class="op" id="5001402">:=</span>&nbsp;<span class="ident" id="5001405">t</span><span class="op" id="5001406">.</span><span class="ident" id="5001407">X</span><span class="op" id="5001408">.</span><span class="op" id="5001409">(</span><span class="op" id="5001410">*</span><span class="ident" id="5001411">ast</span><span class="op" id="5001414">.</span><span class="ident" id="5001415">Ident</span><span class="op" id="5001420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001424">return</span>&nbsp;<span class="ident" id="5001431">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001440">case</span>&nbsp;<span class="op" id="5001445">*</span><span class="ident" id="5001446">ast</span><span class="op" id="5001449">.</span><span class="ident" id="5001450">ArrayType</span><span class="op" id="5001459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001462">case</span>&nbsp;<span class="op" id="5001467">*</span><span class="ident" id="5001468">ast</span><span class="op" id="5001471">.</span><span class="ident" id="5001472">StructType</span><span class="op" id="5001482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001485">case</span>&nbsp;<span class="op" id="5001490">*</span><span class="ident" id="5001491">ast</span><span class="op" id="5001494">.</span><span class="ident" id="5001495">MapType</span><span class="op" id="5001502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001505">default</span><span class="op" id="5001512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001516">return</span>&nbsp;<span class="builtintype" id="5001523">false</span>&nbsp;<span class="comment" id="5001529">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5001587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001590">return</span>&nbsp;<span class="builtintype" id="5001597">true</span><br>
<span class="lineno"></span><span class="op" id="5001602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5001605">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="5001673">func</span>&nbsp;<span class="ident" id="5001678">deref</span><span class="op" id="5001683">(</span><span class="ident" id="5001684">x</span>&nbsp;<span class="ident" id="5001686">ast</span><span class="op" id="5001689">.</span><span class="ident" id="5001690">Expr</span><span class="op" id="5001694">)</span>&nbsp;<span class="ident" id="5001696">ast</span><span class="op" id="5001699">.</span><span class="ident" id="5001700">Expr</span>&nbsp;<span class="op" id="5001705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001708">if</span>&nbsp;<span class="ident" id="5001711">p</span><span class="op" id="5001712">,</span>&nbsp;<span class="ident" id="5001714">isPtr</span>&nbsp;<span class="op" id="5001720">:=</span>&nbsp;<span class="ident" id="5001723">x</span><span class="op" id="5001724">.</span><span class="op" id="5001725">(</span><span class="op" id="5001726">*</span><span class="ident" id="5001727">ast</span><span class="op" id="5001730">.</span><span class="ident" id="5001731">StarExpr</span><span class="op" id="5001739">)</span><span class="op" id="5001740">;</span>&nbsp;<span class="ident" id="5001742">isPtr</span>&nbsp;<span class="op" id="5001748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001752">x</span>&nbsp;<span class="op" id="5001754">=</span>&nbsp;<span class="ident" id="5001756">p</span><span class="op" id="5001757">.</span><span class="ident" id="5001758">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5001761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001764">return</span>&nbsp;<span class="ident" id="5001771">x</span><br>
<span class="lineno">1405</span><span class="op" id="5001773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5001776">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5001856">func</span>&nbsp;<span class="ident" id="5001861">unparen</span><span class="op" id="5001868">(</span><span class="ident" id="5001869">x</span>&nbsp;<span class="ident" id="5001871">ast</span><span class="op" id="5001874">.</span><span class="ident" id="5001875">Expr</span><span class="op" id="5001879">)</span>&nbsp;<span class="ident" id="5001881">ast</span><span class="op" id="5001884">.</span><span class="ident" id="5001885">Expr</span>&nbsp;<span class="op" id="5001890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001893">if</span>&nbsp;<span class="ident" id="5001896">p</span><span class="op" id="5001897">,</span>&nbsp;<span class="ident" id="5001899">isParen</span>&nbsp;<span class="op" id="5001907">:=</span>&nbsp;<span class="ident" id="5001910">x</span><span class="op" id="5001911">.</span><span class="op" id="5001912">(</span><span class="op" id="5001913">*</span><span class="ident" id="5001914">ast</span><span class="op" id="5001917">.</span><span class="ident" id="5001918">ParenExpr</span><span class="op" id="5001927">)</span><span class="op" id="5001928">;</span>&nbsp;<span class="ident" id="5001930">isParen</span>&nbsp;<span class="op" id="5001938">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5001942">x</span>&nbsp;<span class="op" id="5001944">=</span>&nbsp;<span class="ident" id="5001946">unparen</span><span class="op" id="5001953">(</span><span class="ident" id="5001954">p</span><span class="op" id="5001955">.</span><span class="ident" id="5001956">X</span><span class="op" id="5001957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5001960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5001963">return</span>&nbsp;<span class="ident" id="5001970">x</span><br>
<span class="lineno"></span><span class="op" id="5001972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="5001975">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5002035">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="5002075">//</span><br>
<span class="lineno"></span><span class="keyword" id="5002078">func</span>&nbsp;<span class="op" id="5002083">(</span><span class="ident" id="5002084">p</span>&nbsp;<span class="op" id="5002086">*</span><span class="ident" id="5002087">parser</span><span class="op" id="5002093">)</span>&nbsp;<span class="ident" id="5002095">checkExprOrType</span><span class="op" id="5002110">(</span><span class="ident" id="5002111">x</span>&nbsp;<span class="ident" id="5002113">ast</span><span class="op" id="5002116">.</span><span class="ident" id="5002117">Expr</span><span class="op" id="5002121">)</span>&nbsp;<span class="ident" id="5002123">ast</span><span class="op" id="5002126">.</span><span class="ident" id="5002127">Expr</span>&nbsp;<span class="op" id="5002132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002135">switch</span>&nbsp;<span class="ident" id="5002142">t</span>&nbsp;<span class="op" id="5002144">:=</span>&nbsp;<span class="ident" id="5002147">unparen</span><span class="op" id="5002154">(</span><span class="ident" id="5002155">x</span><span class="op" id="5002156">)</span><span class="op" id="5002157">.</span><span class="op" id="5002158">(</span><span class="keyword" id="5002159">type</span><span class="op" id="5002163">)</span>&nbsp;<span class="op" id="5002165">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002168">case</span>&nbsp;<span class="op" id="5002173">*</span><span class="ident" id="5002174">ast</span><span class="op" id="5002177">.</span><span class="ident" id="5002178">ParenExpr</span><span class="op" id="5002187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5002191">panic</span><span class="op" id="5002196">(</span><span class="string" id="5002197">&#34;unreachable&#34;</span><span class="op" id="5002210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002213">case</span>&nbsp;<span class="op" id="5002218">*</span><span class="ident" id="5002219">ast</span><span class="op" id="5002222">.</span><span class="ident" id="5002223">UnaryExpr</span><span class="op" id="5002232">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002235">case</span>&nbsp;<span class="op" id="5002240">*</span><span class="ident" id="5002241">ast</span><span class="op" id="5002244">.</span><span class="ident" id="5002245">ArrayType</span><span class="op" id="5002254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002258">if</span>&nbsp;<span class="builtinfunc" id="5002261">len</span><span class="op" id="5002264">,</span>&nbsp;<span class="ident" id="5002266">isEllipsis</span>&nbsp;<span class="op" id="5002277">:=</span>&nbsp;<span class="ident" id="5002280">t</span><span class="op" id="5002281">.</span><span class="ident" id="5002282">Len</span><span class="op" id="5002285">.</span><span class="op" id="5002286">(</span><span class="op" id="5002287">*</span><span class="ident" id="5002288">ast</span><span class="op" id="5002291">.</span><span class="ident" id="5002292">Ellipsis</span><span class="op" id="5002300">)</span><span class="op" id="5002301">;</span>&nbsp;<span class="ident" id="5002303">isEllipsis</span>&nbsp;<span class="op" id="5002314">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002319">p</span><span class="op" id="5002320">.</span><span class="builtintype" id="5002321">error</span><span class="op" id="5002326">(</span><span class="builtinfunc" id="5002327">len</span><span class="op" id="5002330">.</span><span class="ident" id="5002331">Pos</span><span class="op" id="5002334">(</span><span class="op" id="5002335">)</span><span class="op" id="5002336">,</span>&nbsp;<span class="string" id="5002338">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="5002374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002379">x</span>&nbsp;<span class="op" id="5002381">=</span>&nbsp;<span class="op" id="5002383">&amp;</span><span class="ident" id="5002384">ast</span><span class="op" id="5002387">.</span><span class="ident" id="5002388">BadExpr</span><span class="op" id="5002395">{</span><span class="ident" id="5002396">From</span><span class="op" id="5002400">:</span>&nbsp;<span class="ident" id="5002402">x</span><span class="op" id="5002403">.</span><span class="ident" id="5002404">Pos</span><span class="op" id="5002407">(</span><span class="op" id="5002408">)</span><span class="op" id="5002409">,</span>&nbsp;<span class="ident" id="5002411">To</span><span class="op" id="5002413">:</span>&nbsp;<span class="ident" id="5002415">p</span><span class="op" id="5002416">.</span><span class="ident" id="5002417">safePos</span><span class="op" id="5002424">(</span><span class="ident" id="5002425">x</span><span class="op" id="5002426">.</span><span class="ident" id="5002427">End</span><span class="op" id="5002430">(</span><span class="op" id="5002431">)</span><span class="op" id="5002432">)</span><span class="op" id="5002433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5002437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5002440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5002444">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002489">return</span>&nbsp;<span class="ident" id="5002496">x</span><br>
<span class="lineno"></span><span class="op" id="5002498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5002501">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="5002571">func</span>&nbsp;<span class="op" id="5002576">(</span><span class="ident" id="5002577">p</span>&nbsp;<span class="op" id="5002579">*</span><span class="ident" id="5002580">parser</span><span class="op" id="5002586">)</span>&nbsp;<span class="ident" id="5002588">parsePrimaryExpr</span><span class="op" id="5002604">(</span><span class="ident" id="5002605">lhs</span>&nbsp;<span class="builtintype" id="5002609">bool</span><span class="op" id="5002613">)</span>&nbsp;<span class="ident" id="5002615">ast</span><span class="op" id="5002618">.</span><span class="ident" id="5002619">Expr</span>&nbsp;<span class="op" id="5002624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002627">if</span>&nbsp;<span class="ident" id="5002630">p</span><span class="op" id="5002631">.</span><span class="ident" id="5002632">trace</span>&nbsp;<span class="op" id="5002638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002642">defer</span>&nbsp;<span class="ident" id="5002648">un</span><span class="op" id="5002650">(</span><span class="ident" id="5002651">trace</span><span class="op" id="5002656">(</span><span class="ident" id="5002657">p</span><span class="op" id="5002658">,</span>&nbsp;<span class="string" id="5002660">&#34;PrimaryExpr&#34;</span><span class="op" id="5002673">)</span><span class="op" id="5002674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5002677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002681">x</span>&nbsp;<span class="op" id="5002683">:=</span>&nbsp;<span class="ident" id="5002686">p</span><span class="op" id="5002687">.</span><span class="ident" id="5002688">parseOperand</span><span class="op" id="5002700">(</span><span class="ident" id="5002701">lhs</span><span class="op" id="5002704">)</span><br>
<span class="lineno"></span><span class="ident" id="5002706">L</span><span class="op" id="5002707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002710">for</span>&nbsp;<span class="op" id="5002714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002718">switch</span>&nbsp;<span class="ident" id="5002725">p</span><span class="op" id="5002726">.</span><span class="ident" id="5002727">tok</span>&nbsp;<span class="op" id="5002731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002735">case</span>&nbsp;<span class="ident" id="5002740">token</span><span class="op" id="5002745">.</span><span class="ident" id="5002746">PERIOD</span><span class="op" id="5002752">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002757">p</span><span class="op" id="5002758">.</span><span class="ident" id="5002759">next</span><span class="op" id="5002763">(</span><span class="op" id="5002764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002769">if</span>&nbsp;<span class="ident" id="5002772">lhs</span>&nbsp;<span class="op" id="5002776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002782">p</span><span class="op" id="5002783">.</span><span class="ident" id="5002784">resolve</span><span class="op" id="5002791">(</span><span class="ident" id="5002792">x</span><span class="op" id="5002793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5002798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002803">switch</span>&nbsp;<span class="ident" id="5002810">p</span><span class="op" id="5002811">.</span><span class="ident" id="5002812">tok</span>&nbsp;<span class="op" id="5002816">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002821">case</span>&nbsp;<span class="ident" id="5002826">token</span><span class="op" id="5002831">.</span><span class="ident" id="5002832">IDENT</span><span class="op" id="5002837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002843">x</span>&nbsp;<span class="op" id="5002845">=</span>&nbsp;<span class="ident" id="5002847">p</span><span class="op" id="5002848">.</span><span class="ident" id="5002849">parseSelector</span><span class="op" id="5002862">(</span><span class="ident" id="5002863">p</span><span class="op" id="5002864">.</span><span class="ident" id="5002865">checkExprOrType</span><span class="op" id="5002880">(</span><span class="ident" id="5002881">x</span><span class="op" id="5002882">)</span><span class="op" id="5002883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002888">case</span>&nbsp;<span class="ident" id="5002893">token</span><span class="op" id="5002898">.</span><span class="ident" id="5002899">LPAREN</span><span class="op" id="5002905">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002911">x</span>&nbsp;<span class="op" id="5002913">=</span>&nbsp;<span class="ident" id="5002915">p</span><span class="op" id="5002916">.</span><span class="ident" id="5002917">parseTypeAssertion</span><span class="op" id="5002935">(</span><span class="ident" id="5002936">p</span><span class="op" id="5002937">.</span><span class="ident" id="5002938">checkExpr</span><span class="op" id="5002947">(</span><span class="ident" id="5002948">x</span><span class="op" id="5002949">)</span><span class="op" id="5002950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5002955">default</span><span class="op" id="5002962">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002968">pos</span>&nbsp;<span class="op" id="5002972">:=</span>&nbsp;<span class="ident" id="5002975">p</span><span class="op" id="5002976">.</span><span class="ident" id="5002977">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5002985">p</span><span class="op" id="5002986">.</span><span class="ident" id="5002987">errorExpected</span><span class="op" id="5003000">(</span><span class="ident" id="5003001">pos</span><span class="op" id="5003004">,</span>&nbsp;<span class="string" id="5003006">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="5003034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003040">p</span><span class="op" id="5003041">.</span><span class="ident" id="5003042">next</span><span class="op" id="5003046">(</span><span class="op" id="5003047">)</span>&nbsp;<span class="comment" id="5003049">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003070">x</span>&nbsp;<span class="op" id="5003072">=</span>&nbsp;<span class="op" id="5003074">&amp;</span><span class="ident" id="5003075">ast</span><span class="op" id="5003078">.</span><span class="ident" id="5003079">BadExpr</span><span class="op" id="5003086">{</span><span class="ident" id="5003087">From</span><span class="op" id="5003091">:</span>&nbsp;<span class="ident" id="5003093">pos</span><span class="op" id="5003096">,</span>&nbsp;<span class="ident" id="5003098">To</span><span class="op" id="5003100">:</span>&nbsp;<span class="ident" id="5003102">p</span><span class="op" id="5003103">.</span><span class="ident" id="5003104">pos</span><span class="op" id="5003107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003112">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003116">case</span>&nbsp;<span class="ident" id="5003121">token</span><span class="op" id="5003126">.</span><span class="ident" id="5003127">LBRACK</span><span class="op" id="5003133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003138">if</span>&nbsp;<span class="ident" id="5003141">lhs</span>&nbsp;<span class="op" id="5003145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003151">p</span><span class="op" id="5003152">.</span><span class="ident" id="5003153">resolve</span><span class="op" id="5003160">(</span><span class="ident" id="5003161">x</span><span class="op" id="5003162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003172">x</span>&nbsp;<span class="op" id="5003174">=</span>&nbsp;<span class="ident" id="5003176">p</span><span class="op" id="5003177">.</span><span class="ident" id="5003178">parseIndexOrSlice</span><span class="op" id="5003195">(</span><span class="ident" id="5003196">p</span><span class="op" id="5003197">.</span><span class="ident" id="5003198">checkExpr</span><span class="op" id="5003207">(</span><span class="ident" id="5003208">x</span><span class="op" id="5003209">)</span><span class="op" id="5003210">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003214">case</span>&nbsp;<span class="ident" id="5003219">token</span><span class="op" id="5003224">.</span><span class="ident" id="5003225">LPAREN</span><span class="op" id="5003231">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003236">if</span>&nbsp;<span class="ident" id="5003239">lhs</span>&nbsp;<span class="op" id="5003243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003249">p</span><span class="op" id="5003250">.</span><span class="ident" id="5003251">resolve</span><span class="op" id="5003258">(</span><span class="ident" id="5003259">x</span><span class="op" id="5003260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003270">x</span>&nbsp;<span class="op" id="5003272">=</span>&nbsp;<span class="ident" id="5003274">p</span><span class="op" id="5003275">.</span><span class="ident" id="5003276">parseCallOrConversion</span><span class="op" id="5003297">(</span><span class="ident" id="5003298">p</span><span class="op" id="5003299">.</span><span class="ident" id="5003300">checkExprOrType</span><span class="op" id="5003315">(</span><span class="ident" id="5003316">x</span><span class="op" id="5003317">)</span><span class="op" id="5003318">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003322">case</span>&nbsp;<span class="ident" id="5003327">token</span><span class="op" id="5003332">.</span><span class="ident" id="5003333">LBRACE</span><span class="op" id="5003339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003344">if</span>&nbsp;<span class="ident" id="5003347">isLiteralType</span><span class="op" id="5003360">(</span><span class="ident" id="5003361">x</span><span class="op" id="5003362">)</span>&nbsp;<span class="op" id="5003364">&amp;&amp;</span>&nbsp;<span class="op" id="5003367">(</span><span class="ident" id="5003368">p</span><span class="op" id="5003369">.</span><span class="ident" id="5003370">exprLev</span>&nbsp;<span class="op" id="5003378">&gt;=</span>&nbsp;<span class="num" id="5003381">0</span>&nbsp;<span class="op" id="5003383">||</span>&nbsp;<span class="op" id="5003386">!</span><span class="ident" id="5003387">isTypeName</span><span class="op" id="5003397">(</span><span class="ident" id="5003398">x</span><span class="op" id="5003399">)</span><span class="op" id="5003400">)</span>&nbsp;<span class="op" id="5003402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003408">if</span>&nbsp;<span class="ident" id="5003411">lhs</span>&nbsp;<span class="op" id="5003415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003422">p</span><span class="op" id="5003423">.</span><span class="ident" id="5003424">resolve</span><span class="op" id="5003431">(</span><span class="ident" id="5003432">x</span><span class="op" id="5003433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003439">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003445">x</span>&nbsp;<span class="op" id="5003447">=</span>&nbsp;<span class="ident" id="5003449">p</span><span class="op" id="5003450">.</span><span class="ident" id="5003451">parseLiteralValue</span><span class="op" id="5003468">(</span><span class="ident" id="5003469">x</span><span class="op" id="5003470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003475">}</span>&nbsp;<span class="keyword" id="5003477">else</span>&nbsp;<span class="op" id="5003482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003488">break</span>&nbsp;<span class="ident" id="5003494">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003503">default</span><span class="op" id="5003510">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003515">break</span>&nbsp;<span class="ident" id="5003521">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003529">lhs</span>&nbsp;<span class="op" id="5003533">=</span>&nbsp;<span class="builtintype" id="5003535">false</span>&nbsp;<span class="comment" id="5003541">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003581">return</span>&nbsp;<span class="ident" id="5003588">x</span><br>
<span class="lineno"></span><span class="op" id="5003590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5003593">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5003663">func</span>&nbsp;<span class="op" id="5003668">(</span><span class="ident" id="5003669">p</span>&nbsp;<span class="op" id="5003671">*</span><span class="ident" id="5003672">parser</span><span class="op" id="5003678">)</span>&nbsp;<span class="ident" id="5003680">parseUnaryExpr</span><span class="op" id="5003694">(</span><span class="ident" id="5003695">lhs</span>&nbsp;<span class="builtintype" id="5003699">bool</span><span class="op" id="5003703">)</span>&nbsp;<span class="ident" id="5003705">ast</span><span class="op" id="5003708">.</span><span class="ident" id="5003709">Expr</span>&nbsp;<span class="op" id="5003714">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003717">if</span>&nbsp;<span class="ident" id="5003720">p</span><span class="op" id="5003721">.</span><span class="ident" id="5003722">trace</span>&nbsp;<span class="op" id="5003728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003732">defer</span>&nbsp;<span class="ident" id="5003738">un</span><span class="op" id="5003740">(</span><span class="ident" id="5003741">trace</span><span class="op" id="5003746">(</span><span class="ident" id="5003747">p</span><span class="op" id="5003748">,</span>&nbsp;<span class="string" id="5003750">&#34;UnaryExpr&#34;</span><span class="op" id="5003761">)</span><span class="op" id="5003762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5003765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003769">switch</span>&nbsp;<span class="ident" id="5003776">p</span><span class="op" id="5003777">.</span><span class="ident" id="5003778">tok</span>&nbsp;<span class="op" id="5003782">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003785">case</span>&nbsp;<span class="ident" id="5003790">token</span><span class="op" id="5003795">.</span><span class="ident" id="5003796">ADD</span><span class="op" id="5003799">,</span>&nbsp;<span class="ident" id="5003801">token</span><span class="op" id="5003806">.</span><span class="ident" id="5003807">SUB</span><span class="op" id="5003810">,</span>&nbsp;<span class="ident" id="5003812">token</span><span class="op" id="5003817">.</span><span class="ident" id="5003818">NOT</span><span class="op" id="5003821">,</span>&nbsp;<span class="ident" id="5003823">token</span><span class="op" id="5003828">.</span><span class="ident" id="5003829">XOR</span><span class="op" id="5003832">,</span>&nbsp;<span class="ident" id="5003834">token</span><span class="op" id="5003839">.</span><span class="ident" id="5003840">AND</span><span class="op" id="5003843">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003847">pos</span><span class="op" id="5003850">,</span>&nbsp;<span class="ident" id="5003852">op</span>&nbsp;<span class="op" id="5003855">:=</span>&nbsp;<span class="ident" id="5003858">p</span><span class="op" id="5003859">.</span><span class="ident" id="5003860">pos</span><span class="op" id="5003863">,</span>&nbsp;<span class="ident" id="5003865">p</span><span class="op" id="5003866">.</span><span class="ident" id="5003867">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003873">p</span><span class="op" id="5003874">.</span><span class="ident" id="5003875">next</span><span class="op" id="5003879">(</span><span class="op" id="5003880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5003884">x</span>&nbsp;<span class="op" id="5003886">:=</span>&nbsp;<span class="ident" id="5003889">p</span><span class="op" id="5003890">.</span><span class="ident" id="5003891">parseUnaryExpr</span><span class="op" id="5003905">(</span><span class="builtintype" id="5003906">false</span><span class="op" id="5003911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003915">return</span>&nbsp;<span class="op" id="5003922">&amp;</span><span class="ident" id="5003923">ast</span><span class="op" id="5003926">.</span><span class="ident" id="5003927">UnaryExpr</span><span class="op" id="5003936">{</span><span class="ident" id="5003937">OpPos</span><span class="op" id="5003942">:</span>&nbsp;<span class="ident" id="5003944">pos</span><span class="op" id="5003947">,</span>&nbsp;<span class="ident" id="5003949">Op</span><span class="op" id="5003951">:</span>&nbsp;<span class="ident" id="5003953">op</span><span class="op" id="5003955">,</span>&nbsp;<span class="ident" id="5003957">X</span><span class="op" id="5003958">:</span>&nbsp;<span class="ident" id="5003960">p</span><span class="op" id="5003961">.</span><span class="ident" id="5003962">checkExpr</span><span class="op" id="5003971">(</span><span class="ident" id="5003972">x</span><span class="op" id="5003973">)</span><span class="op" id="5003974">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5003978">case</span>&nbsp;<span class="ident" id="5003983">token</span><span class="op" id="5003988">.</span><span class="ident" id="5003989">ARROW</span><span class="op" id="5003994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5003998">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004038">arrow</span>&nbsp;<span class="op" id="5004044">:=</span>&nbsp;<span class="ident" id="5004047">p</span><span class="op" id="5004048">.</span><span class="ident" id="5004049">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004055">p</span><span class="op" id="5004056">.</span><span class="ident" id="5004057">next</span><span class="op" id="5004061">(</span><span class="op" id="5004062">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004067">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004130">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004191">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004254">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004274">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004279">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004328">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004388">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004393">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004454">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004492">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004497">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004540">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004588">x</span>&nbsp;<span class="op" id="5004590">:=</span>&nbsp;<span class="ident" id="5004593">p</span><span class="op" id="5004594">.</span><span class="ident" id="5004595">parseUnaryExpr</span><span class="op" id="5004609">(</span><span class="builtintype" id="5004610">false</span><span class="op" id="5004615">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004620">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5004654">if</span>&nbsp;<span class="ident" id="5004657">typ</span><span class="op" id="5004660">,</span>&nbsp;<span class="ident" id="5004662">ok</span>&nbsp;<span class="op" id="5004665">:=</span>&nbsp;<span class="ident" id="5004668">x</span><span class="op" id="5004669">.</span><span class="op" id="5004670">(</span><span class="op" id="5004671">*</span><span class="ident" id="5004672">ast</span><span class="op" id="5004675">.</span><span class="ident" id="5004676">ChanType</span><span class="op" id="5004684">)</span><span class="op" id="5004685">;</span>&nbsp;<span class="ident" id="5004687">ok</span>&nbsp;<span class="op" id="5004690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004695">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004711">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004751">dir</span>&nbsp;<span class="op" id="5004755">:=</span>&nbsp;<span class="ident" id="5004758">ast</span><span class="op" id="5004761">.</span><span class="ident" id="5004762">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5004770">for</span>&nbsp;<span class="ident" id="5004774">ok</span>&nbsp;<span class="op" id="5004777">&amp;&amp;</span>&nbsp;<span class="ident" id="5004780">dir</span>&nbsp;<span class="op" id="5004784">==</span>&nbsp;<span class="ident" id="5004787">ast</span><span class="op" id="5004790">.</span><span class="ident" id="5004791">SEND</span>&nbsp;<span class="op" id="5004796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5004802">if</span>&nbsp;<span class="ident" id="5004805">typ</span><span class="op" id="5004808">.</span><span class="ident" id="5004809">Dir</span>&nbsp;<span class="op" id="5004813">==</span>&nbsp;<span class="ident" id="5004816">ast</span><span class="op" id="5004819">.</span><span class="ident" id="5004820">RECV</span>&nbsp;<span class="op" id="5004825">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5004832">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004874">p</span><span class="op" id="5004875">.</span><span class="ident" id="5004876">errorExpected</span><span class="op" id="5004889">(</span><span class="ident" id="5004890">typ</span><span class="op" id="5004893">.</span><span class="ident" id="5004894">Arrow</span><span class="op" id="5004899">,</span>&nbsp;<span class="string" id="5004901">&#34;&#39;chan&#39;&#34;</span><span class="op" id="5004909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5004915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004921">arrow</span><span class="op" id="5004926">,</span>&nbsp;<span class="ident" id="5004928">typ</span><span class="op" id="5004931">.</span><span class="ident" id="5004932">Begin</span><span class="op" id="5004937">,</span>&nbsp;<span class="ident" id="5004939">typ</span><span class="op" id="5004942">.</span><span class="ident" id="5004943">Arrow</span>&nbsp;<span class="op" id="5004949">=</span>&nbsp;<span class="ident" id="5004951">typ</span><span class="op" id="5004954">.</span><span class="ident" id="5004955">Arrow</span><span class="op" id="5004960">,</span>&nbsp;<span class="ident" id="5004962">arrow</span><span class="op" id="5004967">,</span>&nbsp;<span class="ident" id="5004969">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5004979">dir</span><span class="op" id="5004982">,</span>&nbsp;<span class="ident" id="5004984">typ</span><span class="op" id="5004987">.</span><span class="ident" id="5004988">Dir</span>&nbsp;<span class="op" id="5004992">=</span>&nbsp;<span class="ident" id="5004994">typ</span><span class="op" id="5004997">.</span><span class="ident" id="5004998">Dir</span><span class="op" id="5005001">,</span>&nbsp;<span class="ident" id="5005003">ast</span><span class="op" id="5005006">.</span><span class="ident" id="5005007">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005016">typ</span><span class="op" id="5005019">,</span>&nbsp;<span class="ident" id="5005021">ok</span>&nbsp;<span class="op" id="5005024">=</span>&nbsp;<span class="ident" id="5005026">typ</span><span class="op" id="5005029">.</span><span class="ident" id="5005030">Value</span><span class="op" id="5005035">.</span><span class="op" id="5005036">(</span><span class="op" id="5005037">*</span><span class="ident" id="5005038">ast</span><span class="op" id="5005041">.</span><span class="ident" id="5005042">ChanType</span><span class="op" id="5005050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5005055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005060">if</span>&nbsp;<span class="ident" id="5005063">dir</span>&nbsp;<span class="op" id="5005067">==</span>&nbsp;<span class="ident" id="5005070">ast</span><span class="op" id="5005073">.</span><span class="ident" id="5005074">SEND</span>&nbsp;<span class="op" id="5005079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005085">p</span><span class="op" id="5005086">.</span><span class="ident" id="5005087">errorExpected</span><span class="op" id="5005100">(</span><span class="ident" id="5005101">arrow</span><span class="op" id="5005106">,</span>&nbsp;<span class="string" id="5005108">&#34;channel&nbsp;type&#34;</span><span class="op" id="5005122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5005127">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005133">return</span>&nbsp;<span class="ident" id="5005140">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5005144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5005149">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005163">return</span>&nbsp;<span class="op" id="5005170">&amp;</span><span class="ident" id="5005171">ast</span><span class="op" id="5005174">.</span><span class="ident" id="5005175">UnaryExpr</span><span class="op" id="5005184">{</span><span class="ident" id="5005185">OpPos</span><span class="op" id="5005190">:</span>&nbsp;<span class="ident" id="5005192">arrow</span><span class="op" id="5005197">,</span>&nbsp;<span class="ident" id="5005199">Op</span><span class="op" id="5005201">:</span>&nbsp;<span class="ident" id="5005203">token</span><span class="op" id="5005208">.</span><span class="ident" id="5005209">ARROW</span><span class="op" id="5005214">,</span>&nbsp;<span class="ident" id="5005216">X</span><span class="op" id="5005217">:</span>&nbsp;<span class="ident" id="5005219">p</span><span class="op" id="5005220">.</span><span class="ident" id="5005221">checkExpr</span><span class="op" id="5005230">(</span><span class="ident" id="5005231">x</span><span class="op" id="5005232">)</span><span class="op" id="5005233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005237">case</span>&nbsp;<span class="ident" id="5005242">token</span><span class="op" id="5005247">.</span><span class="ident" id="5005248">MUL</span><span class="op" id="5005251">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5005255">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005297">pos</span>&nbsp;<span class="op" id="5005301">:=</span>&nbsp;<span class="ident" id="5005304">p</span><span class="op" id="5005305">.</span><span class="ident" id="5005306">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005312">p</span><span class="op" id="5005313">.</span><span class="ident" id="5005314">next</span><span class="op" id="5005318">(</span><span class="op" id="5005319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005323">x</span>&nbsp;<span class="op" id="5005325">:=</span>&nbsp;<span class="ident" id="5005328">p</span><span class="op" id="5005329">.</span><span class="ident" id="5005330">parseUnaryExpr</span><span class="op" id="5005344">(</span><span class="builtintype" id="5005345">false</span><span class="op" id="5005350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005354">return</span>&nbsp;<span class="op" id="5005361">&amp;</span><span class="ident" id="5005362">ast</span><span class="op" id="5005365">.</span><span class="ident" id="5005366">StarExpr</span><span class="op" id="5005374">{</span><span class="ident" id="5005375">Star</span><span class="op" id="5005379">:</span>&nbsp;<span class="ident" id="5005381">pos</span><span class="op" id="5005384">,</span>&nbsp;<span class="ident" id="5005386">X</span><span class="op" id="5005387">:</span>&nbsp;<span class="ident" id="5005389">p</span><span class="op" id="5005390">.</span><span class="ident" id="5005391">checkExprOrType</span><span class="op" id="5005406">(</span><span class="ident" id="5005407">x</span><span class="op" id="5005408">)</span><span class="op" id="5005409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5005412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005416">return</span>&nbsp;<span class="ident" id="5005423">p</span><span class="op" id="5005424">.</span><span class="ident" id="5005425">parsePrimaryExpr</span><span class="op" id="5005441">(</span><span class="ident" id="5005442">lhs</span><span class="op" id="5005445">)</span><br>
<span class="lineno"></span><span class="op" id="5005447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5005450">func</span>&nbsp;<span class="op" id="5005455">(</span><span class="ident" id="5005456">p</span>&nbsp;<span class="op" id="5005458">*</span><span class="ident" id="5005459">parser</span><span class="op" id="5005465">)</span>&nbsp;<span class="ident" id="5005467">tokPrec</span><span class="op" id="5005474">(</span><span class="op" id="5005475">)</span>&nbsp;<span class="op" id="5005477">(</span><span class="ident" id="5005478">token</span><span class="op" id="5005483">.</span><span class="ident" id="5005484">Token</span><span class="op" id="5005489">,</span>&nbsp;<span class="builtintype" id="5005491">int</span><span class="op" id="5005494">)</span>&nbsp;<span class="op" id="5005496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005499">tok</span>&nbsp;<span class="op" id="5005503">:=</span>&nbsp;<span class="ident" id="5005506">p</span><span class="op" id="5005507">.</span><span class="ident" id="5005508">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005513">if</span>&nbsp;<span class="ident" id="5005516">p</span><span class="op" id="5005517">.</span><span class="ident" id="5005518">inRhs</span>&nbsp;<span class="op" id="5005524">&amp;&amp;</span>&nbsp;<span class="ident" id="5005527">tok</span>&nbsp;<span class="op" id="5005531">==</span>&nbsp;<span class="ident" id="5005534">token</span><span class="op" id="5005539">.</span><span class="ident" id="5005540">ASSIGN</span>&nbsp;<span class="op" id="5005547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005551">tok</span>&nbsp;<span class="op" id="5005555">=</span>&nbsp;<span class="ident" id="5005557">token</span><span class="op" id="5005562">.</span><span class="ident" id="5005563">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5005568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005571">return</span>&nbsp;<span class="ident" id="5005578">tok</span><span class="op" id="5005581">,</span>&nbsp;<span class="ident" id="5005583">tok</span><span class="op" id="5005586">.</span><span class="ident" id="5005587">Precedence</span><span class="op" id="5005597">(</span><span class="op" id="5005598">)</span><br>
<span class="lineno"></span><span class="op" id="5005600">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="5005603">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5005673">func</span>&nbsp;<span class="op" id="5005678">(</span><span class="ident" id="5005679">p</span>&nbsp;<span class="op" id="5005681">*</span><span class="ident" id="5005682">parser</span><span class="op" id="5005688">)</span>&nbsp;<span class="ident" id="5005690">parseBinaryExpr</span><span class="op" id="5005705">(</span><span class="ident" id="5005706">lhs</span>&nbsp;<span class="builtintype" id="5005710">bool</span><span class="op" id="5005714">,</span>&nbsp;<span class="ident" id="5005716">prec1</span>&nbsp;<span class="builtintype" id="5005722">int</span><span class="op" id="5005725">)</span>&nbsp;<span class="ident" id="5005727">ast</span><span class="op" id="5005730">.</span><span class="ident" id="5005731">Expr</span>&nbsp;<span class="op" id="5005736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005739">if</span>&nbsp;<span class="ident" id="5005742">p</span><span class="op" id="5005743">.</span><span class="ident" id="5005744">trace</span>&nbsp;<span class="op" id="5005750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005754">defer</span>&nbsp;<span class="ident" id="5005760">un</span><span class="op" id="5005762">(</span><span class="ident" id="5005763">trace</span><span class="op" id="5005768">(</span><span class="ident" id="5005769">p</span><span class="op" id="5005770">,</span>&nbsp;<span class="string" id="5005772">&#34;BinaryExpr&#34;</span><span class="op" id="5005784">)</span><span class="op" id="5005785">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5005788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005792">x</span>&nbsp;<span class="op" id="5005794">:=</span>&nbsp;<span class="ident" id="5005797">p</span><span class="op" id="5005798">.</span><span class="ident" id="5005799">parseUnaryExpr</span><span class="op" id="5005813">(</span><span class="ident" id="5005814">lhs</span><span class="op" id="5005817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005820">for</span>&nbsp;<span class="ident" id="5005824">_</span><span class="op" id="5005825">,</span>&nbsp;<span class="ident" id="5005827">prec</span>&nbsp;<span class="op" id="5005832">:=</span>&nbsp;<span class="ident" id="5005835">p</span><span class="op" id="5005836">.</span><span class="ident" id="5005837">tokPrec</span><span class="op" id="5005844">(</span><span class="op" id="5005845">)</span><span class="op" id="5005846">;</span>&nbsp;<span class="ident" id="5005848">prec</span>&nbsp;<span class="op" id="5005853">&gt;=</span>&nbsp;<span class="ident" id="5005856">prec1</span><span class="op" id="5005861">;</span>&nbsp;<span class="ident" id="5005863">prec</span><span class="op" id="5005867">--</span>&nbsp;<span class="op" id="5005870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005874">for</span>&nbsp;<span class="op" id="5005878">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005883">op</span><span class="op" id="5005885">,</span>&nbsp;<span class="ident" id="5005887">oprec</span>&nbsp;<span class="op" id="5005893">:=</span>&nbsp;<span class="ident" id="5005896">p</span><span class="op" id="5005897">.</span><span class="ident" id="5005898">tokPrec</span><span class="op" id="5005905">(</span><span class="op" id="5005906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005911">if</span>&nbsp;<span class="ident" id="5005914">oprec</span>&nbsp;<span class="op" id="5005920">!=</span>&nbsp;<span class="ident" id="5005923">prec</span>&nbsp;<span class="op" id="5005928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005934">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5005943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005948">pos</span>&nbsp;<span class="op" id="5005952">:=</span>&nbsp;<span class="ident" id="5005955">p</span><span class="op" id="5005956">.</span><span class="ident" id="5005957">expect</span><span class="op" id="5005963">(</span><span class="ident" id="5005964">op</span><span class="op" id="5005966">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5005971">if</span>&nbsp;<span class="ident" id="5005974">lhs</span>&nbsp;<span class="op" id="5005978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5005984">p</span><span class="op" id="5005985">.</span><span class="ident" id="5005986">resolve</span><span class="op" id="5005993">(</span><span class="ident" id="5005994">x</span><span class="op" id="5005995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006001">lhs</span>&nbsp;<span class="op" id="5006005">=</span>&nbsp;<span class="builtintype" id="5006007">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5006016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006021">y</span>&nbsp;<span class="op" id="5006023">:=</span>&nbsp;<span class="ident" id="5006026">p</span><span class="op" id="5006027">.</span><span class="ident" id="5006028">parseBinaryExpr</span><span class="op" id="5006043">(</span><span class="builtintype" id="5006044">false</span><span class="op" id="5006049">,</span>&nbsp;<span class="ident" id="5006051">prec</span><span class="op" id="5006055">+</span><span class="num" id="5006056">1</span><span class="op" id="5006057">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006062">x</span>&nbsp;<span class="op" id="5006064">=</span>&nbsp;<span class="op" id="5006066">&amp;</span><span class="ident" id="5006067">ast</span><span class="op" id="5006070">.</span><span class="ident" id="5006071">BinaryExpr</span><span class="op" id="5006081">{</span><span class="ident" id="5006082">X</span><span class="op" id="5006083">:</span>&nbsp;<span class="ident" id="5006085">p</span><span class="op" id="5006086">.</span><span class="ident" id="5006087">checkExpr</span><span class="op" id="5006096">(</span><span class="ident" id="5006097">x</span><span class="op" id="5006098">)</span><span class="op" id="5006099">,</span>&nbsp;<span class="ident" id="5006101">OpPos</span><span class="op" id="5006106">:</span>&nbsp;<span class="ident" id="5006108">pos</span><span class="op" id="5006111">,</span>&nbsp;<span class="ident" id="5006113">Op</span><span class="op" id="5006115">:</span>&nbsp;<span class="ident" id="5006117">op</span><span class="op" id="5006119">,</span>&nbsp;<span class="ident" id="5006121">Y</span><span class="op" id="5006122">:</span>&nbsp;<span class="ident" id="5006124">p</span><span class="op" id="5006125">.</span><span class="ident" id="5006126">checkExpr</span><span class="op" id="5006135">(</span><span class="ident" id="5006136">y</span><span class="op" id="5006137">)</span><span class="op" id="5006138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5006142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5006145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006149">return</span>&nbsp;<span class="ident" id="5006156">x</span><br>
<span class="lineno">1590</span><span class="op" id="5006158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5006161">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="5006231">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5006303">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="5006374">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5006386">func</span>&nbsp;<span class="op" id="5006391">(</span><span class="ident" id="5006392">p</span>&nbsp;<span class="op" id="5006394">*</span><span class="ident" id="5006395">parser</span><span class="op" id="5006401">)</span>&nbsp;<span class="ident" id="5006403">parseExpr</span><span class="op" id="5006412">(</span><span class="ident" id="5006413">lhs</span>&nbsp;<span class="builtintype" id="5006417">bool</span><span class="op" id="5006421">)</span>&nbsp;<span class="ident" id="5006423">ast</span><span class="op" id="5006426">.</span><span class="ident" id="5006427">Expr</span>&nbsp;<span class="op" id="5006432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006435">if</span>&nbsp;<span class="ident" id="5006438">p</span><span class="op" id="5006439">.</span><span class="ident" id="5006440">trace</span>&nbsp;<span class="op" id="5006446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006450">defer</span>&nbsp;<span class="ident" id="5006456">un</span><span class="op" id="5006458">(</span><span class="ident" id="5006459">trace</span><span class="op" id="5006464">(</span><span class="ident" id="5006465">p</span><span class="op" id="5006466">,</span>&nbsp;<span class="string" id="5006468">&#34;Expression&#34;</span><span class="op" id="5006480">)</span><span class="op" id="5006481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5006484">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006488">return</span>&nbsp;<span class="ident" id="5006495">p</span><span class="op" id="5006496">.</span><span class="ident" id="5006497">parseBinaryExpr</span><span class="op" id="5006512">(</span><span class="ident" id="5006513">lhs</span><span class="op" id="5006516">,</span>&nbsp;<span class="ident" id="5006518">token</span><span class="op" id="5006523">.</span><span class="ident" id="5006524">LowestPrec</span><span class="op" id="5006534">+</span><span class="num" id="5006535">1</span><span class="op" id="5006536">)</span><br>
<span class="lineno"></span><span class="op" id="5006538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006541">func</span>&nbsp;<span class="op" id="5006546">(</span><span class="ident" id="5006547">p</span>&nbsp;<span class="op" id="5006549">*</span><span class="ident" id="5006550">parser</span><span class="op" id="5006556">)</span>&nbsp;<span class="ident" id="5006558">parseRhs</span><span class="op" id="5006566">(</span><span class="op" id="5006567">)</span>&nbsp;<span class="ident" id="5006569">ast</span><span class="op" id="5006572">.</span><span class="ident" id="5006573">Expr</span>&nbsp;<span class="op" id="5006578">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006581">old</span>&nbsp;<span class="op" id="5006585">:=</span>&nbsp;<span class="ident" id="5006588">p</span><span class="op" id="5006589">.</span><span class="ident" id="5006590">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006597">p</span><span class="op" id="5006598">.</span><span class="ident" id="5006599">inRhs</span>&nbsp;<span class="op" id="5006605">=</span>&nbsp;<span class="builtintype" id="5006607">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006613">x</span>&nbsp;<span class="op" id="5006615">:=</span>&nbsp;<span class="ident" id="5006618">p</span><span class="op" id="5006619">.</span><span class="ident" id="5006620">checkExpr</span><span class="op" id="5006629">(</span><span class="ident" id="5006630">p</span><span class="op" id="5006631">.</span><span class="ident" id="5006632">parseExpr</span><span class="op" id="5006641">(</span><span class="builtintype" id="5006642">false</span><span class="op" id="5006647">)</span><span class="op" id="5006648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006651">p</span><span class="op" id="5006652">.</span><span class="ident" id="5006653">inRhs</span>&nbsp;<span class="op" id="5006659">=</span>&nbsp;<span class="ident" id="5006661">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006666">return</span>&nbsp;<span class="ident" id="5006673">x</span><br>
<span class="lineno">1610</span><span class="op" id="5006675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006678">func</span>&nbsp;<span class="op" id="5006683">(</span><span class="ident" id="5006684">p</span>&nbsp;<span class="op" id="5006686">*</span><span class="ident" id="5006687">parser</span><span class="op" id="5006693">)</span>&nbsp;<span class="ident" id="5006695">parseRhsOrType</span><span class="op" id="5006709">(</span><span class="op" id="5006710">)</span>&nbsp;<span class="ident" id="5006712">ast</span><span class="op" id="5006715">.</span><span class="ident" id="5006716">Expr</span>&nbsp;<span class="op" id="5006721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006724">old</span>&nbsp;<span class="op" id="5006728">:=</span>&nbsp;<span class="ident" id="5006731">p</span><span class="op" id="5006732">.</span><span class="ident" id="5006733">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006740">p</span><span class="op" id="5006741">.</span><span class="ident" id="5006742">inRhs</span>&nbsp;<span class="op" id="5006748">=</span>&nbsp;<span class="builtintype" id="5006750">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006756">x</span>&nbsp;<span class="op" id="5006758">:=</span>&nbsp;<span class="ident" id="5006761">p</span><span class="op" id="5006762">.</span><span class="ident" id="5006763">checkExprOrType</span><span class="op" id="5006778">(</span><span class="ident" id="5006779">p</span><span class="op" id="5006780">.</span><span class="ident" id="5006781">parseExpr</span><span class="op" id="5006790">(</span><span class="builtintype" id="5006791">false</span><span class="op" id="5006796">)</span><span class="op" id="5006797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006800">p</span><span class="op" id="5006801">.</span><span class="ident" id="5006802">inRhs</span>&nbsp;<span class="op" id="5006808">=</span>&nbsp;<span class="ident" id="5006810">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5006815">return</span>&nbsp;<span class="ident" id="5006822">x</span><br>
<span class="lineno"></span><span class="op" id="5006824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="5006827">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5006907">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5006922">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5006960">const</span>&nbsp;<span class="op" id="5006966">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006969">basic</span>&nbsp;<span class="op" id="5006975">=</span>&nbsp;<span class="ident" id="5006977">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006983">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006992">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="5007000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="5007003">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="5007077">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5007151">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5007225">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="5007296">func</span>&nbsp;<span class="op" id="5007301">(</span><span class="ident" id="5007302">p</span>&nbsp;<span class="op" id="5007304">*</span><span class="ident" id="5007305">parser</span><span class="op" id="5007311">)</span>&nbsp;<span class="ident" id="5007313">parseSimpleStmt</span><span class="op" id="5007328">(</span><span class="ident" id="5007329">mode</span>&nbsp;<span class="builtintype" id="5007334">int</span><span class="op" id="5007337">)</span>&nbsp;<span class="op" id="5007339">(</span><span class="ident" id="5007340">ast</span><span class="op" id="5007343">.</span><span class="ident" id="5007344">Stmt</span><span class="op" id="5007348">,</span>&nbsp;<span class="builtintype" id="5007350">bool</span><span class="op" id="5007354">)</span>&nbsp;<span class="op" id="5007356">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007359">if</span>&nbsp;<span class="ident" id="5007362">p</span><span class="op" id="5007363">.</span><span class="ident" id="5007364">trace</span>&nbsp;<span class="op" id="5007370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007374">defer</span>&nbsp;<span class="ident" id="5007380">un</span><span class="op" id="5007382">(</span><span class="ident" id="5007383">trace</span><span class="op" id="5007388">(</span><span class="ident" id="5007389">p</span><span class="op" id="5007390">,</span>&nbsp;<span class="string" id="5007392">&#34;SimpleStmt&#34;</span><span class="op" id="5007404">)</span><span class="op" id="5007405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5007408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007412">x</span>&nbsp;<span class="op" id="5007414">:=</span>&nbsp;<span class="ident" id="5007417">p</span><span class="op" id="5007418">.</span><span class="ident" id="5007419">parseLhsList</span><span class="op" id="5007431">(</span><span class="op" id="5007432">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007436">switch</span>&nbsp;<span class="ident" id="5007443">p</span><span class="op" id="5007444">.</span><span class="ident" id="5007445">tok</span>&nbsp;<span class="op" id="5007449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007452">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007459">token</span><span class="op" id="5007464">.</span><span class="ident" id="5007465">DEFINE</span><span class="op" id="5007471">,</span>&nbsp;<span class="ident" id="5007473">token</span><span class="op" id="5007478">.</span><span class="ident" id="5007479">ASSIGN</span><span class="op" id="5007485">,</span>&nbsp;<span class="ident" id="5007487">token</span><span class="op" id="5007492">.</span><span class="ident" id="5007493">ADD_ASSIGN</span><span class="op" id="5007503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007507">token</span><span class="op" id="5007512">.</span><span class="ident" id="5007513">SUB_ASSIGN</span><span class="op" id="5007523">,</span>&nbsp;<span class="ident" id="5007525">token</span><span class="op" id="5007530">.</span><span class="ident" id="5007531">MUL_ASSIGN</span><span class="op" id="5007541">,</span>&nbsp;<span class="ident" id="5007543">token</span><span class="op" id="5007548">.</span><span class="ident" id="5007549">QUO_ASSIGN</span><span class="op" id="5007559">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007563">token</span><span class="op" id="5007568">.</span><span class="ident" id="5007569">REM_ASSIGN</span><span class="op" id="5007579">,</span>&nbsp;<span class="ident" id="5007581">token</span><span class="op" id="5007586">.</span><span class="ident" id="5007587">AND_ASSIGN</span><span class="op" id="5007597">,</span>&nbsp;<span class="ident" id="5007599">token</span><span class="op" id="5007604">.</span><span class="ident" id="5007605">OR_ASSIGN</span><span class="op" id="5007614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007618">token</span><span class="op" id="5007623">.</span><span class="ident" id="5007624">XOR_ASSIGN</span><span class="op" id="5007634">,</span>&nbsp;<span class="ident" id="5007636">token</span><span class="op" id="5007641">.</span><span class="ident" id="5007642">SHL_ASSIGN</span><span class="op" id="5007652">,</span>&nbsp;<span class="ident" id="5007654">token</span><span class="op" id="5007659">.</span><span class="ident" id="5007660">SHR_ASSIGN</span><span class="op" id="5007670">,</span>&nbsp;<span class="ident" id="5007672">token</span><span class="op" id="5007677">.</span><span class="ident" id="5007678">AND_NOT_ASSIGN</span><span class="op" id="5007692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007696">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007755">pos</span><span class="op" id="5007758">,</span>&nbsp;<span class="ident" id="5007760">tok</span>&nbsp;<span class="op" id="5007764">:=</span>&nbsp;<span class="ident" id="5007767">p</span><span class="op" id="5007768">.</span><span class="ident" id="5007769">pos</span><span class="op" id="5007772">,</span>&nbsp;<span class="ident" id="5007774">p</span><span class="op" id="5007775">.</span><span class="ident" id="5007776">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007782">p</span><span class="op" id="5007783">.</span><span class="ident" id="5007784">next</span><span class="op" id="5007788">(</span><span class="op" id="5007789">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007793">var</span>&nbsp;<span class="ident" id="5007797">y</span>&nbsp;<span class="op" id="5007799">[</span><span class="op" id="5007800">]</span><span class="ident" id="5007801">ast</span><span class="op" id="5007804">.</span><span class="ident" id="5007805">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007812">isRange</span>&nbsp;<span class="op" id="5007820">:=</span>&nbsp;<span class="builtintype" id="5007823">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5007831">if</span>&nbsp;<span class="ident" id="5007834">mode</span>&nbsp;<span class="op" id="5007839">==</span>&nbsp;<span class="ident" id="5007842">rangeOk</span>&nbsp;<span class="op" id="5007850">&amp;&amp;</span>&nbsp;<span class="ident" id="5007853">p</span><span class="op" id="5007854">.</span><span class="ident" id="5007855">tok</span>&nbsp;<span class="op" id="5007859">==</span>&nbsp;<span class="ident" id="5007862">token</span><span class="op" id="5007867">.</span><span class="ident" id="5007868">RANGE</span>&nbsp;<span class="op" id="5007874">&amp;&amp;</span>&nbsp;<span class="op" id="5007877">(</span><span class="ident" id="5007878">tok</span>&nbsp;<span class="op" id="5007882">==</span>&nbsp;<span class="ident" id="5007885">token</span><span class="op" id="5007890">.</span><span class="ident" id="5007891">DEFINE</span>&nbsp;<span class="op" id="5007898">||</span>&nbsp;<span class="ident" id="5007901">tok</span>&nbsp;<span class="op" id="5007905">==</span>&nbsp;<span class="ident" id="5007908">token</span><span class="op" id="5007913">.</span><span class="ident" id="5007914">ASSIGN</span><span class="op" id="5007920">)</span>&nbsp;<span class="op" id="5007922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007927">pos</span>&nbsp;<span class="op" id="5007931">:=</span>&nbsp;<span class="ident" id="5007934">p</span><span class="op" id="5007935">.</span><span class="ident" id="5007936">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007943">p</span><span class="op" id="5007944">.</span><span class="ident" id="5007945">next</span><span class="op" id="5007949">(</span><span class="op" id="5007950">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007955">y</span>&nbsp;<span class="op" id="5007957">=</span>&nbsp;<span class="op" id="5007959">[</span><span class="op" id="5007960">]</span><span class="ident" id="5007961">ast</span><span class="op" id="5007964">.</span><span class="ident" id="5007965">Expr</span><span class="op" id="5007969">{</span><span class="op" id="5007970">&amp;</span><span class="ident" id="5007971">ast</span><span class="op" id="5007974">.</span><span class="ident" id="5007975">UnaryExpr</span><span class="op" id="5007984">{</span><span class="ident" id="5007985">OpPos</span><span class="op" id="5007990">:</span>&nbsp;<span class="ident" id="5007992">pos</span><span class="op" id="5007995">,</span>&nbsp;<span class="ident" id="5007997">Op</span><span class="op" id="5007999">:</span>&nbsp;<span class="ident" id="5008001">token</span><span class="op" id="5008006">.</span><span class="ident" id="5008007">RANGE</span><span class="op" id="5008012">,</span>&nbsp;<span class="ident" id="5008014">X</span><span class="op" id="5008015">:</span>&nbsp;<span class="ident" id="5008017">p</span><span class="op" id="5008018">.</span><span class="ident" id="5008019">parseRhs</span><span class="op" id="5008027">(</span><span class="op" id="5008028">)</span><span class="op" id="5008029">}</span><span class="op" id="5008030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008035">isRange</span>&nbsp;<span class="op" id="5008043">=</span>&nbsp;<span class="builtintype" id="5008045">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008052">}</span>&nbsp;<span class="keyword" id="5008054">else</span>&nbsp;<span class="op" id="5008059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008064">y</span>&nbsp;<span class="op" id="5008066">=</span>&nbsp;<span class="ident" id="5008068">p</span><span class="op" id="5008069">.</span><span class="ident" id="5008070">parseRhsList</span><span class="op" id="5008082">(</span><span class="op" id="5008083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008087">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008091">as</span>&nbsp;<span class="op" id="5008094">:=</span>&nbsp;<span class="op" id="5008097">&amp;</span><span class="ident" id="5008098">ast</span><span class="op" id="5008101">.</span><span class="ident" id="5008102">AssignStmt</span><span class="op" id="5008112">{</span><span class="ident" id="5008113">Lhs</span><span class="op" id="5008116">:</span>&nbsp;<span class="ident" id="5008118">x</span><span class="op" id="5008119">,</span>&nbsp;<span class="ident" id="5008121">TokPos</span><span class="op" id="5008127">:</span>&nbsp;<span class="ident" id="5008129">pos</span><span class="op" id="5008132">,</span>&nbsp;<span class="ident" id="5008134">Tok</span><span class="op" id="5008137">:</span>&nbsp;<span class="ident" id="5008139">tok</span><span class="op" id="5008142">,</span>&nbsp;<span class="ident" id="5008144">Rhs</span><span class="op" id="5008147">:</span>&nbsp;<span class="ident" id="5008149">y</span><span class="op" id="5008150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008154">if</span>&nbsp;<span class="ident" id="5008157">tok</span>&nbsp;<span class="op" id="5008161">==</span>&nbsp;<span class="ident" id="5008164">token</span><span class="op" id="5008169">.</span><span class="ident" id="5008170">DEFINE</span>&nbsp;<span class="op" id="5008177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008182">p</span><span class="op" id="5008183">.</span><span class="ident" id="5008184">shortVarDecl</span><span class="op" id="5008196">(</span><span class="ident" id="5008197">as</span><span class="op" id="5008199">,</span>&nbsp;<span class="ident" id="5008201">x</span><span class="op" id="5008202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008210">return</span>&nbsp;<span class="ident" id="5008217">as</span><span class="op" id="5008219">,</span>&nbsp;<span class="ident" id="5008221">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008234">if</span>&nbsp;<span class="builtinfunc" id="5008237">len</span><span class="op" id="5008240">(</span><span class="ident" id="5008241">x</span><span class="op" id="5008242">)</span>&nbsp;<span class="op" id="5008244">&gt;</span>&nbsp;<span class="num" id="5008246">1</span>&nbsp;<span class="op" id="5008248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008252">p</span><span class="op" id="5008253">.</span><span class="ident" id="5008254">errorExpected</span><span class="op" id="5008267">(</span><span class="ident" id="5008268">x</span><span class="op" id="5008269">[</span><span class="num" id="5008270">0</span><span class="op" id="5008271">]</span><span class="op" id="5008272">.</span><span class="ident" id="5008273">Pos</span><span class="op" id="5008276">(</span><span class="op" id="5008277">)</span><span class="op" id="5008278">,</span>&nbsp;<span class="string" id="5008280">&#34;1&nbsp;expression&#34;</span><span class="op" id="5008294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008298">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008337">switch</span>&nbsp;<span class="ident" id="5008344">p</span><span class="op" id="5008345">.</span><span class="ident" id="5008346">tok</span>&nbsp;<span class="op" id="5008350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008353">case</span>&nbsp;<span class="ident" id="5008358">token</span><span class="op" id="5008363">.</span><span class="ident" id="5008364">COLON</span><span class="op" id="5008369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008373">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008396">colon</span>&nbsp;<span class="op" id="5008402">:=</span>&nbsp;<span class="ident" id="5008405">p</span><span class="op" id="5008406">.</span><span class="ident" id="5008407">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008413">p</span><span class="op" id="5008414">.</span><span class="ident" id="5008415">next</span><span class="op" id="5008419">(</span><span class="op" id="5008420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008424">if</span>&nbsp;<span class="ident" id="5008427">label</span><span class="op" id="5008432">,</span>&nbsp;<span class="ident" id="5008434">isIdent</span>&nbsp;<span class="op" id="5008442">:=</span>&nbsp;<span class="ident" id="5008445">x</span><span class="op" id="5008446">[</span><span class="num" id="5008447">0</span><span class="op" id="5008448">]</span><span class="op" id="5008449">.</span><span class="op" id="5008450">(</span><span class="op" id="5008451">*</span><span class="ident" id="5008452">ast</span><span class="op" id="5008455">.</span><span class="ident" id="5008456">Ident</span><span class="op" id="5008461">)</span><span class="op" id="5008462">;</span>&nbsp;<span class="ident" id="5008464">mode</span>&nbsp;<span class="op" id="5008469">==</span>&nbsp;<span class="ident" id="5008472">labelOk</span>&nbsp;<span class="op" id="5008480">&amp;&amp;</span>&nbsp;<span class="ident" id="5008483">isIdent</span>&nbsp;<span class="op" id="5008491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008496">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008560">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008626">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008642">stmt</span>&nbsp;<span class="op" id="5008647">:=</span>&nbsp;<span class="op" id="5008650">&amp;</span><span class="ident" id="5008651">ast</span><span class="op" id="5008654">.</span><span class="ident" id="5008655">LabeledStmt</span><span class="op" id="5008666">{</span><span class="ident" id="5008667">Label</span><span class="op" id="5008672">:</span>&nbsp;<span class="ident" id="5008674">label</span><span class="op" id="5008679">,</span>&nbsp;<span class="ident" id="5008681">Colon</span><span class="op" id="5008686">:</span>&nbsp;<span class="ident" id="5008688">colon</span><span class="op" id="5008693">,</span>&nbsp;<span class="ident" id="5008695">Stmt</span><span class="op" id="5008699">:</span>&nbsp;<span class="ident" id="5008701">p</span><span class="op" id="5008702">.</span><span class="ident" id="5008703">parseStmt</span><span class="op" id="5008712">(</span><span class="op" id="5008713">)</span><span class="op" id="5008714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008719">p</span><span class="op" id="5008720">.</span><span class="ident" id="5008721">declare</span><span class="op" id="5008728">(</span><span class="ident" id="5008729">stmt</span><span class="op" id="5008733">,</span>&nbsp;<span class="ident" id="5008735">nil</span><span class="op" id="5008738">,</span>&nbsp;<span class="ident" id="5008740">p</span><span class="op" id="5008741">.</span><span class="ident" id="5008742">labelScope</span><span class="op" id="5008752">,</span>&nbsp;<span class="ident" id="5008754">ast</span><span class="op" id="5008757">.</span><span class="ident" id="5008758">Lbl</span><span class="op" id="5008761">,</span>&nbsp;<span class="ident" id="5008763">label</span><span class="op" id="5008768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5008773">return</span>&nbsp;<span class="ident" id="5008780">stmt</span><span class="op" id="5008784">,</span>&nbsp;<span class="builtintype" id="5008786">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5008794">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008798">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008871">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008945">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009018">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009091">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009165">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009200">p</span><span class="op" id="5009201">.</span><span class="builtintype" id="5009202">error</span><span class="op" id="5009207">(</span><span class="ident" id="5009208">colon</span><span class="op" id="5009213">,</span>&nbsp;<span class="string" id="5009215">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="5009242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009246">return</span>&nbsp;<span class="op" id="5009253">&amp;</span><span class="ident" id="5009254">ast</span><span class="op" id="5009257">.</span><span class="ident" id="5009258">BadStmt</span><span class="op" id="5009265">{</span><span class="ident" id="5009266">From</span><span class="op" id="5009270">:</span>&nbsp;<span class="ident" id="5009272">x</span><span class="op" id="5009273">[</span><span class="num" id="5009274">0</span><span class="op" id="5009275">]</span><span class="op" id="5009276">.</span><span class="ident" id="5009277">Pos</span><span class="op" id="5009280">(</span><span class="op" id="5009281">)</span><span class="op" id="5009282">,</span>&nbsp;<span class="ident" id="5009284">To</span><span class="op" id="5009286">:</span>&nbsp;<span class="ident" id="5009288">colon</span>&nbsp;<span class="op" id="5009294">+</span>&nbsp;<span class="num" id="5009296">1</span><span class="op" id="5009297">}</span><span class="op" id="5009298">,</span>&nbsp;<span class="builtintype" id="5009300">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009308">case</span>&nbsp;<span class="ident" id="5009313">token</span><span class="op" id="5009318">.</span><span class="ident" id="5009319">ARROW</span><span class="op" id="5009324">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009328">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009348">arrow</span>&nbsp;<span class="op" id="5009354">:=</span>&nbsp;<span class="ident" id="5009357">p</span><span class="op" id="5009358">.</span><span class="ident" id="5009359">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009365">p</span><span class="op" id="5009366">.</span><span class="ident" id="5009367">next</span><span class="op" id="5009371">(</span><span class="op" id="5009372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009376">y</span>&nbsp;<span class="op" id="5009378">:=</span>&nbsp;<span class="ident" id="5009381">p</span><span class="op" id="5009382">.</span><span class="ident" id="5009383">parseRhs</span><span class="op" id="5009391">(</span><span class="op" id="5009392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009396">return</span>&nbsp;<span class="op" id="5009403">&amp;</span><span class="ident" id="5009404">ast</span><span class="op" id="5009407">.</span><span class="ident" id="5009408">SendStmt</span><span class="op" id="5009416">{</span><span class="ident" id="5009417">Chan</span><span class="op" id="5009421">:</span>&nbsp;<span class="ident" id="5009423">x</span><span class="op" id="5009424">[</span><span class="num" id="5009425">0</span><span class="op" id="5009426">]</span><span class="op" id="5009427">,</span>&nbsp;<span class="ident" id="5009429">Arrow</span><span class="op" id="5009434">:</span>&nbsp;<span class="ident" id="5009436">arrow</span><span class="op" id="5009441">,</span>&nbsp;<span class="ident" id="5009443">Value</span><span class="op" id="5009448">:</span>&nbsp;<span class="ident" id="5009450">y</span><span class="op" id="5009451">}</span><span class="op" id="5009452">,</span>&nbsp;<span class="builtintype" id="5009454">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009462">case</span>&nbsp;<span class="ident" id="5009467">token</span><span class="op" id="5009472">.</span><span class="ident" id="5009473">INC</span><span class="op" id="5009476">,</span>&nbsp;<span class="ident" id="5009478">token</span><span class="op" id="5009483">.</span><span class="ident" id="5009484">DEC</span><span class="op" id="5009487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009491">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009519">s</span>&nbsp;<span class="op" id="5009521">:=</span>&nbsp;<span class="op" id="5009524">&amp;</span><span class="ident" id="5009525">ast</span><span class="op" id="5009528">.</span><span class="ident" id="5009529">IncDecStmt</span><span class="op" id="5009539">{</span><span class="ident" id="5009540">X</span><span class="op" id="5009541">:</span>&nbsp;<span class="ident" id="5009543">x</span><span class="op" id="5009544">[</span><span class="num" id="5009545">0</span><span class="op" id="5009546">]</span><span class="op" id="5009547">,</span>&nbsp;<span class="ident" id="5009549">TokPos</span><span class="op" id="5009555">:</span>&nbsp;<span class="ident" id="5009557">p</span><span class="op" id="5009558">.</span><span class="ident" id="5009559">pos</span><span class="op" id="5009562">,</span>&nbsp;<span class="ident" id="5009564">Tok</span><span class="op" id="5009567">:</span>&nbsp;<span class="ident" id="5009569">p</span><span class="op" id="5009570">.</span><span class="ident" id="5009571">tok</span><span class="op" id="5009574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009578">p</span><span class="op" id="5009579">.</span><span class="ident" id="5009580">next</span><span class="op" id="5009584">(</span><span class="op" id="5009585">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009589">return</span>&nbsp;<span class="ident" id="5009596">s</span><span class="op" id="5009597">,</span>&nbsp;<span class="builtintype" id="5009599">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5009606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009610">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009625">return</span>&nbsp;<span class="op" id="5009632">&amp;</span><span class="ident" id="5009633">ast</span><span class="op" id="5009636">.</span><span class="ident" id="5009637">ExprStmt</span><span class="op" id="5009645">{</span><span class="ident" id="5009646">X</span><span class="op" id="5009647">:</span>&nbsp;<span class="ident" id="5009649">x</span><span class="op" id="5009650">[</span><span class="num" id="5009651">0</span><span class="op" id="5009652">]</span><span class="op" id="5009653">}</span><span class="op" id="5009654">,</span>&nbsp;<span class="builtintype" id="5009656">false</span><br>
<span class="lineno">1710</span><span class="op" id="5009662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5009665">func</span>&nbsp;<span class="op" id="5009670">(</span><span class="ident" id="5009671">p</span>&nbsp;<span class="op" id="5009673">*</span><span class="ident" id="5009674">parser</span><span class="op" id="5009680">)</span>&nbsp;<span class="ident" id="5009682">parseCallExpr</span><span class="op" id="5009695">(</span><span class="ident" id="5009696">callType</span>&nbsp;<span class="builtintype" id="5009705">string</span><span class="op" id="5009711">)</span>&nbsp;<span class="op" id="5009713">*</span><span class="ident" id="5009714">ast</span><span class="op" id="5009717">.</span><span class="ident" id="5009718">CallExpr</span>&nbsp;<span class="op" id="5009727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009730">x</span>&nbsp;<span class="op" id="5009732">:=</span>&nbsp;<span class="ident" id="5009735">p</span><span class="op" id="5009736">.</span><span class="ident" id="5009737">parseRhsOrType</span><span class="op" id="5009751">(</span><span class="op" id="5009752">)</span>&nbsp;<span class="comment" id="5009754">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009796">if</span>&nbsp;<span class="ident" id="5009799">call</span><span class="op" id="5009803">,</span>&nbsp;<span class="ident" id="5009805">isCall</span>&nbsp;<span class="op" id="5009812">:=</span>&nbsp;<span class="ident" id="5009815">x</span><span class="op" id="5009816">.</span><span class="op" id="5009817">(</span><span class="op" id="5009818">*</span><span class="ident" id="5009819">ast</span><span class="op" id="5009822">.</span><span class="ident" id="5009823">CallExpr</span><span class="op" id="5009831">)</span><span class="op" id="5009832">;</span>&nbsp;<span class="ident" id="5009834">isCall</span>&nbsp;<span class="op" id="5009841">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009845">return</span>&nbsp;<span class="ident" id="5009852">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5009858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009861">if</span>&nbsp;<span class="ident" id="5009864">_</span><span class="op" id="5009865">,</span>&nbsp;<span class="ident" id="5009867">isBad</span>&nbsp;<span class="op" id="5009873">:=</span>&nbsp;<span class="ident" id="5009876">x</span><span class="op" id="5009877">.</span><span class="op" id="5009878">(</span><span class="op" id="5009879">*</span><span class="ident" id="5009880">ast</span><span class="op" id="5009883">.</span><span class="ident" id="5009884">BadExpr</span><span class="op" id="5009891">)</span><span class="op" id="5009892">;</span>&nbsp;<span class="op" id="5009894">!</span><span class="ident" id="5009895">isBad</span>&nbsp;<span class="op" id="5009901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009905">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009946">p</span><span class="op" id="5009947">.</span><span class="builtintype" id="5009948">error</span><span class="op" id="5009953">(</span><span class="ident" id="5009954">p</span><span class="op" id="5009955">.</span><span class="ident" id="5009956">safePos</span><span class="op" id="5009963">(</span><span class="ident" id="5009964">x</span><span class="op" id="5009965">.</span><span class="ident" id="5009966">End</span><span class="op" id="5009969">(</span><span class="op" id="5009970">)</span><span class="op" id="5009971">)</span><span class="op" id="5009972">,</span>&nbsp;<span class="ident" id="5009974">fmt</span><span class="op" id="5009977">.</span><span class="ident" id="5009978">Sprintf</span><span class="op" id="5009985">(</span><span class="string" id="5009986">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="5010028">,</span>&nbsp;<span class="ident" id="5010030">callType</span><span class="op" id="5010038">)</span><span class="op" id="5010039">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010045">return</span>&nbsp;<span class="ident" id="5010052">nil</span><br>
<span class="lineno"></span><span class="op" id="5010056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5010059">func</span>&nbsp;<span class="op" id="5010064">(</span><span class="ident" id="5010065">p</span>&nbsp;<span class="op" id="5010067">*</span><span class="ident" id="5010068">parser</span><span class="op" id="5010074">)</span>&nbsp;<span class="ident" id="5010076">parseGoStmt</span><span class="op" id="5010087">(</span><span class="op" id="5010088">)</span>&nbsp;<span class="ident" id="5010090">ast</span><span class="op" id="5010093">.</span><span class="ident" id="5010094">Stmt</span>&nbsp;<span class="op" id="5010099">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010102">if</span>&nbsp;<span class="ident" id="5010105">p</span><span class="op" id="5010106">.</span><span class="ident" id="5010107">trace</span>&nbsp;<span class="op" id="5010113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010117">defer</span>&nbsp;<span class="ident" id="5010123">un</span><span class="op" id="5010125">(</span><span class="ident" id="5010126">trace</span><span class="op" id="5010131">(</span><span class="ident" id="5010132">p</span><span class="op" id="5010133">,</span>&nbsp;<span class="string" id="5010135">&#34;GoStmt&#34;</span><span class="op" id="5010143">)</span><span class="op" id="5010144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010151">pos</span>&nbsp;<span class="op" id="5010155">:=</span>&nbsp;<span class="ident" id="5010158">p</span><span class="op" id="5010159">.</span><span class="ident" id="5010160">expect</span><span class="op" id="5010166">(</span><span class="ident" id="5010167">token</span><span class="op" id="5010172">.</span><span class="ident" id="5010173">GO</span><span class="op" id="5010175">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010178">call</span>&nbsp;<span class="op" id="5010183">:=</span>&nbsp;<span class="ident" id="5010186">p</span><span class="op" id="5010187">.</span><span class="ident" id="5010188">parseCallExpr</span><span class="op" id="5010201">(</span><span class="string" id="5010202">&#34;go&#34;</span><span class="op" id="5010206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010209">p</span><span class="op" id="5010210">.</span><span class="ident" id="5010211">expectSemi</span><span class="op" id="5010221">(</span><span class="op" id="5010222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010225">if</span>&nbsp;<span class="ident" id="5010228">call</span>&nbsp;<span class="op" id="5010233">==</span>&nbsp;<span class="ident" id="5010236">nil</span>&nbsp;<span class="op" id="5010240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010244">return</span>&nbsp;<span class="op" id="5010251">&amp;</span><span class="ident" id="5010252">ast</span><span class="op" id="5010255">.</span><span class="ident" id="5010256">BadStmt</span><span class="op" id="5010263">{</span><span class="ident" id="5010264">From</span><span class="op" id="5010268">:</span>&nbsp;<span class="ident" id="5010270">pos</span><span class="op" id="5010273">,</span>&nbsp;<span class="ident" id="5010275">To</span><span class="op" id="5010277">:</span>&nbsp;<span class="ident" id="5010279">pos</span>&nbsp;<span class="op" id="5010283">+</span>&nbsp;<span class="num" id="5010285">2</span><span class="op" id="5010286">}</span>&nbsp;<span class="comment" id="5010288">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010302">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010306">return</span>&nbsp;<span class="op" id="5010313">&amp;</span><span class="ident" id="5010314">ast</span><span class="op" id="5010317">.</span><span class="ident" id="5010318">GoStmt</span><span class="op" id="5010324">{</span><span class="ident" id="5010325">Go</span><span class="op" id="5010327">:</span>&nbsp;<span class="ident" id="5010329">pos</span><span class="op" id="5010332">,</span>&nbsp;<span class="ident" id="5010334">Call</span><span class="op" id="5010338">:</span>&nbsp;<span class="ident" id="5010340">call</span><span class="op" id="5010344">}</span><br>
<span class="lineno"></span><span class="op" id="5010346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5010349">func</span>&nbsp;<span class="op" id="5010354">(</span><span class="ident" id="5010355">p</span>&nbsp;<span class="op" id="5010357">*</span><span class="ident" id="5010358">parser</span><span class="op" id="5010364">)</span>&nbsp;<span class="ident" id="5010366">parseDeferStmt</span><span class="op" id="5010380">(</span><span class="op" id="5010381">)</span>&nbsp;<span class="ident" id="5010383">ast</span><span class="op" id="5010386">.</span><span class="ident" id="5010387">Stmt</span>&nbsp;<span class="op" id="5010392">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010395">if</span>&nbsp;<span class="ident" id="5010398">p</span><span class="op" id="5010399">.</span><span class="ident" id="5010400">trace</span>&nbsp;<span class="op" id="5010406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010410">defer</span>&nbsp;<span class="ident" id="5010416">un</span><span class="op" id="5010418">(</span><span class="ident" id="5010419">trace</span><span class="op" id="5010424">(</span><span class="ident" id="5010425">p</span><span class="op" id="5010426">,</span>&nbsp;<span class="string" id="5010428">&#34;DeferStmt&#34;</span><span class="op" id="5010439">)</span><span class="op" id="5010440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010447">pos</span>&nbsp;<span class="op" id="5010451">:=</span>&nbsp;<span class="ident" id="5010454">p</span><span class="op" id="5010455">.</span><span class="ident" id="5010456">expect</span><span class="op" id="5010462">(</span><span class="ident" id="5010463">token</span><span class="op" id="5010468">.</span><span class="ident" id="5010469">DEFER</span><span class="op" id="5010474">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010477">call</span>&nbsp;<span class="op" id="5010482">:=</span>&nbsp;<span class="ident" id="5010485">p</span><span class="op" id="5010486">.</span><span class="ident" id="5010487">parseCallExpr</span><span class="op" id="5010500">(</span><span class="string" id="5010501">&#34;defer&#34;</span><span class="op" id="5010508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010511">p</span><span class="op" id="5010512">.</span><span class="ident" id="5010513">expectSemi</span><span class="op" id="5010523">(</span><span class="op" id="5010524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010527">if</span>&nbsp;<span class="ident" id="5010530">call</span>&nbsp;<span class="op" id="5010535">==</span>&nbsp;<span class="ident" id="5010538">nil</span>&nbsp;<span class="op" id="5010542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010546">return</span>&nbsp;<span class="op" id="5010553">&amp;</span><span class="ident" id="5010554">ast</span><span class="op" id="5010557">.</span><span class="ident" id="5010558">BadStmt</span><span class="op" id="5010565">{</span><span class="ident" id="5010566">From</span><span class="op" id="5010570">:</span>&nbsp;<span class="ident" id="5010572">pos</span><span class="op" id="5010575">,</span>&nbsp;<span class="ident" id="5010577">To</span><span class="op" id="5010579">:</span>&nbsp;<span class="ident" id="5010581">pos</span>&nbsp;<span class="op" id="5010585">+</span>&nbsp;<span class="num" id="5010587">5</span><span class="op" id="5010588">}</span>&nbsp;<span class="comment" id="5010590">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010607">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010611">return</span>&nbsp;<span class="op" id="5010618">&amp;</span><span class="ident" id="5010619">ast</span><span class="op" id="5010622">.</span><span class="ident" id="5010623">DeferStmt</span><span class="op" id="5010632">{</span><span class="ident" id="5010633">Defer</span><span class="op" id="5010638">:</span>&nbsp;<span class="ident" id="5010640">pos</span><span class="op" id="5010643">,</span>&nbsp;<span class="ident" id="5010645">Call</span><span class="op" id="5010649">:</span>&nbsp;<span class="ident" id="5010651">call</span><span class="op" id="5010655">}</span><br>
<span class="lineno"></span><span class="op" id="5010657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5010660">func</span>&nbsp;<span class="op" id="5010665">(</span><span class="ident" id="5010666">p</span>&nbsp;<span class="op" id="5010668">*</span><span class="ident" id="5010669">parser</span><span class="op" id="5010675">)</span>&nbsp;<span class="ident" id="5010677">parseReturnStmt</span><span class="op" id="5010692">(</span><span class="op" id="5010693">)</span>&nbsp;<span class="op" id="5010695">*</span><span class="ident" id="5010696">ast</span><span class="op" id="5010699">.</span><span class="ident" id="5010700">ReturnStmt</span>&nbsp;<span class="op" id="5010711">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010714">if</span>&nbsp;<span class="ident" id="5010717">p</span><span class="op" id="5010718">.</span><span class="ident" id="5010719">trace</span>&nbsp;<span class="op" id="5010725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010729">defer</span>&nbsp;<span class="ident" id="5010735">un</span><span class="op" id="5010737">(</span><span class="ident" id="5010738">trace</span><span class="op" id="5010743">(</span><span class="ident" id="5010744">p</span><span class="op" id="5010745">,</span>&nbsp;<span class="string" id="5010747">&#34;ReturnStmt&#34;</span><span class="op" id="5010759">)</span><span class="op" id="5010760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010767">pos</span>&nbsp;<span class="op" id="5010771">:=</span>&nbsp;<span class="ident" id="5010774">p</span><span class="op" id="5010775">.</span><span class="ident" id="5010776">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010781">p</span><span class="op" id="5010782">.</span><span class="ident" id="5010783">expect</span><span class="op" id="5010789">(</span><span class="ident" id="5010790">token</span><span class="op" id="5010795">.</span><span class="ident" id="5010796">RETURN</span><span class="op" id="5010802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010805">var</span>&nbsp;<span class="ident" id="5010809">x</span>&nbsp;<span class="op" id="5010811">[</span><span class="op" id="5010812">]</span><span class="ident" id="5010813">ast</span><span class="op" id="5010816">.</span><span class="ident" id="5010817">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010823">if</span>&nbsp;<span class="ident" id="5010826">p</span><span class="op" id="5010827">.</span><span class="ident" id="5010828">tok</span>&nbsp;<span class="op" id="5010832">!=</span>&nbsp;<span class="ident" id="5010835">token</span><span class="op" id="5010840">.</span><span class="ident" id="5010841">SEMICOLON</span>&nbsp;<span class="op" id="5010851">&amp;&amp;</span>&nbsp;<span class="ident" id="5010854">p</span><span class="op" id="5010855">.</span><span class="ident" id="5010856">tok</span>&nbsp;<span class="op" id="5010860">!=</span>&nbsp;<span class="ident" id="5010863">token</span><span class="op" id="5010868">.</span><span class="ident" id="5010869">RBRACE</span>&nbsp;<span class="op" id="5010876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010880">x</span>&nbsp;<span class="op" id="5010882">=</span>&nbsp;<span class="ident" id="5010884">p</span><span class="op" id="5010885">.</span><span class="ident" id="5010886">parseRhsList</span><span class="op" id="5010898">(</span><span class="op" id="5010899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010902">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010905">p</span><span class="op" id="5010906">.</span><span class="ident" id="5010907">expectSemi</span><span class="op" id="5010917">(</span><span class="op" id="5010918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010922">return</span>&nbsp;<span class="op" id="5010929">&amp;</span><span class="ident" id="5010930">ast</span><span class="op" id="5010933">.</span><span class="ident" id="5010934">ReturnStmt</span><span class="op" id="5010944">{</span><span class="ident" id="5010945">Return</span><span class="op" id="5010951">:</span>&nbsp;<span class="ident" id="5010953">pos</span><span class="op" id="5010956">,</span>&nbsp;<span class="ident" id="5010958">Results</span><span class="op" id="5010965">:</span>&nbsp;<span class="ident" id="5010967">x</span><span class="op" id="5010968">}</span><br>
<span class="lineno"></span><span class="op" id="5010970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="5010973">func</span>&nbsp;<span class="op" id="5010978">(</span><span class="ident" id="5010979">p</span>&nbsp;<span class="op" id="5010981">*</span><span class="ident" id="5010982">parser</span><span class="op" id="5010988">)</span>&nbsp;<span class="ident" id="5010990">parseBranchStmt</span><span class="op" id="5011005">(</span><span class="ident" id="5011006">tok</span>&nbsp;<span class="ident" id="5011010">token</span><span class="op" id="5011015">.</span><span class="ident" id="5011016">Token</span><span class="op" id="5011021">)</span>&nbsp;<span class="op" id="5011023">*</span><span class="ident" id="5011024">ast</span><span class="op" id="5011027">.</span><span class="ident" id="5011028">BranchStmt</span>&nbsp;<span class="op" id="5011039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011042">if</span>&nbsp;<span class="ident" id="5011045">p</span><span class="op" id="5011046">.</span><span class="ident" id="5011047">trace</span>&nbsp;<span class="op" id="5011053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011057">defer</span>&nbsp;<span class="ident" id="5011063">un</span><span class="op" id="5011065">(</span><span class="ident" id="5011066">trace</span><span class="op" id="5011071">(</span><span class="ident" id="5011072">p</span><span class="op" id="5011073">,</span>&nbsp;<span class="string" id="5011075">&#34;BranchStmt&#34;</span><span class="op" id="5011087">)</span><span class="op" id="5011088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011095">pos</span>&nbsp;<span class="op" id="5011099">:=</span>&nbsp;<span class="ident" id="5011102">p</span><span class="op" id="5011103">.</span><span class="ident" id="5011104">expect</span><span class="op" id="5011110">(</span><span class="ident" id="5011111">tok</span><span class="op" id="5011114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011117">var</span>&nbsp;<span class="ident" id="5011121">label</span>&nbsp;<span class="op" id="5011127">*</span><span class="ident" id="5011128">ast</span><span class="op" id="5011131">.</span><span class="ident" id="5011132">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011139">if</span>&nbsp;<span class="ident" id="5011142">tok</span>&nbsp;<span class="op" id="5011146">!=</span>&nbsp;<span class="ident" id="5011149">token</span><span class="op" id="5011154">.</span><span class="ident" id="5011155">FALLTHROUGH</span>&nbsp;<span class="op" id="5011167">&amp;&amp;</span>&nbsp;<span class="ident" id="5011170">p</span><span class="op" id="5011171">.</span><span class="ident" id="5011172">tok</span>&nbsp;<span class="op" id="5011176">==</span>&nbsp;<span class="ident" id="5011179">token</span><span class="op" id="5011184">.</span><span class="ident" id="5011185">IDENT</span>&nbsp;<span class="op" id="5011191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011195">label</span>&nbsp;<span class="op" id="5011201">=</span>&nbsp;<span class="ident" id="5011203">p</span><span class="op" id="5011204">.</span><span class="ident" id="5011205">parseIdent</span><span class="op" id="5011215">(</span><span class="op" id="5011216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5011220">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011259">n</span>&nbsp;<span class="op" id="5011261">:=</span>&nbsp;<span class="builtinfunc" id="5011264">len</span><span class="op" id="5011267">(</span><span class="ident" id="5011268">p</span><span class="op" id="5011269">.</span><span class="ident" id="5011270">targetStack</span><span class="op" id="5011281">)</span>&nbsp;<span class="op" id="5011283">-</span>&nbsp;<span class="num" id="5011285">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011289">p</span><span class="op" id="5011290">.</span><span class="ident" id="5011291">targetStack</span><span class="op" id="5011302">[</span><span class="ident" id="5011303">n</span><span class="op" id="5011304">]</span>&nbsp;<span class="op" id="5011306">=</span>&nbsp;<span class="builtinfunc" id="5011308">append</span><span class="op" id="5011314">(</span><span class="ident" id="5011315">p</span><span class="op" id="5011316">.</span><span class="ident" id="5011317">targetStack</span><span class="op" id="5011328">[</span><span class="ident" id="5011329">n</span><span class="op" id="5011330">]</span><span class="op" id="5011331">,</span>&nbsp;<span class="ident" id="5011333">label</span><span class="op" id="5011338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011344">p</span><span class="op" id="5011345">.</span><span class="ident" id="5011346">expectSemi</span><span class="op" id="5011356">(</span><span class="op" id="5011357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011361">return</span>&nbsp;<span class="op" id="5011368">&amp;</span><span class="ident" id="5011369">ast</span><span class="op" id="5011372">.</span><span class="ident" id="5011373">BranchStmt</span><span class="op" id="5011383">{</span><span class="ident" id="5011384">TokPos</span><span class="op" id="5011390">:</span>&nbsp;<span class="ident" id="5011392">pos</span><span class="op" id="5011395">,</span>&nbsp;<span class="ident" id="5011397">Tok</span><span class="op" id="5011400">:</span>&nbsp;<span class="ident" id="5011402">tok</span><span class="op" id="5011405">,</span>&nbsp;<span class="ident" id="5011407">Label</span><span class="op" id="5011412">:</span>&nbsp;<span class="ident" id="5011414">label</span><span class="op" id="5011419">}</span><br>
<span class="lineno"></span><span class="op" id="5011421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5011424">func</span>&nbsp;<span class="op" id="5011429">(</span><span class="ident" id="5011430">p</span>&nbsp;<span class="op" id="5011432">*</span><span class="ident" id="5011433">parser</span><span class="op" id="5011439">)</span>&nbsp;<span class="ident" id="5011441">makeExpr</span><span class="op" id="5011449">(</span><span class="ident" id="5011450">s</span>&nbsp;<span class="ident" id="5011452">ast</span><span class="op" id="5011455">.</span><span class="ident" id="5011456">Stmt</span><span class="op" id="5011460">,</span>&nbsp;<span class="ident" id="5011462">kind</span>&nbsp;<span class="builtintype" id="5011467">string</span><span class="op" id="5011473">)</span>&nbsp;<span class="ident" id="5011475">ast</span><span class="op" id="5011478">.</span><span class="ident" id="5011479">Expr</span>&nbsp;<span class="op" id="5011484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011487">if</span>&nbsp;<span class="ident" id="5011490">s</span>&nbsp;<span class="op" id="5011492">==</span>&nbsp;<span class="ident" id="5011495">nil</span>&nbsp;<span class="op" id="5011499">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011503">return</span>&nbsp;<span class="ident" id="5011510">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011518">if</span>&nbsp;<span class="ident" id="5011521">es</span><span class="op" id="5011523">,</span>&nbsp;<span class="ident" id="5011525">isExpr</span>&nbsp;<span class="op" id="5011532">:=</span>&nbsp;<span class="ident" id="5011535">s</span><span class="op" id="5011536">.</span><span class="op" id="5011537">(</span><span class="op" id="5011538">*</span><span class="ident" id="5011539">ast</span><span class="op" id="5011542">.</span><span class="ident" id="5011543">ExprStmt</span><span class="op" id="5011551">)</span><span class="op" id="5011552">;</span>&nbsp;<span class="ident" id="5011554">isExpr</span>&nbsp;<span class="op" id="5011561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011565">return</span>&nbsp;<span class="ident" id="5011572">p</span><span class="op" id="5011573">.</span><span class="ident" id="5011574">checkExpr</span><span class="op" id="5011583">(</span><span class="ident" id="5011584">es</span><span class="op" id="5011586">.</span><span class="ident" id="5011587">X</span><span class="op" id="5011588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011591">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011594">p</span><span class="op" id="5011595">.</span><span class="builtintype" id="5011596">error</span><span class="op" id="5011601">(</span><span class="ident" id="5011602">s</span><span class="op" id="5011603">.</span><span class="ident" id="5011604">Pos</span><span class="op" id="5011607">(</span><span class="op" id="5011608">)</span><span class="op" id="5011609">,</span>&nbsp;<span class="ident" id="5011611">fmt</span><span class="op" id="5011614">.</span><span class="ident" id="5011615">Sprintf</span><span class="op" id="5011622">(</span><span class="string" id="5011623">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="5011708">,</span>&nbsp;<span class="ident" id="5011710">kind</span><span class="op" id="5011714">)</span><span class="op" id="5011715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011718">return</span>&nbsp;<span class="op" id="5011725">&amp;</span><span class="ident" id="5011726">ast</span><span class="op" id="5011729">.</span><span class="ident" id="5011730">BadExpr</span><span class="op" id="5011737">{</span><span class="ident" id="5011738">From</span><span class="op" id="5011742">:</span>&nbsp;<span class="ident" id="5011744">s</span><span class="op" id="5011745">.</span><span class="ident" id="5011746">Pos</span><span class="op" id="5011749">(</span><span class="op" id="5011750">)</span><span class="op" id="5011751">,</span>&nbsp;<span class="ident" id="5011753">To</span><span class="op" id="5011755">:</span>&nbsp;<span class="ident" id="5011757">p</span><span class="op" id="5011758">.</span><span class="ident" id="5011759">safePos</span><span class="op" id="5011766">(</span><span class="ident" id="5011767">s</span><span class="op" id="5011768">.</span><span class="ident" id="5011769">End</span><span class="op" id="5011772">(</span><span class="op" id="5011773">)</span><span class="op" id="5011774">)</span><span class="op" id="5011775">}</span><br>
<span class="lineno"></span><span class="op" id="5011777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5011780">func</span>&nbsp;<span class="op" id="5011785">(</span><span class="ident" id="5011786">p</span>&nbsp;<span class="op" id="5011788">*</span><span class="ident" id="5011789">parser</span><span class="op" id="5011795">)</span>&nbsp;<span class="ident" id="5011797">parseIfStmt</span><span class="op" id="5011808">(</span><span class="op" id="5011809">)</span>&nbsp;<span class="op" id="5011811">*</span><span class="ident" id="5011812">ast</span><span class="op" id="5011815">.</span><span class="ident" id="5011816">IfStmt</span>&nbsp;<span class="op" id="5011823">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011826">if</span>&nbsp;<span class="ident" id="5011829">p</span><span class="op" id="5011830">.</span><span class="ident" id="5011831">trace</span>&nbsp;<span class="op" id="5011837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011841">defer</span>&nbsp;<span class="ident" id="5011847">un</span><span class="op" id="5011849">(</span><span class="ident" id="5011850">trace</span><span class="op" id="5011855">(</span><span class="ident" id="5011856">p</span><span class="op" id="5011857">,</span>&nbsp;<span class="string" id="5011859">&#34;IfStmt&#34;</span><span class="op" id="5011867">)</span><span class="op" id="5011868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011875">pos</span>&nbsp;<span class="op" id="5011879">:=</span>&nbsp;<span class="ident" id="5011882">p</span><span class="op" id="5011883">.</span><span class="ident" id="5011884">expect</span><span class="op" id="5011890">(</span><span class="ident" id="5011891">token</span><span class="op" id="5011896">.</span><span class="ident" id="5011897">IF</span><span class="op" id="5011899">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011902">p</span><span class="op" id="5011903">.</span><span class="ident" id="5011904">openScope</span><span class="op" id="5011913">(</span><span class="op" id="5011914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011917">defer</span>&nbsp;<span class="ident" id="5011923">p</span><span class="op" id="5011924">.</span><span class="ident" id="5011925">closeScope</span><span class="op" id="5011935">(</span><span class="op" id="5011936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011940">var</span>&nbsp;<span class="ident" id="5011944">s</span>&nbsp;<span class="ident" id="5011946">ast</span><span class="op" id="5011949">.</span><span class="ident" id="5011950">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011956">var</span>&nbsp;<span class="ident" id="5011960">x</span>&nbsp;<span class="ident" id="5011962">ast</span><span class="op" id="5011965">.</span><span class="ident" id="5011966">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011976">prevLev</span>&nbsp;<span class="op" id="5011984">:=</span>&nbsp;<span class="ident" id="5011987">p</span><span class="op" id="5011988">.</span><span class="ident" id="5011989">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5011999">p</span><span class="op" id="5012000">.</span><span class="ident" id="5012001">exprLev</span>&nbsp;<span class="op" id="5012009">=</span>&nbsp;<span class="op" id="5012011">-</span><span class="num" id="5012012">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012016">if</span>&nbsp;<span class="ident" id="5012019">p</span><span class="op" id="5012020">.</span><span class="ident" id="5012021">tok</span>&nbsp;<span class="op" id="5012025">==</span>&nbsp;<span class="ident" id="5012028">token</span><span class="op" id="5012033">.</span><span class="ident" id="5012034">SEMICOLON</span>&nbsp;<span class="op" id="5012044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012049">p</span><span class="op" id="5012050">.</span><span class="ident" id="5012051">next</span><span class="op" id="5012055">(</span><span class="op" id="5012056">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012061">x</span>&nbsp;<span class="op" id="5012063">=</span>&nbsp;<span class="ident" id="5012065">p</span><span class="op" id="5012066">.</span><span class="ident" id="5012067">parseRhs</span><span class="op" id="5012075">(</span><span class="op" id="5012076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012080">}</span>&nbsp;<span class="keyword" id="5012082">else</span>&nbsp;<span class="op" id="5012087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012092">s</span><span class="op" id="5012093">,</span>&nbsp;<span class="ident" id="5012095">_</span>&nbsp;<span class="op" id="5012097">=</span>&nbsp;<span class="ident" id="5012099">p</span><span class="op" id="5012100">.</span><span class="ident" id="5012101">parseSimpleStmt</span><span class="op" id="5012116">(</span><span class="ident" id="5012117">basic</span><span class="op" id="5012122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012127">if</span>&nbsp;<span class="ident" id="5012130">p</span><span class="op" id="5012131">.</span><span class="ident" id="5012132">tok</span>&nbsp;<span class="op" id="5012136">==</span>&nbsp;<span class="ident" id="5012139">token</span><span class="op" id="5012144">.</span><span class="ident" id="5012145">SEMICOLON</span>&nbsp;<span class="op" id="5012155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012161">p</span><span class="op" id="5012162">.</span><span class="ident" id="5012163">next</span><span class="op" id="5012167">(</span><span class="op" id="5012168">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012174">x</span>&nbsp;<span class="op" id="5012176">=</span>&nbsp;<span class="ident" id="5012178">p</span><span class="op" id="5012179">.</span><span class="ident" id="5012180">parseRhs</span><span class="op" id="5012188">(</span><span class="op" id="5012189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012194">}</span>&nbsp;<span class="keyword" id="5012196">else</span>&nbsp;<span class="op" id="5012201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012207">x</span>&nbsp;<span class="op" id="5012209">=</span>&nbsp;<span class="ident" id="5012211">p</span><span class="op" id="5012212">.</span><span class="ident" id="5012213">makeExpr</span><span class="op" id="5012221">(</span><span class="ident" id="5012222">s</span><span class="op" id="5012223">,</span>&nbsp;<span class="string" id="5012225">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="5012245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012251">s</span>&nbsp;<span class="op" id="5012253">=</span>&nbsp;<span class="ident" id="5012255">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012262">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012270">p</span><span class="op" id="5012271">.</span><span class="ident" id="5012272">exprLev</span>&nbsp;<span class="op" id="5012280">=</span>&nbsp;<span class="ident" id="5012282">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012295">body</span>&nbsp;<span class="op" id="5012300">:=</span>&nbsp;<span class="ident" id="5012303">p</span><span class="op" id="5012304">.</span><span class="ident" id="5012305">parseBlockStmt</span><span class="op" id="5012319">(</span><span class="op" id="5012320">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012323">var</span>&nbsp;<span class="ident" id="5012327">else_</span>&nbsp;<span class="ident" id="5012333">ast</span><span class="op" id="5012336">.</span><span class="ident" id="5012337">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012343">if</span>&nbsp;<span class="ident" id="5012346">p</span><span class="op" id="5012347">.</span><span class="ident" id="5012348">tok</span>&nbsp;<span class="op" id="5012352">==</span>&nbsp;<span class="ident" id="5012355">token</span><span class="op" id="5012360">.</span><span class="ident" id="5012361">ELSE</span>&nbsp;<span class="op" id="5012366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012370">p</span><span class="op" id="5012371">.</span><span class="ident" id="5012372">next</span><span class="op" id="5012376">(</span><span class="op" id="5012377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012381">else_</span>&nbsp;<span class="op" id="5012387">=</span>&nbsp;<span class="ident" id="5012389">p</span><span class="op" id="5012390">.</span><span class="ident" id="5012391">parseStmt</span><span class="op" id="5012400">(</span><span class="op" id="5012401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012404">}</span>&nbsp;<span class="keyword" id="5012406">else</span>&nbsp;<span class="op" id="5012411">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012415">p</span><span class="op" id="5012416">.</span><span class="ident" id="5012417">expectSemi</span><span class="op" id="5012427">(</span><span class="op" id="5012428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012435">return</span>&nbsp;<span class="op" id="5012442">&amp;</span><span class="ident" id="5012443">ast</span><span class="op" id="5012446">.</span><span class="ident" id="5012447">IfStmt</span><span class="op" id="5012453">{</span><span class="ident" id="5012454">If</span><span class="op" id="5012456">:</span>&nbsp;<span class="ident" id="5012458">pos</span><span class="op" id="5012461">,</span>&nbsp;<span class="ident" id="5012463">Init</span><span class="op" id="5012467">:</span>&nbsp;<span class="ident" id="5012469">s</span><span class="op" id="5012470">,</span>&nbsp;<span class="ident" id="5012472">Cond</span><span class="op" id="5012476">:</span>&nbsp;<span class="ident" id="5012478">x</span><span class="op" id="5012479">,</span>&nbsp;<span class="ident" id="5012481">Body</span><span class="op" id="5012485">:</span>&nbsp;<span class="ident" id="5012487">body</span><span class="op" id="5012491">,</span>&nbsp;<span class="ident" id="5012493">Else</span><span class="op" id="5012497">:</span>&nbsp;<span class="ident" id="5012499">else_</span><span class="op" id="5012504">}</span><br>
<span class="lineno"></span><span class="op" id="5012506">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="5012509">func</span>&nbsp;<span class="op" id="5012514">(</span><span class="ident" id="5012515">p</span>&nbsp;<span class="op" id="5012517">*</span><span class="ident" id="5012518">parser</span><span class="op" id="5012524">)</span>&nbsp;<span class="ident" id="5012526">parseTypeList</span><span class="op" id="5012539">(</span><span class="op" id="5012540">)</span>&nbsp;<span class="op" id="5012542">(</span><span class="ident" id="5012543">list</span>&nbsp;<span class="op" id="5012548">[</span><span class="op" id="5012549">]</span><span class="ident" id="5012550">ast</span><span class="op" id="5012553">.</span><span class="ident" id="5012554">Expr</span><span class="op" id="5012558">)</span>&nbsp;<span class="op" id="5012560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012563">if</span>&nbsp;<span class="ident" id="5012566">p</span><span class="op" id="5012567">.</span><span class="ident" id="5012568">trace</span>&nbsp;<span class="op" id="5012574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012578">defer</span>&nbsp;<span class="ident" id="5012584">un</span><span class="op" id="5012586">(</span><span class="ident" id="5012587">trace</span><span class="op" id="5012592">(</span><span class="ident" id="5012593">p</span><span class="op" id="5012594">,</span>&nbsp;<span class="string" id="5012596">&#34;TypeList&#34;</span><span class="op" id="5012606">)</span><span class="op" id="5012607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012610">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012614">list</span>&nbsp;<span class="op" id="5012619">=</span>&nbsp;<span class="builtinfunc" id="5012621">append</span><span class="op" id="5012627">(</span><span class="ident" id="5012628">list</span><span class="op" id="5012632">,</span>&nbsp;<span class="ident" id="5012634">p</span><span class="op" id="5012635">.</span><span class="ident" id="5012636">parseType</span><span class="op" id="5012645">(</span><span class="op" id="5012646">)</span><span class="op" id="5012647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012650">for</span>&nbsp;<span class="ident" id="5012654">p</span><span class="op" id="5012655">.</span><span class="ident" id="5012656">tok</span>&nbsp;<span class="op" id="5012660">==</span>&nbsp;<span class="ident" id="5012663">token</span><span class="op" id="5012668">.</span><span class="ident" id="5012669">COMMA</span>&nbsp;<span class="op" id="5012675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012679">p</span><span class="op" id="5012680">.</span><span class="ident" id="5012681">next</span><span class="op" id="5012685">(</span><span class="op" id="5012686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012690">list</span>&nbsp;<span class="op" id="5012695">=</span>&nbsp;<span class="builtinfunc" id="5012697">append</span><span class="op" id="5012703">(</span><span class="ident" id="5012704">list</span><span class="op" id="5012708">,</span>&nbsp;<span class="ident" id="5012710">p</span><span class="op" id="5012711">.</span><span class="ident" id="5012712">parseType</span><span class="op" id="5012721">(</span><span class="op" id="5012722">)</span><span class="op" id="5012723">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012730">return</span><br>
<span class="lineno"></span><span class="op" id="5012737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="5012740">func</span>&nbsp;<span class="op" id="5012745">(</span><span class="ident" id="5012746">p</span>&nbsp;<span class="op" id="5012748">*</span><span class="ident" id="5012749">parser</span><span class="op" id="5012755">)</span>&nbsp;<span class="ident" id="5012757">parseCaseClause</span><span class="op" id="5012772">(</span><span class="ident" id="5012773">typeSwitch</span>&nbsp;<span class="builtintype" id="5012784">bool</span><span class="op" id="5012788">)</span>&nbsp;<span class="op" id="5012790">*</span><span class="ident" id="5012791">ast</span><span class="op" id="5012794">.</span><span class="ident" id="5012795">CaseClause</span>&nbsp;<span class="op" id="5012806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012809">if</span>&nbsp;<span class="ident" id="5012812">p</span><span class="op" id="5012813">.</span><span class="ident" id="5012814">trace</span>&nbsp;<span class="op" id="5012820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012824">defer</span>&nbsp;<span class="ident" id="5012830">un</span><span class="op" id="5012832">(</span><span class="ident" id="5012833">trace</span><span class="op" id="5012838">(</span><span class="ident" id="5012839">p</span><span class="op" id="5012840">,</span>&nbsp;<span class="string" id="5012842">&#34;CaseClause&#34;</span><span class="op" id="5012854">)</span><span class="op" id="5012855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012862">pos</span>&nbsp;<span class="op" id="5012866">:=</span>&nbsp;<span class="ident" id="5012869">p</span><span class="op" id="5012870">.</span><span class="ident" id="5012871">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012876">var</span>&nbsp;<span class="ident" id="5012880">list</span>&nbsp;<span class="op" id="5012885">[</span><span class="op" id="5012886">]</span><span class="ident" id="5012887">ast</span><span class="op" id="5012890">.</span><span class="ident" id="5012891">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012897">if</span>&nbsp;<span class="ident" id="5012900">p</span><span class="op" id="5012901">.</span><span class="ident" id="5012902">tok</span>&nbsp;<span class="op" id="5012906">==</span>&nbsp;<span class="ident" id="5012909">token</span><span class="op" id="5012914">.</span><span class="ident" id="5012915">CASE</span>&nbsp;<span class="op" id="5012920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012924">p</span><span class="op" id="5012925">.</span><span class="ident" id="5012926">next</span><span class="op" id="5012930">(</span><span class="op" id="5012931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012935">if</span>&nbsp;<span class="ident" id="5012938">typeSwitch</span>&nbsp;<span class="op" id="5012949">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012954">list</span>&nbsp;<span class="op" id="5012959">=</span>&nbsp;<span class="ident" id="5012961">p</span><span class="op" id="5012962">.</span><span class="ident" id="5012963">parseTypeList</span><span class="op" id="5012976">(</span><span class="op" id="5012977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012981">}</span>&nbsp;<span class="keyword" id="5012983">else</span>&nbsp;<span class="op" id="5012988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012993">list</span>&nbsp;<span class="op" id="5012998">=</span>&nbsp;<span class="ident" id="5013000">p</span><span class="op" id="5013001">.</span><span class="ident" id="5013002">parseRhsList</span><span class="op" id="5013014">(</span><span class="op" id="5013015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013022">}</span>&nbsp;<span class="keyword" id="5013024">else</span>&nbsp;<span class="op" id="5013029">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013033">p</span><span class="op" id="5013034">.</span><span class="ident" id="5013035">expect</span><span class="op" id="5013041">(</span><span class="ident" id="5013042">token</span><span class="op" id="5013047">.</span><span class="ident" id="5013048">DEFAULT</span><span class="op" id="5013055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013062">colon</span>&nbsp;<span class="op" id="5013068">:=</span>&nbsp;<span class="ident" id="5013071">p</span><span class="op" id="5013072">.</span><span class="ident" id="5013073">expect</span><span class="op" id="5013079">(</span><span class="ident" id="5013080">token</span><span class="op" id="5013085">.</span><span class="ident" id="5013086">COLON</span><span class="op" id="5013091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013094">p</span><span class="op" id="5013095">.</span><span class="ident" id="5013096">openScope</span><span class="op" id="5013105">(</span><span class="op" id="5013106">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013109">body</span>&nbsp;<span class="op" id="5013114">:=</span>&nbsp;<span class="ident" id="5013117">p</span><span class="op" id="5013118">.</span><span class="ident" id="5013119">parseStmtList</span><span class="op" id="5013132">(</span><span class="op" id="5013133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013136">p</span><span class="op" id="5013137">.</span><span class="ident" id="5013138">closeScope</span><span class="op" id="5013148">(</span><span class="op" id="5013149">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013153">return</span>&nbsp;<span class="op" id="5013160">&amp;</span><span class="ident" id="5013161">ast</span><span class="op" id="5013164">.</span><span class="ident" id="5013165">CaseClause</span><span class="op" id="5013175">{</span><span class="ident" id="5013176">Case</span><span class="op" id="5013180">:</span>&nbsp;<span class="ident" id="5013182">pos</span><span class="op" id="5013185">,</span>&nbsp;<span class="ident" id="5013187">List</span><span class="op" id="5013191">:</span>&nbsp;<span class="ident" id="5013193">list</span><span class="op" id="5013197">,</span>&nbsp;<span class="ident" id="5013199">Colon</span><span class="op" id="5013204">:</span>&nbsp;<span class="ident" id="5013206">colon</span><span class="op" id="5013211">,</span>&nbsp;<span class="ident" id="5013213">Body</span><span class="op" id="5013217">:</span>&nbsp;<span class="ident" id="5013219">body</span><span class="op" id="5013223">}</span><br>
<span class="lineno"></span><span class="op" id="5013225">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="5013228">func</span>&nbsp;<span class="ident" id="5013233">isTypeSwitchAssert</span><span class="op" id="5013251">(</span><span class="ident" id="5013252">x</span>&nbsp;<span class="ident" id="5013254">ast</span><span class="op" id="5013257">.</span><span class="ident" id="5013258">Expr</span><span class="op" id="5013262">)</span>&nbsp;<span class="builtintype" id="5013264">bool</span>&nbsp;<span class="op" id="5013269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013272">a</span><span class="op" id="5013273">,</span>&nbsp;<span class="ident" id="5013275">ok</span>&nbsp;<span class="op" id="5013278">:=</span>&nbsp;<span class="ident" id="5013281">x</span><span class="op" id="5013282">.</span><span class="op" id="5013283">(</span><span class="op" id="5013284">*</span><span class="ident" id="5013285">ast</span><span class="op" id="5013288">.</span><span class="ident" id="5013289">TypeAssertExpr</span><span class="op" id="5013303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013306">return</span>&nbsp;<span class="ident" id="5013313">ok</span>&nbsp;<span class="op" id="5013316">&amp;&amp;</span>&nbsp;<span class="ident" id="5013319">a</span><span class="op" id="5013320">.</span><span class="ident" id="5013321">Type</span>&nbsp;<span class="op" id="5013326">==</span>&nbsp;<span class="ident" id="5013329">nil</span><br>
<span class="lineno"></span><span class="op" id="5013333">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="5013336">func</span>&nbsp;<span class="ident" id="5013341">isTypeSwitchGuard</span><span class="op" id="5013358">(</span><span class="ident" id="5013359">s</span>&nbsp;<span class="ident" id="5013361">ast</span><span class="op" id="5013364">.</span><span class="ident" id="5013365">Stmt</span><span class="op" id="5013369">)</span>&nbsp;<span class="builtintype" id="5013371">bool</span>&nbsp;<span class="op" id="5013376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013379">switch</span>&nbsp;<span class="ident" id="5013386">t</span>&nbsp;<span class="op" id="5013388">:=</span>&nbsp;<span class="ident" id="5013391">s</span><span class="op" id="5013392">.</span><span class="op" id="5013393">(</span><span class="keyword" id="5013394">type</span><span class="op" id="5013398">)</span>&nbsp;<span class="op" id="5013400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013403">case</span>&nbsp;<span class="op" id="5013408">*</span><span class="ident" id="5013409">ast</span><span class="op" id="5013412">.</span><span class="ident" id="5013413">ExprStmt</span><span class="op" id="5013421">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5013425">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013438">return</span>&nbsp;<span class="ident" id="5013445">isTypeSwitchAssert</span><span class="op" id="5013463">(</span><span class="ident" id="5013464">t</span><span class="op" id="5013465">.</span><span class="ident" id="5013466">X</span><span class="op" id="5013467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013470">case</span>&nbsp;<span class="op" id="5013475">*</span><span class="ident" id="5013476">ast</span><span class="op" id="5013479">.</span><span class="ident" id="5013480">AssignStmt</span><span class="op" id="5013490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5013494">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013512">return</span>&nbsp;<span class="builtinfunc" id="5013519">len</span><span class="op" id="5013522">(</span><span class="ident" id="5013523">t</span><span class="op" id="5013524">.</span><span class="ident" id="5013525">Lhs</span><span class="op" id="5013528">)</span>&nbsp;<span class="op" id="5013530">==</span>&nbsp;<span class="num" id="5013533">1</span>&nbsp;<span class="op" id="5013535">&amp;&amp;</span>&nbsp;<span class="ident" id="5013538">t</span><span class="op" id="5013539">.</span><span class="ident" id="5013540">Tok</span>&nbsp;<span class="op" id="5013544">==</span>&nbsp;<span class="ident" id="5013547">token</span><span class="op" id="5013552">.</span><span class="ident" id="5013553">DEFINE</span>&nbsp;<span class="op" id="5013560">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5013563">len</span><span class="op" id="5013566">(</span><span class="ident" id="5013567">t</span><span class="op" id="5013568">.</span><span class="ident" id="5013569">Rhs</span><span class="op" id="5013572">)</span>&nbsp;<span class="op" id="5013574">==</span>&nbsp;<span class="num" id="5013577">1</span>&nbsp;<span class="op" id="5013579">&amp;&amp;</span>&nbsp;<span class="ident" id="5013582">isTypeSwitchAssert</span><span class="op" id="5013600">(</span><span class="ident" id="5013601">t</span><span class="op" id="5013602">.</span><span class="ident" id="5013603">Rhs</span><span class="op" id="5013606">[</span><span class="num" id="5013607">0</span><span class="op" id="5013608">]</span><span class="op" id="5013609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013612">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013615">return</span>&nbsp;<span class="builtintype" id="5013622">false</span><br>
<span class="lineno"></span><span class="op" id="5013628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5013631">func</span>&nbsp;<span class="op" id="5013636">(</span><span class="ident" id="5013637">p</span>&nbsp;<span class="op" id="5013639">*</span><span class="ident" id="5013640">parser</span><span class="op" id="5013646">)</span>&nbsp;<span class="ident" id="5013648">parseSwitchStmt</span><span class="op" id="5013663">(</span><span class="op" id="5013664">)</span>&nbsp;<span class="ident" id="5013666">ast</span><span class="op" id="5013669">.</span><span class="ident" id="5013670">Stmt</span>&nbsp;<span class="op" id="5013675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013678">if</span>&nbsp;<span class="ident" id="5013681">p</span><span class="op" id="5013682">.</span><span class="ident" id="5013683">trace</span>&nbsp;<span class="op" id="5013689">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013693">defer</span>&nbsp;<span class="ident" id="5013699">un</span><span class="op" id="5013701">(</span><span class="ident" id="5013702">trace</span><span class="op" id="5013707">(</span><span class="ident" id="5013708">p</span><span class="op" id="5013709">,</span>&nbsp;<span class="string" id="5013711">&#34;SwitchStmt&#34;</span><span class="op" id="5013723">)</span><span class="op" id="5013724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013731">pos</span>&nbsp;<span class="op" id="5013735">:=</span>&nbsp;<span class="ident" id="5013738">p</span><span class="op" id="5013739">.</span><span class="ident" id="5013740">expect</span><span class="op" id="5013746">(</span><span class="ident" id="5013747">token</span><span class="op" id="5013752">.</span><span class="ident" id="5013753">SWITCH</span><span class="op" id="5013759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013762">p</span><span class="op" id="5013763">.</span><span class="ident" id="5013764">openScope</span><span class="op" id="5013773">(</span><span class="op" id="5013774">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013777">defer</span>&nbsp;<span class="ident" id="5013783">p</span><span class="op" id="5013784">.</span><span class="ident" id="5013785">closeScope</span><span class="op" id="5013795">(</span><span class="op" id="5013796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013800">var</span>&nbsp;<span class="ident" id="5013804">s1</span><span class="op" id="5013806">,</span>&nbsp;<span class="ident" id="5013808">s2</span>&nbsp;<span class="ident" id="5013811">ast</span><span class="op" id="5013814">.</span><span class="ident" id="5013815">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013821">if</span>&nbsp;<span class="ident" id="5013824">p</span><span class="op" id="5013825">.</span><span class="ident" id="5013826">tok</span>&nbsp;<span class="op" id="5013830">!=</span>&nbsp;<span class="ident" id="5013833">token</span><span class="op" id="5013838">.</span><span class="ident" id="5013839">LBRACE</span>&nbsp;<span class="op" id="5013846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013850">prevLev</span>&nbsp;<span class="op" id="5013858">:=</span>&nbsp;<span class="ident" id="5013861">p</span><span class="op" id="5013862">.</span><span class="ident" id="5013863">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013873">p</span><span class="op" id="5013874">.</span><span class="ident" id="5013875">exprLev</span>&nbsp;<span class="op" id="5013883">=</span>&nbsp;<span class="op" id="5013885">-</span><span class="num" id="5013886">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013890">if</span>&nbsp;<span class="ident" id="5013893">p</span><span class="op" id="5013894">.</span><span class="ident" id="5013895">tok</span>&nbsp;<span class="op" id="5013899">!=</span>&nbsp;<span class="ident" id="5013902">token</span><span class="op" id="5013907">.</span><span class="ident" id="5013908">SEMICOLON</span>&nbsp;<span class="op" id="5013918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013923">s2</span><span class="op" id="5013925">,</span>&nbsp;<span class="ident" id="5013927">_</span>&nbsp;<span class="op" id="5013929">=</span>&nbsp;<span class="ident" id="5013931">p</span><span class="op" id="5013932">.</span><span class="ident" id="5013933">parseSimpleStmt</span><span class="op" id="5013948">(</span><span class="ident" id="5013949">basic</span><span class="op" id="5013954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013962">if</span>&nbsp;<span class="ident" id="5013965">p</span><span class="op" id="5013966">.</span><span class="ident" id="5013967">tok</span>&nbsp;<span class="op" id="5013971">==</span>&nbsp;<span class="ident" id="5013974">token</span><span class="op" id="5013979">.</span><span class="ident" id="5013980">SEMICOLON</span>&nbsp;<span class="op" id="5013990">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013995">p</span><span class="op" id="5013996">.</span><span class="ident" id="5013997">next</span><span class="op" id="5014001">(</span><span class="op" id="5014002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014007">s1</span>&nbsp;<span class="op" id="5014010">=</span>&nbsp;<span class="ident" id="5014012">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014018">s2</span>&nbsp;<span class="op" id="5014021">=</span>&nbsp;<span class="ident" id="5014023">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014030">if</span>&nbsp;<span class="ident" id="5014033">p</span><span class="op" id="5014034">.</span><span class="ident" id="5014035">tok</span>&nbsp;<span class="op" id="5014039">!=</span>&nbsp;<span class="ident" id="5014042">token</span><span class="op" id="5014047">.</span><span class="ident" id="5014048">LBRACE</span>&nbsp;<span class="op" id="5014055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014061">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014121">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014180">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014240">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014247">//&nbsp;&nbsp;&nbsp;&nbspswitch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014288">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014295">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014349">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014409">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014464">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014471">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5014536">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014600">p</span><span class="op" id="5014601">.</span><span class="ident" id="5014602">openScope</span><span class="op" id="5014611">(</span><span class="op" id="5014612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014618">defer</span>&nbsp;<span class="ident" id="5014624">p</span><span class="op" id="5014625">.</span><span class="ident" id="5014626">closeScope</span><span class="op" id="5014636">(</span><span class="op" id="5014637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014643">s2</span><span class="op" id="5014645">,</span>&nbsp;<span class="ident" id="5014647">_</span>&nbsp;<span class="op" id="5014649">=</span>&nbsp;<span class="ident" id="5014651">p</span><span class="op" id="5014652">.</span><span class="ident" id="5014653">parseSimpleStmt</span><span class="op" id="5014668">(</span><span class="ident" id="5014669">basic</span><span class="op" id="5014674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014679">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014687">p</span><span class="op" id="5014688">.</span><span class="ident" id="5014689">exprLev</span>&nbsp;<span class="op" id="5014697">=</span>&nbsp;<span class="ident" id="5014699">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014712">typeSwitch</span>&nbsp;<span class="op" id="5014723">:=</span>&nbsp;<span class="ident" id="5014726">isTypeSwitchGuard</span><span class="op" id="5014743">(</span><span class="ident" id="5014744">s2</span><span class="op" id="5014746">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014749">lbrace</span>&nbsp;<span class="op" id="5014756">:=</span>&nbsp;<span class="ident" id="5014759">p</span><span class="op" id="5014760">.</span><span class="ident" id="5014761">expect</span><span class="op" id="5014767">(</span><span class="ident" id="5014768">token</span><span class="op" id="5014773">.</span><span class="ident" id="5014774">LBRACE</span><span class="op" id="5014780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014783">var</span>&nbsp;<span class="ident" id="5014787">list</span>&nbsp;<span class="op" id="5014792">[</span><span class="op" id="5014793">]</span><span class="ident" id="5014794">ast</span><span class="op" id="5014797">.</span><span class="ident" id="5014798">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014804">for</span>&nbsp;<span class="ident" id="5014808">p</span><span class="op" id="5014809">.</span><span class="ident" id="5014810">tok</span>&nbsp;<span class="op" id="5014814">==</span>&nbsp;<span class="ident" id="5014817">token</span><span class="op" id="5014822">.</span><span class="ident" id="5014823">CASE</span>&nbsp;<span class="op" id="5014828">||</span>&nbsp;<span class="ident" id="5014831">p</span><span class="op" id="5014832">.</span><span class="ident" id="5014833">tok</span>&nbsp;<span class="op" id="5014837">==</span>&nbsp;<span class="ident" id="5014840">token</span><span class="op" id="5014845">.</span><span class="ident" id="5014846">DEFAULT</span>&nbsp;<span class="op" id="5014854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014858">list</span>&nbsp;<span class="op" id="5014863">=</span>&nbsp;<span class="builtinfunc" id="5014865">append</span><span class="op" id="5014871">(</span><span class="ident" id="5014872">list</span><span class="op" id="5014876">,</span>&nbsp;<span class="ident" id="5014878">p</span><span class="op" id="5014879">.</span><span class="ident" id="5014880">parseCaseClause</span><span class="op" id="5014895">(</span><span class="ident" id="5014896">typeSwitch</span><span class="op" id="5014906">)</span><span class="op" id="5014907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014910">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014913">rbrace</span>&nbsp;<span class="op" id="5014920">:=</span>&nbsp;<span class="ident" id="5014923">p</span><span class="op" id="5014924">.</span><span class="ident" id="5014925">expect</span><span class="op" id="5014931">(</span><span class="ident" id="5014932">token</span><span class="op" id="5014937">.</span><span class="ident" id="5014938">RBRACE</span><span class="op" id="5014944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014947">p</span><span class="op" id="5014948">.</span><span class="ident" id="5014949">expectSemi</span><span class="op" id="5014959">(</span><span class="op" id="5014960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5014963">body</span>&nbsp;<span class="op" id="5014968">:=</span>&nbsp;<span class="op" id="5014971">&amp;</span><span class="ident" id="5014972">ast</span><span class="op" id="5014975">.</span><span class="ident" id="5014976">BlockStmt</span><span class="op" id="5014985">{</span><span class="ident" id="5014986">Lbrace</span><span class="op" id="5014992">:</span>&nbsp;<span class="ident" id="5014994">lbrace</span><span class="op" id="5015000">,</span>&nbsp;<span class="ident" id="5015002">List</span><span class="op" id="5015006">:</span>&nbsp;<span class="ident" id="5015008">list</span><span class="op" id="5015012">,</span>&nbsp;<span class="ident" id="5015014">Rbrace</span><span class="op" id="5015020">:</span>&nbsp;<span class="ident" id="5015022">rbrace</span><span class="op" id="5015028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015032">if</span>&nbsp;<span class="ident" id="5015035">typeSwitch</span>&nbsp;<span class="op" id="5015046">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015050">return</span>&nbsp;<span class="op" id="5015057">&amp;</span><span class="ident" id="5015058">ast</span><span class="op" id="5015061">.</span><span class="ident" id="5015062">TypeSwitchStmt</span><span class="op" id="5015076">{</span><span class="ident" id="5015077">Switch</span><span class="op" id="5015083">:</span>&nbsp;<span class="ident" id="5015085">pos</span><span class="op" id="5015088">,</span>&nbsp;<span class="ident" id="5015090">Init</span><span class="op" id="5015094">:</span>&nbsp;<span class="ident" id="5015096">s1</span><span class="op" id="5015098">,</span>&nbsp;<span class="ident" id="5015100">Assign</span><span class="op" id="5015106">:</span>&nbsp;<span class="ident" id="5015108">s2</span><span class="op" id="5015110">,</span>&nbsp;<span class="ident" id="5015112">Body</span><span class="op" id="5015116">:</span>&nbsp;<span class="ident" id="5015118">body</span><span class="op" id="5015122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015129">return</span>&nbsp;<span class="op" id="5015136">&amp;</span><span class="ident" id="5015137">ast</span><span class="op" id="5015140">.</span><span class="ident" id="5015141">SwitchStmt</span><span class="op" id="5015151">{</span><span class="ident" id="5015152">Switch</span><span class="op" id="5015158">:</span>&nbsp;<span class="ident" id="5015160">pos</span><span class="op" id="5015163">,</span>&nbsp;<span class="ident" id="5015165">Init</span><span class="op" id="5015169">:</span>&nbsp;<span class="ident" id="5015171">s1</span><span class="op" id="5015173">,</span>&nbsp;<span class="ident" id="5015175">Tag</span><span class="op" id="5015178">:</span>&nbsp;<span class="ident" id="5015180">p</span><span class="op" id="5015181">.</span><span class="ident" id="5015182">makeExpr</span><span class="op" id="5015190">(</span><span class="ident" id="5015191">s2</span><span class="op" id="5015193">,</span>&nbsp;<span class="string" id="5015195">&#34;switch&nbsp;expression&#34;</span><span class="op" id="5015214">)</span><span class="op" id="5015215">,</span>&nbsp;<span class="ident" id="5015217">Body</span><span class="op" id="5015221">:</span>&nbsp;<span class="ident" id="5015223">body</span><span class="op" id="5015227">}</span><br>
<span class="lineno"></span><span class="op" id="5015229">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="5015232">func</span>&nbsp;<span class="op" id="5015237">(</span><span class="ident" id="5015238">p</span>&nbsp;<span class="op" id="5015240">*</span><span class="ident" id="5015241">parser</span><span class="op" id="5015247">)</span>&nbsp;<span class="ident" id="5015249">parseCommClause</span><span class="op" id="5015264">(</span><span class="op" id="5015265">)</span>&nbsp;<span class="op" id="5015267">*</span><span class="ident" id="5015268">ast</span><span class="op" id="5015271">.</span><span class="ident" id="5015272">CommClause</span>&nbsp;<span class="op" id="5015283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015286">if</span>&nbsp;<span class="ident" id="5015289">p</span><span class="op" id="5015290">.</span><span class="ident" id="5015291">trace</span>&nbsp;<span class="op" id="5015297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015301">defer</span>&nbsp;<span class="ident" id="5015307">un</span><span class="op" id="5015309">(</span><span class="ident" id="5015310">trace</span><span class="op" id="5015315">(</span><span class="ident" id="5015316">p</span><span class="op" id="5015317">,</span>&nbsp;<span class="string" id="5015319">&#34;CommClause&#34;</span><span class="op" id="5015331">)</span><span class="op" id="5015332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015335">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015339">p</span><span class="op" id="5015340">.</span><span class="ident" id="5015341">openScope</span><span class="op" id="5015350">(</span><span class="op" id="5015351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015354">pos</span>&nbsp;<span class="op" id="5015358">:=</span>&nbsp;<span class="ident" id="5015361">p</span><span class="op" id="5015362">.</span><span class="ident" id="5015363">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015368">var</span>&nbsp;<span class="ident" id="5015372">comm</span>&nbsp;<span class="ident" id="5015377">ast</span><span class="op" id="5015380">.</span><span class="ident" id="5015381">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015387">if</span>&nbsp;<span class="ident" id="5015390">p</span><span class="op" id="5015391">.</span><span class="ident" id="5015392">tok</span>&nbsp;<span class="op" id="5015396">==</span>&nbsp;<span class="ident" id="5015399">token</span><span class="op" id="5015404">.</span><span class="ident" id="5015405">CASE</span>&nbsp;<span class="op" id="5015410">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015414">p</span><span class="op" id="5015415">.</span><span class="ident" id="5015416">next</span><span class="op" id="5015420">(</span><span class="op" id="5015421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015425">lhs</span>&nbsp;<span class="op" id="5015429">:=</span>&nbsp;<span class="ident" id="5015432">p</span><span class="op" id="5015433">.</span><span class="ident" id="5015434">parseLhsList</span><span class="op" id="5015446">(</span><span class="op" id="5015447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015451">if</span>&nbsp;<span class="ident" id="5015454">p</span><span class="op" id="5015455">.</span><span class="ident" id="5015456">tok</span>&nbsp;<span class="op" id="5015460">==</span>&nbsp;<span class="ident" id="5015463">token</span><span class="op" id="5015468">.</span><span class="ident" id="5015469">ARROW</span>&nbsp;<span class="op" id="5015475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015480">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015495">if</span>&nbsp;<span class="builtinfunc" id="5015498">len</span><span class="op" id="5015501">(</span><span class="ident" id="5015502">lhs</span><span class="op" id="5015505">)</span>&nbsp;<span class="op" id="5015507">&gt;</span>&nbsp;<span class="num" id="5015509">1</span>&nbsp;<span class="op" id="5015511">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015517">p</span><span class="op" id="5015518">.</span><span class="ident" id="5015519">errorExpected</span><span class="op" id="5015532">(</span><span class="ident" id="5015533">lhs</span><span class="op" id="5015536">[</span><span class="num" id="5015537">0</span><span class="op" id="5015538">]</span><span class="op" id="5015539">.</span><span class="ident" id="5015540">Pos</span><span class="op" id="5015543">(</span><span class="op" id="5015544">)</span><span class="op" id="5015545">,</span>&nbsp;<span class="string" id="5015547">&#34;1&nbsp;expression&#34;</span><span class="op" id="5015561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015567">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015609">arrow</span>&nbsp;<span class="op" id="5015615">:=</span>&nbsp;<span class="ident" id="5015618">p</span><span class="op" id="5015619">.</span><span class="ident" id="5015620">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015627">p</span><span class="op" id="5015628">.</span><span class="ident" id="5015629">next</span><span class="op" id="5015633">(</span><span class="op" id="5015634">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015639">rhs</span>&nbsp;<span class="op" id="5015643">:=</span>&nbsp;<span class="ident" id="5015646">p</span><span class="op" id="5015647">.</span><span class="ident" id="5015648">parseRhs</span><span class="op" id="5015656">(</span><span class="op" id="5015657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015662">comm</span>&nbsp;<span class="op" id="5015667">=</span>&nbsp;<span class="op" id="5015669">&amp;</span><span class="ident" id="5015670">ast</span><span class="op" id="5015673">.</span><span class="ident" id="5015674">SendStmt</span><span class="op" id="5015682">{</span><span class="ident" id="5015683">Chan</span><span class="op" id="5015687">:</span>&nbsp;<span class="ident" id="5015689">lhs</span><span class="op" id="5015692">[</span><span class="num" id="5015693">0</span><span class="op" id="5015694">]</span><span class="op" id="5015695">,</span>&nbsp;<span class="ident" id="5015697">Arrow</span><span class="op" id="5015702">:</span>&nbsp;<span class="ident" id="5015704">arrow</span><span class="op" id="5015709">,</span>&nbsp;<span class="ident" id="5015711">Value</span><span class="op" id="5015716">:</span>&nbsp;<span class="ident" id="5015718">rhs</span><span class="op" id="5015721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015725">}</span>&nbsp;<span class="keyword" id="5015727">else</span>&nbsp;<span class="op" id="5015732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015737">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015752">if</span>&nbsp;<span class="ident" id="5015755">tok</span>&nbsp;<span class="op" id="5015759">:=</span>&nbsp;<span class="ident" id="5015762">p</span><span class="op" id="5015763">.</span><span class="ident" id="5015764">tok</span><span class="op" id="5015767">;</span>&nbsp;<span class="ident" id="5015769">tok</span>&nbsp;<span class="op" id="5015773">==</span>&nbsp;<span class="ident" id="5015776">token</span><span class="op" id="5015781">.</span><span class="ident" id="5015782">ASSIGN</span>&nbsp;<span class="op" id="5015789">||</span>&nbsp;<span class="ident" id="5015792">tok</span>&nbsp;<span class="op" id="5015796">==</span>&nbsp;<span class="ident" id="5015799">token</span><span class="op" id="5015804">.</span><span class="ident" id="5015805">DEFINE</span>&nbsp;<span class="op" id="5015812">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015818">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015850">if</span>&nbsp;<span class="builtinfunc" id="5015853">len</span><span class="op" id="5015856">(</span><span class="ident" id="5015857">lhs</span><span class="op" id="5015860">)</span>&nbsp;<span class="op" id="5015862">&gt;</span>&nbsp;<span class="num" id="5015864">2</span>&nbsp;<span class="op" id="5015866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015873">p</span><span class="op" id="5015874">.</span><span class="ident" id="5015875">errorExpected</span><span class="op" id="5015888">(</span><span class="ident" id="5015889">lhs</span><span class="op" id="5015892">[</span><span class="num" id="5015893">0</span><span class="op" id="5015894">]</span><span class="op" id="5015895">.</span><span class="ident" id="5015896">Pos</span><span class="op" id="5015899">(</span><span class="op" id="5015900">)</span><span class="op" id="5015901">,</span>&nbsp;<span class="string" id="5015903">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5015923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5015930">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015974">lhs</span>&nbsp;<span class="op" id="5015978">=</span>&nbsp;<span class="ident" id="5015980">lhs</span><span class="op" id="5015983">[</span><span class="num" id="5015984">0</span><span class="op" id="5015985">:</span><span class="num" id="5015986">2</span><span class="op" id="5015987">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015999">pos</span>&nbsp;<span class="op" id="5016003">:=</span>&nbsp;<span class="ident" id="5016006">p</span><span class="op" id="5016007">.</span><span class="ident" id="5016008">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016016">p</span><span class="op" id="5016017">.</span><span class="ident" id="5016018">next</span><span class="op" id="5016022">(</span><span class="op" id="5016023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016029">rhs</span>&nbsp;<span class="op" id="5016033">:=</span>&nbsp;<span class="ident" id="5016036">p</span><span class="op" id="5016037">.</span><span class="ident" id="5016038">parseRhs</span><span class="op" id="5016046">(</span><span class="op" id="5016047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016053">as</span>&nbsp;<span class="op" id="5016056">:=</span>&nbsp;<span class="op" id="5016059">&amp;</span><span class="ident" id="5016060">ast</span><span class="op" id="5016063">.</span><span class="ident" id="5016064">AssignStmt</span><span class="op" id="5016074">{</span><span class="ident" id="5016075">Lhs</span><span class="op" id="5016078">:</span>&nbsp;<span class="ident" id="5016080">lhs</span><span class="op" id="5016083">,</span>&nbsp;<span class="ident" id="5016085">TokPos</span><span class="op" id="5016091">:</span>&nbsp;<span class="ident" id="5016093">pos</span><span class="op" id="5016096">,</span>&nbsp;<span class="ident" id="5016098">Tok</span><span class="op" id="5016101">:</span>&nbsp;<span class="ident" id="5016103">tok</span><span class="op" id="5016106">,</span>&nbsp;<span class="ident" id="5016108">Rhs</span><span class="op" id="5016111">:</span>&nbsp;<span class="op" id="5016113">[</span><span class="op" id="5016114">]</span><span class="ident" id="5016115">ast</span><span class="op" id="5016118">.</span><span class="ident" id="5016119">Expr</span><span class="op" id="5016123">{</span><span class="ident" id="5016124">rhs</span><span class="op" id="5016127">}</span><span class="op" id="5016128">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016134">if</span>&nbsp;<span class="ident" id="5016137">tok</span>&nbsp;<span class="op" id="5016141">==</span>&nbsp;<span class="ident" id="5016144">token</span><span class="op" id="5016149">.</span><span class="ident" id="5016150">DEFINE</span>&nbsp;<span class="op" id="5016157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016164">p</span><span class="op" id="5016165">.</span><span class="ident" id="5016166">shortVarDecl</span><span class="op" id="5016178">(</span><span class="ident" id="5016179">as</span><span class="op" id="5016181">,</span>&nbsp;<span class="ident" id="5016183">lhs</span><span class="op" id="5016186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016198">comm</span>&nbsp;<span class="op" id="5016203">=</span>&nbsp;<span class="ident" id="5016205">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016211">}</span>&nbsp;<span class="keyword" id="5016213">else</span>&nbsp;<span class="op" id="5016218">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016224">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016268">if</span>&nbsp;<span class="builtinfunc" id="5016271">len</span><span class="op" id="5016274">(</span><span class="ident" id="5016275">lhs</span><span class="op" id="5016278">)</span>&nbsp;<span class="op" id="5016280">&gt;</span>&nbsp;<span class="num" id="5016282">1</span>&nbsp;<span class="op" id="5016284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016291">p</span><span class="op" id="5016292">.</span><span class="ident" id="5016293">errorExpected</span><span class="op" id="5016306">(</span><span class="ident" id="5016307">lhs</span><span class="op" id="5016310">[</span><span class="num" id="5016311">0</span><span class="op" id="5016312">]</span><span class="op" id="5016313">.</span><span class="ident" id="5016314">Pos</span><span class="op" id="5016317">(</span><span class="op" id="5016318">)</span><span class="op" id="5016319">,</span>&nbsp;<span class="string" id="5016321">&#34;1&nbsp;expression&#34;</span><span class="op" id="5016335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016342">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016380">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016386">comm</span>&nbsp;<span class="op" id="5016391">=</span>&nbsp;<span class="op" id="5016393">&amp;</span><span class="ident" id="5016394">ast</span><span class="op" id="5016397">.</span><span class="ident" id="5016398">ExprStmt</span><span class="op" id="5016406">{</span><span class="ident" id="5016407">X</span><span class="op" id="5016408">:</span>&nbsp;<span class="ident" id="5016410">lhs</span><span class="op" id="5016413">[</span><span class="num" id="5016414">0</span><span class="op" id="5016415">]</span><span class="op" id="5016416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016428">}</span>&nbsp;<span class="keyword" id="5016430">else</span>&nbsp;<span class="op" id="5016435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016439">p</span><span class="op" id="5016440">.</span><span class="ident" id="5016441">expect</span><span class="op" id="5016447">(</span><span class="ident" id="5016448">token</span><span class="op" id="5016453">.</span><span class="ident" id="5016454">DEFAULT</span><span class="op" id="5016461">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016468">colon</span>&nbsp;<span class="op" id="5016474">:=</span>&nbsp;<span class="ident" id="5016477">p</span><span class="op" id="5016478">.</span><span class="ident" id="5016479">expect</span><span class="op" id="5016485">(</span><span class="ident" id="5016486">token</span><span class="op" id="5016491">.</span><span class="ident" id="5016492">COLON</span><span class="op" id="5016497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016500">body</span>&nbsp;<span class="op" id="5016505">:=</span>&nbsp;<span class="ident" id="5016508">p</span><span class="op" id="5016509">.</span><span class="ident" id="5016510">parseStmtList</span><span class="op" id="5016523">(</span><span class="op" id="5016524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016527">p</span><span class="op" id="5016528">.</span><span class="ident" id="5016529">closeScope</span><span class="op" id="5016539">(</span><span class="op" id="5016540">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016544">return</span>&nbsp;<span class="op" id="5016551">&amp;</span><span class="ident" id="5016552">ast</span><span class="op" id="5016555">.</span><span class="ident" id="5016556">CommClause</span><span class="op" id="5016566">{</span><span class="ident" id="5016567">Case</span><span class="op" id="5016571">:</span>&nbsp;<span class="ident" id="5016573">pos</span><span class="op" id="5016576">,</span>&nbsp;<span class="ident" id="5016578">Comm</span><span class="op" id="5016582">:</span>&nbsp;<span class="ident" id="5016584">comm</span><span class="op" id="5016588">,</span>&nbsp;<span class="ident" id="5016590">Colon</span><span class="op" id="5016595">:</span>&nbsp;<span class="ident" id="5016597">colon</span><span class="op" id="5016602">,</span>&nbsp;<span class="ident" id="5016604">Body</span><span class="op" id="5016608">:</span>&nbsp;<span class="ident" id="5016610">body</span><span class="op" id="5016614">}</span><br>
<span class="lineno"></span><span class="op" id="5016616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5016619">func</span>&nbsp;<span class="op" id="5016624">(</span><span class="ident" id="5016625">p</span>&nbsp;<span class="op" id="5016627">*</span><span class="ident" id="5016628">parser</span><span class="op" id="5016634">)</span>&nbsp;<span class="ident" id="5016636">parseSelectStmt</span><span class="op" id="5016651">(</span><span class="op" id="5016652">)</span>&nbsp;<span class="op" id="5016654">*</span><span class="ident" id="5016655">ast</span><span class="op" id="5016658">.</span><span class="ident" id="5016659">SelectStmt</span>&nbsp;<span class="op" id="5016670">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016673">if</span>&nbsp;<span class="ident" id="5016676">p</span><span class="op" id="5016677">.</span><span class="ident" id="5016678">trace</span>&nbsp;<span class="op" id="5016684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016688">defer</span>&nbsp;<span class="ident" id="5016694">un</span><span class="op" id="5016696">(</span><span class="ident" id="5016697">trace</span><span class="op" id="5016702">(</span><span class="ident" id="5016703">p</span><span class="op" id="5016704">,</span>&nbsp;<span class="string" id="5016706">&#34;SelectStmt&#34;</span><span class="op" id="5016718">)</span><span class="op" id="5016719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016726">pos</span>&nbsp;<span class="op" id="5016730">:=</span>&nbsp;<span class="ident" id="5016733">p</span><span class="op" id="5016734">.</span><span class="ident" id="5016735">expect</span><span class="op" id="5016741">(</span><span class="ident" id="5016742">token</span><span class="op" id="5016747">.</span><span class="ident" id="5016748">SELECT</span><span class="op" id="5016754">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016757">lbrace</span>&nbsp;<span class="op" id="5016764">:=</span>&nbsp;<span class="ident" id="5016767">p</span><span class="op" id="5016768">.</span><span class="ident" id="5016769">expect</span><span class="op" id="5016775">(</span><span class="ident" id="5016776">token</span><span class="op" id="5016781">.</span><span class="ident" id="5016782">LBRACE</span><span class="op" id="5016788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016791">var</span>&nbsp;<span class="ident" id="5016795">list</span>&nbsp;<span class="op" id="5016800">[</span><span class="op" id="5016801">]</span><span class="ident" id="5016802">ast</span><span class="op" id="5016805">.</span><span class="ident" id="5016806">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016812">for</span>&nbsp;<span class="ident" id="5016816">p</span><span class="op" id="5016817">.</span><span class="ident" id="5016818">tok</span>&nbsp;<span class="op" id="5016822">==</span>&nbsp;<span class="ident" id="5016825">token</span><span class="op" id="5016830">.</span><span class="ident" id="5016831">CASE</span>&nbsp;<span class="op" id="5016836">||</span>&nbsp;<span class="ident" id="5016839">p</span><span class="op" id="5016840">.</span><span class="ident" id="5016841">tok</span>&nbsp;<span class="op" id="5016845">==</span>&nbsp;<span class="ident" id="5016848">token</span><span class="op" id="5016853">.</span><span class="ident" id="5016854">DEFAULT</span>&nbsp;<span class="op" id="5016862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016866">list</span>&nbsp;<span class="op" id="5016871">=</span>&nbsp;<span class="builtinfunc" id="5016873">append</span><span class="op" id="5016879">(</span><span class="ident" id="5016880">list</span><span class="op" id="5016884">,</span>&nbsp;<span class="ident" id="5016886">p</span><span class="op" id="5016887">.</span><span class="ident" id="5016888">parseCommClause</span><span class="op" id="5016903">(</span><span class="op" id="5016904">)</span><span class="op" id="5016905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016908">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016911">rbrace</span>&nbsp;<span class="op" id="5016918">:=</span>&nbsp;<span class="ident" id="5016921">p</span><span class="op" id="5016922">.</span><span class="ident" id="5016923">expect</span><span class="op" id="5016929">(</span><span class="ident" id="5016930">token</span><span class="op" id="5016935">.</span><span class="ident" id="5016936">RBRACE</span><span class="op" id="5016942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016945">p</span><span class="op" id="5016946">.</span><span class="ident" id="5016947">expectSemi</span><span class="op" id="5016957">(</span><span class="op" id="5016958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016961">body</span>&nbsp;<span class="op" id="5016966">:=</span>&nbsp;<span class="op" id="5016969">&amp;</span><span class="ident" id="5016970">ast</span><span class="op" id="5016973">.</span><span class="ident" id="5016974">BlockStmt</span><span class="op" id="5016983">{</span><span class="ident" id="5016984">Lbrace</span><span class="op" id="5016990">:</span>&nbsp;<span class="ident" id="5016992">lbrace</span><span class="op" id="5016998">,</span>&nbsp;<span class="ident" id="5017000">List</span><span class="op" id="5017004">:</span>&nbsp;<span class="ident" id="5017006">list</span><span class="op" id="5017010">,</span>&nbsp;<span class="ident" id="5017012">Rbrace</span><span class="op" id="5017018">:</span>&nbsp;<span class="ident" id="5017020">rbrace</span><span class="op" id="5017026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017030">return</span>&nbsp;<span class="op" id="5017037">&amp;</span><span class="ident" id="5017038">ast</span><span class="op" id="5017041">.</span><span class="ident" id="5017042">SelectStmt</span><span class="op" id="5017052">{</span><span class="ident" id="5017053">Select</span><span class="op" id="5017059">:</span>&nbsp;<span class="ident" id="5017061">pos</span><span class="op" id="5017064">,</span>&nbsp;<span class="ident" id="5017066">Body</span><span class="op" id="5017070">:</span>&nbsp;<span class="ident" id="5017072">body</span><span class="op" id="5017076">}</span><br>
<span class="lineno">2030</span><span class="op" id="5017078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5017081">func</span>&nbsp;<span class="op" id="5017086">(</span><span class="ident" id="5017087">p</span>&nbsp;<span class="op" id="5017089">*</span><span class="ident" id="5017090">parser</span><span class="op" id="5017096">)</span>&nbsp;<span class="ident" id="5017098">parseForStmt</span><span class="op" id="5017110">(</span><span class="op" id="5017111">)</span>&nbsp;<span class="ident" id="5017113">ast</span><span class="op" id="5017116">.</span><span class="ident" id="5017117">Stmt</span>&nbsp;<span class="op" id="5017122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017125">if</span>&nbsp;<span class="ident" id="5017128">p</span><span class="op" id="5017129">.</span><span class="ident" id="5017130">trace</span>&nbsp;<span class="op" id="5017136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017140">defer</span>&nbsp;<span class="ident" id="5017146">un</span><span class="op" id="5017148">(</span><span class="ident" id="5017149">trace</span><span class="op" id="5017154">(</span><span class="ident" id="5017155">p</span><span class="op" id="5017156">,</span>&nbsp;<span class="string" id="5017158">&#34;ForStmt&#34;</span><span class="op" id="5017167">)</span><span class="op" id="5017168">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017175">pos</span>&nbsp;<span class="op" id="5017179">:=</span>&nbsp;<span class="ident" id="5017182">p</span><span class="op" id="5017183">.</span><span class="ident" id="5017184">expect</span><span class="op" id="5017190">(</span><span class="ident" id="5017191">token</span><span class="op" id="5017196">.</span><span class="ident" id="5017197">FOR</span><span class="op" id="5017200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017203">p</span><span class="op" id="5017204">.</span><span class="ident" id="5017205">openScope</span><span class="op" id="5017214">(</span><span class="op" id="5017215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017218">defer</span>&nbsp;<span class="ident" id="5017224">p</span><span class="op" id="5017225">.</span><span class="ident" id="5017226">closeScope</span><span class="op" id="5017236">(</span><span class="op" id="5017237">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017241">var</span>&nbsp;<span class="ident" id="5017245">s1</span><span class="op" id="5017247">,</span>&nbsp;<span class="ident" id="5017249">s2</span><span class="op" id="5017251">,</span>&nbsp;<span class="ident" id="5017253">s3</span>&nbsp;<span class="ident" id="5017256">ast</span><span class="op" id="5017259">.</span><span class="ident" id="5017260">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017266">var</span>&nbsp;<span class="ident" id="5017270">isRange</span>&nbsp;<span class="builtintype" id="5017278">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017284">if</span>&nbsp;<span class="ident" id="5017287">p</span><span class="op" id="5017288">.</span><span class="ident" id="5017289">tok</span>&nbsp;<span class="op" id="5017293">!=</span>&nbsp;<span class="ident" id="5017296">token</span><span class="op" id="5017301">.</span><span class="ident" id="5017302">LBRACE</span>&nbsp;<span class="op" id="5017309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017313">prevLev</span>&nbsp;<span class="op" id="5017321">:=</span>&nbsp;<span class="ident" id="5017324">p</span><span class="op" id="5017325">.</span><span class="ident" id="5017326">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017336">p</span><span class="op" id="5017337">.</span><span class="ident" id="5017338">exprLev</span>&nbsp;<span class="op" id="5017346">=</span>&nbsp;<span class="op" id="5017348">-</span><span class="num" id="5017349">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017353">if</span>&nbsp;<span class="ident" id="5017356">p</span><span class="op" id="5017357">.</span><span class="ident" id="5017358">tok</span>&nbsp;<span class="op" id="5017362">!=</span>&nbsp;<span class="ident" id="5017365">token</span><span class="op" id="5017370">.</span><span class="ident" id="5017371">SEMICOLON</span>&nbsp;<span class="op" id="5017381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017386">if</span>&nbsp;<span class="ident" id="5017389">p</span><span class="op" id="5017390">.</span><span class="ident" id="5017391">tok</span>&nbsp;<span class="op" id="5017395">==</span>&nbsp;<span class="ident" id="5017398">token</span><span class="op" id="5017403">.</span><span class="ident" id="5017404">RANGE</span>&nbsp;<span class="op" id="5017410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017416">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017461">pos</span>&nbsp;<span class="op" id="5017465">:=</span>&nbsp;<span class="ident" id="5017468">p</span><span class="op" id="5017469">.</span><span class="ident" id="5017470">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017478">p</span><span class="op" id="5017479">.</span><span class="ident" id="5017480">next</span><span class="op" id="5017484">(</span><span class="op" id="5017485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017491">y</span>&nbsp;<span class="op" id="5017493">:=</span>&nbsp;<span class="op" id="5017496">[</span><span class="op" id="5017497">]</span><span class="ident" id="5017498">ast</span><span class="op" id="5017501">.</span><span class="ident" id="5017502">Expr</span><span class="op" id="5017506">{</span><span class="op" id="5017507">&amp;</span><span class="ident" id="5017508">ast</span><span class="op" id="5017511">.</span><span class="ident" id="5017512">UnaryExpr</span><span class="op" id="5017521">{</span><span class="ident" id="5017522">OpPos</span><span class="op" id="5017527">:</span>&nbsp;<span class="ident" id="5017529">pos</span><span class="op" id="5017532">,</span>&nbsp;<span class="ident" id="5017534">Op</span><span class="op" id="5017536">:</span>&nbsp;<span class="ident" id="5017538">token</span><span class="op" id="5017543">.</span><span class="ident" id="5017544">RANGE</span><span class="op" id="5017549">,</span>&nbsp;<span class="ident" id="5017551">X</span><span class="op" id="5017552">:</span>&nbsp;<span class="ident" id="5017554">p</span><span class="op" id="5017555">.</span><span class="ident" id="5017556">parseRhs</span><span class="op" id="5017564">(</span><span class="op" id="5017565">)</span><span class="op" id="5017566">}</span><span class="op" id="5017567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017573">s2</span>&nbsp;<span class="op" id="5017576">=</span>&nbsp;<span class="op" id="5017578">&amp;</span><span class="ident" id="5017579">ast</span><span class="op" id="5017582">.</span><span class="ident" id="5017583">AssignStmt</span><span class="op" id="5017593">{</span><span class="ident" id="5017594">Rhs</span><span class="op" id="5017597">:</span>&nbsp;<span class="ident" id="5017599">y</span><span class="op" id="5017600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017606">isRange</span>&nbsp;<span class="op" id="5017614">=</span>&nbsp;<span class="builtintype" id="5017616">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017624">}</span>&nbsp;<span class="keyword" id="5017626">else</span>&nbsp;<span class="op" id="5017631">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017637">s2</span><span class="op" id="5017639">,</span>&nbsp;<span class="ident" id="5017641">isRange</span>&nbsp;<span class="op" id="5017649">=</span>&nbsp;<span class="ident" id="5017651">p</span><span class="op" id="5017652">.</span><span class="ident" id="5017653">parseSimpleStmt</span><span class="op" id="5017668">(</span><span class="ident" id="5017669">rangeOk</span><span class="op" id="5017676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017689">if</span>&nbsp;<span class="op" id="5017692">!</span><span class="ident" id="5017693">isRange</span>&nbsp;<span class="op" id="5017701">&amp;&amp;</span>&nbsp;<span class="ident" id="5017704">p</span><span class="op" id="5017705">.</span><span class="ident" id="5017706">tok</span>&nbsp;<span class="op" id="5017710">==</span>&nbsp;<span class="ident" id="5017713">token</span><span class="op" id="5017718">.</span><span class="ident" id="5017719">SEMICOLON</span>&nbsp;<span class="op" id="5017729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017734">p</span><span class="op" id="5017735">.</span><span class="ident" id="5017736">next</span><span class="op" id="5017740">(</span><span class="op" id="5017741">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017746">s1</span>&nbsp;<span class="op" id="5017749">=</span>&nbsp;<span class="ident" id="5017751">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017757">s2</span>&nbsp;<span class="op" id="5017760">=</span>&nbsp;<span class="ident" id="5017762">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017769">if</span>&nbsp;<span class="ident" id="5017772">p</span><span class="op" id="5017773">.</span><span class="ident" id="5017774">tok</span>&nbsp;<span class="op" id="5017778">!=</span>&nbsp;<span class="ident" id="5017781">token</span><span class="op" id="5017786">.</span><span class="ident" id="5017787">SEMICOLON</span>&nbsp;<span class="op" id="5017797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017803">s2</span><span class="op" id="5017805">,</span>&nbsp;<span class="ident" id="5017807">_</span>&nbsp;<span class="op" id="5017809">=</span>&nbsp;<span class="ident" id="5017811">p</span><span class="op" id="5017812">.</span><span class="ident" id="5017813">parseSimpleStmt</span><span class="op" id="5017828">(</span><span class="ident" id="5017829">basic</span><span class="op" id="5017834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017839">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017844">p</span><span class="op" id="5017845">.</span><span class="ident" id="5017846">expectSemi</span><span class="op" id="5017856">(</span><span class="op" id="5017857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017862">if</span>&nbsp;<span class="ident" id="5017865">p</span><span class="op" id="5017866">.</span><span class="ident" id="5017867">tok</span>&nbsp;<span class="op" id="5017871">!=</span>&nbsp;<span class="ident" id="5017874">token</span><span class="op" id="5017879">.</span><span class="ident" id="5017880">LBRACE</span>&nbsp;<span class="op" id="5017887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017893">s3</span><span class="op" id="5017895">,</span>&nbsp;<span class="ident" id="5017897">_</span>&nbsp;<span class="op" id="5017899">=</span>&nbsp;<span class="ident" id="5017901">p</span><span class="op" id="5017902">.</span><span class="ident" id="5017903">parseSimpleStmt</span><span class="op" id="5017918">(</span><span class="ident" id="5017919">basic</span><span class="op" id="5017924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017933">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017937">p</span><span class="op" id="5017938">.</span><span class="ident" id="5017939">exprLev</span>&nbsp;<span class="op" id="5017947">=</span>&nbsp;<span class="ident" id="5017949">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017962">body</span>&nbsp;<span class="op" id="5017967">:=</span>&nbsp;<span class="ident" id="5017970">p</span><span class="op" id="5017971">.</span><span class="ident" id="5017972">parseBlockStmt</span><span class="op" id="5017986">(</span><span class="op" id="5017987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017990">p</span><span class="op" id="5017991">.</span><span class="ident" id="5017992">expectSemi</span><span class="op" id="5018002">(</span><span class="op" id="5018003">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018007">if</span>&nbsp;<span class="ident" id="5018010">isRange</span>&nbsp;<span class="op" id="5018018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018022">as</span>&nbsp;<span class="op" id="5018025">:=</span>&nbsp;<span class="ident" id="5018028">s2</span><span class="op" id="5018030">.</span><span class="op" id="5018031">(</span><span class="op" id="5018032">*</span><span class="ident" id="5018033">ast</span><span class="op" id="5018036">.</span><span class="ident" id="5018037">AssignStmt</span><span class="op" id="5018047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018051">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018066">var</span>&nbsp;<span class="ident" id="5018070">key</span><span class="op" id="5018073">,</span>&nbsp;<span class="ident" id="5018075">value</span>&nbsp;<span class="ident" id="5018081">ast</span><span class="op" id="5018084">.</span><span class="ident" id="5018085">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018092">switch</span>&nbsp;<span class="builtinfunc" id="5018099">len</span><span class="op" id="5018102">(</span><span class="ident" id="5018103">as</span><span class="op" id="5018105">.</span><span class="ident" id="5018106">Lhs</span><span class="op" id="5018109">)</span>&nbsp;<span class="op" id="5018111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018115">case</span>&nbsp;<span class="num" id="5018120">0</span><span class="op" id="5018121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018126">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018145">case</span>&nbsp;<span class="num" id="5018150">1</span><span class="op" id="5018151">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018156">key</span>&nbsp;<span class="op" id="5018160">=</span>&nbsp;<span class="ident" id="5018162">as</span><span class="op" id="5018164">.</span><span class="ident" id="5018165">Lhs</span><span class="op" id="5018168">[</span><span class="num" id="5018169">0</span><span class="op" id="5018170">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018174">case</span>&nbsp;<span class="num" id="5018179">2</span><span class="op" id="5018180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018185">key</span><span class="op" id="5018188">,</span>&nbsp;<span class="ident" id="5018190">value</span>&nbsp;<span class="op" id="5018196">=</span>&nbsp;<span class="ident" id="5018198">as</span><span class="op" id="5018200">.</span><span class="ident" id="5018201">Lhs</span><span class="op" id="5018204">[</span><span class="num" id="5018205">0</span><span class="op" id="5018206">]</span><span class="op" id="5018207">,</span>&nbsp;<span class="ident" id="5018209">as</span><span class="op" id="5018211">.</span><span class="ident" id="5018212">Lhs</span><span class="op" id="5018215">[</span><span class="num" id="5018216">1</span><span class="op" id="5018217">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018221">default</span><span class="op" id="5018228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018233">p</span><span class="op" id="5018234">.</span><span class="ident" id="5018235">errorExpected</span><span class="op" id="5018248">(</span><span class="ident" id="5018249">as</span><span class="op" id="5018251">.</span><span class="ident" id="5018252">Lhs</span><span class="op" id="5018255">[</span><span class="builtinfunc" id="5018256">len</span><span class="op" id="5018259">(</span><span class="ident" id="5018260">as</span><span class="op" id="5018262">.</span><span class="ident" id="5018263">Lhs</span><span class="op" id="5018266">)</span><span class="op" id="5018267">-</span><span class="num" id="5018268">1</span><span class="op" id="5018269">]</span><span class="op" id="5018270">.</span><span class="ident" id="5018271">Pos</span><span class="op" id="5018274">(</span><span class="op" id="5018275">)</span><span class="op" id="5018276">,</span>&nbsp;<span class="string" id="5018278">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5018301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018306">return</span>&nbsp;<span class="op" id="5018313">&amp;</span><span class="ident" id="5018314">ast</span><span class="op" id="5018317">.</span><span class="ident" id="5018318">BadStmt</span><span class="op" id="5018325">{</span><span class="ident" id="5018326">From</span><span class="op" id="5018330">:</span>&nbsp;<span class="ident" id="5018332">pos</span><span class="op" id="5018335">,</span>&nbsp;<span class="ident" id="5018337">To</span><span class="op" id="5018339">:</span>&nbsp;<span class="ident" id="5018341">p</span><span class="op" id="5018342">.</span><span class="ident" id="5018343">safePos</span><span class="op" id="5018350">(</span><span class="ident" id="5018351">body</span><span class="op" id="5018355">.</span><span class="ident" id="5018356">End</span><span class="op" id="5018359">(</span><span class="op" id="5018360">)</span><span class="op" id="5018361">)</span><span class="op" id="5018362">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018370">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018423">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018479">x</span>&nbsp;<span class="op" id="5018481">:=</span>&nbsp;<span class="ident" id="5018484">as</span><span class="op" id="5018486">.</span><span class="ident" id="5018487">Rhs</span><span class="op" id="5018490">[</span><span class="num" id="5018491">0</span><span class="op" id="5018492">]</span><span class="op" id="5018493">.</span><span class="op" id="5018494">(</span><span class="op" id="5018495">*</span><span class="ident" id="5018496">ast</span><span class="op" id="5018499">.</span><span class="ident" id="5018500">UnaryExpr</span><span class="op" id="5018509">)</span><span class="op" id="5018510">.</span><span class="ident" id="5018511">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018515">return</span>&nbsp;<span class="op" id="5018522">&amp;</span><span class="ident" id="5018523">ast</span><span class="op" id="5018526">.</span><span class="ident" id="5018527">RangeStmt</span><span class="op" id="5018536">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018541">For</span><span class="op" id="5018544">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5018549">pos</span><span class="op" id="5018552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018557">Key</span><span class="op" id="5018560">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5018565">key</span><span class="op" id="5018568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018573">Value</span><span class="op" id="5018578">:</span>&nbsp;&nbsp;<span class="ident" id="5018581">value</span><span class="op" id="5018586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018591">TokPos</span><span class="op" id="5018597">:</span>&nbsp;<span class="ident" id="5018599">as</span><span class="op" id="5018601">.</span><span class="ident" id="5018602">TokPos</span><span class="op" id="5018608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018613">Tok</span><span class="op" id="5018616">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5018621">as</span><span class="op" id="5018623">.</span><span class="ident" id="5018624">Tok</span><span class="op" id="5018627">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018632">X</span><span class="op" id="5018633">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5018640">x</span><span class="op" id="5018641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018646">Body</span><span class="op" id="5018650">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5018654">body</span><span class="op" id="5018658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018669">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018695">return</span>&nbsp;<span class="op" id="5018702">&amp;</span><span class="ident" id="5018703">ast</span><span class="op" id="5018706">.</span><span class="ident" id="5018707">ForStmt</span><span class="op" id="5018714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018718">For</span><span class="op" id="5018721">:</span>&nbsp;&nbsp;<span class="ident" id="5018724">pos</span><span class="op" id="5018727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018731">Init</span><span class="op" id="5018735">:</span>&nbsp;<span class="ident" id="5018737">s1</span><span class="op" id="5018739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018743">Cond</span><span class="op" id="5018747">:</span>&nbsp;<span class="ident" id="5018749">p</span><span class="op" id="5018750">.</span><span class="ident" id="5018751">makeExpr</span><span class="op" id="5018759">(</span><span class="ident" id="5018760">s2</span><span class="op" id="5018762">,</span>&nbsp;<span class="string" id="5018764">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="5018793">)</span><span class="op" id="5018794">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018798">Post</span><span class="op" id="5018802">:</span>&nbsp;<span class="ident" id="5018804">s3</span><span class="op" id="5018806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018810">Body</span><span class="op" id="5018814">:</span>&nbsp;<span class="ident" id="5018816">body</span><span class="op" id="5018820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018823">}</span><br>
<span class="lineno"></span><span class="op" id="5018825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="5018828">func</span>&nbsp;<span class="op" id="5018833">(</span><span class="ident" id="5018834">p</span>&nbsp;<span class="op" id="5018836">*</span><span class="ident" id="5018837">parser</span><span class="op" id="5018843">)</span>&nbsp;<span class="ident" id="5018845">parseStmt</span><span class="op" id="5018854">(</span><span class="op" id="5018855">)</span>&nbsp;<span class="op" id="5018857">(</span><span class="ident" id="5018858">s</span>&nbsp;<span class="ident" id="5018860">ast</span><span class="op" id="5018863">.</span><span class="ident" id="5018864">Stmt</span><span class="op" id="5018868">)</span>&nbsp;<span class="op" id="5018870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018873">if</span>&nbsp;<span class="ident" id="5018876">p</span><span class="op" id="5018877">.</span><span class="ident" id="5018878">trace</span>&nbsp;<span class="op" id="5018884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018888">defer</span>&nbsp;<span class="ident" id="5018894">un</span><span class="op" id="5018896">(</span><span class="ident" id="5018897">trace</span><span class="op" id="5018902">(</span><span class="ident" id="5018903">p</span><span class="op" id="5018904">,</span>&nbsp;<span class="string" id="5018906">&#34;Statement&#34;</span><span class="op" id="5018917">)</span><span class="op" id="5018918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018925">switch</span>&nbsp;<span class="ident" id="5018932">p</span><span class="op" id="5018933">.</span><span class="ident" id="5018934">tok</span>&nbsp;<span class="op" id="5018938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018941">case</span>&nbsp;<span class="ident" id="5018946">token</span><span class="op" id="5018951">.</span><span class="ident" id="5018952">CONST</span><span class="op" id="5018957">,</span>&nbsp;<span class="ident" id="5018959">token</span><span class="op" id="5018964">.</span><span class="ident" id="5018965">TYPE</span><span class="op" id="5018969">,</span>&nbsp;<span class="ident" id="5018971">token</span><span class="op" id="5018976">.</span><span class="ident" id="5018977">VAR</span><span class="op" id="5018980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018984">s</span>&nbsp;<span class="op" id="5018986">=</span>&nbsp;<span class="op" id="5018988">&amp;</span><span class="ident" id="5018989">ast</span><span class="op" id="5018992">.</span><span class="ident" id="5018993">DeclStmt</span><span class="op" id="5019001">{</span><span class="ident" id="5019002">Decl</span><span class="op" id="5019006">:</span>&nbsp;<span class="ident" id="5019008">p</span><span class="op" id="5019009">.</span><span class="ident" id="5019010">parseDecl</span><span class="op" id="5019019">(</span><span class="ident" id="5019020">syncStmt</span><span class="op" id="5019028">)</span><span class="op" id="5019029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019032">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019039">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019080">token</span><span class="op" id="5019085">.</span><span class="ident" id="5019086">IDENT</span><span class="op" id="5019091">,</span>&nbsp;<span class="ident" id="5019093">token</span><span class="op" id="5019098">.</span><span class="ident" id="5019099">INT</span><span class="op" id="5019102">,</span>&nbsp;<span class="ident" id="5019104">token</span><span class="op" id="5019109">.</span><span class="ident" id="5019110">FLOAT</span><span class="op" id="5019115">,</span>&nbsp;<span class="ident" id="5019117">token</span><span class="op" id="5019122">.</span><span class="ident" id="5019123">IMAG</span><span class="op" id="5019127">,</span>&nbsp;<span class="ident" id="5019129">token</span><span class="op" id="5019134">.</span><span class="ident" id="5019135">CHAR</span><span class="op" id="5019139">,</span>&nbsp;<span class="ident" id="5019141">token</span><span class="op" id="5019146">.</span><span class="ident" id="5019147">STRING</span><span class="op" id="5019153">,</span>&nbsp;<span class="ident" id="5019155">token</span><span class="op" id="5019160">.</span><span class="ident" id="5019161">FUNC</span><span class="op" id="5019165">,</span>&nbsp;<span class="ident" id="5019167">token</span><span class="op" id="5019172">.</span><span class="ident" id="5019173">LPAREN</span><span class="op" id="5019179">,</span>&nbsp;<span class="comment" id="5019181">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019195">token</span><span class="op" id="5019200">.</span><span class="ident" id="5019201">LBRACK</span><span class="op" id="5019207">,</span>&nbsp;<span class="ident" id="5019209">token</span><span class="op" id="5019214">.</span><span class="ident" id="5019215">STRUCT</span><span class="op" id="5019221">,</span>&nbsp;<span class="comment" id="5019223">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019244">token</span><span class="op" id="5019249">.</span><span class="ident" id="5019250">ADD</span><span class="op" id="5019253">,</span>&nbsp;<span class="ident" id="5019255">token</span><span class="op" id="5019260">.</span><span class="ident" id="5019261">SUB</span><span class="op" id="5019264">,</span>&nbsp;<span class="ident" id="5019266">token</span><span class="op" id="5019271">.</span><span class="ident" id="5019272">MUL</span><span class="op" id="5019275">,</span>&nbsp;<span class="ident" id="5019277">token</span><span class="op" id="5019282">.</span><span class="ident" id="5019283">AND</span><span class="op" id="5019286">,</span>&nbsp;<span class="ident" id="5019288">token</span><span class="op" id="5019293">.</span><span class="ident" id="5019294">XOR</span><span class="op" id="5019297">,</span>&nbsp;<span class="ident" id="5019299">token</span><span class="op" id="5019304">.</span><span class="ident" id="5019305">ARROW</span><span class="op" id="5019310">,</span>&nbsp;<span class="ident" id="5019312">token</span><span class="op" id="5019317">.</span><span class="ident" id="5019318">NOT</span><span class="op" id="5019321">:</span>&nbsp;<span class="comment" id="5019323">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019344">s</span><span class="op" id="5019345">,</span>&nbsp;<span class="ident" id="5019347">_</span>&nbsp;<span class="op" id="5019349">=</span>&nbsp;<span class="ident" id="5019351">p</span><span class="op" id="5019352">.</span><span class="ident" id="5019353">parseSimpleStmt</span><span class="op" id="5019368">(</span><span class="ident" id="5019369">labelOk</span><span class="op" id="5019376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019380">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019444">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019508">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019518">if</span>&nbsp;<span class="ident" id="5019521">_</span><span class="op" id="5019522">,</span>&nbsp;<span class="ident" id="5019524">isLabeledStmt</span>&nbsp;<span class="op" id="5019538">:=</span>&nbsp;<span class="ident" id="5019541">s</span><span class="op" id="5019542">.</span><span class="op" id="5019543">(</span><span class="op" id="5019544">*</span><span class="ident" id="5019545">ast</span><span class="op" id="5019548">.</span><span class="ident" id="5019549">LabeledStmt</span><span class="op" id="5019560">)</span><span class="op" id="5019561">;</span>&nbsp;<span class="op" id="5019563">!</span><span class="ident" id="5019564">isLabeledStmt</span>&nbsp;<span class="op" id="5019578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019583">p</span><span class="op" id="5019584">.</span><span class="ident" id="5019585">expectSemi</span><span class="op" id="5019595">(</span><span class="op" id="5019596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019600">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019603">case</span>&nbsp;<span class="ident" id="5019608">token</span><span class="op" id="5019613">.</span><span class="ident" id="5019614">GO</span><span class="op" id="5019616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019620">s</span>&nbsp;<span class="op" id="5019622">=</span>&nbsp;<span class="ident" id="5019624">p</span><span class="op" id="5019625">.</span><span class="ident" id="5019626">parseGoStmt</span><span class="op" id="5019637">(</span><span class="op" id="5019638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019641">case</span>&nbsp;<span class="ident" id="5019646">token</span><span class="op" id="5019651">.</span><span class="ident" id="5019652">DEFER</span><span class="op" id="5019657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019661">s</span>&nbsp;<span class="op" id="5019663">=</span>&nbsp;<span class="ident" id="5019665">p</span><span class="op" id="5019666">.</span><span class="ident" id="5019667">parseDeferStmt</span><span class="op" id="5019681">(</span><span class="op" id="5019682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019685">case</span>&nbsp;<span class="ident" id="5019690">token</span><span class="op" id="5019695">.</span><span class="ident" id="5019696">RETURN</span><span class="op" id="5019702">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019706">s</span>&nbsp;<span class="op" id="5019708">=</span>&nbsp;<span class="ident" id="5019710">p</span><span class="op" id="5019711">.</span><span class="ident" id="5019712">parseReturnStmt</span><span class="op" id="5019727">(</span><span class="op" id="5019728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019731">case</span>&nbsp;<span class="ident" id="5019736">token</span><span class="op" id="5019741">.</span><span class="ident" id="5019742">BREAK</span><span class="op" id="5019747">,</span>&nbsp;<span class="ident" id="5019749">token</span><span class="op" id="5019754">.</span><span class="ident" id="5019755">CONTINUE</span><span class="op" id="5019763">,</span>&nbsp;<span class="ident" id="5019765">token</span><span class="op" id="5019770">.</span><span class="ident" id="5019771">GOTO</span><span class="op" id="5019775">,</span>&nbsp;<span class="ident" id="5019777">token</span><span class="op" id="5019782">.</span><span class="ident" id="5019783">FALLTHROUGH</span><span class="op" id="5019794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019798">s</span>&nbsp;<span class="op" id="5019800">=</span>&nbsp;<span class="ident" id="5019802">p</span><span class="op" id="5019803">.</span><span class="ident" id="5019804">parseBranchStmt</span><span class="op" id="5019819">(</span><span class="ident" id="5019820">p</span><span class="op" id="5019821">.</span><span class="ident" id="5019822">tok</span><span class="op" id="5019825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019828">case</span>&nbsp;<span class="ident" id="5019833">token</span><span class="op" id="5019838">.</span><span class="ident" id="5019839">LBRACE</span><span class="op" id="5019845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019849">s</span>&nbsp;<span class="op" id="5019851">=</span>&nbsp;<span class="ident" id="5019853">p</span><span class="op" id="5019854">.</span><span class="ident" id="5019855">parseBlockStmt</span><span class="op" id="5019869">(</span><span class="op" id="5019870">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019874">p</span><span class="op" id="5019875">.</span><span class="ident" id="5019876">expectSemi</span><span class="op" id="5019886">(</span><span class="op" id="5019887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019890">case</span>&nbsp;<span class="ident" id="5019895">token</span><span class="op" id="5019900">.</span><span class="ident" id="5019901">IF</span><span class="op" id="5019903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019907">s</span>&nbsp;<span class="op" id="5019909">=</span>&nbsp;<span class="ident" id="5019911">p</span><span class="op" id="5019912">.</span><span class="ident" id="5019913">parseIfStmt</span><span class="op" id="5019924">(</span><span class="op" id="5019925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019928">case</span>&nbsp;<span class="ident" id="5019933">token</span><span class="op" id="5019938">.</span><span class="ident" id="5019939">SWITCH</span><span class="op" id="5019945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019949">s</span>&nbsp;<span class="op" id="5019951">=</span>&nbsp;<span class="ident" id="5019953">p</span><span class="op" id="5019954">.</span><span class="ident" id="5019955">parseSwitchStmt</span><span class="op" id="5019970">(</span><span class="op" id="5019971">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019974">case</span>&nbsp;<span class="ident" id="5019979">token</span><span class="op" id="5019984">.</span><span class="ident" id="5019985">SELECT</span><span class="op" id="5019991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019995">s</span>&nbsp;<span class="op" id="5019997">=</span>&nbsp;<span class="ident" id="5019999">p</span><span class="op" id="5020000">.</span><span class="ident" id="5020001">parseSelectStmt</span><span class="op" id="5020016">(</span><span class="op" id="5020017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020020">case</span>&nbsp;<span class="ident" id="5020025">token</span><span class="op" id="5020030">.</span><span class="ident" id="5020031">FOR</span><span class="op" id="5020034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020038">s</span>&nbsp;<span class="op" id="5020040">=</span>&nbsp;<span class="ident" id="5020042">p</span><span class="op" id="5020043">.</span><span class="ident" id="5020044">parseForStmt</span><span class="op" id="5020056">(</span><span class="op" id="5020057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020060">case</span>&nbsp;<span class="ident" id="5020065">token</span><span class="op" id="5020070">.</span><span class="ident" id="5020071">SEMICOLON</span><span class="op" id="5020080">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020084">s</span>&nbsp;<span class="op" id="5020086">=</span>&nbsp;<span class="op" id="5020088">&amp;</span><span class="ident" id="5020089">ast</span><span class="op" id="5020092">.</span><span class="ident" id="5020093">EmptyStmt</span><span class="op" id="5020102">{</span><span class="ident" id="5020103">Semicolon</span><span class="op" id="5020112">:</span>&nbsp;<span class="ident" id="5020114">p</span><span class="op" id="5020115">.</span><span class="ident" id="5020116">pos</span><span class="op" id="5020119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020123">p</span><span class="op" id="5020124">.</span><span class="ident" id="5020125">next</span><span class="op" id="5020129">(</span><span class="op" id="5020130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020133">case</span>&nbsp;<span class="ident" id="5020138">token</span><span class="op" id="5020143">.</span><span class="ident" id="5020144">RBRACE</span><span class="op" id="5020150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020154">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020207">s</span>&nbsp;<span class="op" id="5020209">=</span>&nbsp;<span class="op" id="5020211">&amp;</span><span class="ident" id="5020212">ast</span><span class="op" id="5020215">.</span><span class="ident" id="5020216">EmptyStmt</span><span class="op" id="5020225">{</span><span class="ident" id="5020226">Semicolon</span><span class="op" id="5020235">:</span>&nbsp;<span class="ident" id="5020237">p</span><span class="op" id="5020238">.</span><span class="ident" id="5020239">pos</span><span class="op" id="5020242">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020245">default</span><span class="op" id="5020252">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020256">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020280">pos</span>&nbsp;<span class="op" id="5020284">:=</span>&nbsp;<span class="ident" id="5020287">p</span><span class="op" id="5020288">.</span><span class="ident" id="5020289">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020295">p</span><span class="op" id="5020296">.</span><span class="ident" id="5020297">errorExpected</span><span class="op" id="5020310">(</span><span class="ident" id="5020311">pos</span><span class="op" id="5020314">,</span>&nbsp;<span class="string" id="5020316">&#34;statement&#34;</span><span class="op" id="5020327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020331">syncStmt</span><span class="op" id="5020339">(</span><span class="ident" id="5020340">p</span><span class="op" id="5020341">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020345">s</span>&nbsp;<span class="op" id="5020347">=</span>&nbsp;<span class="op" id="5020349">&amp;</span><span class="ident" id="5020350">ast</span><span class="op" id="5020353">.</span><span class="ident" id="5020354">BadStmt</span><span class="op" id="5020361">{</span><span class="ident" id="5020362">From</span><span class="op" id="5020366">:</span>&nbsp;<span class="ident" id="5020368">pos</span><span class="op" id="5020371">,</span>&nbsp;<span class="ident" id="5020373">To</span><span class="op" id="5020375">:</span>&nbsp;<span class="ident" id="5020377">p</span><span class="op" id="5020378">.</span><span class="ident" id="5020379">pos</span><span class="op" id="5020382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020389">return</span><br>
<span class="lineno"></span><span class="op" id="5020396">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="5020399">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5020479">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5020496">type</span>&nbsp;<span class="ident" id="5020501">parseSpecFunction</span>&nbsp;<span class="keyword" id="5020519">func</span><span class="op" id="5020523">(</span><span class="ident" id="5020524">doc</span>&nbsp;<span class="op" id="5020528">*</span><span class="ident" id="5020529">ast</span><span class="op" id="5020532">.</span><span class="ident" id="5020533">CommentGroup</span><span class="op" id="5020545">,</span>&nbsp;<span class="ident" id="5020547">keyword</span>&nbsp;<span class="ident" id="5020555">token</span><span class="op" id="5020560">.</span><span class="ident" id="5020561">Token</span><span class="op" id="5020566">,</span>&nbsp;<span class="ident" id="5020568">iota</span>&nbsp;<span class="builtintype" id="5020573">int</span><span class="op" id="5020576">)</span>&nbsp;<span class="ident" id="5020578">ast</span><span class="op" id="5020581">.</span><span class="ident" id="5020582">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="5020588">func</span>&nbsp;<span class="ident" id="5020593">isValidImport</span><span class="op" id="5020606">(</span><span class="ident" id="5020607">lit</span>&nbsp;<span class="builtintype" id="5020611">string</span><span class="op" id="5020617">)</span>&nbsp;<span class="builtintype" id="5020619">bool</span>&nbsp;<span class="op" id="5020624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020627">const</span>&nbsp;<span class="ident" id="5020633">illegalChars</span>&nbsp;<span class="op" id="5020646">=</span>&nbsp;<span class="string" id="5020648">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="5020675">+</span>&nbsp;<span class="string" id="5020677">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020688">s</span><span class="op" id="5020689">,</span>&nbsp;<span class="ident" id="5020691">_</span>&nbsp;<span class="op" id="5020693">:=</span>&nbsp;<span class="ident" id="5020696">strconv</span><span class="op" id="5020703">.</span><span class="ident" id="5020704">Unquote</span><span class="op" id="5020711">(</span><span class="ident" id="5020712">lit</span><span class="op" id="5020715">)</span>&nbsp;<span class="comment" id="5020717">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020763">for</span>&nbsp;<span class="ident" id="5020767">_</span><span class="op" id="5020768">,</span>&nbsp;<span class="ident" id="5020770">r</span>&nbsp;<span class="op" id="5020772">:=</span>&nbsp;<span class="keyword" id="5020775">range</span>&nbsp;<span class="ident" id="5020781">s</span>&nbsp;<span class="op" id="5020783">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020787">if</span>&nbsp;<span class="op" id="5020790">!</span><span class="ident" id="5020791">unicode</span><span class="op" id="5020798">.</span><span class="ident" id="5020799">IsGraphic</span><span class="op" id="5020808">(</span><span class="ident" id="5020809">r</span><span class="op" id="5020810">)</span>&nbsp;<span class="op" id="5020812">||</span>&nbsp;<span class="ident" id="5020815">unicode</span><span class="op" id="5020822">.</span><span class="ident" id="5020823">IsSpace</span><span class="op" id="5020830">(</span><span class="ident" id="5020831">r</span><span class="op" id="5020832">)</span>&nbsp;<span class="op" id="5020834">||</span>&nbsp;<span class="ident" id="5020837">strings</span><span class="op" id="5020844">.</span><span class="ident" id="5020845">ContainsRune</span><span class="op" id="5020857">(</span><span class="ident" id="5020858">illegalChars</span><span class="op" id="5020870">,</span>&nbsp;<span class="ident" id="5020872">r</span><span class="op" id="5020873">)</span>&nbsp;<span class="op" id="5020875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020880">return</span>&nbsp;<span class="builtintype" id="5020887">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020901">return</span>&nbsp;<span class="ident" id="5020908">s</span>&nbsp;<span class="op" id="5020910">!=</span>&nbsp;<span class="string" id="5020913">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="5020916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5020919">func</span>&nbsp;<span class="op" id="5020924">(</span><span class="ident" id="5020925">p</span>&nbsp;<span class="op" id="5020927">*</span><span class="ident" id="5020928">parser</span><span class="op" id="5020934">)</span>&nbsp;<span class="ident" id="5020936">parseImportSpec</span><span class="op" id="5020951">(</span><span class="ident" id="5020952">doc</span>&nbsp;<span class="op" id="5020956">*</span><span class="ident" id="5020957">ast</span><span class="op" id="5020960">.</span><span class="ident" id="5020961">CommentGroup</span><span class="op" id="5020973">,</span>&nbsp;<span class="ident" id="5020975">_</span>&nbsp;<span class="ident" id="5020977">token</span><span class="op" id="5020982">.</span><span class="ident" id="5020983">Token</span><span class="op" id="5020988">,</span>&nbsp;<span class="ident" id="5020990">_</span>&nbsp;<span class="builtintype" id="5020992">int</span><span class="op" id="5020995">)</span>&nbsp;<span class="ident" id="5020997">ast</span><span class="op" id="5021000">.</span><span class="ident" id="5021001">Spec</span>&nbsp;<span class="op" id="5021006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021009">if</span>&nbsp;<span class="ident" id="5021012">p</span><span class="op" id="5021013">.</span><span class="ident" id="5021014">trace</span>&nbsp;<span class="op" id="5021020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021024">defer</span>&nbsp;<span class="ident" id="5021030">un</span><span class="op" id="5021032">(</span><span class="ident" id="5021033">trace</span><span class="op" id="5021038">(</span><span class="ident" id="5021039">p</span><span class="op" id="5021040">,</span>&nbsp;<span class="string" id="5021042">&#34;ImportSpec&#34;</span><span class="op" id="5021054">)</span><span class="op" id="5021055">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021062">var</span>&nbsp;<span class="ident" id="5021066">ident</span>&nbsp;<span class="op" id="5021072">*</span><span class="ident" id="5021073">ast</span><span class="op" id="5021076">.</span><span class="ident" id="5021077">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021084">switch</span>&nbsp;<span class="ident" id="5021091">p</span><span class="op" id="5021092">.</span><span class="ident" id="5021093">tok</span>&nbsp;<span class="op" id="5021097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021100">case</span>&nbsp;<span class="ident" id="5021105">token</span><span class="op" id="5021110">.</span><span class="ident" id="5021111">PERIOD</span><span class="op" id="5021117">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021121">ident</span>&nbsp;<span class="op" id="5021127">=</span>&nbsp;<span class="op" id="5021129">&amp;</span><span class="ident" id="5021130">ast</span><span class="op" id="5021133">.</span><span class="ident" id="5021134">Ident</span><span class="op" id="5021139">{</span><span class="ident" id="5021140">NamePos</span><span class="op" id="5021147">:</span>&nbsp;<span class="ident" id="5021149">p</span><span class="op" id="5021150">.</span><span class="ident" id="5021151">pos</span><span class="op" id="5021154">,</span>&nbsp;<span class="ident" id="5021156">Name</span><span class="op" id="5021160">:</span>&nbsp;<span class="string" id="5021162">&#34;.&#34;</span><span class="op" id="5021165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021169">p</span><span class="op" id="5021170">.</span><span class="ident" id="5021171">next</span><span class="op" id="5021175">(</span><span class="op" id="5021176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021179">case</span>&nbsp;<span class="ident" id="5021184">token</span><span class="op" id="5021189">.</span><span class="ident" id="5021190">IDENT</span><span class="op" id="5021195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021199">ident</span>&nbsp;<span class="op" id="5021205">=</span>&nbsp;<span class="ident" id="5021207">p</span><span class="op" id="5021208">.</span><span class="ident" id="5021209">parseIdent</span><span class="op" id="5021219">(</span><span class="op" id="5021220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021223">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021227">pos</span>&nbsp;<span class="op" id="5021231">:=</span>&nbsp;<span class="ident" id="5021234">p</span><span class="op" id="5021235">.</span><span class="ident" id="5021236">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021241">var</span>&nbsp;<span class="ident" id="5021245">path</span>&nbsp;<span class="builtintype" id="5021250">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021258">if</span>&nbsp;<span class="ident" id="5021261">p</span><span class="op" id="5021262">.</span><span class="ident" id="5021263">tok</span>&nbsp;<span class="op" id="5021267">==</span>&nbsp;<span class="ident" id="5021270">token</span><span class="op" id="5021275">.</span><span class="ident" id="5021276">STRING</span>&nbsp;<span class="op" id="5021283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021287">path</span>&nbsp;<span class="op" id="5021292">=</span>&nbsp;<span class="ident" id="5021294">p</span><span class="op" id="5021295">.</span><span class="ident" id="5021296">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021302">if</span>&nbsp;<span class="op" id="5021305">!</span><span class="ident" id="5021306">isValidImport</span><span class="op" id="5021319">(</span><span class="ident" id="5021320">path</span><span class="op" id="5021324">)</span>&nbsp;<span class="op" id="5021326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021331">p</span><span class="op" id="5021332">.</span><span class="builtintype" id="5021333">error</span><span class="op" id="5021338">(</span><span class="ident" id="5021339">pos</span><span class="op" id="5021342">,</span>&nbsp;<span class="string" id="5021344">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="5021367">+</span><span class="ident" id="5021368">path</span><span class="op" id="5021372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021380">p</span><span class="op" id="5021381">.</span><span class="ident" id="5021382">next</span><span class="op" id="5021386">(</span><span class="op" id="5021387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021390">}</span>&nbsp;<span class="keyword" id="5021392">else</span>&nbsp;<span class="op" id="5021397">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021401">p</span><span class="op" id="5021402">.</span><span class="ident" id="5021403">expect</span><span class="op" id="5021409">(</span><span class="ident" id="5021410">token</span><span class="op" id="5021415">.</span><span class="ident" id="5021416">STRING</span><span class="op" id="5021422">)</span>&nbsp;<span class="comment" id="5021424">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021459">p</span><span class="op" id="5021460">.</span><span class="ident" id="5021461">expectSemi</span><span class="op" id="5021471">(</span><span class="op" id="5021472">)</span>&nbsp;<span class="comment" id="5021474">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021515">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021535">spec</span>&nbsp;<span class="op" id="5021540">:=</span>&nbsp;<span class="op" id="5021543">&amp;</span><span class="ident" id="5021544">ast</span><span class="op" id="5021547">.</span><span class="ident" id="5021548">ImportSpec</span><span class="op" id="5021558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021562">Doc</span><span class="op" id="5021565">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5021571">doc</span><span class="op" id="5021574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021578">Name</span><span class="op" id="5021582">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5021587">ident</span><span class="op" id="5021592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021596">Path</span><span class="op" id="5021600">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5021605">&amp;</span><span class="ident" id="5021606">ast</span><span class="op" id="5021609">.</span><span class="ident" id="5021610">BasicLit</span><span class="op" id="5021618">{</span><span class="ident" id="5021619">ValuePos</span><span class="op" id="5021627">:</span>&nbsp;<span class="ident" id="5021629">pos</span><span class="op" id="5021632">,</span>&nbsp;<span class="ident" id="5021634">Kind</span><span class="op" id="5021638">:</span>&nbsp;<span class="ident" id="5021640">token</span><span class="op" id="5021645">.</span><span class="ident" id="5021646">STRING</span><span class="op" id="5021652">,</span>&nbsp;<span class="ident" id="5021654">Value</span><span class="op" id="5021659">:</span>&nbsp;<span class="ident" id="5021661">path</span><span class="op" id="5021665">}</span><span class="op" id="5021666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021670">Comment</span><span class="op" id="5021677">:</span>&nbsp;<span class="ident" id="5021679">p</span><span class="op" id="5021680">.</span><span class="ident" id="5021681">lineComment</span><span class="op" id="5021692">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021698">p</span><span class="op" id="5021699">.</span><span class="ident" id="5021700">imports</span>&nbsp;<span class="op" id="5021708">=</span>&nbsp;<span class="builtinfunc" id="5021710">append</span><span class="op" id="5021716">(</span><span class="ident" id="5021717">p</span><span class="op" id="5021718">.</span><span class="ident" id="5021719">imports</span><span class="op" id="5021726">,</span>&nbsp;<span class="ident" id="5021728">spec</span><span class="op" id="5021732">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021736">return</span>&nbsp;<span class="ident" id="5021743">spec</span><br>
<span class="lineno"></span><span class="op" id="5021748">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="5021751">func</span>&nbsp;<span class="op" id="5021756">(</span><span class="ident" id="5021757">p</span>&nbsp;<span class="op" id="5021759">*</span><span class="ident" id="5021760">parser</span><span class="op" id="5021766">)</span>&nbsp;<span class="ident" id="5021768">parseValueSpec</span><span class="op" id="5021782">(</span><span class="ident" id="5021783">doc</span>&nbsp;<span class="op" id="5021787">*</span><span class="ident" id="5021788">ast</span><span class="op" id="5021791">.</span><span class="ident" id="5021792">CommentGroup</span><span class="op" id="5021804">,</span>&nbsp;<span class="ident" id="5021806">keyword</span>&nbsp;<span class="ident" id="5021814">token</span><span class="op" id="5021819">.</span><span class="ident" id="5021820">Token</span><span class="op" id="5021825">,</span>&nbsp;<span class="ident" id="5021827">iota</span>&nbsp;<span class="builtintype" id="5021832">int</span><span class="op" id="5021835">)</span>&nbsp;<span class="ident" id="5021837">ast</span><span class="op" id="5021840">.</span><span class="ident" id="5021841">Spec</span>&nbsp;<span class="op" id="5021846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021849">if</span>&nbsp;<span class="ident" id="5021852">p</span><span class="op" id="5021853">.</span><span class="ident" id="5021854">trace</span>&nbsp;<span class="op" id="5021860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021864">defer</span>&nbsp;<span class="ident" id="5021870">un</span><span class="op" id="5021872">(</span><span class="ident" id="5021873">trace</span><span class="op" id="5021878">(</span><span class="ident" id="5021879">p</span><span class="op" id="5021880">,</span>&nbsp;<span class="ident" id="5021882">keyword</span><span class="op" id="5021889">.</span><span class="ident" id="5021890">String</span><span class="op" id="5021896">(</span><span class="op" id="5021897">)</span><span class="op" id="5021898">+</span><span class="string" id="5021899">&#34;Spec&#34;</span><span class="op" id="5021905">)</span><span class="op" id="5021906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021909">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021913">idents</span>&nbsp;<span class="op" id="5021920">:=</span>&nbsp;<span class="ident" id="5021923">p</span><span class="op" id="5021924">.</span><span class="ident" id="5021925">parseIdentList</span><span class="op" id="5021939">(</span><span class="op" id="5021940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021943">typ</span>&nbsp;<span class="op" id="5021947">:=</span>&nbsp;<span class="ident" id="5021950">p</span><span class="op" id="5021951">.</span><span class="ident" id="5021952">tryType</span><span class="op" id="5021959">(</span><span class="op" id="5021960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021963">var</span>&nbsp;<span class="ident" id="5021967">values</span>&nbsp;<span class="op" id="5021974">[</span><span class="op" id="5021975">]</span><span class="ident" id="5021976">ast</span><span class="op" id="5021979">.</span><span class="ident" id="5021980">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021986">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022054">if</span>&nbsp;<span class="ident" id="5022057">p</span><span class="op" id="5022058">.</span><span class="ident" id="5022059">tok</span>&nbsp;<span class="op" id="5022063">==</span>&nbsp;<span class="ident" id="5022066">token</span><span class="op" id="5022071">.</span><span class="ident" id="5022072">ASSIGN</span>&nbsp;<span class="op" id="5022079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022083">p</span><span class="op" id="5022084">.</span><span class="ident" id="5022085">next</span><span class="op" id="5022089">(</span><span class="op" id="5022090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022094">values</span>&nbsp;<span class="op" id="5022101">=</span>&nbsp;<span class="ident" id="5022103">p</span><span class="op" id="5022104">.</span><span class="ident" id="5022105">parseRhsList</span><span class="op" id="5022117">(</span><span class="op" id="5022118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022124">p</span><span class="op" id="5022125">.</span><span class="ident" id="5022126">expectSemi</span><span class="op" id="5022136">(</span><span class="op" id="5022137">)</span>&nbsp;<span class="comment" id="5022139">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022180">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022256">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022329">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022376">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022449">spec</span>&nbsp;<span class="op" id="5022454">:=</span>&nbsp;<span class="op" id="5022457">&amp;</span><span class="ident" id="5022458">ast</span><span class="op" id="5022461">.</span><span class="ident" id="5022462">ValueSpec</span><span class="op" id="5022471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022475">Doc</span><span class="op" id="5022478">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5022484">doc</span><span class="op" id="5022487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022491">Names</span><span class="op" id="5022496">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5022500">idents</span><span class="op" id="5022506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022510">Type</span><span class="op" id="5022514">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5022519">typ</span><span class="op" id="5022522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022526">Values</span><span class="op" id="5022532">:</span>&nbsp;&nbsp;<span class="ident" id="5022535">values</span><span class="op" id="5022541">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022545">Comment</span><span class="op" id="5022552">:</span>&nbsp;<span class="ident" id="5022554">p</span><span class="op" id="5022555">.</span><span class="ident" id="5022556">lineComment</span><span class="op" id="5022567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022573">kind</span>&nbsp;<span class="op" id="5022578">:=</span>&nbsp;<span class="ident" id="5022581">ast</span><span class="op" id="5022584">.</span><span class="ident" id="5022585">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022590">if</span>&nbsp;<span class="ident" id="5022593">keyword</span>&nbsp;<span class="op" id="5022601">==</span>&nbsp;<span class="ident" id="5022604">token</span><span class="op" id="5022609">.</span><span class="ident" id="5022610">VAR</span>&nbsp;<span class="op" id="5022614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022618">kind</span>&nbsp;<span class="op" id="5022623">=</span>&nbsp;<span class="ident" id="5022625">ast</span><span class="op" id="5022628">.</span><span class="ident" id="5022629">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022637">p</span><span class="op" id="5022638">.</span><span class="ident" id="5022639">declare</span><span class="op" id="5022646">(</span><span class="ident" id="5022647">spec</span><span class="op" id="5022651">,</span>&nbsp;<span class="ident" id="5022653">iota</span><span class="op" id="5022657">,</span>&nbsp;<span class="ident" id="5022659">p</span><span class="op" id="5022660">.</span><span class="ident" id="5022661">topScope</span><span class="op" id="5022669">,</span>&nbsp;<span class="ident" id="5022671">kind</span><span class="op" id="5022675">,</span>&nbsp;<span class="ident" id="5022677">idents</span><span class="op" id="5022683">...</span><span class="op" id="5022686">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022690">return</span>&nbsp;<span class="ident" id="5022697">spec</span><br>
<span class="lineno"></span><span class="op" id="5022702">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="5022705">func</span>&nbsp;<span class="op" id="5022710">(</span><span class="ident" id="5022711">p</span>&nbsp;<span class="op" id="5022713">*</span><span class="ident" id="5022714">parser</span><span class="op" id="5022720">)</span>&nbsp;<span class="ident" id="5022722">parseTypeSpec</span><span class="op" id="5022735">(</span><span class="ident" id="5022736">doc</span>&nbsp;<span class="op" id="5022740">*</span><span class="ident" id="5022741">ast</span><span class="op" id="5022744">.</span><span class="ident" id="5022745">CommentGroup</span><span class="op" id="5022757">,</span>&nbsp;<span class="ident" id="5022759">_</span>&nbsp;<span class="ident" id="5022761">token</span><span class="op" id="5022766">.</span><span class="ident" id="5022767">Token</span><span class="op" id="5022772">,</span>&nbsp;<span class="ident" id="5022774">_</span>&nbsp;<span class="builtintype" id="5022776">int</span><span class="op" id="5022779">)</span>&nbsp;<span class="ident" id="5022781">ast</span><span class="op" id="5022784">.</span><span class="ident" id="5022785">Spec</span>&nbsp;<span class="op" id="5022790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022793">if</span>&nbsp;<span class="ident" id="5022796">p</span><span class="op" id="5022797">.</span><span class="ident" id="5022798">trace</span>&nbsp;<span class="op" id="5022804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022808">defer</span>&nbsp;<span class="ident" id="5022814">un</span><span class="op" id="5022816">(</span><span class="ident" id="5022817">trace</span><span class="op" id="5022822">(</span><span class="ident" id="5022823">p</span><span class="op" id="5022824">,</span>&nbsp;<span class="string" id="5022826">&#34;TypeSpec&#34;</span><span class="op" id="5022836">)</span><span class="op" id="5022837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022840">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022844">ident</span>&nbsp;<span class="op" id="5022850">:=</span>&nbsp;<span class="ident" id="5022853">p</span><span class="op" id="5022854">.</span><span class="ident" id="5022855">parseIdent</span><span class="op" id="5022865">(</span><span class="op" id="5022866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022870">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5022948">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023023">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023045">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023118">spec</span>&nbsp;<span class="op" id="5023123">:=</span>&nbsp;<span class="op" id="5023126">&amp;</span><span class="ident" id="5023127">ast</span><span class="op" id="5023130">.</span><span class="ident" id="5023131">TypeSpec</span><span class="op" id="5023139">{</span><span class="ident" id="5023140">Doc</span><span class="op" id="5023143">:</span>&nbsp;<span class="ident" id="5023145">doc</span><span class="op" id="5023148">,</span>&nbsp;<span class="ident" id="5023150">Name</span><span class="op" id="5023154">:</span>&nbsp;<span class="ident" id="5023156">ident</span><span class="op" id="5023161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023164">p</span><span class="op" id="5023165">.</span><span class="ident" id="5023166">declare</span><span class="op" id="5023173">(</span><span class="ident" id="5023174">spec</span><span class="op" id="5023178">,</span>&nbsp;<span class="ident" id="5023180">nil</span><span class="op" id="5023183">,</span>&nbsp;<span class="ident" id="5023185">p</span><span class="op" id="5023186">.</span><span class="ident" id="5023187">topScope</span><span class="op" id="5023195">,</span>&nbsp;<span class="ident" id="5023197">ast</span><span class="op" id="5023200">.</span><span class="ident" id="5023201">Typ</span><span class="op" id="5023204">,</span>&nbsp;<span class="ident" id="5023206">ident</span><span class="op" id="5023211">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023215">spec</span><span class="op" id="5023219">.</span><span class="ident" id="5023220">Type</span>&nbsp;<span class="op" id="5023225">=</span>&nbsp;<span class="ident" id="5023227">p</span><span class="op" id="5023228">.</span><span class="ident" id="5023229">parseType</span><span class="op" id="5023238">(</span><span class="op" id="5023239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023242">p</span><span class="op" id="5023243">.</span><span class="ident" id="5023244">expectSemi</span><span class="op" id="5023254">(</span><span class="op" id="5023255">)</span>&nbsp;<span class="comment" id="5023257">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023297">spec</span><span class="op" id="5023301">.</span><span class="ident" id="5023302">Comment</span>&nbsp;<span class="op" id="5023310">=</span>&nbsp;<span class="ident" id="5023312">p</span><span class="op" id="5023313">.</span><span class="ident" id="5023314">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023328">return</span>&nbsp;<span class="ident" id="5023335">spec</span><br>
<span class="lineno">2280</span><span class="op" id="5023340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5023343">func</span>&nbsp;<span class="op" id="5023348">(</span><span class="ident" id="5023349">p</span>&nbsp;<span class="op" id="5023351">*</span><span class="ident" id="5023352">parser</span><span class="op" id="5023358">)</span>&nbsp;<span class="ident" id="5023360">parseGenDecl</span><span class="op" id="5023372">(</span><span class="ident" id="5023373">keyword</span>&nbsp;<span class="ident" id="5023381">token</span><span class="op" id="5023386">.</span><span class="ident" id="5023387">Token</span><span class="op" id="5023392">,</span>&nbsp;<span class="ident" id="5023394">f</span>&nbsp;<span class="ident" id="5023396">parseSpecFunction</span><span class="op" id="5023413">)</span>&nbsp;<span class="op" id="5023415">*</span><span class="ident" id="5023416">ast</span><span class="op" id="5023419">.</span><span class="ident" id="5023420">GenDecl</span>&nbsp;<span class="op" id="5023428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023431">if</span>&nbsp;<span class="ident" id="5023434">p</span><span class="op" id="5023435">.</span><span class="ident" id="5023436">trace</span>&nbsp;<span class="op" id="5023442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023446">defer</span>&nbsp;<span class="ident" id="5023452">un</span><span class="op" id="5023454">(</span><span class="ident" id="5023455">trace</span><span class="op" id="5023460">(</span><span class="ident" id="5023461">p</span><span class="op" id="5023462">,</span>&nbsp;<span class="string" id="5023464">&#34;GenDecl(&#34;</span><span class="op" id="5023474">+</span><span class="ident" id="5023475">keyword</span><span class="op" id="5023482">.</span><span class="ident" id="5023483">String</span><span class="op" id="5023489">(</span><span class="op" id="5023490">)</span><span class="op" id="5023491">+</span><span class="string" id="5023492">&#34;)&#34;</span><span class="op" id="5023495">)</span><span class="op" id="5023496">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023503">doc</span>&nbsp;<span class="op" id="5023507">:=</span>&nbsp;<span class="ident" id="5023510">p</span><span class="op" id="5023511">.</span><span class="ident" id="5023512">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023525">pos</span>&nbsp;<span class="op" id="5023529">:=</span>&nbsp;<span class="ident" id="5023532">p</span><span class="op" id="5023533">.</span><span class="ident" id="5023534">expect</span><span class="op" id="5023540">(</span><span class="ident" id="5023541">keyword</span><span class="op" id="5023548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023551">var</span>&nbsp;<span class="ident" id="5023555">lparen</span><span class="op" id="5023561">,</span>&nbsp;<span class="ident" id="5023563">rparen</span>&nbsp;<span class="ident" id="5023570">token</span><span class="op" id="5023575">.</span><span class="ident" id="5023576">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023581">var</span>&nbsp;<span class="ident" id="5023585">list</span>&nbsp;<span class="op" id="5023590">[</span><span class="op" id="5023591">]</span><span class="ident" id="5023592">ast</span><span class="op" id="5023595">.</span><span class="ident" id="5023596">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023602">if</span>&nbsp;<span class="ident" id="5023605">p</span><span class="op" id="5023606">.</span><span class="ident" id="5023607">tok</span>&nbsp;<span class="op" id="5023611">==</span>&nbsp;<span class="ident" id="5023614">token</span><span class="op" id="5023619">.</span><span class="ident" id="5023620">LPAREN</span>&nbsp;<span class="op" id="5023627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023631">lparen</span>&nbsp;<span class="op" id="5023638">=</span>&nbsp;<span class="ident" id="5023640">p</span><span class="op" id="5023641">.</span><span class="ident" id="5023642">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023648">p</span><span class="op" id="5023649">.</span><span class="ident" id="5023650">next</span><span class="op" id="5023654">(</span><span class="op" id="5023655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023659">for</span>&nbsp;<span class="ident" id="5023663">iota</span>&nbsp;<span class="op" id="5023668">:=</span>&nbsp;<span class="num" id="5023671">0</span><span class="op" id="5023672">;</span>&nbsp;<span class="ident" id="5023674">p</span><span class="op" id="5023675">.</span><span class="ident" id="5023676">tok</span>&nbsp;<span class="op" id="5023680">!=</span>&nbsp;<span class="ident" id="5023683">token</span><span class="op" id="5023688">.</span><span class="ident" id="5023689">RPAREN</span>&nbsp;<span class="op" id="5023696">&amp;&amp;</span>&nbsp;<span class="ident" id="5023699">p</span><span class="op" id="5023700">.</span><span class="ident" id="5023701">tok</span>&nbsp;<span class="op" id="5023705">!=</span>&nbsp;<span class="ident" id="5023708">token</span><span class="op" id="5023713">.</span><span class="ident" id="5023714">EOF</span><span class="op" id="5023717">;</span>&nbsp;<span class="ident" id="5023719">iota</span><span class="op" id="5023723">++</span>&nbsp;<span class="op" id="5023726">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023731">list</span>&nbsp;<span class="op" id="5023736">=</span>&nbsp;<span class="builtinfunc" id="5023738">append</span><span class="op" id="5023744">(</span><span class="ident" id="5023745">list</span><span class="op" id="5023749">,</span>&nbsp;<span class="ident" id="5023751">f</span><span class="op" id="5023752">(</span><span class="ident" id="5023753">p</span><span class="op" id="5023754">.</span><span class="ident" id="5023755">leadComment</span><span class="op" id="5023766">,</span>&nbsp;<span class="ident" id="5023768">keyword</span><span class="op" id="5023775">,</span>&nbsp;<span class="ident" id="5023777">iota</span><span class="op" id="5023781">)</span><span class="op" id="5023782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023790">rparen</span>&nbsp;<span class="op" id="5023797">=</span>&nbsp;<span class="ident" id="5023799">p</span><span class="op" id="5023800">.</span><span class="ident" id="5023801">expect</span><span class="op" id="5023807">(</span><span class="ident" id="5023808">token</span><span class="op" id="5023813">.</span><span class="ident" id="5023814">RPAREN</span><span class="op" id="5023820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023824">p</span><span class="op" id="5023825">.</span><span class="ident" id="5023826">expectSemi</span><span class="op" id="5023836">(</span><span class="op" id="5023837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023840">}</span>&nbsp;<span class="keyword" id="5023842">else</span>&nbsp;<span class="op" id="5023847">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023851">list</span>&nbsp;<span class="op" id="5023856">=</span>&nbsp;<span class="builtinfunc" id="5023858">append</span><span class="op" id="5023864">(</span><span class="ident" id="5023865">list</span><span class="op" id="5023869">,</span>&nbsp;<span class="ident" id="5023871">f</span><span class="op" id="5023872">(</span><span class="ident" id="5023873">nil</span><span class="op" id="5023876">,</span>&nbsp;<span class="ident" id="5023878">keyword</span><span class="op" id="5023885">,</span>&nbsp;<span class="num" id="5023887">0</span><span class="op" id="5023888">)</span><span class="op" id="5023889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023896">return</span>&nbsp;<span class="op" id="5023903">&amp;</span><span class="ident" id="5023904">ast</span><span class="op" id="5023907">.</span><span class="ident" id="5023908">GenDecl</span><span class="op" id="5023915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023919">Doc</span><span class="op" id="5023922">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5023927">doc</span><span class="op" id="5023930">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023934">TokPos</span><span class="op" id="5023940">:</span>&nbsp;<span class="ident" id="5023942">pos</span><span class="op" id="5023945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023949">Tok</span><span class="op" id="5023952">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5023957">keyword</span><span class="op" id="5023964">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023968">Lparen</span><span class="op" id="5023974">:</span>&nbsp;<span class="ident" id="5023976">lparen</span><span class="op" id="5023982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023986">Specs</span><span class="op" id="5023991">:</span>&nbsp;&nbsp;<span class="ident" id="5023994">list</span><span class="op" id="5023998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024002">Rparen</span><span class="op" id="5024008">:</span>&nbsp;<span class="ident" id="5024010">rparen</span><span class="op" id="5024016">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024019">}</span><br>
<span class="lineno"></span><span class="op" id="5024021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5024024">func</span>&nbsp;<span class="op" id="5024029">(</span><span class="ident" id="5024030">p</span>&nbsp;<span class="op" id="5024032">*</span><span class="ident" id="5024033">parser</span><span class="op" id="5024039">)</span>&nbsp;<span class="ident" id="5024041">parseFuncDecl</span><span class="op" id="5024054">(</span><span class="op" id="5024055">)</span>&nbsp;<span class="op" id="5024057">*</span><span class="ident" id="5024058">ast</span><span class="op" id="5024061">.</span><span class="ident" id="5024062">FuncDecl</span>&nbsp;<span class="op" id="5024071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024074">if</span>&nbsp;<span class="ident" id="5024077">p</span><span class="op" id="5024078">.</span><span class="ident" id="5024079">trace</span>&nbsp;<span class="op" id="5024085">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024089">defer</span>&nbsp;<span class="ident" id="5024095">un</span><span class="op" id="5024097">(</span><span class="ident" id="5024098">trace</span><span class="op" id="5024103">(</span><span class="ident" id="5024104">p</span><span class="op" id="5024105">,</span>&nbsp;<span class="string" id="5024107">&#34;FunctionDecl&#34;</span><span class="op" id="5024121">)</span><span class="op" id="5024122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024129">doc</span>&nbsp;<span class="op" id="5024133">:=</span>&nbsp;<span class="ident" id="5024136">p</span><span class="op" id="5024137">.</span><span class="ident" id="5024138">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024151">pos</span>&nbsp;<span class="op" id="5024155">:=</span>&nbsp;<span class="ident" id="5024158">p</span><span class="op" id="5024159">.</span><span class="ident" id="5024160">expect</span><span class="op" id="5024166">(</span><span class="ident" id="5024167">token</span><span class="op" id="5024172">.</span><span class="ident" id="5024173">FUNC</span><span class="op" id="5024177">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024180">scope</span>&nbsp;<span class="op" id="5024186">:=</span>&nbsp;<span class="ident" id="5024189">ast</span><span class="op" id="5024192">.</span><span class="ident" id="5024193">NewScope</span><span class="op" id="5024201">(</span><span class="ident" id="5024202">p</span><span class="op" id="5024203">.</span><span class="ident" id="5024204">topScope</span><span class="op" id="5024212">)</span>&nbsp;<span class="comment" id="5024214">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024234">var</span>&nbsp;<span class="ident" id="5024238">recv</span>&nbsp;<span class="op" id="5024243">*</span><span class="ident" id="5024244">ast</span><span class="op" id="5024247">.</span><span class="ident" id="5024248">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024259">if</span>&nbsp;<span class="ident" id="5024262">p</span><span class="op" id="5024263">.</span><span class="ident" id="5024264">tok</span>&nbsp;<span class="op" id="5024268">==</span>&nbsp;<span class="ident" id="5024271">token</span><span class="op" id="5024276">.</span><span class="ident" id="5024277">LPAREN</span>&nbsp;<span class="op" id="5024284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024288">recv</span>&nbsp;<span class="op" id="5024293">=</span>&nbsp;<span class="ident" id="5024295">p</span><span class="op" id="5024296">.</span><span class="ident" id="5024297">parseParameters</span><span class="op" id="5024312">(</span><span class="ident" id="5024313">scope</span><span class="op" id="5024318">,</span>&nbsp;<span class="builtintype" id="5024320">false</span><span class="op" id="5024325">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024332">ident</span>&nbsp;<span class="op" id="5024338">:=</span>&nbsp;<span class="ident" id="5024341">p</span><span class="op" id="5024342">.</span><span class="ident" id="5024343">parseIdent</span><span class="op" id="5024353">(</span><span class="op" id="5024354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024358">params</span><span class="op" id="5024364">,</span>&nbsp;<span class="ident" id="5024366">results</span>&nbsp;<span class="op" id="5024374">:=</span>&nbsp;<span class="ident" id="5024377">p</span><span class="op" id="5024378">.</span><span class="ident" id="5024379">parseSignature</span><span class="op" id="5024393">(</span><span class="ident" id="5024394">scope</span><span class="op" id="5024399">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024403">var</span>&nbsp;<span class="ident" id="5024407">body</span>&nbsp;<span class="op" id="5024412">*</span><span class="ident" id="5024413">ast</span><span class="op" id="5024416">.</span><span class="ident" id="5024417">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024428">if</span>&nbsp;<span class="ident" id="5024431">p</span><span class="op" id="5024432">.</span><span class="ident" id="5024433">tok</span>&nbsp;<span class="op" id="5024437">==</span>&nbsp;<span class="ident" id="5024440">token</span><span class="op" id="5024445">.</span><span class="ident" id="5024446">LBRACE</span>&nbsp;<span class="op" id="5024453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024457">body</span>&nbsp;<span class="op" id="5024462">=</span>&nbsp;<span class="ident" id="5024464">p</span><span class="op" id="5024465">.</span><span class="ident" id="5024466">parseBody</span><span class="op" id="5024475">(</span><span class="ident" id="5024476">scope</span><span class="op" id="5024481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024484">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024487">p</span><span class="op" id="5024488">.</span><span class="ident" id="5024489">expectSemi</span><span class="op" id="5024499">(</span><span class="op" id="5024500">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024504">decl</span>&nbsp;<span class="op" id="5024509">:=</span>&nbsp;<span class="op" id="5024512">&amp;</span><span class="ident" id="5024513">ast</span><span class="op" id="5024516">.</span><span class="ident" id="5024517">FuncDecl</span><span class="op" id="5024525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024529">Doc</span><span class="op" id="5024532">:</span>&nbsp;&nbsp;<span class="ident" id="5024535">doc</span><span class="op" id="5024538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024542">Recv</span><span class="op" id="5024546">:</span>&nbsp;<span class="ident" id="5024548">recv</span><span class="op" id="5024552">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024556">Name</span><span class="op" id="5024560">:</span>&nbsp;<span class="ident" id="5024562">ident</span><span class="op" id="5024567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024571">Type</span><span class="op" id="5024575">:</span>&nbsp;<span class="op" id="5024577">&amp;</span><span class="ident" id="5024578">ast</span><span class="op" id="5024581">.</span><span class="ident" id="5024582">FuncType</span><span class="op" id="5024590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024595">Func</span><span class="op" id="5024599">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5024604">pos</span><span class="op" id="5024607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024612">Params</span><span class="op" id="5024618">:</span>&nbsp;&nbsp;<span class="ident" id="5024621">params</span><span class="op" id="5024627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024632">Results</span><span class="op" id="5024639">:</span>&nbsp;<span class="ident" id="5024641">results</span><span class="op" id="5024648">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024652">}</span><span class="op" id="5024653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024657">Body</span><span class="op" id="5024661">:</span>&nbsp;<span class="ident" id="5024663">body</span><span class="op" id="5024667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024673">if</span>&nbsp;<span class="ident" id="5024676">recv</span>&nbsp;<span class="op" id="5024681">==</span>&nbsp;<span class="ident" id="5024684">nil</span>&nbsp;<span class="op" id="5024688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024692">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024760">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024826">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024876">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024881">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024939">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024994">if</span>&nbsp;<span class="ident" id="5024997">ident</span><span class="op" id="5025002">.</span><span class="ident" id="5025003">Name</span>&nbsp;<span class="op" id="5025008">!=</span>&nbsp;<span class="string" id="5025011">&#34;init&#34;</span>&nbsp;<span class="op" id="5025018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025023">p</span><span class="op" id="5025024">.</span><span class="ident" id="5025025">declare</span><span class="op" id="5025032">(</span><span class="ident" id="5025033">decl</span><span class="op" id="5025037">,</span>&nbsp;<span class="ident" id="5025039">nil</span><span class="op" id="5025042">,</span>&nbsp;<span class="ident" id="5025044">p</span><span class="op" id="5025045">.</span><span class="ident" id="5025046">pkgScope</span><span class="op" id="5025054">,</span>&nbsp;<span class="ident" id="5025056">ast</span><span class="op" id="5025059">.</span><span class="ident" id="5025060">Fun</span><span class="op" id="5025063">,</span>&nbsp;<span class="ident" id="5025065">ident</span><span class="op" id="5025070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025081">return</span>&nbsp;<span class="ident" id="5025088">decl</span><br>
<span class="lineno"></span><span class="op" id="5025093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5025096">func</span>&nbsp;<span class="op" id="5025101">(</span><span class="ident" id="5025102">p</span>&nbsp;<span class="op" id="5025104">*</span><span class="ident" id="5025105">parser</span><span class="op" id="5025111">)</span>&nbsp;<span class="ident" id="5025113">parseDecl</span><span class="op" id="5025122">(</span><span class="ident" id="5025123">sync</span>&nbsp;<span class="keyword" id="5025128">func</span><span class="op" id="5025132">(</span><span class="op" id="5025133">*</span><span class="ident" id="5025134">parser</span><span class="op" id="5025140">)</span><span class="op" id="5025141">)</span>&nbsp;<span class="ident" id="5025143">ast</span><span class="op" id="5025146">.</span><span class="ident" id="5025147">Decl</span>&nbsp;<span class="op" id="5025152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025155">if</span>&nbsp;<span class="ident" id="5025158">p</span><span class="op" id="5025159">.</span><span class="ident" id="5025160">trace</span>&nbsp;<span class="op" id="5025166">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025170">defer</span>&nbsp;<span class="ident" id="5025176">un</span><span class="op" id="5025178">(</span><span class="ident" id="5025179">trace</span><span class="op" id="5025184">(</span><span class="ident" id="5025185">p</span><span class="op" id="5025186">,</span>&nbsp;<span class="string" id="5025188">&#34;Declaration&#34;</span><span class="op" id="5025201">)</span><span class="op" id="5025202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025209">var</span>&nbsp;<span class="ident" id="5025213">f</span>&nbsp;<span class="ident" id="5025215">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025234">switch</span>&nbsp;<span class="ident" id="5025241">p</span><span class="op" id="5025242">.</span><span class="ident" id="5025243">tok</span>&nbsp;<span class="op" id="5025247">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025250">case</span>&nbsp;<span class="ident" id="5025255">token</span><span class="op" id="5025260">.</span><span class="ident" id="5025261">CONST</span><span class="op" id="5025266">,</span>&nbsp;<span class="ident" id="5025268">token</span><span class="op" id="5025273">.</span><span class="ident" id="5025274">VAR</span><span class="op" id="5025277">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025281">f</span>&nbsp;<span class="op" id="5025283">=</span>&nbsp;<span class="ident" id="5025285">p</span><span class="op" id="5025286">.</span><span class="ident" id="5025287">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025304">case</span>&nbsp;<span class="ident" id="5025309">token</span><span class="op" id="5025314">.</span><span class="ident" id="5025315">TYPE</span><span class="op" id="5025319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025323">f</span>&nbsp;<span class="op" id="5025325">=</span>&nbsp;<span class="ident" id="5025327">p</span><span class="op" id="5025328">.</span><span class="ident" id="5025329">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025345">case</span>&nbsp;<span class="ident" id="5025350">token</span><span class="op" id="5025355">.</span><span class="ident" id="5025356">FUNC</span><span class="op" id="5025360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025364">return</span>&nbsp;<span class="ident" id="5025371">p</span><span class="op" id="5025372">.</span><span class="ident" id="5025373">parseFuncDecl</span><span class="op" id="5025386">(</span><span class="op" id="5025387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025391">default</span><span class="op" id="5025398">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025402">pos</span>&nbsp;<span class="op" id="5025406">:=</span>&nbsp;<span class="ident" id="5025409">p</span><span class="op" id="5025410">.</span><span class="ident" id="5025411">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025417">p</span><span class="op" id="5025418">.</span><span class="ident" id="5025419">errorExpected</span><span class="op" id="5025432">(</span><span class="ident" id="5025433">pos</span><span class="op" id="5025436">,</span>&nbsp;<span class="string" id="5025438">&#34;declaration&#34;</span><span class="op" id="5025451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025455">sync</span><span class="op" id="5025459">(</span><span class="ident" id="5025460">p</span><span class="op" id="5025461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025465">return</span>&nbsp;<span class="op" id="5025472">&amp;</span><span class="ident" id="5025473">ast</span><span class="op" id="5025476">.</span><span class="ident" id="5025477">BadDecl</span><span class="op" id="5025484">{</span><span class="ident" id="5025485">From</span><span class="op" id="5025489">:</span>&nbsp;<span class="ident" id="5025491">pos</span><span class="op" id="5025494">,</span>&nbsp;<span class="ident" id="5025496">To</span><span class="op" id="5025498">:</span>&nbsp;<span class="ident" id="5025500">p</span><span class="op" id="5025501">.</span><span class="ident" id="5025502">pos</span><span class="op" id="5025505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025508">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025512">return</span>&nbsp;<span class="ident" id="5025519">p</span><span class="op" id="5025520">.</span><span class="ident" id="5025521">parseGenDecl</span><span class="op" id="5025533">(</span><span class="ident" id="5025534">p</span><span class="op" id="5025535">.</span><span class="ident" id="5025536">tok</span><span class="op" id="5025539">,</span>&nbsp;<span class="ident" id="5025541">f</span><span class="op" id="5025542">)</span><br>
<span class="lineno"></span><span class="op" id="5025544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5025547">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="5025627">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5025644">func</span>&nbsp;<span class="op" id="5025649">(</span><span class="ident" id="5025650">p</span>&nbsp;<span class="op" id="5025652">*</span><span class="ident" id="5025653">parser</span><span class="op" id="5025659">)</span>&nbsp;<span class="ident" id="5025661">parseFile</span><span class="op" id="5025670">(</span><span class="op" id="5025671">)</span>&nbsp;<span class="op" id="5025673">*</span><span class="ident" id="5025674">ast</span><span class="op" id="5025677">.</span><span class="ident" id="5025678">File</span>&nbsp;<span class="op" id="5025683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025686">if</span>&nbsp;<span class="ident" id="5025689">p</span><span class="op" id="5025690">.</span><span class="ident" id="5025691">trace</span>&nbsp;<span class="op" id="5025697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025701">defer</span>&nbsp;<span class="ident" id="5025707">un</span><span class="op" id="5025709">(</span><span class="ident" id="5025710">trace</span><span class="op" id="5025715">(</span><span class="ident" id="5025716">p</span><span class="op" id="5025717">,</span>&nbsp;<span class="string" id="5025719">&#34;File&#34;</span><span class="op" id="5025725">)</span><span class="op" id="5025726">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025733">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025810">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025850">if</span>&nbsp;<span class="ident" id="5025853">p</span><span class="op" id="5025854">.</span><span class="ident" id="5025855">errors</span><span class="op" id="5025861">.</span><span class="ident" id="5025862">Len</span><span class="op" id="5025865">(</span><span class="op" id="5025866">)</span>&nbsp;<span class="op" id="5025868">!=</span>&nbsp;<span class="num" id="5025871">0</span>&nbsp;<span class="op" id="5025873">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025877">return</span>&nbsp;<span class="ident" id="5025884">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025893">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025912">doc</span>&nbsp;<span class="op" id="5025916">:=</span>&nbsp;<span class="ident" id="5025919">p</span><span class="op" id="5025920">.</span><span class="ident" id="5025921">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025934">pos</span>&nbsp;<span class="op" id="5025938">:=</span>&nbsp;<span class="ident" id="5025941">p</span><span class="op" id="5025942">.</span><span class="ident" id="5025943">expect</span><span class="op" id="5025949">(</span><span class="ident" id="5025950">token</span><span class="op" id="5025955">.</span><span class="ident" id="5025956">PACKAGE</span><span class="op" id="5025963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025966">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026020">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026071">ident</span>&nbsp;<span class="op" id="5026077">:=</span>&nbsp;<span class="ident" id="5026080">p</span><span class="op" id="5026081">.</span><span class="ident" id="5026082">parseIdent</span><span class="op" id="5026092">(</span><span class="op" id="5026093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026096">if</span>&nbsp;<span class="ident" id="5026099">ident</span><span class="op" id="5026104">.</span><span class="ident" id="5026105">Name</span>&nbsp;<span class="op" id="5026110">==</span>&nbsp;<span class="string" id="5026113">&#34;_&#34;</span>&nbsp;<span class="op" id="5026117">&amp;&amp;</span>&nbsp;<span class="ident" id="5026120">p</span><span class="op" id="5026121">.</span><span class="ident" id="5026122">mode</span><span class="op" id="5026126">&amp;</span><span class="ident" id="5026127">DeclarationErrors</span>&nbsp;<span class="op" id="5026145">!=</span>&nbsp;<span class="num" id="5026148">0</span>&nbsp;<span class="op" id="5026150">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026154">p</span><span class="op" id="5026155">.</span><span class="builtintype" id="5026156">error</span><span class="op" id="5026161">(</span><span class="ident" id="5026162">p</span><span class="op" id="5026163">.</span><span class="ident" id="5026164">pos</span><span class="op" id="5026167">,</span>&nbsp;<span class="string" id="5026169">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="5026193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026199">p</span><span class="op" id="5026200">.</span><span class="ident" id="5026201">expectSemi</span><span class="op" id="5026211">(</span><span class="op" id="5026212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026216">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026295">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026335">if</span>&nbsp;<span class="ident" id="5026338">p</span><span class="op" id="5026339">.</span><span class="ident" id="5026340">errors</span><span class="op" id="5026346">.</span><span class="ident" id="5026347">Len</span><span class="op" id="5026350">(</span><span class="op" id="5026351">)</span>&nbsp;<span class="op" id="5026353">!=</span>&nbsp;<span class="num" id="5026356">0</span>&nbsp;<span class="op" id="5026358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026362">return</span>&nbsp;<span class="ident" id="5026369">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026378">p</span><span class="op" id="5026379">.</span><span class="ident" id="5026380">openScope</span><span class="op" id="5026389">(</span><span class="op" id="5026390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026393">p</span><span class="op" id="5026394">.</span><span class="ident" id="5026395">pkgScope</span>&nbsp;<span class="op" id="5026404">=</span>&nbsp;<span class="ident" id="5026406">p</span><span class="op" id="5026407">.</span><span class="ident" id="5026408">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026418">var</span>&nbsp;<span class="ident" id="5026422">decls</span>&nbsp;<span class="op" id="5026428">[</span><span class="op" id="5026429">]</span><span class="ident" id="5026430">ast</span><span class="op" id="5026433">.</span><span class="ident" id="5026434">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026440">if</span>&nbsp;<span class="ident" id="5026443">p</span><span class="op" id="5026444">.</span><span class="ident" id="5026445">mode</span><span class="op" id="5026449">&amp;</span><span class="ident" id="5026450">PackageClauseOnly</span>&nbsp;<span class="op" id="5026468">==</span>&nbsp;<span class="num" id="5026471">0</span>&nbsp;<span class="op" id="5026473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026477">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026495">for</span>&nbsp;<span class="ident" id="5026499">p</span><span class="op" id="5026500">.</span><span class="ident" id="5026501">tok</span>&nbsp;<span class="op" id="5026505">==</span>&nbsp;<span class="ident" id="5026508">token</span><span class="op" id="5026513">.</span><span class="ident" id="5026514">IMPORT</span>&nbsp;<span class="op" id="5026521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026526">decls</span>&nbsp;<span class="op" id="5026532">=</span>&nbsp;<span class="builtinfunc" id="5026534">append</span><span class="op" id="5026540">(</span><span class="ident" id="5026541">decls</span><span class="op" id="5026546">,</span>&nbsp;<span class="ident" id="5026548">p</span><span class="op" id="5026549">.</span><span class="ident" id="5026550">parseGenDecl</span><span class="op" id="5026562">(</span><span class="ident" id="5026563">token</span><span class="op" id="5026568">.</span><span class="ident" id="5026569">IMPORT</span><span class="op" id="5026575">,</span>&nbsp;<span class="ident" id="5026577">p</span><span class="op" id="5026578">.</span><span class="ident" id="5026579">parseImportSpec</span><span class="op" id="5026594">)</span><span class="op" id="5026595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026604">if</span>&nbsp;<span class="ident" id="5026607">p</span><span class="op" id="5026608">.</span><span class="ident" id="5026609">mode</span><span class="op" id="5026613">&amp;</span><span class="ident" id="5026614">ImportsOnly</span>&nbsp;<span class="op" id="5026626">==</span>&nbsp;<span class="num" id="5026629">0</span>&nbsp;<span class="op" id="5026631">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026636">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026663">for</span>&nbsp;<span class="ident" id="5026667">p</span><span class="op" id="5026668">.</span><span class="ident" id="5026669">tok</span>&nbsp;<span class="op" id="5026673">!=</span>&nbsp;<span class="ident" id="5026676">token</span><span class="op" id="5026681">.</span><span class="ident" id="5026682">EOF</span>&nbsp;<span class="op" id="5026686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026692">decls</span>&nbsp;<span class="op" id="5026698">=</span>&nbsp;<span class="builtinfunc" id="5026700">append</span><span class="op" id="5026706">(</span><span class="ident" id="5026707">decls</span><span class="op" id="5026712">,</span>&nbsp;<span class="ident" id="5026714">p</span><span class="op" id="5026715">.</span><span class="ident" id="5026716">parseDecl</span><span class="op" id="5026725">(</span><span class="ident" id="5026726">syncDecl</span><span class="op" id="5026734">)</span><span class="op" id="5026735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026744">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026750">p</span><span class="op" id="5026751">.</span><span class="ident" id="5026752">closeScope</span><span class="op" id="5026762">(</span><span class="op" id="5026763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026766">assert</span><span class="op" id="5026772">(</span><span class="ident" id="5026773">p</span><span class="op" id="5026774">.</span><span class="ident" id="5026775">topScope</span>&nbsp;<span class="op" id="5026784">==</span>&nbsp;<span class="ident" id="5026787">nil</span><span class="op" id="5026790">,</span>&nbsp;<span class="string" id="5026792">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="5026811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026814">assert</span><span class="op" id="5026820">(</span><span class="ident" id="5026821">p</span><span class="op" id="5026822">.</span><span class="ident" id="5026823">labelScope</span>&nbsp;<span class="op" id="5026834">==</span>&nbsp;<span class="ident" id="5026837">nil</span><span class="op" id="5026840">,</span>&nbsp;<span class="string" id="5026842">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="5026867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026871">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026923">i</span>&nbsp;<span class="op" id="5026925">:=</span>&nbsp;<span class="num" id="5026928">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026931">for</span>&nbsp;<span class="ident" id="5026935">_</span><span class="op" id="5026936">,</span>&nbsp;<span class="ident" id="5026938">ident</span>&nbsp;<span class="op" id="5026944">:=</span>&nbsp;<span class="keyword" id="5026947">range</span>&nbsp;<span class="ident" id="5026953">p</span><span class="op" id="5026954">.</span><span class="ident" id="5026955">unresolved</span>&nbsp;<span class="op" id="5026966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026970">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027004">assert</span><span class="op" id="5027010">(</span><span class="ident" id="5027011">ident</span><span class="op" id="5027016">.</span><span class="ident" id="5027017">Obj</span>&nbsp;<span class="op" id="5027021">==</span>&nbsp;<span class="ident" id="5027024">unresolved</span><span class="op" id="5027034">,</span>&nbsp;<span class="string" id="5027036">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="5027061">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027065">ident</span><span class="op" id="5027070">.</span><span class="ident" id="5027071">Obj</span>&nbsp;<span class="op" id="5027075">=</span>&nbsp;<span class="ident" id="5027077">p</span><span class="op" id="5027078">.</span><span class="ident" id="5027079">pkgScope</span><span class="op" id="5027087">.</span><span class="ident" id="5027088">Lookup</span><span class="op" id="5027094">(</span><span class="ident" id="5027095">ident</span><span class="op" id="5027100">.</span><span class="ident" id="5027101">Name</span><span class="op" id="5027105">)</span>&nbsp;<span class="comment" id="5027107">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027145">if</span>&nbsp;<span class="ident" id="5027148">ident</span><span class="op" id="5027153">.</span><span class="ident" id="5027154">Obj</span>&nbsp;<span class="op" id="5027158">==</span>&nbsp;<span class="ident" id="5027161">nil</span>&nbsp;<span class="op" id="5027165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027170">p</span><span class="op" id="5027171">.</span><span class="ident" id="5027172">unresolved</span><span class="op" id="5027182">[</span><span class="ident" id="5027183">i</span><span class="op" id="5027184">]</span>&nbsp;<span class="op" id="5027186">=</span>&nbsp;<span class="ident" id="5027188">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027197">i</span><span class="op" id="5027198">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027203">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027210">return</span>&nbsp;<span class="op" id="5027217">&amp;</span><span class="ident" id="5027218">ast</span><span class="op" id="5027221">.</span><span class="ident" id="5027222">File</span><span class="op" id="5027226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027230">Doc</span><span class="op" id="5027233">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5027242">doc</span><span class="op" id="5027245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027249">Package</span><span class="op" id="5027256">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5027261">pos</span><span class="op" id="5027264">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027268">Name</span><span class="op" id="5027272">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5027280">ident</span><span class="op" id="5027285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027289">Decls</span><span class="op" id="5027294">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5027301">decls</span><span class="op" id="5027306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027310">Scope</span><span class="op" id="5027315">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5027322">p</span><span class="op" id="5027323">.</span><span class="ident" id="5027324">pkgScope</span><span class="op" id="5027332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027336">Imports</span><span class="op" id="5027343">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5027348">p</span><span class="op" id="5027349">.</span><span class="ident" id="5027350">imports</span><span class="op" id="5027357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027361">Unresolved</span><span class="op" id="5027371">:</span>&nbsp;<span class="ident" id="5027373">p</span><span class="op" id="5027374">.</span><span class="ident" id="5027375">unresolved</span><span class="op" id="5027385">[</span><span class="num" id="5027386">0</span><span class="op" id="5027387">:</span><span class="ident" id="5027388">i</span><span class="op" id="5027389">]</span><span class="op" id="5027390">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027394">Comments</span><span class="op" id="5027402">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5027406">p</span><span class="op" id="5027407">.</span><span class="ident" id="5027408">comments</span><span class="op" id="5027416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027419">}</span><br>
<span class="lineno"></span><span class="op" id="5027421">}</span>
</div>
</body>
</html>
