<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/signal</h2>
<ul>
<li><a href="/gostd/os/signal/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/signal/signal.go.html">signal.go</a></li>
<li><a href="/gostd/os/signal/signal_test.go.html">signal_test.go</a></li>
<li><a href="/gostd/os/signal/signal_unix.go.html">signal_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5759061">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5759116">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5759170">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5759221">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5759278">package</span>&nbsp;<span class="ident" id="5759286">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5759294">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5759355">import</span>&nbsp;<span class="op" id="5759362">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5759365">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5759371">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5759378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5759381">var</span>&nbsp;<span class="ident" id="5759385">handlers</span>&nbsp;<span class="keyword" id="5759394">struct</span>&nbsp;<span class="op" id="5759401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759404">sync</span><span class="op" id="5759408">.</span><span class="ident" id="5759409">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759416">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5759420">map</span><span class="op" id="5759423">[</span><span class="keyword" id="5759424">chan</span><span class="op" id="5759428">&lt;-</span>&nbsp;<span class="ident" id="5759431">os</span><span class="op" id="5759433">.</span><span class="ident" id="5759434">Signal</span><span class="op" id="5759440">]</span><span class="op" id="5759441">*</span><span class="ident" id="5759442">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759451">ref</span>&nbsp;<span class="op" id="5759455">[</span><span class="ident" id="5759456">numSig</span><span class="op" id="5759462">]</span><span class="ident" id="5759463">int64</span><br>
<span class="lineno"></span><span class="op" id="5759469">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5759472">type</span>&nbsp;<span class="ident" id="5759477">handler</span>&nbsp;<span class="keyword" id="5759485">struct</span>&nbsp;<span class="op" id="5759492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759495">mask</span>&nbsp;<span class="op" id="5759500">[</span><span class="op" id="5759501">(</span><span class="ident" id="5759502">numSig</span>&nbsp;<span class="op" id="5759509">+</span>&nbsp;<span class="num" id="5759511">31</span><span class="op" id="5759513">)</span>&nbsp;<span class="op" id="5759515">/</span>&nbsp;<span class="num" id="5759517">32</span><span class="op" id="5759519">]</span><span class="builtintype" id="5759520">uint32</span><br>
<span class="lineno"></span><span class="op" id="5759527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5759530">func</span>&nbsp;<span class="op" id="5759535">(</span><span class="ident" id="5759536">h</span>&nbsp;<span class="op" id="5759538">*</span><span class="ident" id="5759539">handler</span><span class="op" id="5759546">)</span>&nbsp;<span class="ident" id="5759548">want</span><span class="op" id="5759552">(</span><span class="ident" id="5759553">sig</span>&nbsp;<span class="builtintype" id="5759557">int</span><span class="op" id="5759560">)</span>&nbsp;<span class="builtintype" id="5759562">bool</span>&nbsp;<span class="op" id="5759567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759570">return</span>&nbsp;<span class="op" id="5759577">(</span><span class="ident" id="5759578">h</span><span class="op" id="5759579">.</span><span class="ident" id="5759580">mask</span><span class="op" id="5759584">[</span><span class="ident" id="5759585">sig</span><span class="op" id="5759588">/</span><span class="num" id="5759589">32</span><span class="op" id="5759591">]</span><span class="op" id="5759592">&gt;&gt;</span><span class="builtintype" id="5759594">uint</span><span class="op" id="5759598">(</span><span class="ident" id="5759599">sig</span><span class="op" id="5759602">&amp;</span><span class="num" id="5759603">31</span><span class="op" id="5759605">)</span><span class="op" id="5759606">)</span><span class="op" id="5759607">&amp;</span><span class="num" id="5759608">1</span>&nbsp;<span class="op" id="5759610">!=</span>&nbsp;<span class="num" id="5759613">0</span><br>
<span class="lineno"></span><span class="op" id="5759615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5759618">func</span>&nbsp;<span class="op" id="5759623">(</span><span class="ident" id="5759624">h</span>&nbsp;<span class="op" id="5759626">*</span><span class="ident" id="5759627">handler</span><span class="op" id="5759634">)</span>&nbsp;<span class="ident" id="5759636">set</span><span class="op" id="5759639">(</span><span class="ident" id="5759640">sig</span>&nbsp;<span class="builtintype" id="5759644">int</span><span class="op" id="5759647">)</span>&nbsp;<span class="op" id="5759649">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759652">h</span><span class="op" id="5759653">.</span><span class="ident" id="5759654">mask</span><span class="op" id="5759658">[</span><span class="ident" id="5759659">sig</span><span class="op" id="5759662">/</span><span class="num" id="5759663">32</span><span class="op" id="5759665">]</span>&nbsp;<span class="op" id="5759667">|=</span>&nbsp;<span class="num" id="5759670">1</span>&nbsp;<span class="op" id="5759672">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5759675">uint</span><span class="op" id="5759679">(</span><span class="ident" id="5759680">sig</span><span class="op" id="5759683">&amp;</span><span class="num" id="5759684">31</span><span class="op" id="5759686">)</span><br>
<span class="lineno"></span><span class="op" id="5759688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5759691">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5759755">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="5759827">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="5759871">//</span><br>
<span class="lineno"></span><span class="comment" id="5759874">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5759944">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="5760011">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="5760090">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="5760127">//</span><br>
<span class="lineno"></span><span class="comment" id="5760130">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="5760200">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5760262">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="5760326">//</span><br>
<span class="lineno"></span><span class="comment" id="5760329">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="5760400">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5760466">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="5760492">func</span>&nbsp;<span class="ident" id="5760497">Notify</span><span class="op" id="5760503">(</span><span class="ident" id="5760504">c</span>&nbsp;<span class="keyword" id="5760506">chan</span><span class="op" id="5760510">&lt;-</span>&nbsp;<span class="ident" id="5760513">os</span><span class="op" id="5760515">.</span><span class="ident" id="5760516">Signal</span><span class="op" id="5760522">,</span>&nbsp;<span class="ident" id="5760524">sig</span>&nbsp;<span class="op" id="5760528">...</span><span class="ident" id="5760531">os</span><span class="op" id="5760533">.</span><span class="ident" id="5760534">Signal</span><span class="op" id="5760540">)</span>&nbsp;<span class="op" id="5760542">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760545">if</span>&nbsp;<span class="ident" id="5760548">c</span>&nbsp;<span class="op" id="5760550">==</span>&nbsp;<span class="ident" id="5760553">nil</span>&nbsp;<span class="op" id="5760557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5760561">panic</span><span class="op" id="5760566">(</span><span class="string" id="5760567">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="5760604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760611">handlers</span><span class="op" id="5760619">.</span><span class="ident" id="5760620">Lock</span><span class="op" id="5760624">(</span><span class="op" id="5760625">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760628">defer</span>&nbsp;<span class="ident" id="5760634">handlers</span><span class="op" id="5760642">.</span><span class="ident" id="5760643">Unlock</span><span class="op" id="5760649">(</span><span class="op" id="5760650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760654">h</span>&nbsp;<span class="op" id="5760656">:=</span>&nbsp;<span class="ident" id="5760659">handlers</span><span class="op" id="5760667">.</span><span class="ident" id="5760668">m</span><span class="op" id="5760669">[</span><span class="ident" id="5760670">c</span><span class="op" id="5760671">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760674">if</span>&nbsp;<span class="ident" id="5760677">h</span>&nbsp;<span class="op" id="5760679">==</span>&nbsp;<span class="ident" id="5760682">nil</span>&nbsp;<span class="op" id="5760686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760690">if</span>&nbsp;<span class="ident" id="5760693">handlers</span><span class="op" id="5760701">.</span><span class="ident" id="5760702">m</span>&nbsp;<span class="op" id="5760704">==</span>&nbsp;<span class="ident" id="5760707">nil</span>&nbsp;<span class="op" id="5760711">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760716">handlers</span><span class="op" id="5760724">.</span><span class="ident" id="5760725">m</span>&nbsp;<span class="op" id="5760727">=</span>&nbsp;<span class="builtinfunc" id="5760729">make</span><span class="op" id="5760733">(</span><span class="keyword" id="5760734">map</span><span class="op" id="5760737">[</span><span class="keyword" id="5760738">chan</span><span class="op" id="5760742">&lt;-</span>&nbsp;<span class="ident" id="5760745">os</span><span class="op" id="5760747">.</span><span class="ident" id="5760748">Signal</span><span class="op" id="5760754">]</span><span class="op" id="5760755">*</span><span class="ident" id="5760756">handler</span><span class="op" id="5760763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760771">h</span>&nbsp;<span class="op" id="5760773">=</span>&nbsp;<span class="builtinfunc" id="5760775">new</span><span class="op" id="5760778">(</span><span class="ident" id="5760779">handler</span><span class="op" id="5760786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760790">handlers</span><span class="op" id="5760798">.</span><span class="ident" id="5760799">m</span><span class="op" id="5760800">[</span><span class="ident" id="5760801">c</span><span class="op" id="5760802">]</span>&nbsp;<span class="op" id="5760804">=</span>&nbsp;<span class="ident" id="5760806">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760809">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760813">add</span>&nbsp;<span class="op" id="5760817">:=</span>&nbsp;<span class="keyword" id="5760820">func</span><span class="op" id="5760824">(</span><span class="ident" id="5760825">n</span>&nbsp;<span class="builtintype" id="5760827">int</span><span class="op" id="5760830">)</span>&nbsp;<span class="op" id="5760832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760836">if</span>&nbsp;<span class="ident" id="5760839">n</span>&nbsp;<span class="op" id="5760841">&lt;</span>&nbsp;<span class="num" id="5760843">0</span>&nbsp;<span class="op" id="5760845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760850">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760859">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760863">if</span>&nbsp;<span class="op" id="5760866">!</span><span class="ident" id="5760867">h</span><span class="op" id="5760868">.</span><span class="ident" id="5760869">want</span><span class="op" id="5760873">(</span><span class="ident" id="5760874">n</span><span class="op" id="5760875">)</span>&nbsp;<span class="op" id="5760877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760882">h</span><span class="op" id="5760883">.</span><span class="ident" id="5760884">set</span><span class="op" id="5760887">(</span><span class="ident" id="5760888">n</span><span class="op" id="5760889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760894">if</span>&nbsp;<span class="ident" id="5760897">handlers</span><span class="op" id="5760905">.</span><span class="ident" id="5760906">ref</span><span class="op" id="5760909">[</span><span class="ident" id="5760910">n</span><span class="op" id="5760911">]</span>&nbsp;<span class="op" id="5760913">==</span>&nbsp;<span class="num" id="5760916">0</span>&nbsp;<span class="op" id="5760918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760924">enableSignal</span><span class="op" id="5760936">(</span><span class="ident" id="5760937">n</span><span class="op" id="5760938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760943">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760948">handlers</span><span class="op" id="5760956">.</span><span class="ident" id="5760957">ref</span><span class="op" id="5760960">[</span><span class="ident" id="5760961">n</span><span class="op" id="5760962">]</span><span class="op" id="5760963">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760975">if</span>&nbsp;<span class="builtinfunc" id="5760978">len</span><span class="op" id="5760981">(</span><span class="ident" id="5760982">sig</span><span class="op" id="5760985">)</span>&nbsp;<span class="op" id="5760987">==</span>&nbsp;<span class="num" id="5760990">0</span>&nbsp;<span class="op" id="5760992">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760996">for</span>&nbsp;<span class="ident" id="5761000">n</span>&nbsp;<span class="op" id="5761002">:=</span>&nbsp;<span class="num" id="5761005">0</span><span class="op" id="5761006">;</span>&nbsp;<span class="ident" id="5761008">n</span>&nbsp;<span class="op" id="5761010">&lt;</span>&nbsp;<span class="ident" id="5761012">numSig</span><span class="op" id="5761018">;</span>&nbsp;<span class="ident" id="5761020">n</span><span class="op" id="5761021">++</span>&nbsp;<span class="op" id="5761024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761029">add</span><span class="op" id="5761032">(</span><span class="ident" id="5761033">n</span><span class="op" id="5761034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761041">}</span>&nbsp;<span class="keyword" id="5761043">else</span>&nbsp;<span class="op" id="5761048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761052">for</span>&nbsp;<span class="ident" id="5761056">_</span><span class="op" id="5761057">,</span>&nbsp;<span class="ident" id="5761059">s</span>&nbsp;<span class="op" id="5761061">:=</span>&nbsp;<span class="keyword" id="5761064">range</span>&nbsp;<span class="ident" id="5761070">sig</span>&nbsp;<span class="op" id="5761074">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761079">add</span><span class="op" id="5761082">(</span><span class="ident" id="5761083">signum</span><span class="op" id="5761089">(</span><span class="ident" id="5761090">s</span><span class="op" id="5761091">)</span><span class="op" id="5761092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761099">}</span><br>
<span class="lineno"></span><span class="op" id="5761101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5761104">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5761174">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5761236">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5761312">func</span>&nbsp;<span class="ident" id="5761317">Stop</span><span class="op" id="5761321">(</span><span class="ident" id="5761322">c</span>&nbsp;<span class="keyword" id="5761324">chan</span><span class="op" id="5761328">&lt;-</span>&nbsp;<span class="ident" id="5761331">os</span><span class="op" id="5761333">.</span><span class="ident" id="5761334">Signal</span><span class="op" id="5761340">)</span>&nbsp;<span class="op" id="5761342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761345">handlers</span><span class="op" id="5761353">.</span><span class="ident" id="5761354">Lock</span><span class="op" id="5761358">(</span><span class="op" id="5761359">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761362">defer</span>&nbsp;<span class="ident" id="5761368">handlers</span><span class="op" id="5761376">.</span><span class="ident" id="5761377">Unlock</span><span class="op" id="5761383">(</span><span class="op" id="5761384">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761388">h</span>&nbsp;<span class="op" id="5761390">:=</span>&nbsp;<span class="ident" id="5761393">handlers</span><span class="op" id="5761401">.</span><span class="ident" id="5761402">m</span><span class="op" id="5761403">[</span><span class="ident" id="5761404">c</span><span class="op" id="5761405">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761408">if</span>&nbsp;<span class="ident" id="5761411">h</span>&nbsp;<span class="op" id="5761413">==</span>&nbsp;<span class="ident" id="5761416">nil</span>&nbsp;<span class="op" id="5761420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761424">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5761435">delete</span><span class="op" id="5761441">(</span><span class="ident" id="5761442">handlers</span><span class="op" id="5761450">.</span><span class="ident" id="5761451">m</span><span class="op" id="5761452">,</span>&nbsp;<span class="ident" id="5761454">c</span><span class="op" id="5761455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761459">for</span>&nbsp;<span class="ident" id="5761463">n</span>&nbsp;<span class="op" id="5761465">:=</span>&nbsp;<span class="num" id="5761468">0</span><span class="op" id="5761469">;</span>&nbsp;<span class="ident" id="5761471">n</span>&nbsp;<span class="op" id="5761473">&lt;</span>&nbsp;<span class="ident" id="5761475">numSig</span><span class="op" id="5761481">;</span>&nbsp;<span class="ident" id="5761483">n</span><span class="op" id="5761484">++</span>&nbsp;<span class="op" id="5761487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761491">if</span>&nbsp;<span class="ident" id="5761494">h</span><span class="op" id="5761495">.</span><span class="ident" id="5761496">want</span><span class="op" id="5761500">(</span><span class="ident" id="5761501">n</span><span class="op" id="5761502">)</span>&nbsp;<span class="op" id="5761504">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761509">handlers</span><span class="op" id="5761517">.</span><span class="ident" id="5761518">ref</span><span class="op" id="5761521">[</span><span class="ident" id="5761522">n</span><span class="op" id="5761523">]</span><span class="op" id="5761524">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761530">if</span>&nbsp;<span class="ident" id="5761533">handlers</span><span class="op" id="5761541">.</span><span class="ident" id="5761542">ref</span><span class="op" id="5761545">[</span><span class="ident" id="5761546">n</span><span class="op" id="5761547">]</span>&nbsp;<span class="op" id="5761549">==</span>&nbsp;<span class="num" id="5761552">0</span>&nbsp;<span class="op" id="5761554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761560">disableSignal</span><span class="op" id="5761573">(</span><span class="ident" id="5761574">n</span><span class="op" id="5761575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761584">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761587">}</span><br>
<span class="lineno"></span><span class="op" id="5761589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5761592">func</span>&nbsp;<span class="ident" id="5761597">process</span><span class="op" id="5761604">(</span><span class="ident" id="5761605">sig</span>&nbsp;<span class="ident" id="5761609">os</span><span class="op" id="5761611">.</span><span class="ident" id="5761612">Signal</span><span class="op" id="5761618">)</span>&nbsp;<span class="op" id="5761620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761623">n</span>&nbsp;<span class="op" id="5761625">:=</span>&nbsp;<span class="ident" id="5761628">signum</span><span class="op" id="5761634">(</span><span class="ident" id="5761635">sig</span><span class="op" id="5761638">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761641">if</span>&nbsp;<span class="ident" id="5761644">n</span>&nbsp;<span class="op" id="5761646">&lt;</span>&nbsp;<span class="num" id="5761648">0</span>&nbsp;<span class="op" id="5761650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761654">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761666">handlers</span><span class="op" id="5761674">.</span><span class="ident" id="5761675">Lock</span><span class="op" id="5761679">(</span><span class="op" id="5761680">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761683">defer</span>&nbsp;<span class="ident" id="5761689">handlers</span><span class="op" id="5761697">.</span><span class="ident" id="5761698">Unlock</span><span class="op" id="5761704">(</span><span class="op" id="5761705">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761709">for</span>&nbsp;<span class="ident" id="5761713">c</span><span class="op" id="5761714">,</span>&nbsp;<span class="ident" id="5761716">h</span>&nbsp;<span class="op" id="5761718">:=</span>&nbsp;<span class="keyword" id="5761721">range</span>&nbsp;<span class="ident" id="5761727">handlers</span><span class="op" id="5761735">.</span><span class="ident" id="5761736">m</span>&nbsp;<span class="op" id="5761738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761742">if</span>&nbsp;<span class="ident" id="5761745">h</span><span class="op" id="5761746">.</span><span class="ident" id="5761747">want</span><span class="op" id="5761751">(</span><span class="ident" id="5761752">n</span><span class="op" id="5761753">)</span>&nbsp;<span class="op" id="5761755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761760">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761795">select</span>&nbsp;<span class="op" id="5761802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761807">case</span>&nbsp;<span class="ident" id="5761812">c</span>&nbsp;<span class="op" id="5761814">&lt;-</span>&nbsp;<span class="ident" id="5761817">sig</span><span class="op" id="5761820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761825">default</span><span class="op" id="5761832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761841">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761844">}</span><br>
<span class="lineno"></span><span class="op" id="5761846">}</span>
</div>
</body>
</html>
