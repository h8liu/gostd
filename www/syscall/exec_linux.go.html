<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1634935">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1634990">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1635044">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1635095">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1635112">package</span>&nbsp;<span class="ident" id="1635120">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1635129">import</span>&nbsp;<span class="op" id="1635136">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1635139">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1635148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1635151">//&nbsp;SysProcIDMap&nbsp;holds&nbsp;Container&nbsp;ID&nbsp;to&nbsp;Host&nbsp;ID&nbsp;mappings&nbsp;used&nbsp;for&nbsp;User&nbsp;Namespaces&nbsp;in&nbsp;Linux.</span><br>
<span class="lineno"></span><span class="comment" id="1635241">//&nbsp;See&nbsp;user_namespaces(7).</span><br>
<span class="lineno">15</span><span class="keyword" id="1635268">type</span>&nbsp;<span class="ident" id="1635273">SysProcIDMap</span>&nbsp;<span class="keyword" id="1635286">struct</span>&nbsp;<span class="op" id="1635293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635296">ContainerID</span>&nbsp;<span class="builtintype" id="1635308">int</span>&nbsp;<span class="comment" id="1635312">//&nbsp;Container&nbsp;ID.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635330">HostID</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1635342">int</span>&nbsp;<span class="comment" id="1635346">//&nbsp;Host&nbsp;ID.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635359">Size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1635371">int</span>&nbsp;<span class="comment" id="1635375">//&nbsp;Size.</span><br>
<span class="lineno"></span><span class="op" id="1635384">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1635387">type</span>&nbsp;<span class="ident" id="1635392">SysProcAttr</span>&nbsp;<span class="keyword" id="1635404">struct</span>&nbsp;<span class="op" id="1635411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635414">Chroot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1635426">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1635441">//&nbsp;Chroot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635453">Credential</span>&nbsp;&nbsp;<span class="op" id="1635465">*</span><span class="ident" id="1635466"><a href="/syscall/exec_unix.go.html#1648436">Credential</a></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1635480">//&nbsp;Credential.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635496">Ptrace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1635508">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1635523">//&nbsp;Enable&nbsp;tracing.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635543">Setsid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1635555">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1635570">//&nbsp;Create&nbsp;session.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635590">Setpgid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1635602">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1635617">//&nbsp;Set&nbsp;process&nbsp;group&nbsp;ID&nbsp;to&nbsp;new&nbsp;pid&nbsp;(SYSV&nbsp;setpgrp)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635668">Setctty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1635680">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1635695">//&nbsp;Set&nbsp;controlling&nbsp;terminal&nbsp;to&nbsp;fd&nbsp;Ctty&nbsp;(only&nbsp;meaningful&nbsp;if&nbsp;Setsid&nbsp;is&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635770">Noctty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1635782">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1635797">//&nbsp;Detach&nbsp;fd&nbsp;0&nbsp;from&nbsp;controlling&nbsp;terminal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635839">Ctty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1635851">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1635866">//&nbsp;Controlling&nbsp;TTY&nbsp;fd&nbsp;(Linux&nbsp;only)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1635902">Pdeathsig</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1635914"><a href="/syscall/syscall_unix.go.html#1701634">Signal</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1635929">//&nbsp;Signal&nbsp;that&nbsp;the&nbsp;process&nbsp;will&nbsp;get&nbsp;when&nbsp;its&nbsp;parent&nbsp;dies&nbsp;(Linux&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636000">Cloneflags</span>&nbsp;&nbsp;<span class="builtintype" id="1636012">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1636027">//&nbsp;Flags&nbsp;for&nbsp;clone&nbsp;calls&nbsp;(Linux&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636066">UidMappings</span>&nbsp;<span class="op" id="1636078">[</span><span class="op" id="1636079">]</span><span class="ident" id="1636080"><a href="/syscall/exec_linux.go.html#1635273">SysProcIDMap</a></span>&nbsp;<span class="comment" id="1636093">//&nbsp;User&nbsp;ID&nbsp;mappings&nbsp;for&nbsp;user&nbsp;namespaces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1636135">GidMappings</span>&nbsp;<span class="op" id="1636147">[</span><span class="op" id="1636148">]</span><span class="ident" id="1636149"><a href="/syscall/exec_linux.go.html#1635273">SysProcIDMap</a></span>&nbsp;<span class="comment" id="1636162">//&nbsp;Group&nbsp;ID&nbsp;mappings&nbsp;for&nbsp;user&nbsp;namespaces.</span><br>
<span class="lineno"></span><span class="op" id="1636204">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1636207">//&nbsp;Implemented&nbsp;in&nbsp;runtime&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="1636242">func</span>&nbsp;<span class="ident" id="1636247">runtime_BeforeFork</span><span class="op" id="1636265">(</span><span class="op" id="1636266">)</span><br>
<span class="lineno"></span><span class="keyword" id="1636268">func</span>&nbsp;<span class="ident" id="1636273">runtime_AfterFork</span><span class="op" id="1636290">(</span><span class="op" id="1636291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="1636294">//&nbsp;Fork,&nbsp;dup&nbsp;fd&nbsp;onto&nbsp;0..len(fd),&nbsp;and&nbsp;exec(argv0,&nbsp;argvv,&nbsp;envv)&nbsp;in&nbsp;child.</span><br>
<span class="lineno"></span><span class="comment" id="1636366">//&nbsp;If&nbsp;a&nbsp;dup&nbsp;or&nbsp;exec&nbsp;fails,&nbsp;write&nbsp;the&nbsp;errno&nbsp;error&nbsp;to&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="comment" id="1636424">//&nbsp;(Pipe&nbsp;is&nbsp;close-on-exec&nbsp;so&nbsp;if&nbsp;exec&nbsp;succeeds,&nbsp;it&nbsp;will&nbsp;be&nbsp;closed.)</span><br>
<span class="lineno"></span><span class="comment" id="1636491">//&nbsp;In&nbsp;the&nbsp;child,&nbsp;this&nbsp;function&nbsp;must&nbsp;not&nbsp;acquire&nbsp;any&nbsp;locks,&nbsp;because</span><br>
<span class="lineno"></span><span class="comment" id="1636558">//&nbsp;they&nbsp;might&nbsp;have&nbsp;been&nbsp;locked&nbsp;at&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;fork.&nbsp;&nbsp;This&nbsp;means</span><br>
<span class="lineno">45</span><span class="comment" id="1636626">//&nbsp;no&nbsp;rescheduling,&nbsp;no&nbsp;malloc&nbsp;calls,&nbsp;and&nbsp;no&nbsp;new&nbsp;stack&nbsp;segments.</span><br>
<span class="lineno"></span><span class="comment" id="1636690">//&nbsp;For&nbsp;the&nbsp;same&nbsp;reason&nbsp;compiler&nbsp;does&nbsp;not&nbsp;race&nbsp;instrument&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="1636751">//&nbsp;The&nbsp;calls&nbsp;to&nbsp;RawSyscall&nbsp;are&nbsp;okay&nbsp;because&nbsp;they&nbsp;are&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="1636813">//&nbsp;functions&nbsp;that&nbsp;do&nbsp;not&nbsp;grow&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="1636854">func</span>&nbsp;<span class="ident" id="1636859">forkAndExecInChild</span><span class="op" id="1636877">(</span><span class="ident" id="1636878">argv0</span>&nbsp;<span class="op" id="1636884">*</span><span class="builtintype" id="1636885">byte</span><span class="op" id="1636889">,</span>&nbsp;<span class="ident" id="1636891">argv</span><span class="op" id="1636895">,</span>&nbsp;<span class="ident" id="1636897">envv</span>&nbsp;<span class="op" id="1636902">[</span><span class="op" id="1636903">]</span><span class="op" id="1636904">*</span><span class="builtintype" id="1636905">byte</span><span class="op" id="1636909">,</span>&nbsp;<span class="ident" id="1636911">chroot</span><span class="op" id="1636917">,</span>&nbsp;<span class="ident" id="1636919">dir</span>&nbsp;<span class="op" id="1636923">*</span><span class="builtintype" id="1636924">byte</span><span class="op" id="1636928">,</span>&nbsp;<span class="ident" id="1636930">attr</span>&nbsp;<span class="op" id="1636935">*</span><span class="ident" id="1636936"><a href="/syscall/exec_unix.go.html#1648663">ProcAttr</a></span><span class="op" id="1636944">,</span>&nbsp;<span class="ident" id="1636946">sys</span>&nbsp;<span class="op" id="1636950">*</span><span class="ident" id="1636951"><a href="/syscall/exec_linux.go.html#1635392">SysProcAttr</a></span><span class="op" id="1636962">,</span>&nbsp;<span class="ident" id="1636964">pipe</span>&nbsp;<span class="builtintype" id="1636969">int</span><span class="op" id="1636972">)</span>&nbsp;<span class="op" id="1636974">(</span><span class="ident" id="1636975">pid</span>&nbsp;<span class="builtintype" id="1636979">int</span><span class="op" id="1636982">,</span>&nbsp;<span class="ident" id="1636984">err</span>&nbsp;<span class="ident" id="1636988"><a href="/syscall/syscall_unix.go.html#1701140">Errno</a></span><span class="op" id="1636993">)</span>&nbsp;<span class="op" id="1636995">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1636998">//&nbsp;Declare&nbsp;all&nbsp;variables&nbsp;at&nbsp;top&nbsp;in&nbsp;case&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1637043">//&nbsp;declarations&nbsp;require&nbsp;heap&nbsp;allocation&nbsp;(e.g.,&nbsp;err1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637098">var</span>&nbsp;<span class="op" id="1637102">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637106">r1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1637113">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637123">err1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1637130"><a href="/syscall/syscall_unix.go.html#1701140">Errno</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637138">err2</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1637145"><a href="/syscall/syscall_unix.go.html#1701140">Errno</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637153">nextfd</span>&nbsp;<span class="builtintype" id="1637160">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637166">i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1637173">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637179">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1637186">[</span><span class="num" id="1637187">2</span><span class="op" id="1637188">]</span><span class="builtintype" id="1637189">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637194">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1637198">//&nbsp;Guard&nbsp;against&nbsp;side&nbsp;effects&nbsp;of&nbsp;shuffling&nbsp;fds&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1637253">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;nextfd&nbsp;is&nbsp;beyond&nbsp;any&nbsp;currently&nbsp;open&nbsp;files&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1637317">//&nbsp;that&nbsp;we&nbsp;can&#39;t&nbsp;run&nbsp;the&nbsp;risk&nbsp;of&nbsp;overwriting&nbsp;any&nbsp;of&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637376">fd</span>&nbsp;<span class="op" id="1637379">:=</span>&nbsp;<span class="builtinfunc" id="1637382">make</span><span class="op" id="1637386">(</span><span class="op" id="1637387">[</span><span class="op" id="1637388">]</span><span class="builtintype" id="1637389">int</span><span class="op" id="1637392">,</span>&nbsp;<span class="builtinfunc" id="1637394">len</span><span class="op" id="1637397">(</span><span class="ident" id="1637398"><a href="/syscall/exec_linux.go.html#1636930">attr</a></span><span class="op" id="1637402">.</span><span class="ident" id="1637403">Files</span><span class="op" id="1637408">)</span><span class="op" id="1637409">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637412"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span>&nbsp;<span class="op" id="1637419">=</span>&nbsp;<span class="builtinfunc" id="1637421">len</span><span class="op" id="1637424">(</span><span class="ident" id="1637425"><a href="/syscall/exec_linux.go.html#1636930">attr</a></span><span class="op" id="1637429">.</span><span class="ident" id="1637430">Files</span><span class="op" id="1637435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637438">for</span>&nbsp;<span class="ident" id="1637442">i</span><span class="op" id="1637443">,</span>&nbsp;<span class="ident" id="1637445">ufd</span>&nbsp;<span class="op" id="1637449">:=</span>&nbsp;<span class="keyword" id="1637452">range</span>&nbsp;<span class="ident" id="1637458"><a href="/syscall/exec_linux.go.html#1636930">attr</a></span><span class="op" id="1637462">.</span><span class="ident" id="1637463">Files</span>&nbsp;<span class="op" id="1637469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637473">if</span>&nbsp;<span class="ident" id="1637476"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span>&nbsp;<span class="op" id="1637483">&lt;</span>&nbsp;<span class="builtintype" id="1637485">int</span><span class="op" id="1637488">(</span><span class="ident" id="1637489"><a href="/syscall/exec_linux.go.html#1637445">ufd</a></span><span class="op" id="1637492">)</span>&nbsp;<span class="op" id="1637494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637499"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span>&nbsp;<span class="op" id="1637506">=</span>&nbsp;<span class="builtintype" id="1637508">int</span><span class="op" id="1637511">(</span><span class="ident" id="1637512"><a href="/syscall/exec_linux.go.html#1637445">ufd</a></span><span class="op" id="1637515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637519">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637523"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1637525">[</span><span class="ident" id="1637526"><a href="/syscall/exec_linux.go.html#1637442">i</a></span><span class="op" id="1637527">]</span>&nbsp;<span class="op" id="1637529">=</span>&nbsp;<span class="builtintype" id="1637531">int</span><span class="op" id="1637534">(</span><span class="ident" id="1637535"><a href="/syscall/exec_linux.go.html#1637445">ufd</a></span><span class="op" id="1637538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637544"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span><span class="op" id="1637550">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1637555">//&nbsp;Allocate&nbsp;another&nbsp;pipe&nbsp;for&nbsp;parent&nbsp;to&nbsp;child&nbsp;communication&nbsp;for</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1637619">//&nbsp;synchronizing&nbsp;writing&nbsp;of&nbsp;User&nbsp;ID/Group&nbsp;ID&nbsp;mappings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637675">if</span>&nbsp;<span class="ident" id="1637678"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1637681">.</span><span class="ident" id="1637682">UidMappings</span>&nbsp;<span class="op" id="1637694">!=</span>&nbsp;<span class="ident" id="1637697">nil</span>&nbsp;<span class="op" id="1637701">||</span>&nbsp;<span class="ident" id="1637704"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1637707">.</span><span class="ident" id="1637708">GidMappings</span>&nbsp;<span class="op" id="1637720">!=</span>&nbsp;<span class="ident" id="1637723">nil</span>&nbsp;<span class="op" id="1637727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637731">if</span>&nbsp;<span class="ident" id="1637734">err</span>&nbsp;<span class="op" id="1637738">:=</span>&nbsp;<span class="ident" id="1637741"><a href="/syscall/exec_linux.go.html#1643039">forkExecPipe</a></span><span class="op" id="1637753">(</span><span class="ident" id="1637754"><a href="/syscall/exec_linux.go.html#1637179">p</a></span><span class="op" id="1637755">[</span><span class="op" id="1637756">:</span><span class="op" id="1637757">]</span><span class="op" id="1637758">)</span><span class="op" id="1637759">;</span>&nbsp;<span class="ident" id="1637761"><a href="/syscall/exec_linux.go.html#1637734">err</a></span>&nbsp;<span class="op" id="1637765">!=</span>&nbsp;<span class="ident" id="1637768">nil</span>&nbsp;<span class="op" id="1637772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637777">return</span>&nbsp;<span class="num" id="1637784">0</span><span class="op" id="1637785">,</span>&nbsp;<span class="ident" id="1637787"><a href="/syscall/exec_linux.go.html#1637734">err</a></span><span class="op" id="1637790">.</span><span class="op" id="1637791">(</span><span class="ident" id="1637792"><a href="/syscall/syscall_unix.go.html#1701140">Errno</a></span><span class="op" id="1637797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637801">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1637804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1637808">//&nbsp;About&nbsp;to&nbsp;call&nbsp;fork.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1637832">//&nbsp;No&nbsp;more&nbsp;allocation&nbsp;or&nbsp;calls&nbsp;of&nbsp;non-assembly&nbsp;functions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637891"><a href="/syscall/exec_linux.go.html#1636247">runtime_BeforeFork</a></span><span class="op" id="1637909">(</span><span class="op" id="1637910">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1637913"><a href="/syscall/exec_linux.go.html#1637106">r1</a></span><span class="op" id="1637915">,</span>&nbsp;<span class="ident" id="1637917">_</span><span class="op" id="1637918">,</span>&nbsp;<span class="ident" id="1637920"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1637925">=</span>&nbsp;<span class="ident" id="1637927"><a href="/syscall/syscall_unix.go.html#1699428">RawSyscall6</a></span><span class="op" id="1637938">(</span><span class="ident" id="1637939"><a href="/syscall/zsysnum_linux_amd64.go.html#1813171">SYS_CLONE</a></span><span class="op" id="1637948">,</span>&nbsp;<span class="builtintype" id="1637950">uintptr</span><span class="op" id="1637957">(</span><span class="ident" id="1637958"><a href="/syscall/zerrors_linux_amd64.go.html#1759682">SIGCHLD</a></span><span class="op" id="1637965">)</span><span class="op" id="1637966">|</span><span class="ident" id="1637967"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1637970">.</span><span class="ident" id="1637971">Cloneflags</span><span class="op" id="1637981">,</span>&nbsp;<span class="num" id="1637983">0</span><span class="op" id="1637984">,</span>&nbsp;<span class="num" id="1637986">0</span><span class="op" id="1637987">,</span>&nbsp;<span class="num" id="1637989">0</span><span class="op" id="1637990">,</span>&nbsp;<span class="num" id="1637992">0</span><span class="op" id="1637993">,</span>&nbsp;<span class="num" id="1637995">0</span><span class="op" id="1637996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1637999">if</span>&nbsp;<span class="ident" id="1638002"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1638007">!=</span>&nbsp;<span class="num" id="1638010">0</span>&nbsp;<span class="op" id="1638012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638016"><a href="/syscall/exec_linux.go.html#1636273">runtime_AfterFork</a></span><span class="op" id="1638033">(</span><span class="op" id="1638034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638038">return</span>&nbsp;<span class="num" id="1638045">0</span><span class="op" id="1638046">,</span>&nbsp;<span class="ident" id="1638048"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638054">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638058">if</span>&nbsp;<span class="ident" id="1638061"><a href="/syscall/exec_linux.go.html#1637106">r1</a></span>&nbsp;<span class="op" id="1638064">!=</span>&nbsp;<span class="num" id="1638067">0</span>&nbsp;<span class="op" id="1638069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1638073">//&nbsp;parent;&nbsp;return&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638097"><a href="/syscall/exec_linux.go.html#1636273">runtime_AfterFork</a></span><span class="op" id="1638114">(</span><span class="op" id="1638115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638119"><a href="/syscall/exec_linux.go.html#1636975">pid</a></span>&nbsp;<span class="op" id="1638123">=</span>&nbsp;<span class="builtintype" id="1638125">int</span><span class="op" id="1638128">(</span><span class="ident" id="1638129"><a href="/syscall/exec_linux.go.html#1637106">r1</a></span><span class="op" id="1638131">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638136">if</span>&nbsp;<span class="ident" id="1638139"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1638142">.</span><span class="ident" id="1638143">UidMappings</span>&nbsp;<span class="op" id="1638155">!=</span>&nbsp;<span class="ident" id="1638158">nil</span>&nbsp;<span class="op" id="1638162">||</span>&nbsp;<span class="ident" id="1638165"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1638168">.</span><span class="ident" id="1638169">GidMappings</span>&nbsp;<span class="op" id="1638181">!=</span>&nbsp;<span class="ident" id="1638184">nil</span>&nbsp;<span class="op" id="1638188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638193"><a href="/syscall/zsyscall_linux_amd64.go.html#1772074">Close</a></span><span class="op" id="1638198">(</span><span class="ident" id="1638199"><a href="/syscall/exec_linux.go.html#1637179">p</a></span><span class="op" id="1638200">[</span><span class="num" id="1638201">0</span><span class="op" id="1638202">]</span><span class="op" id="1638203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638208">err</span>&nbsp;<span class="op" id="1638212">:=</span>&nbsp;<span class="ident" id="1638215"><a href="/syscall/exec_linux.go.html#1644142">writeUidGidMappings</a></span><span class="op" id="1638234">(</span><span class="ident" id="1638235"><a href="/syscall/exec_linux.go.html#1636975">pid</a></span><span class="op" id="1638238">,</span>&nbsp;<span class="ident" id="1638240"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1638243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638248">if</span>&nbsp;<span class="ident" id="1638251"><a href="/syscall/exec_linux.go.html#1638208">err</a></span>&nbsp;<span class="op" id="1638255">!=</span>&nbsp;<span class="ident" id="1638258">nil</span>&nbsp;<span class="op" id="1638262">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638268"><a href="/syscall/exec_linux.go.html#1637138">err2</a></span>&nbsp;<span class="op" id="1638273">=</span>&nbsp;<span class="ident" id="1638275"><a href="/syscall/exec_linux.go.html#1638208">err</a></span><span class="op" id="1638278">.</span><span class="op" id="1638279">(</span><span class="ident" id="1638280"><a href="/syscall/syscall_unix.go.html#1701140">Errno</a></span><span class="op" id="1638285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638295"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1638305">(</span><span class="ident" id="1638306"><a href="/syscall/zsysnum_linux_amd64.go.html#1811365">SYS_WRITE</a></span><span class="op" id="1638315">,</span>&nbsp;<span class="builtintype" id="1638317">uintptr</span><span class="op" id="1638324">(</span><span class="ident" id="1638325"><a href="/syscall/exec_linux.go.html#1637179">p</a></span><span class="op" id="1638326">[</span><span class="num" id="1638327">1</span><span class="op" id="1638328">]</span><span class="op" id="1638329">)</span><span class="op" id="1638330">,</span>&nbsp;<span class="builtintype" id="1638332">uintptr</span><span class="op" id="1638339">(</span><span class="ident" id="1638340"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1638346">.</span><span class="ident" id="1638347">Pointer</span><span class="op" id="1638354">(</span><span class="op" id="1638355">&amp;</span><span class="ident" id="1638356"><a href="/syscall/exec_linux.go.html#1637138">err2</a></span><span class="op" id="1638360">)</span><span class="op" id="1638361">)</span><span class="op" id="1638362">,</span>&nbsp;<span class="ident" id="1638364"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1638370">.</span><span class="ident" id="1638371">Sizeof</span><span class="op" id="1638377">(</span><span class="ident" id="1638378"><a href="/syscall/exec_linux.go.html#1637138">err2</a></span><span class="op" id="1638382">)</span><span class="op" id="1638383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638388"><a href="/syscall/zsyscall_linux_amd64.go.html#1772074">Close</a></span><span class="op" id="1638393">(</span><span class="ident" id="1638394"><a href="/syscall/exec_linux.go.html#1637179">p</a></span><span class="op" id="1638395">[</span><span class="num" id="1638396">1</span><span class="op" id="1638397">]</span><span class="op" id="1638398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638402">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638407">return</span>&nbsp;<span class="ident" id="1638414"><a href="/syscall/exec_linux.go.html#1636975">pid</a></span><span class="op" id="1638417">,</span>&nbsp;<span class="num" id="1638419">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1638426">//&nbsp;Fork&nbsp;succeeded,&nbsp;now&nbsp;in&nbsp;child.</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1638461">//&nbsp;Wait&nbsp;for&nbsp;User&nbsp;ID/Group&nbsp;ID&nbsp;mappings&nbsp;to&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638515">if</span>&nbsp;<span class="ident" id="1638518"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1638521">.</span><span class="ident" id="1638522">UidMappings</span>&nbsp;<span class="op" id="1638534">!=</span>&nbsp;<span class="ident" id="1638537">nil</span>&nbsp;<span class="op" id="1638541">||</span>&nbsp;<span class="ident" id="1638544"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1638547">.</span><span class="ident" id="1638548">GidMappings</span>&nbsp;<span class="op" id="1638560">!=</span>&nbsp;<span class="ident" id="1638563">nil</span>&nbsp;<span class="op" id="1638567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638571">if</span>&nbsp;<span class="ident" id="1638574">_</span><span class="op" id="1638575">,</span>&nbsp;<span class="ident" id="1638577">_</span><span class="op" id="1638578">,</span>&nbsp;<span class="ident" id="1638580"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1638585">=</span>&nbsp;<span class="ident" id="1638587"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1638597">(</span><span class="ident" id="1638598"><a href="/syscall/zsysnum_linux_amd64.go.html#1811429">SYS_CLOSE</a></span><span class="op" id="1638607">,</span>&nbsp;<span class="builtintype" id="1638609">uintptr</span><span class="op" id="1638616">(</span><span class="ident" id="1638617"><a href="/syscall/exec_linux.go.html#1637179">p</a></span><span class="op" id="1638618">[</span><span class="num" id="1638619">1</span><span class="op" id="1638620">]</span><span class="op" id="1638621">)</span><span class="op" id="1638622">,</span>&nbsp;<span class="num" id="1638624">0</span><span class="op" id="1638625">,</span>&nbsp;<span class="num" id="1638627">0</span><span class="op" id="1638628">)</span><span class="op" id="1638629">;</span>&nbsp;<span class="ident" id="1638631"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1638636">!=</span>&nbsp;<span class="num" id="1638639">0</span>&nbsp;<span class="op" id="1638641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638646">goto</span>&nbsp;<span class="ident" id="1638651">childerror</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638668"><a href="/syscall/exec_linux.go.html#1637106">r1</a></span><span class="op" id="1638670">,</span>&nbsp;<span class="ident" id="1638672">_</span><span class="op" id="1638673">,</span>&nbsp;<span class="ident" id="1638675"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1638680">=</span>&nbsp;<span class="ident" id="1638682"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1638692">(</span><span class="ident" id="1638693"><a href="/syscall/zsysnum_linux_amd64.go.html#1811333">SYS_READ</a></span><span class="op" id="1638701">,</span>&nbsp;<span class="builtintype" id="1638703">uintptr</span><span class="op" id="1638710">(</span><span class="ident" id="1638711"><a href="/syscall/exec_linux.go.html#1637179">p</a></span><span class="op" id="1638712">[</span><span class="num" id="1638713">0</span><span class="op" id="1638714">]</span><span class="op" id="1638715">)</span><span class="op" id="1638716">,</span>&nbsp;<span class="builtintype" id="1638718">uintptr</span><span class="op" id="1638725">(</span><span class="ident" id="1638726"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1638732">.</span><span class="ident" id="1638733">Pointer</span><span class="op" id="1638740">(</span><span class="op" id="1638741">&amp;</span><span class="ident" id="1638742"><a href="/syscall/exec_linux.go.html#1637138">err2</a></span><span class="op" id="1638746">)</span><span class="op" id="1638747">)</span><span class="op" id="1638748">,</span>&nbsp;<span class="ident" id="1638750"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1638756">.</span><span class="ident" id="1638757">Sizeof</span><span class="op" id="1638763">(</span><span class="ident" id="1638764"><a href="/syscall/exec_linux.go.html#1637138">err2</a></span><span class="op" id="1638768">)</span><span class="op" id="1638769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638773">if</span>&nbsp;<span class="ident" id="1638776"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1638781">!=</span>&nbsp;<span class="num" id="1638784">0</span>&nbsp;<span class="op" id="1638786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638791">goto</span>&nbsp;<span class="ident" id="1638796">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638809">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638813">if</span>&nbsp;<span class="ident" id="1638816"><a href="/syscall/exec_linux.go.html#1637106">r1</a></span>&nbsp;<span class="op" id="1638819">!=</span>&nbsp;<span class="ident" id="1638822"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1638828">.</span><span class="ident" id="1638829">Sizeof</span><span class="op" id="1638835">(</span><span class="ident" id="1638836"><a href="/syscall/exec_linux.go.html#1637138">err2</a></span><span class="op" id="1638840">)</span>&nbsp;<span class="op" id="1638842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638847"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1638852">=</span>&nbsp;<span class="ident" id="1638854"><a href="/syscall/zerrors_linux_amd64.go.html#1756680">EINVAL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638864">goto</span>&nbsp;<span class="ident" id="1638869">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638886">if</span>&nbsp;<span class="ident" id="1638889"><a href="/syscall/exec_linux.go.html#1637138">err2</a></span>&nbsp;<span class="op" id="1638894">!=</span>&nbsp;<span class="num" id="1638897">0</span>&nbsp;<span class="op" id="1638899">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638904"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1638909">=</span>&nbsp;<span class="ident" id="1638911"><a href="/syscall/exec_linux.go.html#1637138">err2</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638919">goto</span>&nbsp;<span class="ident" id="1638924">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1638940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1638944">//&nbsp;Parent&nbsp;death&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1638968">if</span>&nbsp;<span class="ident" id="1638971"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1638974">.</span><span class="ident" id="1638975">Pdeathsig</span>&nbsp;<span class="op" id="1638985">!=</span>&nbsp;<span class="num" id="1638988">0</span>&nbsp;<span class="op" id="1638990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1638994">_</span><span class="op" id="1638995">,</span>&nbsp;<span class="ident" id="1638997">_</span><span class="op" id="1638998">,</span>&nbsp;<span class="ident" id="1639000"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1639005">=</span>&nbsp;<span class="ident" id="1639007"><a href="/syscall/syscall_unix.go.html#1699428">RawSyscall6</a></span><span class="op" id="1639018">(</span><span class="ident" id="1639019"><a href="/syscall/zsysnum_linux_amd64.go.html#1816561">SYS_PRCTL</a></span><span class="op" id="1639028">,</span>&nbsp;<span class="ident" id="1639030"><a href="/syscall/zerrors_linux_amd64.go.html#1735873">PR_SET_PDEATHSIG</a></span><span class="op" id="1639046">,</span>&nbsp;<span class="builtintype" id="1639048">uintptr</span><span class="op" id="1639055">(</span><span class="ident" id="1639056"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1639059">.</span><span class="ident" id="1639060">Pdeathsig</span><span class="op" id="1639069">)</span><span class="op" id="1639070">,</span>&nbsp;<span class="num" id="1639072">0</span><span class="op" id="1639073">,</span>&nbsp;<span class="num" id="1639075">0</span><span class="op" id="1639076">,</span>&nbsp;<span class="num" id="1639078">0</span><span class="op" id="1639079">,</span>&nbsp;<span class="num" id="1639081">0</span><span class="op" id="1639082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639086">if</span>&nbsp;<span class="ident" id="1639089"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1639094">!=</span>&nbsp;<span class="num" id="1639097">0</span>&nbsp;<span class="op" id="1639099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639104">goto</span>&nbsp;<span class="ident" id="1639109">childerror</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1639127">//&nbsp;Signal&nbsp;self&nbsp;if&nbsp;parent&nbsp;is&nbsp;already&nbsp;dead.&nbsp;This&nbsp;might&nbsp;cause&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1639190">//&nbsp;duplicate&nbsp;signal&nbsp;in&nbsp;rare&nbsp;cases,&nbsp;but&nbsp;it&nbsp;won&#39;t&nbsp;matter&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1639252">//&nbsp;using&nbsp;SIGKILL.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639272"><a href="/syscall/exec_linux.go.html#1637106">r1</a></span><span class="op" id="1639274">,</span>&nbsp;<span class="ident" id="1639276">_</span><span class="op" id="1639277">,</span>&nbsp;<span class="ident" id="1639279">_</span>&nbsp;<span class="op" id="1639281">=</span>&nbsp;<span class="ident" id="1639283"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1639293">(</span><span class="ident" id="1639294"><a href="/syscall/zsysnum_linux_amd64.go.html#1814963">SYS_GETPPID</a></span><span class="op" id="1639305">,</span>&nbsp;<span class="num" id="1639307">0</span><span class="op" id="1639308">,</span>&nbsp;<span class="num" id="1639310">0</span><span class="op" id="1639311">,</span>&nbsp;<span class="num" id="1639313">0</span><span class="op" id="1639314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639318">if</span>&nbsp;<span class="ident" id="1639321"><a href="/syscall/exec_linux.go.html#1637106">r1</a></span>&nbsp;<span class="op" id="1639324">==</span>&nbsp;<span class="num" id="1639327">1</span>&nbsp;<span class="op" id="1639329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639334">pid</span><span class="op" id="1639337">,</span>&nbsp;<span class="ident" id="1639339">_</span><span class="op" id="1639340">,</span>&nbsp;<span class="ident" id="1639342">_</span>&nbsp;<span class="op" id="1639344">:=</span>&nbsp;<span class="ident" id="1639347"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1639357">(</span><span class="ident" id="1639358"><a href="/syscall/zsysnum_linux_amd64.go.html#1812610">SYS_GETPID</a></span><span class="op" id="1639368">,</span>&nbsp;<span class="num" id="1639370">0</span><span class="op" id="1639371">,</span>&nbsp;<span class="num" id="1639373">0</span><span class="op" id="1639374">,</span>&nbsp;<span class="num" id="1639376">0</span><span class="op" id="1639377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639382">_</span><span class="op" id="1639383">,</span>&nbsp;<span class="ident" id="1639385">_</span><span class="op" id="1639386">,</span>&nbsp;<span class="ident" id="1639388">err1</span>&nbsp;<span class="op" id="1639393">:=</span>&nbsp;<span class="ident" id="1639396"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1639406">(</span><span class="ident" id="1639407"><a href="/syscall/zsysnum_linux_amd64.go.html#1813369">SYS_KILL</a></span><span class="op" id="1639415">,</span>&nbsp;<span class="ident" id="1639417"><a href="/syscall/exec_linux.go.html#1639334">pid</a></span><span class="op" id="1639420">,</span>&nbsp;<span class="builtintype" id="1639422">uintptr</span><span class="op" id="1639429">(</span><span class="ident" id="1639430"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1639433">.</span><span class="ident" id="1639434">Pdeathsig</span><span class="op" id="1639443">)</span><span class="op" id="1639444">,</span>&nbsp;<span class="num" id="1639446">0</span><span class="op" id="1639447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639452">if</span>&nbsp;<span class="ident" id="1639455"><a href="/syscall/exec_linux.go.html#1639388">err1</a></span>&nbsp;<span class="op" id="1639460">!=</span>&nbsp;<span class="num" id="1639463">0</span>&nbsp;<span class="op" id="1639465">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639471">goto</span>&nbsp;<span class="ident" id="1639476">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1639501">//&nbsp;Enable&nbsp;tracing&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639534">if</span>&nbsp;<span class="ident" id="1639537"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1639540">.</span><span class="ident" id="1639541">Ptrace</span>&nbsp;<span class="op" id="1639548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639552">_</span><span class="op" id="1639553">,</span>&nbsp;<span class="ident" id="1639555">_</span><span class="op" id="1639556">,</span>&nbsp;<span class="ident" id="1639558"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1639563">=</span>&nbsp;<span class="ident" id="1639565"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1639575">(</span><span class="ident" id="1639576"><a href="/syscall/zsysnum_linux_amd64.go.html#1814657">SYS_PTRACE</a></span><span class="op" id="1639586">,</span>&nbsp;<span class="builtintype" id="1639588">uintptr</span><span class="op" id="1639595">(</span><span class="ident" id="1639596"><a href="/syscall/zerrors_linux_amd64.go.html#1738360">PTRACE_TRACEME</a></span><span class="op" id="1639610">)</span><span class="op" id="1639611">,</span>&nbsp;<span class="num" id="1639613">0</span><span class="op" id="1639614">,</span>&nbsp;<span class="num" id="1639616">0</span><span class="op" id="1639617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639621">if</span>&nbsp;<span class="ident" id="1639624"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1639629">!=</span>&nbsp;<span class="num" id="1639632">0</span>&nbsp;<span class="op" id="1639634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639639">goto</span>&nbsp;<span class="ident" id="1639644">childerror</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1639664">//&nbsp;Session&nbsp;ID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639679">if</span>&nbsp;<span class="ident" id="1639682"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1639685">.</span><span class="ident" id="1639686">Setsid</span>&nbsp;<span class="op" id="1639693">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639697">_</span><span class="op" id="1639698">,</span>&nbsp;<span class="ident" id="1639700">_</span><span class="op" id="1639701">,</span>&nbsp;<span class="ident" id="1639703"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1639708">=</span>&nbsp;<span class="ident" id="1639710"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1639720">(</span><span class="ident" id="1639721"><a href="/syscall/zsysnum_linux_amd64.go.html#1815031">SYS_SETSID</a></span><span class="op" id="1639731">,</span>&nbsp;<span class="num" id="1639733">0</span><span class="op" id="1639734">,</span>&nbsp;<span class="num" id="1639736">0</span><span class="op" id="1639737">,</span>&nbsp;<span class="num" id="1639739">0</span><span class="op" id="1639740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639744">if</span>&nbsp;<span class="ident" id="1639747"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1639752">!=</span>&nbsp;<span class="num" id="1639755">0</span>&nbsp;<span class="op" id="1639757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639762">goto</span>&nbsp;<span class="ident" id="1639767">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639783">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1639787">//&nbsp;Set&nbsp;process&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639809">if</span>&nbsp;<span class="ident" id="1639812"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1639815">.</span><span class="ident" id="1639816">Setpgid</span>&nbsp;<span class="op" id="1639824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639828">_</span><span class="op" id="1639829">,</span>&nbsp;<span class="ident" id="1639831">_</span><span class="op" id="1639832">,</span>&nbsp;<span class="ident" id="1639834"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1639839">=</span>&nbsp;<span class="ident" id="1639841"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1639851">(</span><span class="ident" id="1639852"><a href="/syscall/zsysnum_linux_amd64.go.html#1814929">SYS_SETPGID</a></span><span class="op" id="1639863">,</span>&nbsp;<span class="num" id="1639865">0</span><span class="op" id="1639866">,</span>&nbsp;<span class="num" id="1639868">0</span><span class="op" id="1639869">,</span>&nbsp;<span class="num" id="1639871">0</span><span class="op" id="1639872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639876">if</span>&nbsp;<span class="ident" id="1639879"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1639884">!=</span>&nbsp;<span class="num" id="1639887">0</span>&nbsp;<span class="op" id="1639889">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639894">goto</span>&nbsp;<span class="ident" id="1639899">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1639915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1639919">//&nbsp;Chroot</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1639930">if</span>&nbsp;<span class="ident" id="1639933"><a href="/syscall/exec_linux.go.html#1636911">chroot</a></span>&nbsp;<span class="op" id="1639940">!=</span>&nbsp;<span class="ident" id="1639943">nil</span>&nbsp;<span class="op" id="1639947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1639951">_</span><span class="op" id="1639952">,</span>&nbsp;<span class="ident" id="1639954">_</span><span class="op" id="1639955">,</span>&nbsp;<span class="ident" id="1639957"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1639962">=</span>&nbsp;<span class="ident" id="1639964"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1639974">(</span><span class="ident" id="1639975"><a href="/syscall/zsysnum_linux_amd64.go.html#1816697">SYS_CHROOT</a></span><span class="op" id="1639985">,</span>&nbsp;<span class="builtintype" id="1639987">uintptr</span><span class="op" id="1639994">(</span><span class="ident" id="1639995"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1640001">.</span><span class="ident" id="1640002">Pointer</span><span class="op" id="1640009">(</span><span class="ident" id="1640010"><a href="/syscall/exec_linux.go.html#1636911">chroot</a></span><span class="op" id="1640016">)</span><span class="op" id="1640017">)</span><span class="op" id="1640018">,</span>&nbsp;<span class="num" id="1640020">0</span><span class="op" id="1640021">,</span>&nbsp;<span class="num" id="1640023">0</span><span class="op" id="1640024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640028">if</span>&nbsp;<span class="ident" id="1640031"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1640036">!=</span>&nbsp;<span class="num" id="1640039">0</span>&nbsp;<span class="op" id="1640041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640046">goto</span>&nbsp;<span class="ident" id="1640051">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640064">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1640071">//&nbsp;User&nbsp;and&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640091">if</span>&nbsp;<span class="ident" id="1640094">cred</span>&nbsp;<span class="op" id="1640099">:=</span>&nbsp;<span class="ident" id="1640102"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1640105">.</span><span class="ident" id="1640106">Credential</span><span class="op" id="1640116">;</span>&nbsp;<span class="ident" id="1640118"><a href="/syscall/exec_linux.go.html#1640094">cred</a></span>&nbsp;<span class="op" id="1640123">!=</span>&nbsp;<span class="ident" id="1640126">nil</span>&nbsp;<span class="op" id="1640130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640134">ngroups</span>&nbsp;<span class="op" id="1640142">:=</span>&nbsp;<span class="builtintype" id="1640145">uintptr</span><span class="op" id="1640152">(</span><span class="builtinfunc" id="1640153">len</span><span class="op" id="1640156">(</span><span class="ident" id="1640157"><a href="/syscall/exec_linux.go.html#1640094">cred</a></span><span class="op" id="1640161">.</span><span class="ident" id="1640162">Groups</span><span class="op" id="1640168">)</span><span class="op" id="1640169">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640173">var</span>&nbsp;<span class="ident" id="1640177">groups</span>&nbsp;<span class="ident" id="1640184"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1640190">.</span><span class="ident" id="1640191">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640201">if</span>&nbsp;<span class="ident" id="1640204"><a href="/syscall/exec_linux.go.html#1640134">ngroups</a></span>&nbsp;<span class="op" id="1640212">&gt;</span>&nbsp;<span class="num" id="1640214">0</span>&nbsp;<span class="op" id="1640216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640221"><a href="/syscall/exec_linux.go.html#1640177">groups</a></span>&nbsp;<span class="op" id="1640228">=</span>&nbsp;<span class="ident" id="1640230"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1640236">.</span><span class="ident" id="1640237">Pointer</span><span class="op" id="1640244">(</span><span class="op" id="1640245">&amp;</span><span class="ident" id="1640246"><a href="/syscall/exec_linux.go.html#1640094">cred</a></span><span class="op" id="1640250">.</span><span class="ident" id="1640251">Groups</span><span class="op" id="1640257">[</span><span class="num" id="1640258">0</span><span class="op" id="1640259">]</span><span class="op" id="1640260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640268">_</span><span class="op" id="1640269">,</span>&nbsp;<span class="ident" id="1640271">_</span><span class="op" id="1640272">,</span>&nbsp;<span class="ident" id="1640274"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1640279">=</span>&nbsp;<span class="ident" id="1640281"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1640291">(</span><span class="ident" id="1640292"><a href="/syscall/zsysnum_linux_amd64.go.html#1815167">SYS_SETGROUPS</a></span><span class="op" id="1640305">,</span>&nbsp;<span class="ident" id="1640307"><a href="/syscall/exec_linux.go.html#1640134">ngroups</a></span><span class="op" id="1640314">,</span>&nbsp;<span class="builtintype" id="1640316">uintptr</span><span class="op" id="1640323">(</span><span class="ident" id="1640324"><a href="/syscall/exec_linux.go.html#1640177">groups</a></span><span class="op" id="1640330">)</span><span class="op" id="1640331">,</span>&nbsp;<span class="num" id="1640333">0</span><span class="op" id="1640334">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640338">if</span>&nbsp;<span class="ident" id="1640341"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1640346">!=</span>&nbsp;<span class="num" id="1640349">0</span>&nbsp;<span class="op" id="1640351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640356">goto</span>&nbsp;<span class="ident" id="1640361">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640378">_</span><span class="op" id="1640379">,</span>&nbsp;<span class="ident" id="1640381">_</span><span class="op" id="1640382">,</span>&nbsp;<span class="ident" id="1640384"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1640389">=</span>&nbsp;<span class="ident" id="1640391"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1640401">(</span><span class="ident" id="1640402"><a href="/syscall/zsysnum_linux_amd64.go.html#1814827">SYS_SETGID</a></span><span class="op" id="1640412">,</span>&nbsp;<span class="builtintype" id="1640414">uintptr</span><span class="op" id="1640421">(</span><span class="ident" id="1640422"><a href="/syscall/exec_linux.go.html#1640094">cred</a></span><span class="op" id="1640426">.</span><span class="ident" id="1640427">Gid</span><span class="op" id="1640430">)</span><span class="op" id="1640431">,</span>&nbsp;<span class="num" id="1640433">0</span><span class="op" id="1640434">,</span>&nbsp;<span class="num" id="1640436">0</span><span class="op" id="1640437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640441">if</span>&nbsp;<span class="ident" id="1640444"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1640449">!=</span>&nbsp;<span class="num" id="1640452">0</span>&nbsp;<span class="op" id="1640454">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640459">goto</span>&nbsp;<span class="ident" id="1640464">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640481">_</span><span class="op" id="1640482">,</span>&nbsp;<span class="ident" id="1640484">_</span><span class="op" id="1640485">,</span>&nbsp;<span class="ident" id="1640487"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1640492">=</span>&nbsp;<span class="ident" id="1640494"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1640504">(</span><span class="ident" id="1640505"><a href="/syscall/zsysnum_linux_amd64.go.html#1814793">SYS_SETUID</a></span><span class="op" id="1640515">,</span>&nbsp;<span class="builtintype" id="1640517">uintptr</span><span class="op" id="1640524">(</span><span class="ident" id="1640525"><a href="/syscall/exec_linux.go.html#1640094">cred</a></span><span class="op" id="1640529">.</span><span class="ident" id="1640530">Uid</span><span class="op" id="1640533">)</span><span class="op" id="1640534">,</span>&nbsp;<span class="num" id="1640536">0</span><span class="op" id="1640537">,</span>&nbsp;<span class="num" id="1640539">0</span><span class="op" id="1640540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640544">if</span>&nbsp;<span class="ident" id="1640547"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1640552">!=</span>&nbsp;<span class="num" id="1640555">0</span>&nbsp;<span class="op" id="1640557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640562">goto</span>&nbsp;<span class="ident" id="1640567">childerror</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1640587">//&nbsp;Chdir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640597">if</span>&nbsp;<span class="ident" id="1640600"><a href="/syscall/exec_linux.go.html#1636919">dir</a></span>&nbsp;<span class="op" id="1640604">!=</span>&nbsp;<span class="ident" id="1640607">nil</span>&nbsp;<span class="op" id="1640611">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640615">_</span><span class="op" id="1640616">,</span>&nbsp;<span class="ident" id="1640618">_</span><span class="op" id="1640619">,</span>&nbsp;<span class="ident" id="1640621"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1640626">=</span>&nbsp;<span class="ident" id="1640628"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1640638">(</span><span class="ident" id="1640639"><a href="/syscall/zsysnum_linux_amd64.go.html#1813963">SYS_CHDIR</a></span><span class="op" id="1640648">,</span>&nbsp;<span class="builtintype" id="1640650">uintptr</span><span class="op" id="1640657">(</span><span class="ident" id="1640658"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1640664">.</span><span class="ident" id="1640665">Pointer</span><span class="op" id="1640672">(</span><span class="ident" id="1640673"><a href="/syscall/exec_linux.go.html#1636919">dir</a></span><span class="op" id="1640676">)</span><span class="op" id="1640677">)</span><span class="op" id="1640678">,</span>&nbsp;<span class="num" id="1640680">0</span><span class="op" id="1640681">,</span>&nbsp;<span class="num" id="1640683">0</span><span class="op" id="1640684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640688">if</span>&nbsp;<span class="ident" id="1640691"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1640696">!=</span>&nbsp;<span class="num" id="1640699">0</span>&nbsp;<span class="op" id="1640701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640706">goto</span>&nbsp;<span class="ident" id="1640711">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640727">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1640731">//&nbsp;Pass&nbsp;1:&nbsp;look&nbsp;for&nbsp;fd[i]&nbsp;&lt;&nbsp;i&nbsp;and&nbsp;move&nbsp;those&nbsp;up&nbsp;above&nbsp;len(fd)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1640794">//&nbsp;so&nbsp;that&nbsp;pass&nbsp;2&nbsp;won&#39;t&nbsp;stomp&nbsp;on&nbsp;an&nbsp;fd&nbsp;it&nbsp;needs&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640850">if</span>&nbsp;<span class="ident" id="1640853"><a href="/syscall/exec_linux.go.html#1636964">pipe</a></span>&nbsp;<span class="op" id="1640858">&lt;</span>&nbsp;<span class="ident" id="1640860"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span>&nbsp;<span class="op" id="1640867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640871">_</span><span class="op" id="1640872">,</span>&nbsp;<span class="ident" id="1640874">_</span><span class="op" id="1640875">,</span>&nbsp;<span class="ident" id="1640877"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1640882">=</span>&nbsp;<span class="ident" id="1640884"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1640894">(</span><span class="ident" id="1640895"><a href="/syscall/zsysnum_linux_amd64.go.html#1812412">SYS_DUP2</a></span><span class="op" id="1640903">,</span>&nbsp;<span class="builtintype" id="1640905">uintptr</span><span class="op" id="1640912">(</span><span class="ident" id="1640913"><a href="/syscall/exec_linux.go.html#1636964">pipe</a></span><span class="op" id="1640917">)</span><span class="op" id="1640918">,</span>&nbsp;<span class="builtintype" id="1640920">uintptr</span><span class="op" id="1640927">(</span><span class="ident" id="1640928"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span><span class="op" id="1640934">)</span><span class="op" id="1640935">,</span>&nbsp;<span class="num" id="1640937">0</span><span class="op" id="1640938">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640942">if</span>&nbsp;<span class="ident" id="1640945"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1640950">!=</span>&nbsp;<span class="num" id="1640953">0</span>&nbsp;<span class="op" id="1640955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1640960">goto</span>&nbsp;<span class="ident" id="1640965">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1640978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1640982"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1640992">(</span><span class="ident" id="1640993"><a href="/syscall/zsysnum_linux_amd64.go.html#1813699">SYS_FCNTL</a></span><span class="op" id="1641002">,</span>&nbsp;<span class="builtintype" id="1641004">uintptr</span><span class="op" id="1641011">(</span><span class="ident" id="1641012"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span><span class="op" id="1641018">)</span><span class="op" id="1641019">,</span>&nbsp;<span class="ident" id="1641021"><a href="/syscall/zerrors_linux_amd64.go.html#1717234">F_SETFD</a></span><span class="op" id="1641028">,</span>&nbsp;<span class="ident" id="1641030"><a href="/syscall/zerrors_linux_amd64.go.html#1716503">FD_CLOEXEC</a></span><span class="op" id="1641040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1641044"><a href="/syscall/exec_linux.go.html#1636964">pipe</a></span>&nbsp;<span class="op" id="1641049">=</span>&nbsp;<span class="ident" id="1641051"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1641060"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span><span class="op" id="1641066">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641073">for</span>&nbsp;<span class="ident" id="1641077"><a href="/syscall/exec_linux.go.html#1637166">i</a></span>&nbsp;<span class="op" id="1641079">=</span>&nbsp;<span class="num" id="1641081">0</span><span class="op" id="1641082">;</span>&nbsp;<span class="ident" id="1641084"><a href="/syscall/exec_linux.go.html#1637166">i</a></span>&nbsp;<span class="op" id="1641086">&lt;</span>&nbsp;<span class="builtinfunc" id="1641088">len</span><span class="op" id="1641091">(</span><span class="ident" id="1641092"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1641094">)</span><span class="op" id="1641095">;</span>&nbsp;<span class="ident" id="1641097"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641098">++</span>&nbsp;<span class="op" id="1641101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641105">if</span>&nbsp;<span class="ident" id="1641108"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1641110">[</span><span class="ident" id="1641111"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641112">]</span>&nbsp;<span class="op" id="1641114">&gt;=</span>&nbsp;<span class="num" id="1641117">0</span>&nbsp;<span class="op" id="1641119">&amp;&amp;</span>&nbsp;<span class="ident" id="1641122"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1641124">[</span><span class="ident" id="1641125"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641126">]</span>&nbsp;<span class="op" id="1641128">&lt;</span>&nbsp;<span class="builtintype" id="1641130">int</span><span class="op" id="1641133">(</span><span class="ident" id="1641134"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641135">)</span>&nbsp;<span class="op" id="1641137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1641142">_</span><span class="op" id="1641143">,</span>&nbsp;<span class="ident" id="1641145">_</span><span class="op" id="1641146">,</span>&nbsp;<span class="ident" id="1641148"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1641153">=</span>&nbsp;<span class="ident" id="1641155"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1641165">(</span><span class="ident" id="1641166"><a href="/syscall/zsysnum_linux_amd64.go.html#1812412">SYS_DUP2</a></span><span class="op" id="1641174">,</span>&nbsp;<span class="builtintype" id="1641176">uintptr</span><span class="op" id="1641183">(</span><span class="ident" id="1641184"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1641186">[</span><span class="ident" id="1641187"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641188">]</span><span class="op" id="1641189">)</span><span class="op" id="1641190">,</span>&nbsp;<span class="builtintype" id="1641192">uintptr</span><span class="op" id="1641199">(</span><span class="ident" id="1641200"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span><span class="op" id="1641206">)</span><span class="op" id="1641207">,</span>&nbsp;<span class="num" id="1641209">0</span><span class="op" id="1641210">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641215">if</span>&nbsp;<span class="ident" id="1641218"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1641223">!=</span>&nbsp;<span class="num" id="1641226">0</span>&nbsp;<span class="op" id="1641228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641234">goto</span>&nbsp;<span class="ident" id="1641239">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1641258"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1641268">(</span><span class="ident" id="1641269"><a href="/syscall/zsysnum_linux_amd64.go.html#1813699">SYS_FCNTL</a></span><span class="op" id="1641278">,</span>&nbsp;<span class="builtintype" id="1641280">uintptr</span><span class="op" id="1641287">(</span><span class="ident" id="1641288"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span><span class="op" id="1641294">)</span><span class="op" id="1641295">,</span>&nbsp;<span class="ident" id="1641297"><a href="/syscall/zerrors_linux_amd64.go.html#1717234">F_SETFD</a></span><span class="op" id="1641304">,</span>&nbsp;<span class="ident" id="1641306"><a href="/syscall/zerrors_linux_amd64.go.html#1716503">FD_CLOEXEC</a></span><span class="op" id="1641316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1641321"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1641323">[</span><span class="ident" id="1641324"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641325">]</span>&nbsp;<span class="op" id="1641327">=</span>&nbsp;<span class="ident" id="1641329"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1641339"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span><span class="op" id="1641345">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641351">if</span>&nbsp;<span class="ident" id="1641354"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span>&nbsp;<span class="op" id="1641361">==</span>&nbsp;<span class="ident" id="1641364"><a href="/syscall/exec_linux.go.html#1636964">pipe</a></span>&nbsp;<span class="op" id="1641369">{</span>&nbsp;<span class="comment" id="1641371">//&nbsp;don&#39;t&nbsp;stomp&nbsp;on&nbsp;pipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1641398"><a href="/syscall/exec_linux.go.html#1637153">nextfd</a></span><span class="op" id="1641404">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641414">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1641421">//&nbsp;Pass&nbsp;2:&nbsp;dup&nbsp;fd[i]&nbsp;down&nbsp;onto&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641456">for</span>&nbsp;<span class="ident" id="1641460"><a href="/syscall/exec_linux.go.html#1637166">i</a></span>&nbsp;<span class="op" id="1641462">=</span>&nbsp;<span class="num" id="1641464">0</span><span class="op" id="1641465">;</span>&nbsp;<span class="ident" id="1641467"><a href="/syscall/exec_linux.go.html#1637166">i</a></span>&nbsp;<span class="op" id="1641469">&lt;</span>&nbsp;<span class="builtinfunc" id="1641471">len</span><span class="op" id="1641474">(</span><span class="ident" id="1641475"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1641477">)</span><span class="op" id="1641478">;</span>&nbsp;<span class="ident" id="1641480"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641481">++</span>&nbsp;<span class="op" id="1641484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641488">if</span>&nbsp;<span class="ident" id="1641491"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1641493">[</span><span class="ident" id="1641494"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641495">]</span>&nbsp;<span class="op" id="1641497">==</span>&nbsp;<span class="op" id="1641500">-</span><span class="num" id="1641501">1</span>&nbsp;<span class="op" id="1641503">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1641508"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1641518">(</span><span class="ident" id="1641519"><a href="/syscall/zsysnum_linux_amd64.go.html#1811429">SYS_CLOSE</a></span><span class="op" id="1641528">,</span>&nbsp;<span class="builtintype" id="1641530">uintptr</span><span class="op" id="1641537">(</span><span class="ident" id="1641538"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641539">)</span><span class="op" id="1641540">,</span>&nbsp;<span class="num" id="1641542">0</span><span class="op" id="1641543">,</span>&nbsp;<span class="num" id="1641545">0</span><span class="op" id="1641546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641551">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641566">if</span>&nbsp;<span class="ident" id="1641569"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1641571">[</span><span class="ident" id="1641572"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641573">]</span>&nbsp;<span class="op" id="1641575">==</span>&nbsp;<span class="builtintype" id="1641578">int</span><span class="op" id="1641581">(</span><span class="ident" id="1641582"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641583">)</span>&nbsp;<span class="op" id="1641585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1641590">//&nbsp;dup2(i,&nbsp;i)&nbsp;won&#39;t&nbsp;clear&nbsp;close-on-exec&nbsp;flag&nbsp;on&nbsp;Linux,</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1641648">//&nbsp;probably&nbsp;not&nbsp;elsewhere&nbsp;either.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1641685">_</span><span class="op" id="1641686">,</span>&nbsp;<span class="ident" id="1641688">_</span><span class="op" id="1641689">,</span>&nbsp;<span class="ident" id="1641691"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1641696">=</span>&nbsp;<span class="ident" id="1641698"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1641708">(</span><span class="ident" id="1641709"><a href="/syscall/zsysnum_linux_amd64.go.html#1813699">SYS_FCNTL</a></span><span class="op" id="1641718">,</span>&nbsp;<span class="builtintype" id="1641720">uintptr</span><span class="op" id="1641727">(</span><span class="ident" id="1641728"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1641730">[</span><span class="ident" id="1641731"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641732">]</span><span class="op" id="1641733">)</span><span class="op" id="1641734">,</span>&nbsp;<span class="ident" id="1641736"><a href="/syscall/zerrors_linux_amd64.go.html#1717234">F_SETFD</a></span><span class="op" id="1641743">,</span>&nbsp;<span class="num" id="1641745">0</span><span class="op" id="1641746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641751">if</span>&nbsp;<span class="ident" id="1641754"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1641759">!=</span>&nbsp;<span class="num" id="1641762">0</span>&nbsp;<span class="op" id="1641764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641770">goto</span>&nbsp;<span class="ident" id="1641775">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641789">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641794">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1641809">//&nbsp;The&nbsp;new&nbsp;fd&nbsp;is&nbsp;created&nbsp;NOT&nbsp;close-on-exec,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1641855">//&nbsp;which&nbsp;is&nbsp;exactly&nbsp;what&nbsp;we&nbsp;want.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1641891">_</span><span class="op" id="1641892">,</span>&nbsp;<span class="ident" id="1641894">_</span><span class="op" id="1641895">,</span>&nbsp;<span class="ident" id="1641897"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1641902">=</span>&nbsp;<span class="ident" id="1641904"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1641914">(</span><span class="ident" id="1641915"><a href="/syscall/zsysnum_linux_amd64.go.html#1812412">SYS_DUP2</a></span><span class="op" id="1641923">,</span>&nbsp;<span class="builtintype" id="1641925">uintptr</span><span class="op" id="1641932">(</span><span class="ident" id="1641933"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1641935">[</span><span class="ident" id="1641936"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641937">]</span><span class="op" id="1641938">)</span><span class="op" id="1641939">,</span>&nbsp;<span class="builtintype" id="1641941">uintptr</span><span class="op" id="1641948">(</span><span class="ident" id="1641949"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1641950">)</span><span class="op" id="1641951">,</span>&nbsp;<span class="num" id="1641953">0</span><span class="op" id="1641954">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641958">if</span>&nbsp;<span class="ident" id="1641961"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1641966">!=</span>&nbsp;<span class="num" id="1641969">0</span>&nbsp;<span class="op" id="1641971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1641976">goto</span>&nbsp;<span class="ident" id="1641981">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1641997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642001">//&nbsp;By&nbsp;convention,&nbsp;we&nbsp;don&#39;t&nbsp;close-on-exec&nbsp;the&nbsp;fds&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642058">//&nbsp;started&nbsp;with,&nbsp;so&nbsp;if&nbsp;len(fd)&nbsp;&lt;&nbsp;3,&nbsp;close&nbsp;0,&nbsp;1,&nbsp;2&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642120">//&nbsp;Programs&nbsp;that&nbsp;know&nbsp;they&nbsp;inherit&nbsp;fds&nbsp;&gt;=&nbsp;3&nbsp;will&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642175">//&nbsp;to&nbsp;set&nbsp;them&nbsp;close-on-exec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1642206">for</span>&nbsp;<span class="ident" id="1642210"><a href="/syscall/exec_linux.go.html#1637166">i</a></span>&nbsp;<span class="op" id="1642212">=</span>&nbsp;<span class="builtinfunc" id="1642214">len</span><span class="op" id="1642217">(</span><span class="ident" id="1642218"><a href="/syscall/exec_linux.go.html#1637376">fd</a></span><span class="op" id="1642220">)</span><span class="op" id="1642221">;</span>&nbsp;<span class="ident" id="1642223"><a href="/syscall/exec_linux.go.html#1637166">i</a></span>&nbsp;<span class="op" id="1642225">&lt;</span>&nbsp;<span class="num" id="1642227">3</span><span class="op" id="1642228">;</span>&nbsp;<span class="ident" id="1642230"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1642231">++</span>&nbsp;<span class="op" id="1642234">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642238"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1642248">(</span><span class="ident" id="1642249"><a href="/syscall/zsysnum_linux_amd64.go.html#1811429">SYS_CLOSE</a></span><span class="op" id="1642258">,</span>&nbsp;<span class="builtintype" id="1642260">uintptr</span><span class="op" id="1642267">(</span><span class="ident" id="1642268"><a href="/syscall/exec_linux.go.html#1637166">i</a></span><span class="op" id="1642269">)</span><span class="op" id="1642270">,</span>&nbsp;<span class="num" id="1642272">0</span><span class="op" id="1642273">,</span>&nbsp;<span class="num" id="1642275">0</span><span class="op" id="1642276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1642279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642283">//&nbsp;Detach&nbsp;fd&nbsp;0&nbsp;from&nbsp;tty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1642308">if</span>&nbsp;<span class="ident" id="1642311"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1642314">.</span><span class="ident" id="1642315">Noctty</span>&nbsp;<span class="op" id="1642322">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642326">_</span><span class="op" id="1642327">,</span>&nbsp;<span class="ident" id="1642329">_</span><span class="op" id="1642330">,</span>&nbsp;<span class="ident" id="1642332"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1642337">=</span>&nbsp;<span class="ident" id="1642339"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1642349">(</span><span class="ident" id="1642350"><a href="/syscall/zsysnum_linux_amd64.go.html#1811851">SYS_IOCTL</a></span><span class="op" id="1642359">,</span>&nbsp;<span class="num" id="1642361">0</span><span class="op" id="1642362">,</span>&nbsp;<span class="builtintype" id="1642364">uintptr</span><span class="op" id="1642371">(</span><span class="ident" id="1642372"><a href="/syscall/zerrors_linux_amd64.go.html#1752870">TIOCNOTTY</a></span><span class="op" id="1642381">)</span><span class="op" id="1642382">,</span>&nbsp;<span class="num" id="1642384">0</span><span class="op" id="1642385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1642389">if</span>&nbsp;<span class="ident" id="1642392"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1642397">!=</span>&nbsp;<span class="num" id="1642400">0</span>&nbsp;<span class="op" id="1642402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1642407">goto</span>&nbsp;<span class="ident" id="1642412">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1642425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1642428">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642432">//&nbsp;Set&nbsp;the&nbsp;controlling&nbsp;TTY&nbsp;to&nbsp;Ctty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1642468">if</span>&nbsp;<span class="ident" id="1642471"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1642474">.</span><span class="ident" id="1642475">Setctty</span>&nbsp;<span class="op" id="1642483">&amp;&amp;</span>&nbsp;<span class="ident" id="1642486"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1642489">.</span><span class="ident" id="1642490">Ctty</span>&nbsp;<span class="op" id="1642495">&gt;=</span>&nbsp;<span class="num" id="1642498">0</span>&nbsp;<span class="op" id="1642500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642504">_</span><span class="op" id="1642505">,</span>&nbsp;<span class="ident" id="1642507">_</span><span class="op" id="1642508">,</span>&nbsp;<span class="ident" id="1642510"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1642515">=</span>&nbsp;<span class="ident" id="1642517"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1642527">(</span><span class="ident" id="1642528"><a href="/syscall/zsysnum_linux_amd64.go.html#1811851">SYS_IOCTL</a></span><span class="op" id="1642537">,</span>&nbsp;<span class="builtintype" id="1642539">uintptr</span><span class="op" id="1642546">(</span><span class="ident" id="1642547"><a href="/syscall/exec_linux.go.html#1636946">sys</a></span><span class="op" id="1642550">.</span><span class="ident" id="1642551">Ctty</span><span class="op" id="1642555">)</span><span class="op" id="1642556">,</span>&nbsp;<span class="builtintype" id="1642558">uintptr</span><span class="op" id="1642565">(</span><span class="ident" id="1642566"><a href="/syscall/zerrors_linux_amd64.go.html#1753408">TIOCSCTTY</a></span><span class="op" id="1642575">)</span><span class="op" id="1642576">,</span>&nbsp;<span class="num" id="1642578">0</span><span class="op" id="1642579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1642583">if</span>&nbsp;<span class="ident" id="1642586"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1642591">!=</span>&nbsp;<span class="num" id="1642594">0</span>&nbsp;<span class="op" id="1642596">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1642601">goto</span>&nbsp;<span class="ident" id="1642606">childerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1642619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1642622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642626">//&nbsp;Time&nbsp;to&nbsp;exec.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642644">_</span><span class="op" id="1642645">,</span>&nbsp;<span class="ident" id="1642647">_</span><span class="op" id="1642648">,</span>&nbsp;<span class="ident" id="1642650"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span>&nbsp;<span class="op" id="1642655">=</span>&nbsp;<span class="ident" id="1642657"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1642667">(</span><span class="ident" id="1642668"><a href="/syscall/zsysnum_linux_amd64.go.html#1813270">SYS_EXECVE</a></span><span class="op" id="1642678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1642682">uintptr</span><span class="op" id="1642689">(</span><span class="ident" id="1642690"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1642696">.</span><span class="ident" id="1642697">Pointer</span><span class="op" id="1642704">(</span><span class="ident" id="1642705"><a href="/syscall/exec_linux.go.html#1636878">argv0</a></span><span class="op" id="1642710">)</span><span class="op" id="1642711">)</span><span class="op" id="1642712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1642716">uintptr</span><span class="op" id="1642723">(</span><span class="ident" id="1642724"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1642730">.</span><span class="ident" id="1642731">Pointer</span><span class="op" id="1642738">(</span><span class="op" id="1642739">&amp;</span><span class="ident" id="1642740"><a href="/syscall/exec_linux.go.html#1636891">argv</a></span><span class="op" id="1642744">[</span><span class="num" id="1642745">0</span><span class="op" id="1642746">]</span><span class="op" id="1642747">)</span><span class="op" id="1642748">)</span><span class="op" id="1642749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1642753">uintptr</span><span class="op" id="1642760">(</span><span class="ident" id="1642761"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1642767">.</span><span class="ident" id="1642768">Pointer</span><span class="op" id="1642775">(</span><span class="op" id="1642776">&amp;</span><span class="ident" id="1642777"><a href="/syscall/exec_linux.go.html#1636897">envv</a></span><span class="op" id="1642781">[</span><span class="num" id="1642782">0</span><span class="op" id="1642783">]</span><span class="op" id="1642784">)</span><span class="op" id="1642785">)</span><span class="op" id="1642786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="ident" id="1642789">childerror</span><span class="op" id="1642799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642802">//&nbsp;send&nbsp;error&nbsp;code&nbsp;on&nbsp;pipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642830"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1642840">(</span><span class="ident" id="1642841"><a href="/syscall/zsysnum_linux_amd64.go.html#1811365">SYS_WRITE</a></span><span class="op" id="1642850">,</span>&nbsp;<span class="builtintype" id="1642852">uintptr</span><span class="op" id="1642859">(</span><span class="ident" id="1642860"><a href="/syscall/exec_linux.go.html#1636964">pipe</a></span><span class="op" id="1642864">)</span><span class="op" id="1642865">,</span>&nbsp;<span class="builtintype" id="1642867">uintptr</span><span class="op" id="1642874">(</span><span class="ident" id="1642875"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1642881">.</span><span class="ident" id="1642882">Pointer</span><span class="op" id="1642889">(</span><span class="op" id="1642890">&amp;</span><span class="ident" id="1642891"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span><span class="op" id="1642895">)</span><span class="op" id="1642896">)</span><span class="op" id="1642897">,</span>&nbsp;<span class="ident" id="1642899"><a href="/syscall/exec_linux.go.html#1635139">unsafe</a></span><span class="op" id="1642905">.</span><span class="ident" id="1642906">Sizeof</span><span class="op" id="1642912">(</span><span class="ident" id="1642913"><a href="/syscall/exec_linux.go.html#1637123">err1</a></span><span class="op" id="1642917">)</span><span class="op" id="1642918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1642921">for</span>&nbsp;<span class="op" id="1642925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642929"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1642939">(</span><span class="ident" id="1642940"><a href="/syscall/zsysnum_linux_amd64.go.html#1813303">SYS_EXIT</a></span><span class="op" id="1642948">,</span>&nbsp;<span class="num" id="1642950">253</span><span class="op" id="1642953">,</span>&nbsp;<span class="num" id="1642955">0</span><span class="op" id="1642956">,</span>&nbsp;<span class="num" id="1642958">0</span><span class="op" id="1642959">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1642962">}</span><br>
<span class="lineno"></span><span class="op" id="1642964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1642967">//&nbsp;Try&nbsp;to&nbsp;open&nbsp;a&nbsp;pipe&nbsp;with&nbsp;O_CLOEXEC&nbsp;set&nbsp;on&nbsp;both&nbsp;file&nbsp;descriptors.</span><br>
<span class="lineno"></span><span class="keyword" id="1643034">func</span>&nbsp;<span class="ident" id="1643039">forkExecPipe</span><span class="op" id="1643051">(</span><span class="ident" id="1643052">p</span>&nbsp;<span class="op" id="1643054">[</span><span class="op" id="1643055">]</span><span class="builtintype" id="1643056">int</span><span class="op" id="1643059">)</span>&nbsp;<span class="op" id="1643061">(</span><span class="ident" id="1643062">err</span>&nbsp;<span class="builtintype" id="1643066">error</span><span class="op" id="1643071">)</span>&nbsp;<span class="op" id="1643073">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643076"><a href="/syscall/exec_linux.go.html#1643062">err</a></span>&nbsp;<span class="op" id="1643080">=</span>&nbsp;<span class="ident" id="1643082"><a href="/syscall/syscall_linux.go.html#1668519">Pipe2</a></span><span class="op" id="1643087">(</span><span class="ident" id="1643088"><a href="/syscall/exec_linux.go.html#1643052">p</a></span><span class="op" id="1643089">,</span>&nbsp;<span class="ident" id="1643091"><a href="/syscall/zerrors_linux_amd64.go.html#1732341">O_CLOEXEC</a></span><span class="op" id="1643100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1643103">//&nbsp;pipe2&nbsp;was&nbsp;added&nbsp;in&nbsp;2.6.27&nbsp;and&nbsp;our&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;2.6.23,&nbsp;so&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1643178">//&nbsp;might&nbsp;not&nbsp;be&nbsp;implemented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643208">if</span>&nbsp;<span class="ident" id="1643211"><a href="/syscall/exec_linux.go.html#1643062">err</a></span>&nbsp;<span class="op" id="1643215">==</span>&nbsp;<span class="ident" id="1643218"><a href="/syscall/zerrors_linux_amd64.go.html#1758195">ENOSYS</a></span>&nbsp;<span class="op" id="1643225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643229">if</span>&nbsp;<span class="ident" id="1643232"><a href="/syscall/exec_linux.go.html#1643062">err</a></span>&nbsp;<span class="op" id="1643236">=</span>&nbsp;<span class="ident" id="1643238"><a href="/syscall/syscall_linux.go.html#1668313">Pipe</a></span><span class="op" id="1643242">(</span><span class="ident" id="1643243"><a href="/syscall/exec_linux.go.html#1643052">p</a></span><span class="op" id="1643244">)</span><span class="op" id="1643245">;</span>&nbsp;<span class="ident" id="1643247"><a href="/syscall/exec_linux.go.html#1643062">err</a></span>&nbsp;<span class="op" id="1643251">!=</span>&nbsp;<span class="ident" id="1643254">nil</span>&nbsp;<span class="op" id="1643258">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643263">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1643272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643276">if</span>&nbsp;<span class="ident" id="1643279">_</span><span class="op" id="1643280">,</span>&nbsp;<span class="ident" id="1643282"><a href="/syscall/exec_linux.go.html#1643062">err</a></span>&nbsp;<span class="op" id="1643286">=</span>&nbsp;<span class="ident" id="1643288"><a href="/syscall/zsyscall_linux_amd64.go.html#1776566">fcntl</a></span><span class="op" id="1643293">(</span><span class="ident" id="1643294"><a href="/syscall/exec_linux.go.html#1643052">p</a></span><span class="op" id="1643295">[</span><span class="num" id="1643296">0</span><span class="op" id="1643297">]</span><span class="op" id="1643298">,</span>&nbsp;<span class="ident" id="1643300"><a href="/syscall/zerrors_linux_amd64.go.html#1717234">F_SETFD</a></span><span class="op" id="1643307">,</span>&nbsp;<span class="ident" id="1643309"><a href="/syscall/zerrors_linux_amd64.go.html#1716503">FD_CLOEXEC</a></span><span class="op" id="1643319">)</span><span class="op" id="1643320">;</span>&nbsp;<span class="ident" id="1643322"><a href="/syscall/exec_linux.go.html#1643062">err</a></span>&nbsp;<span class="op" id="1643326">!=</span>&nbsp;<span class="ident" id="1643329">nil</span>&nbsp;<span class="op" id="1643333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643338">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1643347">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643351">_</span><span class="op" id="1643352">,</span>&nbsp;<span class="ident" id="1643354"><a href="/syscall/exec_linux.go.html#1643062">err</a></span>&nbsp;<span class="op" id="1643358">=</span>&nbsp;<span class="ident" id="1643360"><a href="/syscall/zsyscall_linux_amd64.go.html#1776566">fcntl</a></span><span class="op" id="1643365">(</span><span class="ident" id="1643366"><a href="/syscall/exec_linux.go.html#1643052">p</a></span><span class="op" id="1643367">[</span><span class="num" id="1643368">1</span><span class="op" id="1643369">]</span><span class="op" id="1643370">,</span>&nbsp;<span class="ident" id="1643372"><a href="/syscall/zerrors_linux_amd64.go.html#1717234">F_SETFD</a></span><span class="op" id="1643379">,</span>&nbsp;<span class="ident" id="1643381"><a href="/syscall/zerrors_linux_amd64.go.html#1716503">FD_CLOEXEC</a></span><span class="op" id="1643391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1643394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643397">return</span><br>
<span class="lineno"></span><span class="op" id="1643404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="1643407">//&nbsp;writeIDMappings&nbsp;writes&nbsp;the&nbsp;user&nbsp;namespace&nbsp;User&nbsp;ID&nbsp;or&nbsp;Group&nbsp;ID&nbsp;mappings&nbsp;to&nbsp;the&nbsp;specified&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="1643504">func</span>&nbsp;<span class="ident" id="1643509">writeIDMappings</span><span class="op" id="1643524">(</span><span class="ident" id="1643525">path</span>&nbsp;<span class="builtintype" id="1643530">string</span><span class="op" id="1643536">,</span>&nbsp;<span class="ident" id="1643538">idMap</span>&nbsp;<span class="op" id="1643544">[</span><span class="op" id="1643545">]</span><span class="ident" id="1643546"><a href="/syscall/exec_linux.go.html#1635273">SysProcIDMap</a></span><span class="op" id="1643558">)</span>&nbsp;<span class="builtintype" id="1643560">error</span>&nbsp;<span class="op" id="1643566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643569">fd</span><span class="op" id="1643571">,</span>&nbsp;<span class="ident" id="1643573">err</span>&nbsp;<span class="op" id="1643577">:=</span>&nbsp;<span class="ident" id="1643580"><a href="/syscall/syscall_linux.go.html#1667939">Open</a></span><span class="op" id="1643584">(</span><span class="ident" id="1643585"><a href="/syscall/exec_linux.go.html#1643525">path</a></span><span class="op" id="1643589">,</span>&nbsp;<span class="ident" id="1643591"><a href="/syscall/zerrors_linux_amd64.go.html#1732936">O_RDWR</a></span><span class="op" id="1643597">,</span>&nbsp;<span class="num" id="1643599">0</span><span class="op" id="1643600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643603">if</span>&nbsp;<span class="ident" id="1643606"><a href="/syscall/exec_linux.go.html#1643573">err</a></span>&nbsp;<span class="op" id="1643610">!=</span>&nbsp;<span class="ident" id="1643613">nil</span>&nbsp;<span class="op" id="1643617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643621">return</span>&nbsp;<span class="ident" id="1643628"><a href="/syscall/exec_linux.go.html#1643573">err</a></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1643633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643637">data</span>&nbsp;<span class="op" id="1643642">:=</span>&nbsp;<span class="string" id="1643645">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643649">for</span>&nbsp;<span class="ident" id="1643653">_</span><span class="op" id="1643654">,</span>&nbsp;<span class="ident" id="1643656">im</span>&nbsp;<span class="op" id="1643659">:=</span>&nbsp;<span class="keyword" id="1643662">range</span>&nbsp;<span class="ident" id="1643668"><a href="/syscall/exec_linux.go.html#1643538">idMap</a></span>&nbsp;<span class="op" id="1643674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643678"><a href="/syscall/exec_linux.go.html#1643637">data</a></span>&nbsp;<span class="op" id="1643683">=</span>&nbsp;<span class="ident" id="1643685"><a href="/syscall/exec_linux.go.html#1643637">data</a></span>&nbsp;<span class="op" id="1643690">+</span>&nbsp;<span class="ident" id="1643692"><a href="/syscall/str.go.html#1663673">itoa</a></span><span class="op" id="1643696">(</span><span class="ident" id="1643697"><a href="/syscall/exec_linux.go.html#1643656">im</a></span><span class="op" id="1643699">.</span><span class="ident" id="1643700">ContainerID</span><span class="op" id="1643711">)</span>&nbsp;<span class="op" id="1643713">+</span>&nbsp;<span class="string" id="1643715">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="1643719">+</span>&nbsp;<span class="ident" id="1643721"><a href="/syscall/str.go.html#1663673">itoa</a></span><span class="op" id="1643725">(</span><span class="ident" id="1643726"><a href="/syscall/exec_linux.go.html#1643656">im</a></span><span class="op" id="1643728">.</span><span class="ident" id="1643729">HostID</span><span class="op" id="1643735">)</span>&nbsp;<span class="op" id="1643737">+</span>&nbsp;<span class="string" id="1643739">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="1643743">+</span>&nbsp;<span class="ident" id="1643745"><a href="/syscall/str.go.html#1663673">itoa</a></span><span class="op" id="1643749">(</span><span class="ident" id="1643750"><a href="/syscall/exec_linux.go.html#1643656">im</a></span><span class="op" id="1643752">.</span><span class="ident" id="1643753">Size</span><span class="op" id="1643757">)</span>&nbsp;<span class="op" id="1643759">+</span>&nbsp;<span class="string" id="1643761">&#34;\n&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1643767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643771">bytes</span><span class="op" id="1643776">,</span>&nbsp;<span class="ident" id="1643778"><a href="/syscall/exec_linux.go.html#1643573">err</a></span>&nbsp;<span class="op" id="1643782">:=</span>&nbsp;<span class="ident" id="1643785"><a href="/syscall/syscall.go.html#1666027">ByteSliceFromString</a></span><span class="op" id="1643804">(</span><span class="ident" id="1643805"><a href="/syscall/exec_linux.go.html#1643637">data</a></span><span class="op" id="1643809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643812">if</span>&nbsp;<span class="ident" id="1643815"><a href="/syscall/exec_linux.go.html#1643573">err</a></span>&nbsp;<span class="op" id="1643819">!=</span>&nbsp;<span class="ident" id="1643822">nil</span>&nbsp;<span class="op" id="1643826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643830"><a href="/syscall/zsyscall_linux_amd64.go.html#1772074">Close</a></span><span class="op" id="1643835">(</span><span class="ident" id="1643836"><a href="/syscall/exec_linux.go.html#1643569">fd</a></span><span class="op" id="1643838">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643842">return</span>&nbsp;<span class="ident" id="1643849"><a href="/syscall/exec_linux.go.html#1643573">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1643854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643858">if</span>&nbsp;<span class="ident" id="1643861">_</span><span class="op" id="1643862">,</span>&nbsp;<span class="ident" id="1643864">err</span>&nbsp;<span class="op" id="1643868">:=</span>&nbsp;<span class="ident" id="1643871"><a href="/syscall/syscall_unix.go.html#1702072">Write</a></span><span class="op" id="1643876">(</span><span class="ident" id="1643877"><a href="/syscall/exec_linux.go.html#1643569">fd</a></span><span class="op" id="1643879">,</span>&nbsp;<span class="ident" id="1643881"><a href="/syscall/exec_linux.go.html#1643771">bytes</a></span><span class="op" id="1643886">)</span><span class="op" id="1643887">;</span>&nbsp;<span class="ident" id="1643889"><a href="/syscall/exec_linux.go.html#1643864">err</a></span>&nbsp;<span class="op" id="1643893">!=</span>&nbsp;<span class="ident" id="1643896">nil</span>&nbsp;<span class="op" id="1643900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643904"><a href="/syscall/zsyscall_linux_amd64.go.html#1772074">Close</a></span><span class="op" id="1643909">(</span><span class="ident" id="1643910"><a href="/syscall/exec_linux.go.html#1643569">fd</a></span><span class="op" id="1643912">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643916">return</span>&nbsp;<span class="ident" id="1643923"><a href="/syscall/exec_linux.go.html#1643864">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1643928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643932">if</span>&nbsp;<span class="ident" id="1643935">err</span>&nbsp;<span class="op" id="1643939">:=</span>&nbsp;<span class="ident" id="1643942"><a href="/syscall/zsyscall_linux_amd64.go.html#1772074">Close</a></span><span class="op" id="1643947">(</span><span class="ident" id="1643948"><a href="/syscall/exec_linux.go.html#1643569">fd</a></span><span class="op" id="1643950">)</span><span class="op" id="1643951">;</span>&nbsp;<span class="ident" id="1643953"><a href="/syscall/exec_linux.go.html#1643935">err</a></span>&nbsp;<span class="op" id="1643957">!=</span>&nbsp;<span class="ident" id="1643960">nil</span>&nbsp;<span class="op" id="1643964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643968">return</span>&nbsp;<span class="ident" id="1643975"><a href="/syscall/exec_linux.go.html#1643935">err</a></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1643980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643984">return</span>&nbsp;<span class="ident" id="1643991">nil</span><br>
<span class="lineno"></span><span class="op" id="1643995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="1643998">//&nbsp;writeUidGidMappings&nbsp;writes&nbsp;User&nbsp;ID&nbsp;and&nbsp;Group&nbsp;ID&nbsp;mappings&nbsp;for&nbsp;user&nbsp;namespaces</span><br>
<span class="lineno"></span><span class="comment" id="1644078">//&nbsp;for&nbsp;a&nbsp;process&nbsp;and&nbsp;it&nbsp;is&nbsp;called&nbsp;from&nbsp;the&nbsp;parent&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="1644137">func</span>&nbsp;<span class="ident" id="1644142">writeUidGidMappings</span><span class="op" id="1644161">(</span><span class="ident" id="1644162">pid</span>&nbsp;<span class="builtintype" id="1644166">int</span><span class="op" id="1644169">,</span>&nbsp;<span class="ident" id="1644171">sys</span>&nbsp;<span class="op" id="1644175">*</span><span class="ident" id="1644176"><a href="/syscall/exec_linux.go.html#1635392">SysProcAttr</a></span><span class="op" id="1644187">)</span>&nbsp;<span class="builtintype" id="1644189">error</span>&nbsp;<span class="op" id="1644195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644198">if</span>&nbsp;<span class="ident" id="1644201"><a href="/syscall/exec_linux.go.html#1644171">sys</a></span><span class="op" id="1644204">.</span><span class="ident" id="1644205">UidMappings</span>&nbsp;<span class="op" id="1644217">!=</span>&nbsp;<span class="ident" id="1644220">nil</span>&nbsp;<span class="op" id="1644224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1644228">uidf</span>&nbsp;<span class="op" id="1644233">:=</span>&nbsp;<span class="string" id="1644236">&#34;/proc/&#34;</span>&nbsp;<span class="op" id="1644245">+</span>&nbsp;<span class="ident" id="1644247"><a href="/syscall/str.go.html#1663673">itoa</a></span><span class="op" id="1644251">(</span><span class="ident" id="1644252"><a href="/syscall/exec_linux.go.html#1644162">pid</a></span><span class="op" id="1644255">)</span>&nbsp;<span class="op" id="1644257">+</span>&nbsp;<span class="string" id="1644259">&#34;/uid_map&#34;</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644272">if</span>&nbsp;<span class="ident" id="1644275">err</span>&nbsp;<span class="op" id="1644279">:=</span>&nbsp;<span class="ident" id="1644282"><a href="/syscall/exec_linux.go.html#1643509">writeIDMappings</a></span><span class="op" id="1644297">(</span><span class="ident" id="1644298"><a href="/syscall/exec_linux.go.html#1644228">uidf</a></span><span class="op" id="1644302">,</span>&nbsp;<span class="ident" id="1644304"><a href="/syscall/exec_linux.go.html#1644171">sys</a></span><span class="op" id="1644307">.</span><span class="ident" id="1644308">UidMappings</span><span class="op" id="1644319">)</span><span class="op" id="1644320">;</span>&nbsp;<span class="ident" id="1644322"><a href="/syscall/exec_linux.go.html#1644275">err</a></span>&nbsp;<span class="op" id="1644326">!=</span>&nbsp;<span class="ident" id="1644329">nil</span>&nbsp;<span class="op" id="1644333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644338">return</span>&nbsp;<span class="ident" id="1644345"><a href="/syscall/exec_linux.go.html#1644275">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1644351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1644354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644358">if</span>&nbsp;<span class="ident" id="1644361"><a href="/syscall/exec_linux.go.html#1644171">sys</a></span><span class="op" id="1644364">.</span><span class="ident" id="1644365">GidMappings</span>&nbsp;<span class="op" id="1644377">!=</span>&nbsp;<span class="ident" id="1644380">nil</span>&nbsp;<span class="op" id="1644384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1644388">gidf</span>&nbsp;<span class="op" id="1644393">:=</span>&nbsp;<span class="string" id="1644396">&#34;/proc/&#34;</span>&nbsp;<span class="op" id="1644405">+</span>&nbsp;<span class="ident" id="1644407"><a href="/syscall/str.go.html#1663673">itoa</a></span><span class="op" id="1644411">(</span><span class="ident" id="1644412"><a href="/syscall/exec_linux.go.html#1644162">pid</a></span><span class="op" id="1644415">)</span>&nbsp;<span class="op" id="1644417">+</span>&nbsp;<span class="string" id="1644419">&#34;/gid_map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644432">if</span>&nbsp;<span class="ident" id="1644435">err</span>&nbsp;<span class="op" id="1644439">:=</span>&nbsp;<span class="ident" id="1644442"><a href="/syscall/exec_linux.go.html#1643509">writeIDMappings</a></span><span class="op" id="1644457">(</span><span class="ident" id="1644458"><a href="/syscall/exec_linux.go.html#1644388">gidf</a></span><span class="op" id="1644462">,</span>&nbsp;<span class="ident" id="1644464"><a href="/syscall/exec_linux.go.html#1644171">sys</a></span><span class="op" id="1644467">.</span><span class="ident" id="1644468">GidMappings</span><span class="op" id="1644479">)</span><span class="op" id="1644480">;</span>&nbsp;<span class="ident" id="1644482"><a href="/syscall/exec_linux.go.html#1644435">err</a></span>&nbsp;<span class="op" id="1644486">!=</span>&nbsp;<span class="ident" id="1644489">nil</span>&nbsp;<span class="op" id="1644493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644498">return</span>&nbsp;<span class="ident" id="1644505"><a href="/syscall/exec_linux.go.html#1644435">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1644511">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1644514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644518">return</span>&nbsp;<span class="ident" id="1644525">nil</span><br>
<span class="lineno"></span><span class="op" id="1644529">}</span>
</div>
</body>
</html>
