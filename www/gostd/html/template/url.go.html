<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html" class="current">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5118853">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5118908">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5118962">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5119013">package</span>&nbsp;<span class="ident" id="5119021">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5119031">import</span>&nbsp;<span class="op" id="5119038">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5119041">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5119050">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5119057">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5119067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5119070">//&nbsp;urlFilter&nbsp;returns&nbsp;its&nbsp;input&nbsp;unless&nbsp;it&nbsp;contains&nbsp;an&nbsp;unsafe&nbsp;protocol&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5119148">//&nbsp;case&nbsp;it&nbsp;defangs&nbsp;the&nbsp;entire&nbsp;URL.</span><br>
<span class="lineno">15</span><span class="keyword" id="5119183">func</span>&nbsp;<span class="ident" id="5119188">urlFilter</span><span class="op" id="5119197">(</span><span class="ident" id="5119198">args</span>&nbsp;<span class="op" id="5119203">...</span><span class="keyword" id="5119206">interface</span><span class="op" id="5119215">{</span><span class="op" id="5119216">}</span><span class="op" id="5119217">)</span>&nbsp;<span class="builtintype" id="5119219">string</span>&nbsp;<span class="op" id="5119226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119229">s</span><span class="op" id="5119230">,</span>&nbsp;<span class="ident" id="5119232">t</span>&nbsp;<span class="op" id="5119234">:=</span>&nbsp;<span class="ident" id="5119237">stringify</span><span class="op" id="5119246">(</span><span class="ident" id="5119247">args</span><span class="op" id="5119251">...</span><span class="op" id="5119254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119257">if</span>&nbsp;<span class="ident" id="5119260">t</span>&nbsp;<span class="op" id="5119262">==</span>&nbsp;<span class="ident" id="5119265">contentTypeURL</span>&nbsp;<span class="op" id="5119280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119284">return</span>&nbsp;<span class="ident" id="5119291">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119294">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119297">if</span>&nbsp;<span class="ident" id="5119300">i</span>&nbsp;<span class="op" id="5119302">:=</span>&nbsp;<span class="ident" id="5119305">strings</span><span class="op" id="5119312">.</span><span class="ident" id="5119313">IndexRune</span><span class="op" id="5119322">(</span><span class="ident" id="5119323">s</span><span class="op" id="5119324">,</span>&nbsp;<span class="string" id="5119326">&#39;:&#39;</span><span class="op" id="5119329">)</span><span class="op" id="5119330">;</span>&nbsp;<span class="ident" id="5119332">i</span>&nbsp;<span class="op" id="5119334">&gt;=</span>&nbsp;<span class="num" id="5119337">0</span>&nbsp;<span class="op" id="5119339">&amp;&amp;</span>&nbsp;<span class="ident" id="5119342">strings</span><span class="op" id="5119349">.</span><span class="ident" id="5119350">IndexRune</span><span class="op" id="5119359">(</span><span class="ident" id="5119360">s</span><span class="op" id="5119361">[</span><span class="op" id="5119362">:</span><span class="ident" id="5119363">i</span><span class="op" id="5119364">]</span><span class="op" id="5119365">,</span>&nbsp;<span class="string" id="5119367">&#39;/&#39;</span><span class="op" id="5119370">)</span>&nbsp;<span class="op" id="5119372">&lt;</span>&nbsp;<span class="num" id="5119374">0</span>&nbsp;<span class="op" id="5119376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5119380">protocol</span>&nbsp;<span class="op" id="5119389">:=</span>&nbsp;<span class="ident" id="5119392">strings</span><span class="op" id="5119399">.</span><span class="ident" id="5119400">ToLower</span><span class="op" id="5119407">(</span><span class="ident" id="5119408">s</span><span class="op" id="5119409">[</span><span class="op" id="5119410">:</span><span class="ident" id="5119411">i</span><span class="op" id="5119412">]</span><span class="op" id="5119413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119417">if</span>&nbsp;<span class="ident" id="5119420">protocol</span>&nbsp;<span class="op" id="5119429">!=</span>&nbsp;<span class="string" id="5119432">&#34;http&#34;</span>&nbsp;<span class="op" id="5119439">&amp;&amp;</span>&nbsp;<span class="ident" id="5119442">protocol</span>&nbsp;<span class="op" id="5119451">!=</span>&nbsp;<span class="string" id="5119454">&#34;https&#34;</span>&nbsp;<span class="op" id="5119462">&amp;&amp;</span>&nbsp;<span class="ident" id="5119465">protocol</span>&nbsp;<span class="op" id="5119474">!=</span>&nbsp;<span class="string" id="5119477">&#34;mailto&#34;</span>&nbsp;<span class="op" id="5119486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119491">return</span>&nbsp;<span class="string" id="5119498">&#34;#&#34;</span>&nbsp;<span class="op" id="5119502">+</span>&nbsp;<span class="ident" id="5119504">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119521">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5119524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119527">return</span>&nbsp;<span class="ident" id="5119534">s</span><br>
<span class="lineno"></span><span class="op" id="5119536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5119539">//&nbsp;urlEscaper&nbsp;produces&nbsp;an&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno">30</span><span class="comment" id="5119609">//&nbsp;The&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;without&nbsp;further&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="keyword" id="5119686">func</span>&nbsp;<span class="ident" id="5119691">urlEscaper</span><span class="op" id="5119701">(</span><span class="ident" id="5119702">args</span>&nbsp;<span class="op" id="5119707">...</span><span class="keyword" id="5119710">interface</span><span class="op" id="5119719">{</span><span class="op" id="5119720">}</span><span class="op" id="5119721">)</span>&nbsp;<span class="builtintype" id="5119723">string</span>&nbsp;<span class="op" id="5119730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5119733">return</span>&nbsp;<span class="ident" id="5119740">urlProcessor</span><span class="op" id="5119752">(</span><span class="builtintype" id="5119753">false</span><span class="op" id="5119758">,</span>&nbsp;<span class="ident" id="5119760">args</span><span class="op" id="5119764">...</span><span class="op" id="5119767">)</span><br>
<span class="lineno"></span><span class="op" id="5119769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5119772">//&nbsp;urlEscaper&nbsp;normalizes&nbsp;URL&nbsp;content&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;quote-delimited</span><br>
<span class="lineno"></span><span class="comment" id="5119852">//&nbsp;string&nbsp;or&nbsp;parenthesis&nbsp;delimited&nbsp;url(...).</span><br>
<span class="lineno"></span><span class="comment" id="5119897">//&nbsp;The&nbsp;normalizer&nbsp;does&nbsp;not&nbsp;encode&nbsp;all&nbsp;HTML&nbsp;specials.&nbsp;Specifically,&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5119976">//&nbsp;encode&nbsp;&#39;&amp;&#39;&nbsp;so&nbsp;correct&nbsp;embedding&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;requires&nbsp;escaping&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5120053">//&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;&#39;&amp;amp;&#39;.</span><br>
<span class="lineno">40</span><span class="keyword" id="5120072">func</span>&nbsp;<span class="ident" id="5120077">urlNormalizer</span><span class="op" id="5120090">(</span><span class="ident" id="5120091">args</span>&nbsp;<span class="op" id="5120096">...</span><span class="keyword" id="5120099">interface</span><span class="op" id="5120108">{</span><span class="op" id="5120109">}</span><span class="op" id="5120110">)</span>&nbsp;<span class="builtintype" id="5120112">string</span>&nbsp;<span class="op" id="5120119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120122">return</span>&nbsp;<span class="ident" id="5120129">urlProcessor</span><span class="op" id="5120141">(</span><span class="builtintype" id="5120142">true</span><span class="op" id="5120146">,</span>&nbsp;<span class="ident" id="5120148">args</span><span class="op" id="5120152">...</span><span class="op" id="5120155">)</span><br>
<span class="lineno"></span><span class="op" id="5120157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5120160">//&nbsp;urlProcessor&nbsp;normalizes&nbsp;(when&nbsp;norm&nbsp;is&nbsp;true)&nbsp;or&nbsp;escapes&nbsp;its&nbsp;input&nbsp;to&nbsp;produce</span><br>
<span class="lineno">45</span><span class="comment" id="5120239">//&nbsp;a&nbsp;valid&nbsp;hierarchical&nbsp;or&nbsp;opaque&nbsp;URL&nbsp;part.</span><br>
<span class="lineno"></span><span class="keyword" id="5120283">func</span>&nbsp;<span class="ident" id="5120288">urlProcessor</span><span class="op" id="5120300">(</span><span class="ident" id="5120301">norm</span>&nbsp;<span class="builtintype" id="5120306">bool</span><span class="op" id="5120310">,</span>&nbsp;<span class="ident" id="5120312">args</span>&nbsp;<span class="op" id="5120317">...</span><span class="keyword" id="5120320">interface</span><span class="op" id="5120329">{</span><span class="op" id="5120330">}</span><span class="op" id="5120331">)</span>&nbsp;<span class="builtintype" id="5120333">string</span>&nbsp;<span class="op" id="5120340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120343">s</span><span class="op" id="5120344">,</span>&nbsp;<span class="ident" id="5120346">t</span>&nbsp;<span class="op" id="5120348">:=</span>&nbsp;<span class="ident" id="5120351">stringify</span><span class="op" id="5120360">(</span><span class="ident" id="5120361">args</span><span class="op" id="5120365">...</span><span class="op" id="5120368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120371">if</span>&nbsp;<span class="ident" id="5120374">t</span>&nbsp;<span class="op" id="5120376">==</span>&nbsp;<span class="ident" id="5120379">contentTypeURL</span>&nbsp;<span class="op" id="5120394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120398">norm</span>&nbsp;<span class="op" id="5120403">=</span>&nbsp;<span class="builtintype" id="5120405">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5120411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120414">var</span>&nbsp;<span class="ident" id="5120418">b</span>&nbsp;<span class="ident" id="5120420">bytes</span><span class="op" id="5120425">.</span><span class="ident" id="5120426">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120434">written</span>&nbsp;<span class="op" id="5120442">:=</span>&nbsp;<span class="num" id="5120445">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120448">//&nbsp;The&nbsp;byte&nbsp;loop&nbsp;below&nbsp;assumes&nbsp;that&nbsp;all&nbsp;URLs&nbsp;use&nbsp;UTF-8&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120511">//&nbsp;content-encoding.&nbsp;This&nbsp;is&nbsp;similar&nbsp;to&nbsp;the&nbsp;URI&nbsp;to&nbsp;IRI&nbsp;encoding&nbsp;scheme</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120583">//&nbsp;defined&nbsp;in&nbsp;section&nbsp;3.1&nbsp;of&nbsp;&nbsp;RFC&nbsp;3987,&nbsp;and&nbsp;behaves&nbsp;the&nbsp;same&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120652">//&nbsp;EcmaScript&nbsp;builtin&nbsp;encodeURIComponent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120695">//&nbsp;It&nbsp;should&nbsp;not&nbsp;cause&nbsp;any&nbsp;misencoding&nbsp;of&nbsp;URLs&nbsp;in&nbsp;pages&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120757">//&nbsp;Content-type:&nbsp;text/html;charset=UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120800">for</span>&nbsp;<span class="ident" id="5120804">i</span><span class="op" id="5120805">,</span>&nbsp;<span class="ident" id="5120807">n</span>&nbsp;<span class="op" id="5120809">:=</span>&nbsp;<span class="num" id="5120812">0</span><span class="op" id="5120813">,</span>&nbsp;<span class="builtinfunc" id="5120815">len</span><span class="op" id="5120818">(</span><span class="ident" id="5120819">s</span><span class="op" id="5120820">)</span><span class="op" id="5120821">;</span>&nbsp;<span class="ident" id="5120823">i</span>&nbsp;<span class="op" id="5120825">&lt;</span>&nbsp;<span class="ident" id="5120827">n</span><span class="op" id="5120828">;</span>&nbsp;<span class="ident" id="5120830">i</span><span class="op" id="5120831">++</span>&nbsp;<span class="op" id="5120834">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5120838">c</span>&nbsp;<span class="op" id="5120840">:=</span>&nbsp;<span class="ident" id="5120843">s</span><span class="op" id="5120844">[</span><span class="ident" id="5120845">i</span><span class="op" id="5120846">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5120850">switch</span>&nbsp;<span class="ident" id="5120857">c</span>&nbsp;<span class="op" id="5120859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120863">//&nbsp;Single&nbsp;quote&nbsp;and&nbsp;parens&nbsp;are&nbsp;sub-delims&nbsp;in&nbsp;RFC&nbsp;3986,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120927">//&nbsp;escape&nbsp;them&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5120984">//&nbsp;quoted&nbsp;attributes&nbsp;and&nbsp;unquoted&nbsp;CSS&nbsp;url(...)&nbsp;constructs.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121045">//&nbsp;Single&nbsp;quotes&nbsp;are&nbsp;reserved&nbsp;in&nbsp;URLs,&nbsp;but&nbsp;are&nbsp;only&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121107">//&nbsp;the&nbsp;obsolete&nbsp;&#34;mark&#34;&nbsp;rule&nbsp;in&nbsp;an&nbsp;appendix&nbsp;in&nbsp;RFC&nbsp;3986</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121164">//&nbsp;so&nbsp;can&nbsp;be&nbsp;safely&nbsp;encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121195">case</span>&nbsp;<span class="string" id="5121200">&#39;!&#39;</span><span class="op" id="5121203">,</span>&nbsp;<span class="string" id="5121205">&#39;#&#39;</span><span class="op" id="5121208">,</span>&nbsp;<span class="string" id="5121210">&#39;$&#39;</span><span class="op" id="5121213">,</span>&nbsp;<span class="string" id="5121215">&#39;&amp;&#39;</span><span class="op" id="5121218">,</span>&nbsp;<span class="string" id="5121220">&#39;*&#39;</span><span class="op" id="5121223">,</span>&nbsp;<span class="string" id="5121225">&#39;+&#39;</span><span class="op" id="5121228">,</span>&nbsp;<span class="string" id="5121230">&#39;,&#39;</span><span class="op" id="5121233">,</span>&nbsp;<span class="string" id="5121235">&#39;/&#39;</span><span class="op" id="5121238">,</span>&nbsp;<span class="string" id="5121240">&#39;:&#39;</span><span class="op" id="5121243">,</span>&nbsp;<span class="string" id="5121245">&#39;;&#39;</span><span class="op" id="5121248">,</span>&nbsp;<span class="string" id="5121250">&#39;=&#39;</span><span class="op" id="5121253">,</span>&nbsp;<span class="string" id="5121255">&#39;?&#39;</span><span class="op" id="5121258">,</span>&nbsp;<span class="string" id="5121260">&#39;@&#39;</span><span class="op" id="5121263">,</span>&nbsp;<span class="string" id="5121265">&#39;[&#39;</span><span class="op" id="5121268">,</span>&nbsp;<span class="string" id="5121270">&#39;]&#39;</span><span class="op" id="5121273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121278">if</span>&nbsp;<span class="ident" id="5121281">norm</span>&nbsp;<span class="op" id="5121286">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121292">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121308">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121354">//&nbsp;&#34;For&nbsp;consistency,&nbsp;percent-encoded&nbsp;octets&nbsp;in&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121417">//&nbsp;ALPHA&nbsp;(%41-%5A&nbsp;and&nbsp;%61-%7A),&nbsp;DIGIT&nbsp;(%30-%39),&nbsp;hyphen&nbsp;(%2D),</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121482">//&nbsp;period&nbsp;(%2E),&nbsp;underscore&nbsp;(%5F),&nbsp;or&nbsp;tilde&nbsp;(%7E)&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121548">//&nbsp;created&nbsp;by&nbsp;URI&nbsp;producers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121578">case</span>&nbsp;<span class="string" id="5121583">&#39;-&#39;</span><span class="op" id="5121586">,</span>&nbsp;<span class="string" id="5121588">&#39;.&#39;</span><span class="op" id="5121591">,</span>&nbsp;<span class="string" id="5121593">&#39;_&#39;</span><span class="op" id="5121596">,</span>&nbsp;<span class="string" id="5121598">&#39;~&#39;</span><span class="op" id="5121601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121606">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121617">case</span>&nbsp;<span class="string" id="5121622">&#39;%&#39;</span><span class="op" id="5121625">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121630">//&nbsp;When&nbsp;normalizing&nbsp;do&nbsp;not&nbsp;re-encode&nbsp;valid&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121685">if</span>&nbsp;<span class="ident" id="5121688">norm</span>&nbsp;<span class="op" id="5121693">&amp;&amp;</span>&nbsp;<span class="ident" id="5121696">i</span><span class="op" id="5121697">+</span><span class="num" id="5121698">2</span>&nbsp;<span class="op" id="5121700">&lt;</span>&nbsp;<span class="builtinfunc" id="5121702">len</span><span class="op" id="5121705">(</span><span class="ident" id="5121706">s</span><span class="op" id="5121707">)</span>&nbsp;<span class="op" id="5121709">&amp;&amp;</span>&nbsp;<span class="ident" id="5121712">isHex</span><span class="op" id="5121717">(</span><span class="ident" id="5121718">s</span><span class="op" id="5121719">[</span><span class="ident" id="5121720">i</span><span class="op" id="5121721">+</span><span class="num" id="5121722">1</span><span class="op" id="5121723">]</span><span class="op" id="5121724">)</span>&nbsp;<span class="op" id="5121726">&amp;&amp;</span>&nbsp;<span class="ident" id="5121729">isHex</span><span class="op" id="5121734">(</span><span class="ident" id="5121735">s</span><span class="op" id="5121736">[</span><span class="ident" id="5121737">i</span><span class="op" id="5121738">+</span><span class="num" id="5121739">2</span><span class="op" id="5121740">]</span><span class="op" id="5121741">)</span>&nbsp;<span class="op" id="5121743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121749">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121765">default</span><span class="op" id="5121772">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5121777">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121824">if</span>&nbsp;<span class="string" id="5121827">&#39;a&#39;</span>&nbsp;<span class="op" id="5121831">&lt;=</span>&nbsp;<span class="ident" id="5121834">c</span>&nbsp;<span class="op" id="5121836">&amp;&amp;</span>&nbsp;<span class="ident" id="5121839">c</span>&nbsp;<span class="op" id="5121841">&lt;=</span>&nbsp;<span class="string" id="5121844">&#39;z&#39;</span>&nbsp;<span class="op" id="5121848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121854">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121871">if</span>&nbsp;<span class="string" id="5121874">&#39;A&#39;</span>&nbsp;<span class="op" id="5121878">&lt;=</span>&nbsp;<span class="ident" id="5121881">c</span>&nbsp;<span class="op" id="5121883">&amp;&amp;</span>&nbsp;<span class="ident" id="5121886">c</span>&nbsp;<span class="op" id="5121888">&lt;=</span>&nbsp;<span class="string" id="5121891">&#39;Z&#39;</span>&nbsp;<span class="op" id="5121895">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121901">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121918">if</span>&nbsp;<span class="string" id="5121921">&#39;0&#39;</span>&nbsp;<span class="op" id="5121925">&lt;=</span>&nbsp;<span class="ident" id="5121928">c</span>&nbsp;<span class="op" id="5121930">&amp;&amp;</span>&nbsp;<span class="ident" id="5121933">c</span>&nbsp;<span class="op" id="5121935">&lt;=</span>&nbsp;<span class="string" id="5121938">&#39;9&#39;</span>&nbsp;<span class="op" id="5121942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5121948">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121960">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5121964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121968">b</span><span class="op" id="5121969">.</span><span class="ident" id="5121970">WriteString</span><span class="op" id="5121981">(</span><span class="ident" id="5121982">s</span><span class="op" id="5121983">[</span><span class="ident" id="5121984">written</span><span class="op" id="5121991">:</span><span class="ident" id="5121992">i</span><span class="op" id="5121993">]</span><span class="op" id="5121994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5121998">fmt</span><span class="op" id="5122001">.</span><span class="ident" id="5122002">Fprintf</span><span class="op" id="5122009">(</span><span class="op" id="5122010">&amp;</span><span class="ident" id="5122011">b</span><span class="op" id="5122012">,</span>&nbsp;<span class="string" id="5122014">&#34;%%%02x&#34;</span><span class="op" id="5122022">,</span>&nbsp;<span class="ident" id="5122024">c</span><span class="op" id="5122025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122029">written</span>&nbsp;<span class="op" id="5122037">=</span>&nbsp;<span class="ident" id="5122039">i</span>&nbsp;<span class="op" id="5122041">+</span>&nbsp;<span class="num" id="5122043">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122046">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122049">if</span>&nbsp;<span class="ident" id="5122052">written</span>&nbsp;<span class="op" id="5122060">==</span>&nbsp;<span class="num" id="5122063">0</span>&nbsp;<span class="op" id="5122065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122069">return</span>&nbsp;<span class="ident" id="5122076">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5122079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5122082">b</span><span class="op" id="5122083">.</span><span class="ident" id="5122084">WriteString</span><span class="op" id="5122095">(</span><span class="ident" id="5122096">s</span><span class="op" id="5122097">[</span><span class="ident" id="5122098">written</span><span class="op" id="5122105">:</span><span class="op" id="5122106">]</span><span class="op" id="5122107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5122110">return</span>&nbsp;<span class="ident" id="5122117">b</span><span class="op" id="5122118">.</span><span class="ident" id="5122119">String</span><span class="op" id="5122125">(</span><span class="op" id="5122126">)</span><br>
<span class="lineno">105</span><span class="op" id="5122128">}</span>
</div>
</body>
</html>
