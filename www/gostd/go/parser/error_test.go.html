<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6662829">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6662884">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6662938">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6662989">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;parser&nbsp;test&nbsp;harness.&nbsp;The&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata</span><br>
<span class="lineno"></span><span class="comment" id="6663062">//&nbsp;directory&nbsp;are&nbsp;parsed&nbsp;and&nbsp;the&nbsp;errors&nbsp;reported&nbsp;are&nbsp;compared&nbsp;against&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6663135">//&nbsp;error&nbsp;messages&nbsp;expected&nbsp;in&nbsp;the&nbsp;test&nbsp;files.&nbsp;The&nbsp;test&nbsp;files&nbsp;must&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6663208">//&nbsp;.src&nbsp;rather&nbsp;than&nbsp;.go&nbsp;so&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;disturbed&nbsp;by&nbsp;gofmt&nbsp;runs.</span><br>
<span class="lineno"></span><span class="comment" id="6663278">//</span><br>
<span class="lineno">10</span><span class="comment" id="6663281">//&nbsp;Expected&nbsp;errors&nbsp;are&nbsp;indicated&nbsp;in&nbsp;the&nbsp;test&nbsp;files&nbsp;by&nbsp;putting&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="6663353">//&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;immediately&nbsp;following&nbsp;an&nbsp;offending&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="6663427">//&nbsp;The&nbsp;harness&nbsp;will&nbsp;verify&nbsp;that&nbsp;an&nbsp;error&nbsp;matching&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="6663500">//&nbsp;rx&nbsp;is&nbsp;reported&nbsp;at&nbsp;that&nbsp;source&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="6663543">//</span><br>
<span class="lineno">15</span><span class="comment" id="6663546">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;following&nbsp;test&nbsp;file&nbsp;indicates&nbsp;that&nbsp;a&nbsp;&#34;not&nbsp;declared&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6663619">//&nbsp;error&nbsp;should&nbsp;be&nbsp;reported&nbsp;for&nbsp;the&nbsp;undeclared&nbsp;variable&nbsp;x:</span><br>
<span class="lineno"></span><span class="comment" id="6663678">//</span><br>
<span class="lineno"></span><span class="comment" id="6663681">//&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="6663694">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;f()&nbsp;{</span><br>
<span class="lineno">20</span><span class="comment" id="6663708">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp_&nbsp;=&nbsp;x&nbsp;/*&nbsp;ERROR&nbsp;&#34;not&nbsp;declared&#34;&nbsp;*/&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="6663749">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6663755">package</span>&nbsp;<span class="ident" id="6663763">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6663771">import</span>&nbsp;<span class="op" id="6663778">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6663781">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6663795">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6663807">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6663820">&#34;path/filepath&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6663837">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6663847">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6663858">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6663868">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="6663871">const</span>&nbsp;<span class="ident" id="6663877">testdata</span>&nbsp;<span class="op" id="6663886">=</span>&nbsp;<span class="string" id="6663888">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6663900">var</span>&nbsp;<span class="ident" id="6663904">fsetErrs</span>&nbsp;<span class="op" id="6663913">=</span>&nbsp;<span class="ident" id="6663915">token</span><span class="op" id="6663920">.</span><span class="ident" id="6663921">NewFileSet</span><span class="op" id="6663931">(</span><span class="op" id="6663932">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6663935">//&nbsp;getFile&nbsp;assumes&nbsp;that&nbsp;each&nbsp;filename&nbsp;occurs&nbsp;at&nbsp;most&nbsp;once</span><br>
<span class="lineno">40</span><span class="keyword" id="6663993">func</span>&nbsp;<span class="ident" id="6663998">getFile</span><span class="op" id="6664005">(</span><span class="ident" id="6664006">filename</span>&nbsp;<span class="builtintype" id="6664015">string</span><span class="op" id="6664021">)</span>&nbsp;<span class="op" id="6664023">(</span><span class="ident" id="6664024">file</span>&nbsp;<span class="op" id="6664029">*</span><span class="ident" id="6664030">token</span><span class="op" id="6664035">.</span><span class="ident" id="6664036">File</span><span class="op" id="6664040">)</span>&nbsp;<span class="op" id="6664042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664045">fsetErrs</span><span class="op" id="6664053">.</span><span class="ident" id="6664054">Iterate</span><span class="op" id="6664061">(</span><span class="keyword" id="6664062">func</span><span class="op" id="6664066">(</span><span class="ident" id="6664067">f</span>&nbsp;<span class="op" id="6664069">*</span><span class="ident" id="6664070">token</span><span class="op" id="6664075">.</span><span class="ident" id="6664076">File</span><span class="op" id="6664080">)</span>&nbsp;<span class="builtintype" id="6664082">bool</span>&nbsp;<span class="op" id="6664087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664091">if</span>&nbsp;<span class="ident" id="6664094">f</span><span class="op" id="6664095">.</span><span class="ident" id="6664096">Name</span><span class="op" id="6664100">(</span><span class="op" id="6664101">)</span>&nbsp;<span class="op" id="6664103">==</span>&nbsp;<span class="ident" id="6664106">filename</span>&nbsp;<span class="op" id="6664115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664120">if</span>&nbsp;<span class="ident" id="6664123">file</span>&nbsp;<span class="op" id="6664128">!=</span>&nbsp;<span class="ident" id="6664131">nil</span>&nbsp;<span class="op" id="6664135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6664141">panic</span><span class="op" id="6664146">(</span><span class="ident" id="6664147">filename</span>&nbsp;<span class="op" id="6664156">+</span>&nbsp;<span class="string" id="6664158">&#34;&nbsp;used&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="6664180">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6664185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664190">file</span>&nbsp;<span class="op" id="6664195">=</span>&nbsp;<span class="ident" id="6664197">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6664201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664205">return</span>&nbsp;<span class="builtintype" id="6664212">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6664218">}</span><span class="op" id="6664219">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664222">return</span>&nbsp;<span class="ident" id="6664229">file</span><br>
<span class="lineno"></span><span class="op" id="6664234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6664237">func</span>&nbsp;<span class="ident" id="6664242">getPos</span><span class="op" id="6664248">(</span><span class="ident" id="6664249">filename</span>&nbsp;<span class="builtintype" id="6664258">string</span><span class="op" id="6664264">,</span>&nbsp;<span class="ident" id="6664266">offset</span>&nbsp;<span class="builtintype" id="6664273">int</span><span class="op" id="6664276">)</span>&nbsp;<span class="ident" id="6664278">token</span><span class="op" id="6664283">.</span><span class="ident" id="6664284">Pos</span>&nbsp;<span class="op" id="6664288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664291">if</span>&nbsp;<span class="ident" id="6664294">f</span>&nbsp;<span class="op" id="6664296">:=</span>&nbsp;<span class="ident" id="6664299">getFile</span><span class="op" id="6664306">(</span><span class="ident" id="6664307">filename</span><span class="op" id="6664315">)</span><span class="op" id="6664316">;</span>&nbsp;<span class="ident" id="6664318">f</span>&nbsp;<span class="op" id="6664320">!=</span>&nbsp;<span class="ident" id="6664323">nil</span>&nbsp;<span class="op" id="6664327">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664331">return</span>&nbsp;<span class="ident" id="6664338">f</span><span class="op" id="6664339">.</span><span class="ident" id="6664340">Pos</span><span class="op" id="6664343">(</span><span class="ident" id="6664344">offset</span><span class="op" id="6664350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6664353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664356">return</span>&nbsp;<span class="ident" id="6664363">token</span><span class="op" id="6664368">.</span><span class="ident" id="6664369">NoPos</span><br>
<span class="lineno"></span><span class="op" id="6664375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6664378">//&nbsp;ERROR&nbsp;comments&nbsp;must&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;and&nbsp;rx&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6664443">//&nbsp;a&nbsp;regular&nbsp;expression&nbsp;that&nbsp;matches&nbsp;the&nbsp;expected&nbsp;error&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="6664508">//&nbsp;The&nbsp;special&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;HERE&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;must&nbsp;be&nbsp;used&nbsp;for&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="6664573">//&nbsp;messages&nbsp;that&nbsp;appear&nbsp;immediately&nbsp;after&nbsp;a&nbsp;token,&nbsp;rather&nbsp;than&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="6664639">//&nbsp;a&nbsp;token&#39;s&nbsp;position.</span><br>
<span class="lineno">65</span><span class="comment" id="6664662">//</span><br>
<span class="lineno"></span><span class="keyword" id="6664665">var</span>&nbsp;<span class="ident" id="6664669">errRx</span>&nbsp;<span class="op" id="6664675">=</span>&nbsp;<span class="ident" id="6664677">regexp</span><span class="op" id="6664683">.</span><span class="ident" id="6664684">MustCompile</span><span class="op" id="6664695">(</span><span class="string" id="6664696">`^/\*&nbsp;*ERROR&nbsp;*(HERE)?&nbsp;*&#34;([^&#34;]*)&#34;&nbsp;*\*/$`</span><span class="op" id="6664735">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6664738">//&nbsp;expectedErrors&nbsp;collects&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;of&nbsp;ERROR&nbsp;comments&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="6664813">//&nbsp;in&nbsp;files&nbsp;and&nbsp;returns&nbsp;them&nbsp;as&nbsp;a&nbsp;map&nbsp;of&nbsp;error&nbsp;positions&nbsp;to&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">70</span><span class="comment" id="6664889">//</span><br>
<span class="lineno"></span><span class="keyword" id="6664892">func</span>&nbsp;<span class="ident" id="6664897">expectedErrors</span><span class="op" id="6664911">(</span><span class="ident" id="6664912">t</span>&nbsp;<span class="op" id="6664914">*</span><span class="ident" id="6664915">testing</span><span class="op" id="6664922">.</span><span class="ident" id="6664923">T</span><span class="op" id="6664924">,</span>&nbsp;<span class="ident" id="6664926">filename</span>&nbsp;<span class="builtintype" id="6664935">string</span><span class="op" id="6664941">,</span>&nbsp;<span class="ident" id="6664943">src</span>&nbsp;<span class="op" id="6664947">[</span><span class="op" id="6664948">]</span><span class="builtintype" id="6664949">byte</span><span class="op" id="6664953">)</span>&nbsp;<span class="keyword" id="6664955">map</span><span class="op" id="6664958">[</span><span class="ident" id="6664959">token</span><span class="op" id="6664964">.</span><span class="ident" id="6664965">Pos</span><span class="op" id="6664968">]</span><span class="builtintype" id="6664969">string</span>&nbsp;<span class="op" id="6664976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664979">errors</span>&nbsp;<span class="op" id="6664986">:=</span>&nbsp;<span class="builtinfunc" id="6664989">make</span><span class="op" id="6664993">(</span><span class="keyword" id="6664994">map</span><span class="op" id="6664997">[</span><span class="ident" id="6664998">token</span><span class="op" id="6665003">.</span><span class="ident" id="6665004">Pos</span><span class="op" id="6665007">]</span><span class="builtintype" id="6665008">string</span><span class="op" id="6665014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665018">var</span>&nbsp;<span class="ident" id="6665022">s</span>&nbsp;<span class="ident" id="6665024">scanner</span><span class="op" id="6665031">.</span><span class="ident" id="6665032">Scanner</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6665041">//&nbsp;file&nbsp;was&nbsp;parsed&nbsp;already&nbsp;-&nbsp;do&nbsp;not&nbsp;add&nbsp;it&nbsp;again&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6665103">//&nbsp;set&nbsp;otherwise&nbsp;the&nbsp;position&nbsp;information&nbsp;returned&nbsp;here&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6665165">//&nbsp;not&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;collected&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665228">s</span><span class="op" id="6665229">.</span><span class="ident" id="6665230">Init</span><span class="op" id="6665234">(</span><span class="ident" id="6665235">getFile</span><span class="op" id="6665242">(</span><span class="ident" id="6665243">filename</span><span class="op" id="6665251">)</span><span class="op" id="6665252">,</span>&nbsp;<span class="ident" id="6665254">src</span><span class="op" id="6665257">,</span>&nbsp;<span class="ident" id="6665259">nil</span><span class="op" id="6665262">,</span>&nbsp;<span class="ident" id="6665264">scanner</span><span class="op" id="6665271">.</span><span class="ident" id="6665272">ScanComments</span><span class="op" id="6665284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665287">var</span>&nbsp;<span class="ident" id="6665291">prev</span>&nbsp;<span class="ident" id="6665296">token</span><span class="op" id="6665301">.</span><span class="ident" id="6665302">Pos</span>&nbsp;<span class="comment" id="6665306">//&nbsp;position&nbsp;of&nbsp;last&nbsp;non-comment,&nbsp;non-semicolon&nbsp;token</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665360">var</span>&nbsp;<span class="ident" id="6665364">here</span>&nbsp;<span class="ident" id="6665369">token</span><span class="op" id="6665374">.</span><span class="ident" id="6665375">Pos</span>&nbsp;<span class="comment" id="6665379">//&nbsp;position&nbsp;immediately&nbsp;after&nbsp;the&nbsp;token&nbsp;at&nbsp;position&nbsp;prev</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665438">for</span>&nbsp;<span class="op" id="6665442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665446">pos</span><span class="op" id="6665449">,</span>&nbsp;<span class="ident" id="6665451">tok</span><span class="op" id="6665454">,</span>&nbsp;<span class="ident" id="6665456">lit</span>&nbsp;<span class="op" id="6665460">:=</span>&nbsp;<span class="ident" id="6665463">s</span><span class="op" id="6665464">.</span><span class="ident" id="6665465">Scan</span><span class="op" id="6665469">(</span><span class="op" id="6665470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665474">switch</span>&nbsp;<span class="ident" id="6665481">tok</span>&nbsp;<span class="op" id="6665485">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665489">case</span>&nbsp;<span class="ident" id="6665494">token</span><span class="op" id="6665499">.</span><span class="ident" id="6665500">EOF</span><span class="op" id="6665503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665508">return</span>&nbsp;<span class="ident" id="6665515">errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665524">case</span>&nbsp;<span class="ident" id="6665529">token</span><span class="op" id="6665534">.</span><span class="ident" id="6665535">COMMENT</span><span class="op" id="6665542">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665547">s</span>&nbsp;<span class="op" id="6665549">:=</span>&nbsp;<span class="ident" id="6665552">errRx</span><span class="op" id="6665557">.</span><span class="ident" id="6665558">FindStringSubmatch</span><span class="op" id="6665576">(</span><span class="ident" id="6665577">lit</span><span class="op" id="6665580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665585">if</span>&nbsp;<span class="builtinfunc" id="6665588">len</span><span class="op" id="6665591">(</span><span class="ident" id="6665592">s</span><span class="op" id="6665593">)</span>&nbsp;<span class="op" id="6665595">==</span>&nbsp;<span class="num" id="6665598">3</span>&nbsp;<span class="op" id="6665600">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665606">pos</span>&nbsp;<span class="op" id="6665610">:=</span>&nbsp;<span class="ident" id="6665613">prev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665622">if</span>&nbsp;<span class="ident" id="6665625">s</span><span class="op" id="6665626">[</span><span class="num" id="6665627">1</span><span class="op" id="6665628">]</span>&nbsp;<span class="op" id="6665630">==</span>&nbsp;<span class="string" id="6665633">&#34;HERE&#34;</span>&nbsp;<span class="op" id="6665640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665647">pos</span>&nbsp;<span class="op" id="6665651">=</span>&nbsp;<span class="ident" id="6665653">here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665668">errors</span><span class="op" id="6665674">[</span><span class="ident" id="6665675">pos</span><span class="op" id="6665678">]</span>&nbsp;<span class="op" id="6665680">=</span>&nbsp;<span class="builtintype" id="6665682">string</span><span class="op" id="6665688">(</span><span class="ident" id="6665689">s</span><span class="op" id="6665690">[</span><span class="num" id="6665691">2</span><span class="op" id="6665692">]</span><span class="op" id="6665693">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665702">default</span><span class="op" id="6665709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665714">prev</span>&nbsp;<span class="op" id="6665719">=</span>&nbsp;<span class="ident" id="6665721">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665728">var</span>&nbsp;<span class="ident" id="6665732">l</span>&nbsp;<span class="builtintype" id="6665734">int</span>&nbsp;<span class="comment" id="6665738">//&nbsp;token&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665757">if</span>&nbsp;<span class="ident" id="6665760">tok</span><span class="op" id="6665763">.</span><span class="ident" id="6665764">IsLiteral</span><span class="op" id="6665773">(</span><span class="op" id="6665774">)</span>&nbsp;<span class="op" id="6665776">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665782">l</span>&nbsp;<span class="op" id="6665784">=</span>&nbsp;<span class="builtinfunc" id="6665786">len</span><span class="op" id="6665789">(</span><span class="ident" id="6665790">lit</span><span class="op" id="6665793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665798">}</span>&nbsp;<span class="keyword" id="6665800">else</span>&nbsp;<span class="op" id="6665805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665811">l</span>&nbsp;<span class="op" id="6665813">=</span>&nbsp;<span class="builtinfunc" id="6665815">len</span><span class="op" id="6665818">(</span><span class="ident" id="6665819">tok</span><span class="op" id="6665822">.</span><span class="ident" id="6665823">String</span><span class="op" id="6665829">(</span><span class="op" id="6665830">)</span><span class="op" id="6665831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665841">here</span>&nbsp;<span class="op" id="6665846">=</span>&nbsp;<span class="ident" id="6665848">prev</span>&nbsp;<span class="op" id="6665853">+</span>&nbsp;<span class="ident" id="6665855">token</span><span class="op" id="6665860">.</span><span class="ident" id="6665861">Pos</span><span class="op" id="6665864">(</span><span class="ident" id="6665865">l</span><span class="op" id="6665866">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665873">}</span><br>
<span class="lineno"></span><span class="op" id="6665875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6665878">//&nbsp;compareErrors&nbsp;compares&nbsp;the&nbsp;map&nbsp;of&nbsp;expected&nbsp;error&nbsp;messages&nbsp;with&nbsp;the&nbsp;list</span><br>
<span class="lineno">110</span><span class="comment" id="6665953">//&nbsp;of&nbsp;found&nbsp;errors&nbsp;and&nbsp;reports&nbsp;discrepancies.</span><br>
<span class="lineno"></span><span class="comment" id="6665999">//</span><br>
<span class="lineno"></span><span class="keyword" id="6666002">func</span>&nbsp;<span class="ident" id="6666007">compareErrors</span><span class="op" id="6666020">(</span><span class="ident" id="6666021">t</span>&nbsp;<span class="op" id="6666023">*</span><span class="ident" id="6666024">testing</span><span class="op" id="6666031">.</span><span class="ident" id="6666032">T</span><span class="op" id="6666033">,</span>&nbsp;<span class="ident" id="6666035">expected</span>&nbsp;<span class="keyword" id="6666044">map</span><span class="op" id="6666047">[</span><span class="ident" id="6666048">token</span><span class="op" id="6666053">.</span><span class="ident" id="6666054">Pos</span><span class="op" id="6666057">]</span><span class="builtintype" id="6666058">string</span><span class="op" id="6666064">,</span>&nbsp;<span class="ident" id="6666066">found</span>&nbsp;<span class="ident" id="6666072">scanner</span><span class="op" id="6666079">.</span><span class="ident" id="6666080">ErrorList</span><span class="op" id="6666089">)</span>&nbsp;<span class="op" id="6666091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666094">for</span>&nbsp;<span class="ident" id="6666098">_</span><span class="op" id="6666099">,</span>&nbsp;<span class="builtintype" id="6666101">error</span>&nbsp;<span class="op" id="6666107">:=</span>&nbsp;<span class="keyword" id="6666110">range</span>&nbsp;<span class="ident" id="6666116">found</span>&nbsp;<span class="op" id="6666122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6666126">//&nbsp;error.Pos&nbsp;is&nbsp;a&nbsp;token.Position,&nbsp;but&nbsp;we&nbsp;want</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6666174">//&nbsp;a&nbsp;token.Pos&nbsp;so&nbsp;we&nbsp;can&nbsp;do&nbsp;a&nbsp;map&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666217">pos</span>&nbsp;<span class="op" id="6666221">:=</span>&nbsp;<span class="ident" id="6666224">getPos</span><span class="op" id="6666230">(</span><span class="builtintype" id="6666231">error</span><span class="op" id="6666236">.</span><span class="ident" id="6666237">Pos</span><span class="op" id="6666240">.</span><span class="ident" id="6666241">Filename</span><span class="op" id="6666249">,</span>&nbsp;<span class="builtintype" id="6666251">error</span><span class="op" id="6666256">.</span><span class="ident" id="6666257">Pos</span><span class="op" id="6666260">.</span><span class="ident" id="6666261">Offset</span><span class="op" id="6666267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666271">if</span>&nbsp;<span class="ident" id="6666274">msg</span><span class="op" id="6666277">,</span>&nbsp;<span class="ident" id="6666279">found</span>&nbsp;<span class="op" id="6666285">:=</span>&nbsp;<span class="ident" id="6666288">expected</span><span class="op" id="6666296">[</span><span class="ident" id="6666297">pos</span><span class="op" id="6666300">]</span><span class="op" id="6666301">;</span>&nbsp;<span class="ident" id="6666303">found</span>&nbsp;<span class="op" id="6666309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6666314">//&nbsp;we&nbsp;expect&nbsp;a&nbsp;message&nbsp;at&nbsp;pos;&nbsp;check&nbsp;if&nbsp;it&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666368">rx</span><span class="op" id="6666370">,</span>&nbsp;<span class="ident" id="6666372">err</span>&nbsp;<span class="op" id="6666376">:=</span>&nbsp;<span class="ident" id="6666379">regexp</span><span class="op" id="6666385">.</span><span class="ident" id="6666386">Compile</span><span class="op" id="6666393">(</span><span class="ident" id="6666394">msg</span><span class="op" id="6666397">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666402">if</span>&nbsp;<span class="ident" id="6666405">err</span>&nbsp;<span class="op" id="6666409">!=</span>&nbsp;<span class="ident" id="6666412">nil</span>&nbsp;<span class="op" id="6666416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666422">t</span><span class="op" id="6666423">.</span><span class="ident" id="6666424">Errorf</span><span class="op" id="6666430">(</span><span class="string" id="6666431">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="6666439">,</span>&nbsp;<span class="builtintype" id="6666441">error</span><span class="op" id="6666446">.</span><span class="ident" id="6666447">Pos</span><span class="op" id="6666450">,</span>&nbsp;<span class="ident" id="6666452">err</span><span class="op" id="6666455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666461">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666478">if</span>&nbsp;<span class="ident" id="6666481">match</span>&nbsp;<span class="op" id="6666487">:=</span>&nbsp;<span class="ident" id="6666490">rx</span><span class="op" id="6666492">.</span><span class="ident" id="6666493">MatchString</span><span class="op" id="6666504">(</span><span class="builtintype" id="6666505">error</span><span class="op" id="6666510">.</span><span class="ident" id="6666511">Msg</span><span class="op" id="6666514">)</span><span class="op" id="6666515">;</span>&nbsp;<span class="op" id="6666517">!</span><span class="ident" id="6666518">match</span>&nbsp;<span class="op" id="6666524">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666530">t</span><span class="op" id="6666531">.</span><span class="ident" id="6666532">Errorf</span><span class="op" id="6666538">(</span><span class="string" id="6666539">&#34;%s:&nbsp;%q&nbsp;does&nbsp;not&nbsp;match&nbsp;%q&#34;</span><span class="op" id="6666565">,</span>&nbsp;<span class="builtintype" id="6666567">error</span><span class="op" id="6666572">.</span><span class="ident" id="6666573">Pos</span><span class="op" id="6666576">,</span>&nbsp;<span class="builtintype" id="6666578">error</span><span class="op" id="6666583">.</span><span class="ident" id="6666584">Msg</span><span class="op" id="6666587">,</span>&nbsp;<span class="ident" id="6666589">msg</span><span class="op" id="6666592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666598">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6666615">//&nbsp;we&nbsp;have&nbsp;a&nbsp;match&nbsp;-&nbsp;eliminate&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6666660">delete</span><span class="op" id="6666666">(</span><span class="ident" id="6666667">expected</span><span class="op" id="6666675">,</span>&nbsp;<span class="ident" id="6666677">pos</span><span class="op" id="6666680">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666684">}</span>&nbsp;<span class="keyword" id="6666686">else</span>&nbsp;<span class="op" id="6666691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6666696">//&nbsp;To&nbsp;keep&nbsp;in&nbsp;mind&nbsp;when&nbsp;analyzing&nbsp;failed&nbsp;test&nbsp;output:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6666753">//&nbsp;If&nbsp;the&nbsp;same&nbsp;error&nbsp;position&nbsp;occurs&nbsp;multiple&nbsp;times&nbsp;in&nbsp;errors,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6666819">//&nbsp;this&nbsp;message&nbsp;will&nbsp;be&nbsp;triggered&nbsp;(because&nbsp;the&nbsp;first&nbsp;error&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6666884">//&nbsp;the&nbsp;position&nbsp;removes&nbsp;this&nbsp;position&nbsp;from&nbsp;the&nbsp;expected&nbsp;errors).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666952">t</span><span class="op" id="6666953">.</span><span class="ident" id="6666954">Errorf</span><span class="op" id="6666960">(</span><span class="string" id="6666961">&#34;%s:&nbsp;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6666987">,</span>&nbsp;<span class="builtintype" id="6666989">error</span><span class="op" id="6666994">.</span><span class="ident" id="6666995">Pos</span><span class="op" id="6666998">,</span>&nbsp;<span class="builtintype" id="6667000">error</span><span class="op" id="6667005">.</span><span class="ident" id="6667006">Msg</span><span class="op" id="6667009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6667020">//&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;expected&nbsp;errors&nbsp;left</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667064">if</span>&nbsp;<span class="builtinfunc" id="6667067">len</span><span class="op" id="6667070">(</span><span class="ident" id="6667071">expected</span><span class="op" id="6667079">)</span>&nbsp;<span class="op" id="6667081">&gt;</span>&nbsp;<span class="num" id="6667083">0</span>&nbsp;<span class="op" id="6667085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667089">t</span><span class="op" id="6667090">.</span><span class="ident" id="6667091">Errorf</span><span class="op" id="6667097">(</span><span class="string" id="6667098">&#34;%d&nbsp;errors&nbsp;not&nbsp;reported:&#34;</span><span class="op" id="6667123">,</span>&nbsp;<span class="builtinfunc" id="6667125">len</span><span class="op" id="6667128">(</span><span class="ident" id="6667129">expected</span><span class="op" id="6667137">)</span><span class="op" id="6667138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667142">for</span>&nbsp;<span class="ident" id="6667146">pos</span><span class="op" id="6667149">,</span>&nbsp;<span class="ident" id="6667151">msg</span>&nbsp;<span class="op" id="6667155">:=</span>&nbsp;<span class="keyword" id="6667158">range</span>&nbsp;<span class="ident" id="6667164">expected</span>&nbsp;<span class="op" id="6667173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667178">t</span><span class="op" id="6667179">.</span><span class="ident" id="6667180">Errorf</span><span class="op" id="6667186">(</span><span class="string" id="6667187">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="6667197">,</span>&nbsp;<span class="ident" id="6667199">fsetErrs</span><span class="op" id="6667207">.</span><span class="ident" id="6667208">Position</span><span class="op" id="6667216">(</span><span class="ident" id="6667217">pos</span><span class="op" id="6667220">)</span><span class="op" id="6667221">,</span>&nbsp;<span class="ident" id="6667223">msg</span><span class="op" id="6667226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667230">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667233">}</span><br>
<span class="lineno"></span><span class="op" id="6667235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6667238">func</span>&nbsp;<span class="ident" id="6667243">checkErrors</span><span class="op" id="6667254">(</span><span class="ident" id="6667255">t</span>&nbsp;<span class="op" id="6667257">*</span><span class="ident" id="6667258">testing</span><span class="op" id="6667265">.</span><span class="ident" id="6667266">T</span><span class="op" id="6667267">,</span>&nbsp;<span class="ident" id="6667269">filename</span>&nbsp;<span class="builtintype" id="6667278">string</span><span class="op" id="6667284">,</span>&nbsp;<span class="ident" id="6667286">input</span>&nbsp;<span class="keyword" id="6667292">interface</span><span class="op" id="6667301">{</span><span class="op" id="6667302">}</span><span class="op" id="6667303">)</span>&nbsp;<span class="op" id="6667305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667308">src</span><span class="op" id="6667311">,</span>&nbsp;<span class="ident" id="6667313">err</span>&nbsp;<span class="op" id="6667317">:=</span>&nbsp;<span class="ident" id="6667320">readSource</span><span class="op" id="6667330">(</span><span class="ident" id="6667331">filename</span><span class="op" id="6667339">,</span>&nbsp;<span class="ident" id="6667341">input</span><span class="op" id="6667346">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667349">if</span>&nbsp;<span class="ident" id="6667352">err</span>&nbsp;<span class="op" id="6667356">!=</span>&nbsp;<span class="ident" id="6667359">nil</span>&nbsp;<span class="op" id="6667363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667367">t</span><span class="op" id="6667368">.</span><span class="ident" id="6667369">Error</span><span class="op" id="6667374">(</span><span class="ident" id="6667375">err</span><span class="op" id="6667378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667382">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667394">_</span><span class="op" id="6667395">,</span>&nbsp;<span class="ident" id="6667397">err</span>&nbsp;<span class="op" id="6667401">=</span>&nbsp;<span class="ident" id="6667403">ParseFile</span><span class="op" id="6667412">(</span><span class="ident" id="6667413">fsetErrs</span><span class="op" id="6667421">,</span>&nbsp;<span class="ident" id="6667423">filename</span><span class="op" id="6667431">,</span>&nbsp;<span class="ident" id="6667433">src</span><span class="op" id="6667436">,</span>&nbsp;<span class="ident" id="6667438">DeclarationErrors</span><span class="op" id="6667455">|</span><span class="ident" id="6667456">AllErrors</span><span class="op" id="6667465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667468">found</span><span class="op" id="6667473">,</span>&nbsp;<span class="ident" id="6667475">ok</span>&nbsp;<span class="op" id="6667478">:=</span>&nbsp;<span class="ident" id="6667481">err</span><span class="op" id="6667484">.</span><span class="op" id="6667485">(</span><span class="ident" id="6667486">scanner</span><span class="op" id="6667493">.</span><span class="ident" id="6667494">ErrorList</span><span class="op" id="6667503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667506">if</span>&nbsp;<span class="ident" id="6667509">err</span>&nbsp;<span class="op" id="6667513">!=</span>&nbsp;<span class="ident" id="6667516">nil</span>&nbsp;<span class="op" id="6667520">&amp;&amp;</span>&nbsp;<span class="op" id="6667523">!</span><span class="ident" id="6667524">ok</span>&nbsp;<span class="op" id="6667527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667531">t</span><span class="op" id="6667532">.</span><span class="ident" id="6667533">Error</span><span class="op" id="6667538">(</span><span class="ident" id="6667539">err</span><span class="op" id="6667542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667546">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667557">found</span><span class="op" id="6667562">.</span><span class="ident" id="6667563">RemoveMultiples</span><span class="op" id="6667578">(</span><span class="op" id="6667579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6667583">//&nbsp;we&nbsp;are&nbsp;expecting&nbsp;the&nbsp;following&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6667625">//&nbsp;(collect&nbsp;these&nbsp;after&nbsp;parsing&nbsp;a&nbsp;file&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;found&nbsp;in&nbsp;the&nbsp;file&nbsp;set)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667702">expected</span>&nbsp;<span class="op" id="6667711">:=</span>&nbsp;<span class="ident" id="6667714">expectedErrors</span><span class="op" id="6667728">(</span><span class="ident" id="6667729">t</span><span class="op" id="6667730">,</span>&nbsp;<span class="ident" id="6667732">filename</span><span class="op" id="6667740">,</span>&nbsp;<span class="ident" id="6667742">src</span><span class="op" id="6667745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6667749">//&nbsp;verify&nbsp;errors&nbsp;returned&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667790">compareErrors</span><span class="op" id="6667803">(</span><span class="ident" id="6667804">t</span><span class="op" id="6667805">,</span>&nbsp;<span class="ident" id="6667807">expected</span><span class="op" id="6667815">,</span>&nbsp;<span class="ident" id="6667817">found</span><span class="op" id="6667822">)</span><br>
<span class="lineno"></span><span class="op" id="6667824">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6667827">func</span>&nbsp;<span class="ident" id="6667832">TestErrors</span><span class="op" id="6667842">(</span><span class="ident" id="6667843">t</span>&nbsp;<span class="op" id="6667845">*</span><span class="ident" id="6667846">testing</span><span class="op" id="6667853">.</span><span class="ident" id="6667854">T</span><span class="op" id="6667855">)</span>&nbsp;<span class="op" id="6667857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667860">list</span><span class="op" id="6667864">,</span>&nbsp;<span class="ident" id="6667866">err</span>&nbsp;<span class="op" id="6667870">:=</span>&nbsp;<span class="ident" id="6667873">ioutil</span><span class="op" id="6667879">.</span><span class="ident" id="6667880">ReadDir</span><span class="op" id="6667887">(</span><span class="ident" id="6667888">testdata</span><span class="op" id="6667896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667899">if</span>&nbsp;<span class="ident" id="6667902">err</span>&nbsp;<span class="op" id="6667906">!=</span>&nbsp;<span class="ident" id="6667909">nil</span>&nbsp;<span class="op" id="6667913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667917">t</span><span class="op" id="6667918">.</span><span class="ident" id="6667919">Fatal</span><span class="op" id="6667924">(</span><span class="ident" id="6667925">err</span><span class="op" id="6667928">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667934">for</span>&nbsp;<span class="ident" id="6667938">_</span><span class="op" id="6667939">,</span>&nbsp;<span class="ident" id="6667941">fi</span>&nbsp;<span class="op" id="6667944">:=</span>&nbsp;<span class="keyword" id="6667947">range</span>&nbsp;<span class="ident" id="6667953">list</span>&nbsp;<span class="op" id="6667958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667962">name</span>&nbsp;<span class="op" id="6667967">:=</span>&nbsp;<span class="ident" id="6667970">fi</span><span class="op" id="6667972">.</span><span class="ident" id="6667973">Name</span><span class="op" id="6667977">(</span><span class="op" id="6667978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667982">if</span>&nbsp;<span class="op" id="6667985">!</span><span class="ident" id="6667986">fi</span><span class="op" id="6667988">.</span><span class="ident" id="6667989">IsDir</span><span class="op" id="6667994">(</span><span class="op" id="6667995">)</span>&nbsp;<span class="op" id="6667997">&amp;&amp;</span>&nbsp;<span class="op" id="6668000">!</span><span class="ident" id="6668001">strings</span><span class="op" id="6668008">.</span><span class="ident" id="6668009">HasPrefix</span><span class="op" id="6668018">(</span><span class="ident" id="6668019">name</span><span class="op" id="6668023">,</span>&nbsp;<span class="string" id="6668025">&#34;.&#34;</span><span class="op" id="6668028">)</span>&nbsp;<span class="op" id="6668030">&amp;&amp;</span>&nbsp;<span class="ident" id="6668033">strings</span><span class="op" id="6668040">.</span><span class="ident" id="6668041">HasSuffix</span><span class="op" id="6668050">(</span><span class="ident" id="6668051">name</span><span class="op" id="6668055">,</span>&nbsp;<span class="string" id="6668057">&#34;.src&#34;</span><span class="op" id="6668063">)</span>&nbsp;<span class="op" id="6668065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668070">checkErrors</span><span class="op" id="6668081">(</span><span class="ident" id="6668082">t</span><span class="op" id="6668083">,</span>&nbsp;<span class="ident" id="6668085">filepath</span><span class="op" id="6668093">.</span><span class="ident" id="6668094">Join</span><span class="op" id="6668098">(</span><span class="ident" id="6668099">testdata</span><span class="op" id="6668107">,</span>&nbsp;<span class="ident" id="6668109">name</span><span class="op" id="6668113">)</span><span class="op" id="6668114">,</span>&nbsp;<span class="ident" id="6668116">nil</span><span class="op" id="6668119">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668126">}</span><br>
<span class="lineno"></span><span class="op" id="6668128">}</span>
</div>
</body>
</html>
