<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html" class="current">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7892713">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7892768">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7892822">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7892873">package</span>&nbsp;<span class="ident" id="7892881">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7892891">import</span>&nbsp;<span class="op" id="7892898">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7892901">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7892908">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7892920">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7892930">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7892933">func</span>&nbsp;<span class="ident" id="7892938">TestRecorder</span><span class="op" id="7892950">(</span><span class="ident" id="7892951">t</span>&nbsp;<span class="op" id="7892953">*</span><span class="ident" id="7892954">testing</span><span class="op" id="7892961">.</span><span class="ident" id="7892962">T</span><span class="op" id="7892963">)</span>&nbsp;<span class="op" id="7892965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7892968">type</span>&nbsp;<span class="ident" id="7892973">checkFunc</span>&nbsp;<span class="keyword" id="7892983">func</span><span class="op" id="7892987">(</span><span class="op" id="7892988">*</span><span class="ident" id="7892989">ResponseRecorder</span><span class="op" id="7893005">)</span>&nbsp;<span class="builtintype" id="7893007">error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7893014">check</span>&nbsp;<span class="op" id="7893020">:=</span>&nbsp;<span class="keyword" id="7893023">func</span><span class="op" id="7893027">(</span><span class="ident" id="7893028">fns</span>&nbsp;<span class="op" id="7893032">...</span><span class="ident" id="7893035">checkFunc</span><span class="op" id="7893044">)</span>&nbsp;<span class="op" id="7893046">[</span><span class="op" id="7893047">]</span><span class="ident" id="7893048">checkFunc</span>&nbsp;<span class="op" id="7893058">{</span>&nbsp;<span class="keyword" id="7893060">return</span>&nbsp;<span class="ident" id="7893067">fns</span>&nbsp;<span class="op" id="7893071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7893075">hasStatus</span>&nbsp;<span class="op" id="7893085">:=</span>&nbsp;<span class="keyword" id="7893088">func</span><span class="op" id="7893092">(</span><span class="ident" id="7893093">wantCode</span>&nbsp;<span class="builtintype" id="7893102">int</span><span class="op" id="7893105">)</span>&nbsp;<span class="ident" id="7893107">checkFunc</span>&nbsp;<span class="op" id="7893117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893121">return</span>&nbsp;<span class="keyword" id="7893128">func</span><span class="op" id="7893132">(</span><span class="ident" id="7893133">rec</span>&nbsp;<span class="op" id="7893137">*</span><span class="ident" id="7893138">ResponseRecorder</span><span class="op" id="7893154">)</span>&nbsp;<span class="builtintype" id="7893156">error</span>&nbsp;<span class="op" id="7893162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893167">if</span>&nbsp;<span class="ident" id="7893170">rec</span><span class="op" id="7893173">.</span><span class="ident" id="7893174">Code</span>&nbsp;<span class="op" id="7893179">!=</span>&nbsp;<span class="ident" id="7893182">wantCode</span>&nbsp;<span class="op" id="7893191">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893197">return</span>&nbsp;<span class="ident" id="7893204">fmt</span><span class="op" id="7893207">.</span><span class="ident" id="7893208">Errorf</span><span class="op" id="7893214">(</span><span class="string" id="7893215">&#34;Status&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7893237">,</span>&nbsp;<span class="ident" id="7893239">rec</span><span class="op" id="7893242">.</span><span class="ident" id="7893243">Code</span><span class="op" id="7893247">,</span>&nbsp;<span class="ident" id="7893249">wantCode</span><span class="op" id="7893257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893267">return</span>&nbsp;<span class="ident" id="7893274">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893283">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7893286">hasContents</span>&nbsp;<span class="op" id="7893298">:=</span>&nbsp;<span class="keyword" id="7893301">func</span><span class="op" id="7893305">(</span><span class="ident" id="7893306">want</span>&nbsp;<span class="builtintype" id="7893311">string</span><span class="op" id="7893317">)</span>&nbsp;<span class="ident" id="7893319">checkFunc</span>&nbsp;<span class="op" id="7893329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893333">return</span>&nbsp;<span class="keyword" id="7893340">func</span><span class="op" id="7893344">(</span><span class="ident" id="7893345">rec</span>&nbsp;<span class="op" id="7893349">*</span><span class="ident" id="7893350">ResponseRecorder</span><span class="op" id="7893366">)</span>&nbsp;<span class="builtintype" id="7893368">error</span>&nbsp;<span class="op" id="7893374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893379">if</span>&nbsp;<span class="ident" id="7893382">rec</span><span class="op" id="7893385">.</span><span class="ident" id="7893386">Body</span><span class="op" id="7893390">.</span><span class="ident" id="7893391">String</span><span class="op" id="7893397">(</span><span class="op" id="7893398">)</span>&nbsp;<span class="op" id="7893400">!=</span>&nbsp;<span class="ident" id="7893403">want</span>&nbsp;<span class="op" id="7893408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893414">return</span>&nbsp;<span class="ident" id="7893421">fmt</span><span class="op" id="7893424">.</span><span class="ident" id="7893425">Errorf</span><span class="op" id="7893431">(</span><span class="string" id="7893432">&#34;wrote&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7893453">,</span>&nbsp;<span class="ident" id="7893455">rec</span><span class="op" id="7893458">.</span><span class="ident" id="7893459">Body</span><span class="op" id="7893463">.</span><span class="ident" id="7893464">String</span><span class="op" id="7893470">(</span><span class="op" id="7893471">)</span><span class="op" id="7893472">,</span>&nbsp;<span class="ident" id="7893474">want</span><span class="op" id="7893478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893483">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893488">return</span>&nbsp;<span class="ident" id="7893495">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7893507">hasFlush</span>&nbsp;<span class="op" id="7893516">:=</span>&nbsp;<span class="keyword" id="7893519">func</span><span class="op" id="7893523">(</span><span class="ident" id="7893524">want</span>&nbsp;<span class="builtintype" id="7893529">bool</span><span class="op" id="7893533">)</span>&nbsp;<span class="ident" id="7893535">checkFunc</span>&nbsp;<span class="op" id="7893545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893549">return</span>&nbsp;<span class="keyword" id="7893556">func</span><span class="op" id="7893560">(</span><span class="ident" id="7893561">rec</span>&nbsp;<span class="op" id="7893565">*</span><span class="ident" id="7893566">ResponseRecorder</span><span class="op" id="7893582">)</span>&nbsp;<span class="builtintype" id="7893584">error</span>&nbsp;<span class="op" id="7893590">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893595">if</span>&nbsp;<span class="ident" id="7893598">rec</span><span class="op" id="7893601">.</span><span class="ident" id="7893602">Flushed</span>&nbsp;<span class="op" id="7893610">!=</span>&nbsp;<span class="ident" id="7893613">want</span>&nbsp;<span class="op" id="7893618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893624">return</span>&nbsp;<span class="ident" id="7893631">fmt</span><span class="op" id="7893634">.</span><span class="ident" id="7893635">Errorf</span><span class="op" id="7893641">(</span><span class="string" id="7893642">&#34;Flushed&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7893665">,</span>&nbsp;<span class="ident" id="7893667">rec</span><span class="op" id="7893670">.</span><span class="ident" id="7893671">Flushed</span><span class="op" id="7893678">,</span>&nbsp;<span class="ident" id="7893680">want</span><span class="op" id="7893684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893694">return</span>&nbsp;<span class="ident" id="7893701">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893707">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7893714">tests</span>&nbsp;<span class="op" id="7893720">:=</span>&nbsp;<span class="op" id="7893723">[</span><span class="op" id="7893724">]</span><span class="keyword" id="7893725">struct</span>&nbsp;<span class="op" id="7893732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7893736">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7893743">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7893752">h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893759">func</span><span class="op" id="7893763">(</span><span class="ident" id="7893764">w</span>&nbsp;<span class="ident" id="7893766">http</span><span class="op" id="7893770">.</span><span class="ident" id="7893771">ResponseWriter</span><span class="op" id="7893785">,</span>&nbsp;<span class="ident" id="7893787">r</span>&nbsp;<span class="op" id="7893789">*</span><span class="ident" id="7893790">http</span><span class="op" id="7893794">.</span><span class="ident" id="7893795">Request</span><span class="op" id="7893802">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7893806">checks</span>&nbsp;<span class="op" id="7893813">[</span><span class="op" id="7893814">]</span><span class="ident" id="7893815">checkFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893826">}</span><span class="op" id="7893827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7893836">&#34;200&nbsp;default&#34;</span><span class="op" id="7893849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893854">func</span><span class="op" id="7893858">(</span><span class="ident" id="7893859">w</span>&nbsp;<span class="ident" id="7893861">http</span><span class="op" id="7893865">.</span><span class="ident" id="7893866">ResponseWriter</span><span class="op" id="7893880">,</span>&nbsp;<span class="ident" id="7893882">r</span>&nbsp;<span class="op" id="7893884">*</span><span class="ident" id="7893885">http</span><span class="op" id="7893889">.</span><span class="ident" id="7893890">Request</span><span class="op" id="7893897">)</span>&nbsp;<span class="op" id="7893899">{</span><span class="op" id="7893900">}</span><span class="op" id="7893901">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7893906">check</span><span class="op" id="7893911">(</span><span class="ident" id="7893912">hasStatus</span><span class="op" id="7893921">(</span><span class="num" id="7893922">200</span><span class="op" id="7893925">)</span><span class="op" id="7893926">,</span>&nbsp;<span class="ident" id="7893928">hasContents</span><span class="op" id="7893939">(</span><span class="string" id="7893940">&#34;&#34;</span><span class="op" id="7893942">)</span><span class="op" id="7893943">)</span><span class="op" id="7893944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893948">}</span><span class="op" id="7893949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7893953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7893958">&#34;first&nbsp;code&nbsp;only&#34;</span><span class="op" id="7893975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7893980">func</span><span class="op" id="7893984">(</span><span class="ident" id="7893985">w</span>&nbsp;<span class="ident" id="7893987">http</span><span class="op" id="7893991">.</span><span class="ident" id="7893992">ResponseWriter</span><span class="op" id="7894006">,</span>&nbsp;<span class="ident" id="7894008">r</span>&nbsp;<span class="op" id="7894010">*</span><span class="ident" id="7894011">http</span><span class="op" id="7894015">.</span><span class="ident" id="7894016">Request</span><span class="op" id="7894023">)</span>&nbsp;<span class="op" id="7894025">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894031">w</span><span class="op" id="7894032">.</span><span class="ident" id="7894033">WriteHeader</span><span class="op" id="7894044">(</span><span class="num" id="7894045">201</span><span class="op" id="7894048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894054">w</span><span class="op" id="7894055">.</span><span class="ident" id="7894056">WriteHeader</span><span class="op" id="7894067">(</span><span class="num" id="7894068">202</span><span class="op" id="7894071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894077">w</span><span class="op" id="7894078">.</span><span class="ident" id="7894079">Write</span><span class="op" id="7894084">(</span><span class="op" id="7894085">[</span><span class="op" id="7894086">]</span><span class="builtintype" id="7894087">byte</span><span class="op" id="7894091">(</span><span class="string" id="7894092">&#34;hi&#34;</span><span class="op" id="7894096">)</span><span class="op" id="7894097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894102">}</span><span class="op" id="7894103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894108">check</span><span class="op" id="7894113">(</span><span class="ident" id="7894114">hasStatus</span><span class="op" id="7894123">(</span><span class="num" id="7894124">201</span><span class="op" id="7894127">)</span><span class="op" id="7894128">,</span>&nbsp;<span class="ident" id="7894130">hasContents</span><span class="op" id="7894141">(</span><span class="string" id="7894142">&#34;hi&#34;</span><span class="op" id="7894146">)</span><span class="op" id="7894147">)</span><span class="op" id="7894148">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894152">}</span><span class="op" id="7894153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7894162">&#34;write&nbsp;sends&nbsp;200&#34;</span><span class="op" id="7894179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7894184">func</span><span class="op" id="7894188">(</span><span class="ident" id="7894189">w</span>&nbsp;<span class="ident" id="7894191">http</span><span class="op" id="7894195">.</span><span class="ident" id="7894196">ResponseWriter</span><span class="op" id="7894210">,</span>&nbsp;<span class="ident" id="7894212">r</span>&nbsp;<span class="op" id="7894214">*</span><span class="ident" id="7894215">http</span><span class="op" id="7894219">.</span><span class="ident" id="7894220">Request</span><span class="op" id="7894227">)</span>&nbsp;<span class="op" id="7894229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894235">w</span><span class="op" id="7894236">.</span><span class="ident" id="7894237">Write</span><span class="op" id="7894242">(</span><span class="op" id="7894243">[</span><span class="op" id="7894244">]</span><span class="builtintype" id="7894245">byte</span><span class="op" id="7894249">(</span><span class="string" id="7894250">&#34;hi&nbsp;first&#34;</span><span class="op" id="7894260">)</span><span class="op" id="7894261">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894267">w</span><span class="op" id="7894268">.</span><span class="ident" id="7894269">WriteHeader</span><span class="op" id="7894280">(</span><span class="num" id="7894281">201</span><span class="op" id="7894284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894290">w</span><span class="op" id="7894291">.</span><span class="ident" id="7894292">WriteHeader</span><span class="op" id="7894303">(</span><span class="num" id="7894304">202</span><span class="op" id="7894307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894312">}</span><span class="op" id="7894313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894318">check</span><span class="op" id="7894323">(</span><span class="ident" id="7894324">hasStatus</span><span class="op" id="7894333">(</span><span class="num" id="7894334">200</span><span class="op" id="7894337">)</span><span class="op" id="7894338">,</span>&nbsp;<span class="ident" id="7894340">hasContents</span><span class="op" id="7894351">(</span><span class="string" id="7894352">&#34;hi&nbsp;first&#34;</span><span class="op" id="7894362">)</span><span class="op" id="7894363">,</span>&nbsp;<span class="ident" id="7894365">hasFlush</span><span class="op" id="7894373">(</span><span class="builtintype" id="7894374">false</span><span class="op" id="7894379">)</span><span class="op" id="7894380">)</span><span class="op" id="7894381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894385">}</span><span class="op" id="7894386">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7894395">&#34;flush&#34;</span><span class="op" id="7894402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7894407">func</span><span class="op" id="7894411">(</span><span class="ident" id="7894412">w</span>&nbsp;<span class="ident" id="7894414">http</span><span class="op" id="7894418">.</span><span class="ident" id="7894419">ResponseWriter</span><span class="op" id="7894433">,</span>&nbsp;<span class="ident" id="7894435">r</span>&nbsp;<span class="op" id="7894437">*</span><span class="ident" id="7894438">http</span><span class="op" id="7894442">.</span><span class="ident" id="7894443">Request</span><span class="op" id="7894450">)</span>&nbsp;<span class="op" id="7894452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894458">w</span><span class="op" id="7894459">.</span><span class="op" id="7894460">(</span><span class="ident" id="7894461">http</span><span class="op" id="7894465">.</span><span class="ident" id="7894466">Flusher</span><span class="op" id="7894473">)</span><span class="op" id="7894474">.</span><span class="ident" id="7894475">Flush</span><span class="op" id="7894480">(</span><span class="op" id="7894481">)</span>&nbsp;<span class="comment" id="7894483">//&nbsp;also&nbsp;sends&nbsp;a&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894507">w</span><span class="op" id="7894508">.</span><span class="ident" id="7894509">WriteHeader</span><span class="op" id="7894520">(</span><span class="num" id="7894521">201</span><span class="op" id="7894524">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894529">}</span><span class="op" id="7894530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894535">check</span><span class="op" id="7894540">(</span><span class="ident" id="7894541">hasStatus</span><span class="op" id="7894550">(</span><span class="num" id="7894551">200</span><span class="op" id="7894554">)</span><span class="op" id="7894555">,</span>&nbsp;<span class="ident" id="7894557">hasFlush</span><span class="op" id="7894565">(</span><span class="builtintype" id="7894566">true</span><span class="op" id="7894570">)</span><span class="op" id="7894571">)</span><span class="op" id="7894572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894576">}</span><span class="op" id="7894577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894583">r</span><span class="op" id="7894584">,</span>&nbsp;<span class="ident" id="7894586">_</span>&nbsp;<span class="op" id="7894588">:=</span>&nbsp;<span class="ident" id="7894591">http</span><span class="op" id="7894595">.</span><span class="ident" id="7894596">NewRequest</span><span class="op" id="7894606">(</span><span class="string" id="7894607">&#34;GET&#34;</span><span class="op" id="7894612">,</span>&nbsp;<span class="string" id="7894614">&#34;http://foo.com/&#34;</span><span class="op" id="7894631">,</span>&nbsp;<span class="ident" id="7894633">nil</span><span class="op" id="7894636">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7894639">for</span>&nbsp;<span class="ident" id="7894643">_</span><span class="op" id="7894644">,</span>&nbsp;<span class="ident" id="7894646">tt</span>&nbsp;<span class="op" id="7894649">:=</span>&nbsp;<span class="keyword" id="7894652">range</span>&nbsp;<span class="ident" id="7894658">tests</span>&nbsp;<span class="op" id="7894664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894668">h</span>&nbsp;<span class="op" id="7894670">:=</span>&nbsp;<span class="ident" id="7894673">http</span><span class="op" id="7894677">.</span><span class="ident" id="7894678">HandlerFunc</span><span class="op" id="7894689">(</span><span class="ident" id="7894690">tt</span><span class="op" id="7894692">.</span><span class="ident" id="7894693">h</span><span class="op" id="7894694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894698">rec</span>&nbsp;<span class="op" id="7894702">:=</span>&nbsp;<span class="ident" id="7894705">NewRecorder</span><span class="op" id="7894716">(</span><span class="op" id="7894717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894721">h</span><span class="op" id="7894722">.</span><span class="ident" id="7894723">ServeHTTP</span><span class="op" id="7894732">(</span><span class="ident" id="7894733">rec</span><span class="op" id="7894736">,</span>&nbsp;<span class="ident" id="7894738">r</span><span class="op" id="7894739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7894743">for</span>&nbsp;<span class="ident" id="7894747">_</span><span class="op" id="7894748">,</span>&nbsp;<span class="ident" id="7894750">check</span>&nbsp;<span class="op" id="7894756">:=</span>&nbsp;<span class="keyword" id="7894759">range</span>&nbsp;<span class="ident" id="7894765">tt</span><span class="op" id="7894767">.</span><span class="ident" id="7894768">checks</span>&nbsp;<span class="op" id="7894775">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7894780">if</span>&nbsp;<span class="ident" id="7894783">err</span>&nbsp;<span class="op" id="7894787">:=</span>&nbsp;<span class="ident" id="7894790">check</span><span class="op" id="7894795">(</span><span class="ident" id="7894796">rec</span><span class="op" id="7894799">)</span><span class="op" id="7894800">;</span>&nbsp;<span class="ident" id="7894802">err</span>&nbsp;<span class="op" id="7894806">!=</span>&nbsp;<span class="ident" id="7894809">nil</span>&nbsp;<span class="op" id="7894813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7894819">t</span><span class="op" id="7894820">.</span><span class="ident" id="7894821">Errorf</span><span class="op" id="7894827">(</span><span class="string" id="7894828">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7894836">,</span>&nbsp;<span class="ident" id="7894838">tt</span><span class="op" id="7894840">.</span><span class="ident" id="7894841">name</span><span class="op" id="7894845">,</span>&nbsp;<span class="ident" id="7894847">err</span><span class="op" id="7894850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7894862">}</span><br>
<span class="lineno">90</span><span class="op" id="7894864">}</span>
</div>
</body>
</html>
