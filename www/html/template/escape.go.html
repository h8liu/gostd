<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4423129">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4423184">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4423238">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4423289">package</span>&nbsp;<span class="ident" id="4423297">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4423307">import</span>&nbsp;<span class="op" id="4423314">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423317">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423326">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423333">&#34;html&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423341">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423347">&#34;text/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4423364">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="4423386">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4423389">//&nbsp;escapeTemplate&nbsp;rewrites&nbsp;the&nbsp;named&nbsp;template,&nbsp;which&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4423450">//&nbsp;associated&nbsp;with&nbsp;t,&nbsp;to&nbsp;guarantee&nbsp;that&nbsp;the&nbsp;output&nbsp;of&nbsp;any&nbsp;of&nbsp;the&nbsp;named</span><br>
<span class="lineno"></span><span class="comment" id="4423521">//&nbsp;templates&nbsp;is&nbsp;properly&nbsp;escaped.&nbsp;&nbsp;If&nbsp;no&nbsp;error&nbsp;is&nbsp;returned,&nbsp;then&nbsp;the&nbsp;named&nbsp;templates&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4423611">//&nbsp;been&nbsp;modified.&nbsp;&nbsp;Otherwise&nbsp;the&nbsp;named&nbsp;templates&nbsp;have&nbsp;been&nbsp;rendered</span><br>
<span class="lineno">20</span><span class="comment" id="4423679">//&nbsp;unusable.</span><br>
<span class="lineno"></span><span class="keyword" id="4423692">func</span>&nbsp;<span class="ident" id="4423697">escapeTemplate</span><span class="op" id="4423711">(</span><span class="ident" id="4423712">tmpl</span>&nbsp;<span class="op" id="4423717">*</span><span class="ident" id="4423718"><a href="/html/template/template.go.html#4466081">Template</a></span><span class="op" id="4423726">,</span>&nbsp;<span class="ident" id="4423728">node</span>&nbsp;<span class="ident" id="4423733"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4423738">.</span><span class="ident" id="4423739">Node</span><span class="op" id="4423743">,</span>&nbsp;<span class="ident" id="4423745">name</span>&nbsp;<span class="builtintype" id="4423750">string</span><span class="op" id="4423756">)</span>&nbsp;<span class="builtintype" id="4423758">error</span>&nbsp;<span class="op" id="4423764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423767">e</span>&nbsp;<span class="op" id="4423769">:=</span>&nbsp;<span class="ident" id="4423772"><a href="/html/template/escape.go.html#4426445">newEscaper</a></span><span class="op" id="4423782">(</span><span class="ident" id="4423783"><a href="/html/template/escape.go.html#4423712">tmpl</a></span><span class="op" id="4423787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423790">c</span><span class="op" id="4423791">,</span>&nbsp;<span class="ident" id="4423793">_</span>&nbsp;<span class="op" id="4423795">:=</span>&nbsp;<span class="ident" id="4423798"><a href="/html/template/escape.go.html#4423767">e</a></span><span class="op" id="4423799">.</span><span class="ident" id="4423800">escapeTree</span><span class="op" id="4423810">(</span><span class="ident" id="4423811"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4423818">{</span><span class="op" id="4423819">}</span><span class="op" id="4423820">,</span>&nbsp;<span class="ident" id="4423822"><a href="/html/template/escape.go.html#4423728">node</a></span><span class="op" id="4423826">,</span>&nbsp;<span class="ident" id="4423828"><a href="/html/template/escape.go.html#4423745">name</a></span><span class="op" id="4423832">,</span>&nbsp;<span class="num" id="4423834">0</span><span class="op" id="4423835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423838">var</span>&nbsp;<span class="ident" id="4423842">err</span>&nbsp;<span class="builtintype" id="4423846">error</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423853">if</span>&nbsp;<span class="ident" id="4423856"><a href="/html/template/escape.go.html#4423790">c</a></span><span class="op" id="4423857">.</span><span class="ident" id="4423858">err</span>&nbsp;<span class="op" id="4423862">!=</span>&nbsp;<span class="ident" id="4423865">nil</span>&nbsp;<span class="op" id="4423869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423873"><a href="/html/template/escape.go.html#4423842">err</a></span><span class="op" id="4423876">,</span>&nbsp;<span class="ident" id="4423878"><a href="/html/template/escape.go.html#4423790">c</a></span><span class="op" id="4423879">.</span><span class="ident" id="4423880">err</span><span class="op" id="4423883">.</span><span class="ident" id="4423884">Name</span>&nbsp;<span class="op" id="4423889">=</span>&nbsp;<span class="ident" id="4423891"><a href="/html/template/escape.go.html#4423790">c</a></span><span class="op" id="4423892">.</span><span class="ident" id="4423893">err</span><span class="op" id="4423896">,</span>&nbsp;<span class="ident" id="4423898"><a href="/html/template/escape.go.html#4423745">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4423904">}</span>&nbsp;<span class="keyword" id="4423906">else</span>&nbsp;<span class="keyword" id="4423911">if</span>&nbsp;<span class="ident" id="4423914"><a href="/html/template/escape.go.html#4423790">c</a></span><span class="op" id="4423915">.</span><span class="ident" id="4423916">state</span>&nbsp;<span class="op" id="4423922">!=</span>&nbsp;<span class="ident" id="4423925"><a href="/html/template/context.go.html#4394308">stateText</a></span>&nbsp;<span class="op" id="4423935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423939"><a href="/html/template/escape.go.html#4423842">err</a></span>&nbsp;<span class="op" id="4423943">=</span>&nbsp;<span class="op" id="4423945">&amp;</span><span class="ident" id="4423946"><a href="/html/template/error.go.html#4415791">Error</a></span><span class="op" id="4423951">{</span><span class="ident" id="4423952"><a href="/html/template/error.go.html#4419491">ErrEndContext</a></span><span class="op" id="4423965">,</span>&nbsp;<span class="ident" id="4423967">nil</span><span class="op" id="4423970">,</span>&nbsp;<span class="ident" id="4423972"><a href="/html/template/escape.go.html#4423745">name</a></span><span class="op" id="4423976">,</span>&nbsp;<span class="num" id="4423978">0</span><span class="op" id="4423979">,</span>&nbsp;<span class="ident" id="4423981"><a href="/html/template/escape.go.html#4423326">fmt</a></span><span class="op" id="4423984">.</span><span class="ident" id="4423985">Sprintf</span><span class="op" id="4423992">(</span><span class="string" id="4423993">&#34;ends&nbsp;in&nbsp;a&nbsp;non-text&nbsp;context:&nbsp;%v&#34;</span><span class="op" id="4424025">,</span>&nbsp;<span class="ident" id="4424027"><a href="/html/template/escape.go.html#4423790">c</a></span><span class="op" id="4424028">)</span><span class="op" id="4424029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4424032">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424035">if</span>&nbsp;<span class="ident" id="4424038"><a href="/html/template/escape.go.html#4423842">err</a></span>&nbsp;<span class="op" id="4424042">!=</span>&nbsp;<span class="ident" id="4424045">nil</span>&nbsp;<span class="op" id="4424049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424053">//&nbsp;Prevent&nbsp;execution&nbsp;of&nbsp;unsafe&nbsp;templates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424097">if</span>&nbsp;<span class="ident" id="4424100">t</span>&nbsp;<span class="op" id="4424102">:=</span>&nbsp;<span class="ident" id="4424105"><a href="/html/template/escape.go.html#4423712">tmpl</a></span><span class="op" id="4424109">.</span><span class="ident" id="4424110">set</span><span class="op" id="4424113">[</span><span class="ident" id="4424114"><a href="/html/template/escape.go.html#4423745">name</a></span><span class="op" id="4424118">]</span><span class="op" id="4424119">;</span>&nbsp;<span class="ident" id="4424121"><a href="/html/template/escape.go.html#4424100">t</a></span>&nbsp;<span class="op" id="4424123">!=</span>&nbsp;<span class="ident" id="4424126">nil</span>&nbsp;<span class="op" id="4424130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424135"><a href="/html/template/escape.go.html#4424100">t</a></span><span class="op" id="4424136">.</span><span class="ident" id="4424137">escapeErr</span>&nbsp;<span class="op" id="4424147">=</span>&nbsp;<span class="ident" id="4424149"><a href="/html/template/escape.go.html#4423842">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424156"><a href="/html/template/escape.go.html#4424100">t</a></span><span class="op" id="4424157">.</span><span class="ident" id="4424158">text</span><span class="op" id="4424162">.</span><span class="ident" id="4424163">Tree</span>&nbsp;<span class="op" id="4424168">=</span>&nbsp;<span class="ident" id="4424170">nil</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424177"><a href="/html/template/escape.go.html#4424100">t</a></span><span class="op" id="4424178">.</span><span class="ident" id="4424179">Tree</span>&nbsp;<span class="op" id="4424184">=</span>&nbsp;<span class="ident" id="4424186">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4424192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424196">return</span>&nbsp;<span class="ident" id="4424203"><a href="/html/template/escape.go.html#4423842">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4424208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424211"><a href="/html/template/escape.go.html#4423767">e</a></span><span class="op" id="4424212">.</span><span class="ident" id="4424213">commit</span><span class="op" id="4424219">(</span><span class="op" id="4424220">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424223">if</span>&nbsp;<span class="ident" id="4424226">t</span>&nbsp;<span class="op" id="4424228">:=</span>&nbsp;<span class="ident" id="4424231"><a href="/html/template/escape.go.html#4423712">tmpl</a></span><span class="op" id="4424235">.</span><span class="ident" id="4424236">set</span><span class="op" id="4424239">[</span><span class="ident" id="4424240"><a href="/html/template/escape.go.html#4423745">name</a></span><span class="op" id="4424244">]</span><span class="op" id="4424245">;</span>&nbsp;<span class="ident" id="4424247"><a href="/html/template/escape.go.html#4424226">t</a></span>&nbsp;<span class="op" id="4424249">!=</span>&nbsp;<span class="ident" id="4424252">nil</span>&nbsp;<span class="op" id="4424256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424260"><a href="/html/template/escape.go.html#4424226">t</a></span><span class="op" id="4424261">.</span><span class="ident" id="4424262">escapeErr</span>&nbsp;<span class="op" id="4424272">=</span>&nbsp;<span class="ident" id="4424274"><a href="/html/template/template.go.html#4466557">escapeOK</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424285"><a href="/html/template/escape.go.html#4424226">t</a></span><span class="op" id="4424286">.</span><span class="ident" id="4424287">Tree</span>&nbsp;<span class="op" id="4424292">=</span>&nbsp;<span class="ident" id="4424294"><a href="/html/template/escape.go.html#4424226">t</a></span><span class="op" id="4424295">.</span><span class="ident" id="4424296">text</span><span class="op" id="4424300">.</span><span class="ident" id="4424301">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4424307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424310">return</span>&nbsp;<span class="ident" id="4424317">nil</span><br>
<span class="lineno">45</span><span class="op" id="4424321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4424324">//&nbsp;funcMap&nbsp;maps&nbsp;command&nbsp;names&nbsp;to&nbsp;functions&nbsp;that&nbsp;render&nbsp;their&nbsp;inputs&nbsp;safe.</span><br>
<span class="lineno"></span><span class="keyword" id="4424398">var</span>&nbsp;<span class="ident" id="4424402">funcMap</span>&nbsp;<span class="op" id="4424410">=</span>&nbsp;<span class="ident" id="4424412"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4424420">.</span><span class="ident" id="4424421">FuncMap</span><span class="op" id="4424428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424431">&#34;html_template_attrescaper&#34;</span><span class="op" id="4424458">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424464"><a href="/html/template/html.go.html#4448857">attrEscaper</a></span><span class="op" id="4424475">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424478">&#34;html_template_commentescaper&#34;</span><span class="op" id="4424508">:</span>&nbsp;&nbsp;<span class="ident" id="4424511"><a href="/html/template/html.go.html#4455390">commentEscaper</a></span><span class="op" id="4424525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424528">&#34;html_template_cssescaper&#34;</span><span class="op" id="4424554">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424561"><a href="/html/template/css.go.html#4406338">cssEscaper</a></span><span class="op" id="4424571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424574">&#34;html_template_cssvaluefilter&#34;</span><span class="op" id="4424604">:</span>&nbsp;&nbsp;<span class="ident" id="4424607"><a href="/html/template/css.go.html#4407854">cssValueFilter</a></span><span class="op" id="4424621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424624">&#34;html_template_htmlnamefilter&#34;</span><span class="op" id="4424654">:</span>&nbsp;&nbsp;<span class="ident" id="4424657"><a href="/html/template/html.go.html#4454319">htmlNameFilter</a></span><span class="op" id="4424671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424674">&#34;html_template_htmlescaper&#34;</span><span class="op" id="4424701">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424707"><a href="/html/template/html.go.html#4449421">htmlEscaper</a></span><span class="op" id="4424718">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424721">&#34;html_template_jsregexpescaper&#34;</span><span class="op" id="4424752">:</span>&nbsp;<span class="ident" id="4424754"><a href="/html/template/js.go.html#4462754">jsRegexpEscaper</a></span><span class="op" id="4424769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424772">&#34;html_template_jsstrescaper&#34;</span><span class="op" id="4424800">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424805"><a href="/html/template/js.go.html#4462270">jsStrEscaper</a></span><span class="op" id="4424817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424820">&#34;html_template_jsvalescaper&#34;</span><span class="op" id="4424848">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424853"><a href="/html/template/js.go.html#4459859">jsValEscaper</a></span><span class="op" id="4424865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424868">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="4424898">:</span>&nbsp;&nbsp;<span class="ident" id="4424901"><a href="/html/template/html.go.html#4448541">htmlNospaceEscaper</a></span><span class="op" id="4424919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424922">&#34;html_template_rcdataescaper&#34;</span><span class="op" id="4424951">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4424955"><a href="/html/template/html.go.html#4449151">rcdataEscaper</a></span><span class="op" id="4424968">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4424971">&#34;html_template_urlescaper&#34;</span><span class="op" id="4424997">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4425004"><a href="/html/template/url.go.html#4493592">urlEscaper</a></span><span class="op" id="4425014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4425017">&#34;html_template_urlfilter&#34;</span><span class="op" id="4425042">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4425050"><a href="/html/template/url.go.html#4493089">urlFilter</a></span><span class="op" id="4425059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4425062">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="4425091">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4425095"><a href="/html/template/url.go.html#4493978">urlNormalizer</a></span><span class="op" id="4425108">,</span><br>
<span class="lineno"></span><span class="op" id="4425110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4425113">//&nbsp;equivEscapers&nbsp;matches&nbsp;contextual&nbsp;escapers&nbsp;to&nbsp;equivalent&nbsp;template&nbsp;builtins.</span><br>
<span class="lineno"></span><span class="keyword" id="4425191">var</span>&nbsp;<span class="ident" id="4425195">equivEscapers</span>&nbsp;<span class="op" id="4425209">=</span>&nbsp;<span class="keyword" id="4425211">map</span><span class="op" id="4425214">[</span><span class="builtintype" id="4425215">string</span><span class="op" id="4425221">]</span><span class="builtintype" id="4425222">string</span><span class="op" id="4425228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4425231">&#34;html_template_attrescaper&#34;</span><span class="op" id="4425258">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4425263">&#34;html&#34;</span><span class="op" id="4425269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4425272">&#34;html_template_htmlescaper&#34;</span><span class="op" id="4425299">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4425304">&#34;html&#34;</span><span class="op" id="4425310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4425313">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="4425343">:</span>&nbsp;<span class="string" id="4425345">&#34;html&#34;</span><span class="op" id="4425351">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4425354">&#34;html_template_rcdataescaper&#34;</span><span class="op" id="4425383">:</span>&nbsp;&nbsp;<span class="string" id="4425386">&#34;html&#34;</span><span class="op" id="4425392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4425395">&#34;html_template_urlescaper&#34;</span><span class="op" id="4425421">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4425427">&#34;urlquery&#34;</span><span class="op" id="4425437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4425440">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="4425469">:</span>&nbsp;&nbsp;<span class="string" id="4425472">&#34;urlquery&#34;</span><span class="op" id="4425482">,</span><br>
<span class="lineno"></span><span class="op" id="4425484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="4425487">//&nbsp;escaper&nbsp;collects&nbsp;type&nbsp;inferences&nbsp;about&nbsp;templates&nbsp;and&nbsp;changes&nbsp;needed&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span><span class="comment" id="4425566">//&nbsp;templates&nbsp;injection&nbsp;safe.</span><br>
<span class="lineno"></span><span class="keyword" id="4425595">type</span>&nbsp;<span class="ident" id="4425600">escaper</span>&nbsp;<span class="keyword" id="4425608">struct</span>&nbsp;<span class="op" id="4425615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425618">tmpl</span>&nbsp;<span class="op" id="4425623">*</span><span class="ident" id="4425624"><a href="/html/template/template.go.html#4466081">Template</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425634">//&nbsp;output[templateName]&nbsp;is&nbsp;the&nbsp;output&nbsp;context&nbsp;for&nbsp;a&nbsp;templateName&nbsp;that</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425705">//&nbsp;has&nbsp;been&nbsp;mangled&nbsp;to&nbsp;include&nbsp;its&nbsp;input&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425756">output</span>&nbsp;<span class="keyword" id="4425763">map</span><span class="op" id="4425766">[</span><span class="builtintype" id="4425767">string</span><span class="op" id="4425773">]</span><span class="ident" id="4425774"><a href="/html/template/context.go.html#4392413">context</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425783">//&nbsp;derived[c.mangle(name)]&nbsp;maps&nbsp;to&nbsp;a&nbsp;template&nbsp;derived&nbsp;from&nbsp;the&nbsp;template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425856">//&nbsp;named&nbsp;name&nbsp;templateName&nbsp;for&nbsp;the&nbsp;start&nbsp;context&nbsp;c.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425909">derived</span>&nbsp;<span class="keyword" id="4425917">map</span><span class="op" id="4425920">[</span><span class="builtintype" id="4425921">string</span><span class="op" id="4425927">]</span><span class="op" id="4425928">*</span><span class="ident" id="4425929"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4425937">.</span><span class="ident" id="4425938">Template</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425948">//&nbsp;called[templateName]&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;called&nbsp;mangled&nbsp;template&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426016">called</span>&nbsp;<span class="keyword" id="4426023">map</span><span class="op" id="4426026">[</span><span class="builtintype" id="4426027">string</span><span class="op" id="4426033">]</span><span class="builtintype" id="4426034">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426040">//&nbsp;xxxNodeEdits&nbsp;are&nbsp;the&nbsp;accumulated&nbsp;edits&nbsp;to&nbsp;apply&nbsp;during&nbsp;commit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426107">//&nbsp;Such&nbsp;edits&nbsp;are&nbsp;not&nbsp;applied&nbsp;immediately&nbsp;in&nbsp;case&nbsp;a&nbsp;template&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426173">//&nbsp;executes&nbsp;a&nbsp;given&nbsp;template&nbsp;in&nbsp;different&nbsp;escaping&nbsp;contexts.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426235">actionNodeEdits</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="4426253">map</span><span class="op" id="4426256">[</span><span class="op" id="4426257">*</span><span class="ident" id="4426258"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4426263">.</span><span class="ident" id="4426264">ActionNode</span><span class="op" id="4426274">]</span><span class="op" id="4426275">[</span><span class="op" id="4426276">]</span><span class="builtintype" id="4426277">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426285">templateNodeEdits</span>&nbsp;<span class="keyword" id="4426303">map</span><span class="op" id="4426306">[</span><span class="op" id="4426307">*</span><span class="ident" id="4426308"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4426313">.</span><span class="ident" id="4426314">TemplateNode</span><span class="op" id="4426326">]</span><span class="builtintype" id="4426327">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426335">textNodeEdits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4426353">map</span><span class="op" id="4426356">[</span><span class="op" id="4426357">*</span><span class="ident" id="4426358"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4426363">.</span><span class="ident" id="4426364">TextNode</span><span class="op" id="4426372">]</span><span class="op" id="4426373">[</span><span class="op" id="4426374">]</span><span class="builtintype" id="4426375">byte</span><br>
<span class="lineno"></span><span class="op" id="4426380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4426383">//&nbsp;newEscaper&nbsp;creates&nbsp;a&nbsp;blank&nbsp;escaper&nbsp;for&nbsp;the&nbsp;given&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="4426440">func</span>&nbsp;<span class="ident" id="4426445">newEscaper</span><span class="op" id="4426455">(</span><span class="ident" id="4426456">t</span>&nbsp;<span class="op" id="4426458">*</span><span class="ident" id="4426459"><a href="/html/template/template.go.html#4466081">Template</a></span><span class="op" id="4426467">)</span>&nbsp;<span class="op" id="4426469">*</span><span class="ident" id="4426470"><a href="/html/template/escape.go.html#4425600">escaper</a></span>&nbsp;<span class="op" id="4426478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426481">return</span>&nbsp;<span class="op" id="4426488">&amp;</span><span class="ident" id="4426489"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4426496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426500"><a href="/html/template/escape.go.html#4426456">t</a></span><span class="op" id="4426501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426505">map</span><span class="op" id="4426508">[</span><span class="builtintype" id="4426509">string</span><span class="op" id="4426515">]</span><span class="ident" id="4426516"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4426523">{</span><span class="op" id="4426524">}</span><span class="op" id="4426525">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426529">map</span><span class="op" id="4426532">[</span><span class="builtintype" id="4426533">string</span><span class="op" id="4426539">]</span><span class="op" id="4426540">*</span><span class="ident" id="4426541"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4426549">.</span><span class="ident" id="4426550">Template</span><span class="op" id="4426558">{</span><span class="op" id="4426559">}</span><span class="op" id="4426560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426564">map</span><span class="op" id="4426567">[</span><span class="builtintype" id="4426568">string</span><span class="op" id="4426574">]</span><span class="builtintype" id="4426575">bool</span><span class="op" id="4426579">{</span><span class="op" id="4426580">}</span><span class="op" id="4426581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426585">map</span><span class="op" id="4426588">[</span><span class="op" id="4426589">*</span><span class="ident" id="4426590"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4426595">.</span><span class="ident" id="4426596">ActionNode</span><span class="op" id="4426606">]</span><span class="op" id="4426607">[</span><span class="op" id="4426608">]</span><span class="builtintype" id="4426609">string</span><span class="op" id="4426615">{</span><span class="op" id="4426616">}</span><span class="op" id="4426617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426621">map</span><span class="op" id="4426624">[</span><span class="op" id="4426625">*</span><span class="ident" id="4426626"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4426631">.</span><span class="ident" id="4426632">TemplateNode</span><span class="op" id="4426644">]</span><span class="builtintype" id="4426645">string</span><span class="op" id="4426651">{</span><span class="op" id="4426652">}</span><span class="op" id="4426653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426657">map</span><span class="op" id="4426660">[</span><span class="op" id="4426661">*</span><span class="ident" id="4426662"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4426667">.</span><span class="ident" id="4426668">TextNode</span><span class="op" id="4426676">]</span><span class="op" id="4426677">[</span><span class="op" id="4426678">]</span><span class="builtintype" id="4426679">byte</span><span class="op" id="4426683">{</span><span class="op" id="4426684">}</span><span class="op" id="4426685">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426688">}</span><br>
<span class="lineno"></span><span class="op" id="4426690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4426693">//&nbsp;filterFailsafe&nbsp;is&nbsp;an&nbsp;innocuous&nbsp;word&nbsp;that&nbsp;is&nbsp;emitted&nbsp;in&nbsp;place&nbsp;of&nbsp;unsafe&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4426774">//&nbsp;by&nbsp;sanitizer&nbsp;functions.&nbsp;It&nbsp;is&nbsp;not&nbsp;a&nbsp;keyword&nbsp;in&nbsp;any&nbsp;programming&nbsp;language,</span><br>
<span class="lineno">110</span><span class="comment" id="4426850">//&nbsp;contains&nbsp;no&nbsp;special&nbsp;characters,&nbsp;is&nbsp;not&nbsp;empty,&nbsp;and&nbsp;when&nbsp;it&nbsp;appears&nbsp;in&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="4426929">//&nbsp;it&nbsp;is&nbsp;distinct&nbsp;enough&nbsp;that&nbsp;a&nbsp;developer&nbsp;can&nbsp;find&nbsp;the&nbsp;source&nbsp;of&nbsp;the&nbsp;problem</span><br>
<span class="lineno"></span><span class="comment" id="4427006">//&nbsp;via&nbsp;a&nbsp;search&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="4427030">const</span>&nbsp;<span class="ident" id="4427036">filterFailsafe</span>&nbsp;<span class="op" id="4427051">=</span>&nbsp;<span class="string" id="4427053">&#34;ZgotmplZ&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4427065">//&nbsp;escape&nbsp;escapes&nbsp;a&nbsp;template&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4427100">func</span>&nbsp;<span class="op" id="4427105">(</span><span class="ident" id="4427106">e</span>&nbsp;<span class="op" id="4427108">*</span><span class="ident" id="4427109"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4427116">)</span>&nbsp;<span class="ident" id="4427118">escape</span><span class="op" id="4427124">(</span><span class="ident" id="4427125">c</span>&nbsp;<span class="ident" id="4427127"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4427134">,</span>&nbsp;<span class="ident" id="4427136">n</span>&nbsp;<span class="ident" id="4427138"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4427143">.</span><span class="ident" id="4427144">Node</span><span class="op" id="4427148">)</span>&nbsp;<span class="ident" id="4427150"><a href="/html/template/context.go.html#4392413">context</a></span>&nbsp;<span class="op" id="4427158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427161">switch</span>&nbsp;<span class="ident" id="4427168">n</span>&nbsp;<span class="op" id="4427170">:=</span>&nbsp;<span class="ident" id="4427173"><a href="/html/template/escape.go.html#4427136">n</a></span><span class="op" id="4427174">.</span><span class="op" id="4427175">(</span><span class="keyword" id="4427176">type</span><span class="op" id="4427180">)</span>&nbsp;<span class="op" id="4427182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427185">case</span>&nbsp;<span class="op" id="4427190">*</span><span class="ident" id="4427191"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4427196">.</span><span class="ident" id="4427197">ActionNode</span><span class="op" id="4427207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427211">return</span>&nbsp;<span class="ident" id="4427218"><a href="/html/template/escape.go.html#4427106">e</a></span><span class="op" id="4427219">.</span><span class="ident" id="4427220">escapeAction</span><span class="op" id="4427232">(</span><span class="ident" id="4427233"><a href="/html/template/escape.go.html#4427125">c</a></span><span class="op" id="4427234">,</span>&nbsp;<span class="ident" id="4427236"><a href="/html/template/escape.go.html#4427168">n</a></span><span class="op" id="4427237">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427240">case</span>&nbsp;<span class="op" id="4427245">*</span><span class="ident" id="4427246"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4427251">.</span><span class="ident" id="4427252">IfNode</span><span class="op" id="4427258">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427262">return</span>&nbsp;<span class="ident" id="4427269"><a href="/html/template/escape.go.html#4427106">e</a></span><span class="op" id="4427270">.</span><span class="ident" id="4427271">escapeBranch</span><span class="op" id="4427283">(</span><span class="ident" id="4427284"><a href="/html/template/escape.go.html#4427125">c</a></span><span class="op" id="4427285">,</span>&nbsp;<span class="op" id="4427287">&amp;</span><span class="ident" id="4427288"><a href="/html/template/escape.go.html#4427168">n</a></span><span class="op" id="4427289">.</span><span class="ident" id="4427290">BranchNode</span><span class="op" id="4427300">,</span>&nbsp;<span class="string" id="4427302">&#34;if&#34;</span><span class="op" id="4427306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427309">case</span>&nbsp;<span class="op" id="4427314">*</span><span class="ident" id="4427315"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4427320">.</span><span class="ident" id="4427321">ListNode</span><span class="op" id="4427329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427333">return</span>&nbsp;<span class="ident" id="4427340"><a href="/html/template/escape.go.html#4427106">e</a></span><span class="op" id="4427341">.</span><span class="ident" id="4427342">escapeList</span><span class="op" id="4427352">(</span><span class="ident" id="4427353"><a href="/html/template/escape.go.html#4427125">c</a></span><span class="op" id="4427354">,</span>&nbsp;<span class="ident" id="4427356"><a href="/html/template/escape.go.html#4427168">n</a></span><span class="op" id="4427357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427360">case</span>&nbsp;<span class="op" id="4427365">*</span><span class="ident" id="4427366"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4427371">.</span><span class="ident" id="4427372">RangeNode</span><span class="op" id="4427381">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427385">return</span>&nbsp;<span class="ident" id="4427392"><a href="/html/template/escape.go.html#4427106">e</a></span><span class="op" id="4427393">.</span><span class="ident" id="4427394">escapeBranch</span><span class="op" id="4427406">(</span><span class="ident" id="4427407"><a href="/html/template/escape.go.html#4427125">c</a></span><span class="op" id="4427408">,</span>&nbsp;<span class="op" id="4427410">&amp;</span><span class="ident" id="4427411"><a href="/html/template/escape.go.html#4427168">n</a></span><span class="op" id="4427412">.</span><span class="ident" id="4427413">BranchNode</span><span class="op" id="4427423">,</span>&nbsp;<span class="string" id="4427425">&#34;range&#34;</span><span class="op" id="4427432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427435">case</span>&nbsp;<span class="op" id="4427440">*</span><span class="ident" id="4427441"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4427446">.</span><span class="ident" id="4427447">TemplateNode</span><span class="op" id="4427459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427463">return</span>&nbsp;<span class="ident" id="4427470"><a href="/html/template/escape.go.html#4427106">e</a></span><span class="op" id="4427471">.</span><span class="ident" id="4427472">escapeTemplate</span><span class="op" id="4427486">(</span><span class="ident" id="4427487"><a href="/html/template/escape.go.html#4427125">c</a></span><span class="op" id="4427488">,</span>&nbsp;<span class="ident" id="4427490"><a href="/html/template/escape.go.html#4427168">n</a></span><span class="op" id="4427491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427494">case</span>&nbsp;<span class="op" id="4427499">*</span><span class="ident" id="4427500"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4427505">.</span><span class="ident" id="4427506">TextNode</span><span class="op" id="4427514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427518">return</span>&nbsp;<span class="ident" id="4427525"><a href="/html/template/escape.go.html#4427106">e</a></span><span class="op" id="4427526">.</span><span class="ident" id="4427527">escapeText</span><span class="op" id="4427537">(</span><span class="ident" id="4427538"><a href="/html/template/escape.go.html#4427125">c</a></span><span class="op" id="4427539">,</span>&nbsp;<span class="ident" id="4427541"><a href="/html/template/escape.go.html#4427168">n</a></span><span class="op" id="4427542">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427545">case</span>&nbsp;<span class="op" id="4427550">*</span><span class="ident" id="4427551"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4427556">.</span><span class="ident" id="4427557">WithNode</span><span class="op" id="4427565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427569">return</span>&nbsp;<span class="ident" id="4427576"><a href="/html/template/escape.go.html#4427106">e</a></span><span class="op" id="4427577">.</span><span class="ident" id="4427578">escapeBranch</span><span class="op" id="4427590">(</span><span class="ident" id="4427591"><a href="/html/template/escape.go.html#4427125">c</a></span><span class="op" id="4427592">,</span>&nbsp;<span class="op" id="4427594">&amp;</span><span class="ident" id="4427595"><a href="/html/template/escape.go.html#4427168">n</a></span><span class="op" id="4427596">.</span><span class="ident" id="4427597">BranchNode</span><span class="op" id="4427607">,</span>&nbsp;<span class="string" id="4427609">&#34;with&#34;</span><span class="op" id="4427615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4427621">panic</span><span class="op" id="4427626">(</span><span class="string" id="4427627">&#34;escaping&nbsp;&#34;</span>&nbsp;<span class="op" id="4427639">+</span>&nbsp;<span class="ident" id="4427641"><a href="/html/template/escape.go.html#4427136">n</a></span><span class="op" id="4427642">.</span><span class="ident" id="4427643">String</span><span class="op" id="4427649">(</span><span class="op" id="4427650">)</span>&nbsp;<span class="op" id="4427652">+</span>&nbsp;<span class="string" id="4427654">&#34;&nbsp;is&nbsp;unimplemented&#34;</span><span class="op" id="4427673">)</span><br>
<span class="lineno"></span><span class="op" id="4427675">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="4427678">//&nbsp;escapeAction&nbsp;escapes&nbsp;an&nbsp;action&nbsp;template&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4427727">func</span>&nbsp;<span class="op" id="4427732">(</span><span class="ident" id="4427733">e</span>&nbsp;<span class="op" id="4427735">*</span><span class="ident" id="4427736"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4427743">)</span>&nbsp;<span class="ident" id="4427745">escapeAction</span><span class="op" id="4427757">(</span><span class="ident" id="4427758">c</span>&nbsp;<span class="ident" id="4427760"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4427767">,</span>&nbsp;<span class="ident" id="4427769">n</span>&nbsp;<span class="op" id="4427771">*</span><span class="ident" id="4427772"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4427777">.</span><span class="ident" id="4427778">ActionNode</span><span class="op" id="4427788">)</span>&nbsp;<span class="ident" id="4427790"><a href="/html/template/context.go.html#4392413">context</a></span>&nbsp;<span class="op" id="4427798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427801">if</span>&nbsp;<span class="builtinfunc" id="4427804">len</span><span class="op" id="4427807">(</span><span class="ident" id="4427808"><a href="/html/template/escape.go.html#4427769">n</a></span><span class="op" id="4427809">.</span><span class="ident" id="4427810">Pipe</span><span class="op" id="4427814">.</span><span class="ident" id="4427815">Decl</span><span class="op" id="4427819">)</span>&nbsp;<span class="op" id="4427821">!=</span>&nbsp;<span class="num" id="4427824">0</span>&nbsp;<span class="op" id="4427826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427830">//&nbsp;A&nbsp;local&nbsp;variable&nbsp;assignment,&nbsp;not&nbsp;an&nbsp;interpolation.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427886">return</span>&nbsp;<span class="ident" id="4427893"><a href="/html/template/escape.go.html#4427758">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427899"><a href="/html/template/escape.go.html#4427758">c</a></span>&nbsp;<span class="op" id="4427901">=</span>&nbsp;<span class="ident" id="4427903"><a href="/html/template/escape.go.html#4434063">nudge</a></span><span class="op" id="4427908">(</span><span class="ident" id="4427909"><a href="/html/template/escape.go.html#4427758">c</a></span><span class="op" id="4427910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427913">s</span>&nbsp;<span class="op" id="4427915">:=</span>&nbsp;<span class="builtinfunc" id="4427918">make</span><span class="op" id="4427922">(</span><span class="op" id="4427923">[</span><span class="op" id="4427924">]</span><span class="builtintype" id="4427925">string</span><span class="op" id="4427931">,</span>&nbsp;<span class="num" id="4427933">0</span><span class="op" id="4427934">,</span>&nbsp;<span class="num" id="4427936">3</span><span class="op" id="4427937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427940">switch</span>&nbsp;<span class="ident" id="4427947"><a href="/html/template/escape.go.html#4427758">c</a></span><span class="op" id="4427948">.</span><span class="ident" id="4427949">state</span>&nbsp;<span class="op" id="4427955">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427958">case</span>&nbsp;<span class="ident" id="4427963"><a href="/html/template/context.go.html#4396369">stateError</a></span><span class="op" id="4427973">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427977">return</span>&nbsp;<span class="ident" id="4427984"><a href="/html/template/escape.go.html#4427758">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427987">case</span>&nbsp;<span class="ident" id="4427992"><a href="/html/template/context.go.html#4395194">stateURL</a></span><span class="op" id="4428000">,</span>&nbsp;<span class="ident" id="4428002"><a href="/html/template/context.go.html#4395810">stateCSSDqStr</a></span><span class="op" id="4428015">,</span>&nbsp;<span class="ident" id="4428017"><a href="/html/template/context.go.html#4395885">stateCSSSqStr</a></span><span class="op" id="4428030">,</span>&nbsp;<span class="ident" id="4428032"><a href="/html/template/context.go.html#4395964">stateCSSDqURL</a></span><span class="op" id="4428045">,</span>&nbsp;<span class="ident" id="4428047"><a href="/html/template/context.go.html#4396043">stateCSSSqURL</a></span><span class="op" id="4428060">,</span>&nbsp;<span class="ident" id="4428062"><a href="/html/template/context.go.html#4396113">stateCSSURL</a></span><span class="op" id="4428073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428077">switch</span>&nbsp;<span class="ident" id="4428084"><a href="/html/template/escape.go.html#4427758">c</a></span><span class="op" id="4428085">.</span><span class="ident" id="4428086">urlPart</span>&nbsp;<span class="op" id="4428094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428098">case</span>&nbsp;<span class="ident" id="4428103"><a href="/html/template/context.go.html#4398943">urlPartNone</a></span><span class="op" id="4428114">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428119"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4428121">=</span>&nbsp;<span class="builtinfunc" id="4428123">append</span><span class="op" id="4428129">(</span><span class="ident" id="4428130"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4428131">,</span>&nbsp;<span class="string" id="4428133">&#34;html_template_urlfilter&#34;</span><span class="op" id="4428158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428163">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428177">case</span>&nbsp;<span class="ident" id="4428182"><a href="/html/template/context.go.html#4399086">urlPartPreQuery</a></span><span class="op" id="4428197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428202">switch</span>&nbsp;<span class="ident" id="4428209"><a href="/html/template/escape.go.html#4427758">c</a></span><span class="op" id="4428210">.</span><span class="ident" id="4428211">state</span>&nbsp;<span class="op" id="4428217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428222">case</span>&nbsp;<span class="ident" id="4428227"><a href="/html/template/context.go.html#4395810">stateCSSDqStr</a></span><span class="op" id="4428240">,</span>&nbsp;<span class="ident" id="4428242"><a href="/html/template/context.go.html#4395885">stateCSSSqStr</a></span><span class="op" id="4428255">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428261"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4428263">=</span>&nbsp;<span class="builtinfunc" id="4428265">append</span><span class="op" id="4428271">(</span><span class="ident" id="4428272"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4428273">,</span>&nbsp;<span class="string" id="4428275">&#34;html_template_cssescaper&#34;</span><span class="op" id="4428301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428306">default</span><span class="op" id="4428313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428319"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4428321">=</span>&nbsp;<span class="builtinfunc" id="4428323">append</span><span class="op" id="4428329">(</span><span class="ident" id="4428330"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4428331">,</span>&nbsp;<span class="string" id="4428333">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="4428362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428371">case</span>&nbsp;<span class="ident" id="4428376"><a href="/html/template/context.go.html#4399207">urlPartQueryOrFrag</a></span><span class="op" id="4428394">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428399"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4428401">=</span>&nbsp;<span class="builtinfunc" id="4428403">append</span><span class="op" id="4428409">(</span><span class="ident" id="4428410"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4428411">,</span>&nbsp;<span class="string" id="4428413">&#34;html_template_urlescaper&#34;</span><span class="op" id="4428439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428443">case</span>&nbsp;<span class="ident" id="4428448"><a href="/html/template/context.go.html#4399327">urlPartUnknown</a></span><span class="op" id="4428462">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428467">return</span>&nbsp;<span class="ident" id="4428474"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4428481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428487">state</span><span class="op" id="4428492">:</span>&nbsp;<span class="ident" id="4428494"><a href="/html/template/context.go.html#4396369">stateError</a></span><span class="op" id="4428504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428510">err</span><span class="op" id="4428513">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4428517"><a href="/html/template/error.go.html#4422980">errorf</a></span><span class="op" id="4428523">(</span><span class="ident" id="4428524"><a href="/html/template/error.go.html#4417405">ErrAmbigContext</a></span><span class="op" id="4428539">,</span>&nbsp;<span class="ident" id="4428541"><a href="/html/template/escape.go.html#4427769">n</a></span><span class="op" id="4428542">,</span>&nbsp;<span class="ident" id="4428544"><a href="/html/template/escape.go.html#4427769">n</a></span><span class="op" id="4428545">.</span><span class="ident" id="4428546">Line</span><span class="op" id="4428550">,</span>&nbsp;<span class="string" id="4428552">&#34;%s&nbsp;appears&nbsp;in&nbsp;an&nbsp;ambiguous&nbsp;URL&nbsp;context&#34;</span><span class="op" id="4428592">,</span>&nbsp;<span class="ident" id="4428594"><a href="/html/template/escape.go.html#4427769">n</a></span><span class="op" id="4428595">)</span><span class="op" id="4428596">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428605">default</span><span class="op" id="4428612">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4428617">panic</span><span class="op" id="4428622">(</span><span class="ident" id="4428623"><a href="/html/template/escape.go.html#4427758">c</a></span><span class="op" id="4428624">.</span><span class="ident" id="4428625">urlPart</span><span class="op" id="4428632">.</span><span class="ident" id="4428633">String</span><span class="op" id="4428639">(</span><span class="op" id="4428640">)</span><span class="op" id="4428641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428648">case</span>&nbsp;<span class="ident" id="4428653"><a href="/html/template/context.go.html#4395266">stateJS</a></span><span class="op" id="4428660">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428664"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4428666">=</span>&nbsp;<span class="builtinfunc" id="4428668">append</span><span class="op" id="4428674">(</span><span class="ident" id="4428675"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4428676">,</span>&nbsp;<span class="string" id="4428678">&#34;html_template_jsvalescaper&#34;</span><span class="op" id="4428706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4428710">//&nbsp;A&nbsp;slash&nbsp;after&nbsp;a&nbsp;value&nbsp;starts&nbsp;a&nbsp;div&nbsp;operator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428760"><a href="/html/template/escape.go.html#4427758">c</a></span><span class="op" id="4428761">.</span><span class="ident" id="4428762">jsCtx</span>&nbsp;<span class="op" id="4428768">=</span>&nbsp;<span class="ident" id="4428770"><a href="/html/template/context.go.html#4399969">jsCtxDivOp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428782">case</span>&nbsp;<span class="ident" id="4428787"><a href="/html/template/context.go.html#4395341">stateJSDqStr</a></span><span class="op" id="4428799">,</span>&nbsp;<span class="ident" id="4428801"><a href="/html/template/context.go.html#4395421">stateJSSqStr</a></span><span class="op" id="4428813">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428817"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4428819">=</span>&nbsp;<span class="builtinfunc" id="4428821">append</span><span class="op" id="4428827">(</span><span class="ident" id="4428828"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4428829">,</span>&nbsp;<span class="string" id="4428831">&#34;html_template_jsstrescaper&#34;</span><span class="op" id="4428859">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428862">case</span>&nbsp;<span class="ident" id="4428867"><a href="/html/template/context.go.html#4395496">stateJSRegexp</a></span><span class="op" id="4428880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428884"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4428886">=</span>&nbsp;<span class="builtinfunc" id="4428888">append</span><span class="op" id="4428894">(</span><span class="ident" id="4428895"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4428896">,</span>&nbsp;<span class="string" id="4428898">&#34;html_template_jsregexpescaper&#34;</span><span class="op" id="4428929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428932">case</span>&nbsp;<span class="ident" id="4428937"><a href="/html/template/context.go.html#4395740">stateCSS</a></span><span class="op" id="4428945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428949"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4428951">=</span>&nbsp;<span class="builtinfunc" id="4428953">append</span><span class="op" id="4428959">(</span><span class="ident" id="4428960"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4428961">,</span>&nbsp;<span class="string" id="4428963">&#34;html_template_cssvaluefilter&#34;</span><span class="op" id="4428993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428996">case</span>&nbsp;<span class="ident" id="4429001"><a href="/html/template/context.go.html#4394308">stateText</a></span><span class="op" id="4429010">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429014"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4429016">=</span>&nbsp;<span class="builtinfunc" id="4429018">append</span><span class="op" id="4429024">(</span><span class="ident" id="4429025"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4429026">,</span>&nbsp;<span class="string" id="4429028">&#34;html_template_htmlescaper&#34;</span><span class="op" id="4429055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429058">case</span>&nbsp;<span class="ident" id="4429063"><a href="/html/template/context.go.html#4395032">stateRCDATA</a></span><span class="op" id="4429074">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429078"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4429080">=</span>&nbsp;<span class="builtinfunc" id="4429082">append</span><span class="op" id="4429088">(</span><span class="ident" id="4429089"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4429090">,</span>&nbsp;<span class="string" id="4429092">&#34;html_template_rcdataescaper&#34;</span><span class="op" id="4429121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429124">case</span>&nbsp;<span class="ident" id="4429129"><a href="/html/template/context.go.html#4395114">stateAttr</a></span><span class="op" id="4429138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4429142">//&nbsp;Handled&nbsp;below&nbsp;in&nbsp;delim&nbsp;check.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429176">case</span>&nbsp;<span class="ident" id="4429181"><a href="/html/template/context.go.html#4394511">stateAttrName</a></span><span class="op" id="4429194">,</span>&nbsp;<span class="ident" id="4429196"><a href="/html/template/context.go.html#4394398">stateTag</a></span><span class="op" id="4429204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429208"><a href="/html/template/escape.go.html#4427758">c</a></span><span class="op" id="4429209">.</span><span class="ident" id="4429210">state</span>&nbsp;<span class="op" id="4429216">=</span>&nbsp;<span class="ident" id="4429218"><a href="/html/template/context.go.html#4394511">stateAttrName</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429234"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4429236">=</span>&nbsp;<span class="builtinfunc" id="4429238">append</span><span class="op" id="4429244">(</span><span class="ident" id="4429245"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4429246">,</span>&nbsp;<span class="string" id="4429248">&#34;html_template_htmlnamefilter&#34;</span><span class="op" id="4429278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429281">default</span><span class="op" id="4429288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429292">if</span>&nbsp;<span class="ident" id="4429295"><a href="/html/template/context.go.html#4397532">isComment</a></span><span class="op" id="4429304">(</span><span class="ident" id="4429305"><a href="/html/template/escape.go.html#4427758">c</a></span><span class="op" id="4429306">.</span><span class="ident" id="4429307">state</span><span class="op" id="4429312">)</span>&nbsp;<span class="op" id="4429314">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429319"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4429321">=</span>&nbsp;<span class="builtinfunc" id="4429323">append</span><span class="op" id="4429329">(</span><span class="ident" id="4429330"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4429331">,</span>&nbsp;<span class="string" id="4429333">&#34;html_template_commentescaper&#34;</span><span class="op" id="4429363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429367">}</span>&nbsp;<span class="keyword" id="4429369">else</span>&nbsp;<span class="op" id="4429374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4429379">panic</span><span class="op" id="4429384">(</span><span class="string" id="4429385">&#34;unexpected&nbsp;state&nbsp;&#34;</span>&nbsp;<span class="op" id="4429405">+</span>&nbsp;<span class="ident" id="4429407"><a href="/html/template/escape.go.html#4427758">c</a></span><span class="op" id="4429408">.</span><span class="ident" id="4429409">state</span><span class="op" id="4429414">.</span><span class="ident" id="4429415">String</span><span class="op" id="4429421">(</span><span class="op" id="4429422">)</span><span class="op" id="4429423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429430">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429433">switch</span>&nbsp;<span class="ident" id="4429440"><a href="/html/template/escape.go.html#4427758">c</a></span><span class="op" id="4429441">.</span><span class="ident" id="4429442">delim</span>&nbsp;<span class="op" id="4429448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429451">case</span>&nbsp;<span class="ident" id="4429456"><a href="/html/template/context.go.html#4398044">delimNone</a></span><span class="op" id="4429465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4429469">//&nbsp;No&nbsp;extra-escaping&nbsp;needed&nbsp;for&nbsp;raw&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429520">case</span>&nbsp;<span class="ident" id="4429525"><a href="/html/template/context.go.html#4398348">delimSpaceOrTagEnd</a></span><span class="op" id="4429543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429547"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4429549">=</span>&nbsp;<span class="builtinfunc" id="4429551">append</span><span class="op" id="4429557">(</span><span class="ident" id="4429558"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4429559">,</span>&nbsp;<span class="string" id="4429561">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="4429591">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429594">default</span><span class="op" id="4429601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429605"><a href="/html/template/escape.go.html#4427913">s</a></span>&nbsp;<span class="op" id="4429607">=</span>&nbsp;<span class="builtinfunc" id="4429609">append</span><span class="op" id="4429615">(</span><span class="ident" id="4429616"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4429617">,</span>&nbsp;<span class="string" id="4429619">&#34;html_template_attrescaper&#34;</span><span class="op" id="4429646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429652"><a href="/html/template/escape.go.html#4427733">e</a></span><span class="op" id="4429653">.</span><span class="ident" id="4429654">editActionNode</span><span class="op" id="4429668">(</span><span class="ident" id="4429669"><a href="/html/template/escape.go.html#4427769">n</a></span><span class="op" id="4429670">,</span>&nbsp;<span class="ident" id="4429672"><a href="/html/template/escape.go.html#4427913">s</a></span><span class="op" id="4429673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429676">return</span>&nbsp;<span class="ident" id="4429683"><a href="/html/template/escape.go.html#4427758">c</a></span><br>
<span class="lineno">205</span><span class="op" id="4429685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4429688">//&nbsp;allIdents&nbsp;returns&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;identifiers&nbsp;under&nbsp;the&nbsp;Ident&nbsp;field&nbsp;of&nbsp;the&nbsp;node,</span><br>
<span class="lineno"></span><span class="comment" id="4429773">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;singleton&nbsp;(Identifier)&nbsp;or&nbsp;a&nbsp;slice&nbsp;(Field).</span><br>
<span class="lineno"></span><span class="keyword" id="4429836">func</span>&nbsp;<span class="ident" id="4429841">allIdents</span><span class="op" id="4429850">(</span><span class="ident" id="4429851">node</span>&nbsp;<span class="ident" id="4429856"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4429861">.</span><span class="ident" id="4429862">Node</span><span class="op" id="4429866">)</span>&nbsp;<span class="op" id="4429868">[</span><span class="op" id="4429869">]</span><span class="builtintype" id="4429870">string</span>&nbsp;<span class="op" id="4429877">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429880">switch</span>&nbsp;<span class="ident" id="4429887">node</span>&nbsp;<span class="op" id="4429892">:=</span>&nbsp;<span class="ident" id="4429895"><a href="/html/template/escape.go.html#4429851">node</a></span><span class="op" id="4429899">.</span><span class="op" id="4429900">(</span><span class="keyword" id="4429901">type</span><span class="op" id="4429905">)</span>&nbsp;<span class="op" id="4429907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429910">case</span>&nbsp;<span class="op" id="4429915">*</span><span class="ident" id="4429916"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4429921">.</span><span class="ident" id="4429922">IdentifierNode</span><span class="op" id="4429936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429940">return</span>&nbsp;<span class="op" id="4429947">[</span><span class="op" id="4429948">]</span><span class="builtintype" id="4429949">string</span><span class="op" id="4429955">{</span><span class="ident" id="4429956"><a href="/html/template/escape.go.html#4429887">node</a></span><span class="op" id="4429960">.</span><span class="ident" id="4429961">Ident</span><span class="op" id="4429966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429969">case</span>&nbsp;<span class="op" id="4429974">*</span><span class="ident" id="4429975"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4429980">.</span><span class="ident" id="4429981">FieldNode</span><span class="op" id="4429990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429994">return</span>&nbsp;<span class="ident" id="4430001"><a href="/html/template/escape.go.html#4429887">node</a></span><span class="op" id="4430005">.</span><span class="ident" id="4430006">Ident</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4430016">panic</span><span class="op" id="4430021">(</span><span class="string" id="4430022">&#34;unidentified&nbsp;node&nbsp;type&nbsp;in&nbsp;allIdents&#34;</span><span class="op" id="4430059">)</span><br>
<span class="lineno"></span><span class="op" id="4430061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4430064">//&nbsp;ensurePipelineContains&nbsp;ensures&nbsp;that&nbsp;the&nbsp;pipeline&nbsp;has&nbsp;commands&nbsp;with</span><br>
<span class="lineno">220</span><span class="comment" id="4430134">//&nbsp;the&nbsp;identifiers&nbsp;in&nbsp;s&nbsp;in&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="4430168">//&nbsp;If&nbsp;the&nbsp;pipeline&nbsp;already&nbsp;has&nbsp;some&nbsp;of&nbsp;the&nbsp;sanitizers,&nbsp;do&nbsp;not&nbsp;interfere.</span><br>
<span class="lineno"></span><span class="comment" id="4430241">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;p&nbsp;is&nbsp;(.X&nbsp;|&nbsp;html)&nbsp;and&nbsp;s&nbsp;is&nbsp;[&#34;escapeJSVal&#34;,&nbsp;&#34;html&#34;]&nbsp;then&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4430318">//&nbsp;has&nbsp;one&nbsp;matching,&nbsp;&#34;html&#34;,&nbsp;and&nbsp;one&nbsp;to&nbsp;insert,&nbsp;&#34;escapeJSVal&#34;,&nbsp;to&nbsp;produce</span><br>
<span class="lineno"></span><span class="comment" id="4430392">//&nbsp;(.X&nbsp;|&nbsp;escapeJSVal&nbsp;|&nbsp;html).</span><br>
<span class="lineno">225</span><span class="keyword" id="4430422">func</span>&nbsp;<span class="ident" id="4430427">ensurePipelineContains</span><span class="op" id="4430449">(</span><span class="ident" id="4430450">p</span>&nbsp;<span class="op" id="4430452">*</span><span class="ident" id="4430453"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4430458">.</span><span class="ident" id="4430459">PipeNode</span><span class="op" id="4430467">,</span>&nbsp;<span class="ident" id="4430469">s</span>&nbsp;<span class="op" id="4430471">[</span><span class="op" id="4430472">]</span><span class="builtintype" id="4430473">string</span><span class="op" id="4430479">)</span>&nbsp;<span class="op" id="4430481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430484">if</span>&nbsp;<span class="builtinfunc" id="4430487">len</span><span class="op" id="4430490">(</span><span class="ident" id="4430491"><a href="/html/template/escape.go.html#4430469">s</a></span><span class="op" id="4430492">)</span>&nbsp;<span class="op" id="4430494">==</span>&nbsp;<span class="num" id="4430497">0</span>&nbsp;<span class="op" id="4430499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430503">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430514">n</span>&nbsp;<span class="op" id="4430516">:=</span>&nbsp;<span class="builtinfunc" id="4430519">len</span><span class="op" id="4430522">(</span><span class="ident" id="4430523"><a href="/html/template/escape.go.html#4430450">p</a></span><span class="op" id="4430524">.</span><span class="ident" id="4430525">Cmds</span><span class="op" id="4430529">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430532">//&nbsp;Find&nbsp;the&nbsp;identifiers&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;command&nbsp;chain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430590">idents</span>&nbsp;<span class="op" id="4430597">:=</span>&nbsp;<span class="ident" id="4430600"><a href="/html/template/escape.go.html#4430450">p</a></span><span class="op" id="4430601">.</span><span class="ident" id="4430602">Cmds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430608">for</span>&nbsp;<span class="ident" id="4430612">i</span>&nbsp;<span class="op" id="4430614">:=</span>&nbsp;<span class="ident" id="4430617"><a href="/html/template/escape.go.html#4430514">n</a></span>&nbsp;<span class="op" id="4430619">-</span>&nbsp;<span class="num" id="4430621">1</span><span class="op" id="4430622">;</span>&nbsp;<span class="ident" id="4430624"><a href="/html/template/escape.go.html#4430612">i</a></span>&nbsp;<span class="op" id="4430626">&gt;=</span>&nbsp;<span class="num" id="4430629">0</span><span class="op" id="4430630">;</span>&nbsp;<span class="ident" id="4430632"><a href="/html/template/escape.go.html#4430612">i</a></span><span class="op" id="4430633">--</span>&nbsp;<span class="op" id="4430636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430640">if</span>&nbsp;<span class="ident" id="4430643">cmd</span>&nbsp;<span class="op" id="4430647">:=</span>&nbsp;<span class="ident" id="4430650"><a href="/html/template/escape.go.html#4430450">p</a></span><span class="op" id="4430651">.</span><span class="ident" id="4430652">Cmds</span><span class="op" id="4430656">[</span><span class="ident" id="4430657"><a href="/html/template/escape.go.html#4430612">i</a></span><span class="op" id="4430658">]</span><span class="op" id="4430659">;</span>&nbsp;<span class="builtinfunc" id="4430661">len</span><span class="op" id="4430664">(</span><span class="ident" id="4430665"><a href="/html/template/escape.go.html#4430643">cmd</a></span><span class="op" id="4430668">.</span><span class="ident" id="4430669">Args</span><span class="op" id="4430673">)</span>&nbsp;<span class="op" id="4430675">!=</span>&nbsp;<span class="num" id="4430678">0</span>&nbsp;<span class="op" id="4430680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430685">if</span>&nbsp;<span class="ident" id="4430688">_</span><span class="op" id="4430689">,</span>&nbsp;<span class="ident" id="4430691">ok</span>&nbsp;<span class="op" id="4430694">:=</span>&nbsp;<span class="ident" id="4430697"><a href="/html/template/escape.go.html#4430643">cmd</a></span><span class="op" id="4430700">.</span><span class="ident" id="4430701">Args</span><span class="op" id="4430705">[</span><span class="num" id="4430706">0</span><span class="op" id="4430707">]</span><span class="op" id="4430708">.</span><span class="op" id="4430709">(</span><span class="op" id="4430710">*</span><span class="ident" id="4430711"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4430716">.</span><span class="ident" id="4430717">IdentifierNode</span><span class="op" id="4430731">)</span><span class="op" id="4430732">;</span>&nbsp;<span class="ident" id="4430734"><a href="/html/template/escape.go.html#4430691">ok</a></span>&nbsp;<span class="op" id="4430737">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430743">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430763"><a href="/html/template/escape.go.html#4430590">idents</a></span>&nbsp;<span class="op" id="4430770">=</span>&nbsp;<span class="ident" id="4430772"><a href="/html/template/escape.go.html#4430450">p</a></span><span class="op" id="4430773">.</span><span class="ident" id="4430774">Cmds</span><span class="op" id="4430778">[</span><span class="ident" id="4430779"><a href="/html/template/escape.go.html#4430612">i</a></span><span class="op" id="4430780">+</span><span class="num" id="4430781">1</span><span class="op" id="4430782">:</span><span class="op" id="4430783">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430786">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430789">dups</span>&nbsp;<span class="op" id="4430794">:=</span>&nbsp;<span class="num" id="4430797">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430800">for</span>&nbsp;<span class="ident" id="4430804">_</span><span class="op" id="4430805">,</span>&nbsp;<span class="ident" id="4430807">idNode</span>&nbsp;<span class="op" id="4430814">:=</span>&nbsp;<span class="keyword" id="4430817">range</span>&nbsp;<span class="ident" id="4430823"><a href="/html/template/escape.go.html#4430590">idents</a></span>&nbsp;<span class="op" id="4430830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430834">for</span>&nbsp;<span class="ident" id="4430838">_</span><span class="op" id="4430839">,</span>&nbsp;<span class="ident" id="4430841">ident</span>&nbsp;<span class="op" id="4430847">:=</span>&nbsp;<span class="keyword" id="4430850">range</span>&nbsp;<span class="ident" id="4430856"><a href="/html/template/escape.go.html#4429841">allIdents</a></span><span class="op" id="4430865">(</span><span class="ident" id="4430866"><a href="/html/template/escape.go.html#4430807">idNode</a></span><span class="op" id="4430872">.</span><span class="ident" id="4430873">Args</span><span class="op" id="4430877">[</span><span class="num" id="4430878">0</span><span class="op" id="4430879">]</span><span class="op" id="4430880">)</span>&nbsp;<span class="op" id="4430882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430887">if</span>&nbsp;<span class="ident" id="4430890"><a href="/html/template/escape.go.html#4432987">escFnsEq</a></span><span class="op" id="4430898">(</span><span class="ident" id="4430899"><a href="/html/template/escape.go.html#4430469">s</a></span><span class="op" id="4430900">[</span><span class="ident" id="4430901"><a href="/html/template/escape.go.html#4430789">dups</a></span><span class="op" id="4430905">]</span><span class="op" id="4430906">,</span>&nbsp;<span class="ident" id="4430908"><a href="/html/template/escape.go.html#4430841">ident</a></span><span class="op" id="4430913">)</span>&nbsp;<span class="op" id="4430915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430921"><a href="/html/template/escape.go.html#4430789">dups</a></span><span class="op" id="4430925">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430932">if</span>&nbsp;<span class="ident" id="4430935"><a href="/html/template/escape.go.html#4430789">dups</a></span>&nbsp;<span class="op" id="4430940">==</span>&nbsp;<span class="builtinfunc" id="4430943">len</span><span class="op" id="4430946">(</span><span class="ident" id="4430947"><a href="/html/template/escape.go.html#4430469">s</a></span><span class="op" id="4430948">)</span>&nbsp;<span class="op" id="4430950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430957">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430977">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430983">newCmds</span>&nbsp;<span class="op" id="4430991">:=</span>&nbsp;<span class="builtinfunc" id="4430994">make</span><span class="op" id="4430998">(</span><span class="op" id="4430999">[</span><span class="op" id="4431000">]</span><span class="op" id="4431001">*</span><span class="ident" id="4431002"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4431007">.</span><span class="ident" id="4431008">CommandNode</span><span class="op" id="4431019">,</span>&nbsp;<span class="ident" id="4431021"><a href="/html/template/escape.go.html#4430514">n</a></span><span class="op" id="4431022">-</span><span class="builtinfunc" id="4431023">len</span><span class="op" id="4431026">(</span><span class="ident" id="4431027"><a href="/html/template/escape.go.html#4430590">idents</a></span><span class="op" id="4431033">)</span><span class="op" id="4431034">,</span>&nbsp;<span class="ident" id="4431036"><a href="/html/template/escape.go.html#4430514">n</a></span><span class="op" id="4431037">+</span><span class="builtinfunc" id="4431038">len</span><span class="op" id="4431041">(</span><span class="ident" id="4431042"><a href="/html/template/escape.go.html#4430469">s</a></span><span class="op" id="4431043">)</span><span class="op" id="4431044">-</span><span class="ident" id="4431045"><a href="/html/template/escape.go.html#4430789">dups</a></span><span class="op" id="4431049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4431052">copy</span><span class="op" id="4431056">(</span><span class="ident" id="4431057"><a href="/html/template/escape.go.html#4430983">newCmds</a></span><span class="op" id="4431064">,</span>&nbsp;<span class="ident" id="4431066"><a href="/html/template/escape.go.html#4430450">p</a></span><span class="op" id="4431067">.</span><span class="ident" id="4431068">Cmds</span><span class="op" id="4431072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431075">//&nbsp;Merge&nbsp;existing&nbsp;identifier&nbsp;commands&nbsp;with&nbsp;the&nbsp;sanitizers&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431142">for</span>&nbsp;<span class="ident" id="4431146">_</span><span class="op" id="4431147">,</span>&nbsp;<span class="ident" id="4431149">idNode</span>&nbsp;<span class="op" id="4431156">:=</span>&nbsp;<span class="keyword" id="4431159">range</span>&nbsp;<span class="ident" id="4431165"><a href="/html/template/escape.go.html#4430590">idents</a></span>&nbsp;<span class="op" id="4431172">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431176">pos</span>&nbsp;<span class="op" id="4431180">:=</span>&nbsp;<span class="ident" id="4431183"><a href="/html/template/escape.go.html#4431149">idNode</a></span><span class="op" id="4431189">.</span><span class="ident" id="4431190">Args</span><span class="op" id="4431194">[</span><span class="num" id="4431195">0</span><span class="op" id="4431196">]</span><span class="op" id="4431197">.</span><span class="ident" id="4431198">Position</span><span class="op" id="4431206">(</span><span class="op" id="4431207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431211">for</span>&nbsp;<span class="ident" id="4431215">_</span><span class="op" id="4431216">,</span>&nbsp;<span class="ident" id="4431218">ident</span>&nbsp;<span class="op" id="4431224">:=</span>&nbsp;<span class="keyword" id="4431227">range</span>&nbsp;<span class="ident" id="4431233"><a href="/html/template/escape.go.html#4429841">allIdents</a></span><span class="op" id="4431242">(</span><span class="ident" id="4431243"><a href="/html/template/escape.go.html#4431149">idNode</a></span><span class="op" id="4431249">.</span><span class="ident" id="4431250">Args</span><span class="op" id="4431254">[</span><span class="num" id="4431255">0</span><span class="op" id="4431256">]</span><span class="op" id="4431257">)</span>&nbsp;<span class="op" id="4431259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431264">i</span>&nbsp;<span class="op" id="4431266">:=</span>&nbsp;<span class="ident" id="4431269"><a href="/html/template/escape.go.html#4432767">indexOfStr</a></span><span class="op" id="4431279">(</span><span class="ident" id="4431280"><a href="/html/template/escape.go.html#4431218">ident</a></span><span class="op" id="4431285">,</span>&nbsp;<span class="ident" id="4431287"><a href="/html/template/escape.go.html#4430469">s</a></span><span class="op" id="4431288">,</span>&nbsp;<span class="ident" id="4431290"><a href="/html/template/escape.go.html#4432987">escFnsEq</a></span><span class="op" id="4431298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431303">if</span>&nbsp;<span class="ident" id="4431306"><a href="/html/template/escape.go.html#4431264">i</a></span>&nbsp;<span class="op" id="4431308">!=</span>&nbsp;<span class="op" id="4431311">-</span><span class="num" id="4431312">1</span>&nbsp;<span class="op" id="4431314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431320">for</span>&nbsp;<span class="ident" id="4431324">_</span><span class="op" id="4431325">,</span>&nbsp;<span class="ident" id="4431327">name</span>&nbsp;<span class="op" id="4431332">:=</span>&nbsp;<span class="keyword" id="4431335">range</span>&nbsp;<span class="ident" id="4431341"><a href="/html/template/escape.go.html#4430469">s</a></span><span class="op" id="4431342">[</span><span class="op" id="4431343">:</span><span class="ident" id="4431344"><a href="/html/template/escape.go.html#4431264">i</a></span><span class="op" id="4431345">]</span>&nbsp;<span class="op" id="4431347">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431354"><a href="/html/template/escape.go.html#4430983">newCmds</a></span>&nbsp;<span class="op" id="4431362">=</span>&nbsp;<span class="ident" id="4431364"><a href="/html/template/escape.go.html#4432361">appendCmd</a></span><span class="op" id="4431373">(</span><span class="ident" id="4431374"><a href="/html/template/escape.go.html#4430983">newCmds</a></span><span class="op" id="4431381">,</span>&nbsp;<span class="ident" id="4431383"><a href="/html/template/escape.go.html#4433206">newIdentCmd</a></span><span class="op" id="4431394">(</span><span class="ident" id="4431395"><a href="/html/template/escape.go.html#4431327">name</a></span><span class="op" id="4431399">,</span>&nbsp;<span class="ident" id="4431401"><a href="/html/template/escape.go.html#4431176">pos</a></span><span class="op" id="4431404">)</span><span class="op" id="4431405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431417"><a href="/html/template/escape.go.html#4430469">s</a></span>&nbsp;<span class="op" id="4431419">=</span>&nbsp;<span class="ident" id="4431421"><a href="/html/template/escape.go.html#4430469">s</a></span><span class="op" id="4431422">[</span><span class="ident" id="4431423"><a href="/html/template/escape.go.html#4431264">i</a></span><span class="op" id="4431424">+</span><span class="num" id="4431425">1</span><span class="op" id="4431426">:</span><span class="op" id="4431427">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431436">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431440"><a href="/html/template/escape.go.html#4430983">newCmds</a></span>&nbsp;<span class="op" id="4431448">=</span>&nbsp;<span class="ident" id="4431450"><a href="/html/template/escape.go.html#4432361">appendCmd</a></span><span class="op" id="4431459">(</span><span class="ident" id="4431460"><a href="/html/template/escape.go.html#4430983">newCmds</a></span><span class="op" id="4431467">,</span>&nbsp;<span class="ident" id="4431469"><a href="/html/template/escape.go.html#4431149">idNode</a></span><span class="op" id="4431475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431481">//&nbsp;Create&nbsp;any&nbsp;remaining&nbsp;sanitizers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431518">for</span>&nbsp;<span class="ident" id="4431522">_</span><span class="op" id="4431523">,</span>&nbsp;<span class="ident" id="4431525">name</span>&nbsp;<span class="op" id="4431530">:=</span>&nbsp;<span class="keyword" id="4431533">range</span>&nbsp;<span class="ident" id="4431539"><a href="/html/template/escape.go.html#4430469">s</a></span>&nbsp;<span class="op" id="4431541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431545"><a href="/html/template/escape.go.html#4430983">newCmds</a></span>&nbsp;<span class="op" id="4431553">=</span>&nbsp;<span class="ident" id="4431555"><a href="/html/template/escape.go.html#4432361">appendCmd</a></span><span class="op" id="4431564">(</span><span class="ident" id="4431565"><a href="/html/template/escape.go.html#4430983">newCmds</a></span><span class="op" id="4431572">,</span>&nbsp;<span class="ident" id="4431574"><a href="/html/template/escape.go.html#4433206">newIdentCmd</a></span><span class="op" id="4431585">(</span><span class="ident" id="4431586"><a href="/html/template/escape.go.html#4431525">name</a></span><span class="op" id="4431590">,</span>&nbsp;<span class="ident" id="4431592"><a href="/html/template/escape.go.html#4430450">p</a></span><span class="op" id="4431593">.</span><span class="ident" id="4431594">Position</span><span class="op" id="4431602">(</span><span class="op" id="4431603">)</span><span class="op" id="4431604">)</span><span class="op" id="4431605">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431611"><a href="/html/template/escape.go.html#4430450">p</a></span><span class="op" id="4431612">.</span><span class="ident" id="4431613">Cmds</span>&nbsp;<span class="op" id="4431618">=</span>&nbsp;<span class="ident" id="4431620"><a href="/html/template/escape.go.html#4430983">newCmds</a></span><br>
<span class="lineno"></span><span class="op" id="4431628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4431631">//&nbsp;redundantFuncs[a][b]&nbsp;implies&nbsp;that&nbsp;funcMap[b](funcMap[a](x))&nbsp;==&nbsp;funcMap[a](x)</span><br>
<span class="lineno">275</span><span class="comment" id="4431711">//&nbsp;for&nbsp;all&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4431725">var</span>&nbsp;<span class="ident" id="4431729">redundantFuncs</span>&nbsp;<span class="op" id="4431744">=</span>&nbsp;<span class="keyword" id="4431746">map</span><span class="op" id="4431749">[</span><span class="builtintype" id="4431750">string</span><span class="op" id="4431756">]</span><span class="keyword" id="4431757">map</span><span class="op" id="4431760">[</span><span class="builtintype" id="4431761">string</span><span class="op" id="4431767">]</span><span class="builtintype" id="4431768">bool</span><span class="op" id="4431772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4431775">&#34;html_template_commentescaper&#34;</span><span class="op" id="4431805">:</span>&nbsp;<span class="op" id="4431807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4431811">&#34;html_template_attrescaper&#34;</span><span class="op" id="4431838">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4431843">true</span><span class="op" id="4431847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4431851">&#34;html_template_nospaceescaper&#34;</span><span class="op" id="4431881">:</span>&nbsp;<span class="builtintype" id="4431883">true</span><span class="op" id="4431887">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4431891">&#34;html_template_htmlescaper&#34;</span><span class="op" id="4431918">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4431923">true</span><span class="op" id="4431927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431930">}</span><span class="op" id="4431931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4431934">&#34;html_template_cssescaper&#34;</span><span class="op" id="4431960">:</span>&nbsp;<span class="op" id="4431962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4431966">&#34;html_template_attrescaper&#34;</span><span class="op" id="4431993">:</span>&nbsp;<span class="builtintype" id="4431995">true</span><span class="op" id="4431999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432002">}</span><span class="op" id="4432003">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4432006">&#34;html_template_jsregexpescaper&#34;</span><span class="op" id="4432037">:</span>&nbsp;<span class="op" id="4432039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4432043">&#34;html_template_attrescaper&#34;</span><span class="op" id="4432070">:</span>&nbsp;<span class="builtintype" id="4432072">true</span><span class="op" id="4432076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432079">}</span><span class="op" id="4432080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4432083">&#34;html_template_jsstrescaper&#34;</span><span class="op" id="4432111">:</span>&nbsp;<span class="op" id="4432113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4432117">&#34;html_template_attrescaper&#34;</span><span class="op" id="4432144">:</span>&nbsp;<span class="builtintype" id="4432146">true</span><span class="op" id="4432150">,</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432153">}</span><span class="op" id="4432154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4432157">&#34;html_template_urlescaper&#34;</span><span class="op" id="4432183">:</span>&nbsp;<span class="op" id="4432185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4432189">&#34;html_template_urlnormalizer&#34;</span><span class="op" id="4432218">:</span>&nbsp;<span class="builtintype" id="4432220">true</span><span class="op" id="4432224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432227">}</span><span class="op" id="4432228">,</span><br>
<span class="lineno"></span><span class="op" id="4432230">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="4432233">//&nbsp;appendCmd&nbsp;appends&nbsp;the&nbsp;given&nbsp;command&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;command&nbsp;pipeline</span><br>
<span class="lineno"></span><span class="comment" id="4432307">//&nbsp;unless&nbsp;it&nbsp;is&nbsp;redundant&nbsp;with&nbsp;the&nbsp;last&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="4432356">func</span>&nbsp;<span class="ident" id="4432361">appendCmd</span><span class="op" id="4432370">(</span><span class="ident" id="4432371">cmds</span>&nbsp;<span class="op" id="4432376">[</span><span class="op" id="4432377">]</span><span class="op" id="4432378">*</span><span class="ident" id="4432379"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4432384">.</span><span class="ident" id="4432385">CommandNode</span><span class="op" id="4432396">,</span>&nbsp;<span class="ident" id="4432398">cmd</span>&nbsp;<span class="op" id="4432402">*</span><span class="ident" id="4432403"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4432408">.</span><span class="ident" id="4432409">CommandNode</span><span class="op" id="4432420">)</span>&nbsp;<span class="op" id="4432422">[</span><span class="op" id="4432423">]</span><span class="op" id="4432424">*</span><span class="ident" id="4432425"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4432430">.</span><span class="ident" id="4432431">CommandNode</span>&nbsp;<span class="op" id="4432443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432446">if</span>&nbsp;<span class="ident" id="4432449">n</span>&nbsp;<span class="op" id="4432451">:=</span>&nbsp;<span class="builtinfunc" id="4432454">len</span><span class="op" id="4432457">(</span><span class="ident" id="4432458"><a href="/html/template/escape.go.html#4432371">cmds</a></span><span class="op" id="4432462">)</span><span class="op" id="4432463">;</span>&nbsp;<span class="ident" id="4432465"><a href="/html/template/escape.go.html#4432449">n</a></span>&nbsp;<span class="op" id="4432467">!=</span>&nbsp;<span class="num" id="4432470">0</span>&nbsp;<span class="op" id="4432472">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432476">last</span><span class="op" id="4432480">,</span>&nbsp;<span class="ident" id="4432482">ok</span>&nbsp;<span class="op" id="4432485">:=</span>&nbsp;<span class="ident" id="4432488"><a href="/html/template/escape.go.html#4432371">cmds</a></span><span class="op" id="4432492">[</span><span class="ident" id="4432493"><a href="/html/template/escape.go.html#4432449">n</a></span><span class="op" id="4432494">-</span><span class="num" id="4432495">1</span><span class="op" id="4432496">]</span><span class="op" id="4432497">.</span><span class="ident" id="4432498">Args</span><span class="op" id="4432502">[</span><span class="num" id="4432503">0</span><span class="op" id="4432504">]</span><span class="op" id="4432505">.</span><span class="op" id="4432506">(</span><span class="op" id="4432507">*</span><span class="ident" id="4432508"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4432513">.</span><span class="ident" id="4432514">IdentifierNode</span><span class="op" id="4432528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432532">next</span><span class="op" id="4432536">,</span>&nbsp;<span class="ident" id="4432538">_</span>&nbsp;<span class="op" id="4432540">:=</span>&nbsp;<span class="ident" id="4432543"><a href="/html/template/escape.go.html#4432398">cmd</a></span><span class="op" id="4432546">.</span><span class="ident" id="4432547">Args</span><span class="op" id="4432551">[</span><span class="num" id="4432552">0</span><span class="op" id="4432553">]</span><span class="op" id="4432554">.</span><span class="op" id="4432555">(</span><span class="op" id="4432556">*</span><span class="ident" id="4432557"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4432562">.</span><span class="ident" id="4432563">IdentifierNode</span><span class="op" id="4432577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432581">if</span>&nbsp;<span class="ident" id="4432584"><a href="/html/template/escape.go.html#4432482">ok</a></span>&nbsp;<span class="op" id="4432587">&amp;&amp;</span>&nbsp;<span class="ident" id="4432590"><a href="/html/template/escape.go.html#4431729">redundantFuncs</a></span><span class="op" id="4432604">[</span><span class="ident" id="4432605"><a href="/html/template/escape.go.html#4432476">last</a></span><span class="op" id="4432609">.</span><span class="ident" id="4432610">Ident</span><span class="op" id="4432615">]</span><span class="op" id="4432616">[</span><span class="ident" id="4432617"><a href="/html/template/escape.go.html#4432532">next</a></span><span class="op" id="4432621">.</span><span class="ident" id="4432622">Ident</span><span class="op" id="4432627">]</span>&nbsp;<span class="op" id="4432629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432634">return</span>&nbsp;<span class="ident" id="4432641"><a href="/html/template/escape.go.html#4432371">cmds</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432648">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432654">return</span>&nbsp;<span class="builtinfunc" id="4432661">append</span><span class="op" id="4432667">(</span><span class="ident" id="4432668"><a href="/html/template/escape.go.html#4432371">cmds</a></span><span class="op" id="4432672">,</span>&nbsp;<span class="ident" id="4432674"><a href="/html/template/escape.go.html#4432398">cmd</a></span><span class="op" id="4432677">)</span><br>
<span class="lineno"></span><span class="op" id="4432679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4432682">//&nbsp;indexOfStr&nbsp;is&nbsp;the&nbsp;first&nbsp;i&nbsp;such&nbsp;that&nbsp;eq(s,&nbsp;strs[i])&nbsp;or&nbsp;-1&nbsp;if&nbsp;s&nbsp;was&nbsp;not&nbsp;found.</span><br>
<span class="lineno">310</span><span class="keyword" id="4432762">func</span>&nbsp;<span class="ident" id="4432767">indexOfStr</span><span class="op" id="4432777">(</span><span class="ident" id="4432778">s</span>&nbsp;<span class="builtintype" id="4432780">string</span><span class="op" id="4432786">,</span>&nbsp;<span class="ident" id="4432788">strs</span>&nbsp;<span class="op" id="4432793">[</span><span class="op" id="4432794">]</span><span class="builtintype" id="4432795">string</span><span class="op" id="4432801">,</span>&nbsp;<span class="ident" id="4432803">eq</span>&nbsp;<span class="keyword" id="4432806">func</span><span class="op" id="4432810">(</span><span class="ident" id="4432811">a</span><span class="op" id="4432812">,</span>&nbsp;<span class="ident" id="4432814">b</span>&nbsp;<span class="builtintype" id="4432816">string</span><span class="op" id="4432822">)</span>&nbsp;<span class="builtintype" id="4432824">bool</span><span class="op" id="4432828">)</span>&nbsp;<span class="builtintype" id="4432830">int</span>&nbsp;<span class="op" id="4432834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432837">for</span>&nbsp;<span class="ident" id="4432841">i</span><span class="op" id="4432842">,</span>&nbsp;<span class="ident" id="4432844">t</span>&nbsp;<span class="op" id="4432846">:=</span>&nbsp;<span class="keyword" id="4432849">range</span>&nbsp;<span class="ident" id="4432855"><a href="/html/template/escape.go.html#4432788">strs</a></span>&nbsp;<span class="op" id="4432860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432864">if</span>&nbsp;<span class="ident" id="4432867"><a href="/html/template/escape.go.html#4432803">eq</a></span><span class="op" id="4432869">(</span><span class="ident" id="4432870"><a href="/html/template/escape.go.html#4432778">s</a></span><span class="op" id="4432871">,</span>&nbsp;<span class="ident" id="4432873"><a href="/html/template/escape.go.html#4432844">t</a></span><span class="op" id="4432874">)</span>&nbsp;<span class="op" id="4432876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432881">return</span>&nbsp;<span class="ident" id="4432888"><a href="/html/template/escape.go.html#4432841">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432892">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432898">return</span>&nbsp;<span class="op" id="4432905">-</span><span class="num" id="4432906">1</span><br>
<span class="lineno"></span><span class="op" id="4432908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4432911">//&nbsp;escFnsEq&nbsp;reports&nbsp;whether&nbsp;the&nbsp;two&nbsp;escaping&nbsp;functions&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno">320</span><span class="keyword" id="4432982">func</span>&nbsp;<span class="ident" id="4432987">escFnsEq</span><span class="op" id="4432995">(</span><span class="ident" id="4432996">a</span><span class="op" id="4432997">,</span>&nbsp;<span class="ident" id="4432999">b</span>&nbsp;<span class="builtintype" id="4433001">string</span><span class="op" id="4433007">)</span>&nbsp;<span class="builtintype" id="4433009">bool</span>&nbsp;<span class="op" id="4433014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433017">if</span>&nbsp;<span class="ident" id="4433020">e</span>&nbsp;<span class="op" id="4433022">:=</span>&nbsp;<span class="ident" id="4433025"><a href="/html/template/escape.go.html#4425195">equivEscapers</a></span><span class="op" id="4433038">[</span><span class="ident" id="4433039"><a href="/html/template/escape.go.html#4432996">a</a></span><span class="op" id="4433040">]</span><span class="op" id="4433041">;</span>&nbsp;<span class="ident" id="4433043"><a href="/html/template/escape.go.html#4433020">e</a></span>&nbsp;<span class="op" id="4433045">!=</span>&nbsp;<span class="string" id="4433048">&#34;&#34;</span>&nbsp;<span class="op" id="4433051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433055"><a href="/html/template/escape.go.html#4432996">a</a></span>&nbsp;<span class="op" id="4433057">=</span>&nbsp;<span class="ident" id="4433059"><a href="/html/template/escape.go.html#4433020">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433065">if</span>&nbsp;<span class="ident" id="4433068">e</span>&nbsp;<span class="op" id="4433070">:=</span>&nbsp;<span class="ident" id="4433073"><a href="/html/template/escape.go.html#4425195">equivEscapers</a></span><span class="op" id="4433086">[</span><span class="ident" id="4433087"><a href="/html/template/escape.go.html#4432999">b</a></span><span class="op" id="4433088">]</span><span class="op" id="4433089">;</span>&nbsp;<span class="ident" id="4433091"><a href="/html/template/escape.go.html#4433068">e</a></span>&nbsp;<span class="op" id="4433093">!=</span>&nbsp;<span class="string" id="4433096">&#34;&#34;</span>&nbsp;<span class="op" id="4433099">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433103"><a href="/html/template/escape.go.html#4432999">b</a></span>&nbsp;<span class="op" id="4433105">=</span>&nbsp;<span class="ident" id="4433107"><a href="/html/template/escape.go.html#4433068">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433113">return</span>&nbsp;<span class="ident" id="4433120"><a href="/html/template/escape.go.html#4432996">a</a></span>&nbsp;<span class="op" id="4433122">==</span>&nbsp;<span class="ident" id="4433125"><a href="/html/template/escape.go.html#4432999">b</a></span><br>
<span class="lineno"></span><span class="op" id="4433127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span><span class="comment" id="4433130">//&nbsp;newIdentCmd&nbsp;produces&nbsp;a&nbsp;command&nbsp;containing&nbsp;a&nbsp;single&nbsp;identifier&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4433201">func</span>&nbsp;<span class="ident" id="4433206">newIdentCmd</span><span class="op" id="4433217">(</span><span class="ident" id="4433218">identifier</span>&nbsp;<span class="builtintype" id="4433229">string</span><span class="op" id="4433235">,</span>&nbsp;<span class="ident" id="4433237">pos</span>&nbsp;<span class="ident" id="4433241"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4433246">.</span><span class="ident" id="4433247">Pos</span><span class="op" id="4433250">)</span>&nbsp;<span class="op" id="4433252">*</span><span class="ident" id="4433253"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4433258">.</span><span class="ident" id="4433259">CommandNode</span>&nbsp;<span class="op" id="4433271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433274">return</span>&nbsp;<span class="op" id="4433281">&amp;</span><span class="ident" id="4433282"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4433287">.</span><span class="ident" id="4433288">CommandNode</span><span class="op" id="4433299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433303">NodeType</span><span class="op" id="4433311">:</span>&nbsp;<span class="ident" id="4433313"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4433318">.</span><span class="ident" id="4433319">NodeCommand</span><span class="op" id="4433330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433334">Args</span><span class="op" id="4433338">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4433344">[</span><span class="op" id="4433345">]</span><span class="ident" id="4433346"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4433351">.</span><span class="ident" id="4433352">Node</span><span class="op" id="4433356">{</span><span class="ident" id="4433357"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4433362">.</span><span class="ident" id="4433363">NewIdentifier</span><span class="op" id="4433376">(</span><span class="ident" id="4433377"><a href="/html/template/escape.go.html#4433218">identifier</a></span><span class="op" id="4433387">)</span><span class="op" id="4433388">.</span><span class="ident" id="4433389">SetTree</span><span class="op" id="4433396">(</span><span class="ident" id="4433397">nil</span><span class="op" id="4433400">)</span><span class="op" id="4433401">.</span><span class="ident" id="4433402">SetPos</span><span class="op" id="4433408">(</span><span class="ident" id="4433409"><a href="/html/template/escape.go.html#4433237">pos</a></span><span class="op" id="4433412">)</span><span class="op" id="4433413">}</span><span class="op" id="4433414">,</span>&nbsp;<span class="comment" id="4433416">//&nbsp;TODO:&nbsp;SetTree.</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433435">}</span><br>
<span class="lineno"></span><span class="op" id="4433437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4433440">//&nbsp;nudge&nbsp;returns&nbsp;the&nbsp;context&nbsp;that&nbsp;would&nbsp;result&nbsp;from&nbsp;following&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="4433515">//&nbsp;transitions&nbsp;from&nbsp;the&nbsp;input&nbsp;context.</span><br>
<span class="lineno">340</span><span class="comment" id="4433554">//&nbsp;For&nbsp;example,&nbsp;parsing:</span><br>
<span class="lineno"></span><span class="comment" id="4433579">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`&lt;a&nbsp;href=`</span><br>
<span class="lineno"></span><span class="comment" id="4433597">//&nbsp;will&nbsp;end&nbsp;in&nbsp;context{stateBeforeValue,&nbsp;attrURL},&nbsp;but&nbsp;parsing&nbsp;one&nbsp;extra&nbsp;rune:</span><br>
<span class="lineno"></span><span class="comment" id="4433676">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`&lt;a&nbsp;href=x`</span><br>
<span class="lineno"></span><span class="comment" id="4433695">//&nbsp;will&nbsp;end&nbsp;in&nbsp;context{stateURL,&nbsp;delimSpaceOrTagEnd,&nbsp;...}.</span><br>
<span class="lineno">345</span><span class="comment" id="4433754">//&nbsp;There&nbsp;are&nbsp;two&nbsp;transitions&nbsp;that&nbsp;happen&nbsp;when&nbsp;the&nbsp;&#39;x&#39;&nbsp;is&nbsp;seen:</span><br>
<span class="lineno"></span><span class="comment" id="4433817">//&nbsp;(1)&nbsp;Transition&nbsp;from&nbsp;a&nbsp;before-value&nbsp;state&nbsp;to&nbsp;a&nbsp;start-of-value&nbsp;state&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="4433895">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consuming&nbsp;any&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="4433927">//&nbsp;(2)&nbsp;Consume&nbsp;&#39;x&#39;&nbsp;and&nbsp;transition&nbsp;past&nbsp;the&nbsp;first&nbsp;value&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="4433993">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;nudging&nbsp;produces&nbsp;the&nbsp;context&nbsp;after&nbsp;(1)&nbsp;happens.</span><br>
<span class="lineno">350</span><span class="keyword" id="4434058">func</span>&nbsp;<span class="ident" id="4434063">nudge</span><span class="op" id="4434068">(</span><span class="ident" id="4434069">c</span>&nbsp;<span class="ident" id="4434071"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4434078">)</span>&nbsp;<span class="ident" id="4434080"><a href="/html/template/context.go.html#4392413">context</a></span>&nbsp;<span class="op" id="4434088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434091">switch</span>&nbsp;<span class="ident" id="4434098"><a href="/html/template/escape.go.html#4434069">c</a></span><span class="op" id="4434099">.</span><span class="ident" id="4434100">state</span>&nbsp;<span class="op" id="4434106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434109">case</span>&nbsp;<span class="ident" id="4434114"><a href="/html/template/context.go.html#4394398">stateTag</a></span><span class="op" id="4434122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4434126">//&nbsp;In&nbsp;`&lt;foo&nbsp;{{.}}`,&nbsp;the&nbsp;action&nbsp;should&nbsp;emit&nbsp;an&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434185"><a href="/html/template/escape.go.html#4434069">c</a></span><span class="op" id="4434186">.</span><span class="ident" id="4434187">state</span>&nbsp;<span class="op" id="4434193">=</span>&nbsp;<span class="ident" id="4434195"><a href="/html/template/context.go.html#4394511">stateAttrName</a></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434210">case</span>&nbsp;<span class="ident" id="4434215"><a href="/html/template/context.go.html#4394801">stateBeforeValue</a></span><span class="op" id="4434231">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4434235">//&nbsp;In&nbsp;`&lt;foo&nbsp;bar={{.}}`,&nbsp;the&nbsp;action&nbsp;is&nbsp;an&nbsp;undelimited&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434297"><a href="/html/template/escape.go.html#4434069">c</a></span><span class="op" id="4434298">.</span><span class="ident" id="4434299">state</span><span class="op" id="4434304">,</span>&nbsp;<span class="ident" id="4434306"><a href="/html/template/escape.go.html#4434069">c</a></span><span class="op" id="4434307">.</span><span class="ident" id="4434308">delim</span><span class="op" id="4434313">,</span>&nbsp;<span class="ident" id="4434315"><a href="/html/template/escape.go.html#4434069">c</a></span><span class="op" id="4434316">.</span><span class="ident" id="4434317">attr</span>&nbsp;<span class="op" id="4434322">=</span>&nbsp;<span class="ident" id="4434324"><a href="/html/template/transition.go.html#4481981">attrStartStates</a></span><span class="op" id="4434339">[</span><span class="ident" id="4434340"><a href="/html/template/escape.go.html#4434069">c</a></span><span class="op" id="4434341">.</span><span class="ident" id="4434342">attr</span><span class="op" id="4434346">]</span><span class="op" id="4434347">,</span>&nbsp;<span class="ident" id="4434349"><a href="/html/template/context.go.html#4398348">delimSpaceOrTagEnd</a></span><span class="op" id="4434367">,</span>&nbsp;<span class="ident" id="4434369"><a href="/html/template/context.go.html#4401602">attrNone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434379">case</span>&nbsp;<span class="ident" id="4434384"><a href="/html/template/context.go.html#4394661">stateAfterName</a></span><span class="op" id="4434398">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4434402">//&nbsp;In&nbsp;`&lt;foo&nbsp;bar&nbsp;{{.}}`,&nbsp;the&nbsp;action&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434461"><a href="/html/template/escape.go.html#4434069">c</a></span><span class="op" id="4434462">.</span><span class="ident" id="4434463">state</span><span class="op" id="4434468">,</span>&nbsp;<span class="ident" id="4434470"><a href="/html/template/escape.go.html#4434069">c</a></span><span class="op" id="4434471">.</span><span class="ident" id="4434472">attr</span>&nbsp;<span class="op" id="4434477">=</span>&nbsp;<span class="ident" id="4434479"><a href="/html/template/context.go.html#4394511">stateAttrName</a></span><span class="op" id="4434492">,</span>&nbsp;<span class="ident" id="4434494"><a href="/html/template/context.go.html#4401602">attrNone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434507">return</span>&nbsp;<span class="ident" id="4434514"><a href="/html/template/escape.go.html#4434069">c</a></span><br>
<span class="lineno"></span><span class="op" id="4434516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4434519">//&nbsp;join&nbsp;joins&nbsp;the&nbsp;two&nbsp;contexts&nbsp;of&nbsp;a&nbsp;branch&nbsp;template&nbsp;node.&nbsp;The&nbsp;result&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4434594">//&nbsp;error&nbsp;context&nbsp;if&nbsp;either&nbsp;of&nbsp;the&nbsp;input&nbsp;contexts&nbsp;are&nbsp;error&nbsp;contexts,&nbsp;or&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4434673">//&nbsp;the&nbsp;input&nbsp;contexts&nbsp;differ.</span><br>
<span class="lineno"></span><span class="keyword" id="4434703">func</span>&nbsp;<span class="ident" id="4434708">join</span><span class="op" id="4434712">(</span><span class="ident" id="4434713">a</span><span class="op" id="4434714">,</span>&nbsp;<span class="ident" id="4434716">b</span>&nbsp;<span class="ident" id="4434718"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4434725">,</span>&nbsp;<span class="ident" id="4434727">node</span>&nbsp;<span class="ident" id="4434732"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4434737">.</span><span class="ident" id="4434738">Node</span><span class="op" id="4434742">,</span>&nbsp;<span class="ident" id="4434744">nodeName</span>&nbsp;<span class="builtintype" id="4434753">string</span><span class="op" id="4434759">)</span>&nbsp;<span class="ident" id="4434761"><a href="/html/template/context.go.html#4392413">context</a></span>&nbsp;<span class="op" id="4434769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434772">if</span>&nbsp;<span class="ident" id="4434775"><a href="/html/template/escape.go.html#4434713">a</a></span><span class="op" id="4434776">.</span><span class="ident" id="4434777">state</span>&nbsp;<span class="op" id="4434783">==</span>&nbsp;<span class="ident" id="4434786"><a href="/html/template/context.go.html#4396369">stateError</a></span>&nbsp;<span class="op" id="4434797">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434801">return</span>&nbsp;<span class="ident" id="4434808"><a href="/html/template/escape.go.html#4434713">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434814">if</span>&nbsp;<span class="ident" id="4434817"><a href="/html/template/escape.go.html#4434716">b</a></span><span class="op" id="4434818">.</span><span class="ident" id="4434819">state</span>&nbsp;<span class="op" id="4434825">==</span>&nbsp;<span class="ident" id="4434828"><a href="/html/template/context.go.html#4396369">stateError</a></span>&nbsp;<span class="op" id="4434839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434843">return</span>&nbsp;<span class="ident" id="4434850"><a href="/html/template/escape.go.html#4434716">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434853">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434856">if</span>&nbsp;<span class="ident" id="4434859"><a href="/html/template/escape.go.html#4434713">a</a></span><span class="op" id="4434860">.</span><span class="ident" id="4434861">eq</span><span class="op" id="4434863">(</span><span class="ident" id="4434864"><a href="/html/template/escape.go.html#4434716">b</a></span><span class="op" id="4434865">)</span>&nbsp;<span class="op" id="4434867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434871">return</span>&nbsp;<span class="ident" id="4434878"><a href="/html/template/escape.go.html#4434713">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434885">c</span>&nbsp;<span class="op" id="4434887">:=</span>&nbsp;<span class="ident" id="4434890"><a href="/html/template/escape.go.html#4434713">a</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434893"><a href="/html/template/escape.go.html#4434885">c</a></span><span class="op" id="4434894">.</span><span class="ident" id="4434895">urlPart</span>&nbsp;<span class="op" id="4434903">=</span>&nbsp;<span class="ident" id="4434905"><a href="/html/template/escape.go.html#4434716">b</a></span><span class="op" id="4434906">.</span><span class="ident" id="4434907">urlPart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434916">if</span>&nbsp;<span class="ident" id="4434919"><a href="/html/template/escape.go.html#4434885">c</a></span><span class="op" id="4434920">.</span><span class="ident" id="4434921">eq</span><span class="op" id="4434923">(</span><span class="ident" id="4434924"><a href="/html/template/escape.go.html#4434716">b</a></span><span class="op" id="4434925">)</span>&nbsp;<span class="op" id="4434927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4434931">//&nbsp;The&nbsp;contexts&nbsp;differ&nbsp;only&nbsp;by&nbsp;urlPart.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434973"><a href="/html/template/escape.go.html#4434885">c</a></span><span class="op" id="4434974">.</span><span class="ident" id="4434975">urlPart</span>&nbsp;<span class="op" id="4434983">=</span>&nbsp;<span class="ident" id="4434985"><a href="/html/template/context.go.html#4399327">urlPartUnknown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435002">return</span>&nbsp;<span class="ident" id="4435009"><a href="/html/template/escape.go.html#4434885">c</a></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435016"><a href="/html/template/escape.go.html#4434885">c</a></span>&nbsp;<span class="op" id="4435018">=</span>&nbsp;<span class="ident" id="4435020"><a href="/html/template/escape.go.html#4434713">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435023"><a href="/html/template/escape.go.html#4434885">c</a></span><span class="op" id="4435024">.</span><span class="ident" id="4435025">jsCtx</span>&nbsp;<span class="op" id="4435031">=</span>&nbsp;<span class="ident" id="4435033"><a href="/html/template/escape.go.html#4434716">b</a></span><span class="op" id="4435034">.</span><span class="ident" id="4435035">jsCtx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435042">if</span>&nbsp;<span class="ident" id="4435045"><a href="/html/template/escape.go.html#4434885">c</a></span><span class="op" id="4435046">.</span><span class="ident" id="4435047">eq</span><span class="op" id="4435049">(</span><span class="ident" id="4435050"><a href="/html/template/escape.go.html#4434716">b</a></span><span class="op" id="4435051">)</span>&nbsp;<span class="op" id="4435053">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435057">//&nbsp;The&nbsp;contexts&nbsp;differ&nbsp;only&nbsp;by&nbsp;jsCtx.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435097"><a href="/html/template/escape.go.html#4434885">c</a></span><span class="op" id="4435098">.</span><span class="ident" id="4435099">jsCtx</span>&nbsp;<span class="op" id="4435105">=</span>&nbsp;<span class="ident" id="4435107"><a href="/html/template/context.go.html#4400054">jsCtxUnknown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435122">return</span>&nbsp;<span class="ident" id="4435129"><a href="/html/template/escape.go.html#4434885">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435136">//&nbsp;Allow&nbsp;a&nbsp;nudged&nbsp;context&nbsp;to&nbsp;join&nbsp;with&nbsp;an&nbsp;unnudged&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435193">//&nbsp;This&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435213">//&nbsp;&nbsp;&nbsp;&lt;p&nbsp;title={{if&nbsp;.C}}{{.}}{{end}}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435250">//&nbsp;ends&nbsp;in&nbsp;an&nbsp;unquoted&nbsp;value&nbsp;state&nbsp;even&nbsp;though&nbsp;the&nbsp;else&nbsp;branch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435314">//&nbsp;ends&nbsp;in&nbsp;stateBeforeValue.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435344">if</span>&nbsp;<span class="ident" id="4435347">c</span><span class="op" id="4435348">,</span>&nbsp;<span class="ident" id="4435350">d</span>&nbsp;<span class="op" id="4435352">:=</span>&nbsp;<span class="ident" id="4435355"><a href="/html/template/escape.go.html#4434063">nudge</a></span><span class="op" id="4435360">(</span><span class="ident" id="4435361"><a href="/html/template/escape.go.html#4434713">a</a></span><span class="op" id="4435362">)</span><span class="op" id="4435363">,</span>&nbsp;<span class="ident" id="4435365"><a href="/html/template/escape.go.html#4434063">nudge</a></span><span class="op" id="4435370">(</span><span class="ident" id="4435371"><a href="/html/template/escape.go.html#4434716">b</a></span><span class="op" id="4435372">)</span><span class="op" id="4435373">;</span>&nbsp;<span class="op" id="4435375">!</span><span class="op" id="4435376">(</span><span class="ident" id="4435377"><a href="/html/template/escape.go.html#4435347">c</a></span><span class="op" id="4435378">.</span><span class="ident" id="4435379">eq</span><span class="op" id="4435381">(</span><span class="ident" id="4435382"><a href="/html/template/escape.go.html#4434713">a</a></span><span class="op" id="4435383">)</span>&nbsp;<span class="op" id="4435385">&amp;&amp;</span>&nbsp;<span class="ident" id="4435388"><a href="/html/template/escape.go.html#4435350">d</a></span><span class="op" id="4435389">.</span><span class="ident" id="4435390">eq</span><span class="op" id="4435392">(</span><span class="ident" id="4435393"><a href="/html/template/escape.go.html#4434716">b</a></span><span class="op" id="4435394">)</span><span class="op" id="4435395">)</span>&nbsp;<span class="op" id="4435397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435401">if</span>&nbsp;<span class="ident" id="4435404">e</span>&nbsp;<span class="op" id="4435406">:=</span>&nbsp;<span class="ident" id="4435409"><a href="/html/template/escape.go.html#4434708">join</a></span><span class="op" id="4435413">(</span><span class="ident" id="4435414"><a href="/html/template/escape.go.html#4435347">c</a></span><span class="op" id="4435415">,</span>&nbsp;<span class="ident" id="4435417"><a href="/html/template/escape.go.html#4435350">d</a></span><span class="op" id="4435418">,</span>&nbsp;<span class="ident" id="4435420"><a href="/html/template/escape.go.html#4434727">node</a></span><span class="op" id="4435424">,</span>&nbsp;<span class="ident" id="4435426"><a href="/html/template/escape.go.html#4434744">nodeName</a></span><span class="op" id="4435434">)</span><span class="op" id="4435435">;</span>&nbsp;<span class="ident" id="4435437"><a href="/html/template/escape.go.html#4435404">e</a></span><span class="op" id="4435438">.</span><span class="ident" id="4435439">state</span>&nbsp;<span class="op" id="4435445">!=</span>&nbsp;<span class="ident" id="4435448"><a href="/html/template/context.go.html#4396369">stateError</a></span>&nbsp;<span class="op" id="4435459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435464">return</span>&nbsp;<span class="ident" id="4435471"><a href="/html/template/escape.go.html#4435404">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435478">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435482">return</span>&nbsp;<span class="ident" id="4435489"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4435496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435500">state</span><span class="op" id="4435505">:</span>&nbsp;<span class="ident" id="4435507"><a href="/html/template/context.go.html#4396369">stateError</a></span><span class="op" id="4435517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435521">err</span><span class="op" id="4435524">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4435528"><a href="/html/template/error.go.html#4422980">errorf</a></span><span class="op" id="4435534">(</span><span class="ident" id="4435535"><a href="/html/template/error.go.html#4418805">ErrBranchEnd</a></span><span class="op" id="4435547">,</span>&nbsp;<span class="ident" id="4435549"><a href="/html/template/escape.go.html#4434727">node</a></span><span class="op" id="4435553">,</span>&nbsp;<span class="num" id="4435555">0</span><span class="op" id="4435556">,</span>&nbsp;<span class="string" id="4435558">&#34;{{%s}}&nbsp;branches&nbsp;end&nbsp;in&nbsp;different&nbsp;contexts:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="4435609">,</span>&nbsp;<span class="ident" id="4435611"><a href="/html/template/escape.go.html#4434744">nodeName</a></span><span class="op" id="4435619">,</span>&nbsp;<span class="ident" id="4435621"><a href="/html/template/escape.go.html#4434713">a</a></span><span class="op" id="4435622">,</span>&nbsp;<span class="ident" id="4435624"><a href="/html/template/escape.go.html#4434716">b</a></span><span class="op" id="4435625">)</span><span class="op" id="4435626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435629">}</span><br>
<span class="lineno">410</span><span class="op" id="4435631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4435634">//&nbsp;escapeBranch&nbsp;escapes&nbsp;a&nbsp;branch&nbsp;template&nbsp;node:&nbsp;&#34;if&#34;,&nbsp;&#34;range&#34;&nbsp;and&nbsp;&#34;with&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4435708">func</span>&nbsp;<span class="op" id="4435713">(</span><span class="ident" id="4435714">e</span>&nbsp;<span class="op" id="4435716">*</span><span class="ident" id="4435717"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4435724">)</span>&nbsp;<span class="ident" id="4435726">escapeBranch</span><span class="op" id="4435738">(</span><span class="ident" id="4435739">c</span>&nbsp;<span class="ident" id="4435741"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4435748">,</span>&nbsp;<span class="ident" id="4435750">n</span>&nbsp;<span class="op" id="4435752">*</span><span class="ident" id="4435753"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4435758">.</span><span class="ident" id="4435759">BranchNode</span><span class="op" id="4435769">,</span>&nbsp;<span class="ident" id="4435771">nodeName</span>&nbsp;<span class="builtintype" id="4435780">string</span><span class="op" id="4435786">)</span>&nbsp;<span class="ident" id="4435788"><a href="/html/template/context.go.html#4392413">context</a></span>&nbsp;<span class="op" id="4435796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435799">c0</span>&nbsp;<span class="op" id="4435802">:=</span>&nbsp;<span class="ident" id="4435805"><a href="/html/template/escape.go.html#4435714">e</a></span><span class="op" id="4435806">.</span><span class="ident" id="4435807">escapeList</span><span class="op" id="4435817">(</span><span class="ident" id="4435818"><a href="/html/template/escape.go.html#4435739">c</a></span><span class="op" id="4435819">,</span>&nbsp;<span class="ident" id="4435821"><a href="/html/template/escape.go.html#4435750">n</a></span><span class="op" id="4435822">.</span><span class="ident" id="4435823">List</span><span class="op" id="4435827">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435830">if</span>&nbsp;<span class="ident" id="4435833"><a href="/html/template/escape.go.html#4435771">nodeName</a></span>&nbsp;<span class="op" id="4435842">==</span>&nbsp;<span class="string" id="4435845">&#34;range&#34;</span>&nbsp;<span class="op" id="4435853">&amp;&amp;</span>&nbsp;<span class="ident" id="4435856"><a href="/html/template/escape.go.html#4435799">c0</a></span><span class="op" id="4435858">.</span><span class="ident" id="4435859">state</span>&nbsp;<span class="op" id="4435865">!=</span>&nbsp;<span class="ident" id="4435868"><a href="/html/template/context.go.html#4396369">stateError</a></span>&nbsp;<span class="op" id="4435879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435883">//&nbsp;The&nbsp;&#34;true&#34;&nbsp;branch&nbsp;of&nbsp;a&nbsp;&#34;range&#34;&nbsp;node&nbsp;can&nbsp;execute&nbsp;multiple&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435952">//&nbsp;We&nbsp;check&nbsp;that&nbsp;executing&nbsp;n.List&nbsp;once&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;context</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436021">//&nbsp;as&nbsp;executing&nbsp;n.List&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436053">c1</span><span class="op" id="4436055">,</span>&nbsp;<span class="ident" id="4436057">_</span>&nbsp;<span class="op" id="4436059">:=</span>&nbsp;<span class="ident" id="4436062"><a href="/html/template/escape.go.html#4435714">e</a></span><span class="op" id="4436063">.</span><span class="ident" id="4436064">escapeListConditionally</span><span class="op" id="4436087">(</span><span class="ident" id="4436088"><a href="/html/template/escape.go.html#4435799">c0</a></span><span class="op" id="4436090">,</span>&nbsp;<span class="ident" id="4436092"><a href="/html/template/escape.go.html#4435750">n</a></span><span class="op" id="4436093">.</span><span class="ident" id="4436094">List</span><span class="op" id="4436098">,</span>&nbsp;<span class="ident" id="4436100">nil</span><span class="op" id="4436103">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436107"><a href="/html/template/escape.go.html#4435799">c0</a></span>&nbsp;<span class="op" id="4436110">=</span>&nbsp;<span class="ident" id="4436112"><a href="/html/template/escape.go.html#4434708">join</a></span><span class="op" id="4436116">(</span><span class="ident" id="4436117"><a href="/html/template/escape.go.html#4435799">c0</a></span><span class="op" id="4436119">,</span>&nbsp;<span class="ident" id="4436121"><a href="/html/template/escape.go.html#4436053">c1</a></span><span class="op" id="4436123">,</span>&nbsp;<span class="ident" id="4436125"><a href="/html/template/escape.go.html#4435750">n</a></span><span class="op" id="4436126">,</span>&nbsp;<span class="ident" id="4436128"><a href="/html/template/escape.go.html#4435771">nodeName</a></span><span class="op" id="4436136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436140">if</span>&nbsp;<span class="ident" id="4436143"><a href="/html/template/escape.go.html#4435799">c0</a></span><span class="op" id="4436145">.</span><span class="ident" id="4436146">state</span>&nbsp;<span class="op" id="4436152">==</span>&nbsp;<span class="ident" id="4436155"><a href="/html/template/context.go.html#4396369">stateError</a></span>&nbsp;<span class="op" id="4436166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436171">//&nbsp;Make&nbsp;clear&nbsp;that&nbsp;this&nbsp;is&nbsp;a&nbsp;problem&nbsp;on&nbsp;loop&nbsp;re-entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436228">//&nbsp;since&nbsp;developers&nbsp;tend&nbsp;to&nbsp;overlook&nbsp;that&nbsp;branch&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436285">//&nbsp;debugging&nbsp;templates.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436312"><a href="/html/template/escape.go.html#4435799">c0</a></span><span class="op" id="4436314">.</span><span class="ident" id="4436315">err</span><span class="op" id="4436318">.</span><span class="ident" id="4436319">Line</span>&nbsp;<span class="op" id="4436324">=</span>&nbsp;<span class="ident" id="4436326"><a href="/html/template/escape.go.html#4435750">n</a></span><span class="op" id="4436327">.</span><span class="ident" id="4436328">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436336"><a href="/html/template/escape.go.html#4435799">c0</a></span><span class="op" id="4436338">.</span><span class="ident" id="4436339">err</span><span class="op" id="4436342">.</span><span class="ident" id="4436343">Description</span>&nbsp;<span class="op" id="4436355">=</span>&nbsp;<span class="string" id="4436357">&#34;on&nbsp;range&nbsp;loop&nbsp;re-entry:&nbsp;&#34;</span>&nbsp;<span class="op" id="4436384">+</span>&nbsp;<span class="ident" id="4436386"><a href="/html/template/escape.go.html#4435799">c0</a></span><span class="op" id="4436388">.</span><span class="ident" id="4436389">err</span><span class="op" id="4436392">.</span><span class="ident" id="4436393">Description</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436408">return</span>&nbsp;<span class="ident" id="4436415"><a href="/html/template/escape.go.html#4435799">c0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436423">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436426">c1</span>&nbsp;<span class="op" id="4436429">:=</span>&nbsp;<span class="ident" id="4436432"><a href="/html/template/escape.go.html#4435714">e</a></span><span class="op" id="4436433">.</span><span class="ident" id="4436434">escapeList</span><span class="op" id="4436444">(</span><span class="ident" id="4436445"><a href="/html/template/escape.go.html#4435739">c</a></span><span class="op" id="4436446">,</span>&nbsp;<span class="ident" id="4436448"><a href="/html/template/escape.go.html#4435750">n</a></span><span class="op" id="4436449">.</span><span class="ident" id="4436450">ElseList</span><span class="op" id="4436458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436461">return</span>&nbsp;<span class="ident" id="4436468"><a href="/html/template/escape.go.html#4434708">join</a></span><span class="op" id="4436472">(</span><span class="ident" id="4436473"><a href="/html/template/escape.go.html#4435799">c0</a></span><span class="op" id="4436475">,</span>&nbsp;<span class="ident" id="4436477"><a href="/html/template/escape.go.html#4436426">c1</a></span><span class="op" id="4436479">,</span>&nbsp;<span class="ident" id="4436481"><a href="/html/template/escape.go.html#4435750">n</a></span><span class="op" id="4436482">,</span>&nbsp;<span class="ident" id="4436484"><a href="/html/template/escape.go.html#4435771">nodeName</a></span><span class="op" id="4436492">)</span><br>
<span class="lineno"></span><span class="op" id="4436494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4436497">//&nbsp;escapeList&nbsp;escapes&nbsp;a&nbsp;list&nbsp;template&nbsp;node.</span><br>
<span class="lineno">435</span><span class="keyword" id="4436541">func</span>&nbsp;<span class="op" id="4436546">(</span><span class="ident" id="4436547">e</span>&nbsp;<span class="op" id="4436549">*</span><span class="ident" id="4436550"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4436557">)</span>&nbsp;<span class="ident" id="4436559">escapeList</span><span class="op" id="4436569">(</span><span class="ident" id="4436570">c</span>&nbsp;<span class="ident" id="4436572"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4436579">,</span>&nbsp;<span class="ident" id="4436581">n</span>&nbsp;<span class="op" id="4436583">*</span><span class="ident" id="4436584"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4436589">.</span><span class="ident" id="4436590">ListNode</span><span class="op" id="4436598">)</span>&nbsp;<span class="ident" id="4436600"><a href="/html/template/context.go.html#4392413">context</a></span>&nbsp;<span class="op" id="4436608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436611">if</span>&nbsp;<span class="ident" id="4436614"><a href="/html/template/escape.go.html#4436581">n</a></span>&nbsp;<span class="op" id="4436616">==</span>&nbsp;<span class="ident" id="4436619">nil</span>&nbsp;<span class="op" id="4436623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436627">return</span>&nbsp;<span class="ident" id="4436634"><a href="/html/template/escape.go.html#4436570">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436640">for</span>&nbsp;<span class="ident" id="4436644">_</span><span class="op" id="4436645">,</span>&nbsp;<span class="ident" id="4436647">m</span>&nbsp;<span class="op" id="4436649">:=</span>&nbsp;<span class="keyword" id="4436652">range</span>&nbsp;<span class="ident" id="4436658"><a href="/html/template/escape.go.html#4436581">n</a></span><span class="op" id="4436659">.</span><span class="ident" id="4436660">Nodes</span>&nbsp;<span class="op" id="4436666">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436670"><a href="/html/template/escape.go.html#4436570">c</a></span>&nbsp;<span class="op" id="4436672">=</span>&nbsp;<span class="ident" id="4436674"><a href="/html/template/escape.go.html#4436547">e</a></span><span class="op" id="4436675">.</span><span class="ident" id="4436676">escape</span><span class="op" id="4436682">(</span><span class="ident" id="4436683"><a href="/html/template/escape.go.html#4436570">c</a></span><span class="op" id="4436684">,</span>&nbsp;<span class="ident" id="4436686"><a href="/html/template/escape.go.html#4436647">m</a></span><span class="op" id="4436687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436693">return</span>&nbsp;<span class="ident" id="4436700"><a href="/html/template/escape.go.html#4436570">c</a></span><br>
<span class="lineno"></span><span class="op" id="4436702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="comment" id="4436705">//&nbsp;escapeListConditionally&nbsp;escapes&nbsp;a&nbsp;list&nbsp;node&nbsp;but&nbsp;only&nbsp;preserves&nbsp;edits&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4436781">//&nbsp;inferences&nbsp;in&nbsp;e&nbsp;if&nbsp;the&nbsp;inferences&nbsp;and&nbsp;output&nbsp;context&nbsp;satisfy&nbsp;filter.</span><br>
<span class="lineno"></span><span class="comment" id="4436853">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;best&nbsp;guess&nbsp;at&nbsp;an&nbsp;output&nbsp;context,&nbsp;and&nbsp;the&nbsp;result&nbsp;of&nbsp;the&nbsp;filter</span><br>
<span class="lineno"></span><span class="comment" id="4436933">//&nbsp;which&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;whether&nbsp;e&nbsp;was&nbsp;updated.</span><br>
<span class="lineno"></span><span class="keyword" id="4436980">func</span>&nbsp;<span class="op" id="4436985">(</span><span class="ident" id="4436986">e</span>&nbsp;<span class="op" id="4436988">*</span><span class="ident" id="4436989"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4436996">)</span>&nbsp;<span class="ident" id="4436998">escapeListConditionally</span><span class="op" id="4437021">(</span><span class="ident" id="4437022">c</span>&nbsp;<span class="ident" id="4437024"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4437031">,</span>&nbsp;<span class="ident" id="4437033">n</span>&nbsp;<span class="op" id="4437035">*</span><span class="ident" id="4437036"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4437041">.</span><span class="ident" id="4437042">ListNode</span><span class="op" id="4437050">,</span>&nbsp;<span class="ident" id="4437052">filter</span>&nbsp;<span class="keyword" id="4437059">func</span><span class="op" id="4437063">(</span><span class="op" id="4437064">*</span><span class="ident" id="4437065"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4437072">,</span>&nbsp;<span class="ident" id="4437074"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4437081">)</span>&nbsp;<span class="builtintype" id="4437083">bool</span><span class="op" id="4437087">)</span>&nbsp;<span class="op" id="4437089">(</span><span class="ident" id="4437090"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4437097">,</span>&nbsp;<span class="builtintype" id="4437099">bool</span><span class="op" id="4437103">)</span>&nbsp;<span class="op" id="4437105">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437108">e1</span>&nbsp;<span class="op" id="4437111">:=</span>&nbsp;<span class="ident" id="4437114"><a href="/html/template/escape.go.html#4426445">newEscaper</a></span><span class="op" id="4437124">(</span><span class="ident" id="4437125"><a href="/html/template/escape.go.html#4436986">e</a></span><span class="op" id="4437126">.</span><span class="ident" id="4437127">tmpl</span><span class="op" id="4437131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437134">//&nbsp;Make&nbsp;type&nbsp;inferences&nbsp;available&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437175">for</span>&nbsp;<span class="ident" id="4437179">k</span><span class="op" id="4437180">,</span>&nbsp;<span class="ident" id="4437182">v</span>&nbsp;<span class="op" id="4437184">:=</span>&nbsp;<span class="keyword" id="4437187">range</span>&nbsp;<span class="ident" id="4437193"><a href="/html/template/escape.go.html#4436986">e</a></span><span class="op" id="4437194">.</span><span class="ident" id="4437195">output</span>&nbsp;<span class="op" id="4437202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437206"><a href="/html/template/escape.go.html#4437108">e1</a></span><span class="op" id="4437208">.</span><span class="ident" id="4437209">output</span><span class="op" id="4437215">[</span><span class="ident" id="4437216"><a href="/html/template/escape.go.html#4437179">k</a></span><span class="op" id="4437217">]</span>&nbsp;<span class="op" id="4437219">=</span>&nbsp;<span class="ident" id="4437221"><a href="/html/template/escape.go.html#4437182">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437224">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437227"><a href="/html/template/escape.go.html#4437022">c</a></span>&nbsp;<span class="op" id="4437229">=</span>&nbsp;<span class="ident" id="4437231"><a href="/html/template/escape.go.html#4437108">e1</a></span><span class="op" id="4437233">.</span><span class="ident" id="4437234">escapeList</span><span class="op" id="4437244">(</span><span class="ident" id="4437245"><a href="/html/template/escape.go.html#4437022">c</a></span><span class="op" id="4437246">,</span>&nbsp;<span class="ident" id="4437248"><a href="/html/template/escape.go.html#4437033">n</a></span><span class="op" id="4437249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437252">ok</span>&nbsp;<span class="op" id="4437255">:=</span>&nbsp;<span class="ident" id="4437258"><a href="/html/template/escape.go.html#4437052">filter</a></span>&nbsp;<span class="op" id="4437265">!=</span>&nbsp;<span class="ident" id="4437268">nil</span>&nbsp;<span class="op" id="4437272">&amp;&amp;</span>&nbsp;<span class="ident" id="4437275"><a href="/html/template/escape.go.html#4437052">filter</a></span><span class="op" id="4437281">(</span><span class="ident" id="4437282"><a href="/html/template/escape.go.html#4437108">e1</a></span><span class="op" id="4437284">,</span>&nbsp;<span class="ident" id="4437286"><a href="/html/template/escape.go.html#4437022">c</a></span><span class="op" id="4437287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437290">if</span>&nbsp;<span class="ident" id="4437293"><a href="/html/template/escape.go.html#4437252">ok</a></span>&nbsp;<span class="op" id="4437296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437300">//&nbsp;Copy&nbsp;inferences&nbsp;and&nbsp;edits&nbsp;from&nbsp;e1&nbsp;back&nbsp;into&nbsp;e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437352">for</span>&nbsp;<span class="ident" id="4437356">k</span><span class="op" id="4437357">,</span>&nbsp;<span class="ident" id="4437359">v</span>&nbsp;<span class="op" id="4437361">:=</span>&nbsp;<span class="keyword" id="4437364">range</span>&nbsp;<span class="ident" id="4437370"><a href="/html/template/escape.go.html#4437108">e1</a></span><span class="op" id="4437372">.</span><span class="ident" id="4437373">output</span>&nbsp;<span class="op" id="4437380">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437385"><a href="/html/template/escape.go.html#4436986">e</a></span><span class="op" id="4437386">.</span><span class="ident" id="4437387">output</span><span class="op" id="4437393">[</span><span class="ident" id="4437394"><a href="/html/template/escape.go.html#4437356">k</a></span><span class="op" id="4437395">]</span>&nbsp;<span class="op" id="4437397">=</span>&nbsp;<span class="ident" id="4437399"><a href="/html/template/escape.go.html#4437359">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437407">for</span>&nbsp;<span class="ident" id="4437411">k</span><span class="op" id="4437412">,</span>&nbsp;<span class="ident" id="4437414">v</span>&nbsp;<span class="op" id="4437416">:=</span>&nbsp;<span class="keyword" id="4437419">range</span>&nbsp;<span class="ident" id="4437425"><a href="/html/template/escape.go.html#4437108">e1</a></span><span class="op" id="4437427">.</span><span class="ident" id="4437428">derived</span>&nbsp;<span class="op" id="4437436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437441"><a href="/html/template/escape.go.html#4436986">e</a></span><span class="op" id="4437442">.</span><span class="ident" id="4437443">derived</span><span class="op" id="4437450">[</span><span class="ident" id="4437451"><a href="/html/template/escape.go.html#4437411">k</a></span><span class="op" id="4437452">]</span>&nbsp;<span class="op" id="4437454">=</span>&nbsp;<span class="ident" id="4437456"><a href="/html/template/escape.go.html#4437414">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437460">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437464">for</span>&nbsp;<span class="ident" id="4437468">k</span><span class="op" id="4437469">,</span>&nbsp;<span class="ident" id="4437471">v</span>&nbsp;<span class="op" id="4437473">:=</span>&nbsp;<span class="keyword" id="4437476">range</span>&nbsp;<span class="ident" id="4437482"><a href="/html/template/escape.go.html#4437108">e1</a></span><span class="op" id="4437484">.</span><span class="ident" id="4437485">called</span>&nbsp;<span class="op" id="4437492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437497"><a href="/html/template/escape.go.html#4436986">e</a></span><span class="op" id="4437498">.</span><span class="ident" id="4437499">called</span><span class="op" id="4437505">[</span><span class="ident" id="4437506"><a href="/html/template/escape.go.html#4437468">k</a></span><span class="op" id="4437507">]</span>&nbsp;<span class="op" id="4437509">=</span>&nbsp;<span class="ident" id="4437511"><a href="/html/template/escape.go.html#4437471">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437519">for</span>&nbsp;<span class="ident" id="4437523">k</span><span class="op" id="4437524">,</span>&nbsp;<span class="ident" id="4437526">v</span>&nbsp;<span class="op" id="4437528">:=</span>&nbsp;<span class="keyword" id="4437531">range</span>&nbsp;<span class="ident" id="4437537"><a href="/html/template/escape.go.html#4437108">e1</a></span><span class="op" id="4437539">.</span><span class="ident" id="4437540">actionNodeEdits</span>&nbsp;<span class="op" id="4437556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437561"><a href="/html/template/escape.go.html#4436986">e</a></span><span class="op" id="4437562">.</span><span class="ident" id="4437563">editActionNode</span><span class="op" id="4437577">(</span><span class="ident" id="4437578"><a href="/html/template/escape.go.html#4437523">k</a></span><span class="op" id="4437579">,</span>&nbsp;<span class="ident" id="4437581"><a href="/html/template/escape.go.html#4437526">v</a></span><span class="op" id="4437582">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437590">for</span>&nbsp;<span class="ident" id="4437594">k</span><span class="op" id="4437595">,</span>&nbsp;<span class="ident" id="4437597">v</span>&nbsp;<span class="op" id="4437599">:=</span>&nbsp;<span class="keyword" id="4437602">range</span>&nbsp;<span class="ident" id="4437608"><a href="/html/template/escape.go.html#4437108">e1</a></span><span class="op" id="4437610">.</span><span class="ident" id="4437611">templateNodeEdits</span>&nbsp;<span class="op" id="4437629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437634"><a href="/html/template/escape.go.html#4436986">e</a></span><span class="op" id="4437635">.</span><span class="ident" id="4437636">editTemplateNode</span><span class="op" id="4437652">(</span><span class="ident" id="4437653"><a href="/html/template/escape.go.html#4437594">k</a></span><span class="op" id="4437654">,</span>&nbsp;<span class="ident" id="4437656"><a href="/html/template/escape.go.html#4437597">v</a></span><span class="op" id="4437657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437665">for</span>&nbsp;<span class="ident" id="4437669">k</span><span class="op" id="4437670">,</span>&nbsp;<span class="ident" id="4437672">v</span>&nbsp;<span class="op" id="4437674">:=</span>&nbsp;<span class="keyword" id="4437677">range</span>&nbsp;<span class="ident" id="4437683"><a href="/html/template/escape.go.html#4437108">e1</a></span><span class="op" id="4437685">.</span><span class="ident" id="4437686">textNodeEdits</span>&nbsp;<span class="op" id="4437700">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437705"><a href="/html/template/escape.go.html#4436986">e</a></span><span class="op" id="4437706">.</span><span class="ident" id="4437707">editTextNode</span><span class="op" id="4437719">(</span><span class="ident" id="4437720"><a href="/html/template/escape.go.html#4437669">k</a></span><span class="op" id="4437721">,</span>&nbsp;<span class="ident" id="4437723"><a href="/html/template/escape.go.html#4437672">v</a></span><span class="op" id="4437724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437734">return</span>&nbsp;<span class="ident" id="4437741"><a href="/html/template/escape.go.html#4437022">c</a></span><span class="op" id="4437742">,</span>&nbsp;<span class="ident" id="4437744"><a href="/html/template/escape.go.html#4437252">ok</a></span><br>
<span class="lineno"></span><span class="op" id="4437747">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4437750">//&nbsp;escapeTemplate&nbsp;escapes&nbsp;a&nbsp;{{template}}&nbsp;call&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4437802">func</span>&nbsp;<span class="op" id="4437807">(</span><span class="ident" id="4437808">e</span>&nbsp;<span class="op" id="4437810">*</span><span class="ident" id="4437811"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4437818">)</span>&nbsp;<span class="ident" id="4437820">escapeTemplate</span><span class="op" id="4437834">(</span><span class="ident" id="4437835">c</span>&nbsp;<span class="ident" id="4437837"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4437844">,</span>&nbsp;<span class="ident" id="4437846">n</span>&nbsp;<span class="op" id="4437848">*</span><span class="ident" id="4437849"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4437854">.</span><span class="ident" id="4437855">TemplateNode</span><span class="op" id="4437867">)</span>&nbsp;<span class="ident" id="4437869"><a href="/html/template/context.go.html#4392413">context</a></span>&nbsp;<span class="op" id="4437877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437880"><a href="/html/template/escape.go.html#4437835">c</a></span><span class="op" id="4437881">,</span>&nbsp;<span class="ident" id="4437883">name</span>&nbsp;<span class="op" id="4437888">:=</span>&nbsp;<span class="ident" id="4437891"><a href="/html/template/escape.go.html#4437808">e</a></span><span class="op" id="4437892">.</span><span class="ident" id="4437893">escapeTree</span><span class="op" id="4437903">(</span><span class="ident" id="4437904"><a href="/html/template/escape.go.html#4437835">c</a></span><span class="op" id="4437905">,</span>&nbsp;<span class="ident" id="4437907"><a href="/html/template/escape.go.html#4437846">n</a></span><span class="op" id="4437908">,</span>&nbsp;<span class="ident" id="4437910"><a href="/html/template/escape.go.html#4437846">n</a></span><span class="op" id="4437911">.</span><span class="ident" id="4437912">Name</span><span class="op" id="4437916">,</span>&nbsp;<span class="ident" id="4437918"><a href="/html/template/escape.go.html#4437846">n</a></span><span class="op" id="4437919">.</span><span class="ident" id="4437920">Line</span><span class="op" id="4437924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437927">if</span>&nbsp;<span class="ident" id="4437930"><a href="/html/template/escape.go.html#4437883">name</a></span>&nbsp;<span class="op" id="4437935">!=</span>&nbsp;<span class="ident" id="4437938"><a href="/html/template/escape.go.html#4437846">n</a></span><span class="op" id="4437939">.</span><span class="ident" id="4437940">Name</span>&nbsp;<span class="op" id="4437945">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437949"><a href="/html/template/escape.go.html#4437808">e</a></span><span class="op" id="4437950">.</span><span class="ident" id="4437951">editTemplateNode</span><span class="op" id="4437967">(</span><span class="ident" id="4437968"><a href="/html/template/escape.go.html#4437846">n</a></span><span class="op" id="4437969">,</span>&nbsp;<span class="ident" id="4437971"><a href="/html/template/escape.go.html#4437883">name</a></span><span class="op" id="4437975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437981">return</span>&nbsp;<span class="ident" id="4437988"><a href="/html/template/escape.go.html#4437835">c</a></span><br>
<span class="lineno"></span><span class="op" id="4437990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span><span class="comment" id="4437993">//&nbsp;escapeTree&nbsp;escapes&nbsp;the&nbsp;named&nbsp;template&nbsp;starting&nbsp;in&nbsp;the&nbsp;given&nbsp;context&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4438067">//&nbsp;necessary&nbsp;and&nbsp;returns&nbsp;its&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="4438112">func</span>&nbsp;<span class="op" id="4438117">(</span><span class="ident" id="4438118">e</span>&nbsp;<span class="op" id="4438120">*</span><span class="ident" id="4438121"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4438128">)</span>&nbsp;<span class="ident" id="4438130">escapeTree</span><span class="op" id="4438140">(</span><span class="ident" id="4438141">c</span>&nbsp;<span class="ident" id="4438143"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4438150">,</span>&nbsp;<span class="ident" id="4438152">node</span>&nbsp;<span class="ident" id="4438157"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4438162">.</span><span class="ident" id="4438163">Node</span><span class="op" id="4438167">,</span>&nbsp;<span class="ident" id="4438169">name</span>&nbsp;<span class="builtintype" id="4438174">string</span><span class="op" id="4438180">,</span>&nbsp;<span class="ident" id="4438182">line</span>&nbsp;<span class="builtintype" id="4438187">int</span><span class="op" id="4438190">)</span>&nbsp;<span class="op" id="4438192">(</span><span class="ident" id="4438193"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4438200">,</span>&nbsp;<span class="builtintype" id="4438202">string</span><span class="op" id="4438208">)</span>&nbsp;<span class="op" id="4438210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438213">//&nbsp;Mangle&nbsp;the&nbsp;template&nbsp;name&nbsp;with&nbsp;the&nbsp;input&nbsp;context&nbsp;to&nbsp;produce&nbsp;a&nbsp;reliable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438287">//&nbsp;identifier.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438303">dname</span>&nbsp;<span class="op" id="4438309">:=</span>&nbsp;<span class="ident" id="4438312"><a href="/html/template/escape.go.html#4438141">c</a></span><span class="op" id="4438313">.</span><span class="ident" id="4438314">mangle</span><span class="op" id="4438320">(</span><span class="ident" id="4438321"><a href="/html/template/escape.go.html#4438169">name</a></span><span class="op" id="4438325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438328"><a href="/html/template/escape.go.html#4438118">e</a></span><span class="op" id="4438329">.</span><span class="ident" id="4438330">called</span><span class="op" id="4438336">[</span><span class="ident" id="4438337"><a href="/html/template/escape.go.html#4438303">dname</a></span><span class="op" id="4438342">]</span>&nbsp;<span class="op" id="4438344">=</span>&nbsp;<span class="builtintype" id="4438346">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438352">if</span>&nbsp;<span class="ident" id="4438355">out</span><span class="op" id="4438358">,</span>&nbsp;<span class="ident" id="4438360">ok</span>&nbsp;<span class="op" id="4438363">:=</span>&nbsp;<span class="ident" id="4438366"><a href="/html/template/escape.go.html#4438118">e</a></span><span class="op" id="4438367">.</span><span class="ident" id="4438368">output</span><span class="op" id="4438374">[</span><span class="ident" id="4438375"><a href="/html/template/escape.go.html#4438303">dname</a></span><span class="op" id="4438380">]</span><span class="op" id="4438381">;</span>&nbsp;<span class="ident" id="4438383"><a href="/html/template/escape.go.html#4438360">ok</a></span>&nbsp;<span class="op" id="4438386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438390">//&nbsp;Already&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438412">return</span>&nbsp;<span class="ident" id="4438419"><a href="/html/template/escape.go.html#4438355">out</a></span><span class="op" id="4438422">,</span>&nbsp;<span class="ident" id="4438424"><a href="/html/template/escape.go.html#4438303">dname</a></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438434">t</span>&nbsp;<span class="op" id="4438436">:=</span>&nbsp;<span class="ident" id="4438439"><a href="/html/template/escape.go.html#4438118">e</a></span><span class="op" id="4438440">.</span><span class="ident" id="4438441">template</span><span class="op" id="4438449">(</span><span class="ident" id="4438450"><a href="/html/template/escape.go.html#4438169">name</a></span><span class="op" id="4438454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438457">if</span>&nbsp;<span class="ident" id="4438460"><a href="/html/template/escape.go.html#4438434">t</a></span>&nbsp;<span class="op" id="4438462">==</span>&nbsp;<span class="ident" id="4438465">nil</span>&nbsp;<span class="op" id="4438469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438473">//&nbsp;Two&nbsp;cases:&nbsp;The&nbsp;template&nbsp;exists&nbsp;but&nbsp;is&nbsp;empty,&nbsp;or&nbsp;has&nbsp;never&nbsp;been&nbsp;mentioned&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438554">//&nbsp;all.&nbsp;Distinguish&nbsp;the&nbsp;cases&nbsp;in&nbsp;the&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438609">if</span>&nbsp;<span class="ident" id="4438612"><a href="/html/template/escape.go.html#4438118">e</a></span><span class="op" id="4438613">.</span><span class="ident" id="4438614">tmpl</span><span class="op" id="4438618">.</span><span class="ident" id="4438619">set</span><span class="op" id="4438622">[</span><span class="ident" id="4438623"><a href="/html/template/escape.go.html#4438169">name</a></span><span class="op" id="4438627">]</span>&nbsp;<span class="op" id="4438629">!=</span>&nbsp;<span class="ident" id="4438632">nil</span>&nbsp;<span class="op" id="4438636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438641">return</span>&nbsp;<span class="ident" id="4438648"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4438655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438661">state</span><span class="op" id="4438666">:</span>&nbsp;<span class="ident" id="4438668"><a href="/html/template/context.go.html#4396369">stateError</a></span><span class="op" id="4438678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438684">err</span><span class="op" id="4438687">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4438691"><a href="/html/template/error.go.html#4422980">errorf</a></span><span class="op" id="4438697">(</span><span class="ident" id="4438698"><a href="/html/template/error.go.html#4419948">ErrNoSuchTemplate</a></span><span class="op" id="4438715">,</span>&nbsp;<span class="ident" id="4438717"><a href="/html/template/escape.go.html#4438152">node</a></span><span class="op" id="4438721">,</span>&nbsp;<span class="ident" id="4438723"><a href="/html/template/escape.go.html#4438182">line</a></span><span class="op" id="4438727">,</span>&nbsp;<span class="string" id="4438729">&#34;%q&nbsp;is&nbsp;an&nbsp;incomplete&nbsp;or&nbsp;empty&nbsp;template&#34;</span><span class="op" id="4438768">,</span>&nbsp;<span class="ident" id="4438770"><a href="/html/template/escape.go.html#4438169">name</a></span><span class="op" id="4438774">)</span><span class="op" id="4438775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438780">}</span><span class="op" id="4438781">,</span>&nbsp;<span class="ident" id="4438783"><a href="/html/template/escape.go.html#4438303">dname</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438795">return</span>&nbsp;<span class="ident" id="4438802"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4438809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438814">state</span><span class="op" id="4438819">:</span>&nbsp;<span class="ident" id="4438821"><a href="/html/template/context.go.html#4396369">stateError</a></span><span class="op" id="4438831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438836">err</span><span class="op" id="4438839">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4438843"><a href="/html/template/error.go.html#4422980">errorf</a></span><span class="op" id="4438849">(</span><span class="ident" id="4438850"><a href="/html/template/error.go.html#4419948">ErrNoSuchTemplate</a></span><span class="op" id="4438867">,</span>&nbsp;<span class="ident" id="4438869"><a href="/html/template/escape.go.html#4438152">node</a></span><span class="op" id="4438873">,</span>&nbsp;<span class="ident" id="4438875"><a href="/html/template/escape.go.html#4438182">line</a></span><span class="op" id="4438879">,</span>&nbsp;<span class="string" id="4438881">&#34;no&nbsp;such&nbsp;template&nbsp;%q&#34;</span><span class="op" id="4438902">,</span>&nbsp;<span class="ident" id="4438904"><a href="/html/template/escape.go.html#4438169">name</a></span><span class="op" id="4438908">)</span><span class="op" id="4438909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438913">}</span><span class="op" id="4438914">,</span>&nbsp;<span class="ident" id="4438916"><a href="/html/template/escape.go.html#4438303">dname</a></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438926">if</span>&nbsp;<span class="ident" id="4438929"><a href="/html/template/escape.go.html#4438303">dname</a></span>&nbsp;<span class="op" id="4438935">!=</span>&nbsp;<span class="ident" id="4438938"><a href="/html/template/escape.go.html#4438169">name</a></span>&nbsp;<span class="op" id="4438943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438947">//&nbsp;Use&nbsp;any&nbsp;template&nbsp;derived&nbsp;during&nbsp;an&nbsp;earlier&nbsp;call&nbsp;to&nbsp;escapeTemplate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439018">//&nbsp;with&nbsp;different&nbsp;top&nbsp;level&nbsp;templates,&nbsp;or&nbsp;clone&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439082">dt</span>&nbsp;<span class="op" id="4439085">:=</span>&nbsp;<span class="ident" id="4439088"><a href="/html/template/escape.go.html#4438118">e</a></span><span class="op" id="4439089">.</span><span class="ident" id="4439090">template</span><span class="op" id="4439098">(</span><span class="ident" id="4439099"><a href="/html/template/escape.go.html#4438303">dname</a></span><span class="op" id="4439104">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439108">if</span>&nbsp;<span class="ident" id="4439111"><a href="/html/template/escape.go.html#4439082">dt</a></span>&nbsp;<span class="op" id="4439114">==</span>&nbsp;<span class="ident" id="4439117">nil</span>&nbsp;<span class="op" id="4439121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439126"><a href="/html/template/escape.go.html#4439082">dt</a></span>&nbsp;<span class="op" id="4439129">=</span>&nbsp;<span class="ident" id="4439131"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4439139">.</span><span class="ident" id="4439140">New</span><span class="op" id="4439143">(</span><span class="ident" id="4439144"><a href="/html/template/escape.go.html#4438303">dname</a></span><span class="op" id="4439149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439154"><a href="/html/template/escape.go.html#4439082">dt</a></span><span class="op" id="4439156">.</span><span class="ident" id="4439157">Tree</span>&nbsp;<span class="op" id="4439162">=</span>&nbsp;<span class="op" id="4439164">&amp;</span><span class="ident" id="4439165"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4439170">.</span><span class="ident" id="4439171">Tree</span><span class="op" id="4439175">{</span><span class="ident" id="4439176">Name</span><span class="op" id="4439180">:</span>&nbsp;<span class="ident" id="4439182"><a href="/html/template/escape.go.html#4438303">dname</a></span><span class="op" id="4439187">,</span>&nbsp;<span class="ident" id="4439189">Root</span><span class="op" id="4439193">:</span>&nbsp;<span class="ident" id="4439195"><a href="/html/template/escape.go.html#4438434">t</a></span><span class="op" id="4439196">.</span><span class="ident" id="4439197">Root</span><span class="op" id="4439201">.</span><span class="ident" id="4439202">CopyList</span><span class="op" id="4439210">(</span><span class="op" id="4439211">)</span><span class="op" id="4439212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439217"><a href="/html/template/escape.go.html#4438118">e</a></span><span class="op" id="4439218">.</span><span class="ident" id="4439219">derived</span><span class="op" id="4439226">[</span><span class="ident" id="4439227"><a href="/html/template/escape.go.html#4438303">dname</a></span><span class="op" id="4439232">]</span>&nbsp;<span class="op" id="4439234">=</span>&nbsp;<span class="ident" id="4439236"><a href="/html/template/escape.go.html#4439082">dt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439241">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439245"><a href="/html/template/escape.go.html#4438434">t</a></span>&nbsp;<span class="op" id="4439247">=</span>&nbsp;<span class="ident" id="4439249"><a href="/html/template/escape.go.html#4439082">dt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439256">return</span>&nbsp;<span class="ident" id="4439263"><a href="/html/template/escape.go.html#4438118">e</a></span><span class="op" id="4439264">.</span><span class="ident" id="4439265">computeOutCtx</span><span class="op" id="4439278">(</span><span class="ident" id="4439279"><a href="/html/template/escape.go.html#4438141">c</a></span><span class="op" id="4439280">,</span>&nbsp;<span class="ident" id="4439282"><a href="/html/template/escape.go.html#4438434">t</a></span><span class="op" id="4439283">)</span><span class="op" id="4439284">,</span>&nbsp;<span class="ident" id="4439286"><a href="/html/template/escape.go.html#4438303">dname</a></span><br>
<span class="lineno"></span><span class="op" id="4439292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="4439295">//&nbsp;computeOutCtx&nbsp;takes&nbsp;a&nbsp;template&nbsp;and&nbsp;its&nbsp;start&nbsp;context&nbsp;and&nbsp;computes&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="4439375">//&nbsp;context&nbsp;while&nbsp;storing&nbsp;any&nbsp;inferences&nbsp;in&nbsp;e.</span><br>
<span class="lineno"></span><span class="keyword" id="4439421">func</span>&nbsp;<span class="op" id="4439426">(</span><span class="ident" id="4439427">e</span>&nbsp;<span class="op" id="4439429">*</span><span class="ident" id="4439430"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4439437">)</span>&nbsp;<span class="ident" id="4439439">computeOutCtx</span><span class="op" id="4439452">(</span><span class="ident" id="4439453">c</span>&nbsp;<span class="ident" id="4439455"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4439462">,</span>&nbsp;<span class="ident" id="4439464">t</span>&nbsp;<span class="op" id="4439466">*</span><span class="ident" id="4439467"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4439475">.</span><span class="ident" id="4439476">Template</span><span class="op" id="4439484">)</span>&nbsp;<span class="ident" id="4439486"><a href="/html/template/context.go.html#4392413">context</a></span>&nbsp;<span class="op" id="4439494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439497">//&nbsp;Propagate&nbsp;context&nbsp;over&nbsp;the&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439534">c1</span><span class="op" id="4439536">,</span>&nbsp;<span class="ident" id="4439538">ok</span>&nbsp;<span class="op" id="4439541">:=</span>&nbsp;<span class="ident" id="4439544"><a href="/html/template/escape.go.html#4439427">e</a></span><span class="op" id="4439545">.</span><span class="ident" id="4439546">escapeTemplateBody</span><span class="op" id="4439564">(</span><span class="ident" id="4439565"><a href="/html/template/escape.go.html#4439453">c</a></span><span class="op" id="4439566">,</span>&nbsp;<span class="ident" id="4439568"><a href="/html/template/escape.go.html#4439464">t</a></span><span class="op" id="4439569">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439572">if</span>&nbsp;<span class="op" id="4439575">!</span><span class="ident" id="4439576"><a href="/html/template/escape.go.html#4439538">ok</a></span>&nbsp;<span class="op" id="4439579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439583">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;fixed&nbsp;point&nbsp;by&nbsp;assuming&nbsp;c1&nbsp;as&nbsp;the&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439649">if</span>&nbsp;<span class="ident" id="4439652">c2</span><span class="op" id="4439654">,</span>&nbsp;<span class="ident" id="4439656">ok2</span>&nbsp;<span class="op" id="4439660">:=</span>&nbsp;<span class="ident" id="4439663"><a href="/html/template/escape.go.html#4439427">e</a></span><span class="op" id="4439664">.</span><span class="ident" id="4439665">escapeTemplateBody</span><span class="op" id="4439683">(</span><span class="ident" id="4439684"><a href="/html/template/escape.go.html#4439534">c1</a></span><span class="op" id="4439686">,</span>&nbsp;<span class="ident" id="4439688"><a href="/html/template/escape.go.html#4439464">t</a></span><span class="op" id="4439689">)</span><span class="op" id="4439690">;</span>&nbsp;<span class="ident" id="4439692"><a href="/html/template/escape.go.html#4439656">ok2</a></span>&nbsp;<span class="op" id="4439696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439701"><a href="/html/template/escape.go.html#4439534">c1</a></span><span class="op" id="4439703">,</span>&nbsp;<span class="ident" id="4439705"><a href="/html/template/escape.go.html#4439538">ok</a></span>&nbsp;<span class="op" id="4439708">=</span>&nbsp;<span class="ident" id="4439710"><a href="/html/template/escape.go.html#4439652">c2</a></span><span class="op" id="4439712">,</span>&nbsp;<span class="builtintype" id="4439714">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439721">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439725">//&nbsp;Use&nbsp;c1&nbsp;as&nbsp;the&nbsp;error&nbsp;context&nbsp;if&nbsp;neither&nbsp;assumption&nbsp;worked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439790">if</span>&nbsp;<span class="op" id="4439793">!</span><span class="ident" id="4439794"><a href="/html/template/escape.go.html#4439538">ok</a></span>&nbsp;<span class="op" id="4439797">&amp;&amp;</span>&nbsp;<span class="ident" id="4439800"><a href="/html/template/escape.go.html#4439534">c1</a></span><span class="op" id="4439802">.</span><span class="ident" id="4439803">state</span>&nbsp;<span class="op" id="4439809">!=</span>&nbsp;<span class="ident" id="4439812"><a href="/html/template/context.go.html#4396369">stateError</a></span>&nbsp;<span class="op" id="4439823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439827">return</span>&nbsp;<span class="ident" id="4439834"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4439841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439846">state</span><span class="op" id="4439851">:</span>&nbsp;<span class="ident" id="4439853"><a href="/html/template/context.go.html#4396369">stateError</a></span><span class="op" id="4439863">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439868">err</span><span class="op" id="4439871">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4439875"><a href="/html/template/error.go.html#4422980">errorf</a></span><span class="op" id="4439881">(</span><span class="ident" id="4439882"><a href="/html/template/error.go.html#4420515">ErrOutputContext</a></span><span class="op" id="4439898">,</span>&nbsp;<span class="ident" id="4439900"><a href="/html/template/escape.go.html#4439464">t</a></span><span class="op" id="4439901">.</span><span class="ident" id="4439902">Tree</span><span class="op" id="4439906">.</span><span class="ident" id="4439907">Root</span><span class="op" id="4439911">,</span>&nbsp;<span class="num" id="4439913">0</span><span class="op" id="4439914">,</span>&nbsp;<span class="string" id="4439916">&#34;cannot&nbsp;compute&nbsp;output&nbsp;context&nbsp;for&nbsp;template&nbsp;%s&#34;</span><span class="op" id="4439963">,</span>&nbsp;<span class="ident" id="4439965"><a href="/html/template/escape.go.html#4439464">t</a></span><span class="op" id="4439966">.</span><span class="ident" id="4439967">Name</span><span class="op" id="4439971">(</span><span class="op" id="4439972">)</span><span class="op" id="4439973">)</span><span class="op" id="4439974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439984">return</span>&nbsp;<span class="ident" id="4439991"><a href="/html/template/escape.go.html#4439534">c1</a></span><br>
<span class="lineno"></span><span class="op" id="4439994">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="4439997">//&nbsp;escapeTemplateBody&nbsp;escapes&nbsp;the&nbsp;given&nbsp;template&nbsp;assuming&nbsp;the&nbsp;given&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="4440072">//&nbsp;context,&nbsp;and&nbsp;returns&nbsp;the&nbsp;best&nbsp;guess&nbsp;at&nbsp;the&nbsp;output&nbsp;context&nbsp;and&nbsp;whether&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4440149">//&nbsp;assumption&nbsp;was&nbsp;correct.</span><br>
<span class="lineno"></span><span class="keyword" id="4440176">func</span>&nbsp;<span class="op" id="4440181">(</span><span class="ident" id="4440182">e</span>&nbsp;<span class="op" id="4440184">*</span><span class="ident" id="4440185"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4440192">)</span>&nbsp;<span class="ident" id="4440194">escapeTemplateBody</span><span class="op" id="4440212">(</span><span class="ident" id="4440213">c</span>&nbsp;<span class="ident" id="4440215"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4440222">,</span>&nbsp;<span class="ident" id="4440224">t</span>&nbsp;<span class="op" id="4440226">*</span><span class="ident" id="4440227"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4440235">.</span><span class="ident" id="4440236">Template</span><span class="op" id="4440244">)</span>&nbsp;<span class="op" id="4440246">(</span><span class="ident" id="4440247"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4440254">,</span>&nbsp;<span class="builtintype" id="4440256">bool</span><span class="op" id="4440260">)</span>&nbsp;<span class="op" id="4440262">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440265">filter</span>&nbsp;<span class="op" id="4440272">:=</span>&nbsp;<span class="keyword" id="4440275">func</span><span class="op" id="4440279">(</span><span class="ident" id="4440280">e1</span>&nbsp;<span class="op" id="4440283">*</span><span class="ident" id="4440284"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4440291">,</span>&nbsp;<span class="ident" id="4440293">c1</span>&nbsp;<span class="ident" id="4440296"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4440303">)</span>&nbsp;<span class="builtintype" id="4440305">bool</span>&nbsp;<span class="op" id="4440310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440314">if</span>&nbsp;<span class="ident" id="4440317"><a href="/html/template/escape.go.html#4440293">c1</a></span><span class="op" id="4440319">.</span><span class="ident" id="4440320">state</span>&nbsp;<span class="op" id="4440326">==</span>&nbsp;<span class="ident" id="4440329"><a href="/html/template/context.go.html#4396369">stateError</a></span>&nbsp;<span class="op" id="4440340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440345">//&nbsp;Do&nbsp;not&nbsp;update&nbsp;the&nbsp;input&nbsp;escaper,&nbsp;e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440387">return</span>&nbsp;<span class="builtintype" id="4440394">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440402">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440406">if</span>&nbsp;<span class="op" id="4440409">!</span><span class="ident" id="4440410"><a href="/html/template/escape.go.html#4440280">e1</a></span><span class="op" id="4440412">.</span><span class="ident" id="4440413">called</span><span class="op" id="4440419">[</span><span class="ident" id="4440420"><a href="/html/template/escape.go.html#4440224">t</a></span><span class="op" id="4440421">.</span><span class="ident" id="4440422">Name</span><span class="op" id="4440426">(</span><span class="op" id="4440427">)</span><span class="op" id="4440428">]</span>&nbsp;<span class="op" id="4440430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440435">//&nbsp;If&nbsp;t&nbsp;is&nbsp;not&nbsp;recursively&nbsp;called,&nbsp;then&nbsp;c1&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440487">//&nbsp;accurate&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440518">return</span>&nbsp;<span class="builtintype" id="4440525">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440532">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440536">//&nbsp;c1&nbsp;is&nbsp;accurate&nbsp;if&nbsp;it&nbsp;matches&nbsp;our&nbsp;assumed&nbsp;output&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440598">return</span>&nbsp;<span class="ident" id="4440605"><a href="/html/template/escape.go.html#4440213">c</a></span><span class="op" id="4440606">.</span><span class="ident" id="4440607">eq</span><span class="op" id="4440609">(</span><span class="ident" id="4440610"><a href="/html/template/escape.go.html#4440293">c1</a></span><span class="op" id="4440612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440618">//&nbsp;We&nbsp;need&nbsp;to&nbsp;assume&nbsp;an&nbsp;output&nbsp;context&nbsp;so&nbsp;that&nbsp;recursive&nbsp;template&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440691">//&nbsp;take&nbsp;the&nbsp;fast&nbsp;path&nbsp;out&nbsp;of&nbsp;escapeTree&nbsp;instead&nbsp;of&nbsp;infinitely&nbsp;recursing.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440765">//&nbsp;Naively&nbsp;assuming&nbsp;that&nbsp;the&nbsp;input&nbsp;context&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440835">//&nbsp;works&nbsp;&gt;90%&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440863"><a href="/html/template/escape.go.html#4440182">e</a></span><span class="op" id="4440864">.</span><span class="ident" id="4440865">output</span><span class="op" id="4440871">[</span><span class="ident" id="4440872"><a href="/html/template/escape.go.html#4440224">t</a></span><span class="op" id="4440873">.</span><span class="ident" id="4440874">Name</span><span class="op" id="4440878">(</span><span class="op" id="4440879">)</span><span class="op" id="4440880">]</span>&nbsp;<span class="op" id="4440882">=</span>&nbsp;<span class="ident" id="4440884"><a href="/html/template/escape.go.html#4440213">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440887">return</span>&nbsp;<span class="ident" id="4440894"><a href="/html/template/escape.go.html#4440182">e</a></span><span class="op" id="4440895">.</span><span class="ident" id="4440896">escapeListConditionally</span><span class="op" id="4440919">(</span><span class="ident" id="4440920"><a href="/html/template/escape.go.html#4440213">c</a></span><span class="op" id="4440921">,</span>&nbsp;<span class="ident" id="4440923"><a href="/html/template/escape.go.html#4440224">t</a></span><span class="op" id="4440924">.</span><span class="ident" id="4440925">Tree</span><span class="op" id="4440929">.</span><span class="ident" id="4440930">Root</span><span class="op" id="4440934">,</span>&nbsp;<span class="ident" id="4440936"><a href="/html/template/escape.go.html#4440265">filter</a></span><span class="op" id="4440942">)</span><br>
<span class="lineno"></span><span class="op" id="4440944">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="4440947">//&nbsp;delimEnds&nbsp;maps&nbsp;each&nbsp;delim&nbsp;to&nbsp;a&nbsp;string&nbsp;of&nbsp;characters&nbsp;that&nbsp;terminate&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4441021">var</span>&nbsp;<span class="ident" id="4441025">delimEnds</span>&nbsp;<span class="op" id="4441035">=</span>&nbsp;<span class="op" id="4441037">[</span><span class="op" id="4441038">...</span><span class="op" id="4441041">]</span><span class="builtintype" id="4441042">string</span><span class="op" id="4441048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441051"><a href="/html/template/context.go.html#4398142">delimDoubleQuote</a></span><span class="op" id="4441067">:</span>&nbsp;<span class="string" id="4441069">`&#34;`</span><span class="op" id="4441072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441075"><a href="/html/template/context.go.html#4398234">delimSingleQuote</a></span><span class="op" id="4441091">:</span>&nbsp;<span class="string" id="4441093">&#34;&#39;&#34;</span><span class="op" id="4441096">,</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441099">//&nbsp;Determined&nbsp;empirically&nbsp;by&nbsp;running&nbsp;the&nbsp;below&nbsp;in&nbsp;various&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441168">//&nbsp;var&nbsp;div&nbsp;=&nbsp;document.createElement(&#34;DIV&#34;);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441213">//&nbsp;for&nbsp;(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441253">//&nbsp;&nbsp;&nbsp;div.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=x&#34;&nbsp;+&nbsp;String.fromCharCode(i)&nbsp;+&nbsp;&#34;-bar&gt;&#34;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441327">//&nbsp;&nbsp;&nbsp;if&nbsp;(div.getElementsByTagName(&#34;SPAN&#34;)[0].title.indexOf(&#34;bar&#34;)&nbsp;&lt;&nbsp;0)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441399">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.write(&#34;&lt;p&gt;U+&#34;&nbsp;+&nbsp;i.toString(16));</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441449">//&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441455"><a href="/html/template/context.go.html#4398348">delimSpaceOrTagEnd</a></span><span class="op" id="4441473">:</span>&nbsp;<span class="string" id="4441475">&#34;&nbsp;\t\n\f\r&gt;&#34;</span><span class="op" id="4441487">,</span><br>
<span class="lineno"></span><span class="op" id="4441489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="4441492">var</span>&nbsp;<span class="ident" id="4441496">doctypeBytes</span>&nbsp;<span class="op" id="4441509">=</span>&nbsp;<span class="op" id="4441511">[</span><span class="op" id="4441512">]</span><span class="builtintype" id="4441513">byte</span><span class="op" id="4441517">(</span><span class="string" id="4441518">&#34;&lt;!DOCTYPE&#34;</span><span class="op" id="4441529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4441532">//&nbsp;escapeText&nbsp;escapes&nbsp;a&nbsp;text&nbsp;template&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4441576">func</span>&nbsp;<span class="op" id="4441581">(</span><span class="ident" id="4441582">e</span>&nbsp;<span class="op" id="4441584">*</span><span class="ident" id="4441585"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4441592">)</span>&nbsp;<span class="ident" id="4441594">escapeText</span><span class="op" id="4441604">(</span><span class="ident" id="4441605">c</span>&nbsp;<span class="ident" id="4441607"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4441614">,</span>&nbsp;<span class="ident" id="4441616">n</span>&nbsp;<span class="op" id="4441618">*</span><span class="ident" id="4441619"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4441624">.</span><span class="ident" id="4441625">TextNode</span><span class="op" id="4441633">)</span>&nbsp;<span class="ident" id="4441635"><a href="/html/template/context.go.html#4392413">context</a></span>&nbsp;<span class="op" id="4441643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441646">s</span><span class="op" id="4441647">,</span>&nbsp;<span class="ident" id="4441649">written</span><span class="op" id="4441656">,</span>&nbsp;<span class="ident" id="4441658">i</span><span class="op" id="4441659">,</span>&nbsp;<span class="ident" id="4441661">b</span>&nbsp;<span class="op" id="4441663">:=</span>&nbsp;<span class="ident" id="4441666"><a href="/html/template/escape.go.html#4441616">n</a></span><span class="op" id="4441667">.</span><span class="ident" id="4441668">Text</span><span class="op" id="4441672">,</span>&nbsp;<span class="num" id="4441674">0</span><span class="op" id="4441675">,</span>&nbsp;<span class="num" id="4441677">0</span><span class="op" id="4441678">,</span>&nbsp;<span class="builtinfunc" id="4441680">new</span><span class="op" id="4441683">(</span><span class="ident" id="4441684"><a href="/html/template/escape.go.html#4423317">bytes</a></span><span class="op" id="4441689">.</span><span class="ident" id="4441690">Buffer</span><span class="op" id="4441696">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441699">for</span>&nbsp;<span class="ident" id="4441703"><a href="/html/template/escape.go.html#4441658">i</a></span>&nbsp;<span class="op" id="4441705">!=</span>&nbsp;<span class="builtinfunc" id="4441708">len</span><span class="op" id="4441711">(</span><span class="ident" id="4441712"><a href="/html/template/escape.go.html#4441646">s</a></span><span class="op" id="4441713">)</span>&nbsp;<span class="op" id="4441715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441719">c1</span><span class="op" id="4441721">,</span>&nbsp;<span class="ident" id="4441723">nread</span>&nbsp;<span class="op" id="4441729">:=</span>&nbsp;<span class="ident" id="4441732"><a href="/html/template/escape.go.html#4443560">contextAfterText</a></span><span class="op" id="4441748">(</span><span class="ident" id="4441749"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4441750">,</span>&nbsp;<span class="ident" id="4441752"><a href="/html/template/escape.go.html#4441646">s</a></span><span class="op" id="4441753">[</span><span class="ident" id="4441754"><a href="/html/template/escape.go.html#4441658">i</a></span><span class="op" id="4441755">:</span><span class="op" id="4441756">]</span><span class="op" id="4441757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441761">i1</span>&nbsp;<span class="op" id="4441764">:=</span>&nbsp;<span class="ident" id="4441767"><a href="/html/template/escape.go.html#4441658">i</a></span>&nbsp;<span class="op" id="4441769">+</span>&nbsp;<span class="ident" id="4441771"><a href="/html/template/escape.go.html#4441723">nread</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441779">if</span>&nbsp;<span class="ident" id="4441782"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4441783">.</span><span class="ident" id="4441784">state</span>&nbsp;<span class="op" id="4441790">==</span>&nbsp;<span class="ident" id="4441793"><a href="/html/template/context.go.html#4394308">stateText</a></span>&nbsp;<span class="op" id="4441803">||</span>&nbsp;<span class="ident" id="4441806"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4441807">.</span><span class="ident" id="4441808">state</span>&nbsp;<span class="op" id="4441814">==</span>&nbsp;<span class="ident" id="4441817"><a href="/html/template/context.go.html#4395032">stateRCDATA</a></span>&nbsp;<span class="op" id="4441829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441834">end</span>&nbsp;<span class="op" id="4441838">:=</span>&nbsp;<span class="ident" id="4441841"><a href="/html/template/escape.go.html#4441761">i1</a></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441847">if</span>&nbsp;<span class="ident" id="4441850"><a href="/html/template/escape.go.html#4441719">c1</a></span><span class="op" id="4441852">.</span><span class="ident" id="4441853">state</span>&nbsp;<span class="op" id="4441859">!=</span>&nbsp;<span class="ident" id="4441862"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4441863">.</span><span class="ident" id="4441864">state</span>&nbsp;<span class="op" id="4441870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441876">for</span>&nbsp;<span class="ident" id="4441880">j</span>&nbsp;<span class="op" id="4441882">:=</span>&nbsp;<span class="ident" id="4441885"><a href="/html/template/escape.go.html#4441834">end</a></span>&nbsp;<span class="op" id="4441889">-</span>&nbsp;<span class="num" id="4441891">1</span><span class="op" id="4441892">;</span>&nbsp;<span class="ident" id="4441894"><a href="/html/template/escape.go.html#4441880">j</a></span>&nbsp;<span class="op" id="4441896">&gt;=</span>&nbsp;<span class="ident" id="4441899"><a href="/html/template/escape.go.html#4441658">i</a></span><span class="op" id="4441900">;</span>&nbsp;<span class="ident" id="4441902"><a href="/html/template/escape.go.html#4441880">j</a></span><span class="op" id="4441903">--</span>&nbsp;<span class="op" id="4441906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441913">if</span>&nbsp;<span class="ident" id="4441916"><a href="/html/template/escape.go.html#4441646">s</a></span><span class="op" id="4441917">[</span><span class="ident" id="4441918"><a href="/html/template/escape.go.html#4441880">j</a></span><span class="op" id="4441919">]</span>&nbsp;<span class="op" id="4441921">==</span>&nbsp;<span class="string" id="4441924">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4441928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441936"><a href="/html/template/escape.go.html#4441834">end</a></span>&nbsp;<span class="op" id="4441940">=</span>&nbsp;<span class="ident" id="4441942"><a href="/html/template/escape.go.html#4441880">j</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441950">break</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441977">for</span>&nbsp;<span class="ident" id="4441981">j</span>&nbsp;<span class="op" id="4441983">:=</span>&nbsp;<span class="ident" id="4441986"><a href="/html/template/escape.go.html#4441658">i</a></span><span class="op" id="4441987">;</span>&nbsp;<span class="ident" id="4441989"><a href="/html/template/escape.go.html#4441981">j</a></span>&nbsp;<span class="op" id="4441991">&lt;</span>&nbsp;<span class="ident" id="4441993"><a href="/html/template/escape.go.html#4441834">end</a></span><span class="op" id="4441996">;</span>&nbsp;<span class="ident" id="4441998"><a href="/html/template/escape.go.html#4441981">j</a></span><span class="op" id="4441999">++</span>&nbsp;<span class="op" id="4442002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442008">if</span>&nbsp;<span class="ident" id="4442011"><a href="/html/template/escape.go.html#4441646">s</a></span><span class="op" id="4442012">[</span><span class="ident" id="4442013"><a href="/html/template/escape.go.html#4441981">j</a></span><span class="op" id="4442014">]</span>&nbsp;<span class="op" id="4442016">==</span>&nbsp;<span class="string" id="4442019">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4442023">&amp;&amp;</span>&nbsp;<span class="op" id="4442026">!</span><span class="ident" id="4442027"><a href="/html/template/escape.go.html#4423317">bytes</a></span><span class="op" id="4442032">.</span><span class="ident" id="4442033">HasPrefix</span><span class="op" id="4442042">(</span><span class="ident" id="4442043"><a href="/html/template/escape.go.html#4423317">bytes</a></span><span class="op" id="4442048">.</span><span class="ident" id="4442049">ToUpper</span><span class="op" id="4442056">(</span><span class="ident" id="4442057"><a href="/html/template/escape.go.html#4441646">s</a></span><span class="op" id="4442058">[</span><span class="ident" id="4442059"><a href="/html/template/escape.go.html#4441981">j</a></span><span class="op" id="4442060">:</span><span class="op" id="4442061">]</span><span class="op" id="4442062">)</span><span class="op" id="4442063">,</span>&nbsp;<span class="ident" id="4442065"><a href="/html/template/escape.go.html#4441496">doctypeBytes</a></span><span class="op" id="4442077">)</span>&nbsp;<span class="op" id="4442079">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442086"><a href="/html/template/escape.go.html#4441661">b</a></span><span class="op" id="4442087">.</span><span class="ident" id="4442088">Write</span><span class="op" id="4442093">(</span><span class="ident" id="4442094"><a href="/html/template/escape.go.html#4441646">s</a></span><span class="op" id="4442095">[</span><span class="ident" id="4442096"><a href="/html/template/escape.go.html#4441649">written</a></span><span class="op" id="4442103">:</span><span class="ident" id="4442104"><a href="/html/template/escape.go.html#4441981">j</a></span><span class="op" id="4442105">]</span><span class="op" id="4442106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442113"><a href="/html/template/escape.go.html#4441661">b</a></span><span class="op" id="4442114">.</span><span class="ident" id="4442115">WriteString</span><span class="op" id="4442126">(</span><span class="string" id="4442127">&#34;&amp;lt;&#34;</span><span class="op" id="4442133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442140"><a href="/html/template/escape.go.html#4441649">written</a></span>&nbsp;<span class="op" id="4442148">=</span>&nbsp;<span class="ident" id="4442150"><a href="/html/template/escape.go.html#4441981">j</a></span>&nbsp;<span class="op" id="4442152">+</span>&nbsp;<span class="num" id="4442154">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442165">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442169">}</span>&nbsp;<span class="keyword" id="4442171">else</span>&nbsp;<span class="keyword" id="4442176">if</span>&nbsp;<span class="ident" id="4442179"><a href="/html/template/context.go.html#4397532">isComment</a></span><span class="op" id="4442188">(</span><span class="ident" id="4442189"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4442190">.</span><span class="ident" id="4442191">state</span><span class="op" id="4442196">)</span>&nbsp;<span class="op" id="4442198">&amp;&amp;</span>&nbsp;<span class="ident" id="4442201"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4442202">.</span><span class="ident" id="4442203">delim</span>&nbsp;<span class="op" id="4442209">==</span>&nbsp;<span class="ident" id="4442212"><a href="/html/template/context.go.html#4398044">delimNone</a></span>&nbsp;<span class="op" id="4442222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442227">switch</span>&nbsp;<span class="ident" id="4442234"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4442235">.</span><span class="ident" id="4442236">state</span>&nbsp;<span class="op" id="4442242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442247">case</span>&nbsp;<span class="ident" id="4442252"><a href="/html/template/context.go.html#4395579">stateJSBlockCmt</a></span><span class="op" id="4442267">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442273">//&nbsp;http://es5.github.com/#x7.4:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442309">//&nbsp;&#34;Comments&nbsp;behave&nbsp;like&nbsp;white&nbsp;space&nbsp;and&nbsp;are</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442358">//&nbsp;discarded&nbsp;except&nbsp;that,&nbsp;if&nbsp;a&nbsp;MultiLineComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442410">//&nbsp;contains&nbsp;a&nbsp;line&nbsp;terminator&nbsp;character,&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442460">//&nbsp;the&nbsp;entire&nbsp;comment&nbsp;is&nbsp;considered&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442508">//&nbsp;LineTerminator&nbsp;for&nbsp;purposes&nbsp;of&nbsp;parsing&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442557">//&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442588">if</span>&nbsp;<span class="ident" id="4442591"><a href="/html/template/escape.go.html#4423317">bytes</a></span><span class="op" id="4442596">.</span><span class="ident" id="4442597">IndexAny</span><span class="op" id="4442605">(</span><span class="ident" id="4442606"><a href="/html/template/escape.go.html#4441646">s</a></span><span class="op" id="4442607">[</span><span class="ident" id="4442608"><a href="/html/template/escape.go.html#4441649">written</a></span><span class="op" id="4442615">:</span><span class="ident" id="4442616"><a href="/html/template/escape.go.html#4441761">i1</a></span><span class="op" id="4442618">]</span><span class="op" id="4442619">,</span>&nbsp;<span class="string" id="4442621">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="4442639">)</span>&nbsp;<span class="op" id="4442641">!=</span>&nbsp;<span class="op" id="4442644">-</span><span class="num" id="4442645">1</span>&nbsp;<span class="op" id="4442647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442654"><a href="/html/template/escape.go.html#4441661">b</a></span><span class="op" id="4442655">.</span><span class="ident" id="4442656">WriteByte</span><span class="op" id="4442665">(</span><span class="string" id="4442666">&#39;\n&#39;</span><span class="op" id="4442670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442676">}</span>&nbsp;<span class="keyword" id="4442678">else</span>&nbsp;<span class="op" id="4442683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442690"><a href="/html/template/escape.go.html#4441661">b</a></span><span class="op" id="4442691">.</span><span class="ident" id="4442692">WriteByte</span><span class="op" id="4442701">(</span><span class="string" id="4442702">&#39;&nbsp;&#39;</span><span class="op" id="4442705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442711">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442716">case</span>&nbsp;<span class="ident" id="4442721"><a href="/html/template/context.go.html#4396188">stateCSSBlockCmt</a></span><span class="op" id="4442737">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442743"><a href="/html/template/escape.go.html#4441661">b</a></span><span class="op" id="4442744">.</span><span class="ident" id="4442745">WriteByte</span><span class="op" id="4442754">(</span><span class="string" id="4442755">&#39;&nbsp;&#39;</span><span class="op" id="4442758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442768"><a href="/html/template/escape.go.html#4441649">written</a></span>&nbsp;<span class="op" id="4442776">=</span>&nbsp;<span class="ident" id="4442778"><a href="/html/template/escape.go.html#4441761">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442783">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442787">if</span>&nbsp;<span class="ident" id="4442790"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4442791">.</span><span class="ident" id="4442792">state</span>&nbsp;<span class="op" id="4442798">!=</span>&nbsp;<span class="ident" id="4442801"><a href="/html/template/escape.go.html#4441719">c1</a></span><span class="op" id="4442803">.</span><span class="ident" id="4442804">state</span>&nbsp;<span class="op" id="4442810">&amp;&amp;</span>&nbsp;<span class="ident" id="4442813"><a href="/html/template/context.go.html#4397532">isComment</a></span><span class="op" id="4442822">(</span><span class="ident" id="4442823"><a href="/html/template/escape.go.html#4441719">c1</a></span><span class="op" id="4442825">.</span><span class="ident" id="4442826">state</span><span class="op" id="4442831">)</span>&nbsp;<span class="op" id="4442833">&amp;&amp;</span>&nbsp;<span class="ident" id="4442836"><a href="/html/template/escape.go.html#4441719">c1</a></span><span class="op" id="4442838">.</span><span class="ident" id="4442839">delim</span>&nbsp;<span class="op" id="4442845">==</span>&nbsp;<span class="ident" id="4442848"><a href="/html/template/context.go.html#4398044">delimNone</a></span>&nbsp;<span class="op" id="4442858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442863">//&nbsp;Preserve&nbsp;the&nbsp;portion&nbsp;between&nbsp;written&nbsp;and&nbsp;the&nbsp;comment&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442929">cs</span>&nbsp;<span class="op" id="4442932">:=</span>&nbsp;<span class="ident" id="4442935"><a href="/html/template/escape.go.html#4441761">i1</a></span>&nbsp;<span class="op" id="4442938">-</span>&nbsp;<span class="num" id="4442940">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442945">if</span>&nbsp;<span class="ident" id="4442948"><a href="/html/template/escape.go.html#4441719">c1</a></span><span class="op" id="4442950">.</span><span class="ident" id="4442951">state</span>&nbsp;<span class="op" id="4442957">==</span>&nbsp;<span class="ident" id="4442960"><a href="/html/template/context.go.html#4394876">stateHTMLCmt</a></span>&nbsp;<span class="op" id="4442973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442979">//&nbsp;&#34;&lt;!--&#34;&nbsp;instead&nbsp;of&nbsp;&#34;/*&#34;&nbsp;or&nbsp;&#34;//&#34;</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443017"><a href="/html/template/escape.go.html#4442929">cs</a></span>&nbsp;<span class="op" id="4443020">-=</span>&nbsp;<span class="num" id="4443023">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443033"><a href="/html/template/escape.go.html#4441661">b</a></span><span class="op" id="4443034">.</span><span class="ident" id="4443035">Write</span><span class="op" id="4443040">(</span><span class="ident" id="4443041"><a href="/html/template/escape.go.html#4441646">s</a></span><span class="op" id="4443042">[</span><span class="ident" id="4443043"><a href="/html/template/escape.go.html#4441649">written</a></span><span class="op" id="4443050">:</span><span class="ident" id="4443051"><a href="/html/template/escape.go.html#4442929">cs</a></span><span class="op" id="4443053">]</span><span class="op" id="4443054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443059"><a href="/html/template/escape.go.html#4441649">written</a></span>&nbsp;<span class="op" id="4443067">=</span>&nbsp;<span class="ident" id="4443069"><a href="/html/template/escape.go.html#4441761">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443074">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443078">if</span>&nbsp;<span class="ident" id="4443081"><a href="/html/template/escape.go.html#4441658">i</a></span>&nbsp;<span class="op" id="4443083">==</span>&nbsp;<span class="ident" id="4443086"><a href="/html/template/escape.go.html#4441761">i1</a></span>&nbsp;<span class="op" id="4443089">&amp;&amp;</span>&nbsp;<span class="ident" id="4443092"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4443093">.</span><span class="ident" id="4443094">state</span>&nbsp;<span class="op" id="4443100">==</span>&nbsp;<span class="ident" id="4443103"><a href="/html/template/escape.go.html#4441719">c1</a></span><span class="op" id="4443105">.</span><span class="ident" id="4443106">state</span>&nbsp;<span class="op" id="4443112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4443117">panic</span><span class="op" id="4443122">(</span><span class="ident" id="4443123"><a href="/html/template/escape.go.html#4423326">fmt</a></span><span class="op" id="4443126">.</span><span class="ident" id="4443127">Sprintf</span><span class="op" id="4443134">(</span><span class="string" id="4443135">&#34;infinite&nbsp;loop&nbsp;from&nbsp;%v&nbsp;to&nbsp;%v&nbsp;on&nbsp;%q..%q&#34;</span><span class="op" id="4443174">,</span>&nbsp;<span class="ident" id="4443176"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4443177">,</span>&nbsp;<span class="ident" id="4443179"><a href="/html/template/escape.go.html#4441719">c1</a></span><span class="op" id="4443181">,</span>&nbsp;<span class="ident" id="4443183"><a href="/html/template/escape.go.html#4441646">s</a></span><span class="op" id="4443184">[</span><span class="op" id="4443185">:</span><span class="ident" id="4443186"><a href="/html/template/escape.go.html#4441658">i</a></span><span class="op" id="4443187">]</span><span class="op" id="4443188">,</span>&nbsp;<span class="ident" id="4443190"><a href="/html/template/escape.go.html#4441646">s</a></span><span class="op" id="4443191">[</span><span class="ident" id="4443192"><a href="/html/template/escape.go.html#4441658">i</a></span><span class="op" id="4443193">:</span><span class="op" id="4443194">]</span><span class="op" id="4443195">)</span><span class="op" id="4443196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443204"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4443205">,</span>&nbsp;<span class="ident" id="4443207"><a href="/html/template/escape.go.html#4441658">i</a></span>&nbsp;<span class="op" id="4443209">=</span>&nbsp;<span class="ident" id="4443211"><a href="/html/template/escape.go.html#4441719">c1</a></span><span class="op" id="4443213">,</span>&nbsp;<span class="ident" id="4443215"><a href="/html/template/escape.go.html#4441761">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443219">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443223">if</span>&nbsp;<span class="ident" id="4443226"><a href="/html/template/escape.go.html#4441649">written</a></span>&nbsp;<span class="op" id="4443234">!=</span>&nbsp;<span class="num" id="4443237">0</span>&nbsp;<span class="op" id="4443239">&amp;&amp;</span>&nbsp;<span class="ident" id="4443242"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4443243">.</span><span class="ident" id="4443244">state</span>&nbsp;<span class="op" id="4443250">!=</span>&nbsp;<span class="ident" id="4443253"><a href="/html/template/context.go.html#4396369">stateError</a></span>&nbsp;<span class="op" id="4443264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443268">if</span>&nbsp;<span class="op" id="4443271">!</span><span class="ident" id="4443272"><a href="/html/template/context.go.html#4397532">isComment</a></span><span class="op" id="4443281">(</span><span class="ident" id="4443282"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4443283">.</span><span class="ident" id="4443284">state</span><span class="op" id="4443289">)</span>&nbsp;<span class="op" id="4443291">||</span>&nbsp;<span class="ident" id="4443294"><a href="/html/template/escape.go.html#4441605">c</a></span><span class="op" id="4443295">.</span><span class="ident" id="4443296">delim</span>&nbsp;<span class="op" id="4443302">!=</span>&nbsp;<span class="ident" id="4443305"><a href="/html/template/context.go.html#4398044">delimNone</a></span>&nbsp;<span class="op" id="4443315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443320"><a href="/html/template/escape.go.html#4441661">b</a></span><span class="op" id="4443321">.</span><span class="ident" id="4443322">Write</span><span class="op" id="4443327">(</span><span class="ident" id="4443328"><a href="/html/template/escape.go.html#4441616">n</a></span><span class="op" id="4443329">.</span><span class="ident" id="4443330">Text</span><span class="op" id="4443334">[</span><span class="ident" id="4443335"><a href="/html/template/escape.go.html#4441649">written</a></span><span class="op" id="4443342">:</span><span class="op" id="4443343">]</span><span class="op" id="4443344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443348">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443352"><a href="/html/template/escape.go.html#4441582">e</a></span><span class="op" id="4443353">.</span><span class="ident" id="4443354">editTextNode</span><span class="op" id="4443366">(</span><span class="ident" id="4443367"><a href="/html/template/escape.go.html#4441616">n</a></span><span class="op" id="4443368">,</span>&nbsp;<span class="ident" id="4443370"><a href="/html/template/escape.go.html#4441661">b</a></span><span class="op" id="4443371">.</span><span class="ident" id="4443372">Bytes</span><span class="op" id="4443377">(</span><span class="op" id="4443378">)</span><span class="op" id="4443379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443385">return</span>&nbsp;<span class="ident" id="4443392"><a href="/html/template/escape.go.html#4441605">c</a></span><br>
<span class="lineno"></span><span class="op" id="4443394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="4443397">//&nbsp;contextAfterText&nbsp;starts&nbsp;in&nbsp;context&nbsp;c,&nbsp;consumes&nbsp;some&nbsp;tokens&nbsp;from&nbsp;the&nbsp;front&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4443477">//&nbsp;s,&nbsp;then&nbsp;returns&nbsp;the&nbsp;context&nbsp;after&nbsp;those&nbsp;tokens&nbsp;and&nbsp;the&nbsp;unprocessed&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="4443555">func</span>&nbsp;<span class="ident" id="4443560">contextAfterText</span><span class="op" id="4443576">(</span><span class="ident" id="4443577">c</span>&nbsp;<span class="ident" id="4443579"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4443586">,</span>&nbsp;<span class="ident" id="4443588">s</span>&nbsp;<span class="op" id="4443590">[</span><span class="op" id="4443591">]</span><span class="builtintype" id="4443592">byte</span><span class="op" id="4443596">)</span>&nbsp;<span class="op" id="4443598">(</span><span class="ident" id="4443599"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4443606">,</span>&nbsp;<span class="builtintype" id="4443608">int</span><span class="op" id="4443611">)</span>&nbsp;<span class="op" id="4443613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443616">if</span>&nbsp;<span class="ident" id="4443619"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4443620">.</span><span class="ident" id="4443621">delim</span>&nbsp;<span class="op" id="4443627">==</span>&nbsp;<span class="ident" id="4443630"><a href="/html/template/context.go.html#4398044">delimNone</a></span>&nbsp;<span class="op" id="4443640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443644">c1</span><span class="op" id="4443646">,</span>&nbsp;<span class="ident" id="4443648">i</span>&nbsp;<span class="op" id="4443650">:=</span>&nbsp;<span class="ident" id="4443653"><a href="/html/template/transition.go.html#4483175">tSpecialTagEnd</a></span><span class="op" id="4443667">(</span><span class="ident" id="4443668"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4443669">,</span>&nbsp;<span class="ident" id="4443671"><a href="/html/template/escape.go.html#4443588">s</a></span><span class="op" id="4443672">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443676">if</span>&nbsp;<span class="ident" id="4443679"><a href="/html/template/escape.go.html#4443648">i</a></span>&nbsp;<span class="op" id="4443681">==</span>&nbsp;<span class="num" id="4443684">0</span>&nbsp;<span class="op" id="4443686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443691">//&nbsp;A&nbsp;special&nbsp;end&nbsp;tag&nbsp;(`&lt;/script&gt;`)&nbsp;has&nbsp;been&nbsp;seen&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443747">//&nbsp;all&nbsp;content&nbsp;preceding&nbsp;it&nbsp;has&nbsp;been&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443797">return</span>&nbsp;<span class="ident" id="4443804"><a href="/html/template/escape.go.html#4443644">c1</a></span><span class="op" id="4443806">,</span>&nbsp;<span class="num" id="4443808">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443812">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443816">//&nbsp;Consider&nbsp;all&nbsp;content&nbsp;up&nbsp;to&nbsp;any&nbsp;end&nbsp;tag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443861">return</span>&nbsp;<span class="ident" id="4443868"><a href="/html/template/transition.go.html#4478703">transitionFunc</a></span><span class="op" id="4443882">[</span><span class="ident" id="4443883"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4443884">.</span><span class="ident" id="4443885">state</span><span class="op" id="4443890">]</span><span class="op" id="4443891">(</span><span class="ident" id="4443892"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4443893">,</span>&nbsp;<span class="ident" id="4443895"><a href="/html/template/escape.go.html#4443588">s</a></span><span class="op" id="4443896">[</span><span class="op" id="4443897">:</span><span class="ident" id="4443898"><a href="/html/template/escape.go.html#4443648">i</a></span><span class="op" id="4443899">]</span><span class="op" id="4443900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443907">i</span>&nbsp;<span class="op" id="4443909">:=</span>&nbsp;<span class="ident" id="4443912"><a href="/html/template/escape.go.html#4423317">bytes</a></span><span class="op" id="4443917">.</span><span class="ident" id="4443918">IndexAny</span><span class="op" id="4443926">(</span><span class="ident" id="4443927"><a href="/html/template/escape.go.html#4443588">s</a></span><span class="op" id="4443928">,</span>&nbsp;<span class="ident" id="4443930"><a href="/html/template/escape.go.html#4441025">delimEnds</a></span><span class="op" id="4443939">[</span><span class="ident" id="4443940"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4443941">.</span><span class="ident" id="4443942">delim</span><span class="op" id="4443947">]</span><span class="op" id="4443948">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443951">if</span>&nbsp;<span class="ident" id="4443954"><a href="/html/template/escape.go.html#4443907">i</a></span>&nbsp;<span class="op" id="4443956">==</span>&nbsp;<span class="op" id="4443959">-</span><span class="num" id="4443960">1</span>&nbsp;<span class="op" id="4443962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443966"><a href="/html/template/escape.go.html#4443907">i</a></span>&nbsp;<span class="op" id="4443968">=</span>&nbsp;<span class="builtinfunc" id="4443970">len</span><span class="op" id="4443973">(</span><span class="ident" id="4443974"><a href="/html/template/escape.go.html#4443588">s</a></span><span class="op" id="4443975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443981">if</span>&nbsp;<span class="ident" id="4443984"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4443985">.</span><span class="ident" id="4443986">delim</span>&nbsp;<span class="op" id="4443992">==</span>&nbsp;<span class="ident" id="4443995"><a href="/html/template/context.go.html#4398348">delimSpaceOrTagEnd</a></span>&nbsp;<span class="op" id="4444014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444018">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444095">//&nbsp;lists&nbsp;the&nbsp;runes&nbsp;below&nbsp;as&nbsp;error&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444143">//&nbsp;Error&nbsp;out&nbsp;because&nbsp;HTML&nbsp;parsers&nbsp;may&nbsp;differ&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444201">//&nbsp;&#34;&lt;a&nbsp;id=&nbsp;onclick=f(&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ends&nbsp;inside&nbsp;id&#39;s&nbsp;or&nbsp;onclick&#39;s&nbsp;value,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444267">//&nbsp;&#34;&lt;a&nbsp;class=`foo&nbsp;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ends&nbsp;inside&nbsp;a&nbsp;value,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444317">//&nbsp;&#34;&lt;a&nbsp;style=font:&#39;Arial&#39;&#34;&nbsp;needs&nbsp;open-quote&nbsp;fixup.</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444370">//&nbsp;IE&nbsp;treats&nbsp;&#39;`&#39;&nbsp;as&nbsp;a&nbsp;quotation&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444415">if</span>&nbsp;<span class="ident" id="4444418">j</span>&nbsp;<span class="op" id="4444420">:=</span>&nbsp;<span class="ident" id="4444423"><a href="/html/template/escape.go.html#4423317">bytes</a></span><span class="op" id="4444428">.</span><span class="ident" id="4444429">IndexAny</span><span class="op" id="4444437">(</span><span class="ident" id="4444438"><a href="/html/template/escape.go.html#4443588">s</a></span><span class="op" id="4444439">[</span><span class="op" id="4444440">:</span><span class="ident" id="4444441"><a href="/html/template/escape.go.html#4443907">i</a></span><span class="op" id="4444442">]</span><span class="op" id="4444443">,</span>&nbsp;<span class="string" id="4444445">&#34;\&#34;&#39;&lt;=`&#34;</span><span class="op" id="4444453">)</span><span class="op" id="4444454">;</span>&nbsp;<span class="ident" id="4444456"><a href="/html/template/escape.go.html#4444418">j</a></span>&nbsp;<span class="op" id="4444458">&gt;=</span>&nbsp;<span class="num" id="4444461">0</span>&nbsp;<span class="op" id="4444463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444468">return</span>&nbsp;<span class="ident" id="4444475"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4444482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444488">state</span><span class="op" id="4444493">:</span>&nbsp;<span class="ident" id="4444495"><a href="/html/template/context.go.html#4396369">stateError</a></span><span class="op" id="4444505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444511">err</span><span class="op" id="4444514">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4444518"><a href="/html/template/error.go.html#4422980">errorf</a></span><span class="op" id="4444524">(</span><span class="ident" id="4444525"><a href="/html/template/error.go.html#4417919">ErrBadHTML</a></span><span class="op" id="4444535">,</span>&nbsp;<span class="ident" id="4444537">nil</span><span class="op" id="4444540">,</span>&nbsp;<span class="num" id="4444542">0</span><span class="op" id="4444543">,</span>&nbsp;<span class="string" id="4444545">&#34;%q&nbsp;in&nbsp;unquoted&nbsp;attr:&nbsp;%q&#34;</span><span class="op" id="4444570">,</span>&nbsp;<span class="ident" id="4444572"><a href="/html/template/escape.go.html#4443588">s</a></span><span class="op" id="4444573">[</span><span class="ident" id="4444574"><a href="/html/template/escape.go.html#4444418">j</a></span><span class="op" id="4444575">:</span><span class="ident" id="4444576"><a href="/html/template/escape.go.html#4444418">j</a></span><span class="op" id="4444577">+</span><span class="num" id="4444578">1</span><span class="op" id="4444579">]</span><span class="op" id="4444580">,</span>&nbsp;<span class="ident" id="4444582"><a href="/html/template/escape.go.html#4443588">s</a></span><span class="op" id="4444583">[</span><span class="op" id="4444584">:</span><span class="ident" id="4444585"><a href="/html/template/escape.go.html#4443907">i</a></span><span class="op" id="4444586">]</span><span class="op" id="4444587">)</span><span class="op" id="4444588">,</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444593">}</span><span class="op" id="4444594">,</span>&nbsp;<span class="builtinfunc" id="4444596">len</span><span class="op" id="4444599">(</span><span class="ident" id="4444600"><a href="/html/template/escape.go.html#4443588">s</a></span><span class="op" id="4444601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444611">if</span>&nbsp;<span class="ident" id="4444614"><a href="/html/template/escape.go.html#4443907">i</a></span>&nbsp;<span class="op" id="4444616">==</span>&nbsp;<span class="builtinfunc" id="4444619">len</span><span class="op" id="4444622">(</span><span class="ident" id="4444623"><a href="/html/template/escape.go.html#4443588">s</a></span><span class="op" id="4444624">)</span>&nbsp;<span class="op" id="4444626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444630">//&nbsp;Remain&nbsp;inside&nbsp;the&nbsp;attribute.</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444664">//&nbsp;Decode&nbsp;the&nbsp;value&nbsp;so&nbsp;non-HTML&nbsp;rules&nbsp;can&nbsp;easily&nbsp;handle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444722">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;button&nbsp;onclick=&#34;alert(&amp;quot;Hi!&amp;quot;)&#34;&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444773">//&nbsp;without&nbsp;having&nbsp;to&nbsp;entity&nbsp;decode&nbsp;token&nbsp;boundaries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444828">for</span>&nbsp;<span class="ident" id="4444832">u</span>&nbsp;<span class="op" id="4444834">:=</span>&nbsp;<span class="op" id="4444837">[</span><span class="op" id="4444838">]</span><span class="builtintype" id="4444839">byte</span><span class="op" id="4444843">(</span><span class="ident" id="4444844"><a href="/html/template/escape.go.html#4423333">html</a></span><span class="op" id="4444848">.</span><span class="ident" id="4444849">UnescapeString</span><span class="op" id="4444863">(</span><span class="builtintype" id="4444864">string</span><span class="op" id="4444870">(</span><span class="ident" id="4444871"><a href="/html/template/escape.go.html#4443588">s</a></span><span class="op" id="4444872">)</span><span class="op" id="4444873">)</span><span class="op" id="4444874">)</span><span class="op" id="4444875">;</span>&nbsp;<span class="builtinfunc" id="4444877">len</span><span class="op" id="4444880">(</span><span class="ident" id="4444881"><a href="/html/template/escape.go.html#4444832">u</a></span><span class="op" id="4444882">)</span>&nbsp;<span class="op" id="4444884">!=</span>&nbsp;<span class="num" id="4444887">0</span><span class="op" id="4444888">;</span>&nbsp;<span class="op" id="4444890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444895">c1</span><span class="op" id="4444897">,</span>&nbsp;<span class="ident" id="4444899">i1</span>&nbsp;<span class="op" id="4444902">:=</span>&nbsp;<span class="ident" id="4444905"><a href="/html/template/transition.go.html#4478703">transitionFunc</a></span><span class="op" id="4444919">[</span><span class="ident" id="4444920"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4444921">.</span><span class="ident" id="4444922">state</span><span class="op" id="4444927">]</span><span class="op" id="4444928">(</span><span class="ident" id="4444929"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4444930">,</span>&nbsp;<span class="ident" id="4444932"><a href="/html/template/escape.go.html#4444832">u</a></span><span class="op" id="4444933">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444938"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4444939">,</span>&nbsp;<span class="ident" id="4444941"><a href="/html/template/escape.go.html#4444832">u</a></span>&nbsp;<span class="op" id="4444943">=</span>&nbsp;<span class="ident" id="4444945"><a href="/html/template/escape.go.html#4444895">c1</a></span><span class="op" id="4444947">,</span>&nbsp;<span class="ident" id="4444949"><a href="/html/template/escape.go.html#4444832">u</a></span><span class="op" id="4444950">[</span><span class="ident" id="4444951"><a href="/html/template/escape.go.html#4444899">i1</a></span><span class="op" id="4444953">:</span><span class="op" id="4444954">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444962">return</span>&nbsp;<span class="ident" id="4444969"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4444970">,</span>&nbsp;<span class="builtinfunc" id="4444972">len</span><span class="op" id="4444975">(</span><span class="ident" id="4444976"><a href="/html/template/escape.go.html#4443588">s</a></span><span class="op" id="4444977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444983">if</span>&nbsp;<span class="ident" id="4444986"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4444987">.</span><span class="ident" id="4444988">delim</span>&nbsp;<span class="op" id="4444994">!=</span>&nbsp;<span class="ident" id="4444997"><a href="/html/template/context.go.html#4398348">delimSpaceOrTagEnd</a></span>&nbsp;<span class="op" id="4445016">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445020">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445044"><a href="/html/template/escape.go.html#4443907">i</a></span><span class="op" id="4445045">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445052">//&nbsp;On&nbsp;exiting&nbsp;an&nbsp;attribute,&nbsp;we&nbsp;discard&nbsp;all&nbsp;state&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445114">//&nbsp;except&nbsp;the&nbsp;state&nbsp;and&nbsp;element.</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445148">return</span>&nbsp;<span class="ident" id="4445155"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4445162">{</span><span class="ident" id="4445163">state</span><span class="op" id="4445168">:</span>&nbsp;<span class="ident" id="4445170"><a href="/html/template/context.go.html#4394398">stateTag</a></span><span class="op" id="4445178">,</span>&nbsp;<span class="ident" id="4445180">element</span><span class="op" id="4445187">:</span>&nbsp;<span class="ident" id="4445189"><a href="/html/template/escape.go.html#4443577">c</a></span><span class="op" id="4445190">.</span><span class="ident" id="4445191">element</span><span class="op" id="4445198">}</span><span class="op" id="4445199">,</span>&nbsp;<span class="ident" id="4445201"><a href="/html/template/escape.go.html#4443907">i</a></span><br>
<span class="lineno"></span><span class="op" id="4445203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4445206">//&nbsp;editActionNode&nbsp;records&nbsp;a&nbsp;change&nbsp;to&nbsp;an&nbsp;action&nbsp;pipeline&nbsp;for&nbsp;later&nbsp;commit.</span><br>
<span class="lineno"></span><span class="keyword" id="4445281">func</span>&nbsp;<span class="op" id="4445286">(</span><span class="ident" id="4445287">e</span>&nbsp;<span class="op" id="4445289">*</span><span class="ident" id="4445290"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4445297">)</span>&nbsp;<span class="ident" id="4445299">editActionNode</span><span class="op" id="4445313">(</span><span class="ident" id="4445314">n</span>&nbsp;<span class="op" id="4445316">*</span><span class="ident" id="4445317"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4445322">.</span><span class="ident" id="4445323">ActionNode</span><span class="op" id="4445333">,</span>&nbsp;<span class="ident" id="4445335">cmds</span>&nbsp;<span class="op" id="4445340">[</span><span class="op" id="4445341">]</span><span class="builtintype" id="4445342">string</span><span class="op" id="4445348">)</span>&nbsp;<span class="op" id="4445350">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445353">if</span>&nbsp;<span class="ident" id="4445356">_</span><span class="op" id="4445357">,</span>&nbsp;<span class="ident" id="4445359">ok</span>&nbsp;<span class="op" id="4445362">:=</span>&nbsp;<span class="ident" id="4445365"><a href="/html/template/escape.go.html#4445287">e</a></span><span class="op" id="4445366">.</span><span class="ident" id="4445367">actionNodeEdits</span><span class="op" id="4445382">[</span><span class="ident" id="4445383"><a href="/html/template/escape.go.html#4445314">n</a></span><span class="op" id="4445384">]</span><span class="op" id="4445385">;</span>&nbsp;<span class="ident" id="4445387"><a href="/html/template/escape.go.html#4445359">ok</a></span>&nbsp;<span class="op" id="4445390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4445394">panic</span><span class="op" id="4445399">(</span><span class="ident" id="4445400"><a href="/html/template/escape.go.html#4423326">fmt</a></span><span class="op" id="4445403">.</span><span class="ident" id="4445404">Sprintf</span><span class="op" id="4445411">(</span><span class="string" id="4445412">&#34;node&nbsp;%s&nbsp;shared&nbsp;between&nbsp;templates&#34;</span><span class="op" id="4445446">,</span>&nbsp;<span class="ident" id="4445448"><a href="/html/template/escape.go.html#4445314">n</a></span><span class="op" id="4445449">)</span><span class="op" id="4445450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445456"><a href="/html/template/escape.go.html#4445287">e</a></span><span class="op" id="4445457">.</span><span class="ident" id="4445458">actionNodeEdits</span><span class="op" id="4445473">[</span><span class="ident" id="4445474"><a href="/html/template/escape.go.html#4445314">n</a></span><span class="op" id="4445475">]</span>&nbsp;<span class="op" id="4445477">=</span>&nbsp;<span class="ident" id="4445479"><a href="/html/template/escape.go.html#4445335">cmds</a></span><br>
<span class="lineno"></span><span class="op" id="4445484">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="comment" id="4445487">//&nbsp;editTemplateNode&nbsp;records&nbsp;a&nbsp;change&nbsp;to&nbsp;a&nbsp;{{template}}&nbsp;callee&nbsp;for&nbsp;later&nbsp;commit.</span><br>
<span class="lineno"></span><span class="keyword" id="4445567">func</span>&nbsp;<span class="op" id="4445572">(</span><span class="ident" id="4445573">e</span>&nbsp;<span class="op" id="4445575">*</span><span class="ident" id="4445576"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4445583">)</span>&nbsp;<span class="ident" id="4445585">editTemplateNode</span><span class="op" id="4445601">(</span><span class="ident" id="4445602">n</span>&nbsp;<span class="op" id="4445604">*</span><span class="ident" id="4445605"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4445610">.</span><span class="ident" id="4445611">TemplateNode</span><span class="op" id="4445623">,</span>&nbsp;<span class="ident" id="4445625">callee</span>&nbsp;<span class="builtintype" id="4445632">string</span><span class="op" id="4445638">)</span>&nbsp;<span class="op" id="4445640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445643">if</span>&nbsp;<span class="ident" id="4445646">_</span><span class="op" id="4445647">,</span>&nbsp;<span class="ident" id="4445649">ok</span>&nbsp;<span class="op" id="4445652">:=</span>&nbsp;<span class="ident" id="4445655"><a href="/html/template/escape.go.html#4445573">e</a></span><span class="op" id="4445656">.</span><span class="ident" id="4445657">templateNodeEdits</span><span class="op" id="4445674">[</span><span class="ident" id="4445675"><a href="/html/template/escape.go.html#4445602">n</a></span><span class="op" id="4445676">]</span><span class="op" id="4445677">;</span>&nbsp;<span class="ident" id="4445679"><a href="/html/template/escape.go.html#4445649">ok</a></span>&nbsp;<span class="op" id="4445682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4445686">panic</span><span class="op" id="4445691">(</span><span class="ident" id="4445692"><a href="/html/template/escape.go.html#4423326">fmt</a></span><span class="op" id="4445695">.</span><span class="ident" id="4445696">Sprintf</span><span class="op" id="4445703">(</span><span class="string" id="4445704">&#34;node&nbsp;%s&nbsp;shared&nbsp;between&nbsp;templates&#34;</span><span class="op" id="4445738">,</span>&nbsp;<span class="ident" id="4445740"><a href="/html/template/escape.go.html#4445602">n</a></span><span class="op" id="4445741">)</span><span class="op" id="4445742">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445748"><a href="/html/template/escape.go.html#4445573">e</a></span><span class="op" id="4445749">.</span><span class="ident" id="4445750">templateNodeEdits</span><span class="op" id="4445767">[</span><span class="ident" id="4445768"><a href="/html/template/escape.go.html#4445602">n</a></span><span class="op" id="4445769">]</span>&nbsp;<span class="op" id="4445771">=</span>&nbsp;<span class="ident" id="4445773"><a href="/html/template/escape.go.html#4445625">callee</a></span><br>
<span class="lineno"></span><span class="op" id="4445780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4445783">//&nbsp;editTextNode&nbsp;records&nbsp;a&nbsp;change&nbsp;to&nbsp;a&nbsp;text&nbsp;node&nbsp;for&nbsp;later&nbsp;commit.</span><br>
<span class="lineno">730</span><span class="keyword" id="4445849">func</span>&nbsp;<span class="op" id="4445854">(</span><span class="ident" id="4445855">e</span>&nbsp;<span class="op" id="4445857">*</span><span class="ident" id="4445858"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4445865">)</span>&nbsp;<span class="ident" id="4445867">editTextNode</span><span class="op" id="4445879">(</span><span class="ident" id="4445880">n</span>&nbsp;<span class="op" id="4445882">*</span><span class="ident" id="4445883"><a href="/html/template/escape.go.html#4423364">parse</a></span><span class="op" id="4445888">.</span><span class="ident" id="4445889">TextNode</span><span class="op" id="4445897">,</span>&nbsp;<span class="ident" id="4445899">text</span>&nbsp;<span class="op" id="4445904">[</span><span class="op" id="4445905">]</span><span class="builtintype" id="4445906">byte</span><span class="op" id="4445910">)</span>&nbsp;<span class="op" id="4445912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445915">if</span>&nbsp;<span class="ident" id="4445918">_</span><span class="op" id="4445919">,</span>&nbsp;<span class="ident" id="4445921">ok</span>&nbsp;<span class="op" id="4445924">:=</span>&nbsp;<span class="ident" id="4445927"><a href="/html/template/escape.go.html#4445855">e</a></span><span class="op" id="4445928">.</span><span class="ident" id="4445929">textNodeEdits</span><span class="op" id="4445942">[</span><span class="ident" id="4445943"><a href="/html/template/escape.go.html#4445880">n</a></span><span class="op" id="4445944">]</span><span class="op" id="4445945">;</span>&nbsp;<span class="ident" id="4445947"><a href="/html/template/escape.go.html#4445921">ok</a></span>&nbsp;<span class="op" id="4445950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4445954">panic</span><span class="op" id="4445959">(</span><span class="ident" id="4445960"><a href="/html/template/escape.go.html#4423326">fmt</a></span><span class="op" id="4445963">.</span><span class="ident" id="4445964">Sprintf</span><span class="op" id="4445971">(</span><span class="string" id="4445972">&#34;node&nbsp;%s&nbsp;shared&nbsp;between&nbsp;templates&#34;</span><span class="op" id="4446006">,</span>&nbsp;<span class="ident" id="4446008"><a href="/html/template/escape.go.html#4445880">n</a></span><span class="op" id="4446009">)</span><span class="op" id="4446010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446016"><a href="/html/template/escape.go.html#4445855">e</a></span><span class="op" id="4446017">.</span><span class="ident" id="4446018">textNodeEdits</span><span class="op" id="4446031">[</span><span class="ident" id="4446032"><a href="/html/template/escape.go.html#4445880">n</a></span><span class="op" id="4446033">]</span>&nbsp;<span class="op" id="4446035">=</span>&nbsp;<span class="ident" id="4446037"><a href="/html/template/escape.go.html#4445899">text</a></span><br>
<span class="lineno">735</span><span class="op" id="4446042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4446045">//&nbsp;commit&nbsp;applies&nbsp;changes&nbsp;to&nbsp;actions&nbsp;and&nbsp;template&nbsp;calls&nbsp;needed&nbsp;to&nbsp;contextually</span><br>
<span class="lineno"></span><span class="comment" id="4446124">//&nbsp;autoescape&nbsp;content&nbsp;and&nbsp;adds&nbsp;any&nbsp;derived&nbsp;templates&nbsp;to&nbsp;the&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="4446189">func</span>&nbsp;<span class="op" id="4446194">(</span><span class="ident" id="4446195">e</span>&nbsp;<span class="op" id="4446197">*</span><span class="ident" id="4446198"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4446205">)</span>&nbsp;<span class="ident" id="4446207">commit</span><span class="op" id="4446213">(</span><span class="op" id="4446214">)</span>&nbsp;<span class="op" id="4446216">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446219">for</span>&nbsp;<span class="ident" id="4446223">name</span>&nbsp;<span class="op" id="4446228">:=</span>&nbsp;<span class="keyword" id="4446231">range</span>&nbsp;<span class="ident" id="4446237"><a href="/html/template/escape.go.html#4446195">e</a></span><span class="op" id="4446238">.</span><span class="ident" id="4446239">output</span>&nbsp;<span class="op" id="4446246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446250"><a href="/html/template/escape.go.html#4446195">e</a></span><span class="op" id="4446251">.</span><span class="ident" id="4446252">template</span><span class="op" id="4446260">(</span><span class="ident" id="4446261"><a href="/html/template/escape.go.html#4446223">name</a></span><span class="op" id="4446265">)</span><span class="op" id="4446266">.</span><span class="ident" id="4446267">Funcs</span><span class="op" id="4446272">(</span><span class="ident" id="4446273"><a href="/html/template/escape.go.html#4424402">funcMap</a></span><span class="op" id="4446280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446286">for</span>&nbsp;<span class="ident" id="4446290">_</span><span class="op" id="4446291">,</span>&nbsp;<span class="ident" id="4446293">t</span>&nbsp;<span class="op" id="4446295">:=</span>&nbsp;<span class="keyword" id="4446298">range</span>&nbsp;<span class="ident" id="4446304"><a href="/html/template/escape.go.html#4446195">e</a></span><span class="op" id="4446305">.</span><span class="ident" id="4446306">derived</span>&nbsp;<span class="op" id="4446314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446318">if</span>&nbsp;<span class="ident" id="4446321">_</span><span class="op" id="4446322">,</span>&nbsp;<span class="ident" id="4446324">err</span>&nbsp;<span class="op" id="4446328">:=</span>&nbsp;<span class="ident" id="4446331"><a href="/html/template/escape.go.html#4446195">e</a></span><span class="op" id="4446332">.</span><span class="ident" id="4446333">tmpl</span><span class="op" id="4446337">.</span><span class="ident" id="4446338">text</span><span class="op" id="4446342">.</span><span class="ident" id="4446343">AddParseTree</span><span class="op" id="4446355">(</span><span class="ident" id="4446356"><a href="/html/template/escape.go.html#4446293">t</a></span><span class="op" id="4446357">.</span><span class="ident" id="4446358">Name</span><span class="op" id="4446362">(</span><span class="op" id="4446363">)</span><span class="op" id="4446364">,</span>&nbsp;<span class="ident" id="4446366"><a href="/html/template/escape.go.html#4446293">t</a></span><span class="op" id="4446367">.</span><span class="ident" id="4446368">Tree</span><span class="op" id="4446372">)</span><span class="op" id="4446373">;</span>&nbsp;<span class="ident" id="4446375"><a href="/html/template/escape.go.html#4446324">err</a></span>&nbsp;<span class="op" id="4446379">!=</span>&nbsp;<span class="ident" id="4446382">nil</span>&nbsp;<span class="op" id="4446386">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4446391">panic</span><span class="op" id="4446396">(</span><span class="string" id="4446397">&#34;error&nbsp;adding&nbsp;derived&nbsp;template&#34;</span><span class="op" id="4446428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446438">for</span>&nbsp;<span class="ident" id="4446442">n</span><span class="op" id="4446443">,</span>&nbsp;<span class="ident" id="4446445">s</span>&nbsp;<span class="op" id="4446447">:=</span>&nbsp;<span class="keyword" id="4446450">range</span>&nbsp;<span class="ident" id="4446456"><a href="/html/template/escape.go.html#4446195">e</a></span><span class="op" id="4446457">.</span><span class="ident" id="4446458">actionNodeEdits</span>&nbsp;<span class="op" id="4446474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446478"><a href="/html/template/escape.go.html#4430427">ensurePipelineContains</a></span><span class="op" id="4446500">(</span><span class="ident" id="4446501"><a href="/html/template/escape.go.html#4446442">n</a></span><span class="op" id="4446502">.</span><span class="ident" id="4446503">Pipe</span><span class="op" id="4446507">,</span>&nbsp;<span class="ident" id="4446509"><a href="/html/template/escape.go.html#4446445">s</a></span><span class="op" id="4446510">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446516">for</span>&nbsp;<span class="ident" id="4446520">n</span><span class="op" id="4446521">,</span>&nbsp;<span class="ident" id="4446523">name</span>&nbsp;<span class="op" id="4446528">:=</span>&nbsp;<span class="keyword" id="4446531">range</span>&nbsp;<span class="ident" id="4446537"><a href="/html/template/escape.go.html#4446195">e</a></span><span class="op" id="4446538">.</span><span class="ident" id="4446539">templateNodeEdits</span>&nbsp;<span class="op" id="4446557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446561"><a href="/html/template/escape.go.html#4446520">n</a></span><span class="op" id="4446562">.</span><span class="ident" id="4446563">Name</span>&nbsp;<span class="op" id="4446568">=</span>&nbsp;<span class="ident" id="4446570"><a href="/html/template/escape.go.html#4446523">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446579">for</span>&nbsp;<span class="ident" id="4446583">n</span><span class="op" id="4446584">,</span>&nbsp;<span class="ident" id="4446586">s</span>&nbsp;<span class="op" id="4446588">:=</span>&nbsp;<span class="keyword" id="4446591">range</span>&nbsp;<span class="ident" id="4446597"><a href="/html/template/escape.go.html#4446195">e</a></span><span class="op" id="4446598">.</span><span class="ident" id="4446599">textNodeEdits</span>&nbsp;<span class="op" id="4446613">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446617"><a href="/html/template/escape.go.html#4446583">n</a></span><span class="op" id="4446618">.</span><span class="ident" id="4446619">Text</span>&nbsp;<span class="op" id="4446624">=</span>&nbsp;<span class="ident" id="4446626"><a href="/html/template/escape.go.html#4446586">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446629">}</span><br>
<span class="lineno"></span><span class="op" id="4446631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4446634">//&nbsp;template&nbsp;returns&nbsp;the&nbsp;named&nbsp;template&nbsp;given&nbsp;a&nbsp;mangled&nbsp;template&nbsp;name.</span><br>
<span class="lineno">760</span><span class="keyword" id="4446704">func</span>&nbsp;<span class="op" id="4446709">(</span><span class="ident" id="4446710">e</span>&nbsp;<span class="op" id="4446712">*</span><span class="ident" id="4446713"><a href="/html/template/escape.go.html#4425600">escaper</a></span><span class="op" id="4446720">)</span>&nbsp;<span class="ident" id="4446722">template</span><span class="op" id="4446730">(</span><span class="ident" id="4446731">name</span>&nbsp;<span class="builtintype" id="4446736">string</span><span class="op" id="4446742">)</span>&nbsp;<span class="op" id="4446744">*</span><span class="ident" id="4446745"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4446753">.</span><span class="ident" id="4446754">Template</span>&nbsp;<span class="op" id="4446763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446766">t</span>&nbsp;<span class="op" id="4446768">:=</span>&nbsp;<span class="ident" id="4446771"><a href="/html/template/escape.go.html#4446710">e</a></span><span class="op" id="4446772">.</span><span class="ident" id="4446773">tmpl</span><span class="op" id="4446777">.</span><span class="ident" id="4446778">text</span><span class="op" id="4446782">.</span><span class="ident" id="4446783">Lookup</span><span class="op" id="4446789">(</span><span class="ident" id="4446790"><a href="/html/template/escape.go.html#4446731">name</a></span><span class="op" id="4446794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446797">if</span>&nbsp;<span class="ident" id="4446800"><a href="/html/template/escape.go.html#4446766">t</a></span>&nbsp;<span class="op" id="4446802">==</span>&nbsp;<span class="ident" id="4446805">nil</span>&nbsp;<span class="op" id="4446809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446813"><a href="/html/template/escape.go.html#4446766">t</a></span>&nbsp;<span class="op" id="4446815">=</span>&nbsp;<span class="ident" id="4446817"><a href="/html/template/escape.go.html#4446710">e</a></span><span class="op" id="4446818">.</span><span class="ident" id="4446819">derived</span><span class="op" id="4446826">[</span><span class="ident" id="4446827"><a href="/html/template/escape.go.html#4446731">name</a></span><span class="op" id="4446831">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4446834">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446837">return</span>&nbsp;<span class="ident" id="4446844"><a href="/html/template/escape.go.html#4446766">t</a></span><br>
<span class="lineno"></span><span class="op" id="4446846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4446849">//&nbsp;Forwarding&nbsp;functions&nbsp;so&nbsp;that&nbsp;clients&nbsp;need&nbsp;only&nbsp;import&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4446919">//&nbsp;to&nbsp;reach&nbsp;the&nbsp;general&nbsp;escaping&nbsp;functions&nbsp;of&nbsp;text/template.</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="comment" id="4446981">//&nbsp;HTMLEscape&nbsp;writes&nbsp;to&nbsp;w&nbsp;the&nbsp;escaped&nbsp;HTML&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4447061">func</span>&nbsp;<span class="ident" id="4447066">HTMLEscape</span><span class="op" id="4447076">(</span><span class="ident" id="4447077">w</span>&nbsp;<span class="ident" id="4447079"><a href="/html/template/escape.go.html#4423341">io</a></span><span class="op" id="4447081">.</span><span class="ident" id="4447082">Writer</span><span class="op" id="4447088">,</span>&nbsp;<span class="ident" id="4447090">b</span>&nbsp;<span class="op" id="4447092">[</span><span class="op" id="4447093">]</span><span class="builtintype" id="4447094">byte</span><span class="op" id="4447098">)</span>&nbsp;<span class="op" id="4447100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447103"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4447111">.</span><span class="ident" id="4447112">HTMLEscape</span><span class="op" id="4447122">(</span><span class="ident" id="4447123"><a href="/html/template/escape.go.html#4447077">w</a></span><span class="op" id="4447124">,</span>&nbsp;<span class="ident" id="4447126"><a href="/html/template/escape.go.html#4447090">b</a></span><span class="op" id="4447127">)</span><br>
<span class="lineno"></span><span class="op" id="4447129">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="4447132">//&nbsp;HTMLEscapeString&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;HTML&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="4447214">func</span>&nbsp;<span class="ident" id="4447219">HTMLEscapeString</span><span class="op" id="4447235">(</span><span class="ident" id="4447236">s</span>&nbsp;<span class="builtintype" id="4447238">string</span><span class="op" id="4447244">)</span>&nbsp;<span class="builtintype" id="4447246">string</span>&nbsp;<span class="op" id="4447253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447256">return</span>&nbsp;<span class="ident" id="4447263"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4447271">.</span><span class="ident" id="4447272">HTMLEscapeString</span><span class="op" id="4447288">(</span><span class="ident" id="4447289"><a href="/html/template/escape.go.html#4447236">s</a></span><span class="op" id="4447290">)</span><br>
<span class="lineno"></span><span class="op" id="4447292">}</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span><span class="comment" id="4447295">//&nbsp;HTMLEscaper&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;HTML&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;textual</span><br>
<span class="lineno"></span><span class="comment" id="4447361">//&nbsp;representation&nbsp;of&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="keyword" id="4447397">func</span>&nbsp;<span class="ident" id="4447402">HTMLEscaper</span><span class="op" id="4447413">(</span><span class="ident" id="4447414">args</span>&nbsp;<span class="op" id="4447419">...</span><span class="keyword" id="4447422">interface</span><span class="op" id="4447431">{</span><span class="op" id="4447432">}</span><span class="op" id="4447433">)</span>&nbsp;<span class="builtintype" id="4447435">string</span>&nbsp;<span class="op" id="4447442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447445">return</span>&nbsp;<span class="ident" id="4447452"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4447460">.</span><span class="ident" id="4447461">HTMLEscaper</span><span class="op" id="4447472">(</span><span class="ident" id="4447473"><a href="/html/template/escape.go.html#4447414">args</a></span><span class="op" id="4447477">...</span><span class="op" id="4447480">)</span><br>
<span class="lineno">785</span><span class="op" id="4447482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4447485">//&nbsp;JSEscape&nbsp;writes&nbsp;to&nbsp;w&nbsp;the&nbsp;escaped&nbsp;JavaScript&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4447569">func</span>&nbsp;<span class="ident" id="4447574">JSEscape</span><span class="op" id="4447582">(</span><span class="ident" id="4447583">w</span>&nbsp;<span class="ident" id="4447585"><a href="/html/template/escape.go.html#4423341">io</a></span><span class="op" id="4447587">.</span><span class="ident" id="4447588">Writer</span><span class="op" id="4447594">,</span>&nbsp;<span class="ident" id="4447596">b</span>&nbsp;<span class="op" id="4447598">[</span><span class="op" id="4447599">]</span><span class="builtintype" id="4447600">byte</span><span class="op" id="4447604">)</span>&nbsp;<span class="op" id="4447606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447609"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4447617">.</span><span class="ident" id="4447618">JSEscape</span><span class="op" id="4447626">(</span><span class="ident" id="4447627"><a href="/html/template/escape.go.html#4447583">w</a></span><span class="op" id="4447628">,</span>&nbsp;<span class="ident" id="4447630"><a href="/html/template/escape.go.html#4447596">b</a></span><span class="op" id="4447631">)</span><br>
<span class="lineno">790</span><span class="op" id="4447633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4447636">//&nbsp;JSEscapeString&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;JavaScript&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;plain&nbsp;text&nbsp;data&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="4447722">func</span>&nbsp;<span class="ident" id="4447727">JSEscapeString</span><span class="op" id="4447741">(</span><span class="ident" id="4447742">s</span>&nbsp;<span class="builtintype" id="4447744">string</span><span class="op" id="4447750">)</span>&nbsp;<span class="builtintype" id="4447752">string</span>&nbsp;<span class="op" id="4447759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447762">return</span>&nbsp;<span class="ident" id="4447769"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4447777">.</span><span class="ident" id="4447778">JSEscapeString</span><span class="op" id="4447792">(</span><span class="ident" id="4447793"><a href="/html/template/escape.go.html#4447742">s</a></span><span class="op" id="4447794">)</span><br>
<span class="lineno">795</span><span class="op" id="4447796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4447799">//&nbsp;JSEscaper&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;JavaScript&nbsp;equivalent&nbsp;of&nbsp;the&nbsp;textual</span><br>
<span class="lineno"></span><span class="comment" id="4447869">//&nbsp;representation&nbsp;of&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="keyword" id="4447905">func</span>&nbsp;<span class="ident" id="4447910">JSEscaper</span><span class="op" id="4447919">(</span><span class="ident" id="4447920">args</span>&nbsp;<span class="op" id="4447925">...</span><span class="keyword" id="4447928">interface</span><span class="op" id="4447937">{</span><span class="op" id="4447938">}</span><span class="op" id="4447939">)</span>&nbsp;<span class="builtintype" id="4447941">string</span>&nbsp;<span class="op" id="4447948">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447951">return</span>&nbsp;<span class="ident" id="4447958"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4447966">.</span><span class="ident" id="4447967">JSEscaper</span><span class="op" id="4447976">(</span><span class="ident" id="4447977"><a href="/html/template/escape.go.html#4447920">args</a></span><span class="op" id="4447981">...</span><span class="op" id="4447984">)</span><br>
<span class="lineno"></span><span class="op" id="4447986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4447989">//&nbsp;URLQueryEscaper&nbsp;returns&nbsp;the&nbsp;escaped&nbsp;value&nbsp;of&nbsp;the&nbsp;textual&nbsp;representation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4448067">//&nbsp;its&nbsp;arguments&nbsp;in&nbsp;a&nbsp;form&nbsp;suitable&nbsp;for&nbsp;embedding&nbsp;in&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno">805</span><span class="keyword" id="4448133">func</span>&nbsp;<span class="ident" id="4448138">URLQueryEscaper</span><span class="op" id="4448153">(</span><span class="ident" id="4448154">args</span>&nbsp;<span class="op" id="4448159">...</span><span class="keyword" id="4448162">interface</span><span class="op" id="4448171">{</span><span class="op" id="4448172">}</span><span class="op" id="4448173">)</span>&nbsp;<span class="builtintype" id="4448175">string</span>&nbsp;<span class="op" id="4448182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448185">return</span>&nbsp;<span class="ident" id="4448192"><a href="/html/template/escape.go.html#4423347">template</a></span><span class="op" id="4448200">.</span><span class="ident" id="4448201">URLQueryEscaper</span><span class="op" id="4448216">(</span><span class="ident" id="4448217"><a href="/html/template/escape.go.html#4448154">args</a></span><span class="op" id="4448221">...</span><span class="op" id="4448224">)</span><br>
<span class="lineno"></span><span class="op" id="4448226">}</span>
</div>
</body>
</html>
