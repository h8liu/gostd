<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6559137">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6559193">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6559247">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6559298">package</span>&nbsp;<span class="ident" id="6559306">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6559315">import</span>&nbsp;<span class="op" id="6559322">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6559325">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6559334">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6559351">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6559361">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6559368">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6559374">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6559387">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6559394">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6559405">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6559416">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6559426">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6559429">type</span>&nbsp;<span class="ident" id="6559434">Args</span>&nbsp;<span class="keyword" id="6559439">struct</span>&nbsp;<span class="op" id="6559446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559449">A</span><span class="op" id="6559450">,</span>&nbsp;<span class="ident" id="6559452">B</span>&nbsp;<span class="builtintype" id="6559454">int</span><br>
<span class="lineno"></span><span class="op" id="6559458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6559461">type</span>&nbsp;<span class="ident" id="6559466">Reply</span>&nbsp;<span class="keyword" id="6559472">struct</span>&nbsp;<span class="op" id="6559479">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559482">C</span>&nbsp;<span class="builtintype" id="6559484">int</span><br>
<span class="lineno"></span><span class="op" id="6559488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6559491">type</span>&nbsp;<span class="ident" id="6559496">Arith</span>&nbsp;<span class="builtintype" id="6559502">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6559507">type</span>&nbsp;<span class="ident" id="6559512">ArithAddResp</span>&nbsp;<span class="keyword" id="6559525">struct</span>&nbsp;<span class="op" id="6559532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559535">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6559542">interface</span><span class="op" id="6559551">{</span><span class="op" id="6559552">}</span>&nbsp;<span class="string" id="6559554">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559567">Result</span>&nbsp;<span class="ident" id="6559574">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6559586">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559603">Error</span>&nbsp;&nbsp;<span class="keyword" id="6559610">interface</span><span class="op" id="6559619">{</span><span class="op" id="6559620">}</span>&nbsp;<span class="string" id="6559622">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6559637">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6559640">func</span>&nbsp;<span class="op" id="6559645">(</span><span class="ident" id="6559646">t</span>&nbsp;<span class="op" id="6559648">*</span><span class="ident" id="6559649">Arith</span><span class="op" id="6559654">)</span>&nbsp;<span class="ident" id="6559656">Add</span><span class="op" id="6559659">(</span><span class="ident" id="6559660">args</span>&nbsp;<span class="op" id="6559665">*</span><span class="ident" id="6559666">Args</span><span class="op" id="6559670">,</span>&nbsp;<span class="ident" id="6559672">reply</span>&nbsp;<span class="op" id="6559678">*</span><span class="ident" id="6559679">Reply</span><span class="op" id="6559684">)</span>&nbsp;<span class="builtintype" id="6559686">error</span>&nbsp;<span class="op" id="6559692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559695">reply</span><span class="op" id="6559700">.</span><span class="ident" id="6559701">C</span>&nbsp;<span class="op" id="6559703">=</span>&nbsp;<span class="ident" id="6559705">args</span><span class="op" id="6559709">.</span><span class="ident" id="6559710">A</span>&nbsp;<span class="op" id="6559712">+</span>&nbsp;<span class="ident" id="6559714">args</span><span class="op" id="6559718">.</span><span class="ident" id="6559719">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6559722">return</span>&nbsp;<span class="ident" id="6559729">nil</span><br>
<span class="lineno"></span><span class="op" id="6559733">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6559736">func</span>&nbsp;<span class="op" id="6559741">(</span><span class="ident" id="6559742">t</span>&nbsp;<span class="op" id="6559744">*</span><span class="ident" id="6559745">Arith</span><span class="op" id="6559750">)</span>&nbsp;<span class="ident" id="6559752">Mul</span><span class="op" id="6559755">(</span><span class="ident" id="6559756">args</span>&nbsp;<span class="op" id="6559761">*</span><span class="ident" id="6559762">Args</span><span class="op" id="6559766">,</span>&nbsp;<span class="ident" id="6559768">reply</span>&nbsp;<span class="op" id="6559774">*</span><span class="ident" id="6559775">Reply</span><span class="op" id="6559780">)</span>&nbsp;<span class="builtintype" id="6559782">error</span>&nbsp;<span class="op" id="6559788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559791">reply</span><span class="op" id="6559796">.</span><span class="ident" id="6559797">C</span>&nbsp;<span class="op" id="6559799">=</span>&nbsp;<span class="ident" id="6559801">args</span><span class="op" id="6559805">.</span><span class="ident" id="6559806">A</span>&nbsp;<span class="op" id="6559808">*</span>&nbsp;<span class="ident" id="6559810">args</span><span class="op" id="6559814">.</span><span class="ident" id="6559815">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6559818">return</span>&nbsp;<span class="ident" id="6559825">nil</span><br>
<span class="lineno"></span><span class="op" id="6559829">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6559832">func</span>&nbsp;<span class="op" id="6559837">(</span><span class="ident" id="6559838">t</span>&nbsp;<span class="op" id="6559840">*</span><span class="ident" id="6559841">Arith</span><span class="op" id="6559846">)</span>&nbsp;<span class="ident" id="6559848">Div</span><span class="op" id="6559851">(</span><span class="ident" id="6559852">args</span>&nbsp;<span class="op" id="6559857">*</span><span class="ident" id="6559858">Args</span><span class="op" id="6559862">,</span>&nbsp;<span class="ident" id="6559864">reply</span>&nbsp;<span class="op" id="6559870">*</span><span class="ident" id="6559871">Reply</span><span class="op" id="6559876">)</span>&nbsp;<span class="builtintype" id="6559878">error</span>&nbsp;<span class="op" id="6559884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6559887">if</span>&nbsp;<span class="ident" id="6559890">args</span><span class="op" id="6559894">.</span><span class="ident" id="6559895">B</span>&nbsp;<span class="op" id="6559897">==</span>&nbsp;<span class="num" id="6559900">0</span>&nbsp;<span class="op" id="6559902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6559906">return</span>&nbsp;<span class="ident" id="6559913">errors</span><span class="op" id="6559919">.</span><span class="ident" id="6559920">New</span><span class="op" id="6559923">(</span><span class="string" id="6559924">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="6559940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559943">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559946">reply</span><span class="op" id="6559951">.</span><span class="ident" id="6559952">C</span>&nbsp;<span class="op" id="6559954">=</span>&nbsp;<span class="ident" id="6559956">args</span><span class="op" id="6559960">.</span><span class="ident" id="6559961">A</span>&nbsp;<span class="op" id="6559963">/</span>&nbsp;<span class="ident" id="6559965">args</span><span class="op" id="6559969">.</span><span class="ident" id="6559970">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6559973">return</span>&nbsp;<span class="ident" id="6559980">nil</span><br>
<span class="lineno"></span><span class="op" id="6559984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6559987">func</span>&nbsp;<span class="op" id="6559992">(</span><span class="ident" id="6559993">t</span>&nbsp;<span class="op" id="6559995">*</span><span class="ident" id="6559996">Arith</span><span class="op" id="6560001">)</span>&nbsp;<span class="ident" id="6560003">Error</span><span class="op" id="6560008">(</span><span class="ident" id="6560009">args</span>&nbsp;<span class="op" id="6560014">*</span><span class="ident" id="6560015">Args</span><span class="op" id="6560019">,</span>&nbsp;<span class="ident" id="6560021">reply</span>&nbsp;<span class="op" id="6560027">*</span><span class="ident" id="6560028">Reply</span><span class="op" id="6560033">)</span>&nbsp;<span class="builtintype" id="6560035">error</span>&nbsp;<span class="op" id="6560041">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6560044">panic</span><span class="op" id="6560049">(</span><span class="string" id="6560050">&#34;ERROR&#34;</span><span class="op" id="6560057">)</span><br>
<span class="lineno"></span><span class="op" id="6560059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6560062">func</span>&nbsp;<span class="ident" id="6560067">init</span><span class="op" id="6560071">(</span><span class="op" id="6560072">)</span>&nbsp;<span class="op" id="6560074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560077">rpc</span><span class="op" id="6560080">.</span><span class="ident" id="6560081">Register</span><span class="op" id="6560089">(</span><span class="builtinfunc" id="6560090">new</span><span class="op" id="6560093">(</span><span class="ident" id="6560094">Arith</span><span class="op" id="6560099">)</span><span class="op" id="6560100">)</span><br>
<span class="lineno">60</span><span class="op" id="6560102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6560105">func</span>&nbsp;<span class="ident" id="6560110">TestServerNoParams</span><span class="op" id="6560128">(</span><span class="ident" id="6560129">t</span>&nbsp;<span class="op" id="6560131">*</span><span class="ident" id="6560132">testing</span><span class="op" id="6560139">.</span><span class="ident" id="6560140">T</span><span class="op" id="6560141">)</span>&nbsp;<span class="op" id="6560143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560146">cli</span><span class="op" id="6560149">,</span>&nbsp;<span class="ident" id="6560151">srv</span>&nbsp;<span class="op" id="6560155">:=</span>&nbsp;<span class="ident" id="6560158">net</span><span class="op" id="6560161">.</span><span class="ident" id="6560162">Pipe</span><span class="op" id="6560166">(</span><span class="op" id="6560167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560170">defer</span>&nbsp;<span class="ident" id="6560176">cli</span><span class="op" id="6560179">.</span><span class="ident" id="6560180">Close</span><span class="op" id="6560185">(</span><span class="op" id="6560186">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560189">go</span>&nbsp;<span class="ident" id="6560192">ServeConn</span><span class="op" id="6560201">(</span><span class="ident" id="6560202">srv</span><span class="op" id="6560205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560208">dec</span>&nbsp;<span class="op" id="6560212">:=</span>&nbsp;<span class="ident" id="6560215">json</span><span class="op" id="6560219">.</span><span class="ident" id="6560220">NewDecoder</span><span class="op" id="6560230">(</span><span class="ident" id="6560231">cli</span><span class="op" id="6560234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560238">fmt</span><span class="op" id="6560241">.</span><span class="ident" id="6560242">Fprintf</span><span class="op" id="6560249">(</span><span class="ident" id="6560250">cli</span><span class="op" id="6560253">,</span>&nbsp;<span class="string" id="6560255">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="6560293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560296">var</span>&nbsp;<span class="ident" id="6560300">resp</span>&nbsp;<span class="ident" id="6560305">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560319">if</span>&nbsp;<span class="ident" id="6560322">err</span>&nbsp;<span class="op" id="6560326">:=</span>&nbsp;<span class="ident" id="6560329">dec</span><span class="op" id="6560332">.</span><span class="ident" id="6560333">Decode</span><span class="op" id="6560339">(</span><span class="op" id="6560340">&amp;</span><span class="ident" id="6560341">resp</span><span class="op" id="6560345">)</span><span class="op" id="6560346">;</span>&nbsp;<span class="ident" id="6560348">err</span>&nbsp;<span class="op" id="6560352">!=</span>&nbsp;<span class="ident" id="6560355">nil</span>&nbsp;<span class="op" id="6560359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560363">t</span><span class="op" id="6560364">.</span><span class="ident" id="6560365">Fatalf</span><span class="op" id="6560371">(</span><span class="string" id="6560372">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="6560400">,</span>&nbsp;<span class="ident" id="6560402">err</span><span class="op" id="6560405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6560408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560411">if</span>&nbsp;<span class="ident" id="6560414">resp</span><span class="op" id="6560418">.</span><span class="ident" id="6560419">Error</span>&nbsp;<span class="op" id="6560425">==</span>&nbsp;<span class="ident" id="6560428">nil</span>&nbsp;<span class="op" id="6560432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560436">t</span><span class="op" id="6560437">.</span><span class="ident" id="6560438">Fatalf</span><span class="op" id="6560444">(</span><span class="string" id="6560445">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="6560470">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6560473">}</span><br>
<span class="lineno"></span><span class="op" id="6560475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6560478">func</span>&nbsp;<span class="ident" id="6560483">TestServerEmptyMessage</span><span class="op" id="6560505">(</span><span class="ident" id="6560506">t</span>&nbsp;<span class="op" id="6560508">*</span><span class="ident" id="6560509">testing</span><span class="op" id="6560516">.</span><span class="ident" id="6560517">T</span><span class="op" id="6560518">)</span>&nbsp;<span class="op" id="6560520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560523">cli</span><span class="op" id="6560526">,</span>&nbsp;<span class="ident" id="6560528">srv</span>&nbsp;<span class="op" id="6560532">:=</span>&nbsp;<span class="ident" id="6560535">net</span><span class="op" id="6560538">.</span><span class="ident" id="6560539">Pipe</span><span class="op" id="6560543">(</span><span class="op" id="6560544">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560547">defer</span>&nbsp;<span class="ident" id="6560553">cli</span><span class="op" id="6560556">.</span><span class="ident" id="6560557">Close</span><span class="op" id="6560562">(</span><span class="op" id="6560563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560566">go</span>&nbsp;<span class="ident" id="6560569">ServeConn</span><span class="op" id="6560578">(</span><span class="ident" id="6560579">srv</span><span class="op" id="6560582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560585">dec</span>&nbsp;<span class="op" id="6560589">:=</span>&nbsp;<span class="ident" id="6560592">json</span><span class="op" id="6560596">.</span><span class="ident" id="6560597">NewDecoder</span><span class="op" id="6560607">(</span><span class="ident" id="6560608">cli</span><span class="op" id="6560611">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560615">fmt</span><span class="op" id="6560618">.</span><span class="ident" id="6560619">Fprintf</span><span class="op" id="6560626">(</span><span class="ident" id="6560627">cli</span><span class="op" id="6560630">,</span>&nbsp;<span class="string" id="6560632">&#34;{}&#34;</span><span class="op" id="6560636">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560639">var</span>&nbsp;<span class="ident" id="6560643">resp</span>&nbsp;<span class="ident" id="6560648">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560662">if</span>&nbsp;<span class="ident" id="6560665">err</span>&nbsp;<span class="op" id="6560669">:=</span>&nbsp;<span class="ident" id="6560672">dec</span><span class="op" id="6560675">.</span><span class="ident" id="6560676">Decode</span><span class="op" id="6560682">(</span><span class="op" id="6560683">&amp;</span><span class="ident" id="6560684">resp</span><span class="op" id="6560688">)</span><span class="op" id="6560689">;</span>&nbsp;<span class="ident" id="6560691">err</span>&nbsp;<span class="op" id="6560695">!=</span>&nbsp;<span class="ident" id="6560698">nil</span>&nbsp;<span class="op" id="6560702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560706">t</span><span class="op" id="6560707">.</span><span class="ident" id="6560708">Fatalf</span><span class="op" id="6560714">(</span><span class="string" id="6560715">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="6560739">,</span>&nbsp;<span class="ident" id="6560741">err</span><span class="op" id="6560744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6560747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560750">if</span>&nbsp;<span class="ident" id="6560753">resp</span><span class="op" id="6560757">.</span><span class="ident" id="6560758">Error</span>&nbsp;<span class="op" id="6560764">==</span>&nbsp;<span class="ident" id="6560767">nil</span>&nbsp;<span class="op" id="6560771">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560775">t</span><span class="op" id="6560776">.</span><span class="ident" id="6560777">Fatalf</span><span class="op" id="6560783">(</span><span class="string" id="6560784">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="6560809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6560812">}</span><br>
<span class="lineno"></span><span class="op" id="6560814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6560817">func</span>&nbsp;<span class="ident" id="6560822">TestServer</span><span class="op" id="6560832">(</span><span class="ident" id="6560833">t</span>&nbsp;<span class="op" id="6560835">*</span><span class="ident" id="6560836">testing</span><span class="op" id="6560843">.</span><span class="ident" id="6560844">T</span><span class="op" id="6560845">)</span>&nbsp;<span class="op" id="6560847">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560850">cli</span><span class="op" id="6560853">,</span>&nbsp;<span class="ident" id="6560855">srv</span>&nbsp;<span class="op" id="6560859">:=</span>&nbsp;<span class="ident" id="6560862">net</span><span class="op" id="6560865">.</span><span class="ident" id="6560866">Pipe</span><span class="op" id="6560870">(</span><span class="op" id="6560871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560874">defer</span>&nbsp;<span class="ident" id="6560880">cli</span><span class="op" id="6560883">.</span><span class="ident" id="6560884">Close</span><span class="op" id="6560889">(</span><span class="op" id="6560890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560893">go</span>&nbsp;<span class="ident" id="6560896">ServeConn</span><span class="op" id="6560905">(</span><span class="ident" id="6560906">srv</span><span class="op" id="6560909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560912">dec</span>&nbsp;<span class="op" id="6560916">:=</span>&nbsp;<span class="ident" id="6560919">json</span><span class="op" id="6560923">.</span><span class="ident" id="6560924">NewDecoder</span><span class="op" id="6560934">(</span><span class="ident" id="6560935">cli</span><span class="op" id="6560938">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6560942">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560999">for</span>&nbsp;<span class="ident" id="6561003">i</span>&nbsp;<span class="op" id="6561005">:=</span>&nbsp;<span class="num" id="6561008">0</span><span class="op" id="6561009">;</span>&nbsp;<span class="ident" id="6561011">i</span>&nbsp;<span class="op" id="6561013">&lt;</span>&nbsp;<span class="num" id="6561015">10</span><span class="op" id="6561017">;</span>&nbsp;<span class="ident" id="6561019">i</span><span class="op" id="6561020">++</span>&nbsp;<span class="op" id="6561023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561027">fmt</span><span class="op" id="6561030">.</span><span class="ident" id="6561031">Fprintf</span><span class="op" id="6561038">(</span><span class="ident" id="6561039">cli</span><span class="op" id="6561042">,</span>&nbsp;<span class="string" id="6561044">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="6561117">,</span>&nbsp;<span class="ident" id="6561119">i</span><span class="op" id="6561120">,</span>&nbsp;<span class="ident" id="6561122">i</span><span class="op" id="6561123">,</span>&nbsp;<span class="ident" id="6561125">i</span><span class="op" id="6561126">+</span><span class="num" id="6561127">1</span><span class="op" id="6561128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561132">var</span>&nbsp;<span class="ident" id="6561136">resp</span>&nbsp;<span class="ident" id="6561141">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561156">err</span>&nbsp;<span class="op" id="6561160">:=</span>&nbsp;<span class="ident" id="6561163">dec</span><span class="op" id="6561166">.</span><span class="ident" id="6561167">Decode</span><span class="op" id="6561173">(</span><span class="op" id="6561174">&amp;</span><span class="ident" id="6561175">resp</span><span class="op" id="6561179">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561183">if</span>&nbsp;<span class="ident" id="6561186">err</span>&nbsp;<span class="op" id="6561190">!=</span>&nbsp;<span class="ident" id="6561193">nil</span>&nbsp;<span class="op" id="6561197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561202">t</span><span class="op" id="6561203">.</span><span class="ident" id="6561204">Fatalf</span><span class="op" id="6561210">(</span><span class="string" id="6561211">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="6561223">,</span>&nbsp;<span class="ident" id="6561225">err</span><span class="op" id="6561228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561236">if</span>&nbsp;<span class="ident" id="6561239">resp</span><span class="op" id="6561243">.</span><span class="ident" id="6561244">Error</span>&nbsp;<span class="op" id="6561250">!=</span>&nbsp;<span class="ident" id="6561253">nil</span>&nbsp;<span class="op" id="6561257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561262">t</span><span class="op" id="6561263">.</span><span class="ident" id="6561264">Fatalf</span><span class="op" id="6561270">(</span><span class="string" id="6561271">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="6561287">,</span>&nbsp;<span class="ident" id="6561289">resp</span><span class="op" id="6561293">.</span><span class="ident" id="6561294">Error</span><span class="op" id="6561299">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561307">if</span>&nbsp;<span class="ident" id="6561310">resp</span><span class="op" id="6561314">.</span><span class="ident" id="6561315">Id</span><span class="op" id="6561317">.</span><span class="op" id="6561318">(</span><span class="builtintype" id="6561319">string</span><span class="op" id="6561325">)</span>&nbsp;<span class="op" id="6561327">!=</span>&nbsp;<span class="builtintype" id="6561330">string</span><span class="op" id="6561336">(</span><span class="ident" id="6561337">i</span><span class="op" id="6561338">)</span>&nbsp;<span class="op" id="6561340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561345">t</span><span class="op" id="6561346">.</span><span class="ident" id="6561347">Fatalf</span><span class="op" id="6561353">(</span><span class="string" id="6561354">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6561379">,</span>&nbsp;<span class="ident" id="6561381">resp</span><span class="op" id="6561385">.</span><span class="ident" id="6561386">Id</span><span class="op" id="6561388">.</span><span class="op" id="6561389">(</span><span class="builtintype" id="6561390">string</span><span class="op" id="6561396">)</span><span class="op" id="6561397">,</span>&nbsp;<span class="builtintype" id="6561399">string</span><span class="op" id="6561405">(</span><span class="ident" id="6561406">i</span><span class="op" id="6561407">)</span><span class="op" id="6561408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561416">if</span>&nbsp;<span class="ident" id="6561419">resp</span><span class="op" id="6561423">.</span><span class="ident" id="6561424">Result</span><span class="op" id="6561430">.</span><span class="ident" id="6561431">C</span>&nbsp;<span class="op" id="6561433">!=</span>&nbsp;<span class="num" id="6561436">2</span><span class="op" id="6561437">*</span><span class="ident" id="6561438">i</span><span class="op" id="6561439">+</span><span class="num" id="6561440">1</span>&nbsp;<span class="op" id="6561442">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561447">t</span><span class="op" id="6561448">.</span><span class="ident" id="6561449">Fatalf</span><span class="op" id="6561455">(</span><span class="string" id="6561456">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="6561484">,</span>&nbsp;<span class="ident" id="6561486">i</span><span class="op" id="6561487">,</span>&nbsp;<span class="ident" id="6561489">i</span><span class="op" id="6561490">+</span><span class="num" id="6561491">1</span><span class="op" id="6561492">,</span>&nbsp;<span class="ident" id="6561494">resp</span><span class="op" id="6561498">.</span><span class="ident" id="6561499">Result</span><span class="op" id="6561505">.</span><span class="ident" id="6561506">C</span><span class="op" id="6561507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561514">}</span><br>
<span class="lineno"></span><span class="op" id="6561516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6561519">func</span>&nbsp;<span class="ident" id="6561524">TestClient</span><span class="op" id="6561534">(</span><span class="ident" id="6561535">t</span>&nbsp;<span class="op" id="6561537">*</span><span class="ident" id="6561538">testing</span><span class="op" id="6561545">.</span><span class="ident" id="6561546">T</span><span class="op" id="6561547">)</span>&nbsp;<span class="op" id="6561549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6561552">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6561601">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561633">cli</span><span class="op" id="6561636">,</span>&nbsp;<span class="ident" id="6561638">srv</span>&nbsp;<span class="op" id="6561642">:=</span>&nbsp;<span class="ident" id="6561645">net</span><span class="op" id="6561648">.</span><span class="ident" id="6561649">Pipe</span><span class="op" id="6561653">(</span><span class="op" id="6561654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561657">go</span>&nbsp;<span class="ident" id="6561660">ServeConn</span><span class="op" id="6561669">(</span><span class="ident" id="6561670">srv</span><span class="op" id="6561673">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561677">client</span>&nbsp;<span class="op" id="6561684">:=</span>&nbsp;<span class="ident" id="6561687">NewClient</span><span class="op" id="6561696">(</span><span class="ident" id="6561697">cli</span><span class="op" id="6561700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561703">defer</span>&nbsp;<span class="ident" id="6561709">client</span><span class="op" id="6561715">.</span><span class="ident" id="6561716">Close</span><span class="op" id="6561721">(</span><span class="op" id="6561722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6561726">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561748">args</span>&nbsp;<span class="op" id="6561753">:=</span>&nbsp;<span class="op" id="6561756">&amp;</span><span class="ident" id="6561757">Args</span><span class="op" id="6561761">{</span><span class="num" id="6561762">7</span><span class="op" id="6561763">,</span>&nbsp;<span class="num" id="6561765">8</span><span class="op" id="6561766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561769">reply</span>&nbsp;<span class="op" id="6561775">:=</span>&nbsp;<span class="builtinfunc" id="6561778">new</span><span class="op" id="6561781">(</span><span class="ident" id="6561782">Reply</span><span class="op" id="6561787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561790">err</span>&nbsp;<span class="op" id="6561794">:=</span>&nbsp;<span class="ident" id="6561797">client</span><span class="op" id="6561803">.</span><span class="ident" id="6561804">Call</span><span class="op" id="6561808">(</span><span class="string" id="6561809">&#34;Arith.Add&#34;</span><span class="op" id="6561820">,</span>&nbsp;<span class="ident" id="6561822">args</span><span class="op" id="6561826">,</span>&nbsp;<span class="ident" id="6561828">reply</span><span class="op" id="6561833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561836">if</span>&nbsp;<span class="ident" id="6561839">err</span>&nbsp;<span class="op" id="6561843">!=</span>&nbsp;<span class="ident" id="6561846">nil</span>&nbsp;<span class="op" id="6561850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561854">t</span><span class="op" id="6561855">.</span><span class="ident" id="6561856">Errorf</span><span class="op" id="6561862">(</span><span class="string" id="6561863">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6561905">,</span>&nbsp;<span class="ident" id="6561907">err</span><span class="op" id="6561910">.</span><span class="ident" id="6561911">Error</span><span class="op" id="6561916">(</span><span class="op" id="6561917">)</span><span class="op" id="6561918">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6561921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6561924">if</span>&nbsp;<span class="ident" id="6561927">reply</span><span class="op" id="6561932">.</span><span class="ident" id="6561933">C</span>&nbsp;<span class="op" id="6561935">!=</span>&nbsp;<span class="ident" id="6561938">args</span><span class="op" id="6561942">.</span><span class="ident" id="6561943">A</span><span class="op" id="6561944">+</span><span class="ident" id="6561945">args</span><span class="op" id="6561949">.</span><span class="ident" id="6561950">B</span>&nbsp;<span class="op" id="6561952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6561956">t</span><span class="op" id="6561957">.</span><span class="ident" id="6561958">Errorf</span><span class="op" id="6561964">(</span><span class="string" id="6561965">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6561990">,</span>&nbsp;<span class="ident" id="6561992">reply</span><span class="op" id="6561997">.</span><span class="ident" id="6561998">C</span><span class="op" id="6561999">,</span>&nbsp;<span class="ident" id="6562001">args</span><span class="op" id="6562005">.</span><span class="ident" id="6562006">A</span><span class="op" id="6562007">+</span><span class="ident" id="6562008">args</span><span class="op" id="6562012">.</span><span class="ident" id="6562013">B</span><span class="op" id="6562014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562021">args</span>&nbsp;<span class="op" id="6562026">=</span>&nbsp;<span class="op" id="6562028">&amp;</span><span class="ident" id="6562029">Args</span><span class="op" id="6562033">{</span><span class="num" id="6562034">7</span><span class="op" id="6562035">,</span>&nbsp;<span class="num" id="6562037">8</span><span class="op" id="6562038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562041">reply</span>&nbsp;<span class="op" id="6562047">=</span>&nbsp;<span class="builtinfunc" id="6562049">new</span><span class="op" id="6562052">(</span><span class="ident" id="6562053">Reply</span><span class="op" id="6562058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562061">err</span>&nbsp;<span class="op" id="6562065">=</span>&nbsp;<span class="ident" id="6562067">client</span><span class="op" id="6562073">.</span><span class="ident" id="6562074">Call</span><span class="op" id="6562078">(</span><span class="string" id="6562079">&#34;Arith.Mul&#34;</span><span class="op" id="6562090">,</span>&nbsp;<span class="ident" id="6562092">args</span><span class="op" id="6562096">,</span>&nbsp;<span class="ident" id="6562098">reply</span><span class="op" id="6562103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562106">if</span>&nbsp;<span class="ident" id="6562109">err</span>&nbsp;<span class="op" id="6562113">!=</span>&nbsp;<span class="ident" id="6562116">nil</span>&nbsp;<span class="op" id="6562120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562124">t</span><span class="op" id="6562125">.</span><span class="ident" id="6562126">Errorf</span><span class="op" id="6562132">(</span><span class="string" id="6562133">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6562175">,</span>&nbsp;<span class="ident" id="6562177">err</span><span class="op" id="6562180">.</span><span class="ident" id="6562181">Error</span><span class="op" id="6562186">(</span><span class="op" id="6562187">)</span><span class="op" id="6562188">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562194">if</span>&nbsp;<span class="ident" id="6562197">reply</span><span class="op" id="6562202">.</span><span class="ident" id="6562203">C</span>&nbsp;<span class="op" id="6562205">!=</span>&nbsp;<span class="ident" id="6562208">args</span><span class="op" id="6562212">.</span><span class="ident" id="6562213">A</span><span class="op" id="6562214">*</span><span class="ident" id="6562215">args</span><span class="op" id="6562219">.</span><span class="ident" id="6562220">B</span>&nbsp;<span class="op" id="6562222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562226">t</span><span class="op" id="6562227">.</span><span class="ident" id="6562228">Errorf</span><span class="op" id="6562234">(</span><span class="string" id="6562235">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6562260">,</span>&nbsp;<span class="ident" id="6562262">reply</span><span class="op" id="6562267">.</span><span class="ident" id="6562268">C</span><span class="op" id="6562269">,</span>&nbsp;<span class="ident" id="6562271">args</span><span class="op" id="6562275">.</span><span class="ident" id="6562276">A</span><span class="op" id="6562277">*</span><span class="ident" id="6562278">args</span><span class="op" id="6562282">.</span><span class="ident" id="6562283">B</span><span class="op" id="6562284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6562291">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562309">args</span>&nbsp;<span class="op" id="6562314">=</span>&nbsp;<span class="op" id="6562316">&amp;</span><span class="ident" id="6562317">Args</span><span class="op" id="6562321">{</span><span class="num" id="6562322">7</span><span class="op" id="6562323">,</span>&nbsp;<span class="num" id="6562325">8</span><span class="op" id="6562326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562329">mulReply</span>&nbsp;<span class="op" id="6562338">:=</span>&nbsp;<span class="builtinfunc" id="6562341">new</span><span class="op" id="6562344">(</span><span class="ident" id="6562345">Reply</span><span class="op" id="6562350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562353">mulCall</span>&nbsp;<span class="op" id="6562361">:=</span>&nbsp;<span class="ident" id="6562364">client</span><span class="op" id="6562370">.</span><span class="ident" id="6562371">Go</span><span class="op" id="6562373">(</span><span class="string" id="6562374">&#34;Arith.Mul&#34;</span><span class="op" id="6562385">,</span>&nbsp;<span class="ident" id="6562387">args</span><span class="op" id="6562391">,</span>&nbsp;<span class="ident" id="6562393">mulReply</span><span class="op" id="6562401">,</span>&nbsp;<span class="ident" id="6562403">nil</span><span class="op" id="6562406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562409">addReply</span>&nbsp;<span class="op" id="6562418">:=</span>&nbsp;<span class="builtinfunc" id="6562421">new</span><span class="op" id="6562424">(</span><span class="ident" id="6562425">Reply</span><span class="op" id="6562430">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562433">addCall</span>&nbsp;<span class="op" id="6562441">:=</span>&nbsp;<span class="ident" id="6562444">client</span><span class="op" id="6562450">.</span><span class="ident" id="6562451">Go</span><span class="op" id="6562453">(</span><span class="string" id="6562454">&#34;Arith.Add&#34;</span><span class="op" id="6562465">,</span>&nbsp;<span class="ident" id="6562467">args</span><span class="op" id="6562471">,</span>&nbsp;<span class="ident" id="6562473">addReply</span><span class="op" id="6562481">,</span>&nbsp;<span class="ident" id="6562483">nil</span><span class="op" id="6562486">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562490">addCall</span>&nbsp;<span class="op" id="6562498">=</span>&nbsp;<span class="op" id="6562500">&lt;-</span><span class="ident" id="6562502">addCall</span><span class="op" id="6562509">.</span><span class="ident" id="6562510">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562516">if</span>&nbsp;<span class="ident" id="6562519">addCall</span><span class="op" id="6562526">.</span><span class="ident" id="6562527">Error</span>&nbsp;<span class="op" id="6562533">!=</span>&nbsp;<span class="ident" id="6562536">nil</span>&nbsp;<span class="op" id="6562540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562544">t</span><span class="op" id="6562545">.</span><span class="ident" id="6562546">Errorf</span><span class="op" id="6562552">(</span><span class="string" id="6562553">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6562595">,</span>&nbsp;<span class="ident" id="6562597">addCall</span><span class="op" id="6562604">.</span><span class="ident" id="6562605">Error</span><span class="op" id="6562610">.</span><span class="ident" id="6562611">Error</span><span class="op" id="6562616">(</span><span class="op" id="6562617">)</span><span class="op" id="6562618">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562624">if</span>&nbsp;<span class="ident" id="6562627">addReply</span><span class="op" id="6562635">.</span><span class="ident" id="6562636">C</span>&nbsp;<span class="op" id="6562638">!=</span>&nbsp;<span class="ident" id="6562641">args</span><span class="op" id="6562645">.</span><span class="ident" id="6562646">A</span><span class="op" id="6562647">+</span><span class="ident" id="6562648">args</span><span class="op" id="6562652">.</span><span class="ident" id="6562653">B</span>&nbsp;<span class="op" id="6562655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562659">t</span><span class="op" id="6562660">.</span><span class="ident" id="6562661">Errorf</span><span class="op" id="6562667">(</span><span class="string" id="6562668">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6562693">,</span>&nbsp;<span class="ident" id="6562695">addReply</span><span class="op" id="6562703">.</span><span class="ident" id="6562704">C</span><span class="op" id="6562705">,</span>&nbsp;<span class="ident" id="6562707">args</span><span class="op" id="6562711">.</span><span class="ident" id="6562712">A</span><span class="op" id="6562713">+</span><span class="ident" id="6562714">args</span><span class="op" id="6562718">.</span><span class="ident" id="6562719">B</span><span class="op" id="6562720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562727">mulCall</span>&nbsp;<span class="op" id="6562735">=</span>&nbsp;<span class="op" id="6562737">&lt;-</span><span class="ident" id="6562739">mulCall</span><span class="op" id="6562746">.</span><span class="ident" id="6562747">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562753">if</span>&nbsp;<span class="ident" id="6562756">mulCall</span><span class="op" id="6562763">.</span><span class="ident" id="6562764">Error</span>&nbsp;<span class="op" id="6562770">!=</span>&nbsp;<span class="ident" id="6562773">nil</span>&nbsp;<span class="op" id="6562777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562781">t</span><span class="op" id="6562782">.</span><span class="ident" id="6562783">Errorf</span><span class="op" id="6562789">(</span><span class="string" id="6562790">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6562832">,</span>&nbsp;<span class="ident" id="6562834">mulCall</span><span class="op" id="6562841">.</span><span class="ident" id="6562842">Error</span><span class="op" id="6562847">.</span><span class="ident" id="6562848">Error</span><span class="op" id="6562853">(</span><span class="op" id="6562854">)</span><span class="op" id="6562855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6562861">if</span>&nbsp;<span class="ident" id="6562864">mulReply</span><span class="op" id="6562872">.</span><span class="ident" id="6562873">C</span>&nbsp;<span class="op" id="6562875">!=</span>&nbsp;<span class="ident" id="6562878">args</span><span class="op" id="6562882">.</span><span class="ident" id="6562883">A</span><span class="op" id="6562884">*</span><span class="ident" id="6562885">args</span><span class="op" id="6562889">.</span><span class="ident" id="6562890">B</span>&nbsp;<span class="op" id="6562892">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562896">t</span><span class="op" id="6562897">.</span><span class="ident" id="6562898">Errorf</span><span class="op" id="6562904">(</span><span class="string" id="6562905">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6562930">,</span>&nbsp;<span class="ident" id="6562932">mulReply</span><span class="op" id="6562940">.</span><span class="ident" id="6562941">C</span><span class="op" id="6562942">,</span>&nbsp;<span class="ident" id="6562944">args</span><span class="op" id="6562948">.</span><span class="ident" id="6562949">A</span><span class="op" id="6562950">*</span><span class="ident" id="6562951">args</span><span class="op" id="6562955">.</span><span class="ident" id="6562956">B</span><span class="op" id="6562957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6562960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6562964">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562979">args</span>&nbsp;<span class="op" id="6562984">=</span>&nbsp;<span class="op" id="6562986">&amp;</span><span class="ident" id="6562987">Args</span><span class="op" id="6562991">{</span><span class="num" id="6562992">7</span><span class="op" id="6562993">,</span>&nbsp;<span class="num" id="6562995">0</span><span class="op" id="6562996">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6562999">reply</span>&nbsp;<span class="op" id="6563005">=</span>&nbsp;<span class="builtinfunc" id="6563007">new</span><span class="op" id="6563010">(</span><span class="ident" id="6563011">Reply</span><span class="op" id="6563016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563019">err</span>&nbsp;<span class="op" id="6563023">=</span>&nbsp;<span class="ident" id="6563025">client</span><span class="op" id="6563031">.</span><span class="ident" id="6563032">Call</span><span class="op" id="6563036">(</span><span class="string" id="6563037">&#34;Arith.Div&#34;</span><span class="op" id="6563048">,</span>&nbsp;<span class="ident" id="6563050">args</span><span class="op" id="6563054">,</span>&nbsp;<span class="ident" id="6563056">reply</span><span class="op" id="6563061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6563064">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563097">if</span>&nbsp;<span class="ident" id="6563100">err</span>&nbsp;<span class="op" id="6563104">==</span>&nbsp;<span class="ident" id="6563107">nil</span>&nbsp;<span class="op" id="6563111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563115">t</span><span class="op" id="6563116">.</span><span class="ident" id="6563117">Error</span><span class="op" id="6563122">(</span><span class="string" id="6563123">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6563144">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563147">}</span>&nbsp;<span class="keyword" id="6563149">else</span>&nbsp;<span class="keyword" id="6563154">if</span>&nbsp;<span class="ident" id="6563157">err</span><span class="op" id="6563160">.</span><span class="ident" id="6563161">Error</span><span class="op" id="6563166">(</span><span class="op" id="6563167">)</span>&nbsp;<span class="op" id="6563169">!=</span>&nbsp;<span class="string" id="6563172">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="6563189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563193">t</span><span class="op" id="6563194">.</span><span class="ident" id="6563195">Error</span><span class="op" id="6563200">(</span><span class="string" id="6563201">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6563242">,</span>&nbsp;<span class="ident" id="6563244">err</span><span class="op" id="6563247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563250">}</span><br>
<span class="lineno"></span><span class="op" id="6563252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="6563255">func</span>&nbsp;<span class="ident" id="6563260">TestMalformedInput</span><span class="op" id="6563278">(</span><span class="ident" id="6563279">t</span>&nbsp;<span class="op" id="6563281">*</span><span class="ident" id="6563282">testing</span><span class="op" id="6563289">.</span><span class="ident" id="6563290">T</span><span class="op" id="6563291">)</span>&nbsp;<span class="op" id="6563293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563296">cli</span><span class="op" id="6563299">,</span>&nbsp;<span class="ident" id="6563301">srv</span>&nbsp;<span class="op" id="6563305">:=</span>&nbsp;<span class="ident" id="6563308">net</span><span class="op" id="6563311">.</span><span class="ident" id="6563312">Pipe</span><span class="op" id="6563316">(</span><span class="op" id="6563317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563320">go</span>&nbsp;<span class="ident" id="6563323">cli</span><span class="op" id="6563326">.</span><span class="ident" id="6563327">Write</span><span class="op" id="6563332">(</span><span class="op" id="6563333">[</span><span class="op" id="6563334">]</span><span class="builtintype" id="6563335">byte</span><span class="op" id="6563339">(</span><span class="string" id="6563340">`{id:1}`</span><span class="op" id="6563348">)</span><span class="op" id="6563349">)</span>&nbsp;<span class="comment" id="6563351">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563368">ServeConn</span><span class="op" id="6563377">(</span><span class="ident" id="6563378">srv</span><span class="op" id="6563381">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6563399">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="6563424">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="6563427">func</span>&nbsp;<span class="ident" id="6563432">TestMalformedOutput</span><span class="op" id="6563451">(</span><span class="ident" id="6563452">t</span>&nbsp;<span class="op" id="6563454">*</span><span class="ident" id="6563455">testing</span><span class="op" id="6563462">.</span><span class="ident" id="6563463">T</span><span class="op" id="6563464">)</span>&nbsp;<span class="op" id="6563466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563469">cli</span><span class="op" id="6563472">,</span>&nbsp;<span class="ident" id="6563474">srv</span>&nbsp;<span class="op" id="6563478">:=</span>&nbsp;<span class="ident" id="6563481">net</span><span class="op" id="6563484">.</span><span class="ident" id="6563485">Pipe</span><span class="op" id="6563489">(</span><span class="op" id="6563490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563493">go</span>&nbsp;<span class="ident" id="6563496">srv</span><span class="op" id="6563499">.</span><span class="ident" id="6563500">Write</span><span class="op" id="6563505">(</span><span class="op" id="6563506">[</span><span class="op" id="6563507">]</span><span class="builtintype" id="6563508">byte</span><span class="op" id="6563512">(</span><span class="string" id="6563513">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="6563550">)</span><span class="op" id="6563551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563554">go</span>&nbsp;<span class="ident" id="6563557">ioutil</span><span class="op" id="6563563">.</span><span class="ident" id="6563564">ReadAll</span><span class="op" id="6563571">(</span><span class="ident" id="6563572">srv</span><span class="op" id="6563575">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563579">client</span>&nbsp;<span class="op" id="6563586">:=</span>&nbsp;<span class="ident" id="6563589">NewClient</span><span class="op" id="6563598">(</span><span class="ident" id="6563599">cli</span><span class="op" id="6563602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563605">defer</span>&nbsp;<span class="ident" id="6563611">client</span><span class="op" id="6563617">.</span><span class="ident" id="6563618">Close</span><span class="op" id="6563623">(</span><span class="op" id="6563624">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563628">args</span>&nbsp;<span class="op" id="6563633">:=</span>&nbsp;<span class="op" id="6563636">&amp;</span><span class="ident" id="6563637">Args</span><span class="op" id="6563641">{</span><span class="num" id="6563642">7</span><span class="op" id="6563643">,</span>&nbsp;<span class="num" id="6563645">8</span><span class="op" id="6563646">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563649">reply</span>&nbsp;<span class="op" id="6563655">:=</span>&nbsp;<span class="builtinfunc" id="6563658">new</span><span class="op" id="6563661">(</span><span class="ident" id="6563662">Reply</span><span class="op" id="6563667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563670">err</span>&nbsp;<span class="op" id="6563674">:=</span>&nbsp;<span class="ident" id="6563677">client</span><span class="op" id="6563683">.</span><span class="ident" id="6563684">Call</span><span class="op" id="6563688">(</span><span class="string" id="6563689">&#34;Arith.Add&#34;</span><span class="op" id="6563700">,</span>&nbsp;<span class="ident" id="6563702">args</span><span class="op" id="6563706">,</span>&nbsp;<span class="ident" id="6563708">reply</span><span class="op" id="6563713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563716">if</span>&nbsp;<span class="ident" id="6563719">err</span>&nbsp;<span class="op" id="6563723">==</span>&nbsp;<span class="ident" id="6563726">nil</span>&nbsp;<span class="op" id="6563730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563734">t</span><span class="op" id="6563735">.</span><span class="ident" id="6563736">Error</span><span class="op" id="6563741">(</span><span class="string" id="6563742">&#34;expected&nbsp;error&#34;</span><span class="op" id="6563758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563761">}</span><br>
<span class="lineno">205</span><span class="op" id="6563763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6563766">func</span>&nbsp;<span class="ident" id="6563771">TestServerErrorHasNullResult</span><span class="op" id="6563799">(</span><span class="ident" id="6563800">t</span>&nbsp;<span class="op" id="6563802">*</span><span class="ident" id="6563803">testing</span><span class="op" id="6563810">.</span><span class="ident" id="6563811">T</span><span class="op" id="6563812">)</span>&nbsp;<span class="op" id="6563814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6563817">var</span>&nbsp;<span class="ident" id="6563821">out</span>&nbsp;<span class="ident" id="6563825">bytes</span><span class="op" id="6563830">.</span><span class="ident" id="6563831">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563839">sc</span>&nbsp;<span class="op" id="6563842">:=</span>&nbsp;<span class="ident" id="6563845">NewServerCodec</span><span class="op" id="6563859">(</span><span class="keyword" id="6563860">struct</span>&nbsp;<span class="op" id="6563867">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563871">io</span><span class="op" id="6563873">.</span><span class="ident" id="6563874">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563883">io</span><span class="op" id="6563885">.</span><span class="ident" id="6563886">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563895">io</span><span class="op" id="6563897">.</span><span class="ident" id="6563898">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6563906">}</span><span class="op" id="6563907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563911">Reader</span><span class="op" id="6563917">:</span>&nbsp;<span class="ident" id="6563919">strings</span><span class="op" id="6563926">.</span><span class="ident" id="6563927">NewReader</span><span class="op" id="6563936">(</span><span class="string" id="6563937">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="6563989">)</span><span class="op" id="6563990">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6563994">Writer</span><span class="op" id="6564000">:</span>&nbsp;<span class="op" id="6564002">&amp;</span><span class="ident" id="6564003">out</span><span class="op" id="6564006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564010">Closer</span><span class="op" id="6564016">:</span>&nbsp;<span class="ident" id="6564018">ioutil</span><span class="op" id="6564024">.</span><span class="ident" id="6564025">NopCloser</span><span class="op" id="6564034">(</span><span class="ident" id="6564035">nil</span><span class="op" id="6564038">)</span><span class="op" id="6564039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564042">}</span><span class="op" id="6564043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564046">r</span>&nbsp;<span class="op" id="6564048">:=</span>&nbsp;<span class="builtinfunc" id="6564051">new</span><span class="op" id="6564054">(</span><span class="ident" id="6564055">rpc</span><span class="op" id="6564058">.</span><span class="ident" id="6564059">Request</span><span class="op" id="6564066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564069">if</span>&nbsp;<span class="ident" id="6564072">err</span>&nbsp;<span class="op" id="6564076">:=</span>&nbsp;<span class="ident" id="6564079">sc</span><span class="op" id="6564081">.</span><span class="ident" id="6564082">ReadRequestHeader</span><span class="op" id="6564099">(</span><span class="ident" id="6564100">r</span><span class="op" id="6564101">)</span><span class="op" id="6564102">;</span>&nbsp;<span class="ident" id="6564104">err</span>&nbsp;<span class="op" id="6564108">!=</span>&nbsp;<span class="ident" id="6564111">nil</span>&nbsp;<span class="op" id="6564115">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564119">t</span><span class="op" id="6564120">.</span><span class="ident" id="6564121">Fatal</span><span class="op" id="6564126">(</span><span class="ident" id="6564127">err</span><span class="op" id="6564130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564136">const</span>&nbsp;<span class="ident" id="6564142">valueText</span>&nbsp;<span class="op" id="6564152">=</span>&nbsp;<span class="string" id="6564154">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564188">const</span>&nbsp;<span class="ident" id="6564194">errorText</span>&nbsp;<span class="op" id="6564204">=</span>&nbsp;<span class="string" id="6564206">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564220">err</span>&nbsp;<span class="op" id="6564224">:=</span>&nbsp;<span class="ident" id="6564227">sc</span><span class="op" id="6564229">.</span><span class="ident" id="6564230">WriteResponse</span><span class="op" id="6564243">(</span><span class="op" id="6564244">&amp;</span><span class="ident" id="6564245">rpc</span><span class="op" id="6564248">.</span><span class="ident" id="6564249">Response</span><span class="op" id="6564257">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564261">ServiceMethod</span><span class="op" id="6564274">:</span>&nbsp;<span class="string" id="6564276">&#34;Method&#34;</span><span class="op" id="6564284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564288">Seq</span><span class="op" id="6564291">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6564303">1</span><span class="op" id="6564304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564308">Error</span><span class="op" id="6564313">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564323">errorText</span><span class="op" id="6564332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564335">}</span><span class="op" id="6564336">,</span>&nbsp;<span class="ident" id="6564338">valueText</span><span class="op" id="6564347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564350">if</span>&nbsp;<span class="ident" id="6564353">err</span>&nbsp;<span class="op" id="6564357">!=</span>&nbsp;<span class="ident" id="6564360">nil</span>&nbsp;<span class="op" id="6564364">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564368">t</span><span class="op" id="6564369">.</span><span class="ident" id="6564370">Fatal</span><span class="op" id="6564375">(</span><span class="ident" id="6564376">err</span><span class="op" id="6564379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564385">if</span>&nbsp;<span class="op" id="6564388">!</span><span class="ident" id="6564389">strings</span><span class="op" id="6564396">.</span><span class="ident" id="6564397">Contains</span><span class="op" id="6564405">(</span><span class="ident" id="6564406">out</span><span class="op" id="6564409">.</span><span class="ident" id="6564410">String</span><span class="op" id="6564416">(</span><span class="op" id="6564417">)</span><span class="op" id="6564418">,</span>&nbsp;<span class="ident" id="6564420">errorText</span><span class="op" id="6564429">)</span>&nbsp;<span class="op" id="6564431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564435">t</span><span class="op" id="6564436">.</span><span class="ident" id="6564437">Fatalf</span><span class="op" id="6564443">(</span><span class="string" id="6564444">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="6564491">,</span>&nbsp;<span class="ident" id="6564493">errorText</span><span class="op" id="6564502">,</span>&nbsp;<span class="op" id="6564504">&amp;</span><span class="ident" id="6564505">out</span><span class="op" id="6564508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564511">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564514">if</span>&nbsp;<span class="ident" id="6564517">strings</span><span class="op" id="6564524">.</span><span class="ident" id="6564525">Contains</span><span class="op" id="6564533">(</span><span class="ident" id="6564534">out</span><span class="op" id="6564537">.</span><span class="ident" id="6564538">String</span><span class="op" id="6564544">(</span><span class="op" id="6564545">)</span><span class="op" id="6564546">,</span>&nbsp;<span class="ident" id="6564548">valueText</span><span class="op" id="6564557">)</span>&nbsp;<span class="op" id="6564559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564563">t</span><span class="op" id="6564564">.</span><span class="ident" id="6564565">Errorf</span><span class="op" id="6564571">(</span><span class="string" id="6564572">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="6564619">,</span>&nbsp;<span class="op" id="6564621">&amp;</span><span class="ident" id="6564622">out</span><span class="op" id="6564625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6564628">}</span><br>
<span class="lineno"></span><span class="op" id="6564630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="6564633">func</span>&nbsp;<span class="ident" id="6564638">TestUnexpectedError</span><span class="op" id="6564657">(</span><span class="ident" id="6564658">t</span>&nbsp;<span class="op" id="6564660">*</span><span class="ident" id="6564661">testing</span><span class="op" id="6564668">.</span><span class="ident" id="6564669">T</span><span class="op" id="6564670">)</span>&nbsp;<span class="op" id="6564672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564675">cli</span><span class="op" id="6564678">,</span>&nbsp;<span class="ident" id="6564680">srv</span>&nbsp;<span class="op" id="6564684">:=</span>&nbsp;<span class="ident" id="6564687">myPipe</span><span class="op" id="6564693">(</span><span class="op" id="6564694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564697">go</span>&nbsp;<span class="ident" id="6564700">cli</span><span class="op" id="6564703">.</span><span class="ident" id="6564704">PipeWriter</span><span class="op" id="6564714">.</span><span class="ident" id="6564715">CloseWithError</span><span class="op" id="6564729">(</span><span class="ident" id="6564730">errors</span><span class="op" id="6564736">.</span><span class="ident" id="6564737">New</span><span class="op" id="6564740">(</span><span class="string" id="6564741">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="6564760">)</span><span class="op" id="6564761">)</span>&nbsp;<span class="comment" id="6564763">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564794">ServeConn</span><span class="op" id="6564803">(</span><span class="ident" id="6564804">srv</span><span class="op" id="6564807">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564860">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="6564885">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6564888">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="6564916">func</span>&nbsp;<span class="ident" id="6564921">myPipe</span><span class="op" id="6564927">(</span><span class="op" id="6564928">)</span>&nbsp;<span class="op" id="6564930">(</span><span class="op" id="6564931">*</span><span class="ident" id="6564932">pipe</span><span class="op" id="6564936">,</span>&nbsp;<span class="op" id="6564938">*</span><span class="ident" id="6564939">pipe</span><span class="op" id="6564943">)</span>&nbsp;<span class="op" id="6564945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564948">r1</span><span class="op" id="6564950">,</span>&nbsp;<span class="ident" id="6564952">w1</span>&nbsp;<span class="op" id="6564955">:=</span>&nbsp;<span class="ident" id="6564958">io</span><span class="op" id="6564960">.</span><span class="ident" id="6564961">Pipe</span><span class="op" id="6564965">(</span><span class="op" id="6564966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6564969">r2</span><span class="op" id="6564971">,</span>&nbsp;<span class="ident" id="6564973">w2</span>&nbsp;<span class="op" id="6564976">:=</span>&nbsp;<span class="ident" id="6564979">io</span><span class="op" id="6564981">.</span><span class="ident" id="6564982">Pipe</span><span class="op" id="6564986">(</span><span class="op" id="6564987">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6564991">return</span>&nbsp;<span class="op" id="6564998">&amp;</span><span class="ident" id="6564999">pipe</span><span class="op" id="6565003">{</span><span class="ident" id="6565004">r1</span><span class="op" id="6565006">,</span>&nbsp;<span class="ident" id="6565008">w2</span><span class="op" id="6565010">}</span><span class="op" id="6565011">,</span>&nbsp;<span class="op" id="6565013">&amp;</span><span class="ident" id="6565014">pipe</span><span class="op" id="6565018">{</span><span class="ident" id="6565019">r2</span><span class="op" id="6565021">,</span>&nbsp;<span class="ident" id="6565023">w1</span><span class="op" id="6565025">}</span><br>
<span class="lineno"></span><span class="op" id="6565027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6565030">type</span>&nbsp;<span class="ident" id="6565035">pipe</span>&nbsp;<span class="keyword" id="6565040">struct</span>&nbsp;<span class="op" id="6565047">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6565050">*</span><span class="ident" id="6565051">io</span><span class="op" id="6565053">.</span><span class="ident" id="6565054">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6565066">*</span><span class="ident" id="6565067">io</span><span class="op" id="6565069">.</span><span class="ident" id="6565070">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="6565081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6565084">type</span>&nbsp;<span class="ident" id="6565089">pipeAddr</span>&nbsp;<span class="builtintype" id="6565098">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="6565103">func</span>&nbsp;<span class="op" id="6565108">(</span><span class="ident" id="6565109">pipeAddr</span><span class="op" id="6565117">)</span>&nbsp;<span class="ident" id="6565119">Network</span><span class="op" id="6565126">(</span><span class="op" id="6565127">)</span>&nbsp;<span class="builtintype" id="6565129">string</span>&nbsp;<span class="op" id="6565136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565139">return</span>&nbsp;<span class="string" id="6565146">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="6565153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="6565156">func</span>&nbsp;<span class="op" id="6565161">(</span><span class="ident" id="6565162">pipeAddr</span><span class="op" id="6565170">)</span>&nbsp;<span class="ident" id="6565172">String</span><span class="op" id="6565178">(</span><span class="op" id="6565179">)</span>&nbsp;<span class="builtintype" id="6565181">string</span>&nbsp;<span class="op" id="6565188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565191">return</span>&nbsp;<span class="string" id="6565198">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="6565205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6565208">func</span>&nbsp;<span class="op" id="6565213">(</span><span class="ident" id="6565214">p</span>&nbsp;<span class="op" id="6565216">*</span><span class="ident" id="6565217">pipe</span><span class="op" id="6565221">)</span>&nbsp;<span class="ident" id="6565223">Close</span><span class="op" id="6565228">(</span><span class="op" id="6565229">)</span>&nbsp;<span class="builtintype" id="6565231">error</span>&nbsp;<span class="op" id="6565237">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565240">err</span>&nbsp;<span class="op" id="6565244">:=</span>&nbsp;<span class="ident" id="6565247">p</span><span class="op" id="6565248">.</span><span class="ident" id="6565249">PipeReader</span><span class="op" id="6565259">.</span><span class="ident" id="6565260">Close</span><span class="op" id="6565265">(</span><span class="op" id="6565266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565269">err1</span>&nbsp;<span class="op" id="6565274">:=</span>&nbsp;<span class="ident" id="6565277">p</span><span class="op" id="6565278">.</span><span class="ident" id="6565279">PipeWriter</span><span class="op" id="6565289">.</span><span class="ident" id="6565290">Close</span><span class="op" id="6565295">(</span><span class="op" id="6565296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565299">if</span>&nbsp;<span class="ident" id="6565302">err</span>&nbsp;<span class="op" id="6565306">==</span>&nbsp;<span class="ident" id="6565309">nil</span>&nbsp;<span class="op" id="6565313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6565317">err</span>&nbsp;<span class="op" id="6565321">=</span>&nbsp;<span class="ident" id="6565323">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6565329">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565332">return</span>&nbsp;<span class="ident" id="6565339">err</span><br>
<span class="lineno"></span><span class="op" id="6565343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6565346">func</span>&nbsp;<span class="op" id="6565351">(</span><span class="ident" id="6565352">p</span>&nbsp;<span class="op" id="6565354">*</span><span class="ident" id="6565355">pipe</span><span class="op" id="6565359">)</span>&nbsp;<span class="ident" id="6565361">LocalAddr</span><span class="op" id="6565370">(</span><span class="op" id="6565371">)</span>&nbsp;<span class="ident" id="6565373">net</span><span class="op" id="6565376">.</span><span class="ident" id="6565377">Addr</span>&nbsp;<span class="op" id="6565382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565385">return</span>&nbsp;<span class="ident" id="6565392">pipeAddr</span><span class="op" id="6565400">(</span><span class="num" id="6565401">0</span><span class="op" id="6565402">)</span><br>
<span class="lineno">280</span><span class="op" id="6565404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6565407">func</span>&nbsp;<span class="op" id="6565412">(</span><span class="ident" id="6565413">p</span>&nbsp;<span class="op" id="6565415">*</span><span class="ident" id="6565416">pipe</span><span class="op" id="6565420">)</span>&nbsp;<span class="ident" id="6565422">RemoteAddr</span><span class="op" id="6565432">(</span><span class="op" id="6565433">)</span>&nbsp;<span class="ident" id="6565435">net</span><span class="op" id="6565438">.</span><span class="ident" id="6565439">Addr</span>&nbsp;<span class="op" id="6565444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565447">return</span>&nbsp;<span class="ident" id="6565454">pipeAddr</span><span class="op" id="6565462">(</span><span class="num" id="6565463">0</span><span class="op" id="6565464">)</span><br>
<span class="lineno"></span><span class="op" id="6565466">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="6565469">func</span>&nbsp;<span class="op" id="6565474">(</span><span class="ident" id="6565475">p</span>&nbsp;<span class="op" id="6565477">*</span><span class="ident" id="6565478">pipe</span><span class="op" id="6565482">)</span>&nbsp;<span class="ident" id="6565484">SetTimeout</span><span class="op" id="6565494">(</span><span class="ident" id="6565495">nsec</span>&nbsp;<span class="ident" id="6565500">int64</span><span class="op" id="6565505">)</span>&nbsp;<span class="builtintype" id="6565507">error</span>&nbsp;<span class="op" id="6565513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565516">return</span>&nbsp;<span class="ident" id="6565523">errors</span><span class="op" id="6565529">.</span><span class="ident" id="6565530">New</span><span class="op" id="6565533">(</span><span class="string" id="6565534">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6565570">)</span><br>
<span class="lineno"></span><span class="op" id="6565572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="6565575">func</span>&nbsp;<span class="op" id="6565580">(</span><span class="ident" id="6565581">p</span>&nbsp;<span class="op" id="6565583">*</span><span class="ident" id="6565584">pipe</span><span class="op" id="6565588">)</span>&nbsp;<span class="ident" id="6565590">SetReadTimeout</span><span class="op" id="6565604">(</span><span class="ident" id="6565605">nsec</span>&nbsp;<span class="ident" id="6565610">int64</span><span class="op" id="6565615">)</span>&nbsp;<span class="builtintype" id="6565617">error</span>&nbsp;<span class="op" id="6565623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565626">return</span>&nbsp;<span class="ident" id="6565633">errors</span><span class="op" id="6565639">.</span><span class="ident" id="6565640">New</span><span class="op" id="6565643">(</span><span class="string" id="6565644">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6565680">)</span><br>
<span class="lineno"></span><span class="op" id="6565682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6565685">func</span>&nbsp;<span class="op" id="6565690">(</span><span class="ident" id="6565691">p</span>&nbsp;<span class="op" id="6565693">*</span><span class="ident" id="6565694">pipe</span><span class="op" id="6565698">)</span>&nbsp;<span class="ident" id="6565700">SetWriteTimeout</span><span class="op" id="6565715">(</span><span class="ident" id="6565716">nsec</span>&nbsp;<span class="ident" id="6565721">int64</span><span class="op" id="6565726">)</span>&nbsp;<span class="builtintype" id="6565728">error</span>&nbsp;<span class="op" id="6565734">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6565737">return</span>&nbsp;<span class="ident" id="6565744">errors</span><span class="op" id="6565750">.</span><span class="ident" id="6565751">New</span><span class="op" id="6565754">(</span><span class="string" id="6565755">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6565791">)</span><br>
<span class="lineno"></span><span class="op" id="6565793">}</span>
</div>
</body>
</html>
