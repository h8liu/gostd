<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html" class="current">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1359070">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1359125">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1359179">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1359230">package</span>&nbsp;<span class="ident" id="1359238">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1359247">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="1359324">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="1359374">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="1359442">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="1359519">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="1359554">type</span>&nbsp;<span class="ident" id="1359559">stringFinder</span>&nbsp;<span class="keyword" id="1359572">struct</span>&nbsp;<span class="op" id="1359579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1359582">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1359647">pattern</span>&nbsp;<span class="builtintype" id="1359655">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1359664">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1359738">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1359812">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1359848">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1359852">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1359924">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1359997">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1360042">badCharSkip</span>&nbsp;<span class="op" id="1360054">[</span><span class="num" id="1360055">256</span><span class="op" id="1360058">]</span><span class="builtintype" id="1360059">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360065">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360141">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360213">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360255">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360259">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360331">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360405">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360475">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360548">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360613">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360648">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360652">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360727">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360795">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360869">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1360935">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361003">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361073">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361144">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361217">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1361274">goodSuffixSkip</span>&nbsp;<span class="op" id="1361289">[</span><span class="op" id="1361290">]</span><span class="builtintype" id="1361291">int</span><br>
<span class="lineno"></span><span class="op" id="1361295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1361298">func</span>&nbsp;<span class="ident" id="1361303">makeStringFinder</span><span class="op" id="1361319">(</span><span class="ident" id="1361320">pattern</span>&nbsp;<span class="builtintype" id="1361328">string</span><span class="op" id="1361334">)</span>&nbsp;<span class="op" id="1361336">*</span><span class="ident" id="1361337">stringFinder</span>&nbsp;<span class="op" id="1361350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1361353">f</span>&nbsp;<span class="op" id="1361355">:=</span>&nbsp;<span class="op" id="1361358">&amp;</span><span class="ident" id="1361359">stringFinder</span><span class="op" id="1361371">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1361375">pattern</span><span class="op" id="1361382">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1361391">pattern</span><span class="op" id="1361398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1361402">goodSuffixSkip</span><span class="op" id="1361416">:</span>&nbsp;<span class="builtinfunc" id="1361418">make</span><span class="op" id="1361422">(</span><span class="op" id="1361423">[</span><span class="op" id="1361424">]</span><span class="builtintype" id="1361425">int</span><span class="op" id="1361428">,</span>&nbsp;<span class="builtinfunc" id="1361430">len</span><span class="op" id="1361433">(</span><span class="ident" id="1361434">pattern</span><span class="op" id="1361441">)</span><span class="op" id="1361442">)</span><span class="op" id="1361443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1361446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361449">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1361509">last</span>&nbsp;<span class="op" id="1361514">:=</span>&nbsp;<span class="builtinfunc" id="1361517">len</span><span class="op" id="1361520">(</span><span class="ident" id="1361521">pattern</span><span class="op" id="1361528">)</span>&nbsp;<span class="op" id="1361530">-</span>&nbsp;<span class="num" id="1361532">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361536">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361567">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1361627">for</span>&nbsp;<span class="ident" id="1361631">i</span>&nbsp;<span class="op" id="1361633">:=</span>&nbsp;<span class="keyword" id="1361636">range</span>&nbsp;<span class="ident" id="1361642">f</span><span class="op" id="1361643">.</span><span class="ident" id="1361644">badCharSkip</span>&nbsp;<span class="op" id="1361656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1361660">f</span><span class="op" id="1361661">.</span><span class="ident" id="1361662">badCharSkip</span><span class="op" id="1361673">[</span><span class="ident" id="1361674">i</span><span class="op" id="1361675">]</span>&nbsp;<span class="op" id="1361677">=</span>&nbsp;<span class="builtinfunc" id="1361679">len</span><span class="op" id="1361682">(</span><span class="ident" id="1361683">pattern</span><span class="op" id="1361690">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1361693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361696">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361769">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361844">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1361885">for</span>&nbsp;<span class="ident" id="1361889">i</span>&nbsp;<span class="op" id="1361891">:=</span>&nbsp;<span class="num" id="1361894">0</span><span class="op" id="1361895">;</span>&nbsp;<span class="ident" id="1361897">i</span>&nbsp;<span class="op" id="1361899">&lt;</span>&nbsp;<span class="ident" id="1361901">last</span><span class="op" id="1361905">;</span>&nbsp;<span class="ident" id="1361907">i</span><span class="op" id="1361908">++</span>&nbsp;<span class="op" id="1361911">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1361915">f</span><span class="op" id="1361916">.</span><span class="ident" id="1361917">badCharSkip</span><span class="op" id="1361928">[</span><span class="ident" id="1361929">pattern</span><span class="op" id="1361936">[</span><span class="ident" id="1361937">i</span><span class="op" id="1361938">]</span><span class="op" id="1361939">]</span>&nbsp;<span class="op" id="1361941">=</span>&nbsp;<span class="ident" id="1361943">last</span>&nbsp;<span class="op" id="1361948">-</span>&nbsp;<span class="ident" id="1361950">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1361953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361957">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1361986">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1362060">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1362073">lastPrefix</span>&nbsp;<span class="op" id="1362084">:=</span>&nbsp;<span class="ident" id="1362087">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1362093">for</span>&nbsp;<span class="ident" id="1362097">i</span>&nbsp;<span class="op" id="1362099">:=</span>&nbsp;<span class="ident" id="1362102">last</span><span class="op" id="1362106">;</span>&nbsp;<span class="ident" id="1362108">i</span>&nbsp;<span class="op" id="1362110">&gt;=</span>&nbsp;<span class="num" id="1362113">0</span><span class="op" id="1362114">;</span>&nbsp;<span class="ident" id="1362116">i</span><span class="op" id="1362117">--</span>&nbsp;<span class="op" id="1362120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1362124">if</span>&nbsp;<span class="ident" id="1362127">HasPrefix</span><span class="op" id="1362136">(</span><span class="ident" id="1362137">pattern</span><span class="op" id="1362144">,</span>&nbsp;<span class="ident" id="1362146">pattern</span><span class="op" id="1362153">[</span><span class="ident" id="1362154">i</span><span class="op" id="1362155">+</span><span class="num" id="1362156">1</span><span class="op" id="1362157">:</span><span class="op" id="1362158">]</span><span class="op" id="1362159">)</span>&nbsp;<span class="op" id="1362161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1362166">lastPrefix</span>&nbsp;<span class="op" id="1362177">=</span>&nbsp;<span class="ident" id="1362179">i</span>&nbsp;<span class="op" id="1362181">+</span>&nbsp;<span class="num" id="1362183">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1362187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1362191">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1362250">f</span><span class="op" id="1362251">.</span><span class="ident" id="1362252">goodSuffixSkip</span><span class="op" id="1362266">[</span><span class="ident" id="1362267">i</span><span class="op" id="1362268">]</span>&nbsp;<span class="op" id="1362270">=</span>&nbsp;<span class="ident" id="1362272">lastPrefix</span>&nbsp;<span class="op" id="1362283">+</span>&nbsp;<span class="ident" id="1362285">last</span>&nbsp;<span class="op" id="1362290">-</span>&nbsp;<span class="ident" id="1362292">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1362295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1362298">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1362373">for</span>&nbsp;<span class="ident" id="1362377">i</span>&nbsp;<span class="op" id="1362379">:=</span>&nbsp;<span class="num" id="1362382">0</span><span class="op" id="1362383">;</span>&nbsp;<span class="ident" id="1362385">i</span>&nbsp;<span class="op" id="1362387">&lt;</span>&nbsp;<span class="ident" id="1362389">last</span><span class="op" id="1362393">;</span>&nbsp;<span class="ident" id="1362395">i</span><span class="op" id="1362396">++</span>&nbsp;<span class="op" id="1362399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1362403">lenSuffix</span>&nbsp;<span class="op" id="1362413">:=</span>&nbsp;<span class="ident" id="1362416">longestCommonSuffix</span><span class="op" id="1362435">(</span><span class="ident" id="1362436">pattern</span><span class="op" id="1362443">,</span>&nbsp;<span class="ident" id="1362445">pattern</span><span class="op" id="1362452">[</span><span class="num" id="1362453">1</span><span class="op" id="1362454">:</span><span class="ident" id="1362455">i</span><span class="op" id="1362456">+</span><span class="num" id="1362457">1</span><span class="op" id="1362458">]</span><span class="op" id="1362459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1362463">if</span>&nbsp;<span class="ident" id="1362466">pattern</span><span class="op" id="1362473">[</span><span class="ident" id="1362474">i</span><span class="op" id="1362475">-</span><span class="ident" id="1362476">lenSuffix</span><span class="op" id="1362485">]</span>&nbsp;<span class="op" id="1362487">!=</span>&nbsp;<span class="ident" id="1362490">pattern</span><span class="op" id="1362497">[</span><span class="ident" id="1362498">last</span><span class="op" id="1362502">-</span><span class="ident" id="1362503">lenSuffix</span><span class="op" id="1362512">]</span>&nbsp;<span class="op" id="1362514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1362519">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1362578">f</span><span class="op" id="1362579">.</span><span class="ident" id="1362580">goodSuffixSkip</span><span class="op" id="1362594">[</span><span class="ident" id="1362595">last</span><span class="op" id="1362599">-</span><span class="ident" id="1362600">lenSuffix</span><span class="op" id="1362609">]</span>&nbsp;<span class="op" id="1362611">=</span>&nbsp;<span class="ident" id="1362613">lenSuffix</span>&nbsp;<span class="op" id="1362623">+</span>&nbsp;<span class="ident" id="1362625">last</span>&nbsp;<span class="op" id="1362630">-</span>&nbsp;<span class="ident" id="1362632">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1362636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1362639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1362643">return</span>&nbsp;<span class="ident" id="1362650">f</span><br>
<span class="lineno"></span><span class="op" id="1362652">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="1362655">func</span>&nbsp;<span class="ident" id="1362660">longestCommonSuffix</span><span class="op" id="1362679">(</span><span class="ident" id="1362680">a</span><span class="op" id="1362681">,</span>&nbsp;<span class="ident" id="1362683">b</span>&nbsp;<span class="builtintype" id="1362685">string</span><span class="op" id="1362691">)</span>&nbsp;<span class="op" id="1362693">(</span><span class="ident" id="1362694">i</span>&nbsp;<span class="builtintype" id="1362696">int</span><span class="op" id="1362699">)</span>&nbsp;<span class="op" id="1362701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1362704">for</span>&nbsp;<span class="op" id="1362708">;</span>&nbsp;<span class="ident" id="1362710">i</span>&nbsp;<span class="op" id="1362712">&lt;</span>&nbsp;<span class="builtinfunc" id="1362714">len</span><span class="op" id="1362717">(</span><span class="ident" id="1362718">a</span><span class="op" id="1362719">)</span>&nbsp;<span class="op" id="1362721">&amp;&amp;</span>&nbsp;<span class="ident" id="1362724">i</span>&nbsp;<span class="op" id="1362726">&lt;</span>&nbsp;<span class="builtinfunc" id="1362728">len</span><span class="op" id="1362731">(</span><span class="ident" id="1362732">b</span><span class="op" id="1362733">)</span><span class="op" id="1362734">;</span>&nbsp;<span class="ident" id="1362736">i</span><span class="op" id="1362737">++</span>&nbsp;<span class="op" id="1362740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1362744">if</span>&nbsp;<span class="ident" id="1362747">a</span><span class="op" id="1362748">[</span><span class="builtinfunc" id="1362749">len</span><span class="op" id="1362752">(</span><span class="ident" id="1362753">a</span><span class="op" id="1362754">)</span><span class="op" id="1362755">-</span><span class="num" id="1362756">1</span><span class="op" id="1362757">-</span><span class="ident" id="1362758">i</span><span class="op" id="1362759">]</span>&nbsp;<span class="op" id="1362761">!=</span>&nbsp;<span class="ident" id="1362764">b</span><span class="op" id="1362765">[</span><span class="builtinfunc" id="1362766">len</span><span class="op" id="1362769">(</span><span class="ident" id="1362770">b</span><span class="op" id="1362771">)</span><span class="op" id="1362772">-</span><span class="num" id="1362773">1</span><span class="op" id="1362774">-</span><span class="ident" id="1362775">i</span><span class="op" id="1362776">]</span>&nbsp;<span class="op" id="1362778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1362783">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1362791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1362794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1362797">return</span><br>
<span class="lineno"></span><span class="op" id="1362804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="1362807">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="1362884">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="1362928">func</span>&nbsp;<span class="op" id="1362933">(</span><span class="ident" id="1362934">f</span>&nbsp;<span class="op" id="1362936">*</span><span class="ident" id="1362937">stringFinder</span><span class="op" id="1362949">)</span>&nbsp;<span class="ident" id="1362951">next</span><span class="op" id="1362955">(</span><span class="ident" id="1362956">text</span>&nbsp;<span class="builtintype" id="1362961">string</span><span class="op" id="1362967">)</span>&nbsp;<span class="builtintype" id="1362969">int</span>&nbsp;<span class="op" id="1362973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1362976">i</span>&nbsp;<span class="op" id="1362978">:=</span>&nbsp;<span class="builtinfunc" id="1362981">len</span><span class="op" id="1362984">(</span><span class="ident" id="1362985">f</span><span class="op" id="1362986">.</span><span class="ident" id="1362987">pattern</span><span class="op" id="1362994">)</span>&nbsp;<span class="op" id="1362996">-</span>&nbsp;<span class="num" id="1362998">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1363001">for</span>&nbsp;<span class="ident" id="1363005">i</span>&nbsp;<span class="op" id="1363007">&lt;</span>&nbsp;<span class="builtinfunc" id="1363009">len</span><span class="op" id="1363012">(</span><span class="ident" id="1363013">text</span><span class="op" id="1363017">)</span>&nbsp;<span class="op" id="1363019">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1363023">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1363097">j</span>&nbsp;<span class="op" id="1363099">:=</span>&nbsp;<span class="builtinfunc" id="1363102">len</span><span class="op" id="1363105">(</span><span class="ident" id="1363106">f</span><span class="op" id="1363107">.</span><span class="ident" id="1363108">pattern</span><span class="op" id="1363115">)</span>&nbsp;<span class="op" id="1363117">-</span>&nbsp;<span class="num" id="1363119">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1363123">for</span>&nbsp;<span class="ident" id="1363127">j</span>&nbsp;<span class="op" id="1363129">&gt;=</span>&nbsp;<span class="num" id="1363132">0</span>&nbsp;<span class="op" id="1363134">&amp;&amp;</span>&nbsp;<span class="ident" id="1363137">text</span><span class="op" id="1363141">[</span><span class="ident" id="1363142">i</span><span class="op" id="1363143">]</span>&nbsp;<span class="op" id="1363145">==</span>&nbsp;<span class="ident" id="1363148">f</span><span class="op" id="1363149">.</span><span class="ident" id="1363150">pattern</span><span class="op" id="1363157">[</span><span class="ident" id="1363158">j</span><span class="op" id="1363159">]</span>&nbsp;<span class="op" id="1363161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1363166">i</span><span class="op" id="1363167">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1363173">j</span><span class="op" id="1363174">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1363179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1363183">if</span>&nbsp;<span class="ident" id="1363186">j</span>&nbsp;<span class="op" id="1363188">&lt;</span>&nbsp;<span class="num" id="1363190">0</span>&nbsp;<span class="op" id="1363192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1363197">return</span>&nbsp;<span class="ident" id="1363204">i</span>&nbsp;<span class="op" id="1363206">+</span>&nbsp;<span class="num" id="1363208">1</span>&nbsp;<span class="comment" id="1363210">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1363221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1363225">i</span>&nbsp;<span class="op" id="1363227">+=</span>&nbsp;<span class="ident" id="1363230">max</span><span class="op" id="1363233">(</span><span class="ident" id="1363234">f</span><span class="op" id="1363235">.</span><span class="ident" id="1363236">badCharSkip</span><span class="op" id="1363247">[</span><span class="ident" id="1363248">text</span><span class="op" id="1363252">[</span><span class="ident" id="1363253">i</span><span class="op" id="1363254">]</span><span class="op" id="1363255">]</span><span class="op" id="1363256">,</span>&nbsp;<span class="ident" id="1363258">f</span><span class="op" id="1363259">.</span><span class="ident" id="1363260">goodSuffixSkip</span><span class="op" id="1363274">[</span><span class="ident" id="1363275">j</span><span class="op" id="1363276">]</span><span class="op" id="1363277">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1363280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1363283">return</span>&nbsp;<span class="op" id="1363290">-</span><span class="num" id="1363291">1</span><br>
<span class="lineno"></span><span class="op" id="1363293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1363296">func</span>&nbsp;<span class="ident" id="1363301">max</span><span class="op" id="1363304">(</span><span class="ident" id="1363305">a</span><span class="op" id="1363306">,</span>&nbsp;<span class="ident" id="1363308">b</span>&nbsp;<span class="builtintype" id="1363310">int</span><span class="op" id="1363313">)</span>&nbsp;<span class="builtintype" id="1363315">int</span>&nbsp;<span class="op" id="1363319">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1363322">if</span>&nbsp;<span class="ident" id="1363325">a</span>&nbsp;<span class="op" id="1363327">&gt;</span>&nbsp;<span class="ident" id="1363329">b</span>&nbsp;<span class="op" id="1363331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1363335">return</span>&nbsp;<span class="ident" id="1363342">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1363345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1363348">return</span>&nbsp;<span class="ident" id="1363355">b</span><br>
<span class="lineno"></span><span class="op" id="1363357">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
