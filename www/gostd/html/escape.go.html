<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html</h2>
<ul>
<li><a href="/gostd/html/entity.go.html">entity.go</a></li>
<li><a href="/gostd/html/entity_test.go.html">entity_test.go</a></li>
<li><a href="/gostd/html/escape.go.html" class="current">escape.go</a></li>
<li><a href="/gostd/html/escape_test.go.html">escape_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3682961">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3683016">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3683070">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3683121">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="3683195">package</span>&nbsp;<span class="ident" id="3683203">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3683209">import</span>&nbsp;<span class="op" id="3683216">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683219">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683228">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683239">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3683254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3683257">type</span>&nbsp;<span class="ident" id="3683262">writer</span>&nbsp;<span class="keyword" id="3683269">interface</span>&nbsp;<span class="op" id="3683279">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683282">WriteString</span><span class="op" id="3683293">(</span><span class="builtintype" id="3683294">string</span><span class="op" id="3683300">)</span>&nbsp;<span class="op" id="3683302">(</span><span class="builtintype" id="3683303">int</span><span class="op" id="3683306">,</span>&nbsp;<span class="builtintype" id="3683308">error</span><span class="op" id="3683313">)</span><br>
<span class="lineno"></span><span class="op" id="3683315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3683318">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3683392">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="3683426">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="3683537">var</span>&nbsp;<span class="ident" id="3683541">replacementTable</span>&nbsp;<span class="op" id="3683558">=</span>&nbsp;<span class="op" id="3683560">[</span><span class="op" id="3683561">...</span><span class="op" id="3683564">]</span><span class="builtintype" id="3683565">rune</span><span class="op" id="3683569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683572">&#39;\u20AC&#39;</span><span class="op" id="3683580">,</span>&nbsp;<span class="comment" id="3683582">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683636">&#39;\u0081&#39;</span><span class="op" id="3683644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683647">&#39;\u201A&#39;</span><span class="op" id="3683655">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683658">&#39;\u0192&#39;</span><span class="op" id="3683666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683669">&#39;\u201E&#39;</span><span class="op" id="3683677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683680">&#39;\u2026&#39;</span><span class="op" id="3683688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683691">&#39;\u2020&#39;</span><span class="op" id="3683699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683702">&#39;\u2021&#39;</span><span class="op" id="3683710">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683713">&#39;\u02C6&#39;</span><span class="op" id="3683721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683724">&#39;\u2030&#39;</span><span class="op" id="3683732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683735">&#39;\u0160&#39;</span><span class="op" id="3683743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683746">&#39;\u2039&#39;</span><span class="op" id="3683754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683757">&#39;\u0152&#39;</span><span class="op" id="3683765">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683768">&#39;\u008D&#39;</span><span class="op" id="3683776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683779">&#39;\u017D&#39;</span><span class="op" id="3683787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683790">&#39;\u008F&#39;</span><span class="op" id="3683798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683801">&#39;\u0090&#39;</span><span class="op" id="3683809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683812">&#39;\u2018&#39;</span><span class="op" id="3683820">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683823">&#39;\u2019&#39;</span><span class="op" id="3683831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683834">&#39;\u201C&#39;</span><span class="op" id="3683842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683845">&#39;\u201D&#39;</span><span class="op" id="3683853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683856">&#39;\u2022&#39;</span><span class="op" id="3683864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683867">&#39;\u2013&#39;</span><span class="op" id="3683875">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683878">&#39;\u2014&#39;</span><span class="op" id="3683886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683889">&#39;\u02DC&#39;</span><span class="op" id="3683897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683900">&#39;\u2122&#39;</span><span class="op" id="3683908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683911">&#39;\u0161&#39;</span><span class="op" id="3683919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683922">&#39;\u203A&#39;</span><span class="op" id="3683930">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683933">&#39;\u0153&#39;</span><span class="op" id="3683941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683944">&#39;\u009D&#39;</span><span class="op" id="3683952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683955">&#39;\u017E&#39;</span><span class="op" id="3683963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3683966">&#39;\u0178&#39;</span><span class="op" id="3683974">,</span>&nbsp;<span class="comment" id="3683976">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3684000">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3684048">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="3684078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3684081">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3684155">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="3684235">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="3684281">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3684340">func</span>&nbsp;<span class="ident" id="3684345">unescapeEntity</span><span class="op" id="3684359">(</span><span class="ident" id="3684360">b</span>&nbsp;<span class="op" id="3684362">[</span><span class="op" id="3684363">]</span><span class="builtintype" id="3684364">byte</span><span class="op" id="3684368">,</span>&nbsp;<span class="ident" id="3684370">dst</span><span class="op" id="3684373">,</span>&nbsp;<span class="ident" id="3684375">src</span>&nbsp;<span class="builtintype" id="3684379">int</span><span class="op" id="3684382">,</span>&nbsp;<span class="ident" id="3684384">attribute</span>&nbsp;<span class="builtintype" id="3684394">bool</span><span class="op" id="3684398">)</span>&nbsp;<span class="op" id="3684400">(</span><span class="ident" id="3684401">dst1</span><span class="op" id="3684405">,</span>&nbsp;<span class="ident" id="3684407">src1</span>&nbsp;<span class="builtintype" id="3684412">int</span><span class="op" id="3684415">)</span>&nbsp;<span class="op" id="3684417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3684420">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3684533">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684593">i</span><span class="op" id="3684594">,</span>&nbsp;<span class="ident" id="3684596">s</span>&nbsp;<span class="op" id="3684598">:=</span>&nbsp;<span class="num" id="3684601">1</span><span class="op" id="3684602">,</span>&nbsp;<span class="ident" id="3684604">b</span><span class="op" id="3684605">[</span><span class="ident" id="3684606">src</span><span class="op" id="3684609">:</span><span class="op" id="3684610">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684614">if</span>&nbsp;<span class="builtinfunc" id="3684617">len</span><span class="op" id="3684620">(</span><span class="ident" id="3684621">s</span><span class="op" id="3684622">)</span>&nbsp;<span class="op" id="3684624">&lt;=</span>&nbsp;<span class="num" id="3684627">1</span>&nbsp;<span class="op" id="3684629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684633">b</span><span class="op" id="3684634">[</span><span class="ident" id="3684635">dst</span><span class="op" id="3684638">]</span>&nbsp;<span class="op" id="3684640">=</span>&nbsp;<span class="ident" id="3684642">b</span><span class="op" id="3684643">[</span><span class="ident" id="3684644">src</span><span class="op" id="3684647">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684651">return</span>&nbsp;<span class="ident" id="3684658">dst</span>&nbsp;<span class="op" id="3684662">+</span>&nbsp;<span class="num" id="3684664">1</span><span class="op" id="3684665">,</span>&nbsp;<span class="ident" id="3684667">src</span>&nbsp;<span class="op" id="3684671">+</span>&nbsp;<span class="num" id="3684673">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684680">if</span>&nbsp;<span class="ident" id="3684683">s</span><span class="op" id="3684684">[</span><span class="ident" id="3684685">i</span><span class="op" id="3684686">]</span>&nbsp;<span class="op" id="3684688">==</span>&nbsp;<span class="string" id="3684691">&#39;#&#39;</span>&nbsp;<span class="op" id="3684695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684699">if</span>&nbsp;<span class="builtinfunc" id="3684702">len</span><span class="op" id="3684705">(</span><span class="ident" id="3684706">s</span><span class="op" id="3684707">)</span>&nbsp;<span class="op" id="3684709">&lt;=</span>&nbsp;<span class="num" id="3684712">3</span>&nbsp;<span class="op" id="3684714">{</span>&nbsp;<span class="comment" id="3684716">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684754">b</span><span class="op" id="3684755">[</span><span class="ident" id="3684756">dst</span><span class="op" id="3684759">]</span>&nbsp;<span class="op" id="3684761">=</span>&nbsp;<span class="ident" id="3684763">b</span><span class="op" id="3684764">[</span><span class="ident" id="3684765">src</span><span class="op" id="3684768">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684773">return</span>&nbsp;<span class="ident" id="3684780">dst</span>&nbsp;<span class="op" id="3684784">+</span>&nbsp;<span class="num" id="3684786">1</span><span class="op" id="3684787">,</span>&nbsp;<span class="ident" id="3684789">src</span>&nbsp;<span class="op" id="3684793">+</span>&nbsp;<span class="num" id="3684795">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684803">i</span><span class="op" id="3684804">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684809">c</span>&nbsp;<span class="op" id="3684811">:=</span>&nbsp;<span class="ident" id="3684814">s</span><span class="op" id="3684815">[</span><span class="ident" id="3684816">i</span><span class="op" id="3684817">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684821">hex</span>&nbsp;<span class="op" id="3684825">:=</span>&nbsp;<span class="builtintype" id="3684828">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684836">if</span>&nbsp;<span class="ident" id="3684839">c</span>&nbsp;<span class="op" id="3684841">==</span>&nbsp;<span class="string" id="3684844">&#39;x&#39;</span>&nbsp;<span class="op" id="3684848">||</span>&nbsp;<span class="ident" id="3684851">c</span>&nbsp;<span class="op" id="3684853">==</span>&nbsp;<span class="string" id="3684856">&#39;X&#39;</span>&nbsp;<span class="op" id="3684860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684865">hex</span>&nbsp;<span class="op" id="3684869">=</span>&nbsp;<span class="builtintype" id="3684871">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684879">i</span><span class="op" id="3684880">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684885">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684890">x</span>&nbsp;<span class="op" id="3684892">:=</span>&nbsp;<span class="string" id="3684895">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684904">for</span>&nbsp;<span class="ident" id="3684908">i</span>&nbsp;<span class="op" id="3684910">&lt;</span>&nbsp;<span class="builtinfunc" id="3684912">len</span><span class="op" id="3684915">(</span><span class="ident" id="3684916">s</span><span class="op" id="3684917">)</span>&nbsp;<span class="op" id="3684919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684924">c</span>&nbsp;<span class="op" id="3684926">=</span>&nbsp;<span class="ident" id="3684928">s</span><span class="op" id="3684929">[</span><span class="ident" id="3684930">i</span><span class="op" id="3684931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684936">i</span><span class="op" id="3684937">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684943">if</span>&nbsp;<span class="ident" id="3684946">hex</span>&nbsp;<span class="op" id="3684950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684956">if</span>&nbsp;<span class="string" id="3684959">&#39;0&#39;</span>&nbsp;<span class="op" id="3684963">&lt;=</span>&nbsp;<span class="ident" id="3684966">c</span>&nbsp;<span class="op" id="3684968">&amp;&amp;</span>&nbsp;<span class="ident" id="3684971">c</span>&nbsp;<span class="op" id="3684973">&lt;=</span>&nbsp;<span class="string" id="3684976">&#39;9&#39;</span>&nbsp;<span class="op" id="3684980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684987">x</span>&nbsp;<span class="op" id="3684989">=</span>&nbsp;<span class="num" id="3684991">16</span><span class="op" id="3684993">*</span><span class="ident" id="3684994">x</span>&nbsp;<span class="op" id="3684996">+</span>&nbsp;<span class="builtintype" id="3684998">rune</span><span class="op" id="3685002">(</span><span class="ident" id="3685003">c</span><span class="op" id="3685004">)</span>&nbsp;<span class="op" id="3685006">-</span>&nbsp;<span class="string" id="3685008">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685017">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685030">}</span>&nbsp;<span class="keyword" id="3685032">else</span>&nbsp;<span class="keyword" id="3685037">if</span>&nbsp;<span class="string" id="3685040">&#39;a&#39;</span>&nbsp;<span class="op" id="3685044">&lt;=</span>&nbsp;<span class="ident" id="3685047">c</span>&nbsp;<span class="op" id="3685049">&amp;&amp;</span>&nbsp;<span class="ident" id="3685052">c</span>&nbsp;<span class="op" id="3685054">&lt;=</span>&nbsp;<span class="string" id="3685057">&#39;f&#39;</span>&nbsp;<span class="op" id="3685061">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685068">x</span>&nbsp;<span class="op" id="3685070">=</span>&nbsp;<span class="num" id="3685072">16</span><span class="op" id="3685074">*</span><span class="ident" id="3685075">x</span>&nbsp;<span class="op" id="3685077">+</span>&nbsp;<span class="builtintype" id="3685079">rune</span><span class="op" id="3685083">(</span><span class="ident" id="3685084">c</span><span class="op" id="3685085">)</span>&nbsp;<span class="op" id="3685087">-</span>&nbsp;<span class="string" id="3685089">&#39;a&#39;</span>&nbsp;<span class="op" id="3685093">+</span>&nbsp;<span class="num" id="3685095">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685103">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685116">}</span>&nbsp;<span class="keyword" id="3685118">else</span>&nbsp;<span class="keyword" id="3685123">if</span>&nbsp;<span class="string" id="3685126">&#39;A&#39;</span>&nbsp;<span class="op" id="3685130">&lt;=</span>&nbsp;<span class="ident" id="3685133">c</span>&nbsp;<span class="op" id="3685135">&amp;&amp;</span>&nbsp;<span class="ident" id="3685138">c</span>&nbsp;<span class="op" id="3685140">&lt;=</span>&nbsp;<span class="string" id="3685143">&#39;F&#39;</span>&nbsp;<span class="op" id="3685147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685154">x</span>&nbsp;<span class="op" id="3685156">=</span>&nbsp;<span class="num" id="3685158">16</span><span class="op" id="3685160">*</span><span class="ident" id="3685161">x</span>&nbsp;<span class="op" id="3685163">+</span>&nbsp;<span class="builtintype" id="3685165">rune</span><span class="op" id="3685169">(</span><span class="ident" id="3685170">c</span><span class="op" id="3685171">)</span>&nbsp;<span class="op" id="3685173">-</span>&nbsp;<span class="string" id="3685175">&#39;A&#39;</span>&nbsp;<span class="op" id="3685179">+</span>&nbsp;<span class="num" id="3685181">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685189">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685207">}</span>&nbsp;<span class="keyword" id="3685209">else</span>&nbsp;<span class="keyword" id="3685214">if</span>&nbsp;<span class="string" id="3685217">&#39;0&#39;</span>&nbsp;<span class="op" id="3685221">&lt;=</span>&nbsp;<span class="ident" id="3685224">c</span>&nbsp;<span class="op" id="3685226">&amp;&amp;</span>&nbsp;<span class="ident" id="3685229">c</span>&nbsp;<span class="op" id="3685231">&lt;=</span>&nbsp;<span class="string" id="3685234">&#39;9&#39;</span>&nbsp;<span class="op" id="3685238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685244">x</span>&nbsp;<span class="op" id="3685246">=</span>&nbsp;<span class="num" id="3685248">10</span><span class="op" id="3685250">*</span><span class="ident" id="3685251">x</span>&nbsp;<span class="op" id="3685253">+</span>&nbsp;<span class="builtintype" id="3685255">rune</span><span class="op" id="3685259">(</span><span class="ident" id="3685260">c</span><span class="op" id="3685261">)</span>&nbsp;<span class="op" id="3685263">-</span>&nbsp;<span class="string" id="3685265">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685273">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685285">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685290">if</span>&nbsp;<span class="ident" id="3685293">c</span>&nbsp;<span class="op" id="3685295">!=</span>&nbsp;<span class="string" id="3685298">&#39;;&#39;</span>&nbsp;<span class="op" id="3685302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685308">i</span><span class="op" id="3685309">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685320">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685328">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685333">if</span>&nbsp;<span class="ident" id="3685336">i</span>&nbsp;<span class="op" id="3685338">&lt;=</span>&nbsp;<span class="num" id="3685341">3</span>&nbsp;<span class="op" id="3685343">{</span>&nbsp;<span class="comment" id="3685345">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685374">b</span><span class="op" id="3685375">[</span><span class="ident" id="3685376">dst</span><span class="op" id="3685379">]</span>&nbsp;<span class="op" id="3685381">=</span>&nbsp;<span class="ident" id="3685383">b</span><span class="op" id="3685384">[</span><span class="ident" id="3685385">src</span><span class="op" id="3685388">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685393">return</span>&nbsp;<span class="ident" id="3685400">dst</span>&nbsp;<span class="op" id="3685404">+</span>&nbsp;<span class="num" id="3685406">1</span><span class="op" id="3685407">,</span>&nbsp;<span class="ident" id="3685409">src</span>&nbsp;<span class="op" id="3685413">+</span>&nbsp;<span class="num" id="3685415">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685419">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685424">if</span>&nbsp;<span class="num" id="3685427">0x80</span>&nbsp;<span class="op" id="3685432">&lt;=</span>&nbsp;<span class="ident" id="3685435">x</span>&nbsp;<span class="op" id="3685437">&amp;&amp;</span>&nbsp;<span class="ident" id="3685440">x</span>&nbsp;<span class="op" id="3685442">&lt;=</span>&nbsp;<span class="num" id="3685445">0x9F</span>&nbsp;<span class="op" id="3685450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3685455">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685522">x</span>&nbsp;<span class="op" id="3685524">=</span>&nbsp;<span class="ident" id="3685526">replacementTable</span><span class="op" id="3685542">[</span><span class="ident" id="3685543">x</span><span class="op" id="3685544">-</span><span class="num" id="3685545">0x80</span><span class="op" id="3685549">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685553">}</span>&nbsp;<span class="keyword" id="3685555">else</span>&nbsp;<span class="keyword" id="3685560">if</span>&nbsp;<span class="ident" id="3685563">x</span>&nbsp;<span class="op" id="3685565">==</span>&nbsp;<span class="num" id="3685568">0</span>&nbsp;<span class="op" id="3685570">||</span>&nbsp;<span class="op" id="3685573">(</span><span class="num" id="3685574">0xD800</span>&nbsp;<span class="op" id="3685581">&lt;=</span>&nbsp;<span class="ident" id="3685584">x</span>&nbsp;<span class="op" id="3685586">&amp;&amp;</span>&nbsp;<span class="ident" id="3685589">x</span>&nbsp;<span class="op" id="3685591">&lt;=</span>&nbsp;<span class="num" id="3685594">0xDFFF</span><span class="op" id="3685600">)</span>&nbsp;<span class="op" id="3685602">||</span>&nbsp;<span class="ident" id="3685605">x</span>&nbsp;<span class="op" id="3685607">&gt;</span>&nbsp;<span class="num" id="3685609">0x10FFFF</span>&nbsp;<span class="op" id="3685618">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3685623">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685688">x</span>&nbsp;<span class="op" id="3685690">=</span>&nbsp;<span class="string" id="3685692">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685708">return</span>&nbsp;<span class="ident" id="3685715">dst</span>&nbsp;<span class="op" id="3685719">+</span>&nbsp;<span class="ident" id="3685721">utf8</span><span class="op" id="3685725">.</span><span class="ident" id="3685726">EncodeRune</span><span class="op" id="3685736">(</span><span class="ident" id="3685737">b</span><span class="op" id="3685738">[</span><span class="ident" id="3685739">dst</span><span class="op" id="3685742">:</span><span class="op" id="3685743">]</span><span class="op" id="3685744">,</span>&nbsp;<span class="ident" id="3685746">x</span><span class="op" id="3685747">)</span><span class="op" id="3685748">,</span>&nbsp;<span class="ident" id="3685750">src</span>&nbsp;<span class="op" id="3685754">+</span>&nbsp;<span class="ident" id="3685756">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3685759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3685763">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3685827">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3685890">for</span>&nbsp;<span class="ident" id="3685894">i</span>&nbsp;<span class="op" id="3685896">&lt;</span>&nbsp;<span class="builtinfunc" id="3685898">len</span><span class="op" id="3685901">(</span><span class="ident" id="3685902">s</span><span class="op" id="3685903">)</span>&nbsp;<span class="op" id="3685905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685909">c</span>&nbsp;<span class="op" id="3685911">:=</span>&nbsp;<span class="ident" id="3685914">s</span><span class="op" id="3685915">[</span><span class="ident" id="3685916">i</span><span class="op" id="3685917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3685921">i</span><span class="op" id="3685922">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3685927">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686012">if</span>&nbsp;<span class="string" id="3686015">&#39;a&#39;</span>&nbsp;<span class="op" id="3686019">&lt;=</span>&nbsp;<span class="ident" id="3686022">c</span>&nbsp;<span class="op" id="3686024">&amp;&amp;</span>&nbsp;<span class="ident" id="3686027">c</span>&nbsp;<span class="op" id="3686029">&lt;=</span>&nbsp;<span class="string" id="3686032">&#39;z&#39;</span>&nbsp;<span class="op" id="3686036">||</span>&nbsp;<span class="string" id="3686039">&#39;A&#39;</span>&nbsp;<span class="op" id="3686043">&lt;=</span>&nbsp;<span class="ident" id="3686046">c</span>&nbsp;<span class="op" id="3686048">&amp;&amp;</span>&nbsp;<span class="ident" id="3686051">c</span>&nbsp;<span class="op" id="3686053">&lt;=</span>&nbsp;<span class="string" id="3686056">&#39;Z&#39;</span>&nbsp;<span class="op" id="3686060">||</span>&nbsp;<span class="string" id="3686063">&#39;0&#39;</span>&nbsp;<span class="op" id="3686067">&lt;=</span>&nbsp;<span class="ident" id="3686070">c</span>&nbsp;<span class="op" id="3686072">&amp;&amp;</span>&nbsp;<span class="ident" id="3686075">c</span>&nbsp;<span class="op" id="3686077">&lt;=</span>&nbsp;<span class="string" id="3686080">&#39;9&#39;</span>&nbsp;<span class="op" id="3686084">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686089">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686104">if</span>&nbsp;<span class="ident" id="3686107">c</span>&nbsp;<span class="op" id="3686109">!=</span>&nbsp;<span class="string" id="3686112">&#39;;&#39;</span>&nbsp;<span class="op" id="3686116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686121">i</span><span class="op" id="3686122">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686127">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686131">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686142">entityName</span>&nbsp;<span class="op" id="3686153">:=</span>&nbsp;<span class="builtintype" id="3686156">string</span><span class="op" id="3686162">(</span><span class="ident" id="3686163">s</span><span class="op" id="3686164">[</span><span class="num" id="3686165">1</span><span class="op" id="3686166">:</span><span class="ident" id="3686167">i</span><span class="op" id="3686168">]</span><span class="op" id="3686169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686172">if</span>&nbsp;<span class="ident" id="3686175">entityName</span>&nbsp;<span class="op" id="3686186">==</span>&nbsp;<span class="string" id="3686189">&#34;&#34;</span>&nbsp;<span class="op" id="3686192">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3686196">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686207">}</span>&nbsp;<span class="keyword" id="3686209">else</span>&nbsp;<span class="keyword" id="3686214">if</span>&nbsp;<span class="ident" id="3686217">attribute</span>&nbsp;<span class="op" id="3686227">&amp;&amp;</span>&nbsp;<span class="ident" id="3686230">entityName</span><span class="op" id="3686240">[</span><span class="builtinfunc" id="3686241">len</span><span class="op" id="3686244">(</span><span class="ident" id="3686245">entityName</span><span class="op" id="3686255">)</span><span class="op" id="3686256">-</span><span class="num" id="3686257">1</span><span class="op" id="3686258">]</span>&nbsp;<span class="op" id="3686260">!=</span>&nbsp;<span class="string" id="3686263">&#39;;&#39;</span>&nbsp;<span class="op" id="3686267">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3686270">len</span><span class="op" id="3686273">(</span><span class="ident" id="3686274">s</span><span class="op" id="3686275">)</span>&nbsp;<span class="op" id="3686277">&gt;</span>&nbsp;<span class="ident" id="3686279">i</span>&nbsp;<span class="op" id="3686281">&amp;&amp;</span>&nbsp;<span class="ident" id="3686284">s</span><span class="op" id="3686285">[</span><span class="ident" id="3686286">i</span><span class="op" id="3686287">]</span>&nbsp;<span class="op" id="3686289">==</span>&nbsp;<span class="string" id="3686292">&#39;=&#39;</span>&nbsp;<span class="op" id="3686296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3686300">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686311">}</span>&nbsp;<span class="keyword" id="3686313">else</span>&nbsp;<span class="keyword" id="3686318">if</span>&nbsp;<span class="ident" id="3686321">x</span>&nbsp;<span class="op" id="3686323">:=</span>&nbsp;<span class="ident" id="3686326">entity</span><span class="op" id="3686332">[</span><span class="ident" id="3686333">entityName</span><span class="op" id="3686343">]</span><span class="op" id="3686344">;</span>&nbsp;<span class="ident" id="3686346">x</span>&nbsp;<span class="op" id="3686348">!=</span>&nbsp;<span class="num" id="3686351">0</span>&nbsp;<span class="op" id="3686353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686357">return</span>&nbsp;<span class="ident" id="3686364">dst</span>&nbsp;<span class="op" id="3686368">+</span>&nbsp;<span class="ident" id="3686370">utf8</span><span class="op" id="3686374">.</span><span class="ident" id="3686375">EncodeRune</span><span class="op" id="3686385">(</span><span class="ident" id="3686386">b</span><span class="op" id="3686387">[</span><span class="ident" id="3686388">dst</span><span class="op" id="3686391">:</span><span class="op" id="3686392">]</span><span class="op" id="3686393">,</span>&nbsp;<span class="ident" id="3686395">x</span><span class="op" id="3686396">)</span><span class="op" id="3686397">,</span>&nbsp;<span class="ident" id="3686399">src</span>&nbsp;<span class="op" id="3686403">+</span>&nbsp;<span class="ident" id="3686405">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686408">}</span>&nbsp;<span class="keyword" id="3686410">else</span>&nbsp;<span class="keyword" id="3686415">if</span>&nbsp;<span class="ident" id="3686418">x</span>&nbsp;<span class="op" id="3686420">:=</span>&nbsp;<span class="ident" id="3686423">entity2</span><span class="op" id="3686430">[</span><span class="ident" id="3686431">entityName</span><span class="op" id="3686441">]</span><span class="op" id="3686442">;</span>&nbsp;<span class="ident" id="3686444">x</span><span class="op" id="3686445">[</span><span class="num" id="3686446">0</span><span class="op" id="3686447">]</span>&nbsp;<span class="op" id="3686449">!=</span>&nbsp;<span class="num" id="3686452">0</span>&nbsp;<span class="op" id="3686454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686458">dst1</span>&nbsp;<span class="op" id="3686463">:=</span>&nbsp;<span class="ident" id="3686466">dst</span>&nbsp;<span class="op" id="3686470">+</span>&nbsp;<span class="ident" id="3686472">utf8</span><span class="op" id="3686476">.</span><span class="ident" id="3686477">EncodeRune</span><span class="op" id="3686487">(</span><span class="ident" id="3686488">b</span><span class="op" id="3686489">[</span><span class="ident" id="3686490">dst</span><span class="op" id="3686493">:</span><span class="op" id="3686494">]</span><span class="op" id="3686495">,</span>&nbsp;<span class="ident" id="3686497">x</span><span class="op" id="3686498">[</span><span class="num" id="3686499">0</span><span class="op" id="3686500">]</span><span class="op" id="3686501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686505">return</span>&nbsp;<span class="ident" id="3686512">dst1</span>&nbsp;<span class="op" id="3686517">+</span>&nbsp;<span class="ident" id="3686519">utf8</span><span class="op" id="3686523">.</span><span class="ident" id="3686524">EncodeRune</span><span class="op" id="3686534">(</span><span class="ident" id="3686535">b</span><span class="op" id="3686536">[</span><span class="ident" id="3686537">dst1</span><span class="op" id="3686541">:</span><span class="op" id="3686542">]</span><span class="op" id="3686543">,</span>&nbsp;<span class="ident" id="3686545">x</span><span class="op" id="3686546">[</span><span class="num" id="3686547">1</span><span class="op" id="3686548">]</span><span class="op" id="3686549">)</span><span class="op" id="3686550">,</span>&nbsp;<span class="ident" id="3686552">src</span>&nbsp;<span class="op" id="3686556">+</span>&nbsp;<span class="ident" id="3686558">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686561">}</span>&nbsp;<span class="keyword" id="3686563">else</span>&nbsp;<span class="keyword" id="3686568">if</span>&nbsp;<span class="op" id="3686571">!</span><span class="ident" id="3686572">attribute</span>&nbsp;<span class="op" id="3686582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686586">maxLen</span>&nbsp;<span class="op" id="3686593">:=</span>&nbsp;<span class="builtinfunc" id="3686596">len</span><span class="op" id="3686599">(</span><span class="ident" id="3686600">entityName</span><span class="op" id="3686610">)</span>&nbsp;<span class="op" id="3686612">-</span>&nbsp;<span class="num" id="3686614">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686618">if</span>&nbsp;<span class="ident" id="3686621">maxLen</span>&nbsp;<span class="op" id="3686628">&gt;</span>&nbsp;<span class="ident" id="3686630">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="3686660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686665">maxLen</span>&nbsp;<span class="op" id="3686672">=</span>&nbsp;<span class="ident" id="3686674">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686710">for</span>&nbsp;<span class="ident" id="3686714">j</span>&nbsp;<span class="op" id="3686716">:=</span>&nbsp;<span class="ident" id="3686719">maxLen</span><span class="op" id="3686725">;</span>&nbsp;<span class="ident" id="3686727">j</span>&nbsp;<span class="op" id="3686729">&gt;</span>&nbsp;<span class="num" id="3686731">1</span><span class="op" id="3686732">;</span>&nbsp;<span class="ident" id="3686734">j</span><span class="op" id="3686735">--</span>&nbsp;<span class="op" id="3686738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686743">if</span>&nbsp;<span class="ident" id="3686746">x</span>&nbsp;<span class="op" id="3686748">:=</span>&nbsp;<span class="ident" id="3686751">entity</span><span class="op" id="3686757">[</span><span class="ident" id="3686758">entityName</span><span class="op" id="3686768">[</span><span class="op" id="3686769">:</span><span class="ident" id="3686770">j</span><span class="op" id="3686771">]</span><span class="op" id="3686772">]</span><span class="op" id="3686773">;</span>&nbsp;<span class="ident" id="3686775">x</span>&nbsp;<span class="op" id="3686777">!=</span>&nbsp;<span class="num" id="3686780">0</span>&nbsp;<span class="op" id="3686782">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686788">return</span>&nbsp;<span class="ident" id="3686795">dst</span>&nbsp;<span class="op" id="3686799">+</span>&nbsp;<span class="ident" id="3686801">utf8</span><span class="op" id="3686805">.</span><span class="ident" id="3686806">EncodeRune</span><span class="op" id="3686816">(</span><span class="ident" id="3686817">b</span><span class="op" id="3686818">[</span><span class="ident" id="3686819">dst</span><span class="op" id="3686822">:</span><span class="op" id="3686823">]</span><span class="op" id="3686824">,</span>&nbsp;<span class="ident" id="3686826">x</span><span class="op" id="3686827">)</span><span class="op" id="3686828">,</span>&nbsp;<span class="ident" id="3686830">src</span>&nbsp;<span class="op" id="3686834">+</span>&nbsp;<span class="ident" id="3686836">j</span>&nbsp;<span class="op" id="3686838">+</span>&nbsp;<span class="num" id="3686840">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3686852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3686856">dst1</span><span class="op" id="3686860">,</span>&nbsp;<span class="ident" id="3686862">src1</span>&nbsp;<span class="op" id="3686867">=</span>&nbsp;<span class="ident" id="3686869">dst</span><span class="op" id="3686872">+</span><span class="ident" id="3686873">i</span><span class="op" id="3686874">,</span>&nbsp;<span class="ident" id="3686876">src</span><span class="op" id="3686879">+</span><span class="ident" id="3686880">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3686883">copy</span><span class="op" id="3686887">(</span><span class="ident" id="3686888">b</span><span class="op" id="3686889">[</span><span class="ident" id="3686890">dst</span><span class="op" id="3686893">:</span><span class="ident" id="3686894">dst1</span><span class="op" id="3686898">]</span><span class="op" id="3686899">,</span>&nbsp;<span class="ident" id="3686901">b</span><span class="op" id="3686902">[</span><span class="ident" id="3686903">src</span><span class="op" id="3686906">:</span><span class="ident" id="3686907">src1</span><span class="op" id="3686911">]</span><span class="op" id="3686912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3686915">return</span>&nbsp;<span class="ident" id="3686922">dst1</span><span class="op" id="3686926">,</span>&nbsp;<span class="ident" id="3686928">src1</span><br>
<span class="lineno"></span><span class="op" id="3686933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="3686936">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3687013">func</span>&nbsp;<span class="ident" id="3687018">unescape</span><span class="op" id="3687026">(</span><span class="ident" id="3687027">b</span>&nbsp;<span class="op" id="3687029">[</span><span class="op" id="3687030">]</span><span class="builtintype" id="3687031">byte</span><span class="op" id="3687035">)</span>&nbsp;<span class="op" id="3687037">[</span><span class="op" id="3687038">]</span><span class="builtintype" id="3687039">byte</span>&nbsp;<span class="op" id="3687044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687047">for</span>&nbsp;<span class="ident" id="3687051">i</span><span class="op" id="3687052">,</span>&nbsp;<span class="ident" id="3687054">c</span>&nbsp;<span class="op" id="3687056">:=</span>&nbsp;<span class="keyword" id="3687059">range</span>&nbsp;<span class="ident" id="3687065">b</span>&nbsp;<span class="op" id="3687067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687071">if</span>&nbsp;<span class="ident" id="3687074">c</span>&nbsp;<span class="op" id="3687076">==</span>&nbsp;<span class="string" id="3687079">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="3687083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687088">dst</span><span class="op" id="3687091">,</span>&nbsp;<span class="ident" id="3687093">src</span>&nbsp;<span class="op" id="3687097">:=</span>&nbsp;<span class="ident" id="3687100">unescapeEntity</span><span class="op" id="3687114">(</span><span class="ident" id="3687115">b</span><span class="op" id="3687116">,</span>&nbsp;<span class="ident" id="3687118">i</span><span class="op" id="3687119">,</span>&nbsp;<span class="ident" id="3687121">i</span><span class="op" id="3687122">,</span>&nbsp;<span class="builtintype" id="3687124">false</span><span class="op" id="3687129">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687134">for</span>&nbsp;<span class="ident" id="3687138">src</span>&nbsp;<span class="op" id="3687142">&lt;</span>&nbsp;<span class="builtinfunc" id="3687144">len</span><span class="op" id="3687147">(</span><span class="ident" id="3687148">b</span><span class="op" id="3687149">)</span>&nbsp;<span class="op" id="3687151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687157">c</span>&nbsp;<span class="op" id="3687159">:=</span>&nbsp;<span class="ident" id="3687162">b</span><span class="op" id="3687163">[</span><span class="ident" id="3687164">src</span><span class="op" id="3687167">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687173">if</span>&nbsp;<span class="ident" id="3687176">c</span>&nbsp;<span class="op" id="3687178">==</span>&nbsp;<span class="string" id="3687181">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="3687185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687192">dst</span><span class="op" id="3687195">,</span>&nbsp;<span class="ident" id="3687197">src</span>&nbsp;<span class="op" id="3687201">=</span>&nbsp;<span class="ident" id="3687203">unescapeEntity</span><span class="op" id="3687217">(</span><span class="ident" id="3687218">b</span><span class="op" id="3687219">,</span>&nbsp;<span class="ident" id="3687221">dst</span><span class="op" id="3687224">,</span>&nbsp;<span class="ident" id="3687226">src</span><span class="op" id="3687229">,</span>&nbsp;<span class="builtintype" id="3687231">false</span><span class="op" id="3687236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3687242">}</span>&nbsp;<span class="keyword" id="3687244">else</span>&nbsp;<span class="op" id="3687249">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687256">b</span><span class="op" id="3687257">[</span><span class="ident" id="3687258">dst</span><span class="op" id="3687261">]</span>&nbsp;<span class="op" id="3687263">=</span>&nbsp;<span class="ident" id="3687265">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687272">dst</span><span class="op" id="3687275">,</span>&nbsp;<span class="ident" id="3687277">src</span>&nbsp;<span class="op" id="3687281">=</span>&nbsp;<span class="ident" id="3687283">dst</span><span class="op" id="3687286">+</span><span class="num" id="3687287">1</span><span class="op" id="3687288">,</span>&nbsp;<span class="ident" id="3687290">src</span><span class="op" id="3687293">+</span><span class="num" id="3687294">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3687300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3687305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687310">return</span>&nbsp;<span class="ident" id="3687317">b</span><span class="op" id="3687318">[</span><span class="num" id="3687319">0</span><span class="op" id="3687320">:</span><span class="ident" id="3687321">dst</span><span class="op" id="3687324">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3687328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3687331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687334">return</span>&nbsp;<span class="ident" id="3687341">b</span><br>
<span class="lineno"></span><span class="op" id="3687343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="3687346">const</span>&nbsp;<span class="ident" id="3687352">escapedChars</span>&nbsp;<span class="op" id="3687365">=</span>&nbsp;<span class="string" id="3687367">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3687376">func</span>&nbsp;<span class="ident" id="3687381">escape</span><span class="op" id="3687387">(</span><span class="ident" id="3687388">w</span>&nbsp;<span class="ident" id="3687390">writer</span><span class="op" id="3687396">,</span>&nbsp;<span class="ident" id="3687398">s</span>&nbsp;<span class="builtintype" id="3687400">string</span><span class="op" id="3687406">)</span>&nbsp;<span class="builtintype" id="3687408">error</span>&nbsp;<span class="op" id="3687414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687417">i</span>&nbsp;<span class="op" id="3687419">:=</span>&nbsp;<span class="ident" id="3687422">strings</span><span class="op" id="3687429">.</span><span class="ident" id="3687430">IndexAny</span><span class="op" id="3687438">(</span><span class="ident" id="3687439">s</span><span class="op" id="3687440">,</span>&nbsp;<span class="ident" id="3687442">escapedChars</span><span class="op" id="3687454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687457">for</span>&nbsp;<span class="ident" id="3687461">i</span>&nbsp;<span class="op" id="3687463">!=</span>&nbsp;<span class="op" id="3687466">-</span><span class="num" id="3687467">1</span>&nbsp;<span class="op" id="3687469">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687473">if</span>&nbsp;<span class="ident" id="3687476">_</span><span class="op" id="3687477">,</span>&nbsp;<span class="ident" id="3687479">err</span>&nbsp;<span class="op" id="3687483">:=</span>&nbsp;<span class="ident" id="3687486">w</span><span class="op" id="3687487">.</span><span class="ident" id="3687488">WriteString</span><span class="op" id="3687499">(</span><span class="ident" id="3687500">s</span><span class="op" id="3687501">[</span><span class="op" id="3687502">:</span><span class="ident" id="3687503">i</span><span class="op" id="3687504">]</span><span class="op" id="3687505">)</span><span class="op" id="3687506">;</span>&nbsp;<span class="ident" id="3687508">err</span>&nbsp;<span class="op" id="3687512">!=</span>&nbsp;<span class="ident" id="3687515">nil</span>&nbsp;<span class="op" id="3687519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687524">return</span>&nbsp;<span class="ident" id="3687531">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3687537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687541">var</span>&nbsp;<span class="ident" id="3687545">esc</span>&nbsp;<span class="builtintype" id="3687549">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687558">switch</span>&nbsp;<span class="ident" id="3687565">s</span><span class="op" id="3687566">[</span><span class="ident" id="3687567">i</span><span class="op" id="3687568">]</span>&nbsp;<span class="op" id="3687570">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687574">case</span>&nbsp;<span class="string" id="3687579">&#39;&amp;&#39;</span><span class="op" id="3687582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687587">esc</span>&nbsp;<span class="op" id="3687591">=</span>&nbsp;<span class="string" id="3687593">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687603">case</span>&nbsp;<span class="string" id="3687608">&#39;\&#39;&#39;</span><span class="op" id="3687612">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3687617">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687694">esc</span>&nbsp;<span class="op" id="3687698">=</span>&nbsp;<span class="string" id="3687700">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687710">case</span>&nbsp;<span class="string" id="3687715">&#39;&lt;&#39;</span><span class="op" id="3687718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687723">esc</span>&nbsp;<span class="op" id="3687727">=</span>&nbsp;<span class="string" id="3687729">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687738">case</span>&nbsp;<span class="string" id="3687743">&#39;&gt;&#39;</span><span class="op" id="3687746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687751">esc</span>&nbsp;<span class="op" id="3687755">=</span>&nbsp;<span class="string" id="3687757">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687766">case</span>&nbsp;<span class="string" id="3687771">&#39;&#34;&#39;</span><span class="op" id="3687774">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3687779">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687819">esc</span>&nbsp;<span class="op" id="3687823">=</span>&nbsp;<span class="string" id="3687825">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687835">default</span><span class="op" id="3687842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3687847">panic</span><span class="op" id="3687852">(</span><span class="string" id="3687853">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="3687884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3687888">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687892">s</span>&nbsp;<span class="op" id="3687894">=</span>&nbsp;<span class="ident" id="3687896">s</span><span class="op" id="3687897">[</span><span class="ident" id="3687898">i</span><span class="op" id="3687899">+</span><span class="num" id="3687900">1</span><span class="op" id="3687901">:</span><span class="op" id="3687902">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687906">if</span>&nbsp;<span class="ident" id="3687909">_</span><span class="op" id="3687910">,</span>&nbsp;<span class="ident" id="3687912">err</span>&nbsp;<span class="op" id="3687916">:=</span>&nbsp;<span class="ident" id="3687919">w</span><span class="op" id="3687920">.</span><span class="ident" id="3687921">WriteString</span><span class="op" id="3687932">(</span><span class="ident" id="3687933">esc</span><span class="op" id="3687936">)</span><span class="op" id="3687937">;</span>&nbsp;<span class="ident" id="3687939">err</span>&nbsp;<span class="op" id="3687943">!=</span>&nbsp;<span class="ident" id="3687946">nil</span>&nbsp;<span class="op" id="3687950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3687955">return</span>&nbsp;<span class="ident" id="3687962">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3687968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3687972">i</span>&nbsp;<span class="op" id="3687974">=</span>&nbsp;<span class="ident" id="3687976">strings</span><span class="op" id="3687983">.</span><span class="ident" id="3687984">IndexAny</span><span class="op" id="3687992">(</span><span class="ident" id="3687993">s</span><span class="op" id="3687994">,</span>&nbsp;<span class="ident" id="3687996">escapedChars</span><span class="op" id="3688008">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3688011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3688014">_</span><span class="op" id="3688015">,</span>&nbsp;<span class="ident" id="3688017">err</span>&nbsp;<span class="op" id="3688021">:=</span>&nbsp;<span class="ident" id="3688024">w</span><span class="op" id="3688025">.</span><span class="ident" id="3688026">WriteString</span><span class="op" id="3688037">(</span><span class="ident" id="3688038">s</span><span class="op" id="3688039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688042">return</span>&nbsp;<span class="ident" id="3688049">err</span><br>
<span class="lineno"></span><span class="op" id="3688053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="3688056">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="3688129">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3688185">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3688262">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="3688278">func</span>&nbsp;<span class="ident" id="3688283">EscapeString</span><span class="op" id="3688295">(</span><span class="ident" id="3688296">s</span>&nbsp;<span class="builtintype" id="3688298">string</span><span class="op" id="3688304">)</span>&nbsp;<span class="builtintype" id="3688306">string</span>&nbsp;<span class="op" id="3688313">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688316">if</span>&nbsp;<span class="ident" id="3688319">strings</span><span class="op" id="3688326">.</span><span class="ident" id="3688327">IndexAny</span><span class="op" id="3688335">(</span><span class="ident" id="3688336">s</span><span class="op" id="3688337">,</span>&nbsp;<span class="ident" id="3688339">escapedChars</span><span class="op" id="3688351">)</span>&nbsp;<span class="op" id="3688353">==</span>&nbsp;<span class="op" id="3688356">-</span><span class="num" id="3688357">1</span>&nbsp;<span class="op" id="3688359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688363">return</span>&nbsp;<span class="ident" id="3688370">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3688373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688376">var</span>&nbsp;<span class="ident" id="3688380">buf</span>&nbsp;<span class="ident" id="3688384">bytes</span><span class="op" id="3688389">.</span><span class="ident" id="3688390">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3688398">escape</span><span class="op" id="3688404">(</span><span class="op" id="3688405">&amp;</span><span class="ident" id="3688406">buf</span><span class="op" id="3688409">,</span>&nbsp;<span class="ident" id="3688411">s</span><span class="op" id="3688412">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688415">return</span>&nbsp;<span class="ident" id="3688422">buf</span><span class="op" id="3688425">.</span><span class="ident" id="3688426">String</span><span class="op" id="3688432">(</span><span class="op" id="3688433">)</span><br>
<span class="lineno"></span><span class="op" id="3688435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3688438">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3688517">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="3688596">//&nbsp;unescapes&nbsp;to&nbsp;&#34;&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3688648">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3688725">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="3688741">func</span>&nbsp;<span class="ident" id="3688746">UnescapeString</span><span class="op" id="3688760">(</span><span class="ident" id="3688761">s</span>&nbsp;<span class="builtintype" id="3688763">string</span><span class="op" id="3688769">)</span>&nbsp;<span class="builtintype" id="3688771">string</span>&nbsp;<span class="op" id="3688778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688781">for</span>&nbsp;<span class="ident" id="3688785">_</span><span class="op" id="3688786">,</span>&nbsp;<span class="ident" id="3688788">c</span>&nbsp;<span class="op" id="3688790">:=</span>&nbsp;<span class="keyword" id="3688793">range</span>&nbsp;<span class="ident" id="3688799">s</span>&nbsp;<span class="op" id="3688801">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688805">if</span>&nbsp;<span class="ident" id="3688808">c</span>&nbsp;<span class="op" id="3688810">==</span>&nbsp;<span class="string" id="3688813">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="3688817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688822">return</span>&nbsp;<span class="builtintype" id="3688829">string</span><span class="op" id="3688835">(</span><span class="ident" id="3688836">unescape</span><span class="op" id="3688844">(</span><span class="op" id="3688845">[</span><span class="op" id="3688846">]</span><span class="builtintype" id="3688847">byte</span><span class="op" id="3688851">(</span><span class="ident" id="3688852">s</span><span class="op" id="3688853">)</span><span class="op" id="3688854">)</span><span class="op" id="3688855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3688859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3688862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3688865">return</span>&nbsp;<span class="ident" id="3688872">s</span><br>
<span class="lineno">250</span><span class="op" id="3688874">}</span>
</div>
</body>
</html>
