<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html" class="current">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2419208">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2419263">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2419317">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2419368">//&nbsp;Package&nbsp;strings&nbsp;implements&nbsp;simple&nbsp;functions&nbsp;to&nbsp;manipulate&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="2419438">package</span>&nbsp;<span class="ident" id="2419446">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2419455">import</span>&nbsp;<span class="op" id="2419462">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2419465">&#34;unicode&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2419476">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2419491">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2419494">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;an&nbsp;array&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;strings)&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;(n&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;no&nbsp;limit).</span><br>
<span class="lineno"></span><span class="comment" id="2419635">//&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;become&nbsp;correct&nbsp;encodings&nbsp;of&nbsp;U+FFF8.</span><br>
<span class="lineno">15</span><span class="keyword" id="2419698">func</span>&nbsp;<span class="ident" id="2419703">explode</span><span class="op" id="2419710">(</span><span class="ident" id="2419711">s</span>&nbsp;<span class="builtintype" id="2419713">string</span><span class="op" id="2419719">,</span>&nbsp;<span class="ident" id="2419721">n</span>&nbsp;<span class="builtintype" id="2419723">int</span><span class="op" id="2419726">)</span>&nbsp;<span class="op" id="2419728">[</span><span class="op" id="2419729">]</span><span class="builtintype" id="2419730">string</span>&nbsp;<span class="op" id="2419737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419740">if</span>&nbsp;<span class="ident" id="2419743">n</span>&nbsp;<span class="op" id="2419745">==</span>&nbsp;<span class="num" id="2419748">0</span>&nbsp;<span class="op" id="2419750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419754">return</span>&nbsp;<span class="ident" id="2419761">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2419766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2419769">l</span>&nbsp;<span class="op" id="2419771">:=</span>&nbsp;<span class="ident" id="2419774">utf8</span><span class="op" id="2419778">.</span><span class="ident" id="2419779">RuneCountInString</span><span class="op" id="2419796">(</span><span class="ident" id="2419797">s</span><span class="op" id="2419798">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419801">if</span>&nbsp;<span class="ident" id="2419804">n</span>&nbsp;<span class="op" id="2419806">&lt;=</span>&nbsp;<span class="num" id="2419809">0</span>&nbsp;<span class="op" id="2419811">||</span>&nbsp;<span class="ident" id="2419814">n</span>&nbsp;<span class="op" id="2419816">&gt;</span>&nbsp;<span class="ident" id="2419818">l</span>&nbsp;<span class="op" id="2419820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2419824">n</span>&nbsp;<span class="op" id="2419826">=</span>&nbsp;<span class="ident" id="2419828">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2419831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2419834">a</span>&nbsp;<span class="op" id="2419836">:=</span>&nbsp;<span class="builtinfunc" id="2419839">make</span><span class="op" id="2419843">(</span><span class="op" id="2419844">[</span><span class="op" id="2419845">]</span><span class="builtintype" id="2419846">string</span><span class="op" id="2419852">,</span>&nbsp;<span class="ident" id="2419854">n</span><span class="op" id="2419855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419858">var</span>&nbsp;<span class="ident" id="2419862">size</span>&nbsp;<span class="builtintype" id="2419867">int</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419872">var</span>&nbsp;<span class="ident" id="2419876">ch</span>&nbsp;<span class="builtintype" id="2419879">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2419885">i</span><span class="op" id="2419886">,</span>&nbsp;<span class="ident" id="2419888">cur</span>&nbsp;<span class="op" id="2419892">:=</span>&nbsp;<span class="num" id="2419895">0</span><span class="op" id="2419896">,</span>&nbsp;<span class="num" id="2419898">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419901">for</span>&nbsp;<span class="op" id="2419905">;</span>&nbsp;<span class="ident" id="2419907">i</span><span class="op" id="2419908">+</span><span class="num" id="2419909">1</span>&nbsp;<span class="op" id="2419911">&lt;</span>&nbsp;<span class="ident" id="2419913">n</span><span class="op" id="2419914">;</span>&nbsp;<span class="ident" id="2419916">i</span><span class="op" id="2419917">++</span>&nbsp;<span class="op" id="2419920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2419924">ch</span><span class="op" id="2419926">,</span>&nbsp;<span class="ident" id="2419928">size</span>&nbsp;<span class="op" id="2419933">=</span>&nbsp;<span class="ident" id="2419935">utf8</span><span class="op" id="2419939">.</span><span class="ident" id="2419940">DecodeRuneInString</span><span class="op" id="2419958">(</span><span class="ident" id="2419959">s</span><span class="op" id="2419960">[</span><span class="ident" id="2419961">cur</span><span class="op" id="2419964">:</span><span class="op" id="2419965">]</span><span class="op" id="2419966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419970">if</span>&nbsp;<span class="ident" id="2419973">ch</span>&nbsp;<span class="op" id="2419976">==</span>&nbsp;<span class="ident" id="2419979">utf8</span><span class="op" id="2419983">.</span><span class="ident" id="2419984">RuneError</span>&nbsp;<span class="op" id="2419994">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2419999">a</span><span class="op" id="2420000">[</span><span class="ident" id="2420001">i</span><span class="op" id="2420002">]</span>&nbsp;<span class="op" id="2420004">=</span>&nbsp;<span class="builtintype" id="2420006">string</span><span class="op" id="2420012">(</span><span class="ident" id="2420013">utf8</span><span class="op" id="2420017">.</span><span class="ident" id="2420018">RuneError</span><span class="op" id="2420027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2420031">}</span>&nbsp;<span class="keyword" id="2420033">else</span>&nbsp;<span class="op" id="2420038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420043">a</span><span class="op" id="2420044">[</span><span class="ident" id="2420045">i</span><span class="op" id="2420046">]</span>&nbsp;<span class="op" id="2420048">=</span>&nbsp;<span class="ident" id="2420050">s</span><span class="op" id="2420051">[</span><span class="ident" id="2420052">cur</span>&nbsp;<span class="op" id="2420056">:</span>&nbsp;<span class="ident" id="2420058">cur</span><span class="op" id="2420061">+</span><span class="ident" id="2420062">size</span><span class="op" id="2420066">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2420070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420074">cur</span>&nbsp;<span class="op" id="2420078">+=</span>&nbsp;<span class="ident" id="2420081">size</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2420087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2420090">//&nbsp;add&nbsp;the&nbsp;rest,&nbsp;if&nbsp;there&nbsp;is&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420124">if</span>&nbsp;<span class="ident" id="2420127">cur</span>&nbsp;<span class="op" id="2420131">&lt;</span>&nbsp;<span class="builtinfunc" id="2420133">len</span><span class="op" id="2420136">(</span><span class="ident" id="2420137">s</span><span class="op" id="2420138">)</span>&nbsp;<span class="op" id="2420140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420144">a</span><span class="op" id="2420145">[</span><span class="ident" id="2420146">i</span><span class="op" id="2420147">]</span>&nbsp;<span class="op" id="2420149">=</span>&nbsp;<span class="ident" id="2420151">s</span><span class="op" id="2420152">[</span><span class="ident" id="2420153">cur</span><span class="op" id="2420156">:</span><span class="op" id="2420157">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2420160">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420163">return</span>&nbsp;<span class="ident" id="2420170">a</span><br>
<span class="lineno"></span><span class="op" id="2420172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2420175">//&nbsp;primeRK&nbsp;is&nbsp;the&nbsp;prime&nbsp;base&nbsp;used&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2420234">const</span>&nbsp;<span class="ident" id="2420240">primeRK</span>&nbsp;<span class="op" id="2420248">=</span>&nbsp;<span class="num" id="2420250">16777619</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2420260">//&nbsp;hashStr&nbsp;returns&nbsp;the&nbsp;hash&nbsp;and&nbsp;the&nbsp;appropriate&nbsp;multiplicative</span><br>
<span class="lineno"></span><span class="comment" id="2420323">//&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="2420366">func</span>&nbsp;<span class="ident" id="2420371">hashStr</span><span class="op" id="2420378">(</span><span class="ident" id="2420379">sep</span>&nbsp;<span class="builtintype" id="2420383">string</span><span class="op" id="2420389">)</span>&nbsp;<span class="op" id="2420391">(</span><span class="builtintype" id="2420392">uint32</span><span class="op" id="2420398">,</span>&nbsp;<span class="builtintype" id="2420400">uint32</span><span class="op" id="2420406">)</span>&nbsp;<span class="op" id="2420408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420411">hash</span>&nbsp;<span class="op" id="2420416">:=</span>&nbsp;<span class="builtintype" id="2420419">uint32</span><span class="op" id="2420425">(</span><span class="num" id="2420426">0</span><span class="op" id="2420427">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420430">for</span>&nbsp;<span class="ident" id="2420434">i</span>&nbsp;<span class="op" id="2420436">:=</span>&nbsp;<span class="num" id="2420439">0</span><span class="op" id="2420440">;</span>&nbsp;<span class="ident" id="2420442">i</span>&nbsp;<span class="op" id="2420444">&lt;</span>&nbsp;<span class="builtinfunc" id="2420446">len</span><span class="op" id="2420449">(</span><span class="ident" id="2420450">sep</span><span class="op" id="2420453">)</span><span class="op" id="2420454">;</span>&nbsp;<span class="ident" id="2420456">i</span><span class="op" id="2420457">++</span>&nbsp;<span class="op" id="2420460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420464">hash</span>&nbsp;<span class="op" id="2420469">=</span>&nbsp;<span class="ident" id="2420471">hash</span><span class="op" id="2420475">*</span><span class="ident" id="2420476">primeRK</span>&nbsp;<span class="op" id="2420484">+</span>&nbsp;<span class="builtintype" id="2420486">uint32</span><span class="op" id="2420492">(</span><span class="ident" id="2420493">sep</span><span class="op" id="2420496">[</span><span class="ident" id="2420497">i</span><span class="op" id="2420498">]</span><span class="op" id="2420499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2420502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420505">var</span>&nbsp;<span class="ident" id="2420509">pow</span><span class="op" id="2420512">,</span>&nbsp;<span class="ident" id="2420514">sq</span>&nbsp;<span class="builtintype" id="2420517">uint32</span>&nbsp;<span class="op" id="2420524">=</span>&nbsp;<span class="num" id="2420526">1</span><span class="op" id="2420527">,</span>&nbsp;<span class="ident" id="2420529">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420538">for</span>&nbsp;<span class="ident" id="2420542">i</span>&nbsp;<span class="op" id="2420544">:=</span>&nbsp;<span class="builtinfunc" id="2420547">len</span><span class="op" id="2420550">(</span><span class="ident" id="2420551">sep</span><span class="op" id="2420554">)</span><span class="op" id="2420555">;</span>&nbsp;<span class="ident" id="2420557">i</span>&nbsp;<span class="op" id="2420559">&gt;</span>&nbsp;<span class="num" id="2420561">0</span><span class="op" id="2420562">;</span>&nbsp;<span class="ident" id="2420564">i</span>&nbsp;<span class="op" id="2420566">&gt;&gt;=</span>&nbsp;<span class="num" id="2420570">1</span>&nbsp;<span class="op" id="2420572">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420576">if</span>&nbsp;<span class="ident" id="2420579">i</span><span class="op" id="2420580">&amp;</span><span class="num" id="2420581">1</span>&nbsp;<span class="op" id="2420583">!=</span>&nbsp;<span class="num" id="2420586">0</span>&nbsp;<span class="op" id="2420588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420593">pow</span>&nbsp;<span class="op" id="2420597">*=</span>&nbsp;<span class="ident" id="2420600">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2420605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420609">sq</span>&nbsp;<span class="op" id="2420612">*=</span>&nbsp;<span class="ident" id="2420615">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2420619">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420622">return</span>&nbsp;<span class="ident" id="2420629">hash</span><span class="op" id="2420633">,</span>&nbsp;<span class="ident" id="2420635">pow</span><br>
<span class="lineno"></span><span class="op" id="2420639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2420642">//&nbsp;hashStrRev&nbsp;returns&nbsp;the&nbsp;hash&nbsp;of&nbsp;the&nbsp;reverse&nbsp;of&nbsp;sep&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2420703">//&nbsp;appropriate&nbsp;multiplicative&nbsp;factor&nbsp;for&nbsp;use&nbsp;in&nbsp;Rabin-Karp&nbsp;algorithm.</span><br>
<span class="lineno">65</span><span class="keyword" id="2420773">func</span>&nbsp;<span class="ident" id="2420778">hashStrRev</span><span class="op" id="2420788">(</span><span class="ident" id="2420789">sep</span>&nbsp;<span class="builtintype" id="2420793">string</span><span class="op" id="2420799">)</span>&nbsp;<span class="op" id="2420801">(</span><span class="builtintype" id="2420802">uint32</span><span class="op" id="2420808">,</span>&nbsp;<span class="builtintype" id="2420810">uint32</span><span class="op" id="2420816">)</span>&nbsp;<span class="op" id="2420818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420821">hash</span>&nbsp;<span class="op" id="2420826">:=</span>&nbsp;<span class="builtintype" id="2420829">uint32</span><span class="op" id="2420835">(</span><span class="num" id="2420836">0</span><span class="op" id="2420837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420840">for</span>&nbsp;<span class="ident" id="2420844">i</span>&nbsp;<span class="op" id="2420846">:=</span>&nbsp;<span class="builtinfunc" id="2420849">len</span><span class="op" id="2420852">(</span><span class="ident" id="2420853">sep</span><span class="op" id="2420856">)</span>&nbsp;<span class="op" id="2420858">-</span>&nbsp;<span class="num" id="2420860">1</span><span class="op" id="2420861">;</span>&nbsp;<span class="ident" id="2420863">i</span>&nbsp;<span class="op" id="2420865">&gt;=</span>&nbsp;<span class="num" id="2420868">0</span><span class="op" id="2420869">;</span>&nbsp;<span class="ident" id="2420871">i</span><span class="op" id="2420872">--</span>&nbsp;<span class="op" id="2420875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420879">hash</span>&nbsp;<span class="op" id="2420884">=</span>&nbsp;<span class="ident" id="2420886">hash</span><span class="op" id="2420890">*</span><span class="ident" id="2420891">primeRK</span>&nbsp;<span class="op" id="2420899">+</span>&nbsp;<span class="builtintype" id="2420901">uint32</span><span class="op" id="2420907">(</span><span class="ident" id="2420908">sep</span><span class="op" id="2420911">[</span><span class="ident" id="2420912">i</span><span class="op" id="2420913">]</span><span class="op" id="2420914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2420917">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420920">var</span>&nbsp;<span class="ident" id="2420924">pow</span><span class="op" id="2420927">,</span>&nbsp;<span class="ident" id="2420929">sq</span>&nbsp;<span class="builtintype" id="2420932">uint32</span>&nbsp;<span class="op" id="2420939">=</span>&nbsp;<span class="num" id="2420941">1</span><span class="op" id="2420942">,</span>&nbsp;<span class="ident" id="2420944">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420953">for</span>&nbsp;<span class="ident" id="2420957">i</span>&nbsp;<span class="op" id="2420959">:=</span>&nbsp;<span class="builtinfunc" id="2420962">len</span><span class="op" id="2420965">(</span><span class="ident" id="2420966">sep</span><span class="op" id="2420969">)</span><span class="op" id="2420970">;</span>&nbsp;<span class="ident" id="2420972">i</span>&nbsp;<span class="op" id="2420974">&gt;</span>&nbsp;<span class="num" id="2420976">0</span><span class="op" id="2420977">;</span>&nbsp;<span class="ident" id="2420979">i</span>&nbsp;<span class="op" id="2420981">&gt;&gt;=</span>&nbsp;<span class="num" id="2420985">1</span>&nbsp;<span class="op" id="2420987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420991">if</span>&nbsp;<span class="ident" id="2420994">i</span><span class="op" id="2420995">&amp;</span><span class="num" id="2420996">1</span>&nbsp;<span class="op" id="2420998">!=</span>&nbsp;<span class="num" id="2421001">0</span>&nbsp;<span class="op" id="2421003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421008">pow</span>&nbsp;<span class="op" id="2421012">*=</span>&nbsp;<span class="ident" id="2421015">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421020">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421024">sq</span>&nbsp;<span class="op" id="2421027">*=</span>&nbsp;<span class="ident" id="2421030">sq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421037">return</span>&nbsp;<span class="ident" id="2421044">hash</span><span class="op" id="2421048">,</span>&nbsp;<span class="ident" id="2421050">pow</span><br>
<span class="lineno"></span><span class="op" id="2421054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2421057">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2421126">func</span>&nbsp;<span class="ident" id="2421131">Count</span><span class="op" id="2421136">(</span><span class="ident" id="2421137">s</span><span class="op" id="2421138">,</span>&nbsp;<span class="ident" id="2421140">sep</span>&nbsp;<span class="builtintype" id="2421144">string</span><span class="op" id="2421150">)</span>&nbsp;<span class="builtintype" id="2421152">int</span>&nbsp;<span class="op" id="2421156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421159">n</span>&nbsp;<span class="op" id="2421161">:=</span>&nbsp;<span class="num" id="2421164">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2421167">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421185">switch</span>&nbsp;<span class="op" id="2421192">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421195">case</span>&nbsp;<span class="builtinfunc" id="2421200">len</span><span class="op" id="2421203">(</span><span class="ident" id="2421204">sep</span><span class="op" id="2421207">)</span>&nbsp;<span class="op" id="2421209">==</span>&nbsp;<span class="num" id="2421212">0</span><span class="op" id="2421213">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421217">return</span>&nbsp;<span class="ident" id="2421224">utf8</span><span class="op" id="2421228">.</span><span class="ident" id="2421229">RuneCountInString</span><span class="op" id="2421246">(</span><span class="ident" id="2421247">s</span><span class="op" id="2421248">)</span>&nbsp;<span class="op" id="2421250">+</span>&nbsp;<span class="num" id="2421252">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421255">case</span>&nbsp;<span class="builtinfunc" id="2421260">len</span><span class="op" id="2421263">(</span><span class="ident" id="2421264">sep</span><span class="op" id="2421267">)</span>&nbsp;<span class="op" id="2421269">==</span>&nbsp;<span class="num" id="2421272">1</span><span class="op" id="2421273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2421277">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421313">c</span>&nbsp;<span class="op" id="2421315">:=</span>&nbsp;<span class="ident" id="2421318">sep</span><span class="op" id="2421321">[</span><span class="num" id="2421322">0</span><span class="op" id="2421323">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421327">for</span>&nbsp;<span class="ident" id="2421331">i</span>&nbsp;<span class="op" id="2421333">:=</span>&nbsp;<span class="num" id="2421336">0</span><span class="op" id="2421337">;</span>&nbsp;<span class="ident" id="2421339">i</span>&nbsp;<span class="op" id="2421341">&lt;</span>&nbsp;<span class="builtinfunc" id="2421343">len</span><span class="op" id="2421346">(</span><span class="ident" id="2421347">s</span><span class="op" id="2421348">)</span><span class="op" id="2421349">;</span>&nbsp;<span class="ident" id="2421351">i</span><span class="op" id="2421352">++</span>&nbsp;<span class="op" id="2421355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421360">if</span>&nbsp;<span class="ident" id="2421363">s</span><span class="op" id="2421364">[</span><span class="ident" id="2421365">i</span><span class="op" id="2421366">]</span>&nbsp;<span class="op" id="2421368">==</span>&nbsp;<span class="ident" id="2421371">c</span>&nbsp;<span class="op" id="2421373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421379">n</span><span class="op" id="2421380">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421390">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421394">return</span>&nbsp;<span class="ident" id="2421401">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421404">case</span>&nbsp;<span class="builtinfunc" id="2421409">len</span><span class="op" id="2421412">(</span><span class="ident" id="2421413">sep</span><span class="op" id="2421416">)</span>&nbsp;<span class="op" id="2421418">&gt;</span>&nbsp;<span class="builtinfunc" id="2421420">len</span><span class="op" id="2421423">(</span><span class="ident" id="2421424">s</span><span class="op" id="2421425">)</span><span class="op" id="2421426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421430">return</span>&nbsp;<span class="num" id="2421437">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421440">case</span>&nbsp;<span class="builtinfunc" id="2421445">len</span><span class="op" id="2421448">(</span><span class="ident" id="2421449">sep</span><span class="op" id="2421452">)</span>&nbsp;<span class="op" id="2421454">==</span>&nbsp;<span class="builtinfunc" id="2421457">len</span><span class="op" id="2421460">(</span><span class="ident" id="2421461">s</span><span class="op" id="2421462">)</span><span class="op" id="2421463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421467">if</span>&nbsp;<span class="ident" id="2421470">sep</span>&nbsp;<span class="op" id="2421474">==</span>&nbsp;<span class="ident" id="2421477">s</span>&nbsp;<span class="op" id="2421479">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421484">return</span>&nbsp;<span class="num" id="2421491">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421499">return</span>&nbsp;<span class="num" id="2421506">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2421512">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421534">hashsep</span><span class="op" id="2421541">,</span>&nbsp;<span class="ident" id="2421543">pow</span>&nbsp;<span class="op" id="2421547">:=</span>&nbsp;<span class="ident" id="2421550">hashStr</span><span class="op" id="2421557">(</span><span class="ident" id="2421558">sep</span><span class="op" id="2421561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421564">h</span>&nbsp;<span class="op" id="2421566">:=</span>&nbsp;<span class="builtintype" id="2421569">uint32</span><span class="op" id="2421575">(</span><span class="num" id="2421576">0</span><span class="op" id="2421577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421580">for</span>&nbsp;<span class="ident" id="2421584">i</span>&nbsp;<span class="op" id="2421586">:=</span>&nbsp;<span class="num" id="2421589">0</span><span class="op" id="2421590">;</span>&nbsp;<span class="ident" id="2421592">i</span>&nbsp;<span class="op" id="2421594">&lt;</span>&nbsp;<span class="builtinfunc" id="2421596">len</span><span class="op" id="2421599">(</span><span class="ident" id="2421600">sep</span><span class="op" id="2421603">)</span><span class="op" id="2421604">;</span>&nbsp;<span class="ident" id="2421606">i</span><span class="op" id="2421607">++</span>&nbsp;<span class="op" id="2421610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421614">h</span>&nbsp;<span class="op" id="2421616">=</span>&nbsp;<span class="ident" id="2421618">h</span><span class="op" id="2421619">*</span><span class="ident" id="2421620">primeRK</span>&nbsp;<span class="op" id="2421628">+</span>&nbsp;<span class="builtintype" id="2421630">uint32</span><span class="op" id="2421636">(</span><span class="ident" id="2421637">s</span><span class="op" id="2421638">[</span><span class="ident" id="2421639">i</span><span class="op" id="2421640">]</span><span class="op" id="2421641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421644">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421647">lastmatch</span>&nbsp;<span class="op" id="2421657">:=</span>&nbsp;<span class="num" id="2421660">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421663">if</span>&nbsp;<span class="ident" id="2421666">h</span>&nbsp;<span class="op" id="2421668">==</span>&nbsp;<span class="ident" id="2421671">hashsep</span>&nbsp;<span class="op" id="2421679">&amp;&amp;</span>&nbsp;<span class="ident" id="2421682">s</span><span class="op" id="2421683">[</span><span class="op" id="2421684">:</span><span class="builtinfunc" id="2421685">len</span><span class="op" id="2421688">(</span><span class="ident" id="2421689">sep</span><span class="op" id="2421692">)</span><span class="op" id="2421693">]</span>&nbsp;<span class="op" id="2421695">==</span>&nbsp;<span class="ident" id="2421698">sep</span>&nbsp;<span class="op" id="2421702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421706">n</span><span class="op" id="2421707">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421712">lastmatch</span>&nbsp;<span class="op" id="2421722">=</span>&nbsp;<span class="builtinfunc" id="2421724">len</span><span class="op" id="2421727">(</span><span class="ident" id="2421728">sep</span><span class="op" id="2421731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421734">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421737">for</span>&nbsp;<span class="ident" id="2421741">i</span>&nbsp;<span class="op" id="2421743">:=</span>&nbsp;<span class="builtinfunc" id="2421746">len</span><span class="op" id="2421749">(</span><span class="ident" id="2421750">sep</span><span class="op" id="2421753">)</span><span class="op" id="2421754">;</span>&nbsp;<span class="ident" id="2421756">i</span>&nbsp;<span class="op" id="2421758">&lt;</span>&nbsp;<span class="builtinfunc" id="2421760">len</span><span class="op" id="2421763">(</span><span class="ident" id="2421764">s</span><span class="op" id="2421765">)</span><span class="op" id="2421766">;</span>&nbsp;<span class="op" id="2421768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421772">h</span>&nbsp;<span class="op" id="2421774">*=</span>&nbsp;<span class="ident" id="2421777">primeRK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421787">h</span>&nbsp;<span class="op" id="2421789">+=</span>&nbsp;<span class="builtintype" id="2421792">uint32</span><span class="op" id="2421798">(</span><span class="ident" id="2421799">s</span><span class="op" id="2421800">[</span><span class="ident" id="2421801">i</span><span class="op" id="2421802">]</span><span class="op" id="2421803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421807">h</span>&nbsp;<span class="op" id="2421809">-=</span>&nbsp;<span class="ident" id="2421812">pow</span>&nbsp;<span class="op" id="2421816">*</span>&nbsp;<span class="builtintype" id="2421818">uint32</span><span class="op" id="2421824">(</span><span class="ident" id="2421825">s</span><span class="op" id="2421826">[</span><span class="ident" id="2421827">i</span><span class="op" id="2421828">-</span><span class="builtinfunc" id="2421829">len</span><span class="op" id="2421832">(</span><span class="ident" id="2421833">sep</span><span class="op" id="2421836">)</span><span class="op" id="2421837">]</span><span class="op" id="2421838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421842">i</span><span class="op" id="2421843">++</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421848">if</span>&nbsp;<span class="ident" id="2421851">h</span>&nbsp;<span class="op" id="2421853">==</span>&nbsp;<span class="ident" id="2421856">hashsep</span>&nbsp;<span class="op" id="2421864">&amp;&amp;</span>&nbsp;<span class="ident" id="2421867">lastmatch</span>&nbsp;<span class="op" id="2421877">&lt;=</span>&nbsp;<span class="ident" id="2421880">i</span><span class="op" id="2421881">-</span><span class="builtinfunc" id="2421882">len</span><span class="op" id="2421885">(</span><span class="ident" id="2421886">sep</span><span class="op" id="2421889">)</span>&nbsp;<span class="op" id="2421891">&amp;&amp;</span>&nbsp;<span class="ident" id="2421894">s</span><span class="op" id="2421895">[</span><span class="ident" id="2421896">i</span><span class="op" id="2421897">-</span><span class="builtinfunc" id="2421898">len</span><span class="op" id="2421901">(</span><span class="ident" id="2421902">sep</span><span class="op" id="2421905">)</span><span class="op" id="2421906">:</span><span class="ident" id="2421907">i</span><span class="op" id="2421908">]</span>&nbsp;<span class="op" id="2421910">==</span>&nbsp;<span class="ident" id="2421913">sep</span>&nbsp;<span class="op" id="2421917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421922">n</span><span class="op" id="2421923">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2421929">lastmatch</span>&nbsp;<span class="op" id="2421939">=</span>&nbsp;<span class="ident" id="2421941">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2421948">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2421951">return</span>&nbsp;<span class="ident" id="2421958">n</span><br>
<span class="lineno"></span><span class="op" id="2421960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2421963">//&nbsp;Contains&nbsp;returns&nbsp;true&nbsp;if&nbsp;substr&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2422011">func</span>&nbsp;<span class="ident" id="2422016">Contains</span><span class="op" id="2422024">(</span><span class="ident" id="2422025">s</span><span class="op" id="2422026">,</span>&nbsp;<span class="ident" id="2422028">substr</span>&nbsp;<span class="builtintype" id="2422035">string</span><span class="op" id="2422041">)</span>&nbsp;<span class="builtintype" id="2422043">bool</span>&nbsp;<span class="op" id="2422048">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422051">return</span>&nbsp;<span class="ident" id="2422058">Index</span><span class="op" id="2422063">(</span><span class="ident" id="2422064">s</span><span class="op" id="2422065">,</span>&nbsp;<span class="ident" id="2422067">substr</span><span class="op" id="2422073">)</span>&nbsp;<span class="op" id="2422075">&gt;=</span>&nbsp;<span class="num" id="2422078">0</span><br>
<span class="lineno"></span><span class="op" id="2422080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2422083">//&nbsp;ContainsAny&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars&nbsp;are&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2422161">func</span>&nbsp;<span class="ident" id="2422166">ContainsAny</span><span class="op" id="2422177">(</span><span class="ident" id="2422178">s</span><span class="op" id="2422179">,</span>&nbsp;<span class="ident" id="2422181">chars</span>&nbsp;<span class="builtintype" id="2422187">string</span><span class="op" id="2422193">)</span>&nbsp;<span class="builtintype" id="2422195">bool</span>&nbsp;<span class="op" id="2422200">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422203">return</span>&nbsp;<span class="ident" id="2422210">IndexAny</span><span class="op" id="2422218">(</span><span class="ident" id="2422219">s</span><span class="op" id="2422220">,</span>&nbsp;<span class="ident" id="2422222">chars</span><span class="op" id="2422227">)</span>&nbsp;<span class="op" id="2422229">&gt;=</span>&nbsp;<span class="num" id="2422232">0</span><br>
<span class="lineno"></span><span class="op" id="2422234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2422237">//&nbsp;ContainsRune&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;is&nbsp;within&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2422307">func</span>&nbsp;<span class="ident" id="2422312">ContainsRune</span><span class="op" id="2422324">(</span><span class="ident" id="2422325">s</span>&nbsp;<span class="builtintype" id="2422327">string</span><span class="op" id="2422333">,</span>&nbsp;<span class="ident" id="2422335">r</span>&nbsp;<span class="builtintype" id="2422337">rune</span><span class="op" id="2422341">)</span>&nbsp;<span class="builtintype" id="2422343">bool</span>&nbsp;<span class="op" id="2422348">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422351">return</span>&nbsp;<span class="ident" id="2422358">IndexRune</span><span class="op" id="2422367">(</span><span class="ident" id="2422368">s</span><span class="op" id="2422369">,</span>&nbsp;<span class="ident" id="2422371">r</span><span class="op" id="2422372">)</span>&nbsp;<span class="op" id="2422374">&gt;=</span>&nbsp;<span class="num" id="2422377">0</span><br>
<span class="lineno"></span><span class="op" id="2422379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2422382">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2422478">func</span>&nbsp;<span class="ident" id="2422483">Index</span><span class="op" id="2422488">(</span><span class="ident" id="2422489">s</span><span class="op" id="2422490">,</span>&nbsp;<span class="ident" id="2422492">sep</span>&nbsp;<span class="builtintype" id="2422496">string</span><span class="op" id="2422502">)</span>&nbsp;<span class="builtintype" id="2422504">int</span>&nbsp;<span class="op" id="2422508">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2422511">n</span>&nbsp;<span class="op" id="2422513">:=</span>&nbsp;<span class="builtinfunc" id="2422516">len</span><span class="op" id="2422519">(</span><span class="ident" id="2422520">sep</span><span class="op" id="2422523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422526">switch</span>&nbsp;<span class="op" id="2422533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422536">case</span>&nbsp;<span class="ident" id="2422541">n</span>&nbsp;<span class="op" id="2422543">==</span>&nbsp;<span class="num" id="2422546">0</span><span class="op" id="2422547">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422551">return</span>&nbsp;<span class="num" id="2422558">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422561">case</span>&nbsp;<span class="ident" id="2422566">n</span>&nbsp;<span class="op" id="2422568">==</span>&nbsp;<span class="num" id="2422571">1</span><span class="op" id="2422572">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422576">return</span>&nbsp;<span class="ident" id="2422583">IndexByte</span><span class="op" id="2422592">(</span><span class="ident" id="2422593">s</span><span class="op" id="2422594">,</span>&nbsp;<span class="ident" id="2422596">sep</span><span class="op" id="2422599">[</span><span class="num" id="2422600">0</span><span class="op" id="2422601">]</span><span class="op" id="2422602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422605">case</span>&nbsp;<span class="ident" id="2422610">n</span>&nbsp;<span class="op" id="2422612">==</span>&nbsp;<span class="builtinfunc" id="2422615">len</span><span class="op" id="2422618">(</span><span class="ident" id="2422619">s</span><span class="op" id="2422620">)</span><span class="op" id="2422621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422625">if</span>&nbsp;<span class="ident" id="2422628">sep</span>&nbsp;<span class="op" id="2422632">==</span>&nbsp;<span class="ident" id="2422635">s</span>&nbsp;<span class="op" id="2422637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422642">return</span>&nbsp;<span class="num" id="2422649">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2422653">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422657">return</span>&nbsp;<span class="op" id="2422664">-</span><span class="num" id="2422665">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422668">case</span>&nbsp;<span class="ident" id="2422673">n</span>&nbsp;<span class="op" id="2422675">&gt;</span>&nbsp;<span class="builtinfunc" id="2422677">len</span><span class="op" id="2422680">(</span><span class="ident" id="2422681">s</span><span class="op" id="2422682">)</span><span class="op" id="2422683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422687">return</span>&nbsp;<span class="op" id="2422694">-</span><span class="num" id="2422695">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2422698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2422701">//&nbsp;Rabin-Karp&nbsp;search</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2422723">hashsep</span><span class="op" id="2422730">,</span>&nbsp;<span class="ident" id="2422732">pow</span>&nbsp;<span class="op" id="2422736">:=</span>&nbsp;<span class="ident" id="2422739">hashStr</span><span class="op" id="2422746">(</span><span class="ident" id="2422747">sep</span><span class="op" id="2422750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422753">var</span>&nbsp;<span class="ident" id="2422757">h</span>&nbsp;<span class="builtintype" id="2422759">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422767">for</span>&nbsp;<span class="ident" id="2422771">i</span>&nbsp;<span class="op" id="2422773">:=</span>&nbsp;<span class="num" id="2422776">0</span><span class="op" id="2422777">;</span>&nbsp;<span class="ident" id="2422779">i</span>&nbsp;<span class="op" id="2422781">&lt;</span>&nbsp;<span class="ident" id="2422783">n</span><span class="op" id="2422784">;</span>&nbsp;<span class="ident" id="2422786">i</span><span class="op" id="2422787">++</span>&nbsp;<span class="op" id="2422790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2422794">h</span>&nbsp;<span class="op" id="2422796">=</span>&nbsp;<span class="ident" id="2422798">h</span><span class="op" id="2422799">*</span><span class="ident" id="2422800">primeRK</span>&nbsp;<span class="op" id="2422808">+</span>&nbsp;<span class="builtintype" id="2422810">uint32</span><span class="op" id="2422816">(</span><span class="ident" id="2422817">s</span><span class="op" id="2422818">[</span><span class="ident" id="2422819">i</span><span class="op" id="2422820">]</span><span class="op" id="2422821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2422824">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422827">if</span>&nbsp;<span class="ident" id="2422830">h</span>&nbsp;<span class="op" id="2422832">==</span>&nbsp;<span class="ident" id="2422835">hashsep</span>&nbsp;<span class="op" id="2422843">&amp;&amp;</span>&nbsp;<span class="ident" id="2422846">s</span><span class="op" id="2422847">[</span><span class="op" id="2422848">:</span><span class="ident" id="2422849">n</span><span class="op" id="2422850">]</span>&nbsp;<span class="op" id="2422852">==</span>&nbsp;<span class="ident" id="2422855">sep</span>&nbsp;<span class="op" id="2422859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422863">return</span>&nbsp;<span class="num" id="2422870">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2422873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422876">for</span>&nbsp;<span class="ident" id="2422880">i</span>&nbsp;<span class="op" id="2422882">:=</span>&nbsp;<span class="ident" id="2422885">n</span><span class="op" id="2422886">;</span>&nbsp;<span class="ident" id="2422888">i</span>&nbsp;<span class="op" id="2422890">&lt;</span>&nbsp;<span class="builtinfunc" id="2422892">len</span><span class="op" id="2422895">(</span><span class="ident" id="2422896">s</span><span class="op" id="2422897">)</span><span class="op" id="2422898">;</span>&nbsp;<span class="op" id="2422900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2422904">h</span>&nbsp;<span class="op" id="2422906">*=</span>&nbsp;<span class="ident" id="2422909">primeRK</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2422919">h</span>&nbsp;<span class="op" id="2422921">+=</span>&nbsp;<span class="builtintype" id="2422924">uint32</span><span class="op" id="2422930">(</span><span class="ident" id="2422931">s</span><span class="op" id="2422932">[</span><span class="ident" id="2422933">i</span><span class="op" id="2422934">]</span><span class="op" id="2422935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2422939">h</span>&nbsp;<span class="op" id="2422941">-=</span>&nbsp;<span class="ident" id="2422944">pow</span>&nbsp;<span class="op" id="2422948">*</span>&nbsp;<span class="builtintype" id="2422950">uint32</span><span class="op" id="2422956">(</span><span class="ident" id="2422957">s</span><span class="op" id="2422958">[</span><span class="ident" id="2422959">i</span><span class="op" id="2422960">-</span><span class="ident" id="2422961">n</span><span class="op" id="2422962">]</span><span class="op" id="2422963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2422967">i</span><span class="op" id="2422968">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2422973">if</span>&nbsp;<span class="ident" id="2422976">h</span>&nbsp;<span class="op" id="2422978">==</span>&nbsp;<span class="ident" id="2422981">hashsep</span>&nbsp;<span class="op" id="2422989">&amp;&amp;</span>&nbsp;<span class="ident" id="2422992">s</span><span class="op" id="2422993">[</span><span class="ident" id="2422994">i</span><span class="op" id="2422995">-</span><span class="ident" id="2422996">n</span><span class="op" id="2422997">:</span><span class="ident" id="2422998">i</span><span class="op" id="2422999">]</span>&nbsp;<span class="op" id="2423001">==</span>&nbsp;<span class="ident" id="2423004">sep</span>&nbsp;<span class="op" id="2423008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423013">return</span>&nbsp;<span class="ident" id="2423020">i</span>&nbsp;<span class="op" id="2423022">-</span>&nbsp;<span class="ident" id="2423024">n</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2423028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2423031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423034">return</span>&nbsp;<span class="op" id="2423041">-</span><span class="num" id="2423042">1</span><br>
<span class="lineno"></span><span class="op" id="2423044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2423047">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2423146">func</span>&nbsp;<span class="ident" id="2423151">LastIndex</span><span class="op" id="2423160">(</span><span class="ident" id="2423161">s</span><span class="op" id="2423162">,</span>&nbsp;<span class="ident" id="2423164">sep</span>&nbsp;<span class="builtintype" id="2423168">string</span><span class="op" id="2423174">)</span>&nbsp;<span class="builtintype" id="2423176">int</span>&nbsp;<span class="op" id="2423180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2423183">n</span>&nbsp;<span class="op" id="2423185">:=</span>&nbsp;<span class="builtinfunc" id="2423188">len</span><span class="op" id="2423191">(</span><span class="ident" id="2423192">sep</span><span class="op" id="2423195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423198">switch</span>&nbsp;<span class="op" id="2423205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423208">case</span>&nbsp;<span class="ident" id="2423213">n</span>&nbsp;<span class="op" id="2423215">==</span>&nbsp;<span class="num" id="2423218">0</span><span class="op" id="2423219">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423223">return</span>&nbsp;<span class="builtinfunc" id="2423230">len</span><span class="op" id="2423233">(</span><span class="ident" id="2423234">s</span><span class="op" id="2423235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423238">case</span>&nbsp;<span class="ident" id="2423243">n</span>&nbsp;<span class="op" id="2423245">==</span>&nbsp;<span class="num" id="2423248">1</span><span class="op" id="2423249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2423253">//&nbsp;special&nbsp;case&nbsp;worth&nbsp;making&nbsp;fast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2423289">c</span>&nbsp;<span class="op" id="2423291">:=</span>&nbsp;<span class="ident" id="2423294">sep</span><span class="op" id="2423297">[</span><span class="num" id="2423298">0</span><span class="op" id="2423299">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423303">for</span>&nbsp;<span class="ident" id="2423307">i</span>&nbsp;<span class="op" id="2423309">:=</span>&nbsp;<span class="builtinfunc" id="2423312">len</span><span class="op" id="2423315">(</span><span class="ident" id="2423316">s</span><span class="op" id="2423317">)</span>&nbsp;<span class="op" id="2423319">-</span>&nbsp;<span class="num" id="2423321">1</span><span class="op" id="2423322">;</span>&nbsp;<span class="ident" id="2423324">i</span>&nbsp;<span class="op" id="2423326">&gt;=</span>&nbsp;<span class="num" id="2423329">0</span><span class="op" id="2423330">;</span>&nbsp;<span class="ident" id="2423332">i</span><span class="op" id="2423333">--</span>&nbsp;<span class="op" id="2423336">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423341">if</span>&nbsp;<span class="ident" id="2423344">s</span><span class="op" id="2423345">[</span><span class="ident" id="2423346">i</span><span class="op" id="2423347">]</span>&nbsp;<span class="op" id="2423349">==</span>&nbsp;<span class="ident" id="2423352">c</span>&nbsp;<span class="op" id="2423354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423360">return</span>&nbsp;<span class="ident" id="2423367">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2423372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2423376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423380">return</span>&nbsp;<span class="op" id="2423387">-</span><span class="num" id="2423388">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423391">case</span>&nbsp;<span class="ident" id="2423396">n</span>&nbsp;<span class="op" id="2423398">==</span>&nbsp;<span class="builtinfunc" id="2423401">len</span><span class="op" id="2423404">(</span><span class="ident" id="2423405">s</span><span class="op" id="2423406">)</span><span class="op" id="2423407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423411">if</span>&nbsp;<span class="ident" id="2423414">sep</span>&nbsp;<span class="op" id="2423418">==</span>&nbsp;<span class="ident" id="2423421">s</span>&nbsp;<span class="op" id="2423423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423428">return</span>&nbsp;<span class="num" id="2423435">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2423439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423443">return</span>&nbsp;<span class="op" id="2423450">-</span><span class="num" id="2423451">1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423454">case</span>&nbsp;<span class="ident" id="2423459">n</span>&nbsp;<span class="op" id="2423461">&gt;</span>&nbsp;<span class="builtinfunc" id="2423463">len</span><span class="op" id="2423466">(</span><span class="ident" id="2423467">s</span><span class="op" id="2423468">)</span><span class="op" id="2423469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423473">return</span>&nbsp;<span class="op" id="2423480">-</span><span class="num" id="2423481">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2423484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2423487">//&nbsp;Rabin-Karp&nbsp;search&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2423536">hashsep</span><span class="op" id="2423543">,</span>&nbsp;<span class="ident" id="2423545">pow</span>&nbsp;<span class="op" id="2423549">:=</span>&nbsp;<span class="ident" id="2423552">hashStrRev</span><span class="op" id="2423562">(</span><span class="ident" id="2423563">sep</span><span class="op" id="2423566">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2423569">last</span>&nbsp;<span class="op" id="2423574">:=</span>&nbsp;<span class="builtinfunc" id="2423577">len</span><span class="op" id="2423580">(</span><span class="ident" id="2423581">s</span><span class="op" id="2423582">)</span>&nbsp;<span class="op" id="2423584">-</span>&nbsp;<span class="ident" id="2423586">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423589">var</span>&nbsp;<span class="ident" id="2423593">h</span>&nbsp;<span class="builtintype" id="2423595">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423603">for</span>&nbsp;<span class="ident" id="2423607">i</span>&nbsp;<span class="op" id="2423609">:=</span>&nbsp;<span class="builtinfunc" id="2423612">len</span><span class="op" id="2423615">(</span><span class="ident" id="2423616">s</span><span class="op" id="2423617">)</span>&nbsp;<span class="op" id="2423619">-</span>&nbsp;<span class="num" id="2423621">1</span><span class="op" id="2423622">;</span>&nbsp;<span class="ident" id="2423624">i</span>&nbsp;<span class="op" id="2423626">&gt;=</span>&nbsp;<span class="ident" id="2423629">last</span><span class="op" id="2423633">;</span>&nbsp;<span class="ident" id="2423635">i</span><span class="op" id="2423636">--</span>&nbsp;<span class="op" id="2423639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2423643">h</span>&nbsp;<span class="op" id="2423645">=</span>&nbsp;<span class="ident" id="2423647">h</span><span class="op" id="2423648">*</span><span class="ident" id="2423649">primeRK</span>&nbsp;<span class="op" id="2423657">+</span>&nbsp;<span class="builtintype" id="2423659">uint32</span><span class="op" id="2423665">(</span><span class="ident" id="2423666">s</span><span class="op" id="2423667">[</span><span class="ident" id="2423668">i</span><span class="op" id="2423669">]</span><span class="op" id="2423670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2423673">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423676">if</span>&nbsp;<span class="ident" id="2423679">h</span>&nbsp;<span class="op" id="2423681">==</span>&nbsp;<span class="ident" id="2423684">hashsep</span>&nbsp;<span class="op" id="2423692">&amp;&amp;</span>&nbsp;<span class="ident" id="2423695">s</span><span class="op" id="2423696">[</span><span class="ident" id="2423697">last</span><span class="op" id="2423701">:</span><span class="op" id="2423702">]</span>&nbsp;<span class="op" id="2423704">==</span>&nbsp;<span class="ident" id="2423707">sep</span>&nbsp;<span class="op" id="2423711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423715">return</span>&nbsp;<span class="ident" id="2423722">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2423728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423731">for</span>&nbsp;<span class="ident" id="2423735">i</span>&nbsp;<span class="op" id="2423737">:=</span>&nbsp;<span class="ident" id="2423740">last</span>&nbsp;<span class="op" id="2423745">-</span>&nbsp;<span class="num" id="2423747">1</span><span class="op" id="2423748">;</span>&nbsp;<span class="ident" id="2423750">i</span>&nbsp;<span class="op" id="2423752">&gt;=</span>&nbsp;<span class="num" id="2423755">0</span><span class="op" id="2423756">;</span>&nbsp;<span class="ident" id="2423758">i</span><span class="op" id="2423759">--</span>&nbsp;<span class="op" id="2423762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2423766">h</span>&nbsp;<span class="op" id="2423768">*=</span>&nbsp;<span class="ident" id="2423771">primeRK</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2423781">h</span>&nbsp;<span class="op" id="2423783">+=</span>&nbsp;<span class="builtintype" id="2423786">uint32</span><span class="op" id="2423792">(</span><span class="ident" id="2423793">s</span><span class="op" id="2423794">[</span><span class="ident" id="2423795">i</span><span class="op" id="2423796">]</span><span class="op" id="2423797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2423801">h</span>&nbsp;<span class="op" id="2423803">-=</span>&nbsp;<span class="ident" id="2423806">pow</span>&nbsp;<span class="op" id="2423810">*</span>&nbsp;<span class="builtintype" id="2423812">uint32</span><span class="op" id="2423818">(</span><span class="ident" id="2423819">s</span><span class="op" id="2423820">[</span><span class="ident" id="2423821">i</span><span class="op" id="2423822">+</span><span class="ident" id="2423823">n</span><span class="op" id="2423824">]</span><span class="op" id="2423825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423829">if</span>&nbsp;<span class="ident" id="2423832">h</span>&nbsp;<span class="op" id="2423834">==</span>&nbsp;<span class="ident" id="2423837">hashsep</span>&nbsp;<span class="op" id="2423845">&amp;&amp;</span>&nbsp;<span class="ident" id="2423848">s</span><span class="op" id="2423849">[</span><span class="ident" id="2423850">i</span><span class="op" id="2423851">:</span><span class="ident" id="2423852">i</span><span class="op" id="2423853">+</span><span class="ident" id="2423854">n</span><span class="op" id="2423855">]</span>&nbsp;<span class="op" id="2423857">==</span>&nbsp;<span class="ident" id="2423860">sep</span>&nbsp;<span class="op" id="2423864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423869">return</span>&nbsp;<span class="ident" id="2423876">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2423880">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2423883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2423886">return</span>&nbsp;<span class="op" id="2423893">-</span><span class="num" id="2423894">1</span><br>
<span class="lineno"></span><span class="op" id="2423896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2423899">//&nbsp;IndexRune&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno">225</span><span class="comment" id="2423978">//&nbsp;r,&nbsp;or&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2424019">func</span>&nbsp;<span class="ident" id="2424024">IndexRune</span><span class="op" id="2424033">(</span><span class="ident" id="2424034">s</span>&nbsp;<span class="builtintype" id="2424036">string</span><span class="op" id="2424042">,</span>&nbsp;<span class="ident" id="2424044">r</span>&nbsp;<span class="builtintype" id="2424046">rune</span><span class="op" id="2424050">)</span>&nbsp;<span class="builtintype" id="2424052">int</span>&nbsp;<span class="op" id="2424056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424059">switch</span>&nbsp;<span class="op" id="2424066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424069">case</span>&nbsp;<span class="ident" id="2424074">r</span>&nbsp;<span class="op" id="2424076">&lt;</span>&nbsp;<span class="ident" id="2424078">utf8</span><span class="op" id="2424082">.</span><span class="ident" id="2424083">RuneSelf</span><span class="op" id="2424091">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424095">return</span>&nbsp;<span class="ident" id="2424102">IndexByte</span><span class="op" id="2424111">(</span><span class="ident" id="2424112">s</span><span class="op" id="2424113">,</span>&nbsp;<span class="builtintype" id="2424115">byte</span><span class="op" id="2424119">(</span><span class="ident" id="2424120">r</span><span class="op" id="2424121">)</span><span class="op" id="2424122">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424125">default</span><span class="op" id="2424132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424136">for</span>&nbsp;<span class="ident" id="2424140">i</span><span class="op" id="2424141">,</span>&nbsp;<span class="ident" id="2424143">c</span>&nbsp;<span class="op" id="2424145">:=</span>&nbsp;<span class="keyword" id="2424148">range</span>&nbsp;<span class="ident" id="2424154">s</span>&nbsp;<span class="op" id="2424156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424161">if</span>&nbsp;<span class="ident" id="2424164">c</span>&nbsp;<span class="op" id="2424166">==</span>&nbsp;<span class="ident" id="2424169">r</span>&nbsp;<span class="op" id="2424171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424177">return</span>&nbsp;<span class="ident" id="2424184">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2424189">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2424193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2424196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424199">return</span>&nbsp;<span class="op" id="2424206">-</span><span class="num" id="2424207">1</span><br>
<span class="lineno"></span><span class="op" id="2424209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="2424212">//&nbsp;IndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="2424290">//&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2424369">func</span>&nbsp;<span class="ident" id="2424374">IndexAny</span><span class="op" id="2424382">(</span><span class="ident" id="2424383">s</span><span class="op" id="2424384">,</span>&nbsp;<span class="ident" id="2424386">chars</span>&nbsp;<span class="builtintype" id="2424392">string</span><span class="op" id="2424398">)</span>&nbsp;<span class="builtintype" id="2424400">int</span>&nbsp;<span class="op" id="2424404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424407">if</span>&nbsp;<span class="builtinfunc" id="2424410">len</span><span class="op" id="2424413">(</span><span class="ident" id="2424414">chars</span><span class="op" id="2424419">)</span>&nbsp;<span class="op" id="2424421">&gt;</span>&nbsp;<span class="num" id="2424423">0</span>&nbsp;<span class="op" id="2424425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424429">for</span>&nbsp;<span class="ident" id="2424433">i</span><span class="op" id="2424434">,</span>&nbsp;<span class="ident" id="2424436">c</span>&nbsp;<span class="op" id="2424438">:=</span>&nbsp;<span class="keyword" id="2424441">range</span>&nbsp;<span class="ident" id="2424447">s</span>&nbsp;<span class="op" id="2424449">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424454">for</span>&nbsp;<span class="ident" id="2424458">_</span><span class="op" id="2424459">,</span>&nbsp;<span class="ident" id="2424461">m</span>&nbsp;<span class="op" id="2424463">:=</span>&nbsp;<span class="keyword" id="2424466">range</span>&nbsp;<span class="ident" id="2424472">chars</span>&nbsp;<span class="op" id="2424478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424484">if</span>&nbsp;<span class="ident" id="2424487">c</span>&nbsp;<span class="op" id="2424489">==</span>&nbsp;<span class="ident" id="2424492">m</span>&nbsp;<span class="op" id="2424494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424501">return</span>&nbsp;<span class="ident" id="2424508">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2424514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2424519">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2424523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2424526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424529">return</span>&nbsp;<span class="op" id="2424536">-</span><span class="num" id="2424537">1</span><br>
<span class="lineno"></span><span class="op" id="2424539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="2424542">//&nbsp;LastIndexAny&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;any&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="2424617">//&nbsp;point&nbsp;from&nbsp;chars&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;no&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;chars&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2424688">//&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2424705">func</span>&nbsp;<span class="ident" id="2424710">LastIndexAny</span><span class="op" id="2424722">(</span><span class="ident" id="2424723">s</span><span class="op" id="2424724">,</span>&nbsp;<span class="ident" id="2424726">chars</span>&nbsp;<span class="builtintype" id="2424732">string</span><span class="op" id="2424738">)</span>&nbsp;<span class="builtintype" id="2424740">int</span>&nbsp;<span class="op" id="2424744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424747">if</span>&nbsp;<span class="builtinfunc" id="2424750">len</span><span class="op" id="2424753">(</span><span class="ident" id="2424754">chars</span><span class="op" id="2424759">)</span>&nbsp;<span class="op" id="2424761">&gt;</span>&nbsp;<span class="num" id="2424763">0</span>&nbsp;<span class="op" id="2424765">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424769">for</span>&nbsp;<span class="ident" id="2424773">i</span>&nbsp;<span class="op" id="2424775">:=</span>&nbsp;<span class="builtinfunc" id="2424778">len</span><span class="op" id="2424781">(</span><span class="ident" id="2424782">s</span><span class="op" id="2424783">)</span><span class="op" id="2424784">;</span>&nbsp;<span class="ident" id="2424786">i</span>&nbsp;<span class="op" id="2424788">&gt;</span>&nbsp;<span class="num" id="2424790">0</span><span class="op" id="2424791">;</span>&nbsp;<span class="op" id="2424793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2424798">rune</span><span class="op" id="2424802">,</span>&nbsp;<span class="ident" id="2424804">size</span>&nbsp;<span class="op" id="2424809">:=</span>&nbsp;<span class="ident" id="2424812">utf8</span><span class="op" id="2424816">.</span><span class="ident" id="2424817">DecodeLastRuneInString</span><span class="op" id="2424839">(</span><span class="ident" id="2424840">s</span><span class="op" id="2424841">[</span><span class="num" id="2424842">0</span><span class="op" id="2424843">:</span><span class="ident" id="2424844">i</span><span class="op" id="2424845">]</span><span class="op" id="2424846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2424851">i</span>&nbsp;<span class="op" id="2424853">-=</span>&nbsp;<span class="ident" id="2424856">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424864">for</span>&nbsp;<span class="ident" id="2424868">_</span><span class="op" id="2424869">,</span>&nbsp;<span class="ident" id="2424871">m</span>&nbsp;<span class="op" id="2424873">:=</span>&nbsp;<span class="keyword" id="2424876">range</span>&nbsp;<span class="ident" id="2424882">chars</span>&nbsp;<span class="op" id="2424888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424894">if</span>&nbsp;<span class="builtintype" id="2424897">rune</span>&nbsp;<span class="op" id="2424902">==</span>&nbsp;<span class="ident" id="2424905">m</span>&nbsp;<span class="op" id="2424907">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424914">return</span>&nbsp;<span class="ident" id="2424921">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2424927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2424932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2424936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2424939">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2424942">return</span>&nbsp;<span class="op" id="2424949">-</span><span class="num" id="2424950">1</span><br>
<span class="lineno"></span><span class="op" id="2424952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2424955">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="2425008">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subarrays.</span><br>
<span class="lineno">275</span><span class="keyword" id="2425060">func</span>&nbsp;<span class="ident" id="2425065">genSplit</span><span class="op" id="2425073">(</span><span class="ident" id="2425074">s</span><span class="op" id="2425075">,</span>&nbsp;<span class="ident" id="2425077">sep</span>&nbsp;<span class="builtintype" id="2425081">string</span><span class="op" id="2425087">,</span>&nbsp;<span class="ident" id="2425089">sepSave</span><span class="op" id="2425096">,</span>&nbsp;<span class="ident" id="2425098">n</span>&nbsp;<span class="builtintype" id="2425100">int</span><span class="op" id="2425103">)</span>&nbsp;<span class="op" id="2425105">[</span><span class="op" id="2425106">]</span><span class="builtintype" id="2425107">string</span>&nbsp;<span class="op" id="2425114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2425117">if</span>&nbsp;<span class="ident" id="2425120">n</span>&nbsp;<span class="op" id="2425122">==</span>&nbsp;<span class="num" id="2425125">0</span>&nbsp;<span class="op" id="2425127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2425131">return</span>&nbsp;<span class="ident" id="2425138">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2425143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2425146">if</span>&nbsp;<span class="ident" id="2425149">sep</span>&nbsp;<span class="op" id="2425153">==</span>&nbsp;<span class="string" id="2425156">&#34;&#34;</span>&nbsp;<span class="op" id="2425159">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2425163">return</span>&nbsp;<span class="ident" id="2425170">explode</span><span class="op" id="2425177">(</span><span class="ident" id="2425178">s</span><span class="op" id="2425179">,</span>&nbsp;<span class="ident" id="2425181">n</span><span class="op" id="2425182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2425185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2425188">if</span>&nbsp;<span class="ident" id="2425191">n</span>&nbsp;<span class="op" id="2425193">&lt;</span>&nbsp;<span class="num" id="2425195">0</span>&nbsp;<span class="op" id="2425197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2425201">n</span>&nbsp;<span class="op" id="2425203">=</span>&nbsp;<span class="ident" id="2425205">Count</span><span class="op" id="2425210">(</span><span class="ident" id="2425211">s</span><span class="op" id="2425212">,</span>&nbsp;<span class="ident" id="2425214">sep</span><span class="op" id="2425217">)</span>&nbsp;<span class="op" id="2425219">+</span>&nbsp;<span class="num" id="2425221">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2425224">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2425227">c</span>&nbsp;<span class="op" id="2425229">:=</span>&nbsp;<span class="ident" id="2425232">sep</span><span class="op" id="2425235">[</span><span class="num" id="2425236">0</span><span class="op" id="2425237">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2425240">start</span>&nbsp;<span class="op" id="2425246">:=</span>&nbsp;<span class="num" id="2425249">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2425252">a</span>&nbsp;<span class="op" id="2425254">:=</span>&nbsp;<span class="builtinfunc" id="2425257">make</span><span class="op" id="2425261">(</span><span class="op" id="2425262">[</span><span class="op" id="2425263">]</span><span class="builtintype" id="2425264">string</span><span class="op" id="2425270">,</span>&nbsp;<span class="ident" id="2425272">n</span><span class="op" id="2425273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2425276">na</span>&nbsp;<span class="op" id="2425279">:=</span>&nbsp;<span class="num" id="2425282">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2425285">for</span>&nbsp;<span class="ident" id="2425289">i</span>&nbsp;<span class="op" id="2425291">:=</span>&nbsp;<span class="num" id="2425294">0</span><span class="op" id="2425295">;</span>&nbsp;<span class="ident" id="2425297">i</span><span class="op" id="2425298">+</span><span class="builtinfunc" id="2425299">len</span><span class="op" id="2425302">(</span><span class="ident" id="2425303">sep</span><span class="op" id="2425306">)</span>&nbsp;<span class="op" id="2425308">&lt;=</span>&nbsp;<span class="builtinfunc" id="2425311">len</span><span class="op" id="2425314">(</span><span class="ident" id="2425315">s</span><span class="op" id="2425316">)</span>&nbsp;<span class="op" id="2425318">&amp;&amp;</span>&nbsp;<span class="ident" id="2425321">na</span><span class="op" id="2425323">+</span><span class="num" id="2425324">1</span>&nbsp;<span class="op" id="2425326">&lt;</span>&nbsp;<span class="ident" id="2425328">n</span><span class="op" id="2425329">;</span>&nbsp;<span class="ident" id="2425331">i</span><span class="op" id="2425332">++</span>&nbsp;<span class="op" id="2425335">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2425339">if</span>&nbsp;<span class="ident" id="2425342">s</span><span class="op" id="2425343">[</span><span class="ident" id="2425344">i</span><span class="op" id="2425345">]</span>&nbsp;<span class="op" id="2425347">==</span>&nbsp;<span class="ident" id="2425350">c</span>&nbsp;<span class="op" id="2425352">&amp;&amp;</span>&nbsp;<span class="op" id="2425355">(</span><span class="builtinfunc" id="2425356">len</span><span class="op" id="2425359">(</span><span class="ident" id="2425360">sep</span><span class="op" id="2425363">)</span>&nbsp;<span class="op" id="2425365">==</span>&nbsp;<span class="num" id="2425368">1</span>&nbsp;<span class="op" id="2425370">||</span>&nbsp;<span class="ident" id="2425373">s</span><span class="op" id="2425374">[</span><span class="ident" id="2425375">i</span><span class="op" id="2425376">:</span><span class="ident" id="2425377">i</span><span class="op" id="2425378">+</span><span class="builtinfunc" id="2425379">len</span><span class="op" id="2425382">(</span><span class="ident" id="2425383">sep</span><span class="op" id="2425386">)</span><span class="op" id="2425387">]</span>&nbsp;<span class="op" id="2425389">==</span>&nbsp;<span class="ident" id="2425392">sep</span><span class="op" id="2425395">)</span>&nbsp;<span class="op" id="2425397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2425402">a</span><span class="op" id="2425403">[</span><span class="ident" id="2425404">na</span><span class="op" id="2425406">]</span>&nbsp;<span class="op" id="2425408">=</span>&nbsp;<span class="ident" id="2425410">s</span><span class="op" id="2425411">[</span><span class="ident" id="2425412">start</span>&nbsp;<span class="op" id="2425418">:</span>&nbsp;<span class="ident" id="2425420">i</span><span class="op" id="2425421">+</span><span class="ident" id="2425422">sepSave</span><span class="op" id="2425429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2425434">na</span><span class="op" id="2425436">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2425442">start</span>&nbsp;<span class="op" id="2425448">=</span>&nbsp;<span class="ident" id="2425450">i</span>&nbsp;<span class="op" id="2425452">+</span>&nbsp;<span class="builtinfunc" id="2425454">len</span><span class="op" id="2425457">(</span><span class="ident" id="2425458">sep</span><span class="op" id="2425461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2425466">i</span>&nbsp;<span class="op" id="2425468">+=</span>&nbsp;<span class="builtinfunc" id="2425471">len</span><span class="op" id="2425474">(</span><span class="ident" id="2425475">sep</span><span class="op" id="2425478">)</span>&nbsp;<span class="op" id="2425480">-</span>&nbsp;<span class="num" id="2425482">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2425486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2425489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2425492">a</span><span class="op" id="2425493">[</span><span class="ident" id="2425494">na</span><span class="op" id="2425496">]</span>&nbsp;<span class="op" id="2425498">=</span>&nbsp;<span class="ident" id="2425500">s</span><span class="op" id="2425501">[</span><span class="ident" id="2425502">start</span><span class="op" id="2425507">:</span><span class="op" id="2425508">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2425511">return</span>&nbsp;<span class="ident" id="2425518">a</span><span class="op" id="2425519">[</span><span class="num" id="2425520">0</span>&nbsp;<span class="op" id="2425522">:</span>&nbsp;<span class="ident" id="2425524">na</span><span class="op" id="2425526">+</span><span class="num" id="2425527">1</span><span class="op" id="2425528">]</span><br>
<span class="lineno"></span><span class="op" id="2425530">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="2425533">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2425608">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2425652">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2425713">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">305</span><span class="comment" id="2425773">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="2425857">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2425906">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2425933">func</span>&nbsp;<span class="ident" id="2425938">SplitN</span><span class="op" id="2425944">(</span><span class="ident" id="2425945">s</span><span class="op" id="2425946">,</span>&nbsp;<span class="ident" id="2425948">sep</span>&nbsp;<span class="builtintype" id="2425952">string</span><span class="op" id="2425958">,</span>&nbsp;<span class="ident" id="2425960">n</span>&nbsp;<span class="builtintype" id="2425962">int</span><span class="op" id="2425965">)</span>&nbsp;<span class="op" id="2425967">[</span><span class="op" id="2425968">]</span><span class="builtintype" id="2425969">string</span>&nbsp;<span class="op" id="2425976">{</span>&nbsp;<span class="keyword" id="2425978">return</span>&nbsp;<span class="ident" id="2425985">genSplit</span><span class="op" id="2425993">(</span><span class="ident" id="2425994">s</span><span class="op" id="2425995">,</span>&nbsp;<span class="ident" id="2425997">sep</span><span class="op" id="2426000">,</span>&nbsp;<span class="num" id="2426002">0</span><span class="op" id="2426003">,</span>&nbsp;<span class="ident" id="2426005">n</span><span class="op" id="2426006">)</span>&nbsp;<span class="op" id="2426008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="2426011">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2426082">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2426122">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2426188">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="2426248">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">315</span><span class="comment" id="2426332">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="2426381">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="2426408">func</span>&nbsp;<span class="ident" id="2426413">SplitAfterN</span><span class="op" id="2426424">(</span><span class="ident" id="2426425">s</span><span class="op" id="2426426">,</span>&nbsp;<span class="ident" id="2426428">sep</span>&nbsp;<span class="builtintype" id="2426432">string</span><span class="op" id="2426438">,</span>&nbsp;<span class="ident" id="2426440">n</span>&nbsp;<span class="builtintype" id="2426442">int</span><span class="op" id="2426445">)</span>&nbsp;<span class="op" id="2426447">[</span><span class="op" id="2426448">]</span><span class="builtintype" id="2426449">string</span>&nbsp;<span class="op" id="2426456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2426459">return</span>&nbsp;<span class="ident" id="2426466">genSplit</span><span class="op" id="2426474">(</span><span class="ident" id="2426475">s</span><span class="op" id="2426476">,</span>&nbsp;<span class="ident" id="2426478">sep</span><span class="op" id="2426481">,</span>&nbsp;<span class="builtinfunc" id="2426483">len</span><span class="op" id="2426486">(</span><span class="ident" id="2426487">sep</span><span class="op" id="2426490">)</span><span class="op" id="2426491">,</span>&nbsp;<span class="ident" id="2426493">n</span><span class="op" id="2426494">)</span><br>
<span class="lineno"></span><span class="op" id="2426496">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2426499">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2426577">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2426621">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2426681">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">325</span><span class="keyword" id="2426731">func</span>&nbsp;<span class="ident" id="2426736">Split</span><span class="op" id="2426741">(</span><span class="ident" id="2426742">s</span><span class="op" id="2426743">,</span>&nbsp;<span class="ident" id="2426745">sep</span>&nbsp;<span class="builtintype" id="2426749">string</span><span class="op" id="2426755">)</span>&nbsp;<span class="op" id="2426757">[</span><span class="op" id="2426758">]</span><span class="builtintype" id="2426759">string</span>&nbsp;<span class="op" id="2426766">{</span>&nbsp;<span class="keyword" id="2426768">return</span>&nbsp;<span class="ident" id="2426775">genSplit</span><span class="op" id="2426783">(</span><span class="ident" id="2426784">s</span><span class="op" id="2426785">,</span>&nbsp;<span class="ident" id="2426787">sep</span><span class="op" id="2426790">,</span>&nbsp;<span class="num" id="2426792">0</span><span class="op" id="2426793">,</span>&nbsp;<span class="op" id="2426795">-</span><span class="num" id="2426796">1</span><span class="op" id="2426797">)</span>&nbsp;<span class="op" id="2426799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2426802">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;substrings&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2426876">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;substrings.</span><br>
<span class="lineno"></span><span class="comment" id="2426916">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">330</span><span class="comment" id="2426981">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2427036">func</span>&nbsp;<span class="ident" id="2427041">SplitAfter</span><span class="op" id="2427051">(</span><span class="ident" id="2427052">s</span><span class="op" id="2427053">,</span>&nbsp;<span class="ident" id="2427055">sep</span>&nbsp;<span class="builtintype" id="2427059">string</span><span class="op" id="2427065">)</span>&nbsp;<span class="op" id="2427067">[</span><span class="op" id="2427068">]</span><span class="builtintype" id="2427069">string</span>&nbsp;<span class="op" id="2427076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2427079">return</span>&nbsp;<span class="ident" id="2427086">genSplit</span><span class="op" id="2427094">(</span><span class="ident" id="2427095">s</span><span class="op" id="2427096">,</span>&nbsp;<span class="ident" id="2427098">sep</span><span class="op" id="2427101">,</span>&nbsp;<span class="builtinfunc" id="2427103">len</span><span class="op" id="2427106">(</span><span class="ident" id="2427107">sep</span><span class="op" id="2427110">)</span><span class="op" id="2427111">,</span>&nbsp;<span class="op" id="2427113">-</span><span class="num" id="2427114">1</span><span class="op" id="2427115">)</span><br>
<span class="lineno"></span><span class="op" id="2427117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="2427120">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2427210">//&nbsp;characters,&nbsp;as&nbsp;defined&nbsp;by&nbsp;unicode.IsSpace,&nbsp;returning&nbsp;an&nbsp;array&nbsp;of&nbsp;substrings&nbsp;of&nbsp;s&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2427300">//&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2427346">func</span>&nbsp;<span class="ident" id="2427351">Fields</span><span class="op" id="2427357">(</span><span class="ident" id="2427358">s</span>&nbsp;<span class="builtintype" id="2427360">string</span><span class="op" id="2427366">)</span>&nbsp;<span class="op" id="2427368">[</span><span class="op" id="2427369">]</span><span class="builtintype" id="2427370">string</span>&nbsp;<span class="op" id="2427377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2427380">return</span>&nbsp;<span class="ident" id="2427387">FieldsFunc</span><span class="op" id="2427397">(</span><span class="ident" id="2427398">s</span><span class="op" id="2427399">,</span>&nbsp;<span class="ident" id="2427401">unicode</span><span class="op" id="2427408">.</span><span class="ident" id="2427409">IsSpace</span><span class="op" id="2427416">)</span><br>
<span class="lineno">340</span><span class="op" id="2427418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2427421">//&nbsp;FieldsFunc&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)</span><br>
<span class="lineno"></span><span class="comment" id="2427508">//&nbsp;and&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;slices&nbsp;of&nbsp;s.&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c)&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2427592">//&nbsp;string&nbsp;is&nbsp;empty,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">345</span><span class="comment" id="2427640">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="2427714">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="2427794">func</span>&nbsp;<span class="ident" id="2427799">FieldsFunc</span><span class="op" id="2427809">(</span><span class="ident" id="2427810">s</span>&nbsp;<span class="builtintype" id="2427812">string</span><span class="op" id="2427818">,</span>&nbsp;<span class="ident" id="2427820">f</span>&nbsp;<span class="keyword" id="2427822">func</span><span class="op" id="2427826">(</span><span class="builtintype" id="2427827">rune</span><span class="op" id="2427831">)</span>&nbsp;<span class="builtintype" id="2427833">bool</span><span class="op" id="2427837">)</span>&nbsp;<span class="op" id="2427839">[</span><span class="op" id="2427840">]</span><span class="builtintype" id="2427841">string</span>&nbsp;<span class="op" id="2427848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2427851">//&nbsp;First&nbsp;count&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427879">n</span>&nbsp;<span class="op" id="2427881">:=</span>&nbsp;<span class="num" id="2427884">0</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427887">inField</span>&nbsp;<span class="op" id="2427895">:=</span>&nbsp;<span class="builtintype" id="2427898">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2427905">for</span>&nbsp;<span class="ident" id="2427909">_</span><span class="op" id="2427910">,</span>&nbsp;<span class="builtintype" id="2427912">rune</span>&nbsp;<span class="op" id="2427917">:=</span>&nbsp;<span class="keyword" id="2427920">range</span>&nbsp;<span class="ident" id="2427926">s</span>&nbsp;<span class="op" id="2427928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427932">wasInField</span>&nbsp;<span class="op" id="2427943">:=</span>&nbsp;<span class="ident" id="2427946">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427956">inField</span>&nbsp;<span class="op" id="2427964">=</span>&nbsp;<span class="op" id="2427966">!</span><span class="ident" id="2427967">f</span><span class="op" id="2427968">(</span><span class="builtintype" id="2427969">rune</span><span class="op" id="2427973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2427977">if</span>&nbsp;<span class="ident" id="2427980">inField</span>&nbsp;<span class="op" id="2427988">&amp;&amp;</span>&nbsp;<span class="op" id="2427991">!</span><span class="ident" id="2427992">wasInField</span>&nbsp;<span class="op" id="2428003">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428008">n</span><span class="op" id="2428009">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2428021">//&nbsp;Now&nbsp;create&nbsp;them.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428042">a</span>&nbsp;<span class="op" id="2428044">:=</span>&nbsp;<span class="builtinfunc" id="2428047">make</span><span class="op" id="2428051">(</span><span class="op" id="2428052">[</span><span class="op" id="2428053">]</span><span class="builtintype" id="2428054">string</span><span class="op" id="2428060">,</span>&nbsp;<span class="ident" id="2428062">n</span><span class="op" id="2428063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428066">na</span>&nbsp;<span class="op" id="2428069">:=</span>&nbsp;<span class="num" id="2428072">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428075">fieldStart</span>&nbsp;<span class="op" id="2428086">:=</span>&nbsp;<span class="op" id="2428089">-</span><span class="num" id="2428090">1</span>&nbsp;<span class="comment" id="2428092">//&nbsp;Set&nbsp;to&nbsp;-1&nbsp;when&nbsp;looking&nbsp;for&nbsp;start&nbsp;of&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428139">for</span>&nbsp;<span class="ident" id="2428143">i</span><span class="op" id="2428144">,</span>&nbsp;<span class="builtintype" id="2428146">rune</span>&nbsp;<span class="op" id="2428151">:=</span>&nbsp;<span class="keyword" id="2428154">range</span>&nbsp;<span class="ident" id="2428160">s</span>&nbsp;<span class="op" id="2428162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428166">if</span>&nbsp;<span class="ident" id="2428169">f</span><span class="op" id="2428170">(</span><span class="builtintype" id="2428171">rune</span><span class="op" id="2428175">)</span>&nbsp;<span class="op" id="2428177">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428182">if</span>&nbsp;<span class="ident" id="2428185">fieldStart</span>&nbsp;<span class="op" id="2428196">&gt;=</span>&nbsp;<span class="num" id="2428199">0</span>&nbsp;<span class="op" id="2428201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428207">a</span><span class="op" id="2428208">[</span><span class="ident" id="2428209">na</span><span class="op" id="2428211">]</span>&nbsp;<span class="op" id="2428213">=</span>&nbsp;<span class="ident" id="2428215">s</span><span class="op" id="2428216">[</span><span class="ident" id="2428217">fieldStart</span><span class="op" id="2428227">:</span><span class="ident" id="2428228">i</span><span class="op" id="2428229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428235">na</span><span class="op" id="2428237">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428244">fieldStart</span>&nbsp;<span class="op" id="2428255">=</span>&nbsp;<span class="op" id="2428257">-</span><span class="num" id="2428258">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428263">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428267">}</span>&nbsp;<span class="keyword" id="2428269">else</span>&nbsp;<span class="keyword" id="2428274">if</span>&nbsp;<span class="ident" id="2428277">fieldStart</span>&nbsp;<span class="op" id="2428288">==</span>&nbsp;<span class="op" id="2428291">-</span><span class="num" id="2428292">1</span>&nbsp;<span class="op" id="2428294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428299">fieldStart</span>&nbsp;<span class="op" id="2428310">=</span>&nbsp;<span class="ident" id="2428312">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428322">if</span>&nbsp;<span class="ident" id="2428325">fieldStart</span>&nbsp;<span class="op" id="2428336">&gt;=</span>&nbsp;<span class="num" id="2428339">0</span>&nbsp;<span class="op" id="2428341">{</span>&nbsp;<span class="comment" id="2428343">//&nbsp;Last&nbsp;field&nbsp;might&nbsp;end&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428377">a</span><span class="op" id="2428378">[</span><span class="ident" id="2428379">na</span><span class="op" id="2428381">]</span>&nbsp;<span class="op" id="2428383">=</span>&nbsp;<span class="ident" id="2428385">s</span><span class="op" id="2428386">[</span><span class="ident" id="2428387">fieldStart</span><span class="op" id="2428397">:</span><span class="op" id="2428398">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428404">return</span>&nbsp;<span class="ident" id="2428411">a</span><br>
<span class="lineno"></span><span class="op" id="2428413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="comment" id="2428416">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;a&nbsp;to&nbsp;create&nbsp;a&nbsp;single&nbsp;string.&nbsp;&nbsp;&nbsp;The&nbsp;separator&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2428505">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2428564">func</span>&nbsp;<span class="ident" id="2428569">Join</span><span class="op" id="2428573">(</span><span class="ident" id="2428574">a</span>&nbsp;<span class="op" id="2428576">[</span><span class="op" id="2428577">]</span><span class="builtintype" id="2428578">string</span><span class="op" id="2428584">,</span>&nbsp;<span class="ident" id="2428586">sep</span>&nbsp;<span class="builtintype" id="2428590">string</span><span class="op" id="2428596">)</span>&nbsp;<span class="builtintype" id="2428598">string</span>&nbsp;<span class="op" id="2428605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428608">if</span>&nbsp;<span class="builtinfunc" id="2428611">len</span><span class="op" id="2428614">(</span><span class="ident" id="2428615">a</span><span class="op" id="2428616">)</span>&nbsp;<span class="op" id="2428618">==</span>&nbsp;<span class="num" id="2428621">0</span>&nbsp;<span class="op" id="2428623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428627">return</span>&nbsp;<span class="string" id="2428634">&#34;&#34;</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428641">if</span>&nbsp;<span class="builtinfunc" id="2428644">len</span><span class="op" id="2428647">(</span><span class="ident" id="2428648">a</span><span class="op" id="2428649">)</span>&nbsp;<span class="op" id="2428651">==</span>&nbsp;<span class="num" id="2428654">1</span>&nbsp;<span class="op" id="2428656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428660">return</span>&nbsp;<span class="ident" id="2428667">a</span><span class="op" id="2428668">[</span><span class="num" id="2428669">0</span><span class="op" id="2428670">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428676">n</span>&nbsp;<span class="op" id="2428678">:=</span>&nbsp;<span class="builtinfunc" id="2428681">len</span><span class="op" id="2428684">(</span><span class="ident" id="2428685">sep</span><span class="op" id="2428688">)</span>&nbsp;<span class="op" id="2428690">*</span>&nbsp;<span class="op" id="2428692">(</span><span class="builtinfunc" id="2428693">len</span><span class="op" id="2428696">(</span><span class="ident" id="2428697">a</span><span class="op" id="2428698">)</span>&nbsp;<span class="op" id="2428700">-</span>&nbsp;<span class="num" id="2428702">1</span><span class="op" id="2428703">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428706">for</span>&nbsp;<span class="ident" id="2428710">i</span>&nbsp;<span class="op" id="2428712">:=</span>&nbsp;<span class="num" id="2428715">0</span><span class="op" id="2428716">;</span>&nbsp;<span class="ident" id="2428718">i</span>&nbsp;<span class="op" id="2428720">&lt;</span>&nbsp;<span class="builtinfunc" id="2428722">len</span><span class="op" id="2428725">(</span><span class="ident" id="2428726">a</span><span class="op" id="2428727">)</span><span class="op" id="2428728">;</span>&nbsp;<span class="ident" id="2428730">i</span><span class="op" id="2428731">++</span>&nbsp;<span class="op" id="2428734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428738">n</span>&nbsp;<span class="op" id="2428740">+=</span>&nbsp;<span class="builtinfunc" id="2428743">len</span><span class="op" id="2428746">(</span><span class="ident" id="2428747">a</span><span class="op" id="2428748">[</span><span class="ident" id="2428749">i</span><span class="op" id="2428750">]</span><span class="op" id="2428751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428758">b</span>&nbsp;<span class="op" id="2428760">:=</span>&nbsp;<span class="builtinfunc" id="2428763">make</span><span class="op" id="2428767">(</span><span class="op" id="2428768">[</span><span class="op" id="2428769">]</span><span class="builtintype" id="2428770">byte</span><span class="op" id="2428774">,</span>&nbsp;<span class="ident" id="2428776">n</span><span class="op" id="2428777">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428780">bp</span>&nbsp;<span class="op" id="2428783">:=</span>&nbsp;<span class="builtinfunc" id="2428786">copy</span><span class="op" id="2428790">(</span><span class="ident" id="2428791">b</span><span class="op" id="2428792">,</span>&nbsp;<span class="ident" id="2428794">a</span><span class="op" id="2428795">[</span><span class="num" id="2428796">0</span><span class="op" id="2428797">]</span><span class="op" id="2428798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428801">for</span>&nbsp;<span class="ident" id="2428805">_</span><span class="op" id="2428806">,</span>&nbsp;<span class="ident" id="2428808">s</span>&nbsp;<span class="op" id="2428810">:=</span>&nbsp;<span class="keyword" id="2428813">range</span>&nbsp;<span class="ident" id="2428819">a</span><span class="op" id="2428820">[</span><span class="num" id="2428821">1</span><span class="op" id="2428822">:</span><span class="op" id="2428823">]</span>&nbsp;<span class="op" id="2428825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428829">bp</span>&nbsp;<span class="op" id="2428832">+=</span>&nbsp;<span class="builtinfunc" id="2428835">copy</span><span class="op" id="2428839">(</span><span class="ident" id="2428840">b</span><span class="op" id="2428841">[</span><span class="ident" id="2428842">bp</span><span class="op" id="2428844">:</span><span class="op" id="2428845">]</span><span class="op" id="2428846">,</span>&nbsp;<span class="ident" id="2428848">sep</span><span class="op" id="2428851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428855">bp</span>&nbsp;<span class="op" id="2428858">+=</span>&nbsp;<span class="builtinfunc" id="2428861">copy</span><span class="op" id="2428865">(</span><span class="ident" id="2428866">b</span><span class="op" id="2428867">[</span><span class="ident" id="2428868">bp</span><span class="op" id="2428870">:</span><span class="op" id="2428871">]</span><span class="op" id="2428872">,</span>&nbsp;<span class="ident" id="2428874">s</span><span class="op" id="2428875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428878">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428881">return</span>&nbsp;<span class="builtintype" id="2428888">string</span><span class="op" id="2428894">(</span><span class="ident" id="2428895">b</span><span class="op" id="2428896">)</span><br>
<span class="lineno"></span><span class="op" id="2428898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2428901">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="2428961">func</span>&nbsp;<span class="ident" id="2428966">HasPrefix</span><span class="op" id="2428975">(</span><span class="ident" id="2428976">s</span><span class="op" id="2428977">,</span>&nbsp;<span class="ident" id="2428979">prefix</span>&nbsp;<span class="builtintype" id="2428986">string</span><span class="op" id="2428992">)</span>&nbsp;<span class="builtintype" id="2428994">bool</span>&nbsp;<span class="op" id="2428999">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429002">return</span>&nbsp;<span class="builtinfunc" id="2429009">len</span><span class="op" id="2429012">(</span><span class="ident" id="2429013">s</span><span class="op" id="2429014">)</span>&nbsp;<span class="op" id="2429016">&gt;=</span>&nbsp;<span class="builtinfunc" id="2429019">len</span><span class="op" id="2429022">(</span><span class="ident" id="2429023">prefix</span><span class="op" id="2429029">)</span>&nbsp;<span class="op" id="2429031">&amp;&amp;</span>&nbsp;<span class="ident" id="2429034">s</span><span class="op" id="2429035">[</span><span class="num" id="2429036">0</span><span class="op" id="2429037">:</span><span class="builtinfunc" id="2429038">len</span><span class="op" id="2429041">(</span><span class="ident" id="2429042">prefix</span><span class="op" id="2429048">)</span><span class="op" id="2429049">]</span>&nbsp;<span class="op" id="2429051">==</span>&nbsp;<span class="ident" id="2429054">prefix</span><br>
<span class="lineno"></span><span class="op" id="2429061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2429064">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="2429122">func</span>&nbsp;<span class="ident" id="2429127">HasSuffix</span><span class="op" id="2429136">(</span><span class="ident" id="2429137">s</span><span class="op" id="2429138">,</span>&nbsp;<span class="ident" id="2429140">suffix</span>&nbsp;<span class="builtintype" id="2429147">string</span><span class="op" id="2429153">)</span>&nbsp;<span class="builtintype" id="2429155">bool</span>&nbsp;<span class="op" id="2429160">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429163">return</span>&nbsp;<span class="builtinfunc" id="2429170">len</span><span class="op" id="2429173">(</span><span class="ident" id="2429174">s</span><span class="op" id="2429175">)</span>&nbsp;<span class="op" id="2429177">&gt;=</span>&nbsp;<span class="builtinfunc" id="2429180">len</span><span class="op" id="2429183">(</span><span class="ident" id="2429184">suffix</span><span class="op" id="2429190">)</span>&nbsp;<span class="op" id="2429192">&amp;&amp;</span>&nbsp;<span class="ident" id="2429195">s</span><span class="op" id="2429196">[</span><span class="builtinfunc" id="2429197">len</span><span class="op" id="2429200">(</span><span class="ident" id="2429201">s</span><span class="op" id="2429202">)</span><span class="op" id="2429203">-</span><span class="builtinfunc" id="2429204">len</span><span class="op" id="2429207">(</span><span class="ident" id="2429208">suffix</span><span class="op" id="2429214">)</span><span class="op" id="2429215">:</span><span class="op" id="2429216">]</span>&nbsp;<span class="op" id="2429218">==</span>&nbsp;<span class="ident" id="2429221">suffix</span><br>
<span class="lineno"></span><span class="op" id="2429228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2429231">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="2429302">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno">415</span><span class="comment" id="2429394">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.</span><br>
<span class="lineno"></span><span class="keyword" id="2429442">func</span>&nbsp;<span class="ident" id="2429447">Map</span><span class="op" id="2429450">(</span><span class="ident" id="2429451">mapping</span>&nbsp;<span class="keyword" id="2429459">func</span><span class="op" id="2429463">(</span><span class="builtintype" id="2429464">rune</span><span class="op" id="2429468">)</span>&nbsp;<span class="builtintype" id="2429470">rune</span><span class="op" id="2429474">,</span>&nbsp;<span class="ident" id="2429476">s</span>&nbsp;<span class="builtintype" id="2429478">string</span><span class="op" id="2429484">)</span>&nbsp;<span class="builtintype" id="2429486">string</span>&nbsp;<span class="op" id="2429493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2429496">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;string&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2429559">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2429626">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429688">maxbytes</span>&nbsp;<span class="op" id="2429697">:=</span>&nbsp;<span class="builtinfunc" id="2429700">len</span><span class="op" id="2429703">(</span><span class="ident" id="2429704">s</span><span class="op" id="2429705">)</span>&nbsp;<span class="comment" id="2429707">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429723">nbytes</span>&nbsp;<span class="op" id="2429730">:=</span>&nbsp;<span class="num" id="2429733">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2429742">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2429775">//&nbsp;The&nbsp;output&nbsp;buffer&nbsp;b&nbsp;is&nbsp;initialized&nbsp;on&nbsp;demand,&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2429835">//&nbsp;time&nbsp;a&nbsp;character&nbsp;differs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429865">var</span>&nbsp;<span class="ident" id="2429869">b</span>&nbsp;<span class="op" id="2429871">[</span><span class="op" id="2429872">]</span><span class="builtintype" id="2429873">byte</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429880">for</span>&nbsp;<span class="ident" id="2429884">i</span><span class="op" id="2429885">,</span>&nbsp;<span class="ident" id="2429887">c</span>&nbsp;<span class="op" id="2429889">:=</span>&nbsp;<span class="keyword" id="2429892">range</span>&nbsp;<span class="ident" id="2429898">s</span>&nbsp;<span class="op" id="2429900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429904">r</span>&nbsp;<span class="op" id="2429906">:=</span>&nbsp;<span class="ident" id="2429909">mapping</span><span class="op" id="2429916">(</span><span class="ident" id="2429917">c</span><span class="op" id="2429918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429922">if</span>&nbsp;<span class="ident" id="2429925">b</span>&nbsp;<span class="op" id="2429927">==</span>&nbsp;<span class="ident" id="2429930">nil</span>&nbsp;<span class="op" id="2429934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429939">if</span>&nbsp;<span class="ident" id="2429942">r</span>&nbsp;<span class="op" id="2429944">==</span>&nbsp;<span class="ident" id="2429947">c</span>&nbsp;<span class="op" id="2429949">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429955">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429972">b</span>&nbsp;<span class="op" id="2429974">=</span>&nbsp;<span class="builtinfunc" id="2429976">make</span><span class="op" id="2429980">(</span><span class="op" id="2429981">[</span><span class="op" id="2429982">]</span><span class="builtintype" id="2429983">byte</span><span class="op" id="2429987">,</span>&nbsp;<span class="ident" id="2429989">maxbytes</span><span class="op" id="2429997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430002">nbytes</span>&nbsp;<span class="op" id="2430009">=</span>&nbsp;<span class="builtinfunc" id="2430011">copy</span><span class="op" id="2430015">(</span><span class="ident" id="2430016">b</span><span class="op" id="2430017">,</span>&nbsp;<span class="ident" id="2430019">s</span><span class="op" id="2430020">[</span><span class="op" id="2430021">:</span><span class="ident" id="2430022">i</span><span class="op" id="2430023">]</span><span class="op" id="2430024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430028">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430032">if</span>&nbsp;<span class="ident" id="2430035">r</span>&nbsp;<span class="op" id="2430037">&gt;=</span>&nbsp;<span class="num" id="2430040">0</span>&nbsp;<span class="op" id="2430042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430047">wid</span>&nbsp;<span class="op" id="2430051">:=</span>&nbsp;<span class="num" id="2430054">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430059">if</span>&nbsp;<span class="ident" id="2430062">r</span>&nbsp;<span class="op" id="2430064">&gt;=</span>&nbsp;<span class="ident" id="2430067">utf8</span><span class="op" id="2430071">.</span><span class="ident" id="2430072">RuneSelf</span>&nbsp;<span class="op" id="2430081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430087">wid</span>&nbsp;<span class="op" id="2430091">=</span>&nbsp;<span class="ident" id="2430093">utf8</span><span class="op" id="2430097">.</span><span class="ident" id="2430098">RuneLen</span><span class="op" id="2430105">(</span><span class="ident" id="2430106">r</span><span class="op" id="2430107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430112">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430117">if</span>&nbsp;<span class="ident" id="2430120">nbytes</span><span class="op" id="2430126">+</span><span class="ident" id="2430127">wid</span>&nbsp;<span class="op" id="2430131">&gt;</span>&nbsp;<span class="ident" id="2430133">maxbytes</span>&nbsp;<span class="op" id="2430142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2430148">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430172">maxbytes</span>&nbsp;<span class="op" id="2430181">=</span>&nbsp;<span class="ident" id="2430183">maxbytes</span><span class="op" id="2430191">*</span><span class="num" id="2430192">2</span>&nbsp;<span class="op" id="2430194">+</span>&nbsp;<span class="ident" id="2430196">utf8</span><span class="op" id="2430200">.</span><span class="ident" id="2430201">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430212">nb</span>&nbsp;<span class="op" id="2430215">:=</span>&nbsp;<span class="builtinfunc" id="2430218">make</span><span class="op" id="2430222">(</span><span class="op" id="2430223">[</span><span class="op" id="2430224">]</span><span class="builtintype" id="2430225">byte</span><span class="op" id="2430229">,</span>&nbsp;<span class="ident" id="2430231">maxbytes</span><span class="op" id="2430239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2430245">copy</span><span class="op" id="2430249">(</span><span class="ident" id="2430250">nb</span><span class="op" id="2430252">,</span>&nbsp;<span class="ident" id="2430254">b</span><span class="op" id="2430255">[</span><span class="num" id="2430256">0</span><span class="op" id="2430257">:</span><span class="ident" id="2430258">nbytes</span><span class="op" id="2430264">]</span><span class="op" id="2430265">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430271">b</span>&nbsp;<span class="op" id="2430273">=</span>&nbsp;<span class="ident" id="2430275">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430286">nbytes</span>&nbsp;<span class="op" id="2430293">+=</span>&nbsp;<span class="ident" id="2430296">utf8</span><span class="op" id="2430300">.</span><span class="ident" id="2430301">EncodeRune</span><span class="op" id="2430311">(</span><span class="ident" id="2430312">b</span><span class="op" id="2430313">[</span><span class="ident" id="2430314">nbytes</span><span class="op" id="2430320">:</span><span class="ident" id="2430321">maxbytes</span><span class="op" id="2430329">]</span><span class="op" id="2430330">,</span>&nbsp;<span class="ident" id="2430332">r</span><span class="op" id="2430333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430340">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430343">if</span>&nbsp;<span class="ident" id="2430346">b</span>&nbsp;<span class="op" id="2430348">==</span>&nbsp;<span class="ident" id="2430351">nil</span>&nbsp;<span class="op" id="2430355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430359">return</span>&nbsp;<span class="ident" id="2430366">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430372">return</span>&nbsp;<span class="builtintype" id="2430379">string</span><span class="op" id="2430385">(</span><span class="ident" id="2430386">b</span><span class="op" id="2430387">[</span><span class="num" id="2430388">0</span><span class="op" id="2430389">:</span><span class="ident" id="2430390">nbytes</span><span class="op" id="2430396">]</span><span class="op" id="2430397">)</span><br>
<span class="lineno"></span><span class="op" id="2430399">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="2430402">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;string&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2430477">func</span>&nbsp;<span class="ident" id="2430482">Repeat</span><span class="op" id="2430488">(</span><span class="ident" id="2430489">s</span>&nbsp;<span class="builtintype" id="2430491">string</span><span class="op" id="2430497">,</span>&nbsp;<span class="ident" id="2430499">count</span>&nbsp;<span class="builtintype" id="2430505">int</span><span class="op" id="2430508">)</span>&nbsp;<span class="builtintype" id="2430510">string</span>&nbsp;<span class="op" id="2430517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430520">b</span>&nbsp;<span class="op" id="2430522">:=</span>&nbsp;<span class="builtinfunc" id="2430525">make</span><span class="op" id="2430529">(</span><span class="op" id="2430530">[</span><span class="op" id="2430531">]</span><span class="builtintype" id="2430532">byte</span><span class="op" id="2430536">,</span>&nbsp;<span class="builtinfunc" id="2430538">len</span><span class="op" id="2430541">(</span><span class="ident" id="2430542">s</span><span class="op" id="2430543">)</span><span class="op" id="2430544">*</span><span class="ident" id="2430545">count</span><span class="op" id="2430550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430553">bp</span>&nbsp;<span class="op" id="2430556">:=</span>&nbsp;<span class="builtinfunc" id="2430559">copy</span><span class="op" id="2430563">(</span><span class="ident" id="2430564">b</span><span class="op" id="2430565">,</span>&nbsp;<span class="ident" id="2430567">s</span><span class="op" id="2430568">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430571">for</span>&nbsp;<span class="ident" id="2430575">bp</span>&nbsp;<span class="op" id="2430578">&lt;</span>&nbsp;<span class="builtinfunc" id="2430580">len</span><span class="op" id="2430583">(</span><span class="ident" id="2430584">b</span><span class="op" id="2430585">)</span>&nbsp;<span class="op" id="2430587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2430591">copy</span><span class="op" id="2430595">(</span><span class="ident" id="2430596">b</span><span class="op" id="2430597">[</span><span class="ident" id="2430598">bp</span><span class="op" id="2430600">:</span><span class="op" id="2430601">]</span><span class="op" id="2430602">,</span>&nbsp;<span class="ident" id="2430604">b</span><span class="op" id="2430605">[</span><span class="op" id="2430606">:</span><span class="ident" id="2430607">bp</span><span class="op" id="2430609">]</span><span class="op" id="2430610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430614">bp</span>&nbsp;<span class="op" id="2430617">*=</span>&nbsp;<span class="num" id="2430620">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430626">return</span>&nbsp;<span class="builtintype" id="2430633">string</span><span class="op" id="2430639">(</span><span class="ident" id="2430640">b</span><span class="op" id="2430641">)</span><br>
<span class="lineno">465</span><span class="op" id="2430643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2430646">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2430741">func</span>&nbsp;<span class="ident" id="2430746">ToUpper</span><span class="op" id="2430753">(</span><span class="ident" id="2430754">s</span>&nbsp;<span class="builtintype" id="2430756">string</span><span class="op" id="2430762">)</span>&nbsp;<span class="builtintype" id="2430764">string</span>&nbsp;<span class="op" id="2430771">{</span>&nbsp;<span class="keyword" id="2430773">return</span>&nbsp;<span class="ident" id="2430780">Map</span><span class="op" id="2430783">(</span><span class="ident" id="2430784">unicode</span><span class="op" id="2430791">.</span><span class="ident" id="2430792">ToUpper</span><span class="op" id="2430799">,</span>&nbsp;<span class="ident" id="2430801">s</span><span class="op" id="2430802">)</span>&nbsp;<span class="op" id="2430804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="2430807">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2430902">func</span>&nbsp;<span class="ident" id="2430907">ToLower</span><span class="op" id="2430914">(</span><span class="ident" id="2430915">s</span>&nbsp;<span class="builtintype" id="2430917">string</span><span class="op" id="2430923">)</span>&nbsp;<span class="builtintype" id="2430925">string</span>&nbsp;<span class="op" id="2430932">{</span>&nbsp;<span class="keyword" id="2430934">return</span>&nbsp;<span class="ident" id="2430941">Map</span><span class="op" id="2430944">(</span><span class="ident" id="2430945">unicode</span><span class="op" id="2430952">.</span><span class="ident" id="2430953">ToLower</span><span class="op" id="2430960">,</span>&nbsp;<span class="ident" id="2430962">s</span><span class="op" id="2430963">)</span>&nbsp;<span class="op" id="2430965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2430968">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2431063">func</span>&nbsp;<span class="ident" id="2431068">ToTitle</span><span class="op" id="2431075">(</span><span class="ident" id="2431076">s</span>&nbsp;<span class="builtintype" id="2431078">string</span><span class="op" id="2431084">)</span>&nbsp;<span class="builtintype" id="2431086">string</span>&nbsp;<span class="op" id="2431093">{</span>&nbsp;<span class="keyword" id="2431095">return</span>&nbsp;<span class="ident" id="2431102">Map</span><span class="op" id="2431105">(</span><span class="ident" id="2431106">unicode</span><span class="op" id="2431113">.</span><span class="ident" id="2431114">ToTitle</span><span class="op" id="2431121">,</span>&nbsp;<span class="ident" id="2431123">s</span><span class="op" id="2431124">)</span>&nbsp;<span class="op" id="2431126">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="2431129">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2431219">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2431279">func</span>&nbsp;<span class="ident" id="2431284">ToUpperSpecial</span><span class="op" id="2431298">(</span><span class="ident" id="2431299">_case</span>&nbsp;<span class="ident" id="2431305">unicode</span><span class="op" id="2431312">.</span><span class="ident" id="2431313">SpecialCase</span><span class="op" id="2431324">,</span>&nbsp;<span class="ident" id="2431326">s</span>&nbsp;<span class="builtintype" id="2431328">string</span><span class="op" id="2431334">)</span>&nbsp;<span class="builtintype" id="2431336">string</span>&nbsp;<span class="op" id="2431343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431346">return</span>&nbsp;<span class="ident" id="2431353">Map</span><span class="op" id="2431356">(</span><span class="keyword" id="2431357">func</span><span class="op" id="2431361">(</span><span class="ident" id="2431362">r</span>&nbsp;<span class="builtintype" id="2431364">rune</span><span class="op" id="2431368">)</span>&nbsp;<span class="builtintype" id="2431370">rune</span>&nbsp;<span class="op" id="2431375">{</span>&nbsp;<span class="keyword" id="2431377">return</span>&nbsp;<span class="ident" id="2431384">_case</span><span class="op" id="2431389">.</span><span class="ident" id="2431390">ToUpper</span><span class="op" id="2431397">(</span><span class="ident" id="2431398">r</span><span class="op" id="2431399">)</span>&nbsp;<span class="op" id="2431401">}</span><span class="op" id="2431402">,</span>&nbsp;<span class="ident" id="2431404">s</span><span class="op" id="2431405">)</span><br>
<span class="lineno">480</span><span class="op" id="2431407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2431410">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2431500">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2431560">func</span>&nbsp;<span class="ident" id="2431565">ToLowerSpecial</span><span class="op" id="2431579">(</span><span class="ident" id="2431580">_case</span>&nbsp;<span class="ident" id="2431586">unicode</span><span class="op" id="2431593">.</span><span class="ident" id="2431594">SpecialCase</span><span class="op" id="2431605">,</span>&nbsp;<span class="ident" id="2431607">s</span>&nbsp;<span class="builtintype" id="2431609">string</span><span class="op" id="2431615">)</span>&nbsp;<span class="builtintype" id="2431617">string</span>&nbsp;<span class="op" id="2431624">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431627">return</span>&nbsp;<span class="ident" id="2431634">Map</span><span class="op" id="2431637">(</span><span class="keyword" id="2431638">func</span><span class="op" id="2431642">(</span><span class="ident" id="2431643">r</span>&nbsp;<span class="builtintype" id="2431645">rune</span><span class="op" id="2431649">)</span>&nbsp;<span class="builtintype" id="2431651">rune</span>&nbsp;<span class="op" id="2431656">{</span>&nbsp;<span class="keyword" id="2431658">return</span>&nbsp;<span class="ident" id="2431665">_case</span><span class="op" id="2431670">.</span><span class="ident" id="2431671">ToLower</span><span class="op" id="2431678">(</span><span class="ident" id="2431679">r</span><span class="op" id="2431680">)</span>&nbsp;<span class="op" id="2431682">}</span><span class="op" id="2431683">,</span>&nbsp;<span class="ident" id="2431685">s</span><span class="op" id="2431686">)</span><br>
<span class="lineno"></span><span class="op" id="2431688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2431691">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2431781">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno">490</span><span class="keyword" id="2431841">func</span>&nbsp;<span class="ident" id="2431846">ToTitleSpecial</span><span class="op" id="2431860">(</span><span class="ident" id="2431861">_case</span>&nbsp;<span class="ident" id="2431867">unicode</span><span class="op" id="2431874">.</span><span class="ident" id="2431875">SpecialCase</span><span class="op" id="2431886">,</span>&nbsp;<span class="ident" id="2431888">s</span>&nbsp;<span class="builtintype" id="2431890">string</span><span class="op" id="2431896">)</span>&nbsp;<span class="builtintype" id="2431898">string</span>&nbsp;<span class="op" id="2431905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431908">return</span>&nbsp;<span class="ident" id="2431915">Map</span><span class="op" id="2431918">(</span><span class="keyword" id="2431919">func</span><span class="op" id="2431923">(</span><span class="ident" id="2431924">r</span>&nbsp;<span class="builtintype" id="2431926">rune</span><span class="op" id="2431930">)</span>&nbsp;<span class="builtintype" id="2431932">rune</span>&nbsp;<span class="op" id="2431937">{</span>&nbsp;<span class="keyword" id="2431939">return</span>&nbsp;<span class="ident" id="2431946">_case</span><span class="op" id="2431951">.</span><span class="ident" id="2431952">ToTitle</span><span class="op" id="2431959">(</span><span class="ident" id="2431960">r</span><span class="op" id="2431961">)</span>&nbsp;<span class="op" id="2431963">}</span><span class="op" id="2431964">,</span>&nbsp;<span class="ident" id="2431966">s</span><span class="op" id="2431967">)</span><br>
<span class="lineno"></span><span class="op" id="2431969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2431972">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno">495</span><span class="comment" id="2432040">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="2432110">func</span>&nbsp;<span class="ident" id="2432115">isSeparator</span><span class="op" id="2432126">(</span><span class="ident" id="2432127">r</span>&nbsp;<span class="builtintype" id="2432129">rune</span><span class="op" id="2432133">)</span>&nbsp;<span class="builtintype" id="2432135">bool</span>&nbsp;<span class="op" id="2432140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2432143">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432201">if</span>&nbsp;<span class="ident" id="2432204">r</span>&nbsp;<span class="op" id="2432206">&lt;=</span>&nbsp;<span class="num" id="2432209">0x7F</span>&nbsp;<span class="op" id="2432214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432218">switch</span>&nbsp;<span class="op" id="2432225">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432229">case</span>&nbsp;<span class="string" id="2432234">&#39;0&#39;</span>&nbsp;<span class="op" id="2432238">&lt;=</span>&nbsp;<span class="ident" id="2432241">r</span>&nbsp;<span class="op" id="2432243">&amp;&amp;</span>&nbsp;<span class="ident" id="2432246">r</span>&nbsp;<span class="op" id="2432248">&lt;=</span>&nbsp;<span class="string" id="2432251">&#39;9&#39;</span><span class="op" id="2432254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432259">return</span>&nbsp;<span class="builtintype" id="2432266">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432274">case</span>&nbsp;<span class="string" id="2432279">&#39;a&#39;</span>&nbsp;<span class="op" id="2432283">&lt;=</span>&nbsp;<span class="ident" id="2432286">r</span>&nbsp;<span class="op" id="2432288">&amp;&amp;</span>&nbsp;<span class="ident" id="2432291">r</span>&nbsp;<span class="op" id="2432293">&lt;=</span>&nbsp;<span class="string" id="2432296">&#39;z&#39;</span><span class="op" id="2432299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432304">return</span>&nbsp;<span class="builtintype" id="2432311">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432319">case</span>&nbsp;<span class="string" id="2432324">&#39;A&#39;</span>&nbsp;<span class="op" id="2432328">&lt;=</span>&nbsp;<span class="ident" id="2432331">r</span>&nbsp;<span class="op" id="2432333">&amp;&amp;</span>&nbsp;<span class="ident" id="2432336">r</span>&nbsp;<span class="op" id="2432338">&lt;=</span>&nbsp;<span class="string" id="2432341">&#39;Z&#39;</span><span class="op" id="2432344">:</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432349">return</span>&nbsp;<span class="builtintype" id="2432356">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432364">case</span>&nbsp;<span class="ident" id="2432369">r</span>&nbsp;<span class="op" id="2432371">==</span>&nbsp;<span class="string" id="2432374">&#39;_&#39;</span><span class="op" id="2432377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432382">return</span>&nbsp;<span class="builtintype" id="2432389">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2432397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432401">return</span>&nbsp;<span class="builtintype" id="2432408">true</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2432414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2432417">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432459">if</span>&nbsp;<span class="ident" id="2432462">unicode</span><span class="op" id="2432469">.</span><span class="ident" id="2432470">IsLetter</span><span class="op" id="2432478">(</span><span class="ident" id="2432479">r</span><span class="op" id="2432480">)</span>&nbsp;<span class="op" id="2432482">||</span>&nbsp;<span class="ident" id="2432485">unicode</span><span class="op" id="2432492">.</span><span class="ident" id="2432493">IsDigit</span><span class="op" id="2432500">(</span><span class="ident" id="2432501">r</span><span class="op" id="2432502">)</span>&nbsp;<span class="op" id="2432504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432508">return</span>&nbsp;<span class="builtintype" id="2432515">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2432522">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2432525">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432593">return</span>&nbsp;<span class="ident" id="2432600">unicode</span><span class="op" id="2432607">.</span><span class="ident" id="2432608">IsSpace</span><span class="op" id="2432615">(</span><span class="ident" id="2432616">r</span><span class="op" id="2432617">)</span><br>
<span class="lineno"></span><span class="op" id="2432619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2432622">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno">520</span><span class="comment" id="2432704">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="2432735">//</span><br>
<span class="lineno"></span><span class="comment" id="2432738">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2432832">func</span>&nbsp;<span class="ident" id="2432837">Title</span><span class="op" id="2432842">(</span><span class="ident" id="2432843">s</span>&nbsp;<span class="builtintype" id="2432845">string</span><span class="op" id="2432851">)</span>&nbsp;<span class="builtintype" id="2432853">string</span>&nbsp;<span class="op" id="2432860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2432863">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2432905">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2432977">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433008">prev</span>&nbsp;<span class="op" id="2433013">:=</span>&nbsp;<span class="string" id="2433016">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433021">return</span>&nbsp;<span class="ident" id="2433028">Map</span><span class="op" id="2433031">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433035">func</span><span class="op" id="2433039">(</span><span class="ident" id="2433040">r</span>&nbsp;<span class="builtintype" id="2433042">rune</span><span class="op" id="2433046">)</span>&nbsp;<span class="builtintype" id="2433048">rune</span>&nbsp;<span class="op" id="2433053">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433058">if</span>&nbsp;<span class="ident" id="2433061">isSeparator</span><span class="op" id="2433072">(</span><span class="ident" id="2433073">prev</span><span class="op" id="2433077">)</span>&nbsp;<span class="op" id="2433079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433085">prev</span>&nbsp;<span class="op" id="2433090">=</span>&nbsp;<span class="ident" id="2433092">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433098">return</span>&nbsp;<span class="ident" id="2433105">unicode</span><span class="op" id="2433112">.</span><span class="ident" id="2433113">ToTitle</span><span class="op" id="2433120">(</span><span class="ident" id="2433121">r</span><span class="op" id="2433122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2433127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433132">prev</span>&nbsp;<span class="op" id="2433137">=</span>&nbsp;<span class="ident" id="2433139">r</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433144">return</span>&nbsp;<span class="ident" id="2433151">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2433155">}</span><span class="op" id="2433156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433160">s</span><span class="op" id="2433161">)</span><br>
<span class="lineno"></span><span class="op" id="2433163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="2433166">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2433231">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2433281">func</span>&nbsp;<span class="ident" id="2433286">TrimLeftFunc</span><span class="op" id="2433298">(</span><span class="ident" id="2433299">s</span>&nbsp;<span class="builtintype" id="2433301">string</span><span class="op" id="2433307">,</span>&nbsp;<span class="ident" id="2433309">f</span>&nbsp;<span class="keyword" id="2433311">func</span><span class="op" id="2433315">(</span><span class="builtintype" id="2433316">rune</span><span class="op" id="2433320">)</span>&nbsp;<span class="builtintype" id="2433322">bool</span><span class="op" id="2433326">)</span>&nbsp;<span class="builtintype" id="2433328">string</span>&nbsp;<span class="op" id="2433335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433338">i</span>&nbsp;<span class="op" id="2433340">:=</span>&nbsp;<span class="ident" id="2433343">indexFunc</span><span class="op" id="2433352">(</span><span class="ident" id="2433353">s</span><span class="op" id="2433354">,</span>&nbsp;<span class="ident" id="2433356">f</span><span class="op" id="2433357">,</span>&nbsp;<span class="builtintype" id="2433359">false</span><span class="op" id="2433364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433367">if</span>&nbsp;<span class="ident" id="2433370">i</span>&nbsp;<span class="op" id="2433372">==</span>&nbsp;<span class="op" id="2433375">-</span><span class="num" id="2433376">1</span>&nbsp;<span class="op" id="2433378">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433382">return</span>&nbsp;<span class="string" id="2433389">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2433393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433396">return</span>&nbsp;<span class="ident" id="2433403">s</span><span class="op" id="2433404">[</span><span class="ident" id="2433405">i</span><span class="op" id="2433406">:</span><span class="op" id="2433407">]</span><br>
<span class="lineno"></span><span class="op" id="2433409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span><span class="comment" id="2433412">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2433479">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2433529">func</span>&nbsp;<span class="ident" id="2433534">TrimRightFunc</span><span class="op" id="2433547">(</span><span class="ident" id="2433548">s</span>&nbsp;<span class="builtintype" id="2433550">string</span><span class="op" id="2433556">,</span>&nbsp;<span class="ident" id="2433558">f</span>&nbsp;<span class="keyword" id="2433560">func</span><span class="op" id="2433564">(</span><span class="builtintype" id="2433565">rune</span><span class="op" id="2433569">)</span>&nbsp;<span class="builtintype" id="2433571">bool</span><span class="op" id="2433575">)</span>&nbsp;<span class="builtintype" id="2433577">string</span>&nbsp;<span class="op" id="2433584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433587">i</span>&nbsp;<span class="op" id="2433589">:=</span>&nbsp;<span class="ident" id="2433592">lastIndexFunc</span><span class="op" id="2433605">(</span><span class="ident" id="2433606">s</span><span class="op" id="2433607">,</span>&nbsp;<span class="ident" id="2433609">f</span><span class="op" id="2433610">,</span>&nbsp;<span class="builtintype" id="2433612">false</span><span class="op" id="2433617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433620">if</span>&nbsp;<span class="ident" id="2433623">i</span>&nbsp;<span class="op" id="2433625">&gt;=</span>&nbsp;<span class="num" id="2433628">0</span>&nbsp;<span class="op" id="2433630">&amp;&amp;</span>&nbsp;<span class="ident" id="2433633">s</span><span class="op" id="2433634">[</span><span class="ident" id="2433635">i</span><span class="op" id="2433636">]</span>&nbsp;<span class="op" id="2433638">&gt;=</span>&nbsp;<span class="ident" id="2433641">utf8</span><span class="op" id="2433645">.</span><span class="ident" id="2433646">RuneSelf</span>&nbsp;<span class="op" id="2433655">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433659">_</span><span class="op" id="2433660">,</span>&nbsp;<span class="ident" id="2433662">wid</span>&nbsp;<span class="op" id="2433666">:=</span>&nbsp;<span class="ident" id="2433669">utf8</span><span class="op" id="2433673">.</span><span class="ident" id="2433674">DecodeRuneInString</span><span class="op" id="2433692">(</span><span class="ident" id="2433693">s</span><span class="op" id="2433694">[</span><span class="ident" id="2433695">i</span><span class="op" id="2433696">:</span><span class="op" id="2433697">]</span><span class="op" id="2433698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433702">i</span>&nbsp;<span class="op" id="2433704">+=</span>&nbsp;<span class="ident" id="2433707">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2433712">}</span>&nbsp;<span class="keyword" id="2433714">else</span>&nbsp;<span class="op" id="2433719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433723">i</span><span class="op" id="2433724">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2433728">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433731">return</span>&nbsp;<span class="ident" id="2433738">s</span><span class="op" id="2433739">[</span><span class="num" id="2433740">0</span><span class="op" id="2433741">:</span><span class="ident" id="2433742">i</span><span class="op" id="2433743">]</span><br>
<span class="lineno"></span><span class="op" id="2433745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2433748">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2433809">//&nbsp;and&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;removed.</span><br>
<span class="lineno">565</span><span class="keyword" id="2433872">func</span>&nbsp;<span class="ident" id="2433877">TrimFunc</span><span class="op" id="2433885">(</span><span class="ident" id="2433886">s</span>&nbsp;<span class="builtintype" id="2433888">string</span><span class="op" id="2433894">,</span>&nbsp;<span class="ident" id="2433896">f</span>&nbsp;<span class="keyword" id="2433898">func</span><span class="op" id="2433902">(</span><span class="builtintype" id="2433903">rune</span><span class="op" id="2433907">)</span>&nbsp;<span class="builtintype" id="2433909">bool</span><span class="op" id="2433913">)</span>&nbsp;<span class="builtintype" id="2433915">string</span>&nbsp;<span class="op" id="2433922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433925">return</span>&nbsp;<span class="ident" id="2433932">TrimRightFunc</span><span class="op" id="2433945">(</span><span class="ident" id="2433946">TrimLeftFunc</span><span class="op" id="2433958">(</span><span class="ident" id="2433959">s</span><span class="op" id="2433960">,</span>&nbsp;<span class="ident" id="2433962">f</span><span class="op" id="2433963">)</span><span class="op" id="2433964">,</span>&nbsp;<span class="ident" id="2433966">f</span><span class="op" id="2433967">)</span><br>
<span class="lineno"></span><span class="op" id="2433969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2433972">//&nbsp;IndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno">570</span><span class="comment" id="2434031">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2434080">func</span>&nbsp;<span class="ident" id="2434085">IndexFunc</span><span class="op" id="2434094">(</span><span class="ident" id="2434095">s</span>&nbsp;<span class="builtintype" id="2434097">string</span><span class="op" id="2434103">,</span>&nbsp;<span class="ident" id="2434105">f</span>&nbsp;<span class="keyword" id="2434107">func</span><span class="op" id="2434111">(</span><span class="builtintype" id="2434112">rune</span><span class="op" id="2434116">)</span>&nbsp;<span class="builtintype" id="2434118">bool</span><span class="op" id="2434122">)</span>&nbsp;<span class="builtintype" id="2434124">int</span>&nbsp;<span class="op" id="2434128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434131">return</span>&nbsp;<span class="ident" id="2434138">indexFunc</span><span class="op" id="2434147">(</span><span class="ident" id="2434148">s</span><span class="op" id="2434149">,</span>&nbsp;<span class="ident" id="2434151">f</span><span class="op" id="2434152">,</span>&nbsp;<span class="builtintype" id="2434154">true</span><span class="op" id="2434158">)</span><br>
<span class="lineno"></span><span class="op" id="2434160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="2434163">//&nbsp;LastIndexFunc&nbsp;returns&nbsp;the&nbsp;index&nbsp;into&nbsp;s&nbsp;of&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span><span class="comment" id="2434217">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2434274">func</span>&nbsp;<span class="ident" id="2434279">LastIndexFunc</span><span class="op" id="2434292">(</span><span class="ident" id="2434293">s</span>&nbsp;<span class="builtintype" id="2434295">string</span><span class="op" id="2434301">,</span>&nbsp;<span class="ident" id="2434303">f</span>&nbsp;<span class="keyword" id="2434305">func</span><span class="op" id="2434309">(</span><span class="builtintype" id="2434310">rune</span><span class="op" id="2434314">)</span>&nbsp;<span class="builtintype" id="2434316">bool</span><span class="op" id="2434320">)</span>&nbsp;<span class="builtintype" id="2434322">int</span>&nbsp;<span class="op" id="2434326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434329">return</span>&nbsp;<span class="ident" id="2434336">lastIndexFunc</span><span class="op" id="2434349">(</span><span class="ident" id="2434350">s</span><span class="op" id="2434351">,</span>&nbsp;<span class="ident" id="2434353">f</span><span class="op" id="2434354">,</span>&nbsp;<span class="builtintype" id="2434356">true</span><span class="op" id="2434360">)</span><br>
<span class="lineno"></span><span class="op" id="2434362">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span><span class="comment" id="2434365">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2434418">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2434474">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2434487">func</span>&nbsp;<span class="ident" id="2434492">indexFunc</span><span class="op" id="2434501">(</span><span class="ident" id="2434502">s</span>&nbsp;<span class="builtintype" id="2434504">string</span><span class="op" id="2434510">,</span>&nbsp;<span class="ident" id="2434512">f</span>&nbsp;<span class="keyword" id="2434514">func</span><span class="op" id="2434518">(</span><span class="builtintype" id="2434519">rune</span><span class="op" id="2434523">)</span>&nbsp;<span class="builtintype" id="2434525">bool</span><span class="op" id="2434529">,</span>&nbsp;<span class="ident" id="2434531">truth</span>&nbsp;<span class="builtintype" id="2434537">bool</span><span class="op" id="2434541">)</span>&nbsp;<span class="builtintype" id="2434543">int</span>&nbsp;<span class="op" id="2434547">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434550">start</span>&nbsp;<span class="op" id="2434556">:=</span>&nbsp;<span class="num" id="2434559">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434562">for</span>&nbsp;<span class="ident" id="2434566">start</span>&nbsp;<span class="op" id="2434572">&lt;</span>&nbsp;<span class="builtinfunc" id="2434574">len</span><span class="op" id="2434577">(</span><span class="ident" id="2434578">s</span><span class="op" id="2434579">)</span>&nbsp;<span class="op" id="2434581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434585">wid</span>&nbsp;<span class="op" id="2434589">:=</span>&nbsp;<span class="num" id="2434592">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434596">r</span>&nbsp;<span class="op" id="2434598">:=</span>&nbsp;<span class="builtintype" id="2434601">rune</span><span class="op" id="2434605">(</span><span class="ident" id="2434606">s</span><span class="op" id="2434607">[</span><span class="ident" id="2434608">start</span><span class="op" id="2434613">]</span><span class="op" id="2434614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434618">if</span>&nbsp;<span class="ident" id="2434621">r</span>&nbsp;<span class="op" id="2434623">&gt;=</span>&nbsp;<span class="ident" id="2434626">utf8</span><span class="op" id="2434630">.</span><span class="ident" id="2434631">RuneSelf</span>&nbsp;<span class="op" id="2434640">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434645">r</span><span class="op" id="2434646">,</span>&nbsp;<span class="ident" id="2434648">wid</span>&nbsp;<span class="op" id="2434652">=</span>&nbsp;<span class="ident" id="2434654">utf8</span><span class="op" id="2434658">.</span><span class="ident" id="2434659">DecodeRuneInString</span><span class="op" id="2434677">(</span><span class="ident" id="2434678">s</span><span class="op" id="2434679">[</span><span class="ident" id="2434680">start</span><span class="op" id="2434685">:</span><span class="op" id="2434686">]</span><span class="op" id="2434687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434695">if</span>&nbsp;<span class="ident" id="2434698">f</span><span class="op" id="2434699">(</span><span class="ident" id="2434700">r</span><span class="op" id="2434701">)</span>&nbsp;<span class="op" id="2434703">==</span>&nbsp;<span class="ident" id="2434706">truth</span>&nbsp;<span class="op" id="2434712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434717">return</span>&nbsp;<span class="ident" id="2434724">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434732">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434736">start</span>&nbsp;<span class="op" id="2434742">+=</span>&nbsp;<span class="ident" id="2434745">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434753">return</span>&nbsp;<span class="op" id="2434760">-</span><span class="num" id="2434761">1</span><br>
<span class="lineno"></span><span class="op" id="2434763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="2434766">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2434827">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2434883">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2434896">func</span>&nbsp;<span class="ident" id="2434901">lastIndexFunc</span><span class="op" id="2434914">(</span><span class="ident" id="2434915">s</span>&nbsp;<span class="builtintype" id="2434917">string</span><span class="op" id="2434923">,</span>&nbsp;<span class="ident" id="2434925">f</span>&nbsp;<span class="keyword" id="2434927">func</span><span class="op" id="2434931">(</span><span class="builtintype" id="2434932">rune</span><span class="op" id="2434936">)</span>&nbsp;<span class="builtintype" id="2434938">bool</span><span class="op" id="2434942">,</span>&nbsp;<span class="ident" id="2434944">truth</span>&nbsp;<span class="builtintype" id="2434950">bool</span><span class="op" id="2434954">)</span>&nbsp;<span class="builtintype" id="2434956">int</span>&nbsp;<span class="op" id="2434960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434963">for</span>&nbsp;<span class="ident" id="2434967">i</span>&nbsp;<span class="op" id="2434969">:=</span>&nbsp;<span class="builtinfunc" id="2434972">len</span><span class="op" id="2434975">(</span><span class="ident" id="2434976">s</span><span class="op" id="2434977">)</span><span class="op" id="2434978">;</span>&nbsp;<span class="ident" id="2434980">i</span>&nbsp;<span class="op" id="2434982">&gt;</span>&nbsp;<span class="num" id="2434984">0</span><span class="op" id="2434985">;</span>&nbsp;<span class="op" id="2434987">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434991">r</span><span class="op" id="2434992">,</span>&nbsp;<span class="ident" id="2434994">size</span>&nbsp;<span class="op" id="2434999">:=</span>&nbsp;<span class="ident" id="2435002">utf8</span><span class="op" id="2435006">.</span><span class="ident" id="2435007">DecodeLastRuneInString</span><span class="op" id="2435029">(</span><span class="ident" id="2435030">s</span><span class="op" id="2435031">[</span><span class="num" id="2435032">0</span><span class="op" id="2435033">:</span><span class="ident" id="2435034">i</span><span class="op" id="2435035">]</span><span class="op" id="2435036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435040">i</span>&nbsp;<span class="op" id="2435042">-=</span>&nbsp;<span class="ident" id="2435045">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435052">if</span>&nbsp;<span class="ident" id="2435055">f</span><span class="op" id="2435056">(</span><span class="ident" id="2435057">r</span><span class="op" id="2435058">)</span>&nbsp;<span class="op" id="2435060">==</span>&nbsp;<span class="ident" id="2435063">truth</span>&nbsp;<span class="op" id="2435069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435074">return</span>&nbsp;<span class="ident" id="2435081">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435085">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435091">return</span>&nbsp;<span class="op" id="2435098">-</span><span class="num" id="2435099">1</span><br>
<span class="lineno"></span><span class="op" id="2435101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2435104">func</span>&nbsp;<span class="ident" id="2435109">makeCutsetFunc</span><span class="op" id="2435123">(</span><span class="ident" id="2435124">cutset</span>&nbsp;<span class="builtintype" id="2435131">string</span><span class="op" id="2435137">)</span>&nbsp;<span class="keyword" id="2435139">func</span><span class="op" id="2435143">(</span><span class="builtintype" id="2435144">rune</span><span class="op" id="2435148">)</span>&nbsp;<span class="builtintype" id="2435150">bool</span>&nbsp;<span class="op" id="2435155">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435158">return</span>&nbsp;<span class="keyword" id="2435165">func</span><span class="op" id="2435169">(</span><span class="ident" id="2435170">r</span>&nbsp;<span class="builtintype" id="2435172">rune</span><span class="op" id="2435176">)</span>&nbsp;<span class="builtintype" id="2435178">bool</span>&nbsp;<span class="op" id="2435183">{</span>&nbsp;<span class="keyword" id="2435185">return</span>&nbsp;<span class="ident" id="2435192">IndexRune</span><span class="op" id="2435201">(</span><span class="ident" id="2435202">cutset</span><span class="op" id="2435208">,</span>&nbsp;<span class="ident" id="2435210">r</span><span class="op" id="2435211">)</span>&nbsp;<span class="op" id="2435213">&gt;=</span>&nbsp;<span class="num" id="2435216">0</span>&nbsp;<span class="op" id="2435218">}</span><br>
<span class="lineno"></span><span class="op" id="2435220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2435223">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2435284">//&nbsp;trailing&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno">620</span><span class="keyword" id="2435345">func</span>&nbsp;<span class="ident" id="2435350">Trim</span><span class="op" id="2435354">(</span><span class="ident" id="2435355">s</span>&nbsp;<span class="builtintype" id="2435357">string</span><span class="op" id="2435363">,</span>&nbsp;<span class="ident" id="2435365">cutset</span>&nbsp;<span class="builtintype" id="2435372">string</span><span class="op" id="2435378">)</span>&nbsp;<span class="builtintype" id="2435380">string</span>&nbsp;<span class="op" id="2435387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435390">if</span>&nbsp;<span class="ident" id="2435393">s</span>&nbsp;<span class="op" id="2435395">==</span>&nbsp;<span class="string" id="2435398">&#34;&#34;</span>&nbsp;<span class="op" id="2435401">||</span>&nbsp;<span class="ident" id="2435404">cutset</span>&nbsp;<span class="op" id="2435411">==</span>&nbsp;<span class="string" id="2435414">&#34;&#34;</span>&nbsp;<span class="op" id="2435417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435421">return</span>&nbsp;<span class="ident" id="2435428">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435434">return</span>&nbsp;<span class="ident" id="2435441">TrimFunc</span><span class="op" id="2435449">(</span><span class="ident" id="2435450">s</span><span class="op" id="2435451">,</span>&nbsp;<span class="ident" id="2435453">makeCutsetFunc</span><span class="op" id="2435467">(</span><span class="ident" id="2435468">cutset</span><span class="op" id="2435474">)</span><span class="op" id="2435475">)</span><br>
<span class="lineno">625</span><span class="op" id="2435477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2435480">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2435541">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2435593">func</span>&nbsp;<span class="ident" id="2435598">TrimLeft</span><span class="op" id="2435606">(</span><span class="ident" id="2435607">s</span>&nbsp;<span class="builtintype" id="2435609">string</span><span class="op" id="2435615">,</span>&nbsp;<span class="ident" id="2435617">cutset</span>&nbsp;<span class="builtintype" id="2435624">string</span><span class="op" id="2435630">)</span>&nbsp;<span class="builtintype" id="2435632">string</span>&nbsp;<span class="op" id="2435639">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435642">if</span>&nbsp;<span class="ident" id="2435645">s</span>&nbsp;<span class="op" id="2435647">==</span>&nbsp;<span class="string" id="2435650">&#34;&#34;</span>&nbsp;<span class="op" id="2435653">||</span>&nbsp;<span class="ident" id="2435656">cutset</span>&nbsp;<span class="op" id="2435663">==</span>&nbsp;<span class="string" id="2435666">&#34;&#34;</span>&nbsp;<span class="op" id="2435669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435673">return</span>&nbsp;<span class="ident" id="2435680">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435686">return</span>&nbsp;<span class="ident" id="2435693">TrimLeftFunc</span><span class="op" id="2435705">(</span><span class="ident" id="2435706">s</span><span class="op" id="2435707">,</span>&nbsp;<span class="ident" id="2435709">makeCutsetFunc</span><span class="op" id="2435723">(</span><span class="ident" id="2435724">cutset</span><span class="op" id="2435730">)</span><span class="op" id="2435731">)</span><br>
<span class="lineno"></span><span class="op" id="2435733">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="comment" id="2435736">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2435800">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="2435852">func</span>&nbsp;<span class="ident" id="2435857">TrimRight</span><span class="op" id="2435866">(</span><span class="ident" id="2435867">s</span>&nbsp;<span class="builtintype" id="2435869">string</span><span class="op" id="2435875">,</span>&nbsp;<span class="ident" id="2435877">cutset</span>&nbsp;<span class="builtintype" id="2435884">string</span><span class="op" id="2435890">)</span>&nbsp;<span class="builtintype" id="2435892">string</span>&nbsp;<span class="op" id="2435899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435902">if</span>&nbsp;<span class="ident" id="2435905">s</span>&nbsp;<span class="op" id="2435907">==</span>&nbsp;<span class="string" id="2435910">&#34;&#34;</span>&nbsp;<span class="op" id="2435913">||</span>&nbsp;<span class="ident" id="2435916">cutset</span>&nbsp;<span class="op" id="2435923">==</span>&nbsp;<span class="string" id="2435926">&#34;&#34;</span>&nbsp;<span class="op" id="2435929">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435933">return</span>&nbsp;<span class="ident" id="2435940">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435946">return</span>&nbsp;<span class="ident" id="2435953">TrimRightFunc</span><span class="op" id="2435966">(</span><span class="ident" id="2435967">s</span><span class="op" id="2435968">,</span>&nbsp;<span class="ident" id="2435970">makeCutsetFunc</span><span class="op" id="2435984">(</span><span class="ident" id="2435985">cutset</span><span class="op" id="2435991">)</span><span class="op" id="2435992">)</span><br>
<span class="lineno"></span><span class="op" id="2435994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span><span class="comment" id="2435997">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;string&nbsp;s,&nbsp;with&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2436060">//&nbsp;and&nbsp;trailing&nbsp;white&nbsp;space&nbsp;removed,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="2436120">func</span>&nbsp;<span class="ident" id="2436125">TrimSpace</span><span class="op" id="2436134">(</span><span class="ident" id="2436135">s</span>&nbsp;<span class="builtintype" id="2436137">string</span><span class="op" id="2436143">)</span>&nbsp;<span class="builtintype" id="2436145">string</span>&nbsp;<span class="op" id="2436152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436155">return</span>&nbsp;<span class="ident" id="2436162">TrimFunc</span><span class="op" id="2436170">(</span><span class="ident" id="2436171">s</span><span class="op" id="2436172">,</span>&nbsp;<span class="ident" id="2436174">unicode</span><span class="op" id="2436181">.</span><span class="ident" id="2436182">IsSpace</span><span class="op" id="2436189">)</span><br>
<span class="lineno"></span><span class="op" id="2436191">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span><span class="comment" id="2436194">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2436262">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2436322">func</span>&nbsp;<span class="ident" id="2436327">TrimPrefix</span><span class="op" id="2436337">(</span><span class="ident" id="2436338">s</span><span class="op" id="2436339">,</span>&nbsp;<span class="ident" id="2436341">prefix</span>&nbsp;<span class="builtintype" id="2436348">string</span><span class="op" id="2436354">)</span>&nbsp;<span class="builtintype" id="2436356">string</span>&nbsp;<span class="op" id="2436363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436366">if</span>&nbsp;<span class="ident" id="2436369">HasPrefix</span><span class="op" id="2436378">(</span><span class="ident" id="2436379">s</span><span class="op" id="2436380">,</span>&nbsp;<span class="ident" id="2436382">prefix</span><span class="op" id="2436388">)</span>&nbsp;<span class="op" id="2436390">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436394">return</span>&nbsp;<span class="ident" id="2436401">s</span><span class="op" id="2436402">[</span><span class="builtinfunc" id="2436403">len</span><span class="op" id="2436406">(</span><span class="ident" id="2436407">prefix</span><span class="op" id="2436413">)</span><span class="op" id="2436414">:</span><span class="op" id="2436415">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2436418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436421">return</span>&nbsp;<span class="ident" id="2436428">s</span><br>
<span class="lineno"></span><span class="op" id="2436430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="2436433">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2436502">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2436560">func</span>&nbsp;<span class="ident" id="2436565">TrimSuffix</span><span class="op" id="2436575">(</span><span class="ident" id="2436576">s</span><span class="op" id="2436577">,</span>&nbsp;<span class="ident" id="2436579">suffix</span>&nbsp;<span class="builtintype" id="2436586">string</span><span class="op" id="2436592">)</span>&nbsp;<span class="builtintype" id="2436594">string</span>&nbsp;<span class="op" id="2436601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436604">if</span>&nbsp;<span class="ident" id="2436607">HasSuffix</span><span class="op" id="2436616">(</span><span class="ident" id="2436617">s</span><span class="op" id="2436618">,</span>&nbsp;<span class="ident" id="2436620">suffix</span><span class="op" id="2436626">)</span>&nbsp;<span class="op" id="2436628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436632">return</span>&nbsp;<span class="ident" id="2436639">s</span><span class="op" id="2436640">[</span><span class="op" id="2436641">:</span><span class="builtinfunc" id="2436642">len</span><span class="op" id="2436645">(</span><span class="ident" id="2436646">s</span><span class="op" id="2436647">)</span><span class="op" id="2436648">-</span><span class="builtinfunc" id="2436649">len</span><span class="op" id="2436652">(</span><span class="ident" id="2436653">suffix</span><span class="op" id="2436659">)</span><span class="op" id="2436660">]</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2436663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436666">return</span>&nbsp;<span class="ident" id="2436673">s</span><br>
<span class="lineno"></span><span class="op" id="2436675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2436678">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;string&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno">670</span><span class="comment" id="2436737">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno"></span><span class="comment" id="2436790">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2436852">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="2436918">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2436942">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno">675</span><span class="keyword" id="2437004">func</span>&nbsp;<span class="ident" id="2437009">Replace</span><span class="op" id="2437016">(</span><span class="ident" id="2437017">s</span><span class="op" id="2437018">,</span>&nbsp;<span class="ident" id="2437020">old</span><span class="op" id="2437023">,</span>&nbsp;<span class="builtinfunc" id="2437025">new</span>&nbsp;<span class="builtintype" id="2437029">string</span><span class="op" id="2437035">,</span>&nbsp;<span class="ident" id="2437037">n</span>&nbsp;<span class="builtintype" id="2437039">int</span><span class="op" id="2437042">)</span>&nbsp;<span class="builtintype" id="2437044">string</span>&nbsp;<span class="op" id="2437051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437054">if</span>&nbsp;<span class="ident" id="2437057">old</span>&nbsp;<span class="op" id="2437061">==</span>&nbsp;<span class="builtinfunc" id="2437064">new</span>&nbsp;<span class="op" id="2437068">||</span>&nbsp;<span class="ident" id="2437071">n</span>&nbsp;<span class="op" id="2437073">==</span>&nbsp;<span class="num" id="2437076">0</span>&nbsp;<span class="op" id="2437078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437082">return</span>&nbsp;<span class="ident" id="2437089">s</span>&nbsp;<span class="comment" id="2437091">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2437112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2437116">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437152">if</span>&nbsp;<span class="ident" id="2437155">m</span>&nbsp;<span class="op" id="2437157">:=</span>&nbsp;<span class="ident" id="2437160">Count</span><span class="op" id="2437165">(</span><span class="ident" id="2437166">s</span><span class="op" id="2437167">,</span>&nbsp;<span class="ident" id="2437169">old</span><span class="op" id="2437172">)</span><span class="op" id="2437173">;</span>&nbsp;<span class="ident" id="2437175">m</span>&nbsp;<span class="op" id="2437177">==</span>&nbsp;<span class="num" id="2437180">0</span>&nbsp;<span class="op" id="2437182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437186">return</span>&nbsp;<span class="ident" id="2437193">s</span>&nbsp;<span class="comment" id="2437195">//&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2437216">}</span>&nbsp;<span class="keyword" id="2437218">else</span>&nbsp;<span class="keyword" id="2437223">if</span>&nbsp;<span class="ident" id="2437226">n</span>&nbsp;<span class="op" id="2437228">&lt;</span>&nbsp;<span class="num" id="2437230">0</span>&nbsp;<span class="op" id="2437232">||</span>&nbsp;<span class="ident" id="2437235">m</span>&nbsp;<span class="op" id="2437237">&lt;</span>&nbsp;<span class="ident" id="2437239">n</span>&nbsp;<span class="op" id="2437241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437245">n</span>&nbsp;<span class="op" id="2437247">=</span>&nbsp;<span class="ident" id="2437249">m</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2437252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2437256">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437290">t</span>&nbsp;<span class="op" id="2437292">:=</span>&nbsp;<span class="builtinfunc" id="2437295">make</span><span class="op" id="2437299">(</span><span class="op" id="2437300">[</span><span class="op" id="2437301">]</span><span class="builtintype" id="2437302">byte</span><span class="op" id="2437306">,</span>&nbsp;<span class="builtinfunc" id="2437308">len</span><span class="op" id="2437311">(</span><span class="ident" id="2437312">s</span><span class="op" id="2437313">)</span><span class="op" id="2437314">+</span><span class="ident" id="2437315">n</span><span class="op" id="2437316">*</span><span class="op" id="2437317">(</span><span class="builtinfunc" id="2437318">len</span><span class="op" id="2437321">(</span><span class="builtinfunc" id="2437322">new</span><span class="op" id="2437325">)</span><span class="op" id="2437326">-</span><span class="builtinfunc" id="2437327">len</span><span class="op" id="2437330">(</span><span class="ident" id="2437331">old</span><span class="op" id="2437334">)</span><span class="op" id="2437335">)</span><span class="op" id="2437336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437339">w</span>&nbsp;<span class="op" id="2437341">:=</span>&nbsp;<span class="num" id="2437344">0</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437347">start</span>&nbsp;<span class="op" id="2437353">:=</span>&nbsp;<span class="num" id="2437356">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437359">for</span>&nbsp;<span class="ident" id="2437363">i</span>&nbsp;<span class="op" id="2437365">:=</span>&nbsp;<span class="num" id="2437368">0</span><span class="op" id="2437369">;</span>&nbsp;<span class="ident" id="2437371">i</span>&nbsp;<span class="op" id="2437373">&lt;</span>&nbsp;<span class="ident" id="2437375">n</span><span class="op" id="2437376">;</span>&nbsp;<span class="ident" id="2437378">i</span><span class="op" id="2437379">++</span>&nbsp;<span class="op" id="2437382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437386">j</span>&nbsp;<span class="op" id="2437388">:=</span>&nbsp;<span class="ident" id="2437391">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437399">if</span>&nbsp;<span class="builtinfunc" id="2437402">len</span><span class="op" id="2437405">(</span><span class="ident" id="2437406">old</span><span class="op" id="2437409">)</span>&nbsp;<span class="op" id="2437411">==</span>&nbsp;<span class="num" id="2437414">0</span>&nbsp;<span class="op" id="2437416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437421">if</span>&nbsp;<span class="ident" id="2437424">i</span>&nbsp;<span class="op" id="2437426">&gt;</span>&nbsp;<span class="num" id="2437428">0</span>&nbsp;<span class="op" id="2437430">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437436">_</span><span class="op" id="2437437">,</span>&nbsp;<span class="ident" id="2437439">wid</span>&nbsp;<span class="op" id="2437443">:=</span>&nbsp;<span class="ident" id="2437446">utf8</span><span class="op" id="2437450">.</span><span class="ident" id="2437451">DecodeRuneInString</span><span class="op" id="2437469">(</span><span class="ident" id="2437470">s</span><span class="op" id="2437471">[</span><span class="ident" id="2437472">start</span><span class="op" id="2437477">:</span><span class="op" id="2437478">]</span><span class="op" id="2437479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437485">j</span>&nbsp;<span class="op" id="2437487">+=</span>&nbsp;<span class="ident" id="2437490">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2437497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2437501">}</span>&nbsp;<span class="keyword" id="2437503">else</span>&nbsp;<span class="op" id="2437508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437513">j</span>&nbsp;<span class="op" id="2437515">+=</span>&nbsp;<span class="ident" id="2437518">Index</span><span class="op" id="2437523">(</span><span class="ident" id="2437524">s</span><span class="op" id="2437525">[</span><span class="ident" id="2437526">start</span><span class="op" id="2437531">:</span><span class="op" id="2437532">]</span><span class="op" id="2437533">,</span>&nbsp;<span class="ident" id="2437535">old</span><span class="op" id="2437538">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2437542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437546">w</span>&nbsp;<span class="op" id="2437548">+=</span>&nbsp;<span class="builtinfunc" id="2437551">copy</span><span class="op" id="2437555">(</span><span class="ident" id="2437556">t</span><span class="op" id="2437557">[</span><span class="ident" id="2437558">w</span><span class="op" id="2437559">:</span><span class="op" id="2437560">]</span><span class="op" id="2437561">,</span>&nbsp;<span class="ident" id="2437563">s</span><span class="op" id="2437564">[</span><span class="ident" id="2437565">start</span><span class="op" id="2437570">:</span><span class="ident" id="2437571">j</span><span class="op" id="2437572">]</span><span class="op" id="2437573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437577">w</span>&nbsp;<span class="op" id="2437579">+=</span>&nbsp;<span class="builtinfunc" id="2437582">copy</span><span class="op" id="2437586">(</span><span class="ident" id="2437587">t</span><span class="op" id="2437588">[</span><span class="ident" id="2437589">w</span><span class="op" id="2437590">:</span><span class="op" id="2437591">]</span><span class="op" id="2437592">,</span>&nbsp;<span class="builtinfunc" id="2437594">new</span><span class="op" id="2437597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437601">start</span>&nbsp;<span class="op" id="2437607">=</span>&nbsp;<span class="ident" id="2437609">j</span>&nbsp;<span class="op" id="2437611">+</span>&nbsp;<span class="builtinfunc" id="2437613">len</span><span class="op" id="2437616">(</span><span class="ident" id="2437617">old</span><span class="op" id="2437620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2437623">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437626">w</span>&nbsp;<span class="op" id="2437628">+=</span>&nbsp;<span class="builtinfunc" id="2437631">copy</span><span class="op" id="2437635">(</span><span class="ident" id="2437636">t</span><span class="op" id="2437637">[</span><span class="ident" id="2437638">w</span><span class="op" id="2437639">:</span><span class="op" id="2437640">]</span><span class="op" id="2437641">,</span>&nbsp;<span class="ident" id="2437643">s</span><span class="op" id="2437644">[</span><span class="ident" id="2437645">start</span><span class="op" id="2437650">:</span><span class="op" id="2437651">]</span><span class="op" id="2437652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437655">return</span>&nbsp;<span class="builtintype" id="2437662">string</span><span class="op" id="2437668">(</span><span class="ident" id="2437669">t</span><span class="op" id="2437670">[</span><span class="num" id="2437671">0</span><span class="op" id="2437672">:</span><span class="ident" id="2437673">w</span><span class="op" id="2437674">]</span><span class="op" id="2437675">)</span><br>
<span class="lineno"></span><span class="op" id="2437677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2437680">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno">710</span><span class="comment" id="2437748">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="2437789">func</span>&nbsp;<span class="ident" id="2437794">EqualFold</span><span class="op" id="2437803">(</span><span class="ident" id="2437804">s</span><span class="op" id="2437805">,</span>&nbsp;<span class="ident" id="2437807">t</span>&nbsp;<span class="builtintype" id="2437809">string</span><span class="op" id="2437815">)</span>&nbsp;<span class="builtintype" id="2437817">bool</span>&nbsp;<span class="op" id="2437822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437825">for</span>&nbsp;<span class="ident" id="2437829">s</span>&nbsp;<span class="op" id="2437831">!=</span>&nbsp;<span class="string" id="2437834">&#34;&#34;</span>&nbsp;<span class="op" id="2437837">&amp;&amp;</span>&nbsp;<span class="ident" id="2437840">t</span>&nbsp;<span class="op" id="2437842">!=</span>&nbsp;<span class="string" id="2437845">&#34;&#34;</span>&nbsp;<span class="op" id="2437848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2437852">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437894">var</span>&nbsp;<span class="ident" id="2437898">sr</span><span class="op" id="2437900">,</span>&nbsp;<span class="ident" id="2437902">tr</span>&nbsp;<span class="builtintype" id="2437905">rune</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437912">if</span>&nbsp;<span class="ident" id="2437915">s</span><span class="op" id="2437916">[</span><span class="num" id="2437917">0</span><span class="op" id="2437918">]</span>&nbsp;<span class="op" id="2437920">&lt;</span>&nbsp;<span class="ident" id="2437922">utf8</span><span class="op" id="2437926">.</span><span class="ident" id="2437927">RuneSelf</span>&nbsp;<span class="op" id="2437936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437941">sr</span><span class="op" id="2437943">,</span>&nbsp;<span class="ident" id="2437945">s</span>&nbsp;<span class="op" id="2437947">=</span>&nbsp;<span class="builtintype" id="2437949">rune</span><span class="op" id="2437953">(</span><span class="ident" id="2437954">s</span><span class="op" id="2437955">[</span><span class="num" id="2437956">0</span><span class="op" id="2437957">]</span><span class="op" id="2437958">)</span><span class="op" id="2437959">,</span>&nbsp;<span class="ident" id="2437961">s</span><span class="op" id="2437962">[</span><span class="num" id="2437963">1</span><span class="op" id="2437964">:</span><span class="op" id="2437965">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2437969">}</span>&nbsp;<span class="keyword" id="2437971">else</span>&nbsp;<span class="op" id="2437976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437981">r</span><span class="op" id="2437982">,</span>&nbsp;<span class="ident" id="2437984">size</span>&nbsp;<span class="op" id="2437989">:=</span>&nbsp;<span class="ident" id="2437992">utf8</span><span class="op" id="2437996">.</span><span class="ident" id="2437997">DecodeRuneInString</span><span class="op" id="2438015">(</span><span class="ident" id="2438016">s</span><span class="op" id="2438017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2438022">sr</span><span class="op" id="2438024">,</span>&nbsp;<span class="ident" id="2438026">s</span>&nbsp;<span class="op" id="2438028">=</span>&nbsp;<span class="ident" id="2438030">r</span><span class="op" id="2438031">,</span>&nbsp;<span class="ident" id="2438033">s</span><span class="op" id="2438034">[</span><span class="ident" id="2438035">size</span><span class="op" id="2438039">:</span><span class="op" id="2438040">]</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438048">if</span>&nbsp;<span class="ident" id="2438051">t</span><span class="op" id="2438052">[</span><span class="num" id="2438053">0</span><span class="op" id="2438054">]</span>&nbsp;<span class="op" id="2438056">&lt;</span>&nbsp;<span class="ident" id="2438058">utf8</span><span class="op" id="2438062">.</span><span class="ident" id="2438063">RuneSelf</span>&nbsp;<span class="op" id="2438072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2438077">tr</span><span class="op" id="2438079">,</span>&nbsp;<span class="ident" id="2438081">t</span>&nbsp;<span class="op" id="2438083">=</span>&nbsp;<span class="builtintype" id="2438085">rune</span><span class="op" id="2438089">(</span><span class="ident" id="2438090">t</span><span class="op" id="2438091">[</span><span class="num" id="2438092">0</span><span class="op" id="2438093">]</span><span class="op" id="2438094">)</span><span class="op" id="2438095">,</span>&nbsp;<span class="ident" id="2438097">t</span><span class="op" id="2438098">[</span><span class="num" id="2438099">1</span><span class="op" id="2438100">:</span><span class="op" id="2438101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438105">}</span>&nbsp;<span class="keyword" id="2438107">else</span>&nbsp;<span class="op" id="2438112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2438117">r</span><span class="op" id="2438118">,</span>&nbsp;<span class="ident" id="2438120">size</span>&nbsp;<span class="op" id="2438125">:=</span>&nbsp;<span class="ident" id="2438128">utf8</span><span class="op" id="2438132">.</span><span class="ident" id="2438133">DecodeRuneInString</span><span class="op" id="2438151">(</span><span class="ident" id="2438152">t</span><span class="op" id="2438153">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2438158">tr</span><span class="op" id="2438160">,</span>&nbsp;<span class="ident" id="2438162">t</span>&nbsp;<span class="op" id="2438164">=</span>&nbsp;<span class="ident" id="2438166">r</span><span class="op" id="2438167">,</span>&nbsp;<span class="ident" id="2438169">t</span><span class="op" id="2438170">[</span><span class="ident" id="2438171">size</span><span class="op" id="2438175">:</span><span class="op" id="2438176">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2438185">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2438240">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438256">if</span>&nbsp;<span class="ident" id="2438259">tr</span>&nbsp;<span class="op" id="2438262">==</span>&nbsp;<span class="ident" id="2438265">sr</span>&nbsp;<span class="op" id="2438268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438273">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2438289">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438333">if</span>&nbsp;<span class="ident" id="2438336">tr</span>&nbsp;<span class="op" id="2438339">&lt;</span>&nbsp;<span class="ident" id="2438341">sr</span>&nbsp;<span class="op" id="2438344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2438349">tr</span><span class="op" id="2438351">,</span>&nbsp;<span class="ident" id="2438353">sr</span>&nbsp;<span class="op" id="2438356">=</span>&nbsp;<span class="ident" id="2438358">sr</span><span class="op" id="2438360">,</span>&nbsp;<span class="ident" id="2438362">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2438371">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438398">if</span>&nbsp;<span class="ident" id="2438401">tr</span>&nbsp;<span class="op" id="2438404">&lt;</span>&nbsp;<span class="ident" id="2438406">utf8</span><span class="op" id="2438410">.</span><span class="ident" id="2438411">RuneSelf</span>&nbsp;<span class="op" id="2438420">&amp;&amp;</span>&nbsp;<span class="string" id="2438423">&#39;A&#39;</span>&nbsp;<span class="op" id="2438427">&lt;=</span>&nbsp;<span class="ident" id="2438430">sr</span>&nbsp;<span class="op" id="2438433">&amp;&amp;</span>&nbsp;<span class="ident" id="2438436">sr</span>&nbsp;<span class="op" id="2438439">&lt;=</span>&nbsp;<span class="string" id="2438442">&#39;Z&#39;</span>&nbsp;<span class="op" id="2438446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2438451">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438510">if</span>&nbsp;<span class="ident" id="2438513">tr</span>&nbsp;<span class="op" id="2438516">==</span>&nbsp;<span class="ident" id="2438519">sr</span><span class="op" id="2438521">+</span><span class="string" id="2438522">&#39;a&#39;</span><span class="op" id="2438525">-</span><span class="string" id="2438526">&#39;A&#39;</span>&nbsp;<span class="op" id="2438530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438536">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438548">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438553">return</span>&nbsp;<span class="builtintype" id="2438560">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2438573">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2438644">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2438684">r</span>&nbsp;<span class="op" id="2438686">:=</span>&nbsp;<span class="ident" id="2438689">unicode</span><span class="op" id="2438696">.</span><span class="ident" id="2438697">SimpleFold</span><span class="op" id="2438707">(</span><span class="ident" id="2438708">sr</span><span class="op" id="2438710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438714">for</span>&nbsp;<span class="ident" id="2438718">r</span>&nbsp;<span class="op" id="2438720">!=</span>&nbsp;<span class="ident" id="2438723">sr</span>&nbsp;<span class="op" id="2438726">&amp;&amp;</span>&nbsp;<span class="ident" id="2438729">r</span>&nbsp;<span class="op" id="2438731">&lt;</span>&nbsp;<span class="ident" id="2438733">tr</span>&nbsp;<span class="op" id="2438736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2438741">r</span>&nbsp;<span class="op" id="2438743">=</span>&nbsp;<span class="ident" id="2438745">unicode</span><span class="op" id="2438752">.</span><span class="ident" id="2438753">SimpleFold</span><span class="op" id="2438763">(</span><span class="ident" id="2438764">r</span><span class="op" id="2438765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438773">if</span>&nbsp;<span class="ident" id="2438776">r</span>&nbsp;<span class="op" id="2438778">==</span>&nbsp;<span class="ident" id="2438781">tr</span>&nbsp;<span class="op" id="2438784">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438789">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438804">return</span>&nbsp;<span class="builtintype" id="2438811">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2438822">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438858">return</span>&nbsp;<span class="ident" id="2438865">s</span>&nbsp;<span class="op" id="2438867">==</span>&nbsp;<span class="ident" id="2438870">t</span><br>
<span class="lineno"></span><span class="op" id="2438872">}</span>
</div>
</body>
</html>
