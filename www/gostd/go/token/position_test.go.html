<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7002823">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7002878">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7002932">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7002983">package</span>&nbsp;<span class="ident" id="7002991">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7002998">import</span>&nbsp;<span class="op" id="7003005">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003008">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003015">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003028">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7003036">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7003046">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7003049">func</span>&nbsp;<span class="ident" id="7003054">checkPos</span><span class="op" id="7003062">(</span><span class="ident" id="7003063">t</span>&nbsp;<span class="op" id="7003065">*</span><span class="ident" id="7003066">testing</span><span class="op" id="7003073">.</span><span class="ident" id="7003074">T</span><span class="op" id="7003075">,</span>&nbsp;<span class="ident" id="7003077">msg</span>&nbsp;<span class="builtintype" id="7003081">string</span><span class="op" id="7003087">,</span>&nbsp;<span class="ident" id="7003089">got</span><span class="op" id="7003092">,</span>&nbsp;<span class="ident" id="7003094">want</span>&nbsp;<span class="ident" id="7003099">Position</span><span class="op" id="7003107">)</span>&nbsp;<span class="op" id="7003109">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7003112">if</span>&nbsp;<span class="ident" id="7003115">got</span><span class="op" id="7003118">.</span><span class="ident" id="7003119">Filename</span>&nbsp;<span class="op" id="7003128">!=</span>&nbsp;<span class="ident" id="7003131">want</span><span class="op" id="7003135">.</span><span class="ident" id="7003136">Filename</span>&nbsp;<span class="op" id="7003145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003149">t</span><span class="op" id="7003150">.</span><span class="ident" id="7003151">Errorf</span><span class="op" id="7003157">(</span><span class="string" id="7003158">&#34;%s:&nbsp;got&nbsp;filename&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7003190">,</span>&nbsp;<span class="ident" id="7003192">msg</span><span class="op" id="7003195">,</span>&nbsp;<span class="ident" id="7003197">got</span><span class="op" id="7003200">.</span><span class="ident" id="7003201">Filename</span><span class="op" id="7003209">,</span>&nbsp;<span class="ident" id="7003211">want</span><span class="op" id="7003215">.</span><span class="ident" id="7003216">Filename</span><span class="op" id="7003224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7003230">if</span>&nbsp;<span class="ident" id="7003233">got</span><span class="op" id="7003236">.</span><span class="ident" id="7003237">Offset</span>&nbsp;<span class="op" id="7003244">!=</span>&nbsp;<span class="ident" id="7003247">want</span><span class="op" id="7003251">.</span><span class="ident" id="7003252">Offset</span>&nbsp;<span class="op" id="7003259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003263">t</span><span class="op" id="7003264">.</span><span class="ident" id="7003265">Errorf</span><span class="op" id="7003271">(</span><span class="string" id="7003272">&#34;%s:&nbsp;got&nbsp;offset&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7003302">,</span>&nbsp;<span class="ident" id="7003304">msg</span><span class="op" id="7003307">,</span>&nbsp;<span class="ident" id="7003309">got</span><span class="op" id="7003312">.</span><span class="ident" id="7003313">Offset</span><span class="op" id="7003319">,</span>&nbsp;<span class="ident" id="7003321">want</span><span class="op" id="7003325">.</span><span class="ident" id="7003326">Offset</span><span class="op" id="7003332">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7003338">if</span>&nbsp;<span class="ident" id="7003341">got</span><span class="op" id="7003344">.</span><span class="ident" id="7003345">Line</span>&nbsp;<span class="op" id="7003350">!=</span>&nbsp;<span class="ident" id="7003353">want</span><span class="op" id="7003357">.</span><span class="ident" id="7003358">Line</span>&nbsp;<span class="op" id="7003363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003367">t</span><span class="op" id="7003368">.</span><span class="ident" id="7003369">Errorf</span><span class="op" id="7003375">(</span><span class="string" id="7003376">&#34;%s:&nbsp;got&nbsp;line&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7003404">,</span>&nbsp;<span class="ident" id="7003406">msg</span><span class="op" id="7003409">,</span>&nbsp;<span class="ident" id="7003411">got</span><span class="op" id="7003414">.</span><span class="ident" id="7003415">Line</span><span class="op" id="7003419">,</span>&nbsp;<span class="ident" id="7003421">want</span><span class="op" id="7003425">.</span><span class="ident" id="7003426">Line</span><span class="op" id="7003430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7003436">if</span>&nbsp;<span class="ident" id="7003439">got</span><span class="op" id="7003442">.</span><span class="ident" id="7003443">Column</span>&nbsp;<span class="op" id="7003450">!=</span>&nbsp;<span class="ident" id="7003453">want</span><span class="op" id="7003457">.</span><span class="ident" id="7003458">Column</span>&nbsp;<span class="op" id="7003465">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003469">t</span><span class="op" id="7003470">.</span><span class="ident" id="7003471">Errorf</span><span class="op" id="7003477">(</span><span class="string" id="7003478">&#34;%s:&nbsp;got&nbsp;column&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7003508">,</span>&nbsp;<span class="ident" id="7003510">msg</span><span class="op" id="7003513">,</span>&nbsp;<span class="ident" id="7003515">got</span><span class="op" id="7003518">.</span><span class="ident" id="7003519">Column</span><span class="op" id="7003525">,</span>&nbsp;<span class="ident" id="7003527">want</span><span class="op" id="7003531">.</span><span class="ident" id="7003532">Column</span><span class="op" id="7003538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003541">}</span><br>
<span class="lineno"></span><span class="op" id="7003543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7003546">func</span>&nbsp;<span class="ident" id="7003551">TestNoPos</span><span class="op" id="7003560">(</span><span class="ident" id="7003561">t</span>&nbsp;<span class="op" id="7003563">*</span><span class="ident" id="7003564">testing</span><span class="op" id="7003571">.</span><span class="ident" id="7003572">T</span><span class="op" id="7003573">)</span>&nbsp;<span class="op" id="7003575">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7003578">if</span>&nbsp;<span class="ident" id="7003581">NoPos</span><span class="op" id="7003586">.</span><span class="ident" id="7003587">IsValid</span><span class="op" id="7003594">(</span><span class="op" id="7003595">)</span>&nbsp;<span class="op" id="7003597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003601">t</span><span class="op" id="7003602">.</span><span class="ident" id="7003603">Errorf</span><span class="op" id="7003609">(</span><span class="string" id="7003610">&#34;NoPos&nbsp;should&nbsp;not&nbsp;be&nbsp;valid&#34;</span><span class="op" id="7003637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7003643">var</span>&nbsp;<span class="ident" id="7003647">fset</span>&nbsp;<span class="op" id="7003652">*</span><span class="ident" id="7003653">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003662">checkPos</span><span class="op" id="7003670">(</span><span class="ident" id="7003671">t</span><span class="op" id="7003672">,</span>&nbsp;<span class="string" id="7003674">&#34;nil&nbsp;NoPos&#34;</span><span class="op" id="7003685">,</span>&nbsp;<span class="ident" id="7003687">fset</span><span class="op" id="7003691">.</span><span class="ident" id="7003692">Position</span><span class="op" id="7003700">(</span><span class="ident" id="7003701">NoPos</span><span class="op" id="7003706">)</span><span class="op" id="7003707">,</span>&nbsp;<span class="ident" id="7003709">Position</span><span class="op" id="7003717">{</span><span class="op" id="7003718">}</span><span class="op" id="7003719">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003722">fset</span>&nbsp;<span class="op" id="7003727">=</span>&nbsp;<span class="ident" id="7003729">NewFileSet</span><span class="op" id="7003739">(</span><span class="op" id="7003740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003743">checkPos</span><span class="op" id="7003751">(</span><span class="ident" id="7003752">t</span><span class="op" id="7003753">,</span>&nbsp;<span class="string" id="7003755">&#34;fset&nbsp;NoPos&#34;</span><span class="op" id="7003767">,</span>&nbsp;<span class="ident" id="7003769">fset</span><span class="op" id="7003773">.</span><span class="ident" id="7003774">Position</span><span class="op" id="7003782">(</span><span class="ident" id="7003783">NoPos</span><span class="op" id="7003788">)</span><span class="op" id="7003789">,</span>&nbsp;<span class="ident" id="7003791">Position</span><span class="op" id="7003799">{</span><span class="op" id="7003800">}</span><span class="op" id="7003801">)</span><br>
<span class="lineno"></span><span class="op" id="7003803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7003806">var</span>&nbsp;<span class="ident" id="7003810">tests</span>&nbsp;<span class="op" id="7003816">=</span>&nbsp;<span class="op" id="7003818">[</span><span class="op" id="7003819">]</span><span class="keyword" id="7003820">struct</span>&nbsp;<span class="op" id="7003827">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003830">filename</span>&nbsp;<span class="builtintype" id="7003839">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003847">source</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7003856">[</span><span class="op" id="7003857">]</span><span class="builtintype" id="7003858">byte</span>&nbsp;<span class="comment" id="7003863">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003878">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7003887">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7003892">lines</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7003901">[</span><span class="op" id="7003902">]</span><span class="builtintype" id="7003903">int</span><br>
<span class="lineno"></span><span class="op" id="7003907">}</span><span class="op" id="7003908">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003911">{</span><span class="string" id="7003912">&#34;a&#34;</span><span class="op" id="7003915">,</span>&nbsp;<span class="op" id="7003917">[</span><span class="op" id="7003918">]</span><span class="builtintype" id="7003919">byte</span><span class="op" id="7003923">{</span><span class="op" id="7003924">}</span><span class="op" id="7003925">,</span>&nbsp;<span class="num" id="7003927">0</span><span class="op" id="7003928">,</span>&nbsp;<span class="op" id="7003930">[</span><span class="op" id="7003931">]</span><span class="builtintype" id="7003932">int</span><span class="op" id="7003935">{</span><span class="op" id="7003936">}</span><span class="op" id="7003937">}</span><span class="op" id="7003938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003941">{</span><span class="string" id="7003942">&#34;b&#34;</span><span class="op" id="7003945">,</span>&nbsp;<span class="op" id="7003947">[</span><span class="op" id="7003948">]</span><span class="builtintype" id="7003949">byte</span><span class="op" id="7003953">(</span><span class="string" id="7003954">&#34;01234&#34;</span><span class="op" id="7003961">)</span><span class="op" id="7003962">,</span>&nbsp;<span class="num" id="7003964">5</span><span class="op" id="7003965">,</span>&nbsp;<span class="op" id="7003967">[</span><span class="op" id="7003968">]</span><span class="builtintype" id="7003969">int</span><span class="op" id="7003972">{</span><span class="num" id="7003973">0</span><span class="op" id="7003974">}</span><span class="op" id="7003975">}</span><span class="op" id="7003976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7003979">{</span><span class="string" id="7003980">&#34;c&#34;</span><span class="op" id="7003983">,</span>&nbsp;<span class="op" id="7003985">[</span><span class="op" id="7003986">]</span><span class="builtintype" id="7003987">byte</span><span class="op" id="7003991">(</span><span class="string" id="7003992">&#34;\n\n\n\n\n\n\n\n\n&#34;</span><span class="op" id="7004012">)</span><span class="op" id="7004013">,</span>&nbsp;<span class="num" id="7004015">9</span><span class="op" id="7004016">,</span>&nbsp;<span class="op" id="7004018">[</span><span class="op" id="7004019">]</span><span class="builtintype" id="7004020">int</span><span class="op" id="7004023">{</span><span class="num" id="7004024">0</span><span class="op" id="7004025">,</span>&nbsp;<span class="num" id="7004027">1</span><span class="op" id="7004028">,</span>&nbsp;<span class="num" id="7004030">2</span><span class="op" id="7004031">,</span>&nbsp;<span class="num" id="7004033">3</span><span class="op" id="7004034">,</span>&nbsp;<span class="num" id="7004036">4</span><span class="op" id="7004037">,</span>&nbsp;<span class="num" id="7004039">5</span><span class="op" id="7004040">,</span>&nbsp;<span class="num" id="7004042">6</span><span class="op" id="7004043">,</span>&nbsp;<span class="num" id="7004045">7</span><span class="op" id="7004046">,</span>&nbsp;<span class="num" id="7004048">8</span><span class="op" id="7004049">}</span><span class="op" id="7004050">}</span><span class="op" id="7004051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004054">{</span><span class="string" id="7004055">&#34;d&#34;</span><span class="op" id="7004058">,</span>&nbsp;<span class="ident" id="7004060">nil</span><span class="op" id="7004063">,</span>&nbsp;<span class="num" id="7004065">100</span><span class="op" id="7004068">,</span>&nbsp;<span class="op" id="7004070">[</span><span class="op" id="7004071">]</span><span class="builtintype" id="7004072">int</span><span class="op" id="7004075">{</span><span class="num" id="7004076">0</span><span class="op" id="7004077">,</span>&nbsp;<span class="num" id="7004079">5</span><span class="op" id="7004080">,</span>&nbsp;<span class="num" id="7004082">10</span><span class="op" id="7004084">,</span>&nbsp;<span class="num" id="7004086">20</span><span class="op" id="7004088">,</span>&nbsp;<span class="num" id="7004090">30</span><span class="op" id="7004092">,</span>&nbsp;<span class="num" id="7004094">70</span><span class="op" id="7004096">,</span>&nbsp;<span class="num" id="7004098">71</span><span class="op" id="7004100">,</span>&nbsp;<span class="num" id="7004102">72</span><span class="op" id="7004104">,</span>&nbsp;<span class="num" id="7004106">80</span><span class="op" id="7004108">,</span>&nbsp;<span class="num" id="7004110">85</span><span class="op" id="7004112">,</span>&nbsp;<span class="num" id="7004114">90</span><span class="op" id="7004116">,</span>&nbsp;<span class="num" id="7004118">99</span><span class="op" id="7004120">}</span><span class="op" id="7004121">}</span><span class="op" id="7004122">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004125">{</span><span class="string" id="7004126">&#34;e&#34;</span><span class="op" id="7004129">,</span>&nbsp;<span class="ident" id="7004131">nil</span><span class="op" id="7004134">,</span>&nbsp;<span class="num" id="7004136">777</span><span class="op" id="7004139">,</span>&nbsp;<span class="op" id="7004141">[</span><span class="op" id="7004142">]</span><span class="builtintype" id="7004143">int</span><span class="op" id="7004146">{</span><span class="num" id="7004147">0</span><span class="op" id="7004148">,</span>&nbsp;<span class="num" id="7004150">80</span><span class="op" id="7004152">,</span>&nbsp;<span class="num" id="7004154">100</span><span class="op" id="7004157">,</span>&nbsp;<span class="num" id="7004159">120</span><span class="op" id="7004162">,</span>&nbsp;<span class="num" id="7004164">130</span><span class="op" id="7004167">,</span>&nbsp;<span class="num" id="7004169">180</span><span class="op" id="7004172">,</span>&nbsp;<span class="num" id="7004174">267</span><span class="op" id="7004177">,</span>&nbsp;<span class="num" id="7004179">455</span><span class="op" id="7004182">,</span>&nbsp;<span class="num" id="7004184">500</span><span class="op" id="7004187">,</span>&nbsp;<span class="num" id="7004189">567</span><span class="op" id="7004192">,</span>&nbsp;<span class="num" id="7004194">620</span><span class="op" id="7004197">}</span><span class="op" id="7004198">}</span><span class="op" id="7004199">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004202">{</span><span class="string" id="7004203">&#34;f&#34;</span><span class="op" id="7004206">,</span>&nbsp;<span class="op" id="7004208">[</span><span class="op" id="7004209">]</span><span class="builtintype" id="7004210">byte</span><span class="op" id="7004214">(</span><span class="string" id="7004215">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;&#34;</span><span class="op" id="7004244">)</span><span class="op" id="7004245">,</span>&nbsp;<span class="num" id="7004247">23</span><span class="op" id="7004249">,</span>&nbsp;<span class="op" id="7004251">[</span><span class="op" id="7004252">]</span><span class="builtintype" id="7004253">int</span><span class="op" id="7004256">{</span><span class="num" id="7004257">0</span><span class="op" id="7004258">,</span>&nbsp;<span class="num" id="7004260">10</span><span class="op" id="7004262">,</span>&nbsp;<span class="num" id="7004264">11</span><span class="op" id="7004266">}</span><span class="op" id="7004267">}</span><span class="op" id="7004268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004271">{</span><span class="string" id="7004272">&#34;g&#34;</span><span class="op" id="7004275">,</span>&nbsp;<span class="op" id="7004277">[</span><span class="op" id="7004278">]</span><span class="builtintype" id="7004279">byte</span><span class="op" id="7004283">(</span><span class="string" id="7004284">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&#34;</span><span class="op" id="7004315">)</span><span class="op" id="7004316">,</span>&nbsp;<span class="num" id="7004318">24</span><span class="op" id="7004320">,</span>&nbsp;<span class="op" id="7004322">[</span><span class="op" id="7004323">]</span><span class="builtintype" id="7004324">int</span><span class="op" id="7004327">{</span><span class="num" id="7004328">0</span><span class="op" id="7004329">,</span>&nbsp;<span class="num" id="7004331">10</span><span class="op" id="7004333">,</span>&nbsp;<span class="num" id="7004335">11</span><span class="op" id="7004337">}</span><span class="op" id="7004338">}</span><span class="op" id="7004339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004342">{</span><span class="string" id="7004343">&#34;h&#34;</span><span class="op" id="7004346">,</span>&nbsp;<span class="op" id="7004348">[</span><span class="op" id="7004349">]</span><span class="builtintype" id="7004350">byte</span><span class="op" id="7004354">(</span><span class="string" id="7004355">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&nbsp;&#34;</span><span class="op" id="7004387">)</span><span class="op" id="7004388">,</span>&nbsp;<span class="num" id="7004390">25</span><span class="op" id="7004392">,</span>&nbsp;<span class="op" id="7004394">[</span><span class="op" id="7004395">]</span><span class="builtintype" id="7004396">int</span><span class="op" id="7004399">{</span><span class="num" id="7004400">0</span><span class="op" id="7004401">,</span>&nbsp;<span class="num" id="7004403">10</span><span class="op" id="7004405">,</span>&nbsp;<span class="num" id="7004407">11</span><span class="op" id="7004409">,</span>&nbsp;<span class="num" id="7004411">24</span><span class="op" id="7004413">}</span><span class="op" id="7004414">}</span><span class="op" id="7004415">,</span><br>
<span class="lineno"></span><span class="op" id="7004417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7004420">func</span>&nbsp;<span class="ident" id="7004425">linecol</span><span class="op" id="7004432">(</span><span class="ident" id="7004433">lines</span>&nbsp;<span class="op" id="7004439">[</span><span class="op" id="7004440">]</span><span class="builtintype" id="7004441">int</span><span class="op" id="7004444">,</span>&nbsp;<span class="ident" id="7004446">offs</span>&nbsp;<span class="builtintype" id="7004451">int</span><span class="op" id="7004454">)</span>&nbsp;<span class="op" id="7004456">(</span><span class="builtintype" id="7004457">int</span><span class="op" id="7004460">,</span>&nbsp;<span class="builtintype" id="7004462">int</span><span class="op" id="7004465">)</span>&nbsp;<span class="op" id="7004467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004470">prevLineOffs</span>&nbsp;<span class="op" id="7004483">:=</span>&nbsp;<span class="num" id="7004486">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7004489">for</span>&nbsp;<span class="ident" id="7004493">line</span><span class="op" id="7004497">,</span>&nbsp;<span class="ident" id="7004499">lineOffs</span>&nbsp;<span class="op" id="7004508">:=</span>&nbsp;<span class="keyword" id="7004511">range</span>&nbsp;<span class="ident" id="7004517">lines</span>&nbsp;<span class="op" id="7004523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7004527">if</span>&nbsp;<span class="ident" id="7004530">offs</span>&nbsp;<span class="op" id="7004535">&lt;</span>&nbsp;<span class="ident" id="7004537">lineOffs</span>&nbsp;<span class="op" id="7004546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7004551">return</span>&nbsp;<span class="ident" id="7004558">line</span><span class="op" id="7004562">,</span>&nbsp;<span class="ident" id="7004564">offs</span>&nbsp;<span class="op" id="7004569">-</span>&nbsp;<span class="ident" id="7004571">prevLineOffs</span>&nbsp;<span class="op" id="7004584">+</span>&nbsp;<span class="num" id="7004586">1</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004594">prevLineOffs</span>&nbsp;<span class="op" id="7004607">=</span>&nbsp;<span class="ident" id="7004609">lineOffs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7004622">return</span>&nbsp;<span class="builtinfunc" id="7004629">len</span><span class="op" id="7004632">(</span><span class="ident" id="7004633">lines</span><span class="op" id="7004638">)</span><span class="op" id="7004639">,</span>&nbsp;<span class="ident" id="7004641">offs</span>&nbsp;<span class="op" id="7004646">-</span>&nbsp;<span class="ident" id="7004648">prevLineOffs</span>&nbsp;<span class="op" id="7004661">+</span>&nbsp;<span class="num" id="7004663">1</span><br>
<span class="lineno"></span><span class="op" id="7004665">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7004668">func</span>&nbsp;<span class="ident" id="7004673">verifyPositions</span><span class="op" id="7004688">(</span><span class="ident" id="7004689">t</span>&nbsp;<span class="op" id="7004691">*</span><span class="ident" id="7004692">testing</span><span class="op" id="7004699">.</span><span class="ident" id="7004700">T</span><span class="op" id="7004701">,</span>&nbsp;<span class="ident" id="7004703">fset</span>&nbsp;<span class="op" id="7004708">*</span><span class="ident" id="7004709">FileSet</span><span class="op" id="7004716">,</span>&nbsp;<span class="ident" id="7004718">f</span>&nbsp;<span class="op" id="7004720">*</span><span class="ident" id="7004721">File</span><span class="op" id="7004725">,</span>&nbsp;<span class="ident" id="7004727">lines</span>&nbsp;<span class="op" id="7004733">[</span><span class="op" id="7004734">]</span><span class="builtintype" id="7004735">int</span><span class="op" id="7004738">)</span>&nbsp;<span class="op" id="7004740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7004743">for</span>&nbsp;<span class="ident" id="7004747">offs</span>&nbsp;<span class="op" id="7004752">:=</span>&nbsp;<span class="num" id="7004755">0</span><span class="op" id="7004756">;</span>&nbsp;<span class="ident" id="7004758">offs</span>&nbsp;<span class="op" id="7004763">&lt;</span>&nbsp;<span class="ident" id="7004765">f</span><span class="op" id="7004766">.</span><span class="ident" id="7004767">Size</span><span class="op" id="7004771">(</span><span class="op" id="7004772">)</span><span class="op" id="7004773">;</span>&nbsp;<span class="ident" id="7004775">offs</span><span class="op" id="7004779">++</span>&nbsp;<span class="op" id="7004782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004786">p</span>&nbsp;<span class="op" id="7004788">:=</span>&nbsp;<span class="ident" id="7004791">f</span><span class="op" id="7004792">.</span><span class="ident" id="7004793">Pos</span><span class="op" id="7004796">(</span><span class="ident" id="7004797">offs</span><span class="op" id="7004801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004805">offs2</span>&nbsp;<span class="op" id="7004811">:=</span>&nbsp;<span class="ident" id="7004814">f</span><span class="op" id="7004815">.</span><span class="ident" id="7004816">Offset</span><span class="op" id="7004822">(</span><span class="ident" id="7004823">p</span><span class="op" id="7004824">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7004828">if</span>&nbsp;<span class="ident" id="7004831">offs2</span>&nbsp;<span class="op" id="7004837">!=</span>&nbsp;<span class="ident" id="7004840">offs</span>&nbsp;<span class="op" id="7004845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004850">t</span><span class="op" id="7004851">.</span><span class="ident" id="7004852">Errorf</span><span class="op" id="7004858">(</span><span class="string" id="7004859">&#34;%s,&nbsp;Offset:&nbsp;got&nbsp;offset&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7004895">,</span>&nbsp;<span class="ident" id="7004897">f</span><span class="op" id="7004898">.</span><span class="ident" id="7004899">Name</span><span class="op" id="7004903">(</span><span class="op" id="7004904">)</span><span class="op" id="7004905">,</span>&nbsp;<span class="ident" id="7004907">offs2</span><span class="op" id="7004912">,</span>&nbsp;<span class="ident" id="7004914">offs</span><span class="op" id="7004918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7004922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004926">line</span><span class="op" id="7004930">,</span>&nbsp;<span class="ident" id="7004932">col</span>&nbsp;<span class="op" id="7004936">:=</span>&nbsp;<span class="ident" id="7004939">linecol</span><span class="op" id="7004946">(</span><span class="ident" id="7004947">lines</span><span class="op" id="7004952">,</span>&nbsp;<span class="ident" id="7004954">offs</span><span class="op" id="7004958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7004962">msg</span>&nbsp;<span class="op" id="7004966">:=</span>&nbsp;<span class="ident" id="7004969">fmt</span><span class="op" id="7004972">.</span><span class="ident" id="7004973">Sprintf</span><span class="op" id="7004980">(</span><span class="string" id="7004981">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7005005">,</span>&nbsp;<span class="ident" id="7005007">f</span><span class="op" id="7005008">.</span><span class="ident" id="7005009">Name</span><span class="op" id="7005013">(</span><span class="op" id="7005014">)</span><span class="op" id="7005015">,</span>&nbsp;<span class="ident" id="7005017">offs</span><span class="op" id="7005021">,</span>&nbsp;<span class="ident" id="7005023">p</span><span class="op" id="7005024">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005028">checkPos</span><span class="op" id="7005036">(</span><span class="ident" id="7005037">t</span><span class="op" id="7005038">,</span>&nbsp;<span class="ident" id="7005040">msg</span><span class="op" id="7005043">,</span>&nbsp;<span class="ident" id="7005045">f</span><span class="op" id="7005046">.</span><span class="ident" id="7005047">Position</span><span class="op" id="7005055">(</span><span class="ident" id="7005056">f</span><span class="op" id="7005057">.</span><span class="ident" id="7005058">Pos</span><span class="op" id="7005061">(</span><span class="ident" id="7005062">offs</span><span class="op" id="7005066">)</span><span class="op" id="7005067">)</span><span class="op" id="7005068">,</span>&nbsp;<span class="ident" id="7005070">Position</span><span class="op" id="7005078">{</span><span class="ident" id="7005079">f</span><span class="op" id="7005080">.</span><span class="ident" id="7005081">Name</span><span class="op" id="7005085">(</span><span class="op" id="7005086">)</span><span class="op" id="7005087">,</span>&nbsp;<span class="ident" id="7005089">offs</span><span class="op" id="7005093">,</span>&nbsp;<span class="ident" id="7005095">line</span><span class="op" id="7005099">,</span>&nbsp;<span class="ident" id="7005101">col</span><span class="op" id="7005104">}</span><span class="op" id="7005105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005109">checkPos</span><span class="op" id="7005117">(</span><span class="ident" id="7005118">t</span><span class="op" id="7005119">,</span>&nbsp;<span class="ident" id="7005121">msg</span><span class="op" id="7005124">,</span>&nbsp;<span class="ident" id="7005126">fset</span><span class="op" id="7005130">.</span><span class="ident" id="7005131">Position</span><span class="op" id="7005139">(</span><span class="ident" id="7005140">p</span><span class="op" id="7005141">)</span><span class="op" id="7005142">,</span>&nbsp;<span class="ident" id="7005144">Position</span><span class="op" id="7005152">{</span><span class="ident" id="7005153">f</span><span class="op" id="7005154">.</span><span class="ident" id="7005155">Name</span><span class="op" id="7005159">(</span><span class="op" id="7005160">)</span><span class="op" id="7005161">,</span>&nbsp;<span class="ident" id="7005163">offs</span><span class="op" id="7005167">,</span>&nbsp;<span class="ident" id="7005169">line</span><span class="op" id="7005173">,</span>&nbsp;<span class="ident" id="7005175">col</span><span class="op" id="7005178">}</span><span class="op" id="7005179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7005182">}</span><br>
<span class="lineno"></span><span class="op" id="7005184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7005187">func</span>&nbsp;<span class="ident" id="7005192">makeTestSource</span><span class="op" id="7005206">(</span><span class="ident" id="7005207">size</span>&nbsp;<span class="builtintype" id="7005212">int</span><span class="op" id="7005215">,</span>&nbsp;<span class="ident" id="7005217">lines</span>&nbsp;<span class="op" id="7005223">[</span><span class="op" id="7005224">]</span><span class="builtintype" id="7005225">int</span><span class="op" id="7005228">)</span>&nbsp;<span class="op" id="7005230">[</span><span class="op" id="7005231">]</span><span class="builtintype" id="7005232">byte</span>&nbsp;<span class="op" id="7005237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005240">src</span>&nbsp;<span class="op" id="7005244">:=</span>&nbsp;<span class="builtinfunc" id="7005247">make</span><span class="op" id="7005251">(</span><span class="op" id="7005252">[</span><span class="op" id="7005253">]</span><span class="builtintype" id="7005254">byte</span><span class="op" id="7005258">,</span>&nbsp;<span class="ident" id="7005260">size</span><span class="op" id="7005264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7005267">for</span>&nbsp;<span class="ident" id="7005271">_</span><span class="op" id="7005272">,</span>&nbsp;<span class="ident" id="7005274">offs</span>&nbsp;<span class="op" id="7005279">:=</span>&nbsp;<span class="keyword" id="7005282">range</span>&nbsp;<span class="ident" id="7005288">lines</span>&nbsp;<span class="op" id="7005294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7005298">if</span>&nbsp;<span class="ident" id="7005301">offs</span>&nbsp;<span class="op" id="7005306">&gt;</span>&nbsp;<span class="num" id="7005308">0</span>&nbsp;<span class="op" id="7005310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005315">src</span><span class="op" id="7005318">[</span><span class="ident" id="7005319">offs</span><span class="op" id="7005323">-</span><span class="num" id="7005324">1</span><span class="op" id="7005325">]</span>&nbsp;<span class="op" id="7005327">=</span>&nbsp;<span class="string" id="7005329">&#39;\n&#39;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7005336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7005339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7005342">return</span>&nbsp;<span class="ident" id="7005349">src</span><br>
<span class="lineno"></span><span class="op" id="7005353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7005356">func</span>&nbsp;<span class="ident" id="7005361">TestPositions</span><span class="op" id="7005374">(</span><span class="ident" id="7005375">t</span>&nbsp;<span class="op" id="7005377">*</span><span class="ident" id="7005378">testing</span><span class="op" id="7005385">.</span><span class="ident" id="7005386">T</span><span class="op" id="7005387">)</span>&nbsp;<span class="op" id="7005389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7005392">const</span>&nbsp;<span class="ident" id="7005398">delta</span>&nbsp;<span class="op" id="7005404">=</span>&nbsp;<span class="num" id="7005406">7</span>&nbsp;<span class="comment" id="7005408">//&nbsp;a&nbsp;non-zero&nbsp;base&nbsp;offset&nbsp;increment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005445">fset</span>&nbsp;<span class="op" id="7005450">:=</span>&nbsp;<span class="ident" id="7005453">NewFileSet</span><span class="op" id="7005463">(</span><span class="op" id="7005464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7005467">for</span>&nbsp;<span class="ident" id="7005471">_</span><span class="op" id="7005472">,</span>&nbsp;<span class="ident" id="7005474">test</span>&nbsp;<span class="op" id="7005479">:=</span>&nbsp;<span class="keyword" id="7005482">range</span>&nbsp;<span class="ident" id="7005488">tests</span>&nbsp;<span class="op" id="7005494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7005498">//&nbsp;verify&nbsp;consistency&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7005535">if</span>&nbsp;<span class="ident" id="7005538">test</span><span class="op" id="7005542">.</span><span class="ident" id="7005543">source</span>&nbsp;<span class="op" id="7005550">!=</span>&nbsp;<span class="ident" id="7005553">nil</span>&nbsp;<span class="op" id="7005557">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7005560">len</span><span class="op" id="7005563">(</span><span class="ident" id="7005564">test</span><span class="op" id="7005568">.</span><span class="ident" id="7005569">source</span><span class="op" id="7005575">)</span>&nbsp;<span class="op" id="7005577">!=</span>&nbsp;<span class="ident" id="7005580">test</span><span class="op" id="7005584">.</span><span class="ident" id="7005585">size</span>&nbsp;<span class="op" id="7005590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005595">t</span><span class="op" id="7005596">.</span><span class="ident" id="7005597">Errorf</span><span class="op" id="7005603">(</span><span class="string" id="7005604">&#34;%s:&nbsp;inconsistent&nbsp;test&nbsp;case:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7005659">,</span>&nbsp;<span class="ident" id="7005661">test</span><span class="op" id="7005665">.</span><span class="ident" id="7005666">filename</span><span class="op" id="7005674">,</span>&nbsp;<span class="builtinfunc" id="7005676">len</span><span class="op" id="7005679">(</span><span class="ident" id="7005680">test</span><span class="op" id="7005684">.</span><span class="ident" id="7005685">source</span><span class="op" id="7005691">)</span><span class="op" id="7005692">,</span>&nbsp;<span class="ident" id="7005694">test</span><span class="op" id="7005698">.</span><span class="ident" id="7005699">size</span><span class="op" id="7005703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7005707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7005712">//&nbsp;add&nbsp;file&nbsp;and&nbsp;verify&nbsp;name&nbsp;and&nbsp;size</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005751">f</span>&nbsp;<span class="op" id="7005753">:=</span>&nbsp;<span class="ident" id="7005756">fset</span><span class="op" id="7005760">.</span><span class="ident" id="7005761">AddFile</span><span class="op" id="7005768">(</span><span class="ident" id="7005769">test</span><span class="op" id="7005773">.</span><span class="ident" id="7005774">filename</span><span class="op" id="7005782">,</span>&nbsp;<span class="ident" id="7005784">fset</span><span class="op" id="7005788">.</span><span class="ident" id="7005789">Base</span><span class="op" id="7005793">(</span><span class="op" id="7005794">)</span><span class="op" id="7005795">+</span><span class="ident" id="7005796">delta</span><span class="op" id="7005801">,</span>&nbsp;<span class="ident" id="7005803">test</span><span class="op" id="7005807">.</span><span class="ident" id="7005808">size</span><span class="op" id="7005812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7005816">if</span>&nbsp;<span class="ident" id="7005819">f</span><span class="op" id="7005820">.</span><span class="ident" id="7005821">Name</span><span class="op" id="7005825">(</span><span class="op" id="7005826">)</span>&nbsp;<span class="op" id="7005828">!=</span>&nbsp;<span class="ident" id="7005831">test</span><span class="op" id="7005835">.</span><span class="ident" id="7005836">filename</span>&nbsp;<span class="op" id="7005845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005850">t</span><span class="op" id="7005851">.</span><span class="ident" id="7005852">Errorf</span><span class="op" id="7005858">(</span><span class="string" id="7005859">&#34;got&nbsp;filename&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7005885">,</span>&nbsp;<span class="ident" id="7005887">f</span><span class="op" id="7005888">.</span><span class="ident" id="7005889">Name</span><span class="op" id="7005893">(</span><span class="op" id="7005894">)</span><span class="op" id="7005895">,</span>&nbsp;<span class="ident" id="7005897">test</span><span class="op" id="7005901">.</span><span class="ident" id="7005902">filename</span><span class="op" id="7005910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7005914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7005918">if</span>&nbsp;<span class="ident" id="7005921">f</span><span class="op" id="7005922">.</span><span class="ident" id="7005923">Size</span><span class="op" id="7005927">(</span><span class="op" id="7005928">)</span>&nbsp;<span class="op" id="7005930">!=</span>&nbsp;<span class="ident" id="7005933">test</span><span class="op" id="7005937">.</span><span class="ident" id="7005938">size</span>&nbsp;<span class="op" id="7005943">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7005948">t</span><span class="op" id="7005949">.</span><span class="ident" id="7005950">Errorf</span><span class="op" id="7005956">(</span><span class="string" id="7005957">&#34;%s:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7005988">,</span>&nbsp;<span class="ident" id="7005990">f</span><span class="op" id="7005991">.</span><span class="ident" id="7005992">Name</span><span class="op" id="7005996">(</span><span class="op" id="7005997">)</span><span class="op" id="7005998">,</span>&nbsp;<span class="ident" id="7006000">f</span><span class="op" id="7006001">.</span><span class="ident" id="7006002">Size</span><span class="op" id="7006006">(</span><span class="op" id="7006007">)</span><span class="op" id="7006008">,</span>&nbsp;<span class="ident" id="7006010">test</span><span class="op" id="7006014">.</span><span class="ident" id="7006015">size</span><span class="op" id="7006019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006027">if</span>&nbsp;<span class="ident" id="7006030">fset</span><span class="op" id="7006034">.</span><span class="ident" id="7006035">File</span><span class="op" id="7006039">(</span><span class="ident" id="7006040">f</span><span class="op" id="7006041">.</span><span class="ident" id="7006042">Pos</span><span class="op" id="7006045">(</span><span class="num" id="7006046">0</span><span class="op" id="7006047">)</span><span class="op" id="7006048">)</span>&nbsp;<span class="op" id="7006050">!=</span>&nbsp;<span class="ident" id="7006053">f</span>&nbsp;<span class="op" id="7006055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006060">t</span><span class="op" id="7006061">.</span><span class="ident" id="7006062">Errorf</span><span class="op" id="7006068">(</span><span class="string" id="7006069">&#34;%s:&nbsp;f.Pos(0)&nbsp;was&nbsp;not&nbsp;found&nbsp;in&nbsp;f&#34;</span><span class="op" id="7006102">,</span>&nbsp;<span class="ident" id="7006104">f</span><span class="op" id="7006105">.</span><span class="ident" id="7006106">Name</span><span class="op" id="7006110">(</span><span class="op" id="7006111">)</span><span class="op" id="7006112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006116">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7006121">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006174">for</span>&nbsp;<span class="ident" id="7006178">i</span><span class="op" id="7006179">,</span>&nbsp;<span class="ident" id="7006181">offset</span>&nbsp;<span class="op" id="7006188">:=</span>&nbsp;<span class="keyword" id="7006191">range</span>&nbsp;<span class="ident" id="7006197">test</span><span class="op" id="7006201">.</span><span class="ident" id="7006202">lines</span>&nbsp;<span class="op" id="7006208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006213">f</span><span class="op" id="7006214">.</span><span class="ident" id="7006215">AddLine</span><span class="op" id="7006222">(</span><span class="ident" id="7006223">offset</span><span class="op" id="7006229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006234">if</span>&nbsp;<span class="ident" id="7006237">f</span><span class="op" id="7006238">.</span><span class="ident" id="7006239">LineCount</span><span class="op" id="7006248">(</span><span class="op" id="7006249">)</span>&nbsp;<span class="op" id="7006251">!=</span>&nbsp;<span class="ident" id="7006254">i</span><span class="op" id="7006255">+</span><span class="num" id="7006256">1</span>&nbsp;<span class="op" id="7006258">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006264">t</span><span class="op" id="7006265">.</span><span class="ident" id="7006266">Errorf</span><span class="op" id="7006272">(</span><span class="string" id="7006273">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7006314">,</span>&nbsp;<span class="ident" id="7006316">f</span><span class="op" id="7006317">.</span><span class="ident" id="7006318">Name</span><span class="op" id="7006322">(</span><span class="op" id="7006323">)</span><span class="op" id="7006324">,</span>&nbsp;<span class="ident" id="7006326">f</span><span class="op" id="7006327">.</span><span class="ident" id="7006328">LineCount</span><span class="op" id="7006337">(</span><span class="op" id="7006338">)</span><span class="op" id="7006339">,</span>&nbsp;<span class="ident" id="7006341">i</span><span class="op" id="7006342">+</span><span class="num" id="7006343">1</span><span class="op" id="7006344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7006354">//&nbsp;adding&nbsp;the&nbsp;same&nbsp;offset&nbsp;again&nbsp;should&nbsp;be&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006407">f</span><span class="op" id="7006408">.</span><span class="ident" id="7006409">AddLine</span><span class="op" id="7006416">(</span><span class="ident" id="7006417">offset</span><span class="op" id="7006423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006428">if</span>&nbsp;<span class="ident" id="7006431">f</span><span class="op" id="7006432">.</span><span class="ident" id="7006433">LineCount</span><span class="op" id="7006442">(</span><span class="op" id="7006443">)</span>&nbsp;<span class="op" id="7006445">!=</span>&nbsp;<span class="ident" id="7006448">i</span><span class="op" id="7006449">+</span><span class="num" id="7006450">1</span>&nbsp;<span class="op" id="7006452">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006458">t</span><span class="op" id="7006459">.</span><span class="ident" id="7006460">Errorf</span><span class="op" id="7006466">(</span><span class="string" id="7006467">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;unchanged&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7006518">,</span>&nbsp;<span class="ident" id="7006520">f</span><span class="op" id="7006521">.</span><span class="ident" id="7006522">Name</span><span class="op" id="7006526">(</span><span class="op" id="7006527">)</span><span class="op" id="7006528">,</span>&nbsp;<span class="ident" id="7006530">f</span><span class="op" id="7006531">.</span><span class="ident" id="7006532">LineCount</span><span class="op" id="7006541">(</span><span class="op" id="7006542">)</span><span class="op" id="7006543">,</span>&nbsp;<span class="ident" id="7006545">i</span><span class="op" id="7006546">+</span><span class="num" id="7006547">1</span><span class="op" id="7006548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006558">verifyPositions</span><span class="op" id="7006573">(</span><span class="ident" id="7006574">t</span><span class="op" id="7006575">,</span>&nbsp;<span class="ident" id="7006577">fset</span><span class="op" id="7006581">,</span>&nbsp;<span class="ident" id="7006583">f</span><span class="op" id="7006584">,</span>&nbsp;<span class="ident" id="7006586">test</span><span class="op" id="7006590">.</span><span class="ident" id="7006591">lines</span><span class="op" id="7006596">[</span><span class="num" id="7006597">0</span><span class="op" id="7006598">:</span><span class="ident" id="7006599">i</span><span class="op" id="7006600">+</span><span class="num" id="7006601">1</span><span class="op" id="7006602">]</span><span class="op" id="7006603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7006612">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLines&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006666">if</span>&nbsp;<span class="ident" id="7006669">ok</span>&nbsp;<span class="op" id="7006672">:=</span>&nbsp;<span class="ident" id="7006675">f</span><span class="op" id="7006676">.</span><span class="ident" id="7006677">SetLines</span><span class="op" id="7006685">(</span><span class="ident" id="7006686">test</span><span class="op" id="7006690">.</span><span class="ident" id="7006691">lines</span><span class="op" id="7006696">)</span><span class="op" id="7006697">;</span>&nbsp;<span class="op" id="7006699">!</span><span class="ident" id="7006700">ok</span>&nbsp;<span class="op" id="7006703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006708">t</span><span class="op" id="7006709">.</span><span class="ident" id="7006710">Errorf</span><span class="op" id="7006716">(</span><span class="string" id="7006717">&#34;%s:&nbsp;SetLines&nbsp;failed&#34;</span><span class="op" id="7006738">,</span>&nbsp;<span class="ident" id="7006740">f</span><span class="op" id="7006741">.</span><span class="ident" id="7006742">Name</span><span class="op" id="7006746">(</span><span class="op" id="7006747">)</span><span class="op" id="7006748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7006756">if</span>&nbsp;<span class="ident" id="7006759">f</span><span class="op" id="7006760">.</span><span class="ident" id="7006761">LineCount</span><span class="op" id="7006770">(</span><span class="op" id="7006771">)</span>&nbsp;<span class="op" id="7006773">!=</span>&nbsp;<span class="builtinfunc" id="7006776">len</span><span class="op" id="7006779">(</span><span class="ident" id="7006780">test</span><span class="op" id="7006784">.</span><span class="ident" id="7006785">lines</span><span class="op" id="7006790">)</span>&nbsp;<span class="op" id="7006792">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006797">t</span><span class="op" id="7006798">.</span><span class="ident" id="7006799">Errorf</span><span class="op" id="7006805">(</span><span class="string" id="7006806">&#34;%s,&nbsp;SetLines:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7006848">,</span>&nbsp;<span class="ident" id="7006850">f</span><span class="op" id="7006851">.</span><span class="ident" id="7006852">Name</span><span class="op" id="7006856">(</span><span class="op" id="7006857">)</span><span class="op" id="7006858">,</span>&nbsp;<span class="ident" id="7006860">f</span><span class="op" id="7006861">.</span><span class="ident" id="7006862">LineCount</span><span class="op" id="7006871">(</span><span class="op" id="7006872">)</span><span class="op" id="7006873">,</span>&nbsp;<span class="builtinfunc" id="7006875">len</span><span class="op" id="7006878">(</span><span class="ident" id="7006879">test</span><span class="op" id="7006883">.</span><span class="ident" id="7006884">lines</span><span class="op" id="7006889">)</span><span class="op" id="7006890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7006894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7006898">verifyPositions</span><span class="op" id="7006913">(</span><span class="ident" id="7006914">t</span><span class="op" id="7006915">,</span>&nbsp;<span class="ident" id="7006917">fset</span><span class="op" id="7006921">,</span>&nbsp;<span class="ident" id="7006923">f</span><span class="op" id="7006924">,</span>&nbsp;<span class="ident" id="7006926">test</span><span class="op" id="7006930">.</span><span class="ident" id="7006931">lines</span><span class="op" id="7006936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7006941">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLinesForContent&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007005">src</span>&nbsp;<span class="op" id="7007009">:=</span>&nbsp;<span class="ident" id="7007012">test</span><span class="op" id="7007016">.</span><span class="ident" id="7007017">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7007026">if</span>&nbsp;<span class="ident" id="7007029">src</span>&nbsp;<span class="op" id="7007033">==</span>&nbsp;<span class="ident" id="7007036">nil</span>&nbsp;<span class="op" id="7007040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7007045">//&nbsp;no&nbsp;test&nbsp;source&nbsp;available&nbsp;-&nbsp;create&nbsp;one&nbsp;from&nbsp;scratch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007102">src</span>&nbsp;<span class="op" id="7007106">=</span>&nbsp;<span class="ident" id="7007108">makeTestSource</span><span class="op" id="7007122">(</span><span class="ident" id="7007123">test</span><span class="op" id="7007127">.</span><span class="ident" id="7007128">size</span><span class="op" id="7007132">,</span>&nbsp;<span class="ident" id="7007134">test</span><span class="op" id="7007138">.</span><span class="ident" id="7007139">lines</span><span class="op" id="7007144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007148">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007152">f</span><span class="op" id="7007153">.</span><span class="ident" id="7007154">SetLinesForContent</span><span class="op" id="7007172">(</span><span class="ident" id="7007173">src</span><span class="op" id="7007176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7007180">if</span>&nbsp;<span class="ident" id="7007183">f</span><span class="op" id="7007184">.</span><span class="ident" id="7007185">LineCount</span><span class="op" id="7007194">(</span><span class="op" id="7007195">)</span>&nbsp;<span class="op" id="7007197">!=</span>&nbsp;<span class="builtinfunc" id="7007200">len</span><span class="op" id="7007203">(</span><span class="ident" id="7007204">test</span><span class="op" id="7007208">.</span><span class="ident" id="7007209">lines</span><span class="op" id="7007214">)</span>&nbsp;<span class="op" id="7007216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007221">t</span><span class="op" id="7007222">.</span><span class="ident" id="7007223">Errorf</span><span class="op" id="7007229">(</span><span class="string" id="7007230">&#34;%s,&nbsp;SetLinesForContent:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7007282">,</span>&nbsp;<span class="ident" id="7007284">f</span><span class="op" id="7007285">.</span><span class="ident" id="7007286">Name</span><span class="op" id="7007290">(</span><span class="op" id="7007291">)</span><span class="op" id="7007292">,</span>&nbsp;<span class="ident" id="7007294">f</span><span class="op" id="7007295">.</span><span class="ident" id="7007296">LineCount</span><span class="op" id="7007305">(</span><span class="op" id="7007306">)</span><span class="op" id="7007307">,</span>&nbsp;<span class="builtinfunc" id="7007309">len</span><span class="op" id="7007312">(</span><span class="ident" id="7007313">test</span><span class="op" id="7007317">.</span><span class="ident" id="7007318">lines</span><span class="op" id="7007323">)</span><span class="op" id="7007324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007332">verifyPositions</span><span class="op" id="7007347">(</span><span class="ident" id="7007348">t</span><span class="op" id="7007349">,</span>&nbsp;<span class="ident" id="7007351">fset</span><span class="op" id="7007355">,</span>&nbsp;<span class="ident" id="7007357">f</span><span class="op" id="7007358">,</span>&nbsp;<span class="ident" id="7007360">test</span><span class="op" id="7007364">.</span><span class="ident" id="7007365">lines</span><span class="op" id="7007370">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007373">}</span><br>
<span class="lineno"></span><span class="op" id="7007375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7007378">func</span>&nbsp;<span class="ident" id="7007383">TestLineInfo</span><span class="op" id="7007395">(</span><span class="ident" id="7007396">t</span>&nbsp;<span class="op" id="7007398">*</span><span class="ident" id="7007399">testing</span><span class="op" id="7007406">.</span><span class="ident" id="7007407">T</span><span class="op" id="7007408">)</span>&nbsp;<span class="op" id="7007410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007413">fset</span>&nbsp;<span class="op" id="7007418">:=</span>&nbsp;<span class="ident" id="7007421">NewFileSet</span><span class="op" id="7007431">(</span><span class="op" id="7007432">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007435">f</span>&nbsp;<span class="op" id="7007437">:=</span>&nbsp;<span class="ident" id="7007440">fset</span><span class="op" id="7007444">.</span><span class="ident" id="7007445">AddFile</span><span class="op" id="7007452">(</span><span class="string" id="7007453">&#34;foo&#34;</span><span class="op" id="7007458">,</span>&nbsp;<span class="ident" id="7007460">fset</span><span class="op" id="7007464">.</span><span class="ident" id="7007465">Base</span><span class="op" id="7007469">(</span><span class="op" id="7007470">)</span><span class="op" id="7007471">,</span>&nbsp;<span class="num" id="7007473">500</span><span class="op" id="7007476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007479">lines</span>&nbsp;<span class="op" id="7007485">:=</span>&nbsp;<span class="op" id="7007488">[</span><span class="op" id="7007489">]</span><span class="builtintype" id="7007490">int</span><span class="op" id="7007493">{</span><span class="num" id="7007494">0</span><span class="op" id="7007495">,</span>&nbsp;<span class="num" id="7007497">42</span><span class="op" id="7007499">,</span>&nbsp;<span class="num" id="7007501">77</span><span class="op" id="7007503">,</span>&nbsp;<span class="num" id="7007505">100</span><span class="op" id="7007508">,</span>&nbsp;<span class="num" id="7007510">210</span><span class="op" id="7007513">,</span>&nbsp;<span class="num" id="7007515">220</span><span class="op" id="7007518">,</span>&nbsp;<span class="num" id="7007520">277</span><span class="op" id="7007523">,</span>&nbsp;<span class="num" id="7007525">300</span><span class="op" id="7007528">,</span>&nbsp;<span class="num" id="7007530">333</span><span class="op" id="7007533">,</span>&nbsp;<span class="num" id="7007535">401</span><span class="op" id="7007538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7007541">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;provide&nbsp;alternative&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7007609">for</span>&nbsp;<span class="ident" id="7007613">_</span><span class="op" id="7007614">,</span>&nbsp;<span class="ident" id="7007616">offs</span>&nbsp;<span class="op" id="7007621">:=</span>&nbsp;<span class="keyword" id="7007624">range</span>&nbsp;<span class="ident" id="7007630">lines</span>&nbsp;<span class="op" id="7007636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007640">f</span><span class="op" id="7007641">.</span><span class="ident" id="7007642">AddLine</span><span class="op" id="7007649">(</span><span class="ident" id="7007650">offs</span><span class="op" id="7007654">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007658">f</span><span class="op" id="7007659">.</span><span class="ident" id="7007660">AddLineInfo</span><span class="op" id="7007671">(</span><span class="ident" id="7007672">offs</span><span class="op" id="7007676">,</span>&nbsp;<span class="string" id="7007678">&#34;bar&#34;</span><span class="op" id="7007683">,</span>&nbsp;<span class="num" id="7007685">42</span><span class="op" id="7007687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7007690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7007693">//&nbsp;verify&nbsp;positions&nbsp;for&nbsp;all&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7007730">for</span>&nbsp;<span class="ident" id="7007734">offs</span>&nbsp;<span class="op" id="7007739">:=</span>&nbsp;<span class="num" id="7007742">0</span><span class="op" id="7007743">;</span>&nbsp;<span class="ident" id="7007745">offs</span>&nbsp;<span class="op" id="7007750">&lt;=</span>&nbsp;<span class="ident" id="7007753">f</span><span class="op" id="7007754">.</span><span class="ident" id="7007755">Size</span><span class="op" id="7007759">(</span><span class="op" id="7007760">)</span><span class="op" id="7007761">;</span>&nbsp;<span class="ident" id="7007763">offs</span><span class="op" id="7007767">++</span>&nbsp;<span class="op" id="7007770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007774">p</span>&nbsp;<span class="op" id="7007776">:=</span>&nbsp;<span class="ident" id="7007779">f</span><span class="op" id="7007780">.</span><span class="ident" id="7007781">Pos</span><span class="op" id="7007784">(</span><span class="ident" id="7007785">offs</span><span class="op" id="7007789">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007793">_</span><span class="op" id="7007794">,</span>&nbsp;<span class="ident" id="7007796">col</span>&nbsp;<span class="op" id="7007800">:=</span>&nbsp;<span class="ident" id="7007803">linecol</span><span class="op" id="7007810">(</span><span class="ident" id="7007811">lines</span><span class="op" id="7007816">,</span>&nbsp;<span class="ident" id="7007818">offs</span><span class="op" id="7007822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007826">msg</span>&nbsp;<span class="op" id="7007830">:=</span>&nbsp;<span class="ident" id="7007833">fmt</span><span class="op" id="7007836">.</span><span class="ident" id="7007837">Sprintf</span><span class="op" id="7007844">(</span><span class="string" id="7007845">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7007869">,</span>&nbsp;<span class="ident" id="7007871">f</span><span class="op" id="7007872">.</span><span class="ident" id="7007873">Name</span><span class="op" id="7007877">(</span><span class="op" id="7007878">)</span><span class="op" id="7007879">,</span>&nbsp;<span class="ident" id="7007881">offs</span><span class="op" id="7007885">,</span>&nbsp;<span class="ident" id="7007887">p</span><span class="op" id="7007888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007892">checkPos</span><span class="op" id="7007900">(</span><span class="ident" id="7007901">t</span><span class="op" id="7007902">,</span>&nbsp;<span class="ident" id="7007904">msg</span><span class="op" id="7007907">,</span>&nbsp;<span class="ident" id="7007909">f</span><span class="op" id="7007910">.</span><span class="ident" id="7007911">Position</span><span class="op" id="7007919">(</span><span class="ident" id="7007920">f</span><span class="op" id="7007921">.</span><span class="ident" id="7007922">Pos</span><span class="op" id="7007925">(</span><span class="ident" id="7007926">offs</span><span class="op" id="7007930">)</span><span class="op" id="7007931">)</span><span class="op" id="7007932">,</span>&nbsp;<span class="ident" id="7007934">Position</span><span class="op" id="7007942">{</span><span class="string" id="7007943">&#34;bar&#34;</span><span class="op" id="7007948">,</span>&nbsp;<span class="ident" id="7007950">offs</span><span class="op" id="7007954">,</span>&nbsp;<span class="num" id="7007956">42</span><span class="op" id="7007958">,</span>&nbsp;<span class="ident" id="7007960">col</span><span class="op" id="7007963">}</span><span class="op" id="7007964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7007968">checkPos</span><span class="op" id="7007976">(</span><span class="ident" id="7007977">t</span><span class="op" id="7007978">,</span>&nbsp;<span class="ident" id="7007980">msg</span><span class="op" id="7007983">,</span>&nbsp;<span class="ident" id="7007985">fset</span><span class="op" id="7007989">.</span><span class="ident" id="7007990">Position</span><span class="op" id="7007998">(</span><span class="ident" id="7007999">p</span><span class="op" id="7008000">)</span><span class="op" id="7008001">,</span>&nbsp;<span class="ident" id="7008003">Position</span><span class="op" id="7008011">{</span><span class="string" id="7008012">&#34;bar&#34;</span><span class="op" id="7008017">,</span>&nbsp;<span class="ident" id="7008019">offs</span><span class="op" id="7008023">,</span>&nbsp;<span class="num" id="7008025">42</span><span class="op" id="7008027">,</span>&nbsp;<span class="ident" id="7008029">col</span><span class="op" id="7008032">}</span><span class="op" id="7008033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008036">}</span><br>
<span class="lineno">165</span><span class="op" id="7008038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7008041">func</span>&nbsp;<span class="ident" id="7008046">TestFiles</span><span class="op" id="7008055">(</span><span class="ident" id="7008056">t</span>&nbsp;<span class="op" id="7008058">*</span><span class="ident" id="7008059">testing</span><span class="op" id="7008066">.</span><span class="ident" id="7008067">T</span><span class="op" id="7008068">)</span>&nbsp;<span class="op" id="7008070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008073">fset</span>&nbsp;<span class="op" id="7008078">:=</span>&nbsp;<span class="ident" id="7008081">NewFileSet</span><span class="op" id="7008091">(</span><span class="op" id="7008092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008095">for</span>&nbsp;<span class="ident" id="7008099">i</span><span class="op" id="7008100">,</span>&nbsp;<span class="ident" id="7008102">test</span>&nbsp;<span class="op" id="7008107">:=</span>&nbsp;<span class="keyword" id="7008110">range</span>&nbsp;<span class="ident" id="7008116">tests</span>&nbsp;<span class="op" id="7008122">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008126">base</span>&nbsp;<span class="op" id="7008131">:=</span>&nbsp;<span class="ident" id="7008134">fset</span><span class="op" id="7008138">.</span><span class="ident" id="7008139">Base</span><span class="op" id="7008143">(</span><span class="op" id="7008144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008148">if</span>&nbsp;<span class="ident" id="7008151">i</span><span class="op" id="7008152">%</span><span class="num" id="7008153">2</span>&nbsp;<span class="op" id="7008155">==</span>&nbsp;<span class="num" id="7008158">1</span>&nbsp;<span class="op" id="7008160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7008165">//&nbsp;Setting&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7008212">//&nbsp;fset.Base(),&nbsp;so&nbsp;test&nbsp;some&nbsp;of&nbsp;each.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008253">base</span>&nbsp;<span class="op" id="7008258">=</span>&nbsp;<span class="op" id="7008260">-</span><span class="num" id="7008261">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008269">fset</span><span class="op" id="7008273">.</span><span class="ident" id="7008274">AddFile</span><span class="op" id="7008281">(</span><span class="ident" id="7008282">test</span><span class="op" id="7008286">.</span><span class="ident" id="7008287">filename</span><span class="op" id="7008295">,</span>&nbsp;<span class="ident" id="7008297">base</span><span class="op" id="7008301">,</span>&nbsp;<span class="ident" id="7008303">test</span><span class="op" id="7008307">.</span><span class="ident" id="7008308">size</span><span class="op" id="7008312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008316">j</span>&nbsp;<span class="op" id="7008318">:=</span>&nbsp;<span class="num" id="7008321">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008325">fset</span><span class="op" id="7008329">.</span><span class="ident" id="7008330">Iterate</span><span class="op" id="7008337">(</span><span class="keyword" id="7008338">func</span><span class="op" id="7008342">(</span><span class="ident" id="7008343">f</span>&nbsp;<span class="op" id="7008345">*</span><span class="ident" id="7008346">File</span><span class="op" id="7008350">)</span>&nbsp;<span class="builtintype" id="7008352">bool</span>&nbsp;<span class="op" id="7008357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008362">if</span>&nbsp;<span class="ident" id="7008365">f</span><span class="op" id="7008366">.</span><span class="ident" id="7008367">Name</span><span class="op" id="7008371">(</span><span class="op" id="7008372">)</span>&nbsp;<span class="op" id="7008374">!=</span>&nbsp;<span class="ident" id="7008377">tests</span><span class="op" id="7008382">[</span><span class="ident" id="7008383">j</span><span class="op" id="7008384">]</span><span class="op" id="7008385">.</span><span class="ident" id="7008386">filename</span>&nbsp;<span class="op" id="7008395">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008401">t</span><span class="op" id="7008402">.</span><span class="ident" id="7008403">Errorf</span><span class="op" id="7008409">(</span><span class="string" id="7008410">&#34;got&nbsp;filename&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7008438">,</span>&nbsp;<span class="ident" id="7008440">f</span><span class="op" id="7008441">.</span><span class="ident" id="7008442">Name</span><span class="op" id="7008446">(</span><span class="op" id="7008447">)</span><span class="op" id="7008448">,</span>&nbsp;<span class="ident" id="7008450">tests</span><span class="op" id="7008455">[</span><span class="ident" id="7008456">j</span><span class="op" id="7008457">]</span><span class="op" id="7008458">.</span><span class="ident" id="7008459">filename</span><span class="op" id="7008467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008477">j</span><span class="op" id="7008478">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008484">return</span>&nbsp;<span class="builtintype" id="7008491">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008498">}</span><span class="op" id="7008499">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008503">if</span>&nbsp;<span class="ident" id="7008506">j</span>&nbsp;<span class="op" id="7008508">!=</span>&nbsp;<span class="ident" id="7008511">i</span><span class="op" id="7008512">+</span><span class="num" id="7008513">1</span>&nbsp;<span class="op" id="7008515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008520">t</span><span class="op" id="7008521">.</span><span class="ident" id="7008522">Errorf</span><span class="op" id="7008528">(</span><span class="string" id="7008529">&#34;got&nbsp;%d&nbsp;files;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7008552">,</span>&nbsp;<span class="ident" id="7008554">j</span><span class="op" id="7008555">,</span>&nbsp;<span class="ident" id="7008557">i</span><span class="op" id="7008558">+</span><span class="num" id="7008559">1</span><span class="op" id="7008560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008567">}</span><br>
<span class="lineno"></span><span class="op" id="7008569">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7008572">//&nbsp;FileSet.File&nbsp;should&nbsp;return&nbsp;nil&nbsp;if&nbsp;Pos&nbsp;is&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="keyword" id="7008645">func</span>&nbsp;<span class="ident" id="7008650">TestFileSetPastEnd</span><span class="op" id="7008668">(</span><span class="ident" id="7008669">t</span>&nbsp;<span class="op" id="7008671">*</span><span class="ident" id="7008672">testing</span><span class="op" id="7008679">.</span><span class="ident" id="7008680">T</span><span class="op" id="7008681">)</span>&nbsp;<span class="op" id="7008683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008686">fset</span>&nbsp;<span class="op" id="7008691">:=</span>&nbsp;<span class="ident" id="7008694">NewFileSet</span><span class="op" id="7008704">(</span><span class="op" id="7008705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008708">for</span>&nbsp;<span class="ident" id="7008712">_</span><span class="op" id="7008713">,</span>&nbsp;<span class="ident" id="7008715">test</span>&nbsp;<span class="op" id="7008720">:=</span>&nbsp;<span class="keyword" id="7008723">range</span>&nbsp;<span class="ident" id="7008729">tests</span>&nbsp;<span class="op" id="7008735">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008739">fset</span><span class="op" id="7008743">.</span><span class="ident" id="7008744">AddFile</span><span class="op" id="7008751">(</span><span class="ident" id="7008752">test</span><span class="op" id="7008756">.</span><span class="ident" id="7008757">filename</span><span class="op" id="7008765">,</span>&nbsp;<span class="ident" id="7008767">fset</span><span class="op" id="7008771">.</span><span class="ident" id="7008772">Base</span><span class="op" id="7008776">(</span><span class="op" id="7008777">)</span><span class="op" id="7008778">,</span>&nbsp;<span class="ident" id="7008780">test</span><span class="op" id="7008784">.</span><span class="ident" id="7008785">size</span><span class="op" id="7008789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008795">if</span>&nbsp;<span class="ident" id="7008798">f</span>&nbsp;<span class="op" id="7008800">:=</span>&nbsp;<span class="ident" id="7008803">fset</span><span class="op" id="7008807">.</span><span class="ident" id="7008808">File</span><span class="op" id="7008812">(</span><span class="ident" id="7008813">Pos</span><span class="op" id="7008816">(</span><span class="ident" id="7008817">fset</span><span class="op" id="7008821">.</span><span class="ident" id="7008822">Base</span><span class="op" id="7008826">(</span><span class="op" id="7008827">)</span><span class="op" id="7008828">)</span><span class="op" id="7008829">)</span><span class="op" id="7008830">;</span>&nbsp;<span class="ident" id="7008832">f</span>&nbsp;<span class="op" id="7008834">!=</span>&nbsp;<span class="ident" id="7008837">nil</span>&nbsp;<span class="op" id="7008841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008845">t</span><span class="op" id="7008846">.</span><span class="ident" id="7008847">Errorf</span><span class="op" id="7008853">(</span><span class="string" id="7008854">&#34;got&nbsp;%v,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7008872">,</span>&nbsp;<span class="ident" id="7008874">f</span><span class="op" id="7008875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7008878">}</span><br>
<span class="lineno">200</span><span class="op" id="7008880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7008883">func</span>&nbsp;<span class="ident" id="7008888">TestFileSetCacheUnlikely</span><span class="op" id="7008912">(</span><span class="ident" id="7008913">t</span>&nbsp;<span class="op" id="7008915">*</span><span class="ident" id="7008916">testing</span><span class="op" id="7008923">.</span><span class="ident" id="7008924">T</span><span class="op" id="7008925">)</span>&nbsp;<span class="op" id="7008927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008930">fset</span>&nbsp;<span class="op" id="7008935">:=</span>&nbsp;<span class="ident" id="7008938">NewFileSet</span><span class="op" id="7008948">(</span><span class="op" id="7008949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7008952">offsets</span>&nbsp;<span class="op" id="7008960">:=</span>&nbsp;<span class="builtinfunc" id="7008963">make</span><span class="op" id="7008967">(</span><span class="keyword" id="7008968">map</span><span class="op" id="7008971">[</span><span class="builtintype" id="7008972">string</span><span class="op" id="7008978">]</span><span class="builtintype" id="7008979">int</span><span class="op" id="7008982">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7008985">for</span>&nbsp;<span class="ident" id="7008989">_</span><span class="op" id="7008990">,</span>&nbsp;<span class="ident" id="7008992">test</span>&nbsp;<span class="op" id="7008997">:=</span>&nbsp;<span class="keyword" id="7009000">range</span>&nbsp;<span class="ident" id="7009006">tests</span>&nbsp;<span class="op" id="7009012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009016">offsets</span><span class="op" id="7009023">[</span><span class="ident" id="7009024">test</span><span class="op" id="7009028">.</span><span class="ident" id="7009029">filename</span><span class="op" id="7009037">]</span>&nbsp;<span class="op" id="7009039">=</span>&nbsp;<span class="ident" id="7009041">fset</span><span class="op" id="7009045">.</span><span class="ident" id="7009046">Base</span><span class="op" id="7009050">(</span><span class="op" id="7009051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009055">fset</span><span class="op" id="7009059">.</span><span class="ident" id="7009060">AddFile</span><span class="op" id="7009067">(</span><span class="ident" id="7009068">test</span><span class="op" id="7009072">.</span><span class="ident" id="7009073">filename</span><span class="op" id="7009081">,</span>&nbsp;<span class="ident" id="7009083">fset</span><span class="op" id="7009087">.</span><span class="ident" id="7009088">Base</span><span class="op" id="7009092">(</span><span class="op" id="7009093">)</span><span class="op" id="7009094">,</span>&nbsp;<span class="ident" id="7009096">test</span><span class="op" id="7009100">.</span><span class="ident" id="7009101">size</span><span class="op" id="7009105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7009108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7009111">for</span>&nbsp;<span class="ident" id="7009115">file</span><span class="op" id="7009119">,</span>&nbsp;<span class="ident" id="7009121">pos</span>&nbsp;<span class="op" id="7009125">:=</span>&nbsp;<span class="keyword" id="7009128">range</span>&nbsp;<span class="ident" id="7009134">offsets</span>&nbsp;<span class="op" id="7009142">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009146">f</span>&nbsp;<span class="op" id="7009148">:=</span>&nbsp;<span class="ident" id="7009151">fset</span><span class="op" id="7009155">.</span><span class="ident" id="7009156">File</span><span class="op" id="7009160">(</span><span class="ident" id="7009161">Pos</span><span class="op" id="7009164">(</span><span class="ident" id="7009165">pos</span><span class="op" id="7009168">)</span><span class="op" id="7009169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7009173">if</span>&nbsp;<span class="ident" id="7009176">f</span><span class="op" id="7009177">.</span><span class="ident" id="7009178">Name</span><span class="op" id="7009182">(</span><span class="op" id="7009183">)</span>&nbsp;<span class="op" id="7009185">!=</span>&nbsp;<span class="ident" id="7009188">file</span>&nbsp;<span class="op" id="7009193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009198">t</span><span class="op" id="7009199">.</span><span class="ident" id="7009200">Errorf</span><span class="op" id="7009206">(</span><span class="string" id="7009207">&#34;got&nbsp;%q&nbsp;at&nbsp;position&nbsp;%d,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7009239">,</span>&nbsp;<span class="ident" id="7009241">f</span><span class="op" id="7009242">.</span><span class="ident" id="7009243">Name</span><span class="op" id="7009247">(</span><span class="op" id="7009248">)</span><span class="op" id="7009249">,</span>&nbsp;<span class="ident" id="7009251">pos</span><span class="op" id="7009254">,</span>&nbsp;<span class="ident" id="7009256">file</span><span class="op" id="7009260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7009264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7009267">}</span><br>
<span class="lineno">215</span><span class="op" id="7009269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7009272">//&nbsp;issue&nbsp;4345.&nbsp;Test&nbsp;concurrent&nbsp;use&nbsp;of&nbsp;FileSet.Pos&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7009341">//&nbsp;race&nbsp;in&nbsp;the&nbsp;FileSet&nbsp;position&nbsp;cache.</span><br>
<span class="lineno"></span><span class="keyword" id="7009380">func</span>&nbsp;<span class="ident" id="7009385">TestFileSetRace</span><span class="op" id="7009400">(</span><span class="ident" id="7009401">t</span>&nbsp;<span class="op" id="7009403">*</span><span class="ident" id="7009404">testing</span><span class="op" id="7009411">.</span><span class="ident" id="7009412">T</span><span class="op" id="7009413">)</span>&nbsp;<span class="op" id="7009415">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009418">fset</span>&nbsp;<span class="op" id="7009423">:=</span>&nbsp;<span class="ident" id="7009426">NewFileSet</span><span class="op" id="7009436">(</span><span class="op" id="7009437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7009440">for</span>&nbsp;<span class="ident" id="7009444">i</span>&nbsp;<span class="op" id="7009446">:=</span>&nbsp;<span class="num" id="7009449">0</span><span class="op" id="7009450">;</span>&nbsp;<span class="ident" id="7009452">i</span>&nbsp;<span class="op" id="7009454">&lt;</span>&nbsp;<span class="num" id="7009456">100</span><span class="op" id="7009459">;</span>&nbsp;<span class="ident" id="7009461">i</span><span class="op" id="7009462">++</span>&nbsp;<span class="op" id="7009465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009469">fset</span><span class="op" id="7009473">.</span><span class="ident" id="7009474">AddFile</span><span class="op" id="7009481">(</span><span class="ident" id="7009482">fmt</span><span class="op" id="7009485">.</span><span class="ident" id="7009486">Sprintf</span><span class="op" id="7009493">(</span><span class="string" id="7009494">&#34;file-%d&#34;</span><span class="op" id="7009503">,</span>&nbsp;<span class="ident" id="7009505">i</span><span class="op" id="7009506">)</span><span class="op" id="7009507">,</span>&nbsp;<span class="ident" id="7009509">fset</span><span class="op" id="7009513">.</span><span class="ident" id="7009514">Base</span><span class="op" id="7009518">(</span><span class="op" id="7009519">)</span><span class="op" id="7009520">,</span>&nbsp;<span class="num" id="7009522">1031</span><span class="op" id="7009526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7009529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009532">max</span>&nbsp;<span class="op" id="7009536">:=</span>&nbsp;<span class="builtintype" id="7009539">int32</span><span class="op" id="7009544">(</span><span class="ident" id="7009545">fset</span><span class="op" id="7009549">.</span><span class="ident" id="7009550">Base</span><span class="op" id="7009554">(</span><span class="op" id="7009555">)</span><span class="op" id="7009556">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7009559">var</span>&nbsp;<span class="ident" id="7009563">stop</span>&nbsp;<span class="ident" id="7009568">sync</span><span class="op" id="7009572">.</span><span class="ident" id="7009573">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009584">r</span>&nbsp;<span class="op" id="7009586">:=</span>&nbsp;<span class="ident" id="7009589">rand</span><span class="op" id="7009593">.</span><span class="ident" id="7009594">New</span><span class="op" id="7009597">(</span><span class="ident" id="7009598">rand</span><span class="op" id="7009602">.</span><span class="ident" id="7009603">NewSource</span><span class="op" id="7009612">(</span><span class="num" id="7009613">7</span><span class="op" id="7009614">)</span><span class="op" id="7009615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7009618">for</span>&nbsp;<span class="ident" id="7009622">i</span>&nbsp;<span class="op" id="7009624">:=</span>&nbsp;<span class="num" id="7009627">0</span><span class="op" id="7009628">;</span>&nbsp;<span class="ident" id="7009630">i</span>&nbsp;<span class="op" id="7009632">&lt;</span>&nbsp;<span class="num" id="7009634">2</span><span class="op" id="7009635">;</span>&nbsp;<span class="ident" id="7009637">i</span><span class="op" id="7009638">++</span>&nbsp;<span class="op" id="7009641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009645">r</span>&nbsp;<span class="op" id="7009647">:=</span>&nbsp;<span class="ident" id="7009650">rand</span><span class="op" id="7009654">.</span><span class="ident" id="7009655">New</span><span class="op" id="7009658">(</span><span class="ident" id="7009659">rand</span><span class="op" id="7009663">.</span><span class="ident" id="7009664">NewSource</span><span class="op" id="7009673">(</span><span class="ident" id="7009674">r</span><span class="op" id="7009675">.</span><span class="ident" id="7009676">Int63</span><span class="op" id="7009681">(</span><span class="op" id="7009682">)</span><span class="op" id="7009683">)</span><span class="op" id="7009684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009688">stop</span><span class="op" id="7009692">.</span><span class="ident" id="7009693">Add</span><span class="op" id="7009696">(</span><span class="num" id="7009697">1</span><span class="op" id="7009698">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7009702">go</span>&nbsp;<span class="keyword" id="7009705">func</span><span class="op" id="7009709">(</span><span class="op" id="7009710">)</span>&nbsp;<span class="op" id="7009712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7009717">for</span>&nbsp;<span class="ident" id="7009721">i</span>&nbsp;<span class="op" id="7009723">:=</span>&nbsp;<span class="num" id="7009726">0</span><span class="op" id="7009727">;</span>&nbsp;<span class="ident" id="7009729">i</span>&nbsp;<span class="op" id="7009731">&lt;</span>&nbsp;<span class="num" id="7009733">1000</span><span class="op" id="7009737">;</span>&nbsp;<span class="ident" id="7009739">i</span><span class="op" id="7009740">++</span>&nbsp;<span class="op" id="7009743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009749">fset</span><span class="op" id="7009753">.</span><span class="ident" id="7009754">Position</span><span class="op" id="7009762">(</span><span class="ident" id="7009763">Pos</span><span class="op" id="7009766">(</span><span class="ident" id="7009767">r</span><span class="op" id="7009768">.</span><span class="ident" id="7009769">Int31n</span><span class="op" id="7009775">(</span><span class="ident" id="7009776">max</span><span class="op" id="7009779">)</span><span class="op" id="7009780">)</span><span class="op" id="7009781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7009786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009791">stop</span><span class="op" id="7009795">.</span><span class="ident" id="7009796">Done</span><span class="op" id="7009800">(</span><span class="op" id="7009801">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7009805">}</span><span class="op" id="7009806">(</span><span class="op" id="7009807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7009810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009813">stop</span><span class="op" id="7009817">.</span><span class="ident" id="7009818">Wait</span><span class="op" id="7009822">(</span><span class="op" id="7009823">)</span><br>
<span class="lineno"></span><span class="op" id="7009825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7009828">func</span>&nbsp;<span class="ident" id="7009833">TestPositionFor</span><span class="op" id="7009848">(</span><span class="ident" id="7009849">t</span>&nbsp;<span class="op" id="7009851">*</span><span class="ident" id="7009852">testing</span><span class="op" id="7009859">.</span><span class="ident" id="7009860">T</span><span class="op" id="7009861">)</span>&nbsp;<span class="op" id="7009863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009866">src</span>&nbsp;<span class="op" id="7009870">:=</span>&nbsp;<span class="op" id="7009873">[</span><span class="op" id="7009874">]</span><span class="builtintype" id="7009875">byte</span><span class="op" id="7009879">(</span><span class="string" id="7009880">`<br>
<span class="lineno"></span>foo<br>
<span class="lineno"></span>b<br>
<span class="lineno"></span>ar<br>
<span class="lineno">245</span>//line&nbsp;:100<br>
<span class="lineno"></span>foobar<br>
<span class="lineno"></span>//line&nbsp;bar:3<br>
<span class="lineno"></span>done<br>
<span class="lineno"></span>`</span><span class="op" id="7009929">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7009933">const</span>&nbsp;<span class="ident" id="7009939">filename</span>&nbsp;<span class="op" id="7009948">=</span>&nbsp;<span class="string" id="7009950">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009957">fset</span>&nbsp;<span class="op" id="7009962">:=</span>&nbsp;<span class="ident" id="7009965">NewFileSet</span><span class="op" id="7009975">(</span><span class="op" id="7009976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7009979">f</span>&nbsp;<span class="op" id="7009981">:=</span>&nbsp;<span class="ident" id="7009984">fset</span><span class="op" id="7009988">.</span><span class="ident" id="7009989">AddFile</span><span class="op" id="7009996">(</span><span class="ident" id="7009997">filename</span><span class="op" id="7010005">,</span>&nbsp;<span class="ident" id="7010007">fset</span><span class="op" id="7010011">.</span><span class="ident" id="7010012">Base</span><span class="op" id="7010016">(</span><span class="op" id="7010017">)</span><span class="op" id="7010018">,</span>&nbsp;<span class="builtinfunc" id="7010020">len</span><span class="op" id="7010023">(</span><span class="ident" id="7010024">src</span><span class="op" id="7010027">)</span><span class="op" id="7010028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010031">f</span><span class="op" id="7010032">.</span><span class="ident" id="7010033">SetLinesForContent</span><span class="op" id="7010051">(</span><span class="ident" id="7010052">src</span><span class="op" id="7010055">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7010059">//&nbsp;verify&nbsp;position&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7010084">for</span>&nbsp;<span class="ident" id="7010088">i</span><span class="op" id="7010089">,</span>&nbsp;<span class="ident" id="7010091">offs</span>&nbsp;<span class="op" id="7010096">:=</span>&nbsp;<span class="keyword" id="7010099">range</span>&nbsp;<span class="ident" id="7010105">f</span><span class="op" id="7010106">.</span><span class="ident" id="7010107">lines</span>&nbsp;<span class="op" id="7010113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010117">got1</span>&nbsp;<span class="op" id="7010122">:=</span>&nbsp;<span class="ident" id="7010125">f</span><span class="op" id="7010126">.</span><span class="ident" id="7010127">PositionFor</span><span class="op" id="7010138">(</span><span class="ident" id="7010139">f</span><span class="op" id="7010140">.</span><span class="ident" id="7010141">Pos</span><span class="op" id="7010144">(</span><span class="ident" id="7010145">offs</span><span class="op" id="7010149">)</span><span class="op" id="7010150">,</span>&nbsp;<span class="builtintype" id="7010152">false</span><span class="op" id="7010157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010161">got2</span>&nbsp;<span class="op" id="7010166">:=</span>&nbsp;<span class="ident" id="7010169">f</span><span class="op" id="7010170">.</span><span class="ident" id="7010171">PositionFor</span><span class="op" id="7010182">(</span><span class="ident" id="7010183">f</span><span class="op" id="7010184">.</span><span class="ident" id="7010185">Pos</span><span class="op" id="7010188">(</span><span class="ident" id="7010189">offs</span><span class="op" id="7010193">)</span><span class="op" id="7010194">,</span>&nbsp;<span class="builtintype" id="7010196">true</span><span class="op" id="7010200">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010204">got3</span>&nbsp;<span class="op" id="7010209">:=</span>&nbsp;<span class="ident" id="7010212">f</span><span class="op" id="7010213">.</span><span class="ident" id="7010214">Position</span><span class="op" id="7010222">(</span><span class="ident" id="7010223">f</span><span class="op" id="7010224">.</span><span class="ident" id="7010225">Pos</span><span class="op" id="7010228">(</span><span class="ident" id="7010229">offs</span><span class="op" id="7010233">)</span><span class="op" id="7010234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010238">want</span>&nbsp;<span class="op" id="7010243">:=</span>&nbsp;<span class="ident" id="7010246">Position</span><span class="op" id="7010254">{</span><span class="ident" id="7010255">filename</span><span class="op" id="7010263">,</span>&nbsp;<span class="ident" id="7010265">offs</span><span class="op" id="7010269">,</span>&nbsp;<span class="ident" id="7010271">i</span>&nbsp;<span class="op" id="7010273">+</span>&nbsp;<span class="num" id="7010275">1</span><span class="op" id="7010276">,</span>&nbsp;<span class="num" id="7010278">1</span><span class="op" id="7010279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010283">checkPos</span><span class="op" id="7010291">(</span><span class="ident" id="7010292">t</span><span class="op" id="7010293">,</span>&nbsp;<span class="string" id="7010295">&#34;1.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7010322">,</span>&nbsp;<span class="ident" id="7010324">got1</span><span class="op" id="7010328">,</span>&nbsp;<span class="ident" id="7010330">want</span><span class="op" id="7010334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010338">checkPos</span><span class="op" id="7010346">(</span><span class="ident" id="7010347">t</span><span class="op" id="7010348">,</span>&nbsp;<span class="string" id="7010350">&#34;1.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7010375">,</span>&nbsp;<span class="ident" id="7010377">got2</span><span class="op" id="7010381">,</span>&nbsp;<span class="ident" id="7010383">want</span><span class="op" id="7010387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010391">checkPos</span><span class="op" id="7010399">(</span><span class="ident" id="7010400">t</span><span class="op" id="7010401">,</span>&nbsp;<span class="string" id="7010403">&#34;1.&nbsp;Position&#34;</span><span class="op" id="7010416">,</span>&nbsp;<span class="ident" id="7010418">got3</span><span class="op" id="7010422">,</span>&nbsp;<span class="ident" id="7010424">want</span><span class="op" id="7010428">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7010431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7010435">//&nbsp;manually&nbsp;add&nbsp;//line&nbsp;info&nbsp;on&nbsp;lines&nbsp;l1,&nbsp;l2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7010480">const</span>&nbsp;<span class="ident" id="7010486">l1</span><span class="op" id="7010488">,</span>&nbsp;<span class="ident" id="7010490">l2</span>&nbsp;<span class="op" id="7010493">=</span>&nbsp;<span class="num" id="7010495">5</span><span class="op" id="7010496">,</span>&nbsp;<span class="num" id="7010498">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010501">f</span><span class="op" id="7010502">.</span><span class="ident" id="7010503">AddLineInfo</span><span class="op" id="7010514">(</span><span class="ident" id="7010515">f</span><span class="op" id="7010516">.</span><span class="ident" id="7010517">lines</span><span class="op" id="7010522">[</span><span class="ident" id="7010523">l1</span><span class="op" id="7010525">-</span><span class="num" id="7010526">1</span><span class="op" id="7010527">]</span><span class="op" id="7010528">,</span>&nbsp;<span class="string" id="7010530">&#34;&#34;</span><span class="op" id="7010532">,</span>&nbsp;<span class="num" id="7010534">100</span><span class="op" id="7010537">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010540">f</span><span class="op" id="7010541">.</span><span class="ident" id="7010542">AddLineInfo</span><span class="op" id="7010553">(</span><span class="ident" id="7010554">f</span><span class="op" id="7010555">.</span><span class="ident" id="7010556">lines</span><span class="op" id="7010561">[</span><span class="ident" id="7010562">l2</span><span class="op" id="7010564">-</span><span class="num" id="7010565">1</span><span class="op" id="7010566">]</span><span class="op" id="7010567">,</span>&nbsp;<span class="string" id="7010569">&#34;bar&#34;</span><span class="op" id="7010574">,</span>&nbsp;<span class="num" id="7010576">3</span><span class="op" id="7010577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7010581">//&nbsp;unadjusted&nbsp;position&nbsp;info&nbsp;must&nbsp;remain&nbsp;unchanged</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7010632">for</span>&nbsp;<span class="ident" id="7010636">i</span><span class="op" id="7010637">,</span>&nbsp;<span class="ident" id="7010639">offs</span>&nbsp;<span class="op" id="7010644">:=</span>&nbsp;<span class="keyword" id="7010647">range</span>&nbsp;<span class="ident" id="7010653">f</span><span class="op" id="7010654">.</span><span class="ident" id="7010655">lines</span>&nbsp;<span class="op" id="7010661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010665">got1</span>&nbsp;<span class="op" id="7010670">:=</span>&nbsp;<span class="ident" id="7010673">f</span><span class="op" id="7010674">.</span><span class="ident" id="7010675">PositionFor</span><span class="op" id="7010686">(</span><span class="ident" id="7010687">f</span><span class="op" id="7010688">.</span><span class="ident" id="7010689">Pos</span><span class="op" id="7010692">(</span><span class="ident" id="7010693">offs</span><span class="op" id="7010697">)</span><span class="op" id="7010698">,</span>&nbsp;<span class="builtintype" id="7010700">false</span><span class="op" id="7010705">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010709">want</span>&nbsp;<span class="op" id="7010714">:=</span>&nbsp;<span class="ident" id="7010717">Position</span><span class="op" id="7010725">{</span><span class="ident" id="7010726">filename</span><span class="op" id="7010734">,</span>&nbsp;<span class="ident" id="7010736">offs</span><span class="op" id="7010740">,</span>&nbsp;<span class="ident" id="7010742">i</span>&nbsp;<span class="op" id="7010744">+</span>&nbsp;<span class="num" id="7010746">1</span><span class="op" id="7010747">,</span>&nbsp;<span class="num" id="7010749">1</span><span class="op" id="7010750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010754">checkPos</span><span class="op" id="7010762">(</span><span class="ident" id="7010763">t</span><span class="op" id="7010764">,</span>&nbsp;<span class="string" id="7010766">&#34;2.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7010793">,</span>&nbsp;<span class="ident" id="7010795">got1</span><span class="op" id="7010799">,</span>&nbsp;<span class="ident" id="7010801">want</span><span class="op" id="7010805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7010808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7010812">//&nbsp;adjusted&nbsp;position&nbsp;info&nbsp;should&nbsp;have&nbsp;changed</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7010859">for</span>&nbsp;<span class="ident" id="7010863">i</span><span class="op" id="7010864">,</span>&nbsp;<span class="ident" id="7010866">offs</span>&nbsp;<span class="op" id="7010871">:=</span>&nbsp;<span class="keyword" id="7010874">range</span>&nbsp;<span class="ident" id="7010880">f</span><span class="op" id="7010881">.</span><span class="ident" id="7010882">lines</span>&nbsp;<span class="op" id="7010888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010892">got2</span>&nbsp;<span class="op" id="7010897">:=</span>&nbsp;<span class="ident" id="7010900">f</span><span class="op" id="7010901">.</span><span class="ident" id="7010902">PositionFor</span><span class="op" id="7010913">(</span><span class="ident" id="7010914">f</span><span class="op" id="7010915">.</span><span class="ident" id="7010916">Pos</span><span class="op" id="7010919">(</span><span class="ident" id="7010920">offs</span><span class="op" id="7010924">)</span><span class="op" id="7010925">,</span>&nbsp;<span class="builtintype" id="7010927">true</span><span class="op" id="7010931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010935">got3</span>&nbsp;<span class="op" id="7010940">:=</span>&nbsp;<span class="ident" id="7010943">f</span><span class="op" id="7010944">.</span><span class="ident" id="7010945">Position</span><span class="op" id="7010953">(</span><span class="ident" id="7010954">f</span><span class="op" id="7010955">.</span><span class="ident" id="7010956">Pos</span><span class="op" id="7010959">(</span><span class="ident" id="7010960">offs</span><span class="op" id="7010964">)</span><span class="op" id="7010965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7010969">want</span>&nbsp;<span class="op" id="7010974">:=</span>&nbsp;<span class="ident" id="7010977">Position</span><span class="op" id="7010985">{</span><span class="ident" id="7010986">filename</span><span class="op" id="7010994">,</span>&nbsp;<span class="ident" id="7010996">offs</span><span class="op" id="7011000">,</span>&nbsp;<span class="ident" id="7011002">i</span>&nbsp;<span class="op" id="7011004">+</span>&nbsp;<span class="num" id="7011006">1</span><span class="op" id="7011007">,</span>&nbsp;<span class="num" id="7011009">1</span><span class="op" id="7011010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7011014">//&nbsp;manually&nbsp;compute&nbsp;wanted&nbsp;filename&nbsp;and&nbsp;line</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7011061">line</span>&nbsp;<span class="op" id="7011066">:=</span>&nbsp;<span class="ident" id="7011069">want</span><span class="op" id="7011073">.</span><span class="ident" id="7011074">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7011081">if</span>&nbsp;<span class="ident" id="7011084">i</span><span class="op" id="7011085">+</span><span class="num" id="7011086">1</span>&nbsp;<span class="op" id="7011088">&gt;=</span>&nbsp;<span class="ident" id="7011091">l1</span>&nbsp;<span class="op" id="7011094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7011099">want</span><span class="op" id="7011103">.</span><span class="ident" id="7011104">Filename</span>&nbsp;<span class="op" id="7011113">=</span>&nbsp;<span class="string" id="7011115">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7011121">want</span><span class="op" id="7011125">.</span><span class="ident" id="7011126">Line</span>&nbsp;<span class="op" id="7011131">=</span>&nbsp;<span class="ident" id="7011133">line</span>&nbsp;<span class="op" id="7011138">-</span>&nbsp;<span class="ident" id="7011140">l1</span>&nbsp;<span class="op" id="7011143">+</span>&nbsp;<span class="num" id="7011145">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7011151">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7011155">if</span>&nbsp;<span class="ident" id="7011158">i</span><span class="op" id="7011159">+</span><span class="num" id="7011160">1</span>&nbsp;<span class="op" id="7011162">&gt;=</span>&nbsp;<span class="ident" id="7011165">l2</span>&nbsp;<span class="op" id="7011168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7011173">want</span><span class="op" id="7011177">.</span><span class="ident" id="7011178">Filename</span>&nbsp;<span class="op" id="7011187">=</span>&nbsp;<span class="string" id="7011189">&#34;bar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7011198">want</span><span class="op" id="7011202">.</span><span class="ident" id="7011203">Line</span>&nbsp;<span class="op" id="7011208">=</span>&nbsp;<span class="ident" id="7011210">line</span>&nbsp;<span class="op" id="7011215">-</span>&nbsp;<span class="ident" id="7011217">l2</span>&nbsp;<span class="op" id="7011220">+</span>&nbsp;<span class="num" id="7011222">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7011226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7011230">checkPos</span><span class="op" id="7011238">(</span><span class="ident" id="7011239">t</span><span class="op" id="7011240">,</span>&nbsp;<span class="string" id="7011242">&#34;3.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7011267">,</span>&nbsp;<span class="ident" id="7011269">got2</span><span class="op" id="7011273">,</span>&nbsp;<span class="ident" id="7011275">want</span><span class="op" id="7011279">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7011283">checkPos</span><span class="op" id="7011291">(</span><span class="ident" id="7011292">t</span><span class="op" id="7011293">,</span>&nbsp;<span class="string" id="7011295">&#34;3.&nbsp;Position&#34;</span><span class="op" id="7011308">,</span>&nbsp;<span class="ident" id="7011310">got3</span><span class="op" id="7011314">,</span>&nbsp;<span class="ident" id="7011316">want</span><span class="op" id="7011320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7011323">}</span><br>
<span class="lineno"></span><span class="op" id="7011325">}</span>
</div>
</body>
</html>
