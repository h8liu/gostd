<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2012022">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;The&nbsp;authors&nbsp;of&nbsp;this&nbsp;software&nbsp;are&nbsp;Rob&nbsp;Pike&nbsp;and&nbsp;Ken&nbsp;Thompson.<br>
<span class="lineno"></span>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Copyright&nbsp;(c)&nbsp;2002&nbsp;by&nbsp;Lucent&nbsp;Technologies.<br>
<span class="lineno"></span>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Portions&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
<span class="lineno">5</span>&nbsp;*&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this&nbsp;software&nbsp;for&nbsp;any<br>
<span class="lineno"></span>&nbsp;*&nbsp;purpose&nbsp;without&nbsp;fee&nbsp;is&nbsp;hereby&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;entire&nbsp;notice<br>
<span class="lineno"></span>&nbsp;*&nbsp;is&nbsp;included&nbsp;in&nbsp;all&nbsp;copies&nbsp;of&nbsp;any&nbsp;software&nbsp;which&nbsp;is&nbsp;or&nbsp;includes&nbsp;a&nbsp;copy<br>
<span class="lineno"></span>&nbsp;*&nbsp;or&nbsp;modification&nbsp;of&nbsp;this&nbsp;software&nbsp;and&nbsp;in&nbsp;all&nbsp;copies&nbsp;of&nbsp;the&nbsp;supporting<br>
<span class="lineno"></span>&nbsp;*&nbsp;documentation&nbsp;for&nbsp;such&nbsp;software.<br>
<span class="lineno">10</span>&nbsp;*&nbsp;THIS&nbsp;SOFTWARE&nbsp;IS&nbsp;BEING&nbsp;PROVIDED&nbsp;&#34;AS&nbsp;IS&#34;,&nbsp;WITHOUT&nbsp;ANY&nbsp;EXPRESS&nbsp;OR&nbsp;IMPLIED<br>
<span class="lineno"></span>&nbsp;*&nbsp;WARRANTY.&nbsp;&nbsp;IN&nbsp;PARTICULAR,&nbsp;NEITHER&nbsp;THE&nbsp;AUTHORS&nbsp;NOR&nbsp;LUCENT&nbsp;TECHNOLOGIES&nbsp;MAKE&nbsp;ANY<br>
<span class="lineno"></span>&nbsp;*&nbsp;REPRESENTATION&nbsp;OR&nbsp;WARRANTY&nbsp;OF&nbsp;ANY&nbsp;KIND&nbsp;CONCERNING&nbsp;THE&nbsp;MERCHANTABILITY<br>
<span class="lineno"></span>&nbsp;*&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE&nbsp;OR&nbsp;ITS&nbsp;FITNESS&nbsp;FOR&nbsp;ANY&nbsp;PARTICULAR&nbsp;PURPOSE.<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2012851">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;This&nbsp;code&nbsp;is&nbsp;copied,&nbsp;with&nbsp;slight&nbsp;editing&nbsp;due&nbsp;to&nbsp;type&nbsp;differences,<br>
<span class="lineno"></span>&nbsp;*&nbsp;from&nbsp;a&nbsp;subset&nbsp;of&nbsp;../lib9/utf/rune.c<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2012967">package</span>&nbsp;<span class="ident" id="2012975">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2012984">const</span>&nbsp;<span class="op" id="2012990">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012993">bit1</span>&nbsp;<span class="op" id="2012998">=</span>&nbsp;<span class="num" id="2013000">7</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013003">bitx</span>&nbsp;<span class="op" id="2013008">=</span>&nbsp;<span class="num" id="2013010">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013013">bit2</span>&nbsp;<span class="op" id="2013018">=</span>&nbsp;<span class="num" id="2013020">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013023">bit3</span>&nbsp;<span class="op" id="2013028">=</span>&nbsp;<span class="num" id="2013030">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013033">bit4</span>&nbsp;<span class="op" id="2013038">=</span>&nbsp;<span class="num" id="2013040">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013043">bit5</span>&nbsp;<span class="op" id="2013048">=</span>&nbsp;<span class="num" id="2013050">2</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013054">t1</span>&nbsp;<span class="op" id="2013057">=</span>&nbsp;<span class="op" id="2013059">(</span><span class="op" id="2013060">(</span><span class="num" id="2013061">1</span>&nbsp;<span class="op" id="2013063">&lt;&lt;</span>&nbsp;<span class="op" id="2013066">(</span><span class="ident" id="2013067">bit1</span>&nbsp;<span class="op" id="2013072">+</span>&nbsp;<span class="num" id="2013074">1</span><span class="op" id="2013075">)</span><span class="op" id="2013076">)</span>&nbsp;<span class="op" id="2013078">-</span>&nbsp;<span class="num" id="2013080">1</span><span class="op" id="2013081">)</span>&nbsp;<span class="op" id="2013083">^</span>&nbsp;<span class="num" id="2013085">0xFF</span>&nbsp;<span class="comment" id="2013090">/*&nbsp;0000&nbsp;0000&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013107">tx</span>&nbsp;<span class="op" id="2013110">=</span>&nbsp;<span class="op" id="2013112">(</span><span class="op" id="2013113">(</span><span class="num" id="2013114">1</span>&nbsp;<span class="op" id="2013116">&lt;&lt;</span>&nbsp;<span class="op" id="2013119">(</span><span class="ident" id="2013120">bitx</span>&nbsp;<span class="op" id="2013125">+</span>&nbsp;<span class="num" id="2013127">1</span><span class="op" id="2013128">)</span><span class="op" id="2013129">)</span>&nbsp;<span class="op" id="2013131">-</span>&nbsp;<span class="num" id="2013133">1</span><span class="op" id="2013134">)</span>&nbsp;<span class="op" id="2013136">^</span>&nbsp;<span class="num" id="2013138">0xFF</span>&nbsp;<span class="comment" id="2013143">/*&nbsp;1000&nbsp;0000&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013160">t2</span>&nbsp;<span class="op" id="2013163">=</span>&nbsp;<span class="op" id="2013165">(</span><span class="op" id="2013166">(</span><span class="num" id="2013167">1</span>&nbsp;<span class="op" id="2013169">&lt;&lt;</span>&nbsp;<span class="op" id="2013172">(</span><span class="ident" id="2013173">bit2</span>&nbsp;<span class="op" id="2013178">+</span>&nbsp;<span class="num" id="2013180">1</span><span class="op" id="2013181">)</span><span class="op" id="2013182">)</span>&nbsp;<span class="op" id="2013184">-</span>&nbsp;<span class="num" id="2013186">1</span><span class="op" id="2013187">)</span>&nbsp;<span class="op" id="2013189">^</span>&nbsp;<span class="num" id="2013191">0xFF</span>&nbsp;<span class="comment" id="2013196">/*&nbsp;1100&nbsp;0000&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013213">t3</span>&nbsp;<span class="op" id="2013216">=</span>&nbsp;<span class="op" id="2013218">(</span><span class="op" id="2013219">(</span><span class="num" id="2013220">1</span>&nbsp;<span class="op" id="2013222">&lt;&lt;</span>&nbsp;<span class="op" id="2013225">(</span><span class="ident" id="2013226">bit3</span>&nbsp;<span class="op" id="2013231">+</span>&nbsp;<span class="num" id="2013233">1</span><span class="op" id="2013234">)</span><span class="op" id="2013235">)</span>&nbsp;<span class="op" id="2013237">-</span>&nbsp;<span class="num" id="2013239">1</span><span class="op" id="2013240">)</span>&nbsp;<span class="op" id="2013242">^</span>&nbsp;<span class="num" id="2013244">0xFF</span>&nbsp;<span class="comment" id="2013249">/*&nbsp;1110&nbsp;0000&nbsp;*/</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013266">t4</span>&nbsp;<span class="op" id="2013269">=</span>&nbsp;<span class="op" id="2013271">(</span><span class="op" id="2013272">(</span><span class="num" id="2013273">1</span>&nbsp;<span class="op" id="2013275">&lt;&lt;</span>&nbsp;<span class="op" id="2013278">(</span><span class="ident" id="2013279">bit4</span>&nbsp;<span class="op" id="2013284">+</span>&nbsp;<span class="num" id="2013286">1</span><span class="op" id="2013287">)</span><span class="op" id="2013288">)</span>&nbsp;<span class="op" id="2013290">-</span>&nbsp;<span class="num" id="2013292">1</span><span class="op" id="2013293">)</span>&nbsp;<span class="op" id="2013295">^</span>&nbsp;<span class="num" id="2013297">0xFF</span>&nbsp;<span class="comment" id="2013302">/*&nbsp;1111&nbsp;0000&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013319">t5</span>&nbsp;<span class="op" id="2013322">=</span>&nbsp;<span class="op" id="2013324">(</span><span class="op" id="2013325">(</span><span class="num" id="2013326">1</span>&nbsp;<span class="op" id="2013328">&lt;&lt;</span>&nbsp;<span class="op" id="2013331">(</span><span class="ident" id="2013332">bit5</span>&nbsp;<span class="op" id="2013337">+</span>&nbsp;<span class="num" id="2013339">1</span><span class="op" id="2013340">)</span><span class="op" id="2013341">)</span>&nbsp;<span class="op" id="2013343">-</span>&nbsp;<span class="num" id="2013345">1</span><span class="op" id="2013346">)</span>&nbsp;<span class="op" id="2013348">^</span>&nbsp;<span class="num" id="2013350">0xFF</span>&nbsp;<span class="comment" id="2013355">/*&nbsp;1111&nbsp;1000&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013373">rune1</span>&nbsp;<span class="op" id="2013379">=</span>&nbsp;<span class="op" id="2013381">(</span><span class="num" id="2013382">1</span>&nbsp;<span class="op" id="2013384">&lt;&lt;</span>&nbsp;<span class="op" id="2013387">(</span><span class="ident" id="2013388">bit1</span>&nbsp;<span class="op" id="2013393">+</span>&nbsp;<span class="num" id="2013395">0</span><span class="op" id="2013396">*</span><span class="ident" id="2013397">bitx</span><span class="op" id="2013401">)</span><span class="op" id="2013402">)</span>&nbsp;<span class="op" id="2013404">-</span>&nbsp;<span class="num" id="2013406">1</span>&nbsp;<span class="comment" id="2013408">/*&nbsp;0000&nbsp;0000&nbsp;0111&nbsp;1111&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013435">rune2</span>&nbsp;<span class="op" id="2013441">=</span>&nbsp;<span class="op" id="2013443">(</span><span class="num" id="2013444">1</span>&nbsp;<span class="op" id="2013446">&lt;&lt;</span>&nbsp;<span class="op" id="2013449">(</span><span class="ident" id="2013450">bit2</span>&nbsp;<span class="op" id="2013455">+</span>&nbsp;<span class="num" id="2013457">1</span><span class="op" id="2013458">*</span><span class="ident" id="2013459">bitx</span><span class="op" id="2013463">)</span><span class="op" id="2013464">)</span>&nbsp;<span class="op" id="2013466">-</span>&nbsp;<span class="num" id="2013468">1</span>&nbsp;<span class="comment" id="2013470">/*&nbsp;0000&nbsp;0111&nbsp;1111&nbsp;1111&nbsp;*/</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013497">rune3</span>&nbsp;<span class="op" id="2013503">=</span>&nbsp;<span class="op" id="2013505">(</span><span class="num" id="2013506">1</span>&nbsp;<span class="op" id="2013508">&lt;&lt;</span>&nbsp;<span class="op" id="2013511">(</span><span class="ident" id="2013512">bit3</span>&nbsp;<span class="op" id="2013517">+</span>&nbsp;<span class="num" id="2013519">2</span><span class="op" id="2013520">*</span><span class="ident" id="2013521">bitx</span><span class="op" id="2013525">)</span><span class="op" id="2013526">)</span>&nbsp;<span class="op" id="2013528">-</span>&nbsp;<span class="num" id="2013530">1</span>&nbsp;<span class="comment" id="2013532">/*&nbsp;1111&nbsp;1111&nbsp;1111&nbsp;1111&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013559">rune4</span>&nbsp;<span class="op" id="2013565">=</span>&nbsp;<span class="op" id="2013567">(</span><span class="num" id="2013568">1</span>&nbsp;<span class="op" id="2013570">&lt;&lt;</span>&nbsp;<span class="op" id="2013573">(</span><span class="ident" id="2013574">bit4</span>&nbsp;<span class="op" id="2013579">+</span>&nbsp;<span class="num" id="2013581">3</span><span class="op" id="2013582">*</span><span class="ident" id="2013583">bitx</span><span class="op" id="2013587">)</span><span class="op" id="2013588">)</span>&nbsp;<span class="op" id="2013590">-</span>&nbsp;<span class="num" id="2013592">1</span>&nbsp;<span class="comment" id="2013594">/*&nbsp;0001&nbsp;1111&nbsp;1111&nbsp;1111&nbsp;1111&nbsp;1111&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013632">maskx</span>&nbsp;<span class="op" id="2013638">=</span>&nbsp;<span class="op" id="2013640">(</span><span class="num" id="2013641">1</span>&nbsp;<span class="op" id="2013643">&lt;&lt;</span>&nbsp;<span class="ident" id="2013646">bitx</span><span class="op" id="2013650">)</span>&nbsp;<span class="op" id="2013652">-</span>&nbsp;<span class="num" id="2013654">1</span>&nbsp;<span class="comment" id="2013656">/*&nbsp;0011&nbsp;1111&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013673">testx</span>&nbsp;<span class="op" id="2013679">=</span>&nbsp;<span class="ident" id="2013681">maskx</span>&nbsp;<span class="op" id="2013687">^</span>&nbsp;<span class="num" id="2013689">0xFF</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2013697">/*&nbsp;1100&nbsp;0000&nbsp;*/</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013715">runeerror</span>&nbsp;<span class="op" id="2013725">=</span>&nbsp;<span class="num" id="2013727">0xFFFD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013735">runeself</span>&nbsp;&nbsp;<span class="op" id="2013745">=</span>&nbsp;<span class="num" id="2013747">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013754">surrogateMin</span>&nbsp;<span class="op" id="2013767">=</span>&nbsp;<span class="num" id="2013769">0xD800</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013777">surrogateMax</span>&nbsp;<span class="op" id="2013790">=</span>&nbsp;<span class="num" id="2013792">0xDFFF</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013801">bad</span>&nbsp;<span class="op" id="2013805">=</span>&nbsp;<span class="ident" id="2013807">runeerror</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013819">runemax</span>&nbsp;<span class="op" id="2013827">=</span>&nbsp;<span class="num" id="2013829">0x10FFFF</span>&nbsp;<span class="comment" id="2013838">/*&nbsp;maximum&nbsp;rune&nbsp;value&nbsp;*/</span><br>
<span class="lineno">55</span><span class="op" id="2013863">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2013866">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Modified&nbsp;by&nbsp;Wei-Hwa&nbsp;Huang,&nbsp;Google&nbsp;Inc.,&nbsp;on&nbsp;2004-09-24<br>
<span class="lineno"></span>&nbsp;*&nbsp;This&nbsp;is&nbsp;a&nbsp;slower&nbsp;but&nbsp;&#34;safe&#34;&nbsp;version&nbsp;of&nbsp;the&nbsp;old&nbsp;chartorune<br>
<span class="lineno">60</span>&nbsp;*&nbsp;that&nbsp;works&nbsp;on&nbsp;strings&nbsp;that&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;null-terminated.<br>
<span class="lineno"></span>&nbsp;*<br>
<span class="lineno"></span>&nbsp;*&nbsp;If&nbsp;you&nbsp;know&nbsp;for&nbsp;sure&nbsp;that&nbsp;your&nbsp;string&nbsp;is&nbsp;null-terminated,<br>
<span class="lineno"></span>&nbsp;*&nbsp;chartorune&nbsp;will&nbsp;be&nbsp;a&nbsp;bit&nbsp;faster.<br>
<span class="lineno"></span>&nbsp;*<br>
<span class="lineno">65</span>&nbsp;*&nbsp;It&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to&nbsp;attempt&nbsp;to&nbsp;access&nbsp;&#34;length&#34;<br>
<span class="lineno"></span>&nbsp;*&nbsp;past&nbsp;the&nbsp;incoming&nbsp;pointer.&nbsp;&nbsp;This&nbsp;is&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>&nbsp;*&nbsp;possible&nbsp;access&nbsp;violations.&nbsp;&nbsp;If&nbsp;the&nbsp;string&nbsp;appears&nbsp;to&nbsp;be<br>
<span class="lineno"></span>&nbsp;*&nbsp;well-formed&nbsp;but&nbsp;incomplete&nbsp;(i.e.,&nbsp;to&nbsp;get&nbsp;the&nbsp;whole&nbsp;Rune<br>
<span class="lineno"></span>&nbsp;*&nbsp;we&#39;d&nbsp;need&nbsp;to&nbsp;read&nbsp;past&nbsp;str+length)&nbsp;then&nbsp;we&#39;ll&nbsp;set&nbsp;the&nbsp;Rune<br>
<span class="lineno">70</span>&nbsp;*&nbsp;to&nbsp;Bad&nbsp;and&nbsp;return&nbsp;0.<br>
<span class="lineno"></span>&nbsp;*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Note&nbsp;that&nbsp;if&nbsp;we&nbsp;have&nbsp;decoding&nbsp;problems&nbsp;for&nbsp;other<br>
<span class="lineno"></span>&nbsp;*&nbsp;reasons,&nbsp;we&nbsp;return&nbsp;1&nbsp;instead&nbsp;of&nbsp;0.<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno">75</span><span class="keyword" id="2014561">func</span>&nbsp;<span class="ident" id="2014566">charntorune</span><span class="op" id="2014577">(</span><span class="ident" id="2014578">s</span>&nbsp;<span class="builtintype" id="2014580">string</span><span class="op" id="2014586">)</span>&nbsp;<span class="op" id="2014588">(</span><span class="builtintype" id="2014589">rune</span><span class="op" id="2014593">,</span>&nbsp;<span class="builtintype" id="2014595">int</span><span class="op" id="2014598">)</span>&nbsp;<span class="op" id="2014600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014603">/*&nbsp;When&nbsp;we&#39;re&nbsp;not&nbsp;allowed&nbsp;to&nbsp;read&nbsp;anything&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014650">if</span>&nbsp;<span class="builtinfunc" id="2014653">len</span><span class="op" id="2014656">(</span><span class="ident" id="2014657">s</span><span class="op" id="2014658">)</span>&nbsp;<span class="op" id="2014660">&lt;=</span>&nbsp;<span class="num" id="2014663">0</span>&nbsp;<span class="op" id="2014665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014669">return</span>&nbsp;<span class="ident" id="2014676">bad</span><span class="op" id="2014679">,</span>&nbsp;<span class="num" id="2014681">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2014684">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014688">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;one&nbsp;character&nbsp;sequence&nbsp;(7-bit&nbsp;value)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp00000-0007F&nbsp;=&gt;&nbsp;T1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014760">c</span>&nbsp;<span class="op" id="2014762">:=</span>&nbsp;<span class="ident" id="2014765">s</span><span class="op" id="2014766">[</span><span class="num" id="2014767">0</span><span class="op" id="2014768">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014771">if</span>&nbsp;<span class="ident" id="2014774">c</span>&nbsp;<span class="op" id="2014776">&lt;</span>&nbsp;<span class="ident" id="2014778">tx</span>&nbsp;<span class="op" id="2014781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014785">return</span>&nbsp;<span class="builtintype" id="2014792">rune</span><span class="op" id="2014796">(</span><span class="ident" id="2014797">c</span><span class="op" id="2014798">)</span><span class="op" id="2014799">,</span>&nbsp;<span class="num" id="2014801">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2014804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014808">//&nbsp;If&nbsp;we&nbsp;can&#39;t&nbsp;read&nbsp;more&nbsp;than&nbsp;one&nbsp;character&nbsp;we&nbsp;must&nbsp;stop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014866">if</span>&nbsp;<span class="builtinfunc" id="2014869">len</span><span class="op" id="2014872">(</span><span class="ident" id="2014873">s</span><span class="op" id="2014874">)</span>&nbsp;<span class="op" id="2014876">&lt;=</span>&nbsp;<span class="num" id="2014879">1</span>&nbsp;<span class="op" id="2014881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014885">return</span>&nbsp;<span class="ident" id="2014892">bad</span><span class="op" id="2014895">,</span>&nbsp;<span class="num" id="2014897">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2014900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014904">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;two&nbsp;character&nbsp;sequence&nbsp;(11-bit&nbsp;value)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp0080-07FF&nbsp;=&gt;&nbsp;t2&nbsp;tx<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014978">c1</span>&nbsp;<span class="op" id="2014981">:=</span>&nbsp;<span class="ident" id="2014984">s</span><span class="op" id="2014985">[</span><span class="num" id="2014986">1</span><span class="op" id="2014987">]</span>&nbsp;<span class="op" id="2014989">^</span>&nbsp;<span class="ident" id="2014991">tx</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014995">if</span>&nbsp;<span class="op" id="2014998">(</span><span class="ident" id="2014999">c1</span>&nbsp;<span class="op" id="2015002">&amp;</span>&nbsp;<span class="ident" id="2015004">testx</span><span class="op" id="2015009">)</span>&nbsp;<span class="op" id="2015011">!=</span>&nbsp;<span class="num" id="2015014">0</span>&nbsp;<span class="op" id="2015016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015020">return</span>&nbsp;<span class="ident" id="2015027">bad</span><span class="op" id="2015030">,</span>&nbsp;<span class="num" id="2015032">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015038">if</span>&nbsp;<span class="ident" id="2015041">c</span>&nbsp;<span class="op" id="2015043">&lt;</span>&nbsp;<span class="ident" id="2015045">t3</span>&nbsp;<span class="op" id="2015048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015052">if</span>&nbsp;<span class="ident" id="2015055">c</span>&nbsp;<span class="op" id="2015057">&lt;</span>&nbsp;<span class="ident" id="2015059">t2</span>&nbsp;<span class="op" id="2015062">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015067">return</span>&nbsp;<span class="ident" id="2015074">bad</span><span class="op" id="2015077">,</span>&nbsp;<span class="num" id="2015079">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015087">l</span>&nbsp;<span class="op" id="2015089">:=</span>&nbsp;<span class="op" id="2015092">(</span><span class="op" id="2015093">(</span><span class="builtintype" id="2015094">rune</span><span class="op" id="2015098">(</span><span class="ident" id="2015099">c</span><span class="op" id="2015100">)</span>&nbsp;<span class="op" id="2015102">&lt;&lt;</span>&nbsp;<span class="ident" id="2015105">bitx</span><span class="op" id="2015109">)</span>&nbsp;<span class="op" id="2015111">|</span>&nbsp;<span class="builtintype" id="2015113">rune</span><span class="op" id="2015117">(</span><span class="ident" id="2015118">c1</span><span class="op" id="2015120">)</span><span class="op" id="2015121">)</span>&nbsp;<span class="op" id="2015123">&amp;</span>&nbsp;<span class="ident" id="2015125">rune2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015133">if</span>&nbsp;<span class="ident" id="2015136">l</span>&nbsp;<span class="op" id="2015138">&lt;=</span>&nbsp;<span class="ident" id="2015141">rune1</span>&nbsp;<span class="op" id="2015147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015152">return</span>&nbsp;<span class="ident" id="2015159">bad</span><span class="op" id="2015162">,</span>&nbsp;<span class="num" id="2015164">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015172">return</span>&nbsp;<span class="ident" id="2015179">l</span><span class="op" id="2015180">,</span>&nbsp;<span class="num" id="2015182">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015189">//&nbsp;If&nbsp;we&nbsp;can&#39;t&nbsp;read&nbsp;more&nbsp;than&nbsp;two&nbsp;characters&nbsp;we&nbsp;must&nbsp;stop</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015248">if</span>&nbsp;<span class="builtinfunc" id="2015251">len</span><span class="op" id="2015254">(</span><span class="ident" id="2015255">s</span><span class="op" id="2015256">)</span>&nbsp;<span class="op" id="2015258">&lt;=</span>&nbsp;<span class="num" id="2015261">2</span>&nbsp;<span class="op" id="2015263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015267">return</span>&nbsp;<span class="ident" id="2015274">bad</span><span class="op" id="2015277">,</span>&nbsp;<span class="num" id="2015279">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015286">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;three&nbsp;character&nbsp;sequence&nbsp;(16-bit&nbsp;value)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp0800-FFFF&nbsp;=&gt;&nbsp;t3&nbsp;tx&nbsp;tx<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015365">c2</span>&nbsp;<span class="op" id="2015368">:=</span>&nbsp;<span class="ident" id="2015371">s</span><span class="op" id="2015372">[</span><span class="num" id="2015373">2</span><span class="op" id="2015374">]</span>&nbsp;<span class="op" id="2015376">^</span>&nbsp;<span class="ident" id="2015378">tx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015382">if</span>&nbsp;<span class="op" id="2015385">(</span><span class="ident" id="2015386">c2</span>&nbsp;<span class="op" id="2015389">&amp;</span>&nbsp;<span class="ident" id="2015391">testx</span><span class="op" id="2015396">)</span>&nbsp;<span class="op" id="2015398">!=</span>&nbsp;<span class="num" id="2015401">0</span>&nbsp;<span class="op" id="2015403">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015407">return</span>&nbsp;<span class="ident" id="2015414">bad</span><span class="op" id="2015417">,</span>&nbsp;<span class="num" id="2015419">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015425">if</span>&nbsp;<span class="ident" id="2015428">c</span>&nbsp;<span class="op" id="2015430">&lt;</span>&nbsp;<span class="ident" id="2015432">t4</span>&nbsp;<span class="op" id="2015435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015439">l</span>&nbsp;<span class="op" id="2015441">:=</span>&nbsp;<span class="op" id="2015444">(</span><span class="op" id="2015445">(</span><span class="op" id="2015446">(</span><span class="op" id="2015447">(</span><span class="builtintype" id="2015448">rune</span><span class="op" id="2015452">(</span><span class="ident" id="2015453">c</span><span class="op" id="2015454">)</span>&nbsp;<span class="op" id="2015456">&lt;&lt;</span>&nbsp;<span class="ident" id="2015459">bitx</span><span class="op" id="2015463">)</span>&nbsp;<span class="op" id="2015465">|</span>&nbsp;<span class="builtintype" id="2015467">rune</span><span class="op" id="2015471">(</span><span class="ident" id="2015472">c1</span><span class="op" id="2015474">)</span><span class="op" id="2015475">)</span>&nbsp;<span class="op" id="2015477">&lt;&lt;</span>&nbsp;<span class="ident" id="2015480">bitx</span><span class="op" id="2015484">)</span>&nbsp;<span class="op" id="2015486">|</span>&nbsp;<span class="builtintype" id="2015488">rune</span><span class="op" id="2015492">(</span><span class="ident" id="2015493">c2</span><span class="op" id="2015495">)</span><span class="op" id="2015496">)</span>&nbsp;<span class="op" id="2015498">&amp;</span>&nbsp;<span class="ident" id="2015500">rune3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015508">if</span>&nbsp;<span class="ident" id="2015511">l</span>&nbsp;<span class="op" id="2015513">&lt;=</span>&nbsp;<span class="ident" id="2015516">rune2</span>&nbsp;<span class="op" id="2015522">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015527">return</span>&nbsp;<span class="ident" id="2015534">bad</span><span class="op" id="2015537">,</span>&nbsp;<span class="num" id="2015539">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015547">if</span>&nbsp;<span class="ident" id="2015550">surrogateMin</span>&nbsp;<span class="op" id="2015563">&lt;=</span>&nbsp;<span class="ident" id="2015566">l</span>&nbsp;<span class="op" id="2015568">&amp;&amp;</span>&nbsp;<span class="ident" id="2015571">l</span>&nbsp;<span class="op" id="2015573">&lt;=</span>&nbsp;<span class="ident" id="2015576">surrogateMax</span>&nbsp;<span class="op" id="2015589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015594">return</span>&nbsp;<span class="ident" id="2015601">bad</span><span class="op" id="2015604">,</span>&nbsp;<span class="num" id="2015606">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015610">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015614">return</span>&nbsp;<span class="ident" id="2015621">l</span><span class="op" id="2015622">,</span>&nbsp;<span class="num" id="2015624">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015631">if</span>&nbsp;<span class="builtinfunc" id="2015634">len</span><span class="op" id="2015637">(</span><span class="ident" id="2015638">s</span><span class="op" id="2015639">)</span>&nbsp;<span class="op" id="2015641">&lt;=</span>&nbsp;<span class="num" id="2015644">3</span>&nbsp;<span class="op" id="2015646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015650">return</span>&nbsp;<span class="ident" id="2015657">bad</span><span class="op" id="2015660">,</span>&nbsp;<span class="num" id="2015662">1</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015669">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;four&nbsp;character&nbsp;sequence&nbsp;(21-bit&nbsp;value)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp10000-1FFFFF&nbsp;=&gt;&nbsp;t4&nbsp;tx&nbsp;tx&nbsp;tx<br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015753">c3</span>&nbsp;<span class="op" id="2015756">:=</span>&nbsp;<span class="ident" id="2015759">s</span><span class="op" id="2015760">[</span><span class="num" id="2015761">3</span><span class="op" id="2015762">]</span>&nbsp;<span class="op" id="2015764">^</span>&nbsp;<span class="ident" id="2015766">tx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015770">if</span>&nbsp;<span class="op" id="2015773">(</span><span class="ident" id="2015774">c3</span>&nbsp;<span class="op" id="2015777">&amp;</span>&nbsp;<span class="ident" id="2015779">testx</span><span class="op" id="2015784">)</span>&nbsp;<span class="op" id="2015786">!=</span>&nbsp;<span class="num" id="2015789">0</span>&nbsp;<span class="op" id="2015791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015795">return</span>&nbsp;<span class="ident" id="2015802">bad</span><span class="op" id="2015805">,</span>&nbsp;<span class="num" id="2015807">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015810">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015813">if</span>&nbsp;<span class="ident" id="2015816">c</span>&nbsp;<span class="op" id="2015818">&lt;</span>&nbsp;<span class="ident" id="2015820">t5</span>&nbsp;<span class="op" id="2015823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015827">l</span>&nbsp;<span class="op" id="2015829">:=</span>&nbsp;<span class="op" id="2015832">(</span><span class="op" id="2015833">(</span><span class="op" id="2015834">(</span><span class="op" id="2015835">(</span><span class="op" id="2015836">(</span><span class="op" id="2015837">(</span><span class="builtintype" id="2015838">rune</span><span class="op" id="2015842">(</span><span class="ident" id="2015843">c</span><span class="op" id="2015844">)</span>&nbsp;<span class="op" id="2015846">&lt;&lt;</span>&nbsp;<span class="ident" id="2015849">bitx</span><span class="op" id="2015853">)</span>&nbsp;<span class="op" id="2015855">|</span>&nbsp;<span class="builtintype" id="2015857">rune</span><span class="op" id="2015861">(</span><span class="ident" id="2015862">c1</span><span class="op" id="2015864">)</span><span class="op" id="2015865">)</span>&nbsp;<span class="op" id="2015867">&lt;&lt;</span>&nbsp;<span class="ident" id="2015870">bitx</span><span class="op" id="2015874">)</span>&nbsp;<span class="op" id="2015876">|</span>&nbsp;<span class="builtintype" id="2015878">rune</span><span class="op" id="2015882">(</span><span class="ident" id="2015883">c2</span><span class="op" id="2015885">)</span><span class="op" id="2015886">)</span>&nbsp;<span class="op" id="2015888">&lt;&lt;</span>&nbsp;<span class="ident" id="2015891">bitx</span><span class="op" id="2015895">)</span>&nbsp;<span class="op" id="2015897">|</span>&nbsp;<span class="builtintype" id="2015899">rune</span><span class="op" id="2015903">(</span><span class="ident" id="2015904">c3</span><span class="op" id="2015906">)</span><span class="op" id="2015907">)</span>&nbsp;<span class="op" id="2015909">&amp;</span>&nbsp;<span class="ident" id="2015911">rune4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015919">if</span>&nbsp;<span class="ident" id="2015922">l</span>&nbsp;<span class="op" id="2015924">&lt;=</span>&nbsp;<span class="ident" id="2015927">rune3</span>&nbsp;<span class="op" id="2015933">||</span>&nbsp;<span class="ident" id="2015936">l</span>&nbsp;<span class="op" id="2015938">&gt;</span>&nbsp;<span class="ident" id="2015940">runemax</span>&nbsp;<span class="op" id="2015948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015953">return</span>&nbsp;<span class="ident" id="2015960">bad</span><span class="op" id="2015963">,</span>&nbsp;<span class="num" id="2015965">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015969">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015973">return</span>&nbsp;<span class="ident" id="2015980">l</span><span class="op" id="2015981">,</span>&nbsp;<span class="num" id="2015983">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015990">//&nbsp;Support&nbsp;for&nbsp;5-byte&nbsp;or&nbsp;longer&nbsp;UTF-8&nbsp;would&nbsp;go&nbsp;here,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016048">//&nbsp;since&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;that,&nbsp;we&#39;ll&nbsp;just&nbsp;return&nbsp;bad.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016101">return</span>&nbsp;<span class="ident" id="2016108">bad</span><span class="op" id="2016111">,</span>&nbsp;<span class="num" id="2016113">1</span><br>
<span class="lineno"></span><span class="op" id="2016115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2016118">//&nbsp;runetochar&nbsp;converts&nbsp;r&nbsp;to&nbsp;bytes&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;str.</span><br>
<span class="lineno"></span><span class="comment" id="2016182">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;generated.</span><br>
<span class="lineno">165</span><span class="keyword" id="2016224">func</span>&nbsp;<span class="ident" id="2016229">runetochar</span><span class="op" id="2016239">(</span><span class="ident" id="2016240">str</span>&nbsp;<span class="op" id="2016244">[</span><span class="op" id="2016245">]</span><span class="builtintype" id="2016246">byte</span><span class="op" id="2016250">,</span>&nbsp;<span class="ident" id="2016252">r</span>&nbsp;<span class="builtintype" id="2016254">rune</span><span class="op" id="2016258">)</span>&nbsp;<span class="builtintype" id="2016260">int</span>&nbsp;<span class="op" id="2016264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016267">/*&nbsp;runes&nbsp;are&nbsp;signed,&nbsp;so&nbsp;convert&nbsp;to&nbsp;unsigned&nbsp;for&nbsp;range&nbsp;check.&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016332">c</span>&nbsp;<span class="op" id="2016334">:=</span>&nbsp;<span class="builtintype" id="2016337">uint32</span><span class="op" id="2016343">(</span><span class="ident" id="2016344">r</span><span class="op" id="2016345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016348">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;one&nbsp;character&nbsp;sequence<br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp00000-0007F&nbsp;=&gt;&nbsp;00-7F<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016409">if</span>&nbsp;<span class="ident" id="2016412">c</span>&nbsp;<span class="op" id="2016414">&lt;=</span>&nbsp;<span class="ident" id="2016417">rune1</span>&nbsp;<span class="op" id="2016423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016427">str</span><span class="op" id="2016430">[</span><span class="num" id="2016431">0</span><span class="op" id="2016432">]</span>&nbsp;<span class="op" id="2016434">=</span>&nbsp;<span class="builtintype" id="2016436">byte</span><span class="op" id="2016440">(</span><span class="ident" id="2016441">c</span><span class="op" id="2016442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016446">return</span>&nbsp;<span class="num" id="2016453">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016459">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;two&nbsp;character&nbsp;sequence<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp0080-07FF&nbsp;=&gt;&nbsp;t2&nbsp;tx<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016518">if</span>&nbsp;<span class="ident" id="2016521">c</span>&nbsp;<span class="op" id="2016523">&lt;=</span>&nbsp;<span class="ident" id="2016526">rune2</span>&nbsp;<span class="op" id="2016532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016536">str</span><span class="op" id="2016539">[</span><span class="num" id="2016540">0</span><span class="op" id="2016541">]</span>&nbsp;<span class="op" id="2016543">=</span>&nbsp;<span class="builtintype" id="2016545">byte</span><span class="op" id="2016549">(</span><span class="ident" id="2016550">t2</span>&nbsp;<span class="op" id="2016553">|</span>&nbsp;<span class="op" id="2016555">(</span><span class="ident" id="2016556">c</span>&nbsp;<span class="op" id="2016558">&gt;&gt;</span>&nbsp;<span class="op" id="2016561">(</span><span class="num" id="2016562">1</span>&nbsp;<span class="op" id="2016564">*</span>&nbsp;<span class="ident" id="2016566">bitx</span><span class="op" id="2016570">)</span><span class="op" id="2016571">)</span><span class="op" id="2016572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016576">str</span><span class="op" id="2016579">[</span><span class="num" id="2016580">1</span><span class="op" id="2016581">]</span>&nbsp;<span class="op" id="2016583">=</span>&nbsp;<span class="builtintype" id="2016585">byte</span><span class="op" id="2016589">(</span><span class="ident" id="2016590">tx</span>&nbsp;<span class="op" id="2016593">|</span>&nbsp;<span class="op" id="2016595">(</span><span class="ident" id="2016596">c</span>&nbsp;<span class="op" id="2016598">&amp;</span>&nbsp;<span class="ident" id="2016600">maskx</span><span class="op" id="2016605">)</span><span class="op" id="2016606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016610">return</span>&nbsp;<span class="num" id="2016617">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016620">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016624">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;If&nbsp;the&nbsp;rune&nbsp;is&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half,&nbsp;convert&nbsp;it&nbsp;to&nbsp;the&nbsp;error&nbsp;rune.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Do&nbsp;this&nbsp;test&nbsp;here&nbsp;because&nbsp;the&nbsp;error&nbsp;rune&nbsp;encodes&nbsp;to&nbsp;three&nbsp;bytes.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Doing&nbsp;it&nbsp;earlier&nbsp;would&nbsp;duplicate&nbsp;work,&nbsp;since&nbsp;an&nbsp;out&nbsp;of&nbsp;range<br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;rune&nbsp;wouldn&#39;t&nbsp;have&nbsp;fit&nbsp;in&nbsp;one&nbsp;or&nbsp;two&nbsp;bytes.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016898">if</span>&nbsp;<span class="ident" id="2016901">c</span>&nbsp;<span class="op" id="2016903">&gt;</span>&nbsp;<span class="ident" id="2016905">runemax</span>&nbsp;<span class="op" id="2016913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016917">c</span>&nbsp;<span class="op" id="2016919">=</span>&nbsp;<span class="ident" id="2016921">runeerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016932">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016935">if</span>&nbsp;<span class="ident" id="2016938">surrogateMin</span>&nbsp;<span class="op" id="2016951">&lt;=</span>&nbsp;<span class="ident" id="2016954">c</span>&nbsp;<span class="op" id="2016956">&amp;&amp;</span>&nbsp;<span class="ident" id="2016959">c</span>&nbsp;<span class="op" id="2016961">&lt;=</span>&nbsp;<span class="ident" id="2016964">surrogateMax</span>&nbsp;<span class="op" id="2016977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016981">c</span>&nbsp;<span class="op" id="2016983">=</span>&nbsp;<span class="ident" id="2016985">runeerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017000">/*<br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;three&nbsp;character&nbsp;sequence<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp0800-FFFF&nbsp;=&gt;&nbsp;t3&nbsp;tx&nbsp;tx<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017064">if</span>&nbsp;<span class="ident" id="2017067">c</span>&nbsp;<span class="op" id="2017069">&lt;=</span>&nbsp;<span class="ident" id="2017072">rune3</span>&nbsp;<span class="op" id="2017078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017082">str</span><span class="op" id="2017085">[</span><span class="num" id="2017086">0</span><span class="op" id="2017087">]</span>&nbsp;<span class="op" id="2017089">=</span>&nbsp;<span class="builtintype" id="2017091">byte</span><span class="op" id="2017095">(</span><span class="ident" id="2017096">t3</span>&nbsp;<span class="op" id="2017099">|</span>&nbsp;<span class="op" id="2017101">(</span><span class="ident" id="2017102">c</span>&nbsp;<span class="op" id="2017104">&gt;&gt;</span>&nbsp;<span class="op" id="2017107">(</span><span class="num" id="2017108">2</span>&nbsp;<span class="op" id="2017110">*</span>&nbsp;<span class="ident" id="2017112">bitx</span><span class="op" id="2017116">)</span><span class="op" id="2017117">)</span><span class="op" id="2017118">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017122">str</span><span class="op" id="2017125">[</span><span class="num" id="2017126">1</span><span class="op" id="2017127">]</span>&nbsp;<span class="op" id="2017129">=</span>&nbsp;<span class="builtintype" id="2017131">byte</span><span class="op" id="2017135">(</span><span class="ident" id="2017136">tx</span>&nbsp;<span class="op" id="2017139">|</span>&nbsp;<span class="op" id="2017141">(</span><span class="op" id="2017142">(</span><span class="ident" id="2017143">c</span>&nbsp;<span class="op" id="2017145">&gt;&gt;</span>&nbsp;<span class="op" id="2017148">(</span><span class="num" id="2017149">1</span>&nbsp;<span class="op" id="2017151">*</span>&nbsp;<span class="ident" id="2017153">bitx</span><span class="op" id="2017157">)</span><span class="op" id="2017158">)</span>&nbsp;<span class="op" id="2017160">&amp;</span>&nbsp;<span class="ident" id="2017162">maskx</span><span class="op" id="2017167">)</span><span class="op" id="2017168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017172">str</span><span class="op" id="2017175">[</span><span class="num" id="2017176">2</span><span class="op" id="2017177">]</span>&nbsp;<span class="op" id="2017179">=</span>&nbsp;<span class="builtintype" id="2017181">byte</span><span class="op" id="2017185">(</span><span class="ident" id="2017186">tx</span>&nbsp;<span class="op" id="2017189">|</span>&nbsp;<span class="op" id="2017191">(</span><span class="ident" id="2017192">c</span>&nbsp;<span class="op" id="2017194">&amp;</span>&nbsp;<span class="ident" id="2017196">maskx</span><span class="op" id="2017201">)</span><span class="op" id="2017202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017206">return</span>&nbsp;<span class="num" id="2017213">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017220">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;four&nbsp;character&nbsp;sequence&nbsp;(21-bit&nbsp;value)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10000-1FFFFF&nbsp;=&gt;&nbsp;t4&nbsp;tx&nbsp;tx&nbsp;tx<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017308">str</span><span class="op" id="2017311">[</span><span class="num" id="2017312">0</span><span class="op" id="2017313">]</span>&nbsp;<span class="op" id="2017315">=</span>&nbsp;<span class="builtintype" id="2017317">byte</span><span class="op" id="2017321">(</span><span class="ident" id="2017322">t4</span>&nbsp;<span class="op" id="2017325">|</span>&nbsp;<span class="op" id="2017327">(</span><span class="ident" id="2017328">c</span>&nbsp;<span class="op" id="2017330">&gt;&gt;</span>&nbsp;<span class="op" id="2017333">(</span><span class="num" id="2017334">3</span>&nbsp;<span class="op" id="2017336">*</span>&nbsp;<span class="ident" id="2017338">bitx</span><span class="op" id="2017342">)</span><span class="op" id="2017343">)</span><span class="op" id="2017344">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017347">str</span><span class="op" id="2017350">[</span><span class="num" id="2017351">1</span><span class="op" id="2017352">]</span>&nbsp;<span class="op" id="2017354">=</span>&nbsp;<span class="builtintype" id="2017356">byte</span><span class="op" id="2017360">(</span><span class="ident" id="2017361">tx</span>&nbsp;<span class="op" id="2017364">|</span>&nbsp;<span class="op" id="2017366">(</span><span class="op" id="2017367">(</span><span class="ident" id="2017368">c</span>&nbsp;<span class="op" id="2017370">&gt;&gt;</span>&nbsp;<span class="op" id="2017373">(</span><span class="num" id="2017374">2</span>&nbsp;<span class="op" id="2017376">*</span>&nbsp;<span class="ident" id="2017378">bitx</span><span class="op" id="2017382">)</span><span class="op" id="2017383">)</span>&nbsp;<span class="op" id="2017385">&amp;</span>&nbsp;<span class="ident" id="2017387">maskx</span><span class="op" id="2017392">)</span><span class="op" id="2017393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017396">str</span><span class="op" id="2017399">[</span><span class="num" id="2017400">2</span><span class="op" id="2017401">]</span>&nbsp;<span class="op" id="2017403">=</span>&nbsp;<span class="builtintype" id="2017405">byte</span><span class="op" id="2017409">(</span><span class="ident" id="2017410">tx</span>&nbsp;<span class="op" id="2017413">|</span>&nbsp;<span class="op" id="2017415">(</span><span class="op" id="2017416">(</span><span class="ident" id="2017417">c</span>&nbsp;<span class="op" id="2017419">&gt;&gt;</span>&nbsp;<span class="op" id="2017422">(</span><span class="num" id="2017423">1</span>&nbsp;<span class="op" id="2017425">*</span>&nbsp;<span class="ident" id="2017427">bitx</span><span class="op" id="2017431">)</span><span class="op" id="2017432">)</span>&nbsp;<span class="op" id="2017434">&amp;</span>&nbsp;<span class="ident" id="2017436">maskx</span><span class="op" id="2017441">)</span><span class="op" id="2017442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017445">str</span><span class="op" id="2017448">[</span><span class="num" id="2017449">3</span><span class="op" id="2017450">]</span>&nbsp;<span class="op" id="2017452">=</span>&nbsp;<span class="builtintype" id="2017454">byte</span><span class="op" id="2017458">(</span><span class="ident" id="2017459">tx</span>&nbsp;<span class="op" id="2017462">|</span>&nbsp;<span class="op" id="2017464">(</span><span class="ident" id="2017465">c</span>&nbsp;<span class="op" id="2017467">&amp;</span>&nbsp;<span class="ident" id="2017469">maskx</span><span class="op" id="2017474">)</span><span class="op" id="2017475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017478">return</span>&nbsp;<span class="num" id="2017485">4</span><br>
<span class="lineno"></span><span class="op" id="2017487">}</span>
</div>
</body>
</html>
