<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7566270">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7566326">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7566380">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7566431">package</span>&nbsp;<span class="ident" id="7566439">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7566444">import</span>&nbsp;<span class="op" id="7566451">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7566454">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7566465">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7566476">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7566487">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7566498">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7566505">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7566508">func</span>&nbsp;<span class="ident" id="7566513">TestResolveUDPAddr</span><span class="op" id="7566531">(</span><span class="ident" id="7566532">t</span>&nbsp;<span class="op" id="7566534">*</span><span class="ident" id="7566535">testing</span><span class="op" id="7566542">.</span><span class="ident" id="7566543">T</span><span class="op" id="7566544">)</span>&nbsp;<span class="op" id="7566546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566549">for</span>&nbsp;<span class="ident" id="7566553">_</span><span class="op" id="7566554">,</span>&nbsp;<span class="ident" id="7566556">tt</span>&nbsp;<span class="op" id="7566559">:=</span>&nbsp;<span class="keyword" id="7566562">range</span>&nbsp;<span class="ident" id="7566568">resolveTCPAddrTests</span>&nbsp;<span class="op" id="7566588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566592">net</span>&nbsp;<span class="op" id="7566596">:=</span>&nbsp;<span class="ident" id="7566599">strings</span><span class="op" id="7566606">.</span><span class="ident" id="7566607">Replace</span><span class="op" id="7566614">(</span><span class="ident" id="7566615">tt</span><span class="op" id="7566617">.</span><span class="ident" id="7566618">net</span><span class="op" id="7566621">,</span>&nbsp;<span class="string" id="7566623">&#34;tcp&#34;</span><span class="op" id="7566628">,</span>&nbsp;<span class="string" id="7566630">&#34;udp&#34;</span><span class="op" id="7566635">,</span>&nbsp;<span class="op" id="7566637">-</span><span class="num" id="7566638">1</span><span class="op" id="7566639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566643">addr</span><span class="op" id="7566647">,</span>&nbsp;<span class="ident" id="7566649">err</span>&nbsp;<span class="op" id="7566653">:=</span>&nbsp;<span class="ident" id="7566656">ResolveUDPAddr</span><span class="op" id="7566670">(</span><span class="ident" id="7566671">net</span><span class="op" id="7566674">,</span>&nbsp;<span class="ident" id="7566676">tt</span><span class="op" id="7566678">.</span><span class="ident" id="7566679">litAddrOrName</span><span class="op" id="7566692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566696">if</span>&nbsp;<span class="ident" id="7566699">err</span>&nbsp;<span class="op" id="7566703">!=</span>&nbsp;<span class="ident" id="7566706">tt</span><span class="op" id="7566708">.</span><span class="ident" id="7566709">err</span>&nbsp;<span class="op" id="7566713">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566718">t</span><span class="op" id="7566719">.</span><span class="ident" id="7566720">Fatalf</span><span class="op" id="7566726">(</span><span class="string" id="7566727">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7566762">,</span>&nbsp;<span class="ident" id="7566764">net</span><span class="op" id="7566767">,</span>&nbsp;<span class="ident" id="7566769">tt</span><span class="op" id="7566771">.</span><span class="ident" id="7566772">litAddrOrName</span><span class="op" id="7566785">,</span>&nbsp;<span class="ident" id="7566787">err</span><span class="op" id="7566790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566798">if</span>&nbsp;<span class="op" id="7566801">!</span><span class="ident" id="7566802">reflect</span><span class="op" id="7566809">.</span><span class="ident" id="7566810">DeepEqual</span><span class="op" id="7566819">(</span><span class="ident" id="7566820">addr</span><span class="op" id="7566824">,</span>&nbsp;<span class="op" id="7566826">(</span><span class="op" id="7566827">*</span><span class="ident" id="7566828">UDPAddr</span><span class="op" id="7566835">)</span><span class="op" id="7566836">(</span><span class="ident" id="7566837">tt</span><span class="op" id="7566839">.</span><span class="ident" id="7566840">addr</span><span class="op" id="7566844">)</span><span class="op" id="7566845">)</span>&nbsp;<span class="op" id="7566847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566852">t</span><span class="op" id="7566853">.</span><span class="ident" id="7566854">Fatalf</span><span class="op" id="7566860">(</span><span class="string" id="7566861">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7566901">,</span>&nbsp;<span class="ident" id="7566903">net</span><span class="op" id="7566906">,</span>&nbsp;<span class="ident" id="7566908">tt</span><span class="op" id="7566910">.</span><span class="ident" id="7566911">litAddrOrName</span><span class="op" id="7566924">,</span>&nbsp;<span class="ident" id="7566926">addr</span><span class="op" id="7566930">,</span>&nbsp;<span class="ident" id="7566932">tt</span><span class="op" id="7566934">.</span><span class="ident" id="7566935">addr</span><span class="op" id="7566939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566943">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566947">if</span>&nbsp;<span class="ident" id="7566950">err</span>&nbsp;<span class="op" id="7566954">==</span>&nbsp;<span class="ident" id="7566957">nil</span>&nbsp;<span class="op" id="7566961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566966">str</span>&nbsp;<span class="op" id="7566970">:=</span>&nbsp;<span class="ident" id="7566973">addr</span><span class="op" id="7566977">.</span><span class="ident" id="7566978">String</span><span class="op" id="7566984">(</span><span class="op" id="7566985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566990">addr1</span><span class="op" id="7566995">,</span>&nbsp;<span class="ident" id="7566997">err</span>&nbsp;<span class="op" id="7567001">:=</span>&nbsp;<span class="ident" id="7567004">ResolveUDPAddr</span><span class="op" id="7567018">(</span><span class="ident" id="7567019">net</span><span class="op" id="7567022">,</span>&nbsp;<span class="ident" id="7567024">str</span><span class="op" id="7567027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567032">if</span>&nbsp;<span class="ident" id="7567035">err</span>&nbsp;<span class="op" id="7567039">!=</span>&nbsp;<span class="ident" id="7567042">nil</span>&nbsp;<span class="op" id="7567046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567052">t</span><span class="op" id="7567053">.</span><span class="ident" id="7567054">Fatalf</span><span class="op" id="7567060">(</span><span class="string" id="7567061">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]:&nbsp;%v&#34;</span><span class="op" id="7567099">,</span>&nbsp;<span class="ident" id="7567101">net</span><span class="op" id="7567104">,</span>&nbsp;<span class="ident" id="7567106">str</span><span class="op" id="7567109">,</span>&nbsp;<span class="ident" id="7567111">tt</span><span class="op" id="7567113">.</span><span class="ident" id="7567114">litAddrOrName</span><span class="op" id="7567127">,</span>&nbsp;<span class="ident" id="7567129">err</span><span class="op" id="7567132">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567142">if</span>&nbsp;<span class="op" id="7567145">!</span><span class="ident" id="7567146">reflect</span><span class="op" id="7567153">.</span><span class="ident" id="7567154">DeepEqual</span><span class="op" id="7567163">(</span><span class="ident" id="7567164">addr1</span><span class="op" id="7567169">,</span>&nbsp;<span class="ident" id="7567171">addr</span><span class="op" id="7567175">)</span>&nbsp;<span class="op" id="7567177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567183">t</span><span class="op" id="7567184">.</span><span class="ident" id="7567185">Fatalf</span><span class="op" id="7567191">(</span><span class="string" id="7567192">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7567242">,</span>&nbsp;<span class="ident" id="7567244">net</span><span class="op" id="7567247">,</span>&nbsp;<span class="ident" id="7567249">str</span><span class="op" id="7567252">,</span>&nbsp;<span class="ident" id="7567254">tt</span><span class="op" id="7567256">.</span><span class="ident" id="7567257">litAddrOrName</span><span class="op" id="7567270">,</span>&nbsp;<span class="ident" id="7567272">addr1</span><span class="op" id="7567277">,</span>&nbsp;<span class="ident" id="7567279">addr</span><span class="op" id="7567283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567292">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567295">}</span><br>
<span class="lineno"></span><span class="op" id="7567297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7567300">func</span>&nbsp;<span class="ident" id="7567305">TestReadFromUDP</span><span class="op" id="7567320">(</span><span class="ident" id="7567321">t</span>&nbsp;<span class="op" id="7567323">*</span><span class="ident" id="7567324">testing</span><span class="op" id="7567331">.</span><span class="ident" id="7567332">T</span><span class="op" id="7567333">)</span>&nbsp;<span class="op" id="7567335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567338">switch</span>&nbsp;<span class="ident" id="7567345">runtime</span><span class="op" id="7567352">.</span><span class="ident" id="7567353">GOOS</span>&nbsp;<span class="op" id="7567358">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567361">case</span>&nbsp;<span class="string" id="7567366">&#34;nacl&#34;</span><span class="op" id="7567372">,</span>&nbsp;<span class="string" id="7567374">&#34;plan9&#34;</span><span class="op" id="7567381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567385">t</span><span class="op" id="7567386">.</span><span class="ident" id="7567387">Skipf</span><span class="op" id="7567392">(</span><span class="string" id="7567393">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q,&nbsp;see&nbsp;issue&nbsp;8916&#34;</span><span class="op" id="7567430">,</span>&nbsp;<span class="ident" id="7567432">runtime</span><span class="op" id="7567439">.</span><span class="ident" id="7567440">GOOS</span><span class="op" id="7567444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567451">ra</span><span class="op" id="7567453">,</span>&nbsp;<span class="ident" id="7567455">err</span>&nbsp;<span class="op" id="7567459">:=</span>&nbsp;<span class="ident" id="7567462">ResolveUDPAddr</span><span class="op" id="7567476">(</span><span class="string" id="7567477">&#34;udp&#34;</span><span class="op" id="7567482">,</span>&nbsp;<span class="string" id="7567484">&#34;127.0.0.1:7&#34;</span><span class="op" id="7567497">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567500">if</span>&nbsp;<span class="ident" id="7567503">err</span>&nbsp;<span class="op" id="7567507">!=</span>&nbsp;<span class="ident" id="7567510">nil</span>&nbsp;<span class="op" id="7567514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567518">t</span><span class="op" id="7567519">.</span><span class="ident" id="7567520">Fatal</span><span class="op" id="7567525">(</span><span class="ident" id="7567526">err</span><span class="op" id="7567529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567536">la</span><span class="op" id="7567538">,</span>&nbsp;<span class="ident" id="7567540">err</span>&nbsp;<span class="op" id="7567544">:=</span>&nbsp;<span class="ident" id="7567547">ResolveUDPAddr</span><span class="op" id="7567561">(</span><span class="string" id="7567562">&#34;udp&#34;</span><span class="op" id="7567567">,</span>&nbsp;<span class="string" id="7567569">&#34;127.0.0.1:0&#34;</span><span class="op" id="7567582">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567585">if</span>&nbsp;<span class="ident" id="7567588">err</span>&nbsp;<span class="op" id="7567592">!=</span>&nbsp;<span class="ident" id="7567595">nil</span>&nbsp;<span class="op" id="7567599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567603">t</span><span class="op" id="7567604">.</span><span class="ident" id="7567605">Fatal</span><span class="op" id="7567610">(</span><span class="ident" id="7567611">err</span><span class="op" id="7567614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567621">c</span><span class="op" id="7567622">,</span>&nbsp;<span class="ident" id="7567624">err</span>&nbsp;<span class="op" id="7567628">:=</span>&nbsp;<span class="ident" id="7567631">ListenUDP</span><span class="op" id="7567640">(</span><span class="string" id="7567641">&#34;udp&#34;</span><span class="op" id="7567646">,</span>&nbsp;<span class="ident" id="7567648">la</span><span class="op" id="7567650">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567653">if</span>&nbsp;<span class="ident" id="7567656">err</span>&nbsp;<span class="op" id="7567660">!=</span>&nbsp;<span class="ident" id="7567663">nil</span>&nbsp;<span class="op" id="7567667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567671">t</span><span class="op" id="7567672">.</span><span class="ident" id="7567673">Fatal</span><span class="op" id="7567678">(</span><span class="ident" id="7567679">err</span><span class="op" id="7567682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567688">defer</span>&nbsp;<span class="ident" id="7567694">c</span><span class="op" id="7567695">.</span><span class="ident" id="7567696">Close</span><span class="op" id="7567701">(</span><span class="op" id="7567702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567706">_</span><span class="op" id="7567707">,</span>&nbsp;<span class="ident" id="7567709">err</span>&nbsp;<span class="op" id="7567713">=</span>&nbsp;<span class="ident" id="7567715">c</span><span class="op" id="7567716">.</span><span class="ident" id="7567717">WriteToUDP</span><span class="op" id="7567727">(</span><span class="op" id="7567728">[</span><span class="op" id="7567729">]</span><span class="builtintype" id="7567730">byte</span><span class="op" id="7567734">(</span><span class="string" id="7567735">&#34;a&#34;</span><span class="op" id="7567738">)</span><span class="op" id="7567739">,</span>&nbsp;<span class="ident" id="7567741">ra</span><span class="op" id="7567743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567746">if</span>&nbsp;<span class="ident" id="7567749">err</span>&nbsp;<span class="op" id="7567753">!=</span>&nbsp;<span class="ident" id="7567756">nil</span>&nbsp;<span class="op" id="7567760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567764">t</span><span class="op" id="7567765">.</span><span class="ident" id="7567766">Fatal</span><span class="op" id="7567771">(</span><span class="ident" id="7567772">err</span><span class="op" id="7567775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567782">err</span>&nbsp;<span class="op" id="7567786">=</span>&nbsp;<span class="ident" id="7567788">c</span><span class="op" id="7567789">.</span><span class="ident" id="7567790">SetDeadline</span><span class="op" id="7567801">(</span><span class="ident" id="7567802">time</span><span class="op" id="7567806">.</span><span class="ident" id="7567807">Now</span><span class="op" id="7567810">(</span><span class="op" id="7567811">)</span><span class="op" id="7567812">.</span><span class="ident" id="7567813">Add</span><span class="op" id="7567816">(</span><span class="num" id="7567817">100</span>&nbsp;<span class="op" id="7567821">*</span>&nbsp;<span class="ident" id="7567823">time</span><span class="op" id="7567827">.</span><span class="ident" id="7567828">Millisecond</span><span class="op" id="7567839">)</span><span class="op" id="7567840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567843">if</span>&nbsp;<span class="ident" id="7567846">err</span>&nbsp;<span class="op" id="7567850">!=</span>&nbsp;<span class="ident" id="7567853">nil</span>&nbsp;<span class="op" id="7567857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567861">t</span><span class="op" id="7567862">.</span><span class="ident" id="7567863">Fatal</span><span class="op" id="7567868">(</span><span class="ident" id="7567869">err</span><span class="op" id="7567872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567878">b</span>&nbsp;<span class="op" id="7567880">:=</span>&nbsp;<span class="builtinfunc" id="7567883">make</span><span class="op" id="7567887">(</span><span class="op" id="7567888">[</span><span class="op" id="7567889">]</span><span class="builtintype" id="7567890">byte</span><span class="op" id="7567894">,</span>&nbsp;<span class="num" id="7567896">1</span><span class="op" id="7567897">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567900">_</span><span class="op" id="7567901">,</span>&nbsp;<span class="ident" id="7567903">_</span><span class="op" id="7567904">,</span>&nbsp;<span class="ident" id="7567906">err</span>&nbsp;<span class="op" id="7567910">=</span>&nbsp;<span class="ident" id="7567912">c</span><span class="op" id="7567913">.</span><span class="ident" id="7567914">ReadFromUDP</span><span class="op" id="7567925">(</span><span class="ident" id="7567926">b</span><span class="op" id="7567927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567930">if</span>&nbsp;<span class="ident" id="7567933">err</span>&nbsp;<span class="op" id="7567937">==</span>&nbsp;<span class="ident" id="7567940">nil</span>&nbsp;<span class="op" id="7567944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567948">t</span><span class="op" id="7567949">.</span><span class="ident" id="7567950">Fatal</span><span class="op" id="7567955">(</span><span class="string" id="7567956">&#34;ReadFromUDP&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7567981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567984">}</span>&nbsp;<span class="keyword" id="7567986">else</span>&nbsp;<span class="keyword" id="7567991">if</span>&nbsp;<span class="op" id="7567994">!</span><span class="ident" id="7567995">isTimeout</span><span class="op" id="7568004">(</span><span class="ident" id="7568005">err</span><span class="op" id="7568008">)</span>&nbsp;<span class="op" id="7568010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568014">t</span><span class="op" id="7568015">.</span><span class="ident" id="7568016">Fatal</span><span class="op" id="7568021">(</span><span class="ident" id="7568022">err</span><span class="op" id="7568025">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568028">}</span><br>
<span class="lineno"></span><span class="op" id="7568030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7568033">func</span>&nbsp;<span class="ident" id="7568038">TestWriteToUDP</span><span class="op" id="7568052">(</span><span class="ident" id="7568053">t</span>&nbsp;<span class="op" id="7568055">*</span><span class="ident" id="7568056">testing</span><span class="op" id="7568063">.</span><span class="ident" id="7568064">T</span><span class="op" id="7568065">)</span>&nbsp;<span class="op" id="7568067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568070">switch</span>&nbsp;<span class="ident" id="7568077">runtime</span><span class="op" id="7568084">.</span><span class="ident" id="7568085">GOOS</span>&nbsp;<span class="op" id="7568090">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568093">case</span>&nbsp;<span class="string" id="7568098">&#34;plan9&#34;</span><span class="op" id="7568105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568109">t</span><span class="op" id="7568110">.</span><span class="ident" id="7568111">Skipf</span><span class="op" id="7568116">(</span><span class="string" id="7568117">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7568138">,</span>&nbsp;<span class="ident" id="7568140">runtime</span><span class="op" id="7568147">.</span><span class="ident" id="7568148">GOOS</span><span class="op" id="7568152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568159">l</span><span class="op" id="7568160">,</span>&nbsp;<span class="ident" id="7568162">err</span>&nbsp;<span class="op" id="7568166">:=</span>&nbsp;<span class="ident" id="7568169">ListenPacket</span><span class="op" id="7568181">(</span><span class="string" id="7568182">&#34;udp&#34;</span><span class="op" id="7568187">,</span>&nbsp;<span class="string" id="7568189">&#34;127.0.0.1:0&#34;</span><span class="op" id="7568202">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568205">if</span>&nbsp;<span class="ident" id="7568208">err</span>&nbsp;<span class="op" id="7568212">!=</span>&nbsp;<span class="ident" id="7568215">nil</span>&nbsp;<span class="op" id="7568219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568223">t</span><span class="op" id="7568224">.</span><span class="ident" id="7568225">Fatalf</span><span class="op" id="7568231">(</span><span class="string" id="7568232">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7568251">,</span>&nbsp;<span class="ident" id="7568253">err</span><span class="op" id="7568256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568262">defer</span>&nbsp;<span class="ident" id="7568268">l</span><span class="op" id="7568269">.</span><span class="ident" id="7568270">Close</span><span class="op" id="7568275">(</span><span class="op" id="7568276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568280">testWriteToConn</span><span class="op" id="7568295">(</span><span class="ident" id="7568296">t</span><span class="op" id="7568297">,</span>&nbsp;<span class="ident" id="7568299">l</span><span class="op" id="7568300">.</span><span class="ident" id="7568301">LocalAddr</span><span class="op" id="7568310">(</span><span class="op" id="7568311">)</span><span class="op" id="7568312">.</span><span class="ident" id="7568313">String</span><span class="op" id="7568319">(</span><span class="op" id="7568320">)</span><span class="op" id="7568321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568324">testWriteToPacketConn</span><span class="op" id="7568345">(</span><span class="ident" id="7568346">t</span><span class="op" id="7568347">,</span>&nbsp;<span class="ident" id="7568349">l</span><span class="op" id="7568350">.</span><span class="ident" id="7568351">LocalAddr</span><span class="op" id="7568360">(</span><span class="op" id="7568361">)</span><span class="op" id="7568362">.</span><span class="ident" id="7568363">String</span><span class="op" id="7568369">(</span><span class="op" id="7568370">)</span><span class="op" id="7568371">)</span><br>
<span class="lineno"></span><span class="op" id="7568373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7568376">func</span>&nbsp;<span class="ident" id="7568381">testWriteToConn</span><span class="op" id="7568396">(</span><span class="ident" id="7568397">t</span>&nbsp;<span class="op" id="7568399">*</span><span class="ident" id="7568400">testing</span><span class="op" id="7568407">.</span><span class="ident" id="7568408">T</span><span class="op" id="7568409">,</span>&nbsp;<span class="ident" id="7568411">raddr</span>&nbsp;<span class="builtintype" id="7568417">string</span><span class="op" id="7568423">)</span>&nbsp;<span class="op" id="7568425">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568428">c</span><span class="op" id="7568429">,</span>&nbsp;<span class="ident" id="7568431">err</span>&nbsp;<span class="op" id="7568435">:=</span>&nbsp;<span class="ident" id="7568438">Dial</span><span class="op" id="7568442">(</span><span class="string" id="7568443">&#34;udp&#34;</span><span class="op" id="7568448">,</span>&nbsp;<span class="ident" id="7568450">raddr</span><span class="op" id="7568455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568458">if</span>&nbsp;<span class="ident" id="7568461">err</span>&nbsp;<span class="op" id="7568465">!=</span>&nbsp;<span class="ident" id="7568468">nil</span>&nbsp;<span class="op" id="7568472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568476">t</span><span class="op" id="7568477">.</span><span class="ident" id="7568478">Fatalf</span><span class="op" id="7568484">(</span><span class="string" id="7568485">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7568502">,</span>&nbsp;<span class="ident" id="7568504">err</span><span class="op" id="7568507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568513">defer</span>&nbsp;<span class="ident" id="7568519">c</span><span class="op" id="7568520">.</span><span class="ident" id="7568521">Close</span><span class="op" id="7568526">(</span><span class="op" id="7568527">)</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568531">ra</span><span class="op" id="7568533">,</span>&nbsp;<span class="ident" id="7568535">err</span>&nbsp;<span class="op" id="7568539">:=</span>&nbsp;<span class="ident" id="7568542">ResolveUDPAddr</span><span class="op" id="7568556">(</span><span class="string" id="7568557">&#34;udp&#34;</span><span class="op" id="7568562">,</span>&nbsp;<span class="ident" id="7568564">raddr</span><span class="op" id="7568569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568572">if</span>&nbsp;<span class="ident" id="7568575">err</span>&nbsp;<span class="op" id="7568579">!=</span>&nbsp;<span class="ident" id="7568582">nil</span>&nbsp;<span class="op" id="7568586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568590">t</span><span class="op" id="7568591">.</span><span class="ident" id="7568592">Fatalf</span><span class="op" id="7568598">(</span><span class="string" id="7568599">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7568626">,</span>&nbsp;<span class="ident" id="7568628">err</span><span class="op" id="7568631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568634">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568638">_</span><span class="op" id="7568639">,</span>&nbsp;<span class="ident" id="7568641">err</span>&nbsp;<span class="op" id="7568645">=</span>&nbsp;<span class="ident" id="7568647">c</span><span class="op" id="7568648">.</span><span class="op" id="7568649">(</span><span class="op" id="7568650">*</span><span class="ident" id="7568651">UDPConn</span><span class="op" id="7568658">)</span><span class="op" id="7568659">.</span><span class="ident" id="7568660">WriteToUDP</span><span class="op" id="7568670">(</span><span class="op" id="7568671">[</span><span class="op" id="7568672">]</span><span class="builtintype" id="7568673">byte</span><span class="op" id="7568677">(</span><span class="string" id="7568678">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7568711">)</span><span class="op" id="7568712">,</span>&nbsp;<span class="ident" id="7568714">ra</span><span class="op" id="7568716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568719">if</span>&nbsp;<span class="ident" id="7568722">err</span>&nbsp;<span class="op" id="7568726">==</span>&nbsp;<span class="ident" id="7568729">nil</span>&nbsp;<span class="op" id="7568733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568737">t</span><span class="op" id="7568738">.</span><span class="ident" id="7568739">Fatal</span><span class="op" id="7568744">(</span><span class="string" id="7568745">&#34;WriteToUDP&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7568769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568772">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568775">if</span>&nbsp;<span class="ident" id="7568778">err</span>&nbsp;<span class="op" id="7568782">!=</span>&nbsp;<span class="ident" id="7568785">nil</span>&nbsp;<span class="op" id="7568789">&amp;&amp;</span>&nbsp;<span class="ident" id="7568792">err</span><span class="op" id="7568795">.</span><span class="op" id="7568796">(</span><span class="op" id="7568797">*</span><span class="ident" id="7568798">OpError</span><span class="op" id="7568805">)</span><span class="op" id="7568806">.</span><span class="ident" id="7568807">Err</span>&nbsp;<span class="op" id="7568811">!=</span>&nbsp;<span class="ident" id="7568814">ErrWriteToConnected</span>&nbsp;<span class="op" id="7568834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568838">t</span><span class="op" id="7568839">.</span><span class="ident" id="7568840">Fatalf</span><span class="op" id="7568846">(</span><span class="string" id="7568847">&#34;WriteToUDP&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7568898">,</span>&nbsp;<span class="ident" id="7568900">err</span><span class="op" id="7568903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568910">_</span><span class="op" id="7568911">,</span>&nbsp;<span class="ident" id="7568913">err</span>&nbsp;<span class="op" id="7568917">=</span>&nbsp;<span class="ident" id="7568919">c</span><span class="op" id="7568920">.</span><span class="op" id="7568921">(</span><span class="op" id="7568922">*</span><span class="ident" id="7568923">UDPConn</span><span class="op" id="7568930">)</span><span class="op" id="7568931">.</span><span class="ident" id="7568932">WriteTo</span><span class="op" id="7568939">(</span><span class="op" id="7568940">[</span><span class="op" id="7568941">]</span><span class="builtintype" id="7568942">byte</span><span class="op" id="7568946">(</span><span class="string" id="7568947">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7568980">)</span><span class="op" id="7568981">,</span>&nbsp;<span class="ident" id="7568983">ra</span><span class="op" id="7568985">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568988">if</span>&nbsp;<span class="ident" id="7568991">err</span>&nbsp;<span class="op" id="7568995">==</span>&nbsp;<span class="ident" id="7568998">nil</span>&nbsp;<span class="op" id="7569002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569006">t</span><span class="op" id="7569007">.</span><span class="ident" id="7569008">Fatal</span><span class="op" id="7569013">(</span><span class="string" id="7569014">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7569035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7569038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7569041">if</span>&nbsp;<span class="ident" id="7569044">err</span>&nbsp;<span class="op" id="7569048">!=</span>&nbsp;<span class="ident" id="7569051">nil</span>&nbsp;<span class="op" id="7569055">&amp;&amp;</span>&nbsp;<span class="ident" id="7569058">err</span><span class="op" id="7569061">.</span><span class="op" id="7569062">(</span><span class="op" id="7569063">*</span><span class="ident" id="7569064">OpError</span><span class="op" id="7569071">)</span><span class="op" id="7569072">.</span><span class="ident" id="7569073">Err</span>&nbsp;<span class="op" id="7569077">!=</span>&nbsp;<span class="ident" id="7569080">ErrWriteToConnected</span>&nbsp;<span class="op" id="7569100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569104">t</span><span class="op" id="7569105">.</span><span class="ident" id="7569106">Fatalf</span><span class="op" id="7569112">(</span><span class="string" id="7569113">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7569161">,</span>&nbsp;<span class="ident" id="7569163">err</span><span class="op" id="7569166">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7569169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569173">_</span><span class="op" id="7569174">,</span>&nbsp;<span class="ident" id="7569176">err</span>&nbsp;<span class="op" id="7569180">=</span>&nbsp;<span class="ident" id="7569182">c</span><span class="op" id="7569183">.</span><span class="ident" id="7569184">Write</span><span class="op" id="7569189">(</span><span class="op" id="7569190">[</span><span class="op" id="7569191">]</span><span class="builtintype" id="7569192">byte</span><span class="op" id="7569196">(</span><span class="string" id="7569197">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7569230">)</span><span class="op" id="7569231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7569234">if</span>&nbsp;<span class="ident" id="7569237">err</span>&nbsp;<span class="op" id="7569241">!=</span>&nbsp;<span class="ident" id="7569244">nil</span>&nbsp;<span class="op" id="7569248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569252">t</span><span class="op" id="7569253">.</span><span class="ident" id="7569254">Fatalf</span><span class="op" id="7569260">(</span><span class="string" id="7569261">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7569279">,</span>&nbsp;<span class="ident" id="7569281">err</span><span class="op" id="7569284">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7569287">}</span><br>
<span class="lineno"></span><span class="op" id="7569289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7569292">func</span>&nbsp;<span class="ident" id="7569297">testWriteToPacketConn</span><span class="op" id="7569318">(</span><span class="ident" id="7569319">t</span>&nbsp;<span class="op" id="7569321">*</span><span class="ident" id="7569322">testing</span><span class="op" id="7569329">.</span><span class="ident" id="7569330">T</span><span class="op" id="7569331">,</span>&nbsp;<span class="ident" id="7569333">raddr</span>&nbsp;<span class="builtintype" id="7569339">string</span><span class="op" id="7569345">)</span>&nbsp;<span class="op" id="7569347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569350">c</span><span class="op" id="7569351">,</span>&nbsp;<span class="ident" id="7569353">err</span>&nbsp;<span class="op" id="7569357">:=</span>&nbsp;<span class="ident" id="7569360">ListenPacket</span><span class="op" id="7569372">(</span><span class="string" id="7569373">&#34;udp&#34;</span><span class="op" id="7569378">,</span>&nbsp;<span class="string" id="7569380">&#34;127.0.0.1:0&#34;</span><span class="op" id="7569393">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7569396">if</span>&nbsp;<span class="ident" id="7569399">err</span>&nbsp;<span class="op" id="7569403">!=</span>&nbsp;<span class="ident" id="7569406">nil</span>&nbsp;<span class="op" id="7569410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569414">t</span><span class="op" id="7569415">.</span><span class="ident" id="7569416">Fatalf</span><span class="op" id="7569422">(</span><span class="string" id="7569423">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7569448">,</span>&nbsp;<span class="ident" id="7569450">err</span><span class="op" id="7569453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7569456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7569459">defer</span>&nbsp;<span class="ident" id="7569465">c</span><span class="op" id="7569466">.</span><span class="ident" id="7569467">Close</span><span class="op" id="7569472">(</span><span class="op" id="7569473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569477">ra</span><span class="op" id="7569479">,</span>&nbsp;<span class="ident" id="7569481">err</span>&nbsp;<span class="op" id="7569485">:=</span>&nbsp;<span class="ident" id="7569488">ResolveUDPAddr</span><span class="op" id="7569502">(</span><span class="string" id="7569503">&#34;udp&#34;</span><span class="op" id="7569508">,</span>&nbsp;<span class="ident" id="7569510">raddr</span><span class="op" id="7569515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7569518">if</span>&nbsp;<span class="ident" id="7569521">err</span>&nbsp;<span class="op" id="7569525">!=</span>&nbsp;<span class="ident" id="7569528">nil</span>&nbsp;<span class="op" id="7569532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569536">t</span><span class="op" id="7569537">.</span><span class="ident" id="7569538">Fatalf</span><span class="op" id="7569544">(</span><span class="string" id="7569545">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7569572">,</span>&nbsp;<span class="ident" id="7569574">err</span><span class="op" id="7569577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7569580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569584">_</span><span class="op" id="7569585">,</span>&nbsp;<span class="ident" id="7569587">err</span>&nbsp;<span class="op" id="7569591">=</span>&nbsp;<span class="ident" id="7569593">c</span><span class="op" id="7569594">.</span><span class="op" id="7569595">(</span><span class="op" id="7569596">*</span><span class="ident" id="7569597">UDPConn</span><span class="op" id="7569604">)</span><span class="op" id="7569605">.</span><span class="ident" id="7569606">WriteToUDP</span><span class="op" id="7569616">(</span><span class="op" id="7569617">[</span><span class="op" id="7569618">]</span><span class="builtintype" id="7569619">byte</span><span class="op" id="7569623">(</span><span class="string" id="7569624">&#34;Connection-less&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7569653">)</span><span class="op" id="7569654">,</span>&nbsp;<span class="ident" id="7569656">ra</span><span class="op" id="7569658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7569661">if</span>&nbsp;<span class="ident" id="7569664">err</span>&nbsp;<span class="op" id="7569668">!=</span>&nbsp;<span class="ident" id="7569671">nil</span>&nbsp;<span class="op" id="7569675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569679">t</span><span class="op" id="7569680">.</span><span class="ident" id="7569681">Fatalf</span><span class="op" id="7569687">(</span><span class="string" id="7569688">&#34;WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7569711">,</span>&nbsp;<span class="ident" id="7569713">err</span><span class="op" id="7569716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7569719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569723">_</span><span class="op" id="7569724">,</span>&nbsp;<span class="ident" id="7569726">err</span>&nbsp;<span class="op" id="7569730">=</span>&nbsp;<span class="ident" id="7569732">c</span><span class="op" id="7569733">.</span><span class="ident" id="7569734">WriteTo</span><span class="op" id="7569741">(</span><span class="op" id="7569742">[</span><span class="op" id="7569743">]</span><span class="builtintype" id="7569744">byte</span><span class="op" id="7569748">(</span><span class="string" id="7569749">&#34;Connection-less&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7569778">)</span><span class="op" id="7569779">,</span>&nbsp;<span class="ident" id="7569781">ra</span><span class="op" id="7569783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7569786">if</span>&nbsp;<span class="ident" id="7569789">err</span>&nbsp;<span class="op" id="7569793">!=</span>&nbsp;<span class="ident" id="7569796">nil</span>&nbsp;<span class="op" id="7569800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569804">t</span><span class="op" id="7569805">.</span><span class="ident" id="7569806">Fatalf</span><span class="op" id="7569812">(</span><span class="string" id="7569813">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7569833">,</span>&nbsp;<span class="ident" id="7569835">err</span><span class="op" id="7569838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7569841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569845">_</span><span class="op" id="7569846">,</span>&nbsp;<span class="ident" id="7569848">err</span>&nbsp;<span class="op" id="7569852">=</span>&nbsp;<span class="ident" id="7569854">c</span><span class="op" id="7569855">.</span><span class="op" id="7569856">(</span><span class="op" id="7569857">*</span><span class="ident" id="7569858">UDPConn</span><span class="op" id="7569865">)</span><span class="op" id="7569866">.</span><span class="ident" id="7569867">Write</span><span class="op" id="7569872">(</span><span class="op" id="7569873">[</span><span class="op" id="7569874">]</span><span class="builtintype" id="7569875">byte</span><span class="op" id="7569879">(</span><span class="string" id="7569880">&#34;Connection-less&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7569909">)</span><span class="op" id="7569910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7569913">if</span>&nbsp;<span class="ident" id="7569916">err</span>&nbsp;<span class="op" id="7569920">==</span>&nbsp;<span class="ident" id="7569923">nil</span>&nbsp;<span class="op" id="7569927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569931">t</span><span class="op" id="7569932">.</span><span class="ident" id="7569933">Fatal</span><span class="op" id="7569938">(</span><span class="string" id="7569939">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7569958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7569961">}</span><br>
<span class="lineno"></span><span class="op" id="7569963">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7569966">var</span>&nbsp;<span class="ident" id="7569970">udpConnLocalNameTests</span>&nbsp;<span class="op" id="7569992">=</span>&nbsp;<span class="op" id="7569994">[</span><span class="op" id="7569995">]</span><span class="keyword" id="7569996">struct</span>&nbsp;<span class="op" id="7570003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7570006">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7570012">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7570020">laddr</span>&nbsp;<span class="op" id="7570026">*</span><span class="ident" id="7570027">UDPAddr</span><br>
<span class="lineno"></span><span class="op" id="7570035">}</span><span class="op" id="7570036">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7570039">{</span><span class="string" id="7570040">&#34;udp4&#34;</span><span class="op" id="7570046">,</span>&nbsp;<span class="op" id="7570048">&amp;</span><span class="ident" id="7570049">UDPAddr</span><span class="op" id="7570056">{</span><span class="ident" id="7570057">IP</span><span class="op" id="7570059">:</span>&nbsp;<span class="ident" id="7570061">IPv4</span><span class="op" id="7570065">(</span><span class="num" id="7570066">127</span><span class="op" id="7570069">,</span>&nbsp;<span class="num" id="7570071">0</span><span class="op" id="7570072">,</span>&nbsp;<span class="num" id="7570074">0</span><span class="op" id="7570075">,</span>&nbsp;<span class="num" id="7570077">1</span><span class="op" id="7570078">)</span><span class="op" id="7570079">}</span><span class="op" id="7570080">}</span><span class="op" id="7570081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7570084">{</span><span class="string" id="7570085">&#34;udp4&#34;</span><span class="op" id="7570091">,</span>&nbsp;<span class="op" id="7570093">&amp;</span><span class="ident" id="7570094">UDPAddr</span><span class="op" id="7570101">{</span><span class="op" id="7570102">}</span><span class="op" id="7570103">}</span><span class="op" id="7570104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7570107">{</span><span class="string" id="7570108">&#34;udp4&#34;</span><span class="op" id="7570114">,</span>&nbsp;<span class="ident" id="7570116">nil</span><span class="op" id="7570119">}</span><span class="op" id="7570120">,</span><br>
<span class="lineno"></span><span class="op" id="7570122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="7570125">func</span>&nbsp;<span class="ident" id="7570130">TestUDPConnLocalName</span><span class="op" id="7570150">(</span><span class="ident" id="7570151">t</span>&nbsp;<span class="op" id="7570153">*</span><span class="ident" id="7570154">testing</span><span class="op" id="7570161">.</span><span class="ident" id="7570162">T</span><span class="op" id="7570163">)</span>&nbsp;<span class="op" id="7570165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570168">if</span>&nbsp;<span class="ident" id="7570171">testing</span><span class="op" id="7570178">.</span><span class="ident" id="7570179">Short</span><span class="op" id="7570184">(</span><span class="op" id="7570185">)</span>&nbsp;<span class="op" id="7570187">||</span>&nbsp;<span class="op" id="7570190">!</span><span class="op" id="7570191">*</span><span class="ident" id="7570192">testExternal</span>&nbsp;<span class="op" id="7570205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7570209">t</span><span class="op" id="7570210">.</span><span class="ident" id="7570211">Skip</span><span class="op" id="7570215">(</span><span class="string" id="7570216">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7570257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7570260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570264">for</span>&nbsp;<span class="ident" id="7570268">_</span><span class="op" id="7570269">,</span>&nbsp;<span class="ident" id="7570271">tt</span>&nbsp;<span class="op" id="7570274">:=</span>&nbsp;<span class="keyword" id="7570277">range</span>&nbsp;<span class="ident" id="7570283">udpConnLocalNameTests</span>&nbsp;<span class="op" id="7570305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7570309">c</span><span class="op" id="7570310">,</span>&nbsp;<span class="ident" id="7570312">err</span>&nbsp;<span class="op" id="7570316">:=</span>&nbsp;<span class="ident" id="7570319">ListenUDP</span><span class="op" id="7570328">(</span><span class="ident" id="7570329">tt</span><span class="op" id="7570331">.</span><span class="ident" id="7570332">net</span><span class="op" id="7570335">,</span>&nbsp;<span class="ident" id="7570337">tt</span><span class="op" id="7570339">.</span><span class="ident" id="7570340">laddr</span><span class="op" id="7570345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570349">if</span>&nbsp;<span class="ident" id="7570352">err</span>&nbsp;<span class="op" id="7570356">!=</span>&nbsp;<span class="ident" id="7570359">nil</span>&nbsp;<span class="op" id="7570363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7570368">t</span><span class="op" id="7570369">.</span><span class="ident" id="7570370">Fatalf</span><span class="op" id="7570376">(</span><span class="string" id="7570377">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7570399">,</span>&nbsp;<span class="ident" id="7570401">err</span><span class="op" id="7570404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7570408">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570412">defer</span>&nbsp;<span class="ident" id="7570418">c</span><span class="op" id="7570419">.</span><span class="ident" id="7570420">Close</span><span class="op" id="7570425">(</span><span class="op" id="7570426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7570430">la</span>&nbsp;<span class="op" id="7570433">:=</span>&nbsp;<span class="ident" id="7570436">c</span><span class="op" id="7570437">.</span><span class="ident" id="7570438">LocalAddr</span><span class="op" id="7570447">(</span><span class="op" id="7570448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570452">if</span>&nbsp;<span class="ident" id="7570455">a</span><span class="op" id="7570456">,</span>&nbsp;<span class="ident" id="7570458">ok</span>&nbsp;<span class="op" id="7570461">:=</span>&nbsp;<span class="ident" id="7570464">la</span><span class="op" id="7570466">.</span><span class="op" id="7570467">(</span><span class="op" id="7570468">*</span><span class="ident" id="7570469">UDPAddr</span><span class="op" id="7570476">)</span><span class="op" id="7570477">;</span>&nbsp;<span class="op" id="7570479">!</span><span class="ident" id="7570480">ok</span>&nbsp;<span class="op" id="7570483">||</span>&nbsp;<span class="ident" id="7570486">a</span><span class="op" id="7570487">.</span><span class="ident" id="7570488">Port</span>&nbsp;<span class="op" id="7570493">==</span>&nbsp;<span class="num" id="7570496">0</span>&nbsp;<span class="op" id="7570498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7570503">t</span><span class="op" id="7570504">.</span><span class="ident" id="7570505">Fatalf</span><span class="op" id="7570511">(</span><span class="string" id="7570512">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;non-zero&nbsp;port&nbsp;number&#34;</span><span class="op" id="7570573">,</span>&nbsp;<span class="ident" id="7570575">la</span><span class="op" id="7570577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7570581">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7570584">}</span><br>
<span class="lineno"></span><span class="op" id="7570586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7570589">func</span>&nbsp;<span class="ident" id="7570594">TestUDPConnLocalAndRemoteNames</span><span class="op" id="7570624">(</span><span class="ident" id="7570625">t</span>&nbsp;<span class="op" id="7570627">*</span><span class="ident" id="7570628">testing</span><span class="op" id="7570635">.</span><span class="ident" id="7570636">T</span><span class="op" id="7570637">)</span>&nbsp;<span class="op" id="7570639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570642">for</span>&nbsp;<span class="ident" id="7570646">_</span><span class="op" id="7570647">,</span>&nbsp;<span class="ident" id="7570649">laddr</span>&nbsp;<span class="op" id="7570655">:=</span>&nbsp;<span class="keyword" id="7570658">range</span>&nbsp;<span class="op" id="7570664">[</span><span class="op" id="7570665">]</span><span class="builtintype" id="7570666">string</span><span class="op" id="7570672">{</span><span class="string" id="7570673">&#34;&#34;</span><span class="op" id="7570675">,</span>&nbsp;<span class="string" id="7570677">&#34;127.0.0.1:0&#34;</span><span class="op" id="7570690">}</span>&nbsp;<span class="op" id="7570692">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7570696">c1</span><span class="op" id="7570698">,</span>&nbsp;<span class="ident" id="7570700">err</span>&nbsp;<span class="op" id="7570704">:=</span>&nbsp;<span class="ident" id="7570707">ListenPacket</span><span class="op" id="7570719">(</span><span class="string" id="7570720">&#34;udp&#34;</span><span class="op" id="7570725">,</span>&nbsp;<span class="string" id="7570727">&#34;127.0.0.1:0&#34;</span><span class="op" id="7570740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570744">if</span>&nbsp;<span class="ident" id="7570747">err</span>&nbsp;<span class="op" id="7570751">!=</span>&nbsp;<span class="ident" id="7570754">nil</span>&nbsp;<span class="op" id="7570758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7570763">t</span><span class="op" id="7570764">.</span><span class="ident" id="7570765">Fatalf</span><span class="op" id="7570771">(</span><span class="string" id="7570772">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7570794">,</span>&nbsp;<span class="ident" id="7570796">err</span><span class="op" id="7570799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7570803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570807">defer</span>&nbsp;<span class="ident" id="7570813">c1</span><span class="op" id="7570815">.</span><span class="ident" id="7570816">Close</span><span class="op" id="7570821">(</span><span class="op" id="7570822">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570827">var</span>&nbsp;<span class="ident" id="7570831">la</span>&nbsp;<span class="op" id="7570834">*</span><span class="ident" id="7570835">UDPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570845">if</span>&nbsp;<span class="ident" id="7570848">laddr</span>&nbsp;<span class="op" id="7570854">!=</span>&nbsp;<span class="string" id="7570857">&#34;&#34;</span>&nbsp;<span class="op" id="7570860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570865">var</span>&nbsp;<span class="ident" id="7570869">err</span>&nbsp;<span class="builtintype" id="7570873">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7570882">if</span>&nbsp;<span class="ident" id="7570885">la</span><span class="op" id="7570887">,</span>&nbsp;<span class="ident" id="7570889">err</span>&nbsp;<span class="op" id="7570893">=</span>&nbsp;<span class="ident" id="7570895">ResolveUDPAddr</span><span class="op" id="7570909">(</span><span class="string" id="7570910">&#34;udp&#34;</span><span class="op" id="7570915">,</span>&nbsp;<span class="ident" id="7570917">laddr</span><span class="op" id="7570922">)</span><span class="op" id="7570923">;</span>&nbsp;<span class="ident" id="7570925">err</span>&nbsp;<span class="op" id="7570929">!=</span>&nbsp;<span class="ident" id="7570932">nil</span>&nbsp;<span class="op" id="7570936">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7570942">t</span><span class="op" id="7570943">.</span><span class="ident" id="7570944">Fatalf</span><span class="op" id="7570950">(</span><span class="string" id="7570951">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7570978">,</span>&nbsp;<span class="ident" id="7570980">err</span><span class="op" id="7570983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7570988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7570992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7570996">c2</span><span class="op" id="7570998">,</span>&nbsp;<span class="ident" id="7571000">err</span>&nbsp;<span class="op" id="7571004">:=</span>&nbsp;<span class="ident" id="7571007">DialUDP</span><span class="op" id="7571014">(</span><span class="string" id="7571015">&#34;udp&#34;</span><span class="op" id="7571020">,</span>&nbsp;<span class="ident" id="7571022">la</span><span class="op" id="7571024">,</span>&nbsp;<span class="ident" id="7571026">c1</span><span class="op" id="7571028">.</span><span class="ident" id="7571029">LocalAddr</span><span class="op" id="7571038">(</span><span class="op" id="7571039">)</span><span class="op" id="7571040">.</span><span class="op" id="7571041">(</span><span class="op" id="7571042">*</span><span class="ident" id="7571043">UDPAddr</span><span class="op" id="7571050">)</span><span class="op" id="7571051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7571055">if</span>&nbsp;<span class="ident" id="7571058">err</span>&nbsp;<span class="op" id="7571062">!=</span>&nbsp;<span class="ident" id="7571065">nil</span>&nbsp;<span class="op" id="7571069">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571074">t</span><span class="op" id="7571075">.</span><span class="ident" id="7571076">Fatalf</span><span class="op" id="7571082">(</span><span class="string" id="7571083">&#34;DialUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7571103">,</span>&nbsp;<span class="ident" id="7571105">err</span><span class="op" id="7571108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7571116">defer</span>&nbsp;<span class="ident" id="7571122">c2</span><span class="op" id="7571124">.</span><span class="ident" id="7571125">Close</span><span class="op" id="7571130">(</span><span class="op" id="7571131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7571136">var</span>&nbsp;<span class="ident" id="7571140">connAddrs</span>&nbsp;<span class="op" id="7571150">=</span>&nbsp;<span class="op" id="7571152">[</span><span class="num" id="7571153">4</span><span class="op" id="7571154">]</span><span class="keyword" id="7571155">struct</span>&nbsp;<span class="op" id="7571162">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571167">got</span>&nbsp;<span class="ident" id="7571171">Addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571179">ok</span>&nbsp;&nbsp;<span class="builtintype" id="7571183">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571190">}</span><span class="op" id="7571191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571196">{</span><span class="ident" id="7571197">c1</span><span class="op" id="7571199">.</span><span class="ident" id="7571200">LocalAddr</span><span class="op" id="7571209">(</span><span class="op" id="7571210">)</span><span class="op" id="7571211">,</span>&nbsp;<span class="ident" id="7571213">true</span><span class="op" id="7571217">}</span><span class="op" id="7571218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571223">{</span><span class="ident" id="7571224">c1</span><span class="op" id="7571226">.</span><span class="op" id="7571227">(</span><span class="op" id="7571228">*</span><span class="ident" id="7571229">UDPConn</span><span class="op" id="7571236">)</span><span class="op" id="7571237">.</span><span class="ident" id="7571238">RemoteAddr</span><span class="op" id="7571248">(</span><span class="op" id="7571249">)</span><span class="op" id="7571250">,</span>&nbsp;<span class="ident" id="7571252">false</span><span class="op" id="7571257">}</span><span class="op" id="7571258">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571263">{</span><span class="ident" id="7571264">c2</span><span class="op" id="7571266">.</span><span class="ident" id="7571267">LocalAddr</span><span class="op" id="7571276">(</span><span class="op" id="7571277">)</span><span class="op" id="7571278">,</span>&nbsp;<span class="ident" id="7571280">true</span><span class="op" id="7571284">}</span><span class="op" id="7571285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571290">{</span><span class="ident" id="7571291">c2</span><span class="op" id="7571293">.</span><span class="ident" id="7571294">RemoteAddr</span><span class="op" id="7571304">(</span><span class="op" id="7571305">)</span><span class="op" id="7571306">,</span>&nbsp;<span class="ident" id="7571308">true</span><span class="op" id="7571312">}</span><span class="op" id="7571313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7571321">for</span>&nbsp;<span class="ident" id="7571325">_</span><span class="op" id="7571326">,</span>&nbsp;<span class="ident" id="7571328">ca</span>&nbsp;<span class="op" id="7571331">:=</span>&nbsp;<span class="keyword" id="7571334">range</span>&nbsp;<span class="ident" id="7571340">connAddrs</span>&nbsp;<span class="op" id="7571350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7571355">if</span>&nbsp;<span class="ident" id="7571358">a</span><span class="op" id="7571359">,</span>&nbsp;<span class="ident" id="7571361">ok</span>&nbsp;<span class="op" id="7571364">:=</span>&nbsp;<span class="ident" id="7571367">ca</span><span class="op" id="7571369">.</span><span class="ident" id="7571370">got</span><span class="op" id="7571373">.</span><span class="op" id="7571374">(</span><span class="op" id="7571375">*</span><span class="ident" id="7571376">UDPAddr</span><span class="op" id="7571383">)</span><span class="op" id="7571384">;</span>&nbsp;<span class="ident" id="7571386">ok</span>&nbsp;<span class="op" id="7571389">!=</span>&nbsp;<span class="ident" id="7571392">ca</span><span class="op" id="7571394">.</span><span class="ident" id="7571395">ok</span>&nbsp;<span class="op" id="7571398">||</span>&nbsp;<span class="ident" id="7571401">ok</span>&nbsp;<span class="op" id="7571404">&amp;&amp;</span>&nbsp;<span class="ident" id="7571407">a</span><span class="op" id="7571408">.</span><span class="ident" id="7571409">Port</span>&nbsp;<span class="op" id="7571414">==</span>&nbsp;<span class="num" id="7571417">0</span>&nbsp;<span class="op" id="7571419">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571425">t</span><span class="op" id="7571426">.</span><span class="ident" id="7571427">Fatalf</span><span class="op" id="7571433">(</span><span class="string" id="7571434">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;non-zero&nbsp;port&nbsp;number&#34;</span><span class="op" id="7571495">,</span>&nbsp;<span class="ident" id="7571497">ca</span><span class="op" id="7571499">.</span><span class="ident" id="7571500">got</span><span class="op" id="7571503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571515">}</span><br>
<span class="lineno"></span><span class="op" id="7571517">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="7571520">func</span>&nbsp;<span class="ident" id="7571525">TestIPv6LinkLocalUnicastUDP</span><span class="op" id="7571552">(</span><span class="ident" id="7571553">t</span>&nbsp;<span class="op" id="7571555">*</span><span class="ident" id="7571556">testing</span><span class="op" id="7571563">.</span><span class="ident" id="7571564">T</span><span class="op" id="7571565">)</span>&nbsp;<span class="op" id="7571567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7571570">if</span>&nbsp;<span class="ident" id="7571573">testing</span><span class="op" id="7571580">.</span><span class="ident" id="7571581">Short</span><span class="op" id="7571586">(</span><span class="op" id="7571587">)</span>&nbsp;<span class="op" id="7571589">||</span>&nbsp;<span class="op" id="7571592">!</span><span class="op" id="7571593">*</span><span class="ident" id="7571594">testExternal</span>&nbsp;<span class="op" id="7571607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571611">t</span><span class="op" id="7571612">.</span><span class="ident" id="7571613">Skip</span><span class="op" id="7571617">(</span><span class="string" id="7571618">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7571659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571662">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7571665">if</span>&nbsp;<span class="op" id="7571668">!</span><span class="ident" id="7571669">supportsIPv6</span>&nbsp;<span class="op" id="7571682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571686">t</span><span class="op" id="7571687">.</span><span class="ident" id="7571688">Skip</span><span class="op" id="7571692">(</span><span class="string" id="7571693">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7571716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571722">ifi</span>&nbsp;<span class="op" id="7571726">:=</span>&nbsp;<span class="ident" id="7571729">loopbackInterface</span><span class="op" id="7571746">(</span><span class="op" id="7571747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7571750">if</span>&nbsp;<span class="ident" id="7571753">ifi</span>&nbsp;<span class="op" id="7571757">==</span>&nbsp;<span class="ident" id="7571760">nil</span>&nbsp;<span class="op" id="7571764">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571768">t</span><span class="op" id="7571769">.</span><span class="ident" id="7571770">Skip</span><span class="op" id="7571774">(</span><span class="string" id="7571775">&#34;loopback&nbsp;interface&nbsp;not&nbsp;found&#34;</span><span class="op" id="7571805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571811">laddr</span>&nbsp;<span class="op" id="7571817">:=</span>&nbsp;<span class="ident" id="7571820">ipv6LinkLocalUnicastAddr</span><span class="op" id="7571844">(</span><span class="ident" id="7571845">ifi</span><span class="op" id="7571848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7571851">if</span>&nbsp;<span class="ident" id="7571854">laddr</span>&nbsp;<span class="op" id="7571860">==</span>&nbsp;<span class="string" id="7571863">&#34;&#34;</span>&nbsp;<span class="op" id="7571866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571870">t</span><span class="op" id="7571871">.</span><span class="ident" id="7571872">Skip</span><span class="op" id="7571876">(</span><span class="string" id="7571877">&#34;ipv6&nbsp;unicast&nbsp;address&nbsp;on&nbsp;loopback&nbsp;not&nbsp;found&#34;</span><span class="op" id="7571921">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7571928">type</span>&nbsp;<span class="ident" id="7571933">test</span>&nbsp;<span class="keyword" id="7571938">struct</span>&nbsp;<span class="op" id="7571945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571949">net</span><span class="op" id="7571952">,</span>&nbsp;<span class="ident" id="7571954">addr</span>&nbsp;&nbsp;<span class="builtintype" id="7571960">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7571969">nameLookup</span>&nbsp;<span class="builtintype" id="7571980">bool</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7571986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7571989">var</span>&nbsp;<span class="ident" id="7571993">tests</span>&nbsp;<span class="op" id="7571999">=</span>&nbsp;<span class="op" id="7572001">[</span><span class="op" id="7572002">]</span><span class="ident" id="7572003">test</span><span class="op" id="7572007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572011">{</span><span class="string" id="7572012">&#34;udp&#34;</span><span class="op" id="7572017">,</span>&nbsp;<span class="string" id="7572019">&#34;[&#34;</span>&nbsp;<span class="op" id="7572023">+</span>&nbsp;<span class="ident" id="7572025">laddr</span>&nbsp;<span class="op" id="7572031">+</span>&nbsp;<span class="string" id="7572033">&#34;%&#34;</span>&nbsp;<span class="op" id="7572037">+</span>&nbsp;<span class="ident" id="7572039">ifi</span><span class="op" id="7572042">.</span><span class="ident" id="7572043">Name</span>&nbsp;<span class="op" id="7572048">+</span>&nbsp;<span class="string" id="7572050">&#34;]:0&#34;</span><span class="op" id="7572055">,</span>&nbsp;<span class="ident" id="7572057">false</span><span class="op" id="7572062">}</span><span class="op" id="7572063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572067">{</span><span class="string" id="7572068">&#34;udp6&#34;</span><span class="op" id="7572074">,</span>&nbsp;<span class="string" id="7572076">&#34;[&#34;</span>&nbsp;<span class="op" id="7572080">+</span>&nbsp;<span class="ident" id="7572082">laddr</span>&nbsp;<span class="op" id="7572088">+</span>&nbsp;<span class="string" id="7572090">&#34;%&#34;</span>&nbsp;<span class="op" id="7572094">+</span>&nbsp;<span class="ident" id="7572096">ifi</span><span class="op" id="7572099">.</span><span class="ident" id="7572100">Name</span>&nbsp;<span class="op" id="7572105">+</span>&nbsp;<span class="string" id="7572107">&#34;]:0&#34;</span><span class="op" id="7572112">,</span>&nbsp;<span class="ident" id="7572114">false</span><span class="op" id="7572119">}</span><span class="op" id="7572120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572123">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7572126">//&nbsp;The&nbsp;first&nbsp;udp&nbsp;test&nbsp;fails&nbsp;on&nbsp;DragonFly&nbsp;-&nbsp;see&nbsp;issue&nbsp;7473.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7572186">if</span>&nbsp;<span class="ident" id="7572189">runtime</span><span class="op" id="7572196">.</span><span class="ident" id="7572197">GOOS</span>&nbsp;<span class="op" id="7572202">==</span>&nbsp;<span class="string" id="7572205">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="7572217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7572221">tests</span>&nbsp;<span class="op" id="7572227">=</span>&nbsp;<span class="ident" id="7572229">tests</span><span class="op" id="7572234">[</span><span class="num" id="7572235">1</span><span class="op" id="7572236">:</span><span class="op" id="7572237">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7572243">switch</span>&nbsp;<span class="ident" id="7572250">runtime</span><span class="op" id="7572257">.</span><span class="ident" id="7572258">GOOS</span>&nbsp;<span class="op" id="7572263">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7572266">case</span>&nbsp;<span class="string" id="7572271">&#34;darwin&#34;</span><span class="op" id="7572279">,</span>&nbsp;<span class="string" id="7572281">&#34;dragonfly&#34;</span><span class="op" id="7572292">,</span>&nbsp;<span class="string" id="7572294">&#34;freebsd&#34;</span><span class="op" id="7572303">,</span>&nbsp;<span class="string" id="7572305">&#34;openbsd&#34;</span><span class="op" id="7572314">,</span>&nbsp;<span class="string" id="7572316">&#34;netbsd&#34;</span><span class="op" id="7572324">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7572328">tests</span>&nbsp;<span class="op" id="7572334">=</span>&nbsp;<span class="builtinfunc" id="7572336">append</span><span class="op" id="7572342">(</span><span class="ident" id="7572343">tests</span><span class="op" id="7572348">,</span>&nbsp;<span class="op" id="7572350">[</span><span class="op" id="7572351">]</span><span class="ident" id="7572352">test</span><span class="op" id="7572356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572361">{</span><span class="string" id="7572362">&#34;udp&#34;</span><span class="op" id="7572367">,</span>&nbsp;<span class="string" id="7572369">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="7572383">+</span>&nbsp;<span class="ident" id="7572385">ifi</span><span class="op" id="7572388">.</span><span class="ident" id="7572389">Name</span>&nbsp;<span class="op" id="7572394">+</span>&nbsp;<span class="string" id="7572396">&#34;]:0&#34;</span><span class="op" id="7572401">,</span>&nbsp;<span class="ident" id="7572403">true</span><span class="op" id="7572407">}</span><span class="op" id="7572408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572413">{</span><span class="string" id="7572414">&#34;udp6&#34;</span><span class="op" id="7572420">,</span>&nbsp;<span class="string" id="7572422">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="7572436">+</span>&nbsp;<span class="ident" id="7572438">ifi</span><span class="op" id="7572441">.</span><span class="ident" id="7572442">Name</span>&nbsp;<span class="op" id="7572447">+</span>&nbsp;<span class="string" id="7572449">&#34;]:0&#34;</span><span class="op" id="7572454">,</span>&nbsp;<span class="ident" id="7572456">true</span><span class="op" id="7572460">}</span><span class="op" id="7572461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572465">}</span><span class="op" id="7572466">...</span><span class="op" id="7572469">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7572472">case</span>&nbsp;<span class="string" id="7572477">&#34;linux&#34;</span><span class="op" id="7572484">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7572488">tests</span>&nbsp;<span class="op" id="7572494">=</span>&nbsp;<span class="builtinfunc" id="7572496">append</span><span class="op" id="7572502">(</span><span class="ident" id="7572503">tests</span><span class="op" id="7572508">,</span>&nbsp;<span class="op" id="7572510">[</span><span class="op" id="7572511">]</span><span class="ident" id="7572512">test</span><span class="op" id="7572516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572521">{</span><span class="string" id="7572522">&#34;udp&#34;</span><span class="op" id="7572527">,</span>&nbsp;<span class="string" id="7572529">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="7572547">+</span>&nbsp;<span class="ident" id="7572549">ifi</span><span class="op" id="7572552">.</span><span class="ident" id="7572553">Name</span>&nbsp;<span class="op" id="7572558">+</span>&nbsp;<span class="string" id="7572560">&#34;]:0&#34;</span><span class="op" id="7572565">,</span>&nbsp;<span class="ident" id="7572567">true</span><span class="op" id="7572571">}</span><span class="op" id="7572572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572577">{</span><span class="string" id="7572578">&#34;udp6&#34;</span><span class="op" id="7572584">,</span>&nbsp;<span class="string" id="7572586">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="7572604">+</span>&nbsp;<span class="ident" id="7572606">ifi</span><span class="op" id="7572609">.</span><span class="ident" id="7572610">Name</span>&nbsp;<span class="op" id="7572615">+</span>&nbsp;<span class="string" id="7572617">&#34;]:0&#34;</span><span class="op" id="7572622">,</span>&nbsp;<span class="ident" id="7572624">true</span><span class="op" id="7572628">}</span><span class="op" id="7572629">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572633">}</span><span class="op" id="7572634">...</span><span class="op" id="7572637">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7572643">for</span>&nbsp;<span class="ident" id="7572647">_</span><span class="op" id="7572648">,</span>&nbsp;<span class="ident" id="7572650">tt</span>&nbsp;<span class="op" id="7572653">:=</span>&nbsp;<span class="keyword" id="7572656">range</span>&nbsp;<span class="ident" id="7572662">tests</span>&nbsp;<span class="op" id="7572668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7572672">c1</span><span class="op" id="7572674">,</span>&nbsp;<span class="ident" id="7572676">err</span>&nbsp;<span class="op" id="7572680">:=</span>&nbsp;<span class="ident" id="7572683">ListenPacket</span><span class="op" id="7572695">(</span><span class="ident" id="7572696">tt</span><span class="op" id="7572698">.</span><span class="ident" id="7572699">net</span><span class="op" id="7572702">,</span>&nbsp;<span class="ident" id="7572704">tt</span><span class="op" id="7572706">.</span><span class="ident" id="7572707">addr</span><span class="op" id="7572711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7572715">if</span>&nbsp;<span class="ident" id="7572718">err</span>&nbsp;<span class="op" id="7572722">!=</span>&nbsp;<span class="ident" id="7572725">nil</span>&nbsp;<span class="op" id="7572729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7572734">//&nbsp;It&nbsp;might&nbsp;return&nbsp;&#34;LookupHost&nbsp;returned&nbsp;no</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7572780">//&nbsp;suitable&nbsp;address&#34;&nbsp;error&nbsp;on&nbsp;some&nbsp;platforms.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7572829">t</span><span class="op" id="7572830">.</span><span class="ident" id="7572831">Logf</span><span class="op" id="7572835">(</span><span class="string" id="7572836">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7572861">,</span>&nbsp;<span class="ident" id="7572863">err</span><span class="op" id="7572866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7572871">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7572882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7572886">defer</span>&nbsp;<span class="ident" id="7572892">c1</span><span class="op" id="7572894">.</span><span class="ident" id="7572895">Close</span><span class="op" id="7572900">(</span><span class="op" id="7572901">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7572905">if</span>&nbsp;<span class="ident" id="7572908">la</span><span class="op" id="7572910">,</span>&nbsp;<span class="ident" id="7572912">ok</span>&nbsp;<span class="op" id="7572915">:=</span>&nbsp;<span class="ident" id="7572918">c1</span><span class="op" id="7572920">.</span><span class="ident" id="7572921">LocalAddr</span><span class="op" id="7572930">(</span><span class="op" id="7572931">)</span><span class="op" id="7572932">.</span><span class="op" id="7572933">(</span><span class="op" id="7572934">*</span><span class="ident" id="7572935">UDPAddr</span><span class="op" id="7572942">)</span><span class="op" id="7572943">;</span>&nbsp;<span class="op" id="7572945">!</span><span class="ident" id="7572946">ok</span>&nbsp;<span class="op" id="7572949">||</span>&nbsp;<span class="op" id="7572952">!</span><span class="ident" id="7572953">tt</span><span class="op" id="7572955">.</span><span class="ident" id="7572956">nameLookup</span>&nbsp;<span class="op" id="7572967">&amp;&amp;</span>&nbsp;<span class="ident" id="7572970">la</span><span class="op" id="7572972">.</span><span class="ident" id="7572973">Zone</span>&nbsp;<span class="op" id="7572978">==</span>&nbsp;<span class="string" id="7572981">&#34;&#34;</span>&nbsp;<span class="op" id="7572984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7572989">t</span><span class="op" id="7572990">.</span><span class="ident" id="7572991">Fatalf</span><span class="op" id="7572997">(</span><span class="string" id="7572998">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="7573054">,</span>&nbsp;<span class="ident" id="7573056">la</span><span class="op" id="7573058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7573062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7573067">c2</span><span class="op" id="7573069">,</span>&nbsp;<span class="ident" id="7573071">err</span>&nbsp;<span class="op" id="7573075">:=</span>&nbsp;<span class="ident" id="7573078">Dial</span><span class="op" id="7573082">(</span><span class="ident" id="7573083">tt</span><span class="op" id="7573085">.</span><span class="ident" id="7573086">net</span><span class="op" id="7573089">,</span>&nbsp;<span class="ident" id="7573091">c1</span><span class="op" id="7573093">.</span><span class="ident" id="7573094">LocalAddr</span><span class="op" id="7573103">(</span><span class="op" id="7573104">)</span><span class="op" id="7573105">.</span><span class="ident" id="7573106">String</span><span class="op" id="7573112">(</span><span class="op" id="7573113">)</span><span class="op" id="7573114">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7573118">if</span>&nbsp;<span class="ident" id="7573121">err</span>&nbsp;<span class="op" id="7573125">!=</span>&nbsp;<span class="ident" id="7573128">nil</span>&nbsp;<span class="op" id="7573132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7573137">t</span><span class="op" id="7573138">.</span><span class="ident" id="7573139">Fatalf</span><span class="op" id="7573145">(</span><span class="string" id="7573146">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7573163">,</span>&nbsp;<span class="ident" id="7573165">err</span><span class="op" id="7573168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7573172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7573176">defer</span>&nbsp;<span class="ident" id="7573182">c2</span><span class="op" id="7573184">.</span><span class="ident" id="7573185">Close</span><span class="op" id="7573190">(</span><span class="op" id="7573191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7573195">if</span>&nbsp;<span class="ident" id="7573198">la</span><span class="op" id="7573200">,</span>&nbsp;<span class="ident" id="7573202">ok</span>&nbsp;<span class="op" id="7573205">:=</span>&nbsp;<span class="ident" id="7573208">c2</span><span class="op" id="7573210">.</span><span class="ident" id="7573211">LocalAddr</span><span class="op" id="7573220">(</span><span class="op" id="7573221">)</span><span class="op" id="7573222">.</span><span class="op" id="7573223">(</span><span class="op" id="7573224">*</span><span class="ident" id="7573225">UDPAddr</span><span class="op" id="7573232">)</span><span class="op" id="7573233">;</span>&nbsp;<span class="op" id="7573235">!</span><span class="ident" id="7573236">ok</span>&nbsp;<span class="op" id="7573239">||</span>&nbsp;<span class="op" id="7573242">!</span><span class="ident" id="7573243">tt</span><span class="op" id="7573245">.</span><span class="ident" id="7573246">nameLookup</span>&nbsp;<span class="op" id="7573257">&amp;&amp;</span>&nbsp;<span class="ident" id="7573260">la</span><span class="op" id="7573262">.</span><span class="ident" id="7573263">Zone</span>&nbsp;<span class="op" id="7573268">==</span>&nbsp;<span class="string" id="7573271">&#34;&#34;</span>&nbsp;<span class="op" id="7573274">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7573279">t</span><span class="op" id="7573280">.</span><span class="ident" id="7573281">Fatalf</span><span class="op" id="7573287">(</span><span class="string" id="7573288">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="7573344">,</span>&nbsp;<span class="ident" id="7573346">la</span><span class="op" id="7573348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7573352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7573356">if</span>&nbsp;<span class="ident" id="7573359">ra</span><span class="op" id="7573361">,</span>&nbsp;<span class="ident" id="7573363">ok</span>&nbsp;<span class="op" id="7573366">:=</span>&nbsp;<span class="ident" id="7573369">c2</span><span class="op" id="7573371">.</span><span class="ident" id="7573372">RemoteAddr</span><span class="op" id="7573382">(</span><span class="op" id="7573383">)</span><span class="op" id="7573384">.</span><span class="op" id="7573385">(</span><span class="op" id="7573386">*</span><span class="ident" id="7573387">UDPAddr</span><span class="op" id="7573394">)</span><span class="op" id="7573395">;</span>&nbsp;<span class="op" id="7573397">!</span><span class="ident" id="7573398">ok</span>&nbsp;<span class="op" id="7573401">||</span>&nbsp;<span class="op" id="7573404">!</span><span class="ident" id="7573405">tt</span><span class="op" id="7573407">.</span><span class="ident" id="7573408">nameLookup</span>&nbsp;<span class="op" id="7573419">&amp;&amp;</span>&nbsp;<span class="ident" id="7573422">ra</span><span class="op" id="7573424">.</span><span class="ident" id="7573425">Zone</span>&nbsp;<span class="op" id="7573430">==</span>&nbsp;<span class="string" id="7573433">&#34;&#34;</span>&nbsp;<span class="op" id="7573436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7573441">t</span><span class="op" id="7573442">.</span><span class="ident" id="7573443">Fatalf</span><span class="op" id="7573449">(</span><span class="string" id="7573450">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="7573506">,</span>&nbsp;<span class="ident" id="7573508">ra</span><span class="op" id="7573510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7573514">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7573519">if</span>&nbsp;<span class="ident" id="7573522">_</span><span class="op" id="7573523">,</span>&nbsp;<span class="ident" id="7573525">err</span>&nbsp;<span class="op" id="7573529">:=</span>&nbsp;<span class="ident" id="7573532">c2</span><span class="op" id="7573534">.</span><span class="ident" id="7573535">Write</span><span class="op" id="7573540">(</span><span class="op" id="7573541">[</span><span class="op" id="7573542">]</span><span class="builtintype" id="7573543">byte</span><span class="op" id="7573547">(</span><span class="string" id="7573548">&#34;UDP&nbsp;OVER&nbsp;IPV6&nbsp;LINKLOCAL&nbsp;TEST&#34;</span><span class="op" id="7573578">)</span><span class="op" id="7573579">)</span><span class="op" id="7573580">;</span>&nbsp;<span class="ident" id="7573582">err</span>&nbsp;<span class="op" id="7573586">!=</span>&nbsp;<span class="ident" id="7573589">nil</span>&nbsp;<span class="op" id="7573593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7573598">t</span><span class="op" id="7573599">.</span><span class="ident" id="7573600">Fatalf</span><span class="op" id="7573606">(</span><span class="string" id="7573607">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7573630">,</span>&nbsp;<span class="ident" id="7573632">err</span><span class="op" id="7573635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7573639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7573643">b</span>&nbsp;<span class="op" id="7573645">:=</span>&nbsp;<span class="builtinfunc" id="7573648">make</span><span class="op" id="7573652">(</span><span class="op" id="7573653">[</span><span class="op" id="7573654">]</span><span class="builtintype" id="7573655">byte</span><span class="op" id="7573659">,</span>&nbsp;<span class="num" id="7573661">32</span><span class="op" id="7573663">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7573667">if</span>&nbsp;<span class="ident" id="7573670">_</span><span class="op" id="7573671">,</span>&nbsp;<span class="ident" id="7573673">from</span><span class="op" id="7573677">,</span>&nbsp;<span class="ident" id="7573679">err</span>&nbsp;<span class="op" id="7573683">:=</span>&nbsp;<span class="ident" id="7573686">c1</span><span class="op" id="7573688">.</span><span class="ident" id="7573689">ReadFrom</span><span class="op" id="7573697">(</span><span class="ident" id="7573698">b</span><span class="op" id="7573699">)</span><span class="op" id="7573700">;</span>&nbsp;<span class="ident" id="7573702">err</span>&nbsp;<span class="op" id="7573706">!=</span>&nbsp;<span class="ident" id="7573709">nil</span>&nbsp;<span class="op" id="7573713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7573718">t</span><span class="op" id="7573719">.</span><span class="ident" id="7573720">Fatalf</span><span class="op" id="7573726">(</span><span class="string" id="7573727">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7573759">,</span>&nbsp;<span class="ident" id="7573761">err</span><span class="op" id="7573764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7573768">}</span>&nbsp;<span class="keyword" id="7573770">else</span>&nbsp;<span class="op" id="7573775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7573780">if</span>&nbsp;<span class="ident" id="7573783">ra</span><span class="op" id="7573785">,</span>&nbsp;<span class="ident" id="7573787">ok</span>&nbsp;<span class="op" id="7573790">:=</span>&nbsp;<span class="ident" id="7573793">from</span><span class="op" id="7573797">.</span><span class="op" id="7573798">(</span><span class="op" id="7573799">*</span><span class="ident" id="7573800">UDPAddr</span><span class="op" id="7573807">)</span><span class="op" id="7573808">;</span>&nbsp;<span class="op" id="7573810">!</span><span class="ident" id="7573811">ok</span>&nbsp;<span class="op" id="7573814">||</span>&nbsp;<span class="op" id="7573817">!</span><span class="ident" id="7573818">tt</span><span class="op" id="7573820">.</span><span class="ident" id="7573821">nameLookup</span>&nbsp;<span class="op" id="7573832">&amp;&amp;</span>&nbsp;<span class="ident" id="7573835">ra</span><span class="op" id="7573837">.</span><span class="ident" id="7573838">Zone</span>&nbsp;<span class="op" id="7573843">==</span>&nbsp;<span class="string" id="7573846">&#34;&#34;</span>&nbsp;<span class="op" id="7573849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7573855">t</span><span class="op" id="7573856">.</span><span class="ident" id="7573857">Fatalf</span><span class="op" id="7573863">(</span><span class="string" id="7573864">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="7573920">,</span>&nbsp;<span class="ident" id="7573922">ra</span><span class="op" id="7573924">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7573929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7573933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7573936">}</span><br>
<span class="lineno"></span><span class="op" id="7573938">}</span>
</div>
</body>
</html>
