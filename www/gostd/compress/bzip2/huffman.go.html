<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5900001">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5900056">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5900110">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5900161">package</span>&nbsp;<span class="ident" id="5900169">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5900176">import</span>&nbsp;<span class="string" id="5900183">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5900191">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="5900267">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5900278">type</span>&nbsp;<span class="ident" id="5900283">huffmanTree</span>&nbsp;<span class="keyword" id="5900295">struct</span>&nbsp;<span class="op" id="5900302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5900305">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5900376">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5900449">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900505">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900514">[</span><span class="op" id="5900515">]</span><span class="ident" id="5900516">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900529">nextNode</span>&nbsp;<span class="builtintype" id="5900538">int</span><br>
<span class="lineno"></span><span class="op" id="5900542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5900545">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="5900625">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="5900705">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="5900765">//</span><br>
<span class="lineno"></span><span class="comment" id="5900768">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5900845">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="5900923">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5900973">type</span>&nbsp;<span class="ident" id="5900978">huffmanNode</span>&nbsp;<span class="keyword" id="5900990">struct</span>&nbsp;<span class="op" id="5900997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901000">left</span><span class="op" id="5901004">,</span>&nbsp;<span class="ident" id="5901006">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901022">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901030">leftValue</span><span class="op" id="5901039">,</span>&nbsp;<span class="ident" id="5901041">rightValue</span>&nbsp;<span class="builtintype" id="5901052">uint16</span><br>
<span class="lineno"></span><span class="op" id="5901059">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5901062">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="5901139">const</span>&nbsp;<span class="ident" id="5901145">invalidNodeValue</span>&nbsp;<span class="op" id="5901162">=</span>&nbsp;<span class="num" id="5901164">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5901172">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="5901249">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5901269">func</span>&nbsp;<span class="op" id="5901274">(</span><span class="ident" id="5901275">t</span>&nbsp;<span class="op" id="5901277">*</span><span class="ident" id="5901278">huffmanTree</span><span class="op" id="5901289">)</span>&nbsp;<span class="ident" id="5901291">Decode</span><span class="op" id="5901297">(</span><span class="ident" id="5901298">br</span>&nbsp;<span class="op" id="5901301">*</span><span class="ident" id="5901302">bitReader</span><span class="op" id="5901311">)</span>&nbsp;<span class="op" id="5901313">(</span><span class="ident" id="5901314">v</span>&nbsp;<span class="builtintype" id="5901316">uint16</span><span class="op" id="5901322">)</span>&nbsp;<span class="op" id="5901324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901327">nodeIndex</span>&nbsp;<span class="op" id="5901337">:=</span>&nbsp;<span class="builtintype" id="5901340">uint16</span><span class="op" id="5901346">(</span><span class="num" id="5901347">0</span><span class="op" id="5901348">)</span>&nbsp;<span class="comment" id="5901350">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901387">for</span>&nbsp;<span class="op" id="5901391">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901395">node</span>&nbsp;<span class="op" id="5901400">:=</span>&nbsp;<span class="op" id="5901403">&amp;</span><span class="ident" id="5901404">t</span><span class="op" id="5901405">.</span><span class="ident" id="5901406">nodes</span><span class="op" id="5901411">[</span><span class="ident" id="5901412">nodeIndex</span><span class="op" id="5901421">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901425">bit</span><span class="op" id="5901428">,</span>&nbsp;<span class="ident" id="5901430">ok</span>&nbsp;<span class="op" id="5901433">:=</span>&nbsp;<span class="ident" id="5901436">br</span><span class="op" id="5901438">.</span><span class="ident" id="5901439">TryReadBit</span><span class="op" id="5901449">(</span><span class="op" id="5901450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901454">if</span>&nbsp;<span class="op" id="5901457">!</span><span class="ident" id="5901458">ok</span>&nbsp;<span class="op" id="5901461">&amp;&amp;</span>&nbsp;<span class="ident" id="5901464">br</span><span class="op" id="5901466">.</span><span class="ident" id="5901467">ReadBit</span><span class="op" id="5901474">(</span><span class="op" id="5901475">)</span>&nbsp;<span class="op" id="5901477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901482">bit</span>&nbsp;<span class="op" id="5901486">=</span>&nbsp;<span class="num" id="5901488">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901492">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901496">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901535">if</span>&nbsp;<span class="ident" id="5901538">bit</span>&nbsp;<span class="op" id="5901542">!=</span>&nbsp;<span class="num" id="5901545">0</span>&nbsp;<span class="op" id="5901547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901552">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901563">if</span>&nbsp;<span class="ident" id="5901566">node</span><span class="op" id="5901570">.</span><span class="ident" id="5901571">left</span>&nbsp;<span class="op" id="5901576">==</span>&nbsp;<span class="ident" id="5901579">invalidNodeValue</span>&nbsp;<span class="op" id="5901596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901602">return</span>&nbsp;<span class="ident" id="5901609">node</span><span class="op" id="5901613">.</span><span class="ident" id="5901614">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901632">nodeIndex</span>&nbsp;<span class="op" id="5901642">=</span>&nbsp;<span class="ident" id="5901644">node</span><span class="op" id="5901648">.</span><span class="ident" id="5901649">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901656">}</span>&nbsp;<span class="keyword" id="5901658">else</span>&nbsp;<span class="op" id="5901663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901668">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901680">if</span>&nbsp;<span class="ident" id="5901683">node</span><span class="op" id="5901687">.</span><span class="ident" id="5901688">right</span>&nbsp;<span class="op" id="5901694">==</span>&nbsp;<span class="ident" id="5901697">invalidNodeValue</span>&nbsp;<span class="op" id="5901714">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901720">return</span>&nbsp;<span class="ident" id="5901727">node</span><span class="op" id="5901731">.</span><span class="ident" id="5901732">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901751">nodeIndex</span>&nbsp;<span class="op" id="5901761">=</span>&nbsp;<span class="ident" id="5901763">node</span><span class="op" id="5901767">.</span><span class="ident" id="5901768">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5901779">}</span><br>
<span class="lineno">60</span><span class="op" id="5901781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5901784">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="5901857">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5901920">func</span>&nbsp;<span class="ident" id="5901925">newHuffmanTree</span><span class="op" id="5901939">(</span><span class="ident" id="5901940">lengths</span>&nbsp;<span class="op" id="5901948">[</span><span class="op" id="5901949">]</span><span class="builtintype" id="5901950">uint8</span><span class="op" id="5901955">)</span>&nbsp;<span class="op" id="5901957">(</span><span class="ident" id="5901958">huffmanTree</span><span class="op" id="5901969">,</span>&nbsp;<span class="builtintype" id="5901971">error</span><span class="op" id="5901976">)</span>&nbsp;<span class="op" id="5901978">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901981">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902051">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902116">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902178">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902246">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902317">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902387">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902426">if</span>&nbsp;<span class="builtinfunc" id="5902429">len</span><span class="op" id="5902432">(</span><span class="ident" id="5902433">lengths</span><span class="op" id="5902440">)</span>&nbsp;<span class="op" id="5902442">&lt;</span>&nbsp;<span class="num" id="5902444">2</span>&nbsp;<span class="op" id="5902446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5902450">panic</span><span class="op" id="5902455">(</span><span class="string" id="5902456">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="5902489">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902496">var</span>&nbsp;<span class="ident" id="5902500">t</span>&nbsp;<span class="ident" id="5902502">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902516">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902588">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902630">pairs</span>&nbsp;<span class="op" id="5902636">:=</span>&nbsp;<span class="ident" id="5902639">huffmanSymbolLengthPairs</span><span class="op" id="5902663">(</span><span class="builtinfunc" id="5902664">make</span><span class="op" id="5902668">(</span><span class="op" id="5902669">[</span><span class="op" id="5902670">]</span><span class="ident" id="5902671">huffmanSymbolLengthPair</span><span class="op" id="5902694">,</span>&nbsp;<span class="builtinfunc" id="5902696">len</span><span class="op" id="5902699">(</span><span class="ident" id="5902700">lengths</span><span class="op" id="5902707">)</span><span class="op" id="5902708">)</span><span class="op" id="5902709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902712">for</span>&nbsp;<span class="ident" id="5902716">i</span><span class="op" id="5902717">,</span>&nbsp;<span class="ident" id="5902719">length</span>&nbsp;<span class="op" id="5902726">:=</span>&nbsp;<span class="keyword" id="5902729">range</span>&nbsp;<span class="ident" id="5902735">lengths</span>&nbsp;<span class="op" id="5902743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902747">pairs</span><span class="op" id="5902752">[</span><span class="ident" id="5902753">i</span><span class="op" id="5902754">]</span><span class="op" id="5902755">.</span><span class="ident" id="5902756">value</span>&nbsp;<span class="op" id="5902762">=</span>&nbsp;<span class="builtintype" id="5902764">uint16</span><span class="op" id="5902770">(</span><span class="ident" id="5902771">i</span><span class="op" id="5902772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902776">pairs</span><span class="op" id="5902781">[</span><span class="ident" id="5902782">i</span><span class="op" id="5902783">]</span><span class="op" id="5902784">.</span><span class="ident" id="5902785">length</span>&nbsp;<span class="op" id="5902792">=</span>&nbsp;<span class="ident" id="5902794">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902806">sort</span><span class="op" id="5902810">.</span><span class="ident" id="5902811">Sort</span><span class="op" id="5902815">(</span><span class="ident" id="5902816">pairs</span><span class="op" id="5902821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902825">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902897">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5902970">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5903042">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903063">code</span>&nbsp;<span class="op" id="5903068">:=</span>&nbsp;<span class="builtintype" id="5903071">uint32</span><span class="op" id="5903077">(</span><span class="num" id="5903078">0</span><span class="op" id="5903079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903082">length</span>&nbsp;<span class="op" id="5903089">:=</span>&nbsp;<span class="builtintype" id="5903092">uint8</span><span class="op" id="5903097">(</span><span class="num" id="5903098">32</span><span class="op" id="5903100">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903104">codes</span>&nbsp;<span class="op" id="5903110">:=</span>&nbsp;<span class="ident" id="5903113">huffmanCodes</span><span class="op" id="5903125">(</span><span class="builtinfunc" id="5903126">make</span><span class="op" id="5903130">(</span><span class="op" id="5903131">[</span><span class="op" id="5903132">]</span><span class="ident" id="5903133">huffmanCode</span><span class="op" id="5903144">,</span>&nbsp;<span class="builtinfunc" id="5903146">len</span><span class="op" id="5903149">(</span><span class="ident" id="5903150">lengths</span><span class="op" id="5903157">)</span><span class="op" id="5903158">)</span><span class="op" id="5903159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5903162">for</span>&nbsp;<span class="ident" id="5903166">i</span>&nbsp;<span class="op" id="5903168">:=</span>&nbsp;<span class="builtinfunc" id="5903171">len</span><span class="op" id="5903174">(</span><span class="ident" id="5903175">pairs</span><span class="op" id="5903180">)</span>&nbsp;<span class="op" id="5903182">-</span>&nbsp;<span class="num" id="5903184">1</span><span class="op" id="5903185">;</span>&nbsp;<span class="ident" id="5903187">i</span>&nbsp;<span class="op" id="5903189">&gt;=</span>&nbsp;<span class="num" id="5903192">0</span><span class="op" id="5903193">;</span>&nbsp;<span class="ident" id="5903195">i</span><span class="op" id="5903196">--</span>&nbsp;<span class="op" id="5903199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5903203">if</span>&nbsp;<span class="ident" id="5903206">length</span>&nbsp;<span class="op" id="5903213">&gt;</span>&nbsp;<span class="ident" id="5903215">pairs</span><span class="op" id="5903220">[</span><span class="ident" id="5903221">i</span><span class="op" id="5903222">]</span><span class="op" id="5903223">.</span><span class="ident" id="5903224">length</span>&nbsp;<span class="op" id="5903231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5903236">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5903292">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903340">length</span>&nbsp;<span class="op" id="5903347">&gt;&gt;=</span>&nbsp;<span class="num" id="5903351">32</span>&nbsp;<span class="op" id="5903354">-</span>&nbsp;<span class="ident" id="5903356">pairs</span><span class="op" id="5903361">[</span><span class="ident" id="5903362">i</span><span class="op" id="5903363">]</span><span class="op" id="5903364">.</span><span class="ident" id="5903365">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903375">length</span>&nbsp;<span class="op" id="5903382">&lt;&lt;=</span>&nbsp;<span class="num" id="5903386">32</span>&nbsp;<span class="op" id="5903389">-</span>&nbsp;<span class="ident" id="5903391">pairs</span><span class="op" id="5903396">[</span><span class="ident" id="5903397">i</span><span class="op" id="5903398">]</span><span class="op" id="5903399">.</span><span class="ident" id="5903400">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903410">length</span>&nbsp;<span class="op" id="5903417">=</span>&nbsp;<span class="ident" id="5903419">pairs</span><span class="op" id="5903424">[</span><span class="ident" id="5903425">i</span><span class="op" id="5903426">]</span><span class="op" id="5903427">.</span><span class="ident" id="5903428">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5903437">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903441">codes</span><span class="op" id="5903446">[</span><span class="ident" id="5903447">i</span><span class="op" id="5903448">]</span><span class="op" id="5903449">.</span><span class="ident" id="5903450">code</span>&nbsp;<span class="op" id="5903455">=</span>&nbsp;<span class="ident" id="5903457">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903464">codes</span><span class="op" id="5903469">[</span><span class="ident" id="5903470">i</span><span class="op" id="5903471">]</span><span class="op" id="5903472">.</span><span class="ident" id="5903473">codeLen</span>&nbsp;<span class="op" id="5903481">=</span>&nbsp;<span class="ident" id="5903483">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903492">codes</span><span class="op" id="5903497">[</span><span class="ident" id="5903498">i</span><span class="op" id="5903499">]</span><span class="op" id="5903500">.</span><span class="ident" id="5903501">value</span>&nbsp;<span class="op" id="5903507">=</span>&nbsp;<span class="ident" id="5903509">pairs</span><span class="op" id="5903514">[</span><span class="ident" id="5903515">i</span><span class="op" id="5903516">]</span><span class="op" id="5903517">.</span><span class="ident" id="5903518">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5903526">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5903592">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903625">code</span>&nbsp;<span class="op" id="5903630">+=</span>&nbsp;<span class="num" id="5903633">1</span>&nbsp;<span class="op" id="5903635">&lt;&lt;</span>&nbsp;<span class="op" id="5903638">(</span><span class="num" id="5903639">32</span>&nbsp;<span class="op" id="5903642">-</span>&nbsp;<span class="ident" id="5903644">length</span><span class="op" id="5903650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5903653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5903657">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5903730">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903765">sort</span><span class="op" id="5903769">.</span><span class="ident" id="5903770">Sort</span><span class="op" id="5903774">(</span><span class="ident" id="5903775">codes</span><span class="op" id="5903780">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903784">t</span><span class="op" id="5903785">.</span><span class="ident" id="5903786">nodes</span>&nbsp;<span class="op" id="5903792">=</span>&nbsp;<span class="builtinfunc" id="5903794">make</span><span class="op" id="5903798">(</span><span class="op" id="5903799">[</span><span class="op" id="5903800">]</span><span class="ident" id="5903801">huffmanNode</span><span class="op" id="5903812">,</span>&nbsp;<span class="builtinfunc" id="5903814">len</span><span class="op" id="5903817">(</span><span class="ident" id="5903818">codes</span><span class="op" id="5903823">)</span><span class="op" id="5903824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903827">_</span><span class="op" id="5903828">,</span>&nbsp;<span class="ident" id="5903830">err</span>&nbsp;<span class="op" id="5903834">:=</span>&nbsp;<span class="ident" id="5903837">buildHuffmanNode</span><span class="op" id="5903853">(</span><span class="op" id="5903854">&amp;</span><span class="ident" id="5903855">t</span><span class="op" id="5903856">,</span>&nbsp;<span class="ident" id="5903858">codes</span><span class="op" id="5903863">,</span>&nbsp;<span class="num" id="5903865">0</span><span class="op" id="5903866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5903869">return</span>&nbsp;<span class="ident" id="5903876">t</span><span class="op" id="5903877">,</span>&nbsp;<span class="ident" id="5903879">err</span><br>
<span class="lineno">120</span><span class="op" id="5903883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5903886">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5903952">type</span>&nbsp;<span class="ident" id="5903957">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="5903981">struct</span>&nbsp;<span class="op" id="5903988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903991">value</span>&nbsp;&nbsp;<span class="builtintype" id="5903998">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904006">length</span>&nbsp;<span class="builtintype" id="5904013">uint8</span><br>
<span class="lineno"></span><span class="op" id="5904019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5904022">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="5904094">type</span>&nbsp;<span class="ident" id="5904099">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="5904124">[</span><span class="op" id="5904125">]</span><span class="ident" id="5904126">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="5904151">func</span>&nbsp;<span class="op" id="5904156">(</span><span class="ident" id="5904157">h</span>&nbsp;<span class="ident" id="5904159">huffmanSymbolLengthPairs</span><span class="op" id="5904183">)</span>&nbsp;<span class="ident" id="5904185">Len</span><span class="op" id="5904188">(</span><span class="op" id="5904189">)</span>&nbsp;<span class="builtintype" id="5904191">int</span>&nbsp;<span class="op" id="5904195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904198">return</span>&nbsp;<span class="builtinfunc" id="5904205">len</span><span class="op" id="5904208">(</span><span class="ident" id="5904209">h</span><span class="op" id="5904210">)</span><br>
<span class="lineno"></span><span class="op" id="5904212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="5904215">func</span>&nbsp;<span class="op" id="5904220">(</span><span class="ident" id="5904221">h</span>&nbsp;<span class="ident" id="5904223">huffmanSymbolLengthPairs</span><span class="op" id="5904247">)</span>&nbsp;<span class="ident" id="5904249">Less</span><span class="op" id="5904253">(</span><span class="ident" id="5904254">i</span><span class="op" id="5904255">,</span>&nbsp;<span class="ident" id="5904257">j</span>&nbsp;<span class="builtintype" id="5904259">int</span><span class="op" id="5904262">)</span>&nbsp;<span class="builtintype" id="5904264">bool</span>&nbsp;<span class="op" id="5904269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904272">if</span>&nbsp;<span class="ident" id="5904275">h</span><span class="op" id="5904276">[</span><span class="ident" id="5904277">i</span><span class="op" id="5904278">]</span><span class="op" id="5904279">.</span><span class="ident" id="5904280">length</span>&nbsp;<span class="op" id="5904287">&lt;</span>&nbsp;<span class="ident" id="5904289">h</span><span class="op" id="5904290">[</span><span class="ident" id="5904291">j</span><span class="op" id="5904292">]</span><span class="op" id="5904293">.</span><span class="ident" id="5904294">length</span>&nbsp;<span class="op" id="5904301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904305">return</span>&nbsp;<span class="builtintype" id="5904312">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5904318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904321">if</span>&nbsp;<span class="ident" id="5904324">h</span><span class="op" id="5904325">[</span><span class="ident" id="5904326">i</span><span class="op" id="5904327">]</span><span class="op" id="5904328">.</span><span class="ident" id="5904329">length</span>&nbsp;<span class="op" id="5904336">&gt;</span>&nbsp;<span class="ident" id="5904338">h</span><span class="op" id="5904339">[</span><span class="ident" id="5904340">j</span><span class="op" id="5904341">]</span><span class="op" id="5904342">.</span><span class="ident" id="5904343">length</span>&nbsp;<span class="op" id="5904350">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904354">return</span>&nbsp;<span class="builtintype" id="5904361">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5904368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904371">if</span>&nbsp;<span class="ident" id="5904374">h</span><span class="op" id="5904375">[</span><span class="ident" id="5904376">i</span><span class="op" id="5904377">]</span><span class="op" id="5904378">.</span><span class="ident" id="5904379">value</span>&nbsp;<span class="op" id="5904385">&lt;</span>&nbsp;<span class="ident" id="5904387">h</span><span class="op" id="5904388">[</span><span class="ident" id="5904389">j</span><span class="op" id="5904390">]</span><span class="op" id="5904391">.</span><span class="ident" id="5904392">value</span>&nbsp;<span class="op" id="5904398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904402">return</span>&nbsp;<span class="builtintype" id="5904409">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5904415">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904418">return</span>&nbsp;<span class="builtintype" id="5904425">false</span><br>
<span class="lineno"></span><span class="op" id="5904431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5904434">func</span>&nbsp;<span class="op" id="5904439">(</span><span class="ident" id="5904440">h</span>&nbsp;<span class="ident" id="5904442">huffmanSymbolLengthPairs</span><span class="op" id="5904466">)</span>&nbsp;<span class="ident" id="5904468">Swap</span><span class="op" id="5904472">(</span><span class="ident" id="5904473">i</span><span class="op" id="5904474">,</span>&nbsp;<span class="ident" id="5904476">j</span>&nbsp;<span class="builtintype" id="5904478">int</span><span class="op" id="5904481">)</span>&nbsp;<span class="op" id="5904483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904486">h</span><span class="op" id="5904487">[</span><span class="ident" id="5904488">i</span><span class="op" id="5904489">]</span><span class="op" id="5904490">,</span>&nbsp;<span class="ident" id="5904492">h</span><span class="op" id="5904493">[</span><span class="ident" id="5904494">j</span><span class="op" id="5904495">]</span>&nbsp;<span class="op" id="5904497">=</span>&nbsp;<span class="ident" id="5904499">h</span><span class="op" id="5904500">[</span><span class="ident" id="5904501">j</span><span class="op" id="5904502">]</span><span class="op" id="5904503">,</span>&nbsp;<span class="ident" id="5904505">h</span><span class="op" id="5904506">[</span><span class="ident" id="5904507">i</span><span class="op" id="5904508">]</span><br>
<span class="lineno">150</span><span class="op" id="5904510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5904513">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5904573">type</span>&nbsp;<span class="ident" id="5904578">huffmanCode</span>&nbsp;<span class="keyword" id="5904590">struct</span>&nbsp;<span class="op" id="5904597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904600">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5904608">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904616">codeLen</span>&nbsp;<span class="builtintype" id="5904624">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904631">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5904639">uint16</span><br>
<span class="lineno"></span><span class="op" id="5904646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5904649">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="5904710">type</span>&nbsp;<span class="ident" id="5904715">huffmanCodes</span>&nbsp;<span class="op" id="5904728">[</span><span class="op" id="5904729">]</span><span class="ident" id="5904730">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5904743">func</span>&nbsp;<span class="op" id="5904748">(</span><span class="ident" id="5904749">n</span>&nbsp;<span class="ident" id="5904751">huffmanCodes</span><span class="op" id="5904763">)</span>&nbsp;<span class="ident" id="5904765">Len</span><span class="op" id="5904768">(</span><span class="op" id="5904769">)</span>&nbsp;<span class="builtintype" id="5904771">int</span>&nbsp;<span class="op" id="5904775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904778">return</span>&nbsp;<span class="builtinfunc" id="5904785">len</span><span class="op" id="5904788">(</span><span class="ident" id="5904789">n</span><span class="op" id="5904790">)</span><br>
<span class="lineno"></span><span class="op" id="5904792">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5904795">func</span>&nbsp;<span class="op" id="5904800">(</span><span class="ident" id="5904801">n</span>&nbsp;<span class="ident" id="5904803">huffmanCodes</span><span class="op" id="5904815">)</span>&nbsp;<span class="ident" id="5904817">Less</span><span class="op" id="5904821">(</span><span class="ident" id="5904822">i</span><span class="op" id="5904823">,</span>&nbsp;<span class="ident" id="5904825">j</span>&nbsp;<span class="builtintype" id="5904827">int</span><span class="op" id="5904830">)</span>&nbsp;<span class="builtintype" id="5904832">bool</span>&nbsp;<span class="op" id="5904837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904840">return</span>&nbsp;<span class="ident" id="5904847">n</span><span class="op" id="5904848">[</span><span class="ident" id="5904849">i</span><span class="op" id="5904850">]</span><span class="op" id="5904851">.</span><span class="ident" id="5904852">code</span>&nbsp;<span class="op" id="5904857">&lt;</span>&nbsp;<span class="ident" id="5904859">n</span><span class="op" id="5904860">[</span><span class="ident" id="5904861">j</span><span class="op" id="5904862">]</span><span class="op" id="5904863">.</span><span class="ident" id="5904864">code</span><br>
<span class="lineno"></span><span class="op" id="5904869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5904872">func</span>&nbsp;<span class="op" id="5904877">(</span><span class="ident" id="5904878">n</span>&nbsp;<span class="ident" id="5904880">huffmanCodes</span><span class="op" id="5904892">)</span>&nbsp;<span class="ident" id="5904894">Swap</span><span class="op" id="5904898">(</span><span class="ident" id="5904899">i</span><span class="op" id="5904900">,</span>&nbsp;<span class="ident" id="5904902">j</span>&nbsp;<span class="builtintype" id="5904904">int</span><span class="op" id="5904907">)</span>&nbsp;<span class="op" id="5904909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904912">n</span><span class="op" id="5904913">[</span><span class="ident" id="5904914">i</span><span class="op" id="5904915">]</span><span class="op" id="5904916">,</span>&nbsp;<span class="ident" id="5904918">n</span><span class="op" id="5904919">[</span><span class="ident" id="5904920">j</span><span class="op" id="5904921">]</span>&nbsp;<span class="op" id="5904923">=</span>&nbsp;<span class="ident" id="5904925">n</span><span class="op" id="5904926">[</span><span class="ident" id="5904927">j</span><span class="op" id="5904928">]</span><span class="op" id="5904929">,</span>&nbsp;<span class="ident" id="5904931">n</span><span class="op" id="5904932">[</span><span class="ident" id="5904933">i</span><span class="op" id="5904934">]</span><br>
<span class="lineno"></span><span class="op" id="5904936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5904939">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="5905017">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="5905091">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5905112">func</span>&nbsp;<span class="ident" id="5905117">buildHuffmanNode</span><span class="op" id="5905133">(</span><span class="ident" id="5905134">t</span>&nbsp;<span class="op" id="5905136">*</span><span class="ident" id="5905137">huffmanTree</span><span class="op" id="5905148">,</span>&nbsp;<span class="ident" id="5905150">codes</span>&nbsp;<span class="op" id="5905156">[</span><span class="op" id="5905157">]</span><span class="ident" id="5905158">huffmanCode</span><span class="op" id="5905169">,</span>&nbsp;<span class="ident" id="5905171">level</span>&nbsp;<span class="builtintype" id="5905177">uint32</span><span class="op" id="5905183">)</span>&nbsp;<span class="op" id="5905185">(</span><span class="ident" id="5905186">nodeIndex</span>&nbsp;<span class="builtintype" id="5905196">uint16</span><span class="op" id="5905202">,</span>&nbsp;<span class="ident" id="5905204">err</span>&nbsp;<span class="builtintype" id="5905208">error</span><span class="op" id="5905213">)</span>&nbsp;<span class="op" id="5905215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905218">test</span>&nbsp;<span class="op" id="5905223">:=</span>&nbsp;<span class="builtintype" id="5905226">uint32</span><span class="op" id="5905232">(</span><span class="num" id="5905233">1</span><span class="op" id="5905234">)</span>&nbsp;<span class="op" id="5905236">&lt;&lt;</span>&nbsp;<span class="op" id="5905239">(</span><span class="num" id="5905240">31</span>&nbsp;<span class="op" id="5905243">-</span>&nbsp;<span class="ident" id="5905245">level</span><span class="op" id="5905250">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905254">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905347">firstRightIndex</span>&nbsp;<span class="op" id="5905363">:=</span>&nbsp;<span class="builtinfunc" id="5905366">len</span><span class="op" id="5905369">(</span><span class="ident" id="5905370">codes</span><span class="op" id="5905375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905378">for</span>&nbsp;<span class="ident" id="5905382">i</span><span class="op" id="5905383">,</span>&nbsp;<span class="ident" id="5905385">code</span>&nbsp;<span class="op" id="5905390">:=</span>&nbsp;<span class="keyword" id="5905393">range</span>&nbsp;<span class="ident" id="5905399">codes</span>&nbsp;<span class="op" id="5905405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905409">if</span>&nbsp;<span class="ident" id="5905412">code</span><span class="op" id="5905416">.</span><span class="ident" id="5905417">code</span><span class="op" id="5905421">&amp;</span><span class="ident" id="5905422">test</span>&nbsp;<span class="op" id="5905427">!=</span>&nbsp;<span class="num" id="5905430">0</span>&nbsp;<span class="op" id="5905432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905437">firstRightIndex</span>&nbsp;<span class="op" id="5905453">=</span>&nbsp;<span class="ident" id="5905455">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905460">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905475">left</span>&nbsp;<span class="op" id="5905480">:=</span>&nbsp;<span class="ident" id="5905483">codes</span><span class="op" id="5905488">[</span><span class="op" id="5905489">:</span><span class="ident" id="5905490">firstRightIndex</span><span class="op" id="5905505">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905508">right</span>&nbsp;<span class="op" id="5905514">:=</span>&nbsp;<span class="ident" id="5905517">codes</span><span class="op" id="5905522">[</span><span class="ident" id="5905523">firstRightIndex</span><span class="op" id="5905538">:</span><span class="op" id="5905539">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905543">if</span>&nbsp;<span class="builtinfunc" id="5905546">len</span><span class="op" id="5905549">(</span><span class="ident" id="5905550">left</span><span class="op" id="5905554">)</span>&nbsp;<span class="op" id="5905556">==</span>&nbsp;<span class="num" id="5905559">0</span>&nbsp;<span class="op" id="5905561">||</span>&nbsp;<span class="builtinfunc" id="5905564">len</span><span class="op" id="5905567">(</span><span class="ident" id="5905568">right</span><span class="op" id="5905573">)</span>&nbsp;<span class="op" id="5905575">==</span>&nbsp;<span class="num" id="5905578">0</span>&nbsp;<span class="op" id="5905580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905584">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905649">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905715">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905747">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905810">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905873">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905921">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905926">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905991">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906057">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906119">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906174">if</span>&nbsp;<span class="builtinfunc" id="5906177">len</span><span class="op" id="5906180">(</span><span class="ident" id="5906181">codes</span><span class="op" id="5906186">)</span>&nbsp;<span class="op" id="5906188">&lt;</span>&nbsp;<span class="num" id="5906190">2</span>&nbsp;<span class="op" id="5906192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906197">return</span>&nbsp;<span class="num" id="5906204">0</span><span class="op" id="5906205">,</span>&nbsp;<span class="ident" id="5906207">StructuralError</span><span class="op" id="5906222">(</span><span class="string" id="5906223">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5906243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906252">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906317">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906376">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906392">if</span>&nbsp;<span class="ident" id="5906395">level</span>&nbsp;<span class="op" id="5906401">==</span>&nbsp;<span class="num" id="5906404">31</span>&nbsp;<span class="op" id="5906407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906412">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906469">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906528">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906579">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906605">return</span>&nbsp;<span class="num" id="5906612">0</span><span class="op" id="5906613">,</span>&nbsp;<span class="ident" id="5906615">StructuralError</span><span class="op" id="5906630">(</span><span class="string" id="5906631">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5906662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906671">if</span>&nbsp;<span class="builtinfunc" id="5906674">len</span><span class="op" id="5906677">(</span><span class="ident" id="5906678">left</span><span class="op" id="5906682">)</span>&nbsp;<span class="op" id="5906684">==</span>&nbsp;<span class="num" id="5906687">0</span>&nbsp;<span class="op" id="5906689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906694">return</span>&nbsp;<span class="ident" id="5906701">buildHuffmanNode</span><span class="op" id="5906717">(</span><span class="ident" id="5906718">t</span><span class="op" id="5906719">,</span>&nbsp;<span class="ident" id="5906721">right</span><span class="op" id="5906726">,</span>&nbsp;<span class="ident" id="5906728">level</span><span class="op" id="5906733">+</span><span class="num" id="5906734">1</span><span class="op" id="5906735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906743">return</span>&nbsp;<span class="ident" id="5906750">buildHuffmanNode</span><span class="op" id="5906766">(</span><span class="ident" id="5906767">t</span><span class="op" id="5906768">,</span>&nbsp;<span class="ident" id="5906770">left</span><span class="op" id="5906774">,</span>&nbsp;<span class="ident" id="5906776">level</span><span class="op" id="5906781">+</span><span class="num" id="5906782">1</span><span class="op" id="5906783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906786">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906790">nodeIndex</span>&nbsp;<span class="op" id="5906800">=</span>&nbsp;<span class="builtintype" id="5906802">uint16</span><span class="op" id="5906808">(</span><span class="ident" id="5906809">t</span><span class="op" id="5906810">.</span><span class="ident" id="5906811">nextNode</span><span class="op" id="5906819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906822">node</span>&nbsp;<span class="op" id="5906827">:=</span>&nbsp;<span class="op" id="5906830">&amp;</span><span class="ident" id="5906831">t</span><span class="op" id="5906832">.</span><span class="ident" id="5906833">nodes</span><span class="op" id="5906838">[</span><span class="ident" id="5906839">t</span><span class="op" id="5906840">.</span><span class="ident" id="5906841">nextNode</span><span class="op" id="5906849">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906852">t</span><span class="op" id="5906853">.</span><span class="ident" id="5906854">nextNode</span><span class="op" id="5906862">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906867">if</span>&nbsp;<span class="builtinfunc" id="5906870">len</span><span class="op" id="5906873">(</span><span class="ident" id="5906874">left</span><span class="op" id="5906878">)</span>&nbsp;<span class="op" id="5906880">==</span>&nbsp;<span class="num" id="5906883">1</span>&nbsp;<span class="op" id="5906885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5906889">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906904">node</span><span class="op" id="5906908">.</span><span class="ident" id="5906909">left</span>&nbsp;<span class="op" id="5906914">=</span>&nbsp;<span class="ident" id="5906916">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906935">node</span><span class="op" id="5906939">.</span><span class="ident" id="5906940">leftValue</span>&nbsp;<span class="op" id="5906950">=</span>&nbsp;<span class="ident" id="5906952">left</span><span class="op" id="5906956">[</span><span class="num" id="5906957">0</span><span class="op" id="5906958">]</span><span class="op" id="5906959">.</span><span class="ident" id="5906960">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906967">}</span>&nbsp;<span class="keyword" id="5906969">else</span>&nbsp;<span class="op" id="5906974">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906978">node</span><span class="op" id="5906982">.</span><span class="ident" id="5906983">left</span><span class="op" id="5906987">,</span>&nbsp;<span class="ident" id="5906989">err</span>&nbsp;<span class="op" id="5906993">=</span>&nbsp;<span class="ident" id="5906995">buildHuffmanNode</span><span class="op" id="5907011">(</span><span class="ident" id="5907012">t</span><span class="op" id="5907013">,</span>&nbsp;<span class="ident" id="5907015">left</span><span class="op" id="5907019">,</span>&nbsp;<span class="ident" id="5907021">level</span><span class="op" id="5907026">+</span><span class="num" id="5907027">1</span><span class="op" id="5907028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907035">if</span>&nbsp;<span class="ident" id="5907038">err</span>&nbsp;<span class="op" id="5907042">!=</span>&nbsp;<span class="ident" id="5907045">nil</span>&nbsp;<span class="op" id="5907049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907053">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907065">if</span>&nbsp;<span class="builtinfunc" id="5907068">len</span><span class="op" id="5907071">(</span><span class="ident" id="5907072">right</span><span class="op" id="5907077">)</span>&nbsp;<span class="op" id="5907079">==</span>&nbsp;<span class="num" id="5907082">1</span>&nbsp;<span class="op" id="5907084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5907088">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907103">node</span><span class="op" id="5907107">.</span><span class="ident" id="5907108">right</span>&nbsp;<span class="op" id="5907114">=</span>&nbsp;<span class="ident" id="5907116">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907135">node</span><span class="op" id="5907139">.</span><span class="ident" id="5907140">rightValue</span>&nbsp;<span class="op" id="5907151">=</span>&nbsp;<span class="ident" id="5907153">right</span><span class="op" id="5907158">[</span><span class="num" id="5907159">0</span><span class="op" id="5907160">]</span><span class="op" id="5907161">.</span><span class="ident" id="5907162">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907169">}</span>&nbsp;<span class="keyword" id="5907171">else</span>&nbsp;<span class="op" id="5907176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907180">node</span><span class="op" id="5907184">.</span><span class="ident" id="5907185">right</span><span class="op" id="5907190">,</span>&nbsp;<span class="ident" id="5907192">err</span>&nbsp;<span class="op" id="5907196">=</span>&nbsp;<span class="ident" id="5907198">buildHuffmanNode</span><span class="op" id="5907214">(</span><span class="ident" id="5907215">t</span><span class="op" id="5907216">,</span>&nbsp;<span class="ident" id="5907218">right</span><span class="op" id="5907223">,</span>&nbsp;<span class="ident" id="5907225">level</span><span class="op" id="5907230">+</span><span class="num" id="5907231">1</span><span class="op" id="5907232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907239">return</span><br>
<span class="lineno"></span><span class="op" id="5907246">}</span>
</div>
</body>
</html>
