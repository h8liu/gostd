<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html" class="current">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8160201">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8160257">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8160311">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8160362">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8160395">package</span>&nbsp;<span class="ident" id="8160403">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8160408">import</span>&nbsp;<span class="op" id="8160415">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8160418">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8160427">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8160433">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8160444">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8160455">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8160466">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8160477">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8160484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8160487">func</span>&nbsp;<span class="ident" id="8160492">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="8160525">(</span><span class="ident" id="8160526">t</span>&nbsp;<span class="op" id="8160528">*</span><span class="ident" id="8160529">testing</span><span class="op" id="8160536">.</span><span class="ident" id="8160537">T</span><span class="op" id="8160538">)</span>&nbsp;<span class="op" id="8160540">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160543">addr</span>&nbsp;<span class="op" id="8160548">:=</span>&nbsp;<span class="ident" id="8160551">testUnixAddr</span><span class="op" id="8160563">(</span><span class="op" id="8160564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160567">la</span><span class="op" id="8160569">,</span>&nbsp;<span class="ident" id="8160571">err</span>&nbsp;<span class="op" id="8160575">:=</span>&nbsp;<span class="ident" id="8160578">ResolveUnixAddr</span><span class="op" id="8160593">(</span><span class="string" id="8160594">&#34;unixgram&#34;</span><span class="op" id="8160604">,</span>&nbsp;<span class="ident" id="8160606">addr</span><span class="op" id="8160610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8160613">if</span>&nbsp;<span class="ident" id="8160616">err</span>&nbsp;<span class="op" id="8160620">!=</span>&nbsp;<span class="ident" id="8160623">nil</span>&nbsp;<span class="op" id="8160627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160631">t</span><span class="op" id="8160632">.</span><span class="ident" id="8160633">Fatalf</span><span class="op" id="8160639">(</span><span class="string" id="8160640">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8160668">,</span>&nbsp;<span class="ident" id="8160670">err</span><span class="op" id="8160673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8160676">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160679">c</span><span class="op" id="8160680">,</span>&nbsp;<span class="ident" id="8160682">err</span>&nbsp;<span class="op" id="8160686">:=</span>&nbsp;<span class="ident" id="8160689">ListenUnixgram</span><span class="op" id="8160703">(</span><span class="string" id="8160704">&#34;unixgram&#34;</span><span class="op" id="8160714">,</span>&nbsp;<span class="ident" id="8160716">la</span><span class="op" id="8160718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8160721">if</span>&nbsp;<span class="ident" id="8160724">err</span>&nbsp;<span class="op" id="8160728">!=</span>&nbsp;<span class="ident" id="8160731">nil</span>&nbsp;<span class="op" id="8160735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160739">t</span><span class="op" id="8160740">.</span><span class="ident" id="8160741">Fatalf</span><span class="op" id="8160747">(</span><span class="string" id="8160748">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8160775">,</span>&nbsp;<span class="ident" id="8160777">err</span><span class="op" id="8160780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8160783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8160786">defer</span>&nbsp;<span class="keyword" id="8160792">func</span><span class="op" id="8160796">(</span><span class="op" id="8160797">)</span>&nbsp;<span class="op" id="8160799">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160803">c</span><span class="op" id="8160804">.</span><span class="ident" id="8160805">Close</span><span class="op" id="8160810">(</span><span class="op" id="8160811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160815">os</span><span class="op" id="8160817">.</span><span class="ident" id="8160818">Remove</span><span class="op" id="8160824">(</span><span class="ident" id="8160825">addr</span><span class="op" id="8160829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8160832">}</span><span class="op" id="8160833">(</span><span class="op" id="8160834">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160838">off</span>&nbsp;<span class="op" id="8160842">:=</span>&nbsp;<span class="builtinfunc" id="8160845">make</span><span class="op" id="8160849">(</span><span class="keyword" id="8160850">chan</span>&nbsp;<span class="builtintype" id="8160855">bool</span><span class="op" id="8160859">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160862">data</span>&nbsp;<span class="op" id="8160867">:=</span>&nbsp;<span class="op" id="8160870">[</span><span class="num" id="8160871">5</span><span class="op" id="8160872">]</span><span class="builtintype" id="8160873">byte</span><span class="op" id="8160877">{</span><span class="num" id="8160878">1</span><span class="op" id="8160879">,</span>&nbsp;<span class="num" id="8160881">2</span><span class="op" id="8160882">,</span>&nbsp;<span class="num" id="8160884">3</span><span class="op" id="8160885">,</span>&nbsp;<span class="num" id="8160887">4</span><span class="op" id="8160888">,</span>&nbsp;<span class="num" id="8160890">5</span><span class="op" id="8160891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8160894">go</span>&nbsp;<span class="keyword" id="8160897">func</span><span class="op" id="8160901">(</span><span class="op" id="8160902">)</span>&nbsp;<span class="op" id="8160904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8160908">defer</span>&nbsp;<span class="keyword" id="8160914">func</span><span class="op" id="8160918">(</span><span class="op" id="8160919">)</span>&nbsp;<span class="op" id="8160921">{</span>&nbsp;<span class="ident" id="8160923">off</span>&nbsp;<span class="op" id="8160927">&lt;-</span>&nbsp;<span class="builtintype" id="8160930">true</span>&nbsp;<span class="op" id="8160935">}</span><span class="op" id="8160936">(</span><span class="op" id="8160937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8160941">s</span><span class="op" id="8160942">,</span>&nbsp;<span class="ident" id="8160944">err</span>&nbsp;<span class="op" id="8160948">:=</span>&nbsp;<span class="ident" id="8160951">syscall</span><span class="op" id="8160958">.</span><span class="ident" id="8160959">Socket</span><span class="op" id="8160965">(</span><span class="ident" id="8160966">syscall</span><span class="op" id="8160973">.</span><span class="ident" id="8160974">AF_UNIX</span><span class="op" id="8160981">,</span>&nbsp;<span class="ident" id="8160983">syscall</span><span class="op" id="8160990">.</span><span class="ident" id="8160991">SOCK_DGRAM</span><span class="op" id="8161001">,</span>&nbsp;<span class="num" id="8161003">0</span><span class="op" id="8161004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8161008">if</span>&nbsp;<span class="ident" id="8161011">err</span>&nbsp;<span class="op" id="8161015">!=</span>&nbsp;<span class="ident" id="8161018">nil</span>&nbsp;<span class="op" id="8161022">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161027">t</span><span class="op" id="8161028">.</span><span class="ident" id="8161029">Errorf</span><span class="op" id="8161035">(</span><span class="string" id="8161036">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8161063">,</span>&nbsp;<span class="ident" id="8161065">err</span><span class="op" id="8161068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8161073">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8161082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8161086">defer</span>&nbsp;<span class="ident" id="8161092">syscall</span><span class="op" id="8161099">.</span><span class="ident" id="8161100">Close</span><span class="op" id="8161105">(</span><span class="ident" id="8161106">s</span><span class="op" id="8161107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161111">rsa</span>&nbsp;<span class="op" id="8161115">:=</span>&nbsp;<span class="op" id="8161118">&amp;</span><span class="ident" id="8161119">syscall</span><span class="op" id="8161126">.</span><span class="ident" id="8161127">SockaddrUnix</span><span class="op" id="8161139">{</span><span class="ident" id="8161140">Name</span><span class="op" id="8161144">:</span>&nbsp;<span class="ident" id="8161146">addr</span><span class="op" id="8161150">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8161154">if</span>&nbsp;<span class="ident" id="8161157">err</span>&nbsp;<span class="op" id="8161161">:=</span>&nbsp;<span class="ident" id="8161164">syscall</span><span class="op" id="8161171">.</span><span class="ident" id="8161172">Sendto</span><span class="op" id="8161178">(</span><span class="ident" id="8161179">s</span><span class="op" id="8161180">,</span>&nbsp;<span class="ident" id="8161182">data</span><span class="op" id="8161186">[</span><span class="op" id="8161187">:</span><span class="op" id="8161188">]</span><span class="op" id="8161189">,</span>&nbsp;<span class="num" id="8161191">0</span><span class="op" id="8161192">,</span>&nbsp;<span class="ident" id="8161194">rsa</span><span class="op" id="8161197">)</span><span class="op" id="8161198">;</span>&nbsp;<span class="ident" id="8161200">err</span>&nbsp;<span class="op" id="8161204">!=</span>&nbsp;<span class="ident" id="8161207">nil</span>&nbsp;<span class="op" id="8161211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161216">t</span><span class="op" id="8161217">.</span><span class="ident" id="8161218">Errorf</span><span class="op" id="8161224">(</span><span class="string" id="8161225">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8161252">,</span>&nbsp;<span class="ident" id="8161254">err</span><span class="op" id="8161257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8161262">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8161271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8161274">}</span><span class="op" id="8161275">(</span><span class="op" id="8161276">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8161280">&lt;-</span><span class="ident" id="8161282">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161287">b</span>&nbsp;<span class="op" id="8161289">:=</span>&nbsp;<span class="builtinfunc" id="8161292">make</span><span class="op" id="8161296">(</span><span class="op" id="8161297">[</span><span class="op" id="8161298">]</span><span class="builtintype" id="8161299">byte</span><span class="op" id="8161303">,</span>&nbsp;<span class="num" id="8161305">64</span><span class="op" id="8161307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161310">c</span><span class="op" id="8161311">.</span><span class="ident" id="8161312">SetReadDeadline</span><span class="op" id="8161327">(</span><span class="ident" id="8161328">time</span><span class="op" id="8161332">.</span><span class="ident" id="8161333">Now</span><span class="op" id="8161336">(</span><span class="op" id="8161337">)</span><span class="op" id="8161338">.</span><span class="ident" id="8161339">Add</span><span class="op" id="8161342">(</span><span class="num" id="8161343">100</span>&nbsp;<span class="op" id="8161347">*</span>&nbsp;<span class="ident" id="8161349">time</span><span class="op" id="8161353">.</span><span class="ident" id="8161354">Millisecond</span><span class="op" id="8161365">)</span><span class="op" id="8161366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161369">n</span><span class="op" id="8161370">,</span>&nbsp;<span class="ident" id="8161372">from</span><span class="op" id="8161376">,</span>&nbsp;<span class="ident" id="8161378">err</span>&nbsp;<span class="op" id="8161382">:=</span>&nbsp;<span class="ident" id="8161385">c</span><span class="op" id="8161386">.</span><span class="ident" id="8161387">ReadFrom</span><span class="op" id="8161395">(</span><span class="ident" id="8161396">b</span><span class="op" id="8161397">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8161400">if</span>&nbsp;<span class="ident" id="8161403">err</span>&nbsp;<span class="op" id="8161407">!=</span>&nbsp;<span class="ident" id="8161410">nil</span>&nbsp;<span class="op" id="8161414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161418">t</span><span class="op" id="8161419">.</span><span class="ident" id="8161420">Fatalf</span><span class="op" id="8161426">(</span><span class="string" id="8161427">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8161457">,</span>&nbsp;<span class="ident" id="8161459">err</span><span class="op" id="8161462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8161465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8161468">if</span>&nbsp;<span class="ident" id="8161471">from</span>&nbsp;<span class="op" id="8161476">!=</span>&nbsp;<span class="ident" id="8161479">nil</span>&nbsp;<span class="op" id="8161483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161487">t</span><span class="op" id="8161488">.</span><span class="ident" id="8161489">Fatalf</span><span class="op" id="8161495">(</span><span class="string" id="8161496">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="8161520">,</span>&nbsp;<span class="ident" id="8161522">from</span><span class="op" id="8161526">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8161529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8161532">if</span>&nbsp;<span class="op" id="8161535">!</span><span class="ident" id="8161536">bytes</span><span class="op" id="8161541">.</span><span class="ident" id="8161542">Equal</span><span class="op" id="8161547">(</span><span class="ident" id="8161548">b</span><span class="op" id="8161549">[</span><span class="op" id="8161550">:</span><span class="ident" id="8161551">n</span><span class="op" id="8161552">]</span><span class="op" id="8161553">,</span>&nbsp;<span class="ident" id="8161555">data</span><span class="op" id="8161559">[</span><span class="op" id="8161560">:</span><span class="op" id="8161561">]</span><span class="op" id="8161562">)</span>&nbsp;<span class="op" id="8161564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161568">t</span><span class="op" id="8161569">.</span><span class="ident" id="8161570">Fatalf</span><span class="op" id="8161576">(</span><span class="string" id="8161577">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8161594">,</span>&nbsp;<span class="ident" id="8161596">b</span><span class="op" id="8161597">[</span><span class="op" id="8161598">:</span><span class="ident" id="8161599">n</span><span class="op" id="8161600">]</span><span class="op" id="8161601">,</span>&nbsp;<span class="ident" id="8161603">data</span><span class="op" id="8161607">[</span><span class="op" id="8161608">:</span><span class="op" id="8161609">]</span><span class="op" id="8161610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8161613">}</span><br>
<span class="lineno"></span><span class="op" id="8161615">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8161618">func</span>&nbsp;<span class="ident" id="8161623">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="8161658">(</span><span class="ident" id="8161659">t</span>&nbsp;<span class="op" id="8161661">*</span><span class="ident" id="8161662">testing</span><span class="op" id="8161669">.</span><span class="ident" id="8161670">T</span><span class="op" id="8161671">)</span>&nbsp;<span class="op" id="8161673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8161676">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8161733">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161799">addr</span>&nbsp;<span class="op" id="8161804">:=</span>&nbsp;<span class="ident" id="8161807">testUnixAddr</span><span class="op" id="8161819">(</span><span class="op" id="8161820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161823">la</span><span class="op" id="8161825">,</span>&nbsp;<span class="ident" id="8161827">err</span>&nbsp;<span class="op" id="8161831">:=</span>&nbsp;<span class="ident" id="8161834">ResolveUnixAddr</span><span class="op" id="8161849">(</span><span class="string" id="8161850">&#34;unixgram&#34;</span><span class="op" id="8161860">,</span>&nbsp;<span class="ident" id="8161862">addr</span><span class="op" id="8161866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8161869">if</span>&nbsp;<span class="ident" id="8161872">err</span>&nbsp;<span class="op" id="8161876">!=</span>&nbsp;<span class="ident" id="8161879">nil</span>&nbsp;<span class="op" id="8161883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161887">t</span><span class="op" id="8161888">.</span><span class="ident" id="8161889">Fatalf</span><span class="op" id="8161895">(</span><span class="string" id="8161896">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8161924">,</span>&nbsp;<span class="ident" id="8161926">err</span><span class="op" id="8161929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8161932">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161935">c</span><span class="op" id="8161936">,</span>&nbsp;<span class="ident" id="8161938">err</span>&nbsp;<span class="op" id="8161942">:=</span>&nbsp;<span class="ident" id="8161945">ListenUnixgram</span><span class="op" id="8161959">(</span><span class="string" id="8161960">&#34;unixgram&#34;</span><span class="op" id="8161970">,</span>&nbsp;<span class="ident" id="8161972">la</span><span class="op" id="8161974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8161977">if</span>&nbsp;<span class="ident" id="8161980">err</span>&nbsp;<span class="op" id="8161984">!=</span>&nbsp;<span class="ident" id="8161987">nil</span>&nbsp;<span class="op" id="8161991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161995">t</span><span class="op" id="8161996">.</span><span class="ident" id="8161997">Fatalf</span><span class="op" id="8162003">(</span><span class="string" id="8162004">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8162031">,</span>&nbsp;<span class="ident" id="8162033">err</span><span class="op" id="8162036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8162039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162042">defer</span>&nbsp;<span class="keyword" id="8162048">func</span><span class="op" id="8162052">(</span><span class="op" id="8162053">)</span>&nbsp;<span class="op" id="8162055">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162059">c</span><span class="op" id="8162060">.</span><span class="ident" id="8162061">Close</span><span class="op" id="8162066">(</span><span class="op" id="8162067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162071">os</span><span class="op" id="8162073">.</span><span class="ident" id="8162074">Remove</span><span class="op" id="8162080">(</span><span class="ident" id="8162081">addr</span><span class="op" id="8162085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8162088">}</span><span class="op" id="8162089">(</span><span class="op" id="8162090">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162094">off</span>&nbsp;<span class="op" id="8162098">:=</span>&nbsp;<span class="builtinfunc" id="8162101">make</span><span class="op" id="8162105">(</span><span class="keyword" id="8162106">chan</span>&nbsp;<span class="builtintype" id="8162111">bool</span><span class="op" id="8162115">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162118">go</span>&nbsp;<span class="keyword" id="8162121">func</span><span class="op" id="8162125">(</span><span class="op" id="8162126">)</span>&nbsp;<span class="op" id="8162128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162132">defer</span>&nbsp;<span class="keyword" id="8162138">func</span><span class="op" id="8162142">(</span><span class="op" id="8162143">)</span>&nbsp;<span class="op" id="8162145">{</span>&nbsp;<span class="ident" id="8162147">off</span>&nbsp;<span class="op" id="8162151">&lt;-</span>&nbsp;<span class="builtintype" id="8162154">true</span>&nbsp;<span class="op" id="8162159">}</span><span class="op" id="8162160">(</span><span class="op" id="8162161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162165">c</span><span class="op" id="8162166">,</span>&nbsp;<span class="ident" id="8162168">err</span>&nbsp;<span class="op" id="8162172">:=</span>&nbsp;<span class="ident" id="8162175">DialUnix</span><span class="op" id="8162183">(</span><span class="string" id="8162184">&#34;unixgram&#34;</span><span class="op" id="8162194">,</span>&nbsp;<span class="ident" id="8162196">nil</span><span class="op" id="8162199">,</span>&nbsp;<span class="ident" id="8162201">la</span><span class="op" id="8162203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162207">if</span>&nbsp;<span class="ident" id="8162210">err</span>&nbsp;<span class="op" id="8162214">!=</span>&nbsp;<span class="ident" id="8162217">nil</span>&nbsp;<span class="op" id="8162221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162226">t</span><span class="op" id="8162227">.</span><span class="ident" id="8162228">Errorf</span><span class="op" id="8162234">(</span><span class="string" id="8162235">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8162256">,</span>&nbsp;<span class="ident" id="8162258">err</span><span class="op" id="8162261">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162266">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8162275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162279">defer</span>&nbsp;<span class="ident" id="8162285">c</span><span class="op" id="8162286">.</span><span class="ident" id="8162287">Close</span><span class="op" id="8162292">(</span><span class="op" id="8162293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162297">if</span>&nbsp;<span class="ident" id="8162300">_</span><span class="op" id="8162301">,</span>&nbsp;<span class="ident" id="8162303">err</span>&nbsp;<span class="op" id="8162307">:=</span>&nbsp;<span class="ident" id="8162310">c</span><span class="op" id="8162311">.</span><span class="ident" id="8162312">Write</span><span class="op" id="8162317">(</span><span class="op" id="8162318">[</span><span class="op" id="8162319">]</span><span class="builtintype" id="8162320">byte</span><span class="op" id="8162324">{</span><span class="num" id="8162325">1</span><span class="op" id="8162326">,</span>&nbsp;<span class="num" id="8162328">2</span><span class="op" id="8162329">,</span>&nbsp;<span class="num" id="8162331">3</span><span class="op" id="8162332">,</span>&nbsp;<span class="num" id="8162334">4</span><span class="op" id="8162335">,</span>&nbsp;<span class="num" id="8162337">5</span><span class="op" id="8162338">}</span><span class="op" id="8162339">)</span><span class="op" id="8162340">;</span>&nbsp;<span class="ident" id="8162342">err</span>&nbsp;<span class="op" id="8162346">!=</span>&nbsp;<span class="ident" id="8162349">nil</span>&nbsp;<span class="op" id="8162353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162358">t</span><span class="op" id="8162359">.</span><span class="ident" id="8162360">Errorf</span><span class="op" id="8162366">(</span><span class="string" id="8162367">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8162394">,</span>&nbsp;<span class="ident" id="8162396">err</span><span class="op" id="8162399">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162404">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8162413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8162416">}</span><span class="op" id="8162417">(</span><span class="op" id="8162418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8162422">&lt;-</span><span class="ident" id="8162424">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162429">c</span><span class="op" id="8162430">.</span><span class="ident" id="8162431">SetReadDeadline</span><span class="op" id="8162446">(</span><span class="ident" id="8162447">time</span><span class="op" id="8162451">.</span><span class="ident" id="8162452">Now</span><span class="op" id="8162455">(</span><span class="op" id="8162456">)</span><span class="op" id="8162457">.</span><span class="ident" id="8162458">Add</span><span class="op" id="8162461">(</span><span class="num" id="8162462">100</span>&nbsp;<span class="op" id="8162466">*</span>&nbsp;<span class="ident" id="8162468">time</span><span class="op" id="8162472">.</span><span class="ident" id="8162473">Millisecond</span><span class="op" id="8162484">)</span><span class="op" id="8162485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162488">_</span><span class="op" id="8162489">,</span>&nbsp;<span class="ident" id="8162491">from</span><span class="op" id="8162495">,</span>&nbsp;<span class="ident" id="8162497">err</span>&nbsp;<span class="op" id="8162501">:=</span>&nbsp;<span class="ident" id="8162504">c</span><span class="op" id="8162505">.</span><span class="ident" id="8162506">ReadFrom</span><span class="op" id="8162514">(</span><span class="ident" id="8162515">nil</span><span class="op" id="8162518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162521">if</span>&nbsp;<span class="ident" id="8162524">err</span>&nbsp;<span class="op" id="8162528">!=</span>&nbsp;<span class="ident" id="8162531">nil</span>&nbsp;<span class="op" id="8162535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162539">t</span><span class="op" id="8162540">.</span><span class="ident" id="8162541">Fatalf</span><span class="op" id="8162547">(</span><span class="string" id="8162548">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8162578">,</span>&nbsp;<span class="ident" id="8162580">err</span><span class="op" id="8162583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8162586">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162589">if</span>&nbsp;<span class="ident" id="8162592">from</span>&nbsp;<span class="op" id="8162597">!=</span>&nbsp;<span class="ident" id="8162600">nil</span>&nbsp;<span class="op" id="8162604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162608">t</span><span class="op" id="8162609">.</span><span class="ident" id="8162610">Fatalf</span><span class="op" id="8162616">(</span><span class="string" id="8162617">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="8162641">,</span>&nbsp;<span class="ident" id="8162643">from</span><span class="op" id="8162647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8162650">}</span><br>
<span class="lineno"></span><span class="op" id="8162652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8162655">func</span>&nbsp;<span class="ident" id="8162660">TestUnixgramAutobind</span><span class="op" id="8162680">(</span><span class="ident" id="8162681">t</span>&nbsp;<span class="op" id="8162683">*</span><span class="ident" id="8162684">testing</span><span class="op" id="8162691">.</span><span class="ident" id="8162692">T</span><span class="op" id="8162693">)</span>&nbsp;<span class="op" id="8162695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162698">if</span>&nbsp;<span class="ident" id="8162701">runtime</span><span class="op" id="8162708">.</span><span class="ident" id="8162709">GOOS</span>&nbsp;<span class="op" id="8162714">!=</span>&nbsp;<span class="string" id="8162717">&#34;linux&#34;</span>&nbsp;<span class="op" id="8162725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162729">t</span><span class="op" id="8162730">.</span><span class="ident" id="8162731">Skip</span><span class="op" id="8162735">(</span><span class="string" id="8162736">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="8162770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8162773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162777">laddr</span>&nbsp;<span class="op" id="8162783">:=</span>&nbsp;<span class="op" id="8162786">&amp;</span><span class="ident" id="8162787">UnixAddr</span><span class="op" id="8162795">{</span><span class="ident" id="8162796">Name</span><span class="op" id="8162800">:</span>&nbsp;<span class="string" id="8162802">&#34;&#34;</span><span class="op" id="8162804">,</span>&nbsp;<span class="ident" id="8162806">Net</span><span class="op" id="8162809">:</span>&nbsp;<span class="string" id="8162811">&#34;unixgram&#34;</span><span class="op" id="8162821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162824">c1</span><span class="op" id="8162826">,</span>&nbsp;<span class="ident" id="8162828">err</span>&nbsp;<span class="op" id="8162832">:=</span>&nbsp;<span class="ident" id="8162835">ListenUnixgram</span><span class="op" id="8162849">(</span><span class="string" id="8162850">&#34;unixgram&#34;</span><span class="op" id="8162860">,</span>&nbsp;<span class="ident" id="8162862">laddr</span><span class="op" id="8162867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162870">if</span>&nbsp;<span class="ident" id="8162873">err</span>&nbsp;<span class="op" id="8162877">!=</span>&nbsp;<span class="ident" id="8162880">nil</span>&nbsp;<span class="op" id="8162884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162888">t</span><span class="op" id="8162889">.</span><span class="ident" id="8162890">Fatalf</span><span class="op" id="8162896">(</span><span class="string" id="8162897">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8162924">,</span>&nbsp;<span class="ident" id="8162926">err</span><span class="op" id="8162929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8162932">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8162935">defer</span>&nbsp;<span class="ident" id="8162941">c1</span><span class="op" id="8162943">.</span><span class="ident" id="8162944">Close</span><span class="op" id="8162949">(</span><span class="op" id="8162950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8162954">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162988">autoAddr</span>&nbsp;<span class="op" id="8162997">:=</span>&nbsp;<span class="ident" id="8163000">c1</span><span class="op" id="8163002">.</span><span class="ident" id="8163003">LocalAddr</span><span class="op" id="8163012">(</span><span class="op" id="8163013">)</span><span class="op" id="8163014">.</span><span class="op" id="8163015">(</span><span class="op" id="8163016">*</span><span class="ident" id="8163017">UnixAddr</span><span class="op" id="8163025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8163028">if</span>&nbsp;<span class="builtinfunc" id="8163031">len</span><span class="op" id="8163034">(</span><span class="ident" id="8163035">autoAddr</span><span class="op" id="8163043">.</span><span class="ident" id="8163044">Name</span><span class="op" id="8163048">)</span>&nbsp;<span class="op" id="8163050">&lt;=</span>&nbsp;<span class="num" id="8163053">1</span>&nbsp;<span class="op" id="8163055">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163059">t</span><span class="op" id="8163060">.</span><span class="ident" id="8163061">Fatalf</span><span class="op" id="8163067">(</span><span class="string" id="8163068">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="8163098">,</span>&nbsp;<span class="ident" id="8163100">autoAddr</span><span class="op" id="8163108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8163111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8163114">if</span>&nbsp;<span class="ident" id="8163117">autoAddr</span><span class="op" id="8163125">.</span><span class="ident" id="8163126">Name</span><span class="op" id="8163130">[</span><span class="num" id="8163131">0</span><span class="op" id="8163132">]</span>&nbsp;<span class="op" id="8163134">!=</span>&nbsp;<span class="string" id="8163137">&#39;@&#39;</span>&nbsp;<span class="op" id="8163141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163145">t</span><span class="op" id="8163146">.</span><span class="ident" id="8163147">Fatalf</span><span class="op" id="8163153">(</span><span class="string" id="8163154">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="8163184">,</span>&nbsp;<span class="ident" id="8163186">autoAddr</span><span class="op" id="8163194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8163197">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163201">c2</span><span class="op" id="8163203">,</span>&nbsp;<span class="ident" id="8163205">err</span>&nbsp;<span class="op" id="8163209">:=</span>&nbsp;<span class="ident" id="8163212">DialUnix</span><span class="op" id="8163220">(</span><span class="string" id="8163221">&#34;unixgram&#34;</span><span class="op" id="8163231">,</span>&nbsp;<span class="ident" id="8163233">nil</span><span class="op" id="8163236">,</span>&nbsp;<span class="ident" id="8163238">autoAddr</span><span class="op" id="8163246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8163249">if</span>&nbsp;<span class="ident" id="8163252">err</span>&nbsp;<span class="op" id="8163256">!=</span>&nbsp;<span class="ident" id="8163259">nil</span>&nbsp;<span class="op" id="8163263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163267">t</span><span class="op" id="8163268">.</span><span class="ident" id="8163269">Fatalf</span><span class="op" id="8163275">(</span><span class="string" id="8163276">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8163297">,</span>&nbsp;<span class="ident" id="8163299">err</span><span class="op" id="8163302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8163305">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8163308">defer</span>&nbsp;<span class="ident" id="8163314">c2</span><span class="op" id="8163316">.</span><span class="ident" id="8163317">Close</span><span class="op" id="8163322">(</span><span class="op" id="8163323">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8163327">if</span>&nbsp;<span class="op" id="8163330">!</span><span class="ident" id="8163331">reflect</span><span class="op" id="8163338">.</span><span class="ident" id="8163339">DeepEqual</span><span class="op" id="8163348">(</span><span class="ident" id="8163349">c1</span><span class="op" id="8163351">.</span><span class="ident" id="8163352">LocalAddr</span><span class="op" id="8163361">(</span><span class="op" id="8163362">)</span><span class="op" id="8163363">,</span>&nbsp;<span class="ident" id="8163365">c2</span><span class="op" id="8163367">.</span><span class="ident" id="8163368">RemoteAddr</span><span class="op" id="8163378">(</span><span class="op" id="8163379">)</span><span class="op" id="8163380">)</span>&nbsp;<span class="op" id="8163382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163386">t</span><span class="op" id="8163387">.</span><span class="ident" id="8163388">Fatalf</span><span class="op" id="8163394">(</span><span class="string" id="8163395">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8163433">,</span>&nbsp;<span class="ident" id="8163435">c1</span><span class="op" id="8163437">.</span><span class="ident" id="8163438">LocalAddr</span><span class="op" id="8163447">(</span><span class="op" id="8163448">)</span><span class="op" id="8163449">,</span>&nbsp;<span class="ident" id="8163451">c2</span><span class="op" id="8163453">.</span><span class="ident" id="8163454">RemoteAddr</span><span class="op" id="8163464">(</span><span class="op" id="8163465">)</span><span class="op" id="8163466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8163469">}</span><br>
<span class="lineno">140</span><span class="op" id="8163471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8163474">func</span>&nbsp;<span class="ident" id="8163479">TestUnixAutobindClose</span><span class="op" id="8163500">(</span><span class="ident" id="8163501">t</span>&nbsp;<span class="op" id="8163503">*</span><span class="ident" id="8163504">testing</span><span class="op" id="8163511">.</span><span class="ident" id="8163512">T</span><span class="op" id="8163513">)</span>&nbsp;<span class="op" id="8163515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8163518">if</span>&nbsp;<span class="ident" id="8163521">runtime</span><span class="op" id="8163528">.</span><span class="ident" id="8163529">GOOS</span>&nbsp;<span class="op" id="8163534">!=</span>&nbsp;<span class="string" id="8163537">&#34;linux&#34;</span>&nbsp;<span class="op" id="8163545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163549">t</span><span class="op" id="8163550">.</span><span class="ident" id="8163551">Skip</span><span class="op" id="8163555">(</span><span class="string" id="8163556">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="8163590">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8163593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163596">laddr</span>&nbsp;<span class="op" id="8163602">:=</span>&nbsp;<span class="op" id="8163605">&amp;</span><span class="ident" id="8163606">UnixAddr</span><span class="op" id="8163614">{</span><span class="ident" id="8163615">Name</span><span class="op" id="8163619">:</span>&nbsp;<span class="string" id="8163621">&#34;&#34;</span><span class="op" id="8163623">,</span>&nbsp;<span class="ident" id="8163625">Net</span><span class="op" id="8163628">:</span>&nbsp;<span class="string" id="8163630">&#34;unix&#34;</span><span class="op" id="8163636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163639">ln</span><span class="op" id="8163641">,</span>&nbsp;<span class="ident" id="8163643">err</span>&nbsp;<span class="op" id="8163647">:=</span>&nbsp;<span class="ident" id="8163650">ListenUnix</span><span class="op" id="8163660">(</span><span class="string" id="8163661">&#34;unix&#34;</span><span class="op" id="8163667">,</span>&nbsp;<span class="ident" id="8163669">laddr</span><span class="op" id="8163674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8163677">if</span>&nbsp;<span class="ident" id="8163680">err</span>&nbsp;<span class="op" id="8163684">!=</span>&nbsp;<span class="ident" id="8163687">nil</span>&nbsp;<span class="op" id="8163691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163695">t</span><span class="op" id="8163696">.</span><span class="ident" id="8163697">Fatalf</span><span class="op" id="8163703">(</span><span class="string" id="8163704">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8163727">,</span>&nbsp;<span class="ident" id="8163729">err</span><span class="op" id="8163732">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8163735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163738">ln</span><span class="op" id="8163740">.</span><span class="ident" id="8163741">Close</span><span class="op" id="8163746">(</span><span class="op" id="8163747">)</span><br>
<span class="lineno"></span><span class="op" id="8163749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8163752">func</span>&nbsp;<span class="ident" id="8163757">TestUnixgramWrite</span><span class="op" id="8163774">(</span><span class="ident" id="8163775">t</span>&nbsp;<span class="op" id="8163777">*</span><span class="ident" id="8163778">testing</span><span class="op" id="8163785">.</span><span class="ident" id="8163786">T</span><span class="op" id="8163787">)</span>&nbsp;<span class="op" id="8163789">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163792">addr</span>&nbsp;<span class="op" id="8163797">:=</span>&nbsp;<span class="ident" id="8163800">testUnixAddr</span><span class="op" id="8163812">(</span><span class="op" id="8163813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163816">laddr</span><span class="op" id="8163821">,</span>&nbsp;<span class="ident" id="8163823">err</span>&nbsp;<span class="op" id="8163827">:=</span>&nbsp;<span class="ident" id="8163830">ResolveUnixAddr</span><span class="op" id="8163845">(</span><span class="string" id="8163846">&#34;unixgram&#34;</span><span class="op" id="8163856">,</span>&nbsp;<span class="ident" id="8163858">addr</span><span class="op" id="8163862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8163865">if</span>&nbsp;<span class="ident" id="8163868">err</span>&nbsp;<span class="op" id="8163872">!=</span>&nbsp;<span class="ident" id="8163875">nil</span>&nbsp;<span class="op" id="8163879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163883">t</span><span class="op" id="8163884">.</span><span class="ident" id="8163885">Fatalf</span><span class="op" id="8163891">(</span><span class="string" id="8163892">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8163920">,</span>&nbsp;<span class="ident" id="8163922">err</span><span class="op" id="8163925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8163928">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163931">c</span><span class="op" id="8163932">,</span>&nbsp;<span class="ident" id="8163934">err</span>&nbsp;<span class="op" id="8163938">:=</span>&nbsp;<span class="ident" id="8163941">ListenPacket</span><span class="op" id="8163953">(</span><span class="string" id="8163954">&#34;unixgram&#34;</span><span class="op" id="8163964">,</span>&nbsp;<span class="ident" id="8163966">addr</span><span class="op" id="8163970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8163973">if</span>&nbsp;<span class="ident" id="8163976">err</span>&nbsp;<span class="op" id="8163980">!=</span>&nbsp;<span class="ident" id="8163983">nil</span>&nbsp;<span class="op" id="8163987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163991">t</span><span class="op" id="8163992">.</span><span class="ident" id="8163993">Fatalf</span><span class="op" id="8163999">(</span><span class="string" id="8164000">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8164025">,</span>&nbsp;<span class="ident" id="8164027">err</span><span class="op" id="8164030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8164033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8164036">defer</span>&nbsp;<span class="ident" id="8164042">os</span><span class="op" id="8164044">.</span><span class="ident" id="8164045">Remove</span><span class="op" id="8164051">(</span><span class="ident" id="8164052">addr</span><span class="op" id="8164056">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8164059">defer</span>&nbsp;<span class="ident" id="8164065">c</span><span class="op" id="8164066">.</span><span class="ident" id="8164067">Close</span><span class="op" id="8164072">(</span><span class="op" id="8164073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8164077">testUnixgramWriteConn</span><span class="op" id="8164098">(</span><span class="ident" id="8164099">t</span><span class="op" id="8164100">,</span>&nbsp;<span class="ident" id="8164102">laddr</span><span class="op" id="8164107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8164110">testUnixgramWritePacketConn</span><span class="op" id="8164137">(</span><span class="ident" id="8164138">t</span><span class="op" id="8164139">,</span>&nbsp;<span class="ident" id="8164141">laddr</span><span class="op" id="8164146">)</span><br>
<span class="lineno"></span><span class="op" id="8164148">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="8164151">func</span>&nbsp;<span class="ident" id="8164156">testUnixgramWriteConn</span><span class="op" id="8164177">(</span><span class="ident" id="8164178">t</span>&nbsp;<span class="op" id="8164180">*</span><span class="ident" id="8164181">testing</span><span class="op" id="8164188">.</span><span class="ident" id="8164189">T</span><span class="op" id="8164190">,</span>&nbsp;<span class="ident" id="8164192">raddr</span>&nbsp;<span class="op" id="8164198">*</span><span class="ident" id="8164199">UnixAddr</span><span class="op" id="8164207">)</span>&nbsp;<span class="op" id="8164209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8164212">c</span><span class="op" id="8164213">,</span>&nbsp;<span class="ident" id="8164215">err</span>&nbsp;<span class="op" id="8164219">:=</span>&nbsp;<span class="ident" id="8164222">Dial</span><span class="op" id="8164226">(</span><span class="string" id="8164227">&#34;unixgram&#34;</span><span class="op" id="8164237">,</span>&nbsp;<span class="ident" id="8164239">raddr</span><span class="op" id="8164244">.</span><span class="ident" id="8164245">String</span><span class="op" id="8164251">(</span><span class="op" id="8164252">)</span><span class="op" id="8164253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8164256">if</span>&nbsp;<span class="ident" id="8164259">err</span>&nbsp;<span class="op" id="8164263">!=</span>&nbsp;<span class="ident" id="8164266">nil</span>&nbsp;<span class="op" id="8164270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8164274">t</span><span class="op" id="8164275">.</span><span class="ident" id="8164276">Fatalf</span><span class="op" id="8164282">(</span><span class="string" id="8164283">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8164300">,</span>&nbsp;<span class="ident" id="8164302">err</span><span class="op" id="8164305">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8164308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8164311">defer</span>&nbsp;<span class="ident" id="8164317">c</span><span class="op" id="8164318">.</span><span class="ident" id="8164319">Close</span><span class="op" id="8164324">(</span><span class="op" id="8164325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8164329">if</span>&nbsp;<span class="ident" id="8164332">_</span><span class="op" id="8164333">,</span>&nbsp;<span class="ident" id="8164335">err</span>&nbsp;<span class="op" id="8164339">:=</span>&nbsp;<span class="ident" id="8164342">c</span><span class="op" id="8164343">.</span><span class="op" id="8164344">(</span><span class="op" id="8164345">*</span><span class="ident" id="8164346">UnixConn</span><span class="op" id="8164354">)</span><span class="op" id="8164355">.</span><span class="ident" id="8164356">WriteToUnix</span><span class="op" id="8164367">(</span><span class="op" id="8164368">[</span><span class="op" id="8164369">]</span><span class="builtintype" id="8164370">byte</span><span class="op" id="8164374">(</span><span class="string" id="8164375">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8164408">)</span><span class="op" id="8164409">,</span>&nbsp;<span class="ident" id="8164411">raddr</span><span class="op" id="8164416">)</span><span class="op" id="8164417">;</span>&nbsp;<span class="ident" id="8164419">err</span>&nbsp;<span class="op" id="8164423">==</span>&nbsp;<span class="ident" id="8164426">nil</span>&nbsp;<span class="op" id="8164430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8164434">t</span><span class="op" id="8164435">.</span><span class="ident" id="8164436">Fatal</span><span class="op" id="8164441">(</span><span class="string" id="8164442">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8164467">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8164470">}</span>&nbsp;<span class="keyword" id="8164472">else</span>&nbsp;<span class="keyword" id="8164477">if</span>&nbsp;<span class="ident" id="8164480">err</span><span class="op" id="8164483">.</span><span class="op" id="8164484">(</span><span class="op" id="8164485">*</span><span class="ident" id="8164486">OpError</span><span class="op" id="8164493">)</span><span class="op" id="8164494">.</span><span class="ident" id="8164495">Err</span>&nbsp;<span class="op" id="8164499">!=</span>&nbsp;<span class="ident" id="8164502">ErrWriteToConnected</span>&nbsp;<span class="op" id="8164522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8164526">t</span><span class="op" id="8164527">.</span><span class="ident" id="8164528">Fatalf</span><span class="op" id="8164534">(</span><span class="string" id="8164535">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8164587">,</span>&nbsp;<span class="ident" id="8164589">err</span><span class="op" id="8164592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8164595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8164598">if</span>&nbsp;<span class="ident" id="8164601">_</span><span class="op" id="8164602">,</span>&nbsp;<span class="ident" id="8164604">err</span>&nbsp;<span class="op" id="8164608">=</span>&nbsp;<span class="ident" id="8164610">c</span><span class="op" id="8164611">.</span><span class="op" id="8164612">(</span><span class="op" id="8164613">*</span><span class="ident" id="8164614">UnixConn</span><span class="op" id="8164622">)</span><span class="op" id="8164623">.</span><span class="ident" id="8164624">WriteTo</span><span class="op" id="8164631">(</span><span class="op" id="8164632">[</span><span class="op" id="8164633">]</span><span class="builtintype" id="8164634">byte</span><span class="op" id="8164638">(</span><span class="string" id="8164639">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8164672">)</span><span class="op" id="8164673">,</span>&nbsp;<span class="ident" id="8164675">raddr</span><span class="op" id="8164680">)</span><span class="op" id="8164681">;</span>&nbsp;<span class="ident" id="8164683">err</span>&nbsp;<span class="op" id="8164687">==</span>&nbsp;<span class="ident" id="8164690">nil</span>&nbsp;<span class="op" id="8164694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8164698">t</span><span class="op" id="8164699">.</span><span class="ident" id="8164700">Fatal</span><span class="op" id="8164705">(</span><span class="string" id="8164706">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8164727">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8164730">}</span>&nbsp;<span class="keyword" id="8164732">else</span>&nbsp;<span class="keyword" id="8164737">if</span>&nbsp;<span class="ident" id="8164740">err</span><span class="op" id="8164743">.</span><span class="op" id="8164744">(</span><span class="op" id="8164745">*</span><span class="ident" id="8164746">OpError</span><span class="op" id="8164753">)</span><span class="op" id="8164754">.</span><span class="ident" id="8164755">Err</span>&nbsp;<span class="op" id="8164759">!=</span>&nbsp;<span class="ident" id="8164762">ErrWriteToConnected</span>&nbsp;<span class="op" id="8164782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8164786">t</span><span class="op" id="8164787">.</span><span class="ident" id="8164788">Fatalf</span><span class="op" id="8164794">(</span><span class="string" id="8164795">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8164843">,</span>&nbsp;<span class="ident" id="8164845">err</span><span class="op" id="8164848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8164851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8164854">if</span>&nbsp;<span class="ident" id="8164857">_</span><span class="op" id="8164858">,</span>&nbsp;<span class="ident" id="8164860">_</span><span class="op" id="8164861">,</span>&nbsp;<span class="ident" id="8164863">err</span>&nbsp;<span class="op" id="8164867">=</span>&nbsp;<span class="ident" id="8164869">c</span><span class="op" id="8164870">.</span><span class="op" id="8164871">(</span><span class="op" id="8164872">*</span><span class="ident" id="8164873">UnixConn</span><span class="op" id="8164881">)</span><span class="op" id="8164882">.</span><span class="ident" id="8164883">WriteMsgUnix</span><span class="op" id="8164895">(</span><span class="op" id="8164896">[</span><span class="op" id="8164897">]</span><span class="builtintype" id="8164898">byte</span><span class="op" id="8164902">(</span><span class="string" id="8164903">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8164936">)</span><span class="op" id="8164937">,</span>&nbsp;<span class="ident" id="8164939">nil</span><span class="op" id="8164942">,</span>&nbsp;<span class="ident" id="8164944">raddr</span><span class="op" id="8164949">)</span><span class="op" id="8164950">;</span>&nbsp;<span class="ident" id="8164952">err</span>&nbsp;<span class="op" id="8164956">==</span>&nbsp;<span class="ident" id="8164959">nil</span>&nbsp;<span class="op" id="8164963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8164967">t</span><span class="op" id="8164968">.</span><span class="ident" id="8164969">Fatal</span><span class="op" id="8164974">(</span><span class="string" id="8164975">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8164996">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8164999">}</span>&nbsp;<span class="keyword" id="8165001">else</span>&nbsp;<span class="keyword" id="8165006">if</span>&nbsp;<span class="ident" id="8165009">err</span><span class="op" id="8165012">.</span><span class="op" id="8165013">(</span><span class="op" id="8165014">*</span><span class="ident" id="8165015">OpError</span><span class="op" id="8165022">)</span><span class="op" id="8165023">.</span><span class="ident" id="8165024">Err</span>&nbsp;<span class="op" id="8165028">!=</span>&nbsp;<span class="ident" id="8165031">ErrWriteToConnected</span>&nbsp;<span class="op" id="8165051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8165055">t</span><span class="op" id="8165056">.</span><span class="ident" id="8165057">Fatalf</span><span class="op" id="8165063">(</span><span class="string" id="8165064">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8165117">,</span>&nbsp;<span class="ident" id="8165119">err</span><span class="op" id="8165122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8165125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8165128">if</span>&nbsp;<span class="ident" id="8165131">_</span><span class="op" id="8165132">,</span>&nbsp;<span class="ident" id="8165134">err</span>&nbsp;<span class="op" id="8165138">:=</span>&nbsp;<span class="ident" id="8165141">c</span><span class="op" id="8165142">.</span><span class="ident" id="8165143">Write</span><span class="op" id="8165148">(</span><span class="op" id="8165149">[</span><span class="op" id="8165150">]</span><span class="builtintype" id="8165151">byte</span><span class="op" id="8165155">(</span><span class="string" id="8165156">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8165189">)</span><span class="op" id="8165190">)</span><span class="op" id="8165191">;</span>&nbsp;<span class="ident" id="8165193">err</span>&nbsp;<span class="op" id="8165197">!=</span>&nbsp;<span class="ident" id="8165200">nil</span>&nbsp;<span class="op" id="8165204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8165208">t</span><span class="op" id="8165209">.</span><span class="ident" id="8165210">Fatalf</span><span class="op" id="8165216">(</span><span class="string" id="8165217">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8165235">,</span>&nbsp;<span class="ident" id="8165237">err</span><span class="op" id="8165240">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8165243">}</span><br>
<span class="lineno"></span><span class="op" id="8165245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8165248">func</span>&nbsp;<span class="ident" id="8165253">testUnixgramWritePacketConn</span><span class="op" id="8165280">(</span><span class="ident" id="8165281">t</span>&nbsp;<span class="op" id="8165283">*</span><span class="ident" id="8165284">testing</span><span class="op" id="8165291">.</span><span class="ident" id="8165292">T</span><span class="op" id="8165293">,</span>&nbsp;<span class="ident" id="8165295">raddr</span>&nbsp;<span class="op" id="8165301">*</span><span class="ident" id="8165302">UnixAddr</span><span class="op" id="8165310">)</span>&nbsp;<span class="op" id="8165312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8165315">addr</span>&nbsp;<span class="op" id="8165320">:=</span>&nbsp;<span class="ident" id="8165323">testUnixAddr</span><span class="op" id="8165335">(</span><span class="op" id="8165336">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8165339">c</span><span class="op" id="8165340">,</span>&nbsp;<span class="ident" id="8165342">err</span>&nbsp;<span class="op" id="8165346">:=</span>&nbsp;<span class="ident" id="8165349">ListenPacket</span><span class="op" id="8165361">(</span><span class="string" id="8165362">&#34;unixgram&#34;</span><span class="op" id="8165372">,</span>&nbsp;<span class="ident" id="8165374">addr</span><span class="op" id="8165378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8165381">if</span>&nbsp;<span class="ident" id="8165384">err</span>&nbsp;<span class="op" id="8165388">!=</span>&nbsp;<span class="ident" id="8165391">nil</span>&nbsp;<span class="op" id="8165395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8165399">t</span><span class="op" id="8165400">.</span><span class="ident" id="8165401">Fatalf</span><span class="op" id="8165407">(</span><span class="string" id="8165408">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8165433">,</span>&nbsp;<span class="ident" id="8165435">err</span><span class="op" id="8165438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8165441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8165444">defer</span>&nbsp;<span class="ident" id="8165450">os</span><span class="op" id="8165452">.</span><span class="ident" id="8165453">Remove</span><span class="op" id="8165459">(</span><span class="ident" id="8165460">addr</span><span class="op" id="8165464">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8165467">defer</span>&nbsp;<span class="ident" id="8165473">c</span><span class="op" id="8165474">.</span><span class="ident" id="8165475">Close</span><span class="op" id="8165480">(</span><span class="op" id="8165481">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8165485">if</span>&nbsp;<span class="ident" id="8165488">_</span><span class="op" id="8165489">,</span>&nbsp;<span class="ident" id="8165491">err</span>&nbsp;<span class="op" id="8165495">:=</span>&nbsp;<span class="ident" id="8165498">c</span><span class="op" id="8165499">.</span><span class="op" id="8165500">(</span><span class="op" id="8165501">*</span><span class="ident" id="8165502">UnixConn</span><span class="op" id="8165510">)</span><span class="op" id="8165511">.</span><span class="ident" id="8165512">WriteToUnix</span><span class="op" id="8165523">(</span><span class="op" id="8165524">[</span><span class="op" id="8165525">]</span><span class="builtintype" id="8165526">byte</span><span class="op" id="8165530">(</span><span class="string" id="8165531">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8165559">)</span><span class="op" id="8165560">,</span>&nbsp;<span class="ident" id="8165562">raddr</span><span class="op" id="8165567">)</span><span class="op" id="8165568">;</span>&nbsp;<span class="ident" id="8165570">err</span>&nbsp;<span class="op" id="8165574">!=</span>&nbsp;<span class="ident" id="8165577">nil</span>&nbsp;<span class="op" id="8165581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8165585">t</span><span class="op" id="8165586">.</span><span class="ident" id="8165587">Fatalf</span><span class="op" id="8165593">(</span><span class="string" id="8165594">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8165618">,</span>&nbsp;<span class="ident" id="8165620">err</span><span class="op" id="8165623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8165626">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8165629">if</span>&nbsp;<span class="ident" id="8165632">_</span><span class="op" id="8165633">,</span>&nbsp;<span class="ident" id="8165635">err</span>&nbsp;<span class="op" id="8165639">:=</span>&nbsp;<span class="ident" id="8165642">c</span><span class="op" id="8165643">.</span><span class="ident" id="8165644">WriteTo</span><span class="op" id="8165651">(</span><span class="op" id="8165652">[</span><span class="op" id="8165653">]</span><span class="builtintype" id="8165654">byte</span><span class="op" id="8165658">(</span><span class="string" id="8165659">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8165687">)</span><span class="op" id="8165688">,</span>&nbsp;<span class="ident" id="8165690">raddr</span><span class="op" id="8165695">)</span><span class="op" id="8165696">;</span>&nbsp;<span class="ident" id="8165698">err</span>&nbsp;<span class="op" id="8165702">!=</span>&nbsp;<span class="ident" id="8165705">nil</span>&nbsp;<span class="op" id="8165709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8165713">t</span><span class="op" id="8165714">.</span><span class="ident" id="8165715">Fatalf</span><span class="op" id="8165721">(</span><span class="string" id="8165722">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8165742">,</span>&nbsp;<span class="ident" id="8165744">err</span><span class="op" id="8165747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8165750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8165753">if</span>&nbsp;<span class="ident" id="8165756">_</span><span class="op" id="8165757">,</span>&nbsp;<span class="ident" id="8165759">_</span><span class="op" id="8165760">,</span>&nbsp;<span class="ident" id="8165762">err</span>&nbsp;<span class="op" id="8165766">:=</span>&nbsp;<span class="ident" id="8165769">c</span><span class="op" id="8165770">.</span><span class="op" id="8165771">(</span><span class="op" id="8165772">*</span><span class="ident" id="8165773">UnixConn</span><span class="op" id="8165781">)</span><span class="op" id="8165782">.</span><span class="ident" id="8165783">WriteMsgUnix</span><span class="op" id="8165795">(</span><span class="op" id="8165796">[</span><span class="op" id="8165797">]</span><span class="builtintype" id="8165798">byte</span><span class="op" id="8165802">(</span><span class="string" id="8165803">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8165831">)</span><span class="op" id="8165832">,</span>&nbsp;<span class="ident" id="8165834">nil</span><span class="op" id="8165837">,</span>&nbsp;<span class="ident" id="8165839">raddr</span><span class="op" id="8165844">)</span><span class="op" id="8165845">;</span>&nbsp;<span class="ident" id="8165847">err</span>&nbsp;<span class="op" id="8165851">!=</span>&nbsp;<span class="ident" id="8165854">nil</span>&nbsp;<span class="op" id="8165858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8165862">t</span><span class="op" id="8165863">.</span><span class="ident" id="8165864">Fatalf</span><span class="op" id="8165870">(</span><span class="string" id="8165871">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8165896">,</span>&nbsp;<span class="ident" id="8165898">err</span><span class="op" id="8165901">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8165904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8165907">if</span>&nbsp;<span class="ident" id="8165910">_</span><span class="op" id="8165911">,</span>&nbsp;<span class="ident" id="8165913">err</span>&nbsp;<span class="op" id="8165917">:=</span>&nbsp;<span class="ident" id="8165920">c</span><span class="op" id="8165921">.</span><span class="op" id="8165922">(</span><span class="op" id="8165923">*</span><span class="ident" id="8165924">UnixConn</span><span class="op" id="8165932">)</span><span class="op" id="8165933">.</span><span class="ident" id="8165934">Write</span><span class="op" id="8165939">(</span><span class="op" id="8165940">[</span><span class="op" id="8165941">]</span><span class="builtintype" id="8165942">byte</span><span class="op" id="8165946">(</span><span class="string" id="8165947">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8165975">)</span><span class="op" id="8165976">)</span><span class="op" id="8165977">;</span>&nbsp;<span class="ident" id="8165979">err</span>&nbsp;<span class="op" id="8165983">==</span>&nbsp;<span class="ident" id="8165986">nil</span>&nbsp;<span class="op" id="8165990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8165994">t</span><span class="op" id="8165995">.</span><span class="ident" id="8165996">Fatal</span><span class="op" id="8166001">(</span><span class="string" id="8166002">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8166021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8166024">}</span><br>
<span class="lineno"></span><span class="op" id="8166026">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="8166029">func</span>&nbsp;<span class="ident" id="8166034">TestUnixConnLocalAndRemoteNames</span><span class="op" id="8166065">(</span><span class="ident" id="8166066">t</span>&nbsp;<span class="op" id="8166068">*</span><span class="ident" id="8166069">testing</span><span class="op" id="8166076">.</span><span class="ident" id="8166077">T</span><span class="op" id="8166078">)</span>&nbsp;<span class="op" id="8166080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166083">for</span>&nbsp;<span class="ident" id="8166087">_</span><span class="op" id="8166088">,</span>&nbsp;<span class="ident" id="8166090">laddr</span>&nbsp;<span class="op" id="8166096">:=</span>&nbsp;<span class="keyword" id="8166099">range</span>&nbsp;<span class="op" id="8166105">[</span><span class="op" id="8166106">]</span><span class="builtintype" id="8166107">string</span><span class="op" id="8166113">{</span><span class="string" id="8166114">&#34;&#34;</span><span class="op" id="8166116">,</span>&nbsp;<span class="ident" id="8166118">testUnixAddr</span><span class="op" id="8166130">(</span><span class="op" id="8166131">)</span><span class="op" id="8166132">}</span>&nbsp;<span class="op" id="8166134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166138">laddr</span>&nbsp;<span class="op" id="8166144">:=</span>&nbsp;<span class="ident" id="8166147">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166155">taddr</span>&nbsp;<span class="op" id="8166161">:=</span>&nbsp;<span class="ident" id="8166164">testUnixAddr</span><span class="op" id="8166176">(</span><span class="op" id="8166177">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166181">ta</span><span class="op" id="8166183">,</span>&nbsp;<span class="ident" id="8166185">err</span>&nbsp;<span class="op" id="8166189">:=</span>&nbsp;<span class="ident" id="8166192">ResolveUnixAddr</span><span class="op" id="8166207">(</span><span class="string" id="8166208">&#34;unix&#34;</span><span class="op" id="8166214">,</span>&nbsp;<span class="ident" id="8166216">taddr</span><span class="op" id="8166221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166225">if</span>&nbsp;<span class="ident" id="8166228">err</span>&nbsp;<span class="op" id="8166232">!=</span>&nbsp;<span class="ident" id="8166235">nil</span>&nbsp;<span class="op" id="8166239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166244">t</span><span class="op" id="8166245">.</span><span class="ident" id="8166246">Fatalf</span><span class="op" id="8166252">(</span><span class="string" id="8166253">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8166281">,</span>&nbsp;<span class="ident" id="8166283">err</span><span class="op" id="8166286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8166290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166294">ln</span><span class="op" id="8166296">,</span>&nbsp;<span class="ident" id="8166298">err</span>&nbsp;<span class="op" id="8166302">:=</span>&nbsp;<span class="ident" id="8166305">ListenUnix</span><span class="op" id="8166315">(</span><span class="string" id="8166316">&#34;unix&#34;</span><span class="op" id="8166322">,</span>&nbsp;<span class="ident" id="8166324">ta</span><span class="op" id="8166326">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166330">if</span>&nbsp;<span class="ident" id="8166333">err</span>&nbsp;<span class="op" id="8166337">!=</span>&nbsp;<span class="ident" id="8166340">nil</span>&nbsp;<span class="op" id="8166344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166349">t</span><span class="op" id="8166350">.</span><span class="ident" id="8166351">Fatalf</span><span class="op" id="8166357">(</span><span class="string" id="8166358">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8166381">,</span>&nbsp;<span class="ident" id="8166383">err</span><span class="op" id="8166386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8166390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166394">defer</span>&nbsp;<span class="keyword" id="8166400">func</span><span class="op" id="8166404">(</span><span class="op" id="8166405">)</span>&nbsp;<span class="op" id="8166407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166412">ln</span><span class="op" id="8166414">.</span><span class="ident" id="8166415">Close</span><span class="op" id="8166420">(</span><span class="op" id="8166421">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166426">os</span><span class="op" id="8166428">.</span><span class="ident" id="8166429">Remove</span><span class="op" id="8166435">(</span><span class="ident" id="8166436">taddr</span><span class="op" id="8166441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8166445">}</span><span class="op" id="8166446">(</span><span class="op" id="8166447">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166452">done</span>&nbsp;<span class="op" id="8166457">:=</span>&nbsp;<span class="builtinfunc" id="8166460">make</span><span class="op" id="8166464">(</span><span class="keyword" id="8166465">chan</span>&nbsp;<span class="builtintype" id="8166470">int</span><span class="op" id="8166473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166477">go</span>&nbsp;<span class="ident" id="8166480">transponder</span><span class="op" id="8166491">(</span><span class="ident" id="8166492">t</span><span class="op" id="8166493">,</span>&nbsp;<span class="ident" id="8166495">ln</span><span class="op" id="8166497">,</span>&nbsp;<span class="ident" id="8166499">done</span><span class="op" id="8166503">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166508">la</span><span class="op" id="8166510">,</span>&nbsp;<span class="ident" id="8166512">err</span>&nbsp;<span class="op" id="8166516">:=</span>&nbsp;<span class="ident" id="8166519">ResolveUnixAddr</span><span class="op" id="8166534">(</span><span class="string" id="8166535">&#34;unix&#34;</span><span class="op" id="8166541">,</span>&nbsp;<span class="ident" id="8166543">laddr</span><span class="op" id="8166548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166552">if</span>&nbsp;<span class="ident" id="8166555">err</span>&nbsp;<span class="op" id="8166559">!=</span>&nbsp;<span class="ident" id="8166562">nil</span>&nbsp;<span class="op" id="8166566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166571">t</span><span class="op" id="8166572">.</span><span class="ident" id="8166573">Fatalf</span><span class="op" id="8166579">(</span><span class="string" id="8166580">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8166608">,</span>&nbsp;<span class="ident" id="8166610">err</span><span class="op" id="8166613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8166617">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166621">c</span><span class="op" id="8166622">,</span>&nbsp;<span class="ident" id="8166624">err</span>&nbsp;<span class="op" id="8166628">:=</span>&nbsp;<span class="ident" id="8166631">DialUnix</span><span class="op" id="8166639">(</span><span class="string" id="8166640">&#34;unix&#34;</span><span class="op" id="8166646">,</span>&nbsp;<span class="ident" id="8166648">la</span><span class="op" id="8166650">,</span>&nbsp;<span class="ident" id="8166652">ta</span><span class="op" id="8166654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166658">if</span>&nbsp;<span class="ident" id="8166661">err</span>&nbsp;<span class="op" id="8166665">!=</span>&nbsp;<span class="ident" id="8166668">nil</span>&nbsp;<span class="op" id="8166672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166677">t</span><span class="op" id="8166678">.</span><span class="ident" id="8166679">Fatalf</span><span class="op" id="8166685">(</span><span class="string" id="8166686">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8166707">,</span>&nbsp;<span class="ident" id="8166709">err</span><span class="op" id="8166712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8166716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166720">defer</span>&nbsp;<span class="keyword" id="8166726">func</span><span class="op" id="8166730">(</span><span class="op" id="8166731">)</span>&nbsp;<span class="op" id="8166733">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166738">c</span><span class="op" id="8166739">.</span><span class="ident" id="8166740">Close</span><span class="op" id="8166745">(</span><span class="op" id="8166746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166751">if</span>&nbsp;<span class="ident" id="8166754">la</span>&nbsp;<span class="op" id="8166757">!=</span>&nbsp;<span class="ident" id="8166760">nil</span>&nbsp;<span class="op" id="8166764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166770">defer</span>&nbsp;<span class="ident" id="8166776">os</span><span class="op" id="8166778">.</span><span class="ident" id="8166779">Remove</span><span class="op" id="8166785">(</span><span class="ident" id="8166786">laddr</span><span class="op" id="8166791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8166796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8166800">}</span><span class="op" id="8166801">(</span><span class="op" id="8166802">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166806">if</span>&nbsp;<span class="ident" id="8166809">_</span><span class="op" id="8166810">,</span>&nbsp;<span class="ident" id="8166812">err</span>&nbsp;<span class="op" id="8166816">:=</span>&nbsp;<span class="ident" id="8166819">c</span><span class="op" id="8166820">.</span><span class="ident" id="8166821">Write</span><span class="op" id="8166826">(</span><span class="op" id="8166827">[</span><span class="op" id="8166828">]</span><span class="builtintype" id="8166829">byte</span><span class="op" id="8166833">(</span><span class="string" id="8166834">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="8166871">)</span><span class="op" id="8166872">)</span><span class="op" id="8166873">;</span>&nbsp;<span class="ident" id="8166875">err</span>&nbsp;<span class="op" id="8166879">!=</span>&nbsp;<span class="ident" id="8166882">nil</span>&nbsp;<span class="op" id="8166886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8166891">t</span><span class="op" id="8166892">.</span><span class="ident" id="8166893">Fatalf</span><span class="op" id="8166899">(</span><span class="string" id="8166900">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8166927">,</span>&nbsp;<span class="ident" id="8166929">err</span><span class="op" id="8166932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8166936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166941">switch</span>&nbsp;<span class="ident" id="8166948">runtime</span><span class="op" id="8166955">.</span><span class="ident" id="8166956">GOOS</span>&nbsp;<span class="op" id="8166961">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166965">case</span>&nbsp;<span class="string" id="8166970">&#34;android&#34;</span><span class="op" id="8166979">,</span>&nbsp;<span class="string" id="8166981">&#34;linux&#34;</span><span class="op" id="8166988">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8166993">if</span>&nbsp;<span class="ident" id="8166996">laddr</span>&nbsp;<span class="op" id="8167002">==</span>&nbsp;<span class="string" id="8167005">&#34;&#34;</span>&nbsp;<span class="op" id="8167008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167014">laddr</span>&nbsp;<span class="op" id="8167020">=</span>&nbsp;<span class="string" id="8167022">&#34;@&#34;</span>&nbsp;<span class="comment" id="8167026">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167053">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8167057">var</span>&nbsp;<span class="ident" id="8167061">connAddrs</span>&nbsp;<span class="op" id="8167071">=</span>&nbsp;<span class="op" id="8167073">[</span><span class="num" id="8167074">3</span><span class="op" id="8167075">]</span><span class="keyword" id="8167076">struct</span><span class="op" id="8167082">{</span>&nbsp;<span class="ident" id="8167084">got</span><span class="op" id="8167087">,</span>&nbsp;<span class="ident" id="8167089">want</span>&nbsp;<span class="ident" id="8167094">Addr</span>&nbsp;<span class="op" id="8167099">}</span><span class="op" id="8167100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167105">{</span><span class="ident" id="8167106">ln</span><span class="op" id="8167108">.</span><span class="ident" id="8167109">Addr</span><span class="op" id="8167113">(</span><span class="op" id="8167114">)</span><span class="op" id="8167115">,</span>&nbsp;<span class="ident" id="8167117">ta</span><span class="op" id="8167119">}</span><span class="op" id="8167120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167125">{</span><span class="ident" id="8167126">c</span><span class="op" id="8167127">.</span><span class="ident" id="8167128">LocalAddr</span><span class="op" id="8167137">(</span><span class="op" id="8167138">)</span><span class="op" id="8167139">,</span>&nbsp;<span class="op" id="8167141">&amp;</span><span class="ident" id="8167142">UnixAddr</span><span class="op" id="8167150">{</span><span class="ident" id="8167151">Name</span><span class="op" id="8167155">:</span>&nbsp;<span class="ident" id="8167157">laddr</span><span class="op" id="8167162">,</span>&nbsp;<span class="ident" id="8167164">Net</span><span class="op" id="8167167">:</span>&nbsp;<span class="string" id="8167169">&#34;unix&#34;</span><span class="op" id="8167175">}</span><span class="op" id="8167176">}</span><span class="op" id="8167177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167182">{</span><span class="ident" id="8167183">c</span><span class="op" id="8167184">.</span><span class="ident" id="8167185">RemoteAddr</span><span class="op" id="8167195">(</span><span class="op" id="8167196">)</span><span class="op" id="8167197">,</span>&nbsp;<span class="ident" id="8167199">ta</span><span class="op" id="8167201">}</span><span class="op" id="8167202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167206">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8167210">for</span>&nbsp;<span class="ident" id="8167214">_</span><span class="op" id="8167215">,</span>&nbsp;<span class="ident" id="8167217">ca</span>&nbsp;<span class="op" id="8167220">:=</span>&nbsp;<span class="keyword" id="8167223">range</span>&nbsp;<span class="ident" id="8167229">connAddrs</span>&nbsp;<span class="op" id="8167239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8167244">if</span>&nbsp;<span class="op" id="8167247">!</span><span class="ident" id="8167248">reflect</span><span class="op" id="8167255">.</span><span class="ident" id="8167256">DeepEqual</span><span class="op" id="8167265">(</span><span class="ident" id="8167266">ca</span><span class="op" id="8167268">.</span><span class="ident" id="8167269">got</span><span class="op" id="8167272">,</span>&nbsp;<span class="ident" id="8167274">ca</span><span class="op" id="8167276">.</span><span class="ident" id="8167277">want</span><span class="op" id="8167281">)</span>&nbsp;<span class="op" id="8167283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167289">t</span><span class="op" id="8167290">.</span><span class="ident" id="8167291">Fatalf</span><span class="op" id="8167297">(</span><span class="string" id="8167298">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8167321">,</span>&nbsp;<span class="ident" id="8167323">ca</span><span class="op" id="8167325">.</span><span class="ident" id="8167326">got</span><span class="op" id="8167329">,</span>&nbsp;<span class="ident" id="8167331">ca</span><span class="op" id="8167333">.</span><span class="ident" id="8167334">want</span><span class="op" id="8167338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167347">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167352">&lt;-</span><span class="ident" id="8167354">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167360">}</span><br>
<span class="lineno"></span><span class="op" id="8167362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8167365">func</span>&nbsp;<span class="ident" id="8167370">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="8167405">(</span><span class="ident" id="8167406">t</span>&nbsp;<span class="op" id="8167408">*</span><span class="ident" id="8167409">testing</span><span class="op" id="8167416">.</span><span class="ident" id="8167417">T</span><span class="op" id="8167418">)</span>&nbsp;<span class="op" id="8167420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8167423">for</span>&nbsp;<span class="ident" id="8167427">_</span><span class="op" id="8167428">,</span>&nbsp;<span class="ident" id="8167430">laddr</span>&nbsp;<span class="op" id="8167436">:=</span>&nbsp;<span class="keyword" id="8167439">range</span>&nbsp;<span class="op" id="8167445">[</span><span class="op" id="8167446">]</span><span class="builtintype" id="8167447">string</span><span class="op" id="8167453">{</span><span class="string" id="8167454">&#34;&#34;</span><span class="op" id="8167456">,</span>&nbsp;<span class="ident" id="8167458">testUnixAddr</span><span class="op" id="8167470">(</span><span class="op" id="8167471">)</span><span class="op" id="8167472">}</span>&nbsp;<span class="op" id="8167474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167478">laddr</span>&nbsp;<span class="op" id="8167484">:=</span>&nbsp;<span class="ident" id="8167487">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167495">taddr</span>&nbsp;<span class="op" id="8167501">:=</span>&nbsp;<span class="ident" id="8167504">testUnixAddr</span><span class="op" id="8167516">(</span><span class="op" id="8167517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167521">ta</span><span class="op" id="8167523">,</span>&nbsp;<span class="ident" id="8167525">err</span>&nbsp;<span class="op" id="8167529">:=</span>&nbsp;<span class="ident" id="8167532">ResolveUnixAddr</span><span class="op" id="8167547">(</span><span class="string" id="8167548">&#34;unixgram&#34;</span><span class="op" id="8167558">,</span>&nbsp;<span class="ident" id="8167560">taddr</span><span class="op" id="8167565">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8167569">if</span>&nbsp;<span class="ident" id="8167572">err</span>&nbsp;<span class="op" id="8167576">!=</span>&nbsp;<span class="ident" id="8167579">nil</span>&nbsp;<span class="op" id="8167583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167588">t</span><span class="op" id="8167589">.</span><span class="ident" id="8167590">Fatalf</span><span class="op" id="8167596">(</span><span class="string" id="8167597">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8167625">,</span>&nbsp;<span class="ident" id="8167627">err</span><span class="op" id="8167630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167638">c1</span><span class="op" id="8167640">,</span>&nbsp;<span class="ident" id="8167642">err</span>&nbsp;<span class="op" id="8167646">:=</span>&nbsp;<span class="ident" id="8167649">ListenUnixgram</span><span class="op" id="8167663">(</span><span class="string" id="8167664">&#34;unixgram&#34;</span><span class="op" id="8167674">,</span>&nbsp;<span class="ident" id="8167676">ta</span><span class="op" id="8167678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8167682">if</span>&nbsp;<span class="ident" id="8167685">err</span>&nbsp;<span class="op" id="8167689">!=</span>&nbsp;<span class="ident" id="8167692">nil</span>&nbsp;<span class="op" id="8167696">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167701">t</span><span class="op" id="8167702">.</span><span class="ident" id="8167703">Fatalf</span><span class="op" id="8167709">(</span><span class="string" id="8167710">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8167737">,</span>&nbsp;<span class="ident" id="8167739">err</span><span class="op" id="8167742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8167750">defer</span>&nbsp;<span class="keyword" id="8167756">func</span><span class="op" id="8167760">(</span><span class="op" id="8167761">)</span>&nbsp;<span class="op" id="8167763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167768">c1</span><span class="op" id="8167770">.</span><span class="ident" id="8167771">Close</span><span class="op" id="8167776">(</span><span class="op" id="8167777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167782">os</span><span class="op" id="8167784">.</span><span class="ident" id="8167785">Remove</span><span class="op" id="8167791">(</span><span class="ident" id="8167792">taddr</span><span class="op" id="8167797">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167801">}</span><span class="op" id="8167802">(</span><span class="op" id="8167803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8167808">var</span>&nbsp;<span class="ident" id="8167812">la</span>&nbsp;<span class="op" id="8167815">*</span><span class="ident" id="8167816">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8167827">if</span>&nbsp;<span class="ident" id="8167830">laddr</span>&nbsp;<span class="op" id="8167836">!=</span>&nbsp;<span class="string" id="8167839">&#34;&#34;</span>&nbsp;<span class="op" id="8167842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8167847">if</span>&nbsp;<span class="ident" id="8167850">la</span><span class="op" id="8167852">,</span>&nbsp;<span class="ident" id="8167854">err</span>&nbsp;<span class="op" id="8167858">=</span>&nbsp;<span class="ident" id="8167860">ResolveUnixAddr</span><span class="op" id="8167875">(</span><span class="string" id="8167876">&#34;unixgram&#34;</span><span class="op" id="8167886">,</span>&nbsp;<span class="ident" id="8167888">laddr</span><span class="op" id="8167893">)</span><span class="op" id="8167894">;</span>&nbsp;<span class="ident" id="8167896">err</span>&nbsp;<span class="op" id="8167900">!=</span>&nbsp;<span class="ident" id="8167903">nil</span>&nbsp;<span class="op" id="8167907">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167913">t</span><span class="op" id="8167914">.</span><span class="ident" id="8167915">Fatalf</span><span class="op" id="8167921">(</span><span class="string" id="8167922">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8167950">,</span>&nbsp;<span class="ident" id="8167952">err</span><span class="op" id="8167955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8167964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167968">c2</span><span class="op" id="8167970">,</span>&nbsp;<span class="ident" id="8167972">err</span>&nbsp;<span class="op" id="8167976">:=</span>&nbsp;<span class="ident" id="8167979">DialUnix</span><span class="op" id="8167987">(</span><span class="string" id="8167988">&#34;unixgram&#34;</span><span class="op" id="8167998">,</span>&nbsp;<span class="ident" id="8168000">la</span><span class="op" id="8168002">,</span>&nbsp;<span class="ident" id="8168004">ta</span><span class="op" id="8168006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8168010">if</span>&nbsp;<span class="ident" id="8168013">err</span>&nbsp;<span class="op" id="8168017">!=</span>&nbsp;<span class="ident" id="8168020">nil</span>&nbsp;<span class="op" id="8168024">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8168029">t</span><span class="op" id="8168030">.</span><span class="ident" id="8168031">Fatalf</span><span class="op" id="8168037">(</span><span class="string" id="8168038">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8168059">,</span>&nbsp;<span class="ident" id="8168061">err</span><span class="op" id="8168064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8168072">defer</span>&nbsp;<span class="keyword" id="8168078">func</span><span class="op" id="8168082">(</span><span class="op" id="8168083">)</span>&nbsp;<span class="op" id="8168085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8168090">c2</span><span class="op" id="8168092">.</span><span class="ident" id="8168093">Close</span><span class="op" id="8168098">(</span><span class="op" id="8168099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8168104">if</span>&nbsp;<span class="ident" id="8168107">la</span>&nbsp;<span class="op" id="8168110">!=</span>&nbsp;<span class="ident" id="8168113">nil</span>&nbsp;<span class="op" id="8168117">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8168123">defer</span>&nbsp;<span class="ident" id="8168129">os</span><span class="op" id="8168131">.</span><span class="ident" id="8168132">Remove</span><span class="op" id="8168138">(</span><span class="ident" id="8168139">laddr</span><span class="op" id="8168144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168153">}</span><span class="op" id="8168154">(</span><span class="op" id="8168155">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8168160">switch</span>&nbsp;<span class="ident" id="8168167">runtime</span><span class="op" id="8168174">.</span><span class="ident" id="8168175">GOOS</span>&nbsp;<span class="op" id="8168180">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8168184">case</span>&nbsp;<span class="string" id="8168189">&#34;android&#34;</span><span class="op" id="8168198">,</span>&nbsp;<span class="string" id="8168200">&#34;linux&#34;</span><span class="op" id="8168207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8168212">if</span>&nbsp;<span class="ident" id="8168215">laddr</span>&nbsp;<span class="op" id="8168221">==</span>&nbsp;<span class="string" id="8168224">&#34;&#34;</span>&nbsp;<span class="op" id="8168227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8168233">laddr</span>&nbsp;<span class="op" id="8168239">=</span>&nbsp;<span class="string" id="8168241">&#34;@&#34;</span>&nbsp;<span class="comment" id="8168245">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168272">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8168277">var</span>&nbsp;<span class="ident" id="8168281">connAddrs</span>&nbsp;<span class="op" id="8168291">=</span>&nbsp;<span class="op" id="8168293">[</span><span class="num" id="8168294">4</span><span class="op" id="8168295">]</span><span class="keyword" id="8168296">struct</span><span class="op" id="8168302">{</span>&nbsp;<span class="ident" id="8168304">got</span><span class="op" id="8168307">,</span>&nbsp;<span class="ident" id="8168309">want</span>&nbsp;<span class="ident" id="8168314">Addr</span>&nbsp;<span class="op" id="8168319">}</span><span class="op" id="8168320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168325">{</span><span class="ident" id="8168326">c1</span><span class="op" id="8168328">.</span><span class="ident" id="8168329">LocalAddr</span><span class="op" id="8168338">(</span><span class="op" id="8168339">)</span><span class="op" id="8168340">,</span>&nbsp;<span class="ident" id="8168342">ta</span><span class="op" id="8168344">}</span><span class="op" id="8168345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168350">{</span><span class="ident" id="8168351">c1</span><span class="op" id="8168353">.</span><span class="ident" id="8168354">RemoteAddr</span><span class="op" id="8168364">(</span><span class="op" id="8168365">)</span><span class="op" id="8168366">,</span>&nbsp;<span class="ident" id="8168368">nil</span><span class="op" id="8168371">}</span><span class="op" id="8168372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168377">{</span><span class="ident" id="8168378">c2</span><span class="op" id="8168380">.</span><span class="ident" id="8168381">LocalAddr</span><span class="op" id="8168390">(</span><span class="op" id="8168391">)</span><span class="op" id="8168392">,</span>&nbsp;<span class="op" id="8168394">&amp;</span><span class="ident" id="8168395">UnixAddr</span><span class="op" id="8168403">{</span><span class="ident" id="8168404">Name</span><span class="op" id="8168408">:</span>&nbsp;<span class="ident" id="8168410">laddr</span><span class="op" id="8168415">,</span>&nbsp;<span class="ident" id="8168417">Net</span><span class="op" id="8168420">:</span>&nbsp;<span class="string" id="8168422">&#34;unixgram&#34;</span><span class="op" id="8168432">}</span><span class="op" id="8168433">}</span><span class="op" id="8168434">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168439">{</span><span class="ident" id="8168440">c2</span><span class="op" id="8168442">.</span><span class="ident" id="8168443">RemoteAddr</span><span class="op" id="8168453">(</span><span class="op" id="8168454">)</span><span class="op" id="8168455">,</span>&nbsp;<span class="ident" id="8168457">ta</span><span class="op" id="8168459">}</span><span class="op" id="8168460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8168468">for</span>&nbsp;<span class="ident" id="8168472">_</span><span class="op" id="8168473">,</span>&nbsp;<span class="ident" id="8168475">ca</span>&nbsp;<span class="op" id="8168478">:=</span>&nbsp;<span class="keyword" id="8168481">range</span>&nbsp;<span class="ident" id="8168487">connAddrs</span>&nbsp;<span class="op" id="8168497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8168502">if</span>&nbsp;<span class="op" id="8168505">!</span><span class="ident" id="8168506">reflect</span><span class="op" id="8168513">.</span><span class="ident" id="8168514">DeepEqual</span><span class="op" id="8168523">(</span><span class="ident" id="8168524">ca</span><span class="op" id="8168526">.</span><span class="ident" id="8168527">got</span><span class="op" id="8168530">,</span>&nbsp;<span class="ident" id="8168532">ca</span><span class="op" id="8168534">.</span><span class="ident" id="8168535">want</span><span class="op" id="8168539">)</span>&nbsp;<span class="op" id="8168541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8168547">t</span><span class="op" id="8168548">.</span><span class="ident" id="8168549">Fatalf</span><span class="op" id="8168555">(</span><span class="string" id="8168556">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8168579">,</span>&nbsp;<span class="ident" id="8168581">ca</span><span class="op" id="8168583">.</span><span class="ident" id="8168584">got</span><span class="op" id="8168587">,</span>&nbsp;<span class="ident" id="8168589">ca</span><span class="op" id="8168591">.</span><span class="ident" id="8168592">want</span><span class="op" id="8168596">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8168608">}</span><br>
<span class="lineno"></span><span class="op" id="8168610">}</span>
</div>
</body>
</html>
