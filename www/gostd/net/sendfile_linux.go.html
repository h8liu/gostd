<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html" class="current">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3352941">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3352997">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3353051">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3353102">package</span>&nbsp;<span class="ident" id="3353110">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3353115">import</span>&nbsp;<span class="op" id="3353122">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3353125">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3353131">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3353137">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3353147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3353150">//&nbsp;maxSendfileSize&nbsp;is&nbsp;the&nbsp;largest&nbsp;chunk&nbsp;size&nbsp;we&nbsp;ask&nbsp;the&nbsp;kernel&nbsp;to&nbsp;copy</span><br>
<span class="lineno"></span><span class="comment" id="3353221">//&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno">15</span><span class="keyword" id="3353235">const</span>&nbsp;<span class="ident" id="3353241">maxSendfileSize</span>&nbsp;<span class="builtintype" id="3353257">int</span>&nbsp;<span class="op" id="3353261">=</span>&nbsp;<span class="num" id="3353263">4</span>&nbsp;<span class="op" id="3353265">&lt;&lt;</span>&nbsp;<span class="num" id="3353268">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3353272">//&nbsp;sendFile&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;r&nbsp;to&nbsp;c&nbsp;using&nbsp;the&nbsp;sendfile</span><br>
<span class="lineno"></span><span class="comment" id="3353333">//&nbsp;system&nbsp;call&nbsp;to&nbsp;minimize&nbsp;copies.</span><br>
<span class="lineno"></span><span class="comment" id="3353368">//</span><br>
<span class="lineno">20</span><span class="comment" id="3353371">//&nbsp;if&nbsp;handled&nbsp;==&nbsp;true,&nbsp;sendFile&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;and&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="3353446">//&nbsp;non-EOF&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3353464">//</span><br>
<span class="lineno"></span><span class="comment" id="3353467">//&nbsp;if&nbsp;handled&nbsp;==&nbsp;false,&nbsp;sendFile&nbsp;performed&nbsp;no&nbsp;work.</span><br>
<span class="lineno"></span><span class="keyword" id="3353519">func</span>&nbsp;<span class="ident" id="3353524">sendFile</span><span class="op" id="3353532">(</span><span class="ident" id="3353533">c</span>&nbsp;<span class="op" id="3353535">*</span><span class="ident" id="3353536"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3353541">,</span>&nbsp;<span class="ident" id="3353543">r</span>&nbsp;<span class="ident" id="3353545"><a href="/gostd/net/sendfile_linux.go.html#3353125">io</a></span><span class="op" id="3353547">.</span><span class="ident" id="3353548"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="3353554">)</span>&nbsp;<span class="op" id="3353556">(</span><span class="ident" id="3353557">written</span>&nbsp;<span class="builtintype" id="3353565">int64</span><span class="op" id="3353570">,</span>&nbsp;<span class="ident" id="3353572">err</span>&nbsp;<span class="builtintype" id="3353576">error</span><span class="op" id="3353581">,</span>&nbsp;<span class="ident" id="3353583">handled</span>&nbsp;<span class="builtintype" id="3353591">bool</span><span class="op" id="3353595">)</span>&nbsp;<span class="op" id="3353597">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353600">var</span>&nbsp;<span class="ident" id="3353604">remain</span>&nbsp;<span class="builtintype" id="3353611">int64</span>&nbsp;<span class="op" id="3353617">=</span>&nbsp;<span class="num" id="3353619">1</span>&nbsp;<span class="op" id="3353621">&lt;&lt;</span>&nbsp;<span class="num" id="3353624">62</span>&nbsp;<span class="comment" id="3353627">//&nbsp;by&nbsp;default,&nbsp;copy&nbsp;until&nbsp;EOF</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353659">lr</span><span class="op" id="3353661">,</span>&nbsp;<span class="ident" id="3353663">ok</span>&nbsp;<span class="op" id="3353666">:=</span>&nbsp;<span class="ident" id="3353669"><a href="/gostd/net/sendfile_linux.go.html#3353543">r</a></span><span class="op" id="3353670">.</span><span class="op" id="3353671">(</span><span class="op" id="3353672">*</span><span class="ident" id="3353673"><a href="/gostd/net/sendfile_linux.go.html#3353125">io</a></span><span class="op" id="3353675">.</span><span class="ident" id="3353676"><a href="/gostd/io/io.go.html#1432050">LimitedReader</a></span><span class="op" id="3353689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353692">if</span>&nbsp;<span class="ident" id="3353695"><a href="/gostd/net/sendfile_linux.go.html#3353663">ok</a></span>&nbsp;<span class="op" id="3353698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353702"><a href="/gostd/net/sendfile_linux.go.html#3353604">remain</a></span><span class="op" id="3353708">,</span>&nbsp;<span class="ident" id="3353710"><a href="/gostd/net/sendfile_linux.go.html#3353543">r</a></span>&nbsp;<span class="op" id="3353712">=</span>&nbsp;<span class="ident" id="3353714"><a href="/gostd/net/sendfile_linux.go.html#3353659">lr</a></span><span class="op" id="3353716">.</span><span class="ident" id="3353717"><a href="/gostd/io/io.go.html#1432105">N</a></span><span class="op" id="3353718">,</span>&nbsp;<span class="ident" id="3353720"><a href="/gostd/net/sendfile_linux.go.html#3353659">lr</a></span><span class="op" id="3353722">.</span><span class="ident" id="3353723"><a href="/gostd/io/io.go.html#1432074">R</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353727">if</span>&nbsp;<span class="ident" id="3353730"><a href="/gostd/net/sendfile_linux.go.html#3353604">remain</a></span>&nbsp;<span class="op" id="3353737">&lt;=</span>&nbsp;<span class="num" id="3353740">0</span>&nbsp;<span class="op" id="3353742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353747">return</span>&nbsp;<span class="num" id="3353754">0</span><span class="op" id="3353755">,</span>&nbsp;<span class="builtintype" id="3353757">nil</span><span class="op" id="3353760">,</span>&nbsp;<span class="builtintype" id="3353762">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353775">f</span><span class="op" id="3353776">,</span>&nbsp;<span class="ident" id="3353778"><a href="/gostd/net/sendfile_linux.go.html#3353663">ok</a></span>&nbsp;<span class="op" id="3353781">:=</span>&nbsp;<span class="ident" id="3353784"><a href="/gostd/net/sendfile_linux.go.html#3353543">r</a></span><span class="op" id="3353785">.</span><span class="op" id="3353786">(</span><span class="op" id="3353787">*</span><span class="ident" id="3353788"><a href="/gostd/net/sendfile_linux.go.html#3353131">os</a></span><span class="op" id="3353790">.</span><span class="ident" id="3353791"><a href="/gostd/os/file_unix.go.html#2452288">File</a></span><span class="op" id="3353795">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353798">if</span>&nbsp;<span class="op" id="3353801">!</span><span class="ident" id="3353802"><a href="/gostd/net/sendfile_linux.go.html#3353663">ok</a></span>&nbsp;<span class="op" id="3353805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353809">return</span>&nbsp;<span class="num" id="3353816">0</span><span class="op" id="3353817">,</span>&nbsp;<span class="builtintype" id="3353819">nil</span><span class="op" id="3353822">,</span>&nbsp;<span class="builtintype" id="3353824">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353835">if</span>&nbsp;<span class="ident" id="3353838">err</span>&nbsp;<span class="op" id="3353842">:=</span>&nbsp;<span class="ident" id="3353845"><a href="/gostd/net/sendfile_linux.go.html#3353533">c</a></span><span class="op" id="3353846">.</span><span class="ident" id="3353847"><a href="/gostd/net/fd_unix.go.html#3261223">writeLock</a></span><span class="op" id="3353856">(</span><span class="op" id="3353857">)</span><span class="op" id="3353858">;</span>&nbsp;<span class="ident" id="3353860"><a href="/gostd/net/sendfile_linux.go.html#3353838">err</a></span>&nbsp;<span class="op" id="3353864">!=</span>&nbsp;<span class="builtintype" id="3353867">nil</span>&nbsp;<span class="op" id="3353871">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353875">return</span>&nbsp;<span class="num" id="3353882">0</span><span class="op" id="3353883">,</span>&nbsp;<span class="ident" id="3353885"><a href="/gostd/net/sendfile_linux.go.html#3353838">err</a></span><span class="op" id="3353888">,</span>&nbsp;<span class="builtintype" id="3353890">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3353896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353899">defer</span>&nbsp;<span class="ident" id="3353905"><a href="/gostd/net/sendfile_linux.go.html#3353533">c</a></span><span class="op" id="3353906">.</span><span class="ident" id="3353907"><a href="/gostd/net/fd_unix.go.html#3261384">writeUnlock</a></span><span class="op" id="3353918">(</span><span class="op" id="3353919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353923">dst</span>&nbsp;<span class="op" id="3353927">:=</span>&nbsp;<span class="ident" id="3353930"><a href="/gostd/net/sendfile_linux.go.html#3353533">c</a></span><span class="op" id="3353931">.</span><span class="ident" id="3353932"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353939">src</span>&nbsp;<span class="op" id="3353943">:=</span>&nbsp;<span class="builtintype" id="3353946">int</span><span class="op" id="3353949">(</span><span class="ident" id="3353950"><a href="/gostd/net/sendfile_linux.go.html#3353775">f</a></span><span class="op" id="3353951">.</span><span class="ident" id="3353952"><a href="/gostd/os/file_unix.go.html#2452859">Fd</a></span><span class="op" id="3353954">(</span><span class="op" id="3353955">)</span><span class="op" id="3353956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3353959">for</span>&nbsp;<span class="ident" id="3353963"><a href="/gostd/net/sendfile_linux.go.html#3353604">remain</a></span>&nbsp;<span class="op" id="3353970">&gt;</span>&nbsp;<span class="num" id="3353972">0</span>&nbsp;<span class="op" id="3353974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3353978">n</span>&nbsp;<span class="op" id="3353980">:=</span>&nbsp;<span class="ident" id="3353983"><a href="/gostd/net/sendfile_linux.go.html#3353241">maxSendfileSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354001">if</span>&nbsp;<span class="builtintype" id="3354004">int64</span><span class="op" id="3354009">(</span><span class="ident" id="3354010"><a href="/gostd/net/sendfile_linux.go.html#3353978">n</a></span><span class="op" id="3354011">)</span>&nbsp;<span class="op" id="3354013">&gt;</span>&nbsp;<span class="ident" id="3354015"><a href="/gostd/net/sendfile_linux.go.html#3353604">remain</a></span>&nbsp;<span class="op" id="3354022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3354027"><a href="/gostd/net/sendfile_linux.go.html#3353978">n</a></span>&nbsp;<span class="op" id="3354029">=</span>&nbsp;<span class="builtintype" id="3354031">int</span><span class="op" id="3354034">(</span><span class="ident" id="3354035"><a href="/gostd/net/sendfile_linux.go.html#3353604">remain</a></span><span class="op" id="3354041">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3354045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3354049"><a href="/gostd/net/sendfile_linux.go.html#3353978">n</a></span><span class="op" id="3354050">,</span>&nbsp;<span class="ident" id="3354052">err1</span>&nbsp;<span class="op" id="3354057">:=</span>&nbsp;<span class="ident" id="3354060"><a href="/gostd/net/sendfile_linux.go.html#3353137">syscall</a></span><span class="op" id="3354067">.</span><span class="ident" id="3354068"><a href="/gostd/syscall/syscall_unix.go.html#2550286">Sendfile</a></span><span class="op" id="3354076">(</span><span class="ident" id="3354077"><a href="/gostd/net/sendfile_linux.go.html#3353923">dst</a></span><span class="op" id="3354080">,</span>&nbsp;<span class="ident" id="3354082"><a href="/gostd/net/sendfile_linux.go.html#3353939">src</a></span><span class="op" id="3354085">,</span>&nbsp;<span class="builtintype" id="3354087">nil</span><span class="op" id="3354090">,</span>&nbsp;<span class="ident" id="3354092"><a href="/gostd/net/sendfile_linux.go.html#3353978">n</a></span><span class="op" id="3354093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354097">if</span>&nbsp;<span class="ident" id="3354100"><a href="/gostd/net/sendfile_linux.go.html#3353978">n</a></span>&nbsp;<span class="op" id="3354102">&gt;</span>&nbsp;<span class="num" id="3354104">0</span>&nbsp;<span class="op" id="3354106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3354111"><a href="/gostd/net/sendfile_linux.go.html#3353557">written</a></span>&nbsp;<span class="op" id="3354119">+=</span>&nbsp;<span class="builtintype" id="3354122">int64</span><span class="op" id="3354127">(</span><span class="ident" id="3354128"><a href="/gostd/net/sendfile_linux.go.html#3353978">n</a></span><span class="op" id="3354129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3354134"><a href="/gostd/net/sendfile_linux.go.html#3353604">remain</a></span>&nbsp;<span class="op" id="3354141">-=</span>&nbsp;<span class="builtintype" id="3354144">int64</span><span class="op" id="3354149">(</span><span class="ident" id="3354150"><a href="/gostd/net/sendfile_linux.go.html#3353978">n</a></span><span class="op" id="3354151">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3354155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354159">if</span>&nbsp;<span class="ident" id="3354162"><a href="/gostd/net/sendfile_linux.go.html#3353978">n</a></span>&nbsp;<span class="op" id="3354164">==</span>&nbsp;<span class="num" id="3354167">0</span>&nbsp;<span class="op" id="3354169">&amp;&amp;</span>&nbsp;<span class="ident" id="3354172"><a href="/gostd/net/sendfile_linux.go.html#3354052">err1</a></span>&nbsp;<span class="op" id="3354177">==</span>&nbsp;<span class="builtintype" id="3354180">nil</span>&nbsp;<span class="op" id="3354184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354189">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3354197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354201">if</span>&nbsp;<span class="ident" id="3354204"><a href="/gostd/net/sendfile_linux.go.html#3354052">err1</a></span>&nbsp;<span class="op" id="3354209">==</span>&nbsp;<span class="ident" id="3354212"><a href="/gostd/net/sendfile_linux.go.html#3353137">syscall</a></span><span class="op" id="3354219">.</span><span class="ident" id="3354220"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600313">EAGAIN</a></span>&nbsp;<span class="op" id="3354227">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354232">if</span>&nbsp;<span class="ident" id="3354235"><a href="/gostd/net/sendfile_linux.go.html#3354052">err1</a></span>&nbsp;<span class="op" id="3354240">=</span>&nbsp;<span class="ident" id="3354242"><a href="/gostd/net/sendfile_linux.go.html#3353533">c</a></span><span class="op" id="3354243">.</span><span class="ident" id="3354244"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3354246">.</span><span class="ident" id="3354247"><a href="/gostd/net/fd_poll_runtime.go.html#3256007">WaitWrite</a></span><span class="op" id="3354256">(</span><span class="op" id="3354257">)</span><span class="op" id="3354258">;</span>&nbsp;<span class="ident" id="3354260"><a href="/gostd/net/sendfile_linux.go.html#3354052">err1</a></span>&nbsp;<span class="op" id="3354265">==</span>&nbsp;<span class="builtintype" id="3354268">nil</span>&nbsp;<span class="op" id="3354272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354278">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3354290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3354294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354298">if</span>&nbsp;<span class="ident" id="3354301"><a href="/gostd/net/sendfile_linux.go.html#3354052">err1</a></span>&nbsp;<span class="op" id="3354306">!=</span>&nbsp;<span class="builtintype" id="3354309">nil</span>&nbsp;<span class="op" id="3354313">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3354318">//&nbsp;This&nbsp;includes&nbsp;syscall.ENOSYS&nbsp;(no&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3354364">//&nbsp;support)&nbsp;and&nbsp;syscall.EINVAL&nbsp;(fd&nbsp;types&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3354414">//&nbsp;don&#39;t&nbsp;implement&nbsp;sendfile&nbsp;together)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3354455"><a href="/gostd/net/sendfile_linux.go.html#3353572">err</a></span>&nbsp;<span class="op" id="3354459">=</span>&nbsp;<span class="op" id="3354461">&amp;</span><span class="ident" id="3354462"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3354469">{</span><span class="string" id="3354470">&#34;sendfile&#34;</span><span class="op" id="3354480">,</span>&nbsp;<span class="ident" id="3354482"><a href="/gostd/net/sendfile_linux.go.html#3353533">c</a></span><span class="op" id="3354483">.</span><span class="ident" id="3354484"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3354487">,</span>&nbsp;<span class="ident" id="3354489"><a href="/gostd/net/sendfile_linux.go.html#3353533">c</a></span><span class="op" id="3354490">.</span><span class="ident" id="3354491"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span><span class="op" id="3354496">,</span>&nbsp;<span class="ident" id="3354498"><a href="/gostd/net/sendfile_linux.go.html#3354052">err1</a></span><span class="op" id="3354502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354507">break</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3354515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3354518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354521">if</span>&nbsp;<span class="ident" id="3354524"><a href="/gostd/net/sendfile_linux.go.html#3353659">lr</a></span>&nbsp;<span class="op" id="3354527">!=</span>&nbsp;<span class="builtintype" id="3354530">nil</span>&nbsp;<span class="op" id="3354534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3354538"><a href="/gostd/net/sendfile_linux.go.html#3353659">lr</a></span><span class="op" id="3354540">.</span><span class="ident" id="3354541"><a href="/gostd/io/io.go.html#1432105">N</a></span>&nbsp;<span class="op" id="3354543">=</span>&nbsp;<span class="ident" id="3354545"><a href="/gostd/net/sendfile_linux.go.html#3353604">remain</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3354553">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3354556">return</span>&nbsp;<span class="ident" id="3354563"><a href="/gostd/net/sendfile_linux.go.html#3353557">written</a></span><span class="op" id="3354570">,</span>&nbsp;<span class="ident" id="3354572"><a href="/gostd/net/sendfile_linux.go.html#3353572">err</a></span><span class="op" id="3354575">,</span>&nbsp;<span class="ident" id="3354577"><a href="/gostd/net/sendfile_linux.go.html#3353557">written</a></span>&nbsp;<span class="op" id="3354585">&gt;</span>&nbsp;<span class="num" id="3354587">0</span><br>
<span class="lineno"></span><span class="op" id="3354589">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
