<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5221260">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5221315">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5221369">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5221420">package</span>&nbsp;<span class="ident" id="5221428">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5221436">import</span>&nbsp;<span class="string" id="5221443">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5221454">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="5221540">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="5221619">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="5221690">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="5221756">//</span><br>
<span class="lineno"></span><span class="comment" id="5221759">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="5221837">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="5221898">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="5221945">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="5222015">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5222092">type</span>&nbsp;<span class="ident" id="5222097">patchList</span>&nbsp;<span class="builtintype" id="5222107">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5222115">func</span>&nbsp;<span class="op" id="5222120">(</span><span class="ident" id="5222121">l</span>&nbsp;<span class="ident" id="5222123">patchList</span><span class="op" id="5222132">)</span>&nbsp;<span class="ident" id="5222134">next</span><span class="op" id="5222138">(</span><span class="ident" id="5222139">p</span>&nbsp;<span class="op" id="5222141">*</span><span class="ident" id="5222142">Prog</span><span class="op" id="5222146">)</span>&nbsp;<span class="ident" id="5222148">patchList</span>&nbsp;<span class="op" id="5222158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222161">i</span>&nbsp;<span class="op" id="5222163">:=</span>&nbsp;<span class="op" id="5222166">&amp;</span><span class="ident" id="5222167">p</span><span class="op" id="5222168">.</span><span class="ident" id="5222169">Inst</span><span class="op" id="5222173">[</span><span class="ident" id="5222174">l</span><span class="op" id="5222175">&gt;&gt;</span><span class="num" id="5222177">1</span><span class="op" id="5222178">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222181">if</span>&nbsp;<span class="ident" id="5222184">l</span><span class="op" id="5222185">&amp;</span><span class="num" id="5222186">1</span>&nbsp;<span class="op" id="5222188">==</span>&nbsp;<span class="num" id="5222191">0</span>&nbsp;<span class="op" id="5222193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222197">return</span>&nbsp;<span class="ident" id="5222204">patchList</span><span class="op" id="5222213">(</span><span class="ident" id="5222214">i</span><span class="op" id="5222215">.</span><span class="ident" id="5222216">Out</span><span class="op" id="5222219">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222225">return</span>&nbsp;<span class="ident" id="5222232">patchList</span><span class="op" id="5222241">(</span><span class="ident" id="5222242">i</span><span class="op" id="5222243">.</span><span class="ident" id="5222244">Arg</span><span class="op" id="5222247">)</span><br>
<span class="lineno"></span><span class="op" id="5222249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5222252">func</span>&nbsp;<span class="op" id="5222257">(</span><span class="ident" id="5222258">l</span>&nbsp;<span class="ident" id="5222260">patchList</span><span class="op" id="5222269">)</span>&nbsp;<span class="ident" id="5222271">patch</span><span class="op" id="5222276">(</span><span class="ident" id="5222277">p</span>&nbsp;<span class="op" id="5222279">*</span><span class="ident" id="5222280">Prog</span><span class="op" id="5222284">,</span>&nbsp;<span class="ident" id="5222286">val</span>&nbsp;<span class="builtintype" id="5222290">uint32</span><span class="op" id="5222296">)</span>&nbsp;<span class="op" id="5222298">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222301">for</span>&nbsp;<span class="ident" id="5222305">l</span>&nbsp;<span class="op" id="5222307">!=</span>&nbsp;<span class="num" id="5222310">0</span>&nbsp;<span class="op" id="5222312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222316">i</span>&nbsp;<span class="op" id="5222318">:=</span>&nbsp;<span class="op" id="5222321">&amp;</span><span class="ident" id="5222322">p</span><span class="op" id="5222323">.</span><span class="ident" id="5222324">Inst</span><span class="op" id="5222328">[</span><span class="ident" id="5222329">l</span><span class="op" id="5222330">&gt;&gt;</span><span class="num" id="5222332">1</span><span class="op" id="5222333">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222337">if</span>&nbsp;<span class="ident" id="5222340">l</span><span class="op" id="5222341">&amp;</span><span class="num" id="5222342">1</span>&nbsp;<span class="op" id="5222344">==</span>&nbsp;<span class="num" id="5222347">0</span>&nbsp;<span class="op" id="5222349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222354">l</span>&nbsp;<span class="op" id="5222356">=</span>&nbsp;<span class="ident" id="5222358">patchList</span><span class="op" id="5222367">(</span><span class="ident" id="5222368">i</span><span class="op" id="5222369">.</span><span class="ident" id="5222370">Out</span><span class="op" id="5222373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222378">i</span><span class="op" id="5222379">.</span><span class="ident" id="5222380">Out</span>&nbsp;<span class="op" id="5222384">=</span>&nbsp;<span class="ident" id="5222386">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222392">}</span>&nbsp;<span class="keyword" id="5222394">else</span>&nbsp;<span class="op" id="5222399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222404">l</span>&nbsp;<span class="op" id="5222406">=</span>&nbsp;<span class="ident" id="5222408">patchList</span><span class="op" id="5222417">(</span><span class="ident" id="5222418">i</span><span class="op" id="5222419">.</span><span class="ident" id="5222420">Arg</span><span class="op" id="5222423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222428">i</span><span class="op" id="5222429">.</span><span class="ident" id="5222430">Arg</span>&nbsp;<span class="op" id="5222434">=</span>&nbsp;<span class="ident" id="5222436">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222445">}</span><br>
<span class="lineno">40</span><span class="op" id="5222447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5222450">func</span>&nbsp;<span class="op" id="5222455">(</span><span class="ident" id="5222456">l1</span>&nbsp;<span class="ident" id="5222459">patchList</span><span class="op" id="5222468">)</span>&nbsp;<span class="builtinfunc" id="5222470">append</span><span class="op" id="5222476">(</span><span class="ident" id="5222477">p</span>&nbsp;<span class="op" id="5222479">*</span><span class="ident" id="5222480">Prog</span><span class="op" id="5222484">,</span>&nbsp;<span class="ident" id="5222486">l2</span>&nbsp;<span class="ident" id="5222489">patchList</span><span class="op" id="5222498">)</span>&nbsp;<span class="ident" id="5222500">patchList</span>&nbsp;<span class="op" id="5222510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222513">if</span>&nbsp;<span class="ident" id="5222516">l1</span>&nbsp;<span class="op" id="5222519">==</span>&nbsp;<span class="num" id="5222522">0</span>&nbsp;<span class="op" id="5222524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222528">return</span>&nbsp;<span class="ident" id="5222535">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222542">if</span>&nbsp;<span class="ident" id="5222545">l2</span>&nbsp;<span class="op" id="5222548">==</span>&nbsp;<span class="num" id="5222551">0</span>&nbsp;<span class="op" id="5222553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222557">return</span>&nbsp;<span class="ident" id="5222564">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222572">last</span>&nbsp;<span class="op" id="5222577">:=</span>&nbsp;<span class="ident" id="5222580">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222584">for</span>&nbsp;<span class="op" id="5222588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222592">next</span>&nbsp;<span class="op" id="5222597">:=</span>&nbsp;<span class="ident" id="5222600">last</span><span class="op" id="5222604">.</span><span class="ident" id="5222605">next</span><span class="op" id="5222609">(</span><span class="ident" id="5222610">p</span><span class="op" id="5222611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222615">if</span>&nbsp;<span class="ident" id="5222618">next</span>&nbsp;<span class="op" id="5222623">==</span>&nbsp;<span class="num" id="5222626">0</span>&nbsp;<span class="op" id="5222628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222633">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222645">last</span>&nbsp;<span class="op" id="5222650">=</span>&nbsp;<span class="ident" id="5222652">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222662">i</span>&nbsp;<span class="op" id="5222664">:=</span>&nbsp;<span class="op" id="5222667">&amp;</span><span class="ident" id="5222668">p</span><span class="op" id="5222669">.</span><span class="ident" id="5222670">Inst</span><span class="op" id="5222674">[</span><span class="ident" id="5222675">last</span><span class="op" id="5222679">&gt;&gt;</span><span class="num" id="5222681">1</span><span class="op" id="5222682">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222685">if</span>&nbsp;<span class="ident" id="5222688">last</span><span class="op" id="5222692">&amp;</span><span class="num" id="5222693">1</span>&nbsp;<span class="op" id="5222695">==</span>&nbsp;<span class="num" id="5222698">0</span>&nbsp;<span class="op" id="5222700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222704">i</span><span class="op" id="5222705">.</span><span class="ident" id="5222706">Out</span>&nbsp;<span class="op" id="5222710">=</span>&nbsp;<span class="builtintype" id="5222712">uint32</span><span class="op" id="5222718">(</span><span class="ident" id="5222719">l2</span><span class="op" id="5222721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222724">}</span>&nbsp;<span class="keyword" id="5222726">else</span>&nbsp;<span class="op" id="5222731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222735">i</span><span class="op" id="5222736">.</span><span class="ident" id="5222737">Arg</span>&nbsp;<span class="op" id="5222741">=</span>&nbsp;<span class="builtintype" id="5222743">uint32</span><span class="op" id="5222749">(</span><span class="ident" id="5222750">l2</span><span class="op" id="5222752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5222755">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5222758">return</span>&nbsp;<span class="ident" id="5222765">l1</span><br>
<span class="lineno"></span><span class="op" id="5222768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5222771">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="5222821">type</span>&nbsp;<span class="ident" id="5222826">frag</span>&nbsp;<span class="keyword" id="5222831">struct</span>&nbsp;<span class="op" id="5222838">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222841">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5222845">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5222855">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222886">out</span>&nbsp;<span class="ident" id="5222890">patchList</span>&nbsp;<span class="comment" id="5222900">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="5222935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5222938">type</span>&nbsp;<span class="ident" id="5222943">compiler</span>&nbsp;<span class="keyword" id="5222952">struct</span>&nbsp;<span class="op" id="5222959">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222962">p</span>&nbsp;<span class="op" id="5222964">*</span><span class="ident" id="5222965">Prog</span><br>
<span class="lineno"></span><span class="op" id="5222970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5222973">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="5223035">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="5223114">func</span>&nbsp;<span class="ident" id="5223119">Compile</span><span class="op" id="5223126">(</span><span class="ident" id="5223127">re</span>&nbsp;<span class="op" id="5223130">*</span><span class="ident" id="5223131">Regexp</span><span class="op" id="5223137">)</span>&nbsp;<span class="op" id="5223139">(</span><span class="op" id="5223140">*</span><span class="ident" id="5223141">Prog</span><span class="op" id="5223145">,</span>&nbsp;<span class="builtintype" id="5223147">error</span><span class="op" id="5223152">)</span>&nbsp;<span class="op" id="5223154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223157">var</span>&nbsp;<span class="ident" id="5223161">c</span>&nbsp;<span class="ident" id="5223163">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223173">c</span><span class="op" id="5223174">.</span><span class="ident" id="5223175">init</span><span class="op" id="5223179">(</span><span class="op" id="5223180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223183">f</span>&nbsp;<span class="op" id="5223185">:=</span>&nbsp;<span class="ident" id="5223188">c</span><span class="op" id="5223189">.</span><span class="ident" id="5223190">compile</span><span class="op" id="5223197">(</span><span class="ident" id="5223198">re</span><span class="op" id="5223200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223203">f</span><span class="op" id="5223204">.</span><span class="ident" id="5223205">out</span><span class="op" id="5223208">.</span><span class="ident" id="5223209">patch</span><span class="op" id="5223214">(</span><span class="ident" id="5223215">c</span><span class="op" id="5223216">.</span><span class="ident" id="5223217">p</span><span class="op" id="5223218">,</span>&nbsp;<span class="ident" id="5223220">c</span><span class="op" id="5223221">.</span><span class="ident" id="5223222">inst</span><span class="op" id="5223226">(</span><span class="ident" id="5223227">InstMatch</span><span class="op" id="5223236">)</span><span class="op" id="5223237">.</span><span class="ident" id="5223238">i</span><span class="op" id="5223239">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223242">c</span><span class="op" id="5223243">.</span><span class="ident" id="5223244">p</span><span class="op" id="5223245">.</span><span class="ident" id="5223246">Start</span>&nbsp;<span class="op" id="5223252">=</span>&nbsp;<span class="builtintype" id="5223254">int</span><span class="op" id="5223257">(</span><span class="ident" id="5223258">f</span><span class="op" id="5223259">.</span><span class="ident" id="5223260">i</span><span class="op" id="5223261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223264">return</span>&nbsp;<span class="ident" id="5223271">c</span><span class="op" id="5223272">.</span><span class="ident" id="5223273">p</span><span class="op" id="5223274">,</span>&nbsp;<span class="ident" id="5223276">nil</span><br>
<span class="lineno"></span><span class="op" id="5223280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5223283">func</span>&nbsp;<span class="op" id="5223288">(</span><span class="ident" id="5223289">c</span>&nbsp;<span class="op" id="5223291">*</span><span class="ident" id="5223292">compiler</span><span class="op" id="5223300">)</span>&nbsp;<span class="ident" id="5223302">init</span><span class="op" id="5223306">(</span><span class="op" id="5223307">)</span>&nbsp;<span class="op" id="5223309">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223312">c</span><span class="op" id="5223313">.</span><span class="ident" id="5223314">p</span>&nbsp;<span class="op" id="5223316">=</span>&nbsp;<span class="builtinfunc" id="5223318">new</span><span class="op" id="5223321">(</span><span class="ident" id="5223322">Prog</span><span class="op" id="5223326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223329">c</span><span class="op" id="5223330">.</span><span class="ident" id="5223331">p</span><span class="op" id="5223332">.</span><span class="ident" id="5223333">NumCap</span>&nbsp;<span class="op" id="5223340">=</span>&nbsp;<span class="num" id="5223342">2</span>&nbsp;<span class="comment" id="5223344">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223384">c</span><span class="op" id="5223385">.</span><span class="ident" id="5223386">inst</span><span class="op" id="5223390">(</span><span class="ident" id="5223391">InstFail</span><span class="op" id="5223399">)</span><br>
<span class="lineno"></span><span class="op" id="5223401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5223404">var</span>&nbsp;<span class="ident" id="5223408">anyRuneNotNL</span>&nbsp;<span class="op" id="5223421">=</span>&nbsp;<span class="op" id="5223423">[</span><span class="op" id="5223424">]</span><span class="builtintype" id="5223425">rune</span><span class="op" id="5223429">{</span><span class="num" id="5223430">0</span><span class="op" id="5223431">,</span>&nbsp;<span class="string" id="5223433">&#39;\n&#39;</span>&nbsp;<span class="op" id="5223438">-</span>&nbsp;<span class="num" id="5223440">1</span><span class="op" id="5223441">,</span>&nbsp;<span class="string" id="5223443">&#39;\n&#39;</span>&nbsp;<span class="op" id="5223448">+</span>&nbsp;<span class="num" id="5223450">1</span><span class="op" id="5223451">,</span>&nbsp;<span class="ident" id="5223453">unicode</span><span class="op" id="5223460">.</span><span class="ident" id="5223461">MaxRune</span><span class="op" id="5223468">}</span><br>
<span class="lineno"></span><span class="keyword" id="5223470">var</span>&nbsp;<span class="ident" id="5223474">anyRune</span>&nbsp;<span class="op" id="5223482">=</span>&nbsp;<span class="op" id="5223484">[</span><span class="op" id="5223485">]</span><span class="builtintype" id="5223486">rune</span><span class="op" id="5223490">{</span><span class="num" id="5223491">0</span><span class="op" id="5223492">,</span>&nbsp;<span class="ident" id="5223494">unicode</span><span class="op" id="5223501">.</span><span class="ident" id="5223502">MaxRune</span><span class="op" id="5223509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5223512">func</span>&nbsp;<span class="op" id="5223517">(</span><span class="ident" id="5223518">c</span>&nbsp;<span class="op" id="5223520">*</span><span class="ident" id="5223521">compiler</span><span class="op" id="5223529">)</span>&nbsp;<span class="ident" id="5223531">compile</span><span class="op" id="5223538">(</span><span class="ident" id="5223539">re</span>&nbsp;<span class="op" id="5223542">*</span><span class="ident" id="5223543">Regexp</span><span class="op" id="5223549">)</span>&nbsp;<span class="ident" id="5223551">frag</span>&nbsp;<span class="op" id="5223556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223559">switch</span>&nbsp;<span class="ident" id="5223566">re</span><span class="op" id="5223568">.</span><span class="ident" id="5223569">Op</span>&nbsp;<span class="op" id="5223572">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223575">case</span>&nbsp;<span class="ident" id="5223580">OpNoMatch</span><span class="op" id="5223589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223593">return</span>&nbsp;<span class="ident" id="5223600">c</span><span class="op" id="5223601">.</span><span class="ident" id="5223602">fail</span><span class="op" id="5223606">(</span><span class="op" id="5223607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223610">case</span>&nbsp;<span class="ident" id="5223615">OpEmptyMatch</span><span class="op" id="5223627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223631">return</span>&nbsp;<span class="ident" id="5223638">c</span><span class="op" id="5223639">.</span><span class="ident" id="5223640">nop</span><span class="op" id="5223643">(</span><span class="op" id="5223644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223647">case</span>&nbsp;<span class="ident" id="5223652">OpLiteral</span><span class="op" id="5223661">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223665">if</span>&nbsp;<span class="builtinfunc" id="5223668">len</span><span class="op" id="5223671">(</span><span class="ident" id="5223672">re</span><span class="op" id="5223674">.</span><span class="ident" id="5223675">Rune</span><span class="op" id="5223679">)</span>&nbsp;<span class="op" id="5223681">==</span>&nbsp;<span class="num" id="5223684">0</span>&nbsp;<span class="op" id="5223686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223691">return</span>&nbsp;<span class="ident" id="5223698">c</span><span class="op" id="5223699">.</span><span class="ident" id="5223700">nop</span><span class="op" id="5223703">(</span><span class="op" id="5223704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5223708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223712">var</span>&nbsp;<span class="ident" id="5223716">f</span>&nbsp;<span class="ident" id="5223718">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223725">for</span>&nbsp;<span class="ident" id="5223729">j</span>&nbsp;<span class="op" id="5223731">:=</span>&nbsp;<span class="keyword" id="5223734">range</span>&nbsp;<span class="ident" id="5223740">re</span><span class="op" id="5223742">.</span><span class="ident" id="5223743">Rune</span>&nbsp;<span class="op" id="5223748">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223753">f1</span>&nbsp;<span class="op" id="5223756">:=</span>&nbsp;<span class="ident" id="5223759">c</span><span class="op" id="5223760">.</span><span class="builtintype" id="5223761">rune</span><span class="op" id="5223765">(</span><span class="ident" id="5223766">re</span><span class="op" id="5223768">.</span><span class="ident" id="5223769">Rune</span><span class="op" id="5223773">[</span><span class="ident" id="5223774">j</span><span class="op" id="5223775">:</span><span class="ident" id="5223776">j</span><span class="op" id="5223777">+</span><span class="num" id="5223778">1</span><span class="op" id="5223779">]</span><span class="op" id="5223780">,</span>&nbsp;<span class="ident" id="5223782">re</span><span class="op" id="5223784">.</span><span class="ident" id="5223785">Flags</span><span class="op" id="5223790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223795">if</span>&nbsp;<span class="ident" id="5223798">j</span>&nbsp;<span class="op" id="5223800">==</span>&nbsp;<span class="num" id="5223803">0</span>&nbsp;<span class="op" id="5223805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223811">f</span>&nbsp;<span class="op" id="5223813">=</span>&nbsp;<span class="ident" id="5223815">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5223821">}</span>&nbsp;<span class="keyword" id="5223823">else</span>&nbsp;<span class="op" id="5223828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223834">f</span>&nbsp;<span class="op" id="5223836">=</span>&nbsp;<span class="ident" id="5223838">c</span><span class="op" id="5223839">.</span><span class="ident" id="5223840">cat</span><span class="op" id="5223843">(</span><span class="ident" id="5223844">f</span><span class="op" id="5223845">,</span>&nbsp;<span class="ident" id="5223847">f1</span><span class="op" id="5223849">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5223854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5223858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223862">return</span>&nbsp;<span class="ident" id="5223869">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223872">case</span>&nbsp;<span class="ident" id="5223877">OpCharClass</span><span class="op" id="5223888">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223892">return</span>&nbsp;<span class="ident" id="5223899">c</span><span class="op" id="5223900">.</span><span class="builtintype" id="5223901">rune</span><span class="op" id="5223905">(</span><span class="ident" id="5223906">re</span><span class="op" id="5223908">.</span><span class="ident" id="5223909">Rune</span><span class="op" id="5223913">,</span>&nbsp;<span class="ident" id="5223915">re</span><span class="op" id="5223917">.</span><span class="ident" id="5223918">Flags</span><span class="op" id="5223923">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223926">case</span>&nbsp;<span class="ident" id="5223931">OpAnyCharNotNL</span><span class="op" id="5223945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223949">return</span>&nbsp;<span class="ident" id="5223956">c</span><span class="op" id="5223957">.</span><span class="builtintype" id="5223958">rune</span><span class="op" id="5223962">(</span><span class="ident" id="5223963">anyRuneNotNL</span><span class="op" id="5223975">,</span>&nbsp;<span class="num" id="5223977">0</span><span class="op" id="5223978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223981">case</span>&nbsp;<span class="ident" id="5223986">OpAnyChar</span><span class="op" id="5223995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223999">return</span>&nbsp;<span class="ident" id="5224006">c</span><span class="op" id="5224007">.</span><span class="builtintype" id="5224008">rune</span><span class="op" id="5224012">(</span><span class="ident" id="5224013">anyRune</span><span class="op" id="5224020">,</span>&nbsp;<span class="num" id="5224022">0</span><span class="op" id="5224023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224026">case</span>&nbsp;<span class="ident" id="5224031">OpBeginLine</span><span class="op" id="5224042">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224046">return</span>&nbsp;<span class="ident" id="5224053">c</span><span class="op" id="5224054">.</span><span class="ident" id="5224055">empty</span><span class="op" id="5224060">(</span><span class="ident" id="5224061">EmptyBeginLine</span><span class="op" id="5224075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224078">case</span>&nbsp;<span class="ident" id="5224083">OpEndLine</span><span class="op" id="5224092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224096">return</span>&nbsp;<span class="ident" id="5224103">c</span><span class="op" id="5224104">.</span><span class="ident" id="5224105">empty</span><span class="op" id="5224110">(</span><span class="ident" id="5224111">EmptyEndLine</span><span class="op" id="5224123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224126">case</span>&nbsp;<span class="ident" id="5224131">OpBeginText</span><span class="op" id="5224142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224146">return</span>&nbsp;<span class="ident" id="5224153">c</span><span class="op" id="5224154">.</span><span class="ident" id="5224155">empty</span><span class="op" id="5224160">(</span><span class="ident" id="5224161">EmptyBeginText</span><span class="op" id="5224175">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224178">case</span>&nbsp;<span class="ident" id="5224183">OpEndText</span><span class="op" id="5224192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224196">return</span>&nbsp;<span class="ident" id="5224203">c</span><span class="op" id="5224204">.</span><span class="ident" id="5224205">empty</span><span class="op" id="5224210">(</span><span class="ident" id="5224211">EmptyEndText</span><span class="op" id="5224223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224226">case</span>&nbsp;<span class="ident" id="5224231">OpWordBoundary</span><span class="op" id="5224245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224249">return</span>&nbsp;<span class="ident" id="5224256">c</span><span class="op" id="5224257">.</span><span class="ident" id="5224258">empty</span><span class="op" id="5224263">(</span><span class="ident" id="5224264">EmptyWordBoundary</span><span class="op" id="5224281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224284">case</span>&nbsp;<span class="ident" id="5224289">OpNoWordBoundary</span><span class="op" id="5224305">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224309">return</span>&nbsp;<span class="ident" id="5224316">c</span><span class="op" id="5224317">.</span><span class="ident" id="5224318">empty</span><span class="op" id="5224323">(</span><span class="ident" id="5224324">EmptyNoWordBoundary</span><span class="op" id="5224343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224346">case</span>&nbsp;<span class="ident" id="5224351">OpCapture</span><span class="op" id="5224360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224364">bra</span>&nbsp;<span class="op" id="5224368">:=</span>&nbsp;<span class="ident" id="5224371">c</span><span class="op" id="5224372">.</span><span class="builtinfunc" id="5224373">cap</span><span class="op" id="5224376">(</span><span class="builtintype" id="5224377">uint32</span><span class="op" id="5224383">(</span><span class="ident" id="5224384">re</span><span class="op" id="5224386">.</span><span class="ident" id="5224387">Cap</span>&nbsp;<span class="op" id="5224391">&lt;&lt;</span>&nbsp;<span class="num" id="5224394">1</span><span class="op" id="5224395">)</span><span class="op" id="5224396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224400">sub</span>&nbsp;<span class="op" id="5224404">:=</span>&nbsp;<span class="ident" id="5224407">c</span><span class="op" id="5224408">.</span><span class="ident" id="5224409">compile</span><span class="op" id="5224416">(</span><span class="ident" id="5224417">re</span><span class="op" id="5224419">.</span><span class="ident" id="5224420">Sub</span><span class="op" id="5224423">[</span><span class="num" id="5224424">0</span><span class="op" id="5224425">]</span><span class="op" id="5224426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224430">ket</span>&nbsp;<span class="op" id="5224434">:=</span>&nbsp;<span class="ident" id="5224437">c</span><span class="op" id="5224438">.</span><span class="builtinfunc" id="5224439">cap</span><span class="op" id="5224442">(</span><span class="builtintype" id="5224443">uint32</span><span class="op" id="5224449">(</span><span class="ident" id="5224450">re</span><span class="op" id="5224452">.</span><span class="ident" id="5224453">Cap</span><span class="op" id="5224456">&lt;&lt;</span><span class="num" id="5224458">1</span>&nbsp;<span class="op" id="5224460">|</span>&nbsp;<span class="num" id="5224462">1</span><span class="op" id="5224463">)</span><span class="op" id="5224464">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224468">return</span>&nbsp;<span class="ident" id="5224475">c</span><span class="op" id="5224476">.</span><span class="ident" id="5224477">cat</span><span class="op" id="5224480">(</span><span class="ident" id="5224481">c</span><span class="op" id="5224482">.</span><span class="ident" id="5224483">cat</span><span class="op" id="5224486">(</span><span class="ident" id="5224487">bra</span><span class="op" id="5224490">,</span>&nbsp;<span class="ident" id="5224492">sub</span><span class="op" id="5224495">)</span><span class="op" id="5224496">,</span>&nbsp;<span class="ident" id="5224498">ket</span><span class="op" id="5224501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224504">case</span>&nbsp;<span class="ident" id="5224509">OpStar</span><span class="op" id="5224515">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224519">return</span>&nbsp;<span class="ident" id="5224526">c</span><span class="op" id="5224527">.</span><span class="ident" id="5224528">star</span><span class="op" id="5224532">(</span><span class="ident" id="5224533">c</span><span class="op" id="5224534">.</span><span class="ident" id="5224535">compile</span><span class="op" id="5224542">(</span><span class="ident" id="5224543">re</span><span class="op" id="5224545">.</span><span class="ident" id="5224546">Sub</span><span class="op" id="5224549">[</span><span class="num" id="5224550">0</span><span class="op" id="5224551">]</span><span class="op" id="5224552">)</span><span class="op" id="5224553">,</span>&nbsp;<span class="ident" id="5224555">re</span><span class="op" id="5224557">.</span><span class="ident" id="5224558">Flags</span><span class="op" id="5224563">&amp;</span><span class="ident" id="5224564">NonGreedy</span>&nbsp;<span class="op" id="5224574">!=</span>&nbsp;<span class="num" id="5224577">0</span><span class="op" id="5224578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224581">case</span>&nbsp;<span class="ident" id="5224586">OpPlus</span><span class="op" id="5224592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224596">return</span>&nbsp;<span class="ident" id="5224603">c</span><span class="op" id="5224604">.</span><span class="ident" id="5224605">plus</span><span class="op" id="5224609">(</span><span class="ident" id="5224610">c</span><span class="op" id="5224611">.</span><span class="ident" id="5224612">compile</span><span class="op" id="5224619">(</span><span class="ident" id="5224620">re</span><span class="op" id="5224622">.</span><span class="ident" id="5224623">Sub</span><span class="op" id="5224626">[</span><span class="num" id="5224627">0</span><span class="op" id="5224628">]</span><span class="op" id="5224629">)</span><span class="op" id="5224630">,</span>&nbsp;<span class="ident" id="5224632">re</span><span class="op" id="5224634">.</span><span class="ident" id="5224635">Flags</span><span class="op" id="5224640">&amp;</span><span class="ident" id="5224641">NonGreedy</span>&nbsp;<span class="op" id="5224651">!=</span>&nbsp;<span class="num" id="5224654">0</span><span class="op" id="5224655">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224658">case</span>&nbsp;<span class="ident" id="5224663">OpQuest</span><span class="op" id="5224670">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224674">return</span>&nbsp;<span class="ident" id="5224681">c</span><span class="op" id="5224682">.</span><span class="ident" id="5224683">quest</span><span class="op" id="5224688">(</span><span class="ident" id="5224689">c</span><span class="op" id="5224690">.</span><span class="ident" id="5224691">compile</span><span class="op" id="5224698">(</span><span class="ident" id="5224699">re</span><span class="op" id="5224701">.</span><span class="ident" id="5224702">Sub</span><span class="op" id="5224705">[</span><span class="num" id="5224706">0</span><span class="op" id="5224707">]</span><span class="op" id="5224708">)</span><span class="op" id="5224709">,</span>&nbsp;<span class="ident" id="5224711">re</span><span class="op" id="5224713">.</span><span class="ident" id="5224714">Flags</span><span class="op" id="5224719">&amp;</span><span class="ident" id="5224720">NonGreedy</span>&nbsp;<span class="op" id="5224730">!=</span>&nbsp;<span class="num" id="5224733">0</span><span class="op" id="5224734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224737">case</span>&nbsp;<span class="ident" id="5224742">OpConcat</span><span class="op" id="5224750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224754">if</span>&nbsp;<span class="builtinfunc" id="5224757">len</span><span class="op" id="5224760">(</span><span class="ident" id="5224761">re</span><span class="op" id="5224763">.</span><span class="ident" id="5224764">Sub</span><span class="op" id="5224767">)</span>&nbsp;<span class="op" id="5224769">==</span>&nbsp;<span class="num" id="5224772">0</span>&nbsp;<span class="op" id="5224774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224779">return</span>&nbsp;<span class="ident" id="5224786">c</span><span class="op" id="5224787">.</span><span class="ident" id="5224788">nop</span><span class="op" id="5224791">(</span><span class="op" id="5224792">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224800">var</span>&nbsp;<span class="ident" id="5224804">f</span>&nbsp;<span class="ident" id="5224806">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224813">for</span>&nbsp;<span class="ident" id="5224817">i</span><span class="op" id="5224818">,</span>&nbsp;<span class="ident" id="5224820">sub</span>&nbsp;<span class="op" id="5224824">:=</span>&nbsp;<span class="keyword" id="5224827">range</span>&nbsp;<span class="ident" id="5224833">re</span><span class="op" id="5224835">.</span><span class="ident" id="5224836">Sub</span>&nbsp;<span class="op" id="5224840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224845">if</span>&nbsp;<span class="ident" id="5224848">i</span>&nbsp;<span class="op" id="5224850">==</span>&nbsp;<span class="num" id="5224853">0</span>&nbsp;<span class="op" id="5224855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224861">f</span>&nbsp;<span class="op" id="5224863">=</span>&nbsp;<span class="ident" id="5224865">c</span><span class="op" id="5224866">.</span><span class="ident" id="5224867">compile</span><span class="op" id="5224874">(</span><span class="ident" id="5224875">sub</span><span class="op" id="5224878">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224883">}</span>&nbsp;<span class="keyword" id="5224885">else</span>&nbsp;<span class="op" id="5224890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224896">f</span>&nbsp;<span class="op" id="5224898">=</span>&nbsp;<span class="ident" id="5224900">c</span><span class="op" id="5224901">.</span><span class="ident" id="5224902">cat</span><span class="op" id="5224905">(</span><span class="ident" id="5224906">f</span><span class="op" id="5224907">,</span>&nbsp;<span class="ident" id="5224909">c</span><span class="op" id="5224910">.</span><span class="ident" id="5224911">compile</span><span class="op" id="5224918">(</span><span class="ident" id="5224919">sub</span><span class="op" id="5224922">)</span><span class="op" id="5224923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224936">return</span>&nbsp;<span class="ident" id="5224943">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224946">case</span>&nbsp;<span class="ident" id="5224951">OpAlternate</span><span class="op" id="5224962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224966">var</span>&nbsp;<span class="ident" id="5224970">f</span>&nbsp;<span class="ident" id="5224972">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224979">for</span>&nbsp;<span class="ident" id="5224983">_</span><span class="op" id="5224984">,</span>&nbsp;<span class="ident" id="5224986">sub</span>&nbsp;<span class="op" id="5224990">:=</span>&nbsp;<span class="keyword" id="5224993">range</span>&nbsp;<span class="ident" id="5224999">re</span><span class="op" id="5225001">.</span><span class="ident" id="5225002">Sub</span>&nbsp;<span class="op" id="5225006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225011">f</span>&nbsp;<span class="op" id="5225013">=</span>&nbsp;<span class="ident" id="5225015">c</span><span class="op" id="5225016">.</span><span class="ident" id="5225017">alt</span><span class="op" id="5225020">(</span><span class="ident" id="5225021">f</span><span class="op" id="5225022">,</span>&nbsp;<span class="ident" id="5225024">c</span><span class="op" id="5225025">.</span><span class="ident" id="5225026">compile</span><span class="op" id="5225033">(</span><span class="ident" id="5225034">sub</span><span class="op" id="5225037">)</span><span class="op" id="5225038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225042">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225046">return</span>&nbsp;<span class="ident" id="5225053">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5225059">panic</span><span class="op" id="5225064">(</span><span class="string" id="5225065">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="5225100">)</span><br>
<span class="lineno"></span><span class="op" id="5225102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5225105">func</span>&nbsp;<span class="op" id="5225110">(</span><span class="ident" id="5225111">c</span>&nbsp;<span class="op" id="5225113">*</span><span class="ident" id="5225114">compiler</span><span class="op" id="5225122">)</span>&nbsp;<span class="ident" id="5225124">inst</span><span class="op" id="5225128">(</span><span class="ident" id="5225129">op</span>&nbsp;<span class="ident" id="5225132">InstOp</span><span class="op" id="5225138">)</span>&nbsp;<span class="ident" id="5225140">frag</span>&nbsp;<span class="op" id="5225145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225148">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225178">f</span>&nbsp;<span class="op" id="5225180">:=</span>&nbsp;<span class="ident" id="5225183">frag</span><span class="op" id="5225187">{</span><span class="ident" id="5225188">i</span><span class="op" id="5225189">:</span>&nbsp;<span class="builtintype" id="5225191">uint32</span><span class="op" id="5225197">(</span><span class="builtinfunc" id="5225198">len</span><span class="op" id="5225201">(</span><span class="ident" id="5225202">c</span><span class="op" id="5225203">.</span><span class="ident" id="5225204">p</span><span class="op" id="5225205">.</span><span class="ident" id="5225206">Inst</span><span class="op" id="5225210">)</span><span class="op" id="5225211">)</span><span class="op" id="5225212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225215">c</span><span class="op" id="5225216">.</span><span class="ident" id="5225217">p</span><span class="op" id="5225218">.</span><span class="ident" id="5225219">Inst</span>&nbsp;<span class="op" id="5225224">=</span>&nbsp;<span class="builtinfunc" id="5225226">append</span><span class="op" id="5225232">(</span><span class="ident" id="5225233">c</span><span class="op" id="5225234">.</span><span class="ident" id="5225235">p</span><span class="op" id="5225236">.</span><span class="ident" id="5225237">Inst</span><span class="op" id="5225241">,</span>&nbsp;<span class="ident" id="5225243">Inst</span><span class="op" id="5225247">{</span><span class="ident" id="5225248">Op</span><span class="op" id="5225250">:</span>&nbsp;<span class="ident" id="5225252">op</span><span class="op" id="5225254">}</span><span class="op" id="5225255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225258">return</span>&nbsp;<span class="ident" id="5225265">f</span><br>
<span class="lineno">175</span><span class="op" id="5225267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5225270">func</span>&nbsp;<span class="op" id="5225275">(</span><span class="ident" id="5225276">c</span>&nbsp;<span class="op" id="5225278">*</span><span class="ident" id="5225279">compiler</span><span class="op" id="5225287">)</span>&nbsp;<span class="ident" id="5225289">nop</span><span class="op" id="5225292">(</span><span class="op" id="5225293">)</span>&nbsp;<span class="ident" id="5225295">frag</span>&nbsp;<span class="op" id="5225300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225303">f</span>&nbsp;<span class="op" id="5225305">:=</span>&nbsp;<span class="ident" id="5225308">c</span><span class="op" id="5225309">.</span><span class="ident" id="5225310">inst</span><span class="op" id="5225314">(</span><span class="ident" id="5225315">InstNop</span><span class="op" id="5225322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225325">f</span><span class="op" id="5225326">.</span><span class="ident" id="5225327">out</span>&nbsp;<span class="op" id="5225331">=</span>&nbsp;<span class="ident" id="5225333">patchList</span><span class="op" id="5225342">(</span><span class="ident" id="5225343">f</span><span class="op" id="5225344">.</span><span class="ident" id="5225345">i</span>&nbsp;<span class="op" id="5225347">&lt;&lt;</span>&nbsp;<span class="num" id="5225350">1</span><span class="op" id="5225351">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225354">return</span>&nbsp;<span class="ident" id="5225361">f</span><br>
<span class="lineno"></span><span class="op" id="5225363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5225366">func</span>&nbsp;<span class="op" id="5225371">(</span><span class="ident" id="5225372">c</span>&nbsp;<span class="op" id="5225374">*</span><span class="ident" id="5225375">compiler</span><span class="op" id="5225383">)</span>&nbsp;<span class="ident" id="5225385">fail</span><span class="op" id="5225389">(</span><span class="op" id="5225390">)</span>&nbsp;<span class="ident" id="5225392">frag</span>&nbsp;<span class="op" id="5225397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225400">return</span>&nbsp;<span class="ident" id="5225407">frag</span><span class="op" id="5225411">{</span><span class="op" id="5225412">}</span><br>
<span class="lineno">185</span><span class="op" id="5225414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5225417">func</span>&nbsp;<span class="op" id="5225422">(</span><span class="ident" id="5225423">c</span>&nbsp;<span class="op" id="5225425">*</span><span class="ident" id="5225426">compiler</span><span class="op" id="5225434">)</span>&nbsp;<span class="builtinfunc" id="5225436">cap</span><span class="op" id="5225439">(</span><span class="ident" id="5225440">arg</span>&nbsp;<span class="builtintype" id="5225444">uint32</span><span class="op" id="5225450">)</span>&nbsp;<span class="ident" id="5225452">frag</span>&nbsp;<span class="op" id="5225457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225460">f</span>&nbsp;<span class="op" id="5225462">:=</span>&nbsp;<span class="ident" id="5225465">c</span><span class="op" id="5225466">.</span><span class="ident" id="5225467">inst</span><span class="op" id="5225471">(</span><span class="ident" id="5225472">InstCapture</span><span class="op" id="5225483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225486">f</span><span class="op" id="5225487">.</span><span class="ident" id="5225488">out</span>&nbsp;<span class="op" id="5225492">=</span>&nbsp;<span class="ident" id="5225494">patchList</span><span class="op" id="5225503">(</span><span class="ident" id="5225504">f</span><span class="op" id="5225505">.</span><span class="ident" id="5225506">i</span>&nbsp;<span class="op" id="5225508">&lt;&lt;</span>&nbsp;<span class="num" id="5225511">1</span><span class="op" id="5225512">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225515">c</span><span class="op" id="5225516">.</span><span class="ident" id="5225517">p</span><span class="op" id="5225518">.</span><span class="ident" id="5225519">Inst</span><span class="op" id="5225523">[</span><span class="ident" id="5225524">f</span><span class="op" id="5225525">.</span><span class="ident" id="5225526">i</span><span class="op" id="5225527">]</span><span class="op" id="5225528">.</span><span class="ident" id="5225529">Arg</span>&nbsp;<span class="op" id="5225533">=</span>&nbsp;<span class="ident" id="5225535">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225541">if</span>&nbsp;<span class="ident" id="5225544">c</span><span class="op" id="5225545">.</span><span class="ident" id="5225546">p</span><span class="op" id="5225547">.</span><span class="ident" id="5225548">NumCap</span>&nbsp;<span class="op" id="5225555">&lt;</span>&nbsp;<span class="builtintype" id="5225557">int</span><span class="op" id="5225560">(</span><span class="ident" id="5225561">arg</span><span class="op" id="5225564">)</span><span class="op" id="5225565">+</span><span class="num" id="5225566">1</span>&nbsp;<span class="op" id="5225568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225572">c</span><span class="op" id="5225573">.</span><span class="ident" id="5225574">p</span><span class="op" id="5225575">.</span><span class="ident" id="5225576">NumCap</span>&nbsp;<span class="op" id="5225583">=</span>&nbsp;<span class="builtintype" id="5225585">int</span><span class="op" id="5225588">(</span><span class="ident" id="5225589">arg</span><span class="op" id="5225592">)</span>&nbsp;<span class="op" id="5225594">+</span>&nbsp;<span class="num" id="5225596">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225599">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225602">return</span>&nbsp;<span class="ident" id="5225609">f</span><br>
<span class="lineno"></span><span class="op" id="5225611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5225614">func</span>&nbsp;<span class="op" id="5225619">(</span><span class="ident" id="5225620">c</span>&nbsp;<span class="op" id="5225622">*</span><span class="ident" id="5225623">compiler</span><span class="op" id="5225631">)</span>&nbsp;<span class="ident" id="5225633">cat</span><span class="op" id="5225636">(</span><span class="ident" id="5225637">f1</span><span class="op" id="5225639">,</span>&nbsp;<span class="ident" id="5225641">f2</span>&nbsp;<span class="ident" id="5225644">frag</span><span class="op" id="5225648">)</span>&nbsp;<span class="ident" id="5225650">frag</span>&nbsp;<span class="op" id="5225655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225658">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225691">if</span>&nbsp;<span class="ident" id="5225694">f1</span><span class="op" id="5225696">.</span><span class="ident" id="5225697">i</span>&nbsp;<span class="op" id="5225699">==</span>&nbsp;<span class="num" id="5225702">0</span>&nbsp;<span class="op" id="5225704">||</span>&nbsp;<span class="ident" id="5225707">f2</span><span class="op" id="5225709">.</span><span class="ident" id="5225710">i</span>&nbsp;<span class="op" id="5225712">==</span>&nbsp;<span class="num" id="5225715">0</span>&nbsp;<span class="op" id="5225717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225721">return</span>&nbsp;<span class="ident" id="5225728">frag</span><span class="op" id="5225732">{</span><span class="op" id="5225733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225740">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225761">f1</span><span class="op" id="5225763">.</span><span class="ident" id="5225764">out</span><span class="op" id="5225767">.</span><span class="ident" id="5225768">patch</span><span class="op" id="5225773">(</span><span class="ident" id="5225774">c</span><span class="op" id="5225775">.</span><span class="ident" id="5225776">p</span><span class="op" id="5225777">,</span>&nbsp;<span class="ident" id="5225779">f2</span><span class="op" id="5225781">.</span><span class="ident" id="5225782">i</span><span class="op" id="5225783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225786">return</span>&nbsp;<span class="ident" id="5225793">frag</span><span class="op" id="5225797">{</span><span class="ident" id="5225798">f1</span><span class="op" id="5225800">.</span><span class="ident" id="5225801">i</span><span class="op" id="5225802">,</span>&nbsp;<span class="ident" id="5225804">f2</span><span class="op" id="5225806">.</span><span class="ident" id="5225807">out</span><span class="op" id="5225810">}</span><br>
<span class="lineno"></span><span class="op" id="5225812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="5225815">func</span>&nbsp;<span class="op" id="5225820">(</span><span class="ident" id="5225821">c</span>&nbsp;<span class="op" id="5225823">*</span><span class="ident" id="5225824">compiler</span><span class="op" id="5225832">)</span>&nbsp;<span class="ident" id="5225834">alt</span><span class="op" id="5225837">(</span><span class="ident" id="5225838">f1</span><span class="op" id="5225840">,</span>&nbsp;<span class="ident" id="5225842">f2</span>&nbsp;<span class="ident" id="5225845">frag</span><span class="op" id="5225849">)</span>&nbsp;<span class="ident" id="5225851">frag</span>&nbsp;<span class="op" id="5225856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225859">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225887">if</span>&nbsp;<span class="ident" id="5225890">f1</span><span class="op" id="5225892">.</span><span class="ident" id="5225893">i</span>&nbsp;<span class="op" id="5225895">==</span>&nbsp;<span class="num" id="5225898">0</span>&nbsp;<span class="op" id="5225900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225904">return</span>&nbsp;<span class="ident" id="5225911">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225915">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225918">if</span>&nbsp;<span class="ident" id="5225921">f2</span><span class="op" id="5225923">.</span><span class="ident" id="5225924">i</span>&nbsp;<span class="op" id="5225926">==</span>&nbsp;<span class="num" id="5225929">0</span>&nbsp;<span class="op" id="5225931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225935">return</span>&nbsp;<span class="ident" id="5225942">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225950">f</span>&nbsp;<span class="op" id="5225952">:=</span>&nbsp;<span class="ident" id="5225955">c</span><span class="op" id="5225956">.</span><span class="ident" id="5225957">inst</span><span class="op" id="5225961">(</span><span class="ident" id="5225962">InstAlt</span><span class="op" id="5225969">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225972">i</span>&nbsp;<span class="op" id="5225974">:=</span>&nbsp;<span class="op" id="5225977">&amp;</span><span class="ident" id="5225978">c</span><span class="op" id="5225979">.</span><span class="ident" id="5225980">p</span><span class="op" id="5225981">.</span><span class="ident" id="5225982">Inst</span><span class="op" id="5225986">[</span><span class="ident" id="5225987">f</span><span class="op" id="5225988">.</span><span class="ident" id="5225989">i</span><span class="op" id="5225990">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225993">i</span><span class="op" id="5225994">.</span><span class="ident" id="5225995">Out</span>&nbsp;<span class="op" id="5225999">=</span>&nbsp;<span class="ident" id="5226001">f1</span><span class="op" id="5226003">.</span><span class="ident" id="5226004">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226007">i</span><span class="op" id="5226008">.</span><span class="ident" id="5226009">Arg</span>&nbsp;<span class="op" id="5226013">=</span>&nbsp;<span class="ident" id="5226015">f2</span><span class="op" id="5226017">.</span><span class="ident" id="5226018">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226021">f</span><span class="op" id="5226022">.</span><span class="ident" id="5226023">out</span>&nbsp;<span class="op" id="5226027">=</span>&nbsp;<span class="ident" id="5226029">f1</span><span class="op" id="5226031">.</span><span class="ident" id="5226032">out</span><span class="op" id="5226035">.</span><span class="builtinfunc" id="5226036">append</span><span class="op" id="5226042">(</span><span class="ident" id="5226043">c</span><span class="op" id="5226044">.</span><span class="ident" id="5226045">p</span><span class="op" id="5226046">,</span>&nbsp;<span class="ident" id="5226048">f2</span><span class="op" id="5226050">.</span><span class="ident" id="5226051">out</span><span class="op" id="5226054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226057">return</span>&nbsp;<span class="ident" id="5226064">f</span><br>
<span class="lineno">225</span><span class="op" id="5226066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5226069">func</span>&nbsp;<span class="op" id="5226074">(</span><span class="ident" id="5226075">c</span>&nbsp;<span class="op" id="5226077">*</span><span class="ident" id="5226078">compiler</span><span class="op" id="5226086">)</span>&nbsp;<span class="ident" id="5226088">quest</span><span class="op" id="5226093">(</span><span class="ident" id="5226094">f1</span>&nbsp;<span class="ident" id="5226097">frag</span><span class="op" id="5226101">,</span>&nbsp;<span class="ident" id="5226103">nongreedy</span>&nbsp;<span class="builtintype" id="5226113">bool</span><span class="op" id="5226117">)</span>&nbsp;<span class="ident" id="5226119">frag</span>&nbsp;<span class="op" id="5226124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226127">f</span>&nbsp;<span class="op" id="5226129">:=</span>&nbsp;<span class="ident" id="5226132">c</span><span class="op" id="5226133">.</span><span class="ident" id="5226134">inst</span><span class="op" id="5226138">(</span><span class="ident" id="5226139">InstAlt</span><span class="op" id="5226146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226149">i</span>&nbsp;<span class="op" id="5226151">:=</span>&nbsp;<span class="op" id="5226154">&amp;</span><span class="ident" id="5226155">c</span><span class="op" id="5226156">.</span><span class="ident" id="5226157">p</span><span class="op" id="5226158">.</span><span class="ident" id="5226159">Inst</span><span class="op" id="5226163">[</span><span class="ident" id="5226164">f</span><span class="op" id="5226165">.</span><span class="ident" id="5226166">i</span><span class="op" id="5226167">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226170">if</span>&nbsp;<span class="ident" id="5226173">nongreedy</span>&nbsp;<span class="op" id="5226183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226187">i</span><span class="op" id="5226188">.</span><span class="ident" id="5226189">Arg</span>&nbsp;<span class="op" id="5226193">=</span>&nbsp;<span class="ident" id="5226195">f1</span><span class="op" id="5226197">.</span><span class="ident" id="5226198">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226202">f</span><span class="op" id="5226203">.</span><span class="ident" id="5226204">out</span>&nbsp;<span class="op" id="5226208">=</span>&nbsp;<span class="ident" id="5226210">patchList</span><span class="op" id="5226219">(</span><span class="ident" id="5226220">f</span><span class="op" id="5226221">.</span><span class="ident" id="5226222">i</span>&nbsp;<span class="op" id="5226224">&lt;&lt;</span>&nbsp;<span class="num" id="5226227">1</span><span class="op" id="5226228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226231">}</span>&nbsp;<span class="keyword" id="5226233">else</span>&nbsp;<span class="op" id="5226238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226242">i</span><span class="op" id="5226243">.</span><span class="ident" id="5226244">Out</span>&nbsp;<span class="op" id="5226248">=</span>&nbsp;<span class="ident" id="5226250">f1</span><span class="op" id="5226252">.</span><span class="ident" id="5226253">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226257">f</span><span class="op" id="5226258">.</span><span class="ident" id="5226259">out</span>&nbsp;<span class="op" id="5226263">=</span>&nbsp;<span class="ident" id="5226265">patchList</span><span class="op" id="5226274">(</span><span class="ident" id="5226275">f</span><span class="op" id="5226276">.</span><span class="ident" id="5226277">i</span><span class="op" id="5226278">&lt;&lt;</span><span class="num" id="5226280">1</span>&nbsp;<span class="op" id="5226282">|</span>&nbsp;<span class="num" id="5226284">1</span><span class="op" id="5226285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226291">f</span><span class="op" id="5226292">.</span><span class="ident" id="5226293">out</span>&nbsp;<span class="op" id="5226297">=</span>&nbsp;<span class="ident" id="5226299">f</span><span class="op" id="5226300">.</span><span class="ident" id="5226301">out</span><span class="op" id="5226304">.</span><span class="builtinfunc" id="5226305">append</span><span class="op" id="5226311">(</span><span class="ident" id="5226312">c</span><span class="op" id="5226313">.</span><span class="ident" id="5226314">p</span><span class="op" id="5226315">,</span>&nbsp;<span class="ident" id="5226317">f1</span><span class="op" id="5226319">.</span><span class="ident" id="5226320">out</span><span class="op" id="5226323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226326">return</span>&nbsp;<span class="ident" id="5226333">f</span><br>
<span class="lineno"></span><span class="op" id="5226335">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5226338">func</span>&nbsp;<span class="op" id="5226343">(</span><span class="ident" id="5226344">c</span>&nbsp;<span class="op" id="5226346">*</span><span class="ident" id="5226347">compiler</span><span class="op" id="5226355">)</span>&nbsp;<span class="ident" id="5226357">star</span><span class="op" id="5226361">(</span><span class="ident" id="5226362">f1</span>&nbsp;<span class="ident" id="5226365">frag</span><span class="op" id="5226369">,</span>&nbsp;<span class="ident" id="5226371">nongreedy</span>&nbsp;<span class="builtintype" id="5226381">bool</span><span class="op" id="5226385">)</span>&nbsp;<span class="ident" id="5226387">frag</span>&nbsp;<span class="op" id="5226392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226395">f</span>&nbsp;<span class="op" id="5226397">:=</span>&nbsp;<span class="ident" id="5226400">c</span><span class="op" id="5226401">.</span><span class="ident" id="5226402">inst</span><span class="op" id="5226406">(</span><span class="ident" id="5226407">InstAlt</span><span class="op" id="5226414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226417">i</span>&nbsp;<span class="op" id="5226419">:=</span>&nbsp;<span class="op" id="5226422">&amp;</span><span class="ident" id="5226423">c</span><span class="op" id="5226424">.</span><span class="ident" id="5226425">p</span><span class="op" id="5226426">.</span><span class="ident" id="5226427">Inst</span><span class="op" id="5226431">[</span><span class="ident" id="5226432">f</span><span class="op" id="5226433">.</span><span class="ident" id="5226434">i</span><span class="op" id="5226435">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226438">if</span>&nbsp;<span class="ident" id="5226441">nongreedy</span>&nbsp;<span class="op" id="5226451">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226455">i</span><span class="op" id="5226456">.</span><span class="ident" id="5226457">Arg</span>&nbsp;<span class="op" id="5226461">=</span>&nbsp;<span class="ident" id="5226463">f1</span><span class="op" id="5226465">.</span><span class="ident" id="5226466">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226470">f</span><span class="op" id="5226471">.</span><span class="ident" id="5226472">out</span>&nbsp;<span class="op" id="5226476">=</span>&nbsp;<span class="ident" id="5226478">patchList</span><span class="op" id="5226487">(</span><span class="ident" id="5226488">f</span><span class="op" id="5226489">.</span><span class="ident" id="5226490">i</span>&nbsp;<span class="op" id="5226492">&lt;&lt;</span>&nbsp;<span class="num" id="5226495">1</span><span class="op" id="5226496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226499">}</span>&nbsp;<span class="keyword" id="5226501">else</span>&nbsp;<span class="op" id="5226506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226510">i</span><span class="op" id="5226511">.</span><span class="ident" id="5226512">Out</span>&nbsp;<span class="op" id="5226516">=</span>&nbsp;<span class="ident" id="5226518">f1</span><span class="op" id="5226520">.</span><span class="ident" id="5226521">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226525">f</span><span class="op" id="5226526">.</span><span class="ident" id="5226527">out</span>&nbsp;<span class="op" id="5226531">=</span>&nbsp;<span class="ident" id="5226533">patchList</span><span class="op" id="5226542">(</span><span class="ident" id="5226543">f</span><span class="op" id="5226544">.</span><span class="ident" id="5226545">i</span><span class="op" id="5226546">&lt;&lt;</span><span class="num" id="5226548">1</span>&nbsp;<span class="op" id="5226550">|</span>&nbsp;<span class="num" id="5226552">1</span><span class="op" id="5226553">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226559">f1</span><span class="op" id="5226561">.</span><span class="ident" id="5226562">out</span><span class="op" id="5226565">.</span><span class="ident" id="5226566">patch</span><span class="op" id="5226571">(</span><span class="ident" id="5226572">c</span><span class="op" id="5226573">.</span><span class="ident" id="5226574">p</span><span class="op" id="5226575">,</span>&nbsp;<span class="ident" id="5226577">f</span><span class="op" id="5226578">.</span><span class="ident" id="5226579">i</span><span class="op" id="5226580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226583">return</span>&nbsp;<span class="ident" id="5226590">f</span><br>
<span class="lineno"></span><span class="op" id="5226592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5226595">func</span>&nbsp;<span class="op" id="5226600">(</span><span class="ident" id="5226601">c</span>&nbsp;<span class="op" id="5226603">*</span><span class="ident" id="5226604">compiler</span><span class="op" id="5226612">)</span>&nbsp;<span class="ident" id="5226614">plus</span><span class="op" id="5226618">(</span><span class="ident" id="5226619">f1</span>&nbsp;<span class="ident" id="5226622">frag</span><span class="op" id="5226626">,</span>&nbsp;<span class="ident" id="5226628">nongreedy</span>&nbsp;<span class="builtintype" id="5226638">bool</span><span class="op" id="5226642">)</span>&nbsp;<span class="ident" id="5226644">frag</span>&nbsp;<span class="op" id="5226649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226652">return</span>&nbsp;<span class="ident" id="5226659">frag</span><span class="op" id="5226663">{</span><span class="ident" id="5226664">f1</span><span class="op" id="5226666">.</span><span class="ident" id="5226667">i</span><span class="op" id="5226668">,</span>&nbsp;<span class="ident" id="5226670">c</span><span class="op" id="5226671">.</span><span class="ident" id="5226672">star</span><span class="op" id="5226676">(</span><span class="ident" id="5226677">f1</span><span class="op" id="5226679">,</span>&nbsp;<span class="ident" id="5226681">nongreedy</span><span class="op" id="5226690">)</span><span class="op" id="5226691">.</span><span class="ident" id="5226692">out</span><span class="op" id="5226695">}</span><br>
<span class="lineno"></span><span class="op" id="5226697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5226700">func</span>&nbsp;<span class="op" id="5226705">(</span><span class="ident" id="5226706">c</span>&nbsp;<span class="op" id="5226708">*</span><span class="ident" id="5226709">compiler</span><span class="op" id="5226717">)</span>&nbsp;<span class="ident" id="5226719">empty</span><span class="op" id="5226724">(</span><span class="ident" id="5226725">op</span>&nbsp;<span class="ident" id="5226728">EmptyOp</span><span class="op" id="5226735">)</span>&nbsp;<span class="ident" id="5226737">frag</span>&nbsp;<span class="op" id="5226742">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226745">f</span>&nbsp;<span class="op" id="5226747">:=</span>&nbsp;<span class="ident" id="5226750">c</span><span class="op" id="5226751">.</span><span class="ident" id="5226752">inst</span><span class="op" id="5226756">(</span><span class="ident" id="5226757">InstEmptyWidth</span><span class="op" id="5226771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226774">c</span><span class="op" id="5226775">.</span><span class="ident" id="5226776">p</span><span class="op" id="5226777">.</span><span class="ident" id="5226778">Inst</span><span class="op" id="5226782">[</span><span class="ident" id="5226783">f</span><span class="op" id="5226784">.</span><span class="ident" id="5226785">i</span><span class="op" id="5226786">]</span><span class="op" id="5226787">.</span><span class="ident" id="5226788">Arg</span>&nbsp;<span class="op" id="5226792">=</span>&nbsp;<span class="builtintype" id="5226794">uint32</span><span class="op" id="5226800">(</span><span class="ident" id="5226801">op</span><span class="op" id="5226803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226806">f</span><span class="op" id="5226807">.</span><span class="ident" id="5226808">out</span>&nbsp;<span class="op" id="5226812">=</span>&nbsp;<span class="ident" id="5226814">patchList</span><span class="op" id="5226823">(</span><span class="ident" id="5226824">f</span><span class="op" id="5226825">.</span><span class="ident" id="5226826">i</span>&nbsp;<span class="op" id="5226828">&lt;&lt;</span>&nbsp;<span class="num" id="5226831">1</span><span class="op" id="5226832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226835">return</span>&nbsp;<span class="ident" id="5226842">f</span><br>
<span class="lineno"></span><span class="op" id="5226844">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5226847">func</span>&nbsp;<span class="op" id="5226852">(</span><span class="ident" id="5226853">c</span>&nbsp;<span class="op" id="5226855">*</span><span class="ident" id="5226856">compiler</span><span class="op" id="5226864">)</span>&nbsp;<span class="builtintype" id="5226866">rune</span><span class="op" id="5226870">(</span><span class="ident" id="5226871">r</span>&nbsp;<span class="op" id="5226873">[</span><span class="op" id="5226874">]</span><span class="builtintype" id="5226875">rune</span><span class="op" id="5226879">,</span>&nbsp;<span class="ident" id="5226881">flags</span>&nbsp;<span class="ident" id="5226887">Flags</span><span class="op" id="5226892">)</span>&nbsp;<span class="ident" id="5226894">frag</span>&nbsp;<span class="op" id="5226899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226902">f</span>&nbsp;<span class="op" id="5226904">:=</span>&nbsp;<span class="ident" id="5226907">c</span><span class="op" id="5226908">.</span><span class="ident" id="5226909">inst</span><span class="op" id="5226913">(</span><span class="ident" id="5226914">InstRune</span><span class="op" id="5226922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226925">i</span>&nbsp;<span class="op" id="5226927">:=</span>&nbsp;<span class="op" id="5226930">&amp;</span><span class="ident" id="5226931">c</span><span class="op" id="5226932">.</span><span class="ident" id="5226933">p</span><span class="op" id="5226934">.</span><span class="ident" id="5226935">Inst</span><span class="op" id="5226939">[</span><span class="ident" id="5226940">f</span><span class="op" id="5226941">.</span><span class="ident" id="5226942">i</span><span class="op" id="5226943">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226946">i</span><span class="op" id="5226947">.</span><span class="ident" id="5226948">Rune</span>&nbsp;<span class="op" id="5226953">=</span>&nbsp;<span class="ident" id="5226955">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226958">flags</span>&nbsp;<span class="op" id="5226964">&amp;=</span>&nbsp;<span class="ident" id="5226967">FoldCase</span>&nbsp;<span class="comment" id="5226976">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227011">if</span>&nbsp;<span class="builtinfunc" id="5227014">len</span><span class="op" id="5227017">(</span><span class="ident" id="5227018">r</span><span class="op" id="5227019">)</span>&nbsp;<span class="op" id="5227021">!=</span>&nbsp;<span class="num" id="5227024">1</span>&nbsp;<span class="op" id="5227026">||</span>&nbsp;<span class="ident" id="5227029">unicode</span><span class="op" id="5227036">.</span><span class="ident" id="5227037">SimpleFold</span><span class="op" id="5227047">(</span><span class="ident" id="5227048">r</span><span class="op" id="5227049">[</span><span class="num" id="5227050">0</span><span class="op" id="5227051">]</span><span class="op" id="5227052">)</span>&nbsp;<span class="op" id="5227054">==</span>&nbsp;<span class="ident" id="5227057">r</span><span class="op" id="5227058">[</span><span class="num" id="5227059">0</span><span class="op" id="5227060">]</span>&nbsp;<span class="op" id="5227062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5227066">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227099">flags</span>&nbsp;<span class="op" id="5227105">&amp;^=</span>&nbsp;<span class="ident" id="5227109">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227119">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227122">i</span><span class="op" id="5227123">.</span><span class="ident" id="5227124">Arg</span>&nbsp;<span class="op" id="5227128">=</span>&nbsp;<span class="builtintype" id="5227130">uint32</span><span class="op" id="5227136">(</span><span class="ident" id="5227137">flags</span><span class="op" id="5227142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227145">f</span><span class="op" id="5227146">.</span><span class="ident" id="5227147">out</span>&nbsp;<span class="op" id="5227151">=</span>&nbsp;<span class="ident" id="5227153">patchList</span><span class="op" id="5227162">(</span><span class="ident" id="5227163">f</span><span class="op" id="5227164">.</span><span class="ident" id="5227165">i</span>&nbsp;<span class="op" id="5227167">&lt;&lt;</span>&nbsp;<span class="num" id="5227170">1</span><span class="op" id="5227171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5227175">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227211">switch</span>&nbsp;<span class="op" id="5227218">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227221">case</span>&nbsp;<span class="ident" id="5227226">flags</span><span class="op" id="5227231">&amp;</span><span class="ident" id="5227232">FoldCase</span>&nbsp;<span class="op" id="5227241">==</span>&nbsp;<span class="num" id="5227244">0</span>&nbsp;<span class="op" id="5227246">&amp;&amp;</span>&nbsp;<span class="op" id="5227249">(</span><span class="builtinfunc" id="5227250">len</span><span class="op" id="5227253">(</span><span class="ident" id="5227254">r</span><span class="op" id="5227255">)</span>&nbsp;<span class="op" id="5227257">==</span>&nbsp;<span class="num" id="5227260">1</span>&nbsp;<span class="op" id="5227262">||</span>&nbsp;<span class="builtinfunc" id="5227265">len</span><span class="op" id="5227268">(</span><span class="ident" id="5227269">r</span><span class="op" id="5227270">)</span>&nbsp;<span class="op" id="5227272">==</span>&nbsp;<span class="num" id="5227275">2</span>&nbsp;<span class="op" id="5227277">&amp;&amp;</span>&nbsp;<span class="ident" id="5227280">r</span><span class="op" id="5227281">[</span><span class="num" id="5227282">0</span><span class="op" id="5227283">]</span>&nbsp;<span class="op" id="5227285">==</span>&nbsp;<span class="ident" id="5227288">r</span><span class="op" id="5227289">[</span><span class="num" id="5227290">1</span><span class="op" id="5227291">]</span><span class="op" id="5227292">)</span><span class="op" id="5227293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227297">i</span><span class="op" id="5227298">.</span><span class="ident" id="5227299">Op</span>&nbsp;<span class="op" id="5227302">=</span>&nbsp;<span class="ident" id="5227304">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227315">case</span>&nbsp;<span class="builtinfunc" id="5227320">len</span><span class="op" id="5227323">(</span><span class="ident" id="5227324">r</span><span class="op" id="5227325">)</span>&nbsp;<span class="op" id="5227327">==</span>&nbsp;<span class="num" id="5227330">2</span>&nbsp;<span class="op" id="5227332">&amp;&amp;</span>&nbsp;<span class="ident" id="5227335">r</span><span class="op" id="5227336">[</span><span class="num" id="5227337">0</span><span class="op" id="5227338">]</span>&nbsp;<span class="op" id="5227340">==</span>&nbsp;<span class="num" id="5227343">0</span>&nbsp;<span class="op" id="5227345">&amp;&amp;</span>&nbsp;<span class="ident" id="5227348">r</span><span class="op" id="5227349">[</span><span class="num" id="5227350">1</span><span class="op" id="5227351">]</span>&nbsp;<span class="op" id="5227353">==</span>&nbsp;<span class="ident" id="5227356">unicode</span><span class="op" id="5227363">.</span><span class="ident" id="5227364">MaxRune</span><span class="op" id="5227371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227375">i</span><span class="op" id="5227376">.</span><span class="ident" id="5227377">Op</span>&nbsp;<span class="op" id="5227380">=</span>&nbsp;<span class="ident" id="5227382">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227395">case</span>&nbsp;<span class="builtinfunc" id="5227400">len</span><span class="op" id="5227403">(</span><span class="ident" id="5227404">r</span><span class="op" id="5227405">)</span>&nbsp;<span class="op" id="5227407">==</span>&nbsp;<span class="num" id="5227410">4</span>&nbsp;<span class="op" id="5227412">&amp;&amp;</span>&nbsp;<span class="ident" id="5227415">r</span><span class="op" id="5227416">[</span><span class="num" id="5227417">0</span><span class="op" id="5227418">]</span>&nbsp;<span class="op" id="5227420">==</span>&nbsp;<span class="num" id="5227423">0</span>&nbsp;<span class="op" id="5227425">&amp;&amp;</span>&nbsp;<span class="ident" id="5227428">r</span><span class="op" id="5227429">[</span><span class="num" id="5227430">1</span><span class="op" id="5227431">]</span>&nbsp;<span class="op" id="5227433">==</span>&nbsp;<span class="string" id="5227436">&#39;\n&#39;</span><span class="op" id="5227440">-</span><span class="num" id="5227441">1</span>&nbsp;<span class="op" id="5227443">&amp;&amp;</span>&nbsp;<span class="ident" id="5227446">r</span><span class="op" id="5227447">[</span><span class="num" id="5227448">2</span><span class="op" id="5227449">]</span>&nbsp;<span class="op" id="5227451">==</span>&nbsp;<span class="string" id="5227454">&#39;\n&#39;</span><span class="op" id="5227458">+</span><span class="num" id="5227459">1</span>&nbsp;<span class="op" id="5227461">&amp;&amp;</span>&nbsp;<span class="ident" id="5227464">r</span><span class="op" id="5227465">[</span><span class="num" id="5227466">3</span><span class="op" id="5227467">]</span>&nbsp;<span class="op" id="5227469">==</span>&nbsp;<span class="ident" id="5227472">unicode</span><span class="op" id="5227479">.</span><span class="ident" id="5227480">MaxRune</span><span class="op" id="5227487">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227491">i</span><span class="op" id="5227492">.</span><span class="ident" id="5227493">Op</span>&nbsp;<span class="op" id="5227496">=</span>&nbsp;<span class="ident" id="5227498">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227520">return</span>&nbsp;<span class="ident" id="5227527">f</span><br>
<span class="lineno"></span><span class="op" id="5227529">}</span>
</div>
</body>
</html>
