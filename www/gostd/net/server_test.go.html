<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8296928">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8296983">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8297037">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8297088">package</span>&nbsp;<span class="ident" id="8297096">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8297101">import</span>&nbsp;<span class="op" id="8297108">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8297111">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8297119">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8297125">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8297131">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8297142">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8297153">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8297160">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8297163">func</span>&nbsp;<span class="ident" id="8297168">skipServerTest</span><span class="op" id="8297182">(</span><span class="ident" id="8297183">net</span><span class="op" id="8297186">,</span>&nbsp;<span class="ident" id="8297188">unixsotype</span><span class="op" id="8297198">,</span>&nbsp;<span class="ident" id="8297200">addr</span>&nbsp;<span class="builtintype" id="8297205">string</span><span class="op" id="8297211">,</span>&nbsp;<span class="ident" id="8297213">ipv6</span><span class="op" id="8297217">,</span>&nbsp;<span class="ident" id="8297219">ipv4map</span><span class="op" id="8297226">,</span>&nbsp;<span class="ident" id="8297228">linuxOnly</span>&nbsp;<span class="builtintype" id="8297238">bool</span><span class="op" id="8297242">)</span>&nbsp;<span class="builtintype" id="8297244">bool</span>&nbsp;<span class="op" id="8297249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297252">switch</span>&nbsp;<span class="ident" id="8297259">runtime</span><span class="op" id="8297266">.</span><span class="ident" id="8297267">GOOS</span>&nbsp;<span class="op" id="8297272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297275">case</span>&nbsp;<span class="string" id="8297280">&#34;linux&#34;</span><span class="op" id="8297287">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297290">case</span>&nbsp;<span class="string" id="8297295">&#34;nacl&#34;</span><span class="op" id="8297301">,</span>&nbsp;<span class="string" id="8297303">&#34;plan9&#34;</span><span class="op" id="8297310">,</span>&nbsp;<span class="string" id="8297312">&#34;windows&#34;</span><span class="op" id="8297321">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8297325">//&nbsp;&#34;unix&#34;&nbsp;sockets&nbsp;are&nbsp;not&nbsp;supported&nbsp;on&nbsp;Windows&nbsp;and&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297386">if</span>&nbsp;<span class="ident" id="8297389">net</span>&nbsp;<span class="op" id="8297393">==</span>&nbsp;<span class="ident" id="8297396">unixsotype</span>&nbsp;<span class="op" id="8297407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297412">return</span>&nbsp;<span class="builtintype" id="8297419">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8297426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297429">default</span><span class="op" id="8297436">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297440">if</span>&nbsp;<span class="ident" id="8297443">net</span>&nbsp;<span class="op" id="8297447">==</span>&nbsp;<span class="ident" id="8297450">unixsotype</span>&nbsp;<span class="op" id="8297461">&amp;&amp;</span>&nbsp;<span class="ident" id="8297464">linuxOnly</span>&nbsp;<span class="op" id="8297474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297479">return</span>&nbsp;<span class="builtintype" id="8297486">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8297493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8297496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297499">switch</span>&nbsp;<span class="ident" id="8297506">addr</span>&nbsp;<span class="op" id="8297511">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297514">case</span>&nbsp;<span class="string" id="8297519">&#34;&#34;</span><span class="op" id="8297521">,</span>&nbsp;<span class="string" id="8297523">&#34;0.0.0.0&#34;</span><span class="op" id="8297532">,</span>&nbsp;<span class="string" id="8297534">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8297552">,</span>&nbsp;<span class="string" id="8297554">&#34;[::]&#34;</span><span class="op" id="8297560">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297564">if</span>&nbsp;<span class="ident" id="8297567">testing</span><span class="op" id="8297574">.</span><span class="ident" id="8297575">Short</span><span class="op" id="8297580">(</span><span class="op" id="8297581">)</span>&nbsp;<span class="op" id="8297583">||</span>&nbsp;<span class="op" id="8297586">!</span><span class="op" id="8297587">*</span><span class="ident" id="8297588">testExternal</span>&nbsp;<span class="op" id="8297601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297606">return</span>&nbsp;<span class="builtintype" id="8297613">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8297620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8297623">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297626">if</span>&nbsp;<span class="ident" id="8297629">ipv6</span>&nbsp;<span class="op" id="8297634">&amp;&amp;</span>&nbsp;<span class="op" id="8297637">!</span><span class="ident" id="8297638">supportsIPv6</span>&nbsp;<span class="op" id="8297651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297655">return</span>&nbsp;<span class="builtintype" id="8297662">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8297668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297671">if</span>&nbsp;<span class="ident" id="8297674">ipv4map</span>&nbsp;<span class="op" id="8297682">&amp;&amp;</span>&nbsp;<span class="op" id="8297685">!</span><span class="ident" id="8297686">supportsIPv4map</span>&nbsp;<span class="op" id="8297702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297706">return</span>&nbsp;<span class="builtintype" id="8297713">true</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8297719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8297722">return</span>&nbsp;<span class="builtintype" id="8297729">false</span><br>
<span class="lineno"></span><span class="op" id="8297735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8297738">var</span>&nbsp;<span class="ident" id="8297742">streamConnServerTests</span>&nbsp;<span class="op" id="8297764">=</span>&nbsp;<span class="op" id="8297766">[</span><span class="op" id="8297767">]</span><span class="keyword" id="8297768">struct</span>&nbsp;<span class="op" id="8297775">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297778">snet</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8297788">string</span>&nbsp;<span class="comment" id="8297795">//&nbsp;server&nbsp;side</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297811">saddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8297821">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297829">cnet</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8297839">string</span>&nbsp;<span class="comment" id="8297846">//&nbsp;client&nbsp;side</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297862">caddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8297872">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297880">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8297890">bool</span>&nbsp;<span class="comment" id="8297895">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297936">ipv4map</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8297946">bool</span>&nbsp;<span class="comment" id="8297951">//&nbsp;test&nbsp;with&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297997">empty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8298007">bool</span>&nbsp;<span class="comment" id="8298012">//&nbsp;test&nbsp;with&nbsp;empty&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8298037">linuxOnly</span>&nbsp;<span class="builtintype" id="8298047">bool</span>&nbsp;<span class="comment" id="8298052">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="8298106">}</span><span class="op" id="8298107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298110">{</span><span class="ident" id="8298111">snet</span><span class="op" id="8298115">:</span>&nbsp;<span class="string" id="8298117">&#34;tcp&#34;</span><span class="op" id="8298122">,</span>&nbsp;<span class="ident" id="8298124">saddr</span><span class="op" id="8298129">:</span>&nbsp;<span class="string" id="8298131">&#34;&#34;</span><span class="op" id="8298133">,</span>&nbsp;<span class="ident" id="8298135">cnet</span><span class="op" id="8298139">:</span>&nbsp;<span class="string" id="8298141">&#34;tcp&#34;</span><span class="op" id="8298146">,</span>&nbsp;<span class="ident" id="8298148">caddr</span><span class="op" id="8298153">:</span>&nbsp;<span class="string" id="8298155">&#34;127.0.0.1&#34;</span><span class="op" id="8298166">}</span><span class="op" id="8298167">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298170">{</span><span class="ident" id="8298171">snet</span><span class="op" id="8298175">:</span>&nbsp;<span class="string" id="8298177">&#34;tcp&#34;</span><span class="op" id="8298182">,</span>&nbsp;<span class="ident" id="8298184">saddr</span><span class="op" id="8298189">:</span>&nbsp;<span class="string" id="8298191">&#34;0.0.0.0&#34;</span><span class="op" id="8298200">,</span>&nbsp;<span class="ident" id="8298202">cnet</span><span class="op" id="8298206">:</span>&nbsp;<span class="string" id="8298208">&#34;tcp&#34;</span><span class="op" id="8298213">,</span>&nbsp;<span class="ident" id="8298215">caddr</span><span class="op" id="8298220">:</span>&nbsp;<span class="string" id="8298222">&#34;127.0.0.1&#34;</span><span class="op" id="8298233">}</span><span class="op" id="8298234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298237">{</span><span class="ident" id="8298238">snet</span><span class="op" id="8298242">:</span>&nbsp;<span class="string" id="8298244">&#34;tcp&#34;</span><span class="op" id="8298249">,</span>&nbsp;<span class="ident" id="8298251">saddr</span><span class="op" id="8298256">:</span>&nbsp;<span class="string" id="8298258">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8298276">,</span>&nbsp;<span class="ident" id="8298278">cnet</span><span class="op" id="8298282">:</span>&nbsp;<span class="string" id="8298284">&#34;tcp&#34;</span><span class="op" id="8298289">,</span>&nbsp;<span class="ident" id="8298291">caddr</span><span class="op" id="8298296">:</span>&nbsp;<span class="string" id="8298298">&#34;127.0.0.1&#34;</span><span class="op" id="8298309">}</span><span class="op" id="8298310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298313">{</span><span class="ident" id="8298314">snet</span><span class="op" id="8298318">:</span>&nbsp;<span class="string" id="8298320">&#34;tcp&#34;</span><span class="op" id="8298325">,</span>&nbsp;<span class="ident" id="8298327">saddr</span><span class="op" id="8298332">:</span>&nbsp;<span class="string" id="8298334">&#34;[::]&#34;</span><span class="op" id="8298340">,</span>&nbsp;<span class="ident" id="8298342">cnet</span><span class="op" id="8298346">:</span>&nbsp;<span class="string" id="8298348">&#34;tcp&#34;</span><span class="op" id="8298353">,</span>&nbsp;<span class="ident" id="8298355">caddr</span><span class="op" id="8298360">:</span>&nbsp;<span class="string" id="8298362">&#34;[::1]&#34;</span><span class="op" id="8298369">,</span>&nbsp;<span class="ident" id="8298371">ipv6</span><span class="op" id="8298375">:</span>&nbsp;<span class="builtintype" id="8298377">true</span><span class="op" id="8298381">}</span><span class="op" id="8298382">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298386">{</span><span class="ident" id="8298387">snet</span><span class="op" id="8298391">:</span>&nbsp;<span class="string" id="8298393">&#34;tcp&#34;</span><span class="op" id="8298398">,</span>&nbsp;<span class="ident" id="8298400">saddr</span><span class="op" id="8298405">:</span>&nbsp;<span class="string" id="8298407">&#34;&#34;</span><span class="op" id="8298409">,</span>&nbsp;<span class="ident" id="8298411">cnet</span><span class="op" id="8298415">:</span>&nbsp;<span class="string" id="8298417">&#34;tcp&#34;</span><span class="op" id="8298422">,</span>&nbsp;<span class="ident" id="8298424">caddr</span><span class="op" id="8298429">:</span>&nbsp;<span class="string" id="8298431">&#34;[::1]&#34;</span><span class="op" id="8298438">,</span>&nbsp;<span class="ident" id="8298440">ipv4map</span><span class="op" id="8298447">:</span>&nbsp;<span class="builtintype" id="8298449">true</span><span class="op" id="8298453">}</span><span class="op" id="8298454">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298457">{</span><span class="ident" id="8298458">snet</span><span class="op" id="8298462">:</span>&nbsp;<span class="string" id="8298464">&#34;tcp&#34;</span><span class="op" id="8298469">,</span>&nbsp;<span class="ident" id="8298471">saddr</span><span class="op" id="8298476">:</span>&nbsp;<span class="string" id="8298478">&#34;0.0.0.0&#34;</span><span class="op" id="8298487">,</span>&nbsp;<span class="ident" id="8298489">cnet</span><span class="op" id="8298493">:</span>&nbsp;<span class="string" id="8298495">&#34;tcp&#34;</span><span class="op" id="8298500">,</span>&nbsp;<span class="ident" id="8298502">caddr</span><span class="op" id="8298507">:</span>&nbsp;<span class="string" id="8298509">&#34;[::1]&#34;</span><span class="op" id="8298516">,</span>&nbsp;<span class="ident" id="8298518">ipv4map</span><span class="op" id="8298525">:</span>&nbsp;<span class="builtintype" id="8298527">true</span><span class="op" id="8298531">}</span><span class="op" id="8298532">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298535">{</span><span class="ident" id="8298536">snet</span><span class="op" id="8298540">:</span>&nbsp;<span class="string" id="8298542">&#34;tcp&#34;</span><span class="op" id="8298547">,</span>&nbsp;<span class="ident" id="8298549">saddr</span><span class="op" id="8298554">:</span>&nbsp;<span class="string" id="8298556">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8298574">,</span>&nbsp;<span class="ident" id="8298576">cnet</span><span class="op" id="8298580">:</span>&nbsp;<span class="string" id="8298582">&#34;tcp&#34;</span><span class="op" id="8298587">,</span>&nbsp;<span class="ident" id="8298589">caddr</span><span class="op" id="8298594">:</span>&nbsp;<span class="string" id="8298596">&#34;[::1]&#34;</span><span class="op" id="8298603">,</span>&nbsp;<span class="ident" id="8298605">ipv4map</span><span class="op" id="8298612">:</span>&nbsp;<span class="builtintype" id="8298614">true</span><span class="op" id="8298618">}</span><span class="op" id="8298619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298622">{</span><span class="ident" id="8298623">snet</span><span class="op" id="8298627">:</span>&nbsp;<span class="string" id="8298629">&#34;tcp&#34;</span><span class="op" id="8298634">,</span>&nbsp;<span class="ident" id="8298636">saddr</span><span class="op" id="8298641">:</span>&nbsp;<span class="string" id="8298643">&#34;[::]&#34;</span><span class="op" id="8298649">,</span>&nbsp;<span class="ident" id="8298651">cnet</span><span class="op" id="8298655">:</span>&nbsp;<span class="string" id="8298657">&#34;tcp&#34;</span><span class="op" id="8298662">,</span>&nbsp;<span class="ident" id="8298664">caddr</span><span class="op" id="8298669">:</span>&nbsp;<span class="string" id="8298671">&#34;127.0.0.1&#34;</span><span class="op" id="8298682">,</span>&nbsp;<span class="ident" id="8298684">ipv4map</span><span class="op" id="8298691">:</span>&nbsp;<span class="builtintype" id="8298693">true</span><span class="op" id="8298697">}</span><span class="op" id="8298698">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298702">{</span><span class="ident" id="8298703">snet</span><span class="op" id="8298707">:</span>&nbsp;<span class="string" id="8298709">&#34;tcp&#34;</span><span class="op" id="8298714">,</span>&nbsp;<span class="ident" id="8298716">saddr</span><span class="op" id="8298721">:</span>&nbsp;<span class="string" id="8298723">&#34;&#34;</span><span class="op" id="8298725">,</span>&nbsp;<span class="ident" id="8298727">cnet</span><span class="op" id="8298731">:</span>&nbsp;<span class="string" id="8298733">&#34;tcp4&#34;</span><span class="op" id="8298739">,</span>&nbsp;<span class="ident" id="8298741">caddr</span><span class="op" id="8298746">:</span>&nbsp;<span class="string" id="8298748">&#34;127.0.0.1&#34;</span><span class="op" id="8298759">}</span><span class="op" id="8298760">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298763">{</span><span class="ident" id="8298764">snet</span><span class="op" id="8298768">:</span>&nbsp;<span class="string" id="8298770">&#34;tcp&#34;</span><span class="op" id="8298775">,</span>&nbsp;<span class="ident" id="8298777">saddr</span><span class="op" id="8298782">:</span>&nbsp;<span class="string" id="8298784">&#34;0.0.0.0&#34;</span><span class="op" id="8298793">,</span>&nbsp;<span class="ident" id="8298795">cnet</span><span class="op" id="8298799">:</span>&nbsp;<span class="string" id="8298801">&#34;tcp4&#34;</span><span class="op" id="8298807">,</span>&nbsp;<span class="ident" id="8298809">caddr</span><span class="op" id="8298814">:</span>&nbsp;<span class="string" id="8298816">&#34;127.0.0.1&#34;</span><span class="op" id="8298827">}</span><span class="op" id="8298828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298831">{</span><span class="ident" id="8298832">snet</span><span class="op" id="8298836">:</span>&nbsp;<span class="string" id="8298838">&#34;tcp&#34;</span><span class="op" id="8298843">,</span>&nbsp;<span class="ident" id="8298845">saddr</span><span class="op" id="8298850">:</span>&nbsp;<span class="string" id="8298852">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8298870">,</span>&nbsp;<span class="ident" id="8298872">cnet</span><span class="op" id="8298876">:</span>&nbsp;<span class="string" id="8298878">&#34;tcp4&#34;</span><span class="op" id="8298884">,</span>&nbsp;<span class="ident" id="8298886">caddr</span><span class="op" id="8298891">:</span>&nbsp;<span class="string" id="8298893">&#34;127.0.0.1&#34;</span><span class="op" id="8298904">}</span><span class="op" id="8298905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298908">{</span><span class="ident" id="8298909">snet</span><span class="op" id="8298913">:</span>&nbsp;<span class="string" id="8298915">&#34;tcp&#34;</span><span class="op" id="8298920">,</span>&nbsp;<span class="ident" id="8298922">saddr</span><span class="op" id="8298927">:</span>&nbsp;<span class="string" id="8298929">&#34;[::]&#34;</span><span class="op" id="8298935">,</span>&nbsp;<span class="ident" id="8298937">cnet</span><span class="op" id="8298941">:</span>&nbsp;<span class="string" id="8298943">&#34;tcp6&#34;</span><span class="op" id="8298949">,</span>&nbsp;<span class="ident" id="8298951">caddr</span><span class="op" id="8298956">:</span>&nbsp;<span class="string" id="8298958">&#34;[::1]&#34;</span><span class="op" id="8298965">,</span>&nbsp;<span class="ident" id="8298967">ipv6</span><span class="op" id="8298971">:</span>&nbsp;<span class="builtintype" id="8298973">true</span><span class="op" id="8298977">}</span><span class="op" id="8298978">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8298982">{</span><span class="ident" id="8298983">snet</span><span class="op" id="8298987">:</span>&nbsp;<span class="string" id="8298989">&#34;tcp&#34;</span><span class="op" id="8298994">,</span>&nbsp;<span class="ident" id="8298996">saddr</span><span class="op" id="8299001">:</span>&nbsp;<span class="string" id="8299003">&#34;&#34;</span><span class="op" id="8299005">,</span>&nbsp;<span class="ident" id="8299007">cnet</span><span class="op" id="8299011">:</span>&nbsp;<span class="string" id="8299013">&#34;tcp6&#34;</span><span class="op" id="8299019">,</span>&nbsp;<span class="ident" id="8299021">caddr</span><span class="op" id="8299026">:</span>&nbsp;<span class="string" id="8299028">&#34;[::1]&#34;</span><span class="op" id="8299035">,</span>&nbsp;<span class="ident" id="8299037">ipv4map</span><span class="op" id="8299044">:</span>&nbsp;<span class="builtintype" id="8299046">true</span><span class="op" id="8299050">}</span><span class="op" id="8299051">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299054">{</span><span class="ident" id="8299055">snet</span><span class="op" id="8299059">:</span>&nbsp;<span class="string" id="8299061">&#34;tcp&#34;</span><span class="op" id="8299066">,</span>&nbsp;<span class="ident" id="8299068">saddr</span><span class="op" id="8299073">:</span>&nbsp;<span class="string" id="8299075">&#34;0.0.0.0&#34;</span><span class="op" id="8299084">,</span>&nbsp;<span class="ident" id="8299086">cnet</span><span class="op" id="8299090">:</span>&nbsp;<span class="string" id="8299092">&#34;tcp6&#34;</span><span class="op" id="8299098">,</span>&nbsp;<span class="ident" id="8299100">caddr</span><span class="op" id="8299105">:</span>&nbsp;<span class="string" id="8299107">&#34;[::1]&#34;</span><span class="op" id="8299114">,</span>&nbsp;<span class="ident" id="8299116">ipv4map</span><span class="op" id="8299123">:</span>&nbsp;<span class="builtintype" id="8299125">true</span><span class="op" id="8299129">}</span><span class="op" id="8299130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299133">{</span><span class="ident" id="8299134">snet</span><span class="op" id="8299138">:</span>&nbsp;<span class="string" id="8299140">&#34;tcp&#34;</span><span class="op" id="8299145">,</span>&nbsp;<span class="ident" id="8299147">saddr</span><span class="op" id="8299152">:</span>&nbsp;<span class="string" id="8299154">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8299172">,</span>&nbsp;<span class="ident" id="8299174">cnet</span><span class="op" id="8299178">:</span>&nbsp;<span class="string" id="8299180">&#34;tcp6&#34;</span><span class="op" id="8299186">,</span>&nbsp;<span class="ident" id="8299188">caddr</span><span class="op" id="8299193">:</span>&nbsp;<span class="string" id="8299195">&#34;[::1]&#34;</span><span class="op" id="8299202">,</span>&nbsp;<span class="ident" id="8299204">ipv4map</span><span class="op" id="8299211">:</span>&nbsp;<span class="builtintype" id="8299213">true</span><span class="op" id="8299217">}</span><span class="op" id="8299218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299221">{</span><span class="ident" id="8299222">snet</span><span class="op" id="8299226">:</span>&nbsp;<span class="string" id="8299228">&#34;tcp&#34;</span><span class="op" id="8299233">,</span>&nbsp;<span class="ident" id="8299235">saddr</span><span class="op" id="8299240">:</span>&nbsp;<span class="string" id="8299242">&#34;[::]&#34;</span><span class="op" id="8299248">,</span>&nbsp;<span class="ident" id="8299250">cnet</span><span class="op" id="8299254">:</span>&nbsp;<span class="string" id="8299256">&#34;tcp4&#34;</span><span class="op" id="8299262">,</span>&nbsp;<span class="ident" id="8299264">caddr</span><span class="op" id="8299269">:</span>&nbsp;<span class="string" id="8299271">&#34;127.0.0.1&#34;</span><span class="op" id="8299282">,</span>&nbsp;<span class="ident" id="8299284">ipv4map</span><span class="op" id="8299291">:</span>&nbsp;<span class="builtintype" id="8299293">true</span><span class="op" id="8299297">}</span><span class="op" id="8299298">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299302">{</span><span class="ident" id="8299303">snet</span><span class="op" id="8299307">:</span>&nbsp;<span class="string" id="8299309">&#34;tcp&#34;</span><span class="op" id="8299314">,</span>&nbsp;<span class="ident" id="8299316">saddr</span><span class="op" id="8299321">:</span>&nbsp;<span class="string" id="8299323">&#34;127.0.0.1&#34;</span><span class="op" id="8299334">,</span>&nbsp;<span class="ident" id="8299336">cnet</span><span class="op" id="8299340">:</span>&nbsp;<span class="string" id="8299342">&#34;tcp&#34;</span><span class="op" id="8299347">,</span>&nbsp;<span class="ident" id="8299349">caddr</span><span class="op" id="8299354">:</span>&nbsp;<span class="string" id="8299356">&#34;127.0.0.1&#34;</span><span class="op" id="8299367">}</span><span class="op" id="8299368">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299371">{</span><span class="ident" id="8299372">snet</span><span class="op" id="8299376">:</span>&nbsp;<span class="string" id="8299378">&#34;tcp&#34;</span><span class="op" id="8299383">,</span>&nbsp;<span class="ident" id="8299385">saddr</span><span class="op" id="8299390">:</span>&nbsp;<span class="string" id="8299392">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8299412">,</span>&nbsp;<span class="ident" id="8299414">cnet</span><span class="op" id="8299418">:</span>&nbsp;<span class="string" id="8299420">&#34;tcp&#34;</span><span class="op" id="8299425">,</span>&nbsp;<span class="ident" id="8299427">caddr</span><span class="op" id="8299432">:</span>&nbsp;<span class="string" id="8299434">&#34;127.0.0.1&#34;</span><span class="op" id="8299445">}</span><span class="op" id="8299446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299449">{</span><span class="ident" id="8299450">snet</span><span class="op" id="8299454">:</span>&nbsp;<span class="string" id="8299456">&#34;tcp&#34;</span><span class="op" id="8299461">,</span>&nbsp;<span class="ident" id="8299463">saddr</span><span class="op" id="8299468">:</span>&nbsp;<span class="string" id="8299470">&#34;[::1]&#34;</span><span class="op" id="8299477">,</span>&nbsp;<span class="ident" id="8299479">cnet</span><span class="op" id="8299483">:</span>&nbsp;<span class="string" id="8299485">&#34;tcp&#34;</span><span class="op" id="8299490">,</span>&nbsp;<span class="ident" id="8299492">caddr</span><span class="op" id="8299497">:</span>&nbsp;<span class="string" id="8299499">&#34;[::1]&#34;</span><span class="op" id="8299506">,</span>&nbsp;<span class="ident" id="8299508">ipv6</span><span class="op" id="8299512">:</span>&nbsp;<span class="builtintype" id="8299514">true</span><span class="op" id="8299518">}</span><span class="op" id="8299519">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299523">{</span><span class="ident" id="8299524">snet</span><span class="op" id="8299528">:</span>&nbsp;<span class="string" id="8299530">&#34;tcp4&#34;</span><span class="op" id="8299536">,</span>&nbsp;<span class="ident" id="8299538">saddr</span><span class="op" id="8299543">:</span>&nbsp;<span class="string" id="8299545">&#34;&#34;</span><span class="op" id="8299547">,</span>&nbsp;<span class="ident" id="8299549">cnet</span><span class="op" id="8299553">:</span>&nbsp;<span class="string" id="8299555">&#34;tcp4&#34;</span><span class="op" id="8299561">,</span>&nbsp;<span class="ident" id="8299563">caddr</span><span class="op" id="8299568">:</span>&nbsp;<span class="string" id="8299570">&#34;127.0.0.1&#34;</span><span class="op" id="8299581">}</span><span class="op" id="8299582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299585">{</span><span class="ident" id="8299586">snet</span><span class="op" id="8299590">:</span>&nbsp;<span class="string" id="8299592">&#34;tcp4&#34;</span><span class="op" id="8299598">,</span>&nbsp;<span class="ident" id="8299600">saddr</span><span class="op" id="8299605">:</span>&nbsp;<span class="string" id="8299607">&#34;0.0.0.0&#34;</span><span class="op" id="8299616">,</span>&nbsp;<span class="ident" id="8299618">cnet</span><span class="op" id="8299622">:</span>&nbsp;<span class="string" id="8299624">&#34;tcp4&#34;</span><span class="op" id="8299630">,</span>&nbsp;<span class="ident" id="8299632">caddr</span><span class="op" id="8299637">:</span>&nbsp;<span class="string" id="8299639">&#34;127.0.0.1&#34;</span><span class="op" id="8299650">}</span><span class="op" id="8299651">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299654">{</span><span class="ident" id="8299655">snet</span><span class="op" id="8299659">:</span>&nbsp;<span class="string" id="8299661">&#34;tcp4&#34;</span><span class="op" id="8299667">,</span>&nbsp;<span class="ident" id="8299669">saddr</span><span class="op" id="8299674">:</span>&nbsp;<span class="string" id="8299676">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8299694">,</span>&nbsp;<span class="ident" id="8299696">cnet</span><span class="op" id="8299700">:</span>&nbsp;<span class="string" id="8299702">&#34;tcp4&#34;</span><span class="op" id="8299708">,</span>&nbsp;<span class="ident" id="8299710">caddr</span><span class="op" id="8299715">:</span>&nbsp;<span class="string" id="8299717">&#34;127.0.0.1&#34;</span><span class="op" id="8299728">}</span><span class="op" id="8299729">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299733">{</span><span class="ident" id="8299734">snet</span><span class="op" id="8299738">:</span>&nbsp;<span class="string" id="8299740">&#34;tcp4&#34;</span><span class="op" id="8299746">,</span>&nbsp;<span class="ident" id="8299748">saddr</span><span class="op" id="8299753">:</span>&nbsp;<span class="string" id="8299755">&#34;127.0.0.1&#34;</span><span class="op" id="8299766">,</span>&nbsp;<span class="ident" id="8299768">cnet</span><span class="op" id="8299772">:</span>&nbsp;<span class="string" id="8299774">&#34;tcp4&#34;</span><span class="op" id="8299780">,</span>&nbsp;<span class="ident" id="8299782">caddr</span><span class="op" id="8299787">:</span>&nbsp;<span class="string" id="8299789">&#34;127.0.0.1&#34;</span><span class="op" id="8299800">}</span><span class="op" id="8299801">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299805">{</span><span class="ident" id="8299806">snet</span><span class="op" id="8299810">:</span>&nbsp;<span class="string" id="8299812">&#34;tcp6&#34;</span><span class="op" id="8299818">,</span>&nbsp;<span class="ident" id="8299820">saddr</span><span class="op" id="8299825">:</span>&nbsp;<span class="string" id="8299827">&#34;&#34;</span><span class="op" id="8299829">,</span>&nbsp;<span class="ident" id="8299831">cnet</span><span class="op" id="8299835">:</span>&nbsp;<span class="string" id="8299837">&#34;tcp6&#34;</span><span class="op" id="8299843">,</span>&nbsp;<span class="ident" id="8299845">caddr</span><span class="op" id="8299850">:</span>&nbsp;<span class="string" id="8299852">&#34;[::1]&#34;</span><span class="op" id="8299859">,</span>&nbsp;<span class="ident" id="8299861">ipv6</span><span class="op" id="8299865">:</span>&nbsp;<span class="builtintype" id="8299867">true</span><span class="op" id="8299871">}</span><span class="op" id="8299872">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299875">{</span><span class="ident" id="8299876">snet</span><span class="op" id="8299880">:</span>&nbsp;<span class="string" id="8299882">&#34;tcp6&#34;</span><span class="op" id="8299888">,</span>&nbsp;<span class="ident" id="8299890">saddr</span><span class="op" id="8299895">:</span>&nbsp;<span class="string" id="8299897">&#34;[::]&#34;</span><span class="op" id="8299903">,</span>&nbsp;<span class="ident" id="8299905">cnet</span><span class="op" id="8299909">:</span>&nbsp;<span class="string" id="8299911">&#34;tcp6&#34;</span><span class="op" id="8299917">,</span>&nbsp;<span class="ident" id="8299919">caddr</span><span class="op" id="8299924">:</span>&nbsp;<span class="string" id="8299926">&#34;[::1]&#34;</span><span class="op" id="8299933">,</span>&nbsp;<span class="ident" id="8299935">ipv6</span><span class="op" id="8299939">:</span>&nbsp;<span class="builtintype" id="8299941">true</span><span class="op" id="8299945">}</span><span class="op" id="8299946">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8299950">{</span><span class="ident" id="8299951">snet</span><span class="op" id="8299955">:</span>&nbsp;<span class="string" id="8299957">&#34;tcp6&#34;</span><span class="op" id="8299963">,</span>&nbsp;<span class="ident" id="8299965">saddr</span><span class="op" id="8299970">:</span>&nbsp;<span class="string" id="8299972">&#34;[::1]&#34;</span><span class="op" id="8299979">,</span>&nbsp;<span class="ident" id="8299981">cnet</span><span class="op" id="8299985">:</span>&nbsp;<span class="string" id="8299987">&#34;tcp6&#34;</span><span class="op" id="8299993">,</span>&nbsp;<span class="ident" id="8299995">caddr</span><span class="op" id="8300000">:</span>&nbsp;<span class="string" id="8300002">&#34;[::1]&#34;</span><span class="op" id="8300009">,</span>&nbsp;<span class="ident" id="8300011">ipv6</span><span class="op" id="8300015">:</span>&nbsp;<span class="builtintype" id="8300017">true</span><span class="op" id="8300021">}</span><span class="op" id="8300022">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8300026">{</span><span class="ident" id="8300027">snet</span><span class="op" id="8300031">:</span>&nbsp;<span class="string" id="8300033">&#34;unix&#34;</span><span class="op" id="8300039">,</span>&nbsp;<span class="ident" id="8300041">saddr</span><span class="op" id="8300046">:</span>&nbsp;<span class="ident" id="8300048">testUnixAddr</span><span class="op" id="8300060">(</span><span class="op" id="8300061">)</span><span class="op" id="8300062">,</span>&nbsp;<span class="ident" id="8300064">cnet</span><span class="op" id="8300068">:</span>&nbsp;<span class="string" id="8300070">&#34;unix&#34;</span><span class="op" id="8300076">,</span>&nbsp;<span class="ident" id="8300078">caddr</span><span class="op" id="8300083">:</span>&nbsp;<span class="ident" id="8300085">testUnixAddr</span><span class="op" id="8300097">(</span><span class="op" id="8300098">)</span><span class="op" id="8300099">}</span><span class="op" id="8300100">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8300103">{</span><span class="ident" id="8300104">snet</span><span class="op" id="8300108">:</span>&nbsp;<span class="string" id="8300110">&#34;unix&#34;</span><span class="op" id="8300116">,</span>&nbsp;<span class="ident" id="8300118">saddr</span><span class="op" id="8300123">:</span>&nbsp;<span class="string" id="8300125">&#34;@gotest2/net&#34;</span><span class="op" id="8300139">,</span>&nbsp;<span class="ident" id="8300141">cnet</span><span class="op" id="8300145">:</span>&nbsp;<span class="string" id="8300147">&#34;unix&#34;</span><span class="op" id="8300153">,</span>&nbsp;<span class="ident" id="8300155">caddr</span><span class="op" id="8300160">:</span>&nbsp;<span class="string" id="8300162">&#34;@gotest2/net.local&#34;</span><span class="op" id="8300182">,</span>&nbsp;<span class="ident" id="8300184">linuxOnly</span><span class="op" id="8300193">:</span>&nbsp;<span class="builtintype" id="8300195">true</span><span class="op" id="8300199">}</span><span class="op" id="8300200">,</span><br>
<span class="lineno"></span><span class="op" id="8300202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8300205">func</span>&nbsp;<span class="ident" id="8300210">TestStreamConnServer</span><span class="op" id="8300230">(</span><span class="ident" id="8300231">t</span>&nbsp;<span class="op" id="8300233">*</span><span class="ident" id="8300234">testing</span><span class="op" id="8300241">.</span><span class="ident" id="8300242">T</span><span class="op" id="8300243">)</span>&nbsp;<span class="op" id="8300245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300248">for</span>&nbsp;<span class="ident" id="8300252">_</span><span class="op" id="8300253">,</span>&nbsp;<span class="ident" id="8300255">tt</span>&nbsp;<span class="op" id="8300258">:=</span>&nbsp;<span class="keyword" id="8300261">range</span>&nbsp;<span class="ident" id="8300267">streamConnServerTests</span>&nbsp;<span class="op" id="8300289">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300293">if</span>&nbsp;<span class="ident" id="8300296">skipServerTest</span><span class="op" id="8300310">(</span><span class="ident" id="8300311">tt</span><span class="op" id="8300313">.</span><span class="ident" id="8300314">snet</span><span class="op" id="8300318">,</span>&nbsp;<span class="string" id="8300320">&#34;unix&#34;</span><span class="op" id="8300326">,</span>&nbsp;<span class="ident" id="8300328">tt</span><span class="op" id="8300330">.</span><span class="ident" id="8300331">saddr</span><span class="op" id="8300336">,</span>&nbsp;<span class="ident" id="8300338">tt</span><span class="op" id="8300340">.</span><span class="ident" id="8300341">ipv6</span><span class="op" id="8300345">,</span>&nbsp;<span class="ident" id="8300347">tt</span><span class="op" id="8300349">.</span><span class="ident" id="8300350">ipv4map</span><span class="op" id="8300357">,</span>&nbsp;<span class="ident" id="8300359">tt</span><span class="op" id="8300361">.</span><span class="ident" id="8300362">linuxOnly</span><span class="op" id="8300371">)</span>&nbsp;<span class="op" id="8300373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300378">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8300389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300394">listening</span>&nbsp;<span class="op" id="8300404">:=</span>&nbsp;<span class="builtinfunc" id="8300407">make</span><span class="op" id="8300411">(</span><span class="keyword" id="8300412">chan</span>&nbsp;<span class="builtintype" id="8300417">string</span><span class="op" id="8300423">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300427">done</span>&nbsp;<span class="op" id="8300432">:=</span>&nbsp;<span class="builtinfunc" id="8300435">make</span><span class="op" id="8300439">(</span><span class="keyword" id="8300440">chan</span>&nbsp;<span class="builtintype" id="8300445">int</span><span class="op" id="8300448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300452">switch</span>&nbsp;<span class="ident" id="8300459">tt</span><span class="op" id="8300461">.</span><span class="ident" id="8300462">snet</span>&nbsp;<span class="op" id="8300467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300471">case</span>&nbsp;<span class="string" id="8300476">&#34;tcp&#34;</span><span class="op" id="8300481">,</span>&nbsp;<span class="string" id="8300483">&#34;tcp4&#34;</span><span class="op" id="8300489">,</span>&nbsp;<span class="string" id="8300491">&#34;tcp6&#34;</span><span class="op" id="8300497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300502">tt</span><span class="op" id="8300504">.</span><span class="ident" id="8300505">saddr</span>&nbsp;<span class="op" id="8300511">+=</span>&nbsp;<span class="string" id="8300514">&#34;:0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300521">case</span>&nbsp;<span class="string" id="8300526">&#34;unix&#34;</span><span class="op" id="8300532">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300537">os</span><span class="op" id="8300539">.</span><span class="ident" id="8300540">Remove</span><span class="op" id="8300546">(</span><span class="ident" id="8300547">tt</span><span class="op" id="8300549">.</span><span class="ident" id="8300550">saddr</span><span class="op" id="8300555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300560">os</span><span class="op" id="8300562">.</span><span class="ident" id="8300563">Remove</span><span class="op" id="8300569">(</span><span class="ident" id="8300570">tt</span><span class="op" id="8300572">.</span><span class="ident" id="8300573">caddr</span><span class="op" id="8300578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8300582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300587">go</span>&nbsp;<span class="ident" id="8300590">runStreamConnServer</span><span class="op" id="8300609">(</span><span class="ident" id="8300610">t</span><span class="op" id="8300611">,</span>&nbsp;<span class="ident" id="8300613">tt</span><span class="op" id="8300615">.</span><span class="ident" id="8300616">snet</span><span class="op" id="8300620">,</span>&nbsp;<span class="ident" id="8300622">tt</span><span class="op" id="8300624">.</span><span class="ident" id="8300625">saddr</span><span class="op" id="8300630">,</span>&nbsp;<span class="ident" id="8300632">listening</span><span class="op" id="8300641">,</span>&nbsp;<span class="ident" id="8300643">done</span><span class="op" id="8300647">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300651">taddr</span>&nbsp;<span class="op" id="8300657">:=</span>&nbsp;<span class="op" id="8300660">&lt;-</span><span class="ident" id="8300662">listening</span>&nbsp;<span class="comment" id="8300672">//&nbsp;wait&nbsp;for&nbsp;server&nbsp;to&nbsp;start</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300703">switch</span>&nbsp;<span class="ident" id="8300710">tt</span><span class="op" id="8300712">.</span><span class="ident" id="8300713">cnet</span>&nbsp;<span class="op" id="8300718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300722">case</span>&nbsp;<span class="string" id="8300727">&#34;tcp&#34;</span><span class="op" id="8300732">,</span>&nbsp;<span class="string" id="8300734">&#34;tcp4&#34;</span><span class="op" id="8300740">,</span>&nbsp;<span class="string" id="8300742">&#34;tcp6&#34;</span><span class="op" id="8300748">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300753">_</span><span class="op" id="8300754">,</span>&nbsp;<span class="ident" id="8300756">port</span><span class="op" id="8300760">,</span>&nbsp;<span class="ident" id="8300762">err</span>&nbsp;<span class="op" id="8300766">:=</span>&nbsp;<span class="ident" id="8300769">SplitHostPort</span><span class="op" id="8300782">(</span><span class="ident" id="8300783">taddr</span><span class="op" id="8300788">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300793">if</span>&nbsp;<span class="ident" id="8300796">err</span>&nbsp;<span class="op" id="8300800">!=</span>&nbsp;<span class="ident" id="8300803">nil</span>&nbsp;<span class="op" id="8300807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300813">t</span><span class="op" id="8300814">.</span><span class="ident" id="8300815">Fatalf</span><span class="op" id="8300821">(</span><span class="string" id="8300822">&#34;SplitHostPort(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8300852">,</span>&nbsp;<span class="ident" id="8300854">taddr</span><span class="op" id="8300859">,</span>&nbsp;<span class="ident" id="8300861">err</span><span class="op" id="8300864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8300869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300874">taddr</span>&nbsp;<span class="op" id="8300880">=</span>&nbsp;<span class="ident" id="8300882">tt</span><span class="op" id="8300884">.</span><span class="ident" id="8300885">caddr</span>&nbsp;<span class="op" id="8300891">+</span>&nbsp;<span class="string" id="8300893">&#34;:&#34;</span>&nbsp;<span class="op" id="8300897">+</span>&nbsp;<span class="ident" id="8300899">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8300906">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300911">runStreamConnClient</span><span class="op" id="8300930">(</span><span class="ident" id="8300931">t</span><span class="op" id="8300932">,</span>&nbsp;<span class="ident" id="8300934">tt</span><span class="op" id="8300936">.</span><span class="ident" id="8300937">cnet</span><span class="op" id="8300941">,</span>&nbsp;<span class="ident" id="8300943">taddr</span><span class="op" id="8300948">,</span>&nbsp;<span class="ident" id="8300950">tt</span><span class="op" id="8300952">.</span><span class="ident" id="8300953">empty</span><span class="op" id="8300958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8300962">&lt;-</span><span class="ident" id="8300964">done</span>&nbsp;<span class="comment" id="8300969">//&nbsp;make&nbsp;sure&nbsp;server&nbsp;stopped</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301000">switch</span>&nbsp;<span class="ident" id="8301007">tt</span><span class="op" id="8301009">.</span><span class="ident" id="8301010">snet</span>&nbsp;<span class="op" id="8301015">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301019">case</span>&nbsp;<span class="string" id="8301024">&#34;unix&#34;</span><span class="op" id="8301030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301035">os</span><span class="op" id="8301037">.</span><span class="ident" id="8301038">Remove</span><span class="op" id="8301044">(</span><span class="ident" id="8301045">tt</span><span class="op" id="8301047">.</span><span class="ident" id="8301048">saddr</span><span class="op" id="8301053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301058">os</span><span class="op" id="8301060">.</span><span class="ident" id="8301061">Remove</span><span class="op" id="8301067">(</span><span class="ident" id="8301068">tt</span><span class="op" id="8301070">.</span><span class="ident" id="8301071">caddr</span><span class="op" id="8301076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301083">}</span><br>
<span class="lineno">130</span><span class="op" id="8301085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8301088">var</span>&nbsp;<span class="ident" id="8301092">seqpacketConnServerTests</span>&nbsp;<span class="op" id="8301117">=</span>&nbsp;<span class="op" id="8301119">[</span><span class="op" id="8301120">]</span><span class="keyword" id="8301121">struct</span>&nbsp;<span class="op" id="8301128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301131">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8301141">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301149">saddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8301159">string</span>&nbsp;<span class="comment" id="8301166">//&nbsp;server&nbsp;address</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301185">caddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8301195">string</span>&nbsp;<span class="comment" id="8301202">//&nbsp;client&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301221">empty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8301231">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8301238">//&nbsp;test&nbsp;with&nbsp;empty&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301263">linuxOnly</span>&nbsp;<span class="builtintype" id="8301273">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8301280">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="8301334">}</span><span class="op" id="8301335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301338">{</span><span class="ident" id="8301339">net</span><span class="op" id="8301342">:</span>&nbsp;<span class="string" id="8301344">&#34;unixpacket&#34;</span><span class="op" id="8301356">,</span>&nbsp;<span class="ident" id="8301358">saddr</span><span class="op" id="8301363">:</span>&nbsp;<span class="ident" id="8301365">testUnixAddr</span><span class="op" id="8301377">(</span><span class="op" id="8301378">)</span><span class="op" id="8301379">,</span>&nbsp;<span class="ident" id="8301381">caddr</span><span class="op" id="8301386">:</span>&nbsp;<span class="ident" id="8301388">testUnixAddr</span><span class="op" id="8301400">(</span><span class="op" id="8301401">)</span><span class="op" id="8301402">}</span><span class="op" id="8301403">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301406">{</span><span class="ident" id="8301407">net</span><span class="op" id="8301410">:</span>&nbsp;<span class="string" id="8301412">&#34;unixpacket&#34;</span><span class="op" id="8301424">,</span>&nbsp;<span class="ident" id="8301426">saddr</span><span class="op" id="8301431">:</span>&nbsp;<span class="string" id="8301433">&#34;@gotest4/net&#34;</span><span class="op" id="8301447">,</span>&nbsp;<span class="ident" id="8301449">caddr</span><span class="op" id="8301454">:</span>&nbsp;<span class="string" id="8301456">&#34;@gotest4/net.local&#34;</span><span class="op" id="8301476">,</span>&nbsp;<span class="ident" id="8301478">linuxOnly</span><span class="op" id="8301487">:</span>&nbsp;<span class="builtintype" id="8301489">true</span><span class="op" id="8301493">}</span><span class="op" id="8301494">,</span><br>
<span class="lineno"></span><span class="op" id="8301496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8301499">func</span>&nbsp;<span class="ident" id="8301504">TestSeqpacketConnServer</span><span class="op" id="8301527">(</span><span class="ident" id="8301528">t</span>&nbsp;<span class="op" id="8301530">*</span><span class="ident" id="8301531">testing</span><span class="op" id="8301538">.</span><span class="ident" id="8301539">T</span><span class="op" id="8301540">)</span>&nbsp;<span class="op" id="8301542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301545">switch</span>&nbsp;<span class="ident" id="8301552">runtime</span><span class="op" id="8301559">.</span><span class="ident" id="8301560">GOOS</span>&nbsp;<span class="op" id="8301565">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301568">case</span>&nbsp;<span class="string" id="8301573">&#34;darwin&#34;</span><span class="op" id="8301581">,</span>&nbsp;<span class="string" id="8301583">&#34;nacl&#34;</span><span class="op" id="8301589">,</span>&nbsp;<span class="string" id="8301591">&#34;openbsd&#34;</span><span class="op" id="8301600">,</span>&nbsp;<span class="string" id="8301602">&#34;plan9&#34;</span><span class="op" id="8301609">,</span>&nbsp;<span class="string" id="8301611">&#34;windows&#34;</span><span class="op" id="8301620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301624">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301637">case</span>&nbsp;<span class="string" id="8301642">&#34;freebsd&#34;</span><span class="op" id="8301651">:</span>&nbsp;<span class="comment" id="8301653">//&nbsp;FreeBSD&nbsp;8&nbsp;doesn&#39;t&nbsp;support&nbsp;unixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301695">t</span><span class="op" id="8301696">.</span><span class="ident" id="8301697">Skipf</span><span class="op" id="8301702">(</span><span class="string" id="8301703">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8301724">,</span>&nbsp;<span class="ident" id="8301726">runtime</span><span class="op" id="8301733">.</span><span class="ident" id="8301734">GOOS</span><span class="op" id="8301738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301741">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301745">for</span>&nbsp;<span class="ident" id="8301749">_</span><span class="op" id="8301750">,</span>&nbsp;<span class="ident" id="8301752">tt</span>&nbsp;<span class="op" id="8301755">:=</span>&nbsp;<span class="keyword" id="8301758">range</span>&nbsp;<span class="ident" id="8301764">seqpacketConnServerTests</span>&nbsp;<span class="op" id="8301789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301793">if</span>&nbsp;<span class="ident" id="8301796">runtime</span><span class="op" id="8301803">.</span><span class="ident" id="8301804">GOOS</span>&nbsp;<span class="op" id="8301809">!=</span>&nbsp;<span class="string" id="8301812">&#34;linux&#34;</span>&nbsp;<span class="op" id="8301820">&amp;&amp;</span>&nbsp;<span class="ident" id="8301823">tt</span><span class="op" id="8301825">.</span><span class="ident" id="8301826">linuxOnly</span>&nbsp;<span class="op" id="8301836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301841">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301852">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301856">listening</span>&nbsp;<span class="op" id="8301866">:=</span>&nbsp;<span class="builtinfunc" id="8301869">make</span><span class="op" id="8301873">(</span><span class="keyword" id="8301874">chan</span>&nbsp;<span class="builtintype" id="8301879">string</span><span class="op" id="8301885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301889">done</span>&nbsp;<span class="op" id="8301894">:=</span>&nbsp;<span class="builtinfunc" id="8301897">make</span><span class="op" id="8301901">(</span><span class="keyword" id="8301902">chan</span>&nbsp;<span class="builtintype" id="8301907">int</span><span class="op" id="8301910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301914">switch</span>&nbsp;<span class="ident" id="8301921">tt</span><span class="op" id="8301923">.</span><span class="ident" id="8301924">net</span>&nbsp;<span class="op" id="8301928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301932">case</span>&nbsp;<span class="string" id="8301937">&#34;unixpacket&#34;</span><span class="op" id="8301949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301954">os</span><span class="op" id="8301956">.</span><span class="ident" id="8301957">Remove</span><span class="op" id="8301963">(</span><span class="ident" id="8301964">tt</span><span class="op" id="8301966">.</span><span class="ident" id="8301967">saddr</span><span class="op" id="8301972">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301977">os</span><span class="op" id="8301979">.</span><span class="ident" id="8301980">Remove</span><span class="op" id="8301986">(</span><span class="ident" id="8301987">tt</span><span class="op" id="8301989">.</span><span class="ident" id="8301990">caddr</span><span class="op" id="8301995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302004">go</span>&nbsp;<span class="ident" id="8302007">runStreamConnServer</span><span class="op" id="8302026">(</span><span class="ident" id="8302027">t</span><span class="op" id="8302028">,</span>&nbsp;<span class="ident" id="8302030">tt</span><span class="op" id="8302032">.</span><span class="ident" id="8302033">net</span><span class="op" id="8302036">,</span>&nbsp;<span class="ident" id="8302038">tt</span><span class="op" id="8302040">.</span><span class="ident" id="8302041">saddr</span><span class="op" id="8302046">,</span>&nbsp;<span class="ident" id="8302048">listening</span><span class="op" id="8302057">,</span>&nbsp;<span class="ident" id="8302059">done</span><span class="op" id="8302063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302067">taddr</span>&nbsp;<span class="op" id="8302073">:=</span>&nbsp;<span class="op" id="8302076">&lt;-</span><span class="ident" id="8302078">listening</span>&nbsp;<span class="comment" id="8302088">//&nbsp;wait&nbsp;for&nbsp;server&nbsp;to&nbsp;start</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302119">runStreamConnClient</span><span class="op" id="8302138">(</span><span class="ident" id="8302139">t</span><span class="op" id="8302140">,</span>&nbsp;<span class="ident" id="8302142">tt</span><span class="op" id="8302144">.</span><span class="ident" id="8302145">net</span><span class="op" id="8302148">,</span>&nbsp;<span class="ident" id="8302150">taddr</span><span class="op" id="8302155">,</span>&nbsp;<span class="ident" id="8302157">tt</span><span class="op" id="8302159">.</span><span class="ident" id="8302160">empty</span><span class="op" id="8302165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302169">&lt;-</span><span class="ident" id="8302171">done</span>&nbsp;<span class="comment" id="8302176">//&nbsp;make&nbsp;sure&nbsp;server&nbsp;stopped</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302207">switch</span>&nbsp;<span class="ident" id="8302214">tt</span><span class="op" id="8302216">.</span><span class="ident" id="8302217">net</span>&nbsp;<span class="op" id="8302221">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302225">case</span>&nbsp;<span class="string" id="8302230">&#34;unixpacket&#34;</span><span class="op" id="8302242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302247">os</span><span class="op" id="8302249">.</span><span class="ident" id="8302250">Remove</span><span class="op" id="8302256">(</span><span class="ident" id="8302257">tt</span><span class="op" id="8302259">.</span><span class="ident" id="8302260">saddr</span><span class="op" id="8302265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302270">os</span><span class="op" id="8302272">.</span><span class="ident" id="8302273">Remove</span><span class="op" id="8302279">(</span><span class="ident" id="8302280">tt</span><span class="op" id="8302282">.</span><span class="ident" id="8302283">caddr</span><span class="op" id="8302288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302295">}</span><br>
<span class="lineno">175</span><span class="op" id="8302297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8302300">func</span>&nbsp;<span class="ident" id="8302305">runStreamConnServer</span><span class="op" id="8302324">(</span><span class="ident" id="8302325">t</span>&nbsp;<span class="op" id="8302327">*</span><span class="ident" id="8302328">testing</span><span class="op" id="8302335">.</span><span class="ident" id="8302336">T</span><span class="op" id="8302337">,</span>&nbsp;<span class="ident" id="8302339">net</span><span class="op" id="8302342">,</span>&nbsp;<span class="ident" id="8302344">laddr</span>&nbsp;<span class="builtintype" id="8302350">string</span><span class="op" id="8302356">,</span>&nbsp;<span class="ident" id="8302358">listening</span>&nbsp;<span class="keyword" id="8302368">chan</span><span class="op" id="8302372">&lt;-</span>&nbsp;<span class="builtintype" id="8302375">string</span><span class="op" id="8302381">,</span>&nbsp;<span class="ident" id="8302383">done</span>&nbsp;<span class="keyword" id="8302388">chan</span><span class="op" id="8302392">&lt;-</span>&nbsp;<span class="builtintype" id="8302395">int</span><span class="op" id="8302398">)</span>&nbsp;<span class="op" id="8302400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302403">defer</span>&nbsp;<span class="builtinfunc" id="8302409">close</span><span class="op" id="8302414">(</span><span class="ident" id="8302415">done</span><span class="op" id="8302419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302422">l</span><span class="op" id="8302423">,</span>&nbsp;<span class="ident" id="8302425">err</span>&nbsp;<span class="op" id="8302429">:=</span>&nbsp;<span class="ident" id="8302432">Listen</span><span class="op" id="8302438">(</span><span class="ident" id="8302439">net</span><span class="op" id="8302442">,</span>&nbsp;<span class="ident" id="8302444">laddr</span><span class="op" id="8302449">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302452">if</span>&nbsp;<span class="ident" id="8302455">err</span>&nbsp;<span class="op" id="8302459">!=</span>&nbsp;<span class="ident" id="8302462">nil</span>&nbsp;<span class="op" id="8302466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302470">t</span><span class="op" id="8302471">.</span><span class="ident" id="8302472">Errorf</span><span class="op" id="8302478">(</span><span class="string" id="8302479">&#34;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8302506">,</span>&nbsp;<span class="ident" id="8302508">net</span><span class="op" id="8302511">,</span>&nbsp;<span class="ident" id="8302513">laddr</span><span class="op" id="8302518">,</span>&nbsp;<span class="ident" id="8302520">err</span><span class="op" id="8302523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302527">listening</span>&nbsp;<span class="op" id="8302537">&lt;-</span>&nbsp;<span class="string" id="8302540">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302550">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302558">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302561">defer</span>&nbsp;<span class="ident" id="8302567">l</span><span class="op" id="8302568">.</span><span class="ident" id="8302569">Close</span><span class="op" id="8302574">(</span><span class="op" id="8302575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302578">listening</span>&nbsp;<span class="op" id="8302588">&lt;-</span>&nbsp;<span class="ident" id="8302591">l</span><span class="op" id="8302592">.</span><span class="ident" id="8302593">Addr</span><span class="op" id="8302597">(</span><span class="op" id="8302598">)</span><span class="op" id="8302599">.</span><span class="ident" id="8302600">String</span><span class="op" id="8302606">(</span><span class="op" id="8302607">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302611">echo</span>&nbsp;<span class="op" id="8302616">:=</span>&nbsp;<span class="keyword" id="8302619">func</span><span class="op" id="8302623">(</span><span class="ident" id="8302624">rw</span>&nbsp;<span class="ident" id="8302627">io</span><span class="op" id="8302629">.</span><span class="ident" id="8302630">ReadWriter</span><span class="op" id="8302640">,</span>&nbsp;<span class="ident" id="8302642">done</span>&nbsp;<span class="keyword" id="8302647">chan</span><span class="op" id="8302651">&lt;-</span>&nbsp;<span class="builtintype" id="8302654">int</span><span class="op" id="8302657">)</span>&nbsp;<span class="op" id="8302659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302663">buf</span>&nbsp;<span class="op" id="8302667">:=</span>&nbsp;<span class="builtinfunc" id="8302670">make</span><span class="op" id="8302674">(</span><span class="op" id="8302675">[</span><span class="op" id="8302676">]</span><span class="builtintype" id="8302677">byte</span><span class="op" id="8302681">,</span>&nbsp;<span class="num" id="8302683">1024</span><span class="op" id="8302687">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302691">for</span>&nbsp;<span class="op" id="8302695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302700">n</span><span class="op" id="8302701">,</span>&nbsp;<span class="ident" id="8302703">err</span>&nbsp;<span class="op" id="8302707">:=</span>&nbsp;<span class="ident" id="8302710">rw</span><span class="op" id="8302712">.</span><span class="ident" id="8302713">Read</span><span class="op" id="8302717">(</span><span class="ident" id="8302718">buf</span><span class="op" id="8302721">[</span><span class="num" id="8302722">0</span><span class="op" id="8302723">:</span><span class="op" id="8302724">]</span><span class="op" id="8302725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302730">if</span>&nbsp;<span class="ident" id="8302733">err</span>&nbsp;<span class="op" id="8302737">!=</span>&nbsp;<span class="ident" id="8302740">nil</span>&nbsp;<span class="op" id="8302744">||</span>&nbsp;<span class="ident" id="8302747">n</span>&nbsp;<span class="op" id="8302749">==</span>&nbsp;<span class="num" id="8302752">0</span>&nbsp;<span class="op" id="8302754">||</span>&nbsp;<span class="builtintype" id="8302757">string</span><span class="op" id="8302763">(</span><span class="ident" id="8302764">buf</span><span class="op" id="8302767">[</span><span class="op" id="8302768">:</span><span class="ident" id="8302769">n</span><span class="op" id="8302770">]</span><span class="op" id="8302771">)</span>&nbsp;<span class="op" id="8302773">==</span>&nbsp;<span class="string" id="8302776">&#34;END&#34;</span>&nbsp;<span class="op" id="8302782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302788">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302797">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302802">rw</span><span class="op" id="8302804">.</span><span class="ident" id="8302805">Write</span><span class="op" id="8302810">(</span><span class="ident" id="8302811">buf</span><span class="op" id="8302814">[</span><span class="num" id="8302815">0</span><span class="op" id="8302816">:</span><span class="ident" id="8302817">n</span><span class="op" id="8302818">]</span><span class="op" id="8302819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8302827">close</span><span class="op" id="8302832">(</span><span class="ident" id="8302833">done</span><span class="op" id="8302837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="8302843">run</span><span class="op" id="8302846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302849">for</span>&nbsp;<span class="op" id="8302853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302857">c</span><span class="op" id="8302858">,</span>&nbsp;<span class="ident" id="8302860">err</span>&nbsp;<span class="op" id="8302864">:=</span>&nbsp;<span class="ident" id="8302867">l</span><span class="op" id="8302868">.</span><span class="ident" id="8302869">Accept</span><span class="op" id="8302875">(</span><span class="op" id="8302876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302880">if</span>&nbsp;<span class="ident" id="8302883">err</span>&nbsp;<span class="op" id="8302887">!=</span>&nbsp;<span class="ident" id="8302890">nil</span>&nbsp;<span class="op" id="8302894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302899">t</span><span class="op" id="8302900">.</span><span class="ident" id="8302901">Logf</span><span class="op" id="8302905">(</span><span class="string" id="8302906">&#34;Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8302925">,</span>&nbsp;<span class="ident" id="8302927">err</span><span class="op" id="8302930">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302935">continue</span>&nbsp;<span class="ident" id="8302944">run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8302950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8302954">echodone</span>&nbsp;<span class="op" id="8302963">:=</span>&nbsp;<span class="builtinfunc" id="8302966">make</span><span class="op" id="8302970">(</span><span class="keyword" id="8302971">chan</span>&nbsp;<span class="builtintype" id="8302976">int</span><span class="op" id="8302979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302983">go</span>&nbsp;<span class="ident" id="8302986">echo</span><span class="op" id="8302990">(</span><span class="ident" id="8302991">c</span><span class="op" id="8302992">,</span>&nbsp;<span class="ident" id="8302994">echodone</span><span class="op" id="8303002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8303006">&lt;-</span><span class="ident" id="8303008">echodone</span>&nbsp;<span class="comment" id="8303017">//&nbsp;make&nbsp;sure&nbsp;echo&nbsp;stopped</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303045">c</span><span class="op" id="8303046">.</span><span class="ident" id="8303047">Close</span><span class="op" id="8303052">(</span><span class="op" id="8303053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303057">break</span>&nbsp;<span class="ident" id="8303063">run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8303068">}</span><br>
<span class="lineno"></span><span class="op" id="8303070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="8303073">func</span>&nbsp;<span class="ident" id="8303078">runStreamConnClient</span><span class="op" id="8303097">(</span><span class="ident" id="8303098">t</span>&nbsp;<span class="op" id="8303100">*</span><span class="ident" id="8303101">testing</span><span class="op" id="8303108">.</span><span class="ident" id="8303109">T</span><span class="op" id="8303110">,</span>&nbsp;<span class="ident" id="8303112">net</span><span class="op" id="8303115">,</span>&nbsp;<span class="ident" id="8303117">taddr</span>&nbsp;<span class="builtintype" id="8303123">string</span><span class="op" id="8303129">,</span>&nbsp;<span class="ident" id="8303131">isEmpty</span>&nbsp;<span class="builtintype" id="8303139">bool</span><span class="op" id="8303143">)</span>&nbsp;<span class="op" id="8303145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303148">c</span><span class="op" id="8303149">,</span>&nbsp;<span class="ident" id="8303151">err</span>&nbsp;<span class="op" id="8303155">:=</span>&nbsp;<span class="ident" id="8303158">Dial</span><span class="op" id="8303162">(</span><span class="ident" id="8303163">net</span><span class="op" id="8303166">,</span>&nbsp;<span class="ident" id="8303168">taddr</span><span class="op" id="8303173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303176">if</span>&nbsp;<span class="ident" id="8303179">err</span>&nbsp;<span class="op" id="8303183">!=</span>&nbsp;<span class="ident" id="8303186">nil</span>&nbsp;<span class="op" id="8303190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303194">t</span><span class="op" id="8303195">.</span><span class="ident" id="8303196">Fatalf</span><span class="op" id="8303202">(</span><span class="string" id="8303203">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8303228">,</span>&nbsp;<span class="ident" id="8303230">net</span><span class="op" id="8303233">,</span>&nbsp;<span class="ident" id="8303235">taddr</span><span class="op" id="8303240">,</span>&nbsp;<span class="ident" id="8303242">err</span><span class="op" id="8303245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8303248">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303251">defer</span>&nbsp;<span class="ident" id="8303257">c</span><span class="op" id="8303258">.</span><span class="ident" id="8303259">Close</span><span class="op" id="8303264">(</span><span class="op" id="8303265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303268">c</span><span class="op" id="8303269">.</span><span class="ident" id="8303270">SetReadDeadline</span><span class="op" id="8303285">(</span><span class="ident" id="8303286">time</span><span class="op" id="8303290">.</span><span class="ident" id="8303291">Now</span><span class="op" id="8303294">(</span><span class="op" id="8303295">)</span><span class="op" id="8303296">.</span><span class="ident" id="8303297">Add</span><span class="op" id="8303300">(</span><span class="num" id="8303301">1</span>&nbsp;<span class="op" id="8303303">*</span>&nbsp;<span class="ident" id="8303305">time</span><span class="op" id="8303309">.</span><span class="ident" id="8303310">Second</span><span class="op" id="8303316">)</span><span class="op" id="8303317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303321">var</span>&nbsp;<span class="ident" id="8303325">wb</span>&nbsp;<span class="op" id="8303328">[</span><span class="op" id="8303329">]</span><span class="builtintype" id="8303330">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303336">if</span>&nbsp;<span class="op" id="8303339">!</span><span class="ident" id="8303340">isEmpty</span>&nbsp;<span class="op" id="8303348">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303352">wb</span>&nbsp;<span class="op" id="8303355">=</span>&nbsp;<span class="op" id="8303357">[</span><span class="op" id="8303358">]</span><span class="builtintype" id="8303359">byte</span><span class="op" id="8303363">(</span><span class="string" id="8303364">&#34;StreamConnClient&nbsp;by&nbsp;Dial\n&#34;</span><span class="op" id="8303392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8303395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303398">if</span>&nbsp;<span class="ident" id="8303401">n</span><span class="op" id="8303402">,</span>&nbsp;<span class="ident" id="8303404">err</span>&nbsp;<span class="op" id="8303408">:=</span>&nbsp;<span class="ident" id="8303411">c</span><span class="op" id="8303412">.</span><span class="ident" id="8303413">Write</span><span class="op" id="8303418">(</span><span class="ident" id="8303419">wb</span><span class="op" id="8303421">)</span><span class="op" id="8303422">;</span>&nbsp;<span class="ident" id="8303424">err</span>&nbsp;<span class="op" id="8303428">!=</span>&nbsp;<span class="ident" id="8303431">nil</span>&nbsp;<span class="op" id="8303435">||</span>&nbsp;<span class="ident" id="8303438">n</span>&nbsp;<span class="op" id="8303440">!=</span>&nbsp;<span class="builtinfunc" id="8303443">len</span><span class="op" id="8303446">(</span><span class="ident" id="8303447">wb</span><span class="op" id="8303449">)</span>&nbsp;<span class="op" id="8303451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303455">t</span><span class="op" id="8303456">.</span><span class="ident" id="8303457">Fatalf</span><span class="op" id="8303463">(</span><span class="string" id="8303464">&#34;Write&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="8303502">,</span>&nbsp;<span class="ident" id="8303504">n</span><span class="op" id="8303505">,</span>&nbsp;<span class="ident" id="8303507">err</span><span class="op" id="8303510">,</span>&nbsp;<span class="builtinfunc" id="8303512">len</span><span class="op" id="8303515">(</span><span class="ident" id="8303516">wb</span><span class="op" id="8303518">)</span><span class="op" id="8303519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8303522">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303526">rb</span>&nbsp;<span class="op" id="8303529">:=</span>&nbsp;<span class="builtinfunc" id="8303532">make</span><span class="op" id="8303536">(</span><span class="op" id="8303537">[</span><span class="op" id="8303538">]</span><span class="builtintype" id="8303539">byte</span><span class="op" id="8303543">,</span>&nbsp;<span class="num" id="8303545">1024</span><span class="op" id="8303549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303552">if</span>&nbsp;<span class="ident" id="8303555">n</span><span class="op" id="8303556">,</span>&nbsp;<span class="ident" id="8303558">err</span>&nbsp;<span class="op" id="8303562">:=</span>&nbsp;<span class="ident" id="8303565">c</span><span class="op" id="8303566">.</span><span class="ident" id="8303567">Read</span><span class="op" id="8303571">(</span><span class="ident" id="8303572">rb</span><span class="op" id="8303574">[</span><span class="num" id="8303575">0</span><span class="op" id="8303576">:</span><span class="op" id="8303577">]</span><span class="op" id="8303578">)</span><span class="op" id="8303579">;</span>&nbsp;<span class="ident" id="8303581">err</span>&nbsp;<span class="op" id="8303585">!=</span>&nbsp;<span class="ident" id="8303588">nil</span>&nbsp;<span class="op" id="8303592">||</span>&nbsp;<span class="ident" id="8303595">n</span>&nbsp;<span class="op" id="8303597">!=</span>&nbsp;<span class="builtinfunc" id="8303600">len</span><span class="op" id="8303603">(</span><span class="ident" id="8303604">wb</span><span class="op" id="8303606">)</span>&nbsp;<span class="op" id="8303608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303612">t</span><span class="op" id="8303613">.</span><span class="ident" id="8303614">Fatalf</span><span class="op" id="8303620">(</span><span class="string" id="8303621">&#34;Read&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="8303658">,</span>&nbsp;<span class="ident" id="8303660">n</span><span class="op" id="8303661">,</span>&nbsp;<span class="ident" id="8303663">err</span><span class="op" id="8303666">,</span>&nbsp;<span class="builtinfunc" id="8303668">len</span><span class="op" id="8303671">(</span><span class="ident" id="8303672">wb</span><span class="op" id="8303674">)</span><span class="op" id="8303675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8303678">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8303682">//&nbsp;Send&nbsp;explicit&nbsp;ending&nbsp;for&nbsp;unixpacket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8303723">//&nbsp;Older&nbsp;Linux&nbsp;kernels&nbsp;do&nbsp;not&nbsp;stop&nbsp;reads&nbsp;on&nbsp;close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303775">switch</span>&nbsp;<span class="ident" id="8303782">net</span>&nbsp;<span class="op" id="8303786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8303789">case</span>&nbsp;<span class="string" id="8303794">&#34;unixpacket&#34;</span><span class="op" id="8303806">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8303810">c</span><span class="op" id="8303811">.</span><span class="ident" id="8303812">Write</span><span class="op" id="8303817">(</span><span class="op" id="8303818">[</span><span class="op" id="8303819">]</span><span class="builtintype" id="8303820">byte</span><span class="op" id="8303824">(</span><span class="string" id="8303825">&#34;END&#34;</span><span class="op" id="8303830">)</span><span class="op" id="8303831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8303834">}</span><br>
<span class="lineno"></span><span class="op" id="8303836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8303839">//&nbsp;Do&nbsp;not&nbsp;test&nbsp;empty&nbsp;datagrams&nbsp;by&nbsp;default.</span><br>
<span class="lineno">245</span><span class="comment" id="8303882">//&nbsp;It&nbsp;causes&nbsp;unexplained&nbsp;timeouts&nbsp;on&nbsp;some&nbsp;systems,</span><br>
<span class="lineno"></span><span class="comment" id="8303933">//&nbsp;including&nbsp;Snow&nbsp;Leopard.&nbsp;&nbsp;I&nbsp;think&nbsp;that&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span><span class="comment" id="8303985">//&nbsp;doesn&#39;t&nbsp;quite&nbsp;expect&nbsp;them.</span><br>
<span class="lineno"></span><span class="keyword" id="8304015">var</span>&nbsp;<span class="ident" id="8304019">testDatagram</span>&nbsp;<span class="op" id="8304032">=</span>&nbsp;<span class="ident" id="8304034">flag</span><span class="op" id="8304038">.</span><span class="ident" id="8304039">Bool</span><span class="op" id="8304043">(</span><span class="string" id="8304044">&#34;datagram&#34;</span><span class="op" id="8304054">,</span>&nbsp;<span class="builtintype" id="8304056">false</span><span class="op" id="8304061">,</span>&nbsp;<span class="string" id="8304063">&#34;whether&nbsp;to&nbsp;test&nbsp;udp&nbsp;and&nbsp;unixgram&#34;</span><span class="op" id="8304097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="8304100">var</span>&nbsp;<span class="ident" id="8304104">datagramPacketConnServerTests</span>&nbsp;<span class="op" id="8304134">=</span>&nbsp;<span class="op" id="8304136">[</span><span class="op" id="8304137">]</span><span class="keyword" id="8304138">struct</span>&nbsp;<span class="op" id="8304145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304148">snet</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8304158">string</span>&nbsp;<span class="comment" id="8304165">//&nbsp;server&nbsp;side</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304181">saddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8304191">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304199">cnet</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8304209">string</span>&nbsp;<span class="comment" id="8304216">//&nbsp;client&nbsp;side</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304232">caddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8304242">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304250">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8304260">bool</span>&nbsp;<span class="comment" id="8304265">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304306">ipv4map</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8304316">bool</span>&nbsp;<span class="comment" id="8304321">//&nbsp;test&nbsp;with&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304367">dial</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8304377">bool</span>&nbsp;<span class="comment" id="8304382">//&nbsp;test&nbsp;with&nbsp;Dial&nbsp;or&nbsp;DialUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304413">empty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8304423">bool</span>&nbsp;<span class="comment" id="8304428">//&nbsp;test&nbsp;with&nbsp;empty&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8304453">linuxOnly</span>&nbsp;<span class="builtintype" id="8304463">bool</span>&nbsp;<span class="comment" id="8304468">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno">260</span><span class="op" id="8304522">}</span><span class="op" id="8304523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304526">{</span><span class="ident" id="8304527">snet</span><span class="op" id="8304531">:</span>&nbsp;<span class="string" id="8304533">&#34;udp&#34;</span><span class="op" id="8304538">,</span>&nbsp;<span class="ident" id="8304540">saddr</span><span class="op" id="8304545">:</span>&nbsp;<span class="string" id="8304547">&#34;&#34;</span><span class="op" id="8304549">,</span>&nbsp;<span class="ident" id="8304551">cnet</span><span class="op" id="8304555">:</span>&nbsp;<span class="string" id="8304557">&#34;udp&#34;</span><span class="op" id="8304562">,</span>&nbsp;<span class="ident" id="8304564">caddr</span><span class="op" id="8304569">:</span>&nbsp;<span class="string" id="8304571">&#34;127.0.0.1&#34;</span><span class="op" id="8304582">}</span><span class="op" id="8304583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304586">{</span><span class="ident" id="8304587">snet</span><span class="op" id="8304591">:</span>&nbsp;<span class="string" id="8304593">&#34;udp&#34;</span><span class="op" id="8304598">,</span>&nbsp;<span class="ident" id="8304600">saddr</span><span class="op" id="8304605">:</span>&nbsp;<span class="string" id="8304607">&#34;0.0.0.0&#34;</span><span class="op" id="8304616">,</span>&nbsp;<span class="ident" id="8304618">cnet</span><span class="op" id="8304622">:</span>&nbsp;<span class="string" id="8304624">&#34;udp&#34;</span><span class="op" id="8304629">,</span>&nbsp;<span class="ident" id="8304631">caddr</span><span class="op" id="8304636">:</span>&nbsp;<span class="string" id="8304638">&#34;127.0.0.1&#34;</span><span class="op" id="8304649">}</span><span class="op" id="8304650">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304653">{</span><span class="ident" id="8304654">snet</span><span class="op" id="8304658">:</span>&nbsp;<span class="string" id="8304660">&#34;udp&#34;</span><span class="op" id="8304665">,</span>&nbsp;<span class="ident" id="8304667">saddr</span><span class="op" id="8304672">:</span>&nbsp;<span class="string" id="8304674">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8304692">,</span>&nbsp;<span class="ident" id="8304694">cnet</span><span class="op" id="8304698">:</span>&nbsp;<span class="string" id="8304700">&#34;udp&#34;</span><span class="op" id="8304705">,</span>&nbsp;<span class="ident" id="8304707">caddr</span><span class="op" id="8304712">:</span>&nbsp;<span class="string" id="8304714">&#34;127.0.0.1&#34;</span><span class="op" id="8304725">}</span><span class="op" id="8304726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304729">{</span><span class="ident" id="8304730">snet</span><span class="op" id="8304734">:</span>&nbsp;<span class="string" id="8304736">&#34;udp&#34;</span><span class="op" id="8304741">,</span>&nbsp;<span class="ident" id="8304743">saddr</span><span class="op" id="8304748">:</span>&nbsp;<span class="string" id="8304750">&#34;[::]&#34;</span><span class="op" id="8304756">,</span>&nbsp;<span class="ident" id="8304758">cnet</span><span class="op" id="8304762">:</span>&nbsp;<span class="string" id="8304764">&#34;udp&#34;</span><span class="op" id="8304769">,</span>&nbsp;<span class="ident" id="8304771">caddr</span><span class="op" id="8304776">:</span>&nbsp;<span class="string" id="8304778">&#34;[::1]&#34;</span><span class="op" id="8304785">,</span>&nbsp;<span class="ident" id="8304787">ipv6</span><span class="op" id="8304791">:</span>&nbsp;<span class="builtintype" id="8304793">true</span><span class="op" id="8304797">}</span><span class="op" id="8304798">,</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304802">{</span><span class="ident" id="8304803">snet</span><span class="op" id="8304807">:</span>&nbsp;<span class="string" id="8304809">&#34;udp&#34;</span><span class="op" id="8304814">,</span>&nbsp;<span class="ident" id="8304816">saddr</span><span class="op" id="8304821">:</span>&nbsp;<span class="string" id="8304823">&#34;&#34;</span><span class="op" id="8304825">,</span>&nbsp;<span class="ident" id="8304827">cnet</span><span class="op" id="8304831">:</span>&nbsp;<span class="string" id="8304833">&#34;udp&#34;</span><span class="op" id="8304838">,</span>&nbsp;<span class="ident" id="8304840">caddr</span><span class="op" id="8304845">:</span>&nbsp;<span class="string" id="8304847">&#34;[::1]&#34;</span><span class="op" id="8304854">,</span>&nbsp;<span class="ident" id="8304856">ipv4map</span><span class="op" id="8304863">:</span>&nbsp;<span class="builtintype" id="8304865">true</span><span class="op" id="8304869">}</span><span class="op" id="8304870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304873">{</span><span class="ident" id="8304874">snet</span><span class="op" id="8304878">:</span>&nbsp;<span class="string" id="8304880">&#34;udp&#34;</span><span class="op" id="8304885">,</span>&nbsp;<span class="ident" id="8304887">saddr</span><span class="op" id="8304892">:</span>&nbsp;<span class="string" id="8304894">&#34;0.0.0.0&#34;</span><span class="op" id="8304903">,</span>&nbsp;<span class="ident" id="8304905">cnet</span><span class="op" id="8304909">:</span>&nbsp;<span class="string" id="8304911">&#34;udp&#34;</span><span class="op" id="8304916">,</span>&nbsp;<span class="ident" id="8304918">caddr</span><span class="op" id="8304923">:</span>&nbsp;<span class="string" id="8304925">&#34;[::1]&#34;</span><span class="op" id="8304932">,</span>&nbsp;<span class="ident" id="8304934">ipv4map</span><span class="op" id="8304941">:</span>&nbsp;<span class="builtintype" id="8304943">true</span><span class="op" id="8304947">}</span><span class="op" id="8304948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8304951">{</span><span class="ident" id="8304952">snet</span><span class="op" id="8304956">:</span>&nbsp;<span class="string" id="8304958">&#34;udp&#34;</span><span class="op" id="8304963">,</span>&nbsp;<span class="ident" id="8304965">saddr</span><span class="op" id="8304970">:</span>&nbsp;<span class="string" id="8304972">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8304990">,</span>&nbsp;<span class="ident" id="8304992">cnet</span><span class="op" id="8304996">:</span>&nbsp;<span class="string" id="8304998">&#34;udp&#34;</span><span class="op" id="8305003">,</span>&nbsp;<span class="ident" id="8305005">caddr</span><span class="op" id="8305010">:</span>&nbsp;<span class="string" id="8305012">&#34;[::1]&#34;</span><span class="op" id="8305019">,</span>&nbsp;<span class="ident" id="8305021">ipv4map</span><span class="op" id="8305028">:</span>&nbsp;<span class="builtintype" id="8305030">true</span><span class="op" id="8305034">}</span><span class="op" id="8305035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305038">{</span><span class="ident" id="8305039">snet</span><span class="op" id="8305043">:</span>&nbsp;<span class="string" id="8305045">&#34;udp&#34;</span><span class="op" id="8305050">,</span>&nbsp;<span class="ident" id="8305052">saddr</span><span class="op" id="8305057">:</span>&nbsp;<span class="string" id="8305059">&#34;[::]&#34;</span><span class="op" id="8305065">,</span>&nbsp;<span class="ident" id="8305067">cnet</span><span class="op" id="8305071">:</span>&nbsp;<span class="string" id="8305073">&#34;udp&#34;</span><span class="op" id="8305078">,</span>&nbsp;<span class="ident" id="8305080">caddr</span><span class="op" id="8305085">:</span>&nbsp;<span class="string" id="8305087">&#34;127.0.0.1&#34;</span><span class="op" id="8305098">,</span>&nbsp;<span class="ident" id="8305100">ipv4map</span><span class="op" id="8305107">:</span>&nbsp;<span class="builtintype" id="8305109">true</span><span class="op" id="8305113">}</span><span class="op" id="8305114">,</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305118">{</span><span class="ident" id="8305119">snet</span><span class="op" id="8305123">:</span>&nbsp;<span class="string" id="8305125">&#34;udp&#34;</span><span class="op" id="8305130">,</span>&nbsp;<span class="ident" id="8305132">saddr</span><span class="op" id="8305137">:</span>&nbsp;<span class="string" id="8305139">&#34;&#34;</span><span class="op" id="8305141">,</span>&nbsp;<span class="ident" id="8305143">cnet</span><span class="op" id="8305147">:</span>&nbsp;<span class="string" id="8305149">&#34;udp4&#34;</span><span class="op" id="8305155">,</span>&nbsp;<span class="ident" id="8305157">caddr</span><span class="op" id="8305162">:</span>&nbsp;<span class="string" id="8305164">&#34;127.0.0.1&#34;</span><span class="op" id="8305175">}</span><span class="op" id="8305176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305179">{</span><span class="ident" id="8305180">snet</span><span class="op" id="8305184">:</span>&nbsp;<span class="string" id="8305186">&#34;udp&#34;</span><span class="op" id="8305191">,</span>&nbsp;<span class="ident" id="8305193">saddr</span><span class="op" id="8305198">:</span>&nbsp;<span class="string" id="8305200">&#34;0.0.0.0&#34;</span><span class="op" id="8305209">,</span>&nbsp;<span class="ident" id="8305211">cnet</span><span class="op" id="8305215">:</span>&nbsp;<span class="string" id="8305217">&#34;udp4&#34;</span><span class="op" id="8305223">,</span>&nbsp;<span class="ident" id="8305225">caddr</span><span class="op" id="8305230">:</span>&nbsp;<span class="string" id="8305232">&#34;127.0.0.1&#34;</span><span class="op" id="8305243">}</span><span class="op" id="8305244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305247">{</span><span class="ident" id="8305248">snet</span><span class="op" id="8305252">:</span>&nbsp;<span class="string" id="8305254">&#34;udp&#34;</span><span class="op" id="8305259">,</span>&nbsp;<span class="ident" id="8305261">saddr</span><span class="op" id="8305266">:</span>&nbsp;<span class="string" id="8305268">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8305286">,</span>&nbsp;<span class="ident" id="8305288">cnet</span><span class="op" id="8305292">:</span>&nbsp;<span class="string" id="8305294">&#34;udp4&#34;</span><span class="op" id="8305300">,</span>&nbsp;<span class="ident" id="8305302">caddr</span><span class="op" id="8305307">:</span>&nbsp;<span class="string" id="8305309">&#34;127.0.0.1&#34;</span><span class="op" id="8305320">}</span><span class="op" id="8305321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305324">{</span><span class="ident" id="8305325">snet</span><span class="op" id="8305329">:</span>&nbsp;<span class="string" id="8305331">&#34;udp&#34;</span><span class="op" id="8305336">,</span>&nbsp;<span class="ident" id="8305338">saddr</span><span class="op" id="8305343">:</span>&nbsp;<span class="string" id="8305345">&#34;[::]&#34;</span><span class="op" id="8305351">,</span>&nbsp;<span class="ident" id="8305353">cnet</span><span class="op" id="8305357">:</span>&nbsp;<span class="string" id="8305359">&#34;udp6&#34;</span><span class="op" id="8305365">,</span>&nbsp;<span class="ident" id="8305367">caddr</span><span class="op" id="8305372">:</span>&nbsp;<span class="string" id="8305374">&#34;[::1]&#34;</span><span class="op" id="8305381">,</span>&nbsp;<span class="ident" id="8305383">ipv6</span><span class="op" id="8305387">:</span>&nbsp;<span class="builtintype" id="8305389">true</span><span class="op" id="8305393">}</span><span class="op" id="8305394">,</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305398">{</span><span class="ident" id="8305399">snet</span><span class="op" id="8305403">:</span>&nbsp;<span class="string" id="8305405">&#34;udp&#34;</span><span class="op" id="8305410">,</span>&nbsp;<span class="ident" id="8305412">saddr</span><span class="op" id="8305417">:</span>&nbsp;<span class="string" id="8305419">&#34;&#34;</span><span class="op" id="8305421">,</span>&nbsp;<span class="ident" id="8305423">cnet</span><span class="op" id="8305427">:</span>&nbsp;<span class="string" id="8305429">&#34;udp6&#34;</span><span class="op" id="8305435">,</span>&nbsp;<span class="ident" id="8305437">caddr</span><span class="op" id="8305442">:</span>&nbsp;<span class="string" id="8305444">&#34;[::1]&#34;</span><span class="op" id="8305451">,</span>&nbsp;<span class="ident" id="8305453">ipv4map</span><span class="op" id="8305460">:</span>&nbsp;<span class="builtintype" id="8305462">true</span><span class="op" id="8305466">}</span><span class="op" id="8305467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305470">{</span><span class="ident" id="8305471">snet</span><span class="op" id="8305475">:</span>&nbsp;<span class="string" id="8305477">&#34;udp&#34;</span><span class="op" id="8305482">,</span>&nbsp;<span class="ident" id="8305484">saddr</span><span class="op" id="8305489">:</span>&nbsp;<span class="string" id="8305491">&#34;0.0.0.0&#34;</span><span class="op" id="8305500">,</span>&nbsp;<span class="ident" id="8305502">cnet</span><span class="op" id="8305506">:</span>&nbsp;<span class="string" id="8305508">&#34;udp6&#34;</span><span class="op" id="8305514">,</span>&nbsp;<span class="ident" id="8305516">caddr</span><span class="op" id="8305521">:</span>&nbsp;<span class="string" id="8305523">&#34;[::1]&#34;</span><span class="op" id="8305530">,</span>&nbsp;<span class="ident" id="8305532">ipv4map</span><span class="op" id="8305539">:</span>&nbsp;<span class="builtintype" id="8305541">true</span><span class="op" id="8305545">}</span><span class="op" id="8305546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305549">{</span><span class="ident" id="8305550">snet</span><span class="op" id="8305554">:</span>&nbsp;<span class="string" id="8305556">&#34;udp&#34;</span><span class="op" id="8305561">,</span>&nbsp;<span class="ident" id="8305563">saddr</span><span class="op" id="8305568">:</span>&nbsp;<span class="string" id="8305570">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8305588">,</span>&nbsp;<span class="ident" id="8305590">cnet</span><span class="op" id="8305594">:</span>&nbsp;<span class="string" id="8305596">&#34;udp6&#34;</span><span class="op" id="8305602">,</span>&nbsp;<span class="ident" id="8305604">caddr</span><span class="op" id="8305609">:</span>&nbsp;<span class="string" id="8305611">&#34;[::1]&#34;</span><span class="op" id="8305618">,</span>&nbsp;<span class="ident" id="8305620">ipv4map</span><span class="op" id="8305627">:</span>&nbsp;<span class="builtintype" id="8305629">true</span><span class="op" id="8305633">}</span><span class="op" id="8305634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305637">{</span><span class="ident" id="8305638">snet</span><span class="op" id="8305642">:</span>&nbsp;<span class="string" id="8305644">&#34;udp&#34;</span><span class="op" id="8305649">,</span>&nbsp;<span class="ident" id="8305651">saddr</span><span class="op" id="8305656">:</span>&nbsp;<span class="string" id="8305658">&#34;[::]&#34;</span><span class="op" id="8305664">,</span>&nbsp;<span class="ident" id="8305666">cnet</span><span class="op" id="8305670">:</span>&nbsp;<span class="string" id="8305672">&#34;udp4&#34;</span><span class="op" id="8305678">,</span>&nbsp;<span class="ident" id="8305680">caddr</span><span class="op" id="8305685">:</span>&nbsp;<span class="string" id="8305687">&#34;127.0.0.1&#34;</span><span class="op" id="8305698">,</span>&nbsp;<span class="ident" id="8305700">ipv4map</span><span class="op" id="8305707">:</span>&nbsp;<span class="builtintype" id="8305709">true</span><span class="op" id="8305713">}</span><span class="op" id="8305714">,</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305718">{</span><span class="ident" id="8305719">snet</span><span class="op" id="8305723">:</span>&nbsp;<span class="string" id="8305725">&#34;udp&#34;</span><span class="op" id="8305730">,</span>&nbsp;<span class="ident" id="8305732">saddr</span><span class="op" id="8305737">:</span>&nbsp;<span class="string" id="8305739">&#34;127.0.0.1&#34;</span><span class="op" id="8305750">,</span>&nbsp;<span class="ident" id="8305752">cnet</span><span class="op" id="8305756">:</span>&nbsp;<span class="string" id="8305758">&#34;udp&#34;</span><span class="op" id="8305763">,</span>&nbsp;<span class="ident" id="8305765">caddr</span><span class="op" id="8305770">:</span>&nbsp;<span class="string" id="8305772">&#34;127.0.0.1&#34;</span><span class="op" id="8305783">}</span><span class="op" id="8305784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305787">{</span><span class="ident" id="8305788">snet</span><span class="op" id="8305792">:</span>&nbsp;<span class="string" id="8305794">&#34;udp&#34;</span><span class="op" id="8305799">,</span>&nbsp;<span class="ident" id="8305801">saddr</span><span class="op" id="8305806">:</span>&nbsp;<span class="string" id="8305808">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8305828">,</span>&nbsp;<span class="ident" id="8305830">cnet</span><span class="op" id="8305834">:</span>&nbsp;<span class="string" id="8305836">&#34;udp&#34;</span><span class="op" id="8305841">,</span>&nbsp;<span class="ident" id="8305843">caddr</span><span class="op" id="8305848">:</span>&nbsp;<span class="string" id="8305850">&#34;127.0.0.1&#34;</span><span class="op" id="8305861">}</span><span class="op" id="8305862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305865">{</span><span class="ident" id="8305866">snet</span><span class="op" id="8305870">:</span>&nbsp;<span class="string" id="8305872">&#34;udp&#34;</span><span class="op" id="8305877">,</span>&nbsp;<span class="ident" id="8305879">saddr</span><span class="op" id="8305884">:</span>&nbsp;<span class="string" id="8305886">&#34;[::1]&#34;</span><span class="op" id="8305893">,</span>&nbsp;<span class="ident" id="8305895">cnet</span><span class="op" id="8305899">:</span>&nbsp;<span class="string" id="8305901">&#34;udp&#34;</span><span class="op" id="8305906">,</span>&nbsp;<span class="ident" id="8305908">caddr</span><span class="op" id="8305913">:</span>&nbsp;<span class="string" id="8305915">&#34;[::1]&#34;</span><span class="op" id="8305922">,</span>&nbsp;<span class="ident" id="8305924">ipv6</span><span class="op" id="8305928">:</span>&nbsp;<span class="builtintype" id="8305930">true</span><span class="op" id="8305934">}</span><span class="op" id="8305935">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305939">{</span><span class="ident" id="8305940">snet</span><span class="op" id="8305944">:</span>&nbsp;<span class="string" id="8305946">&#34;udp4&#34;</span><span class="op" id="8305952">,</span>&nbsp;<span class="ident" id="8305954">saddr</span><span class="op" id="8305959">:</span>&nbsp;<span class="string" id="8305961">&#34;&#34;</span><span class="op" id="8305963">,</span>&nbsp;<span class="ident" id="8305965">cnet</span><span class="op" id="8305969">:</span>&nbsp;<span class="string" id="8305971">&#34;udp4&#34;</span><span class="op" id="8305977">,</span>&nbsp;<span class="ident" id="8305979">caddr</span><span class="op" id="8305984">:</span>&nbsp;<span class="string" id="8305986">&#34;127.0.0.1&#34;</span><span class="op" id="8305997">}</span><span class="op" id="8305998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306001">{</span><span class="ident" id="8306002">snet</span><span class="op" id="8306006">:</span>&nbsp;<span class="string" id="8306008">&#34;udp4&#34;</span><span class="op" id="8306014">,</span>&nbsp;<span class="ident" id="8306016">saddr</span><span class="op" id="8306021">:</span>&nbsp;<span class="string" id="8306023">&#34;0.0.0.0&#34;</span><span class="op" id="8306032">,</span>&nbsp;<span class="ident" id="8306034">cnet</span><span class="op" id="8306038">:</span>&nbsp;<span class="string" id="8306040">&#34;udp4&#34;</span><span class="op" id="8306046">,</span>&nbsp;<span class="ident" id="8306048">caddr</span><span class="op" id="8306053">:</span>&nbsp;<span class="string" id="8306055">&#34;127.0.0.1&#34;</span><span class="op" id="8306066">}</span><span class="op" id="8306067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306070">{</span><span class="ident" id="8306071">snet</span><span class="op" id="8306075">:</span>&nbsp;<span class="string" id="8306077">&#34;udp4&#34;</span><span class="op" id="8306083">,</span>&nbsp;<span class="ident" id="8306085">saddr</span><span class="op" id="8306090">:</span>&nbsp;<span class="string" id="8306092">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8306110">,</span>&nbsp;<span class="ident" id="8306112">cnet</span><span class="op" id="8306116">:</span>&nbsp;<span class="string" id="8306118">&#34;udp4&#34;</span><span class="op" id="8306124">,</span>&nbsp;<span class="ident" id="8306126">caddr</span><span class="op" id="8306131">:</span>&nbsp;<span class="string" id="8306133">&#34;127.0.0.1&#34;</span><span class="op" id="8306144">}</span><span class="op" id="8306145">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306149">{</span><span class="ident" id="8306150">snet</span><span class="op" id="8306154">:</span>&nbsp;<span class="string" id="8306156">&#34;udp4&#34;</span><span class="op" id="8306162">,</span>&nbsp;<span class="ident" id="8306164">saddr</span><span class="op" id="8306169">:</span>&nbsp;<span class="string" id="8306171">&#34;127.0.0.1&#34;</span><span class="op" id="8306182">,</span>&nbsp;<span class="ident" id="8306184">cnet</span><span class="op" id="8306188">:</span>&nbsp;<span class="string" id="8306190">&#34;udp4&#34;</span><span class="op" id="8306196">,</span>&nbsp;<span class="ident" id="8306198">caddr</span><span class="op" id="8306203">:</span>&nbsp;<span class="string" id="8306205">&#34;127.0.0.1&#34;</span><span class="op" id="8306216">}</span><span class="op" id="8306217">,</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306221">{</span><span class="ident" id="8306222">snet</span><span class="op" id="8306226">:</span>&nbsp;<span class="string" id="8306228">&#34;udp6&#34;</span><span class="op" id="8306234">,</span>&nbsp;<span class="ident" id="8306236">saddr</span><span class="op" id="8306241">:</span>&nbsp;<span class="string" id="8306243">&#34;&#34;</span><span class="op" id="8306245">,</span>&nbsp;<span class="ident" id="8306247">cnet</span><span class="op" id="8306251">:</span>&nbsp;<span class="string" id="8306253">&#34;udp6&#34;</span><span class="op" id="8306259">,</span>&nbsp;<span class="ident" id="8306261">caddr</span><span class="op" id="8306266">:</span>&nbsp;<span class="string" id="8306268">&#34;[::1]&#34;</span><span class="op" id="8306275">,</span>&nbsp;<span class="ident" id="8306277">ipv6</span><span class="op" id="8306281">:</span>&nbsp;<span class="builtintype" id="8306283">true</span><span class="op" id="8306287">}</span><span class="op" id="8306288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306291">{</span><span class="ident" id="8306292">snet</span><span class="op" id="8306296">:</span>&nbsp;<span class="string" id="8306298">&#34;udp6&#34;</span><span class="op" id="8306304">,</span>&nbsp;<span class="ident" id="8306306">saddr</span><span class="op" id="8306311">:</span>&nbsp;<span class="string" id="8306313">&#34;[::]&#34;</span><span class="op" id="8306319">,</span>&nbsp;<span class="ident" id="8306321">cnet</span><span class="op" id="8306325">:</span>&nbsp;<span class="string" id="8306327">&#34;udp6&#34;</span><span class="op" id="8306333">,</span>&nbsp;<span class="ident" id="8306335">caddr</span><span class="op" id="8306340">:</span>&nbsp;<span class="string" id="8306342">&#34;[::1]&#34;</span><span class="op" id="8306349">,</span>&nbsp;<span class="ident" id="8306351">ipv6</span><span class="op" id="8306355">:</span>&nbsp;<span class="builtintype" id="8306357">true</span><span class="op" id="8306361">}</span><span class="op" id="8306362">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306366">{</span><span class="ident" id="8306367">snet</span><span class="op" id="8306371">:</span>&nbsp;<span class="string" id="8306373">&#34;udp6&#34;</span><span class="op" id="8306379">,</span>&nbsp;<span class="ident" id="8306381">saddr</span><span class="op" id="8306386">:</span>&nbsp;<span class="string" id="8306388">&#34;[::1]&#34;</span><span class="op" id="8306395">,</span>&nbsp;<span class="ident" id="8306397">cnet</span><span class="op" id="8306401">:</span>&nbsp;<span class="string" id="8306403">&#34;udp6&#34;</span><span class="op" id="8306409">,</span>&nbsp;<span class="ident" id="8306411">caddr</span><span class="op" id="8306416">:</span>&nbsp;<span class="string" id="8306418">&#34;[::1]&#34;</span><span class="op" id="8306425">,</span>&nbsp;<span class="ident" id="8306427">ipv6</span><span class="op" id="8306431">:</span>&nbsp;<span class="builtintype" id="8306433">true</span><span class="op" id="8306437">}</span><span class="op" id="8306438">,</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306442">{</span><span class="ident" id="8306443">snet</span><span class="op" id="8306447">:</span>&nbsp;<span class="string" id="8306449">&#34;udp&#34;</span><span class="op" id="8306454">,</span>&nbsp;<span class="ident" id="8306456">saddr</span><span class="op" id="8306461">:</span>&nbsp;<span class="string" id="8306463">&#34;127.0.0.1&#34;</span><span class="op" id="8306474">,</span>&nbsp;<span class="ident" id="8306476">cnet</span><span class="op" id="8306480">:</span>&nbsp;<span class="string" id="8306482">&#34;udp&#34;</span><span class="op" id="8306487">,</span>&nbsp;<span class="ident" id="8306489">caddr</span><span class="op" id="8306494">:</span>&nbsp;<span class="string" id="8306496">&#34;127.0.0.1&#34;</span><span class="op" id="8306507">,</span>&nbsp;<span class="ident" id="8306509">dial</span><span class="op" id="8306513">:</span>&nbsp;<span class="builtintype" id="8306515">true</span><span class="op" id="8306519">}</span><span class="op" id="8306520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306523">{</span><span class="ident" id="8306524">snet</span><span class="op" id="8306528">:</span>&nbsp;<span class="string" id="8306530">&#34;udp&#34;</span><span class="op" id="8306535">,</span>&nbsp;<span class="ident" id="8306537">saddr</span><span class="op" id="8306542">:</span>&nbsp;<span class="string" id="8306544">&#34;127.0.0.1&#34;</span><span class="op" id="8306555">,</span>&nbsp;<span class="ident" id="8306557">cnet</span><span class="op" id="8306561">:</span>&nbsp;<span class="string" id="8306563">&#34;udp&#34;</span><span class="op" id="8306568">,</span>&nbsp;<span class="ident" id="8306570">caddr</span><span class="op" id="8306575">:</span>&nbsp;<span class="string" id="8306577">&#34;127.0.0.1&#34;</span><span class="op" id="8306588">,</span>&nbsp;<span class="ident" id="8306590">empty</span><span class="op" id="8306595">:</span>&nbsp;<span class="builtintype" id="8306597">true</span><span class="op" id="8306601">}</span><span class="op" id="8306602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306605">{</span><span class="ident" id="8306606">snet</span><span class="op" id="8306610">:</span>&nbsp;<span class="string" id="8306612">&#34;udp&#34;</span><span class="op" id="8306617">,</span>&nbsp;<span class="ident" id="8306619">saddr</span><span class="op" id="8306624">:</span>&nbsp;<span class="string" id="8306626">&#34;127.0.0.1&#34;</span><span class="op" id="8306637">,</span>&nbsp;<span class="ident" id="8306639">cnet</span><span class="op" id="8306643">:</span>&nbsp;<span class="string" id="8306645">&#34;udp&#34;</span><span class="op" id="8306650">,</span>&nbsp;<span class="ident" id="8306652">caddr</span><span class="op" id="8306657">:</span>&nbsp;<span class="string" id="8306659">&#34;127.0.0.1&#34;</span><span class="op" id="8306670">,</span>&nbsp;<span class="ident" id="8306672">dial</span><span class="op" id="8306676">:</span>&nbsp;<span class="builtintype" id="8306678">true</span><span class="op" id="8306682">,</span>&nbsp;<span class="ident" id="8306684">empty</span><span class="op" id="8306689">:</span>&nbsp;<span class="builtintype" id="8306691">true</span><span class="op" id="8306695">}</span><span class="op" id="8306696">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306700">{</span><span class="ident" id="8306701">snet</span><span class="op" id="8306705">:</span>&nbsp;<span class="string" id="8306707">&#34;udp&#34;</span><span class="op" id="8306712">,</span>&nbsp;<span class="ident" id="8306714">saddr</span><span class="op" id="8306719">:</span>&nbsp;<span class="string" id="8306721">&#34;[::1]&#34;</span><span class="op" id="8306728">,</span>&nbsp;<span class="ident" id="8306730">cnet</span><span class="op" id="8306734">:</span>&nbsp;<span class="string" id="8306736">&#34;udp&#34;</span><span class="op" id="8306741">,</span>&nbsp;<span class="ident" id="8306743">caddr</span><span class="op" id="8306748">:</span>&nbsp;<span class="string" id="8306750">&#34;[::1]&#34;</span><span class="op" id="8306757">,</span>&nbsp;<span class="ident" id="8306759">ipv6</span><span class="op" id="8306763">:</span>&nbsp;<span class="builtintype" id="8306765">true</span><span class="op" id="8306769">,</span>&nbsp;<span class="ident" id="8306771">dial</span><span class="op" id="8306775">:</span>&nbsp;<span class="builtintype" id="8306777">true</span><span class="op" id="8306781">}</span><span class="op" id="8306782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306785">{</span><span class="ident" id="8306786">snet</span><span class="op" id="8306790">:</span>&nbsp;<span class="string" id="8306792">&#34;udp&#34;</span><span class="op" id="8306797">,</span>&nbsp;<span class="ident" id="8306799">saddr</span><span class="op" id="8306804">:</span>&nbsp;<span class="string" id="8306806">&#34;[::1]&#34;</span><span class="op" id="8306813">,</span>&nbsp;<span class="ident" id="8306815">cnet</span><span class="op" id="8306819">:</span>&nbsp;<span class="string" id="8306821">&#34;udp&#34;</span><span class="op" id="8306826">,</span>&nbsp;<span class="ident" id="8306828">caddr</span><span class="op" id="8306833">:</span>&nbsp;<span class="string" id="8306835">&#34;[::1]&#34;</span><span class="op" id="8306842">,</span>&nbsp;<span class="ident" id="8306844">ipv6</span><span class="op" id="8306848">:</span>&nbsp;<span class="builtintype" id="8306850">true</span><span class="op" id="8306854">,</span>&nbsp;<span class="ident" id="8306856">empty</span><span class="op" id="8306861">:</span>&nbsp;<span class="builtintype" id="8306863">true</span><span class="op" id="8306867">}</span><span class="op" id="8306868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306871">{</span><span class="ident" id="8306872">snet</span><span class="op" id="8306876">:</span>&nbsp;<span class="string" id="8306878">&#34;udp&#34;</span><span class="op" id="8306883">,</span>&nbsp;<span class="ident" id="8306885">saddr</span><span class="op" id="8306890">:</span>&nbsp;<span class="string" id="8306892">&#34;[::1]&#34;</span><span class="op" id="8306899">,</span>&nbsp;<span class="ident" id="8306901">cnet</span><span class="op" id="8306905">:</span>&nbsp;<span class="string" id="8306907">&#34;udp&#34;</span><span class="op" id="8306912">,</span>&nbsp;<span class="ident" id="8306914">caddr</span><span class="op" id="8306919">:</span>&nbsp;<span class="string" id="8306921">&#34;[::1]&#34;</span><span class="op" id="8306928">,</span>&nbsp;<span class="ident" id="8306930">ipv6</span><span class="op" id="8306934">:</span>&nbsp;<span class="builtintype" id="8306936">true</span><span class="op" id="8306940">,</span>&nbsp;<span class="ident" id="8306942">dial</span><span class="op" id="8306946">:</span>&nbsp;<span class="builtintype" id="8306948">true</span><span class="op" id="8306952">,</span>&nbsp;<span class="ident" id="8306954">empty</span><span class="op" id="8306959">:</span>&nbsp;<span class="builtintype" id="8306961">true</span><span class="op" id="8306965">}</span><span class="op" id="8306966">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306970">{</span><span class="ident" id="8306971">snet</span><span class="op" id="8306975">:</span>&nbsp;<span class="string" id="8306977">&#34;unixgram&#34;</span><span class="op" id="8306987">,</span>&nbsp;<span class="ident" id="8306989">saddr</span><span class="op" id="8306994">:</span>&nbsp;<span class="ident" id="8306996">testUnixAddr</span><span class="op" id="8307008">(</span><span class="op" id="8307009">)</span><span class="op" id="8307010">,</span>&nbsp;<span class="ident" id="8307012">cnet</span><span class="op" id="8307016">:</span>&nbsp;<span class="string" id="8307018">&#34;unixgram&#34;</span><span class="op" id="8307028">,</span>&nbsp;<span class="ident" id="8307030">caddr</span><span class="op" id="8307035">:</span>&nbsp;<span class="ident" id="8307037">testUnixAddr</span><span class="op" id="8307049">(</span><span class="op" id="8307050">)</span><span class="op" id="8307051">}</span><span class="op" id="8307052">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307055">{</span><span class="ident" id="8307056">snet</span><span class="op" id="8307060">:</span>&nbsp;<span class="string" id="8307062">&#34;unixgram&#34;</span><span class="op" id="8307072">,</span>&nbsp;<span class="ident" id="8307074">saddr</span><span class="op" id="8307079">:</span>&nbsp;<span class="ident" id="8307081">testUnixAddr</span><span class="op" id="8307093">(</span><span class="op" id="8307094">)</span><span class="op" id="8307095">,</span>&nbsp;<span class="ident" id="8307097">cnet</span><span class="op" id="8307101">:</span>&nbsp;<span class="string" id="8307103">&#34;unixgram&#34;</span><span class="op" id="8307113">,</span>&nbsp;<span class="ident" id="8307115">caddr</span><span class="op" id="8307120">:</span>&nbsp;<span class="ident" id="8307122">testUnixAddr</span><span class="op" id="8307134">(</span><span class="op" id="8307135">)</span><span class="op" id="8307136">,</span>&nbsp;<span class="ident" id="8307138">dial</span><span class="op" id="8307142">:</span>&nbsp;<span class="builtintype" id="8307144">true</span><span class="op" id="8307148">}</span><span class="op" id="8307149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307152">{</span><span class="ident" id="8307153">snet</span><span class="op" id="8307157">:</span>&nbsp;<span class="string" id="8307159">&#34;unixgram&#34;</span><span class="op" id="8307169">,</span>&nbsp;<span class="ident" id="8307171">saddr</span><span class="op" id="8307176">:</span>&nbsp;<span class="ident" id="8307178">testUnixAddr</span><span class="op" id="8307190">(</span><span class="op" id="8307191">)</span><span class="op" id="8307192">,</span>&nbsp;<span class="ident" id="8307194">cnet</span><span class="op" id="8307198">:</span>&nbsp;<span class="string" id="8307200">&#34;unixgram&#34;</span><span class="op" id="8307210">,</span>&nbsp;<span class="ident" id="8307212">caddr</span><span class="op" id="8307217">:</span>&nbsp;<span class="ident" id="8307219">testUnixAddr</span><span class="op" id="8307231">(</span><span class="op" id="8307232">)</span><span class="op" id="8307233">,</span>&nbsp;<span class="ident" id="8307235">empty</span><span class="op" id="8307240">:</span>&nbsp;<span class="builtintype" id="8307242">true</span><span class="op" id="8307246">}</span><span class="op" id="8307247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307250">{</span><span class="ident" id="8307251">snet</span><span class="op" id="8307255">:</span>&nbsp;<span class="string" id="8307257">&#34;unixgram&#34;</span><span class="op" id="8307267">,</span>&nbsp;<span class="ident" id="8307269">saddr</span><span class="op" id="8307274">:</span>&nbsp;<span class="ident" id="8307276">testUnixAddr</span><span class="op" id="8307288">(</span><span class="op" id="8307289">)</span><span class="op" id="8307290">,</span>&nbsp;<span class="ident" id="8307292">cnet</span><span class="op" id="8307296">:</span>&nbsp;<span class="string" id="8307298">&#34;unixgram&#34;</span><span class="op" id="8307308">,</span>&nbsp;<span class="ident" id="8307310">caddr</span><span class="op" id="8307315">:</span>&nbsp;<span class="ident" id="8307317">testUnixAddr</span><span class="op" id="8307329">(</span><span class="op" id="8307330">)</span><span class="op" id="8307331">,</span>&nbsp;<span class="ident" id="8307333">dial</span><span class="op" id="8307337">:</span>&nbsp;<span class="builtintype" id="8307339">true</span><span class="op" id="8307343">,</span>&nbsp;<span class="ident" id="8307345">empty</span><span class="op" id="8307350">:</span>&nbsp;<span class="builtintype" id="8307352">true</span><span class="op" id="8307356">}</span><span class="op" id="8307357">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307361">{</span><span class="ident" id="8307362">snet</span><span class="op" id="8307366">:</span>&nbsp;<span class="string" id="8307368">&#34;unixgram&#34;</span><span class="op" id="8307378">,</span>&nbsp;<span class="ident" id="8307380">saddr</span><span class="op" id="8307385">:</span>&nbsp;<span class="string" id="8307387">&#34;@gotest6/net&#34;</span><span class="op" id="8307401">,</span>&nbsp;<span class="ident" id="8307403">cnet</span><span class="op" id="8307407">:</span>&nbsp;<span class="string" id="8307409">&#34;unixgram&#34;</span><span class="op" id="8307419">,</span>&nbsp;<span class="ident" id="8307421">caddr</span><span class="op" id="8307426">:</span>&nbsp;<span class="string" id="8307428">&#34;@gotest6/net.local&#34;</span><span class="op" id="8307448">,</span>&nbsp;<span class="ident" id="8307450">linuxOnly</span><span class="op" id="8307459">:</span>&nbsp;<span class="builtintype" id="8307461">true</span><span class="op" id="8307465">}</span><span class="op" id="8307466">,</span><br>
<span class="lineno">310</span><span class="op" id="8307468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8307471">func</span>&nbsp;<span class="ident" id="8307476">TestDatagramPacketConnServer</span><span class="op" id="8307504">(</span><span class="ident" id="8307505">t</span>&nbsp;<span class="op" id="8307507">*</span><span class="ident" id="8307508">testing</span><span class="op" id="8307515">.</span><span class="ident" id="8307516">T</span><span class="op" id="8307517">)</span>&nbsp;<span class="op" id="8307519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307522">if</span>&nbsp;<span class="op" id="8307525">!</span><span class="op" id="8307526">*</span><span class="ident" id="8307527">testDatagram</span>&nbsp;<span class="op" id="8307540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307544">return</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307556">for</span>&nbsp;<span class="ident" id="8307560">_</span><span class="op" id="8307561">,</span>&nbsp;<span class="ident" id="8307563">tt</span>&nbsp;<span class="op" id="8307566">:=</span>&nbsp;<span class="keyword" id="8307569">range</span>&nbsp;<span class="ident" id="8307575">datagramPacketConnServerTests</span>&nbsp;<span class="op" id="8307605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307609">if</span>&nbsp;<span class="ident" id="8307612">skipServerTest</span><span class="op" id="8307626">(</span><span class="ident" id="8307627">tt</span><span class="op" id="8307629">.</span><span class="ident" id="8307630">snet</span><span class="op" id="8307634">,</span>&nbsp;<span class="string" id="8307636">&#34;unixgram&#34;</span><span class="op" id="8307646">,</span>&nbsp;<span class="ident" id="8307648">tt</span><span class="op" id="8307650">.</span><span class="ident" id="8307651">saddr</span><span class="op" id="8307656">,</span>&nbsp;<span class="ident" id="8307658">tt</span><span class="op" id="8307660">.</span><span class="ident" id="8307661">ipv6</span><span class="op" id="8307665">,</span>&nbsp;<span class="ident" id="8307667">tt</span><span class="op" id="8307669">.</span><span class="ident" id="8307670">ipv4map</span><span class="op" id="8307677">,</span>&nbsp;<span class="ident" id="8307679">tt</span><span class="op" id="8307681">.</span><span class="ident" id="8307682">linuxOnly</span><span class="op" id="8307691">)</span>&nbsp;<span class="op" id="8307693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307698">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307714">listening</span>&nbsp;<span class="op" id="8307724">:=</span>&nbsp;<span class="builtinfunc" id="8307727">make</span><span class="op" id="8307731">(</span><span class="keyword" id="8307732">chan</span>&nbsp;<span class="builtintype" id="8307737">string</span><span class="op" id="8307743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307747">done</span>&nbsp;<span class="op" id="8307752">:=</span>&nbsp;<span class="builtinfunc" id="8307755">make</span><span class="op" id="8307759">(</span><span class="keyword" id="8307760">chan</span>&nbsp;<span class="builtintype" id="8307765">int</span><span class="op" id="8307768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307772">switch</span>&nbsp;<span class="ident" id="8307779">tt</span><span class="op" id="8307781">.</span><span class="ident" id="8307782">snet</span>&nbsp;<span class="op" id="8307787">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307791">case</span>&nbsp;<span class="string" id="8307796">&#34;udp&#34;</span><span class="op" id="8307801">,</span>&nbsp;<span class="string" id="8307803">&#34;udp4&#34;</span><span class="op" id="8307809">,</span>&nbsp;<span class="string" id="8307811">&#34;udp6&#34;</span><span class="op" id="8307817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307822">tt</span><span class="op" id="8307824">.</span><span class="ident" id="8307825">saddr</span>&nbsp;<span class="op" id="8307831">+=</span>&nbsp;<span class="string" id="8307834">&#34;:0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307841">case</span>&nbsp;<span class="string" id="8307846">&#34;unixgram&#34;</span><span class="op" id="8307856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307861">os</span><span class="op" id="8307863">.</span><span class="ident" id="8307864">Remove</span><span class="op" id="8307870">(</span><span class="ident" id="8307871">tt</span><span class="op" id="8307873">.</span><span class="ident" id="8307874">saddr</span><span class="op" id="8307879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307884">os</span><span class="op" id="8307886">.</span><span class="ident" id="8307887">Remove</span><span class="op" id="8307893">(</span><span class="ident" id="8307894">tt</span><span class="op" id="8307896">.</span><span class="ident" id="8307897">caddr</span><span class="op" id="8307902">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8307911">go</span>&nbsp;<span class="ident" id="8307914">runDatagramPacketConnServer</span><span class="op" id="8307941">(</span><span class="ident" id="8307942">t</span><span class="op" id="8307943">,</span>&nbsp;<span class="ident" id="8307945">tt</span><span class="op" id="8307947">.</span><span class="ident" id="8307948">snet</span><span class="op" id="8307952">,</span>&nbsp;<span class="ident" id="8307954">tt</span><span class="op" id="8307956">.</span><span class="ident" id="8307957">saddr</span><span class="op" id="8307962">,</span>&nbsp;<span class="ident" id="8307964">listening</span><span class="op" id="8307973">,</span>&nbsp;<span class="ident" id="8307975">done</span><span class="op" id="8307979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307983">taddr</span>&nbsp;<span class="op" id="8307989">:=</span>&nbsp;<span class="op" id="8307992">&lt;-</span><span class="ident" id="8307994">listening</span>&nbsp;<span class="comment" id="8308004">//&nbsp;wait&nbsp;for&nbsp;server&nbsp;to&nbsp;start</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308035">switch</span>&nbsp;<span class="ident" id="8308042">tt</span><span class="op" id="8308044">.</span><span class="ident" id="8308045">cnet</span>&nbsp;<span class="op" id="8308050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308054">case</span>&nbsp;<span class="string" id="8308059">&#34;udp&#34;</span><span class="op" id="8308064">,</span>&nbsp;<span class="string" id="8308066">&#34;udp4&#34;</span><span class="op" id="8308072">,</span>&nbsp;<span class="string" id="8308074">&#34;udp6&#34;</span><span class="op" id="8308080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308085">_</span><span class="op" id="8308086">,</span>&nbsp;<span class="ident" id="8308088">port</span><span class="op" id="8308092">,</span>&nbsp;<span class="ident" id="8308094">err</span>&nbsp;<span class="op" id="8308098">:=</span>&nbsp;<span class="ident" id="8308101">SplitHostPort</span><span class="op" id="8308114">(</span><span class="ident" id="8308115">taddr</span><span class="op" id="8308120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308125">if</span>&nbsp;<span class="ident" id="8308128">err</span>&nbsp;<span class="op" id="8308132">!=</span>&nbsp;<span class="ident" id="8308135">nil</span>&nbsp;<span class="op" id="8308139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308145">t</span><span class="op" id="8308146">.</span><span class="ident" id="8308147">Fatalf</span><span class="op" id="8308153">(</span><span class="string" id="8308154">&#34;SplitHostPort(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8308184">,</span>&nbsp;<span class="ident" id="8308186">taddr</span><span class="op" id="8308191">,</span>&nbsp;<span class="ident" id="8308193">err</span><span class="op" id="8308196">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308206">taddr</span>&nbsp;<span class="op" id="8308212">=</span>&nbsp;<span class="ident" id="8308214">tt</span><span class="op" id="8308216">.</span><span class="ident" id="8308217">caddr</span>&nbsp;<span class="op" id="8308223">+</span>&nbsp;<span class="string" id="8308225">&#34;:&#34;</span>&nbsp;<span class="op" id="8308229">+</span>&nbsp;<span class="ident" id="8308231">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308239">tt</span><span class="op" id="8308241">.</span><span class="ident" id="8308242">caddr</span>&nbsp;<span class="op" id="8308248">+=</span>&nbsp;<span class="string" id="8308251">&#34;:0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308262">if</span>&nbsp;<span class="ident" id="8308265">tt</span><span class="op" id="8308267">.</span><span class="ident" id="8308268">dial</span>&nbsp;<span class="op" id="8308273">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308278">runDatagramConnClient</span><span class="op" id="8308299">(</span><span class="ident" id="8308300">t</span><span class="op" id="8308301">,</span>&nbsp;<span class="ident" id="8308303">tt</span><span class="op" id="8308305">.</span><span class="ident" id="8308306">cnet</span><span class="op" id="8308310">,</span>&nbsp;<span class="ident" id="8308312">tt</span><span class="op" id="8308314">.</span><span class="ident" id="8308315">caddr</span><span class="op" id="8308320">,</span>&nbsp;<span class="ident" id="8308322">taddr</span><span class="op" id="8308327">,</span>&nbsp;<span class="ident" id="8308329">tt</span><span class="op" id="8308331">.</span><span class="ident" id="8308332">empty</span><span class="op" id="8308337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308341">}</span>&nbsp;<span class="keyword" id="8308343">else</span>&nbsp;<span class="op" id="8308348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308353">runDatagramPacketConnClient</span><span class="op" id="8308380">(</span><span class="ident" id="8308381">t</span><span class="op" id="8308382">,</span>&nbsp;<span class="ident" id="8308384">tt</span><span class="op" id="8308386">.</span><span class="ident" id="8308387">cnet</span><span class="op" id="8308391">,</span>&nbsp;<span class="ident" id="8308393">tt</span><span class="op" id="8308395">.</span><span class="ident" id="8308396">caddr</span><span class="op" id="8308401">,</span>&nbsp;<span class="ident" id="8308403">taddr</span><span class="op" id="8308408">,</span>&nbsp;<span class="ident" id="8308410">tt</span><span class="op" id="8308412">.</span><span class="ident" id="8308413">empty</span><span class="op" id="8308418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308426">&lt;-</span><span class="ident" id="8308428">done</span>&nbsp;<span class="comment" id="8308433">//&nbsp;tell&nbsp;server&nbsp;to&nbsp;stop</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308458">&lt;-</span><span class="ident" id="8308460">done</span>&nbsp;<span class="comment" id="8308465">//&nbsp;make&nbsp;sure&nbsp;server&nbsp;stopped</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308496">switch</span>&nbsp;<span class="ident" id="8308503">tt</span><span class="op" id="8308505">.</span><span class="ident" id="8308506">snet</span>&nbsp;<span class="op" id="8308511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308515">case</span>&nbsp;<span class="string" id="8308520">&#34;unixgram&#34;</span><span class="op" id="8308530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308535">os</span><span class="op" id="8308537">.</span><span class="ident" id="8308538">Remove</span><span class="op" id="8308544">(</span><span class="ident" id="8308545">tt</span><span class="op" id="8308547">.</span><span class="ident" id="8308548">saddr</span><span class="op" id="8308553">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308558">os</span><span class="op" id="8308560">.</span><span class="ident" id="8308561">Remove</span><span class="op" id="8308567">(</span><span class="ident" id="8308568">tt</span><span class="op" id="8308570">.</span><span class="ident" id="8308571">caddr</span><span class="op" id="8308576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308583">}</span><br>
<span class="lineno"></span><span class="op" id="8308585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="8308588">func</span>&nbsp;<span class="ident" id="8308593">runDatagramPacketConnServer</span><span class="op" id="8308620">(</span><span class="ident" id="8308621">t</span>&nbsp;<span class="op" id="8308623">*</span><span class="ident" id="8308624">testing</span><span class="op" id="8308631">.</span><span class="ident" id="8308632">T</span><span class="op" id="8308633">,</span>&nbsp;<span class="ident" id="8308635">net</span><span class="op" id="8308638">,</span>&nbsp;<span class="ident" id="8308640">laddr</span>&nbsp;<span class="builtintype" id="8308646">string</span><span class="op" id="8308652">,</span>&nbsp;<span class="ident" id="8308654">listening</span>&nbsp;<span class="keyword" id="8308664">chan</span><span class="op" id="8308668">&lt;-</span>&nbsp;<span class="builtintype" id="8308671">string</span><span class="op" id="8308677">,</span>&nbsp;<span class="ident" id="8308679">done</span>&nbsp;<span class="keyword" id="8308684">chan</span><span class="op" id="8308688">&lt;-</span>&nbsp;<span class="builtintype" id="8308691">int</span><span class="op" id="8308694">)</span>&nbsp;<span class="op" id="8308696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308699">c</span><span class="op" id="8308700">,</span>&nbsp;<span class="ident" id="8308702">err</span>&nbsp;<span class="op" id="8308706">:=</span>&nbsp;<span class="ident" id="8308709">ListenPacket</span><span class="op" id="8308721">(</span><span class="ident" id="8308722">net</span><span class="op" id="8308725">,</span>&nbsp;<span class="ident" id="8308727">laddr</span><span class="op" id="8308732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308735">if</span>&nbsp;<span class="ident" id="8308738">err</span>&nbsp;<span class="op" id="8308742">!=</span>&nbsp;<span class="ident" id="8308745">nil</span>&nbsp;<span class="op" id="8308749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308753">t</span><span class="op" id="8308754">.</span><span class="ident" id="8308755">Errorf</span><span class="op" id="8308761">(</span><span class="string" id="8308762">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8308795">,</span>&nbsp;<span class="ident" id="8308797">net</span><span class="op" id="8308800">,</span>&nbsp;<span class="ident" id="8308802">laddr</span><span class="op" id="8308807">,</span>&nbsp;<span class="ident" id="8308809">err</span><span class="op" id="8308812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308816">listening</span>&nbsp;<span class="op" id="8308826">&lt;-</span>&nbsp;<span class="string" id="8308829">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308839">done</span>&nbsp;<span class="op" id="8308844">&lt;-</span>&nbsp;<span class="num" id="8308847">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308851">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8308859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308862">defer</span>&nbsp;<span class="ident" id="8308868">c</span><span class="op" id="8308869">.</span><span class="ident" id="8308870">Close</span><span class="op" id="8308875">(</span><span class="op" id="8308876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308879">listening</span>&nbsp;<span class="op" id="8308889">&lt;-</span>&nbsp;<span class="ident" id="8308892">c</span><span class="op" id="8308893">.</span><span class="ident" id="8308894">LocalAddr</span><span class="op" id="8308903">(</span><span class="op" id="8308904">)</span><span class="op" id="8308905">.</span><span class="ident" id="8308906">String</span><span class="op" id="8308912">(</span><span class="op" id="8308913">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308917">buf</span>&nbsp;<span class="op" id="8308921">:=</span>&nbsp;<span class="builtinfunc" id="8308924">make</span><span class="op" id="8308928">(</span><span class="op" id="8308929">[</span><span class="op" id="8308930">]</span><span class="builtintype" id="8308931">byte</span><span class="op" id="8308935">,</span>&nbsp;<span class="num" id="8308937">1024</span><span class="op" id="8308941">)</span><br>
<span class="lineno"></span><span class="ident" id="8308943">run</span><span class="op" id="8308946">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8308949">for</span>&nbsp;<span class="op" id="8308953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8308957">c</span><span class="op" id="8308958">.</span><span class="ident" id="8308959">SetReadDeadline</span><span class="op" id="8308974">(</span><span class="ident" id="8308975">time</span><span class="op" id="8308979">.</span><span class="ident" id="8308980">Now</span><span class="op" id="8308983">(</span><span class="op" id="8308984">)</span><span class="op" id="8308985">.</span><span class="ident" id="8308986">Add</span><span class="op" id="8308989">(</span><span class="num" id="8308990">10</span>&nbsp;<span class="op" id="8308993">*</span>&nbsp;<span class="ident" id="8308995">time</span><span class="op" id="8308999">.</span><span class="ident" id="8309000">Millisecond</span><span class="op" id="8309011">)</span><span class="op" id="8309012">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309016">n</span><span class="op" id="8309017">,</span>&nbsp;<span class="ident" id="8309019">ra</span><span class="op" id="8309021">,</span>&nbsp;<span class="ident" id="8309023">err</span>&nbsp;<span class="op" id="8309027">:=</span>&nbsp;<span class="ident" id="8309030">c</span><span class="op" id="8309031">.</span><span class="ident" id="8309032">ReadFrom</span><span class="op" id="8309040">(</span><span class="ident" id="8309041">buf</span><span class="op" id="8309044">[</span><span class="num" id="8309045">0</span><span class="op" id="8309046">:</span><span class="op" id="8309047">]</span><span class="op" id="8309048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309052">if</span>&nbsp;<span class="ident" id="8309055">nerr</span><span class="op" id="8309059">,</span>&nbsp;<span class="ident" id="8309061">ok</span>&nbsp;<span class="op" id="8309064">:=</span>&nbsp;<span class="ident" id="8309067">err</span><span class="op" id="8309070">.</span><span class="op" id="8309071">(</span><span class="ident" id="8309072">Error</span><span class="op" id="8309077">)</span><span class="op" id="8309078">;</span>&nbsp;<span class="ident" id="8309080">ok</span>&nbsp;<span class="op" id="8309083">&amp;&amp;</span>&nbsp;<span class="ident" id="8309086">nerr</span><span class="op" id="8309090">.</span><span class="ident" id="8309091">Timeout</span><span class="op" id="8309098">(</span><span class="op" id="8309099">)</span>&nbsp;<span class="op" id="8309101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309106">select</span>&nbsp;<span class="op" id="8309113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309118">case</span>&nbsp;<span class="ident" id="8309123">done</span>&nbsp;<span class="op" id="8309128">&lt;-</span>&nbsp;<span class="num" id="8309131">1</span><span class="op" id="8309132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309138">break</span>&nbsp;<span class="ident" id="8309144">run</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309151">default</span><span class="op" id="8309158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309164">continue</span>&nbsp;<span class="ident" id="8309173">run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309188">if</span>&nbsp;<span class="ident" id="8309191">err</span>&nbsp;<span class="op" id="8309195">!=</span>&nbsp;<span class="ident" id="8309198">nil</span>&nbsp;<span class="op" id="8309202">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309207">break</span>&nbsp;<span class="ident" id="8309213">run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309223">if</span>&nbsp;<span class="ident" id="8309226">_</span><span class="op" id="8309227">,</span>&nbsp;<span class="ident" id="8309229">err</span>&nbsp;<span class="op" id="8309233">=</span>&nbsp;<span class="ident" id="8309235">c</span><span class="op" id="8309236">.</span><span class="ident" id="8309237">WriteTo</span><span class="op" id="8309244">(</span><span class="ident" id="8309245">buf</span><span class="op" id="8309248">[</span><span class="num" id="8309249">0</span><span class="op" id="8309250">:</span><span class="ident" id="8309251">n</span><span class="op" id="8309252">]</span><span class="op" id="8309253">,</span>&nbsp;<span class="ident" id="8309255">ra</span><span class="op" id="8309257">)</span><span class="op" id="8309258">;</span>&nbsp;<span class="ident" id="8309260">err</span>&nbsp;<span class="op" id="8309264">!=</span>&nbsp;<span class="ident" id="8309267">nil</span>&nbsp;<span class="op" id="8309271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309276">t</span><span class="op" id="8309277">.</span><span class="ident" id="8309278">Errorf</span><span class="op" id="8309284">(</span><span class="string" id="8309285">&#34;WriteTo(%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8309309">,</span>&nbsp;<span class="ident" id="8309311">ra</span><span class="op" id="8309313">,</span>&nbsp;<span class="ident" id="8309315">err</span><span class="op" id="8309318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309323">break</span>&nbsp;<span class="ident" id="8309329">run</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309341">done</span>&nbsp;<span class="op" id="8309346">&lt;-</span>&nbsp;<span class="num" id="8309349">1</span><br>
<span class="lineno"></span><span class="op" id="8309351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="keyword" id="8309354">func</span>&nbsp;<span class="ident" id="8309359">runDatagramConnClient</span><span class="op" id="8309380">(</span><span class="ident" id="8309381">t</span>&nbsp;<span class="op" id="8309383">*</span><span class="ident" id="8309384">testing</span><span class="op" id="8309391">.</span><span class="ident" id="8309392">T</span><span class="op" id="8309393">,</span>&nbsp;<span class="ident" id="8309395">net</span><span class="op" id="8309398">,</span>&nbsp;<span class="ident" id="8309400">laddr</span><span class="op" id="8309405">,</span>&nbsp;<span class="ident" id="8309407">taddr</span>&nbsp;<span class="builtintype" id="8309413">string</span><span class="op" id="8309419">,</span>&nbsp;<span class="ident" id="8309421">isEmpty</span>&nbsp;<span class="builtintype" id="8309429">bool</span><span class="op" id="8309433">)</span>&nbsp;<span class="op" id="8309435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309438">var</span>&nbsp;<span class="ident" id="8309442">c</span>&nbsp;<span class="ident" id="8309444">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309450">var</span>&nbsp;<span class="ident" id="8309454">err</span>&nbsp;<span class="builtintype" id="8309458">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309465">switch</span>&nbsp;<span class="ident" id="8309472">net</span>&nbsp;<span class="op" id="8309476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309479">case</span>&nbsp;<span class="string" id="8309484">&#34;udp&#34;</span><span class="op" id="8309489">,</span>&nbsp;<span class="string" id="8309491">&#34;udp4&#34;</span><span class="op" id="8309497">,</span>&nbsp;<span class="string" id="8309499">&#34;udp6&#34;</span><span class="op" id="8309505">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309509">c</span><span class="op" id="8309510">,</span>&nbsp;<span class="ident" id="8309512">err</span>&nbsp;<span class="op" id="8309516">=</span>&nbsp;<span class="ident" id="8309518">Dial</span><span class="op" id="8309522">(</span><span class="ident" id="8309523">net</span><span class="op" id="8309526">,</span>&nbsp;<span class="ident" id="8309528">taddr</span><span class="op" id="8309533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309537">if</span>&nbsp;<span class="ident" id="8309540">err</span>&nbsp;<span class="op" id="8309544">!=</span>&nbsp;<span class="ident" id="8309547">nil</span>&nbsp;<span class="op" id="8309551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309556">t</span><span class="op" id="8309557">.</span><span class="ident" id="8309558">Fatalf</span><span class="op" id="8309564">(</span><span class="string" id="8309565">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8309590">,</span>&nbsp;<span class="ident" id="8309592">net</span><span class="op" id="8309595">,</span>&nbsp;<span class="ident" id="8309597">taddr</span><span class="op" id="8309602">,</span>&nbsp;<span class="ident" id="8309604">err</span><span class="op" id="8309607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309614">case</span>&nbsp;<span class="string" id="8309619">&#34;unixgram&#34;</span><span class="op" id="8309629">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309633">c</span><span class="op" id="8309634">,</span>&nbsp;<span class="ident" id="8309636">err</span>&nbsp;<span class="op" id="8309640">=</span>&nbsp;<span class="ident" id="8309642">DialUnix</span><span class="op" id="8309650">(</span><span class="ident" id="8309651">net</span><span class="op" id="8309654">,</span>&nbsp;<span class="op" id="8309656">&amp;</span><span class="ident" id="8309657">UnixAddr</span><span class="op" id="8309665">{</span><span class="ident" id="8309666">Name</span><span class="op" id="8309670">:</span>&nbsp;<span class="ident" id="8309672">laddr</span><span class="op" id="8309677">,</span>&nbsp;<span class="ident" id="8309679">Net</span><span class="op" id="8309682">:</span>&nbsp;<span class="ident" id="8309684">net</span><span class="op" id="8309687">}</span><span class="op" id="8309688">,</span>&nbsp;<span class="op" id="8309690">&amp;</span><span class="ident" id="8309691">UnixAddr</span><span class="op" id="8309699">{</span><span class="ident" id="8309700">Name</span><span class="op" id="8309704">:</span>&nbsp;<span class="ident" id="8309706">taddr</span><span class="op" id="8309711">,</span>&nbsp;<span class="ident" id="8309713">Net</span><span class="op" id="8309716">:</span>&nbsp;<span class="ident" id="8309718">net</span><span class="op" id="8309721">}</span><span class="op" id="8309722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309726">if</span>&nbsp;<span class="ident" id="8309729">err</span>&nbsp;<span class="op" id="8309733">!=</span>&nbsp;<span class="ident" id="8309736">nil</span>&nbsp;<span class="op" id="8309740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309745">t</span><span class="op" id="8309746">.</span><span class="ident" id="8309747">Fatalf</span><span class="op" id="8309753">(</span><span class="string" id="8309754">&#34;DialUnix(%q,&nbsp;{%q,&nbsp;%q})&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8309789">,</span>&nbsp;<span class="ident" id="8309791">net</span><span class="op" id="8309794">,</span>&nbsp;<span class="ident" id="8309796">laddr</span><span class="op" id="8309801">,</span>&nbsp;<span class="ident" id="8309803">taddr</span><span class="op" id="8309808">,</span>&nbsp;<span class="ident" id="8309810">err</span><span class="op" id="8309813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309820">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309823">defer</span>&nbsp;<span class="ident" id="8309829">c</span><span class="op" id="8309830">.</span><span class="ident" id="8309831">Close</span><span class="op" id="8309836">(</span><span class="op" id="8309837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309840">c</span><span class="op" id="8309841">.</span><span class="ident" id="8309842">SetReadDeadline</span><span class="op" id="8309857">(</span><span class="ident" id="8309858">time</span><span class="op" id="8309862">.</span><span class="ident" id="8309863">Now</span><span class="op" id="8309866">(</span><span class="op" id="8309867">)</span><span class="op" id="8309868">.</span><span class="ident" id="8309869">Add</span><span class="op" id="8309872">(</span><span class="num" id="8309873">1</span>&nbsp;<span class="op" id="8309875">*</span>&nbsp;<span class="ident" id="8309877">time</span><span class="op" id="8309881">.</span><span class="ident" id="8309882">Second</span><span class="op" id="8309888">)</span><span class="op" id="8309889">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309893">var</span>&nbsp;<span class="ident" id="8309897">wb</span>&nbsp;<span class="op" id="8309900">[</span><span class="op" id="8309901">]</span><span class="builtintype" id="8309902">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309908">if</span>&nbsp;<span class="op" id="8309911">!</span><span class="ident" id="8309912">isEmpty</span>&nbsp;<span class="op" id="8309920">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8309924">wb</span>&nbsp;<span class="op" id="8309927">=</span>&nbsp;<span class="op" id="8309929">[</span><span class="op" id="8309930">]</span><span class="builtintype" id="8309931">byte</span><span class="op" id="8309935">(</span><span class="string" id="8309936">&#34;DatagramConnClient&nbsp;by&nbsp;Dial\n&#34;</span><span class="op" id="8309966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8309969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8309972">if</span>&nbsp;<span class="ident" id="8309975">n</span><span class="op" id="8309976">,</span>&nbsp;<span class="ident" id="8309978">err</span>&nbsp;<span class="op" id="8309982">:=</span>&nbsp;<span class="ident" id="8309985">c</span><span class="op" id="8309986">.</span><span class="ident" id="8309987">Write</span><span class="op" id="8309992">(</span><span class="ident" id="8309993">wb</span><span class="op" id="8309995">[</span><span class="num" id="8309996">0</span><span class="op" id="8309997">:</span><span class="op" id="8309998">]</span><span class="op" id="8309999">)</span><span class="op" id="8310000">;</span>&nbsp;<span class="ident" id="8310002">err</span>&nbsp;<span class="op" id="8310006">!=</span>&nbsp;<span class="ident" id="8310009">nil</span>&nbsp;<span class="op" id="8310013">||</span>&nbsp;<span class="ident" id="8310016">n</span>&nbsp;<span class="op" id="8310018">!=</span>&nbsp;<span class="builtinfunc" id="8310021">len</span><span class="op" id="8310024">(</span><span class="ident" id="8310025">wb</span><span class="op" id="8310027">)</span>&nbsp;<span class="op" id="8310029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310033">t</span><span class="op" id="8310034">.</span><span class="ident" id="8310035">Fatalf</span><span class="op" id="8310041">(</span><span class="string" id="8310042">&#34;Write&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="8310080">,</span>&nbsp;<span class="ident" id="8310082">n</span><span class="op" id="8310083">,</span>&nbsp;<span class="ident" id="8310085">err</span><span class="op" id="8310088">,</span>&nbsp;<span class="builtinfunc" id="8310090">len</span><span class="op" id="8310093">(</span><span class="ident" id="8310094">wb</span><span class="op" id="8310096">)</span><span class="op" id="8310097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310100">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310104">rb</span>&nbsp;<span class="op" id="8310107">:=</span>&nbsp;<span class="builtinfunc" id="8310110">make</span><span class="op" id="8310114">(</span><span class="op" id="8310115">[</span><span class="op" id="8310116">]</span><span class="builtintype" id="8310117">byte</span><span class="op" id="8310121">,</span>&nbsp;<span class="num" id="8310123">1024</span><span class="op" id="8310127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310130">if</span>&nbsp;<span class="ident" id="8310133">n</span><span class="op" id="8310134">,</span>&nbsp;<span class="ident" id="8310136">err</span>&nbsp;<span class="op" id="8310140">:=</span>&nbsp;<span class="ident" id="8310143">c</span><span class="op" id="8310144">.</span><span class="ident" id="8310145">Read</span><span class="op" id="8310149">(</span><span class="ident" id="8310150">rb</span><span class="op" id="8310152">[</span><span class="num" id="8310153">0</span><span class="op" id="8310154">:</span><span class="op" id="8310155">]</span><span class="op" id="8310156">)</span><span class="op" id="8310157">;</span>&nbsp;<span class="ident" id="8310159">err</span>&nbsp;<span class="op" id="8310163">!=</span>&nbsp;<span class="ident" id="8310166">nil</span>&nbsp;<span class="op" id="8310170">||</span>&nbsp;<span class="ident" id="8310173">n</span>&nbsp;<span class="op" id="8310175">!=</span>&nbsp;<span class="builtinfunc" id="8310178">len</span><span class="op" id="8310181">(</span><span class="ident" id="8310182">wb</span><span class="op" id="8310184">)</span>&nbsp;<span class="op" id="8310186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310190">t</span><span class="op" id="8310191">.</span><span class="ident" id="8310192">Fatalf</span><span class="op" id="8310198">(</span><span class="string" id="8310199">&#34;Read&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="8310236">,</span>&nbsp;<span class="ident" id="8310238">n</span><span class="op" id="8310239">,</span>&nbsp;<span class="ident" id="8310241">err</span><span class="op" id="8310244">,</span>&nbsp;<span class="builtinfunc" id="8310246">len</span><span class="op" id="8310249">(</span><span class="ident" id="8310250">wb</span><span class="op" id="8310252">)</span><span class="op" id="8310253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310256">}</span><br>
<span class="lineno">425</span><span class="op" id="8310258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8310261">func</span>&nbsp;<span class="ident" id="8310266">runDatagramPacketConnClient</span><span class="op" id="8310293">(</span><span class="ident" id="8310294">t</span>&nbsp;<span class="op" id="8310296">*</span><span class="ident" id="8310297">testing</span><span class="op" id="8310304">.</span><span class="ident" id="8310305">T</span><span class="op" id="8310306">,</span>&nbsp;<span class="ident" id="8310308">net</span><span class="op" id="8310311">,</span>&nbsp;<span class="ident" id="8310313">laddr</span><span class="op" id="8310318">,</span>&nbsp;<span class="ident" id="8310320">taddr</span>&nbsp;<span class="builtintype" id="8310326">string</span><span class="op" id="8310332">,</span>&nbsp;<span class="ident" id="8310334">isEmpty</span>&nbsp;<span class="builtintype" id="8310342">bool</span><span class="op" id="8310346">)</span>&nbsp;<span class="op" id="8310348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310351">var</span>&nbsp;<span class="ident" id="8310355">ra</span>&nbsp;<span class="ident" id="8310358">Addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310364">var</span>&nbsp;<span class="ident" id="8310368">err</span>&nbsp;<span class="builtintype" id="8310372">error</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310379">switch</span>&nbsp;<span class="ident" id="8310386">net</span>&nbsp;<span class="op" id="8310390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310393">case</span>&nbsp;<span class="string" id="8310398">&#34;udp&#34;</span><span class="op" id="8310403">,</span>&nbsp;<span class="string" id="8310405">&#34;udp4&#34;</span><span class="op" id="8310411">,</span>&nbsp;<span class="string" id="8310413">&#34;udp6&#34;</span><span class="op" id="8310419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310423">ra</span><span class="op" id="8310425">,</span>&nbsp;<span class="ident" id="8310427">err</span>&nbsp;<span class="op" id="8310431">=</span>&nbsp;<span class="ident" id="8310433">ResolveUDPAddr</span><span class="op" id="8310447">(</span><span class="ident" id="8310448">net</span><span class="op" id="8310451">,</span>&nbsp;<span class="ident" id="8310453">taddr</span><span class="op" id="8310458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310462">if</span>&nbsp;<span class="ident" id="8310465">err</span>&nbsp;<span class="op" id="8310469">!=</span>&nbsp;<span class="ident" id="8310472">nil</span>&nbsp;<span class="op" id="8310476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310481">t</span><span class="op" id="8310482">.</span><span class="ident" id="8310483">Fatalf</span><span class="op" id="8310489">(</span><span class="string" id="8310490">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8310525">,</span>&nbsp;<span class="ident" id="8310527">net</span><span class="op" id="8310530">,</span>&nbsp;<span class="ident" id="8310532">taddr</span><span class="op" id="8310537">,</span>&nbsp;<span class="ident" id="8310539">err</span><span class="op" id="8310542">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310549">case</span>&nbsp;<span class="string" id="8310554">&#34;unixgram&#34;</span><span class="op" id="8310564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310568">ra</span><span class="op" id="8310570">,</span>&nbsp;<span class="ident" id="8310572">err</span>&nbsp;<span class="op" id="8310576">=</span>&nbsp;<span class="ident" id="8310578">ResolveUnixAddr</span><span class="op" id="8310593">(</span><span class="ident" id="8310594">net</span><span class="op" id="8310597">,</span>&nbsp;<span class="ident" id="8310599">taddr</span><span class="op" id="8310604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310608">if</span>&nbsp;<span class="ident" id="8310611">err</span>&nbsp;<span class="op" id="8310615">!=</span>&nbsp;<span class="ident" id="8310618">nil</span>&nbsp;<span class="op" id="8310622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310627">t</span><span class="op" id="8310628">.</span><span class="ident" id="8310629">Fatalf</span><span class="op" id="8310635">(</span><span class="string" id="8310636">&#34;ResolveUxixAddr(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8310672">,</span>&nbsp;<span class="ident" id="8310674">net</span><span class="op" id="8310677">,</span>&nbsp;<span class="ident" id="8310679">taddr</span><span class="op" id="8310684">,</span>&nbsp;<span class="ident" id="8310686">err</span><span class="op" id="8310689">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310699">c</span><span class="op" id="8310700">,</span>&nbsp;<span class="ident" id="8310702">err</span>&nbsp;<span class="op" id="8310706">:=</span>&nbsp;<span class="ident" id="8310709">ListenPacket</span><span class="op" id="8310721">(</span><span class="ident" id="8310722">net</span><span class="op" id="8310725">,</span>&nbsp;<span class="ident" id="8310727">laddr</span><span class="op" id="8310732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310735">if</span>&nbsp;<span class="ident" id="8310738">err</span>&nbsp;<span class="op" id="8310742">!=</span>&nbsp;<span class="ident" id="8310745">nil</span>&nbsp;<span class="op" id="8310749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310753">t</span><span class="op" id="8310754">.</span><span class="ident" id="8310755">Fatalf</span><span class="op" id="8310761">(</span><span class="string" id="8310762">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;faild:&nbsp;%v&#34;</span><span class="op" id="8310794">,</span>&nbsp;<span class="ident" id="8310796">net</span><span class="op" id="8310799">,</span>&nbsp;<span class="ident" id="8310801">laddr</span><span class="op" id="8310806">,</span>&nbsp;<span class="ident" id="8310808">err</span><span class="op" id="8310811">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310817">defer</span>&nbsp;<span class="ident" id="8310823">c</span><span class="op" id="8310824">.</span><span class="ident" id="8310825">Close</span><span class="op" id="8310830">(</span><span class="op" id="8310831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310834">c</span><span class="op" id="8310835">.</span><span class="ident" id="8310836">SetReadDeadline</span><span class="op" id="8310851">(</span><span class="ident" id="8310852">time</span><span class="op" id="8310856">.</span><span class="ident" id="8310857">Now</span><span class="op" id="8310860">(</span><span class="op" id="8310861">)</span><span class="op" id="8310862">.</span><span class="ident" id="8310863">Add</span><span class="op" id="8310866">(</span><span class="num" id="8310867">1</span>&nbsp;<span class="op" id="8310869">*</span>&nbsp;<span class="ident" id="8310871">time</span><span class="op" id="8310875">.</span><span class="ident" id="8310876">Second</span><span class="op" id="8310882">)</span><span class="op" id="8310883">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310887">var</span>&nbsp;<span class="ident" id="8310891">wb</span>&nbsp;<span class="op" id="8310894">[</span><span class="op" id="8310895">]</span><span class="builtintype" id="8310896">byte</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310902">if</span>&nbsp;<span class="op" id="8310905">!</span><span class="ident" id="8310906">isEmpty</span>&nbsp;<span class="op" id="8310914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8310918">wb</span>&nbsp;<span class="op" id="8310921">=</span>&nbsp;<span class="op" id="8310923">[</span><span class="op" id="8310924">]</span><span class="builtintype" id="8310925">byte</span><span class="op" id="8310929">(</span><span class="string" id="8310930">&#34;DatagramPacketConnClient&nbsp;by&nbsp;ListenPacket\n&#34;</span><span class="op" id="8310974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8310977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8310980">if</span>&nbsp;<span class="ident" id="8310983">n</span><span class="op" id="8310984">,</span>&nbsp;<span class="ident" id="8310986">err</span>&nbsp;<span class="op" id="8310990">:=</span>&nbsp;<span class="ident" id="8310993">c</span><span class="op" id="8310994">.</span><span class="ident" id="8310995">WriteTo</span><span class="op" id="8311002">(</span><span class="ident" id="8311003">wb</span><span class="op" id="8311005">[</span><span class="num" id="8311006">0</span><span class="op" id="8311007">:</span><span class="op" id="8311008">]</span><span class="op" id="8311009">,</span>&nbsp;<span class="ident" id="8311011">ra</span><span class="op" id="8311013">)</span><span class="op" id="8311014">;</span>&nbsp;<span class="ident" id="8311016">err</span>&nbsp;<span class="op" id="8311020">!=</span>&nbsp;<span class="ident" id="8311023">nil</span>&nbsp;<span class="op" id="8311027">||</span>&nbsp;<span class="ident" id="8311030">n</span>&nbsp;<span class="op" id="8311032">!=</span>&nbsp;<span class="builtinfunc" id="8311035">len</span><span class="op" id="8311038">(</span><span class="ident" id="8311039">wb</span><span class="op" id="8311041">)</span>&nbsp;<span class="op" id="8311043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311047">t</span><span class="op" id="8311048">.</span><span class="ident" id="8311049">Fatalf</span><span class="op" id="8311055">(</span><span class="string" id="8311056">&#34;WriteTo(%v)&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="8311100">,</span>&nbsp;<span class="ident" id="8311102">ra</span><span class="op" id="8311104">,</span>&nbsp;<span class="ident" id="8311106">n</span><span class="op" id="8311107">,</span>&nbsp;<span class="ident" id="8311109">err</span><span class="op" id="8311112">,</span>&nbsp;<span class="builtinfunc" id="8311114">len</span><span class="op" id="8311117">(</span><span class="ident" id="8311118">wb</span><span class="op" id="8311120">)</span><span class="op" id="8311121">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311128">rb</span>&nbsp;<span class="op" id="8311131">:=</span>&nbsp;<span class="builtinfunc" id="8311134">make</span><span class="op" id="8311138">(</span><span class="op" id="8311139">[</span><span class="op" id="8311140">]</span><span class="builtintype" id="8311141">byte</span><span class="op" id="8311145">,</span>&nbsp;<span class="num" id="8311147">1024</span><span class="op" id="8311151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8311154">if</span>&nbsp;<span class="ident" id="8311157">n</span><span class="op" id="8311158">,</span>&nbsp;<span class="ident" id="8311160">_</span><span class="op" id="8311161">,</span>&nbsp;<span class="ident" id="8311163">err</span>&nbsp;<span class="op" id="8311167">:=</span>&nbsp;<span class="ident" id="8311170">c</span><span class="op" id="8311171">.</span><span class="ident" id="8311172">ReadFrom</span><span class="op" id="8311180">(</span><span class="ident" id="8311181">rb</span><span class="op" id="8311183">[</span><span class="num" id="8311184">0</span><span class="op" id="8311185">:</span><span class="op" id="8311186">]</span><span class="op" id="8311187">)</span><span class="op" id="8311188">;</span>&nbsp;<span class="ident" id="8311190">err</span>&nbsp;<span class="op" id="8311194">!=</span>&nbsp;<span class="ident" id="8311197">nil</span>&nbsp;<span class="op" id="8311201">||</span>&nbsp;<span class="ident" id="8311204">n</span>&nbsp;<span class="op" id="8311206">!=</span>&nbsp;<span class="builtinfunc" id="8311209">len</span><span class="op" id="8311212">(</span><span class="ident" id="8311213">wb</span><span class="op" id="8311215">)</span>&nbsp;<span class="op" id="8311217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8311221">t</span><span class="op" id="8311222">.</span><span class="ident" id="8311223">Fatalf</span><span class="op" id="8311229">(</span><span class="string" id="8311230">&#34;ReadFrom&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="8311271">,</span>&nbsp;<span class="ident" id="8311273">n</span><span class="op" id="8311274">,</span>&nbsp;<span class="ident" id="8311276">err</span><span class="op" id="8311279">,</span>&nbsp;<span class="builtinfunc" id="8311281">len</span><span class="op" id="8311284">(</span><span class="ident" id="8311285">wb</span><span class="op" id="8311287">)</span><span class="op" id="8311288">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8311291">}</span><br>
<span class="lineno"></span><span class="op" id="8311293">}</span>
</div>
</body>
</html>
