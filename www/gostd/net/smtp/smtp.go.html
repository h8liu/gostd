<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5938953">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5939008">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5939062">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5939113">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="5939198">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="5939246">//&nbsp;&nbsp;&nbsp;&nbsp8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="5939268">//&nbsp;&nbsp;&nbsp;&nbspAUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="5939290">//&nbsp;&nbsp;&nbsp;&nbspSTARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="5939312">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5939364">package</span>&nbsp;<span class="ident" id="5939372">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5939378">import</span>&nbsp;<span class="op" id="5939385">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5939388">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5939402">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5939421">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5939431">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5939437">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5939444">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5939461">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5939471">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5939474">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5939536">type</span>&nbsp;<span class="ident" id="5939541">Client</span>&nbsp;<span class="keyword" id="5939548">struct</span>&nbsp;<span class="op" id="5939555">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5939558">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5939637">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939668">Text</span>&nbsp;<span class="op" id="5939673">*</span><span class="ident" id="5939674">textproto</span><span class="op" id="5939683">.</span><span class="ident" id="5939684">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5939690">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5939763">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939784">conn</span>&nbsp;<span class="ident" id="5939789">net</span><span class="op" id="5939792">.</span><span class="ident" id="5939793">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5939799">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939835">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5939846">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939852">serverName</span>&nbsp;<span class="builtintype" id="5939863">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5939871">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939903">ext</span>&nbsp;<span class="keyword" id="5939907">map</span><span class="op" id="5939910">[</span><span class="builtintype" id="5939911">string</span><span class="op" id="5939917">]</span><span class="builtintype" id="5939918">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5939926">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939956">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5939967">[</span><span class="op" id="5939968">]</span><span class="builtintype" id="5939969">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939977">localName</span>&nbsp;&nbsp;<span class="builtintype" id="5939988">string</span>&nbsp;<span class="comment" id="5939995">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940028">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5940039">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5940046">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940079">helloError</span>&nbsp;<span class="builtintype" id="5940090">error</span>&nbsp;&nbsp;<span class="comment" id="5940097">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="5940125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5940128">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="5940194">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="5940234">func</span>&nbsp;<span class="ident" id="5940239">Dial</span><span class="op" id="5940243">(</span><span class="ident" id="5940244">addr</span>&nbsp;<span class="builtintype" id="5940249">string</span><span class="op" id="5940255">)</span>&nbsp;<span class="op" id="5940257">(</span><span class="op" id="5940258">*</span><span class="ident" id="5940259">Client</span><span class="op" id="5940265">,</span>&nbsp;<span class="builtintype" id="5940267">error</span><span class="op" id="5940272">)</span>&nbsp;<span class="op" id="5940274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940277">conn</span><span class="op" id="5940281">,</span>&nbsp;<span class="ident" id="5940283">err</span>&nbsp;<span class="op" id="5940287">:=</span>&nbsp;<span class="ident" id="5940290">net</span><span class="op" id="5940293">.</span><span class="ident" id="5940294">Dial</span><span class="op" id="5940298">(</span><span class="string" id="5940299">&#34;tcp&#34;</span><span class="op" id="5940304">,</span>&nbsp;<span class="ident" id="5940306">addr</span><span class="op" id="5940310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940313">if</span>&nbsp;<span class="ident" id="5940316">err</span>&nbsp;<span class="op" id="5940320">!=</span>&nbsp;<span class="ident" id="5940323">nil</span>&nbsp;<span class="op" id="5940327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940331">return</span>&nbsp;<span class="ident" id="5940338">nil</span><span class="op" id="5940341">,</span>&nbsp;<span class="ident" id="5940343">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940348">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940351">host</span><span class="op" id="5940355">,</span>&nbsp;<span class="ident" id="5940357">_</span><span class="op" id="5940358">,</span>&nbsp;<span class="ident" id="5940360">_</span>&nbsp;<span class="op" id="5940362">:=</span>&nbsp;<span class="ident" id="5940365">net</span><span class="op" id="5940368">.</span><span class="ident" id="5940369">SplitHostPort</span><span class="op" id="5940382">(</span><span class="ident" id="5940383">addr</span><span class="op" id="5940387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940390">return</span>&nbsp;<span class="ident" id="5940397">NewClient</span><span class="op" id="5940406">(</span><span class="ident" id="5940407">conn</span><span class="op" id="5940411">,</span>&nbsp;<span class="ident" id="5940413">host</span><span class="op" id="5940417">)</span><br>
<span class="lineno"></span><span class="op" id="5940419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5940422">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="5940499">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="5940546">func</span>&nbsp;<span class="ident" id="5940551">NewClient</span><span class="op" id="5940560">(</span><span class="ident" id="5940561">conn</span>&nbsp;<span class="ident" id="5940566">net</span><span class="op" id="5940569">.</span><span class="ident" id="5940570">Conn</span><span class="op" id="5940574">,</span>&nbsp;<span class="ident" id="5940576">host</span>&nbsp;<span class="builtintype" id="5940581">string</span><span class="op" id="5940587">)</span>&nbsp;<span class="op" id="5940589">(</span><span class="op" id="5940590">*</span><span class="ident" id="5940591">Client</span><span class="op" id="5940597">,</span>&nbsp;<span class="builtintype" id="5940599">error</span><span class="op" id="5940604">)</span>&nbsp;<span class="op" id="5940606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940609">text</span>&nbsp;<span class="op" id="5940614">:=</span>&nbsp;<span class="ident" id="5940617">textproto</span><span class="op" id="5940626">.</span><span class="ident" id="5940627">NewConn</span><span class="op" id="5940634">(</span><span class="ident" id="5940635">conn</span><span class="op" id="5940639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940642">_</span><span class="op" id="5940643">,</span>&nbsp;<span class="ident" id="5940645">_</span><span class="op" id="5940646">,</span>&nbsp;<span class="ident" id="5940648">err</span>&nbsp;<span class="op" id="5940652">:=</span>&nbsp;<span class="ident" id="5940655">text</span><span class="op" id="5940659">.</span><span class="ident" id="5940660">ReadResponse</span><span class="op" id="5940672">(</span><span class="num" id="5940673">220</span><span class="op" id="5940676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940679">if</span>&nbsp;<span class="ident" id="5940682">err</span>&nbsp;<span class="op" id="5940686">!=</span>&nbsp;<span class="ident" id="5940689">nil</span>&nbsp;<span class="op" id="5940693">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940697">text</span><span class="op" id="5940701">.</span><span class="ident" id="5940702">Close</span><span class="op" id="5940707">(</span><span class="op" id="5940708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940712">return</span>&nbsp;<span class="ident" id="5940719">nil</span><span class="op" id="5940722">,</span>&nbsp;<span class="ident" id="5940724">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940732">c</span>&nbsp;<span class="op" id="5940734">:=</span>&nbsp;<span class="op" id="5940737">&amp;</span><span class="ident" id="5940738">Client</span><span class="op" id="5940744">{</span><span class="ident" id="5940745">Text</span><span class="op" id="5940749">:</span>&nbsp;<span class="ident" id="5940751">text</span><span class="op" id="5940755">,</span>&nbsp;<span class="ident" id="5940757">conn</span><span class="op" id="5940761">:</span>&nbsp;<span class="ident" id="5940763">conn</span><span class="op" id="5940767">,</span>&nbsp;<span class="ident" id="5940769">serverName</span><span class="op" id="5940779">:</span>&nbsp;<span class="ident" id="5940781">host</span><span class="op" id="5940785">,</span>&nbsp;<span class="ident" id="5940787">localName</span><span class="op" id="5940796">:</span>&nbsp;<span class="string" id="5940798">&#34;localhost&#34;</span><span class="op" id="5940809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940812">return</span>&nbsp;<span class="ident" id="5940819">c</span><span class="op" id="5940820">,</span>&nbsp;<span class="ident" id="5940822">nil</span><br>
<span class="lineno">65</span><span class="op" id="5940826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5940829">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5940861">func</span>&nbsp;<span class="op" id="5940866">(</span><span class="ident" id="5940867">c</span>&nbsp;<span class="op" id="5940869">*</span><span class="ident" id="5940870">Client</span><span class="op" id="5940876">)</span>&nbsp;<span class="ident" id="5940878">Close</span><span class="op" id="5940883">(</span><span class="op" id="5940884">)</span>&nbsp;<span class="builtintype" id="5940886">error</span>&nbsp;<span class="op" id="5940892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940895">return</span>&nbsp;<span class="ident" id="5940902">c</span><span class="op" id="5940903">.</span><span class="ident" id="5940904">Text</span><span class="op" id="5940908">.</span><span class="ident" id="5940909">Close</span><span class="op" id="5940914">(</span><span class="op" id="5940915">)</span><br>
<span class="lineno">70</span><span class="op" id="5940917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5940920">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="5940962">func</span>&nbsp;<span class="op" id="5940967">(</span><span class="ident" id="5940968">c</span>&nbsp;<span class="op" id="5940970">*</span><span class="ident" id="5940971">Client</span><span class="op" id="5940977">)</span>&nbsp;<span class="ident" id="5940979">hello</span><span class="op" id="5940984">(</span><span class="op" id="5940985">)</span>&nbsp;<span class="builtintype" id="5940987">error</span>&nbsp;<span class="op" id="5940993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940996">if</span>&nbsp;<span class="op" id="5940999">!</span><span class="ident" id="5941000">c</span><span class="op" id="5941001">.</span><span class="ident" id="5941002">didHello</span>&nbsp;<span class="op" id="5941011">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941015">c</span><span class="op" id="5941016">.</span><span class="ident" id="5941017">didHello</span>&nbsp;<span class="op" id="5941026">=</span>&nbsp;<span class="builtintype" id="5941028">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941035">err</span>&nbsp;<span class="op" id="5941039">:=</span>&nbsp;<span class="ident" id="5941042">c</span><span class="op" id="5941043">.</span><span class="ident" id="5941044">ehlo</span><span class="op" id="5941048">(</span><span class="op" id="5941049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941053">if</span>&nbsp;<span class="ident" id="5941056">err</span>&nbsp;<span class="op" id="5941060">!=</span>&nbsp;<span class="ident" id="5941063">nil</span>&nbsp;<span class="op" id="5941067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941072">c</span><span class="op" id="5941073">.</span><span class="ident" id="5941074">helloError</span>&nbsp;<span class="op" id="5941085">=</span>&nbsp;<span class="ident" id="5941087">c</span><span class="op" id="5941088">.</span><span class="ident" id="5941089">helo</span><span class="op" id="5941093">(</span><span class="op" id="5941094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941098">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941104">return</span>&nbsp;<span class="ident" id="5941111">c</span><span class="op" id="5941112">.</span><span class="ident" id="5941113">helloError</span><br>
<span class="lineno"></span><span class="op" id="5941124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5941127">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="5941195">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="5941264">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5941341">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="5941415">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="5941444">func</span>&nbsp;<span class="op" id="5941449">(</span><span class="ident" id="5941450">c</span>&nbsp;<span class="op" id="5941452">*</span><span class="ident" id="5941453">Client</span><span class="op" id="5941459">)</span>&nbsp;<span class="ident" id="5941461">Hello</span><span class="op" id="5941466">(</span><span class="ident" id="5941467">localName</span>&nbsp;<span class="builtintype" id="5941477">string</span><span class="op" id="5941483">)</span>&nbsp;<span class="builtintype" id="5941485">error</span>&nbsp;<span class="op" id="5941491">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941494">if</span>&nbsp;<span class="ident" id="5941497">c</span><span class="op" id="5941498">.</span><span class="ident" id="5941499">didHello</span>&nbsp;<span class="op" id="5941508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941512">return</span>&nbsp;<span class="ident" id="5941519">errors</span><span class="op" id="5941525">.</span><span class="ident" id="5941526">New</span><span class="op" id="5941529">(</span><span class="string" id="5941530">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="5941570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941576">c</span><span class="op" id="5941577">.</span><span class="ident" id="5941578">localName</span>&nbsp;<span class="op" id="5941588">=</span>&nbsp;<span class="ident" id="5941590">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941601">return</span>&nbsp;<span class="ident" id="5941608">c</span><span class="op" id="5941609">.</span><span class="ident" id="5941610">hello</span><span class="op" id="5941615">(</span><span class="op" id="5941616">)</span><br>
<span class="lineno">95</span><span class="op" id="5941618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5941621">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="5941700">func</span>&nbsp;<span class="op" id="5941705">(</span><span class="ident" id="5941706">c</span>&nbsp;<span class="op" id="5941708">*</span><span class="ident" id="5941709">Client</span><span class="op" id="5941715">)</span>&nbsp;<span class="ident" id="5941717">cmd</span><span class="op" id="5941720">(</span><span class="ident" id="5941721">expectCode</span>&nbsp;<span class="builtintype" id="5941732">int</span><span class="op" id="5941735">,</span>&nbsp;<span class="ident" id="5941737">format</span>&nbsp;<span class="builtintype" id="5941744">string</span><span class="op" id="5941750">,</span>&nbsp;<span class="ident" id="5941752">args</span>&nbsp;<span class="op" id="5941757">...</span><span class="keyword" id="5941760">interface</span><span class="op" id="5941769">{</span><span class="op" id="5941770">}</span><span class="op" id="5941771">)</span>&nbsp;<span class="op" id="5941773">(</span><span class="builtintype" id="5941774">int</span><span class="op" id="5941777">,</span>&nbsp;<span class="builtintype" id="5941779">string</span><span class="op" id="5941785">,</span>&nbsp;<span class="builtintype" id="5941787">error</span><span class="op" id="5941792">)</span>&nbsp;<span class="op" id="5941794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941797">id</span><span class="op" id="5941799">,</span>&nbsp;<span class="ident" id="5941801">err</span>&nbsp;<span class="op" id="5941805">:=</span>&nbsp;<span class="ident" id="5941808">c</span><span class="op" id="5941809">.</span><span class="ident" id="5941810">Text</span><span class="op" id="5941814">.</span><span class="ident" id="5941815">Cmd</span><span class="op" id="5941818">(</span><span class="ident" id="5941819">format</span><span class="op" id="5941825">,</span>&nbsp;<span class="ident" id="5941827">args</span><span class="op" id="5941831">...</span><span class="op" id="5941834">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941837">if</span>&nbsp;<span class="ident" id="5941840">err</span>&nbsp;<span class="op" id="5941844">!=</span>&nbsp;<span class="ident" id="5941847">nil</span>&nbsp;<span class="op" id="5941851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941855">return</span>&nbsp;<span class="num" id="5941862">0</span><span class="op" id="5941863">,</span>&nbsp;<span class="string" id="5941865">&#34;&#34;</span><span class="op" id="5941867">,</span>&nbsp;<span class="ident" id="5941869">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941877">c</span><span class="op" id="5941878">.</span><span class="ident" id="5941879">Text</span><span class="op" id="5941883">.</span><span class="ident" id="5941884">StartResponse</span><span class="op" id="5941897">(</span><span class="ident" id="5941898">id</span><span class="op" id="5941900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941903">defer</span>&nbsp;<span class="ident" id="5941909">c</span><span class="op" id="5941910">.</span><span class="ident" id="5941911">Text</span><span class="op" id="5941915">.</span><span class="ident" id="5941916">EndResponse</span><span class="op" id="5941927">(</span><span class="ident" id="5941928">id</span><span class="op" id="5941930">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941933">code</span><span class="op" id="5941937">,</span>&nbsp;<span class="ident" id="5941939">msg</span><span class="op" id="5941942">,</span>&nbsp;<span class="ident" id="5941944">err</span>&nbsp;<span class="op" id="5941948">:=</span>&nbsp;<span class="ident" id="5941951">c</span><span class="op" id="5941952">.</span><span class="ident" id="5941953">Text</span><span class="op" id="5941957">.</span><span class="ident" id="5941958">ReadResponse</span><span class="op" id="5941970">(</span><span class="ident" id="5941971">expectCode</span><span class="op" id="5941981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941984">return</span>&nbsp;<span class="ident" id="5941991">code</span><span class="op" id="5941995">,</span>&nbsp;<span class="ident" id="5941997">msg</span><span class="op" id="5942000">,</span>&nbsp;<span class="ident" id="5942002">err</span><br>
<span class="lineno"></span><span class="op" id="5942006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5942009">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="5942088">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="5942121">func</span>&nbsp;<span class="op" id="5942126">(</span><span class="ident" id="5942127">c</span>&nbsp;<span class="op" id="5942129">*</span><span class="ident" id="5942130">Client</span><span class="op" id="5942136">)</span>&nbsp;<span class="ident" id="5942138">helo</span><span class="op" id="5942142">(</span><span class="op" id="5942143">)</span>&nbsp;<span class="builtintype" id="5942145">error</span>&nbsp;<span class="op" id="5942151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942154">c</span><span class="op" id="5942155">.</span><span class="ident" id="5942156">ext</span>&nbsp;<span class="op" id="5942160">=</span>&nbsp;<span class="ident" id="5942162">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942167">_</span><span class="op" id="5942168">,</span>&nbsp;<span class="ident" id="5942170">_</span><span class="op" id="5942171">,</span>&nbsp;<span class="ident" id="5942173">err</span>&nbsp;<span class="op" id="5942177">:=</span>&nbsp;<span class="ident" id="5942180">c</span><span class="op" id="5942181">.</span><span class="ident" id="5942182">cmd</span><span class="op" id="5942185">(</span><span class="num" id="5942186">250</span><span class="op" id="5942189">,</span>&nbsp;<span class="string" id="5942191">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="5942200">,</span>&nbsp;<span class="ident" id="5942202">c</span><span class="op" id="5942203">.</span><span class="ident" id="5942204">localName</span><span class="op" id="5942213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942216">return</span>&nbsp;<span class="ident" id="5942223">err</span><br>
<span class="lineno">115</span><span class="op" id="5942227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5942230">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5942297">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5942362">func</span>&nbsp;<span class="op" id="5942367">(</span><span class="ident" id="5942368">c</span>&nbsp;<span class="op" id="5942370">*</span><span class="ident" id="5942371">Client</span><span class="op" id="5942377">)</span>&nbsp;<span class="ident" id="5942379">ehlo</span><span class="op" id="5942383">(</span><span class="op" id="5942384">)</span>&nbsp;<span class="builtintype" id="5942386">error</span>&nbsp;<span class="op" id="5942392">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942395">_</span><span class="op" id="5942396">,</span>&nbsp;<span class="ident" id="5942398">msg</span><span class="op" id="5942401">,</span>&nbsp;<span class="ident" id="5942403">err</span>&nbsp;<span class="op" id="5942407">:=</span>&nbsp;<span class="ident" id="5942410">c</span><span class="op" id="5942411">.</span><span class="ident" id="5942412">cmd</span><span class="op" id="5942415">(</span><span class="num" id="5942416">250</span><span class="op" id="5942419">,</span>&nbsp;<span class="string" id="5942421">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="5942430">,</span>&nbsp;<span class="ident" id="5942432">c</span><span class="op" id="5942433">.</span><span class="ident" id="5942434">localName</span><span class="op" id="5942443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942446">if</span>&nbsp;<span class="ident" id="5942449">err</span>&nbsp;<span class="op" id="5942453">!=</span>&nbsp;<span class="ident" id="5942456">nil</span>&nbsp;<span class="op" id="5942460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942464">return</span>&nbsp;<span class="ident" id="5942471">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942479">ext</span>&nbsp;<span class="op" id="5942483">:=</span>&nbsp;<span class="builtinfunc" id="5942486">make</span><span class="op" id="5942490">(</span><span class="keyword" id="5942491">map</span><span class="op" id="5942494">[</span><span class="builtintype" id="5942495">string</span><span class="op" id="5942501">]</span><span class="builtintype" id="5942502">string</span><span class="op" id="5942508">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942511">extList</span>&nbsp;<span class="op" id="5942519">:=</span>&nbsp;<span class="ident" id="5942522">strings</span><span class="op" id="5942529">.</span><span class="ident" id="5942530">Split</span><span class="op" id="5942535">(</span><span class="ident" id="5942536">msg</span><span class="op" id="5942539">,</span>&nbsp;<span class="string" id="5942541">&#34;\n&#34;</span><span class="op" id="5942545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942548">if</span>&nbsp;<span class="builtinfunc" id="5942551">len</span><span class="op" id="5942554">(</span><span class="ident" id="5942555">extList</span><span class="op" id="5942562">)</span>&nbsp;<span class="op" id="5942564">&gt;</span>&nbsp;<span class="num" id="5942566">1</span>&nbsp;<span class="op" id="5942568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942572">extList</span>&nbsp;<span class="op" id="5942580">=</span>&nbsp;<span class="ident" id="5942582">extList</span><span class="op" id="5942589">[</span><span class="num" id="5942590">1</span><span class="op" id="5942591">:</span><span class="op" id="5942592">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942596">for</span>&nbsp;<span class="ident" id="5942600">_</span><span class="op" id="5942601">,</span>&nbsp;<span class="ident" id="5942603">line</span>&nbsp;<span class="op" id="5942608">:=</span>&nbsp;<span class="keyword" id="5942611">range</span>&nbsp;<span class="ident" id="5942617">extList</span>&nbsp;<span class="op" id="5942625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942630">args</span>&nbsp;<span class="op" id="5942635">:=</span>&nbsp;<span class="ident" id="5942638">strings</span><span class="op" id="5942645">.</span><span class="ident" id="5942646">SplitN</span><span class="op" id="5942652">(</span><span class="ident" id="5942653">line</span><span class="op" id="5942657">,</span>&nbsp;<span class="string" id="5942659">&#34;&nbsp;&#34;</span><span class="op" id="5942662">,</span>&nbsp;<span class="num" id="5942664">2</span><span class="op" id="5942665">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942670">if</span>&nbsp;<span class="builtinfunc" id="5942673">len</span><span class="op" id="5942676">(</span><span class="ident" id="5942677">args</span><span class="op" id="5942681">)</span>&nbsp;<span class="op" id="5942683">&gt;</span>&nbsp;<span class="num" id="5942685">1</span>&nbsp;<span class="op" id="5942687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942693">ext</span><span class="op" id="5942696">[</span><span class="ident" id="5942697">args</span><span class="op" id="5942701">[</span><span class="num" id="5942702">0</span><span class="op" id="5942703">]</span><span class="op" id="5942704">]</span>&nbsp;<span class="op" id="5942706">=</span>&nbsp;<span class="ident" id="5942708">args</span><span class="op" id="5942712">[</span><span class="num" id="5942713">1</span><span class="op" id="5942714">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942719">}</span>&nbsp;<span class="keyword" id="5942721">else</span>&nbsp;<span class="op" id="5942726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942732">ext</span><span class="op" id="5942735">[</span><span class="ident" id="5942736">args</span><span class="op" id="5942740">[</span><span class="num" id="5942741">0</span><span class="op" id="5942742">]</span><span class="op" id="5942743">]</span>&nbsp;<span class="op" id="5942745">=</span>&nbsp;<span class="string" id="5942747">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942753">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942763">if</span>&nbsp;<span class="ident" id="5942766">mechs</span><span class="op" id="5942771">,</span>&nbsp;<span class="ident" id="5942773">ok</span>&nbsp;<span class="op" id="5942776">:=</span>&nbsp;<span class="ident" id="5942779">ext</span><span class="op" id="5942782">[</span><span class="string" id="5942783">&#34;AUTH&#34;</span><span class="op" id="5942789">]</span><span class="op" id="5942790">;</span>&nbsp;<span class="ident" id="5942792">ok</span>&nbsp;<span class="op" id="5942795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942799">c</span><span class="op" id="5942800">.</span><span class="ident" id="5942801">auth</span>&nbsp;<span class="op" id="5942806">=</span>&nbsp;<span class="ident" id="5942808">strings</span><span class="op" id="5942815">.</span><span class="ident" id="5942816">Split</span><span class="op" id="5942821">(</span><span class="ident" id="5942822">mechs</span><span class="op" id="5942827">,</span>&nbsp;<span class="string" id="5942829">&#34;&nbsp;&#34;</span><span class="op" id="5942832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942835">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942838">c</span><span class="op" id="5942839">.</span><span class="ident" id="5942840">ext</span>&nbsp;<span class="op" id="5942844">=</span>&nbsp;<span class="ident" id="5942846">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942851">return</span>&nbsp;<span class="ident" id="5942858">err</span><br>
<span class="lineno"></span><span class="op" id="5942862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5942865">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="5942944">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="5943021">func</span>&nbsp;<span class="op" id="5943026">(</span><span class="ident" id="5943027">c</span>&nbsp;<span class="op" id="5943029">*</span><span class="ident" id="5943030">Client</span><span class="op" id="5943036">)</span>&nbsp;<span class="ident" id="5943038">StartTLS</span><span class="op" id="5943046">(</span><span class="ident" id="5943047">config</span>&nbsp;<span class="op" id="5943054">*</span><span class="ident" id="5943055">tls</span><span class="op" id="5943058">.</span><span class="ident" id="5943059">Config</span><span class="op" id="5943065">)</span>&nbsp;<span class="builtintype" id="5943067">error</span>&nbsp;<span class="op" id="5943073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943076">if</span>&nbsp;<span class="ident" id="5943079">err</span>&nbsp;<span class="op" id="5943083">:=</span>&nbsp;<span class="ident" id="5943086">c</span><span class="op" id="5943087">.</span><span class="ident" id="5943088">hello</span><span class="op" id="5943093">(</span><span class="op" id="5943094">)</span><span class="op" id="5943095">;</span>&nbsp;<span class="ident" id="5943097">err</span>&nbsp;<span class="op" id="5943101">!=</span>&nbsp;<span class="ident" id="5943104">nil</span>&nbsp;<span class="op" id="5943108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943112">return</span>&nbsp;<span class="ident" id="5943119">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943124">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943127">_</span><span class="op" id="5943128">,</span>&nbsp;<span class="ident" id="5943130">_</span><span class="op" id="5943131">,</span>&nbsp;<span class="ident" id="5943133">err</span>&nbsp;<span class="op" id="5943137">:=</span>&nbsp;<span class="ident" id="5943140">c</span><span class="op" id="5943141">.</span><span class="ident" id="5943142">cmd</span><span class="op" id="5943145">(</span><span class="num" id="5943146">220</span><span class="op" id="5943149">,</span>&nbsp;<span class="string" id="5943151">&#34;STARTTLS&#34;</span><span class="op" id="5943161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943164">if</span>&nbsp;<span class="ident" id="5943167">err</span>&nbsp;<span class="op" id="5943171">!=</span>&nbsp;<span class="ident" id="5943174">nil</span>&nbsp;<span class="op" id="5943178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943182">return</span>&nbsp;<span class="ident" id="5943189">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943197">c</span><span class="op" id="5943198">.</span><span class="ident" id="5943199">conn</span>&nbsp;<span class="op" id="5943204">=</span>&nbsp;<span class="ident" id="5943206">tls</span><span class="op" id="5943209">.</span><span class="ident" id="5943210">Client</span><span class="op" id="5943216">(</span><span class="ident" id="5943217">c</span><span class="op" id="5943218">.</span><span class="ident" id="5943219">conn</span><span class="op" id="5943223">,</span>&nbsp;<span class="ident" id="5943225">config</span><span class="op" id="5943231">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943234">c</span><span class="op" id="5943235">.</span><span class="ident" id="5943236">Text</span>&nbsp;<span class="op" id="5943241">=</span>&nbsp;<span class="ident" id="5943243">textproto</span><span class="op" id="5943252">.</span><span class="ident" id="5943253">NewConn</span><span class="op" id="5943260">(</span><span class="ident" id="5943261">c</span><span class="op" id="5943262">.</span><span class="ident" id="5943263">conn</span><span class="op" id="5943267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943270">c</span><span class="op" id="5943271">.</span><span class="ident" id="5943272">tls</span>&nbsp;<span class="op" id="5943276">=</span>&nbsp;<span class="builtintype" id="5943278">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943284">return</span>&nbsp;<span class="ident" id="5943291">c</span><span class="op" id="5943292">.</span><span class="ident" id="5943293">ehlo</span><span class="op" id="5943297">(</span><span class="op" id="5943298">)</span><br>
<span class="lineno"></span><span class="op" id="5943300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5943303">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5943368">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5943433">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="5943499">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="5943550">func</span>&nbsp;<span class="op" id="5943555">(</span><span class="ident" id="5943556">c</span>&nbsp;<span class="op" id="5943558">*</span><span class="ident" id="5943559">Client</span><span class="op" id="5943565">)</span>&nbsp;<span class="ident" id="5943567">Verify</span><span class="op" id="5943573">(</span><span class="ident" id="5943574">addr</span>&nbsp;<span class="builtintype" id="5943579">string</span><span class="op" id="5943585">)</span>&nbsp;<span class="builtintype" id="5943587">error</span>&nbsp;<span class="op" id="5943593">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943596">if</span>&nbsp;<span class="ident" id="5943599">err</span>&nbsp;<span class="op" id="5943603">:=</span>&nbsp;<span class="ident" id="5943606">c</span><span class="op" id="5943607">.</span><span class="ident" id="5943608">hello</span><span class="op" id="5943613">(</span><span class="op" id="5943614">)</span><span class="op" id="5943615">;</span>&nbsp;<span class="ident" id="5943617">err</span>&nbsp;<span class="op" id="5943621">!=</span>&nbsp;<span class="ident" id="5943624">nil</span>&nbsp;<span class="op" id="5943628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943632">return</span>&nbsp;<span class="ident" id="5943639">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943647">_</span><span class="op" id="5943648">,</span>&nbsp;<span class="ident" id="5943650">_</span><span class="op" id="5943651">,</span>&nbsp;<span class="ident" id="5943653">err</span>&nbsp;<span class="op" id="5943657">:=</span>&nbsp;<span class="ident" id="5943660">c</span><span class="op" id="5943661">.</span><span class="ident" id="5943662">cmd</span><span class="op" id="5943665">(</span><span class="num" id="5943666">250</span><span class="op" id="5943669">,</span>&nbsp;<span class="string" id="5943671">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="5943680">,</span>&nbsp;<span class="ident" id="5943682">addr</span><span class="op" id="5943686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943689">return</span>&nbsp;<span class="ident" id="5943696">err</span><br>
<span class="lineno">170</span><span class="op" id="5943700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5943703">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="5943779">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5943829">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="5943902">func</span>&nbsp;<span class="op" id="5943907">(</span><span class="ident" id="5943908">c</span>&nbsp;<span class="op" id="5943910">*</span><span class="ident" id="5943911">Client</span><span class="op" id="5943917">)</span>&nbsp;<span class="ident" id="5943919">Auth</span><span class="op" id="5943923">(</span><span class="ident" id="5943924">a</span>&nbsp;<span class="ident" id="5943926">Auth</span><span class="op" id="5943930">)</span>&nbsp;<span class="builtintype" id="5943932">error</span>&nbsp;<span class="op" id="5943938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943941">if</span>&nbsp;<span class="ident" id="5943944">err</span>&nbsp;<span class="op" id="5943948">:=</span>&nbsp;<span class="ident" id="5943951">c</span><span class="op" id="5943952">.</span><span class="ident" id="5943953">hello</span><span class="op" id="5943958">(</span><span class="op" id="5943959">)</span><span class="op" id="5943960">;</span>&nbsp;<span class="ident" id="5943962">err</span>&nbsp;<span class="op" id="5943966">!=</span>&nbsp;<span class="ident" id="5943969">nil</span>&nbsp;<span class="op" id="5943973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943977">return</span>&nbsp;<span class="ident" id="5943984">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943992">encoding</span>&nbsp;<span class="op" id="5944001">:=</span>&nbsp;<span class="ident" id="5944004">base64</span><span class="op" id="5944010">.</span><span class="ident" id="5944011">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944024">mech</span><span class="op" id="5944028">,</span>&nbsp;<span class="ident" id="5944030">resp</span><span class="op" id="5944034">,</span>&nbsp;<span class="ident" id="5944036">err</span>&nbsp;<span class="op" id="5944040">:=</span>&nbsp;<span class="ident" id="5944043">a</span><span class="op" id="5944044">.</span><span class="ident" id="5944045">Start</span><span class="op" id="5944050">(</span><span class="op" id="5944051">&amp;</span><span class="ident" id="5944052">ServerInfo</span><span class="op" id="5944062">{</span><span class="ident" id="5944063">c</span><span class="op" id="5944064">.</span><span class="ident" id="5944065">serverName</span><span class="op" id="5944075">,</span>&nbsp;<span class="ident" id="5944077">c</span><span class="op" id="5944078">.</span><span class="ident" id="5944079">tls</span><span class="op" id="5944082">,</span>&nbsp;<span class="ident" id="5944084">c</span><span class="op" id="5944085">.</span><span class="ident" id="5944086">auth</span><span class="op" id="5944090">}</span><span class="op" id="5944091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944094">if</span>&nbsp;<span class="ident" id="5944097">err</span>&nbsp;<span class="op" id="5944101">!=</span>&nbsp;<span class="ident" id="5944104">nil</span>&nbsp;<span class="op" id="5944108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944112">c</span><span class="op" id="5944113">.</span><span class="ident" id="5944114">Quit</span><span class="op" id="5944118">(</span><span class="op" id="5944119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944123">return</span>&nbsp;<span class="ident" id="5944130">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944135">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944138">resp64</span>&nbsp;<span class="op" id="5944145">:=</span>&nbsp;<span class="builtinfunc" id="5944148">make</span><span class="op" id="5944152">(</span><span class="op" id="5944153">[</span><span class="op" id="5944154">]</span><span class="builtintype" id="5944155">byte</span><span class="op" id="5944159">,</span>&nbsp;<span class="ident" id="5944161">encoding</span><span class="op" id="5944169">.</span><span class="ident" id="5944170">EncodedLen</span><span class="op" id="5944180">(</span><span class="builtinfunc" id="5944181">len</span><span class="op" id="5944184">(</span><span class="ident" id="5944185">resp</span><span class="op" id="5944189">)</span><span class="op" id="5944190">)</span><span class="op" id="5944191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944194">encoding</span><span class="op" id="5944202">.</span><span class="ident" id="5944203">Encode</span><span class="op" id="5944209">(</span><span class="ident" id="5944210">resp64</span><span class="op" id="5944216">,</span>&nbsp;<span class="ident" id="5944218">resp</span><span class="op" id="5944222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944225">code</span><span class="op" id="5944229">,</span>&nbsp;<span class="ident" id="5944231">msg64</span><span class="op" id="5944236">,</span>&nbsp;<span class="ident" id="5944238">err</span>&nbsp;<span class="op" id="5944242">:=</span>&nbsp;<span class="ident" id="5944245">c</span><span class="op" id="5944246">.</span><span class="ident" id="5944247">cmd</span><span class="op" id="5944250">(</span><span class="num" id="5944251">0</span><span class="op" id="5944252">,</span>&nbsp;<span class="string" id="5944254">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="5944266">,</span>&nbsp;<span class="ident" id="5944268">mech</span><span class="op" id="5944272">,</span>&nbsp;<span class="ident" id="5944274">resp64</span><span class="op" id="5944280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944283">for</span>&nbsp;<span class="ident" id="5944287">err</span>&nbsp;<span class="op" id="5944291">==</span>&nbsp;<span class="ident" id="5944294">nil</span>&nbsp;<span class="op" id="5944298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944302">var</span>&nbsp;<span class="ident" id="5944306">msg</span>&nbsp;<span class="op" id="5944310">[</span><span class="op" id="5944311">]</span><span class="builtintype" id="5944312">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944319">switch</span>&nbsp;<span class="ident" id="5944326">code</span>&nbsp;<span class="op" id="5944331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944335">case</span>&nbsp;<span class="num" id="5944340">334</span><span class="op" id="5944343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944348">msg</span><span class="op" id="5944351">,</span>&nbsp;<span class="ident" id="5944353">err</span>&nbsp;<span class="op" id="5944357">=</span>&nbsp;<span class="ident" id="5944359">encoding</span><span class="op" id="5944367">.</span><span class="ident" id="5944368">DecodeString</span><span class="op" id="5944380">(</span><span class="ident" id="5944381">msg64</span><span class="op" id="5944386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944390">case</span>&nbsp;<span class="num" id="5944395">235</span><span class="op" id="5944398">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944403">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944468">msg</span>&nbsp;<span class="op" id="5944472">=</span>&nbsp;<span class="op" id="5944474">[</span><span class="op" id="5944475">]</span><span class="builtintype" id="5944476">byte</span><span class="op" id="5944480">(</span><span class="ident" id="5944481">msg64</span><span class="op" id="5944486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944490">default</span><span class="op" id="5944497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944502">err</span>&nbsp;<span class="op" id="5944506">=</span>&nbsp;<span class="op" id="5944508">&amp;</span><span class="ident" id="5944509">textproto</span><span class="op" id="5944518">.</span><span class="ident" id="5944519">Error</span><span class="op" id="5944524">{</span><span class="ident" id="5944525">Code</span><span class="op" id="5944529">:</span>&nbsp;<span class="ident" id="5944531">code</span><span class="op" id="5944535">,</span>&nbsp;<span class="ident" id="5944537">Msg</span><span class="op" id="5944540">:</span>&nbsp;<span class="ident" id="5944542">msg64</span><span class="op" id="5944547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944555">if</span>&nbsp;<span class="ident" id="5944558">err</span>&nbsp;<span class="op" id="5944562">==</span>&nbsp;<span class="ident" id="5944565">nil</span>&nbsp;<span class="op" id="5944569">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944574">resp</span><span class="op" id="5944578">,</span>&nbsp;<span class="ident" id="5944580">err</span>&nbsp;<span class="op" id="5944584">=</span>&nbsp;<span class="ident" id="5944586">a</span><span class="op" id="5944587">.</span><span class="ident" id="5944588">Next</span><span class="op" id="5944592">(</span><span class="ident" id="5944593">msg</span><span class="op" id="5944596">,</span>&nbsp;<span class="ident" id="5944598">code</span>&nbsp;<span class="op" id="5944603">==</span>&nbsp;<span class="num" id="5944606">334</span><span class="op" id="5944609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944617">if</span>&nbsp;<span class="ident" id="5944620">err</span>&nbsp;<span class="op" id="5944624">!=</span>&nbsp;<span class="ident" id="5944627">nil</span>&nbsp;<span class="op" id="5944631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944636">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944657">c</span><span class="op" id="5944658">.</span><span class="ident" id="5944659">cmd</span><span class="op" id="5944662">(</span><span class="num" id="5944663">501</span><span class="op" id="5944666">,</span>&nbsp;<span class="string" id="5944668">&#34;*&#34;</span><span class="op" id="5944671">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944676">c</span><span class="op" id="5944677">.</span><span class="ident" id="5944678">Quit</span><span class="op" id="5944682">(</span><span class="op" id="5944683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944688">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944700">if</span>&nbsp;<span class="ident" id="5944703">resp</span>&nbsp;<span class="op" id="5944708">==</span>&nbsp;<span class="ident" id="5944711">nil</span>&nbsp;<span class="op" id="5944715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944720">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944732">resp64</span>&nbsp;<span class="op" id="5944739">=</span>&nbsp;<span class="builtinfunc" id="5944741">make</span><span class="op" id="5944745">(</span><span class="op" id="5944746">[</span><span class="op" id="5944747">]</span><span class="builtintype" id="5944748">byte</span><span class="op" id="5944752">,</span>&nbsp;<span class="ident" id="5944754">encoding</span><span class="op" id="5944762">.</span><span class="ident" id="5944763">EncodedLen</span><span class="op" id="5944773">(</span><span class="builtinfunc" id="5944774">len</span><span class="op" id="5944777">(</span><span class="ident" id="5944778">resp</span><span class="op" id="5944782">)</span><span class="op" id="5944783">)</span><span class="op" id="5944784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944788">encoding</span><span class="op" id="5944796">.</span><span class="ident" id="5944797">Encode</span><span class="op" id="5944803">(</span><span class="ident" id="5944804">resp64</span><span class="op" id="5944810">,</span>&nbsp;<span class="ident" id="5944812">resp</span><span class="op" id="5944816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944820">code</span><span class="op" id="5944824">,</span>&nbsp;<span class="ident" id="5944826">msg64</span><span class="op" id="5944831">,</span>&nbsp;<span class="ident" id="5944833">err</span>&nbsp;<span class="op" id="5944837">=</span>&nbsp;<span class="ident" id="5944839">c</span><span class="op" id="5944840">.</span><span class="ident" id="5944841">cmd</span><span class="op" id="5944844">(</span><span class="num" id="5944845">0</span><span class="op" id="5944846">,</span>&nbsp;<span class="builtintype" id="5944848">string</span><span class="op" id="5944854">(</span><span class="ident" id="5944855">resp64</span><span class="op" id="5944861">)</span><span class="op" id="5944862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944865">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944868">return</span>&nbsp;<span class="ident" id="5944875">err</span><br>
<span class="lineno"></span><span class="op" id="5944879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5944882">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5944960">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="5945038">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5945052">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="5945132">func</span>&nbsp;<span class="op" id="5945137">(</span><span class="ident" id="5945138">c</span>&nbsp;<span class="op" id="5945140">*</span><span class="ident" id="5945141">Client</span><span class="op" id="5945147">)</span>&nbsp;<span class="ident" id="5945149">Mail</span><span class="op" id="5945153">(</span><span class="ident" id="5945154">from</span>&nbsp;<span class="builtintype" id="5945159">string</span><span class="op" id="5945165">)</span>&nbsp;<span class="builtintype" id="5945167">error</span>&nbsp;<span class="op" id="5945173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945176">if</span>&nbsp;<span class="ident" id="5945179">err</span>&nbsp;<span class="op" id="5945183">:=</span>&nbsp;<span class="ident" id="5945186">c</span><span class="op" id="5945187">.</span><span class="ident" id="5945188">hello</span><span class="op" id="5945193">(</span><span class="op" id="5945194">)</span><span class="op" id="5945195">;</span>&nbsp;<span class="ident" id="5945197">err</span>&nbsp;<span class="op" id="5945201">!=</span>&nbsp;<span class="ident" id="5945204">nil</span>&nbsp;<span class="op" id="5945208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945212">return</span>&nbsp;<span class="ident" id="5945219">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945227">cmdStr</span>&nbsp;<span class="op" id="5945234">:=</span>&nbsp;<span class="string" id="5945237">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945255">if</span>&nbsp;<span class="ident" id="5945258">c</span><span class="op" id="5945259">.</span><span class="ident" id="5945260">ext</span>&nbsp;<span class="op" id="5945264">!=</span>&nbsp;<span class="ident" id="5945267">nil</span>&nbsp;<span class="op" id="5945271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945275">if</span>&nbsp;<span class="ident" id="5945278">_</span><span class="op" id="5945279">,</span>&nbsp;<span class="ident" id="5945281">ok</span>&nbsp;<span class="op" id="5945284">:=</span>&nbsp;<span class="ident" id="5945287">c</span><span class="op" id="5945288">.</span><span class="ident" id="5945289">ext</span><span class="op" id="5945292">[</span><span class="string" id="5945293">&#34;8BITMIME&#34;</span><span class="op" id="5945303">]</span><span class="op" id="5945304">;</span>&nbsp;<span class="ident" id="5945306">ok</span>&nbsp;<span class="op" id="5945309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945314">cmdStr</span>&nbsp;<span class="op" id="5945321">+=</span>&nbsp;<span class="string" id="5945324">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945349">_</span><span class="op" id="5945350">,</span>&nbsp;<span class="ident" id="5945352">_</span><span class="op" id="5945353">,</span>&nbsp;<span class="ident" id="5945355">err</span>&nbsp;<span class="op" id="5945359">:=</span>&nbsp;<span class="ident" id="5945362">c</span><span class="op" id="5945363">.</span><span class="ident" id="5945364">cmd</span><span class="op" id="5945367">(</span><span class="num" id="5945368">250</span><span class="op" id="5945371">,</span>&nbsp;<span class="ident" id="5945373">cmdStr</span><span class="op" id="5945379">,</span>&nbsp;<span class="ident" id="5945381">from</span><span class="op" id="5945385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945388">return</span>&nbsp;<span class="ident" id="5945395">err</span><br>
<span class="lineno"></span><span class="op" id="5945399">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="5945402">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5945480">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5945556">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="5945593">func</span>&nbsp;<span class="op" id="5945598">(</span><span class="ident" id="5945599">c</span>&nbsp;<span class="op" id="5945601">*</span><span class="ident" id="5945602">Client</span><span class="op" id="5945608">)</span>&nbsp;<span class="ident" id="5945610">Rcpt</span><span class="op" id="5945614">(</span><span class="ident" id="5945615">to</span>&nbsp;<span class="builtintype" id="5945618">string</span><span class="op" id="5945624">)</span>&nbsp;<span class="builtintype" id="5945626">error</span>&nbsp;<span class="op" id="5945632">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945635">_</span><span class="op" id="5945636">,</span>&nbsp;<span class="ident" id="5945638">_</span><span class="op" id="5945639">,</span>&nbsp;<span class="ident" id="5945641">err</span>&nbsp;<span class="op" id="5945645">:=</span>&nbsp;<span class="ident" id="5945648">c</span><span class="op" id="5945649">.</span><span class="ident" id="5945650">cmd</span><span class="op" id="5945653">(</span><span class="num" id="5945654">25</span><span class="op" id="5945656">,</span>&nbsp;<span class="string" id="5945658">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="5945672">,</span>&nbsp;<span class="ident" id="5945674">to</span><span class="op" id="5945676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945679">return</span>&nbsp;<span class="ident" id="5945686">err</span><br>
<span class="lineno"></span><span class="op" id="5945690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5945693">type</span>&nbsp;<span class="ident" id="5945698">dataCloser</span>&nbsp;<span class="keyword" id="5945709">struct</span>&nbsp;<span class="op" id="5945716">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945719">c</span>&nbsp;<span class="op" id="5945721">*</span><span class="ident" id="5945722">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945730">io</span><span class="op" id="5945732">.</span><span class="ident" id="5945733">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="5945745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5945748">func</span>&nbsp;<span class="op" id="5945753">(</span><span class="ident" id="5945754">d</span>&nbsp;<span class="op" id="5945756">*</span><span class="ident" id="5945757">dataCloser</span><span class="op" id="5945767">)</span>&nbsp;<span class="ident" id="5945769">Close</span><span class="op" id="5945774">(</span><span class="op" id="5945775">)</span>&nbsp;<span class="builtintype" id="5945777">error</span>&nbsp;<span class="op" id="5945783">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945786">d</span><span class="op" id="5945787">.</span><span class="ident" id="5945788">WriteCloser</span><span class="op" id="5945799">.</span><span class="ident" id="5945800">Close</span><span class="op" id="5945805">(</span><span class="op" id="5945806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945809">_</span><span class="op" id="5945810">,</span>&nbsp;<span class="ident" id="5945812">_</span><span class="op" id="5945813">,</span>&nbsp;<span class="ident" id="5945815">err</span>&nbsp;<span class="op" id="5945819">:=</span>&nbsp;<span class="ident" id="5945822">d</span><span class="op" id="5945823">.</span><span class="ident" id="5945824">c</span><span class="op" id="5945825">.</span><span class="ident" id="5945826">Text</span><span class="op" id="5945830">.</span><span class="ident" id="5945831">ReadResponse</span><span class="op" id="5945843">(</span><span class="num" id="5945844">250</span><span class="op" id="5945847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945850">return</span>&nbsp;<span class="ident" id="5945857">err</span><br>
<span class="lineno"></span><span class="op" id="5945861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="5945864">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5945934">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="5946003">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5946044">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="5946109">func</span>&nbsp;<span class="op" id="5946114">(</span><span class="ident" id="5946115">c</span>&nbsp;<span class="op" id="5946117">*</span><span class="ident" id="5946118">Client</span><span class="op" id="5946124">)</span>&nbsp;<span class="ident" id="5946126">Data</span><span class="op" id="5946130">(</span><span class="op" id="5946131">)</span>&nbsp;<span class="op" id="5946133">(</span><span class="ident" id="5946134">io</span><span class="op" id="5946136">.</span><span class="ident" id="5946137">WriteCloser</span><span class="op" id="5946148">,</span>&nbsp;<span class="builtintype" id="5946150">error</span><span class="op" id="5946155">)</span>&nbsp;<span class="op" id="5946157">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946160">_</span><span class="op" id="5946161">,</span>&nbsp;<span class="ident" id="5946163">_</span><span class="op" id="5946164">,</span>&nbsp;<span class="ident" id="5946166">err</span>&nbsp;<span class="op" id="5946170">:=</span>&nbsp;<span class="ident" id="5946173">c</span><span class="op" id="5946174">.</span><span class="ident" id="5946175">cmd</span><span class="op" id="5946178">(</span><span class="num" id="5946179">354</span><span class="op" id="5946182">,</span>&nbsp;<span class="string" id="5946184">&#34;DATA&#34;</span><span class="op" id="5946190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946193">if</span>&nbsp;<span class="ident" id="5946196">err</span>&nbsp;<span class="op" id="5946200">!=</span>&nbsp;<span class="ident" id="5946203">nil</span>&nbsp;<span class="op" id="5946207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946211">return</span>&nbsp;<span class="ident" id="5946218">nil</span><span class="op" id="5946221">,</span>&nbsp;<span class="ident" id="5946223">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946231">return</span>&nbsp;<span class="op" id="5946238">&amp;</span><span class="ident" id="5946239">dataCloser</span><span class="op" id="5946249">{</span><span class="ident" id="5946250">c</span><span class="op" id="5946251">,</span>&nbsp;<span class="ident" id="5946253">c</span><span class="op" id="5946254">.</span><span class="ident" id="5946255">Text</span><span class="op" id="5946259">.</span><span class="ident" id="5946260">DotWriter</span><span class="op" id="5946269">(</span><span class="op" id="5946270">)</span><span class="op" id="5946271">}</span><span class="op" id="5946272">,</span>&nbsp;<span class="ident" id="5946274">nil</span><br>
<span class="lineno">265</span><span class="op" id="5946278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5946281">var</span>&nbsp;<span class="ident" id="5946285">testHookStartTLS</span>&nbsp;<span class="keyword" id="5946302">func</span><span class="op" id="5946306">(</span><span class="op" id="5946307">*</span><span class="ident" id="5946308">tls</span><span class="op" id="5946311">.</span><span class="ident" id="5946312">Config</span><span class="op" id="5946318">)</span>&nbsp;<span class="comment" id="5946320">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946346">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="5946409">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="5946479">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5946547">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="5946563">func</span>&nbsp;<span class="ident" id="5946568">SendMail</span><span class="op" id="5946576">(</span><span class="ident" id="5946577">addr</span>&nbsp;<span class="builtintype" id="5946582">string</span><span class="op" id="5946588">,</span>&nbsp;<span class="ident" id="5946590">a</span>&nbsp;<span class="ident" id="5946592">Auth</span><span class="op" id="5946596">,</span>&nbsp;<span class="ident" id="5946598">from</span>&nbsp;<span class="builtintype" id="5946603">string</span><span class="op" id="5946609">,</span>&nbsp;<span class="ident" id="5946611">to</span>&nbsp;<span class="op" id="5946614">[</span><span class="op" id="5946615">]</span><span class="builtintype" id="5946616">string</span><span class="op" id="5946622">,</span>&nbsp;<span class="ident" id="5946624">msg</span>&nbsp;<span class="op" id="5946628">[</span><span class="op" id="5946629">]</span><span class="builtintype" id="5946630">byte</span><span class="op" id="5946634">)</span>&nbsp;<span class="builtintype" id="5946636">error</span>&nbsp;<span class="op" id="5946642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946645">c</span><span class="op" id="5946646">,</span>&nbsp;<span class="ident" id="5946648">err</span>&nbsp;<span class="op" id="5946652">:=</span>&nbsp;<span class="ident" id="5946655">Dial</span><span class="op" id="5946659">(</span><span class="ident" id="5946660">addr</span><span class="op" id="5946664">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946667">if</span>&nbsp;<span class="ident" id="5946670">err</span>&nbsp;<span class="op" id="5946674">!=</span>&nbsp;<span class="ident" id="5946677">nil</span>&nbsp;<span class="op" id="5946681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946685">return</span>&nbsp;<span class="ident" id="5946692">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946700">defer</span>&nbsp;<span class="ident" id="5946706">c</span><span class="op" id="5946707">.</span><span class="ident" id="5946708">Close</span><span class="op" id="5946713">(</span><span class="op" id="5946714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946717">if</span>&nbsp;<span class="ident" id="5946720">err</span>&nbsp;<span class="op" id="5946724">=</span>&nbsp;<span class="ident" id="5946726">c</span><span class="op" id="5946727">.</span><span class="ident" id="5946728">hello</span><span class="op" id="5946733">(</span><span class="op" id="5946734">)</span><span class="op" id="5946735">;</span>&nbsp;<span class="ident" id="5946737">err</span>&nbsp;<span class="op" id="5946741">!=</span>&nbsp;<span class="ident" id="5946744">nil</span>&nbsp;<span class="op" id="5946748">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946752">return</span>&nbsp;<span class="ident" id="5946759">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946767">if</span>&nbsp;<span class="ident" id="5946770">ok</span><span class="op" id="5946772">,</span>&nbsp;<span class="ident" id="5946774">_</span>&nbsp;<span class="op" id="5946776">:=</span>&nbsp;<span class="ident" id="5946779">c</span><span class="op" id="5946780">.</span><span class="ident" id="5946781">Extension</span><span class="op" id="5946790">(</span><span class="string" id="5946791">&#34;STARTTLS&#34;</span><span class="op" id="5946801">)</span><span class="op" id="5946802">;</span>&nbsp;<span class="ident" id="5946804">ok</span>&nbsp;<span class="op" id="5946807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946811">config</span>&nbsp;<span class="op" id="5946818">:=</span>&nbsp;<span class="op" id="5946821">&amp;</span><span class="ident" id="5946822">tls</span><span class="op" id="5946825">.</span><span class="ident" id="5946826">Config</span><span class="op" id="5946832">{</span><span class="ident" id="5946833">ServerName</span><span class="op" id="5946843">:</span>&nbsp;<span class="ident" id="5946845">c</span><span class="op" id="5946846">.</span><span class="ident" id="5946847">serverName</span><span class="op" id="5946857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946861">if</span>&nbsp;<span class="ident" id="5946864">testHookStartTLS</span>&nbsp;<span class="op" id="5946881">!=</span>&nbsp;<span class="ident" id="5946884">nil</span>&nbsp;<span class="op" id="5946888">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946893">testHookStartTLS</span><span class="op" id="5946909">(</span><span class="ident" id="5946910">config</span><span class="op" id="5946916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946924">if</span>&nbsp;<span class="ident" id="5946927">err</span>&nbsp;<span class="op" id="5946931">=</span>&nbsp;<span class="ident" id="5946933">c</span><span class="op" id="5946934">.</span><span class="ident" id="5946935">StartTLS</span><span class="op" id="5946943">(</span><span class="ident" id="5946944">config</span><span class="op" id="5946950">)</span><span class="op" id="5946951">;</span>&nbsp;<span class="ident" id="5946953">err</span>&nbsp;<span class="op" id="5946957">!=</span>&nbsp;<span class="ident" id="5946960">nil</span>&nbsp;<span class="op" id="5946964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946969">return</span>&nbsp;<span class="ident" id="5946976">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946982">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946988">if</span>&nbsp;<span class="ident" id="5946991">a</span>&nbsp;<span class="op" id="5946993">!=</span>&nbsp;<span class="ident" id="5946996">nil</span>&nbsp;<span class="op" id="5947000">&amp;&amp;</span>&nbsp;<span class="ident" id="5947003">c</span><span class="op" id="5947004">.</span><span class="ident" id="5947005">ext</span>&nbsp;<span class="op" id="5947009">!=</span>&nbsp;<span class="ident" id="5947012">nil</span>&nbsp;<span class="op" id="5947016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947020">if</span>&nbsp;<span class="ident" id="5947023">_</span><span class="op" id="5947024">,</span>&nbsp;<span class="ident" id="5947026">ok</span>&nbsp;<span class="op" id="5947029">:=</span>&nbsp;<span class="ident" id="5947032">c</span><span class="op" id="5947033">.</span><span class="ident" id="5947034">ext</span><span class="op" id="5947037">[</span><span class="string" id="5947038">&#34;AUTH&#34;</span><span class="op" id="5947044">]</span><span class="op" id="5947045">;</span>&nbsp;<span class="ident" id="5947047">ok</span>&nbsp;<span class="op" id="5947050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947055">if</span>&nbsp;<span class="ident" id="5947058">err</span>&nbsp;<span class="op" id="5947062">=</span>&nbsp;<span class="ident" id="5947064">c</span><span class="op" id="5947065">.</span><span class="ident" id="5947066">Auth</span><span class="op" id="5947070">(</span><span class="ident" id="5947071">a</span><span class="op" id="5947072">)</span><span class="op" id="5947073">;</span>&nbsp;<span class="ident" id="5947075">err</span>&nbsp;<span class="op" id="5947079">!=</span>&nbsp;<span class="ident" id="5947082">nil</span>&nbsp;<span class="op" id="5947086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947092">return</span>&nbsp;<span class="ident" id="5947099">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947116">if</span>&nbsp;<span class="ident" id="5947119">err</span>&nbsp;<span class="op" id="5947123">=</span>&nbsp;<span class="ident" id="5947125">c</span><span class="op" id="5947126">.</span><span class="ident" id="5947127">Mail</span><span class="op" id="5947131">(</span><span class="ident" id="5947132">from</span><span class="op" id="5947136">)</span><span class="op" id="5947137">;</span>&nbsp;<span class="ident" id="5947139">err</span>&nbsp;<span class="op" id="5947143">!=</span>&nbsp;<span class="ident" id="5947146">nil</span>&nbsp;<span class="op" id="5947150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947154">return</span>&nbsp;<span class="ident" id="5947161">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947169">for</span>&nbsp;<span class="ident" id="5947173">_</span><span class="op" id="5947174">,</span>&nbsp;<span class="ident" id="5947176">addr</span>&nbsp;<span class="op" id="5947181">:=</span>&nbsp;<span class="keyword" id="5947184">range</span>&nbsp;<span class="ident" id="5947190">to</span>&nbsp;<span class="op" id="5947193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947197">if</span>&nbsp;<span class="ident" id="5947200">err</span>&nbsp;<span class="op" id="5947204">=</span>&nbsp;<span class="ident" id="5947206">c</span><span class="op" id="5947207">.</span><span class="ident" id="5947208">Rcpt</span><span class="op" id="5947212">(</span><span class="ident" id="5947213">addr</span><span class="op" id="5947217">)</span><span class="op" id="5947218">;</span>&nbsp;<span class="ident" id="5947220">err</span>&nbsp;<span class="op" id="5947224">!=</span>&nbsp;<span class="ident" id="5947227">nil</span>&nbsp;<span class="op" id="5947231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947236">return</span>&nbsp;<span class="ident" id="5947243">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947249">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947255">w</span><span class="op" id="5947256">,</span>&nbsp;<span class="ident" id="5947258">err</span>&nbsp;<span class="op" id="5947262">:=</span>&nbsp;<span class="ident" id="5947265">c</span><span class="op" id="5947266">.</span><span class="ident" id="5947267">Data</span><span class="op" id="5947271">(</span><span class="op" id="5947272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947275">if</span>&nbsp;<span class="ident" id="5947278">err</span>&nbsp;<span class="op" id="5947282">!=</span>&nbsp;<span class="ident" id="5947285">nil</span>&nbsp;<span class="op" id="5947289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947293">return</span>&nbsp;<span class="ident" id="5947300">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947305">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947308">_</span><span class="op" id="5947309">,</span>&nbsp;<span class="ident" id="5947311">err</span>&nbsp;<span class="op" id="5947315">=</span>&nbsp;<span class="ident" id="5947317">w</span><span class="op" id="5947318">.</span><span class="ident" id="5947319">Write</span><span class="op" id="5947324">(</span><span class="ident" id="5947325">msg</span><span class="op" id="5947328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947331">if</span>&nbsp;<span class="ident" id="5947334">err</span>&nbsp;<span class="op" id="5947338">!=</span>&nbsp;<span class="ident" id="5947341">nil</span>&nbsp;<span class="op" id="5947345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947349">return</span>&nbsp;<span class="ident" id="5947356">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947364">err</span>&nbsp;<span class="op" id="5947368">=</span>&nbsp;<span class="ident" id="5947370">w</span><span class="op" id="5947371">.</span><span class="ident" id="5947372">Close</span><span class="op" id="5947377">(</span><span class="op" id="5947378">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947381">if</span>&nbsp;<span class="ident" id="5947384">err</span>&nbsp;<span class="op" id="5947388">!=</span>&nbsp;<span class="ident" id="5947391">nil</span>&nbsp;<span class="op" id="5947395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947399">return</span>&nbsp;<span class="ident" id="5947406">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947414">return</span>&nbsp;<span class="ident" id="5947421">c</span><span class="op" id="5947422">.</span><span class="ident" id="5947423">Quit</span><span class="op" id="5947427">(</span><span class="op" id="5947428">)</span><br>
<span class="lineno"></span><span class="op" id="5947430">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="5947433">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5947501">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="5947575">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5947643">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="5947682">func</span>&nbsp;<span class="op" id="5947687">(</span><span class="ident" id="5947688">c</span>&nbsp;<span class="op" id="5947690">*</span><span class="ident" id="5947691">Client</span><span class="op" id="5947697">)</span>&nbsp;<span class="ident" id="5947699">Extension</span><span class="op" id="5947708">(</span><span class="ident" id="5947709">ext</span>&nbsp;<span class="builtintype" id="5947713">string</span><span class="op" id="5947719">)</span>&nbsp;<span class="op" id="5947721">(</span><span class="builtintype" id="5947722">bool</span><span class="op" id="5947726">,</span>&nbsp;<span class="builtintype" id="5947728">string</span><span class="op" id="5947734">)</span>&nbsp;<span class="op" id="5947736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947739">if</span>&nbsp;<span class="ident" id="5947742">err</span>&nbsp;<span class="op" id="5947746">:=</span>&nbsp;<span class="ident" id="5947749">c</span><span class="op" id="5947750">.</span><span class="ident" id="5947751">hello</span><span class="op" id="5947756">(</span><span class="op" id="5947757">)</span><span class="op" id="5947758">;</span>&nbsp;<span class="ident" id="5947760">err</span>&nbsp;<span class="op" id="5947764">!=</span>&nbsp;<span class="ident" id="5947767">nil</span>&nbsp;<span class="op" id="5947771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947775">return</span>&nbsp;<span class="builtintype" id="5947782">false</span><span class="op" id="5947787">,</span>&nbsp;<span class="string" id="5947789">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947796">if</span>&nbsp;<span class="ident" id="5947799">c</span><span class="op" id="5947800">.</span><span class="ident" id="5947801">ext</span>&nbsp;<span class="op" id="5947805">==</span>&nbsp;<span class="ident" id="5947808">nil</span>&nbsp;<span class="op" id="5947812">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947816">return</span>&nbsp;<span class="builtintype" id="5947823">false</span><span class="op" id="5947828">,</span>&nbsp;<span class="string" id="5947830">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5947834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947837">ext</span>&nbsp;<span class="op" id="5947841">=</span>&nbsp;<span class="ident" id="5947843">strings</span><span class="op" id="5947850">.</span><span class="ident" id="5947851">ToUpper</span><span class="op" id="5947858">(</span><span class="ident" id="5947859">ext</span><span class="op" id="5947862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5947865">param</span><span class="op" id="5947870">,</span>&nbsp;<span class="ident" id="5947872">ok</span>&nbsp;<span class="op" id="5947875">:=</span>&nbsp;<span class="ident" id="5947878">c</span><span class="op" id="5947879">.</span><span class="ident" id="5947880">ext</span><span class="op" id="5947883">[</span><span class="ident" id="5947884">ext</span><span class="op" id="5947887">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5947890">return</span>&nbsp;<span class="ident" id="5947897">ok</span><span class="op" id="5947899">,</span>&nbsp;<span class="ident" id="5947901">param</span><br>
<span class="lineno">335</span><span class="op" id="5947907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5947910">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="5947983">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="5947999">func</span>&nbsp;<span class="op" id="5948004">(</span><span class="ident" id="5948005">c</span>&nbsp;<span class="op" id="5948007">*</span><span class="ident" id="5948008">Client</span><span class="op" id="5948014">)</span>&nbsp;<span class="ident" id="5948016">Reset</span><span class="op" id="5948021">(</span><span class="op" id="5948022">)</span>&nbsp;<span class="builtintype" id="5948024">error</span>&nbsp;<span class="op" id="5948030">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948033">if</span>&nbsp;<span class="ident" id="5948036">err</span>&nbsp;<span class="op" id="5948040">:=</span>&nbsp;<span class="ident" id="5948043">c</span><span class="op" id="5948044">.</span><span class="ident" id="5948045">hello</span><span class="op" id="5948050">(</span><span class="op" id="5948051">)</span><span class="op" id="5948052">;</span>&nbsp;<span class="ident" id="5948054">err</span>&nbsp;<span class="op" id="5948058">!=</span>&nbsp;<span class="ident" id="5948061">nil</span>&nbsp;<span class="op" id="5948065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948069">return</span>&nbsp;<span class="ident" id="5948076">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948084">_</span><span class="op" id="5948085">,</span>&nbsp;<span class="ident" id="5948087">_</span><span class="op" id="5948088">,</span>&nbsp;<span class="ident" id="5948090">err</span>&nbsp;<span class="op" id="5948094">:=</span>&nbsp;<span class="ident" id="5948097">c</span><span class="op" id="5948098">.</span><span class="ident" id="5948099">cmd</span><span class="op" id="5948102">(</span><span class="num" id="5948103">250</span><span class="op" id="5948106">,</span>&nbsp;<span class="string" id="5948108">&#34;RSET&#34;</span><span class="op" id="5948114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948117">return</span>&nbsp;<span class="ident" id="5948124">err</span><br>
<span class="lineno">345</span><span class="op" id="5948128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5948131">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5948203">func</span>&nbsp;<span class="op" id="5948208">(</span><span class="ident" id="5948209">c</span>&nbsp;<span class="op" id="5948211">*</span><span class="ident" id="5948212">Client</span><span class="op" id="5948218">)</span>&nbsp;<span class="ident" id="5948220">Quit</span><span class="op" id="5948224">(</span><span class="op" id="5948225">)</span>&nbsp;<span class="builtintype" id="5948227">error</span>&nbsp;<span class="op" id="5948233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948236">if</span>&nbsp;<span class="ident" id="5948239">err</span>&nbsp;<span class="op" id="5948243">:=</span>&nbsp;<span class="ident" id="5948246">c</span><span class="op" id="5948247">.</span><span class="ident" id="5948248">hello</span><span class="op" id="5948253">(</span><span class="op" id="5948254">)</span><span class="op" id="5948255">;</span>&nbsp;<span class="ident" id="5948257">err</span>&nbsp;<span class="op" id="5948261">!=</span>&nbsp;<span class="ident" id="5948264">nil</span>&nbsp;<span class="op" id="5948268">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948272">return</span>&nbsp;<span class="ident" id="5948279">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5948287">_</span><span class="op" id="5948288">,</span>&nbsp;<span class="ident" id="5948290">_</span><span class="op" id="5948291">,</span>&nbsp;<span class="ident" id="5948293">err</span>&nbsp;<span class="op" id="5948297">:=</span>&nbsp;<span class="ident" id="5948300">c</span><span class="op" id="5948301">.</span><span class="ident" id="5948302">cmd</span><span class="op" id="5948305">(</span><span class="num" id="5948306">221</span><span class="op" id="5948309">,</span>&nbsp;<span class="string" id="5948311">&#34;QUIT&#34;</span><span class="op" id="5948317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948320">if</span>&nbsp;<span class="ident" id="5948323">err</span>&nbsp;<span class="op" id="5948327">!=</span>&nbsp;<span class="ident" id="5948330">nil</span>&nbsp;<span class="op" id="5948334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948338">return</span>&nbsp;<span class="ident" id="5948345">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5948350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5948353">return</span>&nbsp;<span class="ident" id="5948360">c</span><span class="op" id="5948361">.</span><span class="ident" id="5948362">Text</span><span class="op" id="5948366">.</span><span class="ident" id="5948367">Close</span><span class="op" id="5948372">(</span><span class="op" id="5948373">)</span><br>
<span class="lineno"></span><span class="op" id="5948375">}</span>
</div>
</body>
</html>
