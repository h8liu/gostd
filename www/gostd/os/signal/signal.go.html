<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/signal</h2>
<ul>
<li><a href="/gostd/os/signal/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/signal/signal.go.html">signal.go</a></li>
<li><a href="/gostd/os/signal/signal_test.go.html">signal_test.go</a></li>
<li><a href="/gostd/os/signal/signal_unix.go.html">signal_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5864967">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5865022">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5865076">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5865127">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5865184">package</span>&nbsp;<span class="ident" id="5865192">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5865200">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5865261">import</span>&nbsp;<span class="op" id="5865268">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5865271">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5865277">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5865284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5865287">var</span>&nbsp;<span class="ident" id="5865291">handlers</span>&nbsp;<span class="keyword" id="5865300">struct</span>&nbsp;<span class="op" id="5865307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865310">sync</span><span class="op" id="5865314">.</span><span class="ident" id="5865315">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865322">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865326">map</span><span class="op" id="5865329">[</span><span class="keyword" id="5865330">chan</span><span class="op" id="5865334">&lt;-</span>&nbsp;<span class="ident" id="5865337">os</span><span class="op" id="5865339">.</span><span class="ident" id="5865340">Signal</span><span class="op" id="5865346">]</span><span class="op" id="5865347">*</span><span class="ident" id="5865348">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865357">ref</span>&nbsp;<span class="op" id="5865361">[</span><span class="ident" id="5865362">numSig</span><span class="op" id="5865368">]</span><span class="ident" id="5865369">int64</span><br>
<span class="lineno"></span><span class="op" id="5865375">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5865378">type</span>&nbsp;<span class="ident" id="5865383">handler</span>&nbsp;<span class="keyword" id="5865391">struct</span>&nbsp;<span class="op" id="5865398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865401">mask</span>&nbsp;<span class="op" id="5865406">[</span><span class="op" id="5865407">(</span><span class="ident" id="5865408">numSig</span>&nbsp;<span class="op" id="5865415">+</span>&nbsp;<span class="num" id="5865417">31</span><span class="op" id="5865419">)</span>&nbsp;<span class="op" id="5865421">/</span>&nbsp;<span class="num" id="5865423">32</span><span class="op" id="5865425">]</span><span class="builtintype" id="5865426">uint32</span><br>
<span class="lineno"></span><span class="op" id="5865433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5865436">func</span>&nbsp;<span class="op" id="5865441">(</span><span class="ident" id="5865442">h</span>&nbsp;<span class="op" id="5865444">*</span><span class="ident" id="5865445">handler</span><span class="op" id="5865452">)</span>&nbsp;<span class="ident" id="5865454">want</span><span class="op" id="5865458">(</span><span class="ident" id="5865459">sig</span>&nbsp;<span class="builtintype" id="5865463">int</span><span class="op" id="5865466">)</span>&nbsp;<span class="builtintype" id="5865468">bool</span>&nbsp;<span class="op" id="5865473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865476">return</span>&nbsp;<span class="op" id="5865483">(</span><span class="ident" id="5865484">h</span><span class="op" id="5865485">.</span><span class="ident" id="5865486">mask</span><span class="op" id="5865490">[</span><span class="ident" id="5865491">sig</span><span class="op" id="5865494">/</span><span class="num" id="5865495">32</span><span class="op" id="5865497">]</span><span class="op" id="5865498">&gt;&gt;</span><span class="builtintype" id="5865500">uint</span><span class="op" id="5865504">(</span><span class="ident" id="5865505">sig</span><span class="op" id="5865508">&amp;</span><span class="num" id="5865509">31</span><span class="op" id="5865511">)</span><span class="op" id="5865512">)</span><span class="op" id="5865513">&amp;</span><span class="num" id="5865514">1</span>&nbsp;<span class="op" id="5865516">!=</span>&nbsp;<span class="num" id="5865519">0</span><br>
<span class="lineno"></span><span class="op" id="5865521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5865524">func</span>&nbsp;<span class="op" id="5865529">(</span><span class="ident" id="5865530">h</span>&nbsp;<span class="op" id="5865532">*</span><span class="ident" id="5865533">handler</span><span class="op" id="5865540">)</span>&nbsp;<span class="ident" id="5865542">set</span><span class="op" id="5865545">(</span><span class="ident" id="5865546">sig</span>&nbsp;<span class="builtintype" id="5865550">int</span><span class="op" id="5865553">)</span>&nbsp;<span class="op" id="5865555">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865558">h</span><span class="op" id="5865559">.</span><span class="ident" id="5865560">mask</span><span class="op" id="5865564">[</span><span class="ident" id="5865565">sig</span><span class="op" id="5865568">/</span><span class="num" id="5865569">32</span><span class="op" id="5865571">]</span>&nbsp;<span class="op" id="5865573">|=</span>&nbsp;<span class="num" id="5865576">1</span>&nbsp;<span class="op" id="5865578">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5865581">uint</span><span class="op" id="5865585">(</span><span class="ident" id="5865586">sig</span><span class="op" id="5865589">&amp;</span><span class="num" id="5865590">31</span><span class="op" id="5865592">)</span><br>
<span class="lineno"></span><span class="op" id="5865594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5865597">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5865661">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="5865733">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="5865777">//</span><br>
<span class="lineno"></span><span class="comment" id="5865780">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5865850">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="5865917">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="5865996">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="5866033">//</span><br>
<span class="lineno"></span><span class="comment" id="5866036">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="5866106">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5866168">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="5866232">//</span><br>
<span class="lineno"></span><span class="comment" id="5866235">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="5866306">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5866372">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="5866398">func</span>&nbsp;<span class="ident" id="5866403">Notify</span><span class="op" id="5866409">(</span><span class="ident" id="5866410">c</span>&nbsp;<span class="keyword" id="5866412">chan</span><span class="op" id="5866416">&lt;-</span>&nbsp;<span class="ident" id="5866419">os</span><span class="op" id="5866421">.</span><span class="ident" id="5866422">Signal</span><span class="op" id="5866428">,</span>&nbsp;<span class="ident" id="5866430">sig</span>&nbsp;<span class="op" id="5866434">...</span><span class="ident" id="5866437">os</span><span class="op" id="5866439">.</span><span class="ident" id="5866440">Signal</span><span class="op" id="5866446">)</span>&nbsp;<span class="op" id="5866448">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866451">if</span>&nbsp;<span class="ident" id="5866454">c</span>&nbsp;<span class="op" id="5866456">==</span>&nbsp;<span class="ident" id="5866459">nil</span>&nbsp;<span class="op" id="5866463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5866467">panic</span><span class="op" id="5866472">(</span><span class="string" id="5866473">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="5866510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866517">handlers</span><span class="op" id="5866525">.</span><span class="ident" id="5866526">Lock</span><span class="op" id="5866530">(</span><span class="op" id="5866531">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866534">defer</span>&nbsp;<span class="ident" id="5866540">handlers</span><span class="op" id="5866548">.</span><span class="ident" id="5866549">Unlock</span><span class="op" id="5866555">(</span><span class="op" id="5866556">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866560">h</span>&nbsp;<span class="op" id="5866562">:=</span>&nbsp;<span class="ident" id="5866565">handlers</span><span class="op" id="5866573">.</span><span class="ident" id="5866574">m</span><span class="op" id="5866575">[</span><span class="ident" id="5866576">c</span><span class="op" id="5866577">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866580">if</span>&nbsp;<span class="ident" id="5866583">h</span>&nbsp;<span class="op" id="5866585">==</span>&nbsp;<span class="ident" id="5866588">nil</span>&nbsp;<span class="op" id="5866592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866596">if</span>&nbsp;<span class="ident" id="5866599">handlers</span><span class="op" id="5866607">.</span><span class="ident" id="5866608">m</span>&nbsp;<span class="op" id="5866610">==</span>&nbsp;<span class="ident" id="5866613">nil</span>&nbsp;<span class="op" id="5866617">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866622">handlers</span><span class="op" id="5866630">.</span><span class="ident" id="5866631">m</span>&nbsp;<span class="op" id="5866633">=</span>&nbsp;<span class="builtinfunc" id="5866635">make</span><span class="op" id="5866639">(</span><span class="keyword" id="5866640">map</span><span class="op" id="5866643">[</span><span class="keyword" id="5866644">chan</span><span class="op" id="5866648">&lt;-</span>&nbsp;<span class="ident" id="5866651">os</span><span class="op" id="5866653">.</span><span class="ident" id="5866654">Signal</span><span class="op" id="5866660">]</span><span class="op" id="5866661">*</span><span class="ident" id="5866662">handler</span><span class="op" id="5866669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866677">h</span>&nbsp;<span class="op" id="5866679">=</span>&nbsp;<span class="builtinfunc" id="5866681">new</span><span class="op" id="5866684">(</span><span class="ident" id="5866685">handler</span><span class="op" id="5866692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866696">handlers</span><span class="op" id="5866704">.</span><span class="ident" id="5866705">m</span><span class="op" id="5866706">[</span><span class="ident" id="5866707">c</span><span class="op" id="5866708">]</span>&nbsp;<span class="op" id="5866710">=</span>&nbsp;<span class="ident" id="5866712">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866715">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866719">add</span>&nbsp;<span class="op" id="5866723">:=</span>&nbsp;<span class="keyword" id="5866726">func</span><span class="op" id="5866730">(</span><span class="ident" id="5866731">n</span>&nbsp;<span class="builtintype" id="5866733">int</span><span class="op" id="5866736">)</span>&nbsp;<span class="op" id="5866738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866742">if</span>&nbsp;<span class="ident" id="5866745">n</span>&nbsp;<span class="op" id="5866747">&lt;</span>&nbsp;<span class="num" id="5866749">0</span>&nbsp;<span class="op" id="5866751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866756">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866765">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866769">if</span>&nbsp;<span class="op" id="5866772">!</span><span class="ident" id="5866773">h</span><span class="op" id="5866774">.</span><span class="ident" id="5866775">want</span><span class="op" id="5866779">(</span><span class="ident" id="5866780">n</span><span class="op" id="5866781">)</span>&nbsp;<span class="op" id="5866783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866788">h</span><span class="op" id="5866789">.</span><span class="ident" id="5866790">set</span><span class="op" id="5866793">(</span><span class="ident" id="5866794">n</span><span class="op" id="5866795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866800">if</span>&nbsp;<span class="ident" id="5866803">handlers</span><span class="op" id="5866811">.</span><span class="ident" id="5866812">ref</span><span class="op" id="5866815">[</span><span class="ident" id="5866816">n</span><span class="op" id="5866817">]</span>&nbsp;<span class="op" id="5866819">==</span>&nbsp;<span class="num" id="5866822">0</span>&nbsp;<span class="op" id="5866824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866830">enableSignal</span><span class="op" id="5866842">(</span><span class="ident" id="5866843">n</span><span class="op" id="5866844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866849">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866854">handlers</span><span class="op" id="5866862">.</span><span class="ident" id="5866863">ref</span><span class="op" id="5866866">[</span><span class="ident" id="5866867">n</span><span class="op" id="5866868">]</span><span class="op" id="5866869">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866881">if</span>&nbsp;<span class="builtinfunc" id="5866884">len</span><span class="op" id="5866887">(</span><span class="ident" id="5866888">sig</span><span class="op" id="5866891">)</span>&nbsp;<span class="op" id="5866893">==</span>&nbsp;<span class="num" id="5866896">0</span>&nbsp;<span class="op" id="5866898">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866902">for</span>&nbsp;<span class="ident" id="5866906">n</span>&nbsp;<span class="op" id="5866908">:=</span>&nbsp;<span class="num" id="5866911">0</span><span class="op" id="5866912">;</span>&nbsp;<span class="ident" id="5866914">n</span>&nbsp;<span class="op" id="5866916">&lt;</span>&nbsp;<span class="ident" id="5866918">numSig</span><span class="op" id="5866924">;</span>&nbsp;<span class="ident" id="5866926">n</span><span class="op" id="5866927">++</span>&nbsp;<span class="op" id="5866930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866935">add</span><span class="op" id="5866938">(</span><span class="ident" id="5866939">n</span><span class="op" id="5866940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866947">}</span>&nbsp;<span class="keyword" id="5866949">else</span>&nbsp;<span class="op" id="5866954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866958">for</span>&nbsp;<span class="ident" id="5866962">_</span><span class="op" id="5866963">,</span>&nbsp;<span class="ident" id="5866965">s</span>&nbsp;<span class="op" id="5866967">:=</span>&nbsp;<span class="keyword" id="5866970">range</span>&nbsp;<span class="ident" id="5866976">sig</span>&nbsp;<span class="op" id="5866980">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866985">add</span><span class="op" id="5866988">(</span><span class="ident" id="5866989">signum</span><span class="op" id="5866995">(</span><span class="ident" id="5866996">s</span><span class="op" id="5866997">)</span><span class="op" id="5866998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867005">}</span><br>
<span class="lineno"></span><span class="op" id="5867007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5867010">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5867080">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5867142">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5867218">func</span>&nbsp;<span class="ident" id="5867223">Stop</span><span class="op" id="5867227">(</span><span class="ident" id="5867228">c</span>&nbsp;<span class="keyword" id="5867230">chan</span><span class="op" id="5867234">&lt;-</span>&nbsp;<span class="ident" id="5867237">os</span><span class="op" id="5867239">.</span><span class="ident" id="5867240">Signal</span><span class="op" id="5867246">)</span>&nbsp;<span class="op" id="5867248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5867251">handlers</span><span class="op" id="5867259">.</span><span class="ident" id="5867260">Lock</span><span class="op" id="5867264">(</span><span class="op" id="5867265">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867268">defer</span>&nbsp;<span class="ident" id="5867274">handlers</span><span class="op" id="5867282">.</span><span class="ident" id="5867283">Unlock</span><span class="op" id="5867289">(</span><span class="op" id="5867290">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5867294">h</span>&nbsp;<span class="op" id="5867296">:=</span>&nbsp;<span class="ident" id="5867299">handlers</span><span class="op" id="5867307">.</span><span class="ident" id="5867308">m</span><span class="op" id="5867309">[</span><span class="ident" id="5867310">c</span><span class="op" id="5867311">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867314">if</span>&nbsp;<span class="ident" id="5867317">h</span>&nbsp;<span class="op" id="5867319">==</span>&nbsp;<span class="ident" id="5867322">nil</span>&nbsp;<span class="op" id="5867326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867330">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5867341">delete</span><span class="op" id="5867347">(</span><span class="ident" id="5867348">handlers</span><span class="op" id="5867356">.</span><span class="ident" id="5867357">m</span><span class="op" id="5867358">,</span>&nbsp;<span class="ident" id="5867360">c</span><span class="op" id="5867361">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867365">for</span>&nbsp;<span class="ident" id="5867369">n</span>&nbsp;<span class="op" id="5867371">:=</span>&nbsp;<span class="num" id="5867374">0</span><span class="op" id="5867375">;</span>&nbsp;<span class="ident" id="5867377">n</span>&nbsp;<span class="op" id="5867379">&lt;</span>&nbsp;<span class="ident" id="5867381">numSig</span><span class="op" id="5867387">;</span>&nbsp;<span class="ident" id="5867389">n</span><span class="op" id="5867390">++</span>&nbsp;<span class="op" id="5867393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867397">if</span>&nbsp;<span class="ident" id="5867400">h</span><span class="op" id="5867401">.</span><span class="ident" id="5867402">want</span><span class="op" id="5867406">(</span><span class="ident" id="5867407">n</span><span class="op" id="5867408">)</span>&nbsp;<span class="op" id="5867410">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5867415">handlers</span><span class="op" id="5867423">.</span><span class="ident" id="5867424">ref</span><span class="op" id="5867427">[</span><span class="ident" id="5867428">n</span><span class="op" id="5867429">]</span><span class="op" id="5867430">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867436">if</span>&nbsp;<span class="ident" id="5867439">handlers</span><span class="op" id="5867447">.</span><span class="ident" id="5867448">ref</span><span class="op" id="5867451">[</span><span class="ident" id="5867452">n</span><span class="op" id="5867453">]</span>&nbsp;<span class="op" id="5867455">==</span>&nbsp;<span class="num" id="5867458">0</span>&nbsp;<span class="op" id="5867460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5867466">disableSignal</span><span class="op" id="5867479">(</span><span class="ident" id="5867480">n</span><span class="op" id="5867481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867490">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867493">}</span><br>
<span class="lineno"></span><span class="op" id="5867495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5867498">func</span>&nbsp;<span class="ident" id="5867503">process</span><span class="op" id="5867510">(</span><span class="ident" id="5867511">sig</span>&nbsp;<span class="ident" id="5867515">os</span><span class="op" id="5867517">.</span><span class="ident" id="5867518">Signal</span><span class="op" id="5867524">)</span>&nbsp;<span class="op" id="5867526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5867529">n</span>&nbsp;<span class="op" id="5867531">:=</span>&nbsp;<span class="ident" id="5867534">signum</span><span class="op" id="5867540">(</span><span class="ident" id="5867541">sig</span><span class="op" id="5867544">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867547">if</span>&nbsp;<span class="ident" id="5867550">n</span>&nbsp;<span class="op" id="5867552">&lt;</span>&nbsp;<span class="num" id="5867554">0</span>&nbsp;<span class="op" id="5867556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867560">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5867572">handlers</span><span class="op" id="5867580">.</span><span class="ident" id="5867581">Lock</span><span class="op" id="5867585">(</span><span class="op" id="5867586">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867589">defer</span>&nbsp;<span class="ident" id="5867595">handlers</span><span class="op" id="5867603">.</span><span class="ident" id="5867604">Unlock</span><span class="op" id="5867610">(</span><span class="op" id="5867611">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867615">for</span>&nbsp;<span class="ident" id="5867619">c</span><span class="op" id="5867620">,</span>&nbsp;<span class="ident" id="5867622">h</span>&nbsp;<span class="op" id="5867624">:=</span>&nbsp;<span class="keyword" id="5867627">range</span>&nbsp;<span class="ident" id="5867633">handlers</span><span class="op" id="5867641">.</span><span class="ident" id="5867642">m</span>&nbsp;<span class="op" id="5867644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867648">if</span>&nbsp;<span class="ident" id="5867651">h</span><span class="op" id="5867652">.</span><span class="ident" id="5867653">want</span><span class="op" id="5867657">(</span><span class="ident" id="5867658">n</span><span class="op" id="5867659">)</span>&nbsp;<span class="op" id="5867661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5867666">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867701">select</span>&nbsp;<span class="op" id="5867708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867713">case</span>&nbsp;<span class="ident" id="5867718">c</span>&nbsp;<span class="op" id="5867720">&lt;-</span>&nbsp;<span class="ident" id="5867723">sig</span><span class="op" id="5867726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867731">default</span><span class="op" id="5867738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867747">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867750">}</span><br>
<span class="lineno"></span><span class="op" id="5867752">}</span>
</div>
</body>
</html>
