<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6052542">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6052597">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6052651">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6052702">package</span>&nbsp;<span class="ident" id="6052710">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6052715">import</span>&nbsp;<span class="op" id="6052722">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6052725">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6052734">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6052753">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6052763">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6052771">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6052785">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6052790">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6052793">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="6052833">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6052881">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="6052921">type</span>&nbsp;<span class="ident" id="6052926">Writer</span>&nbsp;<span class="keyword" id="6052933">struct</span>&nbsp;<span class="op" id="6052940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052943">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6052950">*</span><span class="ident" id="6052951">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052964">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6052971">[</span><span class="op" id="6052972">]</span><span class="op" id="6052973">*</span><span class="ident" id="6052974">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052982">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6052989">*</span><span class="ident" id="6052990">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053002">closed</span>&nbsp;<span class="builtintype" id="6053009">bool</span><br>
<span class="lineno">25</span><span class="op" id="6053014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6053017">type</span>&nbsp;<span class="ident" id="6053022">header</span>&nbsp;<span class="keyword" id="6053029">struct</span>&nbsp;<span class="op" id="6053036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053039">*</span><span class="ident" id="6053040">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053052">offset</span>&nbsp;<span class="ident" id="6053059">uint64</span><br>
<span class="lineno">30</span><span class="op" id="6053066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6053069">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6053128">func</span>&nbsp;<span class="ident" id="6053133">NewWriter</span><span class="op" id="6053142">(</span><span class="ident" id="6053143">w</span>&nbsp;<span class="ident" id="6053145">io</span><span class="op" id="6053147">.</span><span class="ident" id="6053148">Writer</span><span class="op" id="6053154">)</span>&nbsp;<span class="op" id="6053156">*</span><span class="ident" id="6053157">Writer</span>&nbsp;<span class="op" id="6053164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053167">return</span>&nbsp;<span class="op" id="6053174">&amp;</span><span class="ident" id="6053175">Writer</span><span class="op" id="6053181">{</span><span class="ident" id="6053182">cw</span><span class="op" id="6053184">:</span>&nbsp;<span class="op" id="6053186">&amp;</span><span class="ident" id="6053187">countWriter</span><span class="op" id="6053198">{</span><span class="ident" id="6053199">w</span><span class="op" id="6053200">:</span>&nbsp;<span class="ident" id="6053202">bufio</span><span class="op" id="6053207">.</span><span class="ident" id="6053208">NewWriter</span><span class="op" id="6053217">(</span><span class="ident" id="6053218">w</span><span class="op" id="6053219">)</span><span class="op" id="6053220">}</span><span class="op" id="6053221">}</span><br>
<span class="lineno">35</span><span class="op" id="6053223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6053226">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="6053287">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="6053360">func</span>&nbsp;<span class="op" id="6053365">(</span><span class="ident" id="6053366">w</span>&nbsp;<span class="op" id="6053368">*</span><span class="ident" id="6053369">Writer</span><span class="op" id="6053375">)</span>&nbsp;<span class="ident" id="6053377">Flush</span><span class="op" id="6053382">(</span><span class="op" id="6053383">)</span>&nbsp;<span class="builtintype" id="6053385">error</span>&nbsp;<span class="op" id="6053391">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053394">return</span>&nbsp;<span class="ident" id="6053401">w</span><span class="op" id="6053402">.</span><span class="ident" id="6053403">cw</span><span class="op" id="6053405">.</span><span class="ident" id="6053406">w</span><span class="op" id="6053407">.</span><span class="op" id="6053408">(</span><span class="op" id="6053409">*</span><span class="ident" id="6053410">bufio</span><span class="op" id="6053415">.</span><span class="ident" id="6053416">Writer</span><span class="op" id="6053422">)</span><span class="op" id="6053423">.</span><span class="ident" id="6053424">Flush</span><span class="op" id="6053429">(</span><span class="op" id="6053430">)</span><br>
<span class="lineno"></span><span class="op" id="6053432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6053435">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="6053508">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="6053566">func</span>&nbsp;<span class="op" id="6053571">(</span><span class="ident" id="6053572">w</span>&nbsp;<span class="op" id="6053574">*</span><span class="ident" id="6053575">Writer</span><span class="op" id="6053581">)</span>&nbsp;<span class="ident" id="6053583">Close</span><span class="op" id="6053588">(</span><span class="op" id="6053589">)</span>&nbsp;<span class="builtintype" id="6053591">error</span>&nbsp;<span class="op" id="6053597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053600">if</span>&nbsp;<span class="ident" id="6053603">w</span><span class="op" id="6053604">.</span><span class="ident" id="6053605">last</span>&nbsp;<span class="op" id="6053610">!=</span>&nbsp;<span class="builtintype" id="6053613">nil</span>&nbsp;<span class="op" id="6053617">&amp;&amp;</span>&nbsp;<span class="op" id="6053620">!</span><span class="ident" id="6053621">w</span><span class="op" id="6053622">.</span><span class="ident" id="6053623">last</span><span class="op" id="6053627">.</span><span class="ident" id="6053628">closed</span>&nbsp;<span class="op" id="6053635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053639">if</span>&nbsp;<span class="ident" id="6053642">err</span>&nbsp;<span class="op" id="6053646">:=</span>&nbsp;<span class="ident" id="6053649">w</span><span class="op" id="6053650">.</span><span class="ident" id="6053651">last</span><span class="op" id="6053655">.</span><span class="builtinfunc" id="6053656">close</span><span class="op" id="6053661">(</span><span class="op" id="6053662">)</span><span class="op" id="6053663">;</span>&nbsp;<span class="ident" id="6053665">err</span>&nbsp;<span class="op" id="6053669">!=</span>&nbsp;<span class="builtintype" id="6053672">nil</span>&nbsp;<span class="op" id="6053676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053681">return</span>&nbsp;<span class="ident" id="6053688">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053694">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053698">w</span><span class="op" id="6053699">.</span><span class="ident" id="6053700">last</span>&nbsp;<span class="op" id="6053705">=</span>&nbsp;<span class="builtintype" id="6053707">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053715">if</span>&nbsp;<span class="ident" id="6053718">w</span><span class="op" id="6053719">.</span><span class="ident" id="6053720">closed</span>&nbsp;<span class="op" id="6053727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053731">return</span>&nbsp;<span class="ident" id="6053738">errors</span><span class="op" id="6053744">.</span><span class="ident" id="6053745">New</span><span class="op" id="6053748">(</span><span class="string" id="6053749">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6053775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053778">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053781">w</span><span class="op" id="6053782">.</span><span class="ident" id="6053783">closed</span>&nbsp;<span class="op" id="6053790">=</span>&nbsp;<span class="builtintype" id="6053792">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6053799">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053827">start</span>&nbsp;<span class="op" id="6053833">:=</span>&nbsp;<span class="ident" id="6053836">w</span><span class="op" id="6053837">.</span><span class="ident" id="6053838">cw</span><span class="op" id="6053840">.</span><span class="ident" id="6053841">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053848">for</span>&nbsp;<span class="ident" id="6053852">_</span><span class="op" id="6053853">,</span>&nbsp;<span class="ident" id="6053855">h</span>&nbsp;<span class="op" id="6053857">:=</span>&nbsp;<span class="keyword" id="6053860">range</span>&nbsp;<span class="ident" id="6053866">w</span><span class="op" id="6053867">.</span><span class="ident" id="6053868">dir</span>&nbsp;<span class="op" id="6053872">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053876">var</span>&nbsp;<span class="ident" id="6053880">buf</span>&nbsp;<span class="op" id="6053884">[</span><span class="ident" id="6053885">directoryHeaderLen</span><span class="op" id="6053903">]</span><span class="builtintype" id="6053904">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053911">b</span>&nbsp;<span class="op" id="6053913">:=</span>&nbsp;<span class="ident" id="6053916">writeBuf</span><span class="op" id="6053924">(</span><span class="ident" id="6053925">buf</span><span class="op" id="6053928">[</span><span class="op" id="6053929">:</span><span class="op" id="6053930">]</span><span class="op" id="6053931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053935">b</span><span class="op" id="6053936">.</span><span class="builtintype" id="6053937">uint32</span><span class="op" id="6053943">(</span><span class="builtintype" id="6053944">uint32</span><span class="op" id="6053950">(</span><span class="ident" id="6053951">directoryHeaderSignature</span><span class="op" id="6053975">)</span><span class="op" id="6053976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053980">b</span><span class="op" id="6053981">.</span><span class="builtintype" id="6053982">uint16</span><span class="op" id="6053988">(</span><span class="ident" id="6053989">h</span><span class="op" id="6053990">.</span><span class="ident" id="6053991">CreatorVersion</span><span class="op" id="6054005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054009">b</span><span class="op" id="6054010">.</span><span class="builtintype" id="6054011">uint16</span><span class="op" id="6054017">(</span><span class="ident" id="6054018">h</span><span class="op" id="6054019">.</span><span class="ident" id="6054020">ReaderVersion</span><span class="op" id="6054033">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054037">b</span><span class="op" id="6054038">.</span><span class="builtintype" id="6054039">uint16</span><span class="op" id="6054045">(</span><span class="ident" id="6054046">h</span><span class="op" id="6054047">.</span><span class="ident" id="6054048">Flags</span><span class="op" id="6054053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054057">b</span><span class="op" id="6054058">.</span><span class="builtintype" id="6054059">uint16</span><span class="op" id="6054065">(</span><span class="ident" id="6054066">h</span><span class="op" id="6054067">.</span><span class="ident" id="6054068">Method</span><span class="op" id="6054074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054078">b</span><span class="op" id="6054079">.</span><span class="builtintype" id="6054080">uint16</span><span class="op" id="6054086">(</span><span class="ident" id="6054087">h</span><span class="op" id="6054088">.</span><span class="ident" id="6054089">ModifiedTime</span><span class="op" id="6054101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054105">b</span><span class="op" id="6054106">.</span><span class="builtintype" id="6054107">uint16</span><span class="op" id="6054113">(</span><span class="ident" id="6054114">h</span><span class="op" id="6054115">.</span><span class="ident" id="6054116">ModifiedDate</span><span class="op" id="6054128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054132">b</span><span class="op" id="6054133">.</span><span class="builtintype" id="6054134">uint32</span><span class="op" id="6054140">(</span><span class="ident" id="6054141">h</span><span class="op" id="6054142">.</span><span class="ident" id="6054143">CRC32</span><span class="op" id="6054148">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054152">if</span>&nbsp;<span class="ident" id="6054155">h</span><span class="op" id="6054156">.</span><span class="ident" id="6054157">isZip64</span><span class="op" id="6054164">(</span><span class="op" id="6054165">)</span>&nbsp;<span class="op" id="6054167">||</span>&nbsp;<span class="ident" id="6054170">h</span><span class="op" id="6054171">.</span><span class="ident" id="6054172">offset</span>&nbsp;<span class="op" id="6054179">&gt;</span>&nbsp;<span class="ident" id="6054181">uint32max</span>&nbsp;<span class="op" id="6054191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054196">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054254">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054317">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054358">b</span><span class="op" id="6054359">.</span><span class="builtintype" id="6054360">uint32</span><span class="op" id="6054366">(</span><span class="ident" id="6054367">uint32max</span><span class="op" id="6054376">)</span>&nbsp;<span class="comment" id="6054378">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054400">b</span><span class="op" id="6054401">.</span><span class="builtintype" id="6054402">uint32</span><span class="op" id="6054408">(</span><span class="ident" id="6054409">uint32max</span><span class="op" id="6054418">)</span>&nbsp;<span class="comment" id="6054420">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054445">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054487">var</span>&nbsp;<span class="ident" id="6054491">buf</span>&nbsp;<span class="op" id="6054495">[</span><span class="num" id="6054496">28</span><span class="op" id="6054498">]</span><span class="builtintype" id="6054499">byte</span>&nbsp;<span class="comment" id="6054504">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054532">eb</span>&nbsp;<span class="op" id="6054535">:=</span>&nbsp;<span class="ident" id="6054538">writeBuf</span><span class="op" id="6054546">(</span><span class="ident" id="6054547">buf</span><span class="op" id="6054550">[</span><span class="op" id="6054551">:</span><span class="op" id="6054552">]</span><span class="op" id="6054553">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054558">eb</span><span class="op" id="6054560">.</span><span class="builtintype" id="6054561">uint16</span><span class="op" id="6054567">(</span><span class="ident" id="6054568">zip64ExtraId</span><span class="op" id="6054580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054585">eb</span><span class="op" id="6054587">.</span><span class="builtintype" id="6054588">uint16</span><span class="op" id="6054594">(</span><span class="num" id="6054595">24</span><span class="op" id="6054597">)</span>&nbsp;<span class="comment" id="6054599">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054622">eb</span><span class="op" id="6054624">.</span><span class="ident" id="6054625">uint64</span><span class="op" id="6054631">(</span><span class="ident" id="6054632">h</span><span class="op" id="6054633">.</span><span class="ident" id="6054634">UncompressedSize64</span><span class="op" id="6054652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054657">eb</span><span class="op" id="6054659">.</span><span class="ident" id="6054660">uint64</span><span class="op" id="6054666">(</span><span class="ident" id="6054667">h</span><span class="op" id="6054668">.</span><span class="ident" id="6054669">CompressedSize64</span><span class="op" id="6054685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054690">eb</span><span class="op" id="6054692">.</span><span class="ident" id="6054693">uint64</span><span class="op" id="6054699">(</span><span class="ident" id="6054700">h</span><span class="op" id="6054701">.</span><span class="ident" id="6054702">offset</span><span class="op" id="6054708">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054713">h</span><span class="op" id="6054714">.</span><span class="ident" id="6054715">Extra</span>&nbsp;<span class="op" id="6054721">=</span>&nbsp;<span class="builtinfunc" id="6054723">append</span><span class="op" id="6054729">(</span><span class="ident" id="6054730">h</span><span class="op" id="6054731">.</span><span class="ident" id="6054732">Extra</span><span class="op" id="6054737">,</span>&nbsp;<span class="ident" id="6054739">buf</span><span class="op" id="6054742">[</span><span class="op" id="6054743">:</span><span class="op" id="6054744">]</span><span class="op" id="6054745">...</span><span class="op" id="6054748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6054752">}</span>&nbsp;<span class="keyword" id="6054754">else</span>&nbsp;<span class="op" id="6054759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054764">b</span><span class="op" id="6054765">.</span><span class="builtintype" id="6054766">uint32</span><span class="op" id="6054772">(</span><span class="ident" id="6054773">h</span><span class="op" id="6054774">.</span><span class="ident" id="6054775">CompressedSize</span><span class="op" id="6054789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054794">b</span><span class="op" id="6054795">.</span><span class="builtintype" id="6054796">uint32</span><span class="op" id="6054802">(</span><span class="ident" id="6054803">h</span><span class="op" id="6054804">.</span><span class="ident" id="6054805">UncompressedSize</span><span class="op" id="6054821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6054825">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054829">b</span><span class="op" id="6054830">.</span><span class="builtintype" id="6054831">uint16</span><span class="op" id="6054837">(</span><span class="builtintype" id="6054838">uint16</span><span class="op" id="6054844">(</span><span class="builtinfunc" id="6054845">len</span><span class="op" id="6054848">(</span><span class="ident" id="6054849">h</span><span class="op" id="6054850">.</span><span class="ident" id="6054851">Name</span><span class="op" id="6054855">)</span><span class="op" id="6054856">)</span><span class="op" id="6054857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054861">b</span><span class="op" id="6054862">.</span><span class="builtintype" id="6054863">uint16</span><span class="op" id="6054869">(</span><span class="builtintype" id="6054870">uint16</span><span class="op" id="6054876">(</span><span class="builtinfunc" id="6054877">len</span><span class="op" id="6054880">(</span><span class="ident" id="6054881">h</span><span class="op" id="6054882">.</span><span class="ident" id="6054883">Extra</span><span class="op" id="6054888">)</span><span class="op" id="6054889">)</span><span class="op" id="6054890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054894">b</span><span class="op" id="6054895">.</span><span class="builtintype" id="6054896">uint16</span><span class="op" id="6054902">(</span><span class="builtintype" id="6054903">uint16</span><span class="op" id="6054909">(</span><span class="builtinfunc" id="6054910">len</span><span class="op" id="6054913">(</span><span class="ident" id="6054914">h</span><span class="op" id="6054915">.</span><span class="ident" id="6054916">Comment</span><span class="op" id="6054923">)</span><span class="op" id="6054924">)</span><span class="op" id="6054925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054929">b</span>&nbsp;<span class="op" id="6054931">=</span>&nbsp;<span class="ident" id="6054933">b</span><span class="op" id="6054934">[</span><span class="num" id="6054935">4</span><span class="op" id="6054936">:</span><span class="op" id="6054937">]</span>&nbsp;<span class="comment" id="6054939">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055002">b</span><span class="op" id="6055003">.</span><span class="builtintype" id="6055004">uint32</span><span class="op" id="6055010">(</span><span class="ident" id="6055011">h</span><span class="op" id="6055012">.</span><span class="ident" id="6055013">ExternalAttrs</span><span class="op" id="6055026">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055030">if</span>&nbsp;<span class="ident" id="6055033">h</span><span class="op" id="6055034">.</span><span class="ident" id="6055035">offset</span>&nbsp;<span class="op" id="6055042">&gt;</span>&nbsp;<span class="ident" id="6055044">uint32max</span>&nbsp;<span class="op" id="6055054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055059">b</span><span class="op" id="6055060">.</span><span class="builtintype" id="6055061">uint32</span><span class="op" id="6055067">(</span><span class="ident" id="6055068">uint32max</span><span class="op" id="6055077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055081">}</span>&nbsp;<span class="keyword" id="6055083">else</span>&nbsp;<span class="op" id="6055088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055093">b</span><span class="op" id="6055094">.</span><span class="builtintype" id="6055095">uint32</span><span class="op" id="6055101">(</span><span class="builtintype" id="6055102">uint32</span><span class="op" id="6055108">(</span><span class="ident" id="6055109">h</span><span class="op" id="6055110">.</span><span class="ident" id="6055111">offset</span><span class="op" id="6055117">)</span><span class="op" id="6055118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055122">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055126">if</span>&nbsp;<span class="ident" id="6055129">_</span><span class="op" id="6055130">,</span>&nbsp;<span class="ident" id="6055132">err</span>&nbsp;<span class="op" id="6055136">:=</span>&nbsp;<span class="ident" id="6055139">w</span><span class="op" id="6055140">.</span><span class="ident" id="6055141">cw</span><span class="op" id="6055143">.</span><span class="ident" id="6055144">Write</span><span class="op" id="6055149">(</span><span class="ident" id="6055150">buf</span><span class="op" id="6055153">[</span><span class="op" id="6055154">:</span><span class="op" id="6055155">]</span><span class="op" id="6055156">)</span><span class="op" id="6055157">;</span>&nbsp;<span class="ident" id="6055159">err</span>&nbsp;<span class="op" id="6055163">!=</span>&nbsp;<span class="builtintype" id="6055166">nil</span>&nbsp;<span class="op" id="6055170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055175">return</span>&nbsp;<span class="ident" id="6055182">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055192">if</span>&nbsp;<span class="ident" id="6055195">_</span><span class="op" id="6055196">,</span>&nbsp;<span class="ident" id="6055198">err</span>&nbsp;<span class="op" id="6055202">:=</span>&nbsp;<span class="ident" id="6055205">io</span><span class="op" id="6055207">.</span><span class="ident" id="6055208">WriteString</span><span class="op" id="6055219">(</span><span class="ident" id="6055220">w</span><span class="op" id="6055221">.</span><span class="ident" id="6055222">cw</span><span class="op" id="6055224">,</span>&nbsp;<span class="ident" id="6055226">h</span><span class="op" id="6055227">.</span><span class="ident" id="6055228">Name</span><span class="op" id="6055232">)</span><span class="op" id="6055233">;</span>&nbsp;<span class="ident" id="6055235">err</span>&nbsp;<span class="op" id="6055239">!=</span>&nbsp;<span class="builtintype" id="6055242">nil</span>&nbsp;<span class="op" id="6055246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055251">return</span>&nbsp;<span class="ident" id="6055258">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055268">if</span>&nbsp;<span class="ident" id="6055271">_</span><span class="op" id="6055272">,</span>&nbsp;<span class="ident" id="6055274">err</span>&nbsp;<span class="op" id="6055278">:=</span>&nbsp;<span class="ident" id="6055281">w</span><span class="op" id="6055282">.</span><span class="ident" id="6055283">cw</span><span class="op" id="6055285">.</span><span class="ident" id="6055286">Write</span><span class="op" id="6055291">(</span><span class="ident" id="6055292">h</span><span class="op" id="6055293">.</span><span class="ident" id="6055294">Extra</span><span class="op" id="6055299">)</span><span class="op" id="6055300">;</span>&nbsp;<span class="ident" id="6055302">err</span>&nbsp;<span class="op" id="6055306">!=</span>&nbsp;<span class="builtintype" id="6055309">nil</span>&nbsp;<span class="op" id="6055313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055318">return</span>&nbsp;<span class="ident" id="6055325">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055335">if</span>&nbsp;<span class="ident" id="6055338">_</span><span class="op" id="6055339">,</span>&nbsp;<span class="ident" id="6055341">err</span>&nbsp;<span class="op" id="6055345">:=</span>&nbsp;<span class="ident" id="6055348">io</span><span class="op" id="6055350">.</span><span class="ident" id="6055351">WriteString</span><span class="op" id="6055362">(</span><span class="ident" id="6055363">w</span><span class="op" id="6055364">.</span><span class="ident" id="6055365">cw</span><span class="op" id="6055367">,</span>&nbsp;<span class="ident" id="6055369">h</span><span class="op" id="6055370">.</span><span class="ident" id="6055371">Comment</span><span class="op" id="6055378">)</span><span class="op" id="6055379">;</span>&nbsp;<span class="ident" id="6055381">err</span>&nbsp;<span class="op" id="6055385">!=</span>&nbsp;<span class="builtintype" id="6055388">nil</span>&nbsp;<span class="op" id="6055392">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055397">return</span>&nbsp;<span class="ident" id="6055404">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055416">end</span>&nbsp;<span class="op" id="6055420">:=</span>&nbsp;<span class="ident" id="6055423">w</span><span class="op" id="6055424">.</span><span class="ident" id="6055425">cw</span><span class="op" id="6055427">.</span><span class="ident" id="6055428">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055436">records</span>&nbsp;<span class="op" id="6055444">:=</span>&nbsp;<span class="ident" id="6055447">uint64</span><span class="op" id="6055453">(</span><span class="builtinfunc" id="6055454">len</span><span class="op" id="6055457">(</span><span class="ident" id="6055458">w</span><span class="op" id="6055459">.</span><span class="ident" id="6055460">dir</span><span class="op" id="6055463">)</span><span class="op" id="6055464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055467">size</span>&nbsp;<span class="op" id="6055472">:=</span>&nbsp;<span class="ident" id="6055475">uint64</span><span class="op" id="6055481">(</span><span class="ident" id="6055482">end</span>&nbsp;<span class="op" id="6055486">-</span>&nbsp;<span class="ident" id="6055488">start</span><span class="op" id="6055493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055496">offset</span>&nbsp;<span class="op" id="6055503">:=</span>&nbsp;<span class="ident" id="6055506">uint64</span><span class="op" id="6055512">(</span><span class="ident" id="6055513">start</span><span class="op" id="6055518">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055522">if</span>&nbsp;<span class="ident" id="6055525">records</span>&nbsp;<span class="op" id="6055533">&gt;</span>&nbsp;<span class="ident" id="6055535">uint16max</span>&nbsp;<span class="op" id="6055545">||</span>&nbsp;<span class="ident" id="6055548">size</span>&nbsp;<span class="op" id="6055553">&gt;</span>&nbsp;<span class="ident" id="6055555">uint32max</span>&nbsp;<span class="op" id="6055565">||</span>&nbsp;<span class="ident" id="6055568">offset</span>&nbsp;<span class="op" id="6055575">&gt;</span>&nbsp;<span class="ident" id="6055577">uint32max</span>&nbsp;<span class="op" id="6055587">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055591">var</span>&nbsp;<span class="ident" id="6055595">buf</span>&nbsp;<span class="op" id="6055599">[</span><span class="ident" id="6055600">directory64EndLen</span>&nbsp;<span class="op" id="6055618">+</span>&nbsp;<span class="ident" id="6055620">directory64LocLen</span><span class="op" id="6055637">]</span><span class="builtintype" id="6055638">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055645">b</span>&nbsp;<span class="op" id="6055647">:=</span>&nbsp;<span class="ident" id="6055650">writeBuf</span><span class="op" id="6055658">(</span><span class="ident" id="6055659">buf</span><span class="op" id="6055662">[</span><span class="op" id="6055663">:</span><span class="op" id="6055664">]</span><span class="op" id="6055665">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055670">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055713">b</span><span class="op" id="6055714">.</span><span class="builtintype" id="6055715">uint32</span><span class="op" id="6055721">(</span><span class="ident" id="6055722">directory64EndSignature</span><span class="op" id="6055745">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055749">b</span><span class="op" id="6055750">.</span><span class="ident" id="6055751">uint64</span><span class="op" id="6055757">(</span><span class="ident" id="6055758">directory64EndLen</span><span class="op" id="6055775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055779">b</span><span class="op" id="6055780">.</span><span class="builtintype" id="6055781">uint16</span><span class="op" id="6055787">(</span><span class="ident" id="6055788">zipVersion45</span><span class="op" id="6055800">)</span>&nbsp;<span class="comment" id="6055802">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055823">b</span><span class="op" id="6055824">.</span><span class="builtintype" id="6055825">uint16</span><span class="op" id="6055831">(</span><span class="ident" id="6055832">zipVersion45</span><span class="op" id="6055844">)</span>&nbsp;<span class="comment" id="6055846">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055877">b</span><span class="op" id="6055878">.</span><span class="builtintype" id="6055879">uint32</span><span class="op" id="6055885">(</span><span class="num" id="6055886">0</span><span class="op" id="6055887">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055900">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055925">b</span><span class="op" id="6055926">.</span><span class="builtintype" id="6055927">uint32</span><span class="op" id="6055933">(</span><span class="num" id="6055934">0</span><span class="op" id="6055935">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055948">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056012">b</span><span class="op" id="6056013">.</span><span class="ident" id="6056014">uint64</span><span class="op" id="6056020">(</span><span class="ident" id="6056021">records</span><span class="op" id="6056028">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056035">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056102">b</span><span class="op" id="6056103">.</span><span class="ident" id="6056104">uint64</span><span class="op" id="6056110">(</span><span class="ident" id="6056111">records</span><span class="op" id="6056118">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056125">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056179">b</span><span class="op" id="6056180">.</span><span class="ident" id="6056181">uint64</span><span class="op" id="6056187">(</span><span class="ident" id="6056188">size</span><span class="op" id="6056192">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056202">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056237">b</span><span class="op" id="6056238">.</span><span class="ident" id="6056239">uint64</span><span class="op" id="6056245">(</span><span class="ident" id="6056246">offset</span><span class="op" id="6056252">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056260">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056344">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056388">b</span><span class="op" id="6056389">.</span><span class="builtintype" id="6056390">uint32</span><span class="op" id="6056396">(</span><span class="ident" id="6056397">directory64LocSignature</span><span class="op" id="6056420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056424">b</span><span class="op" id="6056425">.</span><span class="builtintype" id="6056426">uint32</span><span class="op" id="6056432">(</span><span class="num" id="6056433">0</span><span class="op" id="6056434">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056446">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056523">b</span><span class="op" id="6056524">.</span><span class="ident" id="6056525">uint64</span><span class="op" id="6056531">(</span><span class="ident" id="6056532">uint64</span><span class="op" id="6056538">(</span><span class="ident" id="6056539">end</span><span class="op" id="6056542">)</span><span class="op" id="6056543">)</span>&nbsp;<span class="comment" id="6056545">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056611">b</span><span class="op" id="6056612">.</span><span class="builtintype" id="6056613">uint32</span><span class="op" id="6056619">(</span><span class="num" id="6056620">1</span><span class="op" id="6056621">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056633">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056661">if</span>&nbsp;<span class="ident" id="6056664">_</span><span class="op" id="6056665">,</span>&nbsp;<span class="ident" id="6056667">err</span>&nbsp;<span class="op" id="6056671">:=</span>&nbsp;<span class="ident" id="6056674">w</span><span class="op" id="6056675">.</span><span class="ident" id="6056676">cw</span><span class="op" id="6056678">.</span><span class="ident" id="6056679">Write</span><span class="op" id="6056684">(</span><span class="ident" id="6056685">buf</span><span class="op" id="6056688">[</span><span class="op" id="6056689">:</span><span class="op" id="6056690">]</span><span class="op" id="6056691">)</span><span class="op" id="6056692">;</span>&nbsp;<span class="ident" id="6056694">err</span>&nbsp;<span class="op" id="6056698">!=</span>&nbsp;<span class="builtintype" id="6056701">nil</span>&nbsp;<span class="op" id="6056705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056710">return</span>&nbsp;<span class="ident" id="6056717">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6056723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056728">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056791">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056841">records</span>&nbsp;<span class="op" id="6056849">=</span>&nbsp;<span class="ident" id="6056851">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056863">size</span>&nbsp;<span class="op" id="6056868">=</span>&nbsp;<span class="ident" id="6056870">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056882">offset</span>&nbsp;<span class="op" id="6056889">=</span>&nbsp;<span class="ident" id="6056891">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6056902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056906">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056927">var</span>&nbsp;<span class="ident" id="6056931">buf</span>&nbsp;<span class="op" id="6056935">[</span><span class="ident" id="6056936">directoryEndLen</span><span class="op" id="6056951">]</span><span class="builtintype" id="6056952">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056958">b</span>&nbsp;<span class="op" id="6056960">:=</span>&nbsp;<span class="ident" id="6056963">writeBuf</span><span class="op" id="6056971">(</span><span class="ident" id="6056972">buf</span><span class="op" id="6056975">[</span><span class="op" id="6056976">:</span><span class="op" id="6056977">]</span><span class="op" id="6056978">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056981">b</span><span class="op" id="6056982">.</span><span class="builtintype" id="6056983">uint32</span><span class="op" id="6056989">(</span><span class="builtintype" id="6056990">uint32</span><span class="op" id="6056996">(</span><span class="ident" id="6056997">directoryEndSignature</span><span class="op" id="6057018">)</span><span class="op" id="6057019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057022">b</span>&nbsp;<span class="op" id="6057024">=</span>&nbsp;<span class="ident" id="6057026">b</span><span class="op" id="6057027">[</span><span class="num" id="6057028">4</span><span class="op" id="6057029">:</span><span class="op" id="6057030">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057048">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057108">b</span><span class="op" id="6057109">.</span><span class="builtintype" id="6057110">uint16</span><span class="op" id="6057116">(</span><span class="builtintype" id="6057117">uint16</span><span class="op" id="6057123">(</span><span class="ident" id="6057124">records</span><span class="op" id="6057131">)</span><span class="op" id="6057132">)</span>&nbsp;<span class="comment" id="6057134">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057166">b</span><span class="op" id="6057167">.</span><span class="builtintype" id="6057168">uint16</span><span class="op" id="6057174">(</span><span class="builtintype" id="6057175">uint16</span><span class="op" id="6057181">(</span><span class="ident" id="6057182">records</span><span class="op" id="6057189">)</span><span class="op" id="6057190">)</span>&nbsp;<span class="comment" id="6057192">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057220">b</span><span class="op" id="6057221">.</span><span class="builtintype" id="6057222">uint32</span><span class="op" id="6057228">(</span><span class="builtintype" id="6057229">uint32</span><span class="op" id="6057235">(</span><span class="ident" id="6057236">size</span><span class="op" id="6057240">)</span><span class="op" id="6057241">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057246">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057268">b</span><span class="op" id="6057269">.</span><span class="builtintype" id="6057270">uint32</span><span class="op" id="6057276">(</span><span class="builtintype" id="6057277">uint32</span><span class="op" id="6057283">(</span><span class="ident" id="6057284">offset</span><span class="op" id="6057290">)</span><span class="op" id="6057291">)</span>&nbsp;&nbsp;<span class="comment" id="6057294">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057317">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057359">if</span>&nbsp;<span class="ident" id="6057362">_</span><span class="op" id="6057363">,</span>&nbsp;<span class="ident" id="6057365">err</span>&nbsp;<span class="op" id="6057369">:=</span>&nbsp;<span class="ident" id="6057372">w</span><span class="op" id="6057373">.</span><span class="ident" id="6057374">cw</span><span class="op" id="6057376">.</span><span class="ident" id="6057377">Write</span><span class="op" id="6057382">(</span><span class="ident" id="6057383">buf</span><span class="op" id="6057386">[</span><span class="op" id="6057387">:</span><span class="op" id="6057388">]</span><span class="op" id="6057389">)</span><span class="op" id="6057390">;</span>&nbsp;<span class="ident" id="6057392">err</span>&nbsp;<span class="op" id="6057396">!=</span>&nbsp;<span class="builtintype" id="6057399">nil</span>&nbsp;<span class="op" id="6057403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057407">return</span>&nbsp;<span class="ident" id="6057414">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057419">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057423">return</span>&nbsp;<span class="ident" id="6057430">w</span><span class="op" id="6057431">.</span><span class="ident" id="6057432">cw</span><span class="op" id="6057434">.</span><span class="ident" id="6057435">w</span><span class="op" id="6057436">.</span><span class="op" id="6057437">(</span><span class="op" id="6057438">*</span><span class="ident" id="6057439">bufio</span><span class="op" id="6057444">.</span><span class="ident" id="6057445">Writer</span><span class="op" id="6057451">)</span><span class="op" id="6057452">.</span><span class="ident" id="6057453">Flush</span><span class="op" id="6057458">(</span><span class="op" id="6057459">)</span><br>
<span class="lineno"></span><span class="op" id="6057461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6057464">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="6057527">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6057596">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="6057664">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="6057731">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="6057743">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="6057815">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6057858">func</span>&nbsp;<span class="op" id="6057863">(</span><span class="ident" id="6057864">w</span>&nbsp;<span class="op" id="6057866">*</span><span class="ident" id="6057867">Writer</span><span class="op" id="6057873">)</span>&nbsp;<span class="ident" id="6057875">Create</span><span class="op" id="6057881">(</span><span class="ident" id="6057882">name</span>&nbsp;<span class="builtintype" id="6057887">string</span><span class="op" id="6057893">)</span>&nbsp;<span class="op" id="6057895">(</span><span class="ident" id="6057896">io</span><span class="op" id="6057898">.</span><span class="ident" id="6057899">Writer</span><span class="op" id="6057905">,</span>&nbsp;<span class="builtintype" id="6057907">error</span><span class="op" id="6057912">)</span>&nbsp;<span class="op" id="6057914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057917">header</span>&nbsp;<span class="op" id="6057924">:=</span>&nbsp;<span class="op" id="6057927">&amp;</span><span class="ident" id="6057928">FileHeader</span><span class="op" id="6057938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057942">Name</span><span class="op" id="6057946">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6057950">name</span><span class="op" id="6057954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057958">Method</span><span class="op" id="6057964">:</span>&nbsp;<span class="ident" id="6057966">Deflate</span><span class="op" id="6057973">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057979">return</span>&nbsp;<span class="ident" id="6057986">w</span><span class="op" id="6057987">.</span><span class="ident" id="6057988">CreateHeader</span><span class="op" id="6058000">(</span><span class="ident" id="6058001">header</span><span class="op" id="6058007">)</span><br>
<span class="lineno"></span><span class="op" id="6058009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6058012">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="6058086">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="6058112">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6058181">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="6058253">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6058296">func</span>&nbsp;<span class="op" id="6058301">(</span><span class="ident" id="6058302">w</span>&nbsp;<span class="op" id="6058304">*</span><span class="ident" id="6058305">Writer</span><span class="op" id="6058311">)</span>&nbsp;<span class="ident" id="6058313">CreateHeader</span><span class="op" id="6058325">(</span><span class="ident" id="6058326">fh</span>&nbsp;<span class="op" id="6058329">*</span><span class="ident" id="6058330">FileHeader</span><span class="op" id="6058340">)</span>&nbsp;<span class="op" id="6058342">(</span><span class="ident" id="6058343">io</span><span class="op" id="6058345">.</span><span class="ident" id="6058346">Writer</span><span class="op" id="6058352">,</span>&nbsp;<span class="builtintype" id="6058354">error</span><span class="op" id="6058359">)</span>&nbsp;<span class="op" id="6058361">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058364">if</span>&nbsp;<span class="ident" id="6058367">w</span><span class="op" id="6058368">.</span><span class="ident" id="6058369">last</span>&nbsp;<span class="op" id="6058374">!=</span>&nbsp;<span class="builtintype" id="6058377">nil</span>&nbsp;<span class="op" id="6058381">&amp;&amp;</span>&nbsp;<span class="op" id="6058384">!</span><span class="ident" id="6058385">w</span><span class="op" id="6058386">.</span><span class="ident" id="6058387">last</span><span class="op" id="6058391">.</span><span class="ident" id="6058392">closed</span>&nbsp;<span class="op" id="6058399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058403">if</span>&nbsp;<span class="ident" id="6058406">err</span>&nbsp;<span class="op" id="6058410">:=</span>&nbsp;<span class="ident" id="6058413">w</span><span class="op" id="6058414">.</span><span class="ident" id="6058415">last</span><span class="op" id="6058419">.</span><span class="builtinfunc" id="6058420">close</span><span class="op" id="6058425">(</span><span class="op" id="6058426">)</span><span class="op" id="6058427">;</span>&nbsp;<span class="ident" id="6058429">err</span>&nbsp;<span class="op" id="6058433">!=</span>&nbsp;<span class="builtintype" id="6058436">nil</span>&nbsp;<span class="op" id="6058440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058445">return</span>&nbsp;<span class="builtintype" id="6058452">nil</span><span class="op" id="6058455">,</span>&nbsp;<span class="ident" id="6058457">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6058463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6058466">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058470">fh</span><span class="op" id="6058472">.</span><span class="ident" id="6058473">Flags</span>&nbsp;<span class="op" id="6058479">|=</span>&nbsp;<span class="num" id="6058482">0x8</span>&nbsp;<span class="comment" id="6058486">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058523">fh</span><span class="op" id="6058525">.</span><span class="ident" id="6058526">CreatorVersion</span>&nbsp;<span class="op" id="6058541">=</span>&nbsp;<span class="ident" id="6058543">fh</span><span class="op" id="6058545">.</span><span class="ident" id="6058546">CreatorVersion</span><span class="op" id="6058560">&amp;</span><span class="num" id="6058561">0xff00</span>&nbsp;<span class="op" id="6058568">|</span>&nbsp;<span class="ident" id="6058570">zipVersion20</span>&nbsp;<span class="comment" id="6058583">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058615">fh</span><span class="op" id="6058617">.</span><span class="ident" id="6058618">ReaderVersion</span>&nbsp;<span class="op" id="6058632">=</span>&nbsp;<span class="ident" id="6058634">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058649">fw</span>&nbsp;<span class="op" id="6058652">:=</span>&nbsp;<span class="op" id="6058655">&amp;</span><span class="ident" id="6058656">fileWriter</span><span class="op" id="6058666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058670">zipw</span><span class="op" id="6058674">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058681">w</span><span class="op" id="6058682">.</span><span class="ident" id="6058683">cw</span><span class="op" id="6058685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058689">compCount</span><span class="op" id="6058698">:</span>&nbsp;<span class="op" id="6058700">&amp;</span><span class="ident" id="6058701">countWriter</span><span class="op" id="6058712">{</span><span class="ident" id="6058713">w</span><span class="op" id="6058714">:</span>&nbsp;<span class="ident" id="6058716">w</span><span class="op" id="6058717">.</span><span class="ident" id="6058718">cw</span><span class="op" id="6058720">}</span><span class="op" id="6058721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058725">crc32</span><span class="op" id="6058730">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058736">crc32</span><span class="op" id="6058741">.</span><span class="ident" id="6058742">NewIEEE</span><span class="op" id="6058749">(</span><span class="op" id="6058750">)</span><span class="op" id="6058751">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6058754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058757">comp</span>&nbsp;<span class="op" id="6058762">:=</span>&nbsp;<span class="ident" id="6058765">compressor</span><span class="op" id="6058775">(</span><span class="ident" id="6058776">fh</span><span class="op" id="6058778">.</span><span class="ident" id="6058779">Method</span><span class="op" id="6058785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058788">if</span>&nbsp;<span class="ident" id="6058791">comp</span>&nbsp;<span class="op" id="6058796">==</span>&nbsp;<span class="builtintype" id="6058799">nil</span>&nbsp;<span class="op" id="6058803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058807">return</span>&nbsp;<span class="builtintype" id="6058814">nil</span><span class="op" id="6058817">,</span>&nbsp;<span class="ident" id="6058819">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6058833">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058836">var</span>&nbsp;<span class="ident" id="6058840">err</span>&nbsp;<span class="builtintype" id="6058844">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058851">fw</span><span class="op" id="6058853">.</span><span class="ident" id="6058854">comp</span><span class="op" id="6058858">,</span>&nbsp;<span class="ident" id="6058860">err</span>&nbsp;<span class="op" id="6058864">=</span>&nbsp;<span class="ident" id="6058866">comp</span><span class="op" id="6058870">(</span><span class="ident" id="6058871">fw</span><span class="op" id="6058873">.</span><span class="ident" id="6058874">compCount</span><span class="op" id="6058883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058886">if</span>&nbsp;<span class="ident" id="6058889">err</span>&nbsp;<span class="op" id="6058893">!=</span>&nbsp;<span class="builtintype" id="6058896">nil</span>&nbsp;<span class="op" id="6058900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058904">return</span>&nbsp;<span class="builtintype" id="6058911">nil</span><span class="op" id="6058914">,</span>&nbsp;<span class="ident" id="6058916">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6058921">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058924">fw</span><span class="op" id="6058926">.</span><span class="ident" id="6058927">rawCount</span>&nbsp;<span class="op" id="6058936">=</span>&nbsp;<span class="op" id="6058938">&amp;</span><span class="ident" id="6058939">countWriter</span><span class="op" id="6058950">{</span><span class="ident" id="6058951">w</span><span class="op" id="6058952">:</span>&nbsp;<span class="ident" id="6058954">fw</span><span class="op" id="6058956">.</span><span class="ident" id="6058957">comp</span><span class="op" id="6058961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058965">h</span>&nbsp;<span class="op" id="6058967">:=</span>&nbsp;<span class="op" id="6058970">&amp;</span><span class="ident" id="6058971">header</span><span class="op" id="6058977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058981">FileHeader</span><span class="op" id="6058991">:</span>&nbsp;<span class="ident" id="6058993">fh</span><span class="op" id="6058995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058999">offset</span><span class="op" id="6059005">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059011">uint64</span><span class="op" id="6059017">(</span><span class="ident" id="6059018">w</span><span class="op" id="6059019">.</span><span class="ident" id="6059020">cw</span><span class="op" id="6059022">.</span><span class="ident" id="6059023">count</span><span class="op" id="6059028">)</span><span class="op" id="6059029">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059035">w</span><span class="op" id="6059036">.</span><span class="ident" id="6059037">dir</span>&nbsp;<span class="op" id="6059041">=</span>&nbsp;<span class="builtinfunc" id="6059043">append</span><span class="op" id="6059049">(</span><span class="ident" id="6059050">w</span><span class="op" id="6059051">.</span><span class="ident" id="6059052">dir</span><span class="op" id="6059055">,</span>&nbsp;<span class="ident" id="6059057">h</span><span class="op" id="6059058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059061">fw</span><span class="op" id="6059063">.</span><span class="ident" id="6059064">header</span>&nbsp;<span class="op" id="6059071">=</span>&nbsp;<span class="ident" id="6059073">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059077">if</span>&nbsp;<span class="ident" id="6059080">err</span>&nbsp;<span class="op" id="6059084">:=</span>&nbsp;<span class="ident" id="6059087">writeHeader</span><span class="op" id="6059098">(</span><span class="ident" id="6059099">w</span><span class="op" id="6059100">.</span><span class="ident" id="6059101">cw</span><span class="op" id="6059103">,</span>&nbsp;<span class="ident" id="6059105">fh</span><span class="op" id="6059107">)</span><span class="op" id="6059108">;</span>&nbsp;<span class="ident" id="6059110">err</span>&nbsp;<span class="op" id="6059114">!=</span>&nbsp;<span class="builtintype" id="6059117">nil</span>&nbsp;<span class="op" id="6059121">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059125">return</span>&nbsp;<span class="builtintype" id="6059132">nil</span><span class="op" id="6059135">,</span>&nbsp;<span class="ident" id="6059137">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059146">w</span><span class="op" id="6059147">.</span><span class="ident" id="6059148">last</span>&nbsp;<span class="op" id="6059153">=</span>&nbsp;<span class="ident" id="6059155">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059159">return</span>&nbsp;<span class="ident" id="6059166">fw</span><span class="op" id="6059168">,</span>&nbsp;<span class="builtintype" id="6059170">nil</span><br>
<span class="lineno">230</span><span class="op" id="6059174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6059177">func</span>&nbsp;<span class="ident" id="6059182">writeHeader</span><span class="op" id="6059193">(</span><span class="ident" id="6059194">w</span>&nbsp;<span class="ident" id="6059196">io</span><span class="op" id="6059198">.</span><span class="ident" id="6059199">Writer</span><span class="op" id="6059205">,</span>&nbsp;<span class="ident" id="6059207">h</span>&nbsp;<span class="op" id="6059209">*</span><span class="ident" id="6059210">FileHeader</span><span class="op" id="6059220">)</span>&nbsp;<span class="builtintype" id="6059222">error</span>&nbsp;<span class="op" id="6059228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059231">var</span>&nbsp;<span class="ident" id="6059235">buf</span>&nbsp;<span class="op" id="6059239">[</span><span class="ident" id="6059240">fileHeaderLen</span><span class="op" id="6059253">]</span><span class="builtintype" id="6059254">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059260">b</span>&nbsp;<span class="op" id="6059262">:=</span>&nbsp;<span class="ident" id="6059265">writeBuf</span><span class="op" id="6059273">(</span><span class="ident" id="6059274">buf</span><span class="op" id="6059277">[</span><span class="op" id="6059278">:</span><span class="op" id="6059279">]</span><span class="op" id="6059280">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059283">b</span><span class="op" id="6059284">.</span><span class="builtintype" id="6059285">uint32</span><span class="op" id="6059291">(</span><span class="builtintype" id="6059292">uint32</span><span class="op" id="6059298">(</span><span class="ident" id="6059299">fileHeaderSignature</span><span class="op" id="6059318">)</span><span class="op" id="6059319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059322">b</span><span class="op" id="6059323">.</span><span class="builtintype" id="6059324">uint16</span><span class="op" id="6059330">(</span><span class="ident" id="6059331">h</span><span class="op" id="6059332">.</span><span class="ident" id="6059333">ReaderVersion</span><span class="op" id="6059346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059349">b</span><span class="op" id="6059350">.</span><span class="builtintype" id="6059351">uint16</span><span class="op" id="6059357">(</span><span class="ident" id="6059358">h</span><span class="op" id="6059359">.</span><span class="ident" id="6059360">Flags</span><span class="op" id="6059365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059368">b</span><span class="op" id="6059369">.</span><span class="builtintype" id="6059370">uint16</span><span class="op" id="6059376">(</span><span class="ident" id="6059377">h</span><span class="op" id="6059378">.</span><span class="ident" id="6059379">Method</span><span class="op" id="6059385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059388">b</span><span class="op" id="6059389">.</span><span class="builtintype" id="6059390">uint16</span><span class="op" id="6059396">(</span><span class="ident" id="6059397">h</span><span class="op" id="6059398">.</span><span class="ident" id="6059399">ModifiedTime</span><span class="op" id="6059411">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059414">b</span><span class="op" id="6059415">.</span><span class="builtintype" id="6059416">uint16</span><span class="op" id="6059422">(</span><span class="ident" id="6059423">h</span><span class="op" id="6059424">.</span><span class="ident" id="6059425">ModifiedDate</span><span class="op" id="6059437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059440">b</span><span class="op" id="6059441">.</span><span class="builtintype" id="6059442">uint32</span><span class="op" id="6059448">(</span><span class="num" id="6059449">0</span><span class="op" id="6059450">)</span>&nbsp;<span class="comment" id="6059452">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059502">b</span><span class="op" id="6059503">.</span><span class="builtintype" id="6059504">uint32</span><span class="op" id="6059510">(</span><span class="num" id="6059511">0</span><span class="op" id="6059512">)</span>&nbsp;<span class="comment" id="6059514">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059535">b</span><span class="op" id="6059536">.</span><span class="builtintype" id="6059537">uint32</span><span class="op" id="6059543">(</span><span class="num" id="6059544">0</span><span class="op" id="6059545">)</span>&nbsp;<span class="comment" id="6059547">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059588">b</span><span class="op" id="6059589">.</span><span class="builtintype" id="6059590">uint16</span><span class="op" id="6059596">(</span><span class="builtintype" id="6059597">uint16</span><span class="op" id="6059603">(</span><span class="builtinfunc" id="6059604">len</span><span class="op" id="6059607">(</span><span class="ident" id="6059608">h</span><span class="op" id="6059609">.</span><span class="ident" id="6059610">Name</span><span class="op" id="6059614">)</span><span class="op" id="6059615">)</span><span class="op" id="6059616">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059619">b</span><span class="op" id="6059620">.</span><span class="builtintype" id="6059621">uint16</span><span class="op" id="6059627">(</span><span class="builtintype" id="6059628">uint16</span><span class="op" id="6059634">(</span><span class="builtinfunc" id="6059635">len</span><span class="op" id="6059638">(</span><span class="ident" id="6059639">h</span><span class="op" id="6059640">.</span><span class="ident" id="6059641">Extra</span><span class="op" id="6059646">)</span><span class="op" id="6059647">)</span><span class="op" id="6059648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059651">if</span>&nbsp;<span class="ident" id="6059654">_</span><span class="op" id="6059655">,</span>&nbsp;<span class="ident" id="6059657">err</span>&nbsp;<span class="op" id="6059661">:=</span>&nbsp;<span class="ident" id="6059664">w</span><span class="op" id="6059665">.</span><span class="ident" id="6059666">Write</span><span class="op" id="6059671">(</span><span class="ident" id="6059672">buf</span><span class="op" id="6059675">[</span><span class="op" id="6059676">:</span><span class="op" id="6059677">]</span><span class="op" id="6059678">)</span><span class="op" id="6059679">;</span>&nbsp;<span class="ident" id="6059681">err</span>&nbsp;<span class="op" id="6059685">!=</span>&nbsp;<span class="builtintype" id="6059688">nil</span>&nbsp;<span class="op" id="6059692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059696">return</span>&nbsp;<span class="ident" id="6059703">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059711">if</span>&nbsp;<span class="ident" id="6059714">_</span><span class="op" id="6059715">,</span>&nbsp;<span class="ident" id="6059717">err</span>&nbsp;<span class="op" id="6059721">:=</span>&nbsp;<span class="ident" id="6059724">io</span><span class="op" id="6059726">.</span><span class="ident" id="6059727">WriteString</span><span class="op" id="6059738">(</span><span class="ident" id="6059739">w</span><span class="op" id="6059740">,</span>&nbsp;<span class="ident" id="6059742">h</span><span class="op" id="6059743">.</span><span class="ident" id="6059744">Name</span><span class="op" id="6059748">)</span><span class="op" id="6059749">;</span>&nbsp;<span class="ident" id="6059751">err</span>&nbsp;<span class="op" id="6059755">!=</span>&nbsp;<span class="builtintype" id="6059758">nil</span>&nbsp;<span class="op" id="6059762">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059766">return</span>&nbsp;<span class="ident" id="6059773">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059781">_</span><span class="op" id="6059782">,</span>&nbsp;<span class="ident" id="6059784">err</span>&nbsp;<span class="op" id="6059788">:=</span>&nbsp;<span class="ident" id="6059791">w</span><span class="op" id="6059792">.</span><span class="ident" id="6059793">Write</span><span class="op" id="6059798">(</span><span class="ident" id="6059799">h</span><span class="op" id="6059800">.</span><span class="ident" id="6059801">Extra</span><span class="op" id="6059806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059809">return</span>&nbsp;<span class="ident" id="6059816">err</span><br>
<span class="lineno"></span><span class="op" id="6059820">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6059823">type</span>&nbsp;<span class="ident" id="6059828">fileWriter</span>&nbsp;<span class="keyword" id="6059839">struct</span>&nbsp;<span class="op" id="6059846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059849">*</span><span class="ident" id="6059850">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059858">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059868">io</span><span class="op" id="6059870">.</span><span class="ident" id="6059871">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059879">rawCount</span>&nbsp;&nbsp;<span class="op" id="6059889">*</span><span class="ident" id="6059890">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059903">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059913">io</span><span class="op" id="6059915">.</span><span class="ident" id="6059916">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059929">compCount</span>&nbsp;<span class="op" id="6059939">*</span><span class="ident" id="6059940">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059953">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059963">hash</span><span class="op" id="6059967">.</span><span class="ident" id="6059968">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059976">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6059986">bool</span><br>
<span class="lineno"></span><span class="op" id="6059991">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="6059994">func</span>&nbsp;<span class="op" id="6059999">(</span><span class="ident" id="6060000">w</span>&nbsp;<span class="op" id="6060002">*</span><span class="ident" id="6060003">fileWriter</span><span class="op" id="6060013">)</span>&nbsp;<span class="ident" id="6060015">Write</span><span class="op" id="6060020">(</span><span class="ident" id="6060021">p</span>&nbsp;<span class="op" id="6060023">[</span><span class="op" id="6060024">]</span><span class="builtintype" id="6060025">byte</span><span class="op" id="6060029">)</span>&nbsp;<span class="op" id="6060031">(</span><span class="builtintype" id="6060032">int</span><span class="op" id="6060035">,</span>&nbsp;<span class="builtintype" id="6060037">error</span><span class="op" id="6060042">)</span>&nbsp;<span class="op" id="6060044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060047">if</span>&nbsp;<span class="ident" id="6060050">w</span><span class="op" id="6060051">.</span><span class="ident" id="6060052">closed</span>&nbsp;<span class="op" id="6060059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060063">return</span>&nbsp;<span class="num" id="6060070">0</span><span class="op" id="6060071">,</span>&nbsp;<span class="ident" id="6060073">errors</span><span class="op" id="6060079">.</span><span class="ident" id="6060080">New</span><span class="op" id="6060083">(</span><span class="string" id="6060084">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="6060111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060114">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060117">w</span><span class="op" id="6060118">.</span><span class="ident" id="6060119">crc32</span><span class="op" id="6060124">.</span><span class="ident" id="6060125">Write</span><span class="op" id="6060130">(</span><span class="ident" id="6060131">p</span><span class="op" id="6060132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060135">return</span>&nbsp;<span class="ident" id="6060142">w</span><span class="op" id="6060143">.</span><span class="ident" id="6060144">rawCount</span><span class="op" id="6060152">.</span><span class="ident" id="6060153">Write</span><span class="op" id="6060158">(</span><span class="ident" id="6060159">p</span><span class="op" id="6060160">)</span><br>
<span class="lineno"></span><span class="op" id="6060162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6060165">func</span>&nbsp;<span class="op" id="6060170">(</span><span class="ident" id="6060171">w</span>&nbsp;<span class="op" id="6060173">*</span><span class="ident" id="6060174">fileWriter</span><span class="op" id="6060184">)</span>&nbsp;<span class="builtinfunc" id="6060186">close</span><span class="op" id="6060191">(</span><span class="op" id="6060192">)</span>&nbsp;<span class="builtintype" id="6060194">error</span>&nbsp;<span class="op" id="6060200">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060203">if</span>&nbsp;<span class="ident" id="6060206">w</span><span class="op" id="6060207">.</span><span class="ident" id="6060208">closed</span>&nbsp;<span class="op" id="6060215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060219">return</span>&nbsp;<span class="ident" id="6060226">errors</span><span class="op" id="6060232">.</span><span class="ident" id="6060233">New</span><span class="op" id="6060236">(</span><span class="string" id="6060237">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6060261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060267">w</span><span class="op" id="6060268">.</span><span class="ident" id="6060269">closed</span>&nbsp;<span class="op" id="6060276">=</span>&nbsp;<span class="builtintype" id="6060278">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060284">if</span>&nbsp;<span class="ident" id="6060287">err</span>&nbsp;<span class="op" id="6060291">:=</span>&nbsp;<span class="ident" id="6060294">w</span><span class="op" id="6060295">.</span><span class="ident" id="6060296">comp</span><span class="op" id="6060300">.</span><span class="ident" id="6060301">Close</span><span class="op" id="6060306">(</span><span class="op" id="6060307">)</span><span class="op" id="6060308">;</span>&nbsp;<span class="ident" id="6060310">err</span>&nbsp;<span class="op" id="6060314">!=</span>&nbsp;<span class="builtintype" id="6060317">nil</span>&nbsp;<span class="op" id="6060321">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060325">return</span>&nbsp;<span class="ident" id="6060332">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6060341">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060363">fh</span>&nbsp;<span class="op" id="6060366">:=</span>&nbsp;<span class="ident" id="6060369">w</span><span class="op" id="6060370">.</span><span class="ident" id="6060371">header</span><span class="op" id="6060377">.</span><span class="ident" id="6060378">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060390">fh</span><span class="op" id="6060392">.</span><span class="ident" id="6060393">CRC32</span>&nbsp;<span class="op" id="6060399">=</span>&nbsp;<span class="ident" id="6060401">w</span><span class="op" id="6060402">.</span><span class="ident" id="6060403">crc32</span><span class="op" id="6060408">.</span><span class="ident" id="6060409">Sum32</span><span class="op" id="6060414">(</span><span class="op" id="6060415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060418">fh</span><span class="op" id="6060420">.</span><span class="ident" id="6060421">CompressedSize64</span>&nbsp;<span class="op" id="6060438">=</span>&nbsp;<span class="ident" id="6060440">uint64</span><span class="op" id="6060446">(</span><span class="ident" id="6060447">w</span><span class="op" id="6060448">.</span><span class="ident" id="6060449">compCount</span><span class="op" id="6060458">.</span><span class="ident" id="6060459">count</span><span class="op" id="6060464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060467">fh</span><span class="op" id="6060469">.</span><span class="ident" id="6060470">UncompressedSize64</span>&nbsp;<span class="op" id="6060489">=</span>&nbsp;<span class="ident" id="6060491">uint64</span><span class="op" id="6060497">(</span><span class="ident" id="6060498">w</span><span class="op" id="6060499">.</span><span class="ident" id="6060500">rawCount</span><span class="op" id="6060508">.</span><span class="ident" id="6060509">count</span><span class="op" id="6060514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060518">if</span>&nbsp;<span class="ident" id="6060521">fh</span><span class="op" id="6060523">.</span><span class="ident" id="6060524">isZip64</span><span class="op" id="6060531">(</span><span class="op" id="6060532">)</span>&nbsp;<span class="op" id="6060534">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060538">fh</span><span class="op" id="6060540">.</span><span class="ident" id="6060541">CompressedSize</span>&nbsp;<span class="op" id="6060556">=</span>&nbsp;<span class="ident" id="6060558">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060570">fh</span><span class="op" id="6060572">.</span><span class="ident" id="6060573">UncompressedSize</span>&nbsp;<span class="op" id="6060590">=</span>&nbsp;<span class="ident" id="6060592">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060604">fh</span><span class="op" id="6060606">.</span><span class="ident" id="6060607">ReaderVersion</span>&nbsp;<span class="op" id="6060621">=</span>&nbsp;<span class="ident" id="6060623">zipVersion45</span>&nbsp;<span class="comment" id="6060636">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060689">}</span>&nbsp;<span class="keyword" id="6060691">else</span>&nbsp;<span class="op" id="6060696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060700">fh</span><span class="op" id="6060702">.</span><span class="ident" id="6060703">CompressedSize</span>&nbsp;<span class="op" id="6060718">=</span>&nbsp;<span class="builtintype" id="6060720">uint32</span><span class="op" id="6060726">(</span><span class="ident" id="6060727">fh</span><span class="op" id="6060729">.</span><span class="ident" id="6060730">CompressedSize64</span><span class="op" id="6060746">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060750">fh</span><span class="op" id="6060752">.</span><span class="ident" id="6060753">UncompressedSize</span>&nbsp;<span class="op" id="6060770">=</span>&nbsp;<span class="builtintype" id="6060772">uint32</span><span class="op" id="6060778">(</span><span class="ident" id="6060779">fh</span><span class="op" id="6060781">.</span><span class="ident" id="6060782">UncompressedSize64</span><span class="op" id="6060800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6060807">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6060874">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6060934">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6060998">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6061063">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061127">var</span>&nbsp;<span class="ident" id="6061131">buf</span>&nbsp;<span class="op" id="6061135">[</span><span class="op" id="6061136">]</span><span class="builtintype" id="6061137">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061143">if</span>&nbsp;<span class="ident" id="6061146">fh</span><span class="op" id="6061148">.</span><span class="ident" id="6061149">isZip64</span><span class="op" id="6061156">(</span><span class="op" id="6061157">)</span>&nbsp;<span class="op" id="6061159">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061163">buf</span>&nbsp;<span class="op" id="6061167">=</span>&nbsp;<span class="builtinfunc" id="6061169">make</span><span class="op" id="6061173">(</span><span class="op" id="6061174">[</span><span class="op" id="6061175">]</span><span class="builtintype" id="6061176">byte</span><span class="op" id="6061180">,</span>&nbsp;<span class="ident" id="6061182">dataDescriptor64Len</span><span class="op" id="6061201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061204">}</span>&nbsp;<span class="keyword" id="6061206">else</span>&nbsp;<span class="op" id="6061211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061215">buf</span>&nbsp;<span class="op" id="6061219">=</span>&nbsp;<span class="builtinfunc" id="6061221">make</span><span class="op" id="6061225">(</span><span class="op" id="6061226">[</span><span class="op" id="6061227">]</span><span class="builtintype" id="6061228">byte</span><span class="op" id="6061232">,</span>&nbsp;<span class="ident" id="6061234">dataDescriptorLen</span><span class="op" id="6061251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061257">b</span>&nbsp;<span class="op" id="6061259">:=</span>&nbsp;<span class="ident" id="6061262">writeBuf</span><span class="op" id="6061270">(</span><span class="ident" id="6061271">buf</span><span class="op" id="6061274">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061277">b</span><span class="op" id="6061278">.</span><span class="builtintype" id="6061279">uint32</span><span class="op" id="6061285">(</span><span class="ident" id="6061286">dataDescriptorSignature</span><span class="op" id="6061309">)</span>&nbsp;<span class="comment" id="6061311">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061351">b</span><span class="op" id="6061352">.</span><span class="builtintype" id="6061353">uint32</span><span class="op" id="6061359">(</span><span class="ident" id="6061360">fh</span><span class="op" id="6061362">.</span><span class="ident" id="6061363">CRC32</span><span class="op" id="6061368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061371">if</span>&nbsp;<span class="ident" id="6061374">fh</span><span class="op" id="6061376">.</span><span class="ident" id="6061377">isZip64</span><span class="op" id="6061384">(</span><span class="op" id="6061385">)</span>&nbsp;<span class="op" id="6061387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061391">b</span><span class="op" id="6061392">.</span><span class="ident" id="6061393">uint64</span><span class="op" id="6061399">(</span><span class="ident" id="6061400">fh</span><span class="op" id="6061402">.</span><span class="ident" id="6061403">CompressedSize64</span><span class="op" id="6061419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061423">b</span><span class="op" id="6061424">.</span><span class="ident" id="6061425">uint64</span><span class="op" id="6061431">(</span><span class="ident" id="6061432">fh</span><span class="op" id="6061434">.</span><span class="ident" id="6061435">UncompressedSize64</span><span class="op" id="6061453">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061456">}</span>&nbsp;<span class="keyword" id="6061458">else</span>&nbsp;<span class="op" id="6061463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061467">b</span><span class="op" id="6061468">.</span><span class="builtintype" id="6061469">uint32</span><span class="op" id="6061475">(</span><span class="ident" id="6061476">fh</span><span class="op" id="6061478">.</span><span class="ident" id="6061479">CompressedSize</span><span class="op" id="6061493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061497">b</span><span class="op" id="6061498">.</span><span class="builtintype" id="6061499">uint32</span><span class="op" id="6061505">(</span><span class="ident" id="6061506">fh</span><span class="op" id="6061508">.</span><span class="ident" id="6061509">UncompressedSize</span><span class="op" id="6061525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061531">_</span><span class="op" id="6061532">,</span>&nbsp;<span class="ident" id="6061534">err</span>&nbsp;<span class="op" id="6061538">:=</span>&nbsp;<span class="ident" id="6061541">w</span><span class="op" id="6061542">.</span><span class="ident" id="6061543">zipw</span><span class="op" id="6061547">.</span><span class="ident" id="6061548">Write</span><span class="op" id="6061553">(</span><span class="ident" id="6061554">buf</span><span class="op" id="6061557">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061560">return</span>&nbsp;<span class="ident" id="6061567">err</span><br>
<span class="lineno"></span><span class="op" id="6061571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6061574">type</span>&nbsp;<span class="ident" id="6061579">countWriter</span>&nbsp;<span class="keyword" id="6061591">struct</span>&nbsp;<span class="op" id="6061598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061601">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061607">io</span><span class="op" id="6061609">.</span><span class="ident" id="6061610">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061618">count</span>&nbsp;<span class="ident" id="6061624">int64</span><br>
<span class="lineno"></span><span class="op" id="6061630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6061633">func</span>&nbsp;<span class="op" id="6061638">(</span><span class="ident" id="6061639">w</span>&nbsp;<span class="op" id="6061641">*</span><span class="ident" id="6061642">countWriter</span><span class="op" id="6061653">)</span>&nbsp;<span class="ident" id="6061655">Write</span><span class="op" id="6061660">(</span><span class="ident" id="6061661">p</span>&nbsp;<span class="op" id="6061663">[</span><span class="op" id="6061664">]</span><span class="builtintype" id="6061665">byte</span><span class="op" id="6061669">)</span>&nbsp;<span class="op" id="6061671">(</span><span class="builtintype" id="6061672">int</span><span class="op" id="6061675">,</span>&nbsp;<span class="builtintype" id="6061677">error</span><span class="op" id="6061682">)</span>&nbsp;<span class="op" id="6061684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061687">n</span><span class="op" id="6061688">,</span>&nbsp;<span class="ident" id="6061690">err</span>&nbsp;<span class="op" id="6061694">:=</span>&nbsp;<span class="ident" id="6061697">w</span><span class="op" id="6061698">.</span><span class="ident" id="6061699">w</span><span class="op" id="6061700">.</span><span class="ident" id="6061701">Write</span><span class="op" id="6061706">(</span><span class="ident" id="6061707">p</span><span class="op" id="6061708">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061711">w</span><span class="op" id="6061712">.</span><span class="ident" id="6061713">count</span>&nbsp;<span class="op" id="6061719">+=</span>&nbsp;<span class="ident" id="6061722">int64</span><span class="op" id="6061727">(</span><span class="ident" id="6061728">n</span><span class="op" id="6061729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061732">return</span>&nbsp;<span class="ident" id="6061739">n</span><span class="op" id="6061740">,</span>&nbsp;<span class="ident" id="6061742">err</span><br>
<span class="lineno"></span><span class="op" id="6061746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6061749">type</span>&nbsp;<span class="ident" id="6061754">nopCloser</span>&nbsp;<span class="keyword" id="6061764">struct</span>&nbsp;<span class="op" id="6061771">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061774">io</span><span class="op" id="6061776">.</span><span class="ident" id="6061777">Writer</span><br>
<span class="lineno"></span><span class="op" id="6061784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6061787">func</span>&nbsp;<span class="op" id="6061792">(</span><span class="ident" id="6061793">w</span>&nbsp;<span class="ident" id="6061795">nopCloser</span><span class="op" id="6061804">)</span>&nbsp;<span class="ident" id="6061806">Close</span><span class="op" id="6061811">(</span><span class="op" id="6061812">)</span>&nbsp;<span class="builtintype" id="6061814">error</span>&nbsp;<span class="op" id="6061820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061823">return</span>&nbsp;<span class="builtintype" id="6061830">nil</span><br>
<span class="lineno">340</span><span class="op" id="6061834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6061837">type</span>&nbsp;<span class="ident" id="6061842">writeBuf</span>&nbsp;<span class="op" id="6061851">[</span><span class="op" id="6061852">]</span><span class="builtintype" id="6061853">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6061859">func</span>&nbsp;<span class="op" id="6061864">(</span><span class="ident" id="6061865">b</span>&nbsp;<span class="op" id="6061867">*</span><span class="ident" id="6061868">writeBuf</span><span class="op" id="6061876">)</span>&nbsp;<span class="builtintype" id="6061878">uint16</span><span class="op" id="6061884">(</span><span class="ident" id="6061885">v</span>&nbsp;<span class="builtintype" id="6061887">uint16</span><span class="op" id="6061893">)</span>&nbsp;<span class="op" id="6061895">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061898">binary</span><span class="op" id="6061904">.</span><span class="ident" id="6061905">LittleEndian</span><span class="op" id="6061917">.</span><span class="ident" id="6061918">PutUint16</span><span class="op" id="6061927">(</span><span class="op" id="6061928">*</span><span class="ident" id="6061929">b</span><span class="op" id="6061930">,</span>&nbsp;<span class="ident" id="6061932">v</span><span class="op" id="6061933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061936">*</span><span class="ident" id="6061937">b</span>&nbsp;<span class="op" id="6061939">=</span>&nbsp;<span class="op" id="6061941">(</span><span class="op" id="6061942">*</span><span class="ident" id="6061943">b</span><span class="op" id="6061944">)</span><span class="op" id="6061945">[</span><span class="num" id="6061946">2</span><span class="op" id="6061947">:</span><span class="op" id="6061948">]</span><br>
<span class="lineno"></span><span class="op" id="6061950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6061953">func</span>&nbsp;<span class="op" id="6061958">(</span><span class="ident" id="6061959">b</span>&nbsp;<span class="op" id="6061961">*</span><span class="ident" id="6061962">writeBuf</span><span class="op" id="6061970">)</span>&nbsp;<span class="builtintype" id="6061972">uint32</span><span class="op" id="6061978">(</span><span class="ident" id="6061979">v</span>&nbsp;<span class="builtintype" id="6061981">uint32</span><span class="op" id="6061987">)</span>&nbsp;<span class="op" id="6061989">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061992">binary</span><span class="op" id="6061998">.</span><span class="ident" id="6061999">LittleEndian</span><span class="op" id="6062011">.</span><span class="ident" id="6062012">PutUint32</span><span class="op" id="6062021">(</span><span class="op" id="6062022">*</span><span class="ident" id="6062023">b</span><span class="op" id="6062024">,</span>&nbsp;<span class="ident" id="6062026">v</span><span class="op" id="6062027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062030">*</span><span class="ident" id="6062031">b</span>&nbsp;<span class="op" id="6062033">=</span>&nbsp;<span class="op" id="6062035">(</span><span class="op" id="6062036">*</span><span class="ident" id="6062037">b</span><span class="op" id="6062038">)</span><span class="op" id="6062039">[</span><span class="num" id="6062040">4</span><span class="op" id="6062041">:</span><span class="op" id="6062042">]</span><br>
<span class="lineno"></span><span class="op" id="6062044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6062047">func</span>&nbsp;<span class="op" id="6062052">(</span><span class="ident" id="6062053">b</span>&nbsp;<span class="op" id="6062055">*</span><span class="ident" id="6062056">writeBuf</span><span class="op" id="6062064">)</span>&nbsp;<span class="ident" id="6062066">uint64</span><span class="op" id="6062072">(</span><span class="ident" id="6062073">v</span>&nbsp;<span class="ident" id="6062075">uint64</span><span class="op" id="6062081">)</span>&nbsp;<span class="op" id="6062083">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062086">binary</span><span class="op" id="6062092">.</span><span class="ident" id="6062093">LittleEndian</span><span class="op" id="6062105">.</span><span class="ident" id="6062106">PutUint64</span><span class="op" id="6062115">(</span><span class="op" id="6062116">*</span><span class="ident" id="6062117">b</span><span class="op" id="6062118">,</span>&nbsp;<span class="ident" id="6062120">v</span><span class="op" id="6062121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062124">*</span><span class="ident" id="6062125">b</span>&nbsp;<span class="op" id="6062127">=</span>&nbsp;<span class="op" id="6062129">(</span><span class="op" id="6062130">*</span><span class="ident" id="6062131">b</span><span class="op" id="6062132">)</span><span class="op" id="6062133">[</span><span class="num" id="6062134">8</span><span class="op" id="6062135">:</span><span class="op" id="6062136">]</span><br>
<span class="lineno"></span><span class="op" id="6062138">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
