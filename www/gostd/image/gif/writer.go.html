<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5888872">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5888927">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5888981">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5889032">package</span>&nbsp;<span class="ident" id="5889040">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5889045">import</span>&nbsp;<span class="op" id="5889052">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5889055">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5889064">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5889080">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5889090">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5889099">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5889114">&#34;image/color/palette&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5889137">&#34;image/draw&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5889151">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5889156">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5889159">//&nbsp;Graphic&nbsp;control&nbsp;extension&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5889196">const</span>&nbsp;<span class="op" id="5889202">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889205">gcLabel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5889217">=</span>&nbsp;<span class="num" id="5889219">0xF9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889225">gcBlockSize</span>&nbsp;<span class="op" id="5889237">=</span>&nbsp;<span class="num" id="5889239">0x04</span><br>
<span class="lineno"></span><span class="op" id="5889244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5889247">var</span>&nbsp;<span class="ident" id="5889251">log2Lookup</span>&nbsp;<span class="op" id="5889262">=</span>&nbsp;<span class="op" id="5889264">[</span><span class="num" id="5889265">8</span><span class="op" id="5889266">]</span><span class="builtintype" id="5889267">int</span><span class="op" id="5889270">{</span><span class="num" id="5889271">2</span><span class="op" id="5889272">,</span>&nbsp;<span class="num" id="5889274">4</span><span class="op" id="5889275">,</span>&nbsp;<span class="num" id="5889277">8</span><span class="op" id="5889278">,</span>&nbsp;<span class="num" id="5889280">16</span><span class="op" id="5889282">,</span>&nbsp;<span class="num" id="5889284">32</span><span class="op" id="5889286">,</span>&nbsp;<span class="num" id="5889288">64</span><span class="op" id="5889290">,</span>&nbsp;<span class="num" id="5889292">128</span><span class="op" id="5889295">,</span>&nbsp;<span class="num" id="5889297">256</span><span class="op" id="5889300">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5889303">func</span>&nbsp;<span class="ident" id="5889308">log2</span><span class="op" id="5889312">(</span><span class="ident" id="5889313">x</span>&nbsp;<span class="builtintype" id="5889315">int</span><span class="op" id="5889318">)</span>&nbsp;<span class="builtintype" id="5889320">int</span>&nbsp;<span class="op" id="5889324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5889327">for</span>&nbsp;<span class="ident" id="5889331">i</span><span class="op" id="5889332">,</span>&nbsp;<span class="ident" id="5889334">v</span>&nbsp;<span class="op" id="5889336">:=</span>&nbsp;<span class="keyword" id="5889339">range</span>&nbsp;<span class="ident" id="5889345">log2Lookup</span>&nbsp;<span class="op" id="5889356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5889360">if</span>&nbsp;<span class="ident" id="5889363">x</span>&nbsp;<span class="op" id="5889365">&lt;=</span>&nbsp;<span class="ident" id="5889368">v</span>&nbsp;<span class="op" id="5889370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5889375">return</span>&nbsp;<span class="ident" id="5889382">i</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5889386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5889389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5889392">return</span>&nbsp;<span class="op" id="5889399">-</span><span class="num" id="5889400">1</span><br>
<span class="lineno"></span><span class="op" id="5889402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5889405">//&nbsp;Little-endian.</span><br>
<span class="lineno"></span><span class="keyword" id="5889423">func</span>&nbsp;<span class="ident" id="5889428">writeUint16</span><span class="op" id="5889439">(</span><span class="ident" id="5889440">b</span>&nbsp;<span class="op" id="5889442">[</span><span class="op" id="5889443">]</span><span class="builtintype" id="5889444">uint8</span><span class="op" id="5889449">,</span>&nbsp;<span class="ident" id="5889451">u</span>&nbsp;<span class="builtintype" id="5889453">uint16</span><span class="op" id="5889459">)</span>&nbsp;<span class="op" id="5889461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889464">b</span><span class="op" id="5889465">[</span><span class="num" id="5889466">0</span><span class="op" id="5889467">]</span>&nbsp;<span class="op" id="5889469">=</span>&nbsp;<span class="builtintype" id="5889471">uint8</span><span class="op" id="5889476">(</span><span class="ident" id="5889477">u</span><span class="op" id="5889478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889481">b</span><span class="op" id="5889482">[</span><span class="num" id="5889483">1</span><span class="op" id="5889484">]</span>&nbsp;<span class="op" id="5889486">=</span>&nbsp;<span class="builtintype" id="5889488">uint8</span><span class="op" id="5889493">(</span><span class="ident" id="5889494">u</span>&nbsp;<span class="op" id="5889496">&gt;&gt;</span>&nbsp;<span class="num" id="5889499">8</span><span class="op" id="5889500">)</span><br>
<span class="lineno"></span><span class="op" id="5889502">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5889505">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5889537">type</span>&nbsp;<span class="ident" id="5889542">writer</span>&nbsp;<span class="keyword" id="5889549">interface</span>&nbsp;<span class="op" id="5889559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889562">Flush</span><span class="op" id="5889567">(</span><span class="op" id="5889568">)</span>&nbsp;<span class="builtintype" id="5889570">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889577">io</span><span class="op" id="5889579">.</span><span class="ident" id="5889580">Writer</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889588">io</span><span class="op" id="5889590">.</span><span class="ident" id="5889591">ByteWriter</span><br>
<span class="lineno"></span><span class="op" id="5889602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5889605">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5889652">type</span>&nbsp;<span class="ident" id="5889657">encoder</span>&nbsp;<span class="keyword" id="5889665">struct</span>&nbsp;<span class="op" id="5889672">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5889675">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5889750">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889821">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5889825">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889833">err</span>&nbsp;<span class="builtintype" id="5889837">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5889844">//&nbsp;g&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;data&nbsp;that&nbsp;is&nbsp;being&nbsp;encoded.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889900">g</span>&nbsp;<span class="op" id="5889902">*</span><span class="ident" id="5889903">GIF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5889908">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.&nbsp;It&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;write&nbsp;the&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5889992">buf</span>&nbsp;<span class="op" id="5889996">[</span><span class="num" id="5889997">1024</span><span class="op" id="5890001">]</span><span class="builtintype" id="5890002">byte</span><br>
<span class="lineno"></span><span class="op" id="5890007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5890010">//&nbsp;blockWriter&nbsp;writes&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5890077">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5890143">//&nbsp;writer&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;encoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5890207">//&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="5890220">type</span>&nbsp;<span class="ident" id="5890225">blockWriter</span>&nbsp;<span class="keyword" id="5890237">struct</span>&nbsp;<span class="op" id="5890244">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890247">e</span>&nbsp;<span class="op" id="5890249">*</span><span class="ident" id="5890250">encoder</span><br>
<span class="lineno"></span><span class="op" id="5890258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5890261">func</span>&nbsp;<span class="op" id="5890266">(</span><span class="ident" id="5890267">b</span>&nbsp;<span class="ident" id="5890269">blockWriter</span><span class="op" id="5890280">)</span>&nbsp;<span class="ident" id="5890282">Write</span><span class="op" id="5890287">(</span><span class="ident" id="5890288">data</span>&nbsp;<span class="op" id="5890293">[</span><span class="op" id="5890294">]</span><span class="builtintype" id="5890295">byte</span><span class="op" id="5890299">)</span>&nbsp;<span class="op" id="5890301">(</span><span class="builtintype" id="5890302">int</span><span class="op" id="5890305">,</span>&nbsp;<span class="builtintype" id="5890307">error</span><span class="op" id="5890312">)</span>&nbsp;<span class="op" id="5890314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890317">if</span>&nbsp;<span class="ident" id="5890320">b</span><span class="op" id="5890321">.</span><span class="ident" id="5890322">e</span><span class="op" id="5890323">.</span><span class="ident" id="5890324">err</span>&nbsp;<span class="op" id="5890328">!=</span>&nbsp;<span class="builtintype" id="5890331">nil</span>&nbsp;<span class="op" id="5890335">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890339">return</span>&nbsp;<span class="num" id="5890346">0</span><span class="op" id="5890347">,</span>&nbsp;<span class="ident" id="5890349">b</span><span class="op" id="5890350">.</span><span class="ident" id="5890351">e</span><span class="op" id="5890352">.</span><span class="ident" id="5890353">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5890358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890361">if</span>&nbsp;<span class="builtinfunc" id="5890364">len</span><span class="op" id="5890367">(</span><span class="ident" id="5890368">data</span><span class="op" id="5890372">)</span>&nbsp;<span class="op" id="5890374">==</span>&nbsp;<span class="num" id="5890377">0</span>&nbsp;<span class="op" id="5890379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890383">return</span>&nbsp;<span class="num" id="5890390">0</span><span class="op" id="5890391">,</span>&nbsp;<span class="builtintype" id="5890393">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5890398">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890401">total</span>&nbsp;<span class="op" id="5890407">:=</span>&nbsp;<span class="num" id="5890410">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890413">for</span>&nbsp;<span class="ident" id="5890417">total</span>&nbsp;<span class="op" id="5890423">&lt;</span>&nbsp;<span class="builtinfunc" id="5890425">len</span><span class="op" id="5890428">(</span><span class="ident" id="5890429">data</span><span class="op" id="5890433">)</span>&nbsp;<span class="op" id="5890435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890439">n</span>&nbsp;<span class="op" id="5890441">:=</span>&nbsp;<span class="builtinfunc" id="5890444">copy</span><span class="op" id="5890448">(</span><span class="ident" id="5890449">b</span><span class="op" id="5890450">.</span><span class="ident" id="5890451">e</span><span class="op" id="5890452">.</span><span class="ident" id="5890453">buf</span><span class="op" id="5890456">[</span><span class="num" id="5890457">1</span><span class="op" id="5890458">:</span><span class="num" id="5890459">256</span><span class="op" id="5890462">]</span><span class="op" id="5890463">,</span>&nbsp;<span class="ident" id="5890465">data</span><span class="op" id="5890469">[</span><span class="ident" id="5890470">total</span><span class="op" id="5890475">:</span><span class="op" id="5890476">]</span><span class="op" id="5890477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890481">total</span>&nbsp;<span class="op" id="5890487">+=</span>&nbsp;<span class="ident" id="5890490">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890494">b</span><span class="op" id="5890495">.</span><span class="ident" id="5890496">e</span><span class="op" id="5890497">.</span><span class="ident" id="5890498">buf</span><span class="op" id="5890501">[</span><span class="num" id="5890502">0</span><span class="op" id="5890503">]</span>&nbsp;<span class="op" id="5890505">=</span>&nbsp;<span class="builtintype" id="5890507">uint8</span><span class="op" id="5890512">(</span><span class="ident" id="5890513">n</span><span class="op" id="5890514">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890519">n</span><span class="op" id="5890520">,</span>&nbsp;<span class="ident" id="5890522">b</span><span class="op" id="5890523">.</span><span class="ident" id="5890524">e</span><span class="op" id="5890525">.</span><span class="ident" id="5890526">err</span>&nbsp;<span class="op" id="5890530">=</span>&nbsp;<span class="ident" id="5890532">b</span><span class="op" id="5890533">.</span><span class="ident" id="5890534">e</span><span class="op" id="5890535">.</span><span class="ident" id="5890536">w</span><span class="op" id="5890537">.</span><span class="ident" id="5890538">Write</span><span class="op" id="5890543">(</span><span class="ident" id="5890544">b</span><span class="op" id="5890545">.</span><span class="ident" id="5890546">e</span><span class="op" id="5890547">.</span><span class="ident" id="5890548">buf</span><span class="op" id="5890551">[</span><span class="op" id="5890552">:</span><span class="ident" id="5890553">n</span><span class="op" id="5890554">+</span><span class="num" id="5890555">1</span><span class="op" id="5890556">]</span><span class="op" id="5890557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890561">if</span>&nbsp;<span class="ident" id="5890564">b</span><span class="op" id="5890565">.</span><span class="ident" id="5890566">e</span><span class="op" id="5890567">.</span><span class="ident" id="5890568">err</span>&nbsp;<span class="op" id="5890572">!=</span>&nbsp;<span class="builtintype" id="5890575">nil</span>&nbsp;<span class="op" id="5890579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890584">return</span>&nbsp;<span class="num" id="5890591">0</span><span class="op" id="5890592">,</span>&nbsp;<span class="ident" id="5890594">b</span><span class="op" id="5890595">.</span><span class="ident" id="5890596">e</span><span class="op" id="5890597">.</span><span class="ident" id="5890598">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5890604">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5890607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890610">return</span>&nbsp;<span class="ident" id="5890617">total</span><span class="op" id="5890622">,</span>&nbsp;<span class="ident" id="5890624">b</span><span class="op" id="5890625">.</span><span class="ident" id="5890626">e</span><span class="op" id="5890627">.</span><span class="ident" id="5890628">err</span><br>
<span class="lineno"></span><span class="op" id="5890632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5890635">func</span>&nbsp;<span class="op" id="5890640">(</span><span class="ident" id="5890641">e</span>&nbsp;<span class="op" id="5890643">*</span><span class="ident" id="5890644">encoder</span><span class="op" id="5890651">)</span>&nbsp;<span class="ident" id="5890653">flush</span><span class="op" id="5890658">(</span><span class="op" id="5890659">)</span>&nbsp;<span class="op" id="5890661">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890664">if</span>&nbsp;<span class="ident" id="5890667">e</span><span class="op" id="5890668">.</span><span class="ident" id="5890669">err</span>&nbsp;<span class="op" id="5890673">!=</span>&nbsp;<span class="builtintype" id="5890676">nil</span>&nbsp;<span class="op" id="5890680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890684">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5890692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890695">e</span><span class="op" id="5890696">.</span><span class="ident" id="5890697">err</span>&nbsp;<span class="op" id="5890701">=</span>&nbsp;<span class="ident" id="5890703">e</span><span class="op" id="5890704">.</span><span class="ident" id="5890705">w</span><span class="op" id="5890706">.</span><span class="ident" id="5890707">Flush</span><span class="op" id="5890712">(</span><span class="op" id="5890713">)</span><br>
<span class="lineno"></span><span class="op" id="5890715">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="5890718">func</span>&nbsp;<span class="op" id="5890723">(</span><span class="ident" id="5890724">e</span>&nbsp;<span class="op" id="5890726">*</span><span class="ident" id="5890727">encoder</span><span class="op" id="5890734">)</span>&nbsp;<span class="ident" id="5890736">write</span><span class="op" id="5890741">(</span><span class="ident" id="5890742">p</span>&nbsp;<span class="op" id="5890744">[</span><span class="op" id="5890745">]</span><span class="builtintype" id="5890746">byte</span><span class="op" id="5890750">)</span>&nbsp;<span class="op" id="5890752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890755">if</span>&nbsp;<span class="ident" id="5890758">e</span><span class="op" id="5890759">.</span><span class="ident" id="5890760">err</span>&nbsp;<span class="op" id="5890764">!=</span>&nbsp;<span class="builtintype" id="5890767">nil</span>&nbsp;<span class="op" id="5890771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890775">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5890783">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890786">_</span><span class="op" id="5890787">,</span>&nbsp;<span class="ident" id="5890789">e</span><span class="op" id="5890790">.</span><span class="ident" id="5890791">err</span>&nbsp;<span class="op" id="5890795">=</span>&nbsp;<span class="ident" id="5890797">e</span><span class="op" id="5890798">.</span><span class="ident" id="5890799">w</span><span class="op" id="5890800">.</span><span class="ident" id="5890801">Write</span><span class="op" id="5890806">(</span><span class="ident" id="5890807">p</span><span class="op" id="5890808">)</span><br>
<span class="lineno"></span><span class="op" id="5890810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5890813">func</span>&nbsp;<span class="op" id="5890818">(</span><span class="ident" id="5890819">e</span>&nbsp;<span class="op" id="5890821">*</span><span class="ident" id="5890822">encoder</span><span class="op" id="5890829">)</span>&nbsp;<span class="ident" id="5890831">writeByte</span><span class="op" id="5890840">(</span><span class="ident" id="5890841">b</span>&nbsp;<span class="builtintype" id="5890843">byte</span><span class="op" id="5890847">)</span>&nbsp;<span class="op" id="5890849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890852">if</span>&nbsp;<span class="ident" id="5890855">e</span><span class="op" id="5890856">.</span><span class="ident" id="5890857">err</span>&nbsp;<span class="op" id="5890861">!=</span>&nbsp;<span class="builtintype" id="5890864">nil</span>&nbsp;<span class="op" id="5890868">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890872">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5890880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890883">e</span><span class="op" id="5890884">.</span><span class="ident" id="5890885">err</span>&nbsp;<span class="op" id="5890889">=</span>&nbsp;<span class="ident" id="5890891">e</span><span class="op" id="5890892">.</span><span class="ident" id="5890893">w</span><span class="op" id="5890894">.</span><span class="ident" id="5890895">WriteByte</span><span class="op" id="5890904">(</span><span class="ident" id="5890905">b</span><span class="op" id="5890906">)</span><br>
<span class="lineno"></span><span class="op" id="5890908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="5890911">func</span>&nbsp;<span class="op" id="5890916">(</span><span class="ident" id="5890917">e</span>&nbsp;<span class="op" id="5890919">*</span><span class="ident" id="5890920">encoder</span><span class="op" id="5890927">)</span>&nbsp;<span class="ident" id="5890929">writeHeader</span><span class="op" id="5890940">(</span><span class="op" id="5890941">)</span>&nbsp;<span class="op" id="5890943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890946">if</span>&nbsp;<span class="ident" id="5890949">e</span><span class="op" id="5890950">.</span><span class="ident" id="5890951">err</span>&nbsp;<span class="op" id="5890955">!=</span>&nbsp;<span class="builtintype" id="5890958">nil</span>&nbsp;<span class="op" id="5890962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5890966">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5890974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5890977">_</span><span class="op" id="5890978">,</span>&nbsp;<span class="ident" id="5890980">e</span><span class="op" id="5890981">.</span><span class="ident" id="5890982">err</span>&nbsp;<span class="op" id="5890986">=</span>&nbsp;<span class="ident" id="5890988">io</span><span class="op" id="5890990">.</span><span class="ident" id="5890991">WriteString</span><span class="op" id="5891002">(</span><span class="ident" id="5891003">e</span><span class="op" id="5891004">.</span><span class="ident" id="5891005">w</span><span class="op" id="5891006">,</span>&nbsp;<span class="string" id="5891008">&#34;GIF89a&#34;</span><span class="op" id="5891016">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5891019">if</span>&nbsp;<span class="ident" id="5891022">e</span><span class="op" id="5891023">.</span><span class="ident" id="5891024">err</span>&nbsp;<span class="op" id="5891028">!=</span>&nbsp;<span class="builtintype" id="5891031">nil</span>&nbsp;<span class="op" id="5891035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5891039">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5891047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891051">pm</span>&nbsp;<span class="op" id="5891054">:=</span>&nbsp;<span class="ident" id="5891057">e</span><span class="op" id="5891058">.</span><span class="ident" id="5891059">g</span><span class="op" id="5891060">.</span><span class="ident" id="5891061">Image</span><span class="op" id="5891066">[</span><span class="num" id="5891067">0</span><span class="op" id="5891068">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5891071">//&nbsp;Logical&nbsp;screen&nbsp;width&nbsp;and&nbsp;height.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891108">writeUint16</span><span class="op" id="5891119">(</span><span class="ident" id="5891120">e</span><span class="op" id="5891121">.</span><span class="ident" id="5891122">buf</span><span class="op" id="5891125">[</span><span class="num" id="5891126">0</span><span class="op" id="5891127">:</span><span class="num" id="5891128">2</span><span class="op" id="5891129">]</span><span class="op" id="5891130">,</span>&nbsp;<span class="builtintype" id="5891132">uint16</span><span class="op" id="5891138">(</span><span class="ident" id="5891139">pm</span><span class="op" id="5891141">.</span><span class="ident" id="5891142">Bounds</span><span class="op" id="5891148">(</span><span class="op" id="5891149">)</span><span class="op" id="5891150">.</span><span class="ident" id="5891151">Dx</span><span class="op" id="5891153">(</span><span class="op" id="5891154">)</span><span class="op" id="5891155">)</span><span class="op" id="5891156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891159">writeUint16</span><span class="op" id="5891170">(</span><span class="ident" id="5891171">e</span><span class="op" id="5891172">.</span><span class="ident" id="5891173">buf</span><span class="op" id="5891176">[</span><span class="num" id="5891177">2</span><span class="op" id="5891178">:</span><span class="num" id="5891179">4</span><span class="op" id="5891180">]</span><span class="op" id="5891181">,</span>&nbsp;<span class="builtintype" id="5891183">uint16</span><span class="op" id="5891189">(</span><span class="ident" id="5891190">pm</span><span class="op" id="5891192">.</span><span class="ident" id="5891193">Bounds</span><span class="op" id="5891199">(</span><span class="op" id="5891200">)</span><span class="op" id="5891201">.</span><span class="ident" id="5891202">Dy</span><span class="op" id="5891204">(</span><span class="op" id="5891205">)</span><span class="op" id="5891206">)</span><span class="op" id="5891207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891210">e</span><span class="op" id="5891211">.</span><span class="ident" id="5891212">write</span><span class="op" id="5891217">(</span><span class="ident" id="5891218">e</span><span class="op" id="5891219">.</span><span class="ident" id="5891220">buf</span><span class="op" id="5891223">[</span><span class="op" id="5891224">:</span><span class="num" id="5891225">4</span><span class="op" id="5891226">]</span><span class="op" id="5891227">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5891231">//&nbsp;All&nbsp;frames&nbsp;have&nbsp;a&nbsp;local&nbsp;color&nbsp;table,&nbsp;so&nbsp;a&nbsp;global&nbsp;color&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5891296">//&nbsp;is&nbsp;not&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891315">e</span><span class="op" id="5891316">.</span><span class="ident" id="5891317">buf</span><span class="op" id="5891320">[</span><span class="num" id="5891321">0</span><span class="op" id="5891322">]</span>&nbsp;<span class="op" id="5891324">=</span>&nbsp;<span class="num" id="5891326">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891332">e</span><span class="op" id="5891333">.</span><span class="ident" id="5891334">buf</span><span class="op" id="5891337">[</span><span class="num" id="5891338">1</span><span class="op" id="5891339">]</span>&nbsp;<span class="op" id="5891341">=</span>&nbsp;<span class="num" id="5891343">0x00</span>&nbsp;<span class="comment" id="5891348">//&nbsp;Background&nbsp;Color&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891376">e</span><span class="op" id="5891377">.</span><span class="ident" id="5891378">buf</span><span class="op" id="5891381">[</span><span class="num" id="5891382">2</span><span class="op" id="5891383">]</span>&nbsp;<span class="op" id="5891385">=</span>&nbsp;<span class="num" id="5891387">0x00</span>&nbsp;<span class="comment" id="5891392">//&nbsp;Pixel&nbsp;Aspect&nbsp;Ratio.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891416">e</span><span class="op" id="5891417">.</span><span class="ident" id="5891418">write</span><span class="op" id="5891423">(</span><span class="ident" id="5891424">e</span><span class="op" id="5891425">.</span><span class="ident" id="5891426">buf</span><span class="op" id="5891429">[</span><span class="op" id="5891430">:</span><span class="num" id="5891431">3</span><span class="op" id="5891432">]</span><span class="op" id="5891433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5891437">//&nbsp;Add&nbsp;animation&nbsp;info&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5891474">if</span>&nbsp;<span class="builtinfunc" id="5891477">len</span><span class="op" id="5891480">(</span><span class="ident" id="5891481">e</span><span class="op" id="5891482">.</span><span class="ident" id="5891483">g</span><span class="op" id="5891484">.</span><span class="ident" id="5891485">Image</span><span class="op" id="5891490">)</span>&nbsp;<span class="op" id="5891492">&gt;</span>&nbsp;<span class="num" id="5891494">1</span>&nbsp;<span class="op" id="5891496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891500">e</span><span class="op" id="5891501">.</span><span class="ident" id="5891502">buf</span><span class="op" id="5891505">[</span><span class="num" id="5891506">0</span><span class="op" id="5891507">]</span>&nbsp;<span class="op" id="5891509">=</span>&nbsp;<span class="num" id="5891511">0x21</span>&nbsp;<span class="comment" id="5891516">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891543">e</span><span class="op" id="5891544">.</span><span class="ident" id="5891545">buf</span><span class="op" id="5891548">[</span><span class="num" id="5891549">1</span><span class="op" id="5891550">]</span>&nbsp;<span class="op" id="5891552">=</span>&nbsp;<span class="num" id="5891554">0xff</span>&nbsp;<span class="comment" id="5891559">//&nbsp;Application&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891583">e</span><span class="op" id="5891584">.</span><span class="ident" id="5891585">buf</span><span class="op" id="5891588">[</span><span class="num" id="5891589">2</span><span class="op" id="5891590">]</span>&nbsp;<span class="op" id="5891592">=</span>&nbsp;<span class="num" id="5891594">0x0b</span>&nbsp;<span class="comment" id="5891599">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891616">e</span><span class="op" id="5891617">.</span><span class="ident" id="5891618">write</span><span class="op" id="5891623">(</span><span class="ident" id="5891624">e</span><span class="op" id="5891625">.</span><span class="ident" id="5891626">buf</span><span class="op" id="5891629">[</span><span class="op" id="5891630">:</span><span class="num" id="5891631">3</span><span class="op" id="5891632">]</span><span class="op" id="5891633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891637">_</span><span class="op" id="5891638">,</span>&nbsp;<span class="ident" id="5891640">e</span><span class="op" id="5891641">.</span><span class="ident" id="5891642">err</span>&nbsp;<span class="op" id="5891646">=</span>&nbsp;<span class="ident" id="5891648">io</span><span class="op" id="5891650">.</span><span class="ident" id="5891651">WriteString</span><span class="op" id="5891662">(</span><span class="ident" id="5891663">e</span><span class="op" id="5891664">.</span><span class="ident" id="5891665">w</span><span class="op" id="5891666">,</span>&nbsp;<span class="string" id="5891668">&#34;NETSCAPE2.0&#34;</span><span class="op" id="5891681">)</span>&nbsp;<span class="comment" id="5891683">//&nbsp;Application&nbsp;Identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5891712">if</span>&nbsp;<span class="ident" id="5891715">e</span><span class="op" id="5891716">.</span><span class="ident" id="5891717">err</span>&nbsp;<span class="op" id="5891721">!=</span>&nbsp;<span class="builtintype" id="5891724">nil</span>&nbsp;<span class="op" id="5891728">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5891733">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5891742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891746">e</span><span class="op" id="5891747">.</span><span class="ident" id="5891748">buf</span><span class="op" id="5891751">[</span><span class="num" id="5891752">0</span><span class="op" id="5891753">]</span>&nbsp;<span class="op" id="5891755">=</span>&nbsp;<span class="num" id="5891757">0x03</span>&nbsp;<span class="comment" id="5891762">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891779">e</span><span class="op" id="5891780">.</span><span class="ident" id="5891781">buf</span><span class="op" id="5891784">[</span><span class="num" id="5891785">1</span><span class="op" id="5891786">]</span>&nbsp;<span class="op" id="5891788">=</span>&nbsp;<span class="num" id="5891790">0x01</span>&nbsp;<span class="comment" id="5891795">//&nbsp;Sub-block&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891817">writeUint16</span><span class="op" id="5891828">(</span><span class="ident" id="5891829">e</span><span class="op" id="5891830">.</span><span class="ident" id="5891831">buf</span><span class="op" id="5891834">[</span><span class="num" id="5891835">2</span><span class="op" id="5891836">:</span><span class="num" id="5891837">4</span><span class="op" id="5891838">]</span><span class="op" id="5891839">,</span>&nbsp;<span class="builtintype" id="5891841">uint16</span><span class="op" id="5891847">(</span><span class="ident" id="5891848">e</span><span class="op" id="5891849">.</span><span class="ident" id="5891850">g</span><span class="op" id="5891851">.</span><span class="ident" id="5891852">LoopCount</span><span class="op" id="5891861">)</span><span class="op" id="5891862">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891866">e</span><span class="op" id="5891867">.</span><span class="ident" id="5891868">buf</span><span class="op" id="5891871">[</span><span class="num" id="5891872">4</span><span class="op" id="5891873">]</span>&nbsp;<span class="op" id="5891875">=</span>&nbsp;<span class="num" id="5891877">0x00</span>&nbsp;<span class="comment" id="5891882">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5891905">e</span><span class="op" id="5891906">.</span><span class="ident" id="5891907">write</span><span class="op" id="5891912">(</span><span class="ident" id="5891913">e</span><span class="op" id="5891914">.</span><span class="ident" id="5891915">buf</span><span class="op" id="5891918">[</span><span class="op" id="5891919">:</span><span class="num" id="5891920">5</span><span class="op" id="5891921">]</span><span class="op" id="5891922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5891925">}</span><br>
<span class="lineno"></span><span class="op" id="5891927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="5891930">func</span>&nbsp;<span class="op" id="5891935">(</span><span class="ident" id="5891936">e</span>&nbsp;<span class="op" id="5891938">*</span><span class="ident" id="5891939">encoder</span><span class="op" id="5891946">)</span>&nbsp;<span class="ident" id="5891948">writeColorTable</span><span class="op" id="5891963">(</span><span class="ident" id="5891964">p</span>&nbsp;<span class="ident" id="5891966">color</span><span class="op" id="5891971">.</span><span class="ident" id="5891972">Palette</span><span class="op" id="5891979">,</span>&nbsp;<span class="ident" id="5891981">size</span>&nbsp;<span class="builtintype" id="5891986">int</span><span class="op" id="5891989">)</span>&nbsp;<span class="op" id="5891991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5891994">if</span>&nbsp;<span class="ident" id="5891997">e</span><span class="op" id="5891998">.</span><span class="ident" id="5891999">err</span>&nbsp;<span class="op" id="5892003">!=</span>&nbsp;<span class="builtintype" id="5892006">nil</span>&nbsp;<span class="op" id="5892010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892014">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5892022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892026">for</span>&nbsp;<span class="ident" id="5892030">i</span>&nbsp;<span class="op" id="5892032">:=</span>&nbsp;<span class="num" id="5892035">0</span><span class="op" id="5892036">;</span>&nbsp;<span class="ident" id="5892038">i</span>&nbsp;<span class="op" id="5892040">&lt;</span>&nbsp;<span class="ident" id="5892042">log2Lookup</span><span class="op" id="5892052">[</span><span class="ident" id="5892053">size</span><span class="op" id="5892057">]</span><span class="op" id="5892058">;</span>&nbsp;<span class="ident" id="5892060">i</span><span class="op" id="5892061">++</span>&nbsp;<span class="op" id="5892064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892068">if</span>&nbsp;<span class="ident" id="5892071">i</span>&nbsp;<span class="op" id="5892073">&lt;</span>&nbsp;<span class="builtinfunc" id="5892075">len</span><span class="op" id="5892078">(</span><span class="ident" id="5892079">p</span><span class="op" id="5892080">)</span>&nbsp;<span class="op" id="5892082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892087">r</span><span class="op" id="5892088">,</span>&nbsp;<span class="ident" id="5892090">g</span><span class="op" id="5892091">,</span>&nbsp;<span class="ident" id="5892093">b</span><span class="op" id="5892094">,</span>&nbsp;<span class="ident" id="5892096">_</span>&nbsp;<span class="op" id="5892098">:=</span>&nbsp;<span class="ident" id="5892101">p</span><span class="op" id="5892102">[</span><span class="ident" id="5892103">i</span><span class="op" id="5892104">]</span><span class="op" id="5892105">.</span><span class="ident" id="5892106">RGBA</span><span class="op" id="5892110">(</span><span class="op" id="5892111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892116">e</span><span class="op" id="5892117">.</span><span class="ident" id="5892118">buf</span><span class="op" id="5892121">[</span><span class="num" id="5892122">3</span><span class="op" id="5892123">*</span><span class="ident" id="5892124">i</span><span class="op" id="5892125">+</span><span class="num" id="5892126">0</span><span class="op" id="5892127">]</span>&nbsp;<span class="op" id="5892129">=</span>&nbsp;<span class="builtintype" id="5892131">uint8</span><span class="op" id="5892136">(</span><span class="ident" id="5892137">r</span>&nbsp;<span class="op" id="5892139">&gt;&gt;</span>&nbsp;<span class="num" id="5892142">8</span><span class="op" id="5892143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892148">e</span><span class="op" id="5892149">.</span><span class="ident" id="5892150">buf</span><span class="op" id="5892153">[</span><span class="num" id="5892154">3</span><span class="op" id="5892155">*</span><span class="ident" id="5892156">i</span><span class="op" id="5892157">+</span><span class="num" id="5892158">1</span><span class="op" id="5892159">]</span>&nbsp;<span class="op" id="5892161">=</span>&nbsp;<span class="builtintype" id="5892163">uint8</span><span class="op" id="5892168">(</span><span class="ident" id="5892169">g</span>&nbsp;<span class="op" id="5892171">&gt;&gt;</span>&nbsp;<span class="num" id="5892174">8</span><span class="op" id="5892175">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892180">e</span><span class="op" id="5892181">.</span><span class="ident" id="5892182">buf</span><span class="op" id="5892185">[</span><span class="num" id="5892186">3</span><span class="op" id="5892187">*</span><span class="ident" id="5892188">i</span><span class="op" id="5892189">+</span><span class="num" id="5892190">2</span><span class="op" id="5892191">]</span>&nbsp;<span class="op" id="5892193">=</span>&nbsp;<span class="builtintype" id="5892195">uint8</span><span class="op" id="5892200">(</span><span class="ident" id="5892201">b</span>&nbsp;<span class="op" id="5892203">&gt;&gt;</span>&nbsp;<span class="num" id="5892206">8</span><span class="op" id="5892207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5892211">}</span>&nbsp;<span class="keyword" id="5892213">else</span>&nbsp;<span class="op" id="5892218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5892223">//&nbsp;Pad&nbsp;with&nbsp;black.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892245">e</span><span class="op" id="5892246">.</span><span class="ident" id="5892247">buf</span><span class="op" id="5892250">[</span><span class="num" id="5892251">3</span><span class="op" id="5892252">*</span><span class="ident" id="5892253">i</span><span class="op" id="5892254">+</span><span class="num" id="5892255">0</span><span class="op" id="5892256">]</span>&nbsp;<span class="op" id="5892258">=</span>&nbsp;<span class="num" id="5892260">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892268">e</span><span class="op" id="5892269">.</span><span class="ident" id="5892270">buf</span><span class="op" id="5892273">[</span><span class="num" id="5892274">3</span><span class="op" id="5892275">*</span><span class="ident" id="5892276">i</span><span class="op" id="5892277">+</span><span class="num" id="5892278">1</span><span class="op" id="5892279">]</span>&nbsp;<span class="op" id="5892281">=</span>&nbsp;<span class="num" id="5892283">0x00</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892291">e</span><span class="op" id="5892292">.</span><span class="ident" id="5892293">buf</span><span class="op" id="5892296">[</span><span class="num" id="5892297">3</span><span class="op" id="5892298">*</span><span class="ident" id="5892299">i</span><span class="op" id="5892300">+</span><span class="num" id="5892301">2</span><span class="op" id="5892302">]</span>&nbsp;<span class="op" id="5892304">=</span>&nbsp;<span class="num" id="5892306">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5892313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5892316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892319">e</span><span class="op" id="5892320">.</span><span class="ident" id="5892321">write</span><span class="op" id="5892326">(</span><span class="ident" id="5892327">e</span><span class="op" id="5892328">.</span><span class="ident" id="5892329">buf</span><span class="op" id="5892332">[</span><span class="op" id="5892333">:</span><span class="num" id="5892334">3</span><span class="op" id="5892335">*</span><span class="ident" id="5892336">log2Lookup</span><span class="op" id="5892346">[</span><span class="ident" id="5892347">size</span><span class="op" id="5892351">]</span><span class="op" id="5892352">]</span><span class="op" id="5892353">)</span><br>
<span class="lineno"></span><span class="op" id="5892355">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5892358">func</span>&nbsp;<span class="op" id="5892363">(</span><span class="ident" id="5892364">e</span>&nbsp;<span class="op" id="5892366">*</span><span class="ident" id="5892367">encoder</span><span class="op" id="5892374">)</span>&nbsp;<span class="ident" id="5892376">writeImageBlock</span><span class="op" id="5892391">(</span><span class="ident" id="5892392">pm</span>&nbsp;<span class="op" id="5892395">*</span><span class="ident" id="5892396">image</span><span class="op" id="5892401">.</span><span class="ident" id="5892402">Paletted</span><span class="op" id="5892410">,</span>&nbsp;<span class="ident" id="5892412">delay</span>&nbsp;<span class="builtintype" id="5892418">int</span><span class="op" id="5892421">)</span>&nbsp;<span class="op" id="5892423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892426">if</span>&nbsp;<span class="ident" id="5892429">e</span><span class="op" id="5892430">.</span><span class="ident" id="5892431">err</span>&nbsp;<span class="op" id="5892435">!=</span>&nbsp;<span class="builtintype" id="5892438">nil</span>&nbsp;<span class="op" id="5892442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892446">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5892454">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892458">if</span>&nbsp;<span class="builtinfunc" id="5892461">len</span><span class="op" id="5892464">(</span><span class="ident" id="5892465">pm</span><span class="op" id="5892467">.</span><span class="ident" id="5892468">Palette</span><span class="op" id="5892475">)</span>&nbsp;<span class="op" id="5892477">==</span>&nbsp;<span class="num" id="5892480">0</span>&nbsp;<span class="op" id="5892482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892486">e</span><span class="op" id="5892487">.</span><span class="ident" id="5892488">err</span>&nbsp;<span class="op" id="5892492">=</span>&nbsp;<span class="ident" id="5892494">errors</span><span class="op" id="5892500">.</span><span class="ident" id="5892501">New</span><span class="op" id="5892504">(</span><span class="string" id="5892505">&#34;gif:&nbsp;cannot&nbsp;encode&nbsp;image&nbsp;block&nbsp;with&nbsp;empty&nbsp;palette&#34;</span><span class="op" id="5892556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892560">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5892568">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892572">b</span>&nbsp;<span class="op" id="5892574">:=</span>&nbsp;<span class="ident" id="5892577">pm</span><span class="op" id="5892579">.</span><span class="ident" id="5892580">Bounds</span><span class="op" id="5892586">(</span><span class="op" id="5892587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892590">if</span>&nbsp;<span class="ident" id="5892593">b</span><span class="op" id="5892594">.</span><span class="ident" id="5892595">Dx</span><span class="op" id="5892597">(</span><span class="op" id="5892598">)</span>&nbsp;<span class="op" id="5892600">&gt;=</span>&nbsp;<span class="num" id="5892603">1</span><span class="op" id="5892604">&lt;&lt;</span><span class="num" id="5892606">16</span>&nbsp;<span class="op" id="5892609">||</span>&nbsp;<span class="ident" id="5892612">b</span><span class="op" id="5892613">.</span><span class="ident" id="5892614">Dy</span><span class="op" id="5892616">(</span><span class="op" id="5892617">)</span>&nbsp;<span class="op" id="5892619">&gt;=</span>&nbsp;<span class="num" id="5892622">1</span><span class="op" id="5892623">&lt;&lt;</span><span class="num" id="5892625">16</span>&nbsp;<span class="op" id="5892628">||</span>&nbsp;<span class="ident" id="5892631">b</span><span class="op" id="5892632">.</span><span class="ident" id="5892633">Min</span><span class="op" id="5892636">.</span><span class="ident" id="5892637">X</span>&nbsp;<span class="op" id="5892639">&lt;</span>&nbsp;<span class="num" id="5892641">0</span>&nbsp;<span class="op" id="5892643">||</span>&nbsp;<span class="ident" id="5892646">b</span><span class="op" id="5892647">.</span><span class="ident" id="5892648">Min</span><span class="op" id="5892651">.</span><span class="ident" id="5892652">X</span>&nbsp;<span class="op" id="5892654">&gt;=</span>&nbsp;<span class="num" id="5892657">1</span><span class="op" id="5892658">&lt;&lt;</span><span class="num" id="5892660">16</span>&nbsp;<span class="op" id="5892663">||</span>&nbsp;<span class="ident" id="5892666">b</span><span class="op" id="5892667">.</span><span class="ident" id="5892668">Min</span><span class="op" id="5892671">.</span><span class="ident" id="5892672">Y</span>&nbsp;<span class="op" id="5892674">&lt;</span>&nbsp;<span class="num" id="5892676">0</span>&nbsp;<span class="op" id="5892678">||</span>&nbsp;<span class="ident" id="5892681">b</span><span class="op" id="5892682">.</span><span class="ident" id="5892683">Min</span><span class="op" id="5892686">.</span><span class="ident" id="5892687">Y</span>&nbsp;<span class="op" id="5892689">&gt;=</span>&nbsp;<span class="num" id="5892692">1</span><span class="op" id="5892693">&lt;&lt;</span><span class="num" id="5892695">16</span>&nbsp;<span class="op" id="5892698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892702">e</span><span class="op" id="5892703">.</span><span class="ident" id="5892704">err</span>&nbsp;<span class="op" id="5892708">=</span>&nbsp;<span class="ident" id="5892710">errors</span><span class="op" id="5892716">.</span><span class="ident" id="5892717">New</span><span class="op" id="5892720">(</span><span class="string" id="5892721">&#34;gif:&nbsp;image&nbsp;block&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5892762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892766">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5892774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892778">transparentIndex</span>&nbsp;<span class="op" id="5892795">:=</span>&nbsp;<span class="op" id="5892798">-</span><span class="num" id="5892799">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892802">for</span>&nbsp;<span class="ident" id="5892806">i</span><span class="op" id="5892807">,</span>&nbsp;<span class="ident" id="5892809">c</span>&nbsp;<span class="op" id="5892811">:=</span>&nbsp;<span class="keyword" id="5892814">range</span>&nbsp;<span class="ident" id="5892820">pm</span><span class="op" id="5892822">.</span><span class="ident" id="5892823">Palette</span>&nbsp;<span class="op" id="5892831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892835">if</span>&nbsp;<span class="ident" id="5892838">_</span><span class="op" id="5892839">,</span>&nbsp;<span class="ident" id="5892841">_</span><span class="op" id="5892842">,</span>&nbsp;<span class="ident" id="5892844">_</span><span class="op" id="5892845">,</span>&nbsp;<span class="ident" id="5892847">a</span>&nbsp;<span class="op" id="5892849">:=</span>&nbsp;<span class="ident" id="5892852">c</span><span class="op" id="5892853">.</span><span class="ident" id="5892854">RGBA</span><span class="op" id="5892858">(</span><span class="op" id="5892859">)</span><span class="op" id="5892860">;</span>&nbsp;<span class="ident" id="5892862">a</span>&nbsp;<span class="op" id="5892864">==</span>&nbsp;<span class="num" id="5892867">0</span>&nbsp;<span class="op" id="5892869">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892874">transparentIndex</span>&nbsp;<span class="op" id="5892891">=</span>&nbsp;<span class="ident" id="5892893">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892898">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5892906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5892909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5892913">if</span>&nbsp;<span class="ident" id="5892916">delay</span>&nbsp;<span class="op" id="5892922">&gt;</span>&nbsp;<span class="num" id="5892924">0</span>&nbsp;<span class="op" id="5892926">||</span>&nbsp;<span class="ident" id="5892929">transparentIndex</span>&nbsp;<span class="op" id="5892946">!=</span>&nbsp;<span class="op" id="5892949">-</span><span class="num" id="5892950">1</span>&nbsp;<span class="op" id="5892952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5892956">e</span><span class="op" id="5892957">.</span><span class="ident" id="5892958">buf</span><span class="op" id="5892961">[</span><span class="num" id="5892962">0</span><span class="op" id="5892963">]</span>&nbsp;<span class="op" id="5892965">=</span>&nbsp;<span class="ident" id="5892967">sExtension</span>&nbsp;&nbsp;<span class="comment" id="5892979">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893006">e</span><span class="op" id="5893007">.</span><span class="ident" id="5893008">buf</span><span class="op" id="5893011">[</span><span class="num" id="5893012">1</span><span class="op" id="5893013">]</span>&nbsp;<span class="op" id="5893015">=</span>&nbsp;<span class="ident" id="5893017">gcLabel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5893029">//&nbsp;Graphic&nbsp;Control&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893057">e</span><span class="op" id="5893058">.</span><span class="ident" id="5893059">buf</span><span class="op" id="5893062">[</span><span class="num" id="5893063">2</span><span class="op" id="5893064">]</span>&nbsp;<span class="op" id="5893066">=</span>&nbsp;<span class="ident" id="5893068">gcBlockSize</span>&nbsp;<span class="comment" id="5893080">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5893097">if</span>&nbsp;<span class="ident" id="5893100">transparentIndex</span>&nbsp;<span class="op" id="5893117">!=</span>&nbsp;<span class="op" id="5893120">-</span><span class="num" id="5893121">1</span>&nbsp;<span class="op" id="5893123">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893128">e</span><span class="op" id="5893129">.</span><span class="ident" id="5893130">buf</span><span class="op" id="5893133">[</span><span class="num" id="5893134">3</span><span class="op" id="5893135">]</span>&nbsp;<span class="op" id="5893137">=</span>&nbsp;<span class="num" id="5893139">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893146">}</span>&nbsp;<span class="keyword" id="5893148">else</span>&nbsp;<span class="op" id="5893153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893158">e</span><span class="op" id="5893159">.</span><span class="ident" id="5893160">buf</span><span class="op" id="5893163">[</span><span class="num" id="5893164">3</span><span class="op" id="5893165">]</span>&nbsp;<span class="op" id="5893167">=</span>&nbsp;<span class="num" id="5893169">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893180">writeUint16</span><span class="op" id="5893191">(</span><span class="ident" id="5893192">e</span><span class="op" id="5893193">.</span><span class="ident" id="5893194">buf</span><span class="op" id="5893197">[</span><span class="num" id="5893198">4</span><span class="op" id="5893199">:</span><span class="num" id="5893200">6</span><span class="op" id="5893201">]</span><span class="op" id="5893202">,</span>&nbsp;<span class="builtintype" id="5893204">uint16</span><span class="op" id="5893210">(</span><span class="ident" id="5893211">delay</span><span class="op" id="5893216">)</span><span class="op" id="5893217">)</span>&nbsp;<span class="comment" id="5893219">//&nbsp;Delay&nbsp;Time&nbsp;(1/100ths&nbsp;of&nbsp;a&nbsp;second)</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5893259">//&nbsp;Transparent&nbsp;color&nbsp;index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5893289">if</span>&nbsp;<span class="ident" id="5893292">transparentIndex</span>&nbsp;<span class="op" id="5893309">!=</span>&nbsp;<span class="op" id="5893312">-</span><span class="num" id="5893313">1</span>&nbsp;<span class="op" id="5893315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893320">e</span><span class="op" id="5893321">.</span><span class="ident" id="5893322">buf</span><span class="op" id="5893325">[</span><span class="num" id="5893326">6</span><span class="op" id="5893327">]</span>&nbsp;<span class="op" id="5893329">=</span>&nbsp;<span class="builtintype" id="5893331">uint8</span><span class="op" id="5893336">(</span><span class="ident" id="5893337">transparentIndex</span><span class="op" id="5893353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893357">}</span>&nbsp;<span class="keyword" id="5893359">else</span>&nbsp;<span class="op" id="5893364">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893369">e</span><span class="op" id="5893370">.</span><span class="ident" id="5893371">buf</span><span class="op" id="5893374">[</span><span class="num" id="5893375">6</span><span class="op" id="5893376">]</span>&nbsp;<span class="op" id="5893378">=</span>&nbsp;<span class="num" id="5893380">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893391">e</span><span class="op" id="5893392">.</span><span class="ident" id="5893393">buf</span><span class="op" id="5893396">[</span><span class="num" id="5893397">7</span><span class="op" id="5893398">]</span>&nbsp;<span class="op" id="5893400">=</span>&nbsp;<span class="num" id="5893402">0x00</span>&nbsp;<span class="comment" id="5893407">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893430">e</span><span class="op" id="5893431">.</span><span class="ident" id="5893432">write</span><span class="op" id="5893437">(</span><span class="ident" id="5893438">e</span><span class="op" id="5893439">.</span><span class="ident" id="5893440">buf</span><span class="op" id="5893443">[</span><span class="op" id="5893444">:</span><span class="num" id="5893445">8</span><span class="op" id="5893446">]</span><span class="op" id="5893447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893450">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893453">e</span><span class="op" id="5893454">.</span><span class="ident" id="5893455">buf</span><span class="op" id="5893458">[</span><span class="num" id="5893459">0</span><span class="op" id="5893460">]</span>&nbsp;<span class="op" id="5893462">=</span>&nbsp;<span class="ident" id="5893464">sImageDescriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893482">writeUint16</span><span class="op" id="5893493">(</span><span class="ident" id="5893494">e</span><span class="op" id="5893495">.</span><span class="ident" id="5893496">buf</span><span class="op" id="5893499">[</span><span class="num" id="5893500">1</span><span class="op" id="5893501">:</span><span class="num" id="5893502">3</span><span class="op" id="5893503">]</span><span class="op" id="5893504">,</span>&nbsp;<span class="builtintype" id="5893506">uint16</span><span class="op" id="5893512">(</span><span class="ident" id="5893513">b</span><span class="op" id="5893514">.</span><span class="ident" id="5893515">Min</span><span class="op" id="5893518">.</span><span class="ident" id="5893519">X</span><span class="op" id="5893520">)</span><span class="op" id="5893521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893524">writeUint16</span><span class="op" id="5893535">(</span><span class="ident" id="5893536">e</span><span class="op" id="5893537">.</span><span class="ident" id="5893538">buf</span><span class="op" id="5893541">[</span><span class="num" id="5893542">3</span><span class="op" id="5893543">:</span><span class="num" id="5893544">5</span><span class="op" id="5893545">]</span><span class="op" id="5893546">,</span>&nbsp;<span class="builtintype" id="5893548">uint16</span><span class="op" id="5893554">(</span><span class="ident" id="5893555">b</span><span class="op" id="5893556">.</span><span class="ident" id="5893557">Min</span><span class="op" id="5893560">.</span><span class="ident" id="5893561">Y</span><span class="op" id="5893562">)</span><span class="op" id="5893563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893566">writeUint16</span><span class="op" id="5893577">(</span><span class="ident" id="5893578">e</span><span class="op" id="5893579">.</span><span class="ident" id="5893580">buf</span><span class="op" id="5893583">[</span><span class="num" id="5893584">5</span><span class="op" id="5893585">:</span><span class="num" id="5893586">7</span><span class="op" id="5893587">]</span><span class="op" id="5893588">,</span>&nbsp;<span class="builtintype" id="5893590">uint16</span><span class="op" id="5893596">(</span><span class="ident" id="5893597">b</span><span class="op" id="5893598">.</span><span class="ident" id="5893599">Dx</span><span class="op" id="5893601">(</span><span class="op" id="5893602">)</span><span class="op" id="5893603">)</span><span class="op" id="5893604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893607">writeUint16</span><span class="op" id="5893618">(</span><span class="ident" id="5893619">e</span><span class="op" id="5893620">.</span><span class="ident" id="5893621">buf</span><span class="op" id="5893624">[</span><span class="num" id="5893625">7</span><span class="op" id="5893626">:</span><span class="num" id="5893627">9</span><span class="op" id="5893628">]</span><span class="op" id="5893629">,</span>&nbsp;<span class="builtintype" id="5893631">uint16</span><span class="op" id="5893637">(</span><span class="ident" id="5893638">b</span><span class="op" id="5893639">.</span><span class="ident" id="5893640">Dy</span><span class="op" id="5893642">(</span><span class="op" id="5893643">)</span><span class="op" id="5893644">)</span><span class="op" id="5893645">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893648">e</span><span class="op" id="5893649">.</span><span class="ident" id="5893650">write</span><span class="op" id="5893655">(</span><span class="ident" id="5893656">e</span><span class="op" id="5893657">.</span><span class="ident" id="5893658">buf</span><span class="op" id="5893661">[</span><span class="op" id="5893662">:</span><span class="num" id="5893663">9</span><span class="op" id="5893664">]</span><span class="op" id="5893665">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893669">paddedSize</span>&nbsp;<span class="op" id="5893680">:=</span>&nbsp;<span class="ident" id="5893683">log2</span><span class="op" id="5893687">(</span><span class="builtinfunc" id="5893688">len</span><span class="op" id="5893691">(</span><span class="ident" id="5893692">pm</span><span class="op" id="5893694">.</span><span class="ident" id="5893695">Palette</span><span class="op" id="5893702">)</span><span class="op" id="5893703">)</span>&nbsp;<span class="comment" id="5893705">//&nbsp;Size&nbsp;of&nbsp;Local&nbsp;Color&nbsp;Table:&nbsp;2^(1+n).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5893745">//&nbsp;Interlacing&nbsp;is&nbsp;not&nbsp;supported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893779">e</span><span class="op" id="5893780">.</span><span class="ident" id="5893781">writeByte</span><span class="op" id="5893790">(</span><span class="num" id="5893791">0x80</span>&nbsp;<span class="op" id="5893796">|</span>&nbsp;<span class="builtintype" id="5893798">uint8</span><span class="op" id="5893803">(</span><span class="ident" id="5893804">paddedSize</span><span class="op" id="5893814">)</span><span class="op" id="5893815">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5893819">//&nbsp;Local&nbsp;Color&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893842">e</span><span class="op" id="5893843">.</span><span class="ident" id="5893844">writeColorTable</span><span class="op" id="5893859">(</span><span class="ident" id="5893860">pm</span><span class="op" id="5893862">.</span><span class="ident" id="5893863">Palette</span><span class="op" id="5893870">,</span>&nbsp;<span class="ident" id="5893872">paddedSize</span><span class="op" id="5893882">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893886">litWidth</span>&nbsp;<span class="op" id="5893895">:=</span>&nbsp;<span class="ident" id="5893898">paddedSize</span>&nbsp;<span class="op" id="5893909">+</span>&nbsp;<span class="num" id="5893911">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5893914">if</span>&nbsp;<span class="ident" id="5893917">litWidth</span>&nbsp;<span class="op" id="5893926">&lt;</span>&nbsp;<span class="num" id="5893928">2</span>&nbsp;<span class="op" id="5893930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893934">litWidth</span>&nbsp;<span class="op" id="5893943">=</span>&nbsp;<span class="num" id="5893945">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5893948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893951">e</span><span class="op" id="5893952">.</span><span class="ident" id="5893953">writeByte</span><span class="op" id="5893962">(</span><span class="builtintype" id="5893963">uint8</span><span class="op" id="5893968">(</span><span class="ident" id="5893969">litWidth</span><span class="op" id="5893977">)</span><span class="op" id="5893978">)</span>&nbsp;<span class="comment" id="5893980">//&nbsp;LZW&nbsp;Minimum&nbsp;Code&nbsp;Size.</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894008">lzww</span>&nbsp;<span class="op" id="5894013">:=</span>&nbsp;<span class="ident" id="5894016">lzw</span><span class="op" id="5894019">.</span><span class="ident" id="5894020">NewWriter</span><span class="op" id="5894029">(</span><span class="ident" id="5894030">blockWriter</span><span class="op" id="5894041">{</span><span class="ident" id="5894042">e</span><span class="op" id="5894043">:</span>&nbsp;<span class="ident" id="5894045">e</span><span class="op" id="5894046">}</span><span class="op" id="5894047">,</span>&nbsp;<span class="ident" id="5894049">lzw</span><span class="op" id="5894052">.</span><span class="ident" id="5894053">LSB</span><span class="op" id="5894056">,</span>&nbsp;<span class="ident" id="5894058">litWidth</span><span class="op" id="5894066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894069">if</span>&nbsp;<span class="ident" id="5894072">dx</span>&nbsp;<span class="op" id="5894075">:=</span>&nbsp;<span class="ident" id="5894078">b</span><span class="op" id="5894079">.</span><span class="ident" id="5894080">Dx</span><span class="op" id="5894082">(</span><span class="op" id="5894083">)</span><span class="op" id="5894084">;</span>&nbsp;<span class="ident" id="5894086">dx</span>&nbsp;<span class="op" id="5894089">==</span>&nbsp;<span class="ident" id="5894092">pm</span><span class="op" id="5894094">.</span><span class="ident" id="5894095">Stride</span>&nbsp;<span class="op" id="5894102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894106">_</span><span class="op" id="5894107">,</span>&nbsp;<span class="ident" id="5894109">e</span><span class="op" id="5894110">.</span><span class="ident" id="5894111">err</span>&nbsp;<span class="op" id="5894115">=</span>&nbsp;<span class="ident" id="5894117">lzww</span><span class="op" id="5894121">.</span><span class="ident" id="5894122">Write</span><span class="op" id="5894127">(</span><span class="ident" id="5894128">pm</span><span class="op" id="5894130">.</span><span class="ident" id="5894131">Pix</span><span class="op" id="5894134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894138">if</span>&nbsp;<span class="ident" id="5894141">e</span><span class="op" id="5894142">.</span><span class="ident" id="5894143">err</span>&nbsp;<span class="op" id="5894147">!=</span>&nbsp;<span class="builtintype" id="5894150">nil</span>&nbsp;<span class="op" id="5894154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894159">lzww</span><span class="op" id="5894163">.</span><span class="ident" id="5894164">Close</span><span class="op" id="5894169">(</span><span class="op" id="5894170">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894175">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5894184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5894187">}</span>&nbsp;<span class="keyword" id="5894189">else</span>&nbsp;<span class="op" id="5894194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894198">for</span>&nbsp;<span class="ident" id="5894202">i</span><span class="op" id="5894203">,</span>&nbsp;<span class="ident" id="5894205">y</span>&nbsp;<span class="op" id="5894207">:=</span>&nbsp;<span class="num" id="5894210">0</span><span class="op" id="5894211">,</span>&nbsp;<span class="ident" id="5894213">b</span><span class="op" id="5894214">.</span><span class="ident" id="5894215">Min</span><span class="op" id="5894218">.</span><span class="ident" id="5894219">Y</span><span class="op" id="5894220">;</span>&nbsp;<span class="ident" id="5894222">y</span>&nbsp;<span class="op" id="5894224">&lt;</span>&nbsp;<span class="ident" id="5894226">b</span><span class="op" id="5894227">.</span><span class="ident" id="5894228">Max</span><span class="op" id="5894231">.</span><span class="ident" id="5894232">Y</span><span class="op" id="5894233">;</span>&nbsp;<span class="ident" id="5894235">i</span><span class="op" id="5894236">,</span>&nbsp;<span class="ident" id="5894238">y</span>&nbsp;<span class="op" id="5894240">=</span>&nbsp;<span class="ident" id="5894242">i</span><span class="op" id="5894243">+</span><span class="ident" id="5894244">pm</span><span class="op" id="5894246">.</span><span class="ident" id="5894247">Stride</span><span class="op" id="5894253">,</span>&nbsp;<span class="ident" id="5894255">y</span><span class="op" id="5894256">+</span><span class="num" id="5894257">1</span>&nbsp;<span class="op" id="5894259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894264">_</span><span class="op" id="5894265">,</span>&nbsp;<span class="ident" id="5894267">e</span><span class="op" id="5894268">.</span><span class="ident" id="5894269">err</span>&nbsp;<span class="op" id="5894273">=</span>&nbsp;<span class="ident" id="5894275">lzww</span><span class="op" id="5894279">.</span><span class="ident" id="5894280">Write</span><span class="op" id="5894285">(</span><span class="ident" id="5894286">pm</span><span class="op" id="5894288">.</span><span class="ident" id="5894289">Pix</span><span class="op" id="5894292">[</span><span class="ident" id="5894293">i</span>&nbsp;<span class="op" id="5894295">:</span>&nbsp;<span class="ident" id="5894297">i</span><span class="op" id="5894298">+</span><span class="ident" id="5894299">dx</span><span class="op" id="5894301">]</span><span class="op" id="5894302">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894307">if</span>&nbsp;<span class="ident" id="5894310">e</span><span class="op" id="5894311">.</span><span class="ident" id="5894312">err</span>&nbsp;<span class="op" id="5894316">!=</span>&nbsp;<span class="builtintype" id="5894319">nil</span>&nbsp;<span class="op" id="5894323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894329">lzww</span><span class="op" id="5894333">.</span><span class="ident" id="5894334">Close</span><span class="op" id="5894339">(</span><span class="op" id="5894340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5894346">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5894356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5894360">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5894363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894366">lzww</span><span class="op" id="5894370">.</span><span class="ident" id="5894371">Close</span><span class="op" id="5894376">(</span><span class="op" id="5894377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894380">e</span><span class="op" id="5894381">.</span><span class="ident" id="5894382">writeByte</span><span class="op" id="5894391">(</span><span class="num" id="5894392">0x00</span><span class="op" id="5894396">)</span>&nbsp;<span class="comment" id="5894398">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span><span class="op" id="5894419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="5894422">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="5894462">type</span>&nbsp;<span class="ident" id="5894467">Options</span>&nbsp;<span class="keyword" id="5894475">struct</span>&nbsp;<span class="op" id="5894482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894485">//&nbsp;NumColors&nbsp;is&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;colors&nbsp;used&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894550">//&nbsp;It&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;256.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894579">NumColors</span>&nbsp;<span class="builtintype" id="5894589">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894595">//&nbsp;Quantizer&nbsp;is&nbsp;used&nbsp;to&nbsp;produce&nbsp;a&nbsp;palette&nbsp;with&nbsp;size&nbsp;NumColors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894659">//&nbsp;palette.Plan9&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Quantizer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894714">Quantizer</span>&nbsp;<span class="ident" id="5894724">draw</span><span class="op" id="5894728">.</span><span class="ident" id="5894729">Quantizer</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894741">//&nbsp;Drawer&nbsp;is&nbsp;used&nbsp;to&nbsp;convert&nbsp;the&nbsp;source&nbsp;image&nbsp;to&nbsp;the&nbsp;desired&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894812">//&nbsp;draw.FloydSteinberg&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Drawer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5894870">Drawer</span>&nbsp;<span class="ident" id="5894877">draw</span><span class="op" id="5894881">.</span><span class="ident" id="5894882">Drawer</span><br>
<span class="lineno"></span><span class="op" id="5894889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5894892">//&nbsp;EncodeAll&nbsp;writes&nbsp;the&nbsp;images&nbsp;in&nbsp;g&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5894956">//&nbsp;given&nbsp;loop&nbsp;count&nbsp;and&nbsp;delay&nbsp;between&nbsp;frames.</span><br>
<span class="lineno"></span><span class="keyword" id="5895002">func</span>&nbsp;<span class="ident" id="5895007">EncodeAll</span><span class="op" id="5895016">(</span><span class="ident" id="5895017">w</span>&nbsp;<span class="ident" id="5895019">io</span><span class="op" id="5895021">.</span><span class="ident" id="5895022">Writer</span><span class="op" id="5895028">,</span>&nbsp;<span class="ident" id="5895030">g</span>&nbsp;<span class="op" id="5895032">*</span><span class="ident" id="5895033">GIF</span><span class="op" id="5895036">)</span>&nbsp;<span class="builtintype" id="5895038">error</span>&nbsp;<span class="op" id="5895044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895047">if</span>&nbsp;<span class="builtinfunc" id="5895050">len</span><span class="op" id="5895053">(</span><span class="ident" id="5895054">g</span><span class="op" id="5895055">.</span><span class="ident" id="5895056">Image</span><span class="op" id="5895061">)</span>&nbsp;<span class="op" id="5895063">==</span>&nbsp;<span class="num" id="5895066">0</span>&nbsp;<span class="op" id="5895068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895072">return</span>&nbsp;<span class="ident" id="5895079">errors</span><span class="op" id="5895085">.</span><span class="ident" id="5895086">New</span><span class="op" id="5895089">(</span><span class="string" id="5895090">&#34;gif:&nbsp;must&nbsp;provide&nbsp;at&nbsp;least&nbsp;one&nbsp;image&#34;</span><span class="op" id="5895128">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895135">if</span>&nbsp;<span class="builtinfunc" id="5895138">len</span><span class="op" id="5895141">(</span><span class="ident" id="5895142">g</span><span class="op" id="5895143">.</span><span class="ident" id="5895144">Image</span><span class="op" id="5895149">)</span>&nbsp;<span class="op" id="5895151">!=</span>&nbsp;<span class="builtinfunc" id="5895154">len</span><span class="op" id="5895157">(</span><span class="ident" id="5895158">g</span><span class="op" id="5895159">.</span><span class="ident" id="5895160">Delay</span><span class="op" id="5895165">)</span>&nbsp;<span class="op" id="5895167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895171">return</span>&nbsp;<span class="ident" id="5895178">errors</span><span class="op" id="5895184">.</span><span class="ident" id="5895185">New</span><span class="op" id="5895188">(</span><span class="string" id="5895189">&#34;gif:&nbsp;mismatched&nbsp;image&nbsp;and&nbsp;delay&nbsp;lengths&#34;</span><span class="op" id="5895230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895233">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895236">if</span>&nbsp;<span class="ident" id="5895239">g</span><span class="op" id="5895240">.</span><span class="ident" id="5895241">LoopCount</span>&nbsp;<span class="op" id="5895251">&lt;</span>&nbsp;<span class="num" id="5895253">0</span>&nbsp;<span class="op" id="5895255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895259">g</span><span class="op" id="5895260">.</span><span class="ident" id="5895261">LoopCount</span>&nbsp;<span class="op" id="5895271">=</span>&nbsp;<span class="num" id="5895273">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895280">e</span>&nbsp;<span class="op" id="5895282">:=</span>&nbsp;<span class="ident" id="5895285">encoder</span><span class="op" id="5895292">{</span><span class="ident" id="5895293">g</span><span class="op" id="5895294">:</span>&nbsp;<span class="ident" id="5895296">g</span><span class="op" id="5895297">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895300">if</span>&nbsp;<span class="ident" id="5895303">ww</span><span class="op" id="5895305">,</span>&nbsp;<span class="ident" id="5895307">ok</span>&nbsp;<span class="op" id="5895310">:=</span>&nbsp;<span class="ident" id="5895313">w</span><span class="op" id="5895314">.</span><span class="op" id="5895315">(</span><span class="ident" id="5895316">writer</span><span class="op" id="5895322">)</span><span class="op" id="5895323">;</span>&nbsp;<span class="ident" id="5895325">ok</span>&nbsp;<span class="op" id="5895328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895332">e</span><span class="op" id="5895333">.</span><span class="ident" id="5895334">w</span>&nbsp;<span class="op" id="5895336">=</span>&nbsp;<span class="ident" id="5895338">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895342">}</span>&nbsp;<span class="keyword" id="5895344">else</span>&nbsp;<span class="op" id="5895349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895353">e</span><span class="op" id="5895354">.</span><span class="ident" id="5895355">w</span>&nbsp;<span class="op" id="5895357">=</span>&nbsp;<span class="ident" id="5895359">bufio</span><span class="op" id="5895364">.</span><span class="ident" id="5895365">NewWriter</span><span class="op" id="5895374">(</span><span class="ident" id="5895375">w</span><span class="op" id="5895376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895379">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895383">e</span><span class="op" id="5895384">.</span><span class="ident" id="5895385">writeHeader</span><span class="op" id="5895396">(</span><span class="op" id="5895397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895400">for</span>&nbsp;<span class="ident" id="5895404">i</span><span class="op" id="5895405">,</span>&nbsp;<span class="ident" id="5895407">pm</span>&nbsp;<span class="op" id="5895410">:=</span>&nbsp;<span class="keyword" id="5895413">range</span>&nbsp;<span class="ident" id="5895419">g</span><span class="op" id="5895420">.</span><span class="ident" id="5895421">Image</span>&nbsp;<span class="op" id="5895427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895431">e</span><span class="op" id="5895432">.</span><span class="ident" id="5895433">writeImageBlock</span><span class="op" id="5895448">(</span><span class="ident" id="5895449">pm</span><span class="op" id="5895451">,</span>&nbsp;<span class="ident" id="5895453">g</span><span class="op" id="5895454">.</span><span class="ident" id="5895455">Delay</span><span class="op" id="5895460">[</span><span class="ident" id="5895461">i</span><span class="op" id="5895462">]</span><span class="op" id="5895463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895466">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895469">e</span><span class="op" id="5895470">.</span><span class="ident" id="5895471">writeByte</span><span class="op" id="5895480">(</span><span class="ident" id="5895481">sTrailer</span><span class="op" id="5895489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895492">e</span><span class="op" id="5895493">.</span><span class="ident" id="5895494">flush</span><span class="op" id="5895499">(</span><span class="op" id="5895500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895503">return</span>&nbsp;<span class="ident" id="5895510">e</span><span class="op" id="5895511">.</span><span class="ident" id="5895512">err</span><br>
<span class="lineno"></span><span class="op" id="5895516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="5895519">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5895568">func</span>&nbsp;<span class="ident" id="5895573">Encode</span><span class="op" id="5895579">(</span><span class="ident" id="5895580">w</span>&nbsp;<span class="ident" id="5895582">io</span><span class="op" id="5895584">.</span><span class="ident" id="5895585">Writer</span><span class="op" id="5895591">,</span>&nbsp;<span class="ident" id="5895593">m</span>&nbsp;<span class="ident" id="5895595">image</span><span class="op" id="5895600">.</span><span class="ident" id="5895601">Image</span><span class="op" id="5895606">,</span>&nbsp;<span class="ident" id="5895608">o</span>&nbsp;<span class="op" id="5895610">*</span><span class="ident" id="5895611">Options</span><span class="op" id="5895618">)</span>&nbsp;<span class="builtintype" id="5895620">error</span>&nbsp;<span class="op" id="5895626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895629">//&nbsp;Check&nbsp;for&nbsp;bounds&nbsp;and&nbsp;size&nbsp;restrictions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895673">b</span>&nbsp;<span class="op" id="5895675">:=</span>&nbsp;<span class="ident" id="5895678">m</span><span class="op" id="5895679">.</span><span class="ident" id="5895680">Bounds</span><span class="op" id="5895686">(</span><span class="op" id="5895687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895690">if</span>&nbsp;<span class="ident" id="5895693">b</span><span class="op" id="5895694">.</span><span class="ident" id="5895695">Dx</span><span class="op" id="5895697">(</span><span class="op" id="5895698">)</span>&nbsp;<span class="op" id="5895700">&gt;=</span>&nbsp;<span class="num" id="5895703">1</span><span class="op" id="5895704">&lt;&lt;</span><span class="num" id="5895706">16</span>&nbsp;<span class="op" id="5895709">||</span>&nbsp;<span class="ident" id="5895712">b</span><span class="op" id="5895713">.</span><span class="ident" id="5895714">Dy</span><span class="op" id="5895716">(</span><span class="op" id="5895717">)</span>&nbsp;<span class="op" id="5895719">&gt;=</span>&nbsp;<span class="num" id="5895722">1</span><span class="op" id="5895723">&lt;&lt;</span><span class="num" id="5895725">16</span>&nbsp;<span class="op" id="5895728">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895732">return</span>&nbsp;<span class="ident" id="5895739">errors</span><span class="op" id="5895745">.</span><span class="ident" id="5895746">New</span><span class="op" id="5895749">(</span><span class="string" id="5895750">&#34;gif:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5895785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895792">opts</span>&nbsp;<span class="op" id="5895797">:=</span>&nbsp;<span class="ident" id="5895800">Options</span><span class="op" id="5895807">{</span><span class="op" id="5895808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895811">if</span>&nbsp;<span class="ident" id="5895814">o</span>&nbsp;<span class="op" id="5895816">!=</span>&nbsp;<span class="builtintype" id="5895819">nil</span>&nbsp;<span class="op" id="5895823">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895827">opts</span>&nbsp;<span class="op" id="5895832">=</span>&nbsp;<span class="op" id="5895834">*</span><span class="ident" id="5895835">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895841">if</span>&nbsp;<span class="ident" id="5895844">opts</span><span class="op" id="5895848">.</span><span class="ident" id="5895849">NumColors</span>&nbsp;<span class="op" id="5895859">&lt;</span>&nbsp;<span class="num" id="5895861">1</span>&nbsp;<span class="op" id="5895863">||</span>&nbsp;<span class="num" id="5895866">256</span>&nbsp;<span class="op" id="5895870">&lt;</span>&nbsp;<span class="ident" id="5895872">opts</span><span class="op" id="5895876">.</span><span class="ident" id="5895877">NumColors</span>&nbsp;<span class="op" id="5895887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895891">opts</span><span class="op" id="5895895">.</span><span class="ident" id="5895896">NumColors</span>&nbsp;<span class="op" id="5895906">=</span>&nbsp;<span class="num" id="5895908">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895913">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5895916">if</span>&nbsp;<span class="ident" id="5895919">opts</span><span class="op" id="5895923">.</span><span class="ident" id="5895924">Drawer</span>&nbsp;<span class="op" id="5895931">==</span>&nbsp;<span class="builtintype" id="5895934">nil</span>&nbsp;<span class="op" id="5895938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895942">opts</span><span class="op" id="5895946">.</span><span class="ident" id="5895947">Drawer</span>&nbsp;<span class="op" id="5895954">=</span>&nbsp;<span class="ident" id="5895956">draw</span><span class="op" id="5895960">.</span><span class="ident" id="5895961">FloydSteinberg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5895977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5895981">pm</span><span class="op" id="5895983">,</span>&nbsp;<span class="ident" id="5895985">ok</span>&nbsp;<span class="op" id="5895988">:=</span>&nbsp;<span class="ident" id="5895991">m</span><span class="op" id="5895992">.</span><span class="op" id="5895993">(</span><span class="op" id="5895994">*</span><span class="ident" id="5895995">image</span><span class="op" id="5896000">.</span><span class="ident" id="5896001">Paletted</span><span class="op" id="5896009">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896012">if</span>&nbsp;<span class="op" id="5896015">!</span><span class="ident" id="5896016">ok</span>&nbsp;<span class="op" id="5896019">||</span>&nbsp;<span class="builtinfunc" id="5896022">len</span><span class="op" id="5896025">(</span><span class="ident" id="5896026">pm</span><span class="op" id="5896028">.</span><span class="ident" id="5896029">Palette</span><span class="op" id="5896036">)</span>&nbsp;<span class="op" id="5896038">&gt;</span>&nbsp;<span class="ident" id="5896040">opts</span><span class="op" id="5896044">.</span><span class="ident" id="5896045">NumColors</span>&nbsp;<span class="op" id="5896055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5896059">//&nbsp;TODO:&nbsp;Pick&nbsp;a&nbsp;better&nbsp;sub-sample&nbsp;of&nbsp;the&nbsp;Plan&nbsp;9&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5896118">pm</span>&nbsp;<span class="op" id="5896121">=</span>&nbsp;<span class="ident" id="5896123">image</span><span class="op" id="5896128">.</span><span class="ident" id="5896129">NewPaletted</span><span class="op" id="5896140">(</span><span class="ident" id="5896141">b</span><span class="op" id="5896142">,</span>&nbsp;<span class="ident" id="5896144">palette</span><span class="op" id="5896151">.</span><span class="ident" id="5896152">Plan9</span><span class="op" id="5896157">[</span><span class="op" id="5896158">:</span><span class="ident" id="5896159">opts</span><span class="op" id="5896163">.</span><span class="ident" id="5896164">NumColors</span><span class="op" id="5896173">]</span><span class="op" id="5896174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896178">if</span>&nbsp;<span class="ident" id="5896181">opts</span><span class="op" id="5896185">.</span><span class="ident" id="5896186">Quantizer</span>&nbsp;<span class="op" id="5896196">!=</span>&nbsp;<span class="builtintype" id="5896199">nil</span>&nbsp;<span class="op" id="5896203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5896208">pm</span><span class="op" id="5896210">.</span><span class="ident" id="5896211">Palette</span>&nbsp;<span class="op" id="5896219">=</span>&nbsp;<span class="ident" id="5896221">opts</span><span class="op" id="5896225">.</span><span class="ident" id="5896226">Quantizer</span><span class="op" id="5896235">.</span><span class="ident" id="5896236">Quantize</span><span class="op" id="5896244">(</span><span class="builtinfunc" id="5896245">make</span><span class="op" id="5896249">(</span><span class="ident" id="5896250">color</span><span class="op" id="5896255">.</span><span class="ident" id="5896256">Palette</span><span class="op" id="5896263">,</span>&nbsp;<span class="num" id="5896265">0</span><span class="op" id="5896266">,</span>&nbsp;<span class="ident" id="5896268">opts</span><span class="op" id="5896272">.</span><span class="ident" id="5896273">NumColors</span><span class="op" id="5896282">)</span><span class="op" id="5896283">,</span>&nbsp;<span class="ident" id="5896285">m</span><span class="op" id="5896286">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5896290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5896294">opts</span><span class="op" id="5896298">.</span><span class="ident" id="5896299">Drawer</span><span class="op" id="5896305">.</span><span class="ident" id="5896306">Draw</span><span class="op" id="5896310">(</span><span class="ident" id="5896311">pm</span><span class="op" id="5896313">,</span>&nbsp;<span class="ident" id="5896315">b</span><span class="op" id="5896316">,</span>&nbsp;<span class="ident" id="5896318">m</span><span class="op" id="5896319">,</span>&nbsp;<span class="ident" id="5896321">image</span><span class="op" id="5896326">.</span><span class="ident" id="5896327">ZP</span><span class="op" id="5896329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5896332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5896336">return</span>&nbsp;<span class="ident" id="5896343">EncodeAll</span><span class="op" id="5896352">(</span><span class="ident" id="5896353">w</span><span class="op" id="5896354">,</span>&nbsp;<span class="op" id="5896356">&amp;</span><span class="ident" id="5896357">GIF</span><span class="op" id="5896360">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5896364">Image</span><span class="op" id="5896369">:</span>&nbsp;<span class="op" id="5896371">[</span><span class="op" id="5896372">]</span><span class="op" id="5896373">*</span><span class="ident" id="5896374">image</span><span class="op" id="5896379">.</span><span class="ident" id="5896380">Paletted</span><span class="op" id="5896388">{</span><span class="ident" id="5896389">pm</span><span class="op" id="5896391">}</span><span class="op" id="5896392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5896396">Delay</span><span class="op" id="5896401">:</span>&nbsp;<span class="op" id="5896403">[</span><span class="op" id="5896404">]</span><span class="builtintype" id="5896405">int</span><span class="op" id="5896408">{</span><span class="num" id="5896409">0</span><span class="op" id="5896410">}</span><span class="op" id="5896411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5896414">}</span><span class="op" id="5896415">)</span><br>
<span class="lineno"></span><span class="op" id="5896417">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
