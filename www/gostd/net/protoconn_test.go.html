<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html" class="current">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6687381">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6687437">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6687491">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6687542">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="6687621">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6687630">package</span>&nbsp;<span class="ident" id="6687638">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6687643">import</span>&nbsp;<span class="op" id="6687650">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6687653">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6687666">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6687672">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6687683">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6687694">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6687701">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6687704">//&nbsp;testUnixAddr&nbsp;uses&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="6687774">//&nbsp;also&nbsp;uses&nbsp;/tmp&nbsp;directory&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;prohibited&nbsp;to&nbsp;create&nbsp;UNIX</span><br>
<span class="lineno">20</span><span class="comment" id="6687842">//&nbsp;sockets&nbsp;in&nbsp;TMPDIR.</span><br>
<span class="lineno"></span><span class="keyword" id="6687864">func</span>&nbsp;<span class="ident" id="6687869">testUnixAddr</span><span class="op" id="6687881">(</span><span class="op" id="6687882">)</span>&nbsp;<span class="builtintype" id="6687884">string</span>&nbsp;<span class="op" id="6687891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687894">f</span><span class="op" id="6687895">,</span>&nbsp;<span class="ident" id="6687897">err</span>&nbsp;<span class="op" id="6687901">:=</span>&nbsp;<span class="ident" id="6687904">ioutil</span><span class="op" id="6687910">.</span><span class="ident" id="6687911">TempFile</span><span class="op" id="6687919">(</span><span class="string" id="6687920">&#34;&#34;</span><span class="op" id="6687922">,</span>&nbsp;<span class="string" id="6687924">&#34;nettest&#34;</span><span class="op" id="6687933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6687936">if</span>&nbsp;<span class="ident" id="6687939">err</span>&nbsp;<span class="op" id="6687943">!=</span>&nbsp;<span class="ident" id="6687946">nil</span>&nbsp;<span class="op" id="6687950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6687954">panic</span><span class="op" id="6687959">(</span><span class="ident" id="6687960">err</span><span class="op" id="6687963">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6687966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687969">addr</span>&nbsp;<span class="op" id="6687974">:=</span>&nbsp;<span class="ident" id="6687977">f</span><span class="op" id="6687978">.</span><span class="ident" id="6687979">Name</span><span class="op" id="6687983">(</span><span class="op" id="6687984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687987">f</span><span class="op" id="6687988">.</span><span class="ident" id="6687989">Close</span><span class="op" id="6687994">(</span><span class="op" id="6687995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687998">os</span><span class="op" id="6688000">.</span><span class="ident" id="6688001">Remove</span><span class="op" id="6688007">(</span><span class="ident" id="6688008">addr</span><span class="op" id="6688012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688015">return</span>&nbsp;<span class="ident" id="6688022">addr</span><br>
<span class="lineno">30</span><span class="op" id="6688027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6688030">var</span>&nbsp;<span class="ident" id="6688034">condFatalf</span>&nbsp;<span class="op" id="6688045">=</span>&nbsp;<span class="keyword" id="6688047">func</span><span class="op" id="6688051">(</span><span class="op" id="6688052">)</span>&nbsp;<span class="keyword" id="6688054">func</span><span class="op" id="6688058">(</span><span class="op" id="6688059">*</span><span class="ident" id="6688060">testing</span><span class="op" id="6688067">.</span><span class="ident" id="6688068">T</span><span class="op" id="6688069">,</span>&nbsp;<span class="builtintype" id="6688071">string</span><span class="op" id="6688077">,</span>&nbsp;<span class="op" id="6688079">...</span><span class="keyword" id="6688082">interface</span><span class="op" id="6688091">{</span><span class="op" id="6688092">}</span><span class="op" id="6688093">)</span>&nbsp;<span class="op" id="6688095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6688098">//&nbsp;A&nbsp;few&nbsp;APIs&nbsp;are&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;on&nbsp;both&nbsp;Plan&nbsp;9&nbsp;and&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688165">switch</span>&nbsp;<span class="ident" id="6688172">runtime</span><span class="op" id="6688179">.</span><span class="ident" id="6688180">GOOS</span>&nbsp;<span class="op" id="6688185">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688188">case</span>&nbsp;<span class="string" id="6688193">&#34;plan9&#34;</span><span class="op" id="6688200">,</span>&nbsp;<span class="string" id="6688202">&#34;windows&#34;</span><span class="op" id="6688211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688215">return</span>&nbsp;<span class="op" id="6688222">(</span><span class="op" id="6688223">*</span><span class="ident" id="6688224">testing</span><span class="op" id="6688231">.</span><span class="ident" id="6688232">T</span><span class="op" id="6688233">)</span><span class="op" id="6688234">.</span><span class="ident" id="6688235">Logf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688244">return</span>&nbsp;<span class="op" id="6688251">(</span><span class="op" id="6688252">*</span><span class="ident" id="6688253">testing</span><span class="op" id="6688260">.</span><span class="ident" id="6688261">T</span><span class="op" id="6688262">)</span><span class="op" id="6688263">.</span><span class="ident" id="6688264">Fatalf</span><br>
<span class="lineno"></span><span class="op" id="6688271">}</span><span class="op" id="6688272">(</span><span class="op" id="6688273">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6688276">func</span>&nbsp;<span class="ident" id="6688281">TestTCPListenerSpecificMethods</span><span class="op" id="6688311">(</span><span class="ident" id="6688312">t</span>&nbsp;<span class="op" id="6688314">*</span><span class="ident" id="6688315">testing</span><span class="op" id="6688322">.</span><span class="ident" id="6688323">T</span><span class="op" id="6688324">)</span>&nbsp;<span class="op" id="6688326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688329">switch</span>&nbsp;<span class="ident" id="6688336">runtime</span><span class="op" id="6688343">.</span><span class="ident" id="6688344">GOOS</span>&nbsp;<span class="op" id="6688349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688352">case</span>&nbsp;<span class="string" id="6688357">&#34;plan9&#34;</span><span class="op" id="6688364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688368">t</span><span class="op" id="6688369">.</span><span class="ident" id="6688370">Skipf</span><span class="op" id="6688375">(</span><span class="string" id="6688376">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6688397">,</span>&nbsp;<span class="ident" id="6688399">runtime</span><span class="op" id="6688406">.</span><span class="ident" id="6688407">GOOS</span><span class="op" id="6688411">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688418">la</span><span class="op" id="6688420">,</span>&nbsp;<span class="ident" id="6688422">err</span>&nbsp;<span class="op" id="6688426">:=</span>&nbsp;<span class="ident" id="6688429">ResolveTCPAddr</span><span class="op" id="6688443">(</span><span class="string" id="6688444">&#34;tcp4&#34;</span><span class="op" id="6688450">,</span>&nbsp;<span class="string" id="6688452">&#34;127.0.0.1:0&#34;</span><span class="op" id="6688465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688468">if</span>&nbsp;<span class="ident" id="6688471">err</span>&nbsp;<span class="op" id="6688475">!=</span>&nbsp;<span class="ident" id="6688478">nil</span>&nbsp;<span class="op" id="6688482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688486">t</span><span class="op" id="6688487">.</span><span class="ident" id="6688488">Fatalf</span><span class="op" id="6688494">(</span><span class="string" id="6688495">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6688522">,</span>&nbsp;<span class="ident" id="6688524">err</span><span class="op" id="6688527">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688533">ln</span><span class="op" id="6688535">,</span>&nbsp;<span class="ident" id="6688537">err</span>&nbsp;<span class="op" id="6688541">:=</span>&nbsp;<span class="ident" id="6688544">ListenTCP</span><span class="op" id="6688553">(</span><span class="string" id="6688554">&#34;tcp4&#34;</span><span class="op" id="6688560">,</span>&nbsp;<span class="ident" id="6688562">la</span><span class="op" id="6688564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688567">if</span>&nbsp;<span class="ident" id="6688570">err</span>&nbsp;<span class="op" id="6688574">!=</span>&nbsp;<span class="ident" id="6688577">nil</span>&nbsp;<span class="op" id="6688581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688585">t</span><span class="op" id="6688586">.</span><span class="ident" id="6688587">Fatalf</span><span class="op" id="6688593">(</span><span class="string" id="6688594">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6688616">,</span>&nbsp;<span class="ident" id="6688618">err</span><span class="op" id="6688621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688624">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688627">defer</span>&nbsp;<span class="ident" id="6688633">ln</span><span class="op" id="6688635">.</span><span class="ident" id="6688636">Close</span><span class="op" id="6688641">(</span><span class="op" id="6688642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688645">ln</span><span class="op" id="6688647">.</span><span class="ident" id="6688648">Addr</span><span class="op" id="6688652">(</span><span class="op" id="6688653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688656">ln</span><span class="op" id="6688658">.</span><span class="ident" id="6688659">SetDeadline</span><span class="op" id="6688670">(</span><span class="ident" id="6688671">time</span><span class="op" id="6688675">.</span><span class="ident" id="6688676">Now</span><span class="op" id="6688679">(</span><span class="op" id="6688680">)</span><span class="op" id="6688681">.</span><span class="ident" id="6688682">Add</span><span class="op" id="6688685">(</span><span class="num" id="6688686">30</span>&nbsp;<span class="op" id="6688689">*</span>&nbsp;<span class="ident" id="6688691">time</span><span class="op" id="6688695">.</span><span class="ident" id="6688696">Nanosecond</span><span class="op" id="6688706">)</span><span class="op" id="6688707">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688711">if</span>&nbsp;<span class="ident" id="6688714">c</span><span class="op" id="6688715">,</span>&nbsp;<span class="ident" id="6688717">err</span>&nbsp;<span class="op" id="6688721">:=</span>&nbsp;<span class="ident" id="6688724">ln</span><span class="op" id="6688726">.</span><span class="ident" id="6688727">Accept</span><span class="op" id="6688733">(</span><span class="op" id="6688734">)</span><span class="op" id="6688735">;</span>&nbsp;<span class="ident" id="6688737">err</span>&nbsp;<span class="op" id="6688741">!=</span>&nbsp;<span class="ident" id="6688744">nil</span>&nbsp;<span class="op" id="6688748">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688752">if</span>&nbsp;<span class="op" id="6688755">!</span><span class="ident" id="6688756">err</span><span class="op" id="6688759">.</span><span class="op" id="6688760">(</span><span class="ident" id="6688761">Error</span><span class="op" id="6688766">)</span><span class="op" id="6688767">.</span><span class="ident" id="6688768">Timeout</span><span class="op" id="6688775">(</span><span class="op" id="6688776">)</span>&nbsp;<span class="op" id="6688778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688783">t</span><span class="op" id="6688784">.</span><span class="ident" id="6688785">Fatalf</span><span class="op" id="6688791">(</span><span class="string" id="6688792">&#34;TCPListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6688823">,</span>&nbsp;<span class="ident" id="6688825">err</span><span class="op" id="6688828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688835">}</span>&nbsp;<span class="keyword" id="6688837">else</span>&nbsp;<span class="op" id="6688842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688846">c</span><span class="op" id="6688847">.</span><span class="ident" id="6688848">Close</span><span class="op" id="6688853">(</span><span class="op" id="6688854">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688860">if</span>&nbsp;<span class="ident" id="6688863">c</span><span class="op" id="6688864">,</span>&nbsp;<span class="ident" id="6688866">err</span>&nbsp;<span class="op" id="6688870">:=</span>&nbsp;<span class="ident" id="6688873">ln</span><span class="op" id="6688875">.</span><span class="ident" id="6688876">AcceptTCP</span><span class="op" id="6688885">(</span><span class="op" id="6688886">)</span><span class="op" id="6688887">;</span>&nbsp;<span class="ident" id="6688889">err</span>&nbsp;<span class="op" id="6688893">!=</span>&nbsp;<span class="ident" id="6688896">nil</span>&nbsp;<span class="op" id="6688900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688904">if</span>&nbsp;<span class="op" id="6688907">!</span><span class="ident" id="6688908">err</span><span class="op" id="6688911">.</span><span class="op" id="6688912">(</span><span class="ident" id="6688913">Error</span><span class="op" id="6688918">)</span><span class="op" id="6688919">.</span><span class="ident" id="6688920">Timeout</span><span class="op" id="6688927">(</span><span class="op" id="6688928">)</span>&nbsp;<span class="op" id="6688930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688935">t</span><span class="op" id="6688936">.</span><span class="ident" id="6688937">Fatalf</span><span class="op" id="6688943">(</span><span class="string" id="6688944">&#34;TCPListener.AcceptTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6688978">,</span>&nbsp;<span class="ident" id="6688980">err</span><span class="op" id="6688983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688987">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688990">}</span>&nbsp;<span class="keyword" id="6688992">else</span>&nbsp;<span class="op" id="6688997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689001">c</span><span class="op" id="6689002">.</span><span class="ident" id="6689003">Close</span><span class="op" id="6689008">(</span><span class="op" id="6689009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689016">if</span>&nbsp;<span class="ident" id="6689019">f</span><span class="op" id="6689020">,</span>&nbsp;<span class="ident" id="6689022">err</span>&nbsp;<span class="op" id="6689026">:=</span>&nbsp;<span class="ident" id="6689029">ln</span><span class="op" id="6689031">.</span><span class="ident" id="6689032">File</span><span class="op" id="6689036">(</span><span class="op" id="6689037">)</span><span class="op" id="6689038">;</span>&nbsp;<span class="ident" id="6689040">err</span>&nbsp;<span class="op" id="6689044">!=</span>&nbsp;<span class="ident" id="6689047">nil</span>&nbsp;<span class="op" id="6689051">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689055">condFatalf</span><span class="op" id="6689065">(</span><span class="ident" id="6689066">t</span><span class="op" id="6689067">,</span>&nbsp;<span class="string" id="6689069">&#34;TCPListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6689098">,</span>&nbsp;<span class="ident" id="6689100">err</span><span class="op" id="6689103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689106">}</span>&nbsp;<span class="keyword" id="6689108">else</span>&nbsp;<span class="op" id="6689113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689117">f</span><span class="op" id="6689118">.</span><span class="ident" id="6689119">Close</span><span class="op" id="6689124">(</span><span class="op" id="6689125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689128">}</span><br>
<span class="lineno"></span><span class="op" id="6689130">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6689133">func</span>&nbsp;<span class="ident" id="6689138">TestTCPConnSpecificMethods</span><span class="op" id="6689164">(</span><span class="ident" id="6689165">t</span>&nbsp;<span class="op" id="6689167">*</span><span class="ident" id="6689168">testing</span><span class="op" id="6689175">.</span><span class="ident" id="6689176">T</span><span class="op" id="6689177">)</span>&nbsp;<span class="op" id="6689179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689182">la</span><span class="op" id="6689184">,</span>&nbsp;<span class="ident" id="6689186">err</span>&nbsp;<span class="op" id="6689190">:=</span>&nbsp;<span class="ident" id="6689193">ResolveTCPAddr</span><span class="op" id="6689207">(</span><span class="string" id="6689208">&#34;tcp4&#34;</span><span class="op" id="6689214">,</span>&nbsp;<span class="string" id="6689216">&#34;127.0.0.1:0&#34;</span><span class="op" id="6689229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689232">if</span>&nbsp;<span class="ident" id="6689235">err</span>&nbsp;<span class="op" id="6689239">!=</span>&nbsp;<span class="ident" id="6689242">nil</span>&nbsp;<span class="op" id="6689246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689250">t</span><span class="op" id="6689251">.</span><span class="ident" id="6689252">Fatalf</span><span class="op" id="6689258">(</span><span class="string" id="6689259">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6689286">,</span>&nbsp;<span class="ident" id="6689288">err</span><span class="op" id="6689291">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689297">ln</span><span class="op" id="6689299">,</span>&nbsp;<span class="ident" id="6689301">err</span>&nbsp;<span class="op" id="6689305">:=</span>&nbsp;<span class="ident" id="6689308">ListenTCP</span><span class="op" id="6689317">(</span><span class="string" id="6689318">&#34;tcp4&#34;</span><span class="op" id="6689324">,</span>&nbsp;<span class="ident" id="6689326">la</span><span class="op" id="6689328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689331">if</span>&nbsp;<span class="ident" id="6689334">err</span>&nbsp;<span class="op" id="6689338">!=</span>&nbsp;<span class="ident" id="6689341">nil</span>&nbsp;<span class="op" id="6689345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689349">t</span><span class="op" id="6689350">.</span><span class="ident" id="6689351">Fatalf</span><span class="op" id="6689357">(</span><span class="string" id="6689358">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6689380">,</span>&nbsp;<span class="ident" id="6689382">err</span><span class="op" id="6689385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689388">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689391">defer</span>&nbsp;<span class="ident" id="6689397">ln</span><span class="op" id="6689399">.</span><span class="ident" id="6689400">Close</span><span class="op" id="6689405">(</span><span class="op" id="6689406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689409">ln</span><span class="op" id="6689411">.</span><span class="ident" id="6689412">Addr</span><span class="op" id="6689416">(</span><span class="op" id="6689417">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689421">done</span>&nbsp;<span class="op" id="6689426">:=</span>&nbsp;<span class="builtinfunc" id="6689429">make</span><span class="op" id="6689433">(</span><span class="keyword" id="6689434">chan</span>&nbsp;<span class="builtintype" id="6689439">int</span><span class="op" id="6689442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689445">go</span>&nbsp;<span class="ident" id="6689448">transponder</span><span class="op" id="6689459">(</span><span class="ident" id="6689460">t</span><span class="op" id="6689461">,</span>&nbsp;<span class="ident" id="6689463">ln</span><span class="op" id="6689465">,</span>&nbsp;<span class="ident" id="6689467">done</span><span class="op" id="6689471">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689475">ra</span><span class="op" id="6689477">,</span>&nbsp;<span class="ident" id="6689479">err</span>&nbsp;<span class="op" id="6689483">:=</span>&nbsp;<span class="ident" id="6689486">ResolveTCPAddr</span><span class="op" id="6689500">(</span><span class="string" id="6689501">&#34;tcp4&#34;</span><span class="op" id="6689507">,</span>&nbsp;<span class="ident" id="6689509">ln</span><span class="op" id="6689511">.</span><span class="ident" id="6689512">Addr</span><span class="op" id="6689516">(</span><span class="op" id="6689517">)</span><span class="op" id="6689518">.</span><span class="ident" id="6689519">String</span><span class="op" id="6689525">(</span><span class="op" id="6689526">)</span><span class="op" id="6689527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689530">if</span>&nbsp;<span class="ident" id="6689533">err</span>&nbsp;<span class="op" id="6689537">!=</span>&nbsp;<span class="ident" id="6689540">nil</span>&nbsp;<span class="op" id="6689544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689548">t</span><span class="op" id="6689549">.</span><span class="ident" id="6689550">Fatalf</span><span class="op" id="6689556">(</span><span class="string" id="6689557">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6689584">,</span>&nbsp;<span class="ident" id="6689586">err</span><span class="op" id="6689589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689592">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689595">c</span><span class="op" id="6689596">,</span>&nbsp;<span class="ident" id="6689598">err</span>&nbsp;<span class="op" id="6689602">:=</span>&nbsp;<span class="ident" id="6689605">DialTCP</span><span class="op" id="6689612">(</span><span class="string" id="6689613">&#34;tcp4&#34;</span><span class="op" id="6689619">,</span>&nbsp;<span class="ident" id="6689621">nil</span><span class="op" id="6689624">,</span>&nbsp;<span class="ident" id="6689626">ra</span><span class="op" id="6689628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689631">if</span>&nbsp;<span class="ident" id="6689634">err</span>&nbsp;<span class="op" id="6689638">!=</span>&nbsp;<span class="ident" id="6689641">nil</span>&nbsp;<span class="op" id="6689645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689649">t</span><span class="op" id="6689650">.</span><span class="ident" id="6689651">Fatalf</span><span class="op" id="6689657">(</span><span class="string" id="6689658">&#34;DialTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6689678">,</span>&nbsp;<span class="ident" id="6689680">err</span><span class="op" id="6689683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689689">defer</span>&nbsp;<span class="ident" id="6689695">c</span><span class="op" id="6689696">.</span><span class="ident" id="6689697">Close</span><span class="op" id="6689702">(</span><span class="op" id="6689703">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689706">c</span><span class="op" id="6689707">.</span><span class="ident" id="6689708">SetKeepAlive</span><span class="op" id="6689720">(</span><span class="builtintype" id="6689721">false</span><span class="op" id="6689726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689729">c</span><span class="op" id="6689730">.</span><span class="ident" id="6689731">SetKeepAlivePeriod</span><span class="op" id="6689749">(</span><span class="num" id="6689750">3</span>&nbsp;<span class="op" id="6689752">*</span>&nbsp;<span class="ident" id="6689754">time</span><span class="op" id="6689758">.</span><span class="ident" id="6689759">Second</span><span class="op" id="6689765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689768">c</span><span class="op" id="6689769">.</span><span class="ident" id="6689770">SetLinger</span><span class="op" id="6689779">(</span><span class="num" id="6689780">0</span><span class="op" id="6689781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689784">c</span><span class="op" id="6689785">.</span><span class="ident" id="6689786">SetNoDelay</span><span class="op" id="6689796">(</span><span class="builtintype" id="6689797">false</span><span class="op" id="6689802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689805">c</span><span class="op" id="6689806">.</span><span class="ident" id="6689807">LocalAddr</span><span class="op" id="6689816">(</span><span class="op" id="6689817">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689820">c</span><span class="op" id="6689821">.</span><span class="ident" id="6689822">RemoteAddr</span><span class="op" id="6689832">(</span><span class="op" id="6689833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689836">c</span><span class="op" id="6689837">.</span><span class="ident" id="6689838">SetDeadline</span><span class="op" id="6689849">(</span><span class="ident" id="6689850">time</span><span class="op" id="6689854">.</span><span class="ident" id="6689855">Now</span><span class="op" id="6689858">(</span><span class="op" id="6689859">)</span><span class="op" id="6689860">.</span><span class="ident" id="6689861">Add</span><span class="op" id="6689864">(</span><span class="ident" id="6689865">someTimeout</span><span class="op" id="6689876">)</span><span class="op" id="6689877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689880">c</span><span class="op" id="6689881">.</span><span class="ident" id="6689882">SetReadDeadline</span><span class="op" id="6689897">(</span><span class="ident" id="6689898">time</span><span class="op" id="6689902">.</span><span class="ident" id="6689903">Now</span><span class="op" id="6689906">(</span><span class="op" id="6689907">)</span><span class="op" id="6689908">.</span><span class="ident" id="6689909">Add</span><span class="op" id="6689912">(</span><span class="ident" id="6689913">someTimeout</span><span class="op" id="6689924">)</span><span class="op" id="6689925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689928">c</span><span class="op" id="6689929">.</span><span class="ident" id="6689930">SetWriteDeadline</span><span class="op" id="6689946">(</span><span class="ident" id="6689947">time</span><span class="op" id="6689951">.</span><span class="ident" id="6689952">Now</span><span class="op" id="6689955">(</span><span class="op" id="6689956">)</span><span class="op" id="6689957">.</span><span class="ident" id="6689958">Add</span><span class="op" id="6689961">(</span><span class="ident" id="6689962">someTimeout</span><span class="op" id="6689973">)</span><span class="op" id="6689974">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689978">if</span>&nbsp;<span class="ident" id="6689981">_</span><span class="op" id="6689982">,</span>&nbsp;<span class="ident" id="6689984">err</span>&nbsp;<span class="op" id="6689988">:=</span>&nbsp;<span class="ident" id="6689991">c</span><span class="op" id="6689992">.</span><span class="ident" id="6689993">Write</span><span class="op" id="6689998">(</span><span class="op" id="6689999">[</span><span class="op" id="6690000">]</span><span class="builtintype" id="6690001">byte</span><span class="op" id="6690005">(</span><span class="string" id="6690006">&#34;TCPCONN&nbsp;TEST&#34;</span><span class="op" id="6690020">)</span><span class="op" id="6690021">)</span><span class="op" id="6690022">;</span>&nbsp;<span class="ident" id="6690024">err</span>&nbsp;<span class="op" id="6690028">!=</span>&nbsp;<span class="ident" id="6690031">nil</span>&nbsp;<span class="op" id="6690035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690039">t</span><span class="op" id="6690040">.</span><span class="ident" id="6690041">Fatalf</span><span class="op" id="6690047">(</span><span class="string" id="6690048">&#34;TCPConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6690074">,</span>&nbsp;<span class="ident" id="6690076">err</span><span class="op" id="6690079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6690082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690085">rb</span>&nbsp;<span class="op" id="6690088">:=</span>&nbsp;<span class="builtinfunc" id="6690091">make</span><span class="op" id="6690095">(</span><span class="op" id="6690096">[</span><span class="op" id="6690097">]</span><span class="builtintype" id="6690098">byte</span><span class="op" id="6690102">,</span>&nbsp;<span class="num" id="6690104">128</span><span class="op" id="6690107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6690110">if</span>&nbsp;<span class="ident" id="6690113">_</span><span class="op" id="6690114">,</span>&nbsp;<span class="ident" id="6690116">err</span>&nbsp;<span class="op" id="6690120">:=</span>&nbsp;<span class="ident" id="6690123">c</span><span class="op" id="6690124">.</span><span class="ident" id="6690125">Read</span><span class="op" id="6690129">(</span><span class="ident" id="6690130">rb</span><span class="op" id="6690132">)</span><span class="op" id="6690133">;</span>&nbsp;<span class="ident" id="6690135">err</span>&nbsp;<span class="op" id="6690139">!=</span>&nbsp;<span class="ident" id="6690142">nil</span>&nbsp;<span class="op" id="6690146">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690150">t</span><span class="op" id="6690151">.</span><span class="ident" id="6690152">Fatalf</span><span class="op" id="6690158">(</span><span class="string" id="6690159">&#34;TCPConn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6690184">,</span>&nbsp;<span class="ident" id="6690186">err</span><span class="op" id="6690189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6690192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6690196">&lt;-</span><span class="ident" id="6690198">done</span><br>
<span class="lineno"></span><span class="op" id="6690203">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="6690206">func</span>&nbsp;<span class="ident" id="6690211">TestUDPConnSpecificMethods</span><span class="op" id="6690237">(</span><span class="ident" id="6690238">t</span>&nbsp;<span class="op" id="6690240">*</span><span class="ident" id="6690241">testing</span><span class="op" id="6690248">.</span><span class="ident" id="6690249">T</span><span class="op" id="6690250">)</span>&nbsp;<span class="op" id="6690252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690255">la</span><span class="op" id="6690257">,</span>&nbsp;<span class="ident" id="6690259">err</span>&nbsp;<span class="op" id="6690263">:=</span>&nbsp;<span class="ident" id="6690266">ResolveUDPAddr</span><span class="op" id="6690280">(</span><span class="string" id="6690281">&#34;udp4&#34;</span><span class="op" id="6690287">,</span>&nbsp;<span class="string" id="6690289">&#34;127.0.0.1:0&#34;</span><span class="op" id="6690302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6690305">if</span>&nbsp;<span class="ident" id="6690308">err</span>&nbsp;<span class="op" id="6690312">!=</span>&nbsp;<span class="ident" id="6690315">nil</span>&nbsp;<span class="op" id="6690319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690323">t</span><span class="op" id="6690324">.</span><span class="ident" id="6690325">Fatalf</span><span class="op" id="6690331">(</span><span class="string" id="6690332">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6690359">,</span>&nbsp;<span class="ident" id="6690361">err</span><span class="op" id="6690364">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6690367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690370">c</span><span class="op" id="6690371">,</span>&nbsp;<span class="ident" id="6690373">err</span>&nbsp;<span class="op" id="6690377">:=</span>&nbsp;<span class="ident" id="6690380">ListenUDP</span><span class="op" id="6690389">(</span><span class="string" id="6690390">&#34;udp4&#34;</span><span class="op" id="6690396">,</span>&nbsp;<span class="ident" id="6690398">la</span><span class="op" id="6690400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6690403">if</span>&nbsp;<span class="ident" id="6690406">err</span>&nbsp;<span class="op" id="6690410">!=</span>&nbsp;<span class="ident" id="6690413">nil</span>&nbsp;<span class="op" id="6690417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690421">t</span><span class="op" id="6690422">.</span><span class="ident" id="6690423">Fatalf</span><span class="op" id="6690429">(</span><span class="string" id="6690430">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6690452">,</span>&nbsp;<span class="ident" id="6690454">err</span><span class="op" id="6690457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6690460">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6690463">defer</span>&nbsp;<span class="ident" id="6690469">c</span><span class="op" id="6690470">.</span><span class="ident" id="6690471">Close</span><span class="op" id="6690476">(</span><span class="op" id="6690477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690480">c</span><span class="op" id="6690481">.</span><span class="ident" id="6690482">LocalAddr</span><span class="op" id="6690491">(</span><span class="op" id="6690492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690495">c</span><span class="op" id="6690496">.</span><span class="ident" id="6690497">RemoteAddr</span><span class="op" id="6690507">(</span><span class="op" id="6690508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690511">c</span><span class="op" id="6690512">.</span><span class="ident" id="6690513">SetDeadline</span><span class="op" id="6690524">(</span><span class="ident" id="6690525">time</span><span class="op" id="6690529">.</span><span class="ident" id="6690530">Now</span><span class="op" id="6690533">(</span><span class="op" id="6690534">)</span><span class="op" id="6690535">.</span><span class="ident" id="6690536">Add</span><span class="op" id="6690539">(</span><span class="ident" id="6690540">someTimeout</span><span class="op" id="6690551">)</span><span class="op" id="6690552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690555">c</span><span class="op" id="6690556">.</span><span class="ident" id="6690557">SetReadDeadline</span><span class="op" id="6690572">(</span><span class="ident" id="6690573">time</span><span class="op" id="6690577">.</span><span class="ident" id="6690578">Now</span><span class="op" id="6690581">(</span><span class="op" id="6690582">)</span><span class="op" id="6690583">.</span><span class="ident" id="6690584">Add</span><span class="op" id="6690587">(</span><span class="ident" id="6690588">someTimeout</span><span class="op" id="6690599">)</span><span class="op" id="6690600">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690603">c</span><span class="op" id="6690604">.</span><span class="ident" id="6690605">SetWriteDeadline</span><span class="op" id="6690621">(</span><span class="ident" id="6690622">time</span><span class="op" id="6690626">.</span><span class="ident" id="6690627">Now</span><span class="op" id="6690630">(</span><span class="op" id="6690631">)</span><span class="op" id="6690632">.</span><span class="ident" id="6690633">Add</span><span class="op" id="6690636">(</span><span class="ident" id="6690637">someTimeout</span><span class="op" id="6690648">)</span><span class="op" id="6690649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690652">c</span><span class="op" id="6690653">.</span><span class="ident" id="6690654">SetReadBuffer</span><span class="op" id="6690667">(</span><span class="num" id="6690668">2048</span><span class="op" id="6690672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690675">c</span><span class="op" id="6690676">.</span><span class="ident" id="6690677">SetWriteBuffer</span><span class="op" id="6690691">(</span><span class="num" id="6690692">2048</span><span class="op" id="6690696">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690700">wb</span>&nbsp;<span class="op" id="6690703">:=</span>&nbsp;<span class="op" id="6690706">[</span><span class="op" id="6690707">]</span><span class="builtintype" id="6690708">byte</span><span class="op" id="6690712">(</span><span class="string" id="6690713">&#34;UDPCONN&nbsp;TEST&#34;</span><span class="op" id="6690727">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690730">rb</span>&nbsp;<span class="op" id="6690733">:=</span>&nbsp;<span class="builtinfunc" id="6690736">make</span><span class="op" id="6690740">(</span><span class="op" id="6690741">[</span><span class="op" id="6690742">]</span><span class="builtintype" id="6690743">byte</span><span class="op" id="6690747">,</span>&nbsp;<span class="num" id="6690749">128</span><span class="op" id="6690752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6690755">if</span>&nbsp;<span class="ident" id="6690758">_</span><span class="op" id="6690759">,</span>&nbsp;<span class="ident" id="6690761">err</span>&nbsp;<span class="op" id="6690765">:=</span>&nbsp;<span class="ident" id="6690768">c</span><span class="op" id="6690769">.</span><span class="ident" id="6690770">WriteToUDP</span><span class="op" id="6690780">(</span><span class="ident" id="6690781">wb</span><span class="op" id="6690783">,</span>&nbsp;<span class="ident" id="6690785">c</span><span class="op" id="6690786">.</span><span class="ident" id="6690787">LocalAddr</span><span class="op" id="6690796">(</span><span class="op" id="6690797">)</span><span class="op" id="6690798">.</span><span class="op" id="6690799">(</span><span class="op" id="6690800">*</span><span class="ident" id="6690801">UDPAddr</span><span class="op" id="6690808">)</span><span class="op" id="6690809">)</span><span class="op" id="6690810">;</span>&nbsp;<span class="ident" id="6690812">err</span>&nbsp;<span class="op" id="6690816">!=</span>&nbsp;<span class="ident" id="6690819">nil</span>&nbsp;<span class="op" id="6690823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690827">t</span><span class="op" id="6690828">.</span><span class="ident" id="6690829">Fatalf</span><span class="op" id="6690835">(</span><span class="string" id="6690836">&#34;UDPConn.WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6690867">,</span>&nbsp;<span class="ident" id="6690869">err</span><span class="op" id="6690872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6690875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6690878">if</span>&nbsp;<span class="ident" id="6690881">_</span><span class="op" id="6690882">,</span>&nbsp;<span class="ident" id="6690884">_</span><span class="op" id="6690885">,</span>&nbsp;<span class="ident" id="6690887">err</span>&nbsp;<span class="op" id="6690891">:=</span>&nbsp;<span class="ident" id="6690894">c</span><span class="op" id="6690895">.</span><span class="ident" id="6690896">ReadFromUDP</span><span class="op" id="6690907">(</span><span class="ident" id="6690908">rb</span><span class="op" id="6690910">)</span><span class="op" id="6690911">;</span>&nbsp;<span class="ident" id="6690913">err</span>&nbsp;<span class="op" id="6690917">!=</span>&nbsp;<span class="ident" id="6690920">nil</span>&nbsp;<span class="op" id="6690924">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690928">t</span><span class="op" id="6690929">.</span><span class="ident" id="6690930">Fatalf</span><span class="op" id="6690936">(</span><span class="string" id="6690937">&#34;UDPConn.ReadFromUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6690969">,</span>&nbsp;<span class="ident" id="6690971">err</span><span class="op" id="6690974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6690977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6690980">if</span>&nbsp;<span class="ident" id="6690983">_</span><span class="op" id="6690984">,</span>&nbsp;<span class="ident" id="6690986">_</span><span class="op" id="6690987">,</span>&nbsp;<span class="ident" id="6690989">err</span>&nbsp;<span class="op" id="6690993">:=</span>&nbsp;<span class="ident" id="6690996">c</span><span class="op" id="6690997">.</span><span class="ident" id="6690998">WriteMsgUDP</span><span class="op" id="6691009">(</span><span class="ident" id="6691010">wb</span><span class="op" id="6691012">,</span>&nbsp;<span class="ident" id="6691014">nil</span><span class="op" id="6691017">,</span>&nbsp;<span class="ident" id="6691019">c</span><span class="op" id="6691020">.</span><span class="ident" id="6691021">LocalAddr</span><span class="op" id="6691030">(</span><span class="op" id="6691031">)</span><span class="op" id="6691032">.</span><span class="op" id="6691033">(</span><span class="op" id="6691034">*</span><span class="ident" id="6691035">UDPAddr</span><span class="op" id="6691042">)</span><span class="op" id="6691043">)</span><span class="op" id="6691044">;</span>&nbsp;<span class="ident" id="6691046">err</span>&nbsp;<span class="op" id="6691050">!=</span>&nbsp;<span class="ident" id="6691053">nil</span>&nbsp;<span class="op" id="6691057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691061">condFatalf</span><span class="op" id="6691071">(</span><span class="ident" id="6691072">t</span><span class="op" id="6691073">,</span>&nbsp;<span class="string" id="6691075">&#34;UDPConn.WriteMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6691107">,</span>&nbsp;<span class="ident" id="6691109">err</span><span class="op" id="6691112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691115">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6691118">if</span>&nbsp;<span class="ident" id="6691121">_</span><span class="op" id="6691122">,</span>&nbsp;<span class="ident" id="6691124">_</span><span class="op" id="6691125">,</span>&nbsp;<span class="ident" id="6691127">_</span><span class="op" id="6691128">,</span>&nbsp;<span class="ident" id="6691130">_</span><span class="op" id="6691131">,</span>&nbsp;<span class="ident" id="6691133">err</span>&nbsp;<span class="op" id="6691137">:=</span>&nbsp;<span class="ident" id="6691140">c</span><span class="op" id="6691141">.</span><span class="ident" id="6691142">ReadMsgUDP</span><span class="op" id="6691152">(</span><span class="ident" id="6691153">rb</span><span class="op" id="6691155">,</span>&nbsp;<span class="ident" id="6691157">nil</span><span class="op" id="6691160">)</span><span class="op" id="6691161">;</span>&nbsp;<span class="ident" id="6691163">err</span>&nbsp;<span class="op" id="6691167">!=</span>&nbsp;<span class="ident" id="6691170">nil</span>&nbsp;<span class="op" id="6691174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691178">condFatalf</span><span class="op" id="6691188">(</span><span class="ident" id="6691189">t</span><span class="op" id="6691190">,</span>&nbsp;<span class="string" id="6691192">&#34;UDPConn.ReadMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6691223">,</span>&nbsp;<span class="ident" id="6691225">err</span><span class="op" id="6691228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6691235">if</span>&nbsp;<span class="ident" id="6691238">f</span><span class="op" id="6691239">,</span>&nbsp;<span class="ident" id="6691241">err</span>&nbsp;<span class="op" id="6691245">:=</span>&nbsp;<span class="ident" id="6691248">c</span><span class="op" id="6691249">.</span><span class="ident" id="6691250">File</span><span class="op" id="6691254">(</span><span class="op" id="6691255">)</span><span class="op" id="6691256">;</span>&nbsp;<span class="ident" id="6691258">err</span>&nbsp;<span class="op" id="6691262">!=</span>&nbsp;<span class="ident" id="6691265">nil</span>&nbsp;<span class="op" id="6691269">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691273">condFatalf</span><span class="op" id="6691283">(</span><span class="ident" id="6691284">t</span><span class="op" id="6691285">,</span>&nbsp;<span class="string" id="6691287">&#34;UDPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6691312">,</span>&nbsp;<span class="ident" id="6691314">err</span><span class="op" id="6691317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691320">}</span>&nbsp;<span class="keyword" id="6691322">else</span>&nbsp;<span class="op" id="6691327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691331">f</span><span class="op" id="6691332">.</span><span class="ident" id="6691333">Close</span><span class="op" id="6691338">(</span><span class="op" id="6691339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6691346">defer</span>&nbsp;<span class="keyword" id="6691352">func</span><span class="op" id="6691356">(</span><span class="op" id="6691357">)</span>&nbsp;<span class="op" id="6691359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6691363">if</span>&nbsp;<span class="ident" id="6691366">p</span>&nbsp;<span class="op" id="6691368">:=</span>&nbsp;<span class="builtinfunc" id="6691371">recover</span><span class="op" id="6691378">(</span><span class="op" id="6691379">)</span><span class="op" id="6691380">;</span>&nbsp;<span class="ident" id="6691382">p</span>&nbsp;<span class="op" id="6691384">!=</span>&nbsp;<span class="ident" id="6691387">nil</span>&nbsp;<span class="op" id="6691391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691396">t</span><span class="op" id="6691397">.</span><span class="ident" id="6691398">Fatalf</span><span class="op" id="6691404">(</span><span class="string" id="6691405">&#34;UDPConn.WriteToUDP&nbsp;or&nbsp;WriteMsgUDP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6691453">,</span>&nbsp;<span class="ident" id="6691455">p</span><span class="op" id="6691456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691463">}</span><span class="op" id="6691464">(</span><span class="op" id="6691465">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691469">c</span><span class="op" id="6691470">.</span><span class="ident" id="6691471">WriteToUDP</span><span class="op" id="6691481">(</span><span class="ident" id="6691482">wb</span><span class="op" id="6691484">,</span>&nbsp;<span class="ident" id="6691486">nil</span><span class="op" id="6691489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691492">c</span><span class="op" id="6691493">.</span><span class="ident" id="6691494">WriteMsgUDP</span><span class="op" id="6691505">(</span><span class="ident" id="6691506">wb</span><span class="op" id="6691508">,</span>&nbsp;<span class="ident" id="6691510">nil</span><span class="op" id="6691513">,</span>&nbsp;<span class="ident" id="6691515">nil</span><span class="op" id="6691518">)</span><br>
<span class="lineno"></span><span class="op" id="6691520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="6691523">func</span>&nbsp;<span class="ident" id="6691528">TestIPConnSpecificMethods</span><span class="op" id="6691553">(</span><span class="ident" id="6691554">t</span>&nbsp;<span class="op" id="6691556">*</span><span class="ident" id="6691557">testing</span><span class="op" id="6691564">.</span><span class="ident" id="6691565">T</span><span class="op" id="6691566">)</span>&nbsp;<span class="op" id="6691568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6691571">if</span>&nbsp;<span class="ident" id="6691574">skip</span><span class="op" id="6691578">,</span>&nbsp;<span class="ident" id="6691580">skipmsg</span>&nbsp;<span class="op" id="6691588">:=</span>&nbsp;<span class="ident" id="6691591">skipRawSocketTest</span><span class="op" id="6691608">(</span><span class="ident" id="6691609">t</span><span class="op" id="6691610">)</span><span class="op" id="6691611">;</span>&nbsp;<span class="ident" id="6691613">skip</span>&nbsp;<span class="op" id="6691618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691622">t</span><span class="op" id="6691623">.</span><span class="ident" id="6691624">Skip</span><span class="op" id="6691628">(</span><span class="ident" id="6691629">skipmsg</span><span class="op" id="6691636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691643">la</span><span class="op" id="6691645">,</span>&nbsp;<span class="ident" id="6691647">err</span>&nbsp;<span class="op" id="6691651">:=</span>&nbsp;<span class="ident" id="6691654">ResolveIPAddr</span><span class="op" id="6691667">(</span><span class="string" id="6691668">&#34;ip4&#34;</span><span class="op" id="6691673">,</span>&nbsp;<span class="string" id="6691675">&#34;127.0.0.1&#34;</span><span class="op" id="6691686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6691689">if</span>&nbsp;<span class="ident" id="6691692">err</span>&nbsp;<span class="op" id="6691696">!=</span>&nbsp;<span class="ident" id="6691699">nil</span>&nbsp;<span class="op" id="6691703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691707">t</span><span class="op" id="6691708">.</span><span class="ident" id="6691709">Fatalf</span><span class="op" id="6691715">(</span><span class="string" id="6691716">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6691742">,</span>&nbsp;<span class="ident" id="6691744">err</span><span class="op" id="6691747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691753">c</span><span class="op" id="6691754">,</span>&nbsp;<span class="ident" id="6691756">err</span>&nbsp;<span class="op" id="6691760">:=</span>&nbsp;<span class="ident" id="6691763">ListenIP</span><span class="op" id="6691771">(</span><span class="string" id="6691772">&#34;ip4:icmp&#34;</span><span class="op" id="6691782">,</span>&nbsp;<span class="ident" id="6691784">la</span><span class="op" id="6691786">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6691789">if</span>&nbsp;<span class="ident" id="6691792">err</span>&nbsp;<span class="op" id="6691796">!=</span>&nbsp;<span class="ident" id="6691799">nil</span>&nbsp;<span class="op" id="6691803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691807">t</span><span class="op" id="6691808">.</span><span class="ident" id="6691809">Fatalf</span><span class="op" id="6691815">(</span><span class="string" id="6691816">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6691837">,</span>&nbsp;<span class="ident" id="6691839">err</span><span class="op" id="6691842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6691848">defer</span>&nbsp;<span class="ident" id="6691854">c</span><span class="op" id="6691855">.</span><span class="ident" id="6691856">Close</span><span class="op" id="6691861">(</span><span class="op" id="6691862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691865">c</span><span class="op" id="6691866">.</span><span class="ident" id="6691867">LocalAddr</span><span class="op" id="6691876">(</span><span class="op" id="6691877">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691880">c</span><span class="op" id="6691881">.</span><span class="ident" id="6691882">RemoteAddr</span><span class="op" id="6691892">(</span><span class="op" id="6691893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691896">c</span><span class="op" id="6691897">.</span><span class="ident" id="6691898">SetDeadline</span><span class="op" id="6691909">(</span><span class="ident" id="6691910">time</span><span class="op" id="6691914">.</span><span class="ident" id="6691915">Now</span><span class="op" id="6691918">(</span><span class="op" id="6691919">)</span><span class="op" id="6691920">.</span><span class="ident" id="6691921">Add</span><span class="op" id="6691924">(</span><span class="ident" id="6691925">someTimeout</span><span class="op" id="6691936">)</span><span class="op" id="6691937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691940">c</span><span class="op" id="6691941">.</span><span class="ident" id="6691942">SetReadDeadline</span><span class="op" id="6691957">(</span><span class="ident" id="6691958">time</span><span class="op" id="6691962">.</span><span class="ident" id="6691963">Now</span><span class="op" id="6691966">(</span><span class="op" id="6691967">)</span><span class="op" id="6691968">.</span><span class="ident" id="6691969">Add</span><span class="op" id="6691972">(</span><span class="ident" id="6691973">someTimeout</span><span class="op" id="6691984">)</span><span class="op" id="6691985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691988">c</span><span class="op" id="6691989">.</span><span class="ident" id="6691990">SetWriteDeadline</span><span class="op" id="6692006">(</span><span class="ident" id="6692007">time</span><span class="op" id="6692011">.</span><span class="ident" id="6692012">Now</span><span class="op" id="6692015">(</span><span class="op" id="6692016">)</span><span class="op" id="6692017">.</span><span class="ident" id="6692018">Add</span><span class="op" id="6692021">(</span><span class="ident" id="6692022">someTimeout</span><span class="op" id="6692033">)</span><span class="op" id="6692034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692037">c</span><span class="op" id="6692038">.</span><span class="ident" id="6692039">SetReadBuffer</span><span class="op" id="6692052">(</span><span class="num" id="6692053">2048</span><span class="op" id="6692057">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692060">c</span><span class="op" id="6692061">.</span><span class="ident" id="6692062">SetWriteBuffer</span><span class="op" id="6692076">(</span><span class="num" id="6692077">2048</span><span class="op" id="6692081">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692085">wb</span><span class="op" id="6692087">,</span>&nbsp;<span class="ident" id="6692089">err</span>&nbsp;<span class="op" id="6692093">:=</span>&nbsp;<span class="op" id="6692096">(</span><span class="op" id="6692097">&amp;</span><span class="ident" id="6692098">icmpMessage</span><span class="op" id="6692109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692113">Type</span><span class="op" id="6692117">:</span>&nbsp;<span class="ident" id="6692119">icmpv4EchoRequest</span><span class="op" id="6692136">,</span>&nbsp;<span class="ident" id="6692138">Code</span><span class="op" id="6692142">:</span>&nbsp;<span class="num" id="6692144">0</span><span class="op" id="6692145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692149">Body</span><span class="op" id="6692153">:</span>&nbsp;<span class="op" id="6692155">&amp;</span><span class="ident" id="6692156">icmpEcho</span><span class="op" id="6692164">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692169">ID</span><span class="op" id="6692171">:</span>&nbsp;<span class="ident" id="6692173">os</span><span class="op" id="6692175">.</span><span class="ident" id="6692176">Getpid</span><span class="op" id="6692182">(</span><span class="op" id="6692183">)</span>&nbsp;<span class="op" id="6692185">&amp;</span>&nbsp;<span class="num" id="6692187">0xffff</span><span class="op" id="6692193">,</span>&nbsp;<span class="ident" id="6692195">Seq</span><span class="op" id="6692198">:</span>&nbsp;<span class="num" id="6692200">1</span><span class="op" id="6692201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692206">Data</span><span class="op" id="6692210">:</span>&nbsp;<span class="op" id="6692212">[</span><span class="op" id="6692213">]</span><span class="builtintype" id="6692214">byte</span><span class="op" id="6692218">(</span><span class="string" id="6692219">&#34;IPCONN&nbsp;TEST&nbsp;&#34;</span><span class="op" id="6692233">)</span><span class="op" id="6692234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692238">}</span><span class="op" id="6692239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692242">}</span><span class="op" id="6692243">)</span><span class="op" id="6692244">.</span><span class="ident" id="6692245">Marshal</span><span class="op" id="6692252">(</span><span class="op" id="6692253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692256">if</span>&nbsp;<span class="ident" id="6692259">err</span>&nbsp;<span class="op" id="6692263">!=</span>&nbsp;<span class="ident" id="6692266">nil</span>&nbsp;<span class="op" id="6692270">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692274">t</span><span class="op" id="6692275">.</span><span class="ident" id="6692276">Fatalf</span><span class="op" id="6692282">(</span><span class="string" id="6692283">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6692315">,</span>&nbsp;<span class="ident" id="6692317">err</span><span class="op" id="6692320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692326">rb</span>&nbsp;<span class="op" id="6692329">:=</span>&nbsp;<span class="builtinfunc" id="6692332">make</span><span class="op" id="6692336">(</span><span class="op" id="6692337">[</span><span class="op" id="6692338">]</span><span class="builtintype" id="6692339">byte</span><span class="op" id="6692343">,</span>&nbsp;<span class="num" id="6692345">20</span><span class="op" id="6692347">+</span><span class="builtinfunc" id="6692348">len</span><span class="op" id="6692351">(</span><span class="ident" id="6692352">wb</span><span class="op" id="6692354">)</span><span class="op" id="6692355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692358">if</span>&nbsp;<span class="ident" id="6692361">_</span><span class="op" id="6692362">,</span>&nbsp;<span class="ident" id="6692364">err</span>&nbsp;<span class="op" id="6692368">:=</span>&nbsp;<span class="ident" id="6692371">c</span><span class="op" id="6692372">.</span><span class="ident" id="6692373">WriteToIP</span><span class="op" id="6692382">(</span><span class="ident" id="6692383">wb</span><span class="op" id="6692385">,</span>&nbsp;<span class="ident" id="6692387">c</span><span class="op" id="6692388">.</span><span class="ident" id="6692389">LocalAddr</span><span class="op" id="6692398">(</span><span class="op" id="6692399">)</span><span class="op" id="6692400">.</span><span class="op" id="6692401">(</span><span class="op" id="6692402">*</span><span class="ident" id="6692403">IPAddr</span><span class="op" id="6692409">)</span><span class="op" id="6692410">)</span><span class="op" id="6692411">;</span>&nbsp;<span class="ident" id="6692413">err</span>&nbsp;<span class="op" id="6692417">!=</span>&nbsp;<span class="ident" id="6692420">nil</span>&nbsp;<span class="op" id="6692424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692428">t</span><span class="op" id="6692429">.</span><span class="ident" id="6692430">Fatalf</span><span class="op" id="6692436">(</span><span class="string" id="6692437">&#34;IPConn.WriteToIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6692466">,</span>&nbsp;<span class="ident" id="6692468">err</span><span class="op" id="6692471">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692477">if</span>&nbsp;<span class="ident" id="6692480">_</span><span class="op" id="6692481">,</span>&nbsp;<span class="ident" id="6692483">_</span><span class="op" id="6692484">,</span>&nbsp;<span class="ident" id="6692486">err</span>&nbsp;<span class="op" id="6692490">:=</span>&nbsp;<span class="ident" id="6692493">c</span><span class="op" id="6692494">.</span><span class="ident" id="6692495">ReadFromIP</span><span class="op" id="6692505">(</span><span class="ident" id="6692506">rb</span><span class="op" id="6692508">)</span><span class="op" id="6692509">;</span>&nbsp;<span class="ident" id="6692511">err</span>&nbsp;<span class="op" id="6692515">!=</span>&nbsp;<span class="ident" id="6692518">nil</span>&nbsp;<span class="op" id="6692522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692526">t</span><span class="op" id="6692527">.</span><span class="ident" id="6692528">Fatalf</span><span class="op" id="6692534">(</span><span class="string" id="6692535">&#34;IPConn.ReadFromIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6692565">,</span>&nbsp;<span class="ident" id="6692567">err</span><span class="op" id="6692570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692576">if</span>&nbsp;<span class="ident" id="6692579">_</span><span class="op" id="6692580">,</span>&nbsp;<span class="ident" id="6692582">_</span><span class="op" id="6692583">,</span>&nbsp;<span class="ident" id="6692585">err</span>&nbsp;<span class="op" id="6692589">:=</span>&nbsp;<span class="ident" id="6692592">c</span><span class="op" id="6692593">.</span><span class="ident" id="6692594">WriteMsgIP</span><span class="op" id="6692604">(</span><span class="ident" id="6692605">wb</span><span class="op" id="6692607">,</span>&nbsp;<span class="ident" id="6692609">nil</span><span class="op" id="6692612">,</span>&nbsp;<span class="ident" id="6692614">c</span><span class="op" id="6692615">.</span><span class="ident" id="6692616">LocalAddr</span><span class="op" id="6692625">(</span><span class="op" id="6692626">)</span><span class="op" id="6692627">.</span><span class="op" id="6692628">(</span><span class="op" id="6692629">*</span><span class="ident" id="6692630">IPAddr</span><span class="op" id="6692636">)</span><span class="op" id="6692637">)</span><span class="op" id="6692638">;</span>&nbsp;<span class="ident" id="6692640">err</span>&nbsp;<span class="op" id="6692644">!=</span>&nbsp;<span class="ident" id="6692647">nil</span>&nbsp;<span class="op" id="6692651">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692655">condFatalf</span><span class="op" id="6692665">(</span><span class="ident" id="6692666">t</span><span class="op" id="6692667">,</span>&nbsp;<span class="string" id="6692669">&#34;IPConn.WriteMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6692699">,</span>&nbsp;<span class="ident" id="6692701">err</span><span class="op" id="6692704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692710">if</span>&nbsp;<span class="ident" id="6692713">_</span><span class="op" id="6692714">,</span>&nbsp;<span class="ident" id="6692716">_</span><span class="op" id="6692717">,</span>&nbsp;<span class="ident" id="6692719">_</span><span class="op" id="6692720">,</span>&nbsp;<span class="ident" id="6692722">_</span><span class="op" id="6692723">,</span>&nbsp;<span class="ident" id="6692725">err</span>&nbsp;<span class="op" id="6692729">:=</span>&nbsp;<span class="ident" id="6692732">c</span><span class="op" id="6692733">.</span><span class="ident" id="6692734">ReadMsgIP</span><span class="op" id="6692743">(</span><span class="ident" id="6692744">rb</span><span class="op" id="6692746">,</span>&nbsp;<span class="ident" id="6692748">nil</span><span class="op" id="6692751">)</span><span class="op" id="6692752">;</span>&nbsp;<span class="ident" id="6692754">err</span>&nbsp;<span class="op" id="6692758">!=</span>&nbsp;<span class="ident" id="6692761">nil</span>&nbsp;<span class="op" id="6692765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692769">condFatalf</span><span class="op" id="6692779">(</span><span class="ident" id="6692780">t</span><span class="op" id="6692781">,</span>&nbsp;<span class="string" id="6692783">&#34;IPConn.ReadMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6692812">,</span>&nbsp;<span class="ident" id="6692814">err</span><span class="op" id="6692817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692820">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692824">if</span>&nbsp;<span class="ident" id="6692827">f</span><span class="op" id="6692828">,</span>&nbsp;<span class="ident" id="6692830">err</span>&nbsp;<span class="op" id="6692834">:=</span>&nbsp;<span class="ident" id="6692837">c</span><span class="op" id="6692838">.</span><span class="ident" id="6692839">File</span><span class="op" id="6692843">(</span><span class="op" id="6692844">)</span><span class="op" id="6692845">;</span>&nbsp;<span class="ident" id="6692847">err</span>&nbsp;<span class="op" id="6692851">!=</span>&nbsp;<span class="ident" id="6692854">nil</span>&nbsp;<span class="op" id="6692858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692862">condFatalf</span><span class="op" id="6692872">(</span><span class="ident" id="6692873">t</span><span class="op" id="6692874">,</span>&nbsp;<span class="string" id="6692876">&#34;IPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6692900">,</span>&nbsp;<span class="ident" id="6692902">err</span><span class="op" id="6692905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692908">}</span>&nbsp;<span class="keyword" id="6692910">else</span>&nbsp;<span class="op" id="6692915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692919">f</span><span class="op" id="6692920">.</span><span class="ident" id="6692921">Close</span><span class="op" id="6692926">(</span><span class="op" id="6692927">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692934">defer</span>&nbsp;<span class="keyword" id="6692940">func</span><span class="op" id="6692944">(</span><span class="op" id="6692945">)</span>&nbsp;<span class="op" id="6692947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692951">if</span>&nbsp;<span class="ident" id="6692954">p</span>&nbsp;<span class="op" id="6692956">:=</span>&nbsp;<span class="builtinfunc" id="6692959">recover</span><span class="op" id="6692966">(</span><span class="op" id="6692967">)</span><span class="op" id="6692968">;</span>&nbsp;<span class="ident" id="6692970">p</span>&nbsp;<span class="op" id="6692972">!=</span>&nbsp;<span class="ident" id="6692975">nil</span>&nbsp;<span class="op" id="6692979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692984">t</span><span class="op" id="6692985">.</span><span class="ident" id="6692986">Fatalf</span><span class="op" id="6692992">(</span><span class="string" id="6692993">&#34;IPConn.WriteToIP&nbsp;or&nbsp;WriteMsgIP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6693038">,</span>&nbsp;<span class="ident" id="6693040">p</span><span class="op" id="6693041">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693048">}</span><span class="op" id="6693049">(</span><span class="op" id="6693050">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693054">c</span><span class="op" id="6693055">.</span><span class="ident" id="6693056">WriteToIP</span><span class="op" id="6693065">(</span><span class="ident" id="6693066">wb</span><span class="op" id="6693068">,</span>&nbsp;<span class="ident" id="6693070">nil</span><span class="op" id="6693073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693076">c</span><span class="op" id="6693077">.</span><span class="ident" id="6693078">WriteMsgIP</span><span class="op" id="6693088">(</span><span class="ident" id="6693089">wb</span><span class="op" id="6693091">,</span>&nbsp;<span class="ident" id="6693093">nil</span><span class="op" id="6693096">,</span>&nbsp;<span class="ident" id="6693098">nil</span><span class="op" id="6693101">)</span><br>
<span class="lineno">235</span><span class="op" id="6693103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6693106">func</span>&nbsp;<span class="ident" id="6693111">TestUnixListenerSpecificMethods</span><span class="op" id="6693142">(</span><span class="ident" id="6693143">t</span>&nbsp;<span class="op" id="6693145">*</span><span class="ident" id="6693146">testing</span><span class="op" id="6693153">.</span><span class="ident" id="6693154">T</span><span class="op" id="6693155">)</span>&nbsp;<span class="op" id="6693157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693160">switch</span>&nbsp;<span class="ident" id="6693167">runtime</span><span class="op" id="6693174">.</span><span class="ident" id="6693175">GOOS</span>&nbsp;<span class="op" id="6693180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693183">case</span>&nbsp;<span class="string" id="6693188">&#34;nacl&#34;</span><span class="op" id="6693194">,</span>&nbsp;<span class="string" id="6693196">&#34;plan9&#34;</span><span class="op" id="6693203">,</span>&nbsp;<span class="string" id="6693205">&#34;windows&#34;</span><span class="op" id="6693214">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693218">t</span><span class="op" id="6693219">.</span><span class="ident" id="6693220">Skipf</span><span class="op" id="6693225">(</span><span class="string" id="6693226">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6693247">,</span>&nbsp;<span class="ident" id="6693249">runtime</span><span class="op" id="6693256">.</span><span class="ident" id="6693257">GOOS</span><span class="op" id="6693261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693268">addr</span>&nbsp;<span class="op" id="6693273">:=</span>&nbsp;<span class="ident" id="6693276">testUnixAddr</span><span class="op" id="6693288">(</span><span class="op" id="6693289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693292">la</span><span class="op" id="6693294">,</span>&nbsp;<span class="ident" id="6693296">err</span>&nbsp;<span class="op" id="6693300">:=</span>&nbsp;<span class="ident" id="6693303">ResolveUnixAddr</span><span class="op" id="6693318">(</span><span class="string" id="6693319">&#34;unix&#34;</span><span class="op" id="6693325">,</span>&nbsp;<span class="ident" id="6693327">addr</span><span class="op" id="6693331">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693334">if</span>&nbsp;<span class="ident" id="6693337">err</span>&nbsp;<span class="op" id="6693341">!=</span>&nbsp;<span class="ident" id="6693344">nil</span>&nbsp;<span class="op" id="6693348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693352">t</span><span class="op" id="6693353">.</span><span class="ident" id="6693354">Fatalf</span><span class="op" id="6693360">(</span><span class="string" id="6693361">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6693389">,</span>&nbsp;<span class="ident" id="6693391">err</span><span class="op" id="6693394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693400">ln</span><span class="op" id="6693402">,</span>&nbsp;<span class="ident" id="6693404">err</span>&nbsp;<span class="op" id="6693408">:=</span>&nbsp;<span class="ident" id="6693411">ListenUnix</span><span class="op" id="6693421">(</span><span class="string" id="6693422">&#34;unix&#34;</span><span class="op" id="6693428">,</span>&nbsp;<span class="ident" id="6693430">la</span><span class="op" id="6693432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693435">if</span>&nbsp;<span class="ident" id="6693438">err</span>&nbsp;<span class="op" id="6693442">!=</span>&nbsp;<span class="ident" id="6693445">nil</span>&nbsp;<span class="op" id="6693449">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693453">t</span><span class="op" id="6693454">.</span><span class="ident" id="6693455">Fatalf</span><span class="op" id="6693461">(</span><span class="string" id="6693462">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6693485">,</span>&nbsp;<span class="ident" id="6693487">err</span><span class="op" id="6693490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693496">defer</span>&nbsp;<span class="ident" id="6693502">ln</span><span class="op" id="6693504">.</span><span class="ident" id="6693505">Close</span><span class="op" id="6693510">(</span><span class="op" id="6693511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693514">defer</span>&nbsp;<span class="ident" id="6693520">os</span><span class="op" id="6693522">.</span><span class="ident" id="6693523">Remove</span><span class="op" id="6693529">(</span><span class="ident" id="6693530">addr</span><span class="op" id="6693534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693537">ln</span><span class="op" id="6693539">.</span><span class="ident" id="6693540">Addr</span><span class="op" id="6693544">(</span><span class="op" id="6693545">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693548">ln</span><span class="op" id="6693550">.</span><span class="ident" id="6693551">SetDeadline</span><span class="op" id="6693562">(</span><span class="ident" id="6693563">time</span><span class="op" id="6693567">.</span><span class="ident" id="6693568">Now</span><span class="op" id="6693571">(</span><span class="op" id="6693572">)</span><span class="op" id="6693573">.</span><span class="ident" id="6693574">Add</span><span class="op" id="6693577">(</span><span class="num" id="6693578">30</span>&nbsp;<span class="op" id="6693581">*</span>&nbsp;<span class="ident" id="6693583">time</span><span class="op" id="6693587">.</span><span class="ident" id="6693588">Nanosecond</span><span class="op" id="6693598">)</span><span class="op" id="6693599">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693603">if</span>&nbsp;<span class="ident" id="6693606">c</span><span class="op" id="6693607">,</span>&nbsp;<span class="ident" id="6693609">err</span>&nbsp;<span class="op" id="6693613">:=</span>&nbsp;<span class="ident" id="6693616">ln</span><span class="op" id="6693618">.</span><span class="ident" id="6693619">Accept</span><span class="op" id="6693625">(</span><span class="op" id="6693626">)</span><span class="op" id="6693627">;</span>&nbsp;<span class="ident" id="6693629">err</span>&nbsp;<span class="op" id="6693633">!=</span>&nbsp;<span class="ident" id="6693636">nil</span>&nbsp;<span class="op" id="6693640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693644">if</span>&nbsp;<span class="op" id="6693647">!</span><span class="ident" id="6693648">err</span><span class="op" id="6693651">.</span><span class="op" id="6693652">(</span><span class="ident" id="6693653">Error</span><span class="op" id="6693658">)</span><span class="op" id="6693659">.</span><span class="ident" id="6693660">Timeout</span><span class="op" id="6693667">(</span><span class="op" id="6693668">)</span>&nbsp;<span class="op" id="6693670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693675">t</span><span class="op" id="6693676">.</span><span class="ident" id="6693677">Fatalf</span><span class="op" id="6693683">(</span><span class="string" id="6693684">&#34;UnixListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6693716">,</span>&nbsp;<span class="ident" id="6693718">err</span><span class="op" id="6693721">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693728">}</span>&nbsp;<span class="keyword" id="6693730">else</span>&nbsp;<span class="op" id="6693735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693739">c</span><span class="op" id="6693740">.</span><span class="ident" id="6693741">Close</span><span class="op" id="6693746">(</span><span class="op" id="6693747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693753">if</span>&nbsp;<span class="ident" id="6693756">c</span><span class="op" id="6693757">,</span>&nbsp;<span class="ident" id="6693759">err</span>&nbsp;<span class="op" id="6693763">:=</span>&nbsp;<span class="ident" id="6693766">ln</span><span class="op" id="6693768">.</span><span class="ident" id="6693769">AcceptUnix</span><span class="op" id="6693779">(</span><span class="op" id="6693780">)</span><span class="op" id="6693781">;</span>&nbsp;<span class="ident" id="6693783">err</span>&nbsp;<span class="op" id="6693787">!=</span>&nbsp;<span class="ident" id="6693790">nil</span>&nbsp;<span class="op" id="6693794">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693798">if</span>&nbsp;<span class="op" id="6693801">!</span><span class="ident" id="6693802">err</span><span class="op" id="6693805">.</span><span class="op" id="6693806">(</span><span class="ident" id="6693807">Error</span><span class="op" id="6693812">)</span><span class="op" id="6693813">.</span><span class="ident" id="6693814">Timeout</span><span class="op" id="6693821">(</span><span class="op" id="6693822">)</span>&nbsp;<span class="op" id="6693824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693829">t</span><span class="op" id="6693830">.</span><span class="ident" id="6693831">Fatalf</span><span class="op" id="6693837">(</span><span class="string" id="6693838">&#34;UnixListener.AcceptUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6693874">,</span>&nbsp;<span class="ident" id="6693876">err</span><span class="op" id="6693879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693886">}</span>&nbsp;<span class="keyword" id="6693888">else</span>&nbsp;<span class="op" id="6693893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693897">c</span><span class="op" id="6693898">.</span><span class="ident" id="6693899">Close</span><span class="op" id="6693904">(</span><span class="op" id="6693905">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693912">if</span>&nbsp;<span class="ident" id="6693915">f</span><span class="op" id="6693916">,</span>&nbsp;<span class="ident" id="6693918">err</span>&nbsp;<span class="op" id="6693922">:=</span>&nbsp;<span class="ident" id="6693925">ln</span><span class="op" id="6693927">.</span><span class="ident" id="6693928">File</span><span class="op" id="6693932">(</span><span class="op" id="6693933">)</span><span class="op" id="6693934">;</span>&nbsp;<span class="ident" id="6693936">err</span>&nbsp;<span class="op" id="6693940">!=</span>&nbsp;<span class="ident" id="6693943">nil</span>&nbsp;<span class="op" id="6693947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693951">t</span><span class="op" id="6693952">.</span><span class="ident" id="6693953">Fatalf</span><span class="op" id="6693959">(</span><span class="string" id="6693960">&#34;UnixListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6693990">,</span>&nbsp;<span class="ident" id="6693992">err</span><span class="op" id="6693995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693998">}</span>&nbsp;<span class="keyword" id="6694000">else</span>&nbsp;<span class="op" id="6694005">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694009">f</span><span class="op" id="6694010">.</span><span class="ident" id="6694011">Close</span><span class="op" id="6694016">(</span><span class="op" id="6694017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694020">}</span><br>
<span class="lineno"></span><span class="op" id="6694022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6694025">func</span>&nbsp;<span class="ident" id="6694030">TestUnixConnSpecificMethods</span><span class="op" id="6694057">(</span><span class="ident" id="6694058">t</span>&nbsp;<span class="op" id="6694060">*</span><span class="ident" id="6694061">testing</span><span class="op" id="6694068">.</span><span class="ident" id="6694069">T</span><span class="op" id="6694070">)</span>&nbsp;<span class="op" id="6694072">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694075">switch</span>&nbsp;<span class="ident" id="6694082">runtime</span><span class="op" id="6694089">.</span><span class="ident" id="6694090">GOOS</span>&nbsp;<span class="op" id="6694095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694098">case</span>&nbsp;<span class="string" id="6694103">&#34;nacl&#34;</span><span class="op" id="6694109">,</span>&nbsp;<span class="string" id="6694111">&#34;plan9&#34;</span><span class="op" id="6694118">,</span>&nbsp;<span class="string" id="6694120">&#34;windows&#34;</span><span class="op" id="6694129">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694133">t</span><span class="op" id="6694134">.</span><span class="ident" id="6694135">Skipf</span><span class="op" id="6694140">(</span><span class="string" id="6694141">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6694162">,</span>&nbsp;<span class="ident" id="6694164">runtime</span><span class="op" id="6694171">.</span><span class="ident" id="6694172">GOOS</span><span class="op" id="6694176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694183">addr1</span><span class="op" id="6694188">,</span>&nbsp;<span class="ident" id="6694190">addr2</span><span class="op" id="6694195">,</span>&nbsp;<span class="ident" id="6694197">addr3</span>&nbsp;<span class="op" id="6694203">:=</span>&nbsp;<span class="ident" id="6694206">testUnixAddr</span><span class="op" id="6694218">(</span><span class="op" id="6694219">)</span><span class="op" id="6694220">,</span>&nbsp;<span class="ident" id="6694222">testUnixAddr</span><span class="op" id="6694234">(</span><span class="op" id="6694235">)</span><span class="op" id="6694236">,</span>&nbsp;<span class="ident" id="6694238">testUnixAddr</span><span class="op" id="6694250">(</span><span class="op" id="6694251">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694255">a1</span><span class="op" id="6694257">,</span>&nbsp;<span class="ident" id="6694259">err</span>&nbsp;<span class="op" id="6694263">:=</span>&nbsp;<span class="ident" id="6694266">ResolveUnixAddr</span><span class="op" id="6694281">(</span><span class="string" id="6694282">&#34;unixgram&#34;</span><span class="op" id="6694292">,</span>&nbsp;<span class="ident" id="6694294">addr1</span><span class="op" id="6694299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694302">if</span>&nbsp;<span class="ident" id="6694305">err</span>&nbsp;<span class="op" id="6694309">!=</span>&nbsp;<span class="ident" id="6694312">nil</span>&nbsp;<span class="op" id="6694316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694320">t</span><span class="op" id="6694321">.</span><span class="ident" id="6694322">Fatalf</span><span class="op" id="6694328">(</span><span class="string" id="6694329">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6694357">,</span>&nbsp;<span class="ident" id="6694359">err</span><span class="op" id="6694362">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694368">c1</span><span class="op" id="6694370">,</span>&nbsp;<span class="ident" id="6694372">err</span>&nbsp;<span class="op" id="6694376">:=</span>&nbsp;<span class="ident" id="6694379">DialUnix</span><span class="op" id="6694387">(</span><span class="string" id="6694388">&#34;unixgram&#34;</span><span class="op" id="6694398">,</span>&nbsp;<span class="ident" id="6694400">a1</span><span class="op" id="6694402">,</span>&nbsp;<span class="ident" id="6694404">nil</span><span class="op" id="6694407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694410">if</span>&nbsp;<span class="ident" id="6694413">err</span>&nbsp;<span class="op" id="6694417">!=</span>&nbsp;<span class="ident" id="6694420">nil</span>&nbsp;<span class="op" id="6694424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694428">t</span><span class="op" id="6694429">.</span><span class="ident" id="6694430">Fatalf</span><span class="op" id="6694436">(</span><span class="string" id="6694437">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6694458">,</span>&nbsp;<span class="ident" id="6694460">err</span><span class="op" id="6694463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694466">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694469">defer</span>&nbsp;<span class="ident" id="6694475">c1</span><span class="op" id="6694477">.</span><span class="ident" id="6694478">Close</span><span class="op" id="6694483">(</span><span class="op" id="6694484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694487">defer</span>&nbsp;<span class="ident" id="6694493">os</span><span class="op" id="6694495">.</span><span class="ident" id="6694496">Remove</span><span class="op" id="6694502">(</span><span class="ident" id="6694503">addr1</span><span class="op" id="6694508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694511">c1</span><span class="op" id="6694513">.</span><span class="ident" id="6694514">LocalAddr</span><span class="op" id="6694523">(</span><span class="op" id="6694524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694527">c1</span><span class="op" id="6694529">.</span><span class="ident" id="6694530">RemoteAddr</span><span class="op" id="6694540">(</span><span class="op" id="6694541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694544">c1</span><span class="op" id="6694546">.</span><span class="ident" id="6694547">SetDeadline</span><span class="op" id="6694558">(</span><span class="ident" id="6694559">time</span><span class="op" id="6694563">.</span><span class="ident" id="6694564">Now</span><span class="op" id="6694567">(</span><span class="op" id="6694568">)</span><span class="op" id="6694569">.</span><span class="ident" id="6694570">Add</span><span class="op" id="6694573">(</span><span class="ident" id="6694574">someTimeout</span><span class="op" id="6694585">)</span><span class="op" id="6694586">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694589">c1</span><span class="op" id="6694591">.</span><span class="ident" id="6694592">SetReadDeadline</span><span class="op" id="6694607">(</span><span class="ident" id="6694608">time</span><span class="op" id="6694612">.</span><span class="ident" id="6694613">Now</span><span class="op" id="6694616">(</span><span class="op" id="6694617">)</span><span class="op" id="6694618">.</span><span class="ident" id="6694619">Add</span><span class="op" id="6694622">(</span><span class="ident" id="6694623">someTimeout</span><span class="op" id="6694634">)</span><span class="op" id="6694635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694638">c1</span><span class="op" id="6694640">.</span><span class="ident" id="6694641">SetWriteDeadline</span><span class="op" id="6694657">(</span><span class="ident" id="6694658">time</span><span class="op" id="6694662">.</span><span class="ident" id="6694663">Now</span><span class="op" id="6694666">(</span><span class="op" id="6694667">)</span><span class="op" id="6694668">.</span><span class="ident" id="6694669">Add</span><span class="op" id="6694672">(</span><span class="ident" id="6694673">someTimeout</span><span class="op" id="6694684">)</span><span class="op" id="6694685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694688">c1</span><span class="op" id="6694690">.</span><span class="ident" id="6694691">SetReadBuffer</span><span class="op" id="6694704">(</span><span class="num" id="6694705">2048</span><span class="op" id="6694709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694712">c1</span><span class="op" id="6694714">.</span><span class="ident" id="6694715">SetWriteBuffer</span><span class="op" id="6694729">(</span><span class="num" id="6694730">2048</span><span class="op" id="6694734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694738">a2</span><span class="op" id="6694740">,</span>&nbsp;<span class="ident" id="6694742">err</span>&nbsp;<span class="op" id="6694746">:=</span>&nbsp;<span class="ident" id="6694749">ResolveUnixAddr</span><span class="op" id="6694764">(</span><span class="string" id="6694765">&#34;unixgram&#34;</span><span class="op" id="6694775">,</span>&nbsp;<span class="ident" id="6694777">addr2</span><span class="op" id="6694782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694785">if</span>&nbsp;<span class="ident" id="6694788">err</span>&nbsp;<span class="op" id="6694792">!=</span>&nbsp;<span class="ident" id="6694795">nil</span>&nbsp;<span class="op" id="6694799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694803">t</span><span class="op" id="6694804">.</span><span class="ident" id="6694805">Fatalf</span><span class="op" id="6694811">(</span><span class="string" id="6694812">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6694840">,</span>&nbsp;<span class="ident" id="6694842">err</span><span class="op" id="6694845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694851">c2</span><span class="op" id="6694853">,</span>&nbsp;<span class="ident" id="6694855">err</span>&nbsp;<span class="op" id="6694859">:=</span>&nbsp;<span class="ident" id="6694862">DialUnix</span><span class="op" id="6694870">(</span><span class="string" id="6694871">&#34;unixgram&#34;</span><span class="op" id="6694881">,</span>&nbsp;<span class="ident" id="6694883">a2</span><span class="op" id="6694885">,</span>&nbsp;<span class="ident" id="6694887">nil</span><span class="op" id="6694890">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694893">if</span>&nbsp;<span class="ident" id="6694896">err</span>&nbsp;<span class="op" id="6694900">!=</span>&nbsp;<span class="ident" id="6694903">nil</span>&nbsp;<span class="op" id="6694907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694911">t</span><span class="op" id="6694912">.</span><span class="ident" id="6694913">Fatalf</span><span class="op" id="6694919">(</span><span class="string" id="6694920">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6694941">,</span>&nbsp;<span class="ident" id="6694943">err</span><span class="op" id="6694946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694952">defer</span>&nbsp;<span class="ident" id="6694958">c2</span><span class="op" id="6694960">.</span><span class="ident" id="6694961">Close</span><span class="op" id="6694966">(</span><span class="op" id="6694967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694970">defer</span>&nbsp;<span class="ident" id="6694976">os</span><span class="op" id="6694978">.</span><span class="ident" id="6694979">Remove</span><span class="op" id="6694985">(</span><span class="ident" id="6694986">addr2</span><span class="op" id="6694991">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694994">c2</span><span class="op" id="6694996">.</span><span class="ident" id="6694997">LocalAddr</span><span class="op" id="6695006">(</span><span class="op" id="6695007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695010">c2</span><span class="op" id="6695012">.</span><span class="ident" id="6695013">RemoteAddr</span><span class="op" id="6695023">(</span><span class="op" id="6695024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695027">c2</span><span class="op" id="6695029">.</span><span class="ident" id="6695030">SetDeadline</span><span class="op" id="6695041">(</span><span class="ident" id="6695042">time</span><span class="op" id="6695046">.</span><span class="ident" id="6695047">Now</span><span class="op" id="6695050">(</span><span class="op" id="6695051">)</span><span class="op" id="6695052">.</span><span class="ident" id="6695053">Add</span><span class="op" id="6695056">(</span><span class="ident" id="6695057">someTimeout</span><span class="op" id="6695068">)</span><span class="op" id="6695069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695072">c2</span><span class="op" id="6695074">.</span><span class="ident" id="6695075">SetReadDeadline</span><span class="op" id="6695090">(</span><span class="ident" id="6695091">time</span><span class="op" id="6695095">.</span><span class="ident" id="6695096">Now</span><span class="op" id="6695099">(</span><span class="op" id="6695100">)</span><span class="op" id="6695101">.</span><span class="ident" id="6695102">Add</span><span class="op" id="6695105">(</span><span class="ident" id="6695106">someTimeout</span><span class="op" id="6695117">)</span><span class="op" id="6695118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695121">c2</span><span class="op" id="6695123">.</span><span class="ident" id="6695124">SetWriteDeadline</span><span class="op" id="6695140">(</span><span class="ident" id="6695141">time</span><span class="op" id="6695145">.</span><span class="ident" id="6695146">Now</span><span class="op" id="6695149">(</span><span class="op" id="6695150">)</span><span class="op" id="6695151">.</span><span class="ident" id="6695152">Add</span><span class="op" id="6695155">(</span><span class="ident" id="6695156">someTimeout</span><span class="op" id="6695167">)</span><span class="op" id="6695168">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695171">c2</span><span class="op" id="6695173">.</span><span class="ident" id="6695174">SetReadBuffer</span><span class="op" id="6695187">(</span><span class="num" id="6695188">2048</span><span class="op" id="6695192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695195">c2</span><span class="op" id="6695197">.</span><span class="ident" id="6695198">SetWriteBuffer</span><span class="op" id="6695212">(</span><span class="num" id="6695213">2048</span><span class="op" id="6695217">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695221">a3</span><span class="op" id="6695223">,</span>&nbsp;<span class="ident" id="6695225">err</span>&nbsp;<span class="op" id="6695229">:=</span>&nbsp;<span class="ident" id="6695232">ResolveUnixAddr</span><span class="op" id="6695247">(</span><span class="string" id="6695248">&#34;unixgram&#34;</span><span class="op" id="6695258">,</span>&nbsp;<span class="ident" id="6695260">addr3</span><span class="op" id="6695265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695268">if</span>&nbsp;<span class="ident" id="6695271">err</span>&nbsp;<span class="op" id="6695275">!=</span>&nbsp;<span class="ident" id="6695278">nil</span>&nbsp;<span class="op" id="6695282">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695286">t</span><span class="op" id="6695287">.</span><span class="ident" id="6695288">Fatalf</span><span class="op" id="6695294">(</span><span class="string" id="6695295">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6695323">,</span>&nbsp;<span class="ident" id="6695325">err</span><span class="op" id="6695328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695334">c3</span><span class="op" id="6695336">,</span>&nbsp;<span class="ident" id="6695338">err</span>&nbsp;<span class="op" id="6695342">:=</span>&nbsp;<span class="ident" id="6695345">ListenUnixgram</span><span class="op" id="6695359">(</span><span class="string" id="6695360">&#34;unixgram&#34;</span><span class="op" id="6695370">,</span>&nbsp;<span class="ident" id="6695372">a3</span><span class="op" id="6695374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695377">if</span>&nbsp;<span class="ident" id="6695380">err</span>&nbsp;<span class="op" id="6695384">!=</span>&nbsp;<span class="ident" id="6695387">nil</span>&nbsp;<span class="op" id="6695391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695395">t</span><span class="op" id="6695396">.</span><span class="ident" id="6695397">Fatalf</span><span class="op" id="6695403">(</span><span class="string" id="6695404">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6695431">,</span>&nbsp;<span class="ident" id="6695433">err</span><span class="op" id="6695436">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695442">defer</span>&nbsp;<span class="ident" id="6695448">c3</span><span class="op" id="6695450">.</span><span class="ident" id="6695451">Close</span><span class="op" id="6695456">(</span><span class="op" id="6695457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695460">defer</span>&nbsp;<span class="ident" id="6695466">os</span><span class="op" id="6695468">.</span><span class="ident" id="6695469">Remove</span><span class="op" id="6695475">(</span><span class="ident" id="6695476">addr3</span><span class="op" id="6695481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695484">c3</span><span class="op" id="6695486">.</span><span class="ident" id="6695487">LocalAddr</span><span class="op" id="6695496">(</span><span class="op" id="6695497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695500">c3</span><span class="op" id="6695502">.</span><span class="ident" id="6695503">RemoteAddr</span><span class="op" id="6695513">(</span><span class="op" id="6695514">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695517">c3</span><span class="op" id="6695519">.</span><span class="ident" id="6695520">SetDeadline</span><span class="op" id="6695531">(</span><span class="ident" id="6695532">time</span><span class="op" id="6695536">.</span><span class="ident" id="6695537">Now</span><span class="op" id="6695540">(</span><span class="op" id="6695541">)</span><span class="op" id="6695542">.</span><span class="ident" id="6695543">Add</span><span class="op" id="6695546">(</span><span class="ident" id="6695547">someTimeout</span><span class="op" id="6695558">)</span><span class="op" id="6695559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695562">c3</span><span class="op" id="6695564">.</span><span class="ident" id="6695565">SetReadDeadline</span><span class="op" id="6695580">(</span><span class="ident" id="6695581">time</span><span class="op" id="6695585">.</span><span class="ident" id="6695586">Now</span><span class="op" id="6695589">(</span><span class="op" id="6695590">)</span><span class="op" id="6695591">.</span><span class="ident" id="6695592">Add</span><span class="op" id="6695595">(</span><span class="ident" id="6695596">someTimeout</span><span class="op" id="6695607">)</span><span class="op" id="6695608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695611">c3</span><span class="op" id="6695613">.</span><span class="ident" id="6695614">SetWriteDeadline</span><span class="op" id="6695630">(</span><span class="ident" id="6695631">time</span><span class="op" id="6695635">.</span><span class="ident" id="6695636">Now</span><span class="op" id="6695639">(</span><span class="op" id="6695640">)</span><span class="op" id="6695641">.</span><span class="ident" id="6695642">Add</span><span class="op" id="6695645">(</span><span class="ident" id="6695646">someTimeout</span><span class="op" id="6695657">)</span><span class="op" id="6695658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695661">c3</span><span class="op" id="6695663">.</span><span class="ident" id="6695664">SetReadBuffer</span><span class="op" id="6695677">(</span><span class="num" id="6695678">2048</span><span class="op" id="6695682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695685">c3</span><span class="op" id="6695687">.</span><span class="ident" id="6695688">SetWriteBuffer</span><span class="op" id="6695702">(</span><span class="num" id="6695703">2048</span><span class="op" id="6695707">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695711">wb</span>&nbsp;<span class="op" id="6695714">:=</span>&nbsp;<span class="op" id="6695717">[</span><span class="op" id="6695718">]</span><span class="builtintype" id="6695719">byte</span><span class="op" id="6695723">(</span><span class="string" id="6695724">&#34;UNIXCONN&nbsp;TEST&#34;</span><span class="op" id="6695739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695742">rb1</span>&nbsp;<span class="op" id="6695746">:=</span>&nbsp;<span class="builtinfunc" id="6695749">make</span><span class="op" id="6695753">(</span><span class="op" id="6695754">[</span><span class="op" id="6695755">]</span><span class="builtintype" id="6695756">byte</span><span class="op" id="6695760">,</span>&nbsp;<span class="num" id="6695762">128</span><span class="op" id="6695765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695768">rb2</span>&nbsp;<span class="op" id="6695772">:=</span>&nbsp;<span class="builtinfunc" id="6695775">make</span><span class="op" id="6695779">(</span><span class="op" id="6695780">[</span><span class="op" id="6695781">]</span><span class="builtintype" id="6695782">byte</span><span class="op" id="6695786">,</span>&nbsp;<span class="num" id="6695788">128</span><span class="op" id="6695791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695794">rb3</span>&nbsp;<span class="op" id="6695798">:=</span>&nbsp;<span class="builtinfunc" id="6695801">make</span><span class="op" id="6695805">(</span><span class="op" id="6695806">[</span><span class="op" id="6695807">]</span><span class="builtintype" id="6695808">byte</span><span class="op" id="6695812">,</span>&nbsp;<span class="num" id="6695814">128</span><span class="op" id="6695817">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695820">if</span>&nbsp;<span class="ident" id="6695823">_</span><span class="op" id="6695824">,</span>&nbsp;<span class="ident" id="6695826">_</span><span class="op" id="6695827">,</span>&nbsp;<span class="ident" id="6695829">err</span>&nbsp;<span class="op" id="6695833">:=</span>&nbsp;<span class="ident" id="6695836">c1</span><span class="op" id="6695838">.</span><span class="ident" id="6695839">WriteMsgUnix</span><span class="op" id="6695851">(</span><span class="ident" id="6695852">wb</span><span class="op" id="6695854">,</span>&nbsp;<span class="ident" id="6695856">nil</span><span class="op" id="6695859">,</span>&nbsp;<span class="ident" id="6695861">a2</span><span class="op" id="6695863">)</span><span class="op" id="6695864">;</span>&nbsp;<span class="ident" id="6695866">err</span>&nbsp;<span class="op" id="6695870">!=</span>&nbsp;<span class="ident" id="6695873">nil</span>&nbsp;<span class="op" id="6695877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695881">t</span><span class="op" id="6695882">.</span><span class="ident" id="6695883">Fatalf</span><span class="op" id="6695889">(</span><span class="string" id="6695890">&#34;UnixConn.WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6695924">,</span>&nbsp;<span class="ident" id="6695926">err</span><span class="op" id="6695929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695935">if</span>&nbsp;<span class="ident" id="6695938">_</span><span class="op" id="6695939">,</span>&nbsp;<span class="ident" id="6695941">_</span><span class="op" id="6695942">,</span>&nbsp;<span class="ident" id="6695944">_</span><span class="op" id="6695945">,</span>&nbsp;<span class="ident" id="6695947">_</span><span class="op" id="6695948">,</span>&nbsp;<span class="ident" id="6695950">err</span>&nbsp;<span class="op" id="6695954">:=</span>&nbsp;<span class="ident" id="6695957">c2</span><span class="op" id="6695959">.</span><span class="ident" id="6695960">ReadMsgUnix</span><span class="op" id="6695971">(</span><span class="ident" id="6695972">rb2</span><span class="op" id="6695975">,</span>&nbsp;<span class="ident" id="6695977">nil</span><span class="op" id="6695980">)</span><span class="op" id="6695981">;</span>&nbsp;<span class="ident" id="6695983">err</span>&nbsp;<span class="op" id="6695987">!=</span>&nbsp;<span class="ident" id="6695990">nil</span>&nbsp;<span class="op" id="6695994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695998">t</span><span class="op" id="6695999">.</span><span class="ident" id="6696000">Fatalf</span><span class="op" id="6696006">(</span><span class="string" id="6696007">&#34;UnixConn.ReadMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6696040">,</span>&nbsp;<span class="ident" id="6696042">err</span><span class="op" id="6696045">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696051">if</span>&nbsp;<span class="ident" id="6696054">_</span><span class="op" id="6696055">,</span>&nbsp;<span class="ident" id="6696057">err</span>&nbsp;<span class="op" id="6696061">:=</span>&nbsp;<span class="ident" id="6696064">c2</span><span class="op" id="6696066">.</span><span class="ident" id="6696067">WriteToUnix</span><span class="op" id="6696078">(</span><span class="ident" id="6696079">wb</span><span class="op" id="6696081">,</span>&nbsp;<span class="ident" id="6696083">a1</span><span class="op" id="6696085">)</span><span class="op" id="6696086">;</span>&nbsp;<span class="ident" id="6696088">err</span>&nbsp;<span class="op" id="6696092">!=</span>&nbsp;<span class="ident" id="6696095">nil</span>&nbsp;<span class="op" id="6696099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696103">t</span><span class="op" id="6696104">.</span><span class="ident" id="6696105">Fatalf</span><span class="op" id="6696111">(</span><span class="string" id="6696112">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6696145">,</span>&nbsp;<span class="ident" id="6696147">err</span><span class="op" id="6696150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696156">if</span>&nbsp;<span class="ident" id="6696159">_</span><span class="op" id="6696160">,</span>&nbsp;<span class="ident" id="6696162">_</span><span class="op" id="6696163">,</span>&nbsp;<span class="ident" id="6696165">err</span>&nbsp;<span class="op" id="6696169">:=</span>&nbsp;<span class="ident" id="6696172">c1</span><span class="op" id="6696174">.</span><span class="ident" id="6696175">ReadFromUnix</span><span class="op" id="6696187">(</span><span class="ident" id="6696188">rb1</span><span class="op" id="6696191">)</span><span class="op" id="6696192">;</span>&nbsp;<span class="ident" id="6696194">err</span>&nbsp;<span class="op" id="6696198">!=</span>&nbsp;<span class="ident" id="6696201">nil</span>&nbsp;<span class="op" id="6696205">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696209">t</span><span class="op" id="6696210">.</span><span class="ident" id="6696211">Fatalf</span><span class="op" id="6696217">(</span><span class="string" id="6696218">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6696252">,</span>&nbsp;<span class="ident" id="6696254">err</span><span class="op" id="6696257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696263">if</span>&nbsp;<span class="ident" id="6696266">_</span><span class="op" id="6696267">,</span>&nbsp;<span class="ident" id="6696269">err</span>&nbsp;<span class="op" id="6696273">:=</span>&nbsp;<span class="ident" id="6696276">c3</span><span class="op" id="6696278">.</span><span class="ident" id="6696279">WriteToUnix</span><span class="op" id="6696290">(</span><span class="ident" id="6696291">wb</span><span class="op" id="6696293">,</span>&nbsp;<span class="ident" id="6696295">a1</span><span class="op" id="6696297">)</span><span class="op" id="6696298">;</span>&nbsp;<span class="ident" id="6696300">err</span>&nbsp;<span class="op" id="6696304">!=</span>&nbsp;<span class="ident" id="6696307">nil</span>&nbsp;<span class="op" id="6696311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696315">t</span><span class="op" id="6696316">.</span><span class="ident" id="6696317">Fatalf</span><span class="op" id="6696323">(</span><span class="string" id="6696324">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6696357">,</span>&nbsp;<span class="ident" id="6696359">err</span><span class="op" id="6696362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696365">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696368">if</span>&nbsp;<span class="ident" id="6696371">_</span><span class="op" id="6696372">,</span>&nbsp;<span class="ident" id="6696374">_</span><span class="op" id="6696375">,</span>&nbsp;<span class="ident" id="6696377">err</span>&nbsp;<span class="op" id="6696381">:=</span>&nbsp;<span class="ident" id="6696384">c1</span><span class="op" id="6696386">.</span><span class="ident" id="6696387">ReadFromUnix</span><span class="op" id="6696399">(</span><span class="ident" id="6696400">rb1</span><span class="op" id="6696403">)</span><span class="op" id="6696404">;</span>&nbsp;<span class="ident" id="6696406">err</span>&nbsp;<span class="op" id="6696410">!=</span>&nbsp;<span class="ident" id="6696413">nil</span>&nbsp;<span class="op" id="6696417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696421">t</span><span class="op" id="6696422">.</span><span class="ident" id="6696423">Fatalf</span><span class="op" id="6696429">(</span><span class="string" id="6696430">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6696464">,</span>&nbsp;<span class="ident" id="6696466">err</span><span class="op" id="6696469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696475">if</span>&nbsp;<span class="ident" id="6696478">_</span><span class="op" id="6696479">,</span>&nbsp;<span class="ident" id="6696481">err</span>&nbsp;<span class="op" id="6696485">:=</span>&nbsp;<span class="ident" id="6696488">c2</span><span class="op" id="6696490">.</span><span class="ident" id="6696491">WriteToUnix</span><span class="op" id="6696502">(</span><span class="ident" id="6696503">wb</span><span class="op" id="6696505">,</span>&nbsp;<span class="ident" id="6696507">a3</span><span class="op" id="6696509">)</span><span class="op" id="6696510">;</span>&nbsp;<span class="ident" id="6696512">err</span>&nbsp;<span class="op" id="6696516">!=</span>&nbsp;<span class="ident" id="6696519">nil</span>&nbsp;<span class="op" id="6696523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696527">t</span><span class="op" id="6696528">.</span><span class="ident" id="6696529">Fatalf</span><span class="op" id="6696535">(</span><span class="string" id="6696536">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6696569">,</span>&nbsp;<span class="ident" id="6696571">err</span><span class="op" id="6696574">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696580">if</span>&nbsp;<span class="ident" id="6696583">_</span><span class="op" id="6696584">,</span>&nbsp;<span class="ident" id="6696586">_</span><span class="op" id="6696587">,</span>&nbsp;<span class="ident" id="6696589">err</span>&nbsp;<span class="op" id="6696593">:=</span>&nbsp;<span class="ident" id="6696596">c3</span><span class="op" id="6696598">.</span><span class="ident" id="6696599">ReadFromUnix</span><span class="op" id="6696611">(</span><span class="ident" id="6696612">rb3</span><span class="op" id="6696615">)</span><span class="op" id="6696616">;</span>&nbsp;<span class="ident" id="6696618">err</span>&nbsp;<span class="op" id="6696622">!=</span>&nbsp;<span class="ident" id="6696625">nil</span>&nbsp;<span class="op" id="6696629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696633">t</span><span class="op" id="6696634">.</span><span class="ident" id="6696635">Fatalf</span><span class="op" id="6696641">(</span><span class="string" id="6696642">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6696676">,</span>&nbsp;<span class="ident" id="6696678">err</span><span class="op" id="6696681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696688">if</span>&nbsp;<span class="ident" id="6696691">f</span><span class="op" id="6696692">,</span>&nbsp;<span class="ident" id="6696694">err</span>&nbsp;<span class="op" id="6696698">:=</span>&nbsp;<span class="ident" id="6696701">c1</span><span class="op" id="6696703">.</span><span class="ident" id="6696704">File</span><span class="op" id="6696708">(</span><span class="op" id="6696709">)</span><span class="op" id="6696710">;</span>&nbsp;<span class="ident" id="6696712">err</span>&nbsp;<span class="op" id="6696716">!=</span>&nbsp;<span class="ident" id="6696719">nil</span>&nbsp;<span class="op" id="6696723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696727">t</span><span class="op" id="6696728">.</span><span class="ident" id="6696729">Fatalf</span><span class="op" id="6696735">(</span><span class="string" id="6696736">&#34;UnixConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6696762">,</span>&nbsp;<span class="ident" id="6696764">err</span><span class="op" id="6696767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696770">}</span>&nbsp;<span class="keyword" id="6696772">else</span>&nbsp;<span class="op" id="6696777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696781">f</span><span class="op" id="6696782">.</span><span class="ident" id="6696783">Close</span><span class="op" id="6696788">(</span><span class="op" id="6696789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696792">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696796">defer</span>&nbsp;<span class="keyword" id="6696802">func</span><span class="op" id="6696806">(</span><span class="op" id="6696807">)</span>&nbsp;<span class="op" id="6696809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696813">if</span>&nbsp;<span class="ident" id="6696816">p</span>&nbsp;<span class="op" id="6696818">:=</span>&nbsp;<span class="builtinfunc" id="6696821">recover</span><span class="op" id="6696828">(</span><span class="op" id="6696829">)</span><span class="op" id="6696830">;</span>&nbsp;<span class="ident" id="6696832">p</span>&nbsp;<span class="op" id="6696834">!=</span>&nbsp;<span class="ident" id="6696837">nil</span>&nbsp;<span class="op" id="6696841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696846">t</span><span class="op" id="6696847">.</span><span class="ident" id="6696848">Fatalf</span><span class="op" id="6696854">(</span><span class="string" id="6696855">&#34;UnixConn.WriteToUnix&nbsp;or&nbsp;WriteMsgUnix&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6696906">,</span>&nbsp;<span class="ident" id="6696908">p</span><span class="op" id="6696909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696913">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696916">}</span><span class="op" id="6696917">(</span><span class="op" id="6696918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696922">c1</span><span class="op" id="6696924">.</span><span class="ident" id="6696925">WriteToUnix</span><span class="op" id="6696936">(</span><span class="ident" id="6696937">wb</span><span class="op" id="6696939">,</span>&nbsp;<span class="ident" id="6696941">nil</span><span class="op" id="6696944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696947">c1</span><span class="op" id="6696949">.</span><span class="ident" id="6696950">WriteMsgUnix</span><span class="op" id="6696962">(</span><span class="ident" id="6696963">wb</span><span class="op" id="6696965">,</span>&nbsp;<span class="ident" id="6696967">nil</span><span class="op" id="6696970">,</span>&nbsp;<span class="ident" id="6696972">nil</span><span class="op" id="6696975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696978">c3</span><span class="op" id="6696980">.</span><span class="ident" id="6696981">WriteToUnix</span><span class="op" id="6696992">(</span><span class="ident" id="6696993">wb</span><span class="op" id="6696995">,</span>&nbsp;<span class="ident" id="6696997">nil</span><span class="op" id="6697000">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697003">c3</span><span class="op" id="6697005">.</span><span class="ident" id="6697006">WriteMsgUnix</span><span class="op" id="6697018">(</span><span class="ident" id="6697019">wb</span><span class="op" id="6697021">,</span>&nbsp;<span class="ident" id="6697023">nil</span><span class="op" id="6697026">,</span>&nbsp;<span class="ident" id="6697028">nil</span><span class="op" id="6697031">)</span><br>
<span class="lineno"></span><span class="op" id="6697033">}</span>
</div>
</body>
</html>
