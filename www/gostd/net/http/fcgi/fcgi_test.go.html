<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6921819">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6921874">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6921928">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6921979">package</span>&nbsp;<span class="ident" id="6921987">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6921993">import</span>&nbsp;<span class="op" id="6922000">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6922003">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6922012">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6922022">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6922028">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6922038">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6922041">var</span>&nbsp;<span class="ident" id="6922045">sizeTests</span>&nbsp;<span class="op" id="6922055">=</span>&nbsp;<span class="op" id="6922057">[</span><span class="op" id="6922058">]</span><span class="keyword" id="6922059">struct</span>&nbsp;<span class="op" id="6922066">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922069">size</span>&nbsp;&nbsp;<span class="builtintype" id="6922075">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922083">bytes</span>&nbsp;<span class="op" id="6922089">[</span><span class="op" id="6922090">]</span><span class="builtintype" id="6922091">byte</span><br>
<span class="lineno"></span><span class="op" id="6922096">}</span><span class="op" id="6922097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922100">{</span><span class="num" id="6922101">0</span><span class="op" id="6922102">,</span>&nbsp;<span class="op" id="6922104">[</span><span class="op" id="6922105">]</span><span class="builtintype" id="6922106">byte</span><span class="op" id="6922110">{</span><span class="num" id="6922111">0x00</span><span class="op" id="6922115">}</span><span class="op" id="6922116">}</span><span class="op" id="6922117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922120">{</span><span class="num" id="6922121">127</span><span class="op" id="6922124">,</span>&nbsp;<span class="op" id="6922126">[</span><span class="op" id="6922127">]</span><span class="builtintype" id="6922128">byte</span><span class="op" id="6922132">{</span><span class="num" id="6922133">0x7F</span><span class="op" id="6922137">}</span><span class="op" id="6922138">}</span><span class="op" id="6922139">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922142">{</span><span class="num" id="6922143">128</span><span class="op" id="6922146">,</span>&nbsp;<span class="op" id="6922148">[</span><span class="op" id="6922149">]</span><span class="builtintype" id="6922150">byte</span><span class="op" id="6922154">{</span><span class="num" id="6922155">0x80</span><span class="op" id="6922159">,</span>&nbsp;<span class="num" id="6922161">0x00</span><span class="op" id="6922165">,</span>&nbsp;<span class="num" id="6922167">0x00</span><span class="op" id="6922171">,</span>&nbsp;<span class="num" id="6922173">0x80</span><span class="op" id="6922177">}</span><span class="op" id="6922178">}</span><span class="op" id="6922179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922182">{</span><span class="num" id="6922183">1000</span><span class="op" id="6922187">,</span>&nbsp;<span class="op" id="6922189">[</span><span class="op" id="6922190">]</span><span class="builtintype" id="6922191">byte</span><span class="op" id="6922195">{</span><span class="num" id="6922196">0x80</span><span class="op" id="6922200">,</span>&nbsp;<span class="num" id="6922202">0x00</span><span class="op" id="6922206">,</span>&nbsp;<span class="num" id="6922208">0x03</span><span class="op" id="6922212">,</span>&nbsp;<span class="num" id="6922214">0xE8</span><span class="op" id="6922218">}</span><span class="op" id="6922219">}</span><span class="op" id="6922220">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922223">{</span><span class="num" id="6922224">33554431</span><span class="op" id="6922232">,</span>&nbsp;<span class="op" id="6922234">[</span><span class="op" id="6922235">]</span><span class="builtintype" id="6922236">byte</span><span class="op" id="6922240">{</span><span class="num" id="6922241">0x81</span><span class="op" id="6922245">,</span>&nbsp;<span class="num" id="6922247">0xFF</span><span class="op" id="6922251">,</span>&nbsp;<span class="num" id="6922253">0xFF</span><span class="op" id="6922257">,</span>&nbsp;<span class="num" id="6922259">0xFF</span><span class="op" id="6922263">}</span><span class="op" id="6922264">}</span><span class="op" id="6922265">,</span><br>
<span class="lineno"></span><span class="op" id="6922267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6922270">func</span>&nbsp;<span class="ident" id="6922275">TestSize</span><span class="op" id="6922283">(</span><span class="ident" id="6922284">t</span>&nbsp;<span class="op" id="6922286">*</span><span class="ident" id="6922287">testing</span><span class="op" id="6922294">.</span><span class="ident" id="6922295">T</span><span class="op" id="6922296">)</span>&nbsp;<span class="op" id="6922298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922301">b</span>&nbsp;<span class="op" id="6922303">:=</span>&nbsp;<span class="builtinfunc" id="6922306">make</span><span class="op" id="6922310">(</span><span class="op" id="6922311">[</span><span class="op" id="6922312">]</span><span class="builtintype" id="6922313">byte</span><span class="op" id="6922317">,</span>&nbsp;<span class="num" id="6922319">4</span><span class="op" id="6922320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922323">for</span>&nbsp;<span class="ident" id="6922327">i</span><span class="op" id="6922328">,</span>&nbsp;<span class="ident" id="6922330">test</span>&nbsp;<span class="op" id="6922335">:=</span>&nbsp;<span class="keyword" id="6922338">range</span>&nbsp;<span class="ident" id="6922344">sizeTests</span>&nbsp;<span class="op" id="6922354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922358">n</span>&nbsp;<span class="op" id="6922360">:=</span>&nbsp;<span class="ident" id="6922363">encodeSize</span><span class="op" id="6922373">(</span><span class="ident" id="6922374">b</span><span class="op" id="6922375">,</span>&nbsp;<span class="ident" id="6922377">test</span><span class="op" id="6922381">.</span><span class="ident" id="6922382">size</span><span class="op" id="6922386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922390">if</span>&nbsp;<span class="op" id="6922393">!</span><span class="ident" id="6922394">bytes</span><span class="op" id="6922399">.</span><span class="ident" id="6922400">Equal</span><span class="op" id="6922405">(</span><span class="ident" id="6922406">b</span><span class="op" id="6922407">[</span><span class="op" id="6922408">:</span><span class="ident" id="6922409">n</span><span class="op" id="6922410">]</span><span class="op" id="6922411">,</span>&nbsp;<span class="ident" id="6922413">test</span><span class="op" id="6922417">.</span><span class="ident" id="6922418">bytes</span><span class="op" id="6922423">)</span>&nbsp;<span class="op" id="6922425">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922430">t</span><span class="op" id="6922431">.</span><span class="ident" id="6922432">Errorf</span><span class="op" id="6922438">(</span><span class="string" id="6922439">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="6922467">,</span>&nbsp;<span class="ident" id="6922469">i</span><span class="op" id="6922470">,</span>&nbsp;<span class="ident" id="6922472">test</span><span class="op" id="6922476">.</span><span class="ident" id="6922477">bytes</span><span class="op" id="6922482">,</span>&nbsp;<span class="ident" id="6922484">b</span><span class="op" id="6922485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922493">size</span><span class="op" id="6922497">,</span>&nbsp;<span class="ident" id="6922499">n</span>&nbsp;<span class="op" id="6922501">:=</span>&nbsp;<span class="ident" id="6922504">readSize</span><span class="op" id="6922512">(</span><span class="ident" id="6922513">test</span><span class="op" id="6922517">.</span><span class="ident" id="6922518">bytes</span><span class="op" id="6922523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922527">if</span>&nbsp;<span class="ident" id="6922530">size</span>&nbsp;<span class="op" id="6922535">!=</span>&nbsp;<span class="ident" id="6922538">test</span><span class="op" id="6922542">.</span><span class="ident" id="6922543">size</span>&nbsp;<span class="op" id="6922548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922553">t</span><span class="op" id="6922554">.</span><span class="ident" id="6922555">Errorf</span><span class="op" id="6922561">(</span><span class="string" id="6922562">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6922587">,</span>&nbsp;<span class="ident" id="6922589">i</span><span class="op" id="6922590">,</span>&nbsp;<span class="ident" id="6922592">test</span><span class="op" id="6922596">.</span><span class="ident" id="6922597">size</span><span class="op" id="6922601">,</span>&nbsp;<span class="ident" id="6922603">size</span><span class="op" id="6922607">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6922615">if</span>&nbsp;<span class="builtinfunc" id="6922618">len</span><span class="op" id="6922621">(</span><span class="ident" id="6922622">test</span><span class="op" id="6922626">.</span><span class="ident" id="6922627">bytes</span><span class="op" id="6922632">)</span>&nbsp;<span class="op" id="6922634">!=</span>&nbsp;<span class="ident" id="6922637">n</span>&nbsp;<span class="op" id="6922639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922644">t</span><span class="op" id="6922645">.</span><span class="ident" id="6922646">Errorf</span><span class="op" id="6922652">(</span><span class="string" id="6922653">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="6922687">,</span>&nbsp;<span class="ident" id="6922689">i</span><span class="op" id="6922690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922697">}</span><br>
<span class="lineno">40</span><span class="op" id="6922699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6922702">var</span>&nbsp;<span class="ident" id="6922706">streamTests</span>&nbsp;<span class="op" id="6922718">=</span>&nbsp;<span class="op" id="6922720">[</span><span class="op" id="6922721">]</span><span class="keyword" id="6922722">struct</span>&nbsp;<span class="op" id="6922729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922732">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6922740">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922748">recType</span>&nbsp;<span class="ident" id="6922756">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922765">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6922773">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922781">content</span>&nbsp;<span class="op" id="6922789">[</span><span class="op" id="6922790">]</span><span class="builtintype" id="6922791">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6922797">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6922805">[</span><span class="op" id="6922806">]</span><span class="builtintype" id="6922807">byte</span><br>
<span class="lineno"></span><span class="op" id="6922812">}</span><span class="op" id="6922813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922816">{</span><span class="string" id="6922817">&#34;single&nbsp;record&#34;</span><span class="op" id="6922832">,</span>&nbsp;<span class="ident" id="6922834">typeStdout</span><span class="op" id="6922844">,</span>&nbsp;<span class="num" id="6922846">1</span><span class="op" id="6922847">,</span>&nbsp;<span class="ident" id="6922849">nil</span><span class="op" id="6922852">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922856">[</span><span class="op" id="6922857">]</span><span class="builtintype" id="6922858">byte</span><span class="op" id="6922862">{</span><span class="num" id="6922863">1</span><span class="op" id="6922864">,</span>&nbsp;<span class="builtintype" id="6922866">byte</span><span class="op" id="6922870">(</span><span class="ident" id="6922871">typeStdout</span><span class="op" id="6922881">)</span><span class="op" id="6922882">,</span>&nbsp;<span class="num" id="6922884">0</span><span class="op" id="6922885">,</span>&nbsp;<span class="num" id="6922887">1</span><span class="op" id="6922888">,</span>&nbsp;<span class="num" id="6922890">0</span><span class="op" id="6922891">,</span>&nbsp;<span class="num" id="6922893">0</span><span class="op" id="6922894">,</span>&nbsp;<span class="num" id="6922896">0</span><span class="op" id="6922897">,</span>&nbsp;<span class="num" id="6922899">0</span><span class="op" id="6922900">}</span><span class="op" id="6922901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922904">}</span><span class="op" id="6922905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6922908">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6922961">{</span><span class="string" id="6922962">&#34;two&nbsp;records&#34;</span><span class="op" id="6922975">,</span>&nbsp;<span class="ident" id="6922977">typeStdin</span><span class="op" id="6922986">,</span>&nbsp;<span class="num" id="6922988">300</span><span class="op" id="6922991">,</span>&nbsp;<span class="builtinfunc" id="6922993">make</span><span class="op" id="6922997">(</span><span class="op" id="6922998">[</span><span class="op" id="6922999">]</span><span class="builtintype" id="6923000">byte</span><span class="op" id="6923004">,</span>&nbsp;<span class="num" id="6923006">66000</span><span class="op" id="6923011">)</span><span class="op" id="6923012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923016">bytes</span><span class="op" id="6923021">.</span><span class="ident" id="6923022">Join</span><span class="op" id="6923026">(</span><span class="op" id="6923027">[</span><span class="op" id="6923028">]</span><span class="op" id="6923029">[</span><span class="op" id="6923030">]</span><span class="builtintype" id="6923031">byte</span><span class="op" id="6923035">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6923040">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923074">{</span><span class="num" id="6923075">1</span><span class="op" id="6923076">,</span>&nbsp;<span class="builtintype" id="6923078">byte</span><span class="op" id="6923082">(</span><span class="ident" id="6923083">typeStdin</span><span class="op" id="6923092">)</span><span class="op" id="6923093">,</span>&nbsp;<span class="num" id="6923095">0x01</span><span class="op" id="6923099">,</span>&nbsp;<span class="num" id="6923101">0x2C</span><span class="op" id="6923105">,</span>&nbsp;<span class="num" id="6923107">0xFF</span><span class="op" id="6923111">,</span>&nbsp;<span class="num" id="6923113">0xFF</span><span class="op" id="6923117">,</span>&nbsp;<span class="num" id="6923119">1</span><span class="op" id="6923120">,</span>&nbsp;<span class="num" id="6923122">0</span><span class="op" id="6923123">}</span><span class="op" id="6923124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6923129">make</span><span class="op" id="6923133">(</span><span class="op" id="6923134">[</span><span class="op" id="6923135">]</span><span class="builtintype" id="6923136">byte</span><span class="op" id="6923140">,</span>&nbsp;<span class="num" id="6923142">65536</span><span class="op" id="6923147">)</span><span class="op" id="6923148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6923153">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923181">{</span><span class="num" id="6923182">1</span><span class="op" id="6923183">,</span>&nbsp;<span class="builtintype" id="6923185">byte</span><span class="op" id="6923189">(</span><span class="ident" id="6923190">typeStdin</span><span class="op" id="6923199">)</span><span class="op" id="6923200">,</span>&nbsp;<span class="num" id="6923202">0x01</span><span class="op" id="6923206">,</span>&nbsp;<span class="num" id="6923208">0x2C</span><span class="op" id="6923212">,</span>&nbsp;<span class="num" id="6923214">0x01</span><span class="op" id="6923218">,</span>&nbsp;<span class="num" id="6923220">0xD1</span><span class="op" id="6923224">,</span>&nbsp;<span class="num" id="6923226">7</span><span class="op" id="6923227">,</span>&nbsp;<span class="num" id="6923229">0</span><span class="op" id="6923230">}</span><span class="op" id="6923231">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6923236">make</span><span class="op" id="6923240">(</span><span class="op" id="6923241">[</span><span class="op" id="6923242">]</span><span class="builtintype" id="6923243">byte</span><span class="op" id="6923247">,</span>&nbsp;<span class="num" id="6923249">472</span><span class="op" id="6923252">)</span><span class="op" id="6923253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6923258">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923292">{</span><span class="num" id="6923293">1</span><span class="op" id="6923294">,</span>&nbsp;<span class="builtintype" id="6923296">byte</span><span class="op" id="6923300">(</span><span class="ident" id="6923301">typeStdin</span><span class="op" id="6923310">)</span><span class="op" id="6923311">,</span>&nbsp;<span class="num" id="6923313">0x01</span><span class="op" id="6923317">,</span>&nbsp;<span class="num" id="6923319">0x2C</span><span class="op" id="6923323">,</span>&nbsp;<span class="num" id="6923325">0</span><span class="op" id="6923326">,</span>&nbsp;<span class="num" id="6923328">0</span><span class="op" id="6923329">,</span>&nbsp;<span class="num" id="6923331">0</span><span class="op" id="6923332">,</span>&nbsp;<span class="num" id="6923334">0</span><span class="op" id="6923335">}</span><span class="op" id="6923336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923340">}</span><span class="op" id="6923341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923346">nil</span><span class="op" id="6923349">)</span><span class="op" id="6923350">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923353">}</span><span class="op" id="6923354">,</span><br>
<span class="lineno"></span><span class="op" id="6923356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6923359">type</span>&nbsp;<span class="ident" id="6923364">nilCloser</span>&nbsp;<span class="keyword" id="6923374">struct</span>&nbsp;<span class="op" id="6923381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923384">io</span><span class="op" id="6923386">.</span><span class="ident" id="6923387">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="6923398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6923401">func</span>&nbsp;<span class="op" id="6923406">(</span><span class="ident" id="6923407">c</span>&nbsp;<span class="op" id="6923409">*</span><span class="ident" id="6923410">nilCloser</span><span class="op" id="6923419">)</span>&nbsp;<span class="ident" id="6923421">Close</span><span class="op" id="6923426">(</span><span class="op" id="6923427">)</span>&nbsp;<span class="builtintype" id="6923429">error</span>&nbsp;<span class="op" id="6923435">{</span>&nbsp;<span class="keyword" id="6923437">return</span>&nbsp;<span class="ident" id="6923444">nil</span>&nbsp;<span class="op" id="6923448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6923451">func</span>&nbsp;<span class="ident" id="6923456">TestStreams</span><span class="op" id="6923467">(</span><span class="ident" id="6923468">t</span>&nbsp;<span class="op" id="6923470">*</span><span class="ident" id="6923471">testing</span><span class="op" id="6923478">.</span><span class="ident" id="6923479">T</span><span class="op" id="6923480">)</span>&nbsp;<span class="op" id="6923482">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923485">var</span>&nbsp;<span class="ident" id="6923489">rec</span>&nbsp;<span class="ident" id="6923493">record</span><br>
<span class="lineno"></span><span class="ident" id="6923500">outer</span><span class="op" id="6923505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923508">for</span>&nbsp;<span class="ident" id="6923512">_</span><span class="op" id="6923513">,</span>&nbsp;<span class="ident" id="6923515">test</span>&nbsp;<span class="op" id="6923520">:=</span>&nbsp;<span class="keyword" id="6923523">range</span>&nbsp;<span class="ident" id="6923529">streamTests</span>&nbsp;<span class="op" id="6923541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923545">buf</span>&nbsp;<span class="op" id="6923549">:=</span>&nbsp;<span class="ident" id="6923552">bytes</span><span class="op" id="6923557">.</span><span class="ident" id="6923558">NewBuffer</span><span class="op" id="6923567">(</span><span class="ident" id="6923568">test</span><span class="op" id="6923572">.</span><span class="ident" id="6923573">raw</span><span class="op" id="6923576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923580">var</span>&nbsp;<span class="ident" id="6923584">content</span>&nbsp;<span class="op" id="6923592">[</span><span class="op" id="6923593">]</span><span class="builtintype" id="6923594">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923601">for</span>&nbsp;<span class="ident" id="6923605">buf</span><span class="op" id="6923608">.</span><span class="ident" id="6923609">Len</span><span class="op" id="6923612">(</span><span class="op" id="6923613">)</span>&nbsp;<span class="op" id="6923615">&gt;</span>&nbsp;<span class="num" id="6923617">0</span>&nbsp;<span class="op" id="6923619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923624">if</span>&nbsp;<span class="ident" id="6923627">err</span>&nbsp;<span class="op" id="6923631">:=</span>&nbsp;<span class="ident" id="6923634">rec</span><span class="op" id="6923637">.</span><span class="ident" id="6923638">read</span><span class="op" id="6923642">(</span><span class="ident" id="6923643">buf</span><span class="op" id="6923646">)</span><span class="op" id="6923647">;</span>&nbsp;<span class="ident" id="6923649">err</span>&nbsp;<span class="op" id="6923653">!=</span>&nbsp;<span class="ident" id="6923656">nil</span>&nbsp;<span class="op" id="6923660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923666">t</span><span class="op" id="6923667">.</span><span class="ident" id="6923668">Errorf</span><span class="op" id="6923674">(</span><span class="string" id="6923675">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6923705">,</span>&nbsp;<span class="ident" id="6923707">test</span><span class="op" id="6923711">.</span><span class="ident" id="6923712">desc</span><span class="op" id="6923716">,</span>&nbsp;<span class="ident" id="6923718">err</span><span class="op" id="6923721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923727">continue</span>&nbsp;<span class="ident" id="6923736">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923745">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923750">content</span>&nbsp;<span class="op" id="6923758">=</span>&nbsp;<span class="builtinfunc" id="6923760">append</span><span class="op" id="6923766">(</span><span class="ident" id="6923767">content</span><span class="op" id="6923774">,</span>&nbsp;<span class="ident" id="6923776">rec</span><span class="op" id="6923779">.</span><span class="ident" id="6923780">content</span><span class="op" id="6923787">(</span><span class="op" id="6923788">)</span><span class="op" id="6923789">...</span><span class="op" id="6923792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923800">if</span>&nbsp;<span class="ident" id="6923803">rec</span><span class="op" id="6923806">.</span><span class="ident" id="6923807">h</span><span class="op" id="6923808">.</span><span class="ident" id="6923809">Type</span>&nbsp;<span class="op" id="6923814">!=</span>&nbsp;<span class="ident" id="6923817">test</span><span class="op" id="6923821">.</span><span class="ident" id="6923822">recType</span>&nbsp;<span class="op" id="6923830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923835">t</span><span class="op" id="6923836">.</span><span class="ident" id="6923837">Errorf</span><span class="op" id="6923843">(</span><span class="string" id="6923844">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6923873">,</span>&nbsp;<span class="ident" id="6923875">test</span><span class="op" id="6923879">.</span><span class="ident" id="6923880">desc</span><span class="op" id="6923884">,</span>&nbsp;<span class="ident" id="6923886">rec</span><span class="op" id="6923889">.</span><span class="ident" id="6923890">h</span><span class="op" id="6923891">.</span><span class="ident" id="6923892">Type</span><span class="op" id="6923896">,</span>&nbsp;<span class="ident" id="6923898">test</span><span class="op" id="6923902">.</span><span class="ident" id="6923903">recType</span><span class="op" id="6923910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923915">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6923926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6923930">if</span>&nbsp;<span class="ident" id="6923933">rec</span><span class="op" id="6923936">.</span><span class="ident" id="6923937">h</span><span class="op" id="6923938">.</span><span class="ident" id="6923939">Id</span>&nbsp;<span class="op" id="6923942">!=</span>&nbsp;<span class="ident" id="6923945">test</span><span class="op" id="6923949">.</span><span class="ident" id="6923950">reqId</span>&nbsp;<span class="op" id="6923956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6923961">t</span><span class="op" id="6923962">.</span><span class="ident" id="6923963">Errorf</span><span class="op" id="6923969">(</span><span class="string" id="6923970">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6924005">,</span>&nbsp;<span class="ident" id="6924007">test</span><span class="op" id="6924011">.</span><span class="ident" id="6924012">desc</span><span class="op" id="6924016">,</span>&nbsp;<span class="ident" id="6924018">rec</span><span class="op" id="6924021">.</span><span class="ident" id="6924022">h</span><span class="op" id="6924023">.</span><span class="ident" id="6924024">Id</span><span class="op" id="6924026">,</span>&nbsp;<span class="ident" id="6924028">test</span><span class="op" id="6924032">.</span><span class="ident" id="6924033">reqId</span><span class="op" id="6924038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924043">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924054">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924058">if</span>&nbsp;<span class="op" id="6924061">!</span><span class="ident" id="6924062">bytes</span><span class="op" id="6924067">.</span><span class="ident" id="6924068">Equal</span><span class="op" id="6924073">(</span><span class="ident" id="6924074">content</span><span class="op" id="6924081">,</span>&nbsp;<span class="ident" id="6924083">test</span><span class="op" id="6924087">.</span><span class="ident" id="6924088">content</span><span class="op" id="6924095">)</span>&nbsp;<span class="op" id="6924097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924102">t</span><span class="op" id="6924103">.</span><span class="ident" id="6924104">Errorf</span><span class="op" id="6924110">(</span><span class="string" id="6924111">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6924135">,</span>&nbsp;<span class="ident" id="6924137">test</span><span class="op" id="6924141">.</span><span class="ident" id="6924142">desc</span><span class="op" id="6924146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924151">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924166">buf</span><span class="op" id="6924169">.</span><span class="ident" id="6924170">Reset</span><span class="op" id="6924175">(</span><span class="op" id="6924176">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924180">c</span>&nbsp;<span class="op" id="6924182">:=</span>&nbsp;<span class="ident" id="6924185">newConn</span><span class="op" id="6924192">(</span><span class="op" id="6924193">&amp;</span><span class="ident" id="6924194">nilCloser</span><span class="op" id="6924203">{</span><span class="ident" id="6924204">buf</span><span class="op" id="6924207">}</span><span class="op" id="6924208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924212">w</span>&nbsp;<span class="op" id="6924214">:=</span>&nbsp;<span class="ident" id="6924217">newWriter</span><span class="op" id="6924226">(</span><span class="ident" id="6924227">c</span><span class="op" id="6924228">,</span>&nbsp;<span class="ident" id="6924230">test</span><span class="op" id="6924234">.</span><span class="ident" id="6924235">recType</span><span class="op" id="6924242">,</span>&nbsp;<span class="ident" id="6924244">test</span><span class="op" id="6924248">.</span><span class="ident" id="6924249">reqId</span><span class="op" id="6924254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924258">if</span>&nbsp;<span class="ident" id="6924261">_</span><span class="op" id="6924262">,</span>&nbsp;<span class="ident" id="6924264">err</span>&nbsp;<span class="op" id="6924268">:=</span>&nbsp;<span class="ident" id="6924271">w</span><span class="op" id="6924272">.</span><span class="ident" id="6924273">Write</span><span class="op" id="6924278">(</span><span class="ident" id="6924279">test</span><span class="op" id="6924283">.</span><span class="ident" id="6924284">content</span><span class="op" id="6924291">)</span><span class="op" id="6924292">;</span>&nbsp;<span class="ident" id="6924294">err</span>&nbsp;<span class="op" id="6924298">!=</span>&nbsp;<span class="ident" id="6924301">nil</span>&nbsp;<span class="op" id="6924305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924310">t</span><span class="op" id="6924311">.</span><span class="ident" id="6924312">Errorf</span><span class="op" id="6924318">(</span><span class="string" id="6924319">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6924349">,</span>&nbsp;<span class="ident" id="6924351">test</span><span class="op" id="6924355">.</span><span class="ident" id="6924356">desc</span><span class="op" id="6924360">,</span>&nbsp;<span class="ident" id="6924362">err</span><span class="op" id="6924365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924370">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924385">if</span>&nbsp;<span class="ident" id="6924388">err</span>&nbsp;<span class="op" id="6924392">:=</span>&nbsp;<span class="ident" id="6924395">w</span><span class="op" id="6924396">.</span><span class="ident" id="6924397">Close</span><span class="op" id="6924402">(</span><span class="op" id="6924403">)</span><span class="op" id="6924404">;</span>&nbsp;<span class="ident" id="6924406">err</span>&nbsp;<span class="op" id="6924410">!=</span>&nbsp;<span class="ident" id="6924413">nil</span>&nbsp;<span class="op" id="6924417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924422">t</span><span class="op" id="6924423">.</span><span class="ident" id="6924424">Errorf</span><span class="op" id="6924430">(</span><span class="string" id="6924431">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="6924461">,</span>&nbsp;<span class="ident" id="6924463">test</span><span class="op" id="6924467">.</span><span class="ident" id="6924468">desc</span><span class="op" id="6924472">,</span>&nbsp;<span class="ident" id="6924474">err</span><span class="op" id="6924477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924482">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924493">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924497">if</span>&nbsp;<span class="op" id="6924500">!</span><span class="ident" id="6924501">bytes</span><span class="op" id="6924506">.</span><span class="ident" id="6924507">Equal</span><span class="op" id="6924512">(</span><span class="ident" id="6924513">buf</span><span class="op" id="6924516">.</span><span class="ident" id="6924517">Bytes</span><span class="op" id="6924522">(</span><span class="op" id="6924523">)</span><span class="op" id="6924524">,</span>&nbsp;<span class="ident" id="6924526">test</span><span class="op" id="6924530">.</span><span class="ident" id="6924531">raw</span><span class="op" id="6924534">)</span>&nbsp;<span class="op" id="6924536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924541">t</span><span class="op" id="6924542">.</span><span class="ident" id="6924543">Errorf</span><span class="op" id="6924549">(</span><span class="string" id="6924550">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6924575">,</span>&nbsp;<span class="ident" id="6924577">test</span><span class="op" id="6924581">.</span><span class="ident" id="6924582">desc</span><span class="op" id="6924586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6924593">}</span><br>
<span class="lineno"></span><span class="op" id="6924595">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6924598">type</span>&nbsp;<span class="ident" id="6924603">writeOnlyConn</span>&nbsp;<span class="keyword" id="6924617">struct</span>&nbsp;<span class="op" id="6924624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924627">buf</span>&nbsp;<span class="op" id="6924631">[</span><span class="op" id="6924632">]</span><span class="builtintype" id="6924633">byte</span><br>
<span class="lineno"></span><span class="op" id="6924638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6924641">func</span>&nbsp;<span class="op" id="6924646">(</span><span class="ident" id="6924647">c</span>&nbsp;<span class="op" id="6924649">*</span><span class="ident" id="6924650">writeOnlyConn</span><span class="op" id="6924663">)</span>&nbsp;<span class="ident" id="6924665">Write</span><span class="op" id="6924670">(</span><span class="ident" id="6924671">p</span>&nbsp;<span class="op" id="6924673">[</span><span class="op" id="6924674">]</span><span class="builtintype" id="6924675">byte</span><span class="op" id="6924679">)</span>&nbsp;<span class="op" id="6924681">(</span><span class="builtintype" id="6924682">int</span><span class="op" id="6924685">,</span>&nbsp;<span class="builtintype" id="6924687">error</span><span class="op" id="6924692">)</span>&nbsp;<span class="op" id="6924694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924697">c</span><span class="op" id="6924698">.</span><span class="ident" id="6924699">buf</span>&nbsp;<span class="op" id="6924703">=</span>&nbsp;<span class="builtinfunc" id="6924705">append</span><span class="op" id="6924711">(</span><span class="ident" id="6924712">c</span><span class="op" id="6924713">.</span><span class="ident" id="6924714">buf</span><span class="op" id="6924717">,</span>&nbsp;<span class="ident" id="6924719">p</span><span class="op" id="6924720">...</span><span class="op" id="6924723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924726">return</span>&nbsp;<span class="builtinfunc" id="6924733">len</span><span class="op" id="6924736">(</span><span class="ident" id="6924737">p</span><span class="op" id="6924738">)</span><span class="op" id="6924739">,</span>&nbsp;<span class="ident" id="6924741">nil</span><br>
<span class="lineno"></span><span class="op" id="6924745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="6924748">func</span>&nbsp;<span class="op" id="6924753">(</span><span class="ident" id="6924754">c</span>&nbsp;<span class="op" id="6924756">*</span><span class="ident" id="6924757">writeOnlyConn</span><span class="op" id="6924770">)</span>&nbsp;<span class="ident" id="6924772">Read</span><span class="op" id="6924776">(</span><span class="ident" id="6924777">p</span>&nbsp;<span class="op" id="6924779">[</span><span class="op" id="6924780">]</span><span class="builtintype" id="6924781">byte</span><span class="op" id="6924785">)</span>&nbsp;<span class="op" id="6924787">(</span><span class="builtintype" id="6924788">int</span><span class="op" id="6924791">,</span>&nbsp;<span class="builtintype" id="6924793">error</span><span class="op" id="6924798">)</span>&nbsp;<span class="op" id="6924800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924803">return</span>&nbsp;<span class="num" id="6924810">0</span><span class="op" id="6924811">,</span>&nbsp;<span class="ident" id="6924813">errors</span><span class="op" id="6924819">.</span><span class="ident" id="6924820">New</span><span class="op" id="6924823">(</span><span class="string" id="6924824">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="6924844">)</span><br>
<span class="lineno"></span><span class="op" id="6924846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6924849">func</span>&nbsp;<span class="op" id="6924854">(</span><span class="ident" id="6924855">c</span>&nbsp;<span class="op" id="6924857">*</span><span class="ident" id="6924858">writeOnlyConn</span><span class="op" id="6924871">)</span>&nbsp;<span class="ident" id="6924873">Close</span><span class="op" id="6924878">(</span><span class="op" id="6924879">)</span>&nbsp;<span class="builtintype" id="6924881">error</span>&nbsp;<span class="op" id="6924887">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924890">return</span>&nbsp;<span class="ident" id="6924897">nil</span><br>
<span class="lineno"></span><span class="op" id="6924901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6924904">func</span>&nbsp;<span class="ident" id="6924909">TestGetValues</span><span class="op" id="6924922">(</span><span class="ident" id="6924923">t</span>&nbsp;<span class="op" id="6924925">*</span><span class="ident" id="6924926">testing</span><span class="op" id="6924933">.</span><span class="ident" id="6924934">T</span><span class="op" id="6924935">)</span>&nbsp;<span class="op" id="6924937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6924940">var</span>&nbsp;<span class="ident" id="6924944">rec</span>&nbsp;<span class="ident" id="6924948">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924956">rec</span><span class="op" id="6924959">.</span><span class="ident" id="6924960">h</span><span class="op" id="6924961">.</span><span class="ident" id="6924962">Type</span>&nbsp;<span class="op" id="6924967">=</span>&nbsp;<span class="ident" id="6924969">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6924985">wc</span>&nbsp;<span class="op" id="6924988">:=</span>&nbsp;<span class="builtinfunc" id="6924991">new</span><span class="op" id="6924994">(</span><span class="ident" id="6924995">writeOnlyConn</span><span class="op" id="6925008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925011">c</span>&nbsp;<span class="op" id="6925013">:=</span>&nbsp;<span class="ident" id="6925016">newChild</span><span class="op" id="6925024">(</span><span class="ident" id="6925025">wc</span><span class="op" id="6925027">,</span>&nbsp;<span class="ident" id="6925029">nil</span><span class="op" id="6925032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925035">err</span>&nbsp;<span class="op" id="6925039">:=</span>&nbsp;<span class="ident" id="6925042">c</span><span class="op" id="6925043">.</span><span class="ident" id="6925044">handleRecord</span><span class="op" id="6925056">(</span><span class="op" id="6925057">&amp;</span><span class="ident" id="6925058">rec</span><span class="op" id="6925061">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925064">if</span>&nbsp;<span class="ident" id="6925067">err</span>&nbsp;<span class="op" id="6925071">!=</span>&nbsp;<span class="ident" id="6925074">nil</span>&nbsp;<span class="op" id="6925078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925082">t</span><span class="op" id="6925083">.</span><span class="ident" id="6925084">Fatalf</span><span class="op" id="6925090">(</span><span class="string" id="6925091">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="6925109">,</span>&nbsp;<span class="ident" id="6925111">err</span><span class="op" id="6925114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925121">const</span>&nbsp;<span class="ident" id="6925127">want</span>&nbsp;<span class="op" id="6925132">=</span>&nbsp;<span class="string" id="6925134">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="6925167">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925171">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="6925198">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925202">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925260">if</span>&nbsp;<span class="ident" id="6925263">got</span>&nbsp;<span class="op" id="6925267">:=</span>&nbsp;<span class="builtintype" id="6925270">string</span><span class="op" id="6925276">(</span><span class="ident" id="6925277">wc</span><span class="op" id="6925279">.</span><span class="ident" id="6925280">buf</span><span class="op" id="6925283">)</span><span class="op" id="6925284">;</span>&nbsp;<span class="ident" id="6925286">got</span>&nbsp;<span class="op" id="6925290">!=</span>&nbsp;<span class="ident" id="6925293">want</span>&nbsp;<span class="op" id="6925298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925302">t</span><span class="op" id="6925303">.</span><span class="ident" id="6925304">Errorf</span><span class="op" id="6925310">(</span><span class="string" id="6925311">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="6925333">,</span>&nbsp;<span class="ident" id="6925335">got</span><span class="op" id="6925338">,</span>&nbsp;<span class="ident" id="6925340">want</span><span class="op" id="6925344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925347">}</span><br>
<span class="lineno">150</span><span class="op" id="6925349">}</span>
</div>
</body>
</html>
