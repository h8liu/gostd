<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7820481">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7820537">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7820591">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7820642">package</span>&nbsp;<span class="ident" id="7820650">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7820655">import</span>&nbsp;<span class="op" id="7820662">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7820665">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7820674">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7820681">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7820687">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7820698">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7820709">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7820720">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7820727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7820730">type</span>&nbsp;<span class="ident" id="7820735">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="7820753">struct</span>&nbsp;<span class="op" id="7820760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7820763">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7820777">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7820785">litAddrOrName</span>&nbsp;<span class="builtintype" id="7820799">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7820807">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7820821">*</span><span class="ident" id="7820822">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7820830">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7820844">error</span><br>
<span class="lineno"></span><span class="op" id="7820850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7820853">var</span>&nbsp;<span class="ident" id="7820857">resolveIPAddrTests</span>&nbsp;<span class="op" id="7820876">=</span>&nbsp;<span class="op" id="7820878">[</span><span class="op" id="7820879">]</span><span class="ident" id="7820880">resolveIPAddrTest</span><span class="op" id="7820897">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7820900">{</span><span class="string" id="7820901">&#34;ip&#34;</span><span class="op" id="7820905">,</span>&nbsp;<span class="string" id="7820907">&#34;127.0.0.1&#34;</span><span class="op" id="7820918">,</span>&nbsp;<span class="op" id="7820920">&amp;</span><span class="ident" id="7820921">IPAddr</span><span class="op" id="7820927">{</span><span class="ident" id="7820928">IP</span><span class="op" id="7820930">:</span>&nbsp;<span class="ident" id="7820932">IPv4</span><span class="op" id="7820936">(</span><span class="num" id="7820937">127</span><span class="op" id="7820940">,</span>&nbsp;<span class="num" id="7820942">0</span><span class="op" id="7820943">,</span>&nbsp;<span class="num" id="7820945">0</span><span class="op" id="7820946">,</span>&nbsp;<span class="num" id="7820948">1</span><span class="op" id="7820949">)</span><span class="op" id="7820950">}</span><span class="op" id="7820951">,</span>&nbsp;<span class="ident" id="7820953">nil</span><span class="op" id="7820956">}</span><span class="op" id="7820957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7820960">{</span><span class="string" id="7820961">&#34;ip4&#34;</span><span class="op" id="7820966">,</span>&nbsp;<span class="string" id="7820968">&#34;127.0.0.1&#34;</span><span class="op" id="7820979">,</span>&nbsp;<span class="op" id="7820981">&amp;</span><span class="ident" id="7820982">IPAddr</span><span class="op" id="7820988">{</span><span class="ident" id="7820989">IP</span><span class="op" id="7820991">:</span>&nbsp;<span class="ident" id="7820993">IPv4</span><span class="op" id="7820997">(</span><span class="num" id="7820998">127</span><span class="op" id="7821001">,</span>&nbsp;<span class="num" id="7821003">0</span><span class="op" id="7821004">,</span>&nbsp;<span class="num" id="7821006">0</span><span class="op" id="7821007">,</span>&nbsp;<span class="num" id="7821009">1</span><span class="op" id="7821010">)</span><span class="op" id="7821011">}</span><span class="op" id="7821012">,</span>&nbsp;<span class="ident" id="7821014">nil</span><span class="op" id="7821017">}</span><span class="op" id="7821018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821021">{</span><span class="string" id="7821022">&#34;ip4:icmp&#34;</span><span class="op" id="7821032">,</span>&nbsp;<span class="string" id="7821034">&#34;127.0.0.1&#34;</span><span class="op" id="7821045">,</span>&nbsp;<span class="op" id="7821047">&amp;</span><span class="ident" id="7821048">IPAddr</span><span class="op" id="7821054">{</span><span class="ident" id="7821055">IP</span><span class="op" id="7821057">:</span>&nbsp;<span class="ident" id="7821059">IPv4</span><span class="op" id="7821063">(</span><span class="num" id="7821064">127</span><span class="op" id="7821067">,</span>&nbsp;<span class="num" id="7821069">0</span><span class="op" id="7821070">,</span>&nbsp;<span class="num" id="7821072">0</span><span class="op" id="7821073">,</span>&nbsp;<span class="num" id="7821075">1</span><span class="op" id="7821076">)</span><span class="op" id="7821077">}</span><span class="op" id="7821078">,</span>&nbsp;<span class="ident" id="7821080">nil</span><span class="op" id="7821083">}</span><span class="op" id="7821084">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821088">{</span><span class="string" id="7821089">&#34;ip&#34;</span><span class="op" id="7821093">,</span>&nbsp;<span class="string" id="7821095">&#34;::1&#34;</span><span class="op" id="7821100">,</span>&nbsp;<span class="op" id="7821102">&amp;</span><span class="ident" id="7821103">IPAddr</span><span class="op" id="7821109">{</span><span class="ident" id="7821110">IP</span><span class="op" id="7821112">:</span>&nbsp;<span class="ident" id="7821114">ParseIP</span><span class="op" id="7821121">(</span><span class="string" id="7821122">&#34;::1&#34;</span><span class="op" id="7821127">)</span><span class="op" id="7821128">}</span><span class="op" id="7821129">,</span>&nbsp;<span class="ident" id="7821131">nil</span><span class="op" id="7821134">}</span><span class="op" id="7821135">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821138">{</span><span class="string" id="7821139">&#34;ip6&#34;</span><span class="op" id="7821144">,</span>&nbsp;<span class="string" id="7821146">&#34;::1&#34;</span><span class="op" id="7821151">,</span>&nbsp;<span class="op" id="7821153">&amp;</span><span class="ident" id="7821154">IPAddr</span><span class="op" id="7821160">{</span><span class="ident" id="7821161">IP</span><span class="op" id="7821163">:</span>&nbsp;<span class="ident" id="7821165">ParseIP</span><span class="op" id="7821172">(</span><span class="string" id="7821173">&#34;::1&#34;</span><span class="op" id="7821178">)</span><span class="op" id="7821179">}</span><span class="op" id="7821180">,</span>&nbsp;<span class="ident" id="7821182">nil</span><span class="op" id="7821185">}</span><span class="op" id="7821186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821189">{</span><span class="string" id="7821190">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="7821205">,</span>&nbsp;<span class="string" id="7821207">&#34;::1&#34;</span><span class="op" id="7821212">,</span>&nbsp;<span class="op" id="7821214">&amp;</span><span class="ident" id="7821215">IPAddr</span><span class="op" id="7821221">{</span><span class="ident" id="7821222">IP</span><span class="op" id="7821224">:</span>&nbsp;<span class="ident" id="7821226">ParseIP</span><span class="op" id="7821233">(</span><span class="string" id="7821234">&#34;::1&#34;</span><span class="op" id="7821239">)</span><span class="op" id="7821240">}</span><span class="op" id="7821241">,</span>&nbsp;<span class="ident" id="7821243">nil</span><span class="op" id="7821246">}</span><span class="op" id="7821247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821250">{</span><span class="string" id="7821251">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="7821266">,</span>&nbsp;<span class="string" id="7821268">&#34;::1&#34;</span><span class="op" id="7821273">,</span>&nbsp;<span class="op" id="7821275">&amp;</span><span class="ident" id="7821276">IPAddr</span><span class="op" id="7821282">{</span><span class="ident" id="7821283">IP</span><span class="op" id="7821285">:</span>&nbsp;<span class="ident" id="7821287">ParseIP</span><span class="op" id="7821294">(</span><span class="string" id="7821295">&#34;::1&#34;</span><span class="op" id="7821300">)</span><span class="op" id="7821301">}</span><span class="op" id="7821302">,</span>&nbsp;<span class="ident" id="7821304">nil</span><span class="op" id="7821307">}</span><span class="op" id="7821308">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821312">{</span><span class="string" id="7821313">&#34;ip&#34;</span><span class="op" id="7821317">,</span>&nbsp;<span class="string" id="7821319">&#34;::1%en0&#34;</span><span class="op" id="7821328">,</span>&nbsp;<span class="op" id="7821330">&amp;</span><span class="ident" id="7821331">IPAddr</span><span class="op" id="7821337">{</span><span class="ident" id="7821338">IP</span><span class="op" id="7821340">:</span>&nbsp;<span class="ident" id="7821342">ParseIP</span><span class="op" id="7821349">(</span><span class="string" id="7821350">&#34;::1&#34;</span><span class="op" id="7821355">)</span><span class="op" id="7821356">,</span>&nbsp;<span class="ident" id="7821358">Zone</span><span class="op" id="7821362">:</span>&nbsp;<span class="string" id="7821364">&#34;en0&#34;</span><span class="op" id="7821369">}</span><span class="op" id="7821370">,</span>&nbsp;<span class="ident" id="7821372">nil</span><span class="op" id="7821375">}</span><span class="op" id="7821376">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821379">{</span><span class="string" id="7821380">&#34;ip6&#34;</span><span class="op" id="7821385">,</span>&nbsp;<span class="string" id="7821387">&#34;::1%911&#34;</span><span class="op" id="7821396">,</span>&nbsp;<span class="op" id="7821398">&amp;</span><span class="ident" id="7821399">IPAddr</span><span class="op" id="7821405">{</span><span class="ident" id="7821406">IP</span><span class="op" id="7821408">:</span>&nbsp;<span class="ident" id="7821410">ParseIP</span><span class="op" id="7821417">(</span><span class="string" id="7821418">&#34;::1&#34;</span><span class="op" id="7821423">)</span><span class="op" id="7821424">,</span>&nbsp;<span class="ident" id="7821426">Zone</span><span class="op" id="7821430">:</span>&nbsp;<span class="string" id="7821432">&#34;911&#34;</span><span class="op" id="7821437">}</span><span class="op" id="7821438">,</span>&nbsp;<span class="ident" id="7821440">nil</span><span class="op" id="7821443">}</span><span class="op" id="7821444">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821448">{</span><span class="string" id="7821449">&#34;&#34;</span><span class="op" id="7821451">,</span>&nbsp;<span class="string" id="7821453">&#34;127.0.0.1&#34;</span><span class="op" id="7821464">,</span>&nbsp;<span class="op" id="7821466">&amp;</span><span class="ident" id="7821467">IPAddr</span><span class="op" id="7821473">{</span><span class="ident" id="7821474">IP</span><span class="op" id="7821476">:</span>&nbsp;<span class="ident" id="7821478">IPv4</span><span class="op" id="7821482">(</span><span class="num" id="7821483">127</span><span class="op" id="7821486">,</span>&nbsp;<span class="num" id="7821488">0</span><span class="op" id="7821489">,</span>&nbsp;<span class="num" id="7821491">0</span><span class="op" id="7821492">,</span>&nbsp;<span class="num" id="7821494">1</span><span class="op" id="7821495">)</span><span class="op" id="7821496">}</span><span class="op" id="7821497">,</span>&nbsp;<span class="ident" id="7821499">nil</span><span class="op" id="7821502">}</span><span class="op" id="7821503">,</span>&nbsp;<span class="comment" id="7821505">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821525">{</span><span class="string" id="7821526">&#34;&#34;</span><span class="op" id="7821528">,</span>&nbsp;<span class="string" id="7821530">&#34;::1&#34;</span><span class="op" id="7821535">,</span>&nbsp;<span class="op" id="7821537">&amp;</span><span class="ident" id="7821538">IPAddr</span><span class="op" id="7821544">{</span><span class="ident" id="7821545">IP</span><span class="op" id="7821547">:</span>&nbsp;<span class="ident" id="7821549">ParseIP</span><span class="op" id="7821556">(</span><span class="string" id="7821557">&#34;::1&#34;</span><span class="op" id="7821562">)</span><span class="op" id="7821563">}</span><span class="op" id="7821564">,</span>&nbsp;<span class="ident" id="7821566">nil</span><span class="op" id="7821569">}</span><span class="op" id="7821570">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7821582">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821603">{</span><span class="string" id="7821604">&#34;l2tp&#34;</span><span class="op" id="7821610">,</span>&nbsp;<span class="string" id="7821612">&#34;127.0.0.1&#34;</span><span class="op" id="7821623">,</span>&nbsp;<span class="ident" id="7821625">nil</span><span class="op" id="7821628">,</span>&nbsp;<span class="ident" id="7821630">UnknownNetworkError</span><span class="op" id="7821649">(</span><span class="string" id="7821650">&#34;l2tp&#34;</span><span class="op" id="7821656">)</span><span class="op" id="7821657">}</span><span class="op" id="7821658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821661">{</span><span class="string" id="7821662">&#34;l2tp:gre&#34;</span><span class="op" id="7821672">,</span>&nbsp;<span class="string" id="7821674">&#34;127.0.0.1&#34;</span><span class="op" id="7821685">,</span>&nbsp;<span class="ident" id="7821687">nil</span><span class="op" id="7821690">,</span>&nbsp;<span class="ident" id="7821692">UnknownNetworkError</span><span class="op" id="7821711">(</span><span class="string" id="7821712">&#34;l2tp:gre&#34;</span><span class="op" id="7821722">)</span><span class="op" id="7821723">}</span><span class="op" id="7821724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821727">{</span><span class="string" id="7821728">&#34;tcp&#34;</span><span class="op" id="7821733">,</span>&nbsp;<span class="string" id="7821735">&#34;1.2.3.4:123&#34;</span><span class="op" id="7821748">,</span>&nbsp;<span class="ident" id="7821750">nil</span><span class="op" id="7821753">,</span>&nbsp;<span class="ident" id="7821755">UnknownNetworkError</span><span class="op" id="7821774">(</span><span class="string" id="7821775">&#34;tcp&#34;</span><span class="op" id="7821780">)</span><span class="op" id="7821781">}</span><span class="op" id="7821782">,</span><br>
<span class="lineno"></span><span class="op" id="7821784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7821787">func</span>&nbsp;<span class="ident" id="7821792">init</span><span class="op" id="7821796">(</span><span class="op" id="7821797">)</span>&nbsp;<span class="op" id="7821799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7821802">if</span>&nbsp;<span class="ident" id="7821805">ifi</span>&nbsp;<span class="op" id="7821809">:=</span>&nbsp;<span class="ident" id="7821812">loopbackInterface</span><span class="op" id="7821829">(</span><span class="op" id="7821830">)</span><span class="op" id="7821831">;</span>&nbsp;<span class="ident" id="7821833">ifi</span>&nbsp;<span class="op" id="7821837">!=</span>&nbsp;<span class="ident" id="7821840">nil</span>&nbsp;<span class="op" id="7821844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7821848">index</span>&nbsp;<span class="op" id="7821854">:=</span>&nbsp;<span class="ident" id="7821857">fmt</span><span class="op" id="7821860">.</span><span class="ident" id="7821861">Sprintf</span><span class="op" id="7821868">(</span><span class="string" id="7821869">&#34;%v&#34;</span><span class="op" id="7821873">,</span>&nbsp;<span class="ident" id="7821875">ifi</span><span class="op" id="7821878">.</span><span class="ident" id="7821879">Index</span><span class="op" id="7821884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7821888">resolveIPAddrTests</span>&nbsp;<span class="op" id="7821907">=</span>&nbsp;<span class="builtinfunc" id="7821909">append</span><span class="op" id="7821915">(</span><span class="ident" id="7821916">resolveIPAddrTests</span><span class="op" id="7821934">,</span>&nbsp;<span class="op" id="7821936">[</span><span class="op" id="7821937">]</span><span class="ident" id="7821938">resolveIPAddrTest</span><span class="op" id="7821955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7821960">{</span><span class="string" id="7821961">&#34;ip6&#34;</span><span class="op" id="7821966">,</span>&nbsp;<span class="string" id="7821968">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="7821979">+</span>&nbsp;<span class="ident" id="7821981">ifi</span><span class="op" id="7821984">.</span><span class="ident" id="7821985">Name</span><span class="op" id="7821989">,</span>&nbsp;<span class="op" id="7821991">&amp;</span><span class="ident" id="7821992">IPAddr</span><span class="op" id="7821998">{</span><span class="ident" id="7821999">IP</span><span class="op" id="7822001">:</span>&nbsp;<span class="ident" id="7822003">ParseIP</span><span class="op" id="7822010">(</span><span class="string" id="7822011">&#34;fe80::1&#34;</span><span class="op" id="7822020">)</span><span class="op" id="7822021">,</span>&nbsp;<span class="ident" id="7822023">Zone</span><span class="op" id="7822027">:</span>&nbsp;<span class="ident" id="7822029">zoneToString</span><span class="op" id="7822041">(</span><span class="ident" id="7822042">ifi</span><span class="op" id="7822045">.</span><span class="ident" id="7822046">Index</span><span class="op" id="7822051">)</span><span class="op" id="7822052">}</span><span class="op" id="7822053">,</span>&nbsp;<span class="ident" id="7822055">nil</span><span class="op" id="7822058">}</span><span class="op" id="7822059">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7822064">{</span><span class="string" id="7822065">&#34;ip6&#34;</span><span class="op" id="7822070">,</span>&nbsp;<span class="string" id="7822072">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="7822083">+</span>&nbsp;<span class="ident" id="7822085">index</span><span class="op" id="7822090">,</span>&nbsp;<span class="op" id="7822092">&amp;</span><span class="ident" id="7822093">IPAddr</span><span class="op" id="7822099">{</span><span class="ident" id="7822100">IP</span><span class="op" id="7822102">:</span>&nbsp;<span class="ident" id="7822104">ParseIP</span><span class="op" id="7822111">(</span><span class="string" id="7822112">&#34;fe80::1&#34;</span><span class="op" id="7822121">)</span><span class="op" id="7822122">,</span>&nbsp;<span class="ident" id="7822124">Zone</span><span class="op" id="7822128">:</span>&nbsp;<span class="ident" id="7822130">index</span><span class="op" id="7822135">}</span><span class="op" id="7822136">,</span>&nbsp;<span class="ident" id="7822138">nil</span><span class="op" id="7822141">}</span><span class="op" id="7822142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7822146">}</span><span class="op" id="7822147">...</span><span class="op" id="7822150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7822153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7822156">if</span>&nbsp;<span class="ident" id="7822159">ips</span><span class="op" id="7822162">,</span>&nbsp;<span class="ident" id="7822164">err</span>&nbsp;<span class="op" id="7822168">:=</span>&nbsp;<span class="ident" id="7822171">LookupIP</span><span class="op" id="7822179">(</span><span class="string" id="7822180">&#34;localhost&#34;</span><span class="op" id="7822191">)</span><span class="op" id="7822192">;</span>&nbsp;<span class="ident" id="7822194">err</span>&nbsp;<span class="op" id="7822198">==</span>&nbsp;<span class="ident" id="7822201">nil</span>&nbsp;<span class="op" id="7822205">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7822208">len</span><span class="op" id="7822211">(</span><span class="ident" id="7822212">ips</span><span class="op" id="7822215">)</span>&nbsp;<span class="op" id="7822217">&gt;</span>&nbsp;<span class="num" id="7822219">1</span>&nbsp;<span class="op" id="7822221">&amp;&amp;</span>&nbsp;<span class="ident" id="7822224">supportsIPv4</span>&nbsp;<span class="op" id="7822237">&amp;&amp;</span>&nbsp;<span class="ident" id="7822240">supportsIPv6</span>&nbsp;<span class="op" id="7822253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7822257">resolveIPAddrTests</span>&nbsp;<span class="op" id="7822276">=</span>&nbsp;<span class="builtinfunc" id="7822278">append</span><span class="op" id="7822284">(</span><span class="ident" id="7822285">resolveIPAddrTests</span><span class="op" id="7822303">,</span>&nbsp;<span class="op" id="7822305">[</span><span class="op" id="7822306">]</span><span class="ident" id="7822307">resolveIPAddrTest</span><span class="op" id="7822324">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7822329">{</span><span class="string" id="7822330">&#34;ip&#34;</span><span class="op" id="7822334">,</span>&nbsp;<span class="string" id="7822336">&#34;localhost&#34;</span><span class="op" id="7822347">,</span>&nbsp;<span class="op" id="7822349">&amp;</span><span class="ident" id="7822350">IPAddr</span><span class="op" id="7822356">{</span><span class="ident" id="7822357">IP</span><span class="op" id="7822359">:</span>&nbsp;<span class="ident" id="7822361">IPv4</span><span class="op" id="7822365">(</span><span class="num" id="7822366">127</span><span class="op" id="7822369">,</span>&nbsp;<span class="num" id="7822371">0</span><span class="op" id="7822372">,</span>&nbsp;<span class="num" id="7822374">0</span><span class="op" id="7822375">,</span>&nbsp;<span class="num" id="7822377">1</span><span class="op" id="7822378">)</span><span class="op" id="7822379">}</span><span class="op" id="7822380">,</span>&nbsp;<span class="ident" id="7822382">nil</span><span class="op" id="7822385">}</span><span class="op" id="7822386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7822391">{</span><span class="string" id="7822392">&#34;ip4&#34;</span><span class="op" id="7822397">,</span>&nbsp;<span class="string" id="7822399">&#34;localhost&#34;</span><span class="op" id="7822410">,</span>&nbsp;<span class="op" id="7822412">&amp;</span><span class="ident" id="7822413">IPAddr</span><span class="op" id="7822419">{</span><span class="ident" id="7822420">IP</span><span class="op" id="7822422">:</span>&nbsp;<span class="ident" id="7822424">IPv4</span><span class="op" id="7822428">(</span><span class="num" id="7822429">127</span><span class="op" id="7822432">,</span>&nbsp;<span class="num" id="7822434">0</span><span class="op" id="7822435">,</span>&nbsp;<span class="num" id="7822437">0</span><span class="op" id="7822438">,</span>&nbsp;<span class="num" id="7822440">1</span><span class="op" id="7822441">)</span><span class="op" id="7822442">}</span><span class="op" id="7822443">,</span>&nbsp;<span class="ident" id="7822445">nil</span><span class="op" id="7822448">}</span><span class="op" id="7822449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7822454">{</span><span class="string" id="7822455">&#34;ip6&#34;</span><span class="op" id="7822460">,</span>&nbsp;<span class="string" id="7822462">&#34;localhost&#34;</span><span class="op" id="7822473">,</span>&nbsp;<span class="op" id="7822475">&amp;</span><span class="ident" id="7822476">IPAddr</span><span class="op" id="7822482">{</span><span class="ident" id="7822483">IP</span><span class="op" id="7822485">:</span>&nbsp;<span class="ident" id="7822487">IPv6loopback</span><span class="op" id="7822499">}</span><span class="op" id="7822500">,</span>&nbsp;<span class="ident" id="7822502">nil</span><span class="op" id="7822505">}</span><span class="op" id="7822506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7822510">}</span><span class="op" id="7822511">...</span><span class="op" id="7822514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7822517">}</span><br>
<span class="lineno">60</span><span class="op" id="7822519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7822522">func</span>&nbsp;<span class="ident" id="7822527">skipRawSocketTest</span><span class="op" id="7822544">(</span><span class="ident" id="7822545">t</span>&nbsp;<span class="op" id="7822547">*</span><span class="ident" id="7822548">testing</span><span class="op" id="7822555">.</span><span class="ident" id="7822556">T</span><span class="op" id="7822557">)</span>&nbsp;<span class="op" id="7822559">(</span><span class="ident" id="7822560">skip</span>&nbsp;<span class="builtintype" id="7822565">bool</span><span class="op" id="7822569">,</span>&nbsp;<span class="ident" id="7822571">skipmsg</span>&nbsp;<span class="builtintype" id="7822579">string</span><span class="op" id="7822585">)</span>&nbsp;<span class="op" id="7822587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7822590">skip</span><span class="op" id="7822594">,</span>&nbsp;<span class="ident" id="7822596">skipmsg</span><span class="op" id="7822603">,</span>&nbsp;<span class="ident" id="7822605">err</span>&nbsp;<span class="op" id="7822609">:=</span>&nbsp;<span class="ident" id="7822612">skipRawSocketTests</span><span class="op" id="7822630">(</span><span class="op" id="7822631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7822634">if</span>&nbsp;<span class="ident" id="7822637">err</span>&nbsp;<span class="op" id="7822641">!=</span>&nbsp;<span class="ident" id="7822644">nil</span>&nbsp;<span class="op" id="7822648">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7822652">t</span><span class="op" id="7822653">.</span><span class="ident" id="7822654">Fatal</span><span class="op" id="7822659">(</span><span class="ident" id="7822660">err</span><span class="op" id="7822663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7822666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7822669">return</span>&nbsp;<span class="ident" id="7822676">skip</span><span class="op" id="7822680">,</span>&nbsp;<span class="ident" id="7822682">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="7822690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7822693">func</span>&nbsp;<span class="ident" id="7822698">TestResolveIPAddr</span><span class="op" id="7822715">(</span><span class="ident" id="7822716">t</span>&nbsp;<span class="op" id="7822718">*</span><span class="ident" id="7822719">testing</span><span class="op" id="7822726">.</span><span class="ident" id="7822727">T</span><span class="op" id="7822728">)</span>&nbsp;<span class="op" id="7822730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7822733">switch</span>&nbsp;<span class="ident" id="7822740">runtime</span><span class="op" id="7822747">.</span><span class="ident" id="7822748">GOOS</span>&nbsp;<span class="op" id="7822753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7822756">case</span>&nbsp;<span class="string" id="7822761">&#34;nacl&#34;</span><span class="op" id="7822767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7822771">t</span><span class="op" id="7822772">.</span><span class="ident" id="7822773">Skipf</span><span class="op" id="7822778">(</span><span class="string" id="7822779">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7822800">,</span>&nbsp;<span class="ident" id="7822802">runtime</span><span class="op" id="7822809">.</span><span class="ident" id="7822810">GOOS</span><span class="op" id="7822814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7822817">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7822821">for</span>&nbsp;<span class="ident" id="7822825">_</span><span class="op" id="7822826">,</span>&nbsp;<span class="ident" id="7822828">tt</span>&nbsp;<span class="op" id="7822831">:=</span>&nbsp;<span class="keyword" id="7822834">range</span>&nbsp;<span class="ident" id="7822840">resolveIPAddrTests</span>&nbsp;<span class="op" id="7822859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7822863">addr</span><span class="op" id="7822867">,</span>&nbsp;<span class="ident" id="7822869">err</span>&nbsp;<span class="op" id="7822873">:=</span>&nbsp;<span class="ident" id="7822876">ResolveIPAddr</span><span class="op" id="7822889">(</span><span class="ident" id="7822890">tt</span><span class="op" id="7822892">.</span><span class="ident" id="7822893">net</span><span class="op" id="7822896">,</span>&nbsp;<span class="ident" id="7822898">tt</span><span class="op" id="7822900">.</span><span class="ident" id="7822901">litAddrOrName</span><span class="op" id="7822914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7822918">if</span>&nbsp;<span class="ident" id="7822921">err</span>&nbsp;<span class="op" id="7822925">!=</span>&nbsp;<span class="ident" id="7822928">tt</span><span class="op" id="7822930">.</span><span class="ident" id="7822931">err</span>&nbsp;<span class="op" id="7822935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7822940">t</span><span class="op" id="7822941">.</span><span class="ident" id="7822942">Fatalf</span><span class="op" id="7822948">(</span><span class="string" id="7822949">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7822983">,</span>&nbsp;<span class="ident" id="7822985">tt</span><span class="op" id="7822987">.</span><span class="ident" id="7822988">net</span><span class="op" id="7822991">,</span>&nbsp;<span class="ident" id="7822993">tt</span><span class="op" id="7822995">.</span><span class="ident" id="7822996">litAddrOrName</span><span class="op" id="7823009">,</span>&nbsp;<span class="ident" id="7823011">err</span><span class="op" id="7823014">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7823018">}</span>&nbsp;<span class="keyword" id="7823020">else</span>&nbsp;<span class="keyword" id="7823025">if</span>&nbsp;<span class="op" id="7823028">!</span><span class="ident" id="7823029">reflect</span><span class="op" id="7823036">.</span><span class="ident" id="7823037">DeepEqual</span><span class="op" id="7823046">(</span><span class="ident" id="7823047">addr</span><span class="op" id="7823051">,</span>&nbsp;<span class="ident" id="7823053">tt</span><span class="op" id="7823055">.</span><span class="ident" id="7823056">addr</span><span class="op" id="7823060">)</span>&nbsp;<span class="op" id="7823062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823067">t</span><span class="op" id="7823068">.</span><span class="ident" id="7823069">Fatalf</span><span class="op" id="7823075">(</span><span class="string" id="7823076">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7823099">,</span>&nbsp;<span class="ident" id="7823101">addr</span><span class="op" id="7823105">,</span>&nbsp;<span class="ident" id="7823107">tt</span><span class="op" id="7823109">.</span><span class="ident" id="7823110">addr</span><span class="op" id="7823114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7823118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7823121">}</span><br>
<span class="lineno"></span><span class="op" id="7823123">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7823126">var</span>&nbsp;<span class="ident" id="7823130">icmpEchoTests</span>&nbsp;<span class="op" id="7823144">=</span>&nbsp;<span class="op" id="7823146">[</span><span class="op" id="7823147">]</span><span class="keyword" id="7823148">struct</span>&nbsp;<span class="op" id="7823155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823158">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7823164">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823172">laddr</span>&nbsp;<span class="builtintype" id="7823178">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823186">raddr</span>&nbsp;<span class="builtintype" id="7823192">string</span><br>
<span class="lineno">90</span><span class="op" id="7823199">}</span><span class="op" id="7823200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7823203">{</span><span class="string" id="7823204">&#34;ip4:icmp&#34;</span><span class="op" id="7823214">,</span>&nbsp;<span class="string" id="7823216">&#34;0.0.0.0&#34;</span><span class="op" id="7823225">,</span>&nbsp;<span class="string" id="7823227">&#34;127.0.0.1&#34;</span><span class="op" id="7823238">}</span><span class="op" id="7823239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7823242">{</span><span class="string" id="7823243">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="7823258">,</span>&nbsp;<span class="string" id="7823260">&#34;::&#34;</span><span class="op" id="7823264">,</span>&nbsp;<span class="string" id="7823266">&#34;::1&#34;</span><span class="op" id="7823271">}</span><span class="op" id="7823272">,</span><br>
<span class="lineno"></span><span class="op" id="7823274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7823277">func</span>&nbsp;<span class="ident" id="7823282">TestConnICMPEcho</span><span class="op" id="7823298">(</span><span class="ident" id="7823299">t</span>&nbsp;<span class="op" id="7823301">*</span><span class="ident" id="7823302">testing</span><span class="op" id="7823309">.</span><span class="ident" id="7823310">T</span><span class="op" id="7823311">)</span>&nbsp;<span class="op" id="7823313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7823316">if</span>&nbsp;<span class="ident" id="7823319">skip</span><span class="op" id="7823323">,</span>&nbsp;<span class="ident" id="7823325">skipmsg</span>&nbsp;<span class="op" id="7823333">:=</span>&nbsp;<span class="ident" id="7823336">skipRawSocketTest</span><span class="op" id="7823353">(</span><span class="ident" id="7823354">t</span><span class="op" id="7823355">)</span><span class="op" id="7823356">;</span>&nbsp;<span class="ident" id="7823358">skip</span>&nbsp;<span class="op" id="7823363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823367">t</span><span class="op" id="7823368">.</span><span class="ident" id="7823369">Skip</span><span class="op" id="7823373">(</span><span class="ident" id="7823374">skipmsg</span><span class="op" id="7823381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7823384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7823388">for</span>&nbsp;<span class="ident" id="7823392">i</span><span class="op" id="7823393">,</span>&nbsp;<span class="ident" id="7823395">tt</span>&nbsp;<span class="op" id="7823398">:=</span>&nbsp;<span class="keyword" id="7823401">range</span>&nbsp;<span class="ident" id="7823407">icmpEchoTests</span>&nbsp;<span class="op" id="7823421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823425">net</span><span class="op" id="7823428">,</span>&nbsp;<span class="ident" id="7823430">_</span><span class="op" id="7823431">,</span>&nbsp;<span class="ident" id="7823433">err</span>&nbsp;<span class="op" id="7823437">:=</span>&nbsp;<span class="ident" id="7823440">parseNetwork</span><span class="op" id="7823452">(</span><span class="ident" id="7823453">tt</span><span class="op" id="7823455">.</span><span class="ident" id="7823456">net</span><span class="op" id="7823459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7823463">if</span>&nbsp;<span class="ident" id="7823466">err</span>&nbsp;<span class="op" id="7823470">!=</span>&nbsp;<span class="ident" id="7823473">nil</span>&nbsp;<span class="op" id="7823477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823482">t</span><span class="op" id="7823483">.</span><span class="ident" id="7823484">Fatalf</span><span class="op" id="7823490">(</span><span class="string" id="7823491">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7823516">,</span>&nbsp;<span class="ident" id="7823518">err</span><span class="op" id="7823521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7823525">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7823529">if</span>&nbsp;<span class="ident" id="7823532">net</span>&nbsp;<span class="op" id="7823536">==</span>&nbsp;<span class="string" id="7823539">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7823545">&amp;&amp;</span>&nbsp;<span class="op" id="7823548">!</span><span class="ident" id="7823549">supportsIPv6</span>&nbsp;<span class="op" id="7823562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7823567">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7823578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823583">c</span><span class="op" id="7823584">,</span>&nbsp;<span class="ident" id="7823586">err</span>&nbsp;<span class="op" id="7823590">:=</span>&nbsp;<span class="ident" id="7823593">Dial</span><span class="op" id="7823597">(</span><span class="ident" id="7823598">tt</span><span class="op" id="7823600">.</span><span class="ident" id="7823601">net</span><span class="op" id="7823604">,</span>&nbsp;<span class="ident" id="7823606">tt</span><span class="op" id="7823608">.</span><span class="ident" id="7823609">raddr</span><span class="op" id="7823614">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7823618">if</span>&nbsp;<span class="ident" id="7823621">err</span>&nbsp;<span class="op" id="7823625">!=</span>&nbsp;<span class="ident" id="7823628">nil</span>&nbsp;<span class="op" id="7823632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823637">t</span><span class="op" id="7823638">.</span><span class="ident" id="7823639">Fatalf</span><span class="op" id="7823645">(</span><span class="string" id="7823646">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7823663">,</span>&nbsp;<span class="ident" id="7823665">err</span><span class="op" id="7823668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7823672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823676">c</span><span class="op" id="7823677">.</span><span class="ident" id="7823678">SetDeadline</span><span class="op" id="7823689">(</span><span class="ident" id="7823690">time</span><span class="op" id="7823694">.</span><span class="ident" id="7823695">Now</span><span class="op" id="7823698">(</span><span class="op" id="7823699">)</span><span class="op" id="7823700">.</span><span class="ident" id="7823701">Add</span><span class="op" id="7823704">(</span><span class="num" id="7823705">100</span>&nbsp;<span class="op" id="7823709">*</span>&nbsp;<span class="ident" id="7823711">time</span><span class="op" id="7823715">.</span><span class="ident" id="7823716">Millisecond</span><span class="op" id="7823727">)</span><span class="op" id="7823728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7823732">defer</span>&nbsp;<span class="ident" id="7823738">c</span><span class="op" id="7823739">.</span><span class="ident" id="7823740">Close</span><span class="op" id="7823745">(</span><span class="op" id="7823746">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823751">typ</span>&nbsp;<span class="op" id="7823755">:=</span>&nbsp;<span class="ident" id="7823758">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7823778">if</span>&nbsp;<span class="ident" id="7823781">net</span>&nbsp;<span class="op" id="7823785">==</span>&nbsp;<span class="string" id="7823788">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7823794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823799">typ</span>&nbsp;<span class="op" id="7823803">=</span>&nbsp;<span class="ident" id="7823805">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7823825">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823829">xid</span><span class="op" id="7823832">,</span>&nbsp;<span class="ident" id="7823834">xseq</span>&nbsp;<span class="op" id="7823839">:=</span>&nbsp;<span class="ident" id="7823842">os</span><span class="op" id="7823844">.</span><span class="ident" id="7823845">Getpid</span><span class="op" id="7823851">(</span><span class="op" id="7823852">)</span><span class="op" id="7823853">&amp;</span><span class="num" id="7823854">0xffff</span><span class="op" id="7823860">,</span>&nbsp;<span class="ident" id="7823862">i</span><span class="op" id="7823863">+</span><span class="num" id="7823864">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823868">wb</span><span class="op" id="7823870">,</span>&nbsp;<span class="ident" id="7823872">err</span>&nbsp;<span class="op" id="7823876">:=</span>&nbsp;<span class="op" id="7823879">(</span><span class="op" id="7823880">&amp;</span><span class="ident" id="7823881">icmpMessage</span><span class="op" id="7823892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823897">Type</span><span class="op" id="7823901">:</span>&nbsp;<span class="ident" id="7823903">typ</span><span class="op" id="7823906">,</span>&nbsp;<span class="ident" id="7823908">Code</span><span class="op" id="7823912">:</span>&nbsp;<span class="num" id="7823914">0</span><span class="op" id="7823915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823920">Body</span><span class="op" id="7823924">:</span>&nbsp;<span class="op" id="7823926">&amp;</span><span class="ident" id="7823927">icmpEcho</span><span class="op" id="7823935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823941">ID</span><span class="op" id="7823943">:</span>&nbsp;<span class="ident" id="7823945">xid</span><span class="op" id="7823948">,</span>&nbsp;<span class="ident" id="7823950">Seq</span><span class="op" id="7823953">:</span>&nbsp;<span class="ident" id="7823955">xseq</span><span class="op" id="7823959">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7823965">Data</span><span class="op" id="7823969">:</span>&nbsp;<span class="ident" id="7823971">bytes</span><span class="op" id="7823976">.</span><span class="ident" id="7823977">Repeat</span><span class="op" id="7823983">(</span><span class="op" id="7823984">[</span><span class="op" id="7823985">]</span><span class="builtintype" id="7823986">byte</span><span class="op" id="7823990">(</span><span class="string" id="7823991">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="7824013">)</span><span class="op" id="7824014">,</span>&nbsp;<span class="num" id="7824016">3</span><span class="op" id="7824017">)</span><span class="op" id="7824018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824023">}</span><span class="op" id="7824024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824028">}</span><span class="op" id="7824029">)</span><span class="op" id="7824030">.</span><span class="ident" id="7824031">Marshal</span><span class="op" id="7824038">(</span><span class="op" id="7824039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824043">if</span>&nbsp;<span class="ident" id="7824046">err</span>&nbsp;<span class="op" id="7824050">!=</span>&nbsp;<span class="ident" id="7824053">nil</span>&nbsp;<span class="op" id="7824057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7824062">t</span><span class="op" id="7824063">.</span><span class="ident" id="7824064">Fatalf</span><span class="op" id="7824070">(</span><span class="string" id="7824071">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7824103">,</span>&nbsp;<span class="ident" id="7824105">err</span><span class="op" id="7824108">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824116">if</span>&nbsp;<span class="ident" id="7824119">_</span><span class="op" id="7824120">,</span>&nbsp;<span class="ident" id="7824122">err</span>&nbsp;<span class="op" id="7824126">:=</span>&nbsp;<span class="ident" id="7824129">c</span><span class="op" id="7824130">.</span><span class="ident" id="7824131">Write</span><span class="op" id="7824136">(</span><span class="ident" id="7824137">wb</span><span class="op" id="7824139">)</span><span class="op" id="7824140">;</span>&nbsp;<span class="ident" id="7824142">err</span>&nbsp;<span class="op" id="7824146">!=</span>&nbsp;<span class="ident" id="7824149">nil</span>&nbsp;<span class="op" id="7824153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7824158">t</span><span class="op" id="7824159">.</span><span class="ident" id="7824160">Fatalf</span><span class="op" id="7824166">(</span><span class="string" id="7824167">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7824190">,</span>&nbsp;<span class="ident" id="7824192">err</span><span class="op" id="7824195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824203">var</span>&nbsp;<span class="ident" id="7824207">m</span>&nbsp;<span class="op" id="7824209">*</span><span class="ident" id="7824210">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7824224">rb</span>&nbsp;<span class="op" id="7824227">:=</span>&nbsp;<span class="builtinfunc" id="7824230">make</span><span class="op" id="7824234">(</span><span class="op" id="7824235">[</span><span class="op" id="7824236">]</span><span class="builtintype" id="7824237">byte</span><span class="op" id="7824241">,</span>&nbsp;<span class="num" id="7824243">20</span><span class="op" id="7824245">+</span><span class="builtinfunc" id="7824246">len</span><span class="op" id="7824249">(</span><span class="ident" id="7824250">wb</span><span class="op" id="7824252">)</span><span class="op" id="7824253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824257">for</span>&nbsp;<span class="op" id="7824261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824266">if</span>&nbsp;<span class="ident" id="7824269">_</span><span class="op" id="7824270">,</span>&nbsp;<span class="ident" id="7824272">err</span>&nbsp;<span class="op" id="7824276">:=</span>&nbsp;<span class="ident" id="7824279">c</span><span class="op" id="7824280">.</span><span class="ident" id="7824281">Read</span><span class="op" id="7824285">(</span><span class="ident" id="7824286">rb</span><span class="op" id="7824288">)</span><span class="op" id="7824289">;</span>&nbsp;<span class="ident" id="7824291">err</span>&nbsp;<span class="op" id="7824295">!=</span>&nbsp;<span class="ident" id="7824298">nil</span>&nbsp;<span class="op" id="7824302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7824308">t</span><span class="op" id="7824309">.</span><span class="ident" id="7824310">Fatalf</span><span class="op" id="7824316">(</span><span class="string" id="7824317">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7824339">,</span>&nbsp;<span class="ident" id="7824341">err</span><span class="op" id="7824344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824349">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824354">if</span>&nbsp;<span class="ident" id="7824357">net</span>&nbsp;<span class="op" id="7824361">==</span>&nbsp;<span class="string" id="7824364">&#34;ip4&#34;</span>&nbsp;<span class="op" id="7824370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7824376">rb</span>&nbsp;<span class="op" id="7824379">=</span>&nbsp;<span class="ident" id="7824381">ipv4Payload</span><span class="op" id="7824392">(</span><span class="ident" id="7824393">rb</span><span class="op" id="7824395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824405">if</span>&nbsp;<span class="ident" id="7824408">m</span><span class="op" id="7824409">,</span>&nbsp;<span class="ident" id="7824411">err</span>&nbsp;<span class="op" id="7824415">=</span>&nbsp;<span class="ident" id="7824417">parseICMPMessage</span><span class="op" id="7824433">(</span><span class="ident" id="7824434">rb</span><span class="op" id="7824436">)</span><span class="op" id="7824437">;</span>&nbsp;<span class="ident" id="7824439">err</span>&nbsp;<span class="op" id="7824443">!=</span>&nbsp;<span class="ident" id="7824446">nil</span>&nbsp;<span class="op" id="7824450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7824456">t</span><span class="op" id="7824457">.</span><span class="ident" id="7824458">Fatalf</span><span class="op" id="7824464">(</span><span class="string" id="7824465">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7824494">,</span>&nbsp;<span class="ident" id="7824496">err</span><span class="op" id="7824499">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824509">switch</span>&nbsp;<span class="ident" id="7824516">m</span><span class="op" id="7824517">.</span><span class="ident" id="7824518">Type</span>&nbsp;<span class="op" id="7824523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824528">case</span>&nbsp;<span class="ident" id="7824533">icmpv4EchoRequest</span><span class="op" id="7824550">,</span>&nbsp;<span class="ident" id="7824552">icmpv6EchoRequest</span><span class="op" id="7824569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824575">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824587">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824592">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824604">switch</span>&nbsp;<span class="ident" id="7824611">p</span>&nbsp;<span class="op" id="7824613">:=</span>&nbsp;<span class="ident" id="7824616">m</span><span class="op" id="7824617">.</span><span class="ident" id="7824618">Body</span><span class="op" id="7824622">.</span><span class="op" id="7824623">(</span><span class="keyword" id="7824624">type</span><span class="op" id="7824628">)</span>&nbsp;<span class="op" id="7824630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824634">case</span>&nbsp;<span class="op" id="7824639">*</span><span class="ident" id="7824640">icmpEcho</span><span class="op" id="7824648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824653">if</span>&nbsp;<span class="ident" id="7824656">p</span><span class="op" id="7824657">.</span><span class="ident" id="7824658">ID</span>&nbsp;<span class="op" id="7824661">!=</span>&nbsp;<span class="ident" id="7824664">xid</span>&nbsp;<span class="op" id="7824668">||</span>&nbsp;<span class="ident" id="7824671">p</span><span class="op" id="7824672">.</span><span class="ident" id="7824673">Seq</span>&nbsp;<span class="op" id="7824677">!=</span>&nbsp;<span class="ident" id="7824680">xseq</span>&nbsp;<span class="op" id="7824685">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7824691">t</span><span class="op" id="7824692">.</span><span class="ident" id="7824693">Fatalf</span><span class="op" id="7824699">(</span><span class="string" id="7824700">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="7824749">,</span>&nbsp;<span class="ident" id="7824751">p</span><span class="op" id="7824752">.</span><span class="ident" id="7824753">ID</span><span class="op" id="7824755">,</span>&nbsp;<span class="ident" id="7824757">p</span><span class="op" id="7824758">.</span><span class="ident" id="7824759">Seq</span><span class="op" id="7824762">,</span>&nbsp;<span class="ident" id="7824764">xid</span><span class="op" id="7824767">,</span>&nbsp;<span class="ident" id="7824769">xseq</span><span class="op" id="7824773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824782">default</span><span class="op" id="7824789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7824794">t</span><span class="op" id="7824795">.</span><span class="ident" id="7824796">Fatalf</span><span class="op" id="7824802">(</span><span class="string" id="7824803">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="7824852">,</span>&nbsp;<span class="ident" id="7824854">m</span><span class="op" id="7824855">.</span><span class="ident" id="7824856">Type</span><span class="op" id="7824860">,</span>&nbsp;<span class="ident" id="7824862">m</span><span class="op" id="7824863">.</span><span class="ident" id="7824864">Code</span><span class="op" id="7824868">,</span>&nbsp;<span class="ident" id="7824870">typ</span><span class="op" id="7824873">,</span>&nbsp;<span class="num" id="7824875">0</span><span class="op" id="7824876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824880">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7824883">}</span><br>
<span class="lineno"></span><span class="op" id="7824885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7824888">func</span>&nbsp;<span class="ident" id="7824893">TestPacketConnICMPEcho</span><span class="op" id="7824915">(</span><span class="ident" id="7824916">t</span>&nbsp;<span class="op" id="7824918">*</span><span class="ident" id="7824919">testing</span><span class="op" id="7824926">.</span><span class="ident" id="7824927">T</span><span class="op" id="7824928">)</span>&nbsp;<span class="op" id="7824930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7824933">if</span>&nbsp;<span class="ident" id="7824936">skip</span><span class="op" id="7824940">,</span>&nbsp;<span class="ident" id="7824942">skipmsg</span>&nbsp;<span class="op" id="7824950">:=</span>&nbsp;<span class="ident" id="7824953">skipRawSocketTest</span><span class="op" id="7824970">(</span><span class="ident" id="7824971">t</span><span class="op" id="7824972">)</span><span class="op" id="7824973">;</span>&nbsp;<span class="ident" id="7824975">skip</span>&nbsp;<span class="op" id="7824980">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7824984">t</span><span class="op" id="7824985">.</span><span class="ident" id="7824986">Skip</span><span class="op" id="7824990">(</span><span class="ident" id="7824991">skipmsg</span><span class="op" id="7824998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7825001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7825005">for</span>&nbsp;<span class="ident" id="7825009">i</span><span class="op" id="7825010">,</span>&nbsp;<span class="ident" id="7825012">tt</span>&nbsp;<span class="op" id="7825015">:=</span>&nbsp;<span class="keyword" id="7825018">range</span>&nbsp;<span class="ident" id="7825024">icmpEchoTests</span>&nbsp;<span class="op" id="7825038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825042">net</span><span class="op" id="7825045">,</span>&nbsp;<span class="ident" id="7825047">_</span><span class="op" id="7825048">,</span>&nbsp;<span class="ident" id="7825050">err</span>&nbsp;<span class="op" id="7825054">:=</span>&nbsp;<span class="ident" id="7825057">parseNetwork</span><span class="op" id="7825069">(</span><span class="ident" id="7825070">tt</span><span class="op" id="7825072">.</span><span class="ident" id="7825073">net</span><span class="op" id="7825076">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7825080">if</span>&nbsp;<span class="ident" id="7825083">err</span>&nbsp;<span class="op" id="7825087">!=</span>&nbsp;<span class="ident" id="7825090">nil</span>&nbsp;<span class="op" id="7825094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825099">t</span><span class="op" id="7825100">.</span><span class="ident" id="7825101">Fatalf</span><span class="op" id="7825107">(</span><span class="string" id="7825108">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7825133">,</span>&nbsp;<span class="ident" id="7825135">err</span><span class="op" id="7825138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7825142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7825146">if</span>&nbsp;<span class="ident" id="7825149">net</span>&nbsp;<span class="op" id="7825153">==</span>&nbsp;<span class="string" id="7825156">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7825162">&amp;&amp;</span>&nbsp;<span class="op" id="7825165">!</span><span class="ident" id="7825166">supportsIPv6</span>&nbsp;<span class="op" id="7825179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7825184">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7825195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825200">c</span><span class="op" id="7825201">,</span>&nbsp;<span class="ident" id="7825203">err</span>&nbsp;<span class="op" id="7825207">:=</span>&nbsp;<span class="ident" id="7825210">ListenPacket</span><span class="op" id="7825222">(</span><span class="ident" id="7825223">tt</span><span class="op" id="7825225">.</span><span class="ident" id="7825226">net</span><span class="op" id="7825229">,</span>&nbsp;<span class="ident" id="7825231">tt</span><span class="op" id="7825233">.</span><span class="ident" id="7825234">laddr</span><span class="op" id="7825239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7825243">if</span>&nbsp;<span class="ident" id="7825246">err</span>&nbsp;<span class="op" id="7825250">!=</span>&nbsp;<span class="ident" id="7825253">nil</span>&nbsp;<span class="op" id="7825257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825262">t</span><span class="op" id="7825263">.</span><span class="ident" id="7825264">Fatalf</span><span class="op" id="7825270">(</span><span class="string" id="7825271">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7825296">,</span>&nbsp;<span class="ident" id="7825298">err</span><span class="op" id="7825301">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7825305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825309">c</span><span class="op" id="7825310">.</span><span class="ident" id="7825311">SetDeadline</span><span class="op" id="7825322">(</span><span class="ident" id="7825323">time</span><span class="op" id="7825327">.</span><span class="ident" id="7825328">Now</span><span class="op" id="7825331">(</span><span class="op" id="7825332">)</span><span class="op" id="7825333">.</span><span class="ident" id="7825334">Add</span><span class="op" id="7825337">(</span><span class="num" id="7825338">100</span>&nbsp;<span class="op" id="7825342">*</span>&nbsp;<span class="ident" id="7825344">time</span><span class="op" id="7825348">.</span><span class="ident" id="7825349">Millisecond</span><span class="op" id="7825360">)</span><span class="op" id="7825361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7825365">defer</span>&nbsp;<span class="ident" id="7825371">c</span><span class="op" id="7825372">.</span><span class="ident" id="7825373">Close</span><span class="op" id="7825378">(</span><span class="op" id="7825379">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825384">ra</span><span class="op" id="7825386">,</span>&nbsp;<span class="ident" id="7825388">err</span>&nbsp;<span class="op" id="7825392">:=</span>&nbsp;<span class="ident" id="7825395">ResolveIPAddr</span><span class="op" id="7825408">(</span><span class="ident" id="7825409">tt</span><span class="op" id="7825411">.</span><span class="ident" id="7825412">net</span><span class="op" id="7825415">,</span>&nbsp;<span class="ident" id="7825417">tt</span><span class="op" id="7825419">.</span><span class="ident" id="7825420">raddr</span><span class="op" id="7825425">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7825429">if</span>&nbsp;<span class="ident" id="7825432">err</span>&nbsp;<span class="op" id="7825436">!=</span>&nbsp;<span class="ident" id="7825439">nil</span>&nbsp;<span class="op" id="7825443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825448">t</span><span class="op" id="7825449">.</span><span class="ident" id="7825450">Fatalf</span><span class="op" id="7825456">(</span><span class="string" id="7825457">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7825483">,</span>&nbsp;<span class="ident" id="7825485">err</span><span class="op" id="7825488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7825492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825496">typ</span>&nbsp;<span class="op" id="7825500">:=</span>&nbsp;<span class="ident" id="7825503">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7825523">if</span>&nbsp;<span class="ident" id="7825526">net</span>&nbsp;<span class="op" id="7825530">==</span>&nbsp;<span class="string" id="7825533">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7825539">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825544">typ</span>&nbsp;<span class="op" id="7825548">=</span>&nbsp;<span class="ident" id="7825550">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7825570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825574">xid</span><span class="op" id="7825577">,</span>&nbsp;<span class="ident" id="7825579">xseq</span>&nbsp;<span class="op" id="7825584">:=</span>&nbsp;<span class="ident" id="7825587">os</span><span class="op" id="7825589">.</span><span class="ident" id="7825590">Getpid</span><span class="op" id="7825596">(</span><span class="op" id="7825597">)</span><span class="op" id="7825598">&amp;</span><span class="num" id="7825599">0xffff</span><span class="op" id="7825605">,</span>&nbsp;<span class="ident" id="7825607">i</span><span class="op" id="7825608">+</span><span class="num" id="7825609">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825613">wb</span><span class="op" id="7825615">,</span>&nbsp;<span class="ident" id="7825617">err</span>&nbsp;<span class="op" id="7825621">:=</span>&nbsp;<span class="op" id="7825624">(</span><span class="op" id="7825625">&amp;</span><span class="ident" id="7825626">icmpMessage</span><span class="op" id="7825637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825642">Type</span><span class="op" id="7825646">:</span>&nbsp;<span class="ident" id="7825648">typ</span><span class="op" id="7825651">,</span>&nbsp;<span class="ident" id="7825653">Code</span><span class="op" id="7825657">:</span>&nbsp;<span class="num" id="7825659">0</span><span class="op" id="7825660">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825665">Body</span><span class="op" id="7825669">:</span>&nbsp;<span class="op" id="7825671">&amp;</span><span class="ident" id="7825672">icmpEcho</span><span class="op" id="7825680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825686">ID</span><span class="op" id="7825688">:</span>&nbsp;<span class="ident" id="7825690">xid</span><span class="op" id="7825693">,</span>&nbsp;<span class="ident" id="7825695">Seq</span><span class="op" id="7825698">:</span>&nbsp;<span class="ident" id="7825700">xseq</span><span class="op" id="7825704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825710">Data</span><span class="op" id="7825714">:</span>&nbsp;<span class="ident" id="7825716">bytes</span><span class="op" id="7825721">.</span><span class="ident" id="7825722">Repeat</span><span class="op" id="7825728">(</span><span class="op" id="7825729">[</span><span class="op" id="7825730">]</span><span class="builtintype" id="7825731">byte</span><span class="op" id="7825735">(</span><span class="string" id="7825736">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="7825758">)</span><span class="op" id="7825759">,</span>&nbsp;<span class="num" id="7825761">3</span><span class="op" id="7825762">)</span><span class="op" id="7825763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7825768">}</span><span class="op" id="7825769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7825773">}</span><span class="op" id="7825774">)</span><span class="op" id="7825775">.</span><span class="ident" id="7825776">Marshal</span><span class="op" id="7825783">(</span><span class="op" id="7825784">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7825788">if</span>&nbsp;<span class="ident" id="7825791">err</span>&nbsp;<span class="op" id="7825795">!=</span>&nbsp;<span class="ident" id="7825798">nil</span>&nbsp;<span class="op" id="7825802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825807">t</span><span class="op" id="7825808">.</span><span class="ident" id="7825809">Fatalf</span><span class="op" id="7825815">(</span><span class="string" id="7825816">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7825848">,</span>&nbsp;<span class="ident" id="7825850">err</span><span class="op" id="7825853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7825857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7825861">if</span>&nbsp;<span class="ident" id="7825864">_</span><span class="op" id="7825865">,</span>&nbsp;<span class="ident" id="7825867">err</span>&nbsp;<span class="op" id="7825871">:=</span>&nbsp;<span class="ident" id="7825874">c</span><span class="op" id="7825875">.</span><span class="ident" id="7825876">WriteTo</span><span class="op" id="7825883">(</span><span class="ident" id="7825884">wb</span><span class="op" id="7825886">,</span>&nbsp;<span class="ident" id="7825888">ra</span><span class="op" id="7825890">)</span><span class="op" id="7825891">;</span>&nbsp;<span class="ident" id="7825893">err</span>&nbsp;<span class="op" id="7825897">!=</span>&nbsp;<span class="ident" id="7825900">nil</span>&nbsp;<span class="op" id="7825904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825909">t</span><span class="op" id="7825910">.</span><span class="ident" id="7825911">Fatalf</span><span class="op" id="7825917">(</span><span class="string" id="7825918">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7825949">,</span>&nbsp;<span class="ident" id="7825951">err</span><span class="op" id="7825954">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7825958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7825962">var</span>&nbsp;<span class="ident" id="7825966">m</span>&nbsp;<span class="op" id="7825968">*</span><span class="ident" id="7825969">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7825983">rb</span>&nbsp;<span class="op" id="7825986">:=</span>&nbsp;<span class="builtinfunc" id="7825989">make</span><span class="op" id="7825993">(</span><span class="op" id="7825994">[</span><span class="op" id="7825995">]</span><span class="builtintype" id="7825996">byte</span><span class="op" id="7826000">,</span>&nbsp;<span class="num" id="7826002">20</span><span class="op" id="7826004">+</span><span class="builtinfunc" id="7826005">len</span><span class="op" id="7826008">(</span><span class="ident" id="7826009">wb</span><span class="op" id="7826011">)</span><span class="op" id="7826012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826016">for</span>&nbsp;<span class="op" id="7826020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826025">if</span>&nbsp;<span class="ident" id="7826028">_</span><span class="op" id="7826029">,</span>&nbsp;<span class="ident" id="7826031">_</span><span class="op" id="7826032">,</span>&nbsp;<span class="ident" id="7826034">err</span>&nbsp;<span class="op" id="7826038">:=</span>&nbsp;<span class="ident" id="7826041">c</span><span class="op" id="7826042">.</span><span class="ident" id="7826043">ReadFrom</span><span class="op" id="7826051">(</span><span class="ident" id="7826052">rb</span><span class="op" id="7826054">)</span><span class="op" id="7826055">;</span>&nbsp;<span class="ident" id="7826057">err</span>&nbsp;<span class="op" id="7826061">!=</span>&nbsp;<span class="ident" id="7826064">nil</span>&nbsp;<span class="op" id="7826068">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7826074">t</span><span class="op" id="7826075">.</span><span class="ident" id="7826076">Fatalf</span><span class="op" id="7826082">(</span><span class="string" id="7826083">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7826115">,</span>&nbsp;<span class="ident" id="7826117">err</span><span class="op" id="7826120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7826125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7826130">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7826153">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7826176">//&nbsp;&nbsp;&nbsp;&nbsprb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7826203">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826210">if</span>&nbsp;<span class="ident" id="7826213">m</span><span class="op" id="7826214">,</span>&nbsp;<span class="ident" id="7826216">err</span>&nbsp;<span class="op" id="7826220">=</span>&nbsp;<span class="ident" id="7826222">parseICMPMessage</span><span class="op" id="7826238">(</span><span class="ident" id="7826239">rb</span><span class="op" id="7826241">)</span><span class="op" id="7826242">;</span>&nbsp;<span class="ident" id="7826244">err</span>&nbsp;<span class="op" id="7826248">!=</span>&nbsp;<span class="ident" id="7826251">nil</span>&nbsp;<span class="op" id="7826255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7826261">t</span><span class="op" id="7826262">.</span><span class="ident" id="7826263">Fatalf</span><span class="op" id="7826269">(</span><span class="string" id="7826270">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7826299">,</span>&nbsp;<span class="ident" id="7826301">err</span><span class="op" id="7826304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7826309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826314">switch</span>&nbsp;<span class="ident" id="7826321">m</span><span class="op" id="7826322">.</span><span class="ident" id="7826323">Type</span>&nbsp;<span class="op" id="7826328">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826333">case</span>&nbsp;<span class="ident" id="7826338">icmpv4EchoRequest</span><span class="op" id="7826355">,</span>&nbsp;<span class="ident" id="7826357">icmpv6EchoRequest</span><span class="op" id="7826374">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826380">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7826392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826397">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7826405">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826409">switch</span>&nbsp;<span class="ident" id="7826416">p</span>&nbsp;<span class="op" id="7826418">:=</span>&nbsp;<span class="ident" id="7826421">m</span><span class="op" id="7826422">.</span><span class="ident" id="7826423">Body</span><span class="op" id="7826427">.</span><span class="op" id="7826428">(</span><span class="keyword" id="7826429">type</span><span class="op" id="7826433">)</span>&nbsp;<span class="op" id="7826435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826439">case</span>&nbsp;<span class="op" id="7826444">*</span><span class="ident" id="7826445">icmpEcho</span><span class="op" id="7826453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826458">if</span>&nbsp;<span class="ident" id="7826461">p</span><span class="op" id="7826462">.</span><span class="ident" id="7826463">ID</span>&nbsp;<span class="op" id="7826466">!=</span>&nbsp;<span class="ident" id="7826469">xid</span>&nbsp;<span class="op" id="7826473">||</span>&nbsp;<span class="ident" id="7826476">p</span><span class="op" id="7826477">.</span><span class="ident" id="7826478">Seq</span>&nbsp;<span class="op" id="7826482">!=</span>&nbsp;<span class="ident" id="7826485">xseq</span>&nbsp;<span class="op" id="7826490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7826496">t</span><span class="op" id="7826497">.</span><span class="ident" id="7826498">Fatalf</span><span class="op" id="7826504">(</span><span class="string" id="7826505">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="7826554">,</span>&nbsp;<span class="ident" id="7826556">p</span><span class="op" id="7826557">.</span><span class="ident" id="7826558">ID</span><span class="op" id="7826560">,</span>&nbsp;<span class="ident" id="7826562">p</span><span class="op" id="7826563">.</span><span class="ident" id="7826564">Seq</span><span class="op" id="7826567">,</span>&nbsp;<span class="ident" id="7826569">xid</span><span class="op" id="7826572">,</span>&nbsp;<span class="ident" id="7826574">xseq</span><span class="op" id="7826578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7826583">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826587">default</span><span class="op" id="7826594">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7826599">t</span><span class="op" id="7826600">.</span><span class="ident" id="7826601">Fatalf</span><span class="op" id="7826607">(</span><span class="string" id="7826608">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="7826657">,</span>&nbsp;<span class="ident" id="7826659">m</span><span class="op" id="7826660">.</span><span class="ident" id="7826661">Type</span><span class="op" id="7826665">,</span>&nbsp;<span class="ident" id="7826667">m</span><span class="op" id="7826668">.</span><span class="ident" id="7826669">Code</span><span class="op" id="7826673">,</span>&nbsp;<span class="ident" id="7826675">typ</span><span class="op" id="7826678">,</span>&nbsp;<span class="num" id="7826680">0</span><span class="op" id="7826681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7826685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7826688">}</span><br>
<span class="lineno"></span><span class="op" id="7826690">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="7826693">func</span>&nbsp;<span class="ident" id="7826698">ipv4Payload</span><span class="op" id="7826709">(</span><span class="ident" id="7826710">b</span>&nbsp;<span class="op" id="7826712">[</span><span class="op" id="7826713">]</span><span class="builtintype" id="7826714">byte</span><span class="op" id="7826718">)</span>&nbsp;<span class="op" id="7826720">[</span><span class="op" id="7826721">]</span><span class="builtintype" id="7826722">byte</span>&nbsp;<span class="op" id="7826727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826730">if</span>&nbsp;<span class="builtinfunc" id="7826733">len</span><span class="op" id="7826736">(</span><span class="ident" id="7826737">b</span><span class="op" id="7826738">)</span>&nbsp;<span class="op" id="7826740">&lt;</span>&nbsp;<span class="num" id="7826742">20</span>&nbsp;<span class="op" id="7826745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826749">return</span>&nbsp;<span class="ident" id="7826756">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7826759">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7826762">hdrlen</span>&nbsp;<span class="op" id="7826769">:=</span>&nbsp;<span class="builtintype" id="7826772">int</span><span class="op" id="7826775">(</span><span class="ident" id="7826776">b</span><span class="op" id="7826777">[</span><span class="num" id="7826778">0</span><span class="op" id="7826779">]</span><span class="op" id="7826780">&amp;</span><span class="num" id="7826781">0x0f</span><span class="op" id="7826785">)</span>&nbsp;<span class="op" id="7826787">&lt;&lt;</span>&nbsp;<span class="num" id="7826790">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7826793">return</span>&nbsp;<span class="ident" id="7826800">b</span><span class="op" id="7826801">[</span><span class="ident" id="7826802">hdrlen</span><span class="op" id="7826808">:</span><span class="op" id="7826809">]</span><br>
<span class="lineno"></span><span class="op" id="7826811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7826814">var</span>&nbsp;<span class="ident" id="7826818">ipConnLocalNameTests</span>&nbsp;<span class="op" id="7826839">=</span>&nbsp;<span class="op" id="7826841">[</span><span class="op" id="7826842">]</span><span class="keyword" id="7826843">struct</span>&nbsp;<span class="op" id="7826850">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7826853">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7826859">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7826867">laddr</span>&nbsp;<span class="op" id="7826873">*</span><span class="ident" id="7826874">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="7826881">}</span><span class="op" id="7826882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7826885">{</span><span class="string" id="7826886">&#34;ip4:icmp&#34;</span><span class="op" id="7826896">,</span>&nbsp;<span class="op" id="7826898">&amp;</span><span class="ident" id="7826899">IPAddr</span><span class="op" id="7826905">{</span><span class="ident" id="7826906">IP</span><span class="op" id="7826908">:</span>&nbsp;<span class="ident" id="7826910">IPv4</span><span class="op" id="7826914">(</span><span class="num" id="7826915">127</span><span class="op" id="7826918">,</span>&nbsp;<span class="num" id="7826920">0</span><span class="op" id="7826921">,</span>&nbsp;<span class="num" id="7826923">0</span><span class="op" id="7826924">,</span>&nbsp;<span class="num" id="7826926">1</span><span class="op" id="7826927">)</span><span class="op" id="7826928">}</span><span class="op" id="7826929">}</span><span class="op" id="7826930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7826933">{</span><span class="string" id="7826934">&#34;ip4:icmp&#34;</span><span class="op" id="7826944">,</span>&nbsp;<span class="op" id="7826946">&amp;</span><span class="ident" id="7826947">IPAddr</span><span class="op" id="7826953">{</span><span class="op" id="7826954">}</span><span class="op" id="7826955">}</span><span class="op" id="7826956">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7826959">{</span><span class="string" id="7826960">&#34;ip4:icmp&#34;</span><span class="op" id="7826970">,</span>&nbsp;<span class="ident" id="7826972">nil</span><span class="op" id="7826975">}</span><span class="op" id="7826976">,</span><br>
<span class="lineno"></span><span class="op" id="7826978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7826981">func</span>&nbsp;<span class="ident" id="7826986">TestIPConnLocalName</span><span class="op" id="7827005">(</span><span class="ident" id="7827006">t</span>&nbsp;<span class="op" id="7827008">*</span><span class="ident" id="7827009">testing</span><span class="op" id="7827016">.</span><span class="ident" id="7827017">T</span><span class="op" id="7827018">)</span>&nbsp;<span class="op" id="7827020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827023">switch</span>&nbsp;<span class="ident" id="7827030">runtime</span><span class="op" id="7827037">.</span><span class="ident" id="7827038">GOOS</span>&nbsp;<span class="op" id="7827043">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827046">case</span>&nbsp;<span class="string" id="7827051">&#34;nacl&#34;</span><span class="op" id="7827057">,</span>&nbsp;<span class="string" id="7827059">&#34;plan9&#34;</span><span class="op" id="7827066">,</span>&nbsp;<span class="string" id="7827068">&#34;windows&#34;</span><span class="op" id="7827077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827081">t</span><span class="op" id="7827082">.</span><span class="ident" id="7827083">Skipf</span><span class="op" id="7827088">(</span><span class="string" id="7827089">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7827110">,</span>&nbsp;<span class="ident" id="7827112">runtime</span><span class="op" id="7827119">.</span><span class="ident" id="7827120">GOOS</span><span class="op" id="7827124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827127">default</span><span class="op" id="7827134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827138">if</span>&nbsp;<span class="ident" id="7827141">os</span><span class="op" id="7827143">.</span><span class="ident" id="7827144">Getuid</span><span class="op" id="7827150">(</span><span class="op" id="7827151">)</span>&nbsp;<span class="op" id="7827153">!=</span>&nbsp;<span class="num" id="7827156">0</span>&nbsp;<span class="op" id="7827158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827163">t</span><span class="op" id="7827164">.</span><span class="ident" id="7827165">Skip</span><span class="op" id="7827169">(</span><span class="string" id="7827170">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="7827199">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827210">for</span>&nbsp;<span class="ident" id="7827214">_</span><span class="op" id="7827215">,</span>&nbsp;<span class="ident" id="7827217">tt</span>&nbsp;<span class="op" id="7827220">:=</span>&nbsp;<span class="keyword" id="7827223">range</span>&nbsp;<span class="ident" id="7827229">ipConnLocalNameTests</span>&nbsp;<span class="op" id="7827250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827254">c</span><span class="op" id="7827255">,</span>&nbsp;<span class="ident" id="7827257">err</span>&nbsp;<span class="op" id="7827261">:=</span>&nbsp;<span class="ident" id="7827264">ListenIP</span><span class="op" id="7827272">(</span><span class="ident" id="7827273">tt</span><span class="op" id="7827275">.</span><span class="ident" id="7827276">net</span><span class="op" id="7827279">,</span>&nbsp;<span class="ident" id="7827281">tt</span><span class="op" id="7827283">.</span><span class="ident" id="7827284">laddr</span><span class="op" id="7827289">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827293">if</span>&nbsp;<span class="ident" id="7827296">err</span>&nbsp;<span class="op" id="7827300">!=</span>&nbsp;<span class="ident" id="7827303">nil</span>&nbsp;<span class="op" id="7827307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827312">t</span><span class="op" id="7827313">.</span><span class="ident" id="7827314">Fatalf</span><span class="op" id="7827320">(</span><span class="string" id="7827321">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7827342">,</span>&nbsp;<span class="ident" id="7827344">err</span><span class="op" id="7827347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827355">defer</span>&nbsp;<span class="ident" id="7827361">c</span><span class="op" id="7827362">.</span><span class="ident" id="7827363">Close</span><span class="op" id="7827368">(</span><span class="op" id="7827369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827373">if</span>&nbsp;<span class="ident" id="7827376">la</span>&nbsp;<span class="op" id="7827379">:=</span>&nbsp;<span class="ident" id="7827382">c</span><span class="op" id="7827383">.</span><span class="ident" id="7827384">LocalAddr</span><span class="op" id="7827393">(</span><span class="op" id="7827394">)</span><span class="op" id="7827395">;</span>&nbsp;<span class="ident" id="7827397">la</span>&nbsp;<span class="op" id="7827400">==</span>&nbsp;<span class="ident" id="7827403">nil</span>&nbsp;<span class="op" id="7827407">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827412">t</span><span class="op" id="7827413">.</span><span class="ident" id="7827414">Fatal</span><span class="op" id="7827419">(</span><span class="string" id="7827420">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="7827445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827452">}</span><br>
<span class="lineno"></span><span class="op" id="7827454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="7827457">func</span>&nbsp;<span class="ident" id="7827462">TestIPConnRemoteName</span><span class="op" id="7827482">(</span><span class="ident" id="7827483">t</span>&nbsp;<span class="op" id="7827485">*</span><span class="ident" id="7827486">testing</span><span class="op" id="7827493">.</span><span class="ident" id="7827494">T</span><span class="op" id="7827495">)</span>&nbsp;<span class="op" id="7827497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827500">switch</span>&nbsp;<span class="ident" id="7827507">runtime</span><span class="op" id="7827514">.</span><span class="ident" id="7827515">GOOS</span>&nbsp;<span class="op" id="7827520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827523">case</span>&nbsp;<span class="string" id="7827528">&#34;plan9&#34;</span><span class="op" id="7827535">,</span>&nbsp;<span class="string" id="7827537">&#34;windows&#34;</span><span class="op" id="7827546">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827550">t</span><span class="op" id="7827551">.</span><span class="ident" id="7827552">Skipf</span><span class="op" id="7827557">(</span><span class="string" id="7827558">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7827579">,</span>&nbsp;<span class="ident" id="7827581">runtime</span><span class="op" id="7827588">.</span><span class="ident" id="7827589">GOOS</span><span class="op" id="7827593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827596">default</span><span class="op" id="7827603">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827607">if</span>&nbsp;<span class="ident" id="7827610">os</span><span class="op" id="7827612">.</span><span class="ident" id="7827613">Getuid</span><span class="op" id="7827619">(</span><span class="op" id="7827620">)</span>&nbsp;<span class="op" id="7827622">!=</span>&nbsp;<span class="num" id="7827625">0</span>&nbsp;<span class="op" id="7827627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827632">t</span><span class="op" id="7827633">.</span><span class="ident" id="7827634">Skip</span><span class="op" id="7827638">(</span><span class="string" id="7827639">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="7827668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827679">raddr</span>&nbsp;<span class="op" id="7827685">:=</span>&nbsp;<span class="op" id="7827688">&amp;</span><span class="ident" id="7827689">IPAddr</span><span class="op" id="7827695">{</span><span class="ident" id="7827696">IP</span><span class="op" id="7827698">:</span>&nbsp;<span class="ident" id="7827700">IPv4</span><span class="op" id="7827704">(</span><span class="num" id="7827705">127</span><span class="op" id="7827708">,</span>&nbsp;<span class="num" id="7827710">0</span><span class="op" id="7827711">,</span>&nbsp;<span class="num" id="7827713">0</span><span class="op" id="7827714">,</span>&nbsp;<span class="num" id="7827716">1</span><span class="op" id="7827717">)</span><span class="op" id="7827718">.</span><span class="ident" id="7827719">To4</span><span class="op" id="7827722">(</span><span class="op" id="7827723">)</span><span class="op" id="7827724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827727">c</span><span class="op" id="7827728">,</span>&nbsp;<span class="ident" id="7827730">err</span>&nbsp;<span class="op" id="7827734">:=</span>&nbsp;<span class="ident" id="7827737">DialIP</span><span class="op" id="7827743">(</span><span class="string" id="7827744">&#34;ip:tcp&#34;</span><span class="op" id="7827752">,</span>&nbsp;<span class="op" id="7827754">&amp;</span><span class="ident" id="7827755">IPAddr</span><span class="op" id="7827761">{</span><span class="ident" id="7827762">IP</span><span class="op" id="7827764">:</span>&nbsp;<span class="ident" id="7827766">IPv4</span><span class="op" id="7827770">(</span><span class="num" id="7827771">127</span><span class="op" id="7827774">,</span>&nbsp;<span class="num" id="7827776">0</span><span class="op" id="7827777">,</span>&nbsp;<span class="num" id="7827779">0</span><span class="op" id="7827780">,</span>&nbsp;<span class="num" id="7827782">1</span><span class="op" id="7827783">)</span><span class="op" id="7827784">}</span><span class="op" id="7827785">,</span>&nbsp;<span class="ident" id="7827787">raddr</span><span class="op" id="7827792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827795">if</span>&nbsp;<span class="ident" id="7827798">err</span>&nbsp;<span class="op" id="7827802">!=</span>&nbsp;<span class="ident" id="7827805">nil</span>&nbsp;<span class="op" id="7827809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827813">t</span><span class="op" id="7827814">.</span><span class="ident" id="7827815">Fatalf</span><span class="op" id="7827821">(</span><span class="string" id="7827822">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7827841">,</span>&nbsp;<span class="ident" id="7827843">err</span><span class="op" id="7827846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827849">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827852">defer</span>&nbsp;<span class="ident" id="7827858">c</span><span class="op" id="7827859">.</span><span class="ident" id="7827860">Close</span><span class="op" id="7827865">(</span><span class="op" id="7827866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827869">if</span>&nbsp;<span class="op" id="7827872">!</span><span class="ident" id="7827873">reflect</span><span class="op" id="7827880">.</span><span class="ident" id="7827881">DeepEqual</span><span class="op" id="7827890">(</span><span class="ident" id="7827891">raddr</span><span class="op" id="7827896">,</span>&nbsp;<span class="ident" id="7827898">c</span><span class="op" id="7827899">.</span><span class="ident" id="7827900">RemoteAddr</span><span class="op" id="7827910">(</span><span class="op" id="7827911">)</span><span class="op" id="7827912">)</span>&nbsp;<span class="op" id="7827914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827918">t</span><span class="op" id="7827919">.</span><span class="ident" id="7827920">Fatalf</span><span class="op" id="7827926">(</span><span class="string" id="7827927">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7827950">,</span>&nbsp;<span class="ident" id="7827952">c</span><span class="op" id="7827953">.</span><span class="ident" id="7827954">RemoteAddr</span><span class="op" id="7827964">(</span><span class="op" id="7827965">)</span><span class="op" id="7827966">,</span>&nbsp;<span class="ident" id="7827968">raddr</span><span class="op" id="7827973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827976">}</span><br>
<span class="lineno"></span><span class="op" id="7827978">}</span>
</div>
</body>
</html>
