<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/exec</h2>
<ul>
<li><a href="/gostd/os/exec/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/exec/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/os/exec/lp_test.go.html">lp_test.go</a></li>
<li><a href="/gostd/os/exec/lp_unix.go.html">lp_unix.go</a></li>
<li><a href="/gostd/os/exec/lp_unix_test.go.html" class="current">lp_unix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7188552">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7188608">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7188662">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7188713">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7188778">package</span>&nbsp;<span class="ident" id="7188786">exec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7188792">import</span>&nbsp;<span class="op" id="7188799">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7188802">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7188815">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7188821">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7188831">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7188834">func</span>&nbsp;<span class="ident" id="7188839">TestLookPathUnixEmptyPath</span><span class="op" id="7188864">(</span><span class="ident" id="7188865">t</span>&nbsp;<span class="op" id="7188867">*</span><span class="ident" id="7188868">testing</span><span class="op" id="7188875">.</span><span class="ident" id="7188876">T</span><span class="op" id="7188877">)</span>&nbsp;<span class="op" id="7188879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7188882">tmp</span><span class="op" id="7188885">,</span>&nbsp;<span class="ident" id="7188887">err</span>&nbsp;<span class="op" id="7188891">:=</span>&nbsp;<span class="ident" id="7188894">ioutil</span><span class="op" id="7188900">.</span><span class="ident" id="7188901">TempDir</span><span class="op" id="7188908">(</span><span class="string" id="7188909">&#34;&#34;</span><span class="op" id="7188911">,</span>&nbsp;<span class="string" id="7188913">&#34;TestLookPathUnixEmptyPath&#34;</span><span class="op" id="7188940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7188943">if</span>&nbsp;<span class="ident" id="7188946">err</span>&nbsp;<span class="op" id="7188950">!=</span>&nbsp;<span class="builtintype" id="7188953">nil</span>&nbsp;<span class="op" id="7188957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7188961">t</span><span class="op" id="7188962">.</span><span class="ident" id="7188963">Fatal</span><span class="op" id="7188968">(</span><span class="string" id="7188969">&#34;TempDir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7188987">,</span>&nbsp;<span class="ident" id="7188989">err</span><span class="op" id="7188992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7188995">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7188998">defer</span>&nbsp;<span class="ident" id="7189004">os</span><span class="op" id="7189006">.</span><span class="ident" id="7189007">RemoveAll</span><span class="op" id="7189016">(</span><span class="ident" id="7189017">tmp</span><span class="op" id="7189020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189023">wd</span><span class="op" id="7189025">,</span>&nbsp;<span class="ident" id="7189027">err</span>&nbsp;<span class="op" id="7189031">:=</span>&nbsp;<span class="ident" id="7189034">os</span><span class="op" id="7189036">.</span><span class="ident" id="7189037">Getwd</span><span class="op" id="7189042">(</span><span class="op" id="7189043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189046">if</span>&nbsp;<span class="ident" id="7189049">err</span>&nbsp;<span class="op" id="7189053">!=</span>&nbsp;<span class="builtintype" id="7189056">nil</span>&nbsp;<span class="op" id="7189060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189064">t</span><span class="op" id="7189065">.</span><span class="ident" id="7189066">Fatal</span><span class="op" id="7189071">(</span><span class="string" id="7189072">&#34;Getwd&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7189088">,</span>&nbsp;<span class="ident" id="7189090">err</span><span class="op" id="7189093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189096">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189099">err</span>&nbsp;<span class="op" id="7189103">=</span>&nbsp;<span class="ident" id="7189105">os</span><span class="op" id="7189107">.</span><span class="ident" id="7189108">Chdir</span><span class="op" id="7189113">(</span><span class="ident" id="7189114">tmp</span><span class="op" id="7189117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189120">if</span>&nbsp;<span class="ident" id="7189123">err</span>&nbsp;<span class="op" id="7189127">!=</span>&nbsp;<span class="builtintype" id="7189130">nil</span>&nbsp;<span class="op" id="7189134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189138">t</span><span class="op" id="7189139">.</span><span class="ident" id="7189140">Fatal</span><span class="op" id="7189145">(</span><span class="string" id="7189146">&#34;Chdir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7189162">,</span>&nbsp;<span class="ident" id="7189164">err</span><span class="op" id="7189167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189173">defer</span>&nbsp;<span class="ident" id="7189179">os</span><span class="op" id="7189181">.</span><span class="ident" id="7189182">Chdir</span><span class="op" id="7189187">(</span><span class="ident" id="7189188">wd</span><span class="op" id="7189190">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189194">f</span><span class="op" id="7189195">,</span>&nbsp;<span class="ident" id="7189197">err</span>&nbsp;<span class="op" id="7189201">:=</span>&nbsp;<span class="ident" id="7189204">os</span><span class="op" id="7189206">.</span><span class="ident" id="7189207">OpenFile</span><span class="op" id="7189215">(</span><span class="string" id="7189216">&#34;exec_me&#34;</span><span class="op" id="7189225">,</span>&nbsp;<span class="ident" id="7189227">os</span><span class="op" id="7189229">.</span><span class="ident" id="7189230">O_CREATE</span><span class="op" id="7189238">|</span><span class="ident" id="7189239">os</span><span class="op" id="7189241">.</span><span class="ident" id="7189242">O_EXCL</span><span class="op" id="7189248">,</span>&nbsp;<span class="num" id="7189250">0700</span><span class="op" id="7189254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189257">if</span>&nbsp;<span class="ident" id="7189260">err</span>&nbsp;<span class="op" id="7189264">!=</span>&nbsp;<span class="builtintype" id="7189267">nil</span>&nbsp;<span class="op" id="7189271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189275">t</span><span class="op" id="7189276">.</span><span class="ident" id="7189277">Fatal</span><span class="op" id="7189282">(</span><span class="string" id="7189283">&#34;OpenFile&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7189302">,</span>&nbsp;<span class="ident" id="7189304">err</span><span class="op" id="7189307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189310">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189313">err</span>&nbsp;<span class="op" id="7189317">=</span>&nbsp;<span class="ident" id="7189319">f</span><span class="op" id="7189320">.</span><span class="ident" id="7189321">Close</span><span class="op" id="7189326">(</span><span class="op" id="7189327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189330">if</span>&nbsp;<span class="ident" id="7189333">err</span>&nbsp;<span class="op" id="7189337">!=</span>&nbsp;<span class="builtintype" id="7189340">nil</span>&nbsp;<span class="op" id="7189344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189348">t</span><span class="op" id="7189349">.</span><span class="ident" id="7189350">Fatal</span><span class="op" id="7189355">(</span><span class="string" id="7189356">&#34;Close&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7189372">,</span>&nbsp;<span class="ident" id="7189374">err</span><span class="op" id="7189377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189384">pathenv</span>&nbsp;<span class="op" id="7189392">:=</span>&nbsp;<span class="ident" id="7189395">os</span><span class="op" id="7189397">.</span><span class="ident" id="7189398">Getenv</span><span class="op" id="7189404">(</span><span class="string" id="7189405">&#34;PATH&#34;</span><span class="op" id="7189411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189414">defer</span>&nbsp;<span class="ident" id="7189420">os</span><span class="op" id="7189422">.</span><span class="ident" id="7189423">Setenv</span><span class="op" id="7189429">(</span><span class="string" id="7189430">&#34;PATH&#34;</span><span class="op" id="7189436">,</span>&nbsp;<span class="ident" id="7189438">pathenv</span><span class="op" id="7189445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189449">err</span>&nbsp;<span class="op" id="7189453">=</span>&nbsp;<span class="ident" id="7189455">os</span><span class="op" id="7189457">.</span><span class="ident" id="7189458">Setenv</span><span class="op" id="7189464">(</span><span class="string" id="7189465">&#34;PATH&#34;</span><span class="op" id="7189471">,</span>&nbsp;<span class="string" id="7189473">&#34;&#34;</span><span class="op" id="7189475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189478">if</span>&nbsp;<span class="ident" id="7189481">err</span>&nbsp;<span class="op" id="7189485">!=</span>&nbsp;<span class="builtintype" id="7189488">nil</span>&nbsp;<span class="op" id="7189492">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189496">t</span><span class="op" id="7189497">.</span><span class="ident" id="7189498">Fatal</span><span class="op" id="7189503">(</span><span class="string" id="7189504">&#34;Setenv&nbsp;failed:&nbsp;&#34;</span><span class="op" id="7189521">,</span>&nbsp;<span class="ident" id="7189523">err</span><span class="op" id="7189526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189533">path</span><span class="op" id="7189537">,</span>&nbsp;<span class="ident" id="7189539">err</span>&nbsp;<span class="op" id="7189543">:=</span>&nbsp;<span class="ident" id="7189546">LookPath</span><span class="op" id="7189554">(</span><span class="string" id="7189555">&#34;exec_me&#34;</span><span class="op" id="7189564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189567">if</span>&nbsp;<span class="ident" id="7189570">err</span>&nbsp;<span class="op" id="7189574">==</span>&nbsp;<span class="builtintype" id="7189577">nil</span>&nbsp;<span class="op" id="7189581">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189585">t</span><span class="op" id="7189586">.</span><span class="ident" id="7189587">Fatal</span><span class="op" id="7189592">(</span><span class="string" id="7189593">&#34;LookPath&nbsp;found&nbsp;exec_me&nbsp;in&nbsp;empty&nbsp;$PATH&#34;</span><span class="op" id="7189632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7189638">if</span>&nbsp;<span class="ident" id="7189641">path</span>&nbsp;<span class="op" id="7189646">!=</span>&nbsp;<span class="string" id="7189649">&#34;&#34;</span>&nbsp;<span class="op" id="7189652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7189656">t</span><span class="op" id="7189657">.</span><span class="ident" id="7189658">Fatalf</span><span class="op" id="7189664">(</span><span class="string" id="7189665">&#34;LookPath&nbsp;path&nbsp;==&nbsp;%q&nbsp;when&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="7189702">,</span>&nbsp;<span class="ident" id="7189704">path</span><span class="op" id="7189708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7189711">}</span><br>
<span class="lineno">55</span><span class="op" id="7189713">}</span>
</div>
</body>
</html>
