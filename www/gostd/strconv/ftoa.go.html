<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strconv</h2>
<ul>
<li><a href="/gostd/strconv/atob.go.html">atob.go</a></li>
<li><a href="/gostd/strconv/atob_test.go.html">atob_test.go</a></li>
<li><a href="/gostd/strconv/atof.go.html">atof.go</a></li>
<li><a href="/gostd/strconv/atof_test.go.html">atof_test.go</a></li>
<li><a href="/gostd/strconv/atoi.go.html">atoi.go</a></li>
<li><a href="/gostd/strconv/atoi_test.go.html">atoi_test.go</a></li>
<li><a href="/gostd/strconv/decimal.go.html">decimal.go</a></li>
<li><a href="/gostd/strconv/decimal_test.go.html">decimal_test.go</a></li>
<li><a href="/gostd/strconv/extfloat.go.html">extfloat.go</a></li>
<li><a href="/gostd/strconv/fp_test.go.html">fp_test.go</a></li>
<li><a href="/gostd/strconv/ftoa.go.html" class="current">ftoa.go</a></li>
<li><a href="/gostd/strconv/ftoa_test.go.html">ftoa_test.go</a></li>
<li><a href="/gostd/strconv/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/strconv/isprint.go.html">isprint.go</a></li>
<li><a href="/gostd/strconv/itoa.go.html">itoa.go</a></li>
<li><a href="/gostd/strconv/itoa_test.go.html">itoa_test.go</a></li>
<li><a href="/gostd/strconv/quote.go.html">quote.go</a></li>
<li><a href="/gostd/strconv/quote_example_test.go.html">quote_example_test.go</a></li>
<li><a href="/gostd/strconv/quote_test.go.html">quote_test.go</a></li>
<li><a href="/gostd/strconv/strconv_test.go.html">strconv_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2221769">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2221824">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2221878">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2221929">//&nbsp;Binary&nbsp;to&nbsp;decimal&nbsp;floating&nbsp;point&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="2221977">//&nbsp;Algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2221991">//&nbsp;&nbsp;&nbsp;1)&nbsp;store&nbsp;mantissa&nbsp;in&nbsp;multiprecision&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment" id="2222040">//&nbsp;&nbsp;&nbsp;2)&nbsp;shift&nbsp;decimal&nbsp;by&nbsp;exponent</span><br>
<span class="lineno"></span><span class="comment" id="2222074">//&nbsp;&nbsp;&nbsp;3)&nbsp;read&nbsp;digits&nbsp;out&nbsp;&amp;&nbsp;format</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2222108">package</span>&nbsp;<span class="ident" id="2222116">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2222125">import</span>&nbsp;<span class="string" id="2222132">&#34;math&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2222140">//&nbsp;TODO:&nbsp;move&nbsp;elsewhere?</span><br>
<span class="lineno"></span><span class="keyword" id="2222165">type</span>&nbsp;<span class="ident" id="2222170">floatInfo</span>&nbsp;<span class="keyword" id="2222180">struct</span>&nbsp;<span class="op" id="2222187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2222190">mantbits</span>&nbsp;<span class="builtintype" id="2222199">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2222205">expbits</span>&nbsp;&nbsp;<span class="builtintype" id="2222214">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2222220">bias</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2222229">int</span><br>
<span class="lineno">20</span><span class="op" id="2222233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2222236">var</span>&nbsp;<span class="ident" id="2222240">float32info</span>&nbsp;<span class="op" id="2222252">=</span>&nbsp;<span class="ident" id="2222254">floatInfo</span><span class="op" id="2222263">{</span><span class="num" id="2222264">23</span><span class="op" id="2222266">,</span>&nbsp;<span class="num" id="2222268">8</span><span class="op" id="2222269">,</span>&nbsp;<span class="op" id="2222271">-</span><span class="num" id="2222272">127</span><span class="op" id="2222275">}</span><br>
<span class="lineno"></span><span class="keyword" id="2222277">var</span>&nbsp;<span class="ident" id="2222281">float64info</span>&nbsp;<span class="op" id="2222293">=</span>&nbsp;<span class="ident" id="2222295">floatInfo</span><span class="op" id="2222304">{</span><span class="num" id="2222305">52</span><span class="op" id="2222307">,</span>&nbsp;<span class="num" id="2222309">11</span><span class="op" id="2222311">,</span>&nbsp;<span class="op" id="2222313">-</span><span class="num" id="2222314">1023</span><span class="op" id="2222318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2222321">//&nbsp;FormatFloat&nbsp;converts&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f&nbsp;to&nbsp;a&nbsp;string,</span><br>
<span class="lineno"></span><span class="comment" id="2222386">//&nbsp;according&nbsp;to&nbsp;the&nbsp;format&nbsp;fmt&nbsp;and&nbsp;precision&nbsp;prec.&nbsp;&nbsp;It&nbsp;rounds&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2222452">//&nbsp;result&nbsp;assuming&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="2222524">//&nbsp;value&nbsp;of&nbsp;bitSize&nbsp;bits&nbsp;(32&nbsp;for&nbsp;float32,&nbsp;64&nbsp;for&nbsp;float64).</span><br>
<span class="lineno"></span><span class="comment" id="2222583">//</span><br>
<span class="lineno">30</span><span class="comment" id="2222586">//&nbsp;The&nbsp;format&nbsp;fmt&nbsp;is&nbsp;one&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2222614">//&nbsp;&#39;b&#39;&nbsp;(-ddddp±ddd,&nbsp;a&nbsp;binary&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2222655">//&nbsp;&#39;e&#39;&nbsp;(-d.dddde±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2222698">//&nbsp;&#39;E&#39;&nbsp;(-d.ddddE±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2222741">//&nbsp;&#39;f&#39;&nbsp;(-ddd.dddd,&nbsp;no&nbsp;exponent),</span><br>
<span class="lineno">35</span><span class="comment" id="2222774">//&nbsp;&#39;g&#39;&nbsp;(&#39;e&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2222826">//&nbsp;&#39;G&#39;&nbsp;(&#39;E&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise).</span><br>
<span class="lineno"></span><span class="comment" id="2222875">//</span><br>
<span class="lineno"></span><span class="comment" id="2222878">//&nbsp;The&nbsp;precision&nbsp;prec&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2222930">//&nbsp;(excluding&nbsp;the&nbsp;exponent)&nbsp;printed&nbsp;by&nbsp;the&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;g&#39;,&nbsp;and&nbsp;&#39;G&#39;&nbsp;formats.</span><br>
<span class="lineno">40</span><span class="comment" id="2223010">//&nbsp;For&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;and&nbsp;&#39;f&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment" id="2223087">//&nbsp;For&nbsp;&#39;g&#39;&nbsp;and&nbsp;&#39;G&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="2223140">//&nbsp;The&nbsp;special&nbsp;precision&nbsp;-1&nbsp;uses&nbsp;the&nbsp;smallest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2223203">//&nbsp;necessary&nbsp;such&nbsp;that&nbsp;ParseFloat&nbsp;will&nbsp;return&nbsp;f&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="keyword" id="2223260">func</span>&nbsp;<span class="ident" id="2223265">FormatFloat</span><span class="op" id="2223276">(</span><span class="ident" id="2223277">f</span>&nbsp;<span class="builtintype" id="2223279">float64</span><span class="op" id="2223286">,</span>&nbsp;<span class="ident" id="2223288">fmt</span>&nbsp;<span class="builtintype" id="2223292">byte</span><span class="op" id="2223296">,</span>&nbsp;<span class="ident" id="2223298">prec</span><span class="op" id="2223302">,</span>&nbsp;<span class="ident" id="2223304">bitSize</span>&nbsp;<span class="builtintype" id="2223312">int</span><span class="op" id="2223315">)</span>&nbsp;<span class="builtintype" id="2223317">string</span>&nbsp;<span class="op" id="2223324">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223327">return</span>&nbsp;<span class="builtintype" id="2223334">string</span><span class="op" id="2223340">(</span><span class="ident" id="2223341">genericFtoa</span><span class="op" id="2223352">(</span><span class="builtinfunc" id="2223353">make</span><span class="op" id="2223357">(</span><span class="op" id="2223358">[</span><span class="op" id="2223359">]</span><span class="builtintype" id="2223360">byte</span><span class="op" id="2223364">,</span>&nbsp;<span class="num" id="2223366">0</span><span class="op" id="2223367">,</span>&nbsp;<span class="ident" id="2223369">max</span><span class="op" id="2223372">(</span><span class="ident" id="2223373">prec</span><span class="op" id="2223377">+</span><span class="num" id="2223378">4</span><span class="op" id="2223379">,</span>&nbsp;<span class="num" id="2223381">24</span><span class="op" id="2223383">)</span><span class="op" id="2223384">)</span><span class="op" id="2223385">,</span>&nbsp;<span class="ident" id="2223387">f</span><span class="op" id="2223388">,</span>&nbsp;<span class="ident" id="2223390">fmt</span><span class="op" id="2223393">,</span>&nbsp;<span class="ident" id="2223395">prec</span><span class="op" id="2223399">,</span>&nbsp;<span class="ident" id="2223401">bitSize</span><span class="op" id="2223408">)</span><span class="op" id="2223409">)</span><br>
<span class="lineno"></span><span class="op" id="2223411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2223414">//&nbsp;AppendFloat&nbsp;appends&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f,</span><br>
<span class="lineno"></span><span class="comment" id="2223485">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;FormatFloat,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">50</span><span class="keyword" id="2223557">func</span>&nbsp;<span class="ident" id="2223562">AppendFloat</span><span class="op" id="2223573">(</span><span class="ident" id="2223574">dst</span>&nbsp;<span class="op" id="2223578">[</span><span class="op" id="2223579">]</span><span class="builtintype" id="2223580">byte</span><span class="op" id="2223584">,</span>&nbsp;<span class="ident" id="2223586">f</span>&nbsp;<span class="builtintype" id="2223588">float64</span><span class="op" id="2223595">,</span>&nbsp;<span class="ident" id="2223597">fmt</span>&nbsp;<span class="builtintype" id="2223601">byte</span><span class="op" id="2223605">,</span>&nbsp;<span class="ident" id="2223607">prec</span>&nbsp;<span class="builtintype" id="2223612">int</span><span class="op" id="2223615">,</span>&nbsp;<span class="ident" id="2223617">bitSize</span>&nbsp;<span class="builtintype" id="2223625">int</span><span class="op" id="2223628">)</span>&nbsp;<span class="op" id="2223630">[</span><span class="op" id="2223631">]</span><span class="builtintype" id="2223632">byte</span>&nbsp;<span class="op" id="2223637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223640">return</span>&nbsp;<span class="ident" id="2223647">genericFtoa</span><span class="op" id="2223658">(</span><span class="ident" id="2223659">dst</span><span class="op" id="2223662">,</span>&nbsp;<span class="ident" id="2223664">f</span><span class="op" id="2223665">,</span>&nbsp;<span class="ident" id="2223667">fmt</span><span class="op" id="2223670">,</span>&nbsp;<span class="ident" id="2223672">prec</span><span class="op" id="2223676">,</span>&nbsp;<span class="ident" id="2223678">bitSize</span><span class="op" id="2223685">)</span><br>
<span class="lineno"></span><span class="op" id="2223687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2223690">func</span>&nbsp;<span class="ident" id="2223695">genericFtoa</span><span class="op" id="2223706">(</span><span class="ident" id="2223707">dst</span>&nbsp;<span class="op" id="2223711">[</span><span class="op" id="2223712">]</span><span class="builtintype" id="2223713">byte</span><span class="op" id="2223717">,</span>&nbsp;<span class="ident" id="2223719">val</span>&nbsp;<span class="builtintype" id="2223723">float64</span><span class="op" id="2223730">,</span>&nbsp;<span class="ident" id="2223732">fmt</span>&nbsp;<span class="builtintype" id="2223736">byte</span><span class="op" id="2223740">,</span>&nbsp;<span class="ident" id="2223742">prec</span><span class="op" id="2223746">,</span>&nbsp;<span class="ident" id="2223748">bitSize</span>&nbsp;<span class="builtintype" id="2223756">int</span><span class="op" id="2223759">)</span>&nbsp;<span class="op" id="2223761">[</span><span class="op" id="2223762">]</span><span class="builtintype" id="2223763">byte</span>&nbsp;<span class="op" id="2223768">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223771">var</span>&nbsp;<span class="ident" id="2223775">bits</span>&nbsp;<span class="ident" id="2223780">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223788">var</span>&nbsp;<span class="ident" id="2223792">flt</span>&nbsp;<span class="op" id="2223796">*</span><span class="ident" id="2223797">floatInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223808">switch</span>&nbsp;<span class="ident" id="2223815">bitSize</span>&nbsp;<span class="op" id="2223823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223826">case</span>&nbsp;<span class="num" id="2223831">32</span><span class="op" id="2223833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223837">bits</span>&nbsp;<span class="op" id="2223842">=</span>&nbsp;<span class="ident" id="2223844">uint64</span><span class="op" id="2223850">(</span><span class="ident" id="2223851">math</span><span class="op" id="2223855">.</span><span class="ident" id="2223856">Float32bits</span><span class="op" id="2223867">(</span><span class="builtintype" id="2223868">float32</span><span class="op" id="2223875">(</span><span class="ident" id="2223876">val</span><span class="op" id="2223879">)</span><span class="op" id="2223880">)</span><span class="op" id="2223881">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223885">flt</span>&nbsp;<span class="op" id="2223889">=</span>&nbsp;<span class="op" id="2223891">&amp;</span><span class="ident" id="2223892">float32info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223905">case</span>&nbsp;<span class="num" id="2223910">64</span><span class="op" id="2223912">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223916">bits</span>&nbsp;<span class="op" id="2223921">=</span>&nbsp;<span class="ident" id="2223923">math</span><span class="op" id="2223927">.</span><span class="ident" id="2223928">Float64bits</span><span class="op" id="2223939">(</span><span class="ident" id="2223940">val</span><span class="op" id="2223943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2223947">flt</span>&nbsp;<span class="op" id="2223951">=</span>&nbsp;<span class="op" id="2223953">&amp;</span><span class="ident" id="2223954">float64info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2223967">default</span><span class="op" id="2223974">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2223978">panic</span><span class="op" id="2223983">(</span><span class="string" id="2223984">&#34;strconv:&nbsp;illegal&nbsp;AppendFloat/FormatFloat&nbsp;bitSize&#34;</span><span class="op" id="2224034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224041">neg</span>&nbsp;<span class="op" id="2224045">:=</span>&nbsp;<span class="ident" id="2224048">bits</span><span class="op" id="2224052">&gt;&gt;</span><span class="op" id="2224054">(</span><span class="ident" id="2224055">flt</span><span class="op" id="2224058">.</span><span class="ident" id="2224059">expbits</span><span class="op" id="2224066">+</span><span class="ident" id="2224067">flt</span><span class="op" id="2224070">.</span><span class="ident" id="2224071">mantbits</span><span class="op" id="2224079">)</span>&nbsp;<span class="op" id="2224081">!=</span>&nbsp;<span class="num" id="2224084">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224087">exp</span>&nbsp;<span class="op" id="2224091">:=</span>&nbsp;<span class="builtintype" id="2224094">int</span><span class="op" id="2224097">(</span><span class="ident" id="2224098">bits</span><span class="op" id="2224102">&gt;&gt;</span><span class="ident" id="2224104">flt</span><span class="op" id="2224107">.</span><span class="ident" id="2224108">mantbits</span><span class="op" id="2224116">)</span>&nbsp;<span class="op" id="2224118">&amp;</span>&nbsp;<span class="op" id="2224120">(</span><span class="num" id="2224121">1</span><span class="op" id="2224122">&lt;&lt;</span><span class="ident" id="2224124">flt</span><span class="op" id="2224127">.</span><span class="ident" id="2224128">expbits</span>&nbsp;<span class="op" id="2224136">-</span>&nbsp;<span class="num" id="2224138">1</span><span class="op" id="2224139">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224142">mant</span>&nbsp;<span class="op" id="2224147">:=</span>&nbsp;<span class="ident" id="2224150">bits</span>&nbsp;<span class="op" id="2224155">&amp;</span>&nbsp;<span class="op" id="2224157">(</span><span class="ident" id="2224158">uint64</span><span class="op" id="2224164">(</span><span class="num" id="2224165">1</span><span class="op" id="2224166">)</span><span class="op" id="2224167">&lt;&lt;</span><span class="ident" id="2224169">flt</span><span class="op" id="2224172">.</span><span class="ident" id="2224173">mantbits</span>&nbsp;<span class="op" id="2224182">-</span>&nbsp;<span class="num" id="2224184">1</span><span class="op" id="2224185">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224189">switch</span>&nbsp;<span class="ident" id="2224196">exp</span>&nbsp;<span class="op" id="2224200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224203">case</span>&nbsp;<span class="num" id="2224208">1</span><span class="op" id="2224209">&lt;&lt;</span><span class="ident" id="2224211">flt</span><span class="op" id="2224214">.</span><span class="ident" id="2224215">expbits</span>&nbsp;<span class="op" id="2224223">-</span>&nbsp;<span class="num" id="2224225">1</span><span class="op" id="2224226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224230">//&nbsp;Inf,&nbsp;NaN</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224244">var</span>&nbsp;<span class="ident" id="2224248">s</span>&nbsp;<span class="builtintype" id="2224250">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224259">switch</span>&nbsp;<span class="op" id="2224266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224270">case</span>&nbsp;<span class="ident" id="2224275">mant</span>&nbsp;<span class="op" id="2224280">!=</span>&nbsp;<span class="num" id="2224283">0</span><span class="op" id="2224284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224289">s</span>&nbsp;<span class="op" id="2224291">=</span>&nbsp;<span class="string" id="2224293">&#34;NaN&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224301">case</span>&nbsp;<span class="ident" id="2224306">neg</span><span class="op" id="2224309">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224314">s</span>&nbsp;<span class="op" id="2224316">=</span>&nbsp;<span class="string" id="2224318">&#34;-Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224327">default</span><span class="op" id="2224334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224339">s</span>&nbsp;<span class="op" id="2224341">=</span>&nbsp;<span class="string" id="2224343">&#34;+Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224356">return</span>&nbsp;<span class="builtinfunc" id="2224363">append</span><span class="op" id="2224369">(</span><span class="ident" id="2224370">dst</span><span class="op" id="2224373">,</span>&nbsp;<span class="ident" id="2224375">s</span><span class="op" id="2224376">...</span><span class="op" id="2224379">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224383">case</span>&nbsp;<span class="num" id="2224388">0</span><span class="op" id="2224389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224393">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224411">exp</span><span class="op" id="2224414">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224419">default</span><span class="op" id="2224426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224430">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224456">mant</span>&nbsp;<span class="op" id="2224461">|=</span>&nbsp;<span class="ident" id="2224464">uint64</span><span class="op" id="2224470">(</span><span class="num" id="2224471">1</span><span class="op" id="2224472">)</span>&nbsp;<span class="op" id="2224474">&lt;&lt;</span>&nbsp;<span class="ident" id="2224477">flt</span><span class="op" id="2224480">.</span><span class="ident" id="2224481">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224494">exp</span>&nbsp;<span class="op" id="2224498">+=</span>&nbsp;<span class="ident" id="2224501">flt</span><span class="op" id="2224504">.</span><span class="ident" id="2224505">bias</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224512">//&nbsp;Pick&nbsp;off&nbsp;easy&nbsp;binary&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224545">if</span>&nbsp;<span class="ident" id="2224548">fmt</span>&nbsp;<span class="op" id="2224552">==</span>&nbsp;<span class="string" id="2224555">&#39;b&#39;</span>&nbsp;<span class="op" id="2224559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224563">return</span>&nbsp;<span class="ident" id="2224570">fmtB</span><span class="op" id="2224574">(</span><span class="ident" id="2224575">dst</span><span class="op" id="2224578">,</span>&nbsp;<span class="ident" id="2224580">neg</span><span class="op" id="2224583">,</span>&nbsp;<span class="ident" id="2224585">mant</span><span class="op" id="2224589">,</span>&nbsp;<span class="ident" id="2224591">exp</span><span class="op" id="2224594">,</span>&nbsp;<span class="ident" id="2224596">flt</span><span class="op" id="2224599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224602">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224606">if</span>&nbsp;<span class="op" id="2224609">!</span><span class="ident" id="2224610">optimize</span>&nbsp;<span class="op" id="2224619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224623">return</span>&nbsp;<span class="ident" id="2224630">bigFtoa</span><span class="op" id="2224637">(</span><span class="ident" id="2224638">dst</span><span class="op" id="2224641">,</span>&nbsp;<span class="ident" id="2224643">prec</span><span class="op" id="2224647">,</span>&nbsp;<span class="ident" id="2224649">fmt</span><span class="op" id="2224652">,</span>&nbsp;<span class="ident" id="2224654">neg</span><span class="op" id="2224657">,</span>&nbsp;<span class="ident" id="2224659">mant</span><span class="op" id="2224663">,</span>&nbsp;<span class="ident" id="2224665">exp</span><span class="op" id="2224668">,</span>&nbsp;<span class="ident" id="2224670">flt</span><span class="op" id="2224673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224680">var</span>&nbsp;<span class="ident" id="2224684">digs</span>&nbsp;<span class="ident" id="2224689">decimalSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224703">ok</span>&nbsp;<span class="op" id="2224706">:=</span>&nbsp;<span class="builtintype" id="2224709">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224716">//&nbsp;Negative&nbsp;precision&nbsp;means&nbsp;&#34;only&nbsp;as&nbsp;much&nbsp;as&nbsp;needed&nbsp;to&nbsp;be&nbsp;exact.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224783">shortest</span>&nbsp;<span class="op" id="2224792">:=</span>&nbsp;<span class="ident" id="2224795">prec</span>&nbsp;<span class="op" id="2224800">&lt;</span>&nbsp;<span class="num" id="2224802">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224805">if</span>&nbsp;<span class="ident" id="2224808">shortest</span>&nbsp;<span class="op" id="2224817">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2224821">//&nbsp;Try&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224848">f</span>&nbsp;<span class="op" id="2224850">:=</span>&nbsp;<span class="builtinfunc" id="2224853">new</span><span class="op" id="2224856">(</span><span class="ident" id="2224857">extFloat</span><span class="op" id="2224865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224869">lower</span><span class="op" id="2224874">,</span>&nbsp;<span class="ident" id="2224876">upper</span>&nbsp;<span class="op" id="2224882">:=</span>&nbsp;<span class="ident" id="2224885">f</span><span class="op" id="2224886">.</span><span class="ident" id="2224887">AssignComputeBounds</span><span class="op" id="2224906">(</span><span class="ident" id="2224907">mant</span><span class="op" id="2224911">,</span>&nbsp;<span class="ident" id="2224913">exp</span><span class="op" id="2224916">,</span>&nbsp;<span class="ident" id="2224918">neg</span><span class="op" id="2224921">,</span>&nbsp;<span class="ident" id="2224923">flt</span><span class="op" id="2224926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2224930">var</span>&nbsp;<span class="ident" id="2224934">buf</span>&nbsp;<span class="op" id="2224938">[</span><span class="num" id="2224939">32</span><span class="op" id="2224941">]</span><span class="builtintype" id="2224942">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224949">digs</span><span class="op" id="2224953">.</span><span class="ident" id="2224954">d</span>&nbsp;<span class="op" id="2224956">=</span>&nbsp;<span class="ident" id="2224958">buf</span><span class="op" id="2224961">[</span><span class="op" id="2224962">:</span><span class="op" id="2224963">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224967">ok</span>&nbsp;<span class="op" id="2224970">=</span>&nbsp;<span class="ident" id="2224972">f</span><span class="op" id="2224973">.</span><span class="ident" id="2224974">ShortestDecimal</span><span class="op" id="2224989">(</span><span class="op" id="2224990">&amp;</span><span class="ident" id="2224991">digs</span><span class="op" id="2224995">,</span>&nbsp;<span class="op" id="2224997">&amp;</span><span class="ident" id="2224998">lower</span><span class="op" id="2225003">,</span>&nbsp;<span class="op" id="2225005">&amp;</span><span class="ident" id="2225006">upper</span><span class="op" id="2225011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225015">if</span>&nbsp;<span class="op" id="2225018">!</span><span class="ident" id="2225019">ok</span>&nbsp;<span class="op" id="2225022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225027">return</span>&nbsp;<span class="ident" id="2225034">bigFtoa</span><span class="op" id="2225041">(</span><span class="ident" id="2225042">dst</span><span class="op" id="2225045">,</span>&nbsp;<span class="ident" id="2225047">prec</span><span class="op" id="2225051">,</span>&nbsp;<span class="ident" id="2225053">fmt</span><span class="op" id="2225056">,</span>&nbsp;<span class="ident" id="2225058">neg</span><span class="op" id="2225061">,</span>&nbsp;<span class="ident" id="2225063">mant</span><span class="op" id="2225067">,</span>&nbsp;<span class="ident" id="2225069">exp</span><span class="op" id="2225072">,</span>&nbsp;<span class="ident" id="2225074">flt</span><span class="op" id="2225077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2225085">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225134">switch</span>&nbsp;<span class="ident" id="2225141">fmt</span>&nbsp;<span class="op" id="2225145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225149">case</span>&nbsp;<span class="string" id="2225154">&#39;e&#39;</span><span class="op" id="2225157">,</span>&nbsp;<span class="string" id="2225159">&#39;E&#39;</span><span class="op" id="2225162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225167">prec</span>&nbsp;<span class="op" id="2225172">=</span>&nbsp;<span class="ident" id="2225174">digs</span><span class="op" id="2225178">.</span><span class="ident" id="2225179">nd</span>&nbsp;<span class="op" id="2225182">-</span>&nbsp;<span class="num" id="2225184">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225188">case</span>&nbsp;<span class="string" id="2225193">&#39;f&#39;</span><span class="op" id="2225196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225201">prec</span>&nbsp;<span class="op" id="2225206">=</span>&nbsp;<span class="ident" id="2225208">max</span><span class="op" id="2225211">(</span><span class="ident" id="2225212">digs</span><span class="op" id="2225216">.</span><span class="ident" id="2225217">nd</span><span class="op" id="2225219">-</span><span class="ident" id="2225220">digs</span><span class="op" id="2225224">.</span><span class="ident" id="2225225">dp</span><span class="op" id="2225227">,</span>&nbsp;<span class="num" id="2225229">0</span><span class="op" id="2225230">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225234">case</span>&nbsp;<span class="string" id="2225239">&#39;g&#39;</span><span class="op" id="2225242">,</span>&nbsp;<span class="string" id="2225244">&#39;G&#39;</span><span class="op" id="2225247">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225252">prec</span>&nbsp;<span class="op" id="2225257">=</span>&nbsp;<span class="ident" id="2225259">digs</span><span class="op" id="2225263">.</span><span class="ident" id="2225264">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225272">}</span>&nbsp;<span class="keyword" id="2225274">else</span>&nbsp;<span class="keyword" id="2225279">if</span>&nbsp;<span class="ident" id="2225282">fmt</span>&nbsp;<span class="op" id="2225286">!=</span>&nbsp;<span class="string" id="2225289">&#39;f&#39;</span>&nbsp;<span class="op" id="2225293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2225297">//&nbsp;Fixed&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225326">digits</span>&nbsp;<span class="op" id="2225333">:=</span>&nbsp;<span class="ident" id="2225336">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225343">switch</span>&nbsp;<span class="ident" id="2225350">fmt</span>&nbsp;<span class="op" id="2225354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225358">case</span>&nbsp;<span class="string" id="2225363">&#39;e&#39;</span><span class="op" id="2225366">,</span>&nbsp;<span class="string" id="2225368">&#39;E&#39;</span><span class="op" id="2225371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225376">digits</span><span class="op" id="2225382">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225387">case</span>&nbsp;<span class="string" id="2225392">&#39;g&#39;</span><span class="op" id="2225395">,</span>&nbsp;<span class="string" id="2225397">&#39;G&#39;</span><span class="op" id="2225400">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225405">if</span>&nbsp;<span class="ident" id="2225408">prec</span>&nbsp;<span class="op" id="2225413">==</span>&nbsp;<span class="num" id="2225416">0</span>&nbsp;<span class="op" id="2225418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225424">prec</span>&nbsp;<span class="op" id="2225429">=</span>&nbsp;<span class="num" id="2225431">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225441">digits</span>&nbsp;<span class="op" id="2225448">=</span>&nbsp;<span class="ident" id="2225450">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225457">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225461">if</span>&nbsp;<span class="ident" id="2225464">digits</span>&nbsp;<span class="op" id="2225471">&lt;=</span>&nbsp;<span class="num" id="2225474">15</span>&nbsp;<span class="op" id="2225477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2225482">//&nbsp;try&nbsp;fast&nbsp;algorithm&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;is&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225548">var</span>&nbsp;<span class="ident" id="2225552">buf</span>&nbsp;<span class="op" id="2225556">[</span><span class="num" id="2225557">24</span><span class="op" id="2225559">]</span><span class="builtintype" id="2225560">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225568">digs</span><span class="op" id="2225572">.</span><span class="ident" id="2225573">d</span>&nbsp;<span class="op" id="2225575">=</span>&nbsp;<span class="ident" id="2225577">buf</span><span class="op" id="2225580">[</span><span class="op" id="2225581">:</span><span class="op" id="2225582">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225587">f</span>&nbsp;<span class="op" id="2225589">:=</span>&nbsp;<span class="ident" id="2225592">extFloat</span><span class="op" id="2225600">{</span><span class="ident" id="2225601">mant</span><span class="op" id="2225605">,</span>&nbsp;<span class="ident" id="2225607">exp</span>&nbsp;<span class="op" id="2225611">-</span>&nbsp;<span class="builtintype" id="2225613">int</span><span class="op" id="2225616">(</span><span class="ident" id="2225617">flt</span><span class="op" id="2225620">.</span><span class="ident" id="2225621">mantbits</span><span class="op" id="2225629">)</span><span class="op" id="2225630">,</span>&nbsp;<span class="ident" id="2225632">neg</span><span class="op" id="2225635">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225640">ok</span>&nbsp;<span class="op" id="2225643">=</span>&nbsp;<span class="ident" id="2225645">f</span><span class="op" id="2225646">.</span><span class="ident" id="2225647">FixedDecimal</span><span class="op" id="2225659">(</span><span class="op" id="2225660">&amp;</span><span class="ident" id="2225661">digs</span><span class="op" id="2225665">,</span>&nbsp;<span class="ident" id="2225667">digits</span><span class="op" id="2225673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225683">if</span>&nbsp;<span class="op" id="2225686">!</span><span class="ident" id="2225687">ok</span>&nbsp;<span class="op" id="2225690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225694">return</span>&nbsp;<span class="ident" id="2225701">bigFtoa</span><span class="op" id="2225708">(</span><span class="ident" id="2225709">dst</span><span class="op" id="2225712">,</span>&nbsp;<span class="ident" id="2225714">prec</span><span class="op" id="2225718">,</span>&nbsp;<span class="ident" id="2225720">fmt</span><span class="op" id="2225723">,</span>&nbsp;<span class="ident" id="2225725">neg</span><span class="op" id="2225728">,</span>&nbsp;<span class="ident" id="2225730">mant</span><span class="op" id="2225734">,</span>&nbsp;<span class="ident" id="2225736">exp</span><span class="op" id="2225739">,</span>&nbsp;<span class="ident" id="2225741">flt</span><span class="op" id="2225744">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225750">return</span>&nbsp;<span class="ident" id="2225757">formatDigits</span><span class="op" id="2225769">(</span><span class="ident" id="2225770">dst</span><span class="op" id="2225773">,</span>&nbsp;<span class="ident" id="2225775">shortest</span><span class="op" id="2225783">,</span>&nbsp;<span class="ident" id="2225785">neg</span><span class="op" id="2225788">,</span>&nbsp;<span class="ident" id="2225790">digs</span><span class="op" id="2225794">,</span>&nbsp;<span class="ident" id="2225796">prec</span><span class="op" id="2225800">,</span>&nbsp;<span class="ident" id="2225802">fmt</span><span class="op" id="2225805">)</span><br>
<span class="lineno"></span><span class="op" id="2225807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2225810">//&nbsp;bigFtoa&nbsp;uses&nbsp;multiprecision&nbsp;computations&nbsp;to&nbsp;format&nbsp;a&nbsp;float.</span><br>
<span class="lineno">155</span><span class="keyword" id="2225873">func</span>&nbsp;<span class="ident" id="2225878">bigFtoa</span><span class="op" id="2225885">(</span><span class="ident" id="2225886">dst</span>&nbsp;<span class="op" id="2225890">[</span><span class="op" id="2225891">]</span><span class="builtintype" id="2225892">byte</span><span class="op" id="2225896">,</span>&nbsp;<span class="ident" id="2225898">prec</span>&nbsp;<span class="builtintype" id="2225903">int</span><span class="op" id="2225906">,</span>&nbsp;<span class="ident" id="2225908">fmt</span>&nbsp;<span class="builtintype" id="2225912">byte</span><span class="op" id="2225916">,</span>&nbsp;<span class="ident" id="2225918">neg</span>&nbsp;<span class="builtintype" id="2225922">bool</span><span class="op" id="2225926">,</span>&nbsp;<span class="ident" id="2225928">mant</span>&nbsp;<span class="ident" id="2225933">uint64</span><span class="op" id="2225939">,</span>&nbsp;<span class="ident" id="2225941">exp</span>&nbsp;<span class="builtintype" id="2225945">int</span><span class="op" id="2225948">,</span>&nbsp;<span class="ident" id="2225950">flt</span>&nbsp;<span class="op" id="2225954">*</span><span class="ident" id="2225955">floatInfo</span><span class="op" id="2225964">)</span>&nbsp;<span class="op" id="2225966">[</span><span class="op" id="2225967">]</span><span class="builtintype" id="2225968">byte</span>&nbsp;<span class="op" id="2225973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225976">d</span>&nbsp;<span class="op" id="2225978">:=</span>&nbsp;<span class="builtinfunc" id="2225981">new</span><span class="op" id="2225984">(</span><span class="ident" id="2225985">decimal</span><span class="op" id="2225992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225995">d</span><span class="op" id="2225996">.</span><span class="ident" id="2225997">Assign</span><span class="op" id="2226003">(</span><span class="ident" id="2226004">mant</span><span class="op" id="2226008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226011">d</span><span class="op" id="2226012">.</span><span class="ident" id="2226013">Shift</span><span class="op" id="2226018">(</span><span class="ident" id="2226019">exp</span>&nbsp;<span class="op" id="2226023">-</span>&nbsp;<span class="builtintype" id="2226025">int</span><span class="op" id="2226028">(</span><span class="ident" id="2226029">flt</span><span class="op" id="2226032">.</span><span class="ident" id="2226033">mantbits</span><span class="op" id="2226041">)</span><span class="op" id="2226042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226045">var</span>&nbsp;<span class="ident" id="2226049">digs</span>&nbsp;<span class="ident" id="2226054">decimalSlice</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226068">shortest</span>&nbsp;<span class="op" id="2226077">:=</span>&nbsp;<span class="ident" id="2226080">prec</span>&nbsp;<span class="op" id="2226085">&lt;</span>&nbsp;<span class="num" id="2226087">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226090">if</span>&nbsp;<span class="ident" id="2226093">shortest</span>&nbsp;<span class="op" id="2226102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226106">roundShortest</span><span class="op" id="2226119">(</span><span class="ident" id="2226120">d</span><span class="op" id="2226121">,</span>&nbsp;<span class="ident" id="2226123">mant</span><span class="op" id="2226127">,</span>&nbsp;<span class="ident" id="2226129">exp</span><span class="op" id="2226132">,</span>&nbsp;<span class="ident" id="2226134">flt</span><span class="op" id="2226137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226141">digs</span>&nbsp;<span class="op" id="2226146">=</span>&nbsp;<span class="ident" id="2226148">decimalSlice</span><span class="op" id="2226160">{</span><span class="ident" id="2226161">d</span><span class="op" id="2226162">:</span>&nbsp;<span class="ident" id="2226164">d</span><span class="op" id="2226165">.</span><span class="ident" id="2226166">d</span><span class="op" id="2226167">[</span><span class="op" id="2226168">:</span><span class="op" id="2226169">]</span><span class="op" id="2226170">,</span>&nbsp;<span class="ident" id="2226172">nd</span><span class="op" id="2226174">:</span>&nbsp;<span class="ident" id="2226176">d</span><span class="op" id="2226177">.</span><span class="ident" id="2226178">nd</span><span class="op" id="2226180">,</span>&nbsp;<span class="ident" id="2226182">dp</span><span class="op" id="2226184">:</span>&nbsp;<span class="ident" id="2226186">d</span><span class="op" id="2226187">.</span><span class="ident" id="2226188">dp</span><span class="op" id="2226190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2226194">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226243">switch</span>&nbsp;<span class="ident" id="2226250">fmt</span>&nbsp;<span class="op" id="2226254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226258">case</span>&nbsp;<span class="string" id="2226263">&#39;e&#39;</span><span class="op" id="2226266">,</span>&nbsp;<span class="string" id="2226268">&#39;E&#39;</span><span class="op" id="2226271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226276">prec</span>&nbsp;<span class="op" id="2226281">=</span>&nbsp;<span class="ident" id="2226283">digs</span><span class="op" id="2226287">.</span><span class="ident" id="2226288">nd</span>&nbsp;<span class="op" id="2226291">-</span>&nbsp;<span class="num" id="2226293">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226297">case</span>&nbsp;<span class="string" id="2226302">&#39;f&#39;</span><span class="op" id="2226305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226310">prec</span>&nbsp;<span class="op" id="2226315">=</span>&nbsp;<span class="ident" id="2226317">max</span><span class="op" id="2226320">(</span><span class="ident" id="2226321">digs</span><span class="op" id="2226325">.</span><span class="ident" id="2226326">nd</span><span class="op" id="2226328">-</span><span class="ident" id="2226329">digs</span><span class="op" id="2226333">.</span><span class="ident" id="2226334">dp</span><span class="op" id="2226336">,</span>&nbsp;<span class="num" id="2226338">0</span><span class="op" id="2226339">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226343">case</span>&nbsp;<span class="string" id="2226348">&#39;g&#39;</span><span class="op" id="2226351">,</span>&nbsp;<span class="string" id="2226353">&#39;G&#39;</span><span class="op" id="2226356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226361">prec</span>&nbsp;<span class="op" id="2226366">=</span>&nbsp;<span class="ident" id="2226368">digs</span><span class="op" id="2226372">.</span><span class="ident" id="2226373">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226381">}</span>&nbsp;<span class="keyword" id="2226383">else</span>&nbsp;<span class="op" id="2226388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2226392">//&nbsp;Round&nbsp;appropriately.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226418">switch</span>&nbsp;<span class="ident" id="2226425">fmt</span>&nbsp;<span class="op" id="2226429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226433">case</span>&nbsp;<span class="string" id="2226438">&#39;e&#39;</span><span class="op" id="2226441">,</span>&nbsp;<span class="string" id="2226443">&#39;E&#39;</span><span class="op" id="2226446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226451">d</span><span class="op" id="2226452">.</span><span class="ident" id="2226453">Round</span><span class="op" id="2226458">(</span><span class="ident" id="2226459">prec</span>&nbsp;<span class="op" id="2226464">+</span>&nbsp;<span class="num" id="2226466">1</span><span class="op" id="2226467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226471">case</span>&nbsp;<span class="string" id="2226476">&#39;f&#39;</span><span class="op" id="2226479">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226484">d</span><span class="op" id="2226485">.</span><span class="ident" id="2226486">Round</span><span class="op" id="2226491">(</span><span class="ident" id="2226492">d</span><span class="op" id="2226493">.</span><span class="ident" id="2226494">dp</span>&nbsp;<span class="op" id="2226497">+</span>&nbsp;<span class="ident" id="2226499">prec</span><span class="op" id="2226503">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226507">case</span>&nbsp;<span class="string" id="2226512">&#39;g&#39;</span><span class="op" id="2226515">,</span>&nbsp;<span class="string" id="2226517">&#39;G&#39;</span><span class="op" id="2226520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226525">if</span>&nbsp;<span class="ident" id="2226528">prec</span>&nbsp;<span class="op" id="2226533">==</span>&nbsp;<span class="num" id="2226536">0</span>&nbsp;<span class="op" id="2226538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226544">prec</span>&nbsp;<span class="op" id="2226549">=</span>&nbsp;<span class="num" id="2226551">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226561">d</span><span class="op" id="2226562">.</span><span class="ident" id="2226563">Round</span><span class="op" id="2226568">(</span><span class="ident" id="2226569">prec</span><span class="op" id="2226573">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226581">digs</span>&nbsp;<span class="op" id="2226586">=</span>&nbsp;<span class="ident" id="2226588">decimalSlice</span><span class="op" id="2226600">{</span><span class="ident" id="2226601">d</span><span class="op" id="2226602">:</span>&nbsp;<span class="ident" id="2226604">d</span><span class="op" id="2226605">.</span><span class="ident" id="2226606">d</span><span class="op" id="2226607">[</span><span class="op" id="2226608">:</span><span class="op" id="2226609">]</span><span class="op" id="2226610">,</span>&nbsp;<span class="ident" id="2226612">nd</span><span class="op" id="2226614">:</span>&nbsp;<span class="ident" id="2226616">d</span><span class="op" id="2226617">.</span><span class="ident" id="2226618">nd</span><span class="op" id="2226620">,</span>&nbsp;<span class="ident" id="2226622">dp</span><span class="op" id="2226624">:</span>&nbsp;<span class="ident" id="2226626">d</span><span class="op" id="2226627">.</span><span class="ident" id="2226628">dp</span><span class="op" id="2226630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226636">return</span>&nbsp;<span class="ident" id="2226643">formatDigits</span><span class="op" id="2226655">(</span><span class="ident" id="2226656">dst</span><span class="op" id="2226659">,</span>&nbsp;<span class="ident" id="2226661">shortest</span><span class="op" id="2226669">,</span>&nbsp;<span class="ident" id="2226671">neg</span><span class="op" id="2226674">,</span>&nbsp;<span class="ident" id="2226676">digs</span><span class="op" id="2226680">,</span>&nbsp;<span class="ident" id="2226682">prec</span><span class="op" id="2226686">,</span>&nbsp;<span class="ident" id="2226688">fmt</span><span class="op" id="2226691">)</span><br>
<span class="lineno"></span><span class="op" id="2226693">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="2226696">func</span>&nbsp;<span class="ident" id="2226701">formatDigits</span><span class="op" id="2226713">(</span><span class="ident" id="2226714">dst</span>&nbsp;<span class="op" id="2226718">[</span><span class="op" id="2226719">]</span><span class="builtintype" id="2226720">byte</span><span class="op" id="2226724">,</span>&nbsp;<span class="ident" id="2226726">shortest</span>&nbsp;<span class="builtintype" id="2226735">bool</span><span class="op" id="2226739">,</span>&nbsp;<span class="ident" id="2226741">neg</span>&nbsp;<span class="builtintype" id="2226745">bool</span><span class="op" id="2226749">,</span>&nbsp;<span class="ident" id="2226751">digs</span>&nbsp;<span class="ident" id="2226756">decimalSlice</span><span class="op" id="2226768">,</span>&nbsp;<span class="ident" id="2226770">prec</span>&nbsp;<span class="builtintype" id="2226775">int</span><span class="op" id="2226778">,</span>&nbsp;<span class="ident" id="2226780">fmt</span>&nbsp;<span class="builtintype" id="2226784">byte</span><span class="op" id="2226788">)</span>&nbsp;<span class="op" id="2226790">[</span><span class="op" id="2226791">]</span><span class="builtintype" id="2226792">byte</span>&nbsp;<span class="op" id="2226797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226800">switch</span>&nbsp;<span class="ident" id="2226807">fmt</span>&nbsp;<span class="op" id="2226811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226814">case</span>&nbsp;<span class="string" id="2226819">&#39;e&#39;</span><span class="op" id="2226822">,</span>&nbsp;<span class="string" id="2226824">&#39;E&#39;</span><span class="op" id="2226827">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226831">return</span>&nbsp;<span class="ident" id="2226838">fmtE</span><span class="op" id="2226842">(</span><span class="ident" id="2226843">dst</span><span class="op" id="2226846">,</span>&nbsp;<span class="ident" id="2226848">neg</span><span class="op" id="2226851">,</span>&nbsp;<span class="ident" id="2226853">digs</span><span class="op" id="2226857">,</span>&nbsp;<span class="ident" id="2226859">prec</span><span class="op" id="2226863">,</span>&nbsp;<span class="ident" id="2226865">fmt</span><span class="op" id="2226868">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226871">case</span>&nbsp;<span class="string" id="2226876">&#39;f&#39;</span><span class="op" id="2226879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226883">return</span>&nbsp;<span class="ident" id="2226890">fmtF</span><span class="op" id="2226894">(</span><span class="ident" id="2226895">dst</span><span class="op" id="2226898">,</span>&nbsp;<span class="ident" id="2226900">neg</span><span class="op" id="2226903">,</span>&nbsp;<span class="ident" id="2226905">digs</span><span class="op" id="2226909">,</span>&nbsp;<span class="ident" id="2226911">prec</span><span class="op" id="2226915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226918">case</span>&nbsp;<span class="string" id="2226923">&#39;g&#39;</span><span class="op" id="2226926">,</span>&nbsp;<span class="string" id="2226928">&#39;G&#39;</span><span class="op" id="2226931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2226935">//&nbsp;trailing&nbsp;fractional&nbsp;zeros&nbsp;in&nbsp;&#39;e&#39;&nbsp;form&nbsp;will&nbsp;be&nbsp;trimmed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226995">eprec</span>&nbsp;<span class="op" id="2227001">:=</span>&nbsp;<span class="ident" id="2227004">prec</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227011">if</span>&nbsp;<span class="ident" id="2227014">eprec</span>&nbsp;<span class="op" id="2227020">&gt;</span>&nbsp;<span class="ident" id="2227022">digs</span><span class="op" id="2227026">.</span><span class="ident" id="2227027">nd</span>&nbsp;<span class="op" id="2227030">&amp;&amp;</span>&nbsp;<span class="ident" id="2227033">digs</span><span class="op" id="2227037">.</span><span class="ident" id="2227038">nd</span>&nbsp;<span class="op" id="2227041">&gt;=</span>&nbsp;<span class="ident" id="2227044">digs</span><span class="op" id="2227048">.</span><span class="ident" id="2227049">dp</span>&nbsp;<span class="op" id="2227052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227057">eprec</span>&nbsp;<span class="op" id="2227063">=</span>&nbsp;<span class="ident" id="2227065">digs</span><span class="op" id="2227069">.</span><span class="ident" id="2227070">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2227079">//&nbsp;%e&nbsp;is&nbsp;used&nbsp;if&nbsp;the&nbsp;exponent&nbsp;from&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2227131">//&nbsp;is&nbsp;less&nbsp;than&nbsp;-4&nbsp;or&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;precision.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2227195">//&nbsp;if&nbsp;precision&nbsp;was&nbsp;the&nbsp;shortest&nbsp;possible,&nbsp;use&nbsp;precision&nbsp;6&nbsp;for&nbsp;this&nbsp;decision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227275">if</span>&nbsp;<span class="ident" id="2227278">shortest</span>&nbsp;<span class="op" id="2227287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227292">eprec</span>&nbsp;<span class="op" id="2227298">=</span>&nbsp;<span class="num" id="2227300">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227308">exp</span>&nbsp;<span class="op" id="2227312">:=</span>&nbsp;<span class="ident" id="2227315">digs</span><span class="op" id="2227319">.</span><span class="ident" id="2227320">dp</span>&nbsp;<span class="op" id="2227323">-</span>&nbsp;<span class="num" id="2227325">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227329">if</span>&nbsp;<span class="ident" id="2227332">exp</span>&nbsp;<span class="op" id="2227336">&lt;</span>&nbsp;<span class="op" id="2227338">-</span><span class="num" id="2227339">4</span>&nbsp;<span class="op" id="2227341">||</span>&nbsp;<span class="ident" id="2227344">exp</span>&nbsp;<span class="op" id="2227348">&gt;=</span>&nbsp;<span class="ident" id="2227351">eprec</span>&nbsp;<span class="op" id="2227357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227362">if</span>&nbsp;<span class="ident" id="2227365">prec</span>&nbsp;<span class="op" id="2227370">&gt;</span>&nbsp;<span class="ident" id="2227372">digs</span><span class="op" id="2227376">.</span><span class="ident" id="2227377">nd</span>&nbsp;<span class="op" id="2227380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227386">prec</span>&nbsp;<span class="op" id="2227391">=</span>&nbsp;<span class="ident" id="2227393">digs</span><span class="op" id="2227397">.</span><span class="ident" id="2227398">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227409">return</span>&nbsp;<span class="ident" id="2227416">fmtE</span><span class="op" id="2227420">(</span><span class="ident" id="2227421">dst</span><span class="op" id="2227424">,</span>&nbsp;<span class="ident" id="2227426">neg</span><span class="op" id="2227429">,</span>&nbsp;<span class="ident" id="2227431">digs</span><span class="op" id="2227435">,</span>&nbsp;<span class="ident" id="2227437">prec</span><span class="op" id="2227441">-</span><span class="num" id="2227442">1</span><span class="op" id="2227443">,</span>&nbsp;<span class="ident" id="2227445">fmt</span><span class="op" id="2227448">+</span><span class="string" id="2227449">&#39;e&#39;</span><span class="op" id="2227452">-</span><span class="string" id="2227453">&#39;g&#39;</span><span class="op" id="2227456">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227464">if</span>&nbsp;<span class="ident" id="2227467">prec</span>&nbsp;<span class="op" id="2227472">&gt;</span>&nbsp;<span class="ident" id="2227474">digs</span><span class="op" id="2227478">.</span><span class="ident" id="2227479">dp</span>&nbsp;<span class="op" id="2227482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227487">prec</span>&nbsp;<span class="op" id="2227492">=</span>&nbsp;<span class="ident" id="2227494">digs</span><span class="op" id="2227498">.</span><span class="ident" id="2227499">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227508">return</span>&nbsp;<span class="ident" id="2227515">fmtF</span><span class="op" id="2227519">(</span><span class="ident" id="2227520">dst</span><span class="op" id="2227523">,</span>&nbsp;<span class="ident" id="2227525">neg</span><span class="op" id="2227528">,</span>&nbsp;<span class="ident" id="2227530">digs</span><span class="op" id="2227534">,</span>&nbsp;<span class="ident" id="2227536">max</span><span class="op" id="2227539">(</span><span class="ident" id="2227540">prec</span><span class="op" id="2227544">-</span><span class="ident" id="2227545">digs</span><span class="op" id="2227549">.</span><span class="ident" id="2227550">dp</span><span class="op" id="2227552">,</span>&nbsp;<span class="num" id="2227554">0</span><span class="op" id="2227555">)</span><span class="op" id="2227556">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2227563">//&nbsp;unknown&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227582">return</span>&nbsp;<span class="builtinfunc" id="2227589">append</span><span class="op" id="2227595">(</span><span class="ident" id="2227596">dst</span><span class="op" id="2227599">,</span>&nbsp;<span class="string" id="2227601">&#39;%&#39;</span><span class="op" id="2227604">,</span>&nbsp;<span class="ident" id="2227606">fmt</span><span class="op" id="2227609">)</span><br>
<span class="lineno"></span><span class="op" id="2227611">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2227614">//&nbsp;Round&nbsp;d&nbsp;(=&nbsp;mant&nbsp;*&nbsp;2^exp)&nbsp;to&nbsp;the&nbsp;shortest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2227675">//&nbsp;that&nbsp;will&nbsp;let&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;value&nbsp;be&nbsp;precisely</span><br>
<span class="lineno"></span><span class="comment" id="2227739">//&nbsp;reconstructed.&nbsp;&nbsp;Size&nbsp;is&nbsp;original&nbsp;floating&nbsp;point&nbsp;size&nbsp;(64&nbsp;or&nbsp;32).</span><br>
<span class="lineno"></span><span class="keyword" id="2227807">func</span>&nbsp;<span class="ident" id="2227812">roundShortest</span><span class="op" id="2227825">(</span><span class="ident" id="2227826">d</span>&nbsp;<span class="op" id="2227828">*</span><span class="ident" id="2227829">decimal</span><span class="op" id="2227836">,</span>&nbsp;<span class="ident" id="2227838">mant</span>&nbsp;<span class="ident" id="2227843">uint64</span><span class="op" id="2227849">,</span>&nbsp;<span class="ident" id="2227851">exp</span>&nbsp;<span class="builtintype" id="2227855">int</span><span class="op" id="2227858">,</span>&nbsp;<span class="ident" id="2227860">flt</span>&nbsp;<span class="op" id="2227864">*</span><span class="ident" id="2227865">floatInfo</span><span class="op" id="2227874">)</span>&nbsp;<span class="op" id="2227876">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2227879">//&nbsp;If&nbsp;mantissa&nbsp;is&nbsp;zero,&nbsp;the&nbsp;number&nbsp;is&nbsp;zero;&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227934">if</span>&nbsp;<span class="ident" id="2227937">mant</span>&nbsp;<span class="op" id="2227942">==</span>&nbsp;<span class="num" id="2227945">0</span>&nbsp;<span class="op" id="2227947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227951">d</span><span class="op" id="2227952">.</span><span class="ident" id="2227953">nd</span>&nbsp;<span class="op" id="2227956">=</span>&nbsp;<span class="num" id="2227958">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227962">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227970">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2227974">//&nbsp;Compute&nbsp;upper&nbsp;and&nbsp;lower&nbsp;such&nbsp;that&nbsp;any&nbsp;decimal&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228031">//&nbsp;between&nbsp;upper&nbsp;and&nbsp;lower&nbsp;(possibly&nbsp;inclusive)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228080">//&nbsp;will&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228135">//&nbsp;We&nbsp;may&nbsp;see&nbsp;at&nbsp;once&nbsp;that&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228195">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228199">//&nbsp;Suppose&nbsp;d&nbsp;is&nbsp;not&nbsp;denormal,&nbsp;so&nbsp;that&nbsp;2^exp&nbsp;&lt;=&nbsp;d&nbsp;&lt;&nbsp;10^dp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228258">//&nbsp;The&nbsp;closest&nbsp;shorter&nbsp;number&nbsp;is&nbsp;at&nbsp;least&nbsp;10^(dp-nd)&nbsp;away.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228318">//&nbsp;The&nbsp;lower/upper&nbsp;bounds&nbsp;computed&nbsp;below&nbsp;are&nbsp;at&nbsp;distance</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228376">//&nbsp;at&nbsp;most&nbsp;2^(exp-mantbits).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228406">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228410">//&nbsp;So&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest&nbsp;if&nbsp;10^(dp-nd)&nbsp;&gt;&nbsp;2^(exp-mantbits),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228482">//&nbsp;or&nbsp;equivalently&nbsp;log2(10)*(dp-nd)&nbsp;&gt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228535">//&nbsp;It&nbsp;is&nbsp;true&nbsp;if&nbsp;332/100*(dp-nd)&nbsp;&gt;=&nbsp;exp-mantbits&nbsp;(log2(10)&nbsp;&gt;&nbsp;3.32).</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228604">minexp</span>&nbsp;<span class="op" id="2228611">:=</span>&nbsp;<span class="ident" id="2228614">flt</span><span class="op" id="2228617">.</span><span class="ident" id="2228618">bias</span>&nbsp;<span class="op" id="2228623">+</span>&nbsp;<span class="num" id="2228625">1</span>&nbsp;<span class="comment" id="2228627">//&nbsp;minimum&nbsp;possible&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228657">if</span>&nbsp;<span class="ident" id="2228660">exp</span>&nbsp;<span class="op" id="2228664">&gt;</span>&nbsp;<span class="ident" id="2228666">minexp</span>&nbsp;<span class="op" id="2228673">&amp;&amp;</span>&nbsp;<span class="num" id="2228676">332</span><span class="op" id="2228679">*</span><span class="op" id="2228680">(</span><span class="ident" id="2228681">d</span><span class="op" id="2228682">.</span><span class="ident" id="2228683">dp</span><span class="op" id="2228685">-</span><span class="ident" id="2228686">d</span><span class="op" id="2228687">.</span><span class="ident" id="2228688">nd</span><span class="op" id="2228690">)</span>&nbsp;<span class="op" id="2228692">&gt;=</span>&nbsp;<span class="num" id="2228695">100</span><span class="op" id="2228698">*</span><span class="op" id="2228699">(</span><span class="ident" id="2228700">exp</span><span class="op" id="2228703">-</span><span class="builtintype" id="2228704">int</span><span class="op" id="2228707">(</span><span class="ident" id="2228708">flt</span><span class="op" id="2228711">.</span><span class="ident" id="2228712">mantbits</span><span class="op" id="2228720">)</span><span class="op" id="2228721">)</span>&nbsp;<span class="op" id="2228723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228727">//&nbsp;The&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228764">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2228772">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228776">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228809">//&nbsp;Next&nbsp;highest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant+1&nbsp;&lt;&lt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228875">//&nbsp;Our&nbsp;upper&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mant*2+1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228943">upper</span>&nbsp;<span class="op" id="2228949">:=</span>&nbsp;<span class="builtinfunc" id="2228952">new</span><span class="op" id="2228955">(</span><span class="ident" id="2228956">decimal</span><span class="op" id="2228963">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228966">upper</span><span class="op" id="2228971">.</span><span class="ident" id="2228972">Assign</span><span class="op" id="2228978">(</span><span class="ident" id="2228979">mant</span><span class="op" id="2228983">*</span><span class="num" id="2228984">2</span>&nbsp;<span class="op" id="2228986">+</span>&nbsp;<span class="num" id="2228988">1</span><span class="op" id="2228989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228992">upper</span><span class="op" id="2228997">.</span><span class="ident" id="2228998">Shift</span><span class="op" id="2229003">(</span><span class="ident" id="2229004">exp</span>&nbsp;<span class="op" id="2229008">-</span>&nbsp;<span class="builtintype" id="2229010">int</span><span class="op" id="2229013">(</span><span class="ident" id="2229014">flt</span><span class="op" id="2229017">.</span><span class="ident" id="2229018">mantbits</span><span class="op" id="2229026">)</span>&nbsp;<span class="op" id="2229028">-</span>&nbsp;<span class="num" id="2229030">1</span><span class="op" id="2229031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229035">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229068">//&nbsp;Next&nbsp;lowest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant-1&nbsp;&lt;&lt;&nbsp;exp-mantbits,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229133">//&nbsp;unless&nbsp;mant-1&nbsp;drops&nbsp;the&nbsp;significant&nbsp;bit&nbsp;and&nbsp;exp&nbsp;is&nbsp;not&nbsp;the&nbsp;minimum&nbsp;exp,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229209">//&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;next&nbsp;lowest&nbsp;is&nbsp;mant*2-1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229274">//&nbsp;Either&nbsp;way,&nbsp;call&nbsp;it&nbsp;mantlo&nbsp;&lt;&lt;&nbsp;explo-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229324">//&nbsp;Our&nbsp;lower&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mantlo*2+1&nbsp;&lt;&lt;&nbsp;explo-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229396">var</span>&nbsp;<span class="ident" id="2229400">mantlo</span>&nbsp;<span class="ident" id="2229407">uint64</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229415">var</span>&nbsp;<span class="ident" id="2229419">explo</span>&nbsp;<span class="builtintype" id="2229425">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229430">if</span>&nbsp;<span class="ident" id="2229433">mant</span>&nbsp;<span class="op" id="2229438">&gt;</span>&nbsp;<span class="num" id="2229440">1</span><span class="op" id="2229441">&lt;&lt;</span><span class="ident" id="2229443">flt</span><span class="op" id="2229446">.</span><span class="ident" id="2229447">mantbits</span>&nbsp;<span class="op" id="2229456">||</span>&nbsp;<span class="ident" id="2229459">exp</span>&nbsp;<span class="op" id="2229463">==</span>&nbsp;<span class="ident" id="2229466">minexp</span>&nbsp;<span class="op" id="2229473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229477">mantlo</span>&nbsp;<span class="op" id="2229484">=</span>&nbsp;<span class="ident" id="2229486">mant</span>&nbsp;<span class="op" id="2229491">-</span>&nbsp;<span class="num" id="2229493">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229497">explo</span>&nbsp;<span class="op" id="2229503">=</span>&nbsp;<span class="ident" id="2229505">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2229510">}</span>&nbsp;<span class="keyword" id="2229512">else</span>&nbsp;<span class="op" id="2229517">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229521">mantlo</span>&nbsp;<span class="op" id="2229528">=</span>&nbsp;<span class="ident" id="2229530">mant</span><span class="op" id="2229534">*</span><span class="num" id="2229535">2</span>&nbsp;<span class="op" id="2229537">-</span>&nbsp;<span class="num" id="2229539">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229543">explo</span>&nbsp;<span class="op" id="2229549">=</span>&nbsp;<span class="ident" id="2229551">exp</span>&nbsp;<span class="op" id="2229555">-</span>&nbsp;<span class="num" id="2229557">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2229560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229563">lower</span>&nbsp;<span class="op" id="2229569">:=</span>&nbsp;<span class="builtinfunc" id="2229572">new</span><span class="op" id="2229575">(</span><span class="ident" id="2229576">decimal</span><span class="op" id="2229583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229586">lower</span><span class="op" id="2229591">.</span><span class="ident" id="2229592">Assign</span><span class="op" id="2229598">(</span><span class="ident" id="2229599">mantlo</span><span class="op" id="2229605">*</span><span class="num" id="2229606">2</span>&nbsp;<span class="op" id="2229608">+</span>&nbsp;<span class="num" id="2229610">1</span><span class="op" id="2229611">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229614">lower</span><span class="op" id="2229619">.</span><span class="ident" id="2229620">Shift</span><span class="op" id="2229625">(</span><span class="ident" id="2229626">explo</span>&nbsp;<span class="op" id="2229632">-</span>&nbsp;<span class="builtintype" id="2229634">int</span><span class="op" id="2229637">(</span><span class="ident" id="2229638">flt</span><span class="op" id="2229641">.</span><span class="ident" id="2229642">mantbits</span><span class="op" id="2229650">)</span>&nbsp;<span class="op" id="2229652">-</span>&nbsp;<span class="num" id="2229654">1</span><span class="op" id="2229655">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229659">//&nbsp;The&nbsp;upper&nbsp;and&nbsp;lower&nbsp;bounds&nbsp;are&nbsp;possible&nbsp;outputs&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229719">//&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;is&nbsp;even,&nbsp;so&nbsp;that&nbsp;IEEE&nbsp;round-to-even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229781">//&nbsp;would&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;and&nbsp;not&nbsp;the&nbsp;neighbors.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229845">inclusive</span>&nbsp;<span class="op" id="2229855">:=</span>&nbsp;<span class="ident" id="2229858">mant</span><span class="op" id="2229862">%</span><span class="num" id="2229863">2</span>&nbsp;<span class="op" id="2229865">==</span>&nbsp;<span class="num" id="2229868">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229872">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;digits&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2229937">//&nbsp;Walk&nbsp;along&nbsp;until&nbsp;d&nbsp;has&nbsp;distinguished&nbsp;itself&nbsp;from&nbsp;upper&nbsp;and&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230007">for</span>&nbsp;<span class="ident" id="2230011">i</span>&nbsp;<span class="op" id="2230013">:=</span>&nbsp;<span class="num" id="2230016">0</span><span class="op" id="2230017">;</span>&nbsp;<span class="ident" id="2230019">i</span>&nbsp;<span class="op" id="2230021">&lt;</span>&nbsp;<span class="ident" id="2230023">d</span><span class="op" id="2230024">.</span><span class="ident" id="2230025">nd</span><span class="op" id="2230027">;</span>&nbsp;<span class="ident" id="2230029">i</span><span class="op" id="2230030">++</span>&nbsp;<span class="op" id="2230033">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230037">var</span>&nbsp;<span class="ident" id="2230041">l</span><span class="op" id="2230042">,</span>&nbsp;<span class="ident" id="2230044">m</span><span class="op" id="2230045">,</span>&nbsp;<span class="ident" id="2230047">u</span>&nbsp;<span class="builtintype" id="2230049">byte</span>&nbsp;<span class="comment" id="2230054">//&nbsp;lower,&nbsp;middle,&nbsp;upper&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230087">if</span>&nbsp;<span class="ident" id="2230090">i</span>&nbsp;<span class="op" id="2230092">&lt;</span>&nbsp;<span class="ident" id="2230094">lower</span><span class="op" id="2230099">.</span><span class="ident" id="2230100">nd</span>&nbsp;<span class="op" id="2230103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230108">l</span>&nbsp;<span class="op" id="2230110">=</span>&nbsp;<span class="ident" id="2230112">lower</span><span class="op" id="2230117">.</span><span class="ident" id="2230118">d</span><span class="op" id="2230119">[</span><span class="ident" id="2230120">i</span><span class="op" id="2230121">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230125">}</span>&nbsp;<span class="keyword" id="2230127">else</span>&nbsp;<span class="op" id="2230132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230137">l</span>&nbsp;<span class="op" id="2230139">=</span>&nbsp;<span class="string" id="2230141">&#39;0&#39;</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230151">m</span>&nbsp;<span class="op" id="2230153">=</span>&nbsp;<span class="ident" id="2230155">d</span><span class="op" id="2230156">.</span><span class="ident" id="2230157">d</span><span class="op" id="2230158">[</span><span class="ident" id="2230159">i</span><span class="op" id="2230160">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230164">if</span>&nbsp;<span class="ident" id="2230167">i</span>&nbsp;<span class="op" id="2230169">&lt;</span>&nbsp;<span class="ident" id="2230171">upper</span><span class="op" id="2230176">.</span><span class="ident" id="2230177">nd</span>&nbsp;<span class="op" id="2230180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230185">u</span>&nbsp;<span class="op" id="2230187">=</span>&nbsp;<span class="ident" id="2230189">upper</span><span class="op" id="2230194">.</span><span class="ident" id="2230195">d</span><span class="op" id="2230196">[</span><span class="ident" id="2230197">i</span><span class="op" id="2230198">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230202">}</span>&nbsp;<span class="keyword" id="2230204">else</span>&nbsp;<span class="op" id="2230209">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230214">u</span>&nbsp;<span class="op" id="2230216">=</span>&nbsp;<span class="string" id="2230218">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2230229">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;down&nbsp;(truncate)&nbsp;if&nbsp;lower&nbsp;has&nbsp;a&nbsp;different&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2230295">//&nbsp;or&nbsp;if&nbsp;lower&nbsp;is&nbsp;inclusive&nbsp;and&nbsp;is&nbsp;exactly&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;down.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230369">okdown</span>&nbsp;<span class="op" id="2230376">:=</span>&nbsp;<span class="ident" id="2230379">l</span>&nbsp;<span class="op" id="2230381">!=</span>&nbsp;<span class="ident" id="2230384">m</span>&nbsp;<span class="op" id="2230386">||</span>&nbsp;<span class="op" id="2230389">(</span><span class="ident" id="2230390">inclusive</span>&nbsp;<span class="op" id="2230400">&amp;&amp;</span>&nbsp;<span class="ident" id="2230403">l</span>&nbsp;<span class="op" id="2230405">==</span>&nbsp;<span class="ident" id="2230408">m</span>&nbsp;<span class="op" id="2230410">&amp;&amp;</span>&nbsp;<span class="ident" id="2230413">i</span><span class="op" id="2230414">+</span><span class="num" id="2230415">1</span>&nbsp;<span class="op" id="2230417">==</span>&nbsp;<span class="ident" id="2230420">lower</span><span class="op" id="2230425">.</span><span class="ident" id="2230426">nd</span><span class="op" id="2230428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2230433">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;up&nbsp;if&nbsp;upper&nbsp;has&nbsp;a&nbsp;different&nbsp;digit&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2230490">//&nbsp;either&nbsp;upper&nbsp;is&nbsp;inclusive&nbsp;or&nbsp;upper&nbsp;is&nbsp;bigger&nbsp;than&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230572">okup</span>&nbsp;<span class="op" id="2230577">:=</span>&nbsp;<span class="ident" id="2230580">m</span>&nbsp;<span class="op" id="2230582">!=</span>&nbsp;<span class="ident" id="2230585">u</span>&nbsp;<span class="op" id="2230587">&amp;&amp;</span>&nbsp;<span class="op" id="2230590">(</span><span class="ident" id="2230591">inclusive</span>&nbsp;<span class="op" id="2230601">||</span>&nbsp;<span class="ident" id="2230604">m</span><span class="op" id="2230605">+</span><span class="num" id="2230606">1</span>&nbsp;<span class="op" id="2230608">&lt;</span>&nbsp;<span class="ident" id="2230610">u</span>&nbsp;<span class="op" id="2230612">||</span>&nbsp;<span class="ident" id="2230615">i</span><span class="op" id="2230616">+</span><span class="num" id="2230617">1</span>&nbsp;<span class="op" id="2230619">&lt;</span>&nbsp;<span class="ident" id="2230621">upper</span><span class="op" id="2230626">.</span><span class="ident" id="2230627">nd</span><span class="op" id="2230629">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2230634">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;either,&nbsp;then&nbsp;round&nbsp;to&nbsp;the&nbsp;nearest&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2230697">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;only&nbsp;one,&nbsp;do&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230738">switch</span>&nbsp;<span class="op" id="2230745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230749">case</span>&nbsp;<span class="ident" id="2230754">okdown</span>&nbsp;<span class="op" id="2230761">&amp;&amp;</span>&nbsp;<span class="ident" id="2230764">okup</span><span class="op" id="2230768">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230773">d</span><span class="op" id="2230774">.</span><span class="ident" id="2230775">Round</span><span class="op" id="2230780">(</span><span class="ident" id="2230781">i</span>&nbsp;<span class="op" id="2230783">+</span>&nbsp;<span class="num" id="2230785">1</span><span class="op" id="2230786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230791">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230800">case</span>&nbsp;<span class="ident" id="2230805">okdown</span><span class="op" id="2230811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230816">d</span><span class="op" id="2230817">.</span><span class="ident" id="2230818">RoundDown</span><span class="op" id="2230827">(</span><span class="ident" id="2230828">i</span>&nbsp;<span class="op" id="2230830">+</span>&nbsp;<span class="num" id="2230832">1</span><span class="op" id="2230833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230838">return</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230847">case</span>&nbsp;<span class="ident" id="2230852">okup</span><span class="op" id="2230856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230861">d</span><span class="op" id="2230862">.</span><span class="ident" id="2230863">RoundUp</span><span class="op" id="2230870">(</span><span class="ident" id="2230871">i</span>&nbsp;<span class="op" id="2230873">+</span>&nbsp;<span class="num" id="2230875">1</span><span class="op" id="2230876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230881">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230893">}</span><br>
<span class="lineno">325</span><span class="op" id="2230895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2230898">type</span>&nbsp;<span class="ident" id="2230903">decimalSlice</span>&nbsp;<span class="keyword" id="2230916">struct</span>&nbsp;<span class="op" id="2230923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230926">d</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2230933">[</span><span class="op" id="2230934">]</span><span class="builtintype" id="2230935">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230941">nd</span><span class="op" id="2230943">,</span>&nbsp;<span class="ident" id="2230945">dp</span>&nbsp;<span class="builtintype" id="2230948">int</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230953">neg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2230960">bool</span><br>
<span class="lineno"></span><span class="op" id="2230965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2230968">//&nbsp;%e:&nbsp;-d.ddddde±dd</span><br>
<span class="lineno"></span><span class="keyword" id="2230989">func</span>&nbsp;<span class="ident" id="2230994">fmtE</span><span class="op" id="2230998">(</span><span class="ident" id="2230999">dst</span>&nbsp;<span class="op" id="2231003">[</span><span class="op" id="2231004">]</span><span class="builtintype" id="2231005">byte</span><span class="op" id="2231009">,</span>&nbsp;<span class="ident" id="2231011">neg</span>&nbsp;<span class="builtintype" id="2231015">bool</span><span class="op" id="2231019">,</span>&nbsp;<span class="ident" id="2231021">d</span>&nbsp;<span class="ident" id="2231023">decimalSlice</span><span class="op" id="2231035">,</span>&nbsp;<span class="ident" id="2231037">prec</span>&nbsp;<span class="builtintype" id="2231042">int</span><span class="op" id="2231045">,</span>&nbsp;<span class="ident" id="2231047">fmt</span>&nbsp;<span class="builtintype" id="2231051">byte</span><span class="op" id="2231055">)</span>&nbsp;<span class="op" id="2231057">[</span><span class="op" id="2231058">]</span><span class="builtintype" id="2231059">byte</span>&nbsp;<span class="op" id="2231064">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231067">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231076">if</span>&nbsp;<span class="ident" id="2231079">neg</span>&nbsp;<span class="op" id="2231083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231087">dst</span>&nbsp;<span class="op" id="2231091">=</span>&nbsp;<span class="builtinfunc" id="2231093">append</span><span class="op" id="2231099">(</span><span class="ident" id="2231100">dst</span><span class="op" id="2231103">,</span>&nbsp;<span class="string" id="2231105">&#39;-&#39;</span><span class="op" id="2231108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231115">//&nbsp;first&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231131">ch</span>&nbsp;<span class="op" id="2231134">:=</span>&nbsp;<span class="builtintype" id="2231137">byte</span><span class="op" id="2231141">(</span><span class="string" id="2231142">&#39;0&#39;</span><span class="op" id="2231145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231148">if</span>&nbsp;<span class="ident" id="2231151">d</span><span class="op" id="2231152">.</span><span class="ident" id="2231153">nd</span>&nbsp;<span class="op" id="2231156">!=</span>&nbsp;<span class="num" id="2231159">0</span>&nbsp;<span class="op" id="2231161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231165">ch</span>&nbsp;<span class="op" id="2231168">=</span>&nbsp;<span class="ident" id="2231170">d</span><span class="op" id="2231171">.</span><span class="ident" id="2231172">d</span><span class="op" id="2231173">[</span><span class="num" id="2231174">0</span><span class="op" id="2231175">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231178">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231181">dst</span>&nbsp;<span class="op" id="2231185">=</span>&nbsp;<span class="builtinfunc" id="2231187">append</span><span class="op" id="2231193">(</span><span class="ident" id="2231194">dst</span><span class="op" id="2231197">,</span>&nbsp;<span class="ident" id="2231199">ch</span><span class="op" id="2231201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231205">//&nbsp;.moredigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231221">if</span>&nbsp;<span class="ident" id="2231224">prec</span>&nbsp;<span class="op" id="2231229">&gt;</span>&nbsp;<span class="num" id="2231231">0</span>&nbsp;<span class="op" id="2231233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231237">dst</span>&nbsp;<span class="op" id="2231241">=</span>&nbsp;<span class="builtinfunc" id="2231243">append</span><span class="op" id="2231249">(</span><span class="ident" id="2231250">dst</span><span class="op" id="2231253">,</span>&nbsp;<span class="string" id="2231255">&#39;.&#39;</span><span class="op" id="2231258">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231262">i</span>&nbsp;<span class="op" id="2231264">:=</span>&nbsp;<span class="num" id="2231267">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231271">m</span>&nbsp;<span class="op" id="2231273">:=</span>&nbsp;<span class="ident" id="2231276">d</span><span class="op" id="2231277">.</span><span class="ident" id="2231278">nd</span>&nbsp;<span class="op" id="2231281">+</span>&nbsp;<span class="ident" id="2231283">prec</span>&nbsp;<span class="op" id="2231288">+</span>&nbsp;<span class="num" id="2231290">1</span>&nbsp;<span class="op" id="2231292">-</span>&nbsp;<span class="ident" id="2231294">max</span><span class="op" id="2231297">(</span><span class="ident" id="2231298">d</span><span class="op" id="2231299">.</span><span class="ident" id="2231300">nd</span><span class="op" id="2231302">,</span>&nbsp;<span class="ident" id="2231304">prec</span><span class="op" id="2231308">+</span><span class="num" id="2231309">1</span><span class="op" id="2231310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231314">for</span>&nbsp;<span class="ident" id="2231318">i</span>&nbsp;<span class="op" id="2231320">&lt;</span>&nbsp;<span class="ident" id="2231322">m</span>&nbsp;<span class="op" id="2231324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231329">dst</span>&nbsp;<span class="op" id="2231333">=</span>&nbsp;<span class="builtinfunc" id="2231335">append</span><span class="op" id="2231341">(</span><span class="ident" id="2231342">dst</span><span class="op" id="2231345">,</span>&nbsp;<span class="ident" id="2231347">d</span><span class="op" id="2231348">.</span><span class="ident" id="2231349">d</span><span class="op" id="2231350">[</span><span class="ident" id="2231351">i</span><span class="op" id="2231352">]</span><span class="op" id="2231353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231358">i</span><span class="op" id="2231359">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231368">for</span>&nbsp;<span class="ident" id="2231372">i</span>&nbsp;<span class="op" id="2231374">&lt;=</span>&nbsp;<span class="ident" id="2231377">prec</span>&nbsp;<span class="op" id="2231382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231387">dst</span>&nbsp;<span class="op" id="2231391">=</span>&nbsp;<span class="builtinfunc" id="2231393">append</span><span class="op" id="2231399">(</span><span class="ident" id="2231400">dst</span><span class="op" id="2231403">,</span>&nbsp;<span class="string" id="2231405">&#39;0&#39;</span><span class="op" id="2231408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231413">i</span><span class="op" id="2231414">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231419">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231426">//&nbsp;e±</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231434">dst</span>&nbsp;<span class="op" id="2231438">=</span>&nbsp;<span class="builtinfunc" id="2231440">append</span><span class="op" id="2231446">(</span><span class="ident" id="2231447">dst</span><span class="op" id="2231450">,</span>&nbsp;<span class="ident" id="2231452">fmt</span><span class="op" id="2231455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231458">exp</span>&nbsp;<span class="op" id="2231462">:=</span>&nbsp;<span class="ident" id="2231465">d</span><span class="op" id="2231466">.</span><span class="ident" id="2231467">dp</span>&nbsp;<span class="op" id="2231470">-</span>&nbsp;<span class="num" id="2231472">1</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231475">if</span>&nbsp;<span class="ident" id="2231478">d</span><span class="op" id="2231479">.</span><span class="ident" id="2231480">nd</span>&nbsp;<span class="op" id="2231483">==</span>&nbsp;<span class="num" id="2231486">0</span>&nbsp;<span class="op" id="2231488">{</span>&nbsp;<span class="comment" id="2231490">//&nbsp;special&nbsp;case:&nbsp;0&nbsp;has&nbsp;exponent&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231526">exp</span>&nbsp;<span class="op" id="2231530">=</span>&nbsp;<span class="num" id="2231532">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231538">if</span>&nbsp;<span class="ident" id="2231541">exp</span>&nbsp;<span class="op" id="2231545">&lt;</span>&nbsp;<span class="num" id="2231547">0</span>&nbsp;<span class="op" id="2231549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231553">ch</span>&nbsp;<span class="op" id="2231556">=</span>&nbsp;<span class="string" id="2231558">&#39;-&#39;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231564">exp</span>&nbsp;<span class="op" id="2231568">=</span>&nbsp;<span class="op" id="2231570">-</span><span class="ident" id="2231571">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231576">}</span>&nbsp;<span class="keyword" id="2231578">else</span>&nbsp;<span class="op" id="2231583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231587">ch</span>&nbsp;<span class="op" id="2231590">=</span>&nbsp;<span class="string" id="2231592">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231600">dst</span>&nbsp;<span class="op" id="2231604">=</span>&nbsp;<span class="builtinfunc" id="2231606">append</span><span class="op" id="2231612">(</span><span class="ident" id="2231613">dst</span><span class="op" id="2231616">,</span>&nbsp;<span class="ident" id="2231618">ch</span><span class="op" id="2231620">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231624">//&nbsp;dddd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231633">var</span>&nbsp;<span class="ident" id="2231637">buf</span>&nbsp;<span class="op" id="2231641">[</span><span class="num" id="2231642">3</span><span class="op" id="2231643">]</span><span class="builtintype" id="2231644">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231650">i</span>&nbsp;<span class="op" id="2231652">:=</span>&nbsp;<span class="builtinfunc" id="2231655">len</span><span class="op" id="2231658">(</span><span class="ident" id="2231659">buf</span><span class="op" id="2231662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231665">for</span>&nbsp;<span class="ident" id="2231669">exp</span>&nbsp;<span class="op" id="2231673">&gt;=</span>&nbsp;<span class="num" id="2231676">10</span>&nbsp;<span class="op" id="2231679">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231683">i</span><span class="op" id="2231684">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231689">buf</span><span class="op" id="2231692">[</span><span class="ident" id="2231693">i</span><span class="op" id="2231694">]</span>&nbsp;<span class="op" id="2231696">=</span>&nbsp;<span class="builtintype" id="2231698">byte</span><span class="op" id="2231702">(</span><span class="ident" id="2231703">exp</span><span class="op" id="2231706">%</span><span class="num" id="2231707">10</span>&nbsp;<span class="op" id="2231710">+</span>&nbsp;<span class="string" id="2231712">&#39;0&#39;</span><span class="op" id="2231715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231719">exp</span>&nbsp;<span class="op" id="2231723">/=</span>&nbsp;<span class="num" id="2231726">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231733">//&nbsp;exp&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231746">i</span><span class="op" id="2231747">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231751">buf</span><span class="op" id="2231754">[</span><span class="ident" id="2231755">i</span><span class="op" id="2231756">]</span>&nbsp;<span class="op" id="2231758">=</span>&nbsp;<span class="builtintype" id="2231760">byte</span><span class="op" id="2231764">(</span><span class="ident" id="2231765">exp</span>&nbsp;<span class="op" id="2231769">+</span>&nbsp;<span class="string" id="2231771">&#39;0&#39;</span><span class="op" id="2231774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231778">switch</span>&nbsp;<span class="ident" id="2231785">i</span>&nbsp;<span class="op" id="2231787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231790">case</span>&nbsp;<span class="num" id="2231795">0</span><span class="op" id="2231796">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231800">dst</span>&nbsp;<span class="op" id="2231804">=</span>&nbsp;<span class="builtinfunc" id="2231806">append</span><span class="op" id="2231812">(</span><span class="ident" id="2231813">dst</span><span class="op" id="2231816">,</span>&nbsp;<span class="ident" id="2231818">buf</span><span class="op" id="2231821">[</span><span class="num" id="2231822">0</span><span class="op" id="2231823">]</span><span class="op" id="2231824">,</span>&nbsp;<span class="ident" id="2231826">buf</span><span class="op" id="2231829">[</span><span class="num" id="2231830">1</span><span class="op" id="2231831">]</span><span class="op" id="2231832">,</span>&nbsp;<span class="ident" id="2231834">buf</span><span class="op" id="2231837">[</span><span class="num" id="2231838">2</span><span class="op" id="2231839">]</span><span class="op" id="2231840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231843">case</span>&nbsp;<span class="num" id="2231848">1</span><span class="op" id="2231849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231853">dst</span>&nbsp;<span class="op" id="2231857">=</span>&nbsp;<span class="builtinfunc" id="2231859">append</span><span class="op" id="2231865">(</span><span class="ident" id="2231866">dst</span><span class="op" id="2231869">,</span>&nbsp;<span class="ident" id="2231871">buf</span><span class="op" id="2231874">[</span><span class="num" id="2231875">1</span><span class="op" id="2231876">]</span><span class="op" id="2231877">,</span>&nbsp;<span class="ident" id="2231879">buf</span><span class="op" id="2231882">[</span><span class="num" id="2231883">2</span><span class="op" id="2231884">]</span><span class="op" id="2231885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231888">case</span>&nbsp;<span class="num" id="2231893">2</span><span class="op" id="2231894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231898">//&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231918">dst</span>&nbsp;<span class="op" id="2231922">=</span>&nbsp;<span class="builtinfunc" id="2231924">append</span><span class="op" id="2231930">(</span><span class="ident" id="2231931">dst</span><span class="op" id="2231934">,</span>&nbsp;<span class="string" id="2231936">&#39;0&#39;</span><span class="op" id="2231939">,</span>&nbsp;<span class="ident" id="2231941">buf</span><span class="op" id="2231944">[</span><span class="num" id="2231945">2</span><span class="op" id="2231946">]</span><span class="op" id="2231947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231953">return</span>&nbsp;<span class="ident" id="2231960">dst</span><br>
<span class="lineno"></span><span class="op" id="2231964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="2231967">//&nbsp;%f:&nbsp;-ddddddd.ddddd</span><br>
<span class="lineno"></span><span class="keyword" id="2231989">func</span>&nbsp;<span class="ident" id="2231994">fmtF</span><span class="op" id="2231998">(</span><span class="ident" id="2231999">dst</span>&nbsp;<span class="op" id="2232003">[</span><span class="op" id="2232004">]</span><span class="builtintype" id="2232005">byte</span><span class="op" id="2232009">,</span>&nbsp;<span class="ident" id="2232011">neg</span>&nbsp;<span class="builtintype" id="2232015">bool</span><span class="op" id="2232019">,</span>&nbsp;<span class="ident" id="2232021">d</span>&nbsp;<span class="ident" id="2232023">decimalSlice</span><span class="op" id="2232035">,</span>&nbsp;<span class="ident" id="2232037">prec</span>&nbsp;<span class="builtintype" id="2232042">int</span><span class="op" id="2232045">)</span>&nbsp;<span class="op" id="2232047">[</span><span class="op" id="2232048">]</span><span class="builtintype" id="2232049">byte</span>&nbsp;<span class="op" id="2232054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2232057">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232066">if</span>&nbsp;<span class="ident" id="2232069">neg</span>&nbsp;<span class="op" id="2232073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232077">dst</span>&nbsp;<span class="op" id="2232081">=</span>&nbsp;<span class="builtinfunc" id="2232083">append</span><span class="op" id="2232089">(</span><span class="ident" id="2232090">dst</span><span class="op" id="2232093">,</span>&nbsp;<span class="string" id="2232095">&#39;-&#39;</span><span class="op" id="2232098">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2232105">//&nbsp;integer,&nbsp;padded&nbsp;with&nbsp;zeros&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232147">if</span>&nbsp;<span class="ident" id="2232150">d</span><span class="op" id="2232151">.</span><span class="ident" id="2232152">dp</span>&nbsp;<span class="op" id="2232155">&gt;</span>&nbsp;<span class="num" id="2232157">0</span>&nbsp;<span class="op" id="2232159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232163">var</span>&nbsp;<span class="ident" id="2232167">i</span>&nbsp;<span class="builtintype" id="2232169">int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232175">for</span>&nbsp;<span class="ident" id="2232179">i</span>&nbsp;<span class="op" id="2232181">=</span>&nbsp;<span class="num" id="2232183">0</span><span class="op" id="2232184">;</span>&nbsp;<span class="ident" id="2232186">i</span>&nbsp;<span class="op" id="2232188">&lt;</span>&nbsp;<span class="ident" id="2232190">d</span><span class="op" id="2232191">.</span><span class="ident" id="2232192">dp</span>&nbsp;<span class="op" id="2232195">&amp;&amp;</span>&nbsp;<span class="ident" id="2232198">i</span>&nbsp;<span class="op" id="2232200">&lt;</span>&nbsp;<span class="ident" id="2232202">d</span><span class="op" id="2232203">.</span><span class="ident" id="2232204">nd</span><span class="op" id="2232206">;</span>&nbsp;<span class="ident" id="2232208">i</span><span class="op" id="2232209">++</span>&nbsp;<span class="op" id="2232212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232217">dst</span>&nbsp;<span class="op" id="2232221">=</span>&nbsp;<span class="builtinfunc" id="2232223">append</span><span class="op" id="2232229">(</span><span class="ident" id="2232230">dst</span><span class="op" id="2232233">,</span>&nbsp;<span class="ident" id="2232235">d</span><span class="op" id="2232236">.</span><span class="ident" id="2232237">d</span><span class="op" id="2232238">[</span><span class="ident" id="2232239">i</span><span class="op" id="2232240">]</span><span class="op" id="2232241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232249">for</span>&nbsp;<span class="op" id="2232253">;</span>&nbsp;<span class="ident" id="2232255">i</span>&nbsp;<span class="op" id="2232257">&lt;</span>&nbsp;<span class="ident" id="2232259">d</span><span class="op" id="2232260">.</span><span class="ident" id="2232261">dp</span><span class="op" id="2232263">;</span>&nbsp;<span class="ident" id="2232265">i</span><span class="op" id="2232266">++</span>&nbsp;<span class="op" id="2232269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232274">dst</span>&nbsp;<span class="op" id="2232278">=</span>&nbsp;<span class="builtinfunc" id="2232280">append</span><span class="op" id="2232286">(</span><span class="ident" id="2232287">dst</span><span class="op" id="2232290">,</span>&nbsp;<span class="string" id="2232292">&#39;0&#39;</span><span class="op" id="2232295">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232302">}</span>&nbsp;<span class="keyword" id="2232304">else</span>&nbsp;<span class="op" id="2232309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232313">dst</span>&nbsp;<span class="op" id="2232317">=</span>&nbsp;<span class="builtinfunc" id="2232319">append</span><span class="op" id="2232325">(</span><span class="ident" id="2232326">dst</span><span class="op" id="2232329">,</span>&nbsp;<span class="string" id="2232331">&#39;0&#39;</span><span class="op" id="2232334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2232341">//&nbsp;fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232354">if</span>&nbsp;<span class="ident" id="2232357">prec</span>&nbsp;<span class="op" id="2232362">&gt;</span>&nbsp;<span class="num" id="2232364">0</span>&nbsp;<span class="op" id="2232366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232370">dst</span>&nbsp;<span class="op" id="2232374">=</span>&nbsp;<span class="builtinfunc" id="2232376">append</span><span class="op" id="2232382">(</span><span class="ident" id="2232383">dst</span><span class="op" id="2232386">,</span>&nbsp;<span class="string" id="2232388">&#39;.&#39;</span><span class="op" id="2232391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232395">for</span>&nbsp;<span class="ident" id="2232399">i</span>&nbsp;<span class="op" id="2232401">:=</span>&nbsp;<span class="num" id="2232404">0</span><span class="op" id="2232405">;</span>&nbsp;<span class="ident" id="2232407">i</span>&nbsp;<span class="op" id="2232409">&lt;</span>&nbsp;<span class="ident" id="2232411">prec</span><span class="op" id="2232415">;</span>&nbsp;<span class="ident" id="2232417">i</span><span class="op" id="2232418">++</span>&nbsp;<span class="op" id="2232421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232426">ch</span>&nbsp;<span class="op" id="2232429">:=</span>&nbsp;<span class="builtintype" id="2232432">byte</span><span class="op" id="2232436">(</span><span class="string" id="2232437">&#39;0&#39;</span><span class="op" id="2232440">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232445">if</span>&nbsp;<span class="ident" id="2232448">j</span>&nbsp;<span class="op" id="2232450">:=</span>&nbsp;<span class="ident" id="2232453">d</span><span class="op" id="2232454">.</span><span class="ident" id="2232455">dp</span>&nbsp;<span class="op" id="2232458">+</span>&nbsp;<span class="ident" id="2232460">i</span><span class="op" id="2232461">;</span>&nbsp;<span class="num" id="2232463">0</span>&nbsp;<span class="op" id="2232465">&lt;=</span>&nbsp;<span class="ident" id="2232468">j</span>&nbsp;<span class="op" id="2232470">&amp;&amp;</span>&nbsp;<span class="ident" id="2232473">j</span>&nbsp;<span class="op" id="2232475">&lt;</span>&nbsp;<span class="ident" id="2232477">d</span><span class="op" id="2232478">.</span><span class="ident" id="2232479">nd</span>&nbsp;<span class="op" id="2232482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232488">ch</span>&nbsp;<span class="op" id="2232491">=</span>&nbsp;<span class="ident" id="2232493">d</span><span class="op" id="2232494">.</span><span class="ident" id="2232495">d</span><span class="op" id="2232496">[</span><span class="ident" id="2232497">j</span><span class="op" id="2232498">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232508">dst</span>&nbsp;<span class="op" id="2232512">=</span>&nbsp;<span class="builtinfunc" id="2232514">append</span><span class="op" id="2232520">(</span><span class="ident" id="2232521">dst</span><span class="op" id="2232524">,</span>&nbsp;<span class="ident" id="2232526">ch</span><span class="op" id="2232528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232532">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232539">return</span>&nbsp;<span class="ident" id="2232546">dst</span><br>
<span class="lineno"></span><span class="op" id="2232550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="2232553">//&nbsp;%b:&nbsp;-ddddddddp+ddd</span><br>
<span class="lineno"></span><span class="keyword" id="2232575">func</span>&nbsp;<span class="ident" id="2232580">fmtB</span><span class="op" id="2232584">(</span><span class="ident" id="2232585">dst</span>&nbsp;<span class="op" id="2232589">[</span><span class="op" id="2232590">]</span><span class="builtintype" id="2232591">byte</span><span class="op" id="2232595">,</span>&nbsp;<span class="ident" id="2232597">neg</span>&nbsp;<span class="builtintype" id="2232601">bool</span><span class="op" id="2232605">,</span>&nbsp;<span class="ident" id="2232607">mant</span>&nbsp;<span class="ident" id="2232612">uint64</span><span class="op" id="2232618">,</span>&nbsp;<span class="ident" id="2232620">exp</span>&nbsp;<span class="builtintype" id="2232624">int</span><span class="op" id="2232627">,</span>&nbsp;<span class="ident" id="2232629">flt</span>&nbsp;<span class="op" id="2232633">*</span><span class="ident" id="2232634">floatInfo</span><span class="op" id="2232643">)</span>&nbsp;<span class="op" id="2232645">[</span><span class="op" id="2232646">]</span><span class="builtintype" id="2232647">byte</span>&nbsp;<span class="op" id="2232652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232655">var</span>&nbsp;<span class="ident" id="2232659">buf</span>&nbsp;<span class="op" id="2232663">[</span><span class="num" id="2232664">50</span><span class="op" id="2232666">]</span><span class="builtintype" id="2232667">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232673">w</span>&nbsp;<span class="op" id="2232675">:=</span>&nbsp;<span class="builtinfunc" id="2232678">len</span><span class="op" id="2232681">(</span><span class="ident" id="2232682">buf</span><span class="op" id="2232685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232688">exp</span>&nbsp;<span class="op" id="2232692">-=</span>&nbsp;<span class="builtintype" id="2232695">int</span><span class="op" id="2232698">(</span><span class="ident" id="2232699">flt</span><span class="op" id="2232702">.</span><span class="ident" id="2232703">mantbits</span><span class="op" id="2232711">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232714">esign</span>&nbsp;<span class="op" id="2232720">:=</span>&nbsp;<span class="builtintype" id="2232723">byte</span><span class="op" id="2232727">(</span><span class="string" id="2232728">&#39;+&#39;</span><span class="op" id="2232731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232734">if</span>&nbsp;<span class="ident" id="2232737">exp</span>&nbsp;<span class="op" id="2232741">&lt;</span>&nbsp;<span class="num" id="2232743">0</span>&nbsp;<span class="op" id="2232745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232749">esign</span>&nbsp;<span class="op" id="2232755">=</span>&nbsp;<span class="string" id="2232757">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232763">exp</span>&nbsp;<span class="op" id="2232767">=</span>&nbsp;<span class="op" id="2232769">-</span><span class="ident" id="2232770">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232775">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232778">n</span>&nbsp;<span class="op" id="2232780">:=</span>&nbsp;<span class="num" id="2232783">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232786">for</span>&nbsp;<span class="ident" id="2232790">exp</span>&nbsp;<span class="op" id="2232794">&gt;</span>&nbsp;<span class="num" id="2232796">0</span>&nbsp;<span class="op" id="2232798">||</span>&nbsp;<span class="ident" id="2232801">n</span>&nbsp;<span class="op" id="2232803">&lt;</span>&nbsp;<span class="num" id="2232805">1</span>&nbsp;<span class="op" id="2232807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232811">n</span><span class="op" id="2232812">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232817">w</span><span class="op" id="2232818">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232823">buf</span><span class="op" id="2232826">[</span><span class="ident" id="2232827">w</span><span class="op" id="2232828">]</span>&nbsp;<span class="op" id="2232830">=</span>&nbsp;<span class="builtintype" id="2232832">byte</span><span class="op" id="2232836">(</span><span class="ident" id="2232837">exp</span><span class="op" id="2232840">%</span><span class="num" id="2232841">10</span>&nbsp;<span class="op" id="2232844">+</span>&nbsp;<span class="string" id="2232846">&#39;0&#39;</span><span class="op" id="2232849">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232853">exp</span>&nbsp;<span class="op" id="2232857">/=</span>&nbsp;<span class="num" id="2232860">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232867">w</span><span class="op" id="2232868">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232872">buf</span><span class="op" id="2232875">[</span><span class="ident" id="2232876">w</span><span class="op" id="2232877">]</span>&nbsp;<span class="op" id="2232879">=</span>&nbsp;<span class="ident" id="2232881">esign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232888">w</span><span class="op" id="2232889">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232893">buf</span><span class="op" id="2232896">[</span><span class="ident" id="2232897">w</span><span class="op" id="2232898">]</span>&nbsp;<span class="op" id="2232900">=</span>&nbsp;<span class="string" id="2232902">&#39;p&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232907">n</span>&nbsp;<span class="op" id="2232909">=</span>&nbsp;<span class="num" id="2232911">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232914">for</span>&nbsp;<span class="ident" id="2232918">mant</span>&nbsp;<span class="op" id="2232923">&gt;</span>&nbsp;<span class="num" id="2232925">0</span>&nbsp;<span class="op" id="2232927">||</span>&nbsp;<span class="ident" id="2232930">n</span>&nbsp;<span class="op" id="2232932">&lt;</span>&nbsp;<span class="num" id="2232934">1</span>&nbsp;<span class="op" id="2232936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232940">n</span><span class="op" id="2232941">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232946">w</span><span class="op" id="2232947">--</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232952">buf</span><span class="op" id="2232955">[</span><span class="ident" id="2232956">w</span><span class="op" id="2232957">]</span>&nbsp;<span class="op" id="2232959">=</span>&nbsp;<span class="builtintype" id="2232961">byte</span><span class="op" id="2232965">(</span><span class="ident" id="2232966">mant</span><span class="op" id="2232970">%</span><span class="num" id="2232971">10</span>&nbsp;<span class="op" id="2232974">+</span>&nbsp;<span class="string" id="2232976">&#39;0&#39;</span><span class="op" id="2232979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232983">mant</span>&nbsp;<span class="op" id="2232988">/=</span>&nbsp;<span class="num" id="2232991">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232998">if</span>&nbsp;<span class="ident" id="2233001">neg</span>&nbsp;<span class="op" id="2233005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2233009">w</span><span class="op" id="2233010">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2233015">buf</span><span class="op" id="2233018">[</span><span class="ident" id="2233019">w</span><span class="op" id="2233020">]</span>&nbsp;<span class="op" id="2233022">=</span>&nbsp;<span class="string" id="2233024">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2233029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2233032">return</span>&nbsp;<span class="builtinfunc" id="2233039">append</span><span class="op" id="2233045">(</span><span class="ident" id="2233046">dst</span><span class="op" id="2233049">,</span>&nbsp;<span class="ident" id="2233051">buf</span><span class="op" id="2233054">[</span><span class="ident" id="2233055">w</span><span class="op" id="2233056">:</span><span class="op" id="2233057">]</span><span class="op" id="2233058">...</span><span class="op" id="2233061">)</span><br>
<span class="lineno"></span><span class="op" id="2233063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="2233066">func</span>&nbsp;<span class="ident" id="2233071">max</span><span class="op" id="2233074">(</span><span class="ident" id="2233075">a</span><span class="op" id="2233076">,</span>&nbsp;<span class="ident" id="2233078">b</span>&nbsp;<span class="builtintype" id="2233080">int</span><span class="op" id="2233083">)</span>&nbsp;<span class="builtintype" id="2233085">int</span>&nbsp;<span class="op" id="2233089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2233092">if</span>&nbsp;<span class="ident" id="2233095">a</span>&nbsp;<span class="op" id="2233097">&gt;</span>&nbsp;<span class="ident" id="2233099">b</span>&nbsp;<span class="op" id="2233101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2233105">return</span>&nbsp;<span class="ident" id="2233112">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2233115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2233118">return</span>&nbsp;<span class="ident" id="2233125">b</span><br>
<span class="lineno">475</span><span class="op" id="2233127">}</span>
</div>
</body>
</html>
