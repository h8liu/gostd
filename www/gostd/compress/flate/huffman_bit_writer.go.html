<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html" class="current">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4370826">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4370881">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4370935">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4370986">package</span>&nbsp;<span class="ident" id="4370994">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4371001">import</span>&nbsp;<span class="op" id="4371008">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4371011">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4371017">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4371024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4371027">const</span>&nbsp;<span class="op" id="4371033">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371036">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4371065">offsetCodeCount</span>&nbsp;<span class="op" id="4371081">=</span>&nbsp;<span class="num" id="4371083">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371088">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4371142">endBlockMarker</span>&nbsp;<span class="op" id="4371157">=</span>&nbsp;<span class="num" id="4371159">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371165">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4371192">lengthCodesStart</span>&nbsp;<span class="op" id="4371209">=</span>&nbsp;<span class="num" id="4371211">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371217">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4371250">codegenCodeCount</span>&nbsp;<span class="op" id="4371267">=</span>&nbsp;<span class="num" id="4371269">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4371273">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4371290">=</span>&nbsp;<span class="num" id="4371292">255</span><br>
<span class="lineno">25</span><span class="op" id="4371296">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4371299">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4371373">var</span>&nbsp;<span class="ident" id="4371377">lengthExtraBits</span>&nbsp;<span class="op" id="4371393">=</span>&nbsp;<span class="op" id="4371395">[</span><span class="op" id="4371396">]</span><span class="builtintype" id="4371397">int8</span><span class="op" id="4371401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371404">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="4371414">0</span><span class="op" id="4371415">,</span>&nbsp;<span class="num" id="4371417">0</span><span class="op" id="4371418">,</span>&nbsp;<span class="num" id="4371420">0</span><span class="op" id="4371421">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371424">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="4371434">0</span><span class="op" id="4371435">,</span>&nbsp;<span class="num" id="4371437">0</span><span class="op" id="4371438">,</span>&nbsp;<span class="num" id="4371440">0</span><span class="op" id="4371441">,</span>&nbsp;<span class="num" id="4371443">0</span><span class="op" id="4371444">,</span>&nbsp;<span class="num" id="4371446">0</span><span class="op" id="4371447">,</span>&nbsp;<span class="num" id="4371449">1</span><span class="op" id="4371450">,</span>&nbsp;<span class="num" id="4371452">1</span><span class="op" id="4371453">,</span>&nbsp;<span class="num" id="4371455">1</span><span class="op" id="4371456">,</span>&nbsp;<span class="num" id="4371458">1</span><span class="op" id="4371459">,</span>&nbsp;<span class="num" id="4371461">2</span><span class="op" id="4371462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371465">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="4371475">2</span><span class="op" id="4371476">,</span>&nbsp;<span class="num" id="4371478">2</span><span class="op" id="4371479">,</span>&nbsp;<span class="num" id="4371481">2</span><span class="op" id="4371482">,</span>&nbsp;<span class="num" id="4371484">3</span><span class="op" id="4371485">,</span>&nbsp;<span class="num" id="4371487">3</span><span class="op" id="4371488">,</span>&nbsp;<span class="num" id="4371490">3</span><span class="op" id="4371491">,</span>&nbsp;<span class="num" id="4371493">3</span><span class="op" id="4371494">,</span>&nbsp;<span class="num" id="4371496">4</span><span class="op" id="4371497">,</span>&nbsp;<span class="num" id="4371499">4</span><span class="op" id="4371500">,</span>&nbsp;<span class="num" id="4371502">4</span><span class="op" id="4371503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371506">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="4371516">4</span><span class="op" id="4371517">,</span>&nbsp;<span class="num" id="4371519">5</span><span class="op" id="4371520">,</span>&nbsp;<span class="num" id="4371522">5</span><span class="op" id="4371523">,</span>&nbsp;<span class="num" id="4371525">5</span><span class="op" id="4371526">,</span>&nbsp;<span class="num" id="4371528">5</span><span class="op" id="4371529">,</span>&nbsp;<span class="num" id="4371531">0</span><span class="op" id="4371532">,</span><br>
<span class="lineno"></span><span class="op" id="4371534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4371537">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4371600">var</span>&nbsp;<span class="ident" id="4371604">lengthBase</span>&nbsp;<span class="op" id="4371615">=</span>&nbsp;<span class="op" id="4371617">[</span><span class="op" id="4371618">]</span><span class="builtintype" id="4371619">uint32</span><span class="op" id="4371625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4371628">0</span><span class="op" id="4371629">,</span>&nbsp;<span class="num" id="4371631">1</span><span class="op" id="4371632">,</span>&nbsp;<span class="num" id="4371634">2</span><span class="op" id="4371635">,</span>&nbsp;<span class="num" id="4371637">3</span><span class="op" id="4371638">,</span>&nbsp;<span class="num" id="4371640">4</span><span class="op" id="4371641">,</span>&nbsp;<span class="num" id="4371643">5</span><span class="op" id="4371644">,</span>&nbsp;<span class="num" id="4371646">6</span><span class="op" id="4371647">,</span>&nbsp;<span class="num" id="4371649">7</span><span class="op" id="4371650">,</span>&nbsp;<span class="num" id="4371652">8</span><span class="op" id="4371653">,</span>&nbsp;<span class="num" id="4371655">10</span><span class="op" id="4371657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4371660">12</span><span class="op" id="4371662">,</span>&nbsp;<span class="num" id="4371664">14</span><span class="op" id="4371666">,</span>&nbsp;<span class="num" id="4371668">16</span><span class="op" id="4371670">,</span>&nbsp;<span class="num" id="4371672">20</span><span class="op" id="4371674">,</span>&nbsp;<span class="num" id="4371676">24</span><span class="op" id="4371678">,</span>&nbsp;<span class="num" id="4371680">28</span><span class="op" id="4371682">,</span>&nbsp;<span class="num" id="4371684">32</span><span class="op" id="4371686">,</span>&nbsp;<span class="num" id="4371688">40</span><span class="op" id="4371690">,</span>&nbsp;<span class="num" id="4371692">48</span><span class="op" id="4371694">,</span>&nbsp;<span class="num" id="4371696">56</span><span class="op" id="4371698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4371701">64</span><span class="op" id="4371703">,</span>&nbsp;<span class="num" id="4371705">80</span><span class="op" id="4371707">,</span>&nbsp;<span class="num" id="4371709">96</span><span class="op" id="4371711">,</span>&nbsp;<span class="num" id="4371713">112</span><span class="op" id="4371716">,</span>&nbsp;<span class="num" id="4371718">128</span><span class="op" id="4371721">,</span>&nbsp;<span class="num" id="4371723">160</span><span class="op" id="4371726">,</span>&nbsp;<span class="num" id="4371728">192</span><span class="op" id="4371731">,</span>&nbsp;<span class="num" id="4371733">224</span><span class="op" id="4371736">,</span>&nbsp;<span class="num" id="4371738">255</span><span class="op" id="4371741">,</span><br>
<span class="lineno">40</span><span class="op" id="4371743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4371746">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4371778">var</span>&nbsp;<span class="ident" id="4371782">offsetExtraBits</span>&nbsp;<span class="op" id="4371798">=</span>&nbsp;<span class="op" id="4371800">[</span><span class="op" id="4371801">]</span><span class="builtintype" id="4371802">int8</span><span class="op" id="4371806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4371809">0</span><span class="op" id="4371810">,</span>&nbsp;<span class="num" id="4371812">0</span><span class="op" id="4371813">,</span>&nbsp;<span class="num" id="4371815">0</span><span class="op" id="4371816">,</span>&nbsp;<span class="num" id="4371818">0</span><span class="op" id="4371819">,</span>&nbsp;<span class="num" id="4371821">1</span><span class="op" id="4371822">,</span>&nbsp;<span class="num" id="4371824">1</span><span class="op" id="4371825">,</span>&nbsp;<span class="num" id="4371827">2</span><span class="op" id="4371828">,</span>&nbsp;<span class="num" id="4371830">2</span><span class="op" id="4371831">,</span>&nbsp;<span class="num" id="4371833">3</span><span class="op" id="4371834">,</span>&nbsp;<span class="num" id="4371836">3</span><span class="op" id="4371837">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4371840">4</span><span class="op" id="4371841">,</span>&nbsp;<span class="num" id="4371843">4</span><span class="op" id="4371844">,</span>&nbsp;<span class="num" id="4371846">5</span><span class="op" id="4371847">,</span>&nbsp;<span class="num" id="4371849">5</span><span class="op" id="4371850">,</span>&nbsp;<span class="num" id="4371852">6</span><span class="op" id="4371853">,</span>&nbsp;<span class="num" id="4371855">6</span><span class="op" id="4371856">,</span>&nbsp;<span class="num" id="4371858">7</span><span class="op" id="4371859">,</span>&nbsp;<span class="num" id="4371861">7</span><span class="op" id="4371862">,</span>&nbsp;<span class="num" id="4371864">8</span><span class="op" id="4371865">,</span>&nbsp;<span class="num" id="4371867">8</span><span class="op" id="4371868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4371871">9</span><span class="op" id="4371872">,</span>&nbsp;<span class="num" id="4371874">9</span><span class="op" id="4371875">,</span>&nbsp;<span class="num" id="4371877">10</span><span class="op" id="4371879">,</span>&nbsp;<span class="num" id="4371881">10</span><span class="op" id="4371883">,</span>&nbsp;<span class="num" id="4371885">11</span><span class="op" id="4371887">,</span>&nbsp;<span class="num" id="4371889">11</span><span class="op" id="4371891">,</span>&nbsp;<span class="num" id="4371893">12</span><span class="op" id="4371895">,</span>&nbsp;<span class="num" id="4371897">12</span><span class="op" id="4371899">,</span>&nbsp;<span class="num" id="4371901">13</span><span class="op" id="4371903">,</span>&nbsp;<span class="num" id="4371905">13</span><span class="op" id="4371907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4371910">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4371933">14</span><span class="op" id="4371935">,</span>&nbsp;<span class="num" id="4371937">14</span><span class="op" id="4371939">,</span>&nbsp;<span class="num" id="4371941">15</span><span class="op" id="4371943">,</span>&nbsp;<span class="num" id="4371945">15</span><span class="op" id="4371947">,</span>&nbsp;<span class="num" id="4371949">16</span><span class="op" id="4371951">,</span>&nbsp;<span class="num" id="4371953">16</span><span class="op" id="4371955">,</span>&nbsp;<span class="num" id="4371957">17</span><span class="op" id="4371959">,</span>&nbsp;<span class="num" id="4371961">17</span><span class="op" id="4371963">,</span>&nbsp;<span class="num" id="4371965">18</span><span class="op" id="4371967">,</span>&nbsp;<span class="num" id="4371969">18</span><span class="op" id="4371971">,</span>&nbsp;<span class="num" id="4371973">19</span><span class="op" id="4371975">,</span>&nbsp;<span class="num" id="4371977">19</span><span class="op" id="4371979">,</span>&nbsp;<span class="num" id="4371981">20</span><span class="op" id="4371983">,</span>&nbsp;<span class="num" id="4371985">20</span><span class="op" id="4371987">,</span><br>
<span class="lineno"></span><span class="op" id="4371989">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4371992">var</span>&nbsp;<span class="ident" id="4371996">offsetBase</span>&nbsp;<span class="op" id="4372007">=</span>&nbsp;<span class="op" id="4372009">[</span><span class="op" id="4372010">]</span><span class="builtintype" id="4372011">uint32</span><span class="op" id="4372017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4372020">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4372042">0x000000</span><span class="op" id="4372050">,</span>&nbsp;<span class="num" id="4372052">0x000001</span><span class="op" id="4372060">,</span>&nbsp;<span class="num" id="4372062">0x000002</span><span class="op" id="4372070">,</span>&nbsp;<span class="num" id="4372072">0x000003</span><span class="op" id="4372080">,</span>&nbsp;<span class="num" id="4372082">0x000004</span><span class="op" id="4372090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4372093">0x000006</span><span class="op" id="4372101">,</span>&nbsp;<span class="num" id="4372103">0x000008</span><span class="op" id="4372111">,</span>&nbsp;<span class="num" id="4372113">0x00000c</span><span class="op" id="4372121">,</span>&nbsp;<span class="num" id="4372123">0x000010</span><span class="op" id="4372131">,</span>&nbsp;<span class="num" id="4372133">0x000018</span><span class="op" id="4372141">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4372144">0x000020</span><span class="op" id="4372152">,</span>&nbsp;<span class="num" id="4372154">0x000030</span><span class="op" id="4372162">,</span>&nbsp;<span class="num" id="4372164">0x000040</span><span class="op" id="4372172">,</span>&nbsp;<span class="num" id="4372174">0x000060</span><span class="op" id="4372182">,</span>&nbsp;<span class="num" id="4372184">0x000080</span><span class="op" id="4372192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4372195">0x0000c0</span><span class="op" id="4372203">,</span>&nbsp;<span class="num" id="4372205">0x000100</span><span class="op" id="4372213">,</span>&nbsp;<span class="num" id="4372215">0x000180</span><span class="op" id="4372223">,</span>&nbsp;<span class="num" id="4372225">0x000200</span><span class="op" id="4372233">,</span>&nbsp;<span class="num" id="4372235">0x000300</span><span class="op" id="4372243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4372246">0x000400</span><span class="op" id="4372254">,</span>&nbsp;<span class="num" id="4372256">0x000600</span><span class="op" id="4372264">,</span>&nbsp;<span class="num" id="4372266">0x000800</span><span class="op" id="4372274">,</span>&nbsp;<span class="num" id="4372276">0x000c00</span><span class="op" id="4372284">,</span>&nbsp;<span class="num" id="4372286">0x001000</span><span class="op" id="4372294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4372297">0x001800</span><span class="op" id="4372305">,</span>&nbsp;<span class="num" id="4372307">0x002000</span><span class="op" id="4372315">,</span>&nbsp;<span class="num" id="4372317">0x003000</span><span class="op" id="4372325">,</span>&nbsp;<span class="num" id="4372327">0x004000</span><span class="op" id="4372335">,</span>&nbsp;<span class="num" id="4372337">0x006000</span><span class="op" id="4372345">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4372349">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4372372">0x008000</span><span class="op" id="4372380">,</span>&nbsp;<span class="num" id="4372382">0x00c000</span><span class="op" id="4372390">,</span>&nbsp;<span class="num" id="4372392">0x010000</span><span class="op" id="4372400">,</span>&nbsp;<span class="num" id="4372402">0x018000</span><span class="op" id="4372410">,</span>&nbsp;<span class="num" id="4372412">0x020000</span><span class="op" id="4372420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4372423">0x030000</span><span class="op" id="4372431">,</span>&nbsp;<span class="num" id="4372433">0x040000</span><span class="op" id="4372441">,</span>&nbsp;<span class="num" id="4372443">0x060000</span><span class="op" id="4372451">,</span>&nbsp;<span class="num" id="4372453">0x080000</span><span class="op" id="4372461">,</span>&nbsp;<span class="num" id="4372463">0x0c0000</span><span class="op" id="4372471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4372474">0x100000</span><span class="op" id="4372482">,</span>&nbsp;<span class="num" id="4372484">0x180000</span><span class="op" id="4372492">,</span>&nbsp;<span class="num" id="4372494">0x200000</span><span class="op" id="4372502">,</span>&nbsp;<span class="num" id="4372504">0x300000</span><span class="op" id="4372512">,</span><br>
<span class="lineno"></span><span class="op" id="4372514">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4372517">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="4372579">var</span>&nbsp;<span class="ident" id="4372583">codegenOrder</span>&nbsp;<span class="op" id="4372596">=</span>&nbsp;<span class="op" id="4372598">[</span><span class="op" id="4372599">]</span><span class="builtintype" id="4372600">uint32</span><span class="op" id="4372606">{</span><span class="num" id="4372607">16</span><span class="op" id="4372609">,</span>&nbsp;<span class="num" id="4372611">17</span><span class="op" id="4372613">,</span>&nbsp;<span class="num" id="4372615">18</span><span class="op" id="4372617">,</span>&nbsp;<span class="num" id="4372619">0</span><span class="op" id="4372620">,</span>&nbsp;<span class="num" id="4372622">8</span><span class="op" id="4372623">,</span>&nbsp;<span class="num" id="4372625">7</span><span class="op" id="4372626">,</span>&nbsp;<span class="num" id="4372628">9</span><span class="op" id="4372629">,</span>&nbsp;<span class="num" id="4372631">6</span><span class="op" id="4372632">,</span>&nbsp;<span class="num" id="4372634">10</span><span class="op" id="4372636">,</span>&nbsp;<span class="num" id="4372638">5</span><span class="op" id="4372639">,</span>&nbsp;<span class="num" id="4372641">11</span><span class="op" id="4372643">,</span>&nbsp;<span class="num" id="4372645">4</span><span class="op" id="4372646">,</span>&nbsp;<span class="num" id="4372648">12</span><span class="op" id="4372650">,</span>&nbsp;<span class="num" id="4372652">3</span><span class="op" id="4372653">,</span>&nbsp;<span class="num" id="4372655">13</span><span class="op" id="4372657">,</span>&nbsp;<span class="num" id="4372659">2</span><span class="op" id="4372660">,</span>&nbsp;<span class="num" id="4372662">14</span><span class="op" id="4372664">,</span>&nbsp;<span class="num" id="4372666">1</span><span class="op" id="4372667">,</span>&nbsp;<span class="num" id="4372669">15</span><span class="op" id="4372671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4372674">type</span>&nbsp;<span class="ident" id="4372679">huffmanBitWriter</span>&nbsp;<span class="keyword" id="4372696">struct</span>&nbsp;<span class="op" id="4372703">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4372706">w</span>&nbsp;<span class="ident" id="4372708">io</span><span class="op" id="4372710">.</span><span class="ident" id="4372711">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4372719">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4372769">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4372805">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4372821">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4372829">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4372845">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4372853">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4372869">[</span><span class="num" id="4372870">64</span><span class="op" id="4372872">]</span><span class="builtintype" id="4372873">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4372879">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4372895">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4372900">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4372916">[</span><span class="op" id="4372917">]</span><span class="builtintype" id="4372918">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4372925">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4372941">[</span><span class="op" id="4372942">]</span><span class="builtintype" id="4372943">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4372950">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4372966">[</span><span class="op" id="4372967">]</span><span class="builtintype" id="4372968">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4372975">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4372991">[</span><span class="op" id="4372992">]</span><span class="builtintype" id="4372993">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373000">literalEncoding</span>&nbsp;<span class="op" id="4373016">*</span><span class="ident" id="4373017">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373033">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="4373049">*</span><span class="ident" id="4373050">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373066">codegenEncoding</span>&nbsp;<span class="op" id="4373082">*</span><span class="ident" id="4373083">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373099">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4373115">error</span><br>
<span class="lineno">85</span><span class="op" id="4373121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4373124">func</span>&nbsp;<span class="ident" id="4373129">newHuffmanBitWriter</span><span class="op" id="4373148">(</span><span class="ident" id="4373149">w</span>&nbsp;<span class="ident" id="4373151">io</span><span class="op" id="4373153">.</span><span class="ident" id="4373154">Writer</span><span class="op" id="4373160">)</span>&nbsp;<span class="op" id="4373162">*</span><span class="ident" id="4373163">huffmanBitWriter</span>&nbsp;<span class="op" id="4373180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4373183">return</span>&nbsp;<span class="op" id="4373190">&amp;</span><span class="ident" id="4373191">huffmanBitWriter</span><span class="op" id="4373207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373211">w</span><span class="op" id="4373212">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373228">w</span><span class="op" id="4373229">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373233">literalFreq</span><span class="op" id="4373244">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4373250">make</span><span class="op" id="4373254">(</span><span class="op" id="4373255">[</span><span class="op" id="4373256">]</span><span class="builtintype" id="4373257">int32</span><span class="op" id="4373262">,</span>&nbsp;<span class="ident" id="4373264">maxLit</span><span class="op" id="4373270">)</span><span class="op" id="4373271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373275">offsetFreq</span><span class="op" id="4373285">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4373292">make</span><span class="op" id="4373296">(</span><span class="op" id="4373297">[</span><span class="op" id="4373298">]</span><span class="builtintype" id="4373299">int32</span><span class="op" id="4373304">,</span>&nbsp;<span class="ident" id="4373306">offsetCodeCount</span><span class="op" id="4373321">)</span><span class="op" id="4373322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373326">codegen</span><span class="op" id="4373333">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4373343">make</span><span class="op" id="4373347">(</span><span class="op" id="4373348">[</span><span class="op" id="4373349">]</span><span class="builtintype" id="4373350">uint8</span><span class="op" id="4373355">,</span>&nbsp;<span class="ident" id="4373357">maxLit</span><span class="op" id="4373363">+</span><span class="ident" id="4373364">offsetCodeCount</span><span class="op" id="4373379">+</span><span class="num" id="4373380">1</span><span class="op" id="4373381">)</span><span class="op" id="4373382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373386">codegenFreq</span><span class="op" id="4373397">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4373403">make</span><span class="op" id="4373407">(</span><span class="op" id="4373408">[</span><span class="op" id="4373409">]</span><span class="builtintype" id="4373410">int32</span><span class="op" id="4373415">,</span>&nbsp;<span class="ident" id="4373417">codegenCodeCount</span><span class="op" id="4373433">)</span><span class="op" id="4373434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373438">literalEncoding</span><span class="op" id="4373453">:</span>&nbsp;<span class="ident" id="4373455">newHuffmanEncoder</span><span class="op" id="4373472">(</span><span class="ident" id="4373473">maxLit</span><span class="op" id="4373479">)</span><span class="op" id="4373480">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373484">offsetEncoding</span><span class="op" id="4373498">:</span>&nbsp;&nbsp;<span class="ident" id="4373501">newHuffmanEncoder</span><span class="op" id="4373518">(</span><span class="ident" id="4373519">offsetCodeCount</span><span class="op" id="4373534">)</span><span class="op" id="4373535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373539">codegenEncoding</span><span class="op" id="4373554">:</span>&nbsp;<span class="ident" id="4373556">newHuffmanEncoder</span><span class="op" id="4373573">(</span><span class="ident" id="4373574">codegenCodeCount</span><span class="op" id="4373590">)</span><span class="op" id="4373591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4373594">}</span><br>
<span class="lineno"></span><span class="op" id="4373596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4373599">func</span>&nbsp;<span class="op" id="4373604">(</span><span class="ident" id="4373605">w</span>&nbsp;<span class="op" id="4373607">*</span><span class="ident" id="4373608">huffmanBitWriter</span><span class="op" id="4373624">)</span>&nbsp;<span class="ident" id="4373626">reset</span><span class="op" id="4373631">(</span><span class="ident" id="4373632">writer</span>&nbsp;<span class="ident" id="4373639">io</span><span class="op" id="4373641">.</span><span class="ident" id="4373642">Writer</span><span class="op" id="4373648">)</span>&nbsp;<span class="op" id="4373650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373653">w</span><span class="op" id="4373654">.</span><span class="ident" id="4373655">w</span>&nbsp;<span class="op" id="4373657">=</span>&nbsp;<span class="ident" id="4373659">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373667">w</span><span class="op" id="4373668">.</span><span class="ident" id="4373669">bits</span><span class="op" id="4373673">,</span>&nbsp;<span class="ident" id="4373675">w</span><span class="op" id="4373676">.</span><span class="ident" id="4373677">nbits</span><span class="op" id="4373682">,</span>&nbsp;<span class="ident" id="4373684">w</span><span class="op" id="4373685">.</span><span class="ident" id="4373686">nbytes</span><span class="op" id="4373692">,</span>&nbsp;<span class="ident" id="4373694">w</span><span class="op" id="4373695">.</span><span class="ident" id="4373696">err</span>&nbsp;<span class="op" id="4373700">=</span>&nbsp;<span class="num" id="4373702">0</span><span class="op" id="4373703">,</span>&nbsp;<span class="num" id="4373705">0</span><span class="op" id="4373706">,</span>&nbsp;<span class="num" id="4373708">0</span><span class="op" id="4373709">,</span>&nbsp;<span class="ident" id="4373711">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373716">w</span><span class="op" id="4373717">.</span><span class="ident" id="4373718">bytes</span>&nbsp;<span class="op" id="4373724">=</span>&nbsp;<span class="op" id="4373726">[</span><span class="num" id="4373727">64</span><span class="op" id="4373729">]</span><span class="builtintype" id="4373730">byte</span><span class="op" id="4373734">{</span><span class="op" id="4373735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4373738">for</span>&nbsp;<span class="ident" id="4373742">i</span>&nbsp;<span class="op" id="4373744">:=</span>&nbsp;<span class="keyword" id="4373747">range</span>&nbsp;<span class="ident" id="4373753">w</span><span class="op" id="4373754">.</span><span class="ident" id="4373755">codegen</span>&nbsp;<span class="op" id="4373763">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373767">w</span><span class="op" id="4373768">.</span><span class="ident" id="4373769">codegen</span><span class="op" id="4373776">[</span><span class="ident" id="4373777">i</span><span class="op" id="4373778">]</span>&nbsp;<span class="op" id="4373780">=</span>&nbsp;<span class="num" id="4373782">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4373785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4373788">for</span>&nbsp;<span class="ident" id="4373792">_</span><span class="op" id="4373793">,</span>&nbsp;<span class="ident" id="4373795">s</span>&nbsp;<span class="op" id="4373797">:=</span>&nbsp;<span class="keyword" id="4373800">range</span>&nbsp;<span class="op" id="4373806">[</span><span class="op" id="4373807">...</span><span class="op" id="4373810">]</span><span class="op" id="4373811">[</span><span class="op" id="4373812">]</span><span class="builtintype" id="4373813">int32</span><span class="op" id="4373818">{</span><span class="ident" id="4373819">w</span><span class="op" id="4373820">.</span><span class="ident" id="4373821">literalFreq</span><span class="op" id="4373832">,</span>&nbsp;<span class="ident" id="4373834">w</span><span class="op" id="4373835">.</span><span class="ident" id="4373836">offsetFreq</span><span class="op" id="4373846">,</span>&nbsp;<span class="ident" id="4373848">w</span><span class="op" id="4373849">.</span><span class="ident" id="4373850">codegenFreq</span><span class="op" id="4373861">}</span>&nbsp;<span class="op" id="4373863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4373867">for</span>&nbsp;<span class="ident" id="4373871">i</span>&nbsp;<span class="op" id="4373873">:=</span>&nbsp;<span class="keyword" id="4373876">range</span>&nbsp;<span class="ident" id="4373882">s</span>&nbsp;<span class="op" id="4373884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373889">s</span><span class="op" id="4373890">[</span><span class="ident" id="4373891">i</span><span class="op" id="4373892">]</span>&nbsp;<span class="op" id="4373894">=</span>&nbsp;<span class="num" id="4373896">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4373900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4373903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4373906">for</span>&nbsp;<span class="ident" id="4373910">_</span><span class="op" id="4373911">,</span>&nbsp;<span class="ident" id="4373913">enc</span>&nbsp;<span class="op" id="4373917">:=</span>&nbsp;<span class="keyword" id="4373920">range</span>&nbsp;<span class="op" id="4373926">[</span><span class="op" id="4373927">...</span><span class="op" id="4373930">]</span><span class="op" id="4373931">*</span><span class="ident" id="4373932">huffmanEncoder</span><span class="op" id="4373946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373950">w</span><span class="op" id="4373951">.</span><span class="ident" id="4373952">literalEncoding</span><span class="op" id="4373967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373971">w</span><span class="op" id="4373972">.</span><span class="ident" id="4373973">offsetEncoding</span><span class="op" id="4373987">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4373991">w</span><span class="op" id="4373992">.</span><span class="ident" id="4373993">codegenEncoding</span><span class="op" id="4374008">}</span>&nbsp;<span class="op" id="4374010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374014">for</span>&nbsp;<span class="ident" id="4374018">i</span>&nbsp;<span class="op" id="4374020">:=</span>&nbsp;<span class="keyword" id="4374023">range</span>&nbsp;<span class="ident" id="4374029">enc</span><span class="op" id="4374032">.</span><span class="ident" id="4374033">code</span>&nbsp;<span class="op" id="4374038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374043">enc</span><span class="op" id="4374046">.</span><span class="ident" id="4374047">code</span><span class="op" id="4374051">[</span><span class="ident" id="4374052">i</span><span class="op" id="4374053">]</span>&nbsp;<span class="op" id="4374055">=</span>&nbsp;<span class="num" id="4374057">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4374061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374065">for</span>&nbsp;<span class="ident" id="4374069">i</span>&nbsp;<span class="op" id="4374071">:=</span>&nbsp;<span class="keyword" id="4374074">range</span>&nbsp;<span class="ident" id="4374080">enc</span><span class="op" id="4374083">.</span><span class="ident" id="4374084">codeBits</span>&nbsp;<span class="op" id="4374093">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374098">enc</span><span class="op" id="4374101">.</span><span class="ident" id="4374102">codeBits</span><span class="op" id="4374110">[</span><span class="ident" id="4374111">i</span><span class="op" id="4374112">]</span>&nbsp;<span class="op" id="4374114">=</span>&nbsp;<span class="num" id="4374116">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4374120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4374123">}</span><br>
<span class="lineno"></span><span class="op" id="4374125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4374128">func</span>&nbsp;<span class="op" id="4374133">(</span><span class="ident" id="4374134">w</span>&nbsp;<span class="op" id="4374136">*</span><span class="ident" id="4374137">huffmanBitWriter</span><span class="op" id="4374153">)</span>&nbsp;<span class="ident" id="4374155">flushBits</span><span class="op" id="4374164">(</span><span class="op" id="4374165">)</span>&nbsp;<span class="op" id="4374167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374170">if</span>&nbsp;<span class="ident" id="4374173">w</span><span class="op" id="4374174">.</span><span class="ident" id="4374175">err</span>&nbsp;<span class="op" id="4374179">!=</span>&nbsp;<span class="ident" id="4374182">nil</span>&nbsp;<span class="op" id="4374186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374190">w</span><span class="op" id="4374191">.</span><span class="ident" id="4374192">nbits</span>&nbsp;<span class="op" id="4374198">=</span>&nbsp;<span class="num" id="4374200">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374204">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4374212">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374215">bits</span>&nbsp;<span class="op" id="4374220">:=</span>&nbsp;<span class="ident" id="4374223">w</span><span class="op" id="4374224">.</span><span class="ident" id="4374225">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374231">w</span><span class="op" id="4374232">.</span><span class="ident" id="4374233">bits</span>&nbsp;<span class="op" id="4374238">&gt;&gt;=</span>&nbsp;<span class="num" id="4374242">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374246">w</span><span class="op" id="4374247">.</span><span class="ident" id="4374248">nbits</span>&nbsp;<span class="op" id="4374254">-=</span>&nbsp;<span class="num" id="4374257">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374261">n</span>&nbsp;<span class="op" id="4374263">:=</span>&nbsp;<span class="ident" id="4374266">w</span><span class="op" id="4374267">.</span><span class="ident" id="4374268">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374276">w</span><span class="op" id="4374277">.</span><span class="ident" id="4374278">bytes</span><span class="op" id="4374283">[</span><span class="ident" id="4374284">n</span><span class="op" id="4374285">]</span>&nbsp;<span class="op" id="4374287">=</span>&nbsp;<span class="builtintype" id="4374289">byte</span><span class="op" id="4374293">(</span><span class="ident" id="4374294">bits</span><span class="op" id="4374298">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374301">w</span><span class="op" id="4374302">.</span><span class="ident" id="4374303">bytes</span><span class="op" id="4374308">[</span><span class="ident" id="4374309">n</span><span class="op" id="4374310">+</span><span class="num" id="4374311">1</span><span class="op" id="4374312">]</span>&nbsp;<span class="op" id="4374314">=</span>&nbsp;<span class="builtintype" id="4374316">byte</span><span class="op" id="4374320">(</span><span class="ident" id="4374321">bits</span>&nbsp;<span class="op" id="4374326">&gt;&gt;</span>&nbsp;<span class="num" id="4374329">8</span><span class="op" id="4374330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374333">if</span>&nbsp;<span class="ident" id="4374336">n</span>&nbsp;<span class="op" id="4374338">+=</span>&nbsp;<span class="num" id="4374341">2</span><span class="op" id="4374342">;</span>&nbsp;<span class="ident" id="4374344">n</span>&nbsp;<span class="op" id="4374346">&gt;=</span>&nbsp;<span class="builtinfunc" id="4374349">len</span><span class="op" id="4374352">(</span><span class="ident" id="4374353">w</span><span class="op" id="4374354">.</span><span class="ident" id="4374355">bytes</span><span class="op" id="4374360">)</span>&nbsp;<span class="op" id="4374362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374366">_</span><span class="op" id="4374367">,</span>&nbsp;<span class="ident" id="4374369">w</span><span class="op" id="4374370">.</span><span class="ident" id="4374371">err</span>&nbsp;<span class="op" id="4374375">=</span>&nbsp;<span class="ident" id="4374377">w</span><span class="op" id="4374378">.</span><span class="ident" id="4374379">w</span><span class="op" id="4374380">.</span><span class="ident" id="4374381">Write</span><span class="op" id="4374386">(</span><span class="ident" id="4374387">w</span><span class="op" id="4374388">.</span><span class="ident" id="4374389">bytes</span><span class="op" id="4374394">[</span><span class="num" id="4374395">0</span><span class="op" id="4374396">:</span><span class="op" id="4374397">]</span><span class="op" id="4374398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374402">n</span>&nbsp;<span class="op" id="4374404">=</span>&nbsp;<span class="num" id="4374406">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4374409">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374412">w</span><span class="op" id="4374413">.</span><span class="ident" id="4374414">nbytes</span>&nbsp;<span class="op" id="4374421">=</span>&nbsp;<span class="ident" id="4374423">n</span><br>
<span class="lineno"></span><span class="op" id="4374425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4374428">func</span>&nbsp;<span class="op" id="4374433">(</span><span class="ident" id="4374434">w</span>&nbsp;<span class="op" id="4374436">*</span><span class="ident" id="4374437">huffmanBitWriter</span><span class="op" id="4374453">)</span>&nbsp;<span class="ident" id="4374455">flush</span><span class="op" id="4374460">(</span><span class="op" id="4374461">)</span>&nbsp;<span class="op" id="4374463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374466">if</span>&nbsp;<span class="ident" id="4374469">w</span><span class="op" id="4374470">.</span><span class="ident" id="4374471">err</span>&nbsp;<span class="op" id="4374475">!=</span>&nbsp;<span class="ident" id="4374478">nil</span>&nbsp;<span class="op" id="4374482">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374486">w</span><span class="op" id="4374487">.</span><span class="ident" id="4374488">nbits</span>&nbsp;<span class="op" id="4374494">=</span>&nbsp;<span class="num" id="4374496">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374500">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4374508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374511">n</span>&nbsp;<span class="op" id="4374513">:=</span>&nbsp;<span class="ident" id="4374516">w</span><span class="op" id="4374517">.</span><span class="ident" id="4374518">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374526">if</span>&nbsp;<span class="ident" id="4374529">w</span><span class="op" id="4374530">.</span><span class="ident" id="4374531">nbits</span>&nbsp;<span class="op" id="4374537">&gt;</span>&nbsp;<span class="num" id="4374539">8</span>&nbsp;<span class="op" id="4374541">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374545">w</span><span class="op" id="4374546">.</span><span class="ident" id="4374547">bytes</span><span class="op" id="4374552">[</span><span class="ident" id="4374553">n</span><span class="op" id="4374554">]</span>&nbsp;<span class="op" id="4374556">=</span>&nbsp;<span class="builtintype" id="4374558">byte</span><span class="op" id="4374562">(</span><span class="ident" id="4374563">w</span><span class="op" id="4374564">.</span><span class="ident" id="4374565">bits</span><span class="op" id="4374569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374573">w</span><span class="op" id="4374574">.</span><span class="ident" id="4374575">bits</span>&nbsp;<span class="op" id="4374580">&gt;&gt;=</span>&nbsp;<span class="num" id="4374584">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374588">w</span><span class="op" id="4374589">.</span><span class="ident" id="4374590">nbits</span>&nbsp;<span class="op" id="4374596">-=</span>&nbsp;<span class="num" id="4374599">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374603">n</span><span class="op" id="4374604">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4374608">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374611">if</span>&nbsp;<span class="ident" id="4374614">w</span><span class="op" id="4374615">.</span><span class="ident" id="4374616">nbits</span>&nbsp;<span class="op" id="4374622">&gt;</span>&nbsp;<span class="num" id="4374624">0</span>&nbsp;<span class="op" id="4374626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374630">w</span><span class="op" id="4374631">.</span><span class="ident" id="4374632">bytes</span><span class="op" id="4374637">[</span><span class="ident" id="4374638">n</span><span class="op" id="4374639">]</span>&nbsp;<span class="op" id="4374641">=</span>&nbsp;<span class="builtintype" id="4374643">byte</span><span class="op" id="4374647">(</span><span class="ident" id="4374648">w</span><span class="op" id="4374649">.</span><span class="ident" id="4374650">bits</span><span class="op" id="4374654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374658">w</span><span class="op" id="4374659">.</span><span class="ident" id="4374660">nbits</span>&nbsp;<span class="op" id="4374666">=</span>&nbsp;<span class="num" id="4374668">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374672">n</span><span class="op" id="4374673">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4374677">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374680">w</span><span class="op" id="4374681">.</span><span class="ident" id="4374682">bits</span>&nbsp;<span class="op" id="4374687">=</span>&nbsp;<span class="num" id="4374689">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374692">_</span><span class="op" id="4374693">,</span>&nbsp;<span class="ident" id="4374695">w</span><span class="op" id="4374696">.</span><span class="ident" id="4374697">err</span>&nbsp;<span class="op" id="4374701">=</span>&nbsp;<span class="ident" id="4374703">w</span><span class="op" id="4374704">.</span><span class="ident" id="4374705">w</span><span class="op" id="4374706">.</span><span class="ident" id="4374707">Write</span><span class="op" id="4374712">(</span><span class="ident" id="4374713">w</span><span class="op" id="4374714">.</span><span class="ident" id="4374715">bytes</span><span class="op" id="4374720">[</span><span class="num" id="4374721">0</span><span class="op" id="4374722">:</span><span class="ident" id="4374723">n</span><span class="op" id="4374724">]</span><span class="op" id="4374725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374728">w</span><span class="op" id="4374729">.</span><span class="ident" id="4374730">nbytes</span>&nbsp;<span class="op" id="4374737">=</span>&nbsp;<span class="num" id="4374739">0</span><br>
<span class="lineno"></span><span class="op" id="4374741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4374744">func</span>&nbsp;<span class="op" id="4374749">(</span><span class="ident" id="4374750">w</span>&nbsp;<span class="op" id="4374752">*</span><span class="ident" id="4374753">huffmanBitWriter</span><span class="op" id="4374769">)</span>&nbsp;<span class="ident" id="4374771">writeBits</span><span class="op" id="4374780">(</span><span class="ident" id="4374781">b</span><span class="op" id="4374782">,</span>&nbsp;<span class="ident" id="4374784">nb</span>&nbsp;<span class="builtintype" id="4374787">int32</span><span class="op" id="4374792">)</span>&nbsp;<span class="op" id="4374794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374797">w</span><span class="op" id="4374798">.</span><span class="ident" id="4374799">bits</span>&nbsp;<span class="op" id="4374804">|=</span>&nbsp;<span class="builtintype" id="4374807">uint32</span><span class="op" id="4374813">(</span><span class="ident" id="4374814">b</span><span class="op" id="4374815">)</span>&nbsp;<span class="op" id="4374817">&lt;&lt;</span>&nbsp;<span class="ident" id="4374820">w</span><span class="op" id="4374821">.</span><span class="ident" id="4374822">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374829">if</span>&nbsp;<span class="ident" id="4374832">w</span><span class="op" id="4374833">.</span><span class="ident" id="4374834">nbits</span>&nbsp;<span class="op" id="4374840">+=</span>&nbsp;<span class="builtintype" id="4374843">uint32</span><span class="op" id="4374849">(</span><span class="ident" id="4374850">nb</span><span class="op" id="4374852">)</span><span class="op" id="4374853">;</span>&nbsp;<span class="ident" id="4374855">w</span><span class="op" id="4374856">.</span><span class="ident" id="4374857">nbits</span>&nbsp;<span class="op" id="4374863">&gt;=</span>&nbsp;<span class="num" id="4374866">16</span>&nbsp;<span class="op" id="4374869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374873">w</span><span class="op" id="4374874">.</span><span class="ident" id="4374875">flushBits</span><span class="op" id="4374884">(</span><span class="op" id="4374885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4374888">}</span><br>
<span class="lineno">170</span><span class="op" id="4374890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4374893">func</span>&nbsp;<span class="op" id="4374898">(</span><span class="ident" id="4374899">w</span>&nbsp;<span class="op" id="4374901">*</span><span class="ident" id="4374902">huffmanBitWriter</span><span class="op" id="4374918">)</span>&nbsp;<span class="ident" id="4374920">writeBytes</span><span class="op" id="4374930">(</span><span class="ident" id="4374931">bytes</span>&nbsp;<span class="op" id="4374937">[</span><span class="op" id="4374938">]</span><span class="builtintype" id="4374939">byte</span><span class="op" id="4374943">)</span>&nbsp;<span class="op" id="4374945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374948">if</span>&nbsp;<span class="ident" id="4374951">w</span><span class="op" id="4374952">.</span><span class="ident" id="4374953">err</span>&nbsp;<span class="op" id="4374957">!=</span>&nbsp;<span class="ident" id="4374960">nil</span>&nbsp;<span class="op" id="4374964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374968">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4374976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4374979">n</span>&nbsp;<span class="op" id="4374981">:=</span>&nbsp;<span class="ident" id="4374984">w</span><span class="op" id="4374985">.</span><span class="ident" id="4374986">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4374994">if</span>&nbsp;<span class="ident" id="4374997">w</span><span class="op" id="4374998">.</span><span class="ident" id="4374999">nbits</span>&nbsp;<span class="op" id="4375005">==</span>&nbsp;<span class="num" id="4375008">8</span>&nbsp;<span class="op" id="4375010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4375014">w</span><span class="op" id="4375015">.</span><span class="ident" id="4375016">bytes</span><span class="op" id="4375021">[</span><span class="ident" id="4375022">n</span><span class="op" id="4375023">]</span>&nbsp;<span class="op" id="4375025">=</span>&nbsp;<span class="builtintype" id="4375027">byte</span><span class="op" id="4375031">(</span><span class="ident" id="4375032">w</span><span class="op" id="4375033">.</span><span class="ident" id="4375034">bits</span><span class="op" id="4375038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4375042">w</span><span class="op" id="4375043">.</span><span class="ident" id="4375044">nbits</span>&nbsp;<span class="op" id="4375050">=</span>&nbsp;<span class="num" id="4375052">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4375056">n</span><span class="op" id="4375057">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4375061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4375064">if</span>&nbsp;<span class="ident" id="4375067">w</span><span class="op" id="4375068">.</span><span class="ident" id="4375069">nbits</span>&nbsp;<span class="op" id="4375075">!=</span>&nbsp;<span class="num" id="4375078">0</span>&nbsp;<span class="op" id="4375080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4375084">w</span><span class="op" id="4375085">.</span><span class="ident" id="4375086">err</span>&nbsp;<span class="op" id="4375090">=</span>&nbsp;<span class="ident" id="4375092">InternalError</span><span class="op" id="4375105">(</span><span class="string" id="4375106">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="4375139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4375143">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4375151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4375154">if</span>&nbsp;<span class="ident" id="4375157">n</span>&nbsp;<span class="op" id="4375159">!=</span>&nbsp;<span class="num" id="4375162">0</span>&nbsp;<span class="op" id="4375164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4375168">_</span><span class="op" id="4375169">,</span>&nbsp;<span class="ident" id="4375171">w</span><span class="op" id="4375172">.</span><span class="ident" id="4375173">err</span>&nbsp;<span class="op" id="4375177">=</span>&nbsp;<span class="ident" id="4375179">w</span><span class="op" id="4375180">.</span><span class="ident" id="4375181">w</span><span class="op" id="4375182">.</span><span class="ident" id="4375183">Write</span><span class="op" id="4375188">(</span><span class="ident" id="4375189">w</span><span class="op" id="4375190">.</span><span class="ident" id="4375191">bytes</span><span class="op" id="4375196">[</span><span class="num" id="4375197">0</span><span class="op" id="4375198">:</span><span class="ident" id="4375199">n</span><span class="op" id="4375200">]</span><span class="op" id="4375201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4375205">if</span>&nbsp;<span class="ident" id="4375208">w</span><span class="op" id="4375209">.</span><span class="ident" id="4375210">err</span>&nbsp;<span class="op" id="4375214">!=</span>&nbsp;<span class="ident" id="4375217">nil</span>&nbsp;<span class="op" id="4375221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4375226">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4375235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4375238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4375241">w</span><span class="op" id="4375242">.</span><span class="ident" id="4375243">nbytes</span>&nbsp;<span class="op" id="4375250">=</span>&nbsp;<span class="num" id="4375252">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4375255">_</span><span class="op" id="4375256">,</span>&nbsp;<span class="ident" id="4375258">w</span><span class="op" id="4375259">.</span><span class="ident" id="4375260">err</span>&nbsp;<span class="op" id="4375264">=</span>&nbsp;<span class="ident" id="4375266">w</span><span class="op" id="4375267">.</span><span class="ident" id="4375268">w</span><span class="op" id="4375269">.</span><span class="ident" id="4375270">Write</span><span class="op" id="4375275">(</span><span class="ident" id="4375276">bytes</span><span class="op" id="4375281">)</span><br>
<span class="lineno"></span><span class="op" id="4375283">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4375286">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="4375359">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="4375438">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4375498">//</span><br>
<span class="lineno">200</span><span class="comment" id="4375501">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4375570">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4375625">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="4375701">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="4375748">//</span><br>
<span class="lineno">205</span><span class="comment" id="4375751">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4375814">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="4375875">func</span>&nbsp;<span class="op" id="4375880">(</span><span class="ident" id="4375881">w</span>&nbsp;<span class="op" id="4375883">*</span><span class="ident" id="4375884">huffmanBitWriter</span><span class="op" id="4375900">)</span>&nbsp;<span class="ident" id="4375902">generateCodegen</span><span class="op" id="4375917">(</span><span class="ident" id="4375918">numLiterals</span>&nbsp;<span class="builtintype" id="4375930">int</span><span class="op" id="4375933">,</span>&nbsp;<span class="ident" id="4375935">numOffsets</span>&nbsp;<span class="builtintype" id="4375946">int</span><span class="op" id="4375949">)</span>&nbsp;<span class="op" id="4375951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4375954">for</span>&nbsp;<span class="ident" id="4375958">i</span>&nbsp;<span class="op" id="4375960">:=</span>&nbsp;<span class="keyword" id="4375963">range</span>&nbsp;<span class="ident" id="4375969">w</span><span class="op" id="4375970">.</span><span class="ident" id="4375971">codegenFreq</span>&nbsp;<span class="op" id="4375983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4375987">w</span><span class="op" id="4375988">.</span><span class="ident" id="4375989">codegenFreq</span><span class="op" id="4376000">[</span><span class="ident" id="4376001">i</span><span class="op" id="4376002">]</span>&nbsp;<span class="op" id="4376004">=</span>&nbsp;<span class="num" id="4376006">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4376009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4376012">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4376088">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4376161">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4376235">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376247">codegen</span>&nbsp;<span class="op" id="4376255">:=</span>&nbsp;<span class="ident" id="4376258">w</span><span class="op" id="4376259">.</span><span class="ident" id="4376260">codegen</span>&nbsp;<span class="comment" id="4376268">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4376278">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4376353">copy</span><span class="op" id="4376357">(</span><span class="ident" id="4376358">codegen</span><span class="op" id="4376365">[</span><span class="num" id="4376366">0</span><span class="op" id="4376367">:</span><span class="ident" id="4376368">numLiterals</span><span class="op" id="4376379">]</span><span class="op" id="4376380">,</span>&nbsp;<span class="ident" id="4376382">w</span><span class="op" id="4376383">.</span><span class="ident" id="4376384">literalEncoding</span><span class="op" id="4376399">.</span><span class="ident" id="4376400">codeBits</span><span class="op" id="4376408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4376411">copy</span><span class="op" id="4376415">(</span><span class="ident" id="4376416">codegen</span><span class="op" id="4376423">[</span><span class="ident" id="4376424">numLiterals</span><span class="op" id="4376435">:</span><span class="ident" id="4376436">numLiterals</span><span class="op" id="4376447">+</span><span class="ident" id="4376448">numOffsets</span><span class="op" id="4376458">]</span><span class="op" id="4376459">,</span>&nbsp;<span class="ident" id="4376461">w</span><span class="op" id="4376462">.</span><span class="ident" id="4376463">offsetEncoding</span><span class="op" id="4376477">.</span><span class="ident" id="4376478">codeBits</span><span class="op" id="4376486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376489">codegen</span><span class="op" id="4376496">[</span><span class="ident" id="4376497">numLiterals</span><span class="op" id="4376508">+</span><span class="ident" id="4376509">numOffsets</span><span class="op" id="4376519">]</span>&nbsp;<span class="op" id="4376521">=</span>&nbsp;<span class="ident" id="4376523">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376533">size</span>&nbsp;<span class="op" id="4376538">:=</span>&nbsp;<span class="ident" id="4376541">codegen</span><span class="op" id="4376548">[</span><span class="num" id="4376549">0</span><span class="op" id="4376550">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376553">count</span>&nbsp;<span class="op" id="4376559">:=</span>&nbsp;<span class="num" id="4376562">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376565">outIndex</span>&nbsp;<span class="op" id="4376574">:=</span>&nbsp;<span class="num" id="4376577">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4376580">for</span>&nbsp;<span class="ident" id="4376584">inIndex</span>&nbsp;<span class="op" id="4376592">:=</span>&nbsp;<span class="num" id="4376595">1</span><span class="op" id="4376596">;</span>&nbsp;<span class="ident" id="4376598">size</span>&nbsp;<span class="op" id="4376603">!=</span>&nbsp;<span class="ident" id="4376606">badCode</span><span class="op" id="4376613">;</span>&nbsp;<span class="ident" id="4376615">inIndex</span><span class="op" id="4376622">++</span>&nbsp;<span class="op" id="4376625">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4376629">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4376699">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376735">nextSize</span>&nbsp;<span class="op" id="4376744">:=</span>&nbsp;<span class="ident" id="4376747">codegen</span><span class="op" id="4376754">[</span><span class="ident" id="4376755">inIndex</span><span class="op" id="4376762">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4376766">if</span>&nbsp;<span class="ident" id="4376769">nextSize</span>&nbsp;<span class="op" id="4376778">==</span>&nbsp;<span class="ident" id="4376781">size</span>&nbsp;<span class="op" id="4376786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376791">count</span><span class="op" id="4376796">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4376802">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4376813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4376817">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4376878">if</span>&nbsp;<span class="ident" id="4376881">size</span>&nbsp;<span class="op" id="4376886">!=</span>&nbsp;<span class="num" id="4376889">0</span>&nbsp;<span class="op" id="4376891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376896">codegen</span><span class="op" id="4376903">[</span><span class="ident" id="4376904">outIndex</span><span class="op" id="4376912">]</span>&nbsp;<span class="op" id="4376914">=</span>&nbsp;<span class="ident" id="4376916">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376924">outIndex</span><span class="op" id="4376932">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376938">w</span><span class="op" id="4376939">.</span><span class="ident" id="4376940">codegenFreq</span><span class="op" id="4376951">[</span><span class="ident" id="4376952">size</span><span class="op" id="4376956">]</span><span class="op" id="4376957">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376963">count</span><span class="op" id="4376968">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4376974">for</span>&nbsp;<span class="ident" id="4376978">count</span>&nbsp;<span class="op" id="4376984">&gt;=</span>&nbsp;<span class="num" id="4376987">3</span>&nbsp;<span class="op" id="4376989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4376995">n</span>&nbsp;<span class="op" id="4376997">:=</span>&nbsp;<span class="num" id="4377000">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4377006">if</span>&nbsp;<span class="ident" id="4377009">n</span>&nbsp;<span class="op" id="4377011">&gt;</span>&nbsp;<span class="ident" id="4377013">count</span>&nbsp;<span class="op" id="4377019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377026">n</span>&nbsp;<span class="op" id="4377028">=</span>&nbsp;<span class="ident" id="4377030">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4377040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377046">codegen</span><span class="op" id="4377053">[</span><span class="ident" id="4377054">outIndex</span><span class="op" id="4377062">]</span>&nbsp;<span class="op" id="4377064">=</span>&nbsp;<span class="num" id="4377066">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377073">outIndex</span><span class="op" id="4377081">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377088">codegen</span><span class="op" id="4377095">[</span><span class="ident" id="4377096">outIndex</span><span class="op" id="4377104">]</span>&nbsp;<span class="op" id="4377106">=</span>&nbsp;<span class="builtintype" id="4377108">uint8</span><span class="op" id="4377113">(</span><span class="ident" id="4377114">n</span>&nbsp;<span class="op" id="4377116">-</span>&nbsp;<span class="num" id="4377118">3</span><span class="op" id="4377119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377125">outIndex</span><span class="op" id="4377133">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377140">w</span><span class="op" id="4377141">.</span><span class="ident" id="4377142">codegenFreq</span><span class="op" id="4377153">[</span><span class="num" id="4377154">16</span><span class="op" id="4377156">]</span><span class="op" id="4377157">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377164">count</span>&nbsp;<span class="op" id="4377170">-=</span>&nbsp;<span class="ident" id="4377173">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4377178">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4377182">}</span>&nbsp;<span class="keyword" id="4377184">else</span>&nbsp;<span class="op" id="4377189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4377194">for</span>&nbsp;<span class="ident" id="4377198">count</span>&nbsp;<span class="op" id="4377204">&gt;=</span>&nbsp;<span class="num" id="4377207">11</span>&nbsp;<span class="op" id="4377210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377216">n</span>&nbsp;<span class="op" id="4377218">:=</span>&nbsp;<span class="num" id="4377221">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4377229">if</span>&nbsp;<span class="ident" id="4377232">n</span>&nbsp;<span class="op" id="4377234">&gt;</span>&nbsp;<span class="ident" id="4377236">count</span>&nbsp;<span class="op" id="4377242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377249">n</span>&nbsp;<span class="op" id="4377251">=</span>&nbsp;<span class="ident" id="4377253">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4377263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377269">codegen</span><span class="op" id="4377276">[</span><span class="ident" id="4377277">outIndex</span><span class="op" id="4377285">]</span>&nbsp;<span class="op" id="4377287">=</span>&nbsp;<span class="num" id="4377289">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377296">outIndex</span><span class="op" id="4377304">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377311">codegen</span><span class="op" id="4377318">[</span><span class="ident" id="4377319">outIndex</span><span class="op" id="4377327">]</span>&nbsp;<span class="op" id="4377329">=</span>&nbsp;<span class="builtintype" id="4377331">uint8</span><span class="op" id="4377336">(</span><span class="ident" id="4377337">n</span>&nbsp;<span class="op" id="4377339">-</span>&nbsp;<span class="num" id="4377341">11</span><span class="op" id="4377343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377349">outIndex</span><span class="op" id="4377357">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377364">w</span><span class="op" id="4377365">.</span><span class="ident" id="4377366">codegenFreq</span><span class="op" id="4377377">[</span><span class="num" id="4377378">18</span><span class="op" id="4377380">]</span><span class="op" id="4377381">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377388">count</span>&nbsp;<span class="op" id="4377394">-=</span>&nbsp;<span class="ident" id="4377397">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4377402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4377407">if</span>&nbsp;<span class="ident" id="4377410">count</span>&nbsp;<span class="op" id="4377416">&gt;=</span>&nbsp;<span class="num" id="4377419">3</span>&nbsp;<span class="op" id="4377421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4377427">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377460">codegen</span><span class="op" id="4377467">[</span><span class="ident" id="4377468">outIndex</span><span class="op" id="4377476">]</span>&nbsp;<span class="op" id="4377478">=</span>&nbsp;<span class="num" id="4377480">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377487">outIndex</span><span class="op" id="4377495">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377502">codegen</span><span class="op" id="4377509">[</span><span class="ident" id="4377510">outIndex</span><span class="op" id="4377518">]</span>&nbsp;<span class="op" id="4377520">=</span>&nbsp;<span class="builtintype" id="4377522">uint8</span><span class="op" id="4377527">(</span><span class="ident" id="4377528">count</span>&nbsp;<span class="op" id="4377534">-</span>&nbsp;<span class="num" id="4377536">3</span><span class="op" id="4377537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377543">outIndex</span><span class="op" id="4377551">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377558">w</span><span class="op" id="4377559">.</span><span class="ident" id="4377560">codegenFreq</span><span class="op" id="4377571">[</span><span class="num" id="4377572">17</span><span class="op" id="4377574">]</span><span class="op" id="4377575">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377582">count</span>&nbsp;<span class="op" id="4377588">=</span>&nbsp;<span class="num" id="4377590">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4377595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4377599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377603">count</span><span class="op" id="4377608">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4377613">for</span>&nbsp;<span class="op" id="4377617">;</span>&nbsp;<span class="ident" id="4377619">count</span>&nbsp;<span class="op" id="4377625">&gt;=</span>&nbsp;<span class="num" id="4377628">0</span><span class="op" id="4377629">;</span>&nbsp;<span class="ident" id="4377631">count</span><span class="op" id="4377636">--</span>&nbsp;<span class="op" id="4377639">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377644">codegen</span><span class="op" id="4377651">[</span><span class="ident" id="4377652">outIndex</span><span class="op" id="4377660">]</span>&nbsp;<span class="op" id="4377662">=</span>&nbsp;<span class="ident" id="4377664">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377672">outIndex</span><span class="op" id="4377680">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377686">w</span><span class="op" id="4377687">.</span><span class="ident" id="4377688">codegenFreq</span><span class="op" id="4377699">[</span><span class="ident" id="4377700">size</span><span class="op" id="4377704">]</span><span class="op" id="4377705">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4377710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4377714">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377768">size</span>&nbsp;<span class="op" id="4377773">=</span>&nbsp;<span class="ident" id="4377775">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377786">count</span>&nbsp;<span class="op" id="4377792">=</span>&nbsp;<span class="num" id="4377794">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4377797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4377800">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377846">codegen</span><span class="op" id="4377853">[</span><span class="ident" id="4377854">outIndex</span><span class="op" id="4377862">]</span>&nbsp;<span class="op" id="4377864">=</span>&nbsp;<span class="ident" id="4377866">badCode</span><br>
<span class="lineno">285</span><span class="op" id="4377874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4377877">func</span>&nbsp;<span class="op" id="4377882">(</span><span class="ident" id="4377883">w</span>&nbsp;<span class="op" id="4377885">*</span><span class="ident" id="4377886">huffmanBitWriter</span><span class="op" id="4377902">)</span>&nbsp;<span class="ident" id="4377904">writeCode</span><span class="op" id="4377913">(</span><span class="ident" id="4377914">code</span>&nbsp;<span class="op" id="4377919">*</span><span class="ident" id="4377920">huffmanEncoder</span><span class="op" id="4377934">,</span>&nbsp;<span class="ident" id="4377936">literal</span>&nbsp;<span class="builtintype" id="4377944">uint32</span><span class="op" id="4377950">)</span>&nbsp;<span class="op" id="4377952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4377955">if</span>&nbsp;<span class="ident" id="4377958">w</span><span class="op" id="4377959">.</span><span class="ident" id="4377960">err</span>&nbsp;<span class="op" id="4377964">!=</span>&nbsp;<span class="ident" id="4377967">nil</span>&nbsp;<span class="op" id="4377971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4377975">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4377983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4377986">w</span><span class="op" id="4377987">.</span><span class="ident" id="4377988">writeBits</span><span class="op" id="4377997">(</span><span class="builtintype" id="4377998">int32</span><span class="op" id="4378003">(</span><span class="ident" id="4378004">code</span><span class="op" id="4378008">.</span><span class="ident" id="4378009">code</span><span class="op" id="4378013">[</span><span class="ident" id="4378014">literal</span><span class="op" id="4378021">]</span><span class="op" id="4378022">)</span><span class="op" id="4378023">,</span>&nbsp;<span class="builtintype" id="4378025">int32</span><span class="op" id="4378030">(</span><span class="ident" id="4378031">code</span><span class="op" id="4378035">.</span><span class="ident" id="4378036">codeBits</span><span class="op" id="4378044">[</span><span class="ident" id="4378045">literal</span><span class="op" id="4378052">]</span><span class="op" id="4378053">)</span><span class="op" id="4378054">)</span><br>
<span class="lineno"></span><span class="op" id="4378056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4378059">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="4378128">//</span><br>
<span class="lineno"></span><span class="comment" id="4378131">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4378192">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4378252">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="4378308">func</span>&nbsp;<span class="op" id="4378313">(</span><span class="ident" id="4378314">w</span>&nbsp;<span class="op" id="4378316">*</span><span class="ident" id="4378317">huffmanBitWriter</span><span class="op" id="4378333">)</span>&nbsp;<span class="ident" id="4378335">writeDynamicHeader</span><span class="op" id="4378353">(</span><span class="ident" id="4378354">numLiterals</span>&nbsp;<span class="builtintype" id="4378366">int</span><span class="op" id="4378369">,</span>&nbsp;<span class="ident" id="4378371">numOffsets</span>&nbsp;<span class="builtintype" id="4378382">int</span><span class="op" id="4378385">,</span>&nbsp;<span class="ident" id="4378387">numCodegens</span>&nbsp;<span class="builtintype" id="4378399">int</span><span class="op" id="4378402">,</span>&nbsp;<span class="ident" id="4378404">isEof</span>&nbsp;<span class="builtintype" id="4378410">bool</span><span class="op" id="4378414">)</span>&nbsp;<span class="op" id="4378416">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4378419">if</span>&nbsp;<span class="ident" id="4378422">w</span><span class="op" id="4378423">.</span><span class="ident" id="4378424">err</span>&nbsp;<span class="op" id="4378428">!=</span>&nbsp;<span class="ident" id="4378431">nil</span>&nbsp;<span class="op" id="4378435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4378439">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4378447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4378450">var</span>&nbsp;<span class="ident" id="4378454">firstBits</span>&nbsp;<span class="builtintype" id="4378464">int32</span>&nbsp;<span class="op" id="4378470">=</span>&nbsp;<span class="num" id="4378472">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4378475">if</span>&nbsp;<span class="ident" id="4378478">isEof</span>&nbsp;<span class="op" id="4378484">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4378488">firstBits</span>&nbsp;<span class="op" id="4378498">=</span>&nbsp;<span class="num" id="4378500">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4378503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4378506">w</span><span class="op" id="4378507">.</span><span class="ident" id="4378508">writeBits</span><span class="op" id="4378517">(</span><span class="ident" id="4378518">firstBits</span><span class="op" id="4378527">,</span>&nbsp;<span class="num" id="4378529">3</span><span class="op" id="4378530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4378533">w</span><span class="op" id="4378534">.</span><span class="ident" id="4378535">writeBits</span><span class="op" id="4378544">(</span><span class="builtintype" id="4378545">int32</span><span class="op" id="4378550">(</span><span class="ident" id="4378551">numLiterals</span><span class="op" id="4378562">-</span><span class="num" id="4378563">257</span><span class="op" id="4378566">)</span><span class="op" id="4378567">,</span>&nbsp;<span class="num" id="4378569">5</span><span class="op" id="4378570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4378573">w</span><span class="op" id="4378574">.</span><span class="ident" id="4378575">writeBits</span><span class="op" id="4378584">(</span><span class="builtintype" id="4378585">int32</span><span class="op" id="4378590">(</span><span class="ident" id="4378591">numOffsets</span><span class="op" id="4378601">-</span><span class="num" id="4378602">1</span><span class="op" id="4378603">)</span><span class="op" id="4378604">,</span>&nbsp;<span class="num" id="4378606">5</span><span class="op" id="4378607">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4378610">w</span><span class="op" id="4378611">.</span><span class="ident" id="4378612">writeBits</span><span class="op" id="4378621">(</span><span class="builtintype" id="4378622">int32</span><span class="op" id="4378627">(</span><span class="ident" id="4378628">numCodegens</span><span class="op" id="4378639">-</span><span class="num" id="4378640">4</span><span class="op" id="4378641">)</span><span class="op" id="4378642">,</span>&nbsp;<span class="num" id="4378644">4</span><span class="op" id="4378645">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4378649">for</span>&nbsp;<span class="ident" id="4378653">i</span>&nbsp;<span class="op" id="4378655">:=</span>&nbsp;<span class="num" id="4378658">0</span><span class="op" id="4378659">;</span>&nbsp;<span class="ident" id="4378661">i</span>&nbsp;<span class="op" id="4378663">&lt;</span>&nbsp;<span class="ident" id="4378665">numCodegens</span><span class="op" id="4378676">;</span>&nbsp;<span class="ident" id="4378678">i</span><span class="op" id="4378679">++</span>&nbsp;<span class="op" id="4378682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4378686">value</span>&nbsp;<span class="op" id="4378692">:=</span>&nbsp;<span class="ident" id="4378695">w</span><span class="op" id="4378696">.</span><span class="ident" id="4378697">codegenEncoding</span><span class="op" id="4378712">.</span><span class="ident" id="4378713">codeBits</span><span class="op" id="4378721">[</span><span class="ident" id="4378722">codegenOrder</span><span class="op" id="4378734">[</span><span class="ident" id="4378735">i</span><span class="op" id="4378736">]</span><span class="op" id="4378737">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4378741">w</span><span class="op" id="4378742">.</span><span class="ident" id="4378743">writeBits</span><span class="op" id="4378752">(</span><span class="builtintype" id="4378753">int32</span><span class="op" id="4378758">(</span><span class="ident" id="4378759">value</span><span class="op" id="4378764">)</span><span class="op" id="4378765">,</span>&nbsp;<span class="num" id="4378767">3</span><span class="op" id="4378768">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4378771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4378775">i</span>&nbsp;<span class="op" id="4378777">:=</span>&nbsp;<span class="num" id="4378780">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4378783">for</span>&nbsp;<span class="op" id="4378787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4378791">var</span>&nbsp;<span class="ident" id="4378795">codeWord</span>&nbsp;<span class="builtintype" id="4378804">int</span>&nbsp;<span class="op" id="4378808">=</span>&nbsp;<span class="builtintype" id="4378810">int</span><span class="op" id="4378813">(</span><span class="ident" id="4378814">w</span><span class="op" id="4378815">.</span><span class="ident" id="4378816">codegen</span><span class="op" id="4378823">[</span><span class="ident" id="4378824">i</span><span class="op" id="4378825">]</span><span class="op" id="4378826">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4378830">i</span><span class="op" id="4378831">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4378836">if</span>&nbsp;<span class="ident" id="4378839">codeWord</span>&nbsp;<span class="op" id="4378848">==</span>&nbsp;<span class="ident" id="4378851">badCode</span>&nbsp;<span class="op" id="4378859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4378864">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4378872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4378876">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4378932">w</span><span class="op" id="4378933">.</span><span class="ident" id="4378934">writeCode</span><span class="op" id="4378943">(</span><span class="ident" id="4378944">w</span><span class="op" id="4378945">.</span><span class="ident" id="4378946">codegenEncoding</span><span class="op" id="4378961">,</span>&nbsp;<span class="builtintype" id="4378963">uint32</span><span class="op" id="4378969">(</span><span class="ident" id="4378970">codeWord</span><span class="op" id="4378978">)</span><span class="op" id="4378979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4378984">switch</span>&nbsp;<span class="ident" id="4378991">codeWord</span>&nbsp;<span class="op" id="4379000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379004">case</span>&nbsp;<span class="num" id="4379009">16</span><span class="op" id="4379011">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379016">w</span><span class="op" id="4379017">.</span><span class="ident" id="4379018">writeBits</span><span class="op" id="4379027">(</span><span class="builtintype" id="4379028">int32</span><span class="op" id="4379033">(</span><span class="ident" id="4379034">w</span><span class="op" id="4379035">.</span><span class="ident" id="4379036">codegen</span><span class="op" id="4379043">[</span><span class="ident" id="4379044">i</span><span class="op" id="4379045">]</span><span class="op" id="4379046">)</span><span class="op" id="4379047">,</span>&nbsp;<span class="num" id="4379049">2</span><span class="op" id="4379050">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379055">i</span><span class="op" id="4379056">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379062">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379070">case</span>&nbsp;<span class="num" id="4379075">17</span><span class="op" id="4379077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379082">w</span><span class="op" id="4379083">.</span><span class="ident" id="4379084">writeBits</span><span class="op" id="4379093">(</span><span class="builtintype" id="4379094">int32</span><span class="op" id="4379099">(</span><span class="ident" id="4379100">w</span><span class="op" id="4379101">.</span><span class="ident" id="4379102">codegen</span><span class="op" id="4379109">[</span><span class="ident" id="4379110">i</span><span class="op" id="4379111">]</span><span class="op" id="4379112">)</span><span class="op" id="4379113">,</span>&nbsp;<span class="num" id="4379115">3</span><span class="op" id="4379116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379121">i</span><span class="op" id="4379122">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379128">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379136">case</span>&nbsp;<span class="num" id="4379141">18</span><span class="op" id="4379143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379148">w</span><span class="op" id="4379149">.</span><span class="ident" id="4379150">writeBits</span><span class="op" id="4379159">(</span><span class="builtintype" id="4379160">int32</span><span class="op" id="4379165">(</span><span class="ident" id="4379166">w</span><span class="op" id="4379167">.</span><span class="ident" id="4379168">codegen</span><span class="op" id="4379175">[</span><span class="ident" id="4379176">i</span><span class="op" id="4379177">]</span><span class="op" id="4379178">)</span><span class="op" id="4379179">,</span>&nbsp;<span class="num" id="4379181">7</span><span class="op" id="4379182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379187">i</span><span class="op" id="4379188">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379194">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4379202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4379205">}</span><br>
<span class="lineno"></span><span class="op" id="4379207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4379210">func</span>&nbsp;<span class="op" id="4379215">(</span><span class="ident" id="4379216">w</span>&nbsp;<span class="op" id="4379218">*</span><span class="ident" id="4379219">huffmanBitWriter</span><span class="op" id="4379235">)</span>&nbsp;<span class="ident" id="4379237">writeStoredHeader</span><span class="op" id="4379254">(</span><span class="ident" id="4379255">length</span>&nbsp;<span class="builtintype" id="4379262">int</span><span class="op" id="4379265">,</span>&nbsp;<span class="ident" id="4379267">isEof</span>&nbsp;<span class="builtintype" id="4379273">bool</span><span class="op" id="4379277">)</span>&nbsp;<span class="op" id="4379279">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379282">if</span>&nbsp;<span class="ident" id="4379285">w</span><span class="op" id="4379286">.</span><span class="ident" id="4379287">err</span>&nbsp;<span class="op" id="4379291">!=</span>&nbsp;<span class="ident" id="4379294">nil</span>&nbsp;<span class="op" id="4379298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379302">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4379310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379313">var</span>&nbsp;<span class="ident" id="4379317">flag</span>&nbsp;<span class="builtintype" id="4379322">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379329">if</span>&nbsp;<span class="ident" id="4379332">isEof</span>&nbsp;<span class="op" id="4379338">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379342">flag</span>&nbsp;<span class="op" id="4379347">=</span>&nbsp;<span class="num" id="4379349">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4379352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379355">w</span><span class="op" id="4379356">.</span><span class="ident" id="4379357">writeBits</span><span class="op" id="4379366">(</span><span class="ident" id="4379367">flag</span><span class="op" id="4379371">,</span>&nbsp;<span class="num" id="4379373">3</span><span class="op" id="4379374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379377">w</span><span class="op" id="4379378">.</span><span class="ident" id="4379379">flush</span><span class="op" id="4379384">(</span><span class="op" id="4379385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379388">w</span><span class="op" id="4379389">.</span><span class="ident" id="4379390">writeBits</span><span class="op" id="4379399">(</span><span class="builtintype" id="4379400">int32</span><span class="op" id="4379405">(</span><span class="ident" id="4379406">length</span><span class="op" id="4379412">)</span><span class="op" id="4379413">,</span>&nbsp;<span class="num" id="4379415">16</span><span class="op" id="4379417">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379420">w</span><span class="op" id="4379421">.</span><span class="ident" id="4379422">writeBits</span><span class="op" id="4379431">(</span><span class="builtintype" id="4379432">int32</span><span class="op" id="4379437">(</span><span class="op" id="4379438">^</span><span class="builtintype" id="4379439">uint16</span><span class="op" id="4379445">(</span><span class="ident" id="4379446">length</span><span class="op" id="4379452">)</span><span class="op" id="4379453">)</span><span class="op" id="4379454">,</span>&nbsp;<span class="num" id="4379456">16</span><span class="op" id="4379458">)</span><br>
<span class="lineno"></span><span class="op" id="4379460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4379463">func</span>&nbsp;<span class="op" id="4379468">(</span><span class="ident" id="4379469">w</span>&nbsp;<span class="op" id="4379471">*</span><span class="ident" id="4379472">huffmanBitWriter</span><span class="op" id="4379488">)</span>&nbsp;<span class="ident" id="4379490">writeFixedHeader</span><span class="op" id="4379506">(</span><span class="ident" id="4379507">isEof</span>&nbsp;<span class="builtintype" id="4379513">bool</span><span class="op" id="4379517">)</span>&nbsp;<span class="op" id="4379519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379522">if</span>&nbsp;<span class="ident" id="4379525">w</span><span class="op" id="4379526">.</span><span class="ident" id="4379527">err</span>&nbsp;<span class="op" id="4379531">!=</span>&nbsp;<span class="ident" id="4379534">nil</span>&nbsp;<span class="op" id="4379538">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379542">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4379550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4379553">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379600">var</span>&nbsp;<span class="ident" id="4379604">value</span>&nbsp;<span class="builtintype" id="4379610">int32</span>&nbsp;<span class="op" id="4379616">=</span>&nbsp;<span class="num" id="4379618">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379621">if</span>&nbsp;<span class="ident" id="4379624">isEof</span>&nbsp;<span class="op" id="4379630">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379634">value</span>&nbsp;<span class="op" id="4379640">=</span>&nbsp;<span class="num" id="4379642">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4379645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379648">w</span><span class="op" id="4379649">.</span><span class="ident" id="4379650">writeBits</span><span class="op" id="4379659">(</span><span class="ident" id="4379660">value</span><span class="op" id="4379665">,</span>&nbsp;<span class="num" id="4379667">3</span><span class="op" id="4379668">)</span><br>
<span class="lineno"></span><span class="op" id="4379670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="4379673">func</span>&nbsp;<span class="op" id="4379678">(</span><span class="ident" id="4379679">w</span>&nbsp;<span class="op" id="4379681">*</span><span class="ident" id="4379682">huffmanBitWriter</span><span class="op" id="4379698">)</span>&nbsp;<span class="ident" id="4379700">writeBlock</span><span class="op" id="4379710">(</span><span class="ident" id="4379711">tokens</span>&nbsp;<span class="op" id="4379718">[</span><span class="op" id="4379719">]</span><span class="ident" id="4379720">token</span><span class="op" id="4379725">,</span>&nbsp;<span class="ident" id="4379727">eof</span>&nbsp;<span class="builtintype" id="4379731">bool</span><span class="op" id="4379735">,</span>&nbsp;<span class="ident" id="4379737">input</span>&nbsp;<span class="op" id="4379743">[</span><span class="op" id="4379744">]</span><span class="builtintype" id="4379745">byte</span><span class="op" id="4379749">)</span>&nbsp;<span class="op" id="4379751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379754">if</span>&nbsp;<span class="ident" id="4379757">w</span><span class="op" id="4379758">.</span><span class="ident" id="4379759">err</span>&nbsp;<span class="op" id="4379763">!=</span>&nbsp;<span class="ident" id="4379766">nil</span>&nbsp;<span class="op" id="4379770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379774">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4379782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379785">for</span>&nbsp;<span class="ident" id="4379789">i</span>&nbsp;<span class="op" id="4379791">:=</span>&nbsp;<span class="keyword" id="4379794">range</span>&nbsp;<span class="ident" id="4379800">w</span><span class="op" id="4379801">.</span><span class="ident" id="4379802">literalFreq</span>&nbsp;<span class="op" id="4379814">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379818">w</span><span class="op" id="4379819">.</span><span class="ident" id="4379820">literalFreq</span><span class="op" id="4379831">[</span><span class="ident" id="4379832">i</span><span class="op" id="4379833">]</span>&nbsp;<span class="op" id="4379835">=</span>&nbsp;<span class="num" id="4379837">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4379840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379843">for</span>&nbsp;<span class="ident" id="4379847">i</span>&nbsp;<span class="op" id="4379849">:=</span>&nbsp;<span class="keyword" id="4379852">range</span>&nbsp;<span class="ident" id="4379858">w</span><span class="op" id="4379859">.</span><span class="ident" id="4379860">offsetFreq</span>&nbsp;<span class="op" id="4379871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379875">w</span><span class="op" id="4379876">.</span><span class="ident" id="4379877">offsetFreq</span><span class="op" id="4379887">[</span><span class="ident" id="4379888">i</span><span class="op" id="4379889">]</span>&nbsp;<span class="op" id="4379891">=</span>&nbsp;<span class="num" id="4379893">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4379896">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379900">n</span>&nbsp;<span class="op" id="4379902">:=</span>&nbsp;<span class="builtinfunc" id="4379905">len</span><span class="op" id="4379908">(</span><span class="ident" id="4379909">tokens</span><span class="op" id="4379915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379918">tokens</span>&nbsp;<span class="op" id="4379925">=</span>&nbsp;<span class="ident" id="4379927">tokens</span><span class="op" id="4379933">[</span><span class="num" id="4379934">0</span>&nbsp;<span class="op" id="4379936">:</span>&nbsp;<span class="ident" id="4379938">n</span><span class="op" id="4379939">+</span><span class="num" id="4379940">1</span><span class="op" id="4379941">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4379944">tokens</span><span class="op" id="4379950">[</span><span class="ident" id="4379951">n</span><span class="op" id="4379952">]</span>&nbsp;<span class="op" id="4379954">=</span>&nbsp;<span class="ident" id="4379956">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4379973">for</span>&nbsp;<span class="ident" id="4379977">_</span><span class="op" id="4379978">,</span>&nbsp;<span class="ident" id="4379980">t</span>&nbsp;<span class="op" id="4379982">:=</span>&nbsp;<span class="keyword" id="4379985">range</span>&nbsp;<span class="ident" id="4379991">tokens</span>&nbsp;<span class="op" id="4379998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4380002">switch</span>&nbsp;<span class="ident" id="4380009">t</span><span class="op" id="4380010">.</span><span class="ident" id="4380011">typ</span><span class="op" id="4380014">(</span><span class="op" id="4380015">)</span>&nbsp;<span class="op" id="4380017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4380021">case</span>&nbsp;<span class="ident" id="4380026">literalType</span><span class="op" id="4380037">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380042">w</span><span class="op" id="4380043">.</span><span class="ident" id="4380044">literalFreq</span><span class="op" id="4380055">[</span><span class="ident" id="4380056">t</span><span class="op" id="4380057">.</span><span class="ident" id="4380058">literal</span><span class="op" id="4380065">(</span><span class="op" id="4380066">)</span><span class="op" id="4380067">]</span><span class="op" id="4380068">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4380073">case</span>&nbsp;<span class="ident" id="4380078">matchType</span><span class="op" id="4380087">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380092">length</span>&nbsp;<span class="op" id="4380099">:=</span>&nbsp;<span class="ident" id="4380102">t</span><span class="op" id="4380103">.</span><span class="ident" id="4380104">length</span><span class="op" id="4380110">(</span><span class="op" id="4380111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380116">offset</span>&nbsp;<span class="op" id="4380123">:=</span>&nbsp;<span class="ident" id="4380126">t</span><span class="op" id="4380127">.</span><span class="ident" id="4380128">offset</span><span class="op" id="4380134">(</span><span class="op" id="4380135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380140">w</span><span class="op" id="4380141">.</span><span class="ident" id="4380142">literalFreq</span><span class="op" id="4380153">[</span><span class="ident" id="4380154">lengthCodesStart</span><span class="op" id="4380170">+</span><span class="ident" id="4380171">lengthCode</span><span class="op" id="4380181">(</span><span class="ident" id="4380182">length</span><span class="op" id="4380188">)</span><span class="op" id="4380189">]</span><span class="op" id="4380190">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380196">w</span><span class="op" id="4380197">.</span><span class="ident" id="4380198">offsetFreq</span><span class="op" id="4380208">[</span><span class="ident" id="4380209">offsetCode</span><span class="op" id="4380219">(</span><span class="ident" id="4380220">offset</span><span class="op" id="4380226">)</span><span class="op" id="4380227">]</span><span class="op" id="4380228">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4380233">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4380236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4380240">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380271">numLiterals</span>&nbsp;<span class="op" id="4380283">:=</span>&nbsp;<span class="builtinfunc" id="4380286">len</span><span class="op" id="4380289">(</span><span class="ident" id="4380290">w</span><span class="op" id="4380291">.</span><span class="ident" id="4380292">literalFreq</span><span class="op" id="4380303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4380306">for</span>&nbsp;<span class="ident" id="4380310">w</span><span class="op" id="4380311">.</span><span class="ident" id="4380312">literalFreq</span><span class="op" id="4380323">[</span><span class="ident" id="4380324">numLiterals</span><span class="op" id="4380335">-</span><span class="num" id="4380336">1</span><span class="op" id="4380337">]</span>&nbsp;<span class="op" id="4380339">==</span>&nbsp;<span class="num" id="4380342">0</span>&nbsp;<span class="op" id="4380344">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380348">numLiterals</span><span class="op" id="4380359">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4380363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4380366">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380396">numOffsets</span>&nbsp;<span class="op" id="4380407">:=</span>&nbsp;<span class="builtinfunc" id="4380410">len</span><span class="op" id="4380413">(</span><span class="ident" id="4380414">w</span><span class="op" id="4380415">.</span><span class="ident" id="4380416">offsetFreq</span><span class="op" id="4380426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4380429">for</span>&nbsp;<span class="ident" id="4380433">numOffsets</span>&nbsp;<span class="op" id="4380444">&gt;</span>&nbsp;<span class="num" id="4380446">0</span>&nbsp;<span class="op" id="4380448">&amp;&amp;</span>&nbsp;<span class="ident" id="4380451">w</span><span class="op" id="4380452">.</span><span class="ident" id="4380453">offsetFreq</span><span class="op" id="4380463">[</span><span class="ident" id="4380464">numOffsets</span><span class="op" id="4380474">-</span><span class="num" id="4380475">1</span><span class="op" id="4380476">]</span>&nbsp;<span class="op" id="4380478">==</span>&nbsp;<span class="num" id="4380481">0</span>&nbsp;<span class="op" id="4380483">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380487">numOffsets</span><span class="op" id="4380497">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4380501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4380504">if</span>&nbsp;<span class="ident" id="4380507">numOffsets</span>&nbsp;<span class="op" id="4380518">==</span>&nbsp;<span class="num" id="4380521">0</span>&nbsp;<span class="op" id="4380523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4380527">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4380609">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380708">w</span><span class="op" id="4380709">.</span><span class="ident" id="4380710">offsetFreq</span><span class="op" id="4380720">[</span><span class="num" id="4380721">0</span><span class="op" id="4380722">]</span>&nbsp;<span class="op" id="4380724">=</span>&nbsp;<span class="num" id="4380726">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380730">numOffsets</span>&nbsp;<span class="op" id="4380741">=</span>&nbsp;<span class="num" id="4380743">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4380746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380750">w</span><span class="op" id="4380751">.</span><span class="ident" id="4380752">literalEncoding</span><span class="op" id="4380767">.</span><span class="ident" id="4380768">generate</span><span class="op" id="4380776">(</span><span class="ident" id="4380777">w</span><span class="op" id="4380778">.</span><span class="ident" id="4380779">literalFreq</span><span class="op" id="4380790">,</span>&nbsp;<span class="num" id="4380792">15</span><span class="op" id="4380794">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380797">w</span><span class="op" id="4380798">.</span><span class="ident" id="4380799">offsetEncoding</span><span class="op" id="4380813">.</span><span class="ident" id="4380814">generate</span><span class="op" id="4380822">(</span><span class="ident" id="4380823">w</span><span class="op" id="4380824">.</span><span class="ident" id="4380825">offsetFreq</span><span class="op" id="4380835">,</span>&nbsp;<span class="num" id="4380837">15</span><span class="op" id="4380839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380843">storedBytes</span>&nbsp;<span class="op" id="4380855">:=</span>&nbsp;<span class="num" id="4380858">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4380861">if</span>&nbsp;<span class="ident" id="4380864">input</span>&nbsp;<span class="op" id="4380870">!=</span>&nbsp;<span class="ident" id="4380873">nil</span>&nbsp;<span class="op" id="4380877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4380881">storedBytes</span>&nbsp;<span class="op" id="4380893">=</span>&nbsp;<span class="builtinfunc" id="4380895">len</span><span class="op" id="4380898">(</span><span class="ident" id="4380899">input</span><span class="op" id="4380904">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4380907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4380910">var</span>&nbsp;<span class="ident" id="4380914">extraBits</span>&nbsp;<span class="ident" id="4380924">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4380931">var</span>&nbsp;<span class="ident" id="4380935">storedSize</span>&nbsp;<span class="ident" id="4380946">int64</span>&nbsp;<span class="op" id="4380952">=</span>&nbsp;<span class="ident" id="4380954">math</span><span class="op" id="4380958">.</span><span class="ident" id="4380959">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4380969">if</span>&nbsp;<span class="ident" id="4380972">storedBytes</span>&nbsp;<span class="op" id="4380984">&lt;=</span>&nbsp;<span class="ident" id="4380987">maxStoreBlockSize</span>&nbsp;<span class="op" id="4381005">&amp;&amp;</span>&nbsp;<span class="ident" id="4381008">input</span>&nbsp;<span class="op" id="4381014">!=</span>&nbsp;<span class="ident" id="4381017">nil</span>&nbsp;<span class="op" id="4381021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381025">storedSize</span>&nbsp;<span class="op" id="4381036">=</span>&nbsp;<span class="ident" id="4381038">int64</span><span class="op" id="4381043">(</span><span class="op" id="4381044">(</span><span class="ident" id="4381045">storedBytes</span>&nbsp;<span class="op" id="4381057">+</span>&nbsp;<span class="num" id="4381059">5</span><span class="op" id="4381060">)</span>&nbsp;<span class="op" id="4381062">*</span>&nbsp;<span class="num" id="4381064">8</span><span class="op" id="4381065">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4381069">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4381141">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4381213">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4381283">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4381313">for</span>&nbsp;<span class="ident" id="4381317">lengthCode</span>&nbsp;<span class="op" id="4381328">:=</span>&nbsp;<span class="ident" id="4381331">lengthCodesStart</span>&nbsp;<span class="op" id="4381348">+</span>&nbsp;<span class="num" id="4381350">8</span><span class="op" id="4381351">;</span>&nbsp;<span class="ident" id="4381353">lengthCode</span>&nbsp;<span class="op" id="4381364">&lt;</span>&nbsp;<span class="ident" id="4381366">numLiterals</span><span class="op" id="4381377">;</span>&nbsp;<span class="ident" id="4381379">lengthCode</span><span class="op" id="4381389">++</span>&nbsp;<span class="op" id="4381392">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4381397">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381449">extraBits</span>&nbsp;<span class="op" id="4381459">+=</span>&nbsp;<span class="ident" id="4381462">int64</span><span class="op" id="4381467">(</span><span class="ident" id="4381468">w</span><span class="op" id="4381469">.</span><span class="ident" id="4381470">literalFreq</span><span class="op" id="4381481">[</span><span class="ident" id="4381482">lengthCode</span><span class="op" id="4381492">]</span><span class="op" id="4381493">)</span>&nbsp;<span class="op" id="4381495">*</span>&nbsp;<span class="ident" id="4381497">int64</span><span class="op" id="4381502">(</span><span class="ident" id="4381503">lengthExtraBits</span><span class="op" id="4381518">[</span><span class="ident" id="4381519">lengthCode</span><span class="op" id="4381529">-</span><span class="ident" id="4381530">lengthCodesStart</span><span class="op" id="4381546">]</span><span class="op" id="4381547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4381551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4381555">for</span>&nbsp;<span class="ident" id="4381559">offsetCode</span>&nbsp;<span class="op" id="4381570">:=</span>&nbsp;<span class="num" id="4381573">4</span><span class="op" id="4381574">;</span>&nbsp;<span class="ident" id="4381576">offsetCode</span>&nbsp;<span class="op" id="4381587">&lt;</span>&nbsp;<span class="ident" id="4381589">numOffsets</span><span class="op" id="4381599">;</span>&nbsp;<span class="ident" id="4381601">offsetCode</span><span class="op" id="4381611">++</span>&nbsp;<span class="op" id="4381614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4381619">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381670">extraBits</span>&nbsp;<span class="op" id="4381680">+=</span>&nbsp;<span class="ident" id="4381683">int64</span><span class="op" id="4381688">(</span><span class="ident" id="4381689">w</span><span class="op" id="4381690">.</span><span class="ident" id="4381691">offsetFreq</span><span class="op" id="4381701">[</span><span class="ident" id="4381702">offsetCode</span><span class="op" id="4381712">]</span><span class="op" id="4381713">)</span>&nbsp;<span class="op" id="4381715">*</span>&nbsp;<span class="ident" id="4381717">int64</span><span class="op" id="4381722">(</span><span class="ident" id="4381723">offsetExtraBits</span><span class="op" id="4381738">[</span><span class="ident" id="4381739">offsetCode</span><span class="op" id="4381749">]</span><span class="op" id="4381750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4381754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4381757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4381761">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4381791">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4381819">var</span>&nbsp;<span class="ident" id="4381823">size</span>&nbsp;<span class="op" id="4381828">=</span>&nbsp;<span class="ident" id="4381830">int64</span><span class="op" id="4381835">(</span><span class="num" id="4381836">3</span><span class="op" id="4381837">)</span>&nbsp;<span class="op" id="4381839">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381843">fixedLiteralEncoding</span><span class="op" id="4381863">.</span><span class="ident" id="4381864">bitLength</span><span class="op" id="4381873">(</span><span class="ident" id="4381874">w</span><span class="op" id="4381875">.</span><span class="ident" id="4381876">literalFreq</span><span class="op" id="4381887">)</span>&nbsp;<span class="op" id="4381889">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381893">fixedOffsetEncoding</span><span class="op" id="4381912">.</span><span class="ident" id="4381913">bitLength</span><span class="op" id="4381922">(</span><span class="ident" id="4381923">w</span><span class="op" id="4381924">.</span><span class="ident" id="4381925">offsetFreq</span><span class="op" id="4381935">)</span>&nbsp;<span class="op" id="4381937">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381941">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4381952">var</span>&nbsp;<span class="ident" id="4381956">literalEncoding</span>&nbsp;<span class="op" id="4381972">=</span>&nbsp;<span class="ident" id="4381974">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4381996">var</span>&nbsp;<span class="ident" id="4382000">offsetEncoding</span>&nbsp;<span class="op" id="4382015">=</span>&nbsp;<span class="ident" id="4382017">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4382039">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382060">var</span>&nbsp;<span class="ident" id="4382064">numCodegens</span>&nbsp;<span class="builtintype" id="4382076">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4382082">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4382157">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382205">w</span><span class="op" id="4382206">.</span><span class="ident" id="4382207">generateCodegen</span><span class="op" id="4382222">(</span><span class="ident" id="4382223">numLiterals</span><span class="op" id="4382234">,</span>&nbsp;<span class="ident" id="4382236">numOffsets</span><span class="op" id="4382246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382249">w</span><span class="op" id="4382250">.</span><span class="ident" id="4382251">codegenEncoding</span><span class="op" id="4382266">.</span><span class="ident" id="4382267">generate</span><span class="op" id="4382275">(</span><span class="ident" id="4382276">w</span><span class="op" id="4382277">.</span><span class="ident" id="4382278">codegenFreq</span><span class="op" id="4382289">,</span>&nbsp;<span class="num" id="4382291">7</span><span class="op" id="4382292">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382295">numCodegens</span>&nbsp;<span class="op" id="4382307">=</span>&nbsp;<span class="builtinfunc" id="4382309">len</span><span class="op" id="4382312">(</span><span class="ident" id="4382313">w</span><span class="op" id="4382314">.</span><span class="ident" id="4382315">codegenFreq</span><span class="op" id="4382326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382329">for</span>&nbsp;<span class="ident" id="4382333">numCodegens</span>&nbsp;<span class="op" id="4382345">&gt;</span>&nbsp;<span class="num" id="4382347">4</span>&nbsp;<span class="op" id="4382349">&amp;&amp;</span>&nbsp;<span class="ident" id="4382352">w</span><span class="op" id="4382353">.</span><span class="ident" id="4382354">codegenFreq</span><span class="op" id="4382365">[</span><span class="ident" id="4382366">codegenOrder</span><span class="op" id="4382378">[</span><span class="ident" id="4382379">numCodegens</span><span class="op" id="4382390">-</span><span class="num" id="4382391">1</span><span class="op" id="4382392">]</span><span class="op" id="4382393">]</span>&nbsp;<span class="op" id="4382395">==</span>&nbsp;<span class="num" id="4382398">0</span>&nbsp;<span class="op" id="4382400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382404">numCodegens</span><span class="op" id="4382415">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4382419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382422">dynamicHeader</span>&nbsp;<span class="op" id="4382436">:=</span>&nbsp;<span class="ident" id="4382439">int64</span><span class="op" id="4382444">(</span><span class="num" id="4382445">3</span><span class="op" id="4382446">+</span><span class="num" id="4382447">5</span><span class="op" id="4382448">+</span><span class="num" id="4382449">5</span><span class="op" id="4382450">+</span><span class="num" id="4382451">4</span><span class="op" id="4382452">+</span><span class="op" id="4382453">(</span><span class="num" id="4382454">3</span><span class="op" id="4382455">*</span><span class="ident" id="4382456">numCodegens</span><span class="op" id="4382467">)</span><span class="op" id="4382468">)</span>&nbsp;<span class="op" id="4382470">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382474">w</span><span class="op" id="4382475">.</span><span class="ident" id="4382476">codegenEncoding</span><span class="op" id="4382491">.</span><span class="ident" id="4382492">bitLength</span><span class="op" id="4382501">(</span><span class="ident" id="4382502">w</span><span class="op" id="4382503">.</span><span class="ident" id="4382504">codegenFreq</span><span class="op" id="4382515">)</span>&nbsp;<span class="op" id="4382517">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382521">int64</span><span class="op" id="4382526">(</span><span class="ident" id="4382527">extraBits</span><span class="op" id="4382536">)</span>&nbsp;<span class="op" id="4382538">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382542">int64</span><span class="op" id="4382547">(</span><span class="ident" id="4382548">w</span><span class="op" id="4382549">.</span><span class="ident" id="4382550">codegenFreq</span><span class="op" id="4382561">[</span><span class="num" id="4382562">16</span><span class="op" id="4382564">]</span><span class="op" id="4382565">*</span><span class="num" id="4382566">2</span><span class="op" id="4382567">)</span>&nbsp;<span class="op" id="4382569">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382573">int64</span><span class="op" id="4382578">(</span><span class="ident" id="4382579">w</span><span class="op" id="4382580">.</span><span class="ident" id="4382581">codegenFreq</span><span class="op" id="4382592">[</span><span class="num" id="4382593">17</span><span class="op" id="4382595">]</span><span class="op" id="4382596">*</span><span class="num" id="4382597">3</span><span class="op" id="4382598">)</span>&nbsp;<span class="op" id="4382600">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382604">int64</span><span class="op" id="4382609">(</span><span class="ident" id="4382610">w</span><span class="op" id="4382611">.</span><span class="ident" id="4382612">codegenFreq</span><span class="op" id="4382623">[</span><span class="num" id="4382624">18</span><span class="op" id="4382626">]</span><span class="op" id="4382627">*</span><span class="num" id="4382628">7</span><span class="op" id="4382629">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382632">dynamicSize</span>&nbsp;<span class="op" id="4382644">:=</span>&nbsp;<span class="ident" id="4382647">dynamicHeader</span>&nbsp;<span class="op" id="4382661">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382665">w</span><span class="op" id="4382666">.</span><span class="ident" id="4382667">literalEncoding</span><span class="op" id="4382682">.</span><span class="ident" id="4382683">bitLength</span><span class="op" id="4382692">(</span><span class="ident" id="4382693">w</span><span class="op" id="4382694">.</span><span class="ident" id="4382695">literalFreq</span><span class="op" id="4382706">)</span>&nbsp;<span class="op" id="4382708">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382712">w</span><span class="op" id="4382713">.</span><span class="ident" id="4382714">offsetEncoding</span><span class="op" id="4382728">.</span><span class="ident" id="4382729">bitLength</span><span class="op" id="4382738">(</span><span class="ident" id="4382739">w</span><span class="op" id="4382740">.</span><span class="ident" id="4382741">offsetFreq</span><span class="op" id="4382751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382755">if</span>&nbsp;<span class="ident" id="4382758">dynamicSize</span>&nbsp;<span class="op" id="4382770">&lt;</span>&nbsp;<span class="ident" id="4382772">size</span>&nbsp;<span class="op" id="4382777">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382781">size</span>&nbsp;<span class="op" id="4382786">=</span>&nbsp;<span class="ident" id="4382788">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382802">literalEncoding</span>&nbsp;<span class="op" id="4382818">=</span>&nbsp;<span class="ident" id="4382820">w</span><span class="op" id="4382821">.</span><span class="ident" id="4382822">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382840">offsetEncoding</span>&nbsp;<span class="op" id="4382855">=</span>&nbsp;<span class="ident" id="4382857">w</span><span class="op" id="4382858">.</span><span class="ident" id="4382859">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4382875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4382879">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382897">if</span>&nbsp;<span class="ident" id="4382900">storedSize</span>&nbsp;<span class="op" id="4382911">&lt;</span>&nbsp;<span class="ident" id="4382913">size</span>&nbsp;<span class="op" id="4382918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382922">w</span><span class="op" id="4382923">.</span><span class="ident" id="4382924">writeStoredHeader</span><span class="op" id="4382941">(</span><span class="ident" id="4382942">storedBytes</span><span class="op" id="4382953">,</span>&nbsp;<span class="ident" id="4382955">eof</span><span class="op" id="4382958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382962">w</span><span class="op" id="4382963">.</span><span class="ident" id="4382964">writeBytes</span><span class="op" id="4382974">(</span><span class="ident" id="4382975">input</span><span class="op" id="4382980">[</span><span class="num" id="4382981">0</span><span class="op" id="4382982">:</span><span class="ident" id="4382983">storedBytes</span><span class="op" id="4382994">]</span><span class="op" id="4382995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382999">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4383011">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383024">if</span>&nbsp;<span class="ident" id="4383027">literalEncoding</span>&nbsp;<span class="op" id="4383043">==</span>&nbsp;<span class="ident" id="4383046">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4383067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383071">w</span><span class="op" id="4383072">.</span><span class="ident" id="4383073">writeFixedHeader</span><span class="op" id="4383089">(</span><span class="ident" id="4383090">eof</span><span class="op" id="4383093">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383096">}</span>&nbsp;<span class="keyword" id="4383098">else</span>&nbsp;<span class="op" id="4383103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383107">w</span><span class="op" id="4383108">.</span><span class="ident" id="4383109">writeDynamicHeader</span><span class="op" id="4383127">(</span><span class="ident" id="4383128">numLiterals</span><span class="op" id="4383139">,</span>&nbsp;<span class="ident" id="4383141">numOffsets</span><span class="op" id="4383151">,</span>&nbsp;<span class="ident" id="4383153">numCodegens</span><span class="op" id="4383164">,</span>&nbsp;<span class="ident" id="4383166">eof</span><span class="op" id="4383169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383175">for</span>&nbsp;<span class="ident" id="4383179">_</span><span class="op" id="4383180">,</span>&nbsp;<span class="ident" id="4383182">t</span>&nbsp;<span class="op" id="4383184">:=</span>&nbsp;<span class="keyword" id="4383187">range</span>&nbsp;<span class="ident" id="4383193">tokens</span>&nbsp;<span class="op" id="4383200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383204">switch</span>&nbsp;<span class="ident" id="4383211">t</span><span class="op" id="4383212">.</span><span class="ident" id="4383213">typ</span><span class="op" id="4383216">(</span><span class="op" id="4383217">)</span>&nbsp;<span class="op" id="4383219">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383223">case</span>&nbsp;<span class="ident" id="4383228">literalType</span><span class="op" id="4383239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383244">w</span><span class="op" id="4383245">.</span><span class="ident" id="4383246">writeCode</span><span class="op" id="4383255">(</span><span class="ident" id="4383256">literalEncoding</span><span class="op" id="4383271">,</span>&nbsp;<span class="ident" id="4383273">t</span><span class="op" id="4383274">.</span><span class="ident" id="4383275">literal</span><span class="op" id="4383282">(</span><span class="op" id="4383283">)</span><span class="op" id="4383284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383289">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383297">case</span>&nbsp;<span class="ident" id="4383302">matchType</span><span class="op" id="4383311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4383316">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383339">length</span>&nbsp;<span class="op" id="4383346">:=</span>&nbsp;<span class="ident" id="4383349">t</span><span class="op" id="4383350">.</span><span class="ident" id="4383351">length</span><span class="op" id="4383357">(</span><span class="op" id="4383358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383363">lengthCode</span>&nbsp;<span class="op" id="4383374">:=</span>&nbsp;<span class="ident" id="4383377">lengthCode</span><span class="op" id="4383387">(</span><span class="ident" id="4383388">length</span><span class="op" id="4383394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383399">w</span><span class="op" id="4383400">.</span><span class="ident" id="4383401">writeCode</span><span class="op" id="4383410">(</span><span class="ident" id="4383411">literalEncoding</span><span class="op" id="4383426">,</span>&nbsp;<span class="ident" id="4383428">lengthCode</span><span class="op" id="4383438">+</span><span class="ident" id="4383439">lengthCodesStart</span><span class="op" id="4383455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383460">extraLengthBits</span>&nbsp;<span class="op" id="4383476">:=</span>&nbsp;<span class="builtintype" id="4383479">int32</span><span class="op" id="4383484">(</span><span class="ident" id="4383485">lengthExtraBits</span><span class="op" id="4383500">[</span><span class="ident" id="4383501">lengthCode</span><span class="op" id="4383511">]</span><span class="op" id="4383512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383517">if</span>&nbsp;<span class="ident" id="4383520">extraLengthBits</span>&nbsp;<span class="op" id="4383536">&gt;</span>&nbsp;<span class="num" id="4383538">0</span>&nbsp;<span class="op" id="4383540">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383546">extraLength</span>&nbsp;<span class="op" id="4383558">:=</span>&nbsp;<span class="builtintype" id="4383561">int32</span><span class="op" id="4383566">(</span><span class="ident" id="4383567">length</span>&nbsp;<span class="op" id="4383574">-</span>&nbsp;<span class="ident" id="4383576">lengthBase</span><span class="op" id="4383586">[</span><span class="ident" id="4383587">lengthCode</span><span class="op" id="4383597">]</span><span class="op" id="4383598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383604">w</span><span class="op" id="4383605">.</span><span class="ident" id="4383606">writeBits</span><span class="op" id="4383615">(</span><span class="ident" id="4383616">extraLength</span><span class="op" id="4383627">,</span>&nbsp;<span class="ident" id="4383629">extraLengthBits</span><span class="op" id="4383644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4383654">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383677">offset</span>&nbsp;<span class="op" id="4383684">:=</span>&nbsp;<span class="ident" id="4383687">t</span><span class="op" id="4383688">.</span><span class="ident" id="4383689">offset</span><span class="op" id="4383695">(</span><span class="op" id="4383696">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383701">offsetCode</span>&nbsp;<span class="op" id="4383712">:=</span>&nbsp;<span class="ident" id="4383715">offsetCode</span><span class="op" id="4383725">(</span><span class="ident" id="4383726">offset</span><span class="op" id="4383732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383737">w</span><span class="op" id="4383738">.</span><span class="ident" id="4383739">writeCode</span><span class="op" id="4383748">(</span><span class="ident" id="4383749">offsetEncoding</span><span class="op" id="4383763">,</span>&nbsp;<span class="ident" id="4383765">offsetCode</span><span class="op" id="4383775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383780">extraOffsetBits</span>&nbsp;<span class="op" id="4383796">:=</span>&nbsp;<span class="builtintype" id="4383799">int32</span><span class="op" id="4383804">(</span><span class="ident" id="4383805">offsetExtraBits</span><span class="op" id="4383820">[</span><span class="ident" id="4383821">offsetCode</span><span class="op" id="4383831">]</span><span class="op" id="4383832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383837">if</span>&nbsp;<span class="ident" id="4383840">extraOffsetBits</span>&nbsp;<span class="op" id="4383856">&gt;</span>&nbsp;<span class="num" id="4383858">0</span>&nbsp;<span class="op" id="4383860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383866">extraOffset</span>&nbsp;<span class="op" id="4383878">:=</span>&nbsp;<span class="builtintype" id="4383881">int32</span><span class="op" id="4383886">(</span><span class="ident" id="4383887">offset</span>&nbsp;<span class="op" id="4383894">-</span>&nbsp;<span class="ident" id="4383896">offsetBase</span><span class="op" id="4383906">[</span><span class="ident" id="4383907">offsetCode</span><span class="op" id="4383917">]</span><span class="op" id="4383918">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383924">w</span><span class="op" id="4383925">.</span><span class="ident" id="4383926">writeBits</span><span class="op" id="4383935">(</span><span class="ident" id="4383936">extraOffset</span><span class="op" id="4383947">,</span>&nbsp;<span class="ident" id="4383949">extraOffsetBits</span><span class="op" id="4383964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383974">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383982">default</span><span class="op" id="4383989">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4383994">panic</span><span class="op" id="4383999">(</span><span class="string" id="4384000">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4384023">+</span>&nbsp;<span class="builtintype" id="4384025">string</span><span class="op" id="4384031">(</span><span class="ident" id="4384032">t</span><span class="op" id="4384033">)</span><span class="op" id="4384034">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4384038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4384041">}</span><br>
<span class="lineno"></span><span class="op" id="4384043">}</span>
</div>
</body>
</html>
