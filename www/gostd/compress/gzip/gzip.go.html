<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html" class="current">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4652234">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4652289">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4652343">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4652394">package</span>&nbsp;<span class="ident" id="4652402">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4652408">import</span>&nbsp;<span class="op" id="4652415">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4652418">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4652436">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4652446">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4652453">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4652461">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4652475">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4652480">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4652483">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4652563">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4652629">const</span>&nbsp;<span class="op" id="4652635">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652638">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652657">=</span>&nbsp;<span class="ident" id="4652659">flate</span><span class="op" id="4652664">.</span><span class="ident" id="4652665">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652680">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652699">=</span>&nbsp;<span class="ident" id="4652701">flate</span><span class="op" id="4652706">.</span><span class="ident" id="4652707">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652718">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652737">=</span>&nbsp;<span class="ident" id="4652739">flate</span><span class="op" id="4652744">.</span><span class="ident" id="4652745">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652762">DefaultCompression</span>&nbsp;<span class="op" id="4652781">=</span>&nbsp;<span class="ident" id="4652783">flate</span><span class="op" id="4652788">.</span><span class="ident" id="4652789">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4652808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4652811">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="4652845">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4652900">type</span>&nbsp;<span class="ident" id="4652905">Writer</span>&nbsp;<span class="keyword" id="4652912">struct</span>&nbsp;<span class="op" id="4652919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652922">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652930">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652942">io</span><span class="op" id="4652944">.</span><span class="ident" id="4652945">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652953">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4652965">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652970">wroteHeader</span>&nbsp;<span class="builtintype" id="4652982">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652988">compressor</span>&nbsp;&nbsp;<span class="op" id="4653000">*</span><span class="ident" id="4653001">flate</span><span class="op" id="4653006">.</span><span class="ident" id="4653007">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653015">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653027">hash</span><span class="op" id="4653031">.</span><span class="ident" id="4653032">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653040">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4653052">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653060">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4653072">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653078">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4653090">[</span><span class="num" id="4653091">10</span><span class="op" id="4653093">]</span><span class="builtintype" id="4653094">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653100">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4653112">error</span><br>
<span class="lineno"></span><span class="op" id="4653118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4653121">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4653156">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4653222">//</span><br>
<span class="lineno"></span><span class="comment" id="4653225">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4653306">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="4653361">//</span><br>
<span class="lineno"></span><span class="comment" id="4653364">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4653438">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4653514">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="4653592">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="4653671">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="4653690">func</span>&nbsp;<span class="ident" id="4653695">NewWriter</span><span class="op" id="4653704">(</span><span class="ident" id="4653705">w</span>&nbsp;<span class="ident" id="4653707">io</span><span class="op" id="4653709">.</span><span class="ident" id="4653710">Writer</span><span class="op" id="4653716">)</span>&nbsp;<span class="op" id="4653718">*</span><span class="ident" id="4653719">Writer</span>&nbsp;<span class="op" id="4653726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653729">z</span><span class="op" id="4653730">,</span>&nbsp;<span class="ident" id="4653732">_</span>&nbsp;<span class="op" id="4653734">:=</span>&nbsp;<span class="ident" id="4653737">NewWriterLevel</span><span class="op" id="4653751">(</span><span class="ident" id="4653752">w</span><span class="op" id="4653753">,</span>&nbsp;<span class="ident" id="4653755">DefaultCompression</span><span class="op" id="4653773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4653776">return</span>&nbsp;<span class="ident" id="4653783">z</span><br>
<span class="lineno"></span><span class="op" id="4653785">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4653788">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4653868">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4653903">//</span><br>
<span class="lineno"></span><span class="comment" id="4653906">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="4653980">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4654056">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4654103">func</span>&nbsp;<span class="ident" id="4654108">NewWriterLevel</span><span class="op" id="4654122">(</span><span class="ident" id="4654123">w</span>&nbsp;<span class="ident" id="4654125">io</span><span class="op" id="4654127">.</span><span class="ident" id="4654128">Writer</span><span class="op" id="4654134">,</span>&nbsp;<span class="ident" id="4654136">level</span>&nbsp;<span class="builtintype" id="4654142">int</span><span class="op" id="4654145">)</span>&nbsp;<span class="op" id="4654147">(</span><span class="op" id="4654148">*</span><span class="ident" id="4654149">Writer</span><span class="op" id="4654155">,</span>&nbsp;<span class="builtintype" id="4654157">error</span><span class="op" id="4654162">)</span>&nbsp;<span class="op" id="4654164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4654167">if</span>&nbsp;<span class="ident" id="4654170">level</span>&nbsp;<span class="op" id="4654176">&lt;</span>&nbsp;<span class="ident" id="4654178">DefaultCompression</span>&nbsp;<span class="op" id="4654197">||</span>&nbsp;<span class="ident" id="4654200">level</span>&nbsp;<span class="op" id="4654206">&gt;</span>&nbsp;<span class="ident" id="4654208">BestCompression</span>&nbsp;<span class="op" id="4654224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4654228">return</span>&nbsp;<span class="builtintype" id="4654235">nil</span><span class="op" id="4654238">,</span>&nbsp;<span class="ident" id="4654240">fmt</span><span class="op" id="4654243">.</span><span class="ident" id="4654244">Errorf</span><span class="op" id="4654250">(</span><span class="string" id="4654251">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4654288">,</span>&nbsp;<span class="ident" id="4654290">level</span><span class="op" id="4654295">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654301">z</span>&nbsp;<span class="op" id="4654303">:=</span>&nbsp;<span class="builtinfunc" id="4654306">new</span><span class="op" id="4654309">(</span><span class="ident" id="4654310">Writer</span><span class="op" id="4654316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654319">z</span><span class="op" id="4654320">.</span><span class="ident" id="4654321">init</span><span class="op" id="4654325">(</span><span class="ident" id="4654326">w</span><span class="op" id="4654327">,</span>&nbsp;<span class="ident" id="4654329">level</span><span class="op" id="4654334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4654337">return</span>&nbsp;<span class="ident" id="4654344">z</span><span class="op" id="4654345">,</span>&nbsp;<span class="builtintype" id="4654347">nil</span><br>
<span class="lineno"></span><span class="op" id="4654351">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4654354">func</span>&nbsp;<span class="op" id="4654359">(</span><span class="ident" id="4654360">z</span>&nbsp;<span class="op" id="4654362">*</span><span class="ident" id="4654363">Writer</span><span class="op" id="4654369">)</span>&nbsp;<span class="ident" id="4654371">init</span><span class="op" id="4654375">(</span><span class="ident" id="4654376">w</span>&nbsp;<span class="ident" id="4654378">io</span><span class="op" id="4654380">.</span><span class="ident" id="4654381">Writer</span><span class="op" id="4654387">,</span>&nbsp;<span class="ident" id="4654389">level</span>&nbsp;<span class="builtintype" id="4654395">int</span><span class="op" id="4654398">)</span>&nbsp;<span class="op" id="4654400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654403">digest</span>&nbsp;<span class="op" id="4654410">:=</span>&nbsp;<span class="ident" id="4654413">z</span><span class="op" id="4654414">.</span><span class="ident" id="4654415">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4654423">if</span>&nbsp;<span class="ident" id="4654426">digest</span>&nbsp;<span class="op" id="4654433">!=</span>&nbsp;<span class="builtintype" id="4654436">nil</span>&nbsp;<span class="op" id="4654440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654444">digest</span><span class="op" id="4654450">.</span><span class="ident" id="4654451">Reset</span><span class="op" id="4654456">(</span><span class="op" id="4654457">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654460">}</span>&nbsp;<span class="keyword" id="4654462">else</span>&nbsp;<span class="op" id="4654467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654471">digest</span>&nbsp;<span class="op" id="4654478">=</span>&nbsp;<span class="ident" id="4654480">crc32</span><span class="op" id="4654485">.</span><span class="ident" id="4654486">NewIEEE</span><span class="op" id="4654493">(</span><span class="op" id="4654494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654500">compressor</span>&nbsp;<span class="op" id="4654511">:=</span>&nbsp;<span class="ident" id="4654514">z</span><span class="op" id="4654515">.</span><span class="ident" id="4654516">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4654528">if</span>&nbsp;<span class="ident" id="4654531">compressor</span>&nbsp;<span class="op" id="4654542">!=</span>&nbsp;<span class="builtintype" id="4654545">nil</span>&nbsp;<span class="op" id="4654549">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654553">compressor</span><span class="op" id="4654563">.</span><span class="ident" id="4654564">Reset</span><span class="op" id="4654569">(</span><span class="ident" id="4654570">w</span><span class="op" id="4654571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654577">*</span><span class="ident" id="4654578">z</span>&nbsp;<span class="op" id="4654580">=</span>&nbsp;<span class="ident" id="4654582">Writer</span><span class="op" id="4654588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654592">Header</span><span class="op" id="4654598">:</span>&nbsp;<span class="ident" id="4654600">Header</span><span class="op" id="4654606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654611">OS</span><span class="op" id="4654613">:</span>&nbsp;<span class="num" id="4654615">255</span><span class="op" id="4654618">,</span>&nbsp;<span class="comment" id="4654620">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654633">}</span><span class="op" id="4654634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654638">w</span><span class="op" id="4654639">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654650">w</span><span class="op" id="4654651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654655">level</span><span class="op" id="4654660">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654667">level</span><span class="op" id="4654672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654676">digest</span><span class="op" id="4654682">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654688">digest</span><span class="op" id="4654694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654698">compressor</span><span class="op" id="4654708">:</span>&nbsp;<span class="ident" id="4654710">compressor</span><span class="op" id="4654720">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654723">}</span><br>
<span class="lineno"></span><span class="op" id="4654725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4654728">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4654798">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="4654868">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="4654935">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4654960">func</span>&nbsp;<span class="op" id="4654965">(</span><span class="ident" id="4654966">z</span>&nbsp;<span class="op" id="4654968">*</span><span class="ident" id="4654969">Writer</span><span class="op" id="4654975">)</span>&nbsp;<span class="ident" id="4654977">Reset</span><span class="op" id="4654982">(</span><span class="ident" id="4654983">w</span>&nbsp;<span class="ident" id="4654985">io</span><span class="op" id="4654987">.</span><span class="ident" id="4654988">Writer</span><span class="op" id="4654994">)</span>&nbsp;<span class="op" id="4654996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654999">z</span><span class="op" id="4655000">.</span><span class="ident" id="4655001">init</span><span class="op" id="4655005">(</span><span class="ident" id="4655006">w</span><span class="op" id="4655007">,</span>&nbsp;<span class="ident" id="4655009">z</span><span class="op" id="4655010">.</span><span class="ident" id="4655011">level</span><span class="op" id="4655016">)</span><br>
<span class="lineno"></span><span class="op" id="4655018">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4655021">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4655082">func</span>&nbsp;<span class="ident" id="4655087">put2</span><span class="op" id="4655091">(</span><span class="ident" id="4655092">p</span>&nbsp;<span class="op" id="4655094">[</span><span class="op" id="4655095">]</span><span class="builtintype" id="4655096">byte</span><span class="op" id="4655100">,</span>&nbsp;<span class="ident" id="4655102">v</span>&nbsp;<span class="builtintype" id="4655104">uint16</span><span class="op" id="4655110">)</span>&nbsp;<span class="op" id="4655112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655115">p</span><span class="op" id="4655116">[</span><span class="num" id="4655117">0</span><span class="op" id="4655118">]</span>&nbsp;<span class="op" id="4655120">=</span>&nbsp;<span class="builtintype" id="4655122">uint8</span><span class="op" id="4655127">(</span><span class="ident" id="4655128">v</span>&nbsp;<span class="op" id="4655130">&gt;&gt;</span>&nbsp;<span class="num" id="4655133">0</span><span class="op" id="4655134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655137">p</span><span class="op" id="4655138">[</span><span class="num" id="4655139">1</span><span class="op" id="4655140">]</span>&nbsp;<span class="op" id="4655142">=</span>&nbsp;<span class="builtintype" id="4655144">uint8</span><span class="op" id="4655149">(</span><span class="ident" id="4655150">v</span>&nbsp;<span class="op" id="4655152">&gt;&gt;</span>&nbsp;<span class="num" id="4655155">8</span><span class="op" id="4655156">)</span><br>
<span class="lineno">105</span><span class="op" id="4655158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4655161">func</span>&nbsp;<span class="ident" id="4655166">put4</span><span class="op" id="4655170">(</span><span class="ident" id="4655171">p</span>&nbsp;<span class="op" id="4655173">[</span><span class="op" id="4655174">]</span><span class="builtintype" id="4655175">byte</span><span class="op" id="4655179">,</span>&nbsp;<span class="ident" id="4655181">v</span>&nbsp;<span class="builtintype" id="4655183">uint32</span><span class="op" id="4655189">)</span>&nbsp;<span class="op" id="4655191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655194">p</span><span class="op" id="4655195">[</span><span class="num" id="4655196">0</span><span class="op" id="4655197">]</span>&nbsp;<span class="op" id="4655199">=</span>&nbsp;<span class="builtintype" id="4655201">uint8</span><span class="op" id="4655206">(</span><span class="ident" id="4655207">v</span>&nbsp;<span class="op" id="4655209">&gt;&gt;</span>&nbsp;<span class="num" id="4655212">0</span><span class="op" id="4655213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655216">p</span><span class="op" id="4655217">[</span><span class="num" id="4655218">1</span><span class="op" id="4655219">]</span>&nbsp;<span class="op" id="4655221">=</span>&nbsp;<span class="builtintype" id="4655223">uint8</span><span class="op" id="4655228">(</span><span class="ident" id="4655229">v</span>&nbsp;<span class="op" id="4655231">&gt;&gt;</span>&nbsp;<span class="num" id="4655234">8</span><span class="op" id="4655235">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655238">p</span><span class="op" id="4655239">[</span><span class="num" id="4655240">2</span><span class="op" id="4655241">]</span>&nbsp;<span class="op" id="4655243">=</span>&nbsp;<span class="builtintype" id="4655245">uint8</span><span class="op" id="4655250">(</span><span class="ident" id="4655251">v</span>&nbsp;<span class="op" id="4655253">&gt;&gt;</span>&nbsp;<span class="num" id="4655256">16</span><span class="op" id="4655258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655261">p</span><span class="op" id="4655262">[</span><span class="num" id="4655263">3</span><span class="op" id="4655264">]</span>&nbsp;<span class="op" id="4655266">=</span>&nbsp;<span class="builtintype" id="4655268">uint8</span><span class="op" id="4655273">(</span><span class="ident" id="4655274">v</span>&nbsp;<span class="op" id="4655276">&gt;&gt;</span>&nbsp;<span class="num" id="4655279">24</span><span class="op" id="4655281">)</span><br>
<span class="lineno"></span><span class="op" id="4655283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4655286">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="4655344">func</span>&nbsp;<span class="op" id="4655349">(</span><span class="ident" id="4655350">z</span>&nbsp;<span class="op" id="4655352">*</span><span class="ident" id="4655353">Writer</span><span class="op" id="4655359">)</span>&nbsp;<span class="ident" id="4655361">writeBytes</span><span class="op" id="4655371">(</span><span class="ident" id="4655372">b</span>&nbsp;<span class="op" id="4655374">[</span><span class="op" id="4655375">]</span><span class="builtintype" id="4655376">byte</span><span class="op" id="4655380">)</span>&nbsp;<span class="builtintype" id="4655382">error</span>&nbsp;<span class="op" id="4655388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655391">if</span>&nbsp;<span class="builtinfunc" id="4655394">len</span><span class="op" id="4655397">(</span><span class="ident" id="4655398">b</span><span class="op" id="4655399">)</span>&nbsp;<span class="op" id="4655401">&gt;</span>&nbsp;<span class="num" id="4655403">0xffff</span>&nbsp;<span class="op" id="4655410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655414">return</span>&nbsp;<span class="ident" id="4655421">errors</span><span class="op" id="4655427">.</span><span class="ident" id="4655428">New</span><span class="op" id="4655431">(</span><span class="string" id="4655432">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="4655469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4655472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655475">put2</span><span class="op" id="4655479">(</span><span class="ident" id="4655480">z</span><span class="op" id="4655481">.</span><span class="ident" id="4655482">buf</span><span class="op" id="4655485">[</span><span class="num" id="4655486">0</span><span class="op" id="4655487">:</span><span class="num" id="4655488">2</span><span class="op" id="4655489">]</span><span class="op" id="4655490">,</span>&nbsp;<span class="builtintype" id="4655492">uint16</span><span class="op" id="4655498">(</span><span class="builtinfunc" id="4655499">len</span><span class="op" id="4655502">(</span><span class="ident" id="4655503">b</span><span class="op" id="4655504">)</span><span class="op" id="4655505">)</span><span class="op" id="4655506">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655509">_</span><span class="op" id="4655510">,</span>&nbsp;<span class="ident" id="4655512">err</span>&nbsp;<span class="op" id="4655516">:=</span>&nbsp;<span class="ident" id="4655519">z</span><span class="op" id="4655520">.</span><span class="ident" id="4655521">w</span><span class="op" id="4655522">.</span><span class="ident" id="4655523">Write</span><span class="op" id="4655528">(</span><span class="ident" id="4655529">z</span><span class="op" id="4655530">.</span><span class="ident" id="4655531">buf</span><span class="op" id="4655534">[</span><span class="num" id="4655535">0</span><span class="op" id="4655536">:</span><span class="num" id="4655537">2</span><span class="op" id="4655538">]</span><span class="op" id="4655539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655542">if</span>&nbsp;<span class="ident" id="4655545">err</span>&nbsp;<span class="op" id="4655549">!=</span>&nbsp;<span class="builtintype" id="4655552">nil</span>&nbsp;<span class="op" id="4655556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655560">return</span>&nbsp;<span class="ident" id="4655567">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4655572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655575">_</span><span class="op" id="4655576">,</span>&nbsp;<span class="ident" id="4655578">err</span>&nbsp;<span class="op" id="4655582">=</span>&nbsp;<span class="ident" id="4655584">z</span><span class="op" id="4655585">.</span><span class="ident" id="4655586">w</span><span class="op" id="4655587">.</span><span class="ident" id="4655588">Write</span><span class="op" id="4655593">(</span><span class="ident" id="4655594">b</span><span class="op" id="4655595">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655598">return</span>&nbsp;<span class="ident" id="4655605">err</span><br>
<span class="lineno"></span><span class="op" id="4655609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4655612">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="4655676">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="4655759">func</span>&nbsp;<span class="op" id="4655764">(</span><span class="ident" id="4655765">z</span>&nbsp;<span class="op" id="4655767">*</span><span class="ident" id="4655768">Writer</span><span class="op" id="4655774">)</span>&nbsp;<span class="ident" id="4655776">writeString</span><span class="op" id="4655787">(</span><span class="ident" id="4655788">s</span>&nbsp;<span class="builtintype" id="4655790">string</span><span class="op" id="4655796">)</span>&nbsp;<span class="op" id="4655798">(</span><span class="ident" id="4655799">err</span>&nbsp;<span class="builtintype" id="4655803">error</span><span class="op" id="4655808">)</span>&nbsp;<span class="op" id="4655810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4655813">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655890">needconv</span>&nbsp;<span class="op" id="4655899">:=</span>&nbsp;<span class="builtintype" id="4655902">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655909">for</span>&nbsp;<span class="ident" id="4655913">_</span><span class="op" id="4655914">,</span>&nbsp;<span class="ident" id="4655916">v</span>&nbsp;<span class="op" id="4655918">:=</span>&nbsp;<span class="keyword" id="4655921">range</span>&nbsp;<span class="ident" id="4655927">s</span>&nbsp;<span class="op" id="4655929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655933">if</span>&nbsp;<span class="ident" id="4655936">v</span>&nbsp;<span class="op" id="4655938">==</span>&nbsp;<span class="num" id="4655941">0</span>&nbsp;<span class="op" id="4655943">||</span>&nbsp;<span class="ident" id="4655946">v</span>&nbsp;<span class="op" id="4655948">&gt;</span>&nbsp;<span class="num" id="4655950">0xff</span>&nbsp;<span class="op" id="4655955">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655960">return</span>&nbsp;<span class="ident" id="4655967">errors</span><span class="op" id="4655973">.</span><span class="ident" id="4655974">New</span><span class="op" id="4655977">(</span><span class="string" id="4655978">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="4656017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656025">if</span>&nbsp;<span class="ident" id="4656028">v</span>&nbsp;<span class="op" id="4656030">&gt;</span>&nbsp;<span class="num" id="4656032">0x7f</span>&nbsp;<span class="op" id="4656037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656042">needconv</span>&nbsp;<span class="op" id="4656051">=</span>&nbsp;<span class="builtintype" id="4656053">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656060">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656066">if</span>&nbsp;<span class="ident" id="4656069">needconv</span>&nbsp;<span class="op" id="4656078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656082">b</span>&nbsp;<span class="op" id="4656084">:=</span>&nbsp;<span class="builtinfunc" id="4656087">make</span><span class="op" id="4656091">(</span><span class="op" id="4656092">[</span><span class="op" id="4656093">]</span><span class="builtintype" id="4656094">byte</span><span class="op" id="4656098">,</span>&nbsp;<span class="num" id="4656100">0</span><span class="op" id="4656101">,</span>&nbsp;<span class="builtinfunc" id="4656103">len</span><span class="op" id="4656106">(</span><span class="ident" id="4656107">s</span><span class="op" id="4656108">)</span><span class="op" id="4656109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656113">for</span>&nbsp;<span class="ident" id="4656117">_</span><span class="op" id="4656118">,</span>&nbsp;<span class="ident" id="4656120">v</span>&nbsp;<span class="op" id="4656122">:=</span>&nbsp;<span class="keyword" id="4656125">range</span>&nbsp;<span class="ident" id="4656131">s</span>&nbsp;<span class="op" id="4656133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656138">b</span>&nbsp;<span class="op" id="4656140">=</span>&nbsp;<span class="builtinfunc" id="4656142">append</span><span class="op" id="4656148">(</span><span class="ident" id="4656149">b</span><span class="op" id="4656150">,</span>&nbsp;<span class="builtintype" id="4656152">byte</span><span class="op" id="4656156">(</span><span class="ident" id="4656157">v</span><span class="op" id="4656158">)</span><span class="op" id="4656159">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656167">_</span><span class="op" id="4656168">,</span>&nbsp;<span class="ident" id="4656170">err</span>&nbsp;<span class="op" id="4656174">=</span>&nbsp;<span class="ident" id="4656176">z</span><span class="op" id="4656177">.</span><span class="ident" id="4656178">w</span><span class="op" id="4656179">.</span><span class="ident" id="4656180">Write</span><span class="op" id="4656185">(</span><span class="ident" id="4656186">b</span><span class="op" id="4656187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656190">}</span>&nbsp;<span class="keyword" id="4656192">else</span>&nbsp;<span class="op" id="4656197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656201">_</span><span class="op" id="4656202">,</span>&nbsp;<span class="ident" id="4656204">err</span>&nbsp;<span class="op" id="4656208">=</span>&nbsp;<span class="ident" id="4656210">io</span><span class="op" id="4656212">.</span><span class="ident" id="4656213">WriteString</span><span class="op" id="4656224">(</span><span class="ident" id="4656225">z</span><span class="op" id="4656226">.</span><span class="ident" id="4656227">w</span><span class="op" id="4656228">,</span>&nbsp;<span class="ident" id="4656230">s</span><span class="op" id="4656231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656234">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656237">if</span>&nbsp;<span class="ident" id="4656240">err</span>&nbsp;<span class="op" id="4656244">!=</span>&nbsp;<span class="builtintype" id="4656247">nil</span>&nbsp;<span class="op" id="4656251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656255">return</span>&nbsp;<span class="ident" id="4656262">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4656270">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656307">z</span><span class="op" id="4656308">.</span><span class="ident" id="4656309">buf</span><span class="op" id="4656312">[</span><span class="num" id="4656313">0</span><span class="op" id="4656314">]</span>&nbsp;<span class="op" id="4656316">=</span>&nbsp;<span class="num" id="4656318">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656321">_</span><span class="op" id="4656322">,</span>&nbsp;<span class="ident" id="4656324">err</span>&nbsp;<span class="op" id="4656328">=</span>&nbsp;<span class="ident" id="4656330">z</span><span class="op" id="4656331">.</span><span class="ident" id="4656332">w</span><span class="op" id="4656333">.</span><span class="ident" id="4656334">Write</span><span class="op" id="4656339">(</span><span class="ident" id="4656340">z</span><span class="op" id="4656341">.</span><span class="ident" id="4656342">buf</span><span class="op" id="4656345">[</span><span class="num" id="4656346">0</span><span class="op" id="4656347">:</span><span class="num" id="4656348">1</span><span class="op" id="4656349">]</span><span class="op" id="4656350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656353">return</span>&nbsp;<span class="ident" id="4656360">err</span><br>
<span class="lineno"></span><span class="op" id="4656364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4656367">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="4656439">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4656515">func</span>&nbsp;<span class="op" id="4656520">(</span><span class="ident" id="4656521">z</span>&nbsp;<span class="op" id="4656523">*</span><span class="ident" id="4656524">Writer</span><span class="op" id="4656530">)</span>&nbsp;<span class="ident" id="4656532">Write</span><span class="op" id="4656537">(</span><span class="ident" id="4656538">p</span>&nbsp;<span class="op" id="4656540">[</span><span class="op" id="4656541">]</span><span class="builtintype" id="4656542">byte</span><span class="op" id="4656546">)</span>&nbsp;<span class="op" id="4656548">(</span><span class="builtintype" id="4656549">int</span><span class="op" id="4656552">,</span>&nbsp;<span class="builtintype" id="4656554">error</span><span class="op" id="4656559">)</span>&nbsp;<span class="op" id="4656561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656564">if</span>&nbsp;<span class="ident" id="4656567">z</span><span class="op" id="4656568">.</span><span class="ident" id="4656569">err</span>&nbsp;<span class="op" id="4656573">!=</span>&nbsp;<span class="builtintype" id="4656576">nil</span>&nbsp;<span class="op" id="4656580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656584">return</span>&nbsp;<span class="num" id="4656591">0</span><span class="op" id="4656592">,</span>&nbsp;<span class="ident" id="4656594">z</span><span class="op" id="4656595">.</span><span class="ident" id="4656596">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656601">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656604">var</span>&nbsp;<span class="ident" id="4656608">n</span>&nbsp;<span class="builtintype" id="4656610">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4656615">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656649">if</span>&nbsp;<span class="op" id="4656652">!</span><span class="ident" id="4656653">z</span><span class="op" id="4656654">.</span><span class="ident" id="4656655">wroteHeader</span>&nbsp;<span class="op" id="4656667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656671">z</span><span class="op" id="4656672">.</span><span class="ident" id="4656673">wroteHeader</span>&nbsp;<span class="op" id="4656685">=</span>&nbsp;<span class="builtintype" id="4656687">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656694">z</span><span class="op" id="4656695">.</span><span class="ident" id="4656696">buf</span><span class="op" id="4656699">[</span><span class="num" id="4656700">0</span><span class="op" id="4656701">]</span>&nbsp;<span class="op" id="4656703">=</span>&nbsp;<span class="ident" id="4656705">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656715">z</span><span class="op" id="4656716">.</span><span class="ident" id="4656717">buf</span><span class="op" id="4656720">[</span><span class="num" id="4656721">1</span><span class="op" id="4656722">]</span>&nbsp;<span class="op" id="4656724">=</span>&nbsp;<span class="ident" id="4656726">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656736">z</span><span class="op" id="4656737">.</span><span class="ident" id="4656738">buf</span><span class="op" id="4656741">[</span><span class="num" id="4656742">2</span><span class="op" id="4656743">]</span>&nbsp;<span class="op" id="4656745">=</span>&nbsp;<span class="ident" id="4656747">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656761">z</span><span class="op" id="4656762">.</span><span class="ident" id="4656763">buf</span><span class="op" id="4656766">[</span><span class="num" id="4656767">3</span><span class="op" id="4656768">]</span>&nbsp;<span class="op" id="4656770">=</span>&nbsp;<span class="num" id="4656772">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656776">if</span>&nbsp;<span class="ident" id="4656779">z</span><span class="op" id="4656780">.</span><span class="ident" id="4656781">Extra</span>&nbsp;<span class="op" id="4656787">!=</span>&nbsp;<span class="builtintype" id="4656790">nil</span>&nbsp;<span class="op" id="4656794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656799">z</span><span class="op" id="4656800">.</span><span class="ident" id="4656801">buf</span><span class="op" id="4656804">[</span><span class="num" id="4656805">3</span><span class="op" id="4656806">]</span>&nbsp;<span class="op" id="4656808">|=</span>&nbsp;<span class="num" id="4656811">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656822">if</span>&nbsp;<span class="ident" id="4656825">z</span><span class="op" id="4656826">.</span><span class="ident" id="4656827">Name</span>&nbsp;<span class="op" id="4656832">!=</span>&nbsp;<span class="string" id="4656835">&#34;&#34;</span>&nbsp;<span class="op" id="4656838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656843">z</span><span class="op" id="4656844">.</span><span class="ident" id="4656845">buf</span><span class="op" id="4656848">[</span><span class="num" id="4656849">3</span><span class="op" id="4656850">]</span>&nbsp;<span class="op" id="4656852">|=</span>&nbsp;<span class="num" id="4656855">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656866">if</span>&nbsp;<span class="ident" id="4656869">z</span><span class="op" id="4656870">.</span><span class="ident" id="4656871">Comment</span>&nbsp;<span class="op" id="4656879">!=</span>&nbsp;<span class="string" id="4656882">&#34;&#34;</span>&nbsp;<span class="op" id="4656885">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656890">z</span><span class="op" id="4656891">.</span><span class="ident" id="4656892">buf</span><span class="op" id="4656895">[</span><span class="num" id="4656896">3</span><span class="op" id="4656897">]</span>&nbsp;<span class="op" id="4656899">|=</span>&nbsp;<span class="num" id="4656902">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656913">put4</span><span class="op" id="4656917">(</span><span class="ident" id="4656918">z</span><span class="op" id="4656919">.</span><span class="ident" id="4656920">buf</span><span class="op" id="4656923">[</span><span class="num" id="4656924">4</span><span class="op" id="4656925">:</span><span class="num" id="4656926">8</span><span class="op" id="4656927">]</span><span class="op" id="4656928">,</span>&nbsp;<span class="builtintype" id="4656930">uint32</span><span class="op" id="4656936">(</span><span class="ident" id="4656937">z</span><span class="op" id="4656938">.</span><span class="ident" id="4656939">ModTime</span><span class="op" id="4656946">.</span><span class="ident" id="4656947">Unix</span><span class="op" id="4656951">(</span><span class="op" id="4656952">)</span><span class="op" id="4656953">)</span><span class="op" id="4656954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656958">if</span>&nbsp;<span class="ident" id="4656961">z</span><span class="op" id="4656962">.</span><span class="ident" id="4656963">level</span>&nbsp;<span class="op" id="4656969">==</span>&nbsp;<span class="ident" id="4656972">BestCompression</span>&nbsp;<span class="op" id="4656988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656993">z</span><span class="op" id="4656994">.</span><span class="ident" id="4656995">buf</span><span class="op" id="4656998">[</span><span class="num" id="4656999">8</span><span class="op" id="4657000">]</span>&nbsp;<span class="op" id="4657002">=</span>&nbsp;<span class="num" id="4657004">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657008">}</span>&nbsp;<span class="keyword" id="4657010">else</span>&nbsp;<span class="keyword" id="4657015">if</span>&nbsp;<span class="ident" id="4657018">z</span><span class="op" id="4657019">.</span><span class="ident" id="4657020">level</span>&nbsp;<span class="op" id="4657026">==</span>&nbsp;<span class="ident" id="4657029">BestSpeed</span>&nbsp;<span class="op" id="4657039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657044">z</span><span class="op" id="4657045">.</span><span class="ident" id="4657046">buf</span><span class="op" id="4657049">[</span><span class="num" id="4657050">8</span><span class="op" id="4657051">]</span>&nbsp;<span class="op" id="4657053">=</span>&nbsp;<span class="num" id="4657055">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657059">}</span>&nbsp;<span class="keyword" id="4657061">else</span>&nbsp;<span class="op" id="4657066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657071">z</span><span class="op" id="4657072">.</span><span class="ident" id="4657073">buf</span><span class="op" id="4657076">[</span><span class="num" id="4657077">8</span><span class="op" id="4657078">]</span>&nbsp;<span class="op" id="4657080">=</span>&nbsp;<span class="num" id="4657082">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657086">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657090">z</span><span class="op" id="4657091">.</span><span class="ident" id="4657092">buf</span><span class="op" id="4657095">[</span><span class="num" id="4657096">9</span><span class="op" id="4657097">]</span>&nbsp;<span class="op" id="4657099">=</span>&nbsp;<span class="ident" id="4657101">z</span><span class="op" id="4657102">.</span><span class="ident" id="4657103">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657108">n</span><span class="op" id="4657109">,</span>&nbsp;<span class="ident" id="4657111">z</span><span class="op" id="4657112">.</span><span class="ident" id="4657113">err</span>&nbsp;<span class="op" id="4657117">=</span>&nbsp;<span class="ident" id="4657119">z</span><span class="op" id="4657120">.</span><span class="ident" id="4657121">w</span><span class="op" id="4657122">.</span><span class="ident" id="4657123">Write</span><span class="op" id="4657128">(</span><span class="ident" id="4657129">z</span><span class="op" id="4657130">.</span><span class="ident" id="4657131">buf</span><span class="op" id="4657134">[</span><span class="num" id="4657135">0</span><span class="op" id="4657136">:</span><span class="num" id="4657137">10</span><span class="op" id="4657139">]</span><span class="op" id="4657140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657144">if</span>&nbsp;<span class="ident" id="4657147">z</span><span class="op" id="4657148">.</span><span class="ident" id="4657149">err</span>&nbsp;<span class="op" id="4657153">!=</span>&nbsp;<span class="builtintype" id="4657156">nil</span>&nbsp;<span class="op" id="4657160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657165">return</span>&nbsp;<span class="ident" id="4657172">n</span><span class="op" id="4657173">,</span>&nbsp;<span class="ident" id="4657175">z</span><span class="op" id="4657176">.</span><span class="ident" id="4657177">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657183">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657187">if</span>&nbsp;<span class="ident" id="4657190">z</span><span class="op" id="4657191">.</span><span class="ident" id="4657192">Extra</span>&nbsp;<span class="op" id="4657198">!=</span>&nbsp;<span class="builtintype" id="4657201">nil</span>&nbsp;<span class="op" id="4657205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657210">z</span><span class="op" id="4657211">.</span><span class="ident" id="4657212">err</span>&nbsp;<span class="op" id="4657216">=</span>&nbsp;<span class="ident" id="4657218">z</span><span class="op" id="4657219">.</span><span class="ident" id="4657220">writeBytes</span><span class="op" id="4657230">(</span><span class="ident" id="4657231">z</span><span class="op" id="4657232">.</span><span class="ident" id="4657233">Extra</span><span class="op" id="4657238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657243">if</span>&nbsp;<span class="ident" id="4657246">z</span><span class="op" id="4657247">.</span><span class="ident" id="4657248">err</span>&nbsp;<span class="op" id="4657252">!=</span>&nbsp;<span class="builtintype" id="4657255">nil</span>&nbsp;<span class="op" id="4657259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657265">return</span>&nbsp;<span class="ident" id="4657272">n</span><span class="op" id="4657273">,</span>&nbsp;<span class="ident" id="4657275">z</span><span class="op" id="4657276">.</span><span class="ident" id="4657277">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657284">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657292">if</span>&nbsp;<span class="ident" id="4657295">z</span><span class="op" id="4657296">.</span><span class="ident" id="4657297">Name</span>&nbsp;<span class="op" id="4657302">!=</span>&nbsp;<span class="string" id="4657305">&#34;&#34;</span>&nbsp;<span class="op" id="4657308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657313">z</span><span class="op" id="4657314">.</span><span class="ident" id="4657315">err</span>&nbsp;<span class="op" id="4657319">=</span>&nbsp;<span class="ident" id="4657321">z</span><span class="op" id="4657322">.</span><span class="ident" id="4657323">writeString</span><span class="op" id="4657334">(</span><span class="ident" id="4657335">z</span><span class="op" id="4657336">.</span><span class="ident" id="4657337">Name</span><span class="op" id="4657341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657346">if</span>&nbsp;<span class="ident" id="4657349">z</span><span class="op" id="4657350">.</span><span class="ident" id="4657351">err</span>&nbsp;<span class="op" id="4657355">!=</span>&nbsp;<span class="builtintype" id="4657358">nil</span>&nbsp;<span class="op" id="4657362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657368">return</span>&nbsp;<span class="ident" id="4657375">n</span><span class="op" id="4657376">,</span>&nbsp;<span class="ident" id="4657378">z</span><span class="op" id="4657379">.</span><span class="ident" id="4657380">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657395">if</span>&nbsp;<span class="ident" id="4657398">z</span><span class="op" id="4657399">.</span><span class="ident" id="4657400">Comment</span>&nbsp;<span class="op" id="4657408">!=</span>&nbsp;<span class="string" id="4657411">&#34;&#34;</span>&nbsp;<span class="op" id="4657414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657419">z</span><span class="op" id="4657420">.</span><span class="ident" id="4657421">err</span>&nbsp;<span class="op" id="4657425">=</span>&nbsp;<span class="ident" id="4657427">z</span><span class="op" id="4657428">.</span><span class="ident" id="4657429">writeString</span><span class="op" id="4657440">(</span><span class="ident" id="4657441">z</span><span class="op" id="4657442">.</span><span class="ident" id="4657443">Comment</span><span class="op" id="4657450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657455">if</span>&nbsp;<span class="ident" id="4657458">z</span><span class="op" id="4657459">.</span><span class="ident" id="4657460">err</span>&nbsp;<span class="op" id="4657464">!=</span>&nbsp;<span class="builtintype" id="4657467">nil</span>&nbsp;<span class="op" id="4657471">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657477">return</span>&nbsp;<span class="ident" id="4657484">n</span><span class="op" id="4657485">,</span>&nbsp;<span class="ident" id="4657487">z</span><span class="op" id="4657488">.</span><span class="ident" id="4657489">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657504">if</span>&nbsp;<span class="ident" id="4657507">z</span><span class="op" id="4657508">.</span><span class="ident" id="4657509">compressor</span>&nbsp;<span class="op" id="4657520">==</span>&nbsp;<span class="builtintype" id="4657523">nil</span>&nbsp;<span class="op" id="4657527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657532">z</span><span class="op" id="4657533">.</span><span class="ident" id="4657534">compressor</span><span class="op" id="4657544">,</span>&nbsp;<span class="ident" id="4657546">_</span>&nbsp;<span class="op" id="4657548">=</span>&nbsp;<span class="ident" id="4657550">flate</span><span class="op" id="4657555">.</span><span class="ident" id="4657556">NewWriter</span><span class="op" id="4657565">(</span><span class="ident" id="4657566">z</span><span class="op" id="4657567">.</span><span class="ident" id="4657568">w</span><span class="op" id="4657569">,</span>&nbsp;<span class="ident" id="4657571">z</span><span class="op" id="4657572">.</span><span class="ident" id="4657573">level</span><span class="op" id="4657578">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657588">z</span><span class="op" id="4657589">.</span><span class="ident" id="4657590">size</span>&nbsp;<span class="op" id="4657595">+=</span>&nbsp;<span class="builtintype" id="4657598">uint32</span><span class="op" id="4657604">(</span><span class="builtinfunc" id="4657605">len</span><span class="op" id="4657608">(</span><span class="ident" id="4657609">p</span><span class="op" id="4657610">)</span><span class="op" id="4657611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657614">z</span><span class="op" id="4657615">.</span><span class="ident" id="4657616">digest</span><span class="op" id="4657622">.</span><span class="ident" id="4657623">Write</span><span class="op" id="4657628">(</span><span class="ident" id="4657629">p</span><span class="op" id="4657630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657633">n</span><span class="op" id="4657634">,</span>&nbsp;<span class="ident" id="4657636">z</span><span class="op" id="4657637">.</span><span class="ident" id="4657638">err</span>&nbsp;<span class="op" id="4657642">=</span>&nbsp;<span class="ident" id="4657644">z</span><span class="op" id="4657645">.</span><span class="ident" id="4657646">compressor</span><span class="op" id="4657656">.</span><span class="ident" id="4657657">Write</span><span class="op" id="4657662">(</span><span class="ident" id="4657663">p</span><span class="op" id="4657664">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657667">return</span>&nbsp;<span class="ident" id="4657674">n</span><span class="op" id="4657675">,</span>&nbsp;<span class="ident" id="4657677">z</span><span class="op" id="4657678">.</span><span class="ident" id="4657679">err</span><br>
<span class="lineno"></span><span class="op" id="4657683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4657686">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4657757">//</span><br>
<span class="lineno">225</span><span class="comment" id="4657760">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4657831">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4657902">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4657967">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4658021">//</span><br>
<span class="lineno">230</span><span class="comment" id="4658024">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4658104">func</span>&nbsp;<span class="op" id="4658109">(</span><span class="ident" id="4658110">z</span>&nbsp;<span class="op" id="4658112">*</span><span class="ident" id="4658113">Writer</span><span class="op" id="4658119">)</span>&nbsp;<span class="ident" id="4658121">Flush</span><span class="op" id="4658126">(</span><span class="op" id="4658127">)</span>&nbsp;<span class="builtintype" id="4658129">error</span>&nbsp;<span class="op" id="4658135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658138">if</span>&nbsp;<span class="ident" id="4658141">z</span><span class="op" id="4658142">.</span><span class="ident" id="4658143">err</span>&nbsp;<span class="op" id="4658147">!=</span>&nbsp;<span class="builtintype" id="4658150">nil</span>&nbsp;<span class="op" id="4658154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658158">return</span>&nbsp;<span class="ident" id="4658165">z</span><span class="op" id="4658166">.</span><span class="ident" id="4658167">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658172">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658175">if</span>&nbsp;<span class="ident" id="4658178">z</span><span class="op" id="4658179">.</span><span class="ident" id="4658180">closed</span>&nbsp;<span class="op" id="4658187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658191">return</span>&nbsp;<span class="builtintype" id="4658198">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658206">if</span>&nbsp;<span class="op" id="4658209">!</span><span class="ident" id="4658210">z</span><span class="op" id="4658211">.</span><span class="ident" id="4658212">wroteHeader</span>&nbsp;<span class="op" id="4658224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658228">z</span><span class="op" id="4658229">.</span><span class="ident" id="4658230">Write</span><span class="op" id="4658235">(</span><span class="builtintype" id="4658236">nil</span><span class="op" id="4658239">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658243">if</span>&nbsp;<span class="ident" id="4658246">z</span><span class="op" id="4658247">.</span><span class="ident" id="4658248">err</span>&nbsp;<span class="op" id="4658252">!=</span>&nbsp;<span class="builtintype" id="4658255">nil</span>&nbsp;<span class="op" id="4658259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658264">return</span>&nbsp;<span class="ident" id="4658271">z</span><span class="op" id="4658272">.</span><span class="ident" id="4658273">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658285">z</span><span class="op" id="4658286">.</span><span class="ident" id="4658287">err</span>&nbsp;<span class="op" id="4658291">=</span>&nbsp;<span class="ident" id="4658293">z</span><span class="op" id="4658294">.</span><span class="ident" id="4658295">compressor</span><span class="op" id="4658305">.</span><span class="ident" id="4658306">Flush</span><span class="op" id="4658311">(</span><span class="op" id="4658312">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658315">return</span>&nbsp;<span class="ident" id="4658322">z</span><span class="op" id="4658323">.</span><span class="ident" id="4658324">err</span><br>
<span class="lineno"></span><span class="op" id="4658328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4658331">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4658405">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="4658464">func</span>&nbsp;<span class="op" id="4658469">(</span><span class="ident" id="4658470">z</span>&nbsp;<span class="op" id="4658472">*</span><span class="ident" id="4658473">Writer</span><span class="op" id="4658479">)</span>&nbsp;<span class="ident" id="4658481">Close</span><span class="op" id="4658486">(</span><span class="op" id="4658487">)</span>&nbsp;<span class="builtintype" id="4658489">error</span>&nbsp;<span class="op" id="4658495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658498">if</span>&nbsp;<span class="ident" id="4658501">z</span><span class="op" id="4658502">.</span><span class="ident" id="4658503">err</span>&nbsp;<span class="op" id="4658507">!=</span>&nbsp;<span class="builtintype" id="4658510">nil</span>&nbsp;<span class="op" id="4658514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658518">return</span>&nbsp;<span class="ident" id="4658525">z</span><span class="op" id="4658526">.</span><span class="ident" id="4658527">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658535">if</span>&nbsp;<span class="ident" id="4658538">z</span><span class="op" id="4658539">.</span><span class="ident" id="4658540">closed</span>&nbsp;<span class="op" id="4658547">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658551">return</span>&nbsp;<span class="builtintype" id="4658558">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658566">z</span><span class="op" id="4658567">.</span><span class="ident" id="4658568">closed</span>&nbsp;<span class="op" id="4658575">=</span>&nbsp;<span class="builtintype" id="4658577">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658583">if</span>&nbsp;<span class="op" id="4658586">!</span><span class="ident" id="4658587">z</span><span class="op" id="4658588">.</span><span class="ident" id="4658589">wroteHeader</span>&nbsp;<span class="op" id="4658601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658605">z</span><span class="op" id="4658606">.</span><span class="ident" id="4658607">Write</span><span class="op" id="4658612">(</span><span class="builtintype" id="4658613">nil</span><span class="op" id="4658616">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658620">if</span>&nbsp;<span class="ident" id="4658623">z</span><span class="op" id="4658624">.</span><span class="ident" id="4658625">err</span>&nbsp;<span class="op" id="4658629">!=</span>&nbsp;<span class="builtintype" id="4658632">nil</span>&nbsp;<span class="op" id="4658636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658641">return</span>&nbsp;<span class="ident" id="4658648">z</span><span class="op" id="4658649">.</span><span class="ident" id="4658650">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658662">z</span><span class="op" id="4658663">.</span><span class="ident" id="4658664">err</span>&nbsp;<span class="op" id="4658668">=</span>&nbsp;<span class="ident" id="4658670">z</span><span class="op" id="4658671">.</span><span class="ident" id="4658672">compressor</span><span class="op" id="4658682">.</span><span class="ident" id="4658683">Close</span><span class="op" id="4658688">(</span><span class="op" id="4658689">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658692">if</span>&nbsp;<span class="ident" id="4658695">z</span><span class="op" id="4658696">.</span><span class="ident" id="4658697">err</span>&nbsp;<span class="op" id="4658701">!=</span>&nbsp;<span class="builtintype" id="4658704">nil</span>&nbsp;<span class="op" id="4658708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658712">return</span>&nbsp;<span class="ident" id="4658719">z</span><span class="op" id="4658720">.</span><span class="ident" id="4658721">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658729">put4</span><span class="op" id="4658733">(</span><span class="ident" id="4658734">z</span><span class="op" id="4658735">.</span><span class="ident" id="4658736">buf</span><span class="op" id="4658739">[</span><span class="num" id="4658740">0</span><span class="op" id="4658741">:</span><span class="num" id="4658742">4</span><span class="op" id="4658743">]</span><span class="op" id="4658744">,</span>&nbsp;<span class="ident" id="4658746">z</span><span class="op" id="4658747">.</span><span class="ident" id="4658748">digest</span><span class="op" id="4658754">.</span><span class="ident" id="4658755">Sum32</span><span class="op" id="4658760">(</span><span class="op" id="4658761">)</span><span class="op" id="4658762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658765">put4</span><span class="op" id="4658769">(</span><span class="ident" id="4658770">z</span><span class="op" id="4658771">.</span><span class="ident" id="4658772">buf</span><span class="op" id="4658775">[</span><span class="num" id="4658776">4</span><span class="op" id="4658777">:</span><span class="num" id="4658778">8</span><span class="op" id="4658779">]</span><span class="op" id="4658780">,</span>&nbsp;<span class="ident" id="4658782">z</span><span class="op" id="4658783">.</span><span class="ident" id="4658784">size</span><span class="op" id="4658788">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658791">_</span><span class="op" id="4658792">,</span>&nbsp;<span class="ident" id="4658794">z</span><span class="op" id="4658795">.</span><span class="ident" id="4658796">err</span>&nbsp;<span class="op" id="4658800">=</span>&nbsp;<span class="ident" id="4658802">z</span><span class="op" id="4658803">.</span><span class="ident" id="4658804">w</span><span class="op" id="4658805">.</span><span class="ident" id="4658806">Write</span><span class="op" id="4658811">(</span><span class="ident" id="4658812">z</span><span class="op" id="4658813">.</span><span class="ident" id="4658814">buf</span><span class="op" id="4658817">[</span><span class="num" id="4658818">0</span><span class="op" id="4658819">:</span><span class="num" id="4658820">8</span><span class="op" id="4658821">]</span><span class="op" id="4658822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658825">return</span>&nbsp;<span class="ident" id="4658832">z</span><span class="op" id="4658833">.</span><span class="ident" id="4658834">err</span><br>
<span class="lineno"></span><span class="op" id="4658838">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
