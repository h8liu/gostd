<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4261349">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4261404">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4261458">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4261509">package</span>&nbsp;<span class="ident" id="4261517">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4261522">import</span>&nbsp;<span class="op" id="4261529">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4261532">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4261542">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4261557">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4261571">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4261586">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4261603">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4261610">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4261613">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4261685">func</span>&nbsp;<span class="ident" id="4261690">splitPreMasterSecret</span><span class="op" id="4261710">(</span><span class="ident" id="4261711">secret</span>&nbsp;<span class="op" id="4261718">[</span><span class="op" id="4261719">]</span><span class="builtintype" id="4261720">byte</span><span class="op" id="4261724">)</span>&nbsp;<span class="op" id="4261726">(</span><span class="ident" id="4261727">s1</span><span class="op" id="4261729">,</span>&nbsp;<span class="ident" id="4261731">s2</span>&nbsp;<span class="op" id="4261734">[</span><span class="op" id="4261735">]</span><span class="builtintype" id="4261736">byte</span><span class="op" id="4261740">)</span>&nbsp;<span class="op" id="4261742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261745">s1</span>&nbsp;<span class="op" id="4261748">=</span>&nbsp;<span class="ident" id="4261750">secret</span><span class="op" id="4261756">[</span><span class="num" id="4261757">0</span>&nbsp;<span class="op" id="4261759">:</span>&nbsp;<span class="op" id="4261761">(</span><span class="builtinfunc" id="4261762">len</span><span class="op" id="4261765">(</span><span class="ident" id="4261766">secret</span><span class="op" id="4261772">)</span><span class="op" id="4261773">+</span><span class="num" id="4261774">1</span><span class="op" id="4261775">)</span><span class="op" id="4261776">/</span><span class="num" id="4261777">2</span><span class="op" id="4261778">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261781">s2</span>&nbsp;<span class="op" id="4261784">=</span>&nbsp;<span class="ident" id="4261786">secret</span><span class="op" id="4261792">[</span><span class="builtinfunc" id="4261793">len</span><span class="op" id="4261796">(</span><span class="ident" id="4261797">secret</span><span class="op" id="4261803">)</span><span class="op" id="4261804">/</span><span class="num" id="4261805">2</span><span class="op" id="4261806">:</span><span class="op" id="4261807">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261810">return</span><br>
<span class="lineno"></span><span class="op" id="4261817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4261820">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4261896">func</span>&nbsp;<span class="ident" id="4261901">pHash</span><span class="op" id="4261906">(</span><span class="ident" id="4261907">result</span><span class="op" id="4261913">,</span>&nbsp;<span class="ident" id="4261915">secret</span><span class="op" id="4261921">,</span>&nbsp;<span class="ident" id="4261923">seed</span>&nbsp;<span class="op" id="4261928">[</span><span class="op" id="4261929">]</span><span class="builtintype" id="4261930">byte</span><span class="op" id="4261934">,</span>&nbsp;<span class="ident" id="4261936">hash</span>&nbsp;<span class="keyword" id="4261941">func</span><span class="op" id="4261945">(</span><span class="op" id="4261946">)</span>&nbsp;<span class="ident" id="4261948">hash</span><span class="op" id="4261952">.</span><span class="ident" id="4261953">Hash</span><span class="op" id="4261957">)</span>&nbsp;<span class="op" id="4261959">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261962">h</span>&nbsp;<span class="op" id="4261964">:=</span>&nbsp;<span class="ident" id="4261967">hmac</span><span class="op" id="4261971">.</span><span class="ident" id="4261972">New</span><span class="op" id="4261975">(</span><span class="ident" id="4261976">hash</span><span class="op" id="4261980">,</span>&nbsp;<span class="ident" id="4261982">secret</span><span class="op" id="4261988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261991">h</span><span class="op" id="4261992">.</span><span class="ident" id="4261993">Write</span><span class="op" id="4261998">(</span><span class="ident" id="4261999">seed</span><span class="op" id="4262003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262006">a</span>&nbsp;<span class="op" id="4262008">:=</span>&nbsp;<span class="ident" id="4262011">h</span><span class="op" id="4262012">.</span><span class="ident" id="4262013">Sum</span><span class="op" id="4262016">(</span><span class="ident" id="4262017">nil</span><span class="op" id="4262020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262024">j</span>&nbsp;<span class="op" id="4262026">:=</span>&nbsp;<span class="num" id="4262029">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262032">for</span>&nbsp;<span class="ident" id="4262036">j</span>&nbsp;<span class="op" id="4262038">&lt;</span>&nbsp;<span class="builtinfunc" id="4262040">len</span><span class="op" id="4262043">(</span><span class="ident" id="4262044">result</span><span class="op" id="4262050">)</span>&nbsp;<span class="op" id="4262052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262056">h</span><span class="op" id="4262057">.</span><span class="ident" id="4262058">Reset</span><span class="op" id="4262063">(</span><span class="op" id="4262064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262068">h</span><span class="op" id="4262069">.</span><span class="ident" id="4262070">Write</span><span class="op" id="4262075">(</span><span class="ident" id="4262076">a</span><span class="op" id="4262077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262081">h</span><span class="op" id="4262082">.</span><span class="ident" id="4262083">Write</span><span class="op" id="4262088">(</span><span class="ident" id="4262089">seed</span><span class="op" id="4262093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262097">b</span>&nbsp;<span class="op" id="4262099">:=</span>&nbsp;<span class="ident" id="4262102">h</span><span class="op" id="4262103">.</span><span class="ident" id="4262104">Sum</span><span class="op" id="4262107">(</span><span class="ident" id="4262108">nil</span><span class="op" id="4262111">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262115">todo</span>&nbsp;<span class="op" id="4262120">:=</span>&nbsp;<span class="builtinfunc" id="4262123">len</span><span class="op" id="4262126">(</span><span class="ident" id="4262127">b</span><span class="op" id="4262128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262132">if</span>&nbsp;<span class="ident" id="4262135">j</span><span class="op" id="4262136">+</span><span class="ident" id="4262137">todo</span>&nbsp;<span class="op" id="4262142">&gt;</span>&nbsp;<span class="builtinfunc" id="4262144">len</span><span class="op" id="4262147">(</span><span class="ident" id="4262148">result</span><span class="op" id="4262154">)</span>&nbsp;<span class="op" id="4262156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262161">todo</span>&nbsp;<span class="op" id="4262166">=</span>&nbsp;<span class="builtinfunc" id="4262168">len</span><span class="op" id="4262171">(</span><span class="ident" id="4262172">result</span><span class="op" id="4262178">)</span>&nbsp;<span class="op" id="4262180">-</span>&nbsp;<span class="ident" id="4262182">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4262190">copy</span><span class="op" id="4262194">(</span><span class="ident" id="4262195">result</span><span class="op" id="4262201">[</span><span class="ident" id="4262202">j</span><span class="op" id="4262203">:</span><span class="ident" id="4262204">j</span><span class="op" id="4262205">+</span><span class="ident" id="4262206">todo</span><span class="op" id="4262210">]</span><span class="op" id="4262211">,</span>&nbsp;<span class="ident" id="4262213">b</span><span class="op" id="4262214">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262218">j</span>&nbsp;<span class="op" id="4262220">+=</span>&nbsp;<span class="ident" id="4262223">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262231">h</span><span class="op" id="4262232">.</span><span class="ident" id="4262233">Reset</span><span class="op" id="4262238">(</span><span class="op" id="4262239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262243">h</span><span class="op" id="4262244">.</span><span class="ident" id="4262245">Write</span><span class="op" id="4262250">(</span><span class="ident" id="4262251">a</span><span class="op" id="4262252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262256">a</span>&nbsp;<span class="op" id="4262258">=</span>&nbsp;<span class="ident" id="4262260">h</span><span class="op" id="4262261">.</span><span class="ident" id="4262262">Sum</span><span class="op" id="4262265">(</span><span class="ident" id="4262266">nil</span><span class="op" id="4262269">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262272">}</span><br>
<span class="lineno"></span><span class="op" id="4262274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4262277">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4262368">func</span>&nbsp;<span class="ident" id="4262373">prf10</span><span class="op" id="4262378">(</span><span class="ident" id="4262379">result</span><span class="op" id="4262385">,</span>&nbsp;<span class="ident" id="4262387">secret</span><span class="op" id="4262393">,</span>&nbsp;<span class="ident" id="4262395">label</span><span class="op" id="4262400">,</span>&nbsp;<span class="ident" id="4262402">seed</span>&nbsp;<span class="op" id="4262407">[</span><span class="op" id="4262408">]</span><span class="builtintype" id="4262409">byte</span><span class="op" id="4262413">)</span>&nbsp;<span class="op" id="4262415">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262418">hashSHA1</span>&nbsp;<span class="op" id="4262427">:=</span>&nbsp;<span class="ident" id="4262430">sha1</span><span class="op" id="4262434">.</span><span class="ident" id="4262435">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262440">hashMD5</span>&nbsp;<span class="op" id="4262448">:=</span>&nbsp;<span class="ident" id="4262451">md5</span><span class="op" id="4262454">.</span><span class="ident" id="4262455">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262461">labelAndSeed</span>&nbsp;<span class="op" id="4262474">:=</span>&nbsp;<span class="builtinfunc" id="4262477">make</span><span class="op" id="4262481">(</span><span class="op" id="4262482">[</span><span class="op" id="4262483">]</span><span class="builtintype" id="4262484">byte</span><span class="op" id="4262488">,</span>&nbsp;<span class="builtinfunc" id="4262490">len</span><span class="op" id="4262493">(</span><span class="ident" id="4262494">label</span><span class="op" id="4262499">)</span><span class="op" id="4262500">+</span><span class="builtinfunc" id="4262501">len</span><span class="op" id="4262504">(</span><span class="ident" id="4262505">seed</span><span class="op" id="4262509">)</span><span class="op" id="4262510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4262513">copy</span><span class="op" id="4262517">(</span><span class="ident" id="4262518">labelAndSeed</span><span class="op" id="4262530">,</span>&nbsp;<span class="ident" id="4262532">label</span><span class="op" id="4262537">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4262540">copy</span><span class="op" id="4262544">(</span><span class="ident" id="4262545">labelAndSeed</span><span class="op" id="4262557">[</span><span class="builtinfunc" id="4262558">len</span><span class="op" id="4262561">(</span><span class="ident" id="4262562">label</span><span class="op" id="4262567">)</span><span class="op" id="4262568">:</span><span class="op" id="4262569">]</span><span class="op" id="4262570">,</span>&nbsp;<span class="ident" id="4262572">seed</span><span class="op" id="4262576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262580">s1</span><span class="op" id="4262582">,</span>&nbsp;<span class="ident" id="4262584">s2</span>&nbsp;<span class="op" id="4262587">:=</span>&nbsp;<span class="ident" id="4262590">splitPreMasterSecret</span><span class="op" id="4262610">(</span><span class="ident" id="4262611">secret</span><span class="op" id="4262617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262620">pHash</span><span class="op" id="4262625">(</span><span class="ident" id="4262626">result</span><span class="op" id="4262632">,</span>&nbsp;<span class="ident" id="4262634">s1</span><span class="op" id="4262636">,</span>&nbsp;<span class="ident" id="4262638">labelAndSeed</span><span class="op" id="4262650">,</span>&nbsp;<span class="ident" id="4262652">hashMD5</span><span class="op" id="4262659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262662">result2</span>&nbsp;<span class="op" id="4262670">:=</span>&nbsp;<span class="builtinfunc" id="4262673">make</span><span class="op" id="4262677">(</span><span class="op" id="4262678">[</span><span class="op" id="4262679">]</span><span class="builtintype" id="4262680">byte</span><span class="op" id="4262684">,</span>&nbsp;<span class="builtinfunc" id="4262686">len</span><span class="op" id="4262689">(</span><span class="ident" id="4262690">result</span><span class="op" id="4262696">)</span><span class="op" id="4262697">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262700">pHash</span><span class="op" id="4262705">(</span><span class="ident" id="4262706">result2</span><span class="op" id="4262713">,</span>&nbsp;<span class="ident" id="4262715">s2</span><span class="op" id="4262717">,</span>&nbsp;<span class="ident" id="4262719">labelAndSeed</span><span class="op" id="4262731">,</span>&nbsp;<span class="ident" id="4262733">hashSHA1</span><span class="op" id="4262741">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262745">for</span>&nbsp;<span class="ident" id="4262749">i</span><span class="op" id="4262750">,</span>&nbsp;<span class="ident" id="4262752">b</span>&nbsp;<span class="op" id="4262754">:=</span>&nbsp;<span class="keyword" id="4262757">range</span>&nbsp;<span class="ident" id="4262763">result2</span>&nbsp;<span class="op" id="4262771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262775">result</span><span class="op" id="4262781">[</span><span class="ident" id="4262782">i</span><span class="op" id="4262783">]</span>&nbsp;<span class="op" id="4262785">^=</span>&nbsp;<span class="ident" id="4262788">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262791">}</span><br>
<span class="lineno">65</span><span class="op" id="4262793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4262796">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4262887">func</span>&nbsp;<span class="ident" id="4262892">prf12</span><span class="op" id="4262897">(</span><span class="ident" id="4262898">result</span><span class="op" id="4262904">,</span>&nbsp;<span class="ident" id="4262906">secret</span><span class="op" id="4262912">,</span>&nbsp;<span class="ident" id="4262914">label</span><span class="op" id="4262919">,</span>&nbsp;<span class="ident" id="4262921">seed</span>&nbsp;<span class="op" id="4262926">[</span><span class="op" id="4262927">]</span><span class="builtintype" id="4262928">byte</span><span class="op" id="4262932">)</span>&nbsp;<span class="op" id="4262934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262937">labelAndSeed</span>&nbsp;<span class="op" id="4262950">:=</span>&nbsp;<span class="builtinfunc" id="4262953">make</span><span class="op" id="4262957">(</span><span class="op" id="4262958">[</span><span class="op" id="4262959">]</span><span class="builtintype" id="4262960">byte</span><span class="op" id="4262964">,</span>&nbsp;<span class="builtinfunc" id="4262966">len</span><span class="op" id="4262969">(</span><span class="ident" id="4262970">label</span><span class="op" id="4262975">)</span><span class="op" id="4262976">+</span><span class="builtinfunc" id="4262977">len</span><span class="op" id="4262980">(</span><span class="ident" id="4262981">seed</span><span class="op" id="4262985">)</span><span class="op" id="4262986">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4262989">copy</span><span class="op" id="4262993">(</span><span class="ident" id="4262994">labelAndSeed</span><span class="op" id="4263006">,</span>&nbsp;<span class="ident" id="4263008">label</span><span class="op" id="4263013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4263016">copy</span><span class="op" id="4263020">(</span><span class="ident" id="4263021">labelAndSeed</span><span class="op" id="4263033">[</span><span class="builtinfunc" id="4263034">len</span><span class="op" id="4263037">(</span><span class="ident" id="4263038">label</span><span class="op" id="4263043">)</span><span class="op" id="4263044">:</span><span class="op" id="4263045">]</span><span class="op" id="4263046">,</span>&nbsp;<span class="ident" id="4263048">seed</span><span class="op" id="4263052">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263056">pHash</span><span class="op" id="4263061">(</span><span class="ident" id="4263062">result</span><span class="op" id="4263068">,</span>&nbsp;<span class="ident" id="4263070">secret</span><span class="op" id="4263076">,</span>&nbsp;<span class="ident" id="4263078">labelAndSeed</span><span class="op" id="4263090">,</span>&nbsp;<span class="ident" id="4263092">sha256</span><span class="op" id="4263098">.</span><span class="ident" id="4263099">New</span><span class="op" id="4263102">)</span><br>
<span class="lineno"></span><span class="op" id="4263104">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4263107">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4263177">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="4263250">func</span>&nbsp;<span class="ident" id="4263255">prf30</span><span class="op" id="4263260">(</span><span class="ident" id="4263261">result</span><span class="op" id="4263267">,</span>&nbsp;<span class="ident" id="4263269">secret</span><span class="op" id="4263275">,</span>&nbsp;<span class="ident" id="4263277">label</span><span class="op" id="4263282">,</span>&nbsp;<span class="ident" id="4263284">seed</span>&nbsp;<span class="op" id="4263289">[</span><span class="op" id="4263290">]</span><span class="builtintype" id="4263291">byte</span><span class="op" id="4263295">)</span>&nbsp;<span class="op" id="4263297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263300">hashSHA1</span>&nbsp;<span class="op" id="4263309">:=</span>&nbsp;<span class="ident" id="4263312">sha1</span><span class="op" id="4263316">.</span><span class="ident" id="4263317">New</span><span class="op" id="4263320">(</span><span class="op" id="4263321">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263324">hashMD5</span>&nbsp;<span class="op" id="4263332">:=</span>&nbsp;<span class="ident" id="4263335">md5</span><span class="op" id="4263338">.</span><span class="ident" id="4263339">New</span><span class="op" id="4263342">(</span><span class="op" id="4263343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263347">done</span>&nbsp;<span class="op" id="4263352">:=</span>&nbsp;<span class="num" id="4263355">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263358">i</span>&nbsp;<span class="op" id="4263360">:=</span>&nbsp;<span class="num" id="4263363">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263366">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263437">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263509">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263581">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263600">var</span>&nbsp;<span class="ident" id="4263604">b</span>&nbsp;<span class="op" id="4263606">[</span><span class="num" id="4263607">11</span><span class="op" id="4263609">]</span><span class="builtintype" id="4263610">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263616">for</span>&nbsp;<span class="ident" id="4263620">done</span>&nbsp;<span class="op" id="4263625">&lt;</span>&nbsp;<span class="builtinfunc" id="4263627">len</span><span class="op" id="4263630">(</span><span class="ident" id="4263631">result</span><span class="op" id="4263637">)</span>&nbsp;<span class="op" id="4263639">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263643">for</span>&nbsp;<span class="ident" id="4263647">j</span>&nbsp;<span class="op" id="4263649">:=</span>&nbsp;<span class="num" id="4263652">0</span><span class="op" id="4263653">;</span>&nbsp;<span class="ident" id="4263655">j</span>&nbsp;<span class="op" id="4263657">&lt;=</span>&nbsp;<span class="ident" id="4263660">i</span><span class="op" id="4263661">;</span>&nbsp;<span class="ident" id="4263663">j</span><span class="op" id="4263664">++</span>&nbsp;<span class="op" id="4263667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263672">b</span><span class="op" id="4263673">[</span><span class="ident" id="4263674">j</span><span class="op" id="4263675">]</span>&nbsp;<span class="op" id="4263677">=</span>&nbsp;<span class="string" id="4263679">&#39;A&#39;</span>&nbsp;<span class="op" id="4263683">+</span>&nbsp;<span class="builtintype" id="4263685">byte</span><span class="op" id="4263689">(</span><span class="ident" id="4263690">i</span><span class="op" id="4263691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263700">hashSHA1</span><span class="op" id="4263708">.</span><span class="ident" id="4263709">Reset</span><span class="op" id="4263714">(</span><span class="op" id="4263715">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263719">hashSHA1</span><span class="op" id="4263727">.</span><span class="ident" id="4263728">Write</span><span class="op" id="4263733">(</span><span class="ident" id="4263734">b</span><span class="op" id="4263735">[</span><span class="op" id="4263736">:</span><span class="ident" id="4263737">i</span><span class="op" id="4263738">+</span><span class="num" id="4263739">1</span><span class="op" id="4263740">]</span><span class="op" id="4263741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263745">hashSHA1</span><span class="op" id="4263753">.</span><span class="ident" id="4263754">Write</span><span class="op" id="4263759">(</span><span class="ident" id="4263760">secret</span><span class="op" id="4263766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263770">hashSHA1</span><span class="op" id="4263778">.</span><span class="ident" id="4263779">Write</span><span class="op" id="4263784">(</span><span class="ident" id="4263785">seed</span><span class="op" id="4263789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263793">digest</span>&nbsp;<span class="op" id="4263800">:=</span>&nbsp;<span class="ident" id="4263803">hashSHA1</span><span class="op" id="4263811">.</span><span class="ident" id="4263812">Sum</span><span class="op" id="4263815">(</span><span class="ident" id="4263816">nil</span><span class="op" id="4263819">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263824">hashMD5</span><span class="op" id="4263831">.</span><span class="ident" id="4263832">Reset</span><span class="op" id="4263837">(</span><span class="op" id="4263838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263842">hashMD5</span><span class="op" id="4263849">.</span><span class="ident" id="4263850">Write</span><span class="op" id="4263855">(</span><span class="ident" id="4263856">secret</span><span class="op" id="4263862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263866">hashMD5</span><span class="op" id="4263873">.</span><span class="ident" id="4263874">Write</span><span class="op" id="4263879">(</span><span class="ident" id="4263880">digest</span><span class="op" id="4263886">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263891">done</span>&nbsp;<span class="op" id="4263896">+=</span>&nbsp;<span class="builtinfunc" id="4263899">copy</span><span class="op" id="4263903">(</span><span class="ident" id="4263904">result</span><span class="op" id="4263910">[</span><span class="ident" id="4263911">done</span><span class="op" id="4263915">:</span><span class="op" id="4263916">]</span><span class="op" id="4263917">,</span>&nbsp;<span class="ident" id="4263919">hashMD5</span><span class="op" id="4263926">.</span><span class="ident" id="4263927">Sum</span><span class="op" id="4263930">(</span><span class="ident" id="4263931">nil</span><span class="op" id="4263934">)</span><span class="op" id="4263935">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263939">i</span><span class="op" id="4263940">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263944">}</span><br>
<span class="lineno"></span><span class="op" id="4263946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4263949">const</span>&nbsp;<span class="op" id="4263955">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263958">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263979">=</span>&nbsp;<span class="num" id="4263981">32</span>&nbsp;<span class="comment" id="4263984">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264025">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4264046">=</span>&nbsp;<span class="num" id="4264048">48</span>&nbsp;<span class="comment" id="4264051">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264093">finishedVerifyLength</span>&nbsp;<span class="op" id="4264114">=</span>&nbsp;<span class="num" id="4264116">12</span>&nbsp;<span class="comment" id="4264119">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="4264167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4264170">var</span>&nbsp;<span class="ident" id="4264174">masterSecretLabel</span>&nbsp;<span class="op" id="4264192">=</span>&nbsp;<span class="op" id="4264194">[</span><span class="op" id="4264195">]</span><span class="builtintype" id="4264196">byte</span><span class="op" id="4264200">(</span><span class="string" id="4264201">&#34;master&nbsp;secret&#34;</span><span class="op" id="4264216">)</span><br>
<span class="lineno"></span><span class="keyword" id="4264218">var</span>&nbsp;<span class="ident" id="4264222">keyExpansionLabel</span>&nbsp;<span class="op" id="4264240">=</span>&nbsp;<span class="op" id="4264242">[</span><span class="op" id="4264243">]</span><span class="builtintype" id="4264244">byte</span><span class="op" id="4264248">(</span><span class="string" id="4264249">&#34;key&nbsp;expansion&#34;</span><span class="op" id="4264264">)</span><br>
<span class="lineno"></span><span class="keyword" id="4264266">var</span>&nbsp;<span class="ident" id="4264270">clientFinishedLabel</span>&nbsp;<span class="op" id="4264290">=</span>&nbsp;<span class="op" id="4264292">[</span><span class="op" id="4264293">]</span><span class="builtintype" id="4264294">byte</span><span class="op" id="4264298">(</span><span class="string" id="4264299">&#34;client&nbsp;finished&#34;</span><span class="op" id="4264316">)</span><br>
<span class="lineno"></span><span class="keyword" id="4264318">var</span>&nbsp;<span class="ident" id="4264322">serverFinishedLabel</span>&nbsp;<span class="op" id="4264342">=</span>&nbsp;<span class="op" id="4264344">[</span><span class="op" id="4264345">]</span><span class="builtintype" id="4264346">byte</span><span class="op" id="4264350">(</span><span class="string" id="4264351">&#34;server&nbsp;finished&#34;</span><span class="op" id="4264368">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="4264371">func</span>&nbsp;<span class="ident" id="4264376">prfForVersion</span><span class="op" id="4264389">(</span><span class="ident" id="4264390">version</span>&nbsp;<span class="builtintype" id="4264398">uint16</span><span class="op" id="4264404">)</span>&nbsp;<span class="keyword" id="4264406">func</span><span class="op" id="4264410">(</span><span class="ident" id="4264411">result</span><span class="op" id="4264417">,</span>&nbsp;<span class="ident" id="4264419">secret</span><span class="op" id="4264425">,</span>&nbsp;<span class="ident" id="4264427">label</span><span class="op" id="4264432">,</span>&nbsp;<span class="ident" id="4264434">seed</span>&nbsp;<span class="op" id="4264439">[</span><span class="op" id="4264440">]</span><span class="builtintype" id="4264441">byte</span><span class="op" id="4264445">)</span>&nbsp;<span class="op" id="4264447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264450">switch</span>&nbsp;<span class="ident" id="4264457">version</span>&nbsp;<span class="op" id="4264465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264468">case</span>&nbsp;<span class="ident" id="4264473">VersionSSL30</span><span class="op" id="4264485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264489">return</span>&nbsp;<span class="ident" id="4264496">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264503">case</span>&nbsp;<span class="ident" id="4264508">VersionTLS10</span><span class="op" id="4264520">,</span>&nbsp;<span class="ident" id="4264522">VersionTLS11</span><span class="op" id="4264534">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264538">return</span>&nbsp;<span class="ident" id="4264545">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264552">case</span>&nbsp;<span class="ident" id="4264557">VersionTLS12</span><span class="op" id="4264569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264573">return</span>&nbsp;<span class="ident" id="4264580">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264587">default</span><span class="op" id="4264594">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4264598">panic</span><span class="op" id="4264603">(</span><span class="string" id="4264604">&#34;unknown&nbsp;version&#34;</span><span class="op" id="4264621">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264624">}</span><br>
<span class="lineno"></span><span class="op" id="4264626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4264629">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="4264706">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="4264768">func</span>&nbsp;<span class="ident" id="4264773">masterFromPreMasterSecret</span><span class="op" id="4264798">(</span><span class="ident" id="4264799">version</span>&nbsp;<span class="builtintype" id="4264807">uint16</span><span class="op" id="4264813">,</span>&nbsp;<span class="ident" id="4264815">preMasterSecret</span><span class="op" id="4264830">,</span>&nbsp;<span class="ident" id="4264832">clientRandom</span><span class="op" id="4264844">,</span>&nbsp;<span class="ident" id="4264846">serverRandom</span>&nbsp;<span class="op" id="4264859">[</span><span class="op" id="4264860">]</span><span class="builtintype" id="4264861">byte</span><span class="op" id="4264865">)</span>&nbsp;<span class="op" id="4264867">[</span><span class="op" id="4264868">]</span><span class="builtintype" id="4264869">byte</span>&nbsp;<span class="op" id="4264874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264877">var</span>&nbsp;<span class="ident" id="4264881">seed</span>&nbsp;<span class="op" id="4264886">[</span><span class="ident" id="4264887">tlsRandomLength</span>&nbsp;<span class="op" id="4264903">*</span>&nbsp;<span class="num" id="4264905">2</span><span class="op" id="4264906">]</span><span class="builtintype" id="4264907">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4264913">copy</span><span class="op" id="4264917">(</span><span class="ident" id="4264918">seed</span><span class="op" id="4264922">[</span><span class="num" id="4264923">0</span><span class="op" id="4264924">:</span><span class="builtinfunc" id="4264925">len</span><span class="op" id="4264928">(</span><span class="ident" id="4264929">clientRandom</span><span class="op" id="4264941">)</span><span class="op" id="4264942">]</span><span class="op" id="4264943">,</span>&nbsp;<span class="ident" id="4264945">clientRandom</span><span class="op" id="4264957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4264960">copy</span><span class="op" id="4264964">(</span><span class="ident" id="4264965">seed</span><span class="op" id="4264969">[</span><span class="builtinfunc" id="4264970">len</span><span class="op" id="4264973">(</span><span class="ident" id="4264974">clientRandom</span><span class="op" id="4264986">)</span><span class="op" id="4264987">:</span><span class="op" id="4264988">]</span><span class="op" id="4264989">,</span>&nbsp;<span class="ident" id="4264991">serverRandom</span><span class="op" id="4265003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265006">masterSecret</span>&nbsp;<span class="op" id="4265019">:=</span>&nbsp;<span class="builtinfunc" id="4265022">make</span><span class="op" id="4265026">(</span><span class="op" id="4265027">[</span><span class="op" id="4265028">]</span><span class="builtintype" id="4265029">byte</span><span class="op" id="4265033">,</span>&nbsp;<span class="ident" id="4265035">masterSecretLength</span><span class="op" id="4265053">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265056">prfForVersion</span><span class="op" id="4265069">(</span><span class="ident" id="4265070">version</span><span class="op" id="4265077">)</span><span class="op" id="4265078">(</span><span class="ident" id="4265079">masterSecret</span><span class="op" id="4265091">,</span>&nbsp;<span class="ident" id="4265093">preMasterSecret</span><span class="op" id="4265108">,</span>&nbsp;<span class="ident" id="4265110">masterSecretLabel</span><span class="op" id="4265127">,</span>&nbsp;<span class="ident" id="4265129">seed</span><span class="op" id="4265133">[</span><span class="num" id="4265134">0</span><span class="op" id="4265135">:</span><span class="op" id="4265136">]</span><span class="op" id="4265137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265140">return</span>&nbsp;<span class="ident" id="4265147">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="4265160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4265163">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="4265233">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4265311">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="4265337">func</span>&nbsp;<span class="ident" id="4265342">keysFromMasterSecret</span><span class="op" id="4265362">(</span><span class="ident" id="4265363">version</span>&nbsp;<span class="builtintype" id="4265371">uint16</span><span class="op" id="4265377">,</span>&nbsp;<span class="ident" id="4265379">masterSecret</span><span class="op" id="4265391">,</span>&nbsp;<span class="ident" id="4265393">clientRandom</span><span class="op" id="4265405">,</span>&nbsp;<span class="ident" id="4265407">serverRandom</span>&nbsp;<span class="op" id="4265420">[</span><span class="op" id="4265421">]</span><span class="builtintype" id="4265422">byte</span><span class="op" id="4265426">,</span>&nbsp;<span class="ident" id="4265428">macLen</span><span class="op" id="4265434">,</span>&nbsp;<span class="ident" id="4265436">keyLen</span><span class="op" id="4265442">,</span>&nbsp;<span class="ident" id="4265444">ivLen</span>&nbsp;<span class="builtintype" id="4265450">int</span><span class="op" id="4265453">)</span>&nbsp;<span class="op" id="4265455">(</span><span class="ident" id="4265456">clientMAC</span><span class="op" id="4265465">,</span>&nbsp;<span class="ident" id="4265467">serverMAC</span><span class="op" id="4265476">,</span>&nbsp;<span class="ident" id="4265478">clientKey</span><span class="op" id="4265487">,</span>&nbsp;<span class="ident" id="4265489">serverKey</span><span class="op" id="4265498">,</span>&nbsp;<span class="ident" id="4265500">clientIV</span><span class="op" id="4265508">,</span>&nbsp;<span class="ident" id="4265510">serverIV</span>&nbsp;<span class="op" id="4265519">[</span><span class="op" id="4265520">]</span><span class="builtintype" id="4265521">byte</span><span class="op" id="4265525">)</span>&nbsp;<span class="op" id="4265527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265530">var</span>&nbsp;<span class="ident" id="4265534">seed</span>&nbsp;<span class="op" id="4265539">[</span><span class="ident" id="4265540">tlsRandomLength</span>&nbsp;<span class="op" id="4265556">*</span>&nbsp;<span class="num" id="4265558">2</span><span class="op" id="4265559">]</span><span class="builtintype" id="4265560">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4265566">copy</span><span class="op" id="4265570">(</span><span class="ident" id="4265571">seed</span><span class="op" id="4265575">[</span><span class="num" id="4265576">0</span><span class="op" id="4265577">:</span><span class="builtinfunc" id="4265578">len</span><span class="op" id="4265581">(</span><span class="ident" id="4265582">clientRandom</span><span class="op" id="4265594">)</span><span class="op" id="4265595">]</span><span class="op" id="4265596">,</span>&nbsp;<span class="ident" id="4265598">serverRandom</span><span class="op" id="4265610">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4265613">copy</span><span class="op" id="4265617">(</span><span class="ident" id="4265618">seed</span><span class="op" id="4265622">[</span><span class="builtinfunc" id="4265623">len</span><span class="op" id="4265626">(</span><span class="ident" id="4265627">serverRandom</span><span class="op" id="4265639">)</span><span class="op" id="4265640">:</span><span class="op" id="4265641">]</span><span class="op" id="4265642">,</span>&nbsp;<span class="ident" id="4265644">clientRandom</span><span class="op" id="4265656">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265660">n</span>&nbsp;<span class="op" id="4265662">:=</span>&nbsp;<span class="num" id="4265665">2</span><span class="op" id="4265666">*</span><span class="ident" id="4265667">macLen</span>&nbsp;<span class="op" id="4265674">+</span>&nbsp;<span class="num" id="4265676">2</span><span class="op" id="4265677">*</span><span class="ident" id="4265678">keyLen</span>&nbsp;<span class="op" id="4265685">+</span>&nbsp;<span class="num" id="4265687">2</span><span class="op" id="4265688">*</span><span class="ident" id="4265689">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265696">keyMaterial</span>&nbsp;<span class="op" id="4265708">:=</span>&nbsp;<span class="builtinfunc" id="4265711">make</span><span class="op" id="4265715">(</span><span class="op" id="4265716">[</span><span class="op" id="4265717">]</span><span class="builtintype" id="4265718">byte</span><span class="op" id="4265722">,</span>&nbsp;<span class="ident" id="4265724">n</span><span class="op" id="4265725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265728">prfForVersion</span><span class="op" id="4265741">(</span><span class="ident" id="4265742">version</span><span class="op" id="4265749">)</span><span class="op" id="4265750">(</span><span class="ident" id="4265751">keyMaterial</span><span class="op" id="4265762">,</span>&nbsp;<span class="ident" id="4265764">masterSecret</span><span class="op" id="4265776">,</span>&nbsp;<span class="ident" id="4265778">keyExpansionLabel</span><span class="op" id="4265795">,</span>&nbsp;<span class="ident" id="4265797">seed</span><span class="op" id="4265801">[</span><span class="num" id="4265802">0</span><span class="op" id="4265803">:</span><span class="op" id="4265804">]</span><span class="op" id="4265805">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265808">clientMAC</span>&nbsp;<span class="op" id="4265818">=</span>&nbsp;<span class="ident" id="4265820">keyMaterial</span><span class="op" id="4265831">[</span><span class="op" id="4265832">:</span><span class="ident" id="4265833">macLen</span><span class="op" id="4265839">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265842">keyMaterial</span>&nbsp;<span class="op" id="4265854">=</span>&nbsp;<span class="ident" id="4265856">keyMaterial</span><span class="op" id="4265867">[</span><span class="ident" id="4265868">macLen</span><span class="op" id="4265874">:</span><span class="op" id="4265875">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265878">serverMAC</span>&nbsp;<span class="op" id="4265888">=</span>&nbsp;<span class="ident" id="4265890">keyMaterial</span><span class="op" id="4265901">[</span><span class="op" id="4265902">:</span><span class="ident" id="4265903">macLen</span><span class="op" id="4265909">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265912">keyMaterial</span>&nbsp;<span class="op" id="4265924">=</span>&nbsp;<span class="ident" id="4265926">keyMaterial</span><span class="op" id="4265937">[</span><span class="ident" id="4265938">macLen</span><span class="op" id="4265944">:</span><span class="op" id="4265945">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265948">clientKey</span>&nbsp;<span class="op" id="4265958">=</span>&nbsp;<span class="ident" id="4265960">keyMaterial</span><span class="op" id="4265971">[</span><span class="op" id="4265972">:</span><span class="ident" id="4265973">keyLen</span><span class="op" id="4265979">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265982">keyMaterial</span>&nbsp;<span class="op" id="4265994">=</span>&nbsp;<span class="ident" id="4265996">keyMaterial</span><span class="op" id="4266007">[</span><span class="ident" id="4266008">keyLen</span><span class="op" id="4266014">:</span><span class="op" id="4266015">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266018">serverKey</span>&nbsp;<span class="op" id="4266028">=</span>&nbsp;<span class="ident" id="4266030">keyMaterial</span><span class="op" id="4266041">[</span><span class="op" id="4266042">:</span><span class="ident" id="4266043">keyLen</span><span class="op" id="4266049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266052">keyMaterial</span>&nbsp;<span class="op" id="4266064">=</span>&nbsp;<span class="ident" id="4266066">keyMaterial</span><span class="op" id="4266077">[</span><span class="ident" id="4266078">keyLen</span><span class="op" id="4266084">:</span><span class="op" id="4266085">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266088">clientIV</span>&nbsp;<span class="op" id="4266097">=</span>&nbsp;<span class="ident" id="4266099">keyMaterial</span><span class="op" id="4266110">[</span><span class="op" id="4266111">:</span><span class="ident" id="4266112">ivLen</span><span class="op" id="4266117">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266120">keyMaterial</span>&nbsp;<span class="op" id="4266132">=</span>&nbsp;<span class="ident" id="4266134">keyMaterial</span><span class="op" id="4266145">[</span><span class="ident" id="4266146">ivLen</span><span class="op" id="4266151">:</span><span class="op" id="4266152">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266155">serverIV</span>&nbsp;<span class="op" id="4266164">=</span>&nbsp;<span class="ident" id="4266166">keyMaterial</span><span class="op" id="4266177">[</span><span class="op" id="4266178">:</span><span class="ident" id="4266179">ivLen</span><span class="op" id="4266184">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266187">return</span><br>
<span class="lineno"></span><span class="op" id="4266194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4266197">func</span>&nbsp;<span class="ident" id="4266202">newFinishedHash</span><span class="op" id="4266217">(</span><span class="ident" id="4266218">version</span>&nbsp;<span class="builtintype" id="4266226">uint16</span><span class="op" id="4266232">)</span>&nbsp;<span class="ident" id="4266234">finishedHash</span>&nbsp;<span class="op" id="4266247">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266250">if</span>&nbsp;<span class="ident" id="4266253">version</span>&nbsp;<span class="op" id="4266261">&gt;=</span>&nbsp;<span class="ident" id="4266264">VersionTLS12</span>&nbsp;<span class="op" id="4266277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266281">return</span>&nbsp;<span class="ident" id="4266288">finishedHash</span><span class="op" id="4266300">{</span><span class="ident" id="4266301">sha256</span><span class="op" id="4266307">.</span><span class="ident" id="4266308">New</span><span class="op" id="4266311">(</span><span class="op" id="4266312">)</span><span class="op" id="4266313">,</span>&nbsp;<span class="ident" id="4266315">sha256</span><span class="op" id="4266321">.</span><span class="ident" id="4266322">New</span><span class="op" id="4266325">(</span><span class="op" id="4266326">)</span><span class="op" id="4266327">,</span>&nbsp;<span class="ident" id="4266329">nil</span><span class="op" id="4266332">,</span>&nbsp;<span class="ident" id="4266334">nil</span><span class="op" id="4266337">,</span>&nbsp;<span class="ident" id="4266339">version</span><span class="op" id="4266346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266352">return</span>&nbsp;<span class="ident" id="4266359">finishedHash</span><span class="op" id="4266371">{</span><span class="ident" id="4266372">sha1</span><span class="op" id="4266376">.</span><span class="ident" id="4266377">New</span><span class="op" id="4266380">(</span><span class="op" id="4266381">)</span><span class="op" id="4266382">,</span>&nbsp;<span class="ident" id="4266384">sha1</span><span class="op" id="4266388">.</span><span class="ident" id="4266389">New</span><span class="op" id="4266392">(</span><span class="op" id="4266393">)</span><span class="op" id="4266394">,</span>&nbsp;<span class="ident" id="4266396">md5</span><span class="op" id="4266399">.</span><span class="ident" id="4266400">New</span><span class="op" id="4266403">(</span><span class="op" id="4266404">)</span><span class="op" id="4266405">,</span>&nbsp;<span class="ident" id="4266407">md5</span><span class="op" id="4266410">.</span><span class="ident" id="4266411">New</span><span class="op" id="4266414">(</span><span class="op" id="4266415">)</span><span class="op" id="4266416">,</span>&nbsp;<span class="ident" id="4266418">version</span><span class="op" id="4266425">}</span><br>
<span class="lineno"></span><span class="op" id="4266427">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4266430">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="4266508">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4266548">type</span>&nbsp;<span class="ident" id="4266553">finishedHash</span>&nbsp;<span class="keyword" id="4266566">struct</span>&nbsp;<span class="op" id="4266573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266576">client</span>&nbsp;<span class="ident" id="4266583">hash</span><span class="op" id="4266587">.</span><span class="ident" id="4266588">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266594">server</span>&nbsp;<span class="ident" id="4266601">hash</span><span class="op" id="4266605">.</span><span class="ident" id="4266606">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266613">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266671">clientMD5</span>&nbsp;<span class="ident" id="4266681">hash</span><span class="op" id="4266685">.</span><span class="ident" id="4266686">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266692">serverMD5</span>&nbsp;<span class="ident" id="4266702">hash</span><span class="op" id="4266706">.</span><span class="ident" id="4266707">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266714">version</span>&nbsp;<span class="builtintype" id="4266722">uint16</span><br>
<span class="lineno"></span><span class="op" id="4266729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4266732">func</span>&nbsp;<span class="op" id="4266737">(</span><span class="ident" id="4266738">h</span>&nbsp;<span class="ident" id="4266740">finishedHash</span><span class="op" id="4266752">)</span>&nbsp;<span class="ident" id="4266754">Write</span><span class="op" id="4266759">(</span><span class="ident" id="4266760">msg</span>&nbsp;<span class="op" id="4266764">[</span><span class="op" id="4266765">]</span><span class="builtintype" id="4266766">byte</span><span class="op" id="4266770">)</span>&nbsp;<span class="op" id="4266772">(</span><span class="ident" id="4266773">n</span>&nbsp;<span class="builtintype" id="4266775">int</span><span class="op" id="4266778">,</span>&nbsp;<span class="ident" id="4266780">err</span>&nbsp;<span class="builtintype" id="4266784">error</span><span class="op" id="4266789">)</span>&nbsp;<span class="op" id="4266791">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266794">h</span><span class="op" id="4266795">.</span><span class="ident" id="4266796">client</span><span class="op" id="4266802">.</span><span class="ident" id="4266803">Write</span><span class="op" id="4266808">(</span><span class="ident" id="4266809">msg</span><span class="op" id="4266812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266815">h</span><span class="op" id="4266816">.</span><span class="ident" id="4266817">server</span><span class="op" id="4266823">.</span><span class="ident" id="4266824">Write</span><span class="op" id="4266829">(</span><span class="ident" id="4266830">msg</span><span class="op" id="4266833">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266837">if</span>&nbsp;<span class="ident" id="4266840">h</span><span class="op" id="4266841">.</span><span class="ident" id="4266842">version</span>&nbsp;<span class="op" id="4266850">&lt;</span>&nbsp;<span class="ident" id="4266852">VersionTLS12</span>&nbsp;<span class="op" id="4266865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266869">h</span><span class="op" id="4266870">.</span><span class="ident" id="4266871">clientMD5</span><span class="op" id="4266880">.</span><span class="ident" id="4266881">Write</span><span class="op" id="4266886">(</span><span class="ident" id="4266887">msg</span><span class="op" id="4266890">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266894">h</span><span class="op" id="4266895">.</span><span class="ident" id="4266896">serverMD5</span><span class="op" id="4266905">.</span><span class="ident" id="4266906">Write</span><span class="op" id="4266911">(</span><span class="ident" id="4266912">msg</span><span class="op" id="4266915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266921">return</span>&nbsp;<span class="builtinfunc" id="4266928">len</span><span class="op" id="4266931">(</span><span class="ident" id="4266932">msg</span><span class="op" id="4266935">)</span><span class="op" id="4266936">,</span>&nbsp;<span class="ident" id="4266938">nil</span><br>
<span class="lineno"></span><span class="op" id="4266942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4266945">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="4267023">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="4267095">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="4267108">func</span>&nbsp;<span class="ident" id="4267113">finishedSum30</span><span class="op" id="4267126">(</span><span class="ident" id="4267127">md5</span><span class="op" id="4267130">,</span>&nbsp;<span class="ident" id="4267132">sha1</span>&nbsp;<span class="ident" id="4267137">hash</span><span class="op" id="4267141">.</span><span class="ident" id="4267142">Hash</span><span class="op" id="4267146">,</span>&nbsp;<span class="ident" id="4267148">masterSecret</span>&nbsp;<span class="op" id="4267161">[</span><span class="op" id="4267162">]</span><span class="builtintype" id="4267163">byte</span><span class="op" id="4267167">,</span>&nbsp;<span class="ident" id="4267169">magic</span>&nbsp;<span class="op" id="4267175">[</span><span class="num" id="4267176">4</span><span class="op" id="4267177">]</span><span class="builtintype" id="4267178">byte</span><span class="op" id="4267182">)</span>&nbsp;<span class="op" id="4267184">[</span><span class="op" id="4267185">]</span><span class="builtintype" id="4267186">byte</span>&nbsp;<span class="op" id="4267191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267194">md5</span><span class="op" id="4267197">.</span><span class="ident" id="4267198">Write</span><span class="op" id="4267203">(</span><span class="ident" id="4267204">magic</span><span class="op" id="4267209">[</span><span class="op" id="4267210">:</span><span class="op" id="4267211">]</span><span class="op" id="4267212">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267215">md5</span><span class="op" id="4267218">.</span><span class="ident" id="4267219">Write</span><span class="op" id="4267224">(</span><span class="ident" id="4267225">masterSecret</span><span class="op" id="4267237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267240">md5</span><span class="op" id="4267243">.</span><span class="ident" id="4267244">Write</span><span class="op" id="4267249">(</span><span class="ident" id="4267250">ssl30Pad1</span><span class="op" id="4267259">[</span><span class="op" id="4267260">:</span><span class="op" id="4267261">]</span><span class="op" id="4267262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267265">md5Digest</span>&nbsp;<span class="op" id="4267275">:=</span>&nbsp;<span class="ident" id="4267278">md5</span><span class="op" id="4267281">.</span><span class="ident" id="4267282">Sum</span><span class="op" id="4267285">(</span><span class="ident" id="4267286">nil</span><span class="op" id="4267289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267293">md5</span><span class="op" id="4267296">.</span><span class="ident" id="4267297">Reset</span><span class="op" id="4267302">(</span><span class="op" id="4267303">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267306">md5</span><span class="op" id="4267309">.</span><span class="ident" id="4267310">Write</span><span class="op" id="4267315">(</span><span class="ident" id="4267316">masterSecret</span><span class="op" id="4267328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267331">md5</span><span class="op" id="4267334">.</span><span class="ident" id="4267335">Write</span><span class="op" id="4267340">(</span><span class="ident" id="4267341">ssl30Pad2</span><span class="op" id="4267350">[</span><span class="op" id="4267351">:</span><span class="op" id="4267352">]</span><span class="op" id="4267353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267356">md5</span><span class="op" id="4267359">.</span><span class="ident" id="4267360">Write</span><span class="op" id="4267365">(</span><span class="ident" id="4267366">md5Digest</span><span class="op" id="4267375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267378">md5Digest</span>&nbsp;<span class="op" id="4267388">=</span>&nbsp;<span class="ident" id="4267390">md5</span><span class="op" id="4267393">.</span><span class="ident" id="4267394">Sum</span><span class="op" id="4267397">(</span><span class="ident" id="4267398">nil</span><span class="op" id="4267401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267405">sha1</span><span class="op" id="4267409">.</span><span class="ident" id="4267410">Write</span><span class="op" id="4267415">(</span><span class="ident" id="4267416">magic</span><span class="op" id="4267421">[</span><span class="op" id="4267422">:</span><span class="op" id="4267423">]</span><span class="op" id="4267424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267427">sha1</span><span class="op" id="4267431">.</span><span class="ident" id="4267432">Write</span><span class="op" id="4267437">(</span><span class="ident" id="4267438">masterSecret</span><span class="op" id="4267450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267453">sha1</span><span class="op" id="4267457">.</span><span class="ident" id="4267458">Write</span><span class="op" id="4267463">(</span><span class="ident" id="4267464">ssl30Pad1</span><span class="op" id="4267473">[</span><span class="op" id="4267474">:</span><span class="num" id="4267475">40</span><span class="op" id="4267477">]</span><span class="op" id="4267478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267481">sha1Digest</span>&nbsp;<span class="op" id="4267492">:=</span>&nbsp;<span class="ident" id="4267495">sha1</span><span class="op" id="4267499">.</span><span class="ident" id="4267500">Sum</span><span class="op" id="4267503">(</span><span class="ident" id="4267504">nil</span><span class="op" id="4267507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267511">sha1</span><span class="op" id="4267515">.</span><span class="ident" id="4267516">Reset</span><span class="op" id="4267521">(</span><span class="op" id="4267522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267525">sha1</span><span class="op" id="4267529">.</span><span class="ident" id="4267530">Write</span><span class="op" id="4267535">(</span><span class="ident" id="4267536">masterSecret</span><span class="op" id="4267548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267551">sha1</span><span class="op" id="4267555">.</span><span class="ident" id="4267556">Write</span><span class="op" id="4267561">(</span><span class="ident" id="4267562">ssl30Pad2</span><span class="op" id="4267571">[</span><span class="op" id="4267572">:</span><span class="num" id="4267573">40</span><span class="op" id="4267575">]</span><span class="op" id="4267576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267579">sha1</span><span class="op" id="4267583">.</span><span class="ident" id="4267584">Write</span><span class="op" id="4267589">(</span><span class="ident" id="4267590">sha1Digest</span><span class="op" id="4267600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267603">sha1Digest</span>&nbsp;<span class="op" id="4267614">=</span>&nbsp;<span class="ident" id="4267616">sha1</span><span class="op" id="4267620">.</span><span class="ident" id="4267621">Sum</span><span class="op" id="4267624">(</span><span class="ident" id="4267625">nil</span><span class="op" id="4267628">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4267632">ret</span>&nbsp;<span class="op" id="4267636">:=</span>&nbsp;<span class="builtinfunc" id="4267639">make</span><span class="op" id="4267643">(</span><span class="op" id="4267644">[</span><span class="op" id="4267645">]</span><span class="builtintype" id="4267646">byte</span><span class="op" id="4267650">,</span>&nbsp;<span class="builtinfunc" id="4267652">len</span><span class="op" id="4267655">(</span><span class="ident" id="4267656">md5Digest</span><span class="op" id="4267665">)</span><span class="op" id="4267666">+</span><span class="builtinfunc" id="4267667">len</span><span class="op" id="4267670">(</span><span class="ident" id="4267671">sha1Digest</span><span class="op" id="4267681">)</span><span class="op" id="4267682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4267685">copy</span><span class="op" id="4267689">(</span><span class="ident" id="4267690">ret</span><span class="op" id="4267693">,</span>&nbsp;<span class="ident" id="4267695">md5Digest</span><span class="op" id="4267704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4267707">copy</span><span class="op" id="4267711">(</span><span class="ident" id="4267712">ret</span><span class="op" id="4267715">[</span><span class="builtinfunc" id="4267716">len</span><span class="op" id="4267719">(</span><span class="ident" id="4267720">md5Digest</span><span class="op" id="4267729">)</span><span class="op" id="4267730">:</span><span class="op" id="4267731">]</span><span class="op" id="4267732">,</span>&nbsp;<span class="ident" id="4267734">sha1Digest</span><span class="op" id="4267744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267747">return</span>&nbsp;<span class="ident" id="4267754">ret</span><br>
<span class="lineno">230</span><span class="op" id="4267758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4267761">var</span>&nbsp;<span class="ident" id="4267765">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="4267789">=</span>&nbsp;<span class="op" id="4267791">[</span><span class="num" id="4267792">4</span><span class="op" id="4267793">]</span><span class="builtintype" id="4267794">byte</span><span class="op" id="4267798">{</span><span class="num" id="4267799">0x43</span><span class="op" id="4267803">,</span>&nbsp;<span class="num" id="4267805">0x4c</span><span class="op" id="4267809">,</span>&nbsp;<span class="num" id="4267811">0x4e</span><span class="op" id="4267815">,</span>&nbsp;<span class="num" id="4267817">0x54</span><span class="op" id="4267821">}</span><br>
<span class="lineno"></span><span class="keyword" id="4267823">var</span>&nbsp;<span class="ident" id="4267827">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="4267851">=</span>&nbsp;<span class="op" id="4267853">[</span><span class="num" id="4267854">4</span><span class="op" id="4267855">]</span><span class="builtintype" id="4267856">byte</span><span class="op" id="4267860">{</span><span class="num" id="4267861">0x53</span><span class="op" id="4267865">,</span>&nbsp;<span class="num" id="4267867">0x52</span><span class="op" id="4267871">,</span>&nbsp;<span class="num" id="4267873">0x56</span><span class="op" id="4267877">,</span>&nbsp;<span class="num" id="4267879">0x52</span><span class="op" id="4267883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4267886">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4267960">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4267981">func</span>&nbsp;<span class="op" id="4267986">(</span><span class="ident" id="4267987">h</span>&nbsp;<span class="ident" id="4267989">finishedHash</span><span class="op" id="4268001">)</span>&nbsp;<span class="ident" id="4268003">clientSum</span><span class="op" id="4268012">(</span><span class="ident" id="4268013">masterSecret</span>&nbsp;<span class="op" id="4268026">[</span><span class="op" id="4268027">]</span><span class="builtintype" id="4268028">byte</span><span class="op" id="4268032">)</span>&nbsp;<span class="op" id="4268034">[</span><span class="op" id="4268035">]</span><span class="builtintype" id="4268036">byte</span>&nbsp;<span class="op" id="4268041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268044">if</span>&nbsp;<span class="ident" id="4268047">h</span><span class="op" id="4268048">.</span><span class="ident" id="4268049">version</span>&nbsp;<span class="op" id="4268057">==</span>&nbsp;<span class="ident" id="4268060">VersionSSL30</span>&nbsp;<span class="op" id="4268073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268077">return</span>&nbsp;<span class="ident" id="4268084">finishedSum30</span><span class="op" id="4268097">(</span><span class="ident" id="4268098">h</span><span class="op" id="4268099">.</span><span class="ident" id="4268100">clientMD5</span><span class="op" id="4268109">,</span>&nbsp;<span class="ident" id="4268111">h</span><span class="op" id="4268112">.</span><span class="ident" id="4268113">client</span><span class="op" id="4268119">,</span>&nbsp;<span class="ident" id="4268121">masterSecret</span><span class="op" id="4268133">,</span>&nbsp;<span class="ident" id="4268135">ssl3ClientFinishedMagic</span><span class="op" id="4268158">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268165">out</span>&nbsp;<span class="op" id="4268169">:=</span>&nbsp;<span class="builtinfunc" id="4268172">make</span><span class="op" id="4268176">(</span><span class="op" id="4268177">[</span><span class="op" id="4268178">]</span><span class="builtintype" id="4268179">byte</span><span class="op" id="4268183">,</span>&nbsp;<span class="ident" id="4268185">finishedVerifyLength</span><span class="op" id="4268205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268208">if</span>&nbsp;<span class="ident" id="4268211">h</span><span class="op" id="4268212">.</span><span class="ident" id="4268213">version</span>&nbsp;<span class="op" id="4268221">&gt;=</span>&nbsp;<span class="ident" id="4268224">VersionTLS12</span>&nbsp;<span class="op" id="4268237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268241">seed</span>&nbsp;<span class="op" id="4268246">:=</span>&nbsp;<span class="ident" id="4268249">h</span><span class="op" id="4268250">.</span><span class="ident" id="4268251">client</span><span class="op" id="4268257">.</span><span class="ident" id="4268258">Sum</span><span class="op" id="4268261">(</span><span class="ident" id="4268262">nil</span><span class="op" id="4268265">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268269">prf12</span><span class="op" id="4268274">(</span><span class="ident" id="4268275">out</span><span class="op" id="4268278">,</span>&nbsp;<span class="ident" id="4268280">masterSecret</span><span class="op" id="4268292">,</span>&nbsp;<span class="ident" id="4268294">clientFinishedLabel</span><span class="op" id="4268313">,</span>&nbsp;<span class="ident" id="4268315">seed</span><span class="op" id="4268319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268322">}</span>&nbsp;<span class="keyword" id="4268324">else</span>&nbsp;<span class="op" id="4268329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268333">seed</span>&nbsp;<span class="op" id="4268338">:=</span>&nbsp;<span class="builtinfunc" id="4268341">make</span><span class="op" id="4268345">(</span><span class="op" id="4268346">[</span><span class="op" id="4268347">]</span><span class="builtintype" id="4268348">byte</span><span class="op" id="4268352">,</span>&nbsp;<span class="num" id="4268354">0</span><span class="op" id="4268355">,</span>&nbsp;<span class="ident" id="4268357">md5</span><span class="op" id="4268360">.</span><span class="ident" id="4268361">Size</span><span class="op" id="4268365">+</span><span class="ident" id="4268366">sha1</span><span class="op" id="4268370">.</span><span class="ident" id="4268371">Size</span><span class="op" id="4268375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268379">seed</span>&nbsp;<span class="op" id="4268384">=</span>&nbsp;<span class="ident" id="4268386">h</span><span class="op" id="4268387">.</span><span class="ident" id="4268388">clientMD5</span><span class="op" id="4268397">.</span><span class="ident" id="4268398">Sum</span><span class="op" id="4268401">(</span><span class="ident" id="4268402">seed</span><span class="op" id="4268406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268410">seed</span>&nbsp;<span class="op" id="4268415">=</span>&nbsp;<span class="ident" id="4268417">h</span><span class="op" id="4268418">.</span><span class="ident" id="4268419">client</span><span class="op" id="4268425">.</span><span class="ident" id="4268426">Sum</span><span class="op" id="4268429">(</span><span class="ident" id="4268430">seed</span><span class="op" id="4268434">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268438">prf10</span><span class="op" id="4268443">(</span><span class="ident" id="4268444">out</span><span class="op" id="4268447">,</span>&nbsp;<span class="ident" id="4268449">masterSecret</span><span class="op" id="4268461">,</span>&nbsp;<span class="ident" id="4268463">clientFinishedLabel</span><span class="op" id="4268482">,</span>&nbsp;<span class="ident" id="4268484">seed</span><span class="op" id="4268488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268494">return</span>&nbsp;<span class="ident" id="4268501">out</span><br>
<span class="lineno"></span><span class="op" id="4268505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4268508">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4268582">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4268603">func</span>&nbsp;<span class="op" id="4268608">(</span><span class="ident" id="4268609">h</span>&nbsp;<span class="ident" id="4268611">finishedHash</span><span class="op" id="4268623">)</span>&nbsp;<span class="ident" id="4268625">serverSum</span><span class="op" id="4268634">(</span><span class="ident" id="4268635">masterSecret</span>&nbsp;<span class="op" id="4268648">[</span><span class="op" id="4268649">]</span><span class="builtintype" id="4268650">byte</span><span class="op" id="4268654">)</span>&nbsp;<span class="op" id="4268656">[</span><span class="op" id="4268657">]</span><span class="builtintype" id="4268658">byte</span>&nbsp;<span class="op" id="4268663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268666">if</span>&nbsp;<span class="ident" id="4268669">h</span><span class="op" id="4268670">.</span><span class="ident" id="4268671">version</span>&nbsp;<span class="op" id="4268679">==</span>&nbsp;<span class="ident" id="4268682">VersionSSL30</span>&nbsp;<span class="op" id="4268695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268699">return</span>&nbsp;<span class="ident" id="4268706">finishedSum30</span><span class="op" id="4268719">(</span><span class="ident" id="4268720">h</span><span class="op" id="4268721">.</span><span class="ident" id="4268722">serverMD5</span><span class="op" id="4268731">,</span>&nbsp;<span class="ident" id="4268733">h</span><span class="op" id="4268734">.</span><span class="ident" id="4268735">server</span><span class="op" id="4268741">,</span>&nbsp;<span class="ident" id="4268743">masterSecret</span><span class="op" id="4268755">,</span>&nbsp;<span class="ident" id="4268757">ssl3ServerFinishedMagic</span><span class="op" id="4268780">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268787">out</span>&nbsp;<span class="op" id="4268791">:=</span>&nbsp;<span class="builtinfunc" id="4268794">make</span><span class="op" id="4268798">(</span><span class="op" id="4268799">[</span><span class="op" id="4268800">]</span><span class="builtintype" id="4268801">byte</span><span class="op" id="4268805">,</span>&nbsp;<span class="ident" id="4268807">finishedVerifyLength</span><span class="op" id="4268827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268830">if</span>&nbsp;<span class="ident" id="4268833">h</span><span class="op" id="4268834">.</span><span class="ident" id="4268835">version</span>&nbsp;<span class="op" id="4268843">&gt;=</span>&nbsp;<span class="ident" id="4268846">VersionTLS12</span>&nbsp;<span class="op" id="4268859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268863">seed</span>&nbsp;<span class="op" id="4268868">:=</span>&nbsp;<span class="ident" id="4268871">h</span><span class="op" id="4268872">.</span><span class="ident" id="4268873">server</span><span class="op" id="4268879">.</span><span class="ident" id="4268880">Sum</span><span class="op" id="4268883">(</span><span class="ident" id="4268884">nil</span><span class="op" id="4268887">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268891">prf12</span><span class="op" id="4268896">(</span><span class="ident" id="4268897">out</span><span class="op" id="4268900">,</span>&nbsp;<span class="ident" id="4268902">masterSecret</span><span class="op" id="4268914">,</span>&nbsp;<span class="ident" id="4268916">serverFinishedLabel</span><span class="op" id="4268935">,</span>&nbsp;<span class="ident" id="4268937">seed</span><span class="op" id="4268941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268944">}</span>&nbsp;<span class="keyword" id="4268946">else</span>&nbsp;<span class="op" id="4268951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268955">seed</span>&nbsp;<span class="op" id="4268960">:=</span>&nbsp;<span class="builtinfunc" id="4268963">make</span><span class="op" id="4268967">(</span><span class="op" id="4268968">[</span><span class="op" id="4268969">]</span><span class="builtintype" id="4268970">byte</span><span class="op" id="4268974">,</span>&nbsp;<span class="num" id="4268976">0</span><span class="op" id="4268977">,</span>&nbsp;<span class="ident" id="4268979">md5</span><span class="op" id="4268982">.</span><span class="ident" id="4268983">Size</span><span class="op" id="4268987">+</span><span class="ident" id="4268988">sha1</span><span class="op" id="4268992">.</span><span class="ident" id="4268993">Size</span><span class="op" id="4268997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269001">seed</span>&nbsp;<span class="op" id="4269006">=</span>&nbsp;<span class="ident" id="4269008">h</span><span class="op" id="4269009">.</span><span class="ident" id="4269010">serverMD5</span><span class="op" id="4269019">.</span><span class="ident" id="4269020">Sum</span><span class="op" id="4269023">(</span><span class="ident" id="4269024">seed</span><span class="op" id="4269028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269032">seed</span>&nbsp;<span class="op" id="4269037">=</span>&nbsp;<span class="ident" id="4269039">h</span><span class="op" id="4269040">.</span><span class="ident" id="4269041">server</span><span class="op" id="4269047">.</span><span class="ident" id="4269048">Sum</span><span class="op" id="4269051">(</span><span class="ident" id="4269052">seed</span><span class="op" id="4269056">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269060">prf10</span><span class="op" id="4269065">(</span><span class="ident" id="4269066">out</span><span class="op" id="4269069">,</span>&nbsp;<span class="ident" id="4269071">masterSecret</span><span class="op" id="4269083">,</span>&nbsp;<span class="ident" id="4269085">serverFinishedLabel</span><span class="op" id="4269104">,</span>&nbsp;<span class="ident" id="4269106">seed</span><span class="op" id="4269110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269116">return</span>&nbsp;<span class="ident" id="4269123">out</span><br>
<span class="lineno"></span><span class="op" id="4269127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="4269130">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4269208">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4269264">func</span>&nbsp;<span class="op" id="4269269">(</span><span class="ident" id="4269270">h</span>&nbsp;<span class="ident" id="4269272">finishedHash</span><span class="op" id="4269284">)</span>&nbsp;<span class="ident" id="4269286">hashForClientCertificate</span><span class="op" id="4269310">(</span><span class="ident" id="4269311">sigType</span>&nbsp;<span class="builtintype" id="4269319">uint8</span><span class="op" id="4269324">)</span>&nbsp;<span class="op" id="4269326">(</span><span class="op" id="4269327">[</span><span class="op" id="4269328">]</span><span class="builtintype" id="4269329">byte</span><span class="op" id="4269333">,</span>&nbsp;<span class="ident" id="4269335">crypto</span><span class="op" id="4269341">.</span><span class="ident" id="4269342">Hash</span><span class="op" id="4269346">,</span>&nbsp;<span class="builtintype" id="4269348">uint8</span><span class="op" id="4269353">)</span>&nbsp;<span class="op" id="4269355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269358">if</span>&nbsp;<span class="ident" id="4269361">h</span><span class="op" id="4269362">.</span><span class="ident" id="4269363">version</span>&nbsp;<span class="op" id="4269371">&gt;=</span>&nbsp;<span class="ident" id="4269374">VersionTLS12</span>&nbsp;<span class="op" id="4269387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269391">digest</span>&nbsp;<span class="op" id="4269398">:=</span>&nbsp;<span class="ident" id="4269401">h</span><span class="op" id="4269402">.</span><span class="ident" id="4269403">server</span><span class="op" id="4269409">.</span><span class="ident" id="4269410">Sum</span><span class="op" id="4269413">(</span><span class="ident" id="4269414">nil</span><span class="op" id="4269417">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269421">return</span>&nbsp;<span class="ident" id="4269428">digest</span><span class="op" id="4269434">,</span>&nbsp;<span class="ident" id="4269436">crypto</span><span class="op" id="4269442">.</span><span class="ident" id="4269443">SHA256</span><span class="op" id="4269449">,</span>&nbsp;<span class="ident" id="4269451">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269466">if</span>&nbsp;<span class="ident" id="4269469">sigType</span>&nbsp;<span class="op" id="4269477">==</span>&nbsp;<span class="ident" id="4269480">signatureECDSA</span>&nbsp;<span class="op" id="4269495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269499">digest</span>&nbsp;<span class="op" id="4269506">:=</span>&nbsp;<span class="ident" id="4269509">h</span><span class="op" id="4269510">.</span><span class="ident" id="4269511">server</span><span class="op" id="4269517">.</span><span class="ident" id="4269518">Sum</span><span class="op" id="4269521">(</span><span class="ident" id="4269522">nil</span><span class="op" id="4269525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269529">return</span>&nbsp;<span class="ident" id="4269536">digest</span><span class="op" id="4269542">,</span>&nbsp;<span class="ident" id="4269544">crypto</span><span class="op" id="4269550">.</span><span class="ident" id="4269551">SHA1</span><span class="op" id="4269555">,</span>&nbsp;<span class="ident" id="4269557">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269571">digest</span>&nbsp;<span class="op" id="4269578">:=</span>&nbsp;<span class="builtinfunc" id="4269581">make</span><span class="op" id="4269585">(</span><span class="op" id="4269586">[</span><span class="op" id="4269587">]</span><span class="builtintype" id="4269588">byte</span><span class="op" id="4269592">,</span>&nbsp;<span class="num" id="4269594">0</span><span class="op" id="4269595">,</span>&nbsp;<span class="num" id="4269597">36</span><span class="op" id="4269599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269602">digest</span>&nbsp;<span class="op" id="4269609">=</span>&nbsp;<span class="ident" id="4269611">h</span><span class="op" id="4269612">.</span><span class="ident" id="4269613">serverMD5</span><span class="op" id="4269622">.</span><span class="ident" id="4269623">Sum</span><span class="op" id="4269626">(</span><span class="ident" id="4269627">digest</span><span class="op" id="4269633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269636">digest</span>&nbsp;<span class="op" id="4269643">=</span>&nbsp;<span class="ident" id="4269645">h</span><span class="op" id="4269646">.</span><span class="ident" id="4269647">server</span><span class="op" id="4269653">.</span><span class="ident" id="4269654">Sum</span><span class="op" id="4269657">(</span><span class="ident" id="4269658">digest</span><span class="op" id="4269664">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269667">return</span>&nbsp;<span class="ident" id="4269674">digest</span><span class="op" id="4269680">,</span>&nbsp;<span class="ident" id="4269682">crypto</span><span class="op" id="4269688">.</span><span class="ident" id="4269689">MD5SHA1</span><span class="op" id="4269696">,</span>&nbsp;<span class="num" id="4269698">0</span>&nbsp;<span class="comment" id="4269700">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="4269732">}</span>
</div>
</body>
</html>
