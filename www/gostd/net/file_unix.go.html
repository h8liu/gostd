<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html" class="current">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3256780">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3256835">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3256889">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3256940">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3257005">package</span>&nbsp;<span class="ident" id="3257013">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3257018">import</span>&nbsp;<span class="op" id="3257025">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3257028">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3257034">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3257044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3257047">func</span>&nbsp;<span class="ident" id="3257052">newFileFD</span><span class="op" id="3257061">(</span><span class="ident" id="3257062">f</span>&nbsp;<span class="op" id="3257064">*</span><span class="ident" id="3257065">os</span><span class="op" id="3257067">.</span><span class="ident" id="3257068">File</span><span class="op" id="3257072">)</span>&nbsp;<span class="op" id="3257074">(</span><span class="op" id="3257075">*</span><span class="ident" id="3257076">netFD</span><span class="op" id="3257081">,</span>&nbsp;<span class="builtintype" id="3257083">error</span><span class="op" id="3257088">)</span>&nbsp;<span class="op" id="3257090">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257093">fd</span><span class="op" id="3257095">,</span>&nbsp;<span class="ident" id="3257097">err</span>&nbsp;<span class="op" id="3257101">:=</span>&nbsp;<span class="ident" id="3257104">dupCloseOnExec</span><span class="op" id="3257118">(</span><span class="builtintype" id="3257119">int</span><span class="op" id="3257122">(</span><span class="ident" id="3257123">f</span><span class="op" id="3257124">.</span><span class="ident" id="3257125">Fd</span><span class="op" id="3257127">(</span><span class="op" id="3257128">)</span><span class="op" id="3257129">)</span><span class="op" id="3257130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257133">if</span>&nbsp;<span class="ident" id="3257136">err</span>&nbsp;<span class="op" id="3257140">!=</span>&nbsp;<span class="builtintype" id="3257143">nil</span>&nbsp;<span class="op" id="3257147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257151">return</span>&nbsp;<span class="builtintype" id="3257158">nil</span><span class="op" id="3257161">,</span>&nbsp;<span class="ident" id="3257163">os</span><span class="op" id="3257165">.</span><span class="ident" id="3257166">NewSyscallError</span><span class="op" id="3257181">(</span><span class="string" id="3257182">&#34;dup&#34;</span><span class="op" id="3257187">,</span>&nbsp;<span class="ident" id="3257189">err</span><span class="op" id="3257192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257199">if</span>&nbsp;<span class="ident" id="3257202">err</span>&nbsp;<span class="op" id="3257206">=</span>&nbsp;<span class="ident" id="3257208">syscall</span><span class="op" id="3257215">.</span><span class="ident" id="3257216">SetNonblock</span><span class="op" id="3257227">(</span><span class="ident" id="3257228">fd</span><span class="op" id="3257230">,</span>&nbsp;<span class="builtintype" id="3257232">true</span><span class="op" id="3257236">)</span><span class="op" id="3257237">;</span>&nbsp;<span class="ident" id="3257239">err</span>&nbsp;<span class="op" id="3257243">!=</span>&nbsp;<span class="builtintype" id="3257246">nil</span>&nbsp;<span class="op" id="3257250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257254">closesocket</span><span class="op" id="3257265">(</span><span class="ident" id="3257266">fd</span><span class="op" id="3257268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257272">return</span>&nbsp;<span class="builtintype" id="3257279">nil</span><span class="op" id="3257282">,</span>&nbsp;<span class="ident" id="3257284">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257293">sotype</span><span class="op" id="3257299">,</span>&nbsp;<span class="ident" id="3257301">err</span>&nbsp;<span class="op" id="3257305">:=</span>&nbsp;<span class="ident" id="3257308">syscall</span><span class="op" id="3257315">.</span><span class="ident" id="3257316">GetsockoptInt</span><span class="op" id="3257329">(</span><span class="ident" id="3257330">fd</span><span class="op" id="3257332">,</span>&nbsp;<span class="ident" id="3257334">syscall</span><span class="op" id="3257341">.</span><span class="ident" id="3257342">SOL_SOCKET</span><span class="op" id="3257352">,</span>&nbsp;<span class="ident" id="3257354">syscall</span><span class="op" id="3257361">.</span><span class="ident" id="3257362">SO_TYPE</span><span class="op" id="3257369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257372">if</span>&nbsp;<span class="ident" id="3257375">err</span>&nbsp;<span class="op" id="3257379">!=</span>&nbsp;<span class="builtintype" id="3257382">nil</span>&nbsp;<span class="op" id="3257386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257390">closesocket</span><span class="op" id="3257401">(</span><span class="ident" id="3257402">fd</span><span class="op" id="3257404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257408">return</span>&nbsp;<span class="builtintype" id="3257415">nil</span><span class="op" id="3257418">,</span>&nbsp;<span class="ident" id="3257420">os</span><span class="op" id="3257422">.</span><span class="ident" id="3257423">NewSyscallError</span><span class="op" id="3257438">(</span><span class="string" id="3257439">&#34;getsockopt&#34;</span><span class="op" id="3257451">,</span>&nbsp;<span class="ident" id="3257453">err</span><span class="op" id="3257456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257459">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257463">family</span>&nbsp;<span class="op" id="3257470">:=</span>&nbsp;<span class="ident" id="3257473">syscall</span><span class="op" id="3257480">.</span><span class="ident" id="3257481">AF_UNSPEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257492">toAddr</span>&nbsp;<span class="op" id="3257499">:=</span>&nbsp;<span class="ident" id="3257502">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257517">lsa</span><span class="op" id="3257520">,</span>&nbsp;<span class="ident" id="3257522">_</span>&nbsp;<span class="op" id="3257524">:=</span>&nbsp;<span class="ident" id="3257527">syscall</span><span class="op" id="3257534">.</span><span class="ident" id="3257535">Getsockname</span><span class="op" id="3257546">(</span><span class="ident" id="3257547">fd</span><span class="op" id="3257549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257552">switch</span>&nbsp;<span class="ident" id="3257559">lsa</span><span class="op" id="3257562">.</span><span class="op" id="3257563">(</span><span class="keyword" id="3257564">type</span><span class="op" id="3257568">)</span>&nbsp;<span class="op" id="3257570">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257573">default</span><span class="op" id="3257580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257584">closesocket</span><span class="op" id="3257595">(</span><span class="ident" id="3257596">fd</span><span class="op" id="3257598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257602">return</span>&nbsp;<span class="builtintype" id="3257609">nil</span><span class="op" id="3257612">,</span>&nbsp;<span class="ident" id="3257614">syscall</span><span class="op" id="3257621">.</span><span class="ident" id="3257622">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257630">case</span>&nbsp;<span class="op" id="3257635">*</span><span class="ident" id="3257636">syscall</span><span class="op" id="3257643">.</span><span class="ident" id="3257644">SockaddrInet4</span><span class="op" id="3257657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257661">family</span>&nbsp;<span class="op" id="3257668">=</span>&nbsp;<span class="ident" id="3257670">syscall</span><span class="op" id="3257677">.</span><span class="ident" id="3257678">AF_INET</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257688">if</span>&nbsp;<span class="ident" id="3257691">sotype</span>&nbsp;<span class="op" id="3257698">==</span>&nbsp;<span class="ident" id="3257701">syscall</span><span class="op" id="3257708">.</span><span class="ident" id="3257709">SOCK_DGRAM</span>&nbsp;<span class="op" id="3257720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257725">toAddr</span>&nbsp;<span class="op" id="3257732">=</span>&nbsp;<span class="ident" id="3257734">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257750">}</span>&nbsp;<span class="keyword" id="3257752">else</span>&nbsp;<span class="keyword" id="3257757">if</span>&nbsp;<span class="ident" id="3257760">sotype</span>&nbsp;<span class="op" id="3257767">==</span>&nbsp;<span class="ident" id="3257770">syscall</span><span class="op" id="3257777">.</span><span class="ident" id="3257778">SOCK_RAW</span>&nbsp;<span class="op" id="3257787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257792">toAddr</span>&nbsp;<span class="op" id="3257799">=</span>&nbsp;<span class="ident" id="3257801">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257816">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257819">case</span>&nbsp;<span class="op" id="3257824">*</span><span class="ident" id="3257825">syscall</span><span class="op" id="3257832">.</span><span class="ident" id="3257833">SockaddrInet6</span><span class="op" id="3257846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257850">family</span>&nbsp;<span class="op" id="3257857">=</span>&nbsp;<span class="ident" id="3257859">syscall</span><span class="op" id="3257866">.</span><span class="ident" id="3257867">AF_INET6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257878">if</span>&nbsp;<span class="ident" id="3257881">sotype</span>&nbsp;<span class="op" id="3257888">==</span>&nbsp;<span class="ident" id="3257891">syscall</span><span class="op" id="3257898">.</span><span class="ident" id="3257899">SOCK_DGRAM</span>&nbsp;<span class="op" id="3257910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257915">toAddr</span>&nbsp;<span class="op" id="3257922">=</span>&nbsp;<span class="ident" id="3257924">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3257940">}</span>&nbsp;<span class="keyword" id="3257942">else</span>&nbsp;<span class="keyword" id="3257947">if</span>&nbsp;<span class="ident" id="3257950">sotype</span>&nbsp;<span class="op" id="3257957">==</span>&nbsp;<span class="ident" id="3257960">syscall</span><span class="op" id="3257967">.</span><span class="ident" id="3257968">SOCK_RAW</span>&nbsp;<span class="op" id="3257977">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257982">toAddr</span>&nbsp;<span class="op" id="3257989">=</span>&nbsp;<span class="ident" id="3257991">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258009">case</span>&nbsp;<span class="op" id="3258014">*</span><span class="ident" id="3258015">syscall</span><span class="op" id="3258022">.</span><span class="ident" id="3258023">SockaddrUnix</span><span class="op" id="3258035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258039">family</span>&nbsp;<span class="op" id="3258046">=</span>&nbsp;<span class="ident" id="3258048">syscall</span><span class="op" id="3258055">.</span><span class="ident" id="3258056">AF_UNIX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258066">toAddr</span>&nbsp;<span class="op" id="3258073">=</span>&nbsp;<span class="ident" id="3258075">sockaddrToUnix</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258092">if</span>&nbsp;<span class="ident" id="3258095">sotype</span>&nbsp;<span class="op" id="3258102">==</span>&nbsp;<span class="ident" id="3258105">syscall</span><span class="op" id="3258112">.</span><span class="ident" id="3258113">SOCK_DGRAM</span>&nbsp;<span class="op" id="3258124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258129">toAddr</span>&nbsp;<span class="op" id="3258136">=</span>&nbsp;<span class="ident" id="3258138">sockaddrToUnixgram</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258159">}</span>&nbsp;<span class="keyword" id="3258161">else</span>&nbsp;<span class="keyword" id="3258166">if</span>&nbsp;<span class="ident" id="3258169">sotype</span>&nbsp;<span class="op" id="3258176">==</span>&nbsp;<span class="ident" id="3258179">syscall</span><span class="op" id="3258186">.</span><span class="ident" id="3258187">SOCK_SEQPACKET</span>&nbsp;<span class="op" id="3258202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258207">toAddr</span>&nbsp;<span class="op" id="3258214">=</span>&nbsp;<span class="ident" id="3258216">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258239">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258245">laddr</span>&nbsp;<span class="op" id="3258251">:=</span>&nbsp;<span class="ident" id="3258254">toAddr</span><span class="op" id="3258260">(</span><span class="ident" id="3258261">lsa</span><span class="op" id="3258264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258267">rsa</span><span class="op" id="3258270">,</span>&nbsp;<span class="ident" id="3258272">_</span>&nbsp;<span class="op" id="3258274">:=</span>&nbsp;<span class="ident" id="3258277">syscall</span><span class="op" id="3258284">.</span><span class="ident" id="3258285">Getpeername</span><span class="op" id="3258296">(</span><span class="ident" id="3258297">fd</span><span class="op" id="3258299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258302">raddr</span>&nbsp;<span class="op" id="3258308">:=</span>&nbsp;<span class="ident" id="3258311">toAddr</span><span class="op" id="3258317">(</span><span class="ident" id="3258318">rsa</span><span class="op" id="3258321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258325">netfd</span><span class="op" id="3258330">,</span>&nbsp;<span class="ident" id="3258332">err</span>&nbsp;<span class="op" id="3258336">:=</span>&nbsp;<span class="ident" id="3258339">newFD</span><span class="op" id="3258344">(</span><span class="ident" id="3258345">fd</span><span class="op" id="3258347">,</span>&nbsp;<span class="ident" id="3258349">family</span><span class="op" id="3258355">,</span>&nbsp;<span class="ident" id="3258357">sotype</span><span class="op" id="3258363">,</span>&nbsp;<span class="ident" id="3258365">laddr</span><span class="op" id="3258370">.</span><span class="ident" id="3258371">Network</span><span class="op" id="3258378">(</span><span class="op" id="3258379">)</span><span class="op" id="3258380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258383">if</span>&nbsp;<span class="ident" id="3258386">err</span>&nbsp;<span class="op" id="3258390">!=</span>&nbsp;<span class="builtintype" id="3258393">nil</span>&nbsp;<span class="op" id="3258397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258401">closesocket</span><span class="op" id="3258412">(</span><span class="ident" id="3258413">fd</span><span class="op" id="3258415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258419">return</span>&nbsp;<span class="builtintype" id="3258426">nil</span><span class="op" id="3258429">,</span>&nbsp;<span class="ident" id="3258431">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258436">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258439">if</span>&nbsp;<span class="ident" id="3258442">err</span>&nbsp;<span class="op" id="3258446">:=</span>&nbsp;<span class="ident" id="3258449">netfd</span><span class="op" id="3258454">.</span><span class="ident" id="3258455">init</span><span class="op" id="3258459">(</span><span class="op" id="3258460">)</span><span class="op" id="3258461">;</span>&nbsp;<span class="ident" id="3258463">err</span>&nbsp;<span class="op" id="3258467">!=</span>&nbsp;<span class="builtintype" id="3258470">nil</span>&nbsp;<span class="op" id="3258474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258478">netfd</span><span class="op" id="3258483">.</span><span class="ident" id="3258484">Close</span><span class="op" id="3258489">(</span><span class="op" id="3258490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258494">return</span>&nbsp;<span class="builtintype" id="3258501">nil</span><span class="op" id="3258504">,</span>&nbsp;<span class="ident" id="3258506">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258514">netfd</span><span class="op" id="3258519">.</span><span class="ident" id="3258520">setAddr</span><span class="op" id="3258527">(</span><span class="ident" id="3258528">laddr</span><span class="op" id="3258533">,</span>&nbsp;<span class="ident" id="3258535">raddr</span><span class="op" id="3258540">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258543">return</span>&nbsp;<span class="ident" id="3258550">netfd</span><span class="op" id="3258555">,</span>&nbsp;<span class="builtintype" id="3258557">nil</span><br>
<span class="lineno"></span><span class="op" id="3258561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3258564">//&nbsp;FileConn&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;network&nbsp;connection&nbsp;corresponding&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3258634">//&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when</span><br>
<span class="lineno">80</span><span class="comment" id="3258705">//&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;c&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3258771">//&nbsp;affect&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="3258784">func</span>&nbsp;<span class="ident" id="3258789">FileConn</span><span class="op" id="3258797">(</span><span class="ident" id="3258798">f</span>&nbsp;<span class="op" id="3258800">*</span><span class="ident" id="3258801">os</span><span class="op" id="3258803">.</span><span class="ident" id="3258804">File</span><span class="op" id="3258808">)</span>&nbsp;<span class="op" id="3258810">(</span><span class="ident" id="3258811">c</span>&nbsp;<span class="ident" id="3258813">Conn</span><span class="op" id="3258817">,</span>&nbsp;<span class="ident" id="3258819">err</span>&nbsp;<span class="builtintype" id="3258823">error</span><span class="op" id="3258828">)</span>&nbsp;<span class="op" id="3258830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258833">fd</span><span class="op" id="3258835">,</span>&nbsp;<span class="ident" id="3258837">err</span>&nbsp;<span class="op" id="3258841">:=</span>&nbsp;<span class="ident" id="3258844">newFileFD</span><span class="op" id="3258853">(</span><span class="ident" id="3258854">f</span><span class="op" id="3258855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258858">if</span>&nbsp;<span class="ident" id="3258861">err</span>&nbsp;<span class="op" id="3258865">!=</span>&nbsp;<span class="builtintype" id="3258868">nil</span>&nbsp;<span class="op" id="3258872">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258876">return</span>&nbsp;<span class="builtintype" id="3258883">nil</span><span class="op" id="3258886">,</span>&nbsp;<span class="ident" id="3258888">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258896">switch</span>&nbsp;<span class="ident" id="3258903">fd</span><span class="op" id="3258905">.</span><span class="ident" id="3258906">laddr</span><span class="op" id="3258911">.</span><span class="op" id="3258912">(</span><span class="keyword" id="3258913">type</span><span class="op" id="3258917">)</span>&nbsp;<span class="op" id="3258919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258922">case</span>&nbsp;<span class="op" id="3258927">*</span><span class="ident" id="3258928">TCPAddr</span><span class="op" id="3258935">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258939">return</span>&nbsp;<span class="ident" id="3258946">newTCPConn</span><span class="op" id="3258956">(</span><span class="ident" id="3258957">fd</span><span class="op" id="3258959">)</span><span class="op" id="3258960">,</span>&nbsp;<span class="builtintype" id="3258962">nil</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258967">case</span>&nbsp;<span class="op" id="3258972">*</span><span class="ident" id="3258973">UDPAddr</span><span class="op" id="3258980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258984">return</span>&nbsp;<span class="ident" id="3258991">newUDPConn</span><span class="op" id="3259001">(</span><span class="ident" id="3259002">fd</span><span class="op" id="3259004">)</span><span class="op" id="3259005">,</span>&nbsp;<span class="builtintype" id="3259007">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259012">case</span>&nbsp;<span class="op" id="3259017">*</span><span class="ident" id="3259018">IPAddr</span><span class="op" id="3259024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259028">return</span>&nbsp;<span class="ident" id="3259035">newIPConn</span><span class="op" id="3259044">(</span><span class="ident" id="3259045">fd</span><span class="op" id="3259047">)</span><span class="op" id="3259048">,</span>&nbsp;<span class="builtintype" id="3259050">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259055">case</span>&nbsp;<span class="op" id="3259060">*</span><span class="ident" id="3259061">UnixAddr</span><span class="op" id="3259069">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259073">return</span>&nbsp;<span class="ident" id="3259080">newUnixConn</span><span class="op" id="3259091">(</span><span class="ident" id="3259092">fd</span><span class="op" id="3259094">)</span><span class="op" id="3259095">,</span>&nbsp;<span class="builtintype" id="3259097">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3259102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3259105">fd</span><span class="op" id="3259107">.</span><span class="ident" id="3259108">Close</span><span class="op" id="3259113">(</span><span class="op" id="3259114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259117">return</span>&nbsp;<span class="builtintype" id="3259124">nil</span><span class="op" id="3259127">,</span>&nbsp;<span class="ident" id="3259129">syscall</span><span class="op" id="3259136">.</span><span class="ident" id="3259137">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="3259144">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3259147">//&nbsp;FileListener&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;network&nbsp;listener&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="3259216">//&nbsp;to&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;l</span><br>
<span class="lineno"></span><span class="comment" id="3259285">//&nbsp;when&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3259356">//&nbsp;affect&nbsp;l.</span><br>
<span class="lineno">105</span><span class="keyword" id="3259369">func</span>&nbsp;<span class="ident" id="3259374">FileListener</span><span class="op" id="3259386">(</span><span class="ident" id="3259387">f</span>&nbsp;<span class="op" id="3259389">*</span><span class="ident" id="3259390">os</span><span class="op" id="3259392">.</span><span class="ident" id="3259393">File</span><span class="op" id="3259397">)</span>&nbsp;<span class="op" id="3259399">(</span><span class="ident" id="3259400">l</span>&nbsp;<span class="ident" id="3259402">Listener</span><span class="op" id="3259410">,</span>&nbsp;<span class="ident" id="3259412">err</span>&nbsp;<span class="builtintype" id="3259416">error</span><span class="op" id="3259421">)</span>&nbsp;<span class="op" id="3259423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3259426">fd</span><span class="op" id="3259428">,</span>&nbsp;<span class="ident" id="3259430">err</span>&nbsp;<span class="op" id="3259434">:=</span>&nbsp;<span class="ident" id="3259437">newFileFD</span><span class="op" id="3259446">(</span><span class="ident" id="3259447">f</span><span class="op" id="3259448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259451">if</span>&nbsp;<span class="ident" id="3259454">err</span>&nbsp;<span class="op" id="3259458">!=</span>&nbsp;<span class="builtintype" id="3259461">nil</span>&nbsp;<span class="op" id="3259465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259469">return</span>&nbsp;<span class="builtintype" id="3259476">nil</span><span class="op" id="3259479">,</span>&nbsp;<span class="ident" id="3259481">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3259486">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259489">switch</span>&nbsp;<span class="ident" id="3259496">laddr</span>&nbsp;<span class="op" id="3259502">:=</span>&nbsp;<span class="ident" id="3259505">fd</span><span class="op" id="3259507">.</span><span class="ident" id="3259508">laddr</span><span class="op" id="3259513">.</span><span class="op" id="3259514">(</span><span class="keyword" id="3259515">type</span><span class="op" id="3259519">)</span>&nbsp;<span class="op" id="3259521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259524">case</span>&nbsp;<span class="op" id="3259529">*</span><span class="ident" id="3259530">TCPAddr</span><span class="op" id="3259537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259541">return</span>&nbsp;<span class="op" id="3259548">&amp;</span><span class="ident" id="3259549">TCPListener</span><span class="op" id="3259560">{</span><span class="ident" id="3259561">fd</span><span class="op" id="3259563">}</span><span class="op" id="3259564">,</span>&nbsp;<span class="builtintype" id="3259566">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259571">case</span>&nbsp;<span class="op" id="3259576">*</span><span class="ident" id="3259577">UnixAddr</span><span class="op" id="3259585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259589">return</span>&nbsp;<span class="op" id="3259596">&amp;</span><span class="ident" id="3259597">UnixListener</span><span class="op" id="3259609">{</span><span class="ident" id="3259610">fd</span><span class="op" id="3259612">,</span>&nbsp;<span class="ident" id="3259614">laddr</span><span class="op" id="3259619">.</span><span class="ident" id="3259620">Name</span><span class="op" id="3259624">}</span><span class="op" id="3259625">,</span>&nbsp;<span class="builtintype" id="3259627">nil</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3259632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3259635">fd</span><span class="op" id="3259637">.</span><span class="ident" id="3259638">Close</span><span class="op" id="3259643">(</span><span class="op" id="3259644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259647">return</span>&nbsp;<span class="builtintype" id="3259654">nil</span><span class="op" id="3259657">,</span>&nbsp;<span class="ident" id="3259659">syscall</span><span class="op" id="3259666">.</span><span class="ident" id="3259667">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="3259674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="3259677">//&nbsp;FilePacketConn&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;packet&nbsp;network&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="3259743">//&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3259800">//&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;c&nbsp;does&nbsp;not&nbsp;affect</span><br>
<span class="lineno"></span><span class="comment" id="3259871">//&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="3259910">func</span>&nbsp;<span class="ident" id="3259915">FilePacketConn</span><span class="op" id="3259929">(</span><span class="ident" id="3259930">f</span>&nbsp;<span class="op" id="3259932">*</span><span class="ident" id="3259933">os</span><span class="op" id="3259935">.</span><span class="ident" id="3259936">File</span><span class="op" id="3259940">)</span>&nbsp;<span class="op" id="3259942">(</span><span class="ident" id="3259943">c</span>&nbsp;<span class="ident" id="3259945">PacketConn</span><span class="op" id="3259955">,</span>&nbsp;<span class="ident" id="3259957">err</span>&nbsp;<span class="builtintype" id="3259961">error</span><span class="op" id="3259966">)</span>&nbsp;<span class="op" id="3259968">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3259971">fd</span><span class="op" id="3259973">,</span>&nbsp;<span class="ident" id="3259975">err</span>&nbsp;<span class="op" id="3259979">:=</span>&nbsp;<span class="ident" id="3259982">newFileFD</span><span class="op" id="3259991">(</span><span class="ident" id="3259992">f</span><span class="op" id="3259993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259996">if</span>&nbsp;<span class="ident" id="3259999">err</span>&nbsp;<span class="op" id="3260003">!=</span>&nbsp;<span class="builtintype" id="3260006">nil</span>&nbsp;<span class="op" id="3260010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260014">return</span>&nbsp;<span class="builtintype" id="3260021">nil</span><span class="op" id="3260024">,</span>&nbsp;<span class="ident" id="3260026">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3260031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260034">switch</span>&nbsp;<span class="ident" id="3260041">fd</span><span class="op" id="3260043">.</span><span class="ident" id="3260044">laddr</span><span class="op" id="3260049">.</span><span class="op" id="3260050">(</span><span class="keyword" id="3260051">type</span><span class="op" id="3260055">)</span>&nbsp;<span class="op" id="3260057">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260060">case</span>&nbsp;<span class="op" id="3260065">*</span><span class="ident" id="3260066">UDPAddr</span><span class="op" id="3260073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260077">return</span>&nbsp;<span class="ident" id="3260084">newUDPConn</span><span class="op" id="3260094">(</span><span class="ident" id="3260095">fd</span><span class="op" id="3260097">)</span><span class="op" id="3260098">,</span>&nbsp;<span class="builtintype" id="3260100">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260105">case</span>&nbsp;<span class="op" id="3260110">*</span><span class="ident" id="3260111">IPAddr</span><span class="op" id="3260117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260121">return</span>&nbsp;<span class="ident" id="3260128">newIPConn</span><span class="op" id="3260137">(</span><span class="ident" id="3260138">fd</span><span class="op" id="3260140">)</span><span class="op" id="3260141">,</span>&nbsp;<span class="builtintype" id="3260143">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260148">case</span>&nbsp;<span class="op" id="3260153">*</span><span class="ident" id="3260154">UnixAddr</span><span class="op" id="3260162">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260166">return</span>&nbsp;<span class="ident" id="3260173">newUnixConn</span><span class="op" id="3260184">(</span><span class="ident" id="3260185">fd</span><span class="op" id="3260187">)</span><span class="op" id="3260188">,</span>&nbsp;<span class="builtintype" id="3260190">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3260195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260198">fd</span><span class="op" id="3260200">.</span><span class="ident" id="3260201">Close</span><span class="op" id="3260206">(</span><span class="op" id="3260207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260210">return</span>&nbsp;<span class="builtintype" id="3260217">nil</span><span class="op" id="3260220">,</span>&nbsp;<span class="ident" id="3260222">syscall</span><span class="op" id="3260229">.</span><span class="ident" id="3260230">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="3260237">}</span>
</div>
</body>
</html>
