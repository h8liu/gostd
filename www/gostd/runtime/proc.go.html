<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1660482">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1660537">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1660591">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1660642">package</span>&nbsp;<span class="ident" id="1660650">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1660659">import</span>&nbsp;<span class="string" id="1660666">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1660676">func</span>&nbsp;<span class="ident" id="1660681">newsysmon</span><span class="op" id="1660690">(</span><span class="op" id="1660691">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1660694">func</span>&nbsp;<span class="ident" id="1660699">runtime_init</span><span class="op" id="1660711">(</span><span class="op" id="1660712">)</span><br>
<span class="lineno"></span><span class="keyword" id="1660714">func</span>&nbsp;<span class="ident" id="1660719">main_init</span><span class="op" id="1660728">(</span><span class="op" id="1660729">)</span><br>
<span class="lineno"></span><span class="keyword" id="1660731">func</span>&nbsp;<span class="ident" id="1660736">main_main</span><span class="op" id="1660745">(</span><span class="op" id="1660746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1660749">//&nbsp;The&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1660772">func</span>&nbsp;<span class="ident" id="1660777">main</span><span class="op" id="1660781">(</span><span class="op" id="1660782">)</span>&nbsp;<span class="op" id="1660784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660787">g</span>&nbsp;<span class="op" id="1660789">:=</span>&nbsp;<span class="ident" id="1660792">getg</span><span class="op" id="1660796">(</span><span class="op" id="1660797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660801">//&nbsp;Racectx&nbsp;of&nbsp;m0-&gt;g0&nbsp;is&nbsp;used&nbsp;only&nbsp;as&nbsp;the&nbsp;parent&nbsp;of&nbsp;the&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660873">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;anything&nbsp;else.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660916">g</span><span class="op" id="1660917">.</span><span class="ident" id="1660918">m</span><span class="op" id="1660919">.</span><span class="ident" id="1660920">g0</span><span class="op" id="1660922">.</span><span class="ident" id="1660923">racectx</span>&nbsp;<span class="op" id="1660931">=</span>&nbsp;<span class="num" id="1660933">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660937">//&nbsp;Max&nbsp;stack&nbsp;size&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1660993">//&nbsp;Using&nbsp;decimal&nbsp;instead&nbsp;of&nbsp;binary&nbsp;GB&nbsp;and&nbsp;MB&nbsp;because</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1661047">//&nbsp;they&nbsp;look&nbsp;nicer&nbsp;in&nbsp;the&nbsp;stack&nbsp;overflow&nbsp;failure&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1661106">if</span>&nbsp;<span class="ident" id="1661109">ptrSize</span>&nbsp;<span class="op" id="1661117">==</span>&nbsp;<span class="num" id="1661120">8</span>&nbsp;<span class="op" id="1661122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661126">maxstacksize</span>&nbsp;<span class="op" id="1661139">=</span>&nbsp;<span class="num" id="1661141">1000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1661153">}</span>&nbsp;<span class="keyword" id="1661155">else</span>&nbsp;<span class="op" id="1661160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661164">maxstacksize</span>&nbsp;<span class="op" id="1661177">=</span>&nbsp;<span class="num" id="1661179">250000000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1661190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661194">onM</span><span class="op" id="1661197">(</span><span class="ident" id="1661198">newsysmon</span><span class="op" id="1661207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1661211">//&nbsp;Lock&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;onto&nbsp;this,&nbsp;the&nbsp;main&nbsp;OS&nbsp;thread,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1661270">//&nbsp;during&nbsp;initialization.&nbsp;&nbsp;Most&nbsp;programs&nbsp;won&#39;t&nbsp;care,&nbsp;but&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1661334">//&nbsp;do&nbsp;require&nbsp;certain&nbsp;calls&nbsp;to&nbsp;be&nbsp;made&nbsp;by&nbsp;the&nbsp;main&nbsp;thread.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1661394">//&nbsp;Those&nbsp;can&nbsp;arrange&nbsp;for&nbsp;main.main&nbsp;to&nbsp;run&nbsp;in&nbsp;the&nbsp;main&nbsp;thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1661456">//&nbsp;by&nbsp;calling&nbsp;runtime.LockOSThread&nbsp;during&nbsp;initialization</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1661514">//&nbsp;to&nbsp;preserve&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661540">lockOSThread</span><span class="op" id="1661552">(</span><span class="op" id="1661553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1661557">if</span>&nbsp;<span class="ident" id="1661560">g</span><span class="op" id="1661561">.</span><span class="ident" id="1661562">m</span>&nbsp;<span class="op" id="1661564">!=</span>&nbsp;<span class="op" id="1661567">&amp;</span><span class="ident" id="1661568">m0</span>&nbsp;<span class="op" id="1661571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661575">gothrow</span><span class="op" id="1661582">(</span><span class="string" id="1661583">&#34;runtime.main&nbsp;not&nbsp;on&nbsp;m0&#34;</span><span class="op" id="1661607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1661610">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661614">runtime_init</span><span class="op" id="1661626">(</span><span class="op" id="1661627">)</span>&nbsp;<span class="comment" id="1661629">//&nbsp;must&nbsp;be&nbsp;before&nbsp;defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1661655">//&nbsp;Defer&nbsp;unlock&nbsp;so&nbsp;that&nbsp;runtime.Goexit&nbsp;during&nbsp;init&nbsp;does&nbsp;the&nbsp;unlock&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661728">needUnlock</span>&nbsp;<span class="op" id="1661739">:=</span>&nbsp;<span class="builtintype" id="1661742">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1661748">defer</span>&nbsp;<span class="keyword" id="1661754">func</span><span class="op" id="1661758">(</span><span class="op" id="1661759">)</span>&nbsp;<span class="op" id="1661761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1661765">if</span>&nbsp;<span class="ident" id="1661768">needUnlock</span>&nbsp;<span class="op" id="1661779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661784">unlockOSThread</span><span class="op" id="1661798">(</span><span class="op" id="1661799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1661803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1661806">}</span><span class="op" id="1661807">(</span><span class="op" id="1661808">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661812">memstats</span><span class="op" id="1661820">.</span><span class="ident" id="1661821">enablegc</span>&nbsp;<span class="op" id="1661830">=</span>&nbsp;<span class="builtintype" id="1661832">true</span>&nbsp;<span class="comment" id="1661837">//&nbsp;now&nbsp;that&nbsp;runtime&nbsp;is&nbsp;initialized,&nbsp;GC&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661886">main_init</span><span class="op" id="1661895">(</span><span class="op" id="1661896">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661900">needUnlock</span>&nbsp;<span class="op" id="1661911">=</span>&nbsp;<span class="builtintype" id="1661913">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661920">unlockOSThread</span><span class="op" id="1661934">(</span><span class="op" id="1661935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661939">main_main</span><span class="op" id="1661948">(</span><span class="op" id="1661949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1661952">if</span>&nbsp;<span class="ident" id="1661955">raceenabled</span>&nbsp;<span class="op" id="1661967">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1661971">racefini</span><span class="op" id="1661979">(</span><span class="op" id="1661980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1661983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1661987">//&nbsp;Make&nbsp;racy&nbsp;client&nbsp;program&nbsp;work:&nbsp;if&nbsp;panicking&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1662038">//&nbsp;another&nbsp;goroutine&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;as&nbsp;main&nbsp;returns,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1662094">//&nbsp;let&nbsp;the&nbsp;other&nbsp;goroutine&nbsp;finish&nbsp;printing&nbsp;the&nbsp;panic&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1662155">//&nbsp;Once&nbsp;it&nbsp;does,&nbsp;it&nbsp;will&nbsp;exit.&nbsp;See&nbsp;issue&nbsp;3934.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662203">if</span>&nbsp;<span class="ident" id="1662206">panicking</span>&nbsp;<span class="op" id="1662216">!=</span>&nbsp;<span class="num" id="1662219">0</span>&nbsp;<span class="op" id="1662221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662225">gopark</span><span class="op" id="1662231">(</span><span class="ident" id="1662232">nil</span><span class="op" id="1662235">,</span>&nbsp;<span class="ident" id="1662237">nil</span><span class="op" id="1662240">,</span>&nbsp;<span class="string" id="1662242">&#34;panicwait&#34;</span><span class="op" id="1662253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1662256">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662260">exit</span><span class="op" id="1662264">(</span><span class="num" id="1662265">0</span><span class="op" id="1662266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662269">for</span>&nbsp;<span class="op" id="1662273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662277">var</span>&nbsp;<span class="ident" id="1662281">x</span>&nbsp;<span class="op" id="1662283">*</span><span class="builtintype" id="1662284">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1662292">*</span><span class="ident" id="1662293">x</span>&nbsp;<span class="op" id="1662295">=</span>&nbsp;<span class="num" id="1662297">0</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1662300">}</span><br>
<span class="lineno"></span><span class="op" id="1662302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1662305">var</span>&nbsp;<span class="ident" id="1662309">parkunlock_c</span>&nbsp;<span class="builtintype" id="1662322">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1662328">//&nbsp;start&nbsp;forcegc&nbsp;helper&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="keyword" id="1662362">func</span>&nbsp;<span class="ident" id="1662367">init</span><span class="op" id="1662371">(</span><span class="op" id="1662372">)</span>&nbsp;<span class="op" id="1662374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662377">go</span>&nbsp;<span class="ident" id="1662380">forcegchelper</span><span class="op" id="1662393">(</span><span class="op" id="1662394">)</span><br>
<span class="lineno"></span><span class="op" id="1662396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="1662399">func</span>&nbsp;<span class="ident" id="1662404">forcegchelper</span><span class="op" id="1662417">(</span><span class="op" id="1662418">)</span>&nbsp;<span class="op" id="1662420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662423">forcegc</span><span class="op" id="1662430">.</span><span class="ident" id="1662431">g</span>&nbsp;<span class="op" id="1662433">=</span>&nbsp;<span class="ident" id="1662435">getg</span><span class="op" id="1662439">(</span><span class="op" id="1662440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662443">forcegc</span><span class="op" id="1662450">.</span><span class="ident" id="1662451">g</span><span class="op" id="1662452">.</span><span class="ident" id="1662453">issystem</span>&nbsp;<span class="op" id="1662462">=</span>&nbsp;<span class="builtintype" id="1662464">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662470">for</span>&nbsp;<span class="op" id="1662474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662478">lock</span><span class="op" id="1662482">(</span><span class="op" id="1662483">&amp;</span><span class="ident" id="1662484">forcegc</span><span class="op" id="1662491">.</span><span class="ident" id="1662492">lock</span><span class="op" id="1662496">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662500">if</span>&nbsp;<span class="ident" id="1662503">forcegc</span><span class="op" id="1662510">.</span><span class="ident" id="1662511">idle</span>&nbsp;<span class="op" id="1662516">!=</span>&nbsp;<span class="num" id="1662519">0</span>&nbsp;<span class="op" id="1662521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662526">gothrow</span><span class="op" id="1662533">(</span><span class="string" id="1662534">&#34;forcegc:&nbsp;phase&nbsp;error&#34;</span><span class="op" id="1662556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1662560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662564">atomicstore</span><span class="op" id="1662575">(</span><span class="op" id="1662576">&amp;</span><span class="ident" id="1662577">forcegc</span><span class="op" id="1662584">.</span><span class="ident" id="1662585">idle</span><span class="op" id="1662589">,</span>&nbsp;<span class="num" id="1662591">1</span><span class="op" id="1662592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662596">goparkunlock</span><span class="op" id="1662608">(</span><span class="op" id="1662609">&amp;</span><span class="ident" id="1662610">forcegc</span><span class="op" id="1662617">.</span><span class="ident" id="1662618">lock</span><span class="op" id="1662622">,</span>&nbsp;<span class="string" id="1662624">&#34;force&nbsp;gc&nbsp;(idle)&#34;</span><span class="op" id="1662641">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1662645">//&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;explicitly&nbsp;resumed&nbsp;by&nbsp;sysmon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1662697">if</span>&nbsp;<span class="ident" id="1662700">debug</span><span class="op" id="1662705">.</span><span class="ident" id="1662706">gctrace</span>&nbsp;<span class="op" id="1662714">&gt;</span>&nbsp;<span class="num" id="1662716">0</span>&nbsp;<span class="op" id="1662718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1662723">println</span><span class="op" id="1662730">(</span><span class="string" id="1662731">&#34;GC&nbsp;forced&#34;</span><span class="op" id="1662742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1662746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662750">gogc</span><span class="op" id="1662754">(</span><span class="num" id="1662755">1</span><span class="op" id="1662756">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1662759">}</span><br>
<span class="lineno"></span><span class="op" id="1662761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1662764">//go:nosplit</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1662778">//&nbsp;Gosched&nbsp;yields&nbsp;the&nbsp;processor,&nbsp;allowing&nbsp;other&nbsp;goroutines&nbsp;to&nbsp;run.&nbsp;&nbsp;It&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1662858">//&nbsp;suspend&nbsp;the&nbsp;current&nbsp;goroutine,&nbsp;so&nbsp;execution&nbsp;resumes&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="keyword" id="1662928">func</span>&nbsp;<span class="ident" id="1662933">Gosched</span><span class="op" id="1662940">(</span><span class="op" id="1662941">)</span>&nbsp;<span class="op" id="1662943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1662946">mcall</span><span class="op" id="1662951">(</span><span class="ident" id="1662952">gosched_m</span><span class="op" id="1662961">)</span><br>
<span class="lineno"></span><span class="op" id="1662963">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1662966">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;calls&nbsp;unlockf.</span><br>
<span class="lineno"></span><span class="comment" id="1663036">//&nbsp;If&nbsp;unlockf&nbsp;returns&nbsp;false,&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;resumed.</span><br>
<span class="lineno"></span><span class="keyword" id="1663091">func</span>&nbsp;<span class="ident" id="1663096">gopark</span><span class="op" id="1663102">(</span><span class="ident" id="1663103">unlockf</span>&nbsp;<span class="ident" id="1663111">unsafe</span><span class="op" id="1663117">.</span><span class="ident" id="1663118">Pointer</span><span class="op" id="1663125">,</span>&nbsp;<span class="ident" id="1663127">lock</span>&nbsp;<span class="ident" id="1663132">unsafe</span><span class="op" id="1663138">.</span><span class="ident" id="1663139">Pointer</span><span class="op" id="1663146">,</span>&nbsp;<span class="ident" id="1663148">reason</span>&nbsp;<span class="builtintype" id="1663155">string</span><span class="op" id="1663161">)</span>&nbsp;<span class="op" id="1663163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663166">mp</span>&nbsp;<span class="op" id="1663169">:=</span>&nbsp;<span class="ident" id="1663172">acquirem</span><span class="op" id="1663180">(</span><span class="op" id="1663181">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663184">gp</span>&nbsp;<span class="op" id="1663187">:=</span>&nbsp;<span class="ident" id="1663190">mp</span><span class="op" id="1663192">.</span><span class="ident" id="1663193">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663199">status</span>&nbsp;<span class="op" id="1663206">:=</span>&nbsp;<span class="ident" id="1663209">readgstatus</span><span class="op" id="1663220">(</span><span class="ident" id="1663221">gp</span><span class="op" id="1663223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1663226">if</span>&nbsp;<span class="ident" id="1663229">status</span>&nbsp;<span class="op" id="1663236">!=</span>&nbsp;<span class="ident" id="1663239">_Grunning</span>&nbsp;<span class="op" id="1663249">&amp;&amp;</span>&nbsp;<span class="ident" id="1663252">status</span>&nbsp;<span class="op" id="1663259">!=</span>&nbsp;<span class="ident" id="1663262">_Gscanrunning</span>&nbsp;<span class="op" id="1663276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663280">gothrow</span><span class="op" id="1663287">(</span><span class="string" id="1663288">&#34;gopark:&nbsp;bad&nbsp;g&nbsp;status&#34;</span><span class="op" id="1663310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1663313">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663316">mp</span><span class="op" id="1663318">.</span><span class="ident" id="1663319">waitlock</span>&nbsp;<span class="op" id="1663328">=</span>&nbsp;<span class="ident" id="1663330">lock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663336">mp</span><span class="op" id="1663338">.</span><span class="ident" id="1663339">waitunlockf</span>&nbsp;<span class="op" id="1663351">=</span>&nbsp;<span class="ident" id="1663353">unlockf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663362">gp</span><span class="op" id="1663364">.</span><span class="ident" id="1663365">waitreason</span>&nbsp;<span class="op" id="1663376">=</span>&nbsp;<span class="ident" id="1663378">reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663386">releasem</span><span class="op" id="1663394">(</span><span class="ident" id="1663395">mp</span><span class="op" id="1663397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1663400">//&nbsp;can&#39;t&nbsp;do&nbsp;anything&nbsp;that&nbsp;might&nbsp;move&nbsp;the&nbsp;G&nbsp;between&nbsp;Ms&nbsp;here.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663461">mcall</span><span class="op" id="1663466">(</span><span class="ident" id="1663467">park_m</span><span class="op" id="1663473">)</span><br>
<span class="lineno"></span><span class="op" id="1663475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1663478">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;unlocks&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="comment" id="1663551">//&nbsp;The&nbsp;goroutine&nbsp;can&nbsp;be&nbsp;made&nbsp;runnable&nbsp;again&nbsp;by&nbsp;calling&nbsp;goready(gp).</span><br>
<span class="lineno">135</span><span class="keyword" id="1663619">func</span>&nbsp;<span class="ident" id="1663624">goparkunlock</span><span class="op" id="1663636">(</span><span class="ident" id="1663637">lock</span>&nbsp;<span class="op" id="1663642">*</span><span class="ident" id="1663643">mutex</span><span class="op" id="1663648">,</span>&nbsp;<span class="ident" id="1663650">reason</span>&nbsp;<span class="builtintype" id="1663657">string</span><span class="op" id="1663663">)</span>&nbsp;<span class="op" id="1663665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663668">gopark</span><span class="op" id="1663674">(</span><span class="ident" id="1663675">unsafe</span><span class="op" id="1663681">.</span><span class="ident" id="1663682">Pointer</span><span class="op" id="1663689">(</span><span class="op" id="1663690">&amp;</span><span class="ident" id="1663691">parkunlock_c</span><span class="op" id="1663703">)</span><span class="op" id="1663704">,</span>&nbsp;<span class="ident" id="1663706">unsafe</span><span class="op" id="1663712">.</span><span class="ident" id="1663713">Pointer</span><span class="op" id="1663720">(</span><span class="ident" id="1663721">lock</span><span class="op" id="1663725">)</span><span class="op" id="1663726">,</span>&nbsp;<span class="ident" id="1663728">reason</span><span class="op" id="1663734">)</span><br>
<span class="lineno"></span><span class="op" id="1663736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1663739">func</span>&nbsp;<span class="ident" id="1663744">goready</span><span class="op" id="1663751">(</span><span class="ident" id="1663752">gp</span>&nbsp;<span class="op" id="1663755">*</span><span class="ident" id="1663756">g</span><span class="op" id="1663757">)</span>&nbsp;<span class="op" id="1663759">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663762">mp</span>&nbsp;<span class="op" id="1663765">:=</span>&nbsp;<span class="ident" id="1663768">acquirem</span><span class="op" id="1663776">(</span><span class="op" id="1663777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663780">mp</span><span class="op" id="1663782">.</span><span class="ident" id="1663783">ptrarg</span><span class="op" id="1663789">[</span><span class="num" id="1663790">0</span><span class="op" id="1663791">]</span>&nbsp;<span class="op" id="1663793">=</span>&nbsp;<span class="ident" id="1663795">unsafe</span><span class="op" id="1663801">.</span><span class="ident" id="1663802">Pointer</span><span class="op" id="1663809">(</span><span class="ident" id="1663810">gp</span><span class="op" id="1663812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663815">onM</span><span class="op" id="1663818">(</span><span class="ident" id="1663819">ready_m</span><span class="op" id="1663826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663829">releasem</span><span class="op" id="1663837">(</span><span class="ident" id="1663838">mp</span><span class="op" id="1663840">)</span><br>
<span class="lineno"></span><span class="op" id="1663842">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1663845">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1663858">func</span>&nbsp;<span class="ident" id="1663863">acquireSudog</span><span class="op" id="1663875">(</span><span class="op" id="1663876">)</span>&nbsp;<span class="op" id="1663878">*</span><span class="ident" id="1663879">sudog</span>&nbsp;<span class="op" id="1663885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663888">c</span>&nbsp;<span class="op" id="1663890">:=</span>&nbsp;<span class="ident" id="1663893">gomcache</span><span class="op" id="1663901">(</span><span class="op" id="1663902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663905">s</span>&nbsp;<span class="op" id="1663907">:=</span>&nbsp;<span class="ident" id="1663910">c</span><span class="op" id="1663911">.</span><span class="ident" id="1663912">sudogcache</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1663924">if</span>&nbsp;<span class="ident" id="1663927">s</span>&nbsp;<span class="op" id="1663929">!=</span>&nbsp;<span class="ident" id="1663932">nil</span>&nbsp;<span class="op" id="1663936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1663940">if</span>&nbsp;<span class="ident" id="1663943">s</span><span class="op" id="1663944">.</span><span class="ident" id="1663945">elem</span>&nbsp;<span class="op" id="1663950">!=</span>&nbsp;<span class="ident" id="1663953">nil</span>&nbsp;<span class="op" id="1663957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1663962">gothrow</span><span class="op" id="1663969">(</span><span class="string" id="1663970">&#34;acquireSudog:&nbsp;found&nbsp;s.elem&nbsp;!=&nbsp;nil&nbsp;in&nbsp;cache&#34;</span><span class="op" id="1664014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1664018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1664022">c</span><span class="op" id="1664023">.</span><span class="ident" id="1664024">sudogcache</span>&nbsp;<span class="op" id="1664035">=</span>&nbsp;<span class="ident" id="1664037">s</span><span class="op" id="1664038">.</span><span class="ident" id="1664039">next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1664046">s</span><span class="op" id="1664047">.</span><span class="ident" id="1664048">next</span>&nbsp;<span class="op" id="1664053">=</span>&nbsp;<span class="ident" id="1664055">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1664061">return</span>&nbsp;<span class="ident" id="1664068">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1664071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1664075">//&nbsp;Delicate&nbsp;dance:&nbsp;the&nbsp;semaphore&nbsp;implementation&nbsp;calls</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1664130">//&nbsp;acquireSudog,&nbsp;acquireSudog&nbsp;calls&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1664179">//&nbsp;new&nbsp;calls&nbsp;malloc,&nbsp;malloc&nbsp;can&nbsp;call&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1664240">//&nbsp;and&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;calls&nbsp;the&nbsp;semaphore&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1664305">//&nbsp;in&nbsp;stoptheworld.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1664326">//&nbsp;Break&nbsp;the&nbsp;cycle&nbsp;by&nbsp;doing&nbsp;acquirem/releasem&nbsp;around&nbsp;new(sudog).</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1664392">//&nbsp;The&nbsp;acquirem/releasem&nbsp;increments&nbsp;m.locks&nbsp;during&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1664456">//&nbsp;which&nbsp;keeps&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;from&nbsp;being&nbsp;invoked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1664514">mp</span>&nbsp;<span class="op" id="1664517">:=</span>&nbsp;<span class="ident" id="1664520">acquirem</span><span class="op" id="1664528">(</span><span class="op" id="1664529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1664532">p</span>&nbsp;<span class="op" id="1664534">:=</span>&nbsp;<span class="builtinfunc" id="1664537">new</span><span class="op" id="1664540">(</span><span class="ident" id="1664541">sudog</span><span class="op" id="1664546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1664549">releasem</span><span class="op" id="1664557">(</span><span class="ident" id="1664558">mp</span><span class="op" id="1664560">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1664563">return</span>&nbsp;<span class="ident" id="1664570">p</span><br>
<span class="lineno"></span><span class="op" id="1664572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1664575">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1664588">func</span>&nbsp;<span class="ident" id="1664593">releaseSudog</span><span class="op" id="1664605">(</span><span class="ident" id="1664606">s</span>&nbsp;<span class="op" id="1664608">*</span><span class="ident" id="1664609">sudog</span><span class="op" id="1664614">)</span>&nbsp;<span class="op" id="1664616">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1664619">if</span>&nbsp;<span class="ident" id="1664622">s</span><span class="op" id="1664623">.</span><span class="ident" id="1664624">elem</span>&nbsp;<span class="op" id="1664629">!=</span>&nbsp;<span class="ident" id="1664632">nil</span>&nbsp;<span class="op" id="1664636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1664640">gothrow</span><span class="op" id="1664647">(</span><span class="string" id="1664648">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;elem&#34;</span><span class="op" id="1664682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1664685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1664688">if</span>&nbsp;<span class="ident" id="1664691">s</span><span class="op" id="1664692">.</span><span class="ident" id="1664693">selectdone</span>&nbsp;<span class="op" id="1664704">!=</span>&nbsp;<span class="ident" id="1664707">nil</span>&nbsp;<span class="op" id="1664711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1664715">gothrow</span><span class="op" id="1664722">(</span><span class="string" id="1664723">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;selectdone&#34;</span><span class="op" id="1664763">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1664766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1664769">if</span>&nbsp;<span class="ident" id="1664772">s</span><span class="op" id="1664773">.</span><span class="ident" id="1664774">next</span>&nbsp;<span class="op" id="1664779">!=</span>&nbsp;<span class="ident" id="1664782">nil</span>&nbsp;<span class="op" id="1664786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1664790">gothrow</span><span class="op" id="1664797">(</span><span class="string" id="1664798">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;next&#34;</span><span class="op" id="1664832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1664835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1664838">if</span>&nbsp;<span class="ident" id="1664841">s</span><span class="op" id="1664842">.</span><span class="ident" id="1664843">prev</span>&nbsp;<span class="op" id="1664848">!=</span>&nbsp;<span class="ident" id="1664851">nil</span>&nbsp;<span class="op" id="1664855">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1664859">gothrow</span><span class="op" id="1664866">(</span><span class="string" id="1664867">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;prev&#34;</span><span class="op" id="1664901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1664904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1664907">if</span>&nbsp;<span class="ident" id="1664910">s</span><span class="op" id="1664911">.</span><span class="ident" id="1664912">waitlink</span>&nbsp;<span class="op" id="1664921">!=</span>&nbsp;<span class="ident" id="1664924">nil</span>&nbsp;<span class="op" id="1664928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1664932">gothrow</span><span class="op" id="1664939">(</span><span class="string" id="1664940">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;waitlink&#34;</span><span class="op" id="1664978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1664981">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1664984">gp</span>&nbsp;<span class="op" id="1664987">:=</span>&nbsp;<span class="ident" id="1664990">getg</span><span class="op" id="1664994">(</span><span class="op" id="1664995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1664998">if</span>&nbsp;<span class="ident" id="1665001">gp</span><span class="op" id="1665003">.</span><span class="ident" id="1665004">param</span>&nbsp;<span class="op" id="1665010">!=</span>&nbsp;<span class="ident" id="1665013">nil</span>&nbsp;<span class="op" id="1665017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1665021">gothrow</span><span class="op" id="1665028">(</span><span class="string" id="1665029">&#34;runtime:&nbsp;releaseSudog&nbsp;with&nbsp;non-nil&nbsp;gp.param&#34;</span><span class="op" id="1665074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1665077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1665080">c</span>&nbsp;<span class="op" id="1665082">:=</span>&nbsp;<span class="ident" id="1665085">gomcache</span><span class="op" id="1665093">(</span><span class="op" id="1665094">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1665097">s</span><span class="op" id="1665098">.</span><span class="ident" id="1665099">next</span>&nbsp;<span class="op" id="1665104">=</span>&nbsp;<span class="ident" id="1665106">c</span><span class="op" id="1665107">.</span><span class="ident" id="1665108">sudogcache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1665120">c</span><span class="op" id="1665121">.</span><span class="ident" id="1665122">sudogcache</span>&nbsp;<span class="op" id="1665133">=</span>&nbsp;<span class="ident" id="1665135">s</span><br>
<span class="lineno"></span><span class="op" id="1665137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1665140">//&nbsp;funcPC&nbsp;returns&nbsp;the&nbsp;entry&nbsp;PC&nbsp;of&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno">200</span><span class="comment" id="1665190">//&nbsp;It&nbsp;assumes&nbsp;that&nbsp;f&nbsp;is&nbsp;a&nbsp;func&nbsp;value.&nbsp;Otherwise&nbsp;the&nbsp;behavior&nbsp;is&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="comment" id="1665265">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1665278">func</span>&nbsp;<span class="ident" id="1665283">funcPC</span><span class="op" id="1665289">(</span><span class="ident" id="1665290">f</span>&nbsp;<span class="keyword" id="1665292">interface</span><span class="op" id="1665301">{</span><span class="op" id="1665302">}</span><span class="op" id="1665303">)</span>&nbsp;<span class="builtintype" id="1665305">uintptr</span>&nbsp;<span class="op" id="1665313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1665316">return</span>&nbsp;<span class="op" id="1665323">*</span><span class="op" id="1665324">*</span><span class="op" id="1665325">(</span><span class="op" id="1665326">*</span><span class="op" id="1665327">*</span><span class="builtintype" id="1665328">uintptr</span><span class="op" id="1665335">)</span><span class="op" id="1665336">(</span><span class="ident" id="1665337">add</span><span class="op" id="1665340">(</span><span class="ident" id="1665341">unsafe</span><span class="op" id="1665347">.</span><span class="ident" id="1665348">Pointer</span><span class="op" id="1665355">(</span><span class="op" id="1665356">&amp;</span><span class="ident" id="1665357">f</span><span class="op" id="1665358">)</span><span class="op" id="1665359">,</span>&nbsp;<span class="ident" id="1665361">ptrSize</span><span class="op" id="1665368">)</span><span class="op" id="1665369">)</span><br>
<span class="lineno"></span><span class="op" id="1665371">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="1665374">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno"></span><span class="keyword" id="1665398">func</span>&nbsp;<span class="ident" id="1665403">badmcall</span><span class="op" id="1665411">(</span><span class="ident" id="1665412">fn</span>&nbsp;<span class="keyword" id="1665415">func</span><span class="op" id="1665419">(</span><span class="op" id="1665420">*</span><span class="ident" id="1665421">g</span><span class="op" id="1665422">)</span><span class="op" id="1665423">)</span>&nbsp;<span class="op" id="1665425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1665428">gothrow</span><span class="op" id="1665435">(</span><span class="string" id="1665436">&#34;runtime:&nbsp;mcall&nbsp;called&nbsp;on&nbsp;m-&gt;g0&nbsp;stack&#34;</span><span class="op" id="1665474">)</span><br>
<span class="lineno"></span><span class="op" id="1665476">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="1665479">func</span>&nbsp;<span class="ident" id="1665484">badmcall2</span><span class="op" id="1665493">(</span><span class="ident" id="1665494">fn</span>&nbsp;<span class="keyword" id="1665497">func</span><span class="op" id="1665501">(</span><span class="op" id="1665502">*</span><span class="ident" id="1665503">g</span><span class="op" id="1665504">)</span><span class="op" id="1665505">)</span>&nbsp;<span class="op" id="1665507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1665510">gothrow</span><span class="op" id="1665517">(</span><span class="string" id="1665518">&#34;runtime:&nbsp;mcall&nbsp;function&nbsp;returned&#34;</span><span class="op" id="1665552">)</span><br>
<span class="lineno"></span><span class="op" id="1665554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1665557">func</span>&nbsp;<span class="ident" id="1665562">badreflectcall</span><span class="op" id="1665576">(</span><span class="op" id="1665577">)</span>&nbsp;<span class="op" id="1665579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1665582">panic</span><span class="op" id="1665587">(</span><span class="string" id="1665588">&#34;runtime:&nbsp;arg&nbsp;size&nbsp;to&nbsp;reflect.call&nbsp;more&nbsp;than&nbsp;1GB&#34;</span><span class="op" id="1665637">)</span><br>
<span class="lineno"></span><span class="op" id="1665639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1665642">func</span>&nbsp;<span class="ident" id="1665647">lockedOSThread</span><span class="op" id="1665661">(</span><span class="op" id="1665662">)</span>&nbsp;<span class="builtintype" id="1665664">bool</span>&nbsp;<span class="op" id="1665669">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1665672">gp</span>&nbsp;<span class="op" id="1665675">:=</span>&nbsp;<span class="ident" id="1665678">getg</span><span class="op" id="1665682">(</span><span class="op" id="1665683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1665686">return</span>&nbsp;<span class="ident" id="1665693">gp</span><span class="op" id="1665695">.</span><span class="ident" id="1665696">lockedm</span>&nbsp;<span class="op" id="1665704">!=</span>&nbsp;<span class="ident" id="1665707">nil</span>&nbsp;<span class="op" id="1665711">&amp;&amp;</span>&nbsp;<span class="ident" id="1665714">gp</span><span class="op" id="1665716">.</span><span class="ident" id="1665717">m</span><span class="op" id="1665718">.</span><span class="ident" id="1665719">lockedg</span>&nbsp;<span class="op" id="1665727">!=</span>&nbsp;<span class="ident" id="1665730">nil</span><br>
<span class="lineno"></span><span class="op" id="1665734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1665737">func</span>&nbsp;<span class="ident" id="1665742">newP</span><span class="op" id="1665746">(</span><span class="op" id="1665747">)</span>&nbsp;<span class="op" id="1665749">*</span><span class="ident" id="1665750">p</span>&nbsp;<span class="op" id="1665752">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1665755">return</span>&nbsp;<span class="builtinfunc" id="1665762">new</span><span class="op" id="1665765">(</span><span class="ident" id="1665766">p</span><span class="op" id="1665767">)</span><br>
<span class="lineno"></span><span class="op" id="1665769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1665772">func</span>&nbsp;<span class="ident" id="1665777">newM</span><span class="op" id="1665781">(</span><span class="op" id="1665782">)</span>&nbsp;<span class="op" id="1665784">*</span><span class="ident" id="1665785">m</span>&nbsp;<span class="op" id="1665787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1665790">return</span>&nbsp;<span class="builtinfunc" id="1665797">new</span><span class="op" id="1665800">(</span><span class="ident" id="1665801">m</span><span class="op" id="1665802">)</span><br>
<span class="lineno">230</span><span class="op" id="1665804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1665807">func</span>&nbsp;<span class="ident" id="1665812">newG</span><span class="op" id="1665816">(</span><span class="op" id="1665817">)</span>&nbsp;<span class="op" id="1665819">*</span><span class="ident" id="1665820">g</span>&nbsp;<span class="op" id="1665822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1665825">return</span>&nbsp;<span class="builtinfunc" id="1665832">new</span><span class="op" id="1665835">(</span><span class="ident" id="1665836">g</span><span class="op" id="1665837">)</span><br>
<span class="lineno"></span><span class="op" id="1665839">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="1665842">func</span>&nbsp;<span class="ident" id="1665847">allgadd</span><span class="op" id="1665854">(</span><span class="ident" id="1665855">gp</span>&nbsp;<span class="op" id="1665858">*</span><span class="ident" id="1665859">g</span><span class="op" id="1665860">)</span>&nbsp;<span class="op" id="1665862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1665865">if</span>&nbsp;<span class="ident" id="1665868">readgstatus</span><span class="op" id="1665879">(</span><span class="ident" id="1665880">gp</span><span class="op" id="1665882">)</span>&nbsp;<span class="op" id="1665884">==</span>&nbsp;<span class="ident" id="1665887">_Gidle</span>&nbsp;<span class="op" id="1665894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1665898">gothrow</span><span class="op" id="1665905">(</span><span class="string" id="1665906">&#34;allgadd:&nbsp;bad&nbsp;status&nbsp;Gidle&#34;</span><span class="op" id="1665933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1665936">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1665940">lock</span><span class="op" id="1665944">(</span><span class="op" id="1665945">&amp;</span><span class="ident" id="1665946">allglock</span><span class="op" id="1665954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1665957">allgs</span>&nbsp;<span class="op" id="1665963">=</span>&nbsp;<span class="builtinfunc" id="1665965">append</span><span class="op" id="1665971">(</span><span class="ident" id="1665972">allgs</span><span class="op" id="1665977">,</span>&nbsp;<span class="ident" id="1665979">gp</span><span class="op" id="1665981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1665984">allg</span>&nbsp;<span class="op" id="1665989">=</span>&nbsp;<span class="op" id="1665991">&amp;</span><span class="ident" id="1665992">allgs</span><span class="op" id="1665997">[</span><span class="num" id="1665998">0</span><span class="op" id="1665999">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666002">allglen</span>&nbsp;<span class="op" id="1666010">=</span>&nbsp;<span class="builtintype" id="1666012">uintptr</span><span class="op" id="1666019">(</span><span class="builtinfunc" id="1666020">len</span><span class="op" id="1666023">(</span><span class="ident" id="1666024">allgs</span><span class="op" id="1666029">)</span><span class="op" id="1666030">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1666033">unlock</span><span class="op" id="1666039">(</span><span class="op" id="1666040">&amp;</span><span class="ident" id="1666041">allglock</span><span class="op" id="1666049">)</span><br>
<span class="lineno"></span><span class="op" id="1666051">}</span>
</div>
</body>
</html>
