<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5139433">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5139488">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5139542">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5139593">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5139654">package</span>&nbsp;<span class="ident" id="5139662">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5139667">import</span>&nbsp;<span class="op" id="5139674">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139677">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139683">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139693">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139704">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="5139720">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139739">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5139750">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5139765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5139768">var</span>&nbsp;<span class="op" id="5139772">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139775">ldquo</span>&nbsp;<span class="op" id="5139781">=</span>&nbsp;<span class="op" id="5139783">[</span><span class="op" id="5139784">]</span><span class="builtintype" id="5139785">byte</span><span class="op" id="5139789">(</span><span class="string" id="5139790">&#34;&amp;ldquo;&#34;</span><span class="op" id="5139799">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139802">rdquo</span>&nbsp;<span class="op" id="5139808">=</span>&nbsp;<span class="op" id="5139810">[</span><span class="op" id="5139811">]</span><span class="builtintype" id="5139812">byte</span><span class="op" id="5139816">(</span><span class="string" id="5139817">&#34;&amp;rdquo;&#34;</span><span class="op" id="5139826">)</span><br>
<span class="lineno"></span><span class="op" id="5139828">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5139831">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="5139880">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="5139930">func</span>&nbsp;<span class="ident" id="5139935">commentEscape</span><span class="op" id="5139948">(</span><span class="ident" id="5139949">w</span>&nbsp;<span class="ident" id="5139951">io</span><span class="op" id="5139953">.</span><span class="ident" id="5139954">Writer</span><span class="op" id="5139960">,</span>&nbsp;<span class="ident" id="5139962">text</span>&nbsp;<span class="builtintype" id="5139967">string</span><span class="op" id="5139973">,</span>&nbsp;<span class="ident" id="5139975">nice</span>&nbsp;<span class="builtintype" id="5139980">bool</span><span class="op" id="5139984">)</span>&nbsp;<span class="op" id="5139986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139989">last</span>&nbsp;<span class="op" id="5139994">:=</span>&nbsp;<span class="num" id="5139997">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140000">if</span>&nbsp;<span class="ident" id="5140003">nice</span>&nbsp;<span class="op" id="5140008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140012">for</span>&nbsp;<span class="ident" id="5140016">i</span>&nbsp;<span class="op" id="5140018">:=</span>&nbsp;<span class="num" id="5140021">0</span><span class="op" id="5140022">;</span>&nbsp;<span class="ident" id="5140024">i</span>&nbsp;<span class="op" id="5140026">&lt;</span>&nbsp;<span class="builtinfunc" id="5140028">len</span><span class="op" id="5140031">(</span><span class="ident" id="5140032">text</span><span class="op" id="5140036">)</span><span class="op" id="5140037">-</span><span class="num" id="5140038">1</span><span class="op" id="5140039">;</span>&nbsp;<span class="ident" id="5140041">i</span><span class="op" id="5140042">++</span>&nbsp;<span class="op" id="5140045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140050">ch</span>&nbsp;<span class="op" id="5140053">:=</span>&nbsp;<span class="ident" id="5140056">text</span><span class="op" id="5140060">[</span><span class="ident" id="5140061">i</span><span class="op" id="5140062">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140067">if</span>&nbsp;<span class="ident" id="5140070">ch</span>&nbsp;<span class="op" id="5140073">==</span>&nbsp;<span class="ident" id="5140076">text</span><span class="op" id="5140080">[</span><span class="ident" id="5140081">i</span><span class="op" id="5140082">+</span><span class="num" id="5140083">1</span><span class="op" id="5140084">]</span>&nbsp;<span class="op" id="5140086">&amp;&amp;</span>&nbsp;<span class="op" id="5140089">(</span><span class="ident" id="5140090">ch</span>&nbsp;<span class="op" id="5140093">==</span>&nbsp;<span class="string" id="5140096">&#39;`&#39;</span>&nbsp;<span class="op" id="5140100">||</span>&nbsp;<span class="ident" id="5140103">ch</span>&nbsp;<span class="op" id="5140106">==</span>&nbsp;<span class="string" id="5140109">&#39;\&#39;&#39;</span><span class="op" id="5140113">)</span>&nbsp;<span class="op" id="5140115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140121">template</span><span class="op" id="5140129">.</span><span class="ident" id="5140130">HTMLEscape</span><span class="op" id="5140140">(</span><span class="ident" id="5140141">w</span><span class="op" id="5140142">,</span>&nbsp;<span class="op" id="5140144">[</span><span class="op" id="5140145">]</span><span class="builtintype" id="5140146">byte</span><span class="op" id="5140150">(</span><span class="ident" id="5140151">text</span><span class="op" id="5140155">[</span><span class="ident" id="5140156">last</span><span class="op" id="5140160">:</span><span class="ident" id="5140161">i</span><span class="op" id="5140162">]</span><span class="op" id="5140163">)</span><span class="op" id="5140164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140170">last</span>&nbsp;<span class="op" id="5140175">=</span>&nbsp;<span class="ident" id="5140177">i</span>&nbsp;<span class="op" id="5140179">+</span>&nbsp;<span class="num" id="5140181">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140187">switch</span>&nbsp;<span class="ident" id="5140194">ch</span>&nbsp;<span class="op" id="5140197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140203">case</span>&nbsp;<span class="string" id="5140208">&#39;`&#39;</span><span class="op" id="5140211">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140218">w</span><span class="op" id="5140219">.</span><span class="ident" id="5140220">Write</span><span class="op" id="5140225">(</span><span class="ident" id="5140226">ldquo</span><span class="op" id="5140231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140237">case</span>&nbsp;<span class="string" id="5140242">&#39;\&#39;&#39;</span><span class="op" id="5140246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140253">w</span><span class="op" id="5140254">.</span><span class="ident" id="5140255">Write</span><span class="op" id="5140260">(</span><span class="ident" id="5140261">rdquo</span><span class="op" id="5140266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140278">i</span><span class="op" id="5140279">++</span>&nbsp;<span class="comment" id="5140282">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140321">template</span><span class="op" id="5140329">.</span><span class="ident" id="5140330">HTMLEscape</span><span class="op" id="5140340">(</span><span class="ident" id="5140341">w</span><span class="op" id="5140342">,</span>&nbsp;<span class="op" id="5140344">[</span><span class="op" id="5140345">]</span><span class="builtintype" id="5140346">byte</span><span class="op" id="5140350">(</span><span class="ident" id="5140351">text</span><span class="op" id="5140355">[</span><span class="ident" id="5140356">last</span><span class="op" id="5140360">:</span><span class="op" id="5140361">]</span><span class="op" id="5140362">)</span><span class="op" id="5140363">)</span><br>
<span class="lineno"></span><span class="op" id="5140365">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5140368">const</span>&nbsp;<span class="op" id="5140374">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5140377">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140407">identRx</span>&nbsp;<span class="op" id="5140415">=</span>&nbsp;<span class="string" id="5140417">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5140438">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140458">protocol</span>&nbsp;<span class="op" id="5140467">=</span>&nbsp;<span class="string" id="5140469">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140533">hostPart</span>&nbsp;<span class="op" id="5140542">=</span>&nbsp;<span class="string" id="5140544">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140564">filePart</span>&nbsp;<span class="op" id="5140573">=</span>&nbsp;<span class="string" id="5140575">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="5140603">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140666">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5140675">=</span>&nbsp;<span class="string" id="5140677">`(`</span>&nbsp;<span class="op" id="5140681">+</span>&nbsp;<span class="ident" id="5140683">protocol</span>&nbsp;<span class="op" id="5140692">+</span>&nbsp;<span class="string" id="5140694">`)://`</span>&nbsp;<span class="op" id="5140701">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5140705">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140718">hostPart</span>&nbsp;<span class="op" id="5140727">+</span>&nbsp;<span class="string" id="5140729">`([.:]`</span>&nbsp;<span class="op" id="5140737">+</span>&nbsp;<span class="ident" id="5140739">hostPart</span>&nbsp;<span class="op" id="5140748">+</span>&nbsp;<span class="string" id="5140750">`)*/?`</span>&nbsp;<span class="op" id="5140757">+</span>&nbsp;<span class="comment" id="5140759">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140787">filePart</span>&nbsp;<span class="op" id="5140796">+</span>&nbsp;<span class="string" id="5140798">`([:.,]`</span>&nbsp;<span class="op" id="5140807">+</span>&nbsp;<span class="ident" id="5140809">filePart</span>&nbsp;<span class="op" id="5140818">+</span>&nbsp;<span class="string" id="5140820">`)*`</span><br>
<span class="lineno"></span><span class="op" id="5140825">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5140828">var</span>&nbsp;<span class="ident" id="5140832">matchRx</span>&nbsp;<span class="op" id="5140840">=</span>&nbsp;<span class="ident" id="5140842">regexp</span><span class="op" id="5140848">.</span><span class="ident" id="5140849">MustCompile</span><span class="op" id="5140860">(</span><span class="string" id="5140861">`(`</span>&nbsp;<span class="op" id="5140865">+</span>&nbsp;<span class="ident" id="5140867">urlRx</span>&nbsp;<span class="op" id="5140873">+</span>&nbsp;<span class="string" id="5140875">`)|(`</span>&nbsp;<span class="op" id="5140881">+</span>&nbsp;<span class="ident" id="5140883">identRx</span>&nbsp;<span class="op" id="5140891">+</span>&nbsp;<span class="string" id="5140893">`)`</span><span class="op" id="5140896">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5140899">var</span>&nbsp;<span class="op" id="5140903">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140906">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5140918">=</span>&nbsp;<span class="op" id="5140920">[</span><span class="op" id="5140921">]</span><span class="builtintype" id="5140922">byte</span><span class="op" id="5140926">(</span><span class="string" id="5140927">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="5140938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140941">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5140953">=</span>&nbsp;<span class="op" id="5140955">[</span><span class="op" id="5140956">]</span><span class="builtintype" id="5140957">byte</span><span class="op" id="5140961">(</span><span class="string" id="5140962">`&#34;&gt;`</span><span class="op" id="5140966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140969">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5140981">=</span>&nbsp;<span class="op" id="5140983">[</span><span class="op" id="5140984">]</span><span class="builtintype" id="5140985">byte</span><span class="op" id="5140989">(</span><span class="string" id="5140990">&#34;&lt;/a&gt;&#34;</span><span class="op" id="5140996">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140999">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5141011">=</span>&nbsp;<span class="op" id="5141013">[</span><span class="op" id="5141014">]</span><span class="builtintype" id="5141015">byte</span><span class="op" id="5141019">(</span><span class="string" id="5141020">&#34;&lt;i&gt;&#34;</span><span class="op" id="5141025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141028">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5141040">=</span>&nbsp;<span class="op" id="5141042">[</span><span class="op" id="5141043">]</span><span class="builtintype" id="5141044">byte</span><span class="op" id="5141048">(</span><span class="string" id="5141049">&#34;&lt;/i&gt;&#34;</span><span class="op" id="5141055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141058">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5141070">=</span>&nbsp;<span class="op" id="5141072">[</span><span class="op" id="5141073">]</span><span class="builtintype" id="5141074">byte</span><span class="op" id="5141078">(</span><span class="string" id="5141079">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="5141086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141089">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5141101">=</span>&nbsp;<span class="op" id="5141103">[</span><span class="op" id="5141104">]</span><span class="builtintype" id="5141105">byte</span><span class="op" id="5141109">(</span><span class="string" id="5141110">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="5141118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141121">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5141133">=</span>&nbsp;<span class="op" id="5141135">[</span><span class="op" id="5141136">]</span><span class="builtintype" id="5141137">byte</span><span class="op" id="5141141">(</span><span class="string" id="5141142">&#34;&lt;pre&gt;&#34;</span><span class="op" id="5141149">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141152">html_endpre</span>&nbsp;<span class="op" id="5141164">=</span>&nbsp;<span class="op" id="5141166">[</span><span class="op" id="5141167">]</span><span class="builtintype" id="5141168">byte</span><span class="op" id="5141172">(</span><span class="string" id="5141173">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="5141183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141186">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5141198">=</span>&nbsp;<span class="op" id="5141200">[</span><span class="op" id="5141201">]</span><span class="builtintype" id="5141202">byte</span><span class="op" id="5141206">(</span><span class="string" id="5141207">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="5141217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141220">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5141232">=</span>&nbsp;<span class="op" id="5141234">[</span><span class="op" id="5141235">]</span><span class="builtintype" id="5141236">byte</span><span class="op" id="5141240">(</span><span class="string" id="5141241">`&#34;&gt;`</span><span class="op" id="5141245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141248">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5141260">=</span>&nbsp;<span class="op" id="5141262">[</span><span class="op" id="5141263">]</span><span class="builtintype" id="5141264">byte</span><span class="op" id="5141268">(</span><span class="string" id="5141269">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="5141278">)</span><br>
<span class="lineno"></span><span class="op" id="5141280">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="5141283">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="5141385">func</span>&nbsp;<span class="ident" id="5141390">pairedParensPrefixLen</span><span class="op" id="5141411">(</span><span class="ident" id="5141412">s</span>&nbsp;<span class="builtintype" id="5141414">string</span><span class="op" id="5141420">)</span>&nbsp;<span class="builtintype" id="5141422">int</span>&nbsp;<span class="op" id="5141426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141429">parens</span>&nbsp;<span class="op" id="5141436">:=</span>&nbsp;<span class="num" id="5141439">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141442">l</span>&nbsp;<span class="op" id="5141444">:=</span>&nbsp;<span class="builtinfunc" id="5141447">len</span><span class="op" id="5141450">(</span><span class="ident" id="5141451">s</span><span class="op" id="5141452">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141455">for</span>&nbsp;<span class="ident" id="5141459">i</span><span class="op" id="5141460">,</span>&nbsp;<span class="ident" id="5141462">ch</span>&nbsp;<span class="op" id="5141465">:=</span>&nbsp;<span class="keyword" id="5141468">range</span>&nbsp;<span class="ident" id="5141474">s</span>&nbsp;<span class="op" id="5141476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141480">switch</span>&nbsp;<span class="ident" id="5141487">ch</span>&nbsp;<span class="op" id="5141490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141494">case</span>&nbsp;<span class="string" id="5141499">&#39;(&#39;</span><span class="op" id="5141502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141507">if</span>&nbsp;<span class="ident" id="5141510">parens</span>&nbsp;<span class="op" id="5141517">==</span>&nbsp;<span class="num" id="5141520">0</span>&nbsp;<span class="op" id="5141522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141528">l</span>&nbsp;<span class="op" id="5141530">=</span>&nbsp;<span class="ident" id="5141532">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141542">parens</span><span class="op" id="5141548">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141553">case</span>&nbsp;<span class="string" id="5141558">&#39;)&#39;</span><span class="op" id="5141561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141566">parens</span><span class="op" id="5141572">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141578">if</span>&nbsp;<span class="ident" id="5141581">parens</span>&nbsp;<span class="op" id="5141588">==</span>&nbsp;<span class="num" id="5141591">0</span>&nbsp;<span class="op" id="5141593">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141599">l</span>&nbsp;<span class="op" id="5141601">=</span>&nbsp;<span class="builtinfunc" id="5141603">len</span><span class="op" id="5141606">(</span><span class="ident" id="5141607">s</span><span class="op" id="5141608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141613">}</span>&nbsp;<span class="keyword" id="5141615">else</span>&nbsp;<span class="keyword" id="5141620">if</span>&nbsp;<span class="ident" id="5141623">parens</span>&nbsp;<span class="op" id="5141630">&lt;</span>&nbsp;<span class="num" id="5141632">0</span>&nbsp;<span class="op" id="5141634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141640">return</span>&nbsp;<span class="ident" id="5141647">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141656">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141662">return</span>&nbsp;<span class="ident" id="5141669">l</span><br>
<span class="lineno"></span><span class="op" id="5141671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5141674">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="5141754">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="5141834">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5141911">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5141991">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="5142070">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="5142149">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="5142229">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="5142254">func</span>&nbsp;<span class="ident" id="5142259">emphasize</span><span class="op" id="5142268">(</span><span class="ident" id="5142269">w</span>&nbsp;<span class="ident" id="5142271">io</span><span class="op" id="5142273">.</span><span class="ident" id="5142274">Writer</span><span class="op" id="5142280">,</span>&nbsp;<span class="ident" id="5142282">line</span>&nbsp;<span class="builtintype" id="5142287">string</span><span class="op" id="5142293">,</span>&nbsp;<span class="ident" id="5142295">words</span>&nbsp;<span class="keyword" id="5142301">map</span><span class="op" id="5142304">[</span><span class="builtintype" id="5142305">string</span><span class="op" id="5142311">]</span><span class="builtintype" id="5142312">string</span><span class="op" id="5142318">,</span>&nbsp;<span class="ident" id="5142320">nice</span>&nbsp;<span class="builtintype" id="5142325">bool</span><span class="op" id="5142329">)</span>&nbsp;<span class="op" id="5142331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142334">for</span>&nbsp;<span class="op" id="5142338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142342">m</span>&nbsp;<span class="op" id="5142344">:=</span>&nbsp;<span class="ident" id="5142347">matchRx</span><span class="op" id="5142354">.</span><span class="ident" id="5142355">FindStringSubmatchIndex</span><span class="op" id="5142378">(</span><span class="ident" id="5142379">line</span><span class="op" id="5142383">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142387">if</span>&nbsp;<span class="ident" id="5142390">m</span>&nbsp;<span class="op" id="5142392">==</span>&nbsp;<span class="ident" id="5142395">nil</span>&nbsp;<span class="op" id="5142399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142404">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5142416">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5142490">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142519">commentEscape</span><span class="op" id="5142532">(</span><span class="ident" id="5142533">w</span><span class="op" id="5142534">,</span>&nbsp;<span class="ident" id="5142536">line</span><span class="op" id="5142540">[</span><span class="num" id="5142541">0</span><span class="op" id="5142542">:</span><span class="ident" id="5142543">m</span><span class="op" id="5142544">[</span><span class="num" id="5142545">0</span><span class="op" id="5142546">]</span><span class="op" id="5142547">]</span><span class="op" id="5142548">,</span>&nbsp;<span class="ident" id="5142550">nice</span><span class="op" id="5142554">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5142559">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142590">match</span>&nbsp;<span class="op" id="5142596">:=</span>&nbsp;<span class="ident" id="5142599">line</span><span class="op" id="5142603">[</span><span class="ident" id="5142604">m</span><span class="op" id="5142605">[</span><span class="num" id="5142606">0</span><span class="op" id="5142607">]</span><span class="op" id="5142608">:</span><span class="ident" id="5142609">m</span><span class="op" id="5142610">[</span><span class="num" id="5142611">1</span><span class="op" id="5142612">]</span><span class="op" id="5142613">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142617">if</span>&nbsp;<span class="ident" id="5142620">n</span>&nbsp;<span class="op" id="5142622">:=</span>&nbsp;<span class="ident" id="5142625">pairedParensPrefixLen</span><span class="op" id="5142646">(</span><span class="ident" id="5142647">match</span><span class="op" id="5142652">)</span><span class="op" id="5142653">;</span>&nbsp;<span class="ident" id="5142655">n</span>&nbsp;<span class="op" id="5142657">&lt;</span>&nbsp;<span class="builtinfunc" id="5142659">len</span><span class="op" id="5142662">(</span><span class="ident" id="5142663">match</span><span class="op" id="5142668">)</span>&nbsp;<span class="op" id="5142670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5142675">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5142725">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142785">m</span>&nbsp;<span class="op" id="5142787">=</span>&nbsp;<span class="ident" id="5142789">matchRx</span><span class="op" id="5142796">.</span><span class="ident" id="5142797">FindStringSubmatchIndex</span><span class="op" id="5142820">(</span><span class="ident" id="5142821">line</span><span class="op" id="5142825">[</span><span class="op" id="5142826">:</span><span class="ident" id="5142827">m</span><span class="op" id="5142828">[</span><span class="num" id="5142829">0</span><span class="op" id="5142830">]</span><span class="op" id="5142831">+</span><span class="ident" id="5142832">n</span><span class="op" id="5142833">]</span><span class="op" id="5142834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142839">match</span>&nbsp;<span class="op" id="5142845">=</span>&nbsp;<span class="ident" id="5142847">match</span><span class="op" id="5142852">[</span><span class="op" id="5142853">:</span><span class="ident" id="5142854">n</span><span class="op" id="5142855">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5142864">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142883">url</span>&nbsp;<span class="op" id="5142887">:=</span>&nbsp;<span class="string" id="5142890">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142895">italics</span>&nbsp;<span class="op" id="5142903">:=</span>&nbsp;<span class="builtintype" id="5142906">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142914">if</span>&nbsp;<span class="ident" id="5142917">words</span>&nbsp;<span class="op" id="5142923">!=</span>&nbsp;<span class="ident" id="5142926">nil</span>&nbsp;<span class="op" id="5142930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5142935">url</span><span class="op" id="5142938">,</span>&nbsp;<span class="ident" id="5142940">italics</span>&nbsp;<span class="op" id="5142948">=</span>&nbsp;<span class="ident" id="5142950">words</span><span class="op" id="5142955">[</span><span class="ident" id="5142956">match</span><span class="op" id="5142961">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5142965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5142969">if</span>&nbsp;<span class="ident" id="5142972">m</span><span class="op" id="5142973">[</span><span class="num" id="5142974">2</span><span class="op" id="5142975">]</span>&nbsp;<span class="op" id="5142977">&gt;=</span>&nbsp;<span class="num" id="5142980">0</span>&nbsp;<span class="op" id="5142982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5142987">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143067">if</span>&nbsp;<span class="op" id="5143070">!</span><span class="ident" id="5143071">italics</span>&nbsp;<span class="op" id="5143079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143085">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143144">url</span>&nbsp;<span class="op" id="5143148">=</span>&nbsp;<span class="ident" id="5143150">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143164">italics</span>&nbsp;<span class="op" id="5143172">=</span>&nbsp;<span class="builtintype" id="5143174">false</span>&nbsp;<span class="comment" id="5143180">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143211">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143228">if</span>&nbsp;<span class="builtinfunc" id="5143231">len</span><span class="op" id="5143234">(</span><span class="ident" id="5143235">url</span><span class="op" id="5143238">)</span>&nbsp;<span class="op" id="5143240">&gt;</span>&nbsp;<span class="num" id="5143242">0</span>&nbsp;<span class="op" id="5143244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143249">w</span><span class="op" id="5143250">.</span><span class="ident" id="5143251">Write</span><span class="op" id="5143256">(</span><span class="ident" id="5143257">html_a</span><span class="op" id="5143263">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143268">template</span><span class="op" id="5143276">.</span><span class="ident" id="5143277">HTMLEscape</span><span class="op" id="5143287">(</span><span class="ident" id="5143288">w</span><span class="op" id="5143289">,</span>&nbsp;<span class="op" id="5143291">[</span><span class="op" id="5143292">]</span><span class="builtintype" id="5143293">byte</span><span class="op" id="5143297">(</span><span class="ident" id="5143298">url</span><span class="op" id="5143301">)</span><span class="op" id="5143302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143307">w</span><span class="op" id="5143308">.</span><span class="ident" id="5143309">Write</span><span class="op" id="5143314">(</span><span class="ident" id="5143315">html_aq</span><span class="op" id="5143322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143330">if</span>&nbsp;<span class="ident" id="5143333">italics</span>&nbsp;<span class="op" id="5143341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143346">w</span><span class="op" id="5143347">.</span><span class="ident" id="5143348">Write</span><span class="op" id="5143353">(</span><span class="ident" id="5143354">html_i</span><span class="op" id="5143360">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143368">commentEscape</span><span class="op" id="5143381">(</span><span class="ident" id="5143382">w</span><span class="op" id="5143383">,</span>&nbsp;<span class="ident" id="5143385">match</span><span class="op" id="5143390">,</span>&nbsp;<span class="ident" id="5143392">nice</span><span class="op" id="5143396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143400">if</span>&nbsp;<span class="ident" id="5143403">italics</span>&nbsp;<span class="op" id="5143411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143416">w</span><span class="op" id="5143417">.</span><span class="ident" id="5143418">Write</span><span class="op" id="5143423">(</span><span class="ident" id="5143424">html_endi</span><span class="op" id="5143433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143437">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143441">if</span>&nbsp;<span class="builtinfunc" id="5143444">len</span><span class="op" id="5143447">(</span><span class="ident" id="5143448">url</span><span class="op" id="5143451">)</span>&nbsp;<span class="op" id="5143453">&gt;</span>&nbsp;<span class="num" id="5143455">0</span>&nbsp;<span class="op" id="5143457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143462">w</span><span class="op" id="5143463">.</span><span class="ident" id="5143464">Write</span><span class="op" id="5143469">(</span><span class="ident" id="5143470">html_enda</span><span class="op" id="5143479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143488">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143501">line</span>&nbsp;<span class="op" id="5143506">=</span>&nbsp;<span class="ident" id="5143508">line</span><span class="op" id="5143512">[</span><span class="ident" id="5143513">m</span><span class="op" id="5143514">[</span><span class="num" id="5143515">1</span><span class="op" id="5143516">]</span><span class="op" id="5143517">:</span><span class="op" id="5143518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143524">commentEscape</span><span class="op" id="5143537">(</span><span class="ident" id="5143538">w</span><span class="op" id="5143539">,</span>&nbsp;<span class="ident" id="5143541">line</span><span class="op" id="5143545">,</span>&nbsp;<span class="ident" id="5143547">nice</span><span class="op" id="5143551">)</span><br>
<span class="lineno"></span><span class="op" id="5143553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="5143556">func</span>&nbsp;<span class="ident" id="5143561">indentLen</span><span class="op" id="5143570">(</span><span class="ident" id="5143571">s</span>&nbsp;<span class="builtintype" id="5143573">string</span><span class="op" id="5143579">)</span>&nbsp;<span class="builtintype" id="5143581">int</span>&nbsp;<span class="op" id="5143585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143588">i</span>&nbsp;<span class="op" id="5143590">:=</span>&nbsp;<span class="num" id="5143593">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143596">for</span>&nbsp;<span class="ident" id="5143600">i</span>&nbsp;<span class="op" id="5143602">&lt;</span>&nbsp;<span class="builtinfunc" id="5143604">len</span><span class="op" id="5143607">(</span><span class="ident" id="5143608">s</span><span class="op" id="5143609">)</span>&nbsp;<span class="op" id="5143611">&amp;&amp;</span>&nbsp;<span class="op" id="5143614">(</span><span class="ident" id="5143615">s</span><span class="op" id="5143616">[</span><span class="ident" id="5143617">i</span><span class="op" id="5143618">]</span>&nbsp;<span class="op" id="5143620">==</span>&nbsp;<span class="string" id="5143623">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5143627">||</span>&nbsp;<span class="ident" id="5143630">s</span><span class="op" id="5143631">[</span><span class="ident" id="5143632">i</span><span class="op" id="5143633">]</span>&nbsp;<span class="op" id="5143635">==</span>&nbsp;<span class="string" id="5143638">&#39;\t&#39;</span><span class="op" id="5143642">)</span>&nbsp;<span class="op" id="5143644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143648">i</span><span class="op" id="5143649">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143653">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143656">return</span>&nbsp;<span class="ident" id="5143663">i</span><br>
<span class="lineno"></span><span class="op" id="5143665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5143668">func</span>&nbsp;<span class="ident" id="5143673">isBlank</span><span class="op" id="5143680">(</span><span class="ident" id="5143681">s</span>&nbsp;<span class="builtintype" id="5143683">string</span><span class="op" id="5143689">)</span>&nbsp;<span class="builtintype" id="5143691">bool</span>&nbsp;<span class="op" id="5143696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143699">return</span>&nbsp;<span class="builtinfunc" id="5143706">len</span><span class="op" id="5143709">(</span><span class="ident" id="5143710">s</span><span class="op" id="5143711">)</span>&nbsp;<span class="op" id="5143713">==</span>&nbsp;<span class="num" id="5143716">0</span>&nbsp;<span class="op" id="5143718">||</span>&nbsp;<span class="op" id="5143721">(</span><span class="builtinfunc" id="5143722">len</span><span class="op" id="5143725">(</span><span class="ident" id="5143726">s</span><span class="op" id="5143727">)</span>&nbsp;<span class="op" id="5143729">==</span>&nbsp;<span class="num" id="5143732">1</span>&nbsp;<span class="op" id="5143734">&amp;&amp;</span>&nbsp;<span class="ident" id="5143737">s</span><span class="op" id="5143738">[</span><span class="num" id="5143739">0</span><span class="op" id="5143740">]</span>&nbsp;<span class="op" id="5143742">==</span>&nbsp;<span class="string" id="5143745">&#39;\n&#39;</span><span class="op" id="5143749">)</span><br>
<span class="lineno">175</span><span class="op" id="5143751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5143754">func</span>&nbsp;<span class="ident" id="5143759">commonPrefix</span><span class="op" id="5143771">(</span><span class="ident" id="5143772">a</span><span class="op" id="5143773">,</span>&nbsp;<span class="ident" id="5143775">b</span>&nbsp;<span class="builtintype" id="5143777">string</span><span class="op" id="5143783">)</span>&nbsp;<span class="builtintype" id="5143785">string</span>&nbsp;<span class="op" id="5143792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143795">i</span>&nbsp;<span class="op" id="5143797">:=</span>&nbsp;<span class="num" id="5143800">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143803">for</span>&nbsp;<span class="ident" id="5143807">i</span>&nbsp;<span class="op" id="5143809">&lt;</span>&nbsp;<span class="builtinfunc" id="5143811">len</span><span class="op" id="5143814">(</span><span class="ident" id="5143815">a</span><span class="op" id="5143816">)</span>&nbsp;<span class="op" id="5143818">&amp;&amp;</span>&nbsp;<span class="ident" id="5143821">i</span>&nbsp;<span class="op" id="5143823">&lt;</span>&nbsp;<span class="builtinfunc" id="5143825">len</span><span class="op" id="5143828">(</span><span class="ident" id="5143829">b</span><span class="op" id="5143830">)</span>&nbsp;<span class="op" id="5143832">&amp;&amp;</span>&nbsp;<span class="ident" id="5143835">a</span><span class="op" id="5143836">[</span><span class="ident" id="5143837">i</span><span class="op" id="5143838">]</span>&nbsp;<span class="op" id="5143840">==</span>&nbsp;<span class="ident" id="5143843">b</span><span class="op" id="5143844">[</span><span class="ident" id="5143845">i</span><span class="op" id="5143846">]</span>&nbsp;<span class="op" id="5143848">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143852">i</span><span class="op" id="5143853">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143860">return</span>&nbsp;<span class="ident" id="5143867">a</span><span class="op" id="5143868">[</span><span class="num" id="5143869">0</span><span class="op" id="5143870">:</span><span class="ident" id="5143871">i</span><span class="op" id="5143872">]</span><br>
<span class="lineno"></span><span class="op" id="5143874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5143877">func</span>&nbsp;<span class="ident" id="5143882">unindent</span><span class="op" id="5143890">(</span><span class="ident" id="5143891">block</span>&nbsp;<span class="op" id="5143897">[</span><span class="op" id="5143898">]</span><span class="builtintype" id="5143899">string</span><span class="op" id="5143905">)</span>&nbsp;<span class="op" id="5143907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143910">if</span>&nbsp;<span class="builtinfunc" id="5143913">len</span><span class="op" id="5143916">(</span><span class="ident" id="5143917">block</span><span class="op" id="5143922">)</span>&nbsp;<span class="op" id="5143924">==</span>&nbsp;<span class="num" id="5143927">0</span>&nbsp;<span class="op" id="5143929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5143933">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5143941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5143945">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5143985">prefix</span>&nbsp;<span class="op" id="5143992">:=</span>&nbsp;<span class="ident" id="5143995">block</span><span class="op" id="5144000">[</span><span class="num" id="5144001">0</span><span class="op" id="5144002">]</span><span class="op" id="5144003">[</span><span class="num" id="5144004">0</span><span class="op" id="5144005">:</span><span class="ident" id="5144006">indentLen</span><span class="op" id="5144015">(</span><span class="ident" id="5144016">block</span><span class="op" id="5144021">[</span><span class="num" id="5144022">0</span><span class="op" id="5144023">]</span><span class="op" id="5144024">)</span><span class="op" id="5144025">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144028">for</span>&nbsp;<span class="ident" id="5144032">_</span><span class="op" id="5144033">,</span>&nbsp;<span class="ident" id="5144035">line</span>&nbsp;<span class="op" id="5144040">:=</span>&nbsp;<span class="keyword" id="5144043">range</span>&nbsp;<span class="ident" id="5144049">block</span>&nbsp;<span class="op" id="5144055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144059">if</span>&nbsp;<span class="op" id="5144062">!</span><span class="ident" id="5144063">isBlank</span><span class="op" id="5144070">(</span><span class="ident" id="5144071">line</span><span class="op" id="5144075">)</span>&nbsp;<span class="op" id="5144077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144082">prefix</span>&nbsp;<span class="op" id="5144089">=</span>&nbsp;<span class="ident" id="5144091">commonPrefix</span><span class="op" id="5144103">(</span><span class="ident" id="5144104">prefix</span><span class="op" id="5144110">,</span>&nbsp;<span class="ident" id="5144112">line</span><span class="op" id="5144116">[</span><span class="num" id="5144117">0</span><span class="op" id="5144118">:</span><span class="ident" id="5144119">indentLen</span><span class="op" id="5144128">(</span><span class="ident" id="5144129">line</span><span class="op" id="5144133">)</span><span class="op" id="5144134">]</span><span class="op" id="5144135">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5144139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5144142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144145">n</span>&nbsp;<span class="op" id="5144147">:=</span>&nbsp;<span class="builtinfunc" id="5144150">len</span><span class="op" id="5144153">(</span><span class="ident" id="5144154">prefix</span><span class="op" id="5144160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144164">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144175">for</span>&nbsp;<span class="ident" id="5144179">i</span><span class="op" id="5144180">,</span>&nbsp;<span class="ident" id="5144182">line</span>&nbsp;<span class="op" id="5144187">:=</span>&nbsp;<span class="keyword" id="5144190">range</span>&nbsp;<span class="ident" id="5144196">block</span>&nbsp;<span class="op" id="5144202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144206">if</span>&nbsp;<span class="op" id="5144209">!</span><span class="ident" id="5144210">isBlank</span><span class="op" id="5144217">(</span><span class="ident" id="5144218">line</span><span class="op" id="5144222">)</span>&nbsp;<span class="op" id="5144224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144229">block</span><span class="op" id="5144234">[</span><span class="ident" id="5144235">i</span><span class="op" id="5144236">]</span>&nbsp;<span class="op" id="5144238">=</span>&nbsp;<span class="ident" id="5144240">line</span><span class="op" id="5144244">[</span><span class="ident" id="5144245">n</span><span class="op" id="5144246">:</span><span class="op" id="5144247">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5144251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5144254">}</span><br>
<span class="lineno">205</span><span class="op" id="5144256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5144259">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="5144330">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5144372">func</span>&nbsp;<span class="ident" id="5144377">heading</span><span class="op" id="5144384">(</span><span class="ident" id="5144385">line</span>&nbsp;<span class="builtintype" id="5144390">string</span><span class="op" id="5144396">)</span>&nbsp;<span class="builtintype" id="5144398">string</span>&nbsp;<span class="op" id="5144405">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144408">line</span>&nbsp;<span class="op" id="5144413">=</span>&nbsp;<span class="ident" id="5144415">strings</span><span class="op" id="5144422">.</span><span class="ident" id="5144423">TrimSpace</span><span class="op" id="5144432">(</span><span class="ident" id="5144433">line</span><span class="op" id="5144437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144440">if</span>&nbsp;<span class="builtinfunc" id="5144443">len</span><span class="op" id="5144446">(</span><span class="ident" id="5144447">line</span><span class="op" id="5144451">)</span>&nbsp;<span class="op" id="5144453">==</span>&nbsp;<span class="num" id="5144456">0</span>&nbsp;<span class="op" id="5144458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144462">return</span>&nbsp;<span class="string" id="5144469">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5144473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144477">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144527">r</span><span class="op" id="5144528">,</span>&nbsp;<span class="ident" id="5144530">_</span>&nbsp;<span class="op" id="5144532">:=</span>&nbsp;<span class="ident" id="5144535">utf8</span><span class="op" id="5144539">.</span><span class="ident" id="5144540">DecodeRuneInString</span><span class="op" id="5144558">(</span><span class="ident" id="5144559">line</span><span class="op" id="5144563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144566">if</span>&nbsp;<span class="op" id="5144569">!</span><span class="ident" id="5144570">unicode</span><span class="op" id="5144577">.</span><span class="ident" id="5144578">IsLetter</span><span class="op" id="5144586">(</span><span class="ident" id="5144587">r</span><span class="op" id="5144588">)</span>&nbsp;<span class="op" id="5144590">||</span>&nbsp;<span class="op" id="5144593">!</span><span class="ident" id="5144594">unicode</span><span class="op" id="5144601">.</span><span class="ident" id="5144602">IsUpper</span><span class="op" id="5144609">(</span><span class="ident" id="5144610">r</span><span class="op" id="5144611">)</span>&nbsp;<span class="op" id="5144613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144617">return</span>&nbsp;<span class="string" id="5144624">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5144628">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144632">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144670">r</span><span class="op" id="5144671">,</span>&nbsp;<span class="ident" id="5144673">_</span>&nbsp;<span class="op" id="5144675">=</span>&nbsp;<span class="ident" id="5144677">utf8</span><span class="op" id="5144681">.</span><span class="ident" id="5144682">DecodeLastRuneInString</span><span class="op" id="5144704">(</span><span class="ident" id="5144705">line</span><span class="op" id="5144709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144712">if</span>&nbsp;<span class="op" id="5144715">!</span><span class="ident" id="5144716">unicode</span><span class="op" id="5144723">.</span><span class="ident" id="5144724">IsLetter</span><span class="op" id="5144732">(</span><span class="ident" id="5144733">r</span><span class="op" id="5144734">)</span>&nbsp;<span class="op" id="5144736">&amp;&amp;</span>&nbsp;<span class="op" id="5144739">!</span><span class="ident" id="5144740">unicode</span><span class="op" id="5144747">.</span><span class="ident" id="5144748">IsDigit</span><span class="op" id="5144755">(</span><span class="ident" id="5144756">r</span><span class="op" id="5144757">)</span>&nbsp;<span class="op" id="5144759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144763">return</span>&nbsp;<span class="string" id="5144770">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5144774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144778">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144820">if</span>&nbsp;<span class="ident" id="5144823">strings</span><span class="op" id="5144830">.</span><span class="ident" id="5144831">IndexAny</span><span class="op" id="5144839">(</span><span class="ident" id="5144840">line</span><span class="op" id="5144844">,</span>&nbsp;<span class="string" id="5144846">&#34;,.;:!?+*/=()[]{}_^°&amp;§~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="5144881">)</span>&nbsp;<span class="op" id="5144883">&gt;=</span>&nbsp;<span class="num" id="5144886">0</span>&nbsp;<span class="op" id="5144888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144892">return</span>&nbsp;<span class="string" id="5144899">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5144903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5144907">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5144946">for</span>&nbsp;<span class="ident" id="5144950">b</span>&nbsp;<span class="op" id="5144952">:=</span>&nbsp;<span class="ident" id="5144955">line</span><span class="op" id="5144959">;</span>&nbsp;<span class="op" id="5144961">;</span>&nbsp;<span class="op" id="5144963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5144967">i</span>&nbsp;<span class="op" id="5144969">:=</span>&nbsp;<span class="ident" id="5144972">strings</span><span class="op" id="5144979">.</span><span class="ident" id="5144980">IndexRune</span><span class="op" id="5144989">(</span><span class="ident" id="5144990">b</span><span class="op" id="5144991">,</span>&nbsp;<span class="string" id="5144993">&#39;\&#39;&#39;</span><span class="op" id="5144997">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5145001">if</span>&nbsp;<span class="ident" id="5145004">i</span>&nbsp;<span class="op" id="5145006">&lt;</span>&nbsp;<span class="num" id="5145008">0</span>&nbsp;<span class="op" id="5145010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5145015">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5145023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5145027">if</span>&nbsp;<span class="ident" id="5145030">i</span><span class="op" id="5145031">+</span><span class="num" id="5145032">1</span>&nbsp;<span class="op" id="5145034">&gt;=</span>&nbsp;<span class="builtinfunc" id="5145037">len</span><span class="op" id="5145040">(</span><span class="ident" id="5145041">b</span><span class="op" id="5145042">)</span>&nbsp;<span class="op" id="5145044">||</span>&nbsp;<span class="ident" id="5145047">b</span><span class="op" id="5145048">[</span><span class="ident" id="5145049">i</span><span class="op" id="5145050">+</span><span class="num" id="5145051">1</span><span class="op" id="5145052">]</span>&nbsp;<span class="op" id="5145054">!=</span>&nbsp;<span class="string" id="5145057">&#39;s&#39;</span>&nbsp;<span class="op" id="5145061">||</span>&nbsp;<span class="op" id="5145064">(</span><span class="ident" id="5145065">i</span><span class="op" id="5145066">+</span><span class="num" id="5145067">2</span>&nbsp;<span class="op" id="5145069">&lt;</span>&nbsp;<span class="builtinfunc" id="5145071">len</span><span class="op" id="5145074">(</span><span class="ident" id="5145075">b</span><span class="op" id="5145076">)</span>&nbsp;<span class="op" id="5145078">&amp;&amp;</span>&nbsp;<span class="ident" id="5145081">b</span><span class="op" id="5145082">[</span><span class="ident" id="5145083">i</span><span class="op" id="5145084">+</span><span class="num" id="5145085">2</span><span class="op" id="5145086">]</span>&nbsp;<span class="op" id="5145088">!=</span>&nbsp;<span class="string" id="5145091">&#39;&nbsp;&#39;</span><span class="op" id="5145094">)</span>&nbsp;<span class="op" id="5145096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5145101">return</span>&nbsp;<span class="string" id="5145108">&#34;&#34;</span>&nbsp;<span class="comment" id="5145111">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5145137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5145141">b</span>&nbsp;<span class="op" id="5145143">=</span>&nbsp;<span class="ident" id="5145145">b</span><span class="op" id="5145146">[</span><span class="ident" id="5145147">i</span><span class="op" id="5145148">+</span><span class="num" id="5145149">2</span><span class="op" id="5145150">:</span><span class="op" id="5145151">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5145154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5145158">return</span>&nbsp;<span class="ident" id="5145165">line</span><br>
<span class="lineno">245</span><span class="op" id="5145170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5145173">type</span>&nbsp;<span class="ident" id="5145178">op</span>&nbsp;<span class="builtintype" id="5145181">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5145186">const</span>&nbsp;<span class="op" id="5145192">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5145195">opPara</span>&nbsp;<span class="ident" id="5145202">op</span>&nbsp;<span class="op" id="5145205">=</span>&nbsp;<span class="ident" id="5145207">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5145213">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5145221">opPre</span><br>
<span class="lineno"></span><span class="op" id="5145227">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5145230">type</span>&nbsp;<span class="ident" id="5145235">block</span>&nbsp;<span class="keyword" id="5145241">struct</span>&nbsp;<span class="op" id="5145248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5145251">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5145257">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5145261">lines</span>&nbsp;<span class="op" id="5145267">[</span><span class="op" id="5145268">]</span><span class="builtintype" id="5145269">string</span><br>
<span class="lineno"></span><span class="op" id="5145276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5145279">var</span>&nbsp;<span class="ident" id="5145283">nonAlphaNumRx</span>&nbsp;<span class="op" id="5145297">=</span>&nbsp;<span class="ident" id="5145299">regexp</span><span class="op" id="5145305">.</span><span class="ident" id="5145306">MustCompile</span><span class="op" id="5145317">(</span><span class="string" id="5145318">`[^a-zA-Z0-9]`</span><span class="op" id="5145332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5145335">func</span>&nbsp;<span class="ident" id="5145340">anchorID</span><span class="op" id="5145348">(</span><span class="ident" id="5145349">line</span>&nbsp;<span class="builtintype" id="5145354">string</span><span class="op" id="5145360">)</span>&nbsp;<span class="builtintype" id="5145362">string</span>&nbsp;<span class="op" id="5145369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5145372">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5145452">return</span>&nbsp;<span class="string" id="5145459">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="5145466">+</span>&nbsp;<span class="ident" id="5145468">nonAlphaNumRx</span><span class="op" id="5145481">.</span><span class="ident" id="5145482">ReplaceAllString</span><span class="op" id="5145498">(</span><span class="ident" id="5145499">line</span><span class="op" id="5145503">,</span>&nbsp;<span class="string" id="5145505">&#34;_&#34;</span><span class="op" id="5145508">)</span><br>
<span class="lineno">265</span><span class="op" id="5145510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5145513">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="5145564">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="5145606">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="5145666">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="5145718">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5145768">//</span><br>
<span class="lineno"></span><span class="comment" id="5145771">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="5145832">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="5145903">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="5145972">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="5146033">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="5146063">//</span><br>
<span class="lineno"></span><span class="comment" id="5146066">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="5146127">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5146169">//</span><br>
<span class="lineno"></span><span class="comment" id="5146172">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="5146250">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="5146328">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="5146397">//</span><br>
<span class="lineno"></span><span class="comment" id="5146400">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5146484">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5146571">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5146587">func</span>&nbsp;<span class="ident" id="5146592">ToHTML</span><span class="op" id="5146598">(</span><span class="ident" id="5146599">w</span>&nbsp;<span class="ident" id="5146601">io</span><span class="op" id="5146603">.</span><span class="ident" id="5146604">Writer</span><span class="op" id="5146610">,</span>&nbsp;<span class="ident" id="5146612">text</span>&nbsp;<span class="builtintype" id="5146617">string</span><span class="op" id="5146623">,</span>&nbsp;<span class="ident" id="5146625">words</span>&nbsp;<span class="keyword" id="5146631">map</span><span class="op" id="5146634">[</span><span class="builtintype" id="5146635">string</span><span class="op" id="5146641">]</span><span class="builtintype" id="5146642">string</span><span class="op" id="5146648">)</span>&nbsp;<span class="op" id="5146650">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5146653">for</span>&nbsp;<span class="ident" id="5146657">_</span><span class="op" id="5146658">,</span>&nbsp;<span class="ident" id="5146660">b</span>&nbsp;<span class="op" id="5146662">:=</span>&nbsp;<span class="keyword" id="5146665">range</span>&nbsp;<span class="ident" id="5146671">blocks</span><span class="op" id="5146677">(</span><span class="ident" id="5146678">text</span><span class="op" id="5146682">)</span>&nbsp;<span class="op" id="5146684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5146688">switch</span>&nbsp;<span class="ident" id="5146695">b</span><span class="op" id="5146696">.</span><span class="ident" id="5146697">op</span>&nbsp;<span class="op" id="5146700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5146704">case</span>&nbsp;<span class="ident" id="5146709">opPara</span><span class="op" id="5146715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5146720">w</span><span class="op" id="5146721">.</span><span class="ident" id="5146722">Write</span><span class="op" id="5146727">(</span><span class="ident" id="5146728">html_p</span><span class="op" id="5146734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5146739">for</span>&nbsp;<span class="ident" id="5146743">_</span><span class="op" id="5146744">,</span>&nbsp;<span class="ident" id="5146746">line</span>&nbsp;<span class="op" id="5146751">:=</span>&nbsp;<span class="keyword" id="5146754">range</span>&nbsp;<span class="ident" id="5146760">b</span><span class="op" id="5146761">.</span><span class="ident" id="5146762">lines</span>&nbsp;<span class="op" id="5146768">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5146774">emphasize</span><span class="op" id="5146783">(</span><span class="ident" id="5146784">w</span><span class="op" id="5146785">,</span>&nbsp;<span class="ident" id="5146787">line</span><span class="op" id="5146791">,</span>&nbsp;<span class="ident" id="5146793">words</span><span class="op" id="5146798">,</span>&nbsp;<span class="builtintype" id="5146800">true</span><span class="op" id="5146804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5146809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5146814">w</span><span class="op" id="5146815">.</span><span class="ident" id="5146816">Write</span><span class="op" id="5146821">(</span><span class="ident" id="5146822">html_endp</span><span class="op" id="5146831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5146835">case</span>&nbsp;<span class="ident" id="5146840">opHead</span><span class="op" id="5146846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5146851">w</span><span class="op" id="5146852">.</span><span class="ident" id="5146853">Write</span><span class="op" id="5146858">(</span><span class="ident" id="5146859">html_h</span><span class="op" id="5146865">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5146870">id</span>&nbsp;<span class="op" id="5146873">:=</span>&nbsp;<span class="string" id="5146876">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5146882">for</span>&nbsp;<span class="ident" id="5146886">_</span><span class="op" id="5146887">,</span>&nbsp;<span class="ident" id="5146889">line</span>&nbsp;<span class="op" id="5146894">:=</span>&nbsp;<span class="keyword" id="5146897">range</span>&nbsp;<span class="ident" id="5146903">b</span><span class="op" id="5146904">.</span><span class="ident" id="5146905">lines</span>&nbsp;<span class="op" id="5146911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5146917">if</span>&nbsp;<span class="ident" id="5146920">id</span>&nbsp;<span class="op" id="5146923">==</span>&nbsp;<span class="string" id="5146926">&#34;&#34;</span>&nbsp;<span class="op" id="5146929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5146936">id</span>&nbsp;<span class="op" id="5146939">=</span>&nbsp;<span class="ident" id="5146941">anchorID</span><span class="op" id="5146949">(</span><span class="ident" id="5146950">line</span><span class="op" id="5146954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5146961">w</span><span class="op" id="5146962">.</span><span class="ident" id="5146963">Write</span><span class="op" id="5146968">(</span><span class="op" id="5146969">[</span><span class="op" id="5146970">]</span><span class="builtintype" id="5146971">byte</span><span class="op" id="5146975">(</span><span class="ident" id="5146976">id</span><span class="op" id="5146978">)</span><span class="op" id="5146979">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5146986">w</span><span class="op" id="5146987">.</span><span class="ident" id="5146988">Write</span><span class="op" id="5146993">(</span><span class="ident" id="5146994">html_hq</span><span class="op" id="5147001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147013">commentEscape</span><span class="op" id="5147026">(</span><span class="ident" id="5147027">w</span><span class="op" id="5147028">,</span>&nbsp;<span class="ident" id="5147030">line</span><span class="op" id="5147034">,</span>&nbsp;<span class="builtintype" id="5147036">true</span><span class="op" id="5147040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5147050">if</span>&nbsp;<span class="ident" id="5147053">id</span>&nbsp;<span class="op" id="5147056">==</span>&nbsp;<span class="string" id="5147059">&#34;&#34;</span>&nbsp;<span class="op" id="5147062">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147068">w</span><span class="op" id="5147069">.</span><span class="ident" id="5147070">Write</span><span class="op" id="5147075">(</span><span class="ident" id="5147076">html_hq</span><span class="op" id="5147083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147093">w</span><span class="op" id="5147094">.</span><span class="ident" id="5147095">Write</span><span class="op" id="5147100">(</span><span class="ident" id="5147101">html_endh</span><span class="op" id="5147110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5147114">case</span>&nbsp;<span class="ident" id="5147119">opPre</span><span class="op" id="5147124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147129">w</span><span class="op" id="5147130">.</span><span class="ident" id="5147131">Write</span><span class="op" id="5147136">(</span><span class="ident" id="5147137">html_pre</span><span class="op" id="5147145">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5147150">for</span>&nbsp;<span class="ident" id="5147154">_</span><span class="op" id="5147155">,</span>&nbsp;<span class="ident" id="5147157">line</span>&nbsp;<span class="op" id="5147162">:=</span>&nbsp;<span class="keyword" id="5147165">range</span>&nbsp;<span class="ident" id="5147171">b</span><span class="op" id="5147172">.</span><span class="ident" id="5147173">lines</span>&nbsp;<span class="op" id="5147179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147185">emphasize</span><span class="op" id="5147194">(</span><span class="ident" id="5147195">w</span><span class="op" id="5147196">,</span>&nbsp;<span class="ident" id="5147198">line</span><span class="op" id="5147202">,</span>&nbsp;<span class="ident" id="5147204">nil</span><span class="op" id="5147207">,</span>&nbsp;<span class="builtintype" id="5147209">false</span><span class="op" id="5147214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147224">w</span><span class="op" id="5147225">.</span><span class="ident" id="5147226">Write</span><span class="op" id="5147231">(</span><span class="ident" id="5147232">html_endpre</span><span class="op" id="5147243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147247">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147250">}</span><br>
<span class="lineno"></span><span class="op" id="5147252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5147255">func</span>&nbsp;<span class="ident" id="5147260">blocks</span><span class="op" id="5147266">(</span><span class="ident" id="5147267">text</span>&nbsp;<span class="builtintype" id="5147272">string</span><span class="op" id="5147278">)</span>&nbsp;<span class="op" id="5147280">[</span><span class="op" id="5147281">]</span><span class="ident" id="5147282">block</span>&nbsp;<span class="op" id="5147288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5147291">var</span>&nbsp;<span class="op" id="5147295">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147299">out</span>&nbsp;&nbsp;<span class="op" id="5147304">[</span><span class="op" id="5147305">]</span><span class="ident" id="5147306">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147314">para</span>&nbsp;<span class="op" id="5147319">[</span><span class="op" id="5147320">]</span><span class="builtintype" id="5147321">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147331">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5147346">=</span>&nbsp;<span class="builtintype" id="5147348">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147356">lastWasHeading</span>&nbsp;<span class="op" id="5147371">=</span>&nbsp;<span class="builtintype" id="5147373">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5147384">close</span>&nbsp;<span class="op" id="5147390">:=</span>&nbsp;<span class="keyword" id="5147393">func</span><span class="op" id="5147397">(</span><span class="op" id="5147398">)</span>&nbsp;<span class="op" id="5147400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5147404">if</span>&nbsp;<span class="ident" id="5147407">para</span>&nbsp;<span class="op" id="5147412">!=</span>&nbsp;<span class="ident" id="5147415">nil</span>&nbsp;<span class="op" id="5147419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147424">out</span>&nbsp;<span class="op" id="5147428">=</span>&nbsp;<span class="builtinfunc" id="5147430">append</span><span class="op" id="5147436">(</span><span class="ident" id="5147437">out</span><span class="op" id="5147440">,</span>&nbsp;<span class="ident" id="5147442">block</span><span class="op" id="5147447">{</span><span class="ident" id="5147448">opPara</span><span class="op" id="5147454">,</span>&nbsp;<span class="ident" id="5147456">para</span><span class="op" id="5147460">}</span><span class="op" id="5147461">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147466">para</span>&nbsp;<span class="op" id="5147471">=</span>&nbsp;<span class="ident" id="5147473">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147486">lines</span>&nbsp;<span class="op" id="5147492">:=</span>&nbsp;<span class="ident" id="5147495">strings</span><span class="op" id="5147502">.</span><span class="ident" id="5147503">SplitAfter</span><span class="op" id="5147513">(</span><span class="ident" id="5147514">text</span><span class="op" id="5147518">,</span>&nbsp;<span class="string" id="5147520">&#34;\n&#34;</span><span class="op" id="5147524">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147527">unindent</span><span class="op" id="5147535">(</span><span class="ident" id="5147536">lines</span><span class="op" id="5147541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5147544">for</span>&nbsp;<span class="ident" id="5147548">i</span>&nbsp;<span class="op" id="5147550">:=</span>&nbsp;<span class="num" id="5147553">0</span><span class="op" id="5147554">;</span>&nbsp;<span class="ident" id="5147556">i</span>&nbsp;<span class="op" id="5147558">&lt;</span>&nbsp;<span class="builtinfunc" id="5147560">len</span><span class="op" id="5147563">(</span><span class="ident" id="5147564">lines</span><span class="op" id="5147569">)</span><span class="op" id="5147570">;</span>&nbsp;<span class="op" id="5147572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147576">line</span>&nbsp;<span class="op" id="5147581">:=</span>&nbsp;<span class="ident" id="5147584">lines</span><span class="op" id="5147589">[</span><span class="ident" id="5147590">i</span><span class="op" id="5147591">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5147595">if</span>&nbsp;<span class="ident" id="5147598">isBlank</span><span class="op" id="5147605">(</span><span class="ident" id="5147606">line</span><span class="op" id="5147610">)</span>&nbsp;<span class="op" id="5147612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5147617">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5147639">close</span><span class="op" id="5147644">(</span><span class="op" id="5147645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147650">i</span><span class="op" id="5147651">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147657">lastWasBlank</span>&nbsp;<span class="op" id="5147670">=</span>&nbsp;<span class="builtintype" id="5147672">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5147680">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147691">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5147695">if</span>&nbsp;<span class="ident" id="5147698">indentLen</span><span class="op" id="5147707">(</span><span class="ident" id="5147708">line</span><span class="op" id="5147712">)</span>&nbsp;<span class="op" id="5147714">&gt;</span>&nbsp;<span class="num" id="5147716">0</span>&nbsp;<span class="op" id="5147718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5147723">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5147745">close</span><span class="op" id="5147750">(</span><span class="op" id="5147751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5147757">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147793">j</span>&nbsp;<span class="op" id="5147795">:=</span>&nbsp;<span class="ident" id="5147798">i</span>&nbsp;<span class="op" id="5147800">+</span>&nbsp;<span class="num" id="5147802">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5147807">for</span>&nbsp;<span class="ident" id="5147811">j</span>&nbsp;<span class="op" id="5147813">&lt;</span>&nbsp;<span class="builtinfunc" id="5147815">len</span><span class="op" id="5147818">(</span><span class="ident" id="5147819">lines</span><span class="op" id="5147824">)</span>&nbsp;<span class="op" id="5147826">&amp;&amp;</span>&nbsp;<span class="op" id="5147829">(</span><span class="ident" id="5147830">isBlank</span><span class="op" id="5147837">(</span><span class="ident" id="5147838">lines</span><span class="op" id="5147843">[</span><span class="ident" id="5147844">j</span><span class="op" id="5147845">]</span><span class="op" id="5147846">)</span>&nbsp;<span class="op" id="5147848">||</span>&nbsp;<span class="ident" id="5147851">indentLen</span><span class="op" id="5147860">(</span><span class="ident" id="5147861">lines</span><span class="op" id="5147866">[</span><span class="ident" id="5147867">j</span><span class="op" id="5147868">]</span><span class="op" id="5147869">)</span>&nbsp;<span class="op" id="5147871">&gt;</span>&nbsp;<span class="num" id="5147873">0</span><span class="op" id="5147874">)</span>&nbsp;<span class="op" id="5147876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147882">j</span><span class="op" id="5147883">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5147894">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5147929">for</span>&nbsp;<span class="ident" id="5147933">j</span>&nbsp;<span class="op" id="5147935">&gt;</span>&nbsp;<span class="ident" id="5147937">i</span>&nbsp;<span class="op" id="5147939">&amp;&amp;</span>&nbsp;<span class="ident" id="5147942">isBlank</span><span class="op" id="5147949">(</span><span class="ident" id="5147950">lines</span><span class="op" id="5147955">[</span><span class="ident" id="5147956">j</span><span class="op" id="5147957">-</span><span class="num" id="5147958">1</span><span class="op" id="5147959">]</span><span class="op" id="5147960">)</span>&nbsp;<span class="op" id="5147962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147968">j</span><span class="op" id="5147969">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5147975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5147980">pre</span>&nbsp;<span class="op" id="5147984">:=</span>&nbsp;<span class="ident" id="5147987">lines</span><span class="op" id="5147992">[</span><span class="ident" id="5147993">i</span><span class="op" id="5147994">:</span><span class="ident" id="5147995">j</span><span class="op" id="5147996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148001">i</span>&nbsp;<span class="op" id="5148003">=</span>&nbsp;<span class="ident" id="5148005">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148011">unindent</span><span class="op" id="5148019">(</span><span class="ident" id="5148020">pre</span><span class="op" id="5148023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5148029">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148066">out</span>&nbsp;<span class="op" id="5148070">=</span>&nbsp;<span class="builtinfunc" id="5148072">append</span><span class="op" id="5148078">(</span><span class="ident" id="5148079">out</span><span class="op" id="5148082">,</span>&nbsp;<span class="ident" id="5148084">block</span><span class="op" id="5148089">{</span><span class="ident" id="5148090">opPre</span><span class="op" id="5148095">,</span>&nbsp;<span class="ident" id="5148097">pre</span><span class="op" id="5148100">}</span><span class="op" id="5148101">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148106">lastWasHeading</span>&nbsp;<span class="op" id="5148121">=</span>&nbsp;<span class="builtintype" id="5148123">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5148132">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5148143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5148148">if</span>&nbsp;<span class="ident" id="5148151">lastWasBlank</span>&nbsp;<span class="op" id="5148164">&amp;&amp;</span>&nbsp;<span class="op" id="5148167">!</span><span class="ident" id="5148168">lastWasHeading</span>&nbsp;<span class="op" id="5148183">&amp;&amp;</span>&nbsp;<span class="ident" id="5148186">i</span><span class="op" id="5148187">+</span><span class="num" id="5148188">2</span>&nbsp;<span class="op" id="5148190">&lt;</span>&nbsp;<span class="builtinfunc" id="5148192">len</span><span class="op" id="5148195">(</span><span class="ident" id="5148196">lines</span><span class="op" id="5148201">)</span>&nbsp;<span class="op" id="5148203">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148209">isBlank</span><span class="op" id="5148216">(</span><span class="ident" id="5148217">lines</span><span class="op" id="5148222">[</span><span class="ident" id="5148223">i</span><span class="op" id="5148224">+</span><span class="num" id="5148225">1</span><span class="op" id="5148226">]</span><span class="op" id="5148227">)</span>&nbsp;<span class="op" id="5148229">&amp;&amp;</span>&nbsp;<span class="op" id="5148232">!</span><span class="ident" id="5148233">isBlank</span><span class="op" id="5148240">(</span><span class="ident" id="5148241">lines</span><span class="op" id="5148246">[</span><span class="ident" id="5148247">i</span><span class="op" id="5148248">+</span><span class="num" id="5148249">2</span><span class="op" id="5148250">]</span><span class="op" id="5148251">)</span>&nbsp;<span class="op" id="5148253">&amp;&amp;</span>&nbsp;<span class="ident" id="5148256">indentLen</span><span class="op" id="5148265">(</span><span class="ident" id="5148266">lines</span><span class="op" id="5148271">[</span><span class="ident" id="5148272">i</span><span class="op" id="5148273">+</span><span class="num" id="5148274">2</span><span class="op" id="5148275">]</span><span class="op" id="5148276">)</span>&nbsp;<span class="op" id="5148278">==</span>&nbsp;<span class="num" id="5148281">0</span>&nbsp;<span class="op" id="5148283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5148288">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5148347">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5148403">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5148429">if</span>&nbsp;<span class="ident" id="5148432">head</span>&nbsp;<span class="op" id="5148437">:=</span>&nbsp;<span class="ident" id="5148440">heading</span><span class="op" id="5148447">(</span><span class="ident" id="5148448">line</span><span class="op" id="5148452">)</span><span class="op" id="5148453">;</span>&nbsp;<span class="ident" id="5148455">head</span>&nbsp;<span class="op" id="5148460">!=</span>&nbsp;<span class="string" id="5148463">&#34;&#34;</span>&nbsp;<span class="op" id="5148466">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5148472">close</span><span class="op" id="5148477">(</span><span class="op" id="5148478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148484">out</span>&nbsp;<span class="op" id="5148488">=</span>&nbsp;<span class="builtinfunc" id="5148490">append</span><span class="op" id="5148496">(</span><span class="ident" id="5148497">out</span><span class="op" id="5148500">,</span>&nbsp;<span class="ident" id="5148502">block</span><span class="op" id="5148507">{</span><span class="ident" id="5148508">opHead</span><span class="op" id="5148514">,</span>&nbsp;<span class="op" id="5148516">[</span><span class="op" id="5148517">]</span><span class="builtintype" id="5148518">string</span><span class="op" id="5148524">{</span><span class="ident" id="5148525">head</span><span class="op" id="5148529">}</span><span class="op" id="5148530">}</span><span class="op" id="5148531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148537">i</span>&nbsp;<span class="op" id="5148539">+=</span>&nbsp;<span class="num" id="5148542">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148548">lastWasHeading</span>&nbsp;<span class="op" id="5148563">=</span>&nbsp;<span class="builtintype" id="5148565">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5148574">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5148586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5148590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5148595">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148615">lastWasBlank</span>&nbsp;<span class="op" id="5148628">=</span>&nbsp;<span class="builtintype" id="5148630">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148638">lastWasHeading</span>&nbsp;<span class="op" id="5148653">=</span>&nbsp;<span class="builtintype" id="5148655">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148663">para</span>&nbsp;<span class="op" id="5148668">=</span>&nbsp;<span class="builtinfunc" id="5148670">append</span><span class="op" id="5148676">(</span><span class="ident" id="5148677">para</span><span class="op" id="5148681">,</span>&nbsp;<span class="ident" id="5148683">lines</span><span class="op" id="5148688">[</span><span class="ident" id="5148689">i</span><span class="op" id="5148690">]</span><span class="op" id="5148691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5148695">i</span><span class="op" id="5148696">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5148700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5148703">close</span><span class="op" id="5148708">(</span><span class="op" id="5148709">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5148713">return</span>&nbsp;<span class="ident" id="5148720">out</span><br>
<span class="lineno"></span><span class="op" id="5148724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5148727">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="5148795">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="5148864">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="5148938">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="5149013">func</span>&nbsp;<span class="ident" id="5149018">ToText</span><span class="op" id="5149024">(</span><span class="ident" id="5149025">w</span>&nbsp;<span class="ident" id="5149027">io</span><span class="op" id="5149029">.</span><span class="ident" id="5149030">Writer</span><span class="op" id="5149036">,</span>&nbsp;<span class="ident" id="5149038">text</span>&nbsp;<span class="builtintype" id="5149043">string</span><span class="op" id="5149049">,</span>&nbsp;<span class="ident" id="5149051">indent</span><span class="op" id="5149057">,</span>&nbsp;<span class="ident" id="5149059">preIndent</span>&nbsp;<span class="builtintype" id="5149069">string</span><span class="op" id="5149075">,</span>&nbsp;<span class="ident" id="5149077">width</span>&nbsp;<span class="builtintype" id="5149083">int</span><span class="op" id="5149086">)</span>&nbsp;<span class="op" id="5149088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149091">l</span>&nbsp;<span class="op" id="5149093">:=</span>&nbsp;<span class="ident" id="5149096">lineWrapper</span><span class="op" id="5149107">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149111">out</span><span class="op" id="5149114">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149119">w</span><span class="op" id="5149120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149124">width</span><span class="op" id="5149129">:</span>&nbsp;&nbsp;<span class="ident" id="5149132">width</span><span class="op" id="5149137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149141">indent</span><span class="op" id="5149147">:</span>&nbsp;<span class="ident" id="5149149">indent</span><span class="op" id="5149155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5149158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5149161">for</span>&nbsp;<span class="ident" id="5149165">_</span><span class="op" id="5149166">,</span>&nbsp;<span class="ident" id="5149168">b</span>&nbsp;<span class="op" id="5149170">:=</span>&nbsp;<span class="keyword" id="5149173">range</span>&nbsp;<span class="ident" id="5149179">blocks</span><span class="op" id="5149185">(</span><span class="ident" id="5149186">text</span><span class="op" id="5149190">)</span>&nbsp;<span class="op" id="5149192">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5149196">switch</span>&nbsp;<span class="ident" id="5149203">b</span><span class="op" id="5149204">.</span><span class="ident" id="5149205">op</span>&nbsp;<span class="op" id="5149208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5149212">case</span>&nbsp;<span class="ident" id="5149217">opPara</span><span class="op" id="5149223">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5149228">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5149279">for</span>&nbsp;<span class="ident" id="5149283">_</span><span class="op" id="5149284">,</span>&nbsp;<span class="ident" id="5149286">line</span>&nbsp;<span class="op" id="5149291">:=</span>&nbsp;<span class="keyword" id="5149294">range</span>&nbsp;<span class="ident" id="5149300">b</span><span class="op" id="5149301">.</span><span class="ident" id="5149302">lines</span>&nbsp;<span class="op" id="5149308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149314">l</span><span class="op" id="5149315">.</span><span class="ident" id="5149316">write</span><span class="op" id="5149321">(</span><span class="ident" id="5149322">line</span><span class="op" id="5149326">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5149331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149336">l</span><span class="op" id="5149337">.</span><span class="ident" id="5149338">flush</span><span class="op" id="5149343">(</span><span class="op" id="5149344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5149348">case</span>&nbsp;<span class="ident" id="5149353">opHead</span><span class="op" id="5149359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149364">w</span><span class="op" id="5149365">.</span><span class="ident" id="5149366">Write</span><span class="op" id="5149371">(</span><span class="ident" id="5149372">nl</span><span class="op" id="5149374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5149379">for</span>&nbsp;<span class="ident" id="5149383">_</span><span class="op" id="5149384">,</span>&nbsp;<span class="ident" id="5149386">line</span>&nbsp;<span class="op" id="5149391">:=</span>&nbsp;<span class="keyword" id="5149394">range</span>&nbsp;<span class="ident" id="5149400">b</span><span class="op" id="5149401">.</span><span class="ident" id="5149402">lines</span>&nbsp;<span class="op" id="5149408">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149414">l</span><span class="op" id="5149415">.</span><span class="ident" id="5149416">write</span><span class="op" id="5149421">(</span><span class="ident" id="5149422">line</span>&nbsp;<span class="op" id="5149427">+</span>&nbsp;<span class="string" id="5149429">&#34;\n&#34;</span><span class="op" id="5149433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5149438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149443">l</span><span class="op" id="5149444">.</span><span class="ident" id="5149445">flush</span><span class="op" id="5149450">(</span><span class="op" id="5149451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5149455">case</span>&nbsp;<span class="ident" id="5149460">opPre</span><span class="op" id="5149465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149470">w</span><span class="op" id="5149471">.</span><span class="ident" id="5149472">Write</span><span class="op" id="5149477">(</span><span class="ident" id="5149478">nl</span><span class="op" id="5149480">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5149485">for</span>&nbsp;<span class="ident" id="5149489">_</span><span class="op" id="5149490">,</span>&nbsp;<span class="ident" id="5149492">line</span>&nbsp;<span class="op" id="5149497">:=</span>&nbsp;<span class="keyword" id="5149500">range</span>&nbsp;<span class="ident" id="5149506">b</span><span class="op" id="5149507">.</span><span class="ident" id="5149508">lines</span>&nbsp;<span class="op" id="5149514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5149520">if</span>&nbsp;<span class="ident" id="5149523">isBlank</span><span class="op" id="5149530">(</span><span class="ident" id="5149531">line</span><span class="op" id="5149535">)</span>&nbsp;<span class="op" id="5149537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149544">w</span><span class="op" id="5149545">.</span><span class="ident" id="5149546">Write</span><span class="op" id="5149551">(</span><span class="op" id="5149552">[</span><span class="op" id="5149553">]</span><span class="builtintype" id="5149554">byte</span><span class="op" id="5149558">(</span><span class="string" id="5149559">&#34;\n&#34;</span><span class="op" id="5149563">)</span><span class="op" id="5149564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5149570">}</span>&nbsp;<span class="keyword" id="5149572">else</span>&nbsp;<span class="op" id="5149577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149584">w</span><span class="op" id="5149585">.</span><span class="ident" id="5149586">Write</span><span class="op" id="5149591">(</span><span class="op" id="5149592">[</span><span class="op" id="5149593">]</span><span class="builtintype" id="5149594">byte</span><span class="op" id="5149598">(</span><span class="ident" id="5149599">preIndent</span><span class="op" id="5149608">)</span><span class="op" id="5149609">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149616">w</span><span class="op" id="5149617">.</span><span class="ident" id="5149618">Write</span><span class="op" id="5149623">(</span><span class="op" id="5149624">[</span><span class="op" id="5149625">]</span><span class="builtintype" id="5149626">byte</span><span class="op" id="5149630">(</span><span class="ident" id="5149631">line</span><span class="op" id="5149635">)</span><span class="op" id="5149636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5149642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5149647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5149651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5149654">}</span><br>
<span class="lineno">435</span><span class="op" id="5149656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5149659">type</span>&nbsp;<span class="ident" id="5149664">lineWrapper</span>&nbsp;<span class="keyword" id="5149676">struct</span>&nbsp;<span class="op" id="5149683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149686">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5149696">io</span><span class="op" id="5149698">.</span><span class="ident" id="5149699">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149707">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5149717">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149723">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5149733">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149738">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5149748">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149756">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5149766">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149771">pendSpace</span>&nbsp;<span class="builtintype" id="5149781">int</span><br>
<span class="lineno"></span><span class="op" id="5149785">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="5149788">var</span>&nbsp;<span class="ident" id="5149792">nl</span>&nbsp;<span class="op" id="5149795">=</span>&nbsp;<span class="op" id="5149797">[</span><span class="op" id="5149798">]</span><span class="builtintype" id="5149799">byte</span><span class="op" id="5149803">(</span><span class="string" id="5149804">&#34;\n&#34;</span><span class="op" id="5149808">)</span><br>
<span class="lineno"></span><span class="keyword" id="5149810">var</span>&nbsp;<span class="ident" id="5149814">space</span>&nbsp;<span class="op" id="5149820">=</span>&nbsp;<span class="op" id="5149822">[</span><span class="op" id="5149823">]</span><span class="builtintype" id="5149824">byte</span><span class="op" id="5149828">(</span><span class="string" id="5149829">&#34;&nbsp;&#34;</span><span class="op" id="5149832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5149835">func</span>&nbsp;<span class="op" id="5149840">(</span><span class="ident" id="5149841">l</span>&nbsp;<span class="op" id="5149843">*</span><span class="ident" id="5149844">lineWrapper</span><span class="op" id="5149855">)</span>&nbsp;<span class="ident" id="5149857">write</span><span class="op" id="5149862">(</span><span class="ident" id="5149863">text</span>&nbsp;<span class="builtintype" id="5149868">string</span><span class="op" id="5149874">)</span>&nbsp;<span class="op" id="5149876">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5149879">if</span>&nbsp;<span class="ident" id="5149882">l</span><span class="op" id="5149883">.</span><span class="ident" id="5149884">n</span>&nbsp;<span class="op" id="5149886">==</span>&nbsp;<span class="num" id="5149889">0</span>&nbsp;<span class="op" id="5149891">&amp;&amp;</span>&nbsp;<span class="ident" id="5149894">l</span><span class="op" id="5149895">.</span><span class="ident" id="5149896">printed</span>&nbsp;<span class="op" id="5149904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149908">l</span><span class="op" id="5149909">.</span><span class="ident" id="5149910">out</span><span class="op" id="5149913">.</span><span class="ident" id="5149914">Write</span><span class="op" id="5149919">(</span><span class="ident" id="5149920">nl</span><span class="op" id="5149922">)</span>&nbsp;<span class="comment" id="5149924">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5149960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5149963">l</span><span class="op" id="5149964">.</span><span class="ident" id="5149965">printed</span>&nbsp;<span class="op" id="5149973">=</span>&nbsp;<span class="builtintype" id="5149975">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5149982">for</span>&nbsp;<span class="ident" id="5149986">_</span><span class="op" id="5149987">,</span>&nbsp;<span class="ident" id="5149989">f</span>&nbsp;<span class="op" id="5149991">:=</span>&nbsp;<span class="keyword" id="5149994">range</span>&nbsp;<span class="ident" id="5150000">strings</span><span class="op" id="5150007">.</span><span class="ident" id="5150008">Fields</span><span class="op" id="5150014">(</span><span class="ident" id="5150015">text</span><span class="op" id="5150019">)</span>&nbsp;<span class="op" id="5150021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150025">w</span>&nbsp;<span class="op" id="5150027">:=</span>&nbsp;<span class="ident" id="5150030">utf8</span><span class="op" id="5150034">.</span><span class="ident" id="5150035">RuneCountInString</span><span class="op" id="5150052">(</span><span class="ident" id="5150053">f</span><span class="op" id="5150054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5150058">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5150088">if</span>&nbsp;<span class="ident" id="5150091">l</span><span class="op" id="5150092">.</span><span class="ident" id="5150093">n</span>&nbsp;<span class="op" id="5150095">&gt;</span>&nbsp;<span class="num" id="5150097">0</span>&nbsp;<span class="op" id="5150099">&amp;&amp;</span>&nbsp;<span class="ident" id="5150102">l</span><span class="op" id="5150103">.</span><span class="ident" id="5150104">n</span><span class="op" id="5150105">+</span><span class="ident" id="5150106">l</span><span class="op" id="5150107">.</span><span class="ident" id="5150108">pendSpace</span><span class="op" id="5150117">+</span><span class="ident" id="5150118">w</span>&nbsp;<span class="op" id="5150120">&gt;</span>&nbsp;<span class="ident" id="5150122">l</span><span class="op" id="5150123">.</span><span class="ident" id="5150124">width</span>&nbsp;<span class="op" id="5150130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150135">l</span><span class="op" id="5150136">.</span><span class="ident" id="5150137">out</span><span class="op" id="5150140">.</span><span class="ident" id="5150141">Write</span><span class="op" id="5150146">(</span><span class="ident" id="5150147">nl</span><span class="op" id="5150149">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150154">l</span><span class="op" id="5150155">.</span><span class="ident" id="5150156">n</span>&nbsp;<span class="op" id="5150158">=</span>&nbsp;<span class="num" id="5150160">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150165">l</span><span class="op" id="5150166">.</span><span class="ident" id="5150167">pendSpace</span>&nbsp;<span class="op" id="5150177">=</span>&nbsp;<span class="num" id="5150179">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5150183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5150187">if</span>&nbsp;<span class="ident" id="5150190">l</span><span class="op" id="5150191">.</span><span class="ident" id="5150192">n</span>&nbsp;<span class="op" id="5150194">==</span>&nbsp;<span class="num" id="5150197">0</span>&nbsp;<span class="op" id="5150199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150204">l</span><span class="op" id="5150205">.</span><span class="ident" id="5150206">out</span><span class="op" id="5150209">.</span><span class="ident" id="5150210">Write</span><span class="op" id="5150215">(</span><span class="op" id="5150216">[</span><span class="op" id="5150217">]</span><span class="builtintype" id="5150218">byte</span><span class="op" id="5150222">(</span><span class="ident" id="5150223">l</span><span class="op" id="5150224">.</span><span class="ident" id="5150225">indent</span><span class="op" id="5150231">)</span><span class="op" id="5150232">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5150236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150240">l</span><span class="op" id="5150241">.</span><span class="ident" id="5150242">out</span><span class="op" id="5150245">.</span><span class="ident" id="5150246">Write</span><span class="op" id="5150251">(</span><span class="ident" id="5150252">space</span><span class="op" id="5150257">[</span><span class="op" id="5150258">:</span><span class="ident" id="5150259">l</span><span class="op" id="5150260">.</span><span class="ident" id="5150261">pendSpace</span><span class="op" id="5150270">]</span><span class="op" id="5150271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150275">l</span><span class="op" id="5150276">.</span><span class="ident" id="5150277">out</span><span class="op" id="5150280">.</span><span class="ident" id="5150281">Write</span><span class="op" id="5150286">(</span><span class="op" id="5150287">[</span><span class="op" id="5150288">]</span><span class="builtintype" id="5150289">byte</span><span class="op" id="5150293">(</span><span class="ident" id="5150294">f</span><span class="op" id="5150295">)</span><span class="op" id="5150296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150300">l</span><span class="op" id="5150301">.</span><span class="ident" id="5150302">n</span>&nbsp;<span class="op" id="5150304">+=</span>&nbsp;<span class="ident" id="5150307">l</span><span class="op" id="5150308">.</span><span class="ident" id="5150309">pendSpace</span>&nbsp;<span class="op" id="5150319">+</span>&nbsp;<span class="ident" id="5150321">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150325">l</span><span class="op" id="5150326">.</span><span class="ident" id="5150327">pendSpace</span>&nbsp;<span class="op" id="5150337">=</span>&nbsp;<span class="num" id="5150339">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5150342">}</span><br>
<span class="lineno"></span><span class="op" id="5150344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5150347">func</span>&nbsp;<span class="op" id="5150352">(</span><span class="ident" id="5150353">l</span>&nbsp;<span class="op" id="5150355">*</span><span class="ident" id="5150356">lineWrapper</span><span class="op" id="5150367">)</span>&nbsp;<span class="ident" id="5150369">flush</span><span class="op" id="5150374">(</span><span class="op" id="5150375">)</span>&nbsp;<span class="op" id="5150377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5150380">if</span>&nbsp;<span class="ident" id="5150383">l</span><span class="op" id="5150384">.</span><span class="ident" id="5150385">n</span>&nbsp;<span class="op" id="5150387">==</span>&nbsp;<span class="num" id="5150390">0</span>&nbsp;<span class="op" id="5150392">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5150396">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5150404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150407">l</span><span class="op" id="5150408">.</span><span class="ident" id="5150409">out</span><span class="op" id="5150412">.</span><span class="ident" id="5150413">Write</span><span class="op" id="5150418">(</span><span class="ident" id="5150419">nl</span><span class="op" id="5150421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150424">l</span><span class="op" id="5150425">.</span><span class="ident" id="5150426">pendSpace</span>&nbsp;<span class="op" id="5150436">=</span>&nbsp;<span class="num" id="5150438">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5150441">l</span><span class="op" id="5150442">.</span><span class="ident" id="5150443">n</span>&nbsp;<span class="op" id="5150445">=</span>&nbsp;<span class="num" id="5150447">0</span><br>
<span class="lineno">480</span><span class="op" id="5150449">}</span>
</div>
</body>
</html>
