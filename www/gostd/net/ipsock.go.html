<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3225749">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3225805">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3225859">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3225910">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3225947">package</span>&nbsp;<span class="ident" id="3225955">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3225960">import</span>&nbsp;<span class="op" id="3225967">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3225970">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3225980">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3225987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3225990">var</span>&nbsp;<span class="op" id="3225994">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225997">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3226057">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226087">supportsIPv4</span>&nbsp;<span class="builtintype" id="3226100">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3226107">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3226167">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226197">supportsIPv6</span>&nbsp;<span class="builtintype" id="3226210">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3226217">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3226275">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3226339">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226398">supportsIPv4map</span>&nbsp;<span class="builtintype" id="3226414">bool</span><br>
<span class="lineno"></span><span class="op" id="3226419">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3226422">func</span>&nbsp;<span class="ident" id="3226427">init</span><span class="op" id="3226431">(</span><span class="op" id="3226432">)</span>&nbsp;<span class="op" id="3226434">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226437">sysInit</span><span class="op" id="3226444">(</span><span class="op" id="3226445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226448">supportsIPv4</span>&nbsp;<span class="op" id="3226461">=</span>&nbsp;<span class="ident" id="3226463">probeIPv4Stack</span><span class="op" id="3226477">(</span><span class="op" id="3226478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226481">supportsIPv6</span><span class="op" id="3226493">,</span>&nbsp;<span class="ident" id="3226495">supportsIPv4map</span>&nbsp;<span class="op" id="3226511">=</span>&nbsp;<span class="ident" id="3226513">probeIPv6Stack</span><span class="op" id="3226527">(</span><span class="op" id="3226528">)</span><br>
<span class="lineno"></span><span class="op" id="3226530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3226533">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3226597">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3226628">type</span>&nbsp;<span class="ident" id="3226633">netaddr</span>&nbsp;<span class="keyword" id="3226641">interface</span>&nbsp;<span class="op" id="3226651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3226654">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3226716">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226772">toAddr</span><span class="op" id="3226778">(</span><span class="op" id="3226779">)</span>&nbsp;<span class="ident" id="3226781">Addr</span><br>
<span class="lineno"></span><span class="op" id="3226786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3226789">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3226853">type</span>&nbsp;<span class="ident" id="3226858">addrList</span>&nbsp;<span class="op" id="3226867">[</span><span class="op" id="3226868">]</span><span class="ident" id="3226869">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3226878">func</span>&nbsp;<span class="op" id="3226883">(</span><span class="ident" id="3226884">al</span>&nbsp;<span class="ident" id="3226887">addrList</span><span class="op" id="3226895">)</span>&nbsp;<span class="ident" id="3226897">toAddr</span><span class="op" id="3226903">(</span><span class="op" id="3226904">)</span>&nbsp;<span class="ident" id="3226906">Addr</span>&nbsp;<span class="op" id="3226911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226914">switch</span>&nbsp;<span class="builtinfunc" id="3226921">len</span><span class="op" id="3226924">(</span><span class="ident" id="3226925">al</span><span class="op" id="3226927">)</span>&nbsp;<span class="op" id="3226929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226932">case</span>&nbsp;<span class="num" id="3226937">0</span><span class="op" id="3226938">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226942">return</span>&nbsp;<span class="ident" id="3226949">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226954">case</span>&nbsp;<span class="num" id="3226959">1</span><span class="op" id="3226960">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226964">return</span>&nbsp;<span class="ident" id="3226971">al</span><span class="op" id="3226973">[</span><span class="num" id="3226974">0</span><span class="op" id="3226975">]</span><span class="op" id="3226976">.</span><span class="ident" id="3226977">toAddr</span><span class="op" id="3226983">(</span><span class="op" id="3226984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226987">default</span><span class="op" id="3226994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3226998">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3227049">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3227103">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3227157">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227175">return</span>&nbsp;<span class="ident" id="3227182">al</span><span class="op" id="3227184">[</span><span class="num" id="3227185">0</span><span class="op" id="3227186">]</span><span class="op" id="3227187">.</span><span class="ident" id="3227188">toAddr</span><span class="op" id="3227194">(</span><span class="op" id="3227195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227198">}</span><br>
<span class="lineno"></span><span class="op" id="3227200">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3227203">var</span>&nbsp;<span class="ident" id="3227207">errNoSuitableAddress</span>&nbsp;<span class="op" id="3227228">=</span>&nbsp;<span class="ident" id="3227230">errors</span><span class="op" id="3227236">.</span><span class="ident" id="3227237">New</span><span class="op" id="3227240">(</span><span class="string" id="3227241">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="3227268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3227271">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3227339">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="3227407">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="3227478">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3227530">func</span>&nbsp;<span class="ident" id="3227535">firstFavoriteAddr</span><span class="op" id="3227552">(</span><span class="ident" id="3227553">filter</span>&nbsp;<span class="keyword" id="3227560">func</span><span class="op" id="3227564">(</span><span class="ident" id="3227565">IP</span><span class="op" id="3227567">)</span>&nbsp;<span class="ident" id="3227569">IP</span><span class="op" id="3227571">,</span>&nbsp;<span class="ident" id="3227573">ips</span>&nbsp;<span class="op" id="3227577">[</span><span class="op" id="3227578">]</span><span class="ident" id="3227579">IP</span><span class="op" id="3227581">,</span>&nbsp;<span class="ident" id="3227583">inetaddr</span>&nbsp;<span class="keyword" id="3227592">func</span><span class="op" id="3227596">(</span><span class="ident" id="3227597">IP</span><span class="op" id="3227599">)</span>&nbsp;<span class="ident" id="3227601">netaddr</span><span class="op" id="3227608">)</span>&nbsp;<span class="op" id="3227610">(</span><span class="ident" id="3227611">netaddr</span><span class="op" id="3227618">,</span>&nbsp;<span class="builtintype" id="3227620">error</span><span class="op" id="3227625">)</span>&nbsp;<span class="op" id="3227627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227630">if</span>&nbsp;<span class="ident" id="3227633">filter</span>&nbsp;<span class="op" id="3227640">!=</span>&nbsp;<span class="ident" id="3227643">nil</span>&nbsp;<span class="op" id="3227647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227651">return</span>&nbsp;<span class="ident" id="3227658">firstSupportedAddr</span><span class="op" id="3227676">(</span><span class="ident" id="3227677">filter</span><span class="op" id="3227683">,</span>&nbsp;<span class="ident" id="3227685">ips</span><span class="op" id="3227688">,</span>&nbsp;<span class="ident" id="3227690">inetaddr</span><span class="op" id="3227698">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227704">var</span>&nbsp;<span class="op" id="3227708">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227712">ipv4</span><span class="op" id="3227716">,</span>&nbsp;<span class="ident" id="3227718">ipv6</span><span class="op" id="3227722">,</span>&nbsp;<span class="ident" id="3227724">swap</span>&nbsp;<span class="builtintype" id="3227729">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3227736">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3227753">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227763">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227766">for</span>&nbsp;<span class="ident" id="3227770">_</span><span class="op" id="3227771">,</span>&nbsp;<span class="ident" id="3227773">ip</span>&nbsp;<span class="op" id="3227776">:=</span>&nbsp;<span class="keyword" id="3227779">range</span>&nbsp;<span class="ident" id="3227785">ips</span>&nbsp;<span class="op" id="3227789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3227793">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3227847">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3227893">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3227944">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3228000">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3228055">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228107">if</span>&nbsp;<span class="ident" id="3228110">ip4</span>&nbsp;<span class="op" id="3228114">:=</span>&nbsp;<span class="ident" id="3228117">ipv4only</span><span class="op" id="3228125">(</span><span class="ident" id="3228126">ip</span><span class="op" id="3228128">)</span><span class="op" id="3228129">;</span>&nbsp;<span class="ident" id="3228131">ip4</span>&nbsp;<span class="op" id="3228135">!=</span>&nbsp;<span class="ident" id="3228138">nil</span>&nbsp;<span class="op" id="3228142">&amp;&amp;</span>&nbsp;<span class="op" id="3228145">!</span><span class="ident" id="3228146">ipv4</span>&nbsp;<span class="op" id="3228151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3228156">list</span>&nbsp;<span class="op" id="3228161">=</span>&nbsp;<span class="builtinfunc" id="3228163">append</span><span class="op" id="3228169">(</span><span class="ident" id="3228170">list</span><span class="op" id="3228174">,</span>&nbsp;<span class="ident" id="3228176">inetaddr</span><span class="op" id="3228184">(</span><span class="ident" id="3228185">ip4</span><span class="op" id="3228188">)</span><span class="op" id="3228189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3228194">ipv4</span>&nbsp;<span class="op" id="3228199">=</span>&nbsp;<span class="builtintype" id="3228201">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228209">if</span>&nbsp;<span class="ident" id="3228212">ipv6</span>&nbsp;<span class="op" id="3228217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3228223">swap</span>&nbsp;<span class="op" id="3228228">=</span>&nbsp;<span class="builtintype" id="3228230">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3228238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3228242">}</span>&nbsp;<span class="keyword" id="3228244">else</span>&nbsp;<span class="keyword" id="3228249">if</span>&nbsp;<span class="ident" id="3228252">ip6</span>&nbsp;<span class="op" id="3228256">:=</span>&nbsp;<span class="ident" id="3228259">ipv6only</span><span class="op" id="3228267">(</span><span class="ident" id="3228268">ip</span><span class="op" id="3228270">)</span><span class="op" id="3228271">;</span>&nbsp;<span class="ident" id="3228273">ip6</span>&nbsp;<span class="op" id="3228277">!=</span>&nbsp;<span class="ident" id="3228280">nil</span>&nbsp;<span class="op" id="3228284">&amp;&amp;</span>&nbsp;<span class="op" id="3228287">!</span><span class="ident" id="3228288">ipv6</span>&nbsp;<span class="op" id="3228293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3228298">list</span>&nbsp;<span class="op" id="3228303">=</span>&nbsp;<span class="builtinfunc" id="3228305">append</span><span class="op" id="3228311">(</span><span class="ident" id="3228312">list</span><span class="op" id="3228316">,</span>&nbsp;<span class="ident" id="3228318">inetaddr</span><span class="op" id="3228326">(</span><span class="ident" id="3228327">ip6</span><span class="op" id="3228330">)</span><span class="op" id="3228331">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3228336">ipv6</span>&nbsp;<span class="op" id="3228341">=</span>&nbsp;<span class="builtintype" id="3228343">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3228350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228354">if</span>&nbsp;<span class="ident" id="3228357">ipv4</span>&nbsp;<span class="op" id="3228362">&amp;&amp;</span>&nbsp;<span class="ident" id="3228365">ipv6</span>&nbsp;<span class="op" id="3228370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228375">if</span>&nbsp;<span class="ident" id="3228378">swap</span>&nbsp;<span class="op" id="3228383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3228389">list</span><span class="op" id="3228393">[</span><span class="num" id="3228394">0</span><span class="op" id="3228395">]</span><span class="op" id="3228396">,</span>&nbsp;<span class="ident" id="3228398">list</span><span class="op" id="3228402">[</span><span class="num" id="3228403">1</span><span class="op" id="3228404">]</span>&nbsp;<span class="op" id="3228406">=</span>&nbsp;<span class="ident" id="3228408">list</span><span class="op" id="3228412">[</span><span class="num" id="3228413">1</span><span class="op" id="3228414">]</span><span class="op" id="3228415">,</span>&nbsp;<span class="ident" id="3228417">list</span><span class="op" id="3228421">[</span><span class="num" id="3228422">0</span><span class="op" id="3228423">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3228428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228433">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3228441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3228444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228447">switch</span>&nbsp;<span class="builtinfunc" id="3228454">len</span><span class="op" id="3228457">(</span><span class="ident" id="3228458">list</span><span class="op" id="3228462">)</span>&nbsp;<span class="op" id="3228464">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228467">case</span>&nbsp;<span class="num" id="3228472">0</span><span class="op" id="3228473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228477">return</span>&nbsp;<span class="ident" id="3228484">nil</span><span class="op" id="3228487">,</span>&nbsp;<span class="ident" id="3228489">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228511">case</span>&nbsp;<span class="num" id="3228516">1</span><span class="op" id="3228517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228521">return</span>&nbsp;<span class="ident" id="3228528">list</span><span class="op" id="3228532">[</span><span class="num" id="3228533">0</span><span class="op" id="3228534">]</span><span class="op" id="3228535">,</span>&nbsp;<span class="ident" id="3228537">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228542">default</span><span class="op" id="3228549">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228553">return</span>&nbsp;<span class="ident" id="3228560">list</span><span class="op" id="3228564">,</span>&nbsp;<span class="ident" id="3228566">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3228571">}</span><br>
<span class="lineno"></span><span class="op" id="3228573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3228576">func</span>&nbsp;<span class="ident" id="3228581">firstSupportedAddr</span><span class="op" id="3228599">(</span><span class="ident" id="3228600">filter</span>&nbsp;<span class="keyword" id="3228607">func</span><span class="op" id="3228611">(</span><span class="ident" id="3228612">IP</span><span class="op" id="3228614">)</span>&nbsp;<span class="ident" id="3228616">IP</span><span class="op" id="3228618">,</span>&nbsp;<span class="ident" id="3228620">ips</span>&nbsp;<span class="op" id="3228624">[</span><span class="op" id="3228625">]</span><span class="ident" id="3228626">IP</span><span class="op" id="3228628">,</span>&nbsp;<span class="ident" id="3228630">inetaddr</span>&nbsp;<span class="keyword" id="3228639">func</span><span class="op" id="3228643">(</span><span class="ident" id="3228644">IP</span><span class="op" id="3228646">)</span>&nbsp;<span class="ident" id="3228648">netaddr</span><span class="op" id="3228655">)</span>&nbsp;<span class="op" id="3228657">(</span><span class="ident" id="3228658">netaddr</span><span class="op" id="3228665">,</span>&nbsp;<span class="builtintype" id="3228667">error</span><span class="op" id="3228672">)</span>&nbsp;<span class="op" id="3228674">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228677">for</span>&nbsp;<span class="ident" id="3228681">_</span><span class="op" id="3228682">,</span>&nbsp;<span class="ident" id="3228684">ip</span>&nbsp;<span class="op" id="3228687">:=</span>&nbsp;<span class="keyword" id="3228690">range</span>&nbsp;<span class="ident" id="3228696">ips</span>&nbsp;<span class="op" id="3228700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228704">if</span>&nbsp;<span class="ident" id="3228707">ip</span>&nbsp;<span class="op" id="3228710">:=</span>&nbsp;<span class="ident" id="3228713">filter</span><span class="op" id="3228719">(</span><span class="ident" id="3228720">ip</span><span class="op" id="3228722">)</span><span class="op" id="3228723">;</span>&nbsp;<span class="ident" id="3228725">ip</span>&nbsp;<span class="op" id="3228728">!=</span>&nbsp;<span class="ident" id="3228731">nil</span>&nbsp;<span class="op" id="3228735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228740">return</span>&nbsp;<span class="ident" id="3228747">inetaddr</span><span class="op" id="3228755">(</span><span class="ident" id="3228756">ip</span><span class="op" id="3228758">)</span><span class="op" id="3228759">,</span>&nbsp;<span class="ident" id="3228761">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3228767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3228770">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228773">return</span>&nbsp;<span class="ident" id="3228780">nil</span><span class="op" id="3228783">,</span>&nbsp;<span class="ident" id="3228785">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="3228806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3228809">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3228878">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="3228951">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3228980">func</span>&nbsp;<span class="ident" id="3228985">ipv4only</span><span class="op" id="3228993">(</span><span class="ident" id="3228994">ip</span>&nbsp;<span class="ident" id="3228997">IP</span><span class="op" id="3228999">)</span>&nbsp;<span class="ident" id="3229001">IP</span>&nbsp;<span class="op" id="3229004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229007">if</span>&nbsp;<span class="ident" id="3229010">supportsIPv4</span>&nbsp;<span class="op" id="3229023">&amp;&amp;</span>&nbsp;<span class="ident" id="3229026">ip</span><span class="op" id="3229028">.</span><span class="ident" id="3229029">To4</span><span class="op" id="3229032">(</span><span class="op" id="3229033">)</span>&nbsp;<span class="op" id="3229035">!=</span>&nbsp;<span class="ident" id="3229038">nil</span>&nbsp;<span class="op" id="3229042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229046">return</span>&nbsp;<span class="ident" id="3229053">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229057">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229060">return</span>&nbsp;<span class="ident" id="3229067">nil</span><br>
<span class="lineno"></span><span class="op" id="3229071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3229074">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3229143">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="3229211">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3229275">func</span>&nbsp;<span class="ident" id="3229280">ipv6only</span><span class="op" id="3229288">(</span><span class="ident" id="3229289">ip</span>&nbsp;<span class="ident" id="3229292">IP</span><span class="op" id="3229294">)</span>&nbsp;<span class="ident" id="3229296">IP</span>&nbsp;<span class="op" id="3229299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229302">if</span>&nbsp;<span class="ident" id="3229305">supportsIPv6</span>&nbsp;<span class="op" id="3229318">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3229321">len</span><span class="op" id="3229324">(</span><span class="ident" id="3229325">ip</span><span class="op" id="3229327">)</span>&nbsp;<span class="op" id="3229329">==</span>&nbsp;<span class="ident" id="3229332">IPv6len</span>&nbsp;<span class="op" id="3229340">&amp;&amp;</span>&nbsp;<span class="ident" id="3229343">ip</span><span class="op" id="3229345">.</span><span class="ident" id="3229346">To4</span><span class="op" id="3229349">(</span><span class="op" id="3229350">)</span>&nbsp;<span class="op" id="3229352">==</span>&nbsp;<span class="ident" id="3229355">nil</span>&nbsp;<span class="op" id="3229359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229363">return</span>&nbsp;<span class="ident" id="3229370">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229374">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229377">return</span>&nbsp;<span class="ident" id="3229384">nil</span><br>
<span class="lineno"></span><span class="op" id="3229388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3229391">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3229458">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="3229515">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="3229584">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3229642">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3229690">func</span>&nbsp;<span class="ident" id="3229695">SplitHostPort</span><span class="op" id="3229708">(</span><span class="ident" id="3229709">hostport</span>&nbsp;<span class="builtintype" id="3229718">string</span><span class="op" id="3229724">)</span>&nbsp;<span class="op" id="3229726">(</span><span class="ident" id="3229727">host</span><span class="op" id="3229731">,</span>&nbsp;<span class="ident" id="3229733">port</span>&nbsp;<span class="builtintype" id="3229738">string</span><span class="op" id="3229744">,</span>&nbsp;<span class="ident" id="3229746">err</span>&nbsp;<span class="builtintype" id="3229750">error</span><span class="op" id="3229755">)</span>&nbsp;<span class="op" id="3229757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229760">j</span><span class="op" id="3229761">,</span>&nbsp;<span class="ident" id="3229763">k</span>&nbsp;<span class="op" id="3229765">:=</span>&nbsp;<span class="num" id="3229768">0</span><span class="op" id="3229769">,</span>&nbsp;<span class="num" id="3229771">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3229775">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229817">i</span>&nbsp;<span class="op" id="3229819">:=</span>&nbsp;<span class="ident" id="3229822">last</span><span class="op" id="3229826">(</span><span class="ident" id="3229827">hostport</span><span class="op" id="3229835">,</span>&nbsp;<span class="string" id="3229837">&#39;:&#39;</span><span class="op" id="3229840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229843">if</span>&nbsp;<span class="ident" id="3229846">i</span>&nbsp;<span class="op" id="3229848">&lt;</span>&nbsp;<span class="num" id="3229850">0</span>&nbsp;<span class="op" id="3229852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229856">goto</span>&nbsp;<span class="ident" id="3229861">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229878">if</span>&nbsp;<span class="ident" id="3229881">hostport</span><span class="op" id="3229889">[</span><span class="num" id="3229890">0</span><span class="op" id="3229891">]</span>&nbsp;<span class="op" id="3229893">==</span>&nbsp;<span class="string" id="3229896">&#39;[&#39;</span>&nbsp;<span class="op" id="3229900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3229904">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229956">end</span>&nbsp;<span class="op" id="3229960">:=</span>&nbsp;<span class="ident" id="3229963">byteIndex</span><span class="op" id="3229972">(</span><span class="ident" id="3229973">hostport</span><span class="op" id="3229981">,</span>&nbsp;<span class="string" id="3229983">&#39;]&#39;</span><span class="op" id="3229986">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229990">if</span>&nbsp;<span class="ident" id="3229993">end</span>&nbsp;<span class="op" id="3229997">&lt;</span>&nbsp;<span class="num" id="3229999">0</span>&nbsp;<span class="op" id="3230001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230006">err</span>&nbsp;<span class="op" id="3230010">=</span>&nbsp;<span class="op" id="3230012">&amp;</span><span class="ident" id="3230013">AddrError</span><span class="op" id="3230022">{</span><span class="string" id="3230023">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3230047">,</span>&nbsp;<span class="ident" id="3230049">hostport</span><span class="op" id="3230057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230062">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230075">switch</span>&nbsp;<span class="ident" id="3230082">end</span>&nbsp;<span class="op" id="3230086">+</span>&nbsp;<span class="num" id="3230088">1</span>&nbsp;<span class="op" id="3230090">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230094">case</span>&nbsp;<span class="builtinfunc" id="3230099">len</span><span class="op" id="3230102">(</span><span class="ident" id="3230103">hostport</span><span class="op" id="3230111">)</span><span class="op" id="3230112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3230117">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230164">goto</span>&nbsp;<span class="ident" id="3230169">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230183">case</span>&nbsp;<span class="ident" id="3230188">i</span><span class="op" id="3230189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3230194">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230220">default</span><span class="op" id="3230227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3230232">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3230285">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230337">if</span>&nbsp;<span class="ident" id="3230340">hostport</span><span class="op" id="3230348">[</span><span class="ident" id="3230349">end</span><span class="op" id="3230352">+</span><span class="num" id="3230353">1</span><span class="op" id="3230354">]</span>&nbsp;<span class="op" id="3230356">==</span>&nbsp;<span class="string" id="3230359">&#39;:&#39;</span>&nbsp;<span class="op" id="3230363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230369">goto</span>&nbsp;<span class="ident" id="3230374">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230396">goto</span>&nbsp;<span class="ident" id="3230401">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230419">host</span>&nbsp;<span class="op" id="3230424">=</span>&nbsp;<span class="ident" id="3230426">hostport</span><span class="op" id="3230434">[</span><span class="num" id="3230435">1</span><span class="op" id="3230436">:</span><span class="ident" id="3230437">end</span><span class="op" id="3230440">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230444">j</span><span class="op" id="3230445">,</span>&nbsp;<span class="ident" id="3230447">k</span>&nbsp;<span class="op" id="3230449">=</span>&nbsp;<span class="num" id="3230451">1</span><span class="op" id="3230452">,</span>&nbsp;<span class="ident" id="3230454">end</span><span class="op" id="3230457">+</span><span class="num" id="3230458">1</span>&nbsp;<span class="comment" id="3230460">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230518">}</span>&nbsp;<span class="keyword" id="3230520">else</span>&nbsp;<span class="op" id="3230525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230529">host</span>&nbsp;<span class="op" id="3230534">=</span>&nbsp;<span class="ident" id="3230536">hostport</span><span class="op" id="3230544">[</span><span class="op" id="3230545">:</span><span class="ident" id="3230546">i</span><span class="op" id="3230547">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230551">if</span>&nbsp;<span class="ident" id="3230554">byteIndex</span><span class="op" id="3230563">(</span><span class="ident" id="3230564">host</span><span class="op" id="3230568">,</span>&nbsp;<span class="string" id="3230570">&#39;:&#39;</span><span class="op" id="3230573">)</span>&nbsp;<span class="op" id="3230575">&gt;=</span>&nbsp;<span class="num" id="3230578">0</span>&nbsp;<span class="op" id="3230580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230585">goto</span>&nbsp;<span class="ident" id="3230590">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230606">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230610">if</span>&nbsp;<span class="ident" id="3230613">byteIndex</span><span class="op" id="3230622">(</span><span class="ident" id="3230623">host</span><span class="op" id="3230627">,</span>&nbsp;<span class="string" id="3230629">&#39;%&#39;</span><span class="op" id="3230632">)</span>&nbsp;<span class="op" id="3230634">&gt;=</span>&nbsp;<span class="num" id="3230637">0</span>&nbsp;<span class="op" id="3230639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230644">goto</span>&nbsp;<span class="ident" id="3230649">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230673">if</span>&nbsp;<span class="ident" id="3230676">byteIndex</span><span class="op" id="3230685">(</span><span class="ident" id="3230686">hostport</span><span class="op" id="3230694">[</span><span class="ident" id="3230695">j</span><span class="op" id="3230696">:</span><span class="op" id="3230697">]</span><span class="op" id="3230698">,</span>&nbsp;<span class="string" id="3230700">&#39;[&#39;</span><span class="op" id="3230703">)</span>&nbsp;<span class="op" id="3230705">&gt;=</span>&nbsp;<span class="num" id="3230708">0</span>&nbsp;<span class="op" id="3230710">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230714">err</span>&nbsp;<span class="op" id="3230718">=</span>&nbsp;<span class="op" id="3230720">&amp;</span><span class="ident" id="3230721">AddrError</span><span class="op" id="3230730">{</span><span class="string" id="3230731">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3230758">,</span>&nbsp;<span class="ident" id="3230760">hostport</span><span class="op" id="3230768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230772">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230783">if</span>&nbsp;<span class="ident" id="3230786">byteIndex</span><span class="op" id="3230795">(</span><span class="ident" id="3230796">hostport</span><span class="op" id="3230804">[</span><span class="ident" id="3230805">k</span><span class="op" id="3230806">:</span><span class="op" id="3230807">]</span><span class="op" id="3230808">,</span>&nbsp;<span class="string" id="3230810">&#39;]&#39;</span><span class="op" id="3230813">)</span>&nbsp;<span class="op" id="3230815">&gt;=</span>&nbsp;<span class="num" id="3230818">0</span>&nbsp;<span class="op" id="3230820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230824">err</span>&nbsp;<span class="op" id="3230828">=</span>&nbsp;<span class="op" id="3230830">&amp;</span><span class="ident" id="3230831">AddrError</span><span class="op" id="3230840">{</span><span class="string" id="3230841">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3230868">,</span>&nbsp;<span class="ident" id="3230870">hostport</span><span class="op" id="3230878">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230882">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230894">port</span>&nbsp;<span class="op" id="3230899">=</span>&nbsp;<span class="ident" id="3230901">hostport</span><span class="op" id="3230909">[</span><span class="ident" id="3230910">i</span><span class="op" id="3230911">+</span><span class="num" id="3230912">1</span><span class="op" id="3230913">:</span><span class="op" id="3230914">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230917">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="3230925">missingPort</span><span class="op" id="3230936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230939">err</span>&nbsp;<span class="op" id="3230943">=</span>&nbsp;<span class="op" id="3230945">&amp;</span><span class="ident" id="3230946">AddrError</span><span class="op" id="3230955">{</span><span class="string" id="3230956">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="3230981">,</span>&nbsp;<span class="ident" id="3230983">hostport</span><span class="op" id="3230991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230994">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="3231002">tooManyColons</span><span class="op" id="3231015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231018">err</span>&nbsp;<span class="op" id="3231022">=</span>&nbsp;<span class="op" id="3231024">&amp;</span><span class="ident" id="3231025">AddrError</span><span class="op" id="3231034">{</span><span class="string" id="3231035">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="3231063">,</span>&nbsp;<span class="ident" id="3231065">hostport</span><span class="op" id="3231073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231076">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3231084">missingBrackets</span><span class="op" id="3231099">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231102">err</span>&nbsp;<span class="op" id="3231106">=</span>&nbsp;<span class="op" id="3231108">&amp;</span><span class="ident" id="3231109">AddrError</span><span class="op" id="3231118">{</span><span class="string" id="3231119">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="3231148">,</span>&nbsp;<span class="ident" id="3231150">hostport</span><span class="op" id="3231158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231161">return</span><br>
<span class="lineno"></span><span class="op" id="3231168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3231171">func</span>&nbsp;<span class="ident" id="3231176">splitHostZone</span><span class="op" id="3231189">(</span><span class="ident" id="3231190">s</span>&nbsp;<span class="builtintype" id="3231192">string</span><span class="op" id="3231198">)</span>&nbsp;<span class="op" id="3231200">(</span><span class="ident" id="3231201">host</span><span class="op" id="3231205">,</span>&nbsp;<span class="ident" id="3231207">zone</span>&nbsp;<span class="builtintype" id="3231212">string</span><span class="op" id="3231218">)</span>&nbsp;<span class="op" id="3231220">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3231223">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3231287">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231310">if</span>&nbsp;<span class="ident" id="3231313">i</span>&nbsp;<span class="op" id="3231315">:=</span>&nbsp;<span class="ident" id="3231318">last</span><span class="op" id="3231322">(</span><span class="ident" id="3231323">s</span><span class="op" id="3231324">,</span>&nbsp;<span class="string" id="3231326">&#39;%&#39;</span><span class="op" id="3231329">)</span><span class="op" id="3231330">;</span>&nbsp;<span class="ident" id="3231332">i</span>&nbsp;<span class="op" id="3231334">&gt;</span>&nbsp;<span class="num" id="3231336">0</span>&nbsp;<span class="op" id="3231338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231342">host</span><span class="op" id="3231346">,</span>&nbsp;<span class="ident" id="3231348">zone</span>&nbsp;<span class="op" id="3231353">=</span>&nbsp;<span class="ident" id="3231355">s</span><span class="op" id="3231356">[</span><span class="op" id="3231357">:</span><span class="ident" id="3231358">i</span><span class="op" id="3231359">]</span><span class="op" id="3231360">,</span>&nbsp;<span class="ident" id="3231362">s</span><span class="op" id="3231363">[</span><span class="ident" id="3231364">i</span><span class="op" id="3231365">+</span><span class="num" id="3231366">1</span><span class="op" id="3231367">:</span><span class="op" id="3231368">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3231371">}</span>&nbsp;<span class="keyword" id="3231373">else</span>&nbsp;<span class="op" id="3231378">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231382">host</span>&nbsp;<span class="op" id="3231387">=</span>&nbsp;<span class="ident" id="3231389">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3231392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231395">return</span><br>
<span class="lineno"></span><span class="op" id="3231402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3231405">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3231474">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="3231542">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3231560">func</span>&nbsp;<span class="ident" id="3231565">JoinHostPort</span><span class="op" id="3231577">(</span><span class="ident" id="3231578">host</span><span class="op" id="3231582">,</span>&nbsp;<span class="ident" id="3231584">port</span>&nbsp;<span class="builtintype" id="3231589">string</span><span class="op" id="3231595">)</span>&nbsp;<span class="builtintype" id="3231597">string</span>&nbsp;<span class="op" id="3231604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3231607">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231669">if</span>&nbsp;<span class="ident" id="3231672">byteIndex</span><span class="op" id="3231681">(</span><span class="ident" id="3231682">host</span><span class="op" id="3231686">,</span>&nbsp;<span class="string" id="3231688">&#39;:&#39;</span><span class="op" id="3231691">)</span>&nbsp;<span class="op" id="3231693">&gt;=</span>&nbsp;<span class="num" id="3231696">0</span>&nbsp;<span class="op" id="3231698">||</span>&nbsp;<span class="ident" id="3231701">byteIndex</span><span class="op" id="3231710">(</span><span class="ident" id="3231711">host</span><span class="op" id="3231715">,</span>&nbsp;<span class="string" id="3231717">&#39;%&#39;</span><span class="op" id="3231720">)</span>&nbsp;<span class="op" id="3231722">&gt;=</span>&nbsp;<span class="num" id="3231725">0</span>&nbsp;<span class="op" id="3231727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231731">return</span>&nbsp;<span class="string" id="3231738">&#34;[&#34;</span>&nbsp;<span class="op" id="3231742">+</span>&nbsp;<span class="ident" id="3231744">host</span>&nbsp;<span class="op" id="3231749">+</span>&nbsp;<span class="string" id="3231751">&#34;]:&#34;</span>&nbsp;<span class="op" id="3231756">+</span>&nbsp;<span class="ident" id="3231758">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3231764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231767">return</span>&nbsp;<span class="ident" id="3231774">host</span>&nbsp;<span class="op" id="3231779">+</span>&nbsp;<span class="string" id="3231781">&#34;:&#34;</span>&nbsp;<span class="op" id="3231785">+</span>&nbsp;<span class="ident" id="3231787">port</span><br>
<span class="lineno"></span><span class="op" id="3231792">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3231795">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3231860">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="3231925">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3231989">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="3232058">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="3232127">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3232157">func</span>&nbsp;<span class="ident" id="3232162">resolveInternetAddr</span><span class="op" id="3232181">(</span><span class="ident" id="3232182">net</span><span class="op" id="3232185">,</span>&nbsp;<span class="ident" id="3232187">addr</span>&nbsp;<span class="builtintype" id="3232192">string</span><span class="op" id="3232198">,</span>&nbsp;<span class="ident" id="3232200">deadline</span>&nbsp;<span class="ident" id="3232209">time</span><span class="op" id="3232213">.</span><span class="ident" id="3232214">Time</span><span class="op" id="3232218">)</span>&nbsp;<span class="op" id="3232220">(</span><span class="ident" id="3232221">netaddr</span><span class="op" id="3232228">,</span>&nbsp;<span class="builtintype" id="3232230">error</span><span class="op" id="3232235">)</span>&nbsp;<span class="op" id="3232237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232240">var</span>&nbsp;<span class="op" id="3232244">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3232248">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3232265">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3232273">host</span><span class="op" id="3232277">,</span>&nbsp;<span class="ident" id="3232279">port</span><span class="op" id="3232283">,</span>&nbsp;<span class="ident" id="3232285">zone</span>&nbsp;<span class="builtintype" id="3232290">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3232299">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3232316">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3232321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232324">switch</span>&nbsp;<span class="ident" id="3232331">net</span>&nbsp;<span class="op" id="3232335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232338">case</span>&nbsp;<span class="string" id="3232343">&#34;tcp&#34;</span><span class="op" id="3232348">,</span>&nbsp;<span class="string" id="3232350">&#34;tcp4&#34;</span><span class="op" id="3232356">,</span>&nbsp;<span class="string" id="3232358">&#34;tcp6&#34;</span><span class="op" id="3232364">,</span>&nbsp;<span class="string" id="3232366">&#34;udp&#34;</span><span class="op" id="3232371">,</span>&nbsp;<span class="string" id="3232373">&#34;udp4&#34;</span><span class="op" id="3232379">,</span>&nbsp;<span class="string" id="3232381">&#34;udp6&#34;</span><span class="op" id="3232387">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232391">if</span>&nbsp;<span class="ident" id="3232394">addr</span>&nbsp;<span class="op" id="3232399">!=</span>&nbsp;<span class="string" id="3232402">&#34;&#34;</span>&nbsp;<span class="op" id="3232405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232410">if</span>&nbsp;<span class="ident" id="3232413">host</span><span class="op" id="3232417">,</span>&nbsp;<span class="ident" id="3232419">port</span><span class="op" id="3232423">,</span>&nbsp;<span class="ident" id="3232425">err</span>&nbsp;<span class="op" id="3232429">=</span>&nbsp;<span class="ident" id="3232431">SplitHostPort</span><span class="op" id="3232444">(</span><span class="ident" id="3232445">addr</span><span class="op" id="3232449">)</span><span class="op" id="3232450">;</span>&nbsp;<span class="ident" id="3232452">err</span>&nbsp;<span class="op" id="3232456">!=</span>&nbsp;<span class="ident" id="3232459">nil</span>&nbsp;<span class="op" id="3232463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232469">return</span>&nbsp;<span class="ident" id="3232476">nil</span><span class="op" id="3232479">,</span>&nbsp;<span class="ident" id="3232481">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3232488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232493">if</span>&nbsp;<span class="ident" id="3232496">portnum</span><span class="op" id="3232503">,</span>&nbsp;<span class="ident" id="3232505">err</span>&nbsp;<span class="op" id="3232509">=</span>&nbsp;<span class="ident" id="3232511">parsePort</span><span class="op" id="3232520">(</span><span class="ident" id="3232521">net</span><span class="op" id="3232524">,</span>&nbsp;<span class="ident" id="3232526">port</span><span class="op" id="3232530">)</span><span class="op" id="3232531">;</span>&nbsp;<span class="ident" id="3232533">err</span>&nbsp;<span class="op" id="3232537">!=</span>&nbsp;<span class="ident" id="3232540">nil</span>&nbsp;<span class="op" id="3232544">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232550">return</span>&nbsp;<span class="ident" id="3232557">nil</span><span class="op" id="3232560">,</span>&nbsp;<span class="ident" id="3232562">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3232569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3232573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232576">case</span>&nbsp;<span class="string" id="3232581">&#34;ip&#34;</span><span class="op" id="3232585">,</span>&nbsp;<span class="string" id="3232587">&#34;ip4&#34;</span><span class="op" id="3232592">,</span>&nbsp;<span class="string" id="3232594">&#34;ip6&#34;</span><span class="op" id="3232599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232603">if</span>&nbsp;<span class="ident" id="3232606">addr</span>&nbsp;<span class="op" id="3232611">!=</span>&nbsp;<span class="string" id="3232614">&#34;&#34;</span>&nbsp;<span class="op" id="3232617">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3232622">host</span>&nbsp;<span class="op" id="3232627">=</span>&nbsp;<span class="ident" id="3232629">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3232636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232639">default</span><span class="op" id="3232646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232650">return</span>&nbsp;<span class="ident" id="3232657">nil</span><span class="op" id="3232660">,</span>&nbsp;<span class="ident" id="3232662">UnknownNetworkError</span><span class="op" id="3232681">(</span><span class="ident" id="3232682">net</span><span class="op" id="3232685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3232688">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3232691">inetaddr</span>&nbsp;<span class="op" id="3232700">:=</span>&nbsp;<span class="keyword" id="3232703">func</span><span class="op" id="3232707">(</span><span class="ident" id="3232708">ip</span>&nbsp;<span class="ident" id="3232711">IP</span><span class="op" id="3232713">)</span>&nbsp;<span class="ident" id="3232715">netaddr</span>&nbsp;<span class="op" id="3232723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232727">switch</span>&nbsp;<span class="ident" id="3232734">net</span>&nbsp;<span class="op" id="3232738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232742">case</span>&nbsp;<span class="string" id="3232747">&#34;tcp&#34;</span><span class="op" id="3232752">,</span>&nbsp;<span class="string" id="3232754">&#34;tcp4&#34;</span><span class="op" id="3232760">,</span>&nbsp;<span class="string" id="3232762">&#34;tcp6&#34;</span><span class="op" id="3232768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232773">return</span>&nbsp;<span class="op" id="3232780">&amp;</span><span class="ident" id="3232781">TCPAddr</span><span class="op" id="3232788">{</span><span class="ident" id="3232789">IP</span><span class="op" id="3232791">:</span>&nbsp;<span class="ident" id="3232793">ip</span><span class="op" id="3232795">,</span>&nbsp;<span class="ident" id="3232797">Port</span><span class="op" id="3232801">:</span>&nbsp;<span class="ident" id="3232803">portnum</span><span class="op" id="3232810">,</span>&nbsp;<span class="ident" id="3232812">Zone</span><span class="op" id="3232816">:</span>&nbsp;<span class="ident" id="3232818">zone</span><span class="op" id="3232822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232826">case</span>&nbsp;<span class="string" id="3232831">&#34;udp&#34;</span><span class="op" id="3232836">,</span>&nbsp;<span class="string" id="3232838">&#34;udp4&#34;</span><span class="op" id="3232844">,</span>&nbsp;<span class="string" id="3232846">&#34;udp6&#34;</span><span class="op" id="3232852">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232857">return</span>&nbsp;<span class="op" id="3232864">&amp;</span><span class="ident" id="3232865">UDPAddr</span><span class="op" id="3232872">{</span><span class="ident" id="3232873">IP</span><span class="op" id="3232875">:</span>&nbsp;<span class="ident" id="3232877">ip</span><span class="op" id="3232879">,</span>&nbsp;<span class="ident" id="3232881">Port</span><span class="op" id="3232885">:</span>&nbsp;<span class="ident" id="3232887">portnum</span><span class="op" id="3232894">,</span>&nbsp;<span class="ident" id="3232896">Zone</span><span class="op" id="3232900">:</span>&nbsp;<span class="ident" id="3232902">zone</span><span class="op" id="3232906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232910">case</span>&nbsp;<span class="string" id="3232915">&#34;ip&#34;</span><span class="op" id="3232919">,</span>&nbsp;<span class="string" id="3232921">&#34;ip4&#34;</span><span class="op" id="3232926">,</span>&nbsp;<span class="string" id="3232928">&#34;ip6&#34;</span><span class="op" id="3232933">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232938">return</span>&nbsp;<span class="op" id="3232945">&amp;</span><span class="ident" id="3232946">IPAddr</span><span class="op" id="3232952">{</span><span class="ident" id="3232953">IP</span><span class="op" id="3232955">:</span>&nbsp;<span class="ident" id="3232957">ip</span><span class="op" id="3232959">,</span>&nbsp;<span class="ident" id="3232961">Zone</span><span class="op" id="3232965">:</span>&nbsp;<span class="ident" id="3232967">zone</span><span class="op" id="3232971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232975">default</span><span class="op" id="3232982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3232987">panic</span><span class="op" id="3232992">(</span><span class="string" id="3232993">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="3233016">+</span>&nbsp;<span class="ident" id="3233018">net</span><span class="op" id="3233021">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233031">if</span>&nbsp;<span class="ident" id="3233034">host</span>&nbsp;<span class="op" id="3233039">==</span>&nbsp;<span class="string" id="3233042">&#34;&#34;</span>&nbsp;<span class="op" id="3233045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233049">return</span>&nbsp;<span class="ident" id="3233056">inetaddr</span><span class="op" id="3233064">(</span><span class="ident" id="3233065">nil</span><span class="op" id="3233068">)</span><span class="op" id="3233069">,</span>&nbsp;<span class="ident" id="3233071">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233076">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3233079">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233112">var</span>&nbsp;<span class="ident" id="3233116">ip</span>&nbsp;<span class="ident" id="3233119">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233123">if</span>&nbsp;<span class="ident" id="3233126">ip</span>&nbsp;<span class="op" id="3233129">=</span>&nbsp;<span class="ident" id="3233131">parseIPv4</span><span class="op" id="3233140">(</span><span class="ident" id="3233141">host</span><span class="op" id="3233145">)</span><span class="op" id="3233146">;</span>&nbsp;<span class="ident" id="3233148">ip</span>&nbsp;<span class="op" id="3233151">!=</span>&nbsp;<span class="ident" id="3233154">nil</span>&nbsp;<span class="op" id="3233158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233162">return</span>&nbsp;<span class="ident" id="3233169">inetaddr</span><span class="op" id="3233177">(</span><span class="ident" id="3233178">ip</span><span class="op" id="3233180">)</span><span class="op" id="3233181">,</span>&nbsp;<span class="ident" id="3233183">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233188">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233191">if</span>&nbsp;<span class="ident" id="3233194">ip</span><span class="op" id="3233196">,</span>&nbsp;<span class="ident" id="3233198">zone</span>&nbsp;<span class="op" id="3233203">=</span>&nbsp;<span class="ident" id="3233205">parseIPv6</span><span class="op" id="3233214">(</span><span class="ident" id="3233215">host</span><span class="op" id="3233219">,</span>&nbsp;<span class="builtintype" id="3233221">true</span><span class="op" id="3233225">)</span><span class="op" id="3233226">;</span>&nbsp;<span class="ident" id="3233228">ip</span>&nbsp;<span class="op" id="3233231">!=</span>&nbsp;<span class="ident" id="3233234">nil</span>&nbsp;<span class="op" id="3233238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233242">return</span>&nbsp;<span class="ident" id="3233249">inetaddr</span><span class="op" id="3233257">(</span><span class="ident" id="3233258">ip</span><span class="op" id="3233260">)</span><span class="op" id="3233261">,</span>&nbsp;<span class="ident" id="3233263">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3233271">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233294">host</span><span class="op" id="3233298">,</span>&nbsp;<span class="ident" id="3233300">zone</span>&nbsp;<span class="op" id="3233305">=</span>&nbsp;<span class="ident" id="3233307">splitHostZone</span><span class="op" id="3233320">(</span><span class="ident" id="3233321">host</span><span class="op" id="3233325">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233328">ips</span><span class="op" id="3233331">,</span>&nbsp;<span class="ident" id="3233333">err</span>&nbsp;<span class="op" id="3233337">:=</span>&nbsp;<span class="ident" id="3233340">lookupIPDeadline</span><span class="op" id="3233356">(</span><span class="ident" id="3233357">host</span><span class="op" id="3233361">,</span>&nbsp;<span class="ident" id="3233363">deadline</span><span class="op" id="3233371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233374">if</span>&nbsp;<span class="ident" id="3233377">err</span>&nbsp;<span class="op" id="3233381">!=</span>&nbsp;<span class="ident" id="3233384">nil</span>&nbsp;<span class="op" id="3233388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233392">return</span>&nbsp;<span class="ident" id="3233399">nil</span><span class="op" id="3233402">,</span>&nbsp;<span class="ident" id="3233404">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233412">var</span>&nbsp;<span class="ident" id="3233416">filter</span>&nbsp;<span class="keyword" id="3233423">func</span><span class="op" id="3233427">(</span><span class="ident" id="3233428">IP</span><span class="op" id="3233430">)</span>&nbsp;<span class="ident" id="3233432">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233436">if</span>&nbsp;<span class="ident" id="3233439">net</span>&nbsp;<span class="op" id="3233443">!=</span>&nbsp;<span class="string" id="3233446">&#34;&#34;</span>&nbsp;<span class="op" id="3233449">&amp;&amp;</span>&nbsp;<span class="ident" id="3233452">net</span><span class="op" id="3233455">[</span><span class="builtinfunc" id="3233456">len</span><span class="op" id="3233459">(</span><span class="ident" id="3233460">net</span><span class="op" id="3233463">)</span><span class="op" id="3233464">-</span><span class="num" id="3233465">1</span><span class="op" id="3233466">]</span>&nbsp;<span class="op" id="3233468">==</span>&nbsp;<span class="string" id="3233471">&#39;4&#39;</span>&nbsp;<span class="op" id="3233475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233479">filter</span>&nbsp;<span class="op" id="3233486">=</span>&nbsp;<span class="ident" id="3233488">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233501">if</span>&nbsp;<span class="ident" id="3233504">net</span>&nbsp;<span class="op" id="3233508">!=</span>&nbsp;<span class="string" id="3233511">&#34;&#34;</span>&nbsp;<span class="op" id="3233514">&amp;&amp;</span>&nbsp;<span class="ident" id="3233517">net</span><span class="op" id="3233520">[</span><span class="builtinfunc" id="3233521">len</span><span class="op" id="3233524">(</span><span class="ident" id="3233525">net</span><span class="op" id="3233528">)</span><span class="op" id="3233529">-</span><span class="num" id="3233530">1</span><span class="op" id="3233531">]</span>&nbsp;<span class="op" id="3233533">==</span>&nbsp;<span class="string" id="3233536">&#39;6&#39;</span>&nbsp;<span class="op" id="3233540">||</span>&nbsp;<span class="ident" id="3233543">zone</span>&nbsp;<span class="op" id="3233548">!=</span>&nbsp;<span class="string" id="3233551">&#34;&#34;</span>&nbsp;<span class="op" id="3233554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233558">filter</span>&nbsp;<span class="op" id="3233565">=</span>&nbsp;<span class="ident" id="3233567">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233580">return</span>&nbsp;<span class="ident" id="3233587">firstFavoriteAddr</span><span class="op" id="3233604">(</span><span class="ident" id="3233605">filter</span><span class="op" id="3233611">,</span>&nbsp;<span class="ident" id="3233613">ips</span><span class="op" id="3233616">,</span>&nbsp;<span class="ident" id="3233618">inetaddr</span><span class="op" id="3233626">)</span><br>
<span class="lineno"></span><span class="op" id="3233628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3233631">func</span>&nbsp;<span class="ident" id="3233636">zoneToString</span><span class="op" id="3233648">(</span><span class="ident" id="3233649">zone</span>&nbsp;<span class="builtintype" id="3233654">int</span><span class="op" id="3233657">)</span>&nbsp;<span class="builtintype" id="3233659">string</span>&nbsp;<span class="op" id="3233666">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233669">if</span>&nbsp;<span class="ident" id="3233672">zone</span>&nbsp;<span class="op" id="3233677">==</span>&nbsp;<span class="num" id="3233680">0</span>&nbsp;<span class="op" id="3233682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233686">return</span>&nbsp;<span class="string" id="3233693">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233700">if</span>&nbsp;<span class="ident" id="3233703">ifi</span><span class="op" id="3233706">,</span>&nbsp;<span class="ident" id="3233708">err</span>&nbsp;<span class="op" id="3233712">:=</span>&nbsp;<span class="ident" id="3233715">InterfaceByIndex</span><span class="op" id="3233731">(</span><span class="ident" id="3233732">zone</span><span class="op" id="3233736">)</span><span class="op" id="3233737">;</span>&nbsp;<span class="ident" id="3233739">err</span>&nbsp;<span class="op" id="3233743">==</span>&nbsp;<span class="ident" id="3233746">nil</span>&nbsp;<span class="op" id="3233750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233754">return</span>&nbsp;<span class="ident" id="3233761">ifi</span><span class="op" id="3233764">.</span><span class="ident" id="3233765">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233774">return</span>&nbsp;<span class="ident" id="3233781">itod</span><span class="op" id="3233785">(</span><span class="builtintype" id="3233786">uint</span><span class="op" id="3233790">(</span><span class="ident" id="3233791">zone</span><span class="op" id="3233795">)</span><span class="op" id="3233796">)</span><br>
<span class="lineno"></span><span class="op" id="3233798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3233801">func</span>&nbsp;<span class="ident" id="3233806">zoneToInt</span><span class="op" id="3233815">(</span><span class="ident" id="3233816">zone</span>&nbsp;<span class="builtintype" id="3233821">string</span><span class="op" id="3233827">)</span>&nbsp;<span class="builtintype" id="3233829">int</span>&nbsp;<span class="op" id="3233833">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233836">if</span>&nbsp;<span class="ident" id="3233839">zone</span>&nbsp;<span class="op" id="3233844">==</span>&nbsp;<span class="string" id="3233847">&#34;&#34;</span>&nbsp;<span class="op" id="3233850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233854">return</span>&nbsp;<span class="num" id="3233861">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233867">if</span>&nbsp;<span class="ident" id="3233870">ifi</span><span class="op" id="3233873">,</span>&nbsp;<span class="ident" id="3233875">err</span>&nbsp;<span class="op" id="3233879">:=</span>&nbsp;<span class="ident" id="3233882">InterfaceByName</span><span class="op" id="3233897">(</span><span class="ident" id="3233898">zone</span><span class="op" id="3233902">)</span><span class="op" id="3233903">;</span>&nbsp;<span class="ident" id="3233905">err</span>&nbsp;<span class="op" id="3233909">==</span>&nbsp;<span class="ident" id="3233912">nil</span>&nbsp;<span class="op" id="3233916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233920">return</span>&nbsp;<span class="ident" id="3233927">ifi</span><span class="op" id="3233930">.</span><span class="ident" id="3233931">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3233941">n</span><span class="op" id="3233942">,</span>&nbsp;<span class="ident" id="3233944">_</span><span class="op" id="3233945">,</span>&nbsp;<span class="ident" id="3233947">_</span>&nbsp;<span class="op" id="3233949">:=</span>&nbsp;<span class="ident" id="3233952">dtoi</span><span class="op" id="3233956">(</span><span class="ident" id="3233957">zone</span><span class="op" id="3233961">,</span>&nbsp;<span class="num" id="3233963">0</span><span class="op" id="3233964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233967">return</span>&nbsp;<span class="ident" id="3233974">n</span><br>
<span class="lineno"></span><span class="op" id="3233976">}</span>
</div>
</body>
</html>
