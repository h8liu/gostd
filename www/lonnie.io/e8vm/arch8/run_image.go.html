<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="4883460">package</span>&nbsp;<span class="ident" id="4883468">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4883475">import</span>&nbsp;<span class="op" id="4883482">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4883485">&#34;os&#34;</span><br>
<span class="lineno">5</span><span class="op" id="4883490">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4883493">//&nbsp;RunImage&nbsp;loads&nbsp;and&nbsp;run&nbsp;a&nbsp;raw&nbsp;image&nbsp;on&nbsp;a&nbsp;single&nbsp;core&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="4883556">//&nbsp;with&nbsp;1GB&nbsp;physical&nbsp;memory&nbsp;until&nbsp;it&nbsp;runs&nbsp;into&nbsp;an&nbsp;exception.</span><br>
<span class="lineno"></span><span class="keyword" id="4883617">func</span>&nbsp;<span class="ident" id="4883622">RunImage</span><span class="op" id="4883630">(</span><span class="ident" id="4883631">path</span>&nbsp;<span class="builtintype" id="4883636">string</span><span class="op" id="4883642">)</span>&nbsp;<span class="builtintype" id="4883644">error</span>&nbsp;<span class="op" id="4883650">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883653">f</span><span class="op" id="4883654">,</span>&nbsp;<span class="ident" id="4883656">e</span>&nbsp;<span class="op" id="4883658">:=</span>&nbsp;<span class="ident" id="4883661">os</span><span class="op" id="4883663">.</span><span class="ident" id="4883664">Open</span><span class="op" id="4883668">(</span><span class="ident" id="4883669">path</span><span class="op" id="4883673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883676">if</span>&nbsp;<span class="ident" id="4883679">e</span>&nbsp;<span class="op" id="4883681">!=</span>&nbsp;<span class="ident" id="4883684">nil</span>&nbsp;<span class="op" id="4883688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883692">return</span>&nbsp;<span class="ident" id="4883699">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883706">m</span>&nbsp;<span class="op" id="4883708">:=</span>&nbsp;<span class="ident" id="4883711">NewMachine</span><span class="op" id="4883721">(</span><span class="builtintype" id="4883722">uint32</span><span class="op" id="4883728">(</span><span class="num" id="4883729">1</span><span class="op" id="4883730">&lt;&lt;</span><span class="num" id="4883732">30</span><span class="op" id="4883734">)</span><span class="op" id="4883735">,</span>&nbsp;<span class="num" id="4883737">1</span><span class="op" id="4883738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883741">e</span>&nbsp;<span class="op" id="4883743">=</span>&nbsp;<span class="ident" id="4883745">m</span><span class="op" id="4883746">.</span><span class="ident" id="4883747">LoadImage</span><span class="op" id="4883756">(</span><span class="ident" id="4883757">f</span><span class="op" id="4883758">,</span>&nbsp;<span class="ident" id="4883760">InitPC</span><span class="op" id="4883766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883769">if</span>&nbsp;<span class="ident" id="4883772">e</span>&nbsp;<span class="op" id="4883774">!=</span>&nbsp;<span class="ident" id="4883777">nil</span>&nbsp;<span class="op" id="4883781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883785">return</span>&nbsp;<span class="ident" id="4883792">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883795">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883799">_</span><span class="op" id="4883800">,</span>&nbsp;<span class="ident" id="4883802">exp</span>&nbsp;<span class="op" id="4883806">:=</span>&nbsp;<span class="ident" id="4883809">m</span><span class="op" id="4883810">.</span><span class="ident" id="4883811">Run</span><span class="op" id="4883814">(</span><span class="num" id="4883815">0</span><span class="op" id="4883816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883819">if</span>&nbsp;<span class="ident" id="4883822">exp</span>&nbsp;<span class="op" id="4883826">!=</span>&nbsp;<span class="ident" id="4883829">nil</span>&nbsp;<span class="op" id="4883833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883837">return</span>&nbsp;<span class="ident" id="4883844">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4883849">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4883853">return</span>&nbsp;<span class="ident" id="4883860">nil</span><br>
<span class="lineno"></span><span class="op" id="4883864">}</span>
</div>
</body>
</html>
