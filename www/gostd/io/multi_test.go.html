<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="298532">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="298588">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="298642">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="298693">package</span>&nbsp;<span class="ident" id="298701">io_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="298710">import</span>&nbsp;<span class="op" id="298717">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="298720">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="298729">&#34;crypto/sha1&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="298744">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="298751">.</span>&nbsp;<span class="string" id="298753">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="298759">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="298772">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="298783">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="298793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="298796">func</span>&nbsp;<span class="ident" id="298801">TestMultiReader</span><span class="op" id="298816">(</span><span class="ident" id="298817">t</span>&nbsp;<span class="op" id="298819">*</span><span class="ident" id="298820">testing</span><span class="op" id="298827">.</span><span class="ident" id="298828">T</span><span class="op" id="298829">)</span>&nbsp;<span class="op" id="298831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="298834">var</span>&nbsp;<span class="ident" id="298838">mr</span>&nbsp;<span class="ident" id="298841">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="298849">var</span>&nbsp;<span class="ident" id="298853">buf</span>&nbsp;<span class="op" id="298857">[</span><span class="op" id="298858">]</span><span class="builtintype" id="298859">byte</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="298865">nread</span>&nbsp;<span class="op" id="298871">:=</span>&nbsp;<span class="num" id="298874">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="298877">withFooBar</span>&nbsp;<span class="op" id="298888">:=</span>&nbsp;<span class="keyword" id="298891">func</span><span class="op" id="298895">(</span><span class="ident" id="298896">tests</span>&nbsp;<span class="keyword" id="298902">func</span><span class="op" id="298906">(</span><span class="op" id="298907">)</span><span class="op" id="298908">)</span>&nbsp;<span class="op" id="298910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="298914">r1</span>&nbsp;<span class="op" id="298917">:=</span>&nbsp;<span class="ident" id="298920">strings</span><span class="op" id="298927">.</span><span class="ident" id="298928">NewReader</span><span class="op" id="298937">(</span><span class="string" id="298938">&#34;foo&nbsp;&#34;</span><span class="op" id="298944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="298948">r2</span>&nbsp;<span class="op" id="298951">:=</span>&nbsp;<span class="ident" id="298954">strings</span><span class="op" id="298961">.</span><span class="ident" id="298962">NewReader</span><span class="op" id="298971">(</span><span class="string" id="298972">&#34;&#34;</span><span class="op" id="298974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="298978">r3</span>&nbsp;<span class="op" id="298981">:=</span>&nbsp;<span class="ident" id="298984">strings</span><span class="op" id="298991">.</span><span class="ident" id="298992">NewReader</span><span class="op" id="299001">(</span><span class="string" id="299002">&#34;bar&#34;</span><span class="op" id="299007">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299011">mr</span>&nbsp;<span class="op" id="299014">=</span>&nbsp;<span class="ident" id="299016">MultiReader</span><span class="op" id="299027">(</span><span class="ident" id="299028">r1</span><span class="op" id="299030">,</span>&nbsp;<span class="ident" id="299032">r2</span><span class="op" id="299034">,</span>&nbsp;<span class="ident" id="299036">r3</span><span class="op" id="299038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299042">buf</span>&nbsp;<span class="op" id="299046">=</span>&nbsp;<span class="builtinfunc" id="299048">make</span><span class="op" id="299052">(</span><span class="op" id="299053">[</span><span class="op" id="299054">]</span><span class="builtintype" id="299055">byte</span><span class="op" id="299059">,</span>&nbsp;<span class="num" id="299061">20</span><span class="op" id="299063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299067">tests</span><span class="op" id="299072">(</span><span class="op" id="299073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="299076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299079">expectRead</span>&nbsp;<span class="op" id="299090">:=</span>&nbsp;<span class="keyword" id="299093">func</span><span class="op" id="299097">(</span><span class="ident" id="299098">size</span>&nbsp;<span class="builtintype" id="299103">int</span><span class="op" id="299106">,</span>&nbsp;<span class="ident" id="299108">expected</span>&nbsp;<span class="builtintype" id="299117">string</span><span class="op" id="299123">,</span>&nbsp;<span class="ident" id="299125">eerr</span>&nbsp;<span class="builtintype" id="299130">error</span><span class="op" id="299135">)</span>&nbsp;<span class="op" id="299137">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299141">nread</span><span class="op" id="299146">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299151">n</span><span class="op" id="299152">,</span>&nbsp;<span class="ident" id="299154">gerr</span>&nbsp;<span class="op" id="299159">:=</span>&nbsp;<span class="ident" id="299162">mr</span><span class="op" id="299164">.</span><span class="ident" id="299165">Read</span><span class="op" id="299169">(</span><span class="ident" id="299170">buf</span><span class="op" id="299173">[</span><span class="num" id="299174">0</span><span class="op" id="299175">:</span><span class="ident" id="299176">size</span><span class="op" id="299180">]</span><span class="op" id="299181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="299185">if</span>&nbsp;<span class="ident" id="299188">n</span>&nbsp;<span class="op" id="299190">!=</span>&nbsp;<span class="builtinfunc" id="299193">len</span><span class="op" id="299196">(</span><span class="ident" id="299197">expected</span><span class="op" id="299205">)</span>&nbsp;<span class="op" id="299207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299212">t</span><span class="op" id="299213">.</span><span class="ident" id="299214">Errorf</span><span class="op" id="299220">(</span><span class="string" id="299221">&#34;#%d,&nbsp;expected&nbsp;%d&nbsp;bytes;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="299253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299259">nread</span><span class="op" id="299264">,</span>&nbsp;<span class="builtinfunc" id="299266">len</span><span class="op" id="299269">(</span><span class="ident" id="299270">expected</span><span class="op" id="299278">)</span><span class="op" id="299279">,</span>&nbsp;<span class="ident" id="299281">n</span><span class="op" id="299282">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="299286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299290">got</span>&nbsp;<span class="op" id="299294">:=</span>&nbsp;<span class="builtintype" id="299297">string</span><span class="op" id="299303">(</span><span class="ident" id="299304">buf</span><span class="op" id="299307">[</span><span class="num" id="299308">0</span><span class="op" id="299309">:</span><span class="ident" id="299310">n</span><span class="op" id="299311">]</span><span class="op" id="299312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="299316">if</span>&nbsp;<span class="ident" id="299319">got</span>&nbsp;<span class="op" id="299323">!=</span>&nbsp;<span class="ident" id="299326">expected</span>&nbsp;<span class="op" id="299335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299340">t</span><span class="op" id="299341">.</span><span class="ident" id="299342">Errorf</span><span class="op" id="299348">(</span><span class="string" id="299349">&#34;#%d,&nbsp;expected&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="299375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299381">nread</span><span class="op" id="299386">,</span>&nbsp;<span class="ident" id="299388">expected</span><span class="op" id="299396">,</span>&nbsp;<span class="ident" id="299398">got</span><span class="op" id="299401">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="299405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="299409">if</span>&nbsp;<span class="ident" id="299412">gerr</span>&nbsp;<span class="op" id="299417">!=</span>&nbsp;<span class="ident" id="299420">eerr</span>&nbsp;<span class="op" id="299425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299430">t</span><span class="op" id="299431">.</span><span class="ident" id="299432">Errorf</span><span class="op" id="299438">(</span><span class="string" id="299439">&#34;#%d,&nbsp;expected&nbsp;error&nbsp;%v;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="299471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299477">nread</span><span class="op" id="299482">,</span>&nbsp;<span class="ident" id="299484">eerr</span><span class="op" id="299488">,</span>&nbsp;<span class="ident" id="299490">gerr</span><span class="op" id="299494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="299498">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299502">buf</span>&nbsp;<span class="op" id="299506">=</span>&nbsp;<span class="ident" id="299508">buf</span><span class="op" id="299511">[</span><span class="ident" id="299512">n</span><span class="op" id="299513">:</span><span class="op" id="299514">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="299517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299520">withFooBar</span><span class="op" id="299530">(</span><span class="keyword" id="299531">func</span><span class="op" id="299535">(</span><span class="op" id="299536">)</span>&nbsp;<span class="op" id="299538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299542">expectRead</span><span class="op" id="299552">(</span><span class="num" id="299553">2</span><span class="op" id="299554">,</span>&nbsp;<span class="string" id="299556">&#34;fo&#34;</span><span class="op" id="299560">,</span>&nbsp;<span class="ident" id="299562">nil</span><span class="op" id="299565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299569">expectRead</span><span class="op" id="299579">(</span><span class="num" id="299580">5</span><span class="op" id="299581">,</span>&nbsp;<span class="string" id="299583">&#34;o&nbsp;&#34;</span><span class="op" id="299587">,</span>&nbsp;<span class="ident" id="299589">nil</span><span class="op" id="299592">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299596">expectRead</span><span class="op" id="299606">(</span><span class="num" id="299607">5</span><span class="op" id="299608">,</span>&nbsp;<span class="string" id="299610">&#34;bar&#34;</span><span class="op" id="299615">,</span>&nbsp;<span class="ident" id="299617">nil</span><span class="op" id="299620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299624">expectRead</span><span class="op" id="299634">(</span><span class="num" id="299635">5</span><span class="op" id="299636">,</span>&nbsp;<span class="string" id="299638">&#34;&#34;</span><span class="op" id="299640">,</span>&nbsp;<span class="ident" id="299642">EOF</span><span class="op" id="299645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="299648">}</span><span class="op" id="299649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299652">withFooBar</span><span class="op" id="299662">(</span><span class="keyword" id="299663">func</span><span class="op" id="299667">(</span><span class="op" id="299668">)</span>&nbsp;<span class="op" id="299670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299674">expectRead</span><span class="op" id="299684">(</span><span class="num" id="299685">4</span><span class="op" id="299686">,</span>&nbsp;<span class="string" id="299688">&#34;foo&nbsp;&#34;</span><span class="op" id="299694">,</span>&nbsp;<span class="ident" id="299696">nil</span><span class="op" id="299699">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299703">expectRead</span><span class="op" id="299713">(</span><span class="num" id="299714">1</span><span class="op" id="299715">,</span>&nbsp;<span class="string" id="299717">&#34;b&#34;</span><span class="op" id="299720">,</span>&nbsp;<span class="ident" id="299722">nil</span><span class="op" id="299725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299729">expectRead</span><span class="op" id="299739">(</span><span class="num" id="299740">3</span><span class="op" id="299741">,</span>&nbsp;<span class="string" id="299743">&#34;ar&#34;</span><span class="op" id="299747">,</span>&nbsp;<span class="ident" id="299749">nil</span><span class="op" id="299752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299756">expectRead</span><span class="op" id="299766">(</span><span class="num" id="299767">1</span><span class="op" id="299768">,</span>&nbsp;<span class="string" id="299770">&#34;&#34;</span><span class="op" id="299772">,</span>&nbsp;<span class="ident" id="299774">EOF</span><span class="op" id="299777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="299780">}</span><span class="op" id="299781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299784">withFooBar</span><span class="op" id="299794">(</span><span class="keyword" id="299795">func</span><span class="op" id="299799">(</span><span class="op" id="299800">)</span>&nbsp;<span class="op" id="299802">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299806">expectRead</span><span class="op" id="299816">(</span><span class="num" id="299817">5</span><span class="op" id="299818">,</span>&nbsp;<span class="string" id="299820">&#34;foo&nbsp;&#34;</span><span class="op" id="299826">,</span>&nbsp;<span class="ident" id="299828">nil</span><span class="op" id="299831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="299834">}</span><span class="op" id="299835">)</span><br>
<span class="lineno"></span><span class="op" id="299837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="299840">func</span>&nbsp;<span class="ident" id="299845">TestMultiWriter</span><span class="op" id="299860">(</span><span class="ident" id="299861">t</span>&nbsp;<span class="op" id="299863">*</span><span class="ident" id="299864">testing</span><span class="op" id="299871">.</span><span class="ident" id="299872">T</span><span class="op" id="299873">)</span>&nbsp;<span class="op" id="299875">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299878">sha1</span>&nbsp;<span class="op" id="299883">:=</span>&nbsp;<span class="ident" id="299886">sha1</span><span class="op" id="299890">.</span><span class="ident" id="299891">New</span><span class="op" id="299894">(</span><span class="op" id="299895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299898">sink</span>&nbsp;<span class="op" id="299903">:=</span>&nbsp;<span class="builtinfunc" id="299906">new</span><span class="op" id="299909">(</span><span class="ident" id="299910">bytes</span><span class="op" id="299915">.</span><span class="ident" id="299916">Buffer</span><span class="op" id="299922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299925">mw</span>&nbsp;<span class="op" id="299928">:=</span>&nbsp;<span class="ident" id="299931">MultiWriter</span><span class="op" id="299942">(</span><span class="ident" id="299943">sha1</span><span class="op" id="299947">,</span>&nbsp;<span class="ident" id="299949">sink</span><span class="op" id="299953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299957">sourceString</span>&nbsp;<span class="op" id="299970">:=</span>&nbsp;<span class="string" id="299973">&#34;My&nbsp;input&nbsp;text.&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="299991">source</span>&nbsp;<span class="op" id="299998">:=</span>&nbsp;<span class="ident" id="300001">strings</span><span class="op" id="300008">.</span><span class="ident" id="300009">NewReader</span><span class="op" id="300018">(</span><span class="ident" id="300019">sourceString</span><span class="op" id="300031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="300034">written</span><span class="op" id="300041">,</span>&nbsp;<span class="ident" id="300043">err</span>&nbsp;<span class="op" id="300047">:=</span>&nbsp;<span class="ident" id="300050">Copy</span><span class="op" id="300054">(</span><span class="ident" id="300055">mw</span><span class="op" id="300057">,</span>&nbsp;<span class="ident" id="300059">source</span><span class="op" id="300065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="300069">if</span>&nbsp;<span class="ident" id="300072">written</span>&nbsp;<span class="op" id="300080">!=</span>&nbsp;<span class="ident" id="300083">int64</span><span class="op" id="300088">(</span><span class="builtinfunc" id="300089">len</span><span class="op" id="300092">(</span><span class="ident" id="300093">sourceString</span><span class="op" id="300105">)</span><span class="op" id="300106">)</span>&nbsp;<span class="op" id="300108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="300112">t</span><span class="op" id="300113">.</span><span class="ident" id="300114">Errorf</span><span class="op" id="300120">(</span><span class="string" id="300121">&#34;short&nbsp;write&nbsp;of&nbsp;%d,&nbsp;not&nbsp;%d&#34;</span><span class="op" id="300148">,</span>&nbsp;<span class="ident" id="300150">written</span><span class="op" id="300157">,</span>&nbsp;<span class="builtinfunc" id="300159">len</span><span class="op" id="300162">(</span><span class="ident" id="300163">sourceString</span><span class="op" id="300175">)</span><span class="op" id="300176">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="300179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="300183">if</span>&nbsp;<span class="ident" id="300186">err</span>&nbsp;<span class="op" id="300190">!=</span>&nbsp;<span class="ident" id="300193">nil</span>&nbsp;<span class="op" id="300197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="300201">t</span><span class="op" id="300202">.</span><span class="ident" id="300203">Errorf</span><span class="op" id="300209">(</span><span class="string" id="300210">&#34;unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="300232">,</span>&nbsp;<span class="ident" id="300234">err</span><span class="op" id="300237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="300240">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="300244">sha1hex</span>&nbsp;<span class="op" id="300252">:=</span>&nbsp;<span class="ident" id="300255">fmt</span><span class="op" id="300258">.</span><span class="ident" id="300259">Sprintf</span><span class="op" id="300266">(</span><span class="string" id="300267">&#34;%x&#34;</span><span class="op" id="300271">,</span>&nbsp;<span class="ident" id="300273">sha1</span><span class="op" id="300277">.</span><span class="ident" id="300278">Sum</span><span class="op" id="300281">(</span><span class="ident" id="300282">nil</span><span class="op" id="300285">)</span><span class="op" id="300286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="300289">if</span>&nbsp;<span class="ident" id="300292">sha1hex</span>&nbsp;<span class="op" id="300300">!=</span>&nbsp;<span class="string" id="300303">&#34;01cb303fa8c30a64123067c5aa6284ba7ec2d31b&#34;</span>&nbsp;<span class="op" id="300346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="300350">t</span><span class="op" id="300351">.</span><span class="ident" id="300352">Error</span><span class="op" id="300357">(</span><span class="string" id="300358">&#34;incorrect&nbsp;sha1&nbsp;value&#34;</span><span class="op" id="300380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="300383">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="300387">if</span>&nbsp;<span class="ident" id="300390">sink</span><span class="op" id="300394">.</span><span class="ident" id="300395">String</span><span class="op" id="300401">(</span><span class="op" id="300402">)</span>&nbsp;<span class="op" id="300404">!=</span>&nbsp;<span class="ident" id="300407">sourceString</span>&nbsp;<span class="op" id="300420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="300424">t</span><span class="op" id="300425">.</span><span class="ident" id="300426">Errorf</span><span class="op" id="300432">(</span><span class="string" id="300433">&#34;expected&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="300454">,</span>&nbsp;<span class="ident" id="300456">sourceString</span><span class="op" id="300468">,</span>&nbsp;<span class="ident" id="300470">sink</span><span class="op" id="300474">.</span><span class="ident" id="300475">String</span><span class="op" id="300481">(</span><span class="op" id="300482">)</span><span class="op" id="300483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="300486">}</span><br>
<span class="lineno"></span><span class="op" id="300488">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="300491">//&nbsp;Test&nbsp;that&nbsp;MultiReader&nbsp;copies&nbsp;the&nbsp;input&nbsp;slice&nbsp;and&nbsp;is&nbsp;insulated&nbsp;from&nbsp;future&nbsp;modification.</span><br>
<span class="lineno"></span><span class="keyword" id="300582">func</span>&nbsp;<span class="ident" id="300587">TestMultiReaderCopy</span><span class="op" id="300606">(</span><span class="ident" id="300607">t</span>&nbsp;<span class="op" id="300609">*</span><span class="ident" id="300610">testing</span><span class="op" id="300617">.</span><span class="ident" id="300618">T</span><span class="op" id="300619">)</span>&nbsp;<span class="op" id="300621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="300624">slice</span>&nbsp;<span class="op" id="300630">:=</span>&nbsp;<span class="op" id="300633">[</span><span class="op" id="300634">]</span><span class="ident" id="300635">Reader</span><span class="op" id="300641">{</span><span class="ident" id="300642">strings</span><span class="op" id="300649">.</span><span class="ident" id="300650">NewReader</span><span class="op" id="300659">(</span><span class="string" id="300660">&#34;hello&nbsp;world&#34;</span><span class="op" id="300673">)</span><span class="op" id="300674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="300677">r</span>&nbsp;<span class="op" id="300679">:=</span>&nbsp;<span class="ident" id="300682">MultiReader</span><span class="op" id="300693">(</span><span class="ident" id="300694">slice</span><span class="op" id="300699">...</span><span class="op" id="300702">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="300705">slice</span><span class="op" id="300710">[</span><span class="num" id="300711">0</span><span class="op" id="300712">]</span>&nbsp;<span class="op" id="300714">=</span>&nbsp;<span class="ident" id="300716">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="300721">data</span><span class="op" id="300725">,</span>&nbsp;<span class="ident" id="300727">err</span>&nbsp;<span class="op" id="300731">:=</span>&nbsp;<span class="ident" id="300734">ioutil</span><span class="op" id="300740">.</span><span class="ident" id="300741">ReadAll</span><span class="op" id="300748">(</span><span class="ident" id="300749">r</span><span class="op" id="300750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="300753">if</span>&nbsp;<span class="ident" id="300756">err</span>&nbsp;<span class="op" id="300760">!=</span>&nbsp;<span class="ident" id="300763">nil</span>&nbsp;<span class="op" id="300767">||</span>&nbsp;<span class="builtintype" id="300770">string</span><span class="op" id="300776">(</span><span class="ident" id="300777">data</span><span class="op" id="300781">)</span>&nbsp;<span class="op" id="300783">!=</span>&nbsp;<span class="string" id="300786">&#34;hello&nbsp;world&#34;</span>&nbsp;<span class="op" id="300800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="300804">t</span><span class="op" id="300805">.</span><span class="ident" id="300806">Errorf</span><span class="op" id="300812">(</span><span class="string" id="300813">&#34;ReadAll()&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="300847">,</span>&nbsp;<span class="ident" id="300849">data</span><span class="op" id="300853">,</span>&nbsp;<span class="ident" id="300855">err</span><span class="op" id="300858">,</span>&nbsp;<span class="string" id="300860">&#34;hello&nbsp;world&#34;</span><span class="op" id="300873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="300876">}</span><br>
<span class="lineno">100</span><span class="op" id="300878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="300881">//&nbsp;Test&nbsp;that&nbsp;MultiWriter&nbsp;copies&nbsp;the&nbsp;input&nbsp;slice&nbsp;and&nbsp;is&nbsp;insulated&nbsp;from&nbsp;future&nbsp;modification.</span><br>
<span class="lineno"></span><span class="keyword" id="300972">func</span>&nbsp;<span class="ident" id="300977">TestMultiWriterCopy</span><span class="op" id="300996">(</span><span class="ident" id="300997">t</span>&nbsp;<span class="op" id="300999">*</span><span class="ident" id="301000">testing</span><span class="op" id="301007">.</span><span class="ident" id="301008">T</span><span class="op" id="301009">)</span>&nbsp;<span class="op" id="301011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="301014">var</span>&nbsp;<span class="ident" id="301018">buf</span>&nbsp;<span class="ident" id="301022">bytes</span><span class="op" id="301027">.</span><span class="ident" id="301028">Buffer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301036">slice</span>&nbsp;<span class="op" id="301042">:=</span>&nbsp;<span class="op" id="301045">[</span><span class="op" id="301046">]</span><span class="ident" id="301047">Writer</span><span class="op" id="301053">{</span><span class="op" id="301054">&amp;</span><span class="ident" id="301055">buf</span><span class="op" id="301058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301061">w</span>&nbsp;<span class="op" id="301063">:=</span>&nbsp;<span class="ident" id="301066">MultiWriter</span><span class="op" id="301077">(</span><span class="ident" id="301078">slice</span><span class="op" id="301083">...</span><span class="op" id="301086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301089">slice</span><span class="op" id="301094">[</span><span class="num" id="301095">0</span><span class="op" id="301096">]</span>&nbsp;<span class="op" id="301098">=</span>&nbsp;<span class="ident" id="301100">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301105">n</span><span class="op" id="301106">,</span>&nbsp;<span class="ident" id="301108">err</span>&nbsp;<span class="op" id="301112">:=</span>&nbsp;<span class="ident" id="301115">w</span><span class="op" id="301116">.</span><span class="ident" id="301117">Write</span><span class="op" id="301122">(</span><span class="op" id="301123">[</span><span class="op" id="301124">]</span><span class="builtintype" id="301125">byte</span><span class="op" id="301129">(</span><span class="string" id="301130">&#34;hello&nbsp;world&#34;</span><span class="op" id="301143">)</span><span class="op" id="301144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="301147">if</span>&nbsp;<span class="ident" id="301150">err</span>&nbsp;<span class="op" id="301154">!=</span>&nbsp;<span class="ident" id="301157">nil</span>&nbsp;<span class="op" id="301161">||</span>&nbsp;<span class="ident" id="301164">n</span>&nbsp;<span class="op" id="301166">!=</span>&nbsp;<span class="num" id="301169">11</span>&nbsp;<span class="op" id="301172">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301176">t</span><span class="op" id="301177">.</span><span class="ident" id="301178">Errorf</span><span class="op" id="301184">(</span><span class="string" id="301185">&#34;Write(`hello&nbsp;world`)&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;11,&nbsp;nil&#34;</span><span class="op" id="301230">,</span>&nbsp;<span class="ident" id="301232">n</span><span class="op" id="301233">,</span>&nbsp;<span class="ident" id="301235">err</span><span class="op" id="301238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="301241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="301244">if</span>&nbsp;<span class="ident" id="301247">buf</span><span class="op" id="301250">.</span><span class="ident" id="301251">String</span><span class="op" id="301257">(</span><span class="op" id="301258">)</span>&nbsp;<span class="op" id="301260">!=</span>&nbsp;<span class="string" id="301263">&#34;hello&nbsp;world&#34;</span>&nbsp;<span class="op" id="301277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301281">t</span><span class="op" id="301282">.</span><span class="ident" id="301283">Errorf</span><span class="op" id="301289">(</span><span class="string" id="301290">&#34;buf.String()&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="301318">,</span>&nbsp;<span class="ident" id="301320">buf</span><span class="op" id="301323">.</span><span class="ident" id="301324">String</span><span class="op" id="301330">(</span><span class="op" id="301331">)</span><span class="op" id="301332">,</span>&nbsp;<span class="string" id="301334">&#34;hello&nbsp;world&#34;</span><span class="op" id="301347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="301350">}</span><br>
<span class="lineno">115</span><span class="op" id="301352">}</span>
</div>
</body>
</html>
