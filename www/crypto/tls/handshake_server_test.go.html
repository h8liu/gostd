<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7827125">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7827180">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7827234">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7827285">package</span>&nbsp;<span class="ident" id="7827293">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7827298">import</span>&nbsp;<span class="op" id="7827305">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827308">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827317">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827333">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827352">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827366">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827382">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827398">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827408">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827415">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827421">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827433">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827440">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827446">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827457">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827474">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827485">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7827496">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="7827503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7827506">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7827584">type</span>&nbsp;<span class="ident" id="7827589">zeroSource</span>&nbsp;<span class="keyword" id="7827600">struct</span><span class="op" id="7827606">{</span><span class="op" id="7827607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7827610">func</span>&nbsp;<span class="op" id="7827615">(</span><span class="ident" id="7827616">zeroSource</span><span class="op" id="7827626">)</span>&nbsp;<span class="ident" id="7827628">Read</span><span class="op" id="7827632">(</span><span class="ident" id="7827633">b</span>&nbsp;<span class="op" id="7827635">[</span><span class="op" id="7827636">]</span><span class="builtintype" id="7827637">byte</span><span class="op" id="7827641">)</span>&nbsp;<span class="op" id="7827643">(</span><span class="ident" id="7827644">n</span>&nbsp;<span class="builtintype" id="7827646">int</span><span class="op" id="7827649">,</span>&nbsp;<span class="ident" id="7827651">err</span>&nbsp;<span class="builtintype" id="7827655">error</span><span class="op" id="7827660">)</span>&nbsp;<span class="op" id="7827662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827665">for</span>&nbsp;<span class="ident" id="7827669">i</span>&nbsp;<span class="op" id="7827671">:=</span>&nbsp;<span class="keyword" id="7827674">range</span>&nbsp;<span class="ident" id="7827680">b</span>&nbsp;<span class="op" id="7827682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827686">b</span><span class="op" id="7827687">[</span><span class="ident" id="7827688">i</span><span class="op" id="7827689">]</span>&nbsp;<span class="op" id="7827691">=</span>&nbsp;<span class="num" id="7827693">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7827696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7827700">return</span>&nbsp;<span class="builtinfunc" id="7827707">len</span><span class="op" id="7827710">(</span><span class="ident" id="7827711">b</span><span class="op" id="7827712">)</span><span class="op" id="7827713">,</span>&nbsp;<span class="ident" id="7827715">nil</span><br>
<span class="lineno"></span><span class="op" id="7827719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7827722">var</span>&nbsp;<span class="ident" id="7827726">testConfig</span>&nbsp;<span class="op" id="7827737">*</span><span class="ident" id="7827738">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7827746">func</span>&nbsp;<span class="ident" id="7827751">init</span><span class="op" id="7827755">(</span><span class="op" id="7827756">)</span>&nbsp;<span class="op" id="7827758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827761">testConfig</span>&nbsp;<span class="op" id="7827772">=</span>&nbsp;<span class="op" id="7827774">&amp;</span><span class="ident" id="7827775">Config</span><span class="op" id="7827781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827785">Time</span><span class="op" id="7827789">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7827805">func</span><span class="op" id="7827809">(</span><span class="op" id="7827810">)</span>&nbsp;<span class="ident" id="7827812">time</span><span class="op" id="7827816">.</span><span class="ident" id="7827817">Time</span>&nbsp;<span class="op" id="7827822">{</span>&nbsp;<span class="keyword" id="7827824">return</span>&nbsp;<span class="ident" id="7827831">time</span><span class="op" id="7827835">.</span><span class="ident" id="7827836">Unix</span><span class="op" id="7827840">(</span><span class="num" id="7827841">0</span><span class="op" id="7827842">,</span>&nbsp;<span class="num" id="7827844">0</span><span class="op" id="7827845">)</span>&nbsp;<span class="op" id="7827847">}</span><span class="op" id="7827848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827852">Rand</span><span class="op" id="7827856">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7827872">zeroSource</span><span class="op" id="7827882">{</span><span class="op" id="7827883">}</span><span class="op" id="7827884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827888">Certificates</span><span class="op" id="7827900">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7827908">make</span><span class="op" id="7827912">(</span><span class="op" id="7827913">[</span><span class="op" id="7827914">]</span><span class="ident" id="7827915">Certificate</span><span class="op" id="7827926">,</span>&nbsp;<span class="num" id="7827928">2</span><span class="op" id="7827929">)</span><span class="op" id="7827930">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827934">InsecureSkipVerify</span><span class="op" id="7827952">:</span>&nbsp;<span class="ident" id="7827954">true</span><span class="op" id="7827958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827962">MinVersion</span><span class="op" id="7827972">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7827982">VersionSSL30</span><span class="op" id="7827994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7827998">MaxVersion</span><span class="op" id="7828008">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7828018">VersionTLS12</span><span class="op" id="7828030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7828033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828036">testConfig</span><span class="op" id="7828046">.</span><span class="ident" id="7828047">Certificates</span><span class="op" id="7828059">[</span><span class="num" id="7828060">0</span><span class="op" id="7828061">]</span><span class="op" id="7828062">.</span><span class="ident" id="7828063">Certificate</span>&nbsp;<span class="op" id="7828075">=</span>&nbsp;<span class="op" id="7828077">[</span><span class="op" id="7828078">]</span><span class="op" id="7828079">[</span><span class="op" id="7828080">]</span><span class="builtintype" id="7828081">byte</span><span class="op" id="7828085">{</span><span class="ident" id="7828086">testRSACertificate</span><span class="op" id="7828104">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828107">testConfig</span><span class="op" id="7828117">.</span><span class="ident" id="7828118">Certificates</span><span class="op" id="7828130">[</span><span class="num" id="7828131">0</span><span class="op" id="7828132">]</span><span class="op" id="7828133">.</span><span class="ident" id="7828134">PrivateKey</span>&nbsp;<span class="op" id="7828145">=</span>&nbsp;<span class="ident" id="7828147">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828166">testConfig</span><span class="op" id="7828176">.</span><span class="ident" id="7828177">Certificates</span><span class="op" id="7828189">[</span><span class="num" id="7828190">1</span><span class="op" id="7828191">]</span><span class="op" id="7828192">.</span><span class="ident" id="7828193">Certificate</span>&nbsp;<span class="op" id="7828205">=</span>&nbsp;<span class="op" id="7828207">[</span><span class="op" id="7828208">]</span><span class="op" id="7828209">[</span><span class="op" id="7828210">]</span><span class="builtintype" id="7828211">byte</span><span class="op" id="7828215">{</span><span class="ident" id="7828216">testSNICertificate</span><span class="op" id="7828234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828237">testConfig</span><span class="op" id="7828247">.</span><span class="ident" id="7828248">Certificates</span><span class="op" id="7828260">[</span><span class="num" id="7828261">1</span><span class="op" id="7828262">]</span><span class="op" id="7828263">.</span><span class="ident" id="7828264">PrivateKey</span>&nbsp;<span class="op" id="7828275">=</span>&nbsp;<span class="ident" id="7828277">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828296">testConfig</span><span class="op" id="7828306">.</span><span class="ident" id="7828307">BuildNameToCertificate</span><span class="op" id="7828329">(</span><span class="op" id="7828330">)</span><br>
<span class="lineno"></span><span class="op" id="7828332">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7828335">func</span>&nbsp;<span class="ident" id="7828340">testClientHelloFailure</span><span class="op" id="7828362">(</span><span class="ident" id="7828363">t</span>&nbsp;<span class="op" id="7828365">*</span><span class="ident" id="7828366">testing</span><span class="op" id="7828373">.</span><span class="ident" id="7828374">T</span><span class="op" id="7828375">,</span>&nbsp;<span class="ident" id="7828377">m</span>&nbsp;<span class="ident" id="7828379">handshakeMessage</span><span class="op" id="7828395">,</span>&nbsp;<span class="ident" id="7828397">expectedSubStr</span>&nbsp;<span class="builtintype" id="7828412">string</span><span class="op" id="7828418">)</span>&nbsp;<span class="op" id="7828420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828423">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828464">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7828507">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828527">c</span><span class="op" id="7828528">,</span>&nbsp;<span class="ident" id="7828530">s</span>&nbsp;<span class="op" id="7828532">:=</span>&nbsp;<span class="ident" id="7828535">net</span><span class="op" id="7828538">.</span><span class="ident" id="7828539">Pipe</span><span class="op" id="7828543">(</span><span class="op" id="7828544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7828547">go</span>&nbsp;<span class="keyword" id="7828550">func</span><span class="op" id="7828554">(</span><span class="op" id="7828555">)</span>&nbsp;<span class="op" id="7828557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828561">cli</span>&nbsp;<span class="op" id="7828565">:=</span>&nbsp;<span class="ident" id="7828568">Client</span><span class="op" id="7828574">(</span><span class="ident" id="7828575">c</span><span class="op" id="7828576">,</span>&nbsp;<span class="ident" id="7828578">testConfig</span><span class="op" id="7828588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7828592">if</span>&nbsp;<span class="ident" id="7828595">ch</span><span class="op" id="7828597">,</span>&nbsp;<span class="ident" id="7828599">ok</span>&nbsp;<span class="op" id="7828602">:=</span>&nbsp;<span class="ident" id="7828605">m</span><span class="op" id="7828606">.</span><span class="op" id="7828607">(</span><span class="op" id="7828608">*</span><span class="ident" id="7828609">clientHelloMsg</span><span class="op" id="7828623">)</span><span class="op" id="7828624">;</span>&nbsp;<span class="ident" id="7828626">ok</span>&nbsp;<span class="op" id="7828629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828634">cli</span><span class="op" id="7828637">.</span><span class="ident" id="7828638">vers</span>&nbsp;<span class="op" id="7828643">=</span>&nbsp;<span class="ident" id="7828645">ch</span><span class="op" id="7828647">.</span><span class="ident" id="7828648">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7828655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828659">cli</span><span class="op" id="7828662">.</span><span class="ident" id="7828663">writeRecord</span><span class="op" id="7828674">(</span><span class="ident" id="7828675">recordTypeHandshake</span><span class="op" id="7828694">,</span>&nbsp;<span class="ident" id="7828696">m</span><span class="op" id="7828697">.</span><span class="ident" id="7828698">marshal</span><span class="op" id="7828705">(</span><span class="op" id="7828706">)</span><span class="op" id="7828707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828711">c</span><span class="op" id="7828712">.</span><span class="ident" id="7828713">Close</span><span class="op" id="7828718">(</span><span class="op" id="7828719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7828722">}</span><span class="op" id="7828723">(</span><span class="op" id="7828724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828727">err</span>&nbsp;<span class="op" id="7828731">:=</span>&nbsp;<span class="ident" id="7828734">Server</span><span class="op" id="7828740">(</span><span class="ident" id="7828741">s</span><span class="op" id="7828742">,</span>&nbsp;<span class="ident" id="7828744">testConfig</span><span class="op" id="7828754">)</span><span class="op" id="7828755">.</span><span class="ident" id="7828756">Handshake</span><span class="op" id="7828765">(</span><span class="op" id="7828766">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828769">s</span><span class="op" id="7828770">.</span><span class="ident" id="7828771">Close</span><span class="op" id="7828776">(</span><span class="op" id="7828777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7828780">if</span>&nbsp;<span class="ident" id="7828783">err</span>&nbsp;<span class="op" id="7828787">==</span>&nbsp;<span class="ident" id="7828790">nil</span>&nbsp;<span class="op" id="7828794">||</span>&nbsp;<span class="op" id="7828797">!</span><span class="ident" id="7828798">strings</span><span class="op" id="7828805">.</span><span class="ident" id="7828806">Contains</span><span class="op" id="7828814">(</span><span class="ident" id="7828815">err</span><span class="op" id="7828818">.</span><span class="ident" id="7828819">Error</span><span class="op" id="7828824">(</span><span class="op" id="7828825">)</span><span class="op" id="7828826">,</span>&nbsp;<span class="ident" id="7828828">expectedSubStr</span><span class="op" id="7828842">)</span>&nbsp;<span class="op" id="7828844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828848">t</span><span class="op" id="7828849">.</span><span class="ident" id="7828850">Errorf</span><span class="op" id="7828856">(</span><span class="string" id="7828857">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7828906">,</span>&nbsp;<span class="ident" id="7828908">err</span><span class="op" id="7828911">,</span>&nbsp;<span class="ident" id="7828913">expectedSubStr</span><span class="op" id="7828927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7828930">}</span><br>
<span class="lineno"></span><span class="op" id="7828932">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7828935">func</span>&nbsp;<span class="ident" id="7828940">TestSimpleError</span><span class="op" id="7828955">(</span><span class="ident" id="7828956">t</span>&nbsp;<span class="op" id="7828958">*</span><span class="ident" id="7828959">testing</span><span class="op" id="7828966">.</span><span class="ident" id="7828967">T</span><span class="op" id="7828968">)</span>&nbsp;<span class="op" id="7828970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7828973">testClientHelloFailure</span><span class="op" id="7828995">(</span><span class="ident" id="7828996">t</span><span class="op" id="7828997">,</span>&nbsp;<span class="op" id="7828999">&amp;</span><span class="ident" id="7829000">serverHelloDoneMsg</span><span class="op" id="7829018">{</span><span class="op" id="7829019">}</span><span class="op" id="7829020">,</span>&nbsp;<span class="string" id="7829022">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="7829052">)</span><br>
<span class="lineno"></span><span class="op" id="7829054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7829057">var</span>&nbsp;<span class="ident" id="7829061">badProtocolVersions</span>&nbsp;<span class="op" id="7829081">=</span>&nbsp;<span class="op" id="7829083">[</span><span class="op" id="7829084">]</span><span class="builtintype" id="7829085">uint16</span><span class="op" id="7829091">{</span><span class="num" id="7829092">0x0000</span><span class="op" id="7829098">,</span>&nbsp;<span class="num" id="7829100">0x0005</span><span class="op" id="7829106">,</span>&nbsp;<span class="num" id="7829108">0x0100</span><span class="op" id="7829114">,</span>&nbsp;<span class="num" id="7829116">0x0105</span><span class="op" id="7829122">,</span>&nbsp;<span class="num" id="7829124">0x0200</span><span class="op" id="7829130">,</span>&nbsp;<span class="num" id="7829132">0x0205</span><span class="op" id="7829138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7829141">func</span>&nbsp;<span class="ident" id="7829146">TestRejectBadProtocolVersion</span><span class="op" id="7829174">(</span><span class="ident" id="7829175">t</span>&nbsp;<span class="op" id="7829177">*</span><span class="ident" id="7829178">testing</span><span class="op" id="7829185">.</span><span class="ident" id="7829186">T</span><span class="op" id="7829187">)</span>&nbsp;<span class="op" id="7829189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7829192">for</span>&nbsp;<span class="ident" id="7829196">_</span><span class="op" id="7829197">,</span>&nbsp;<span class="ident" id="7829199">v</span>&nbsp;<span class="op" id="7829201">:=</span>&nbsp;<span class="keyword" id="7829204">range</span>&nbsp;<span class="ident" id="7829210">badProtocolVersions</span>&nbsp;<span class="op" id="7829230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829234">testClientHelloFailure</span><span class="op" id="7829256">(</span><span class="ident" id="7829257">t</span><span class="op" id="7829258">,</span>&nbsp;<span class="op" id="7829260">&amp;</span><span class="ident" id="7829261">clientHelloMsg</span><span class="op" id="7829275">{</span><span class="ident" id="7829276">vers</span><span class="op" id="7829280">:</span>&nbsp;<span class="ident" id="7829282">v</span><span class="op" id="7829283">}</span><span class="op" id="7829284">,</span>&nbsp;<span class="string" id="7829286">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="7829325">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7829328">}</span><br>
<span class="lineno"></span><span class="op" id="7829330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7829333">func</span>&nbsp;<span class="ident" id="7829338">TestNoSuiteOverlap</span><span class="op" id="7829356">(</span><span class="ident" id="7829357">t</span>&nbsp;<span class="op" id="7829359">*</span><span class="ident" id="7829360">testing</span><span class="op" id="7829367">.</span><span class="ident" id="7829368">T</span><span class="op" id="7829369">)</span>&nbsp;<span class="op" id="7829371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829374">clientHello</span>&nbsp;<span class="op" id="7829386">:=</span>&nbsp;<span class="op" id="7829389">&amp;</span><span class="ident" id="7829390">clientHelloMsg</span><span class="op" id="7829404">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829408">vers</span><span class="op" id="7829412">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7829428">0x0301</span><span class="op" id="7829434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829438">cipherSuites</span><span class="op" id="7829450">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7829458">[</span><span class="op" id="7829459">]</span><span class="builtintype" id="7829460">uint16</span><span class="op" id="7829466">{</span><span class="num" id="7829467">0xff00</span><span class="op" id="7829473">}</span><span class="op" id="7829474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829478">compressionMethods</span><span class="op" id="7829496">:</span>&nbsp;<span class="op" id="7829498">[</span><span class="op" id="7829499">]</span><span class="builtintype" id="7829500">uint8</span><span class="op" id="7829505">{</span><span class="num" id="7829506">0</span><span class="op" id="7829507">}</span><span class="op" id="7829508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7829511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829514">testClientHelloFailure</span><span class="op" id="7829536">(</span><span class="ident" id="7829537">t</span><span class="op" id="7829538">,</span>&nbsp;<span class="ident" id="7829540">clientHello</span><span class="op" id="7829551">,</span>&nbsp;<span class="string" id="7829553">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="7829606">)</span><br>
<span class="lineno">95</span><span class="op" id="7829608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7829611">func</span>&nbsp;<span class="ident" id="7829616">TestNoCompressionOverlap</span><span class="op" id="7829640">(</span><span class="ident" id="7829641">t</span>&nbsp;<span class="op" id="7829643">*</span><span class="ident" id="7829644">testing</span><span class="op" id="7829651">.</span><span class="ident" id="7829652">T</span><span class="op" id="7829653">)</span>&nbsp;<span class="op" id="7829655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829658">clientHello</span>&nbsp;<span class="op" id="7829670">:=</span>&nbsp;<span class="op" id="7829673">&amp;</span><span class="ident" id="7829674">clientHelloMsg</span><span class="op" id="7829688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829692">vers</span><span class="op" id="7829696">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7829712">0x0301</span><span class="op" id="7829718">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829722">cipherSuites</span><span class="op" id="7829734">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7829742">[</span><span class="op" id="7829743">]</span><span class="builtintype" id="7829744">uint16</span><span class="op" id="7829750">{</span><span class="ident" id="7829751">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7829775">}</span><span class="op" id="7829776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829780">compressionMethods</span><span class="op" id="7829798">:</span>&nbsp;<span class="op" id="7829800">[</span><span class="op" id="7829801">]</span><span class="builtintype" id="7829802">uint8</span><span class="op" id="7829807">{</span><span class="num" id="7829808">0xff</span><span class="op" id="7829812">}</span><span class="op" id="7829813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7829816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7829819">testClientHelloFailure</span><span class="op" id="7829841">(</span><span class="ident" id="7829842">t</span><span class="op" id="7829843">,</span>&nbsp;<span class="ident" id="7829845">clientHello</span><span class="op" id="7829856">,</span>&nbsp;<span class="string" id="7829858">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="7829908">)</span><br>
<span class="lineno"></span><span class="op" id="7829910">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7829913">func</span>&nbsp;<span class="ident" id="7829918">TestTLS12OnlyCipherSuites</span><span class="op" id="7829943">(</span><span class="ident" id="7829944">t</span>&nbsp;<span class="op" id="7829946">*</span><span class="ident" id="7829947">testing</span><span class="op" id="7829954">.</span><span class="ident" id="7829955">T</span><span class="op" id="7829956">)</span>&nbsp;<span class="op" id="7829958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7829961">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830032">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830067">var</span>&nbsp;<span class="ident" id="7830071">zeros</span>&nbsp;<span class="op" id="7830077">[</span><span class="num" id="7830078">32</span><span class="op" id="7830080">]</span><span class="builtintype" id="7830081">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830088">clientHello</span>&nbsp;<span class="op" id="7830100">:=</span>&nbsp;<span class="op" id="7830103">&amp;</span><span class="ident" id="7830104">clientHelloMsg</span><span class="op" id="7830118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830122">vers</span><span class="op" id="7830126">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7830130">VersionTLS11</span><span class="op" id="7830142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830146">random</span><span class="op" id="7830152">:</span>&nbsp;<span class="ident" id="7830154">zeros</span><span class="op" id="7830159">[</span><span class="op" id="7830160">:</span><span class="op" id="7830161">]</span><span class="op" id="7830162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830166">cipherSuites</span><span class="op" id="7830178">:</span>&nbsp;<span class="op" id="7830180">[</span><span class="op" id="7830181">]</span><span class="builtintype" id="7830182">uint16</span><span class="op" id="7830188">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830193">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830245">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830293">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7830345">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830387">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="7830424">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830429">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7830453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830457">}</span><span class="op" id="7830458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830462">compressionMethods</span><span class="op" id="7830480">:</span>&nbsp;<span class="op" id="7830482">[</span><span class="op" id="7830483">]</span><span class="builtintype" id="7830484">uint8</span><span class="op" id="7830489">{</span><span class="ident" id="7830490">compressionNone</span><span class="op" id="7830505">}</span><span class="op" id="7830506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830510">supportedCurves</span><span class="op" id="7830525">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7830530">[</span><span class="op" id="7830531">]</span><span class="ident" id="7830532">CurveID</span><span class="op" id="7830539">{</span><span class="ident" id="7830540">CurveP256</span><span class="op" id="7830549">,</span>&nbsp;<span class="ident" id="7830551">CurveP384</span><span class="op" id="7830560">,</span>&nbsp;<span class="ident" id="7830562">CurveP521</span><span class="op" id="7830571">}</span><span class="op" id="7830572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830576">supportedPoints</span><span class="op" id="7830591">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7830596">[</span><span class="op" id="7830597">]</span><span class="builtintype" id="7830598">uint8</span><span class="op" id="7830603">{</span><span class="ident" id="7830604">pointFormatUncompressed</span><span class="op" id="7830627">}</span><span class="op" id="7830628">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830635">c</span><span class="op" id="7830636">,</span>&nbsp;<span class="ident" id="7830638">s</span>&nbsp;<span class="op" id="7830640">:=</span>&nbsp;<span class="ident" id="7830643">net</span><span class="op" id="7830646">.</span><span class="ident" id="7830647">Pipe</span><span class="op" id="7830651">(</span><span class="op" id="7830652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830655">var</span>&nbsp;<span class="ident" id="7830659">reply</span>&nbsp;<span class="keyword" id="7830665">interface</span><span class="op" id="7830674">{</span><span class="op" id="7830675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830678">var</span>&nbsp;<span class="ident" id="7830682">clientErr</span>&nbsp;<span class="builtintype" id="7830692">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7830699">go</span>&nbsp;<span class="keyword" id="7830702">func</span><span class="op" id="7830706">(</span><span class="op" id="7830707">)</span>&nbsp;<span class="op" id="7830709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830713">cli</span>&nbsp;<span class="op" id="7830717">:=</span>&nbsp;<span class="ident" id="7830720">Client</span><span class="op" id="7830726">(</span><span class="ident" id="7830727">c</span><span class="op" id="7830728">,</span>&nbsp;<span class="ident" id="7830730">testConfig</span><span class="op" id="7830740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830744">cli</span><span class="op" id="7830747">.</span><span class="ident" id="7830748">vers</span>&nbsp;<span class="op" id="7830753">=</span>&nbsp;<span class="ident" id="7830755">clientHello</span><span class="op" id="7830766">.</span><span class="ident" id="7830767">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830774">cli</span><span class="op" id="7830777">.</span><span class="ident" id="7830778">writeRecord</span><span class="op" id="7830789">(</span><span class="ident" id="7830790">recordTypeHandshake</span><span class="op" id="7830809">,</span>&nbsp;<span class="ident" id="7830811">clientHello</span><span class="op" id="7830822">.</span><span class="ident" id="7830823">marshal</span><span class="op" id="7830830">(</span><span class="op" id="7830831">)</span><span class="op" id="7830832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830836">reply</span><span class="op" id="7830841">,</span>&nbsp;<span class="ident" id="7830843">clientErr</span>&nbsp;<span class="op" id="7830853">=</span>&nbsp;<span class="ident" id="7830855">cli</span><span class="op" id="7830858">.</span><span class="ident" id="7830859">readHandshake</span><span class="op" id="7830872">(</span><span class="op" id="7830873">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830877">c</span><span class="op" id="7830878">.</span><span class="ident" id="7830879">Close</span><span class="op" id="7830884">(</span><span class="op" id="7830885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7830888">}</span><span class="op" id="7830889">(</span><span class="op" id="7830890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830893">config</span>&nbsp;<span class="op" id="7830900">:=</span>&nbsp;<span class="op" id="7830903">*</span><span class="ident" id="7830904">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830916">config</span><span class="op" id="7830922">.</span><span class="ident" id="7830923">CipherSuites</span>&nbsp;<span class="op" id="7830936">=</span>&nbsp;<span class="ident" id="7830938">clientHello</span><span class="op" id="7830949">.</span><span class="ident" id="7830950">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830964">Server</span><span class="op" id="7830970">(</span><span class="ident" id="7830971">s</span><span class="op" id="7830972">,</span>&nbsp;<span class="op" id="7830974">&amp;</span><span class="ident" id="7830975">config</span><span class="op" id="7830981">)</span><span class="op" id="7830982">.</span><span class="ident" id="7830983">Handshake</span><span class="op" id="7830992">(</span><span class="op" id="7830993">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7830996">s</span><span class="op" id="7830997">.</span><span class="ident" id="7830998">Close</span><span class="op" id="7831003">(</span><span class="op" id="7831004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7831007">if</span>&nbsp;<span class="ident" id="7831010">clientErr</span>&nbsp;<span class="op" id="7831020">!=</span>&nbsp;<span class="ident" id="7831023">nil</span>&nbsp;<span class="op" id="7831027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831031">t</span><span class="op" id="7831032">.</span><span class="ident" id="7831033">Fatal</span><span class="op" id="7831038">(</span><span class="ident" id="7831039">clientErr</span><span class="op" id="7831048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831054">serverHello</span><span class="op" id="7831065">,</span>&nbsp;<span class="ident" id="7831067">ok</span>&nbsp;<span class="op" id="7831070">:=</span>&nbsp;<span class="ident" id="7831073">reply</span><span class="op" id="7831078">.</span><span class="op" id="7831079">(</span><span class="op" id="7831080">*</span><span class="ident" id="7831081">serverHelloMsg</span><span class="op" id="7831095">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7831098">if</span>&nbsp;<span class="op" id="7831101">!</span><span class="ident" id="7831102">ok</span>&nbsp;<span class="op" id="7831105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831109">t</span><span class="op" id="7831110">.</span><span class="ident" id="7831111">Fatalf</span><span class="op" id="7831117">(</span><span class="string" id="7831118">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="7831169">,</span>&nbsp;<span class="ident" id="7831171">reply</span><span class="op" id="7831176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7831182">if</span>&nbsp;<span class="ident" id="7831185">s</span>&nbsp;<span class="op" id="7831187">:=</span>&nbsp;<span class="ident" id="7831190">serverHello</span><span class="op" id="7831201">.</span><span class="ident" id="7831202">cipherSuite</span><span class="op" id="7831213">;</span>&nbsp;<span class="ident" id="7831215">s</span>&nbsp;<span class="op" id="7831217">!=</span>&nbsp;<span class="ident" id="7831220">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7831245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831249">t</span><span class="op" id="7831250">.</span><span class="ident" id="7831251">Fatalf</span><span class="op" id="7831257">(</span><span class="string" id="7831258">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="7831292">,</span>&nbsp;<span class="ident" id="7831294">s</span><span class="op" id="7831295">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831298">}</span><br>
<span class="lineno"></span><span class="op" id="7831300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7831303">func</span>&nbsp;<span class="ident" id="7831308">TestAlertForwarding</span><span class="op" id="7831327">(</span><span class="ident" id="7831328">t</span>&nbsp;<span class="op" id="7831330">*</span><span class="ident" id="7831331">testing</span><span class="op" id="7831338">.</span><span class="ident" id="7831339">T</span><span class="op" id="7831340">)</span>&nbsp;<span class="op" id="7831342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831345">c</span><span class="op" id="7831346">,</span>&nbsp;<span class="ident" id="7831348">s</span>&nbsp;<span class="op" id="7831350">:=</span>&nbsp;<span class="ident" id="7831353">net</span><span class="op" id="7831356">.</span><span class="ident" id="7831357">Pipe</span><span class="op" id="7831361">(</span><span class="op" id="7831362">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7831365">go</span>&nbsp;<span class="keyword" id="7831368">func</span><span class="op" id="7831372">(</span><span class="op" id="7831373">)</span>&nbsp;<span class="op" id="7831375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831379">Client</span><span class="op" id="7831385">(</span><span class="ident" id="7831386">c</span><span class="op" id="7831387">,</span>&nbsp;<span class="ident" id="7831389">testConfig</span><span class="op" id="7831399">)</span><span class="op" id="7831400">.</span><span class="ident" id="7831401">sendAlert</span><span class="op" id="7831410">(</span><span class="ident" id="7831411">alertUnknownCA</span><span class="op" id="7831425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831429">c</span><span class="op" id="7831430">.</span><span class="ident" id="7831431">Close</span><span class="op" id="7831436">(</span><span class="op" id="7831437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831440">}</span><span class="op" id="7831441">(</span><span class="op" id="7831442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831446">err</span>&nbsp;<span class="op" id="7831450">:=</span>&nbsp;<span class="ident" id="7831453">Server</span><span class="op" id="7831459">(</span><span class="ident" id="7831460">s</span><span class="op" id="7831461">,</span>&nbsp;<span class="ident" id="7831463">testConfig</span><span class="op" id="7831473">)</span><span class="op" id="7831474">.</span><span class="ident" id="7831475">Handshake</span><span class="op" id="7831484">(</span><span class="op" id="7831485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831488">s</span><span class="op" id="7831489">.</span><span class="ident" id="7831490">Close</span><span class="op" id="7831495">(</span><span class="op" id="7831496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7831499">if</span>&nbsp;<span class="ident" id="7831502">e</span><span class="op" id="7831503">,</span>&nbsp;<span class="ident" id="7831505">ok</span>&nbsp;<span class="op" id="7831508">:=</span>&nbsp;<span class="ident" id="7831511">err</span><span class="op" id="7831514">.</span><span class="op" id="7831515">(</span><span class="op" id="7831516">*</span><span class="ident" id="7831517">net</span><span class="op" id="7831520">.</span><span class="ident" id="7831521">OpError</span><span class="op" id="7831528">)</span><span class="op" id="7831529">;</span>&nbsp;<span class="op" id="7831531">!</span><span class="ident" id="7831532">ok</span>&nbsp;<span class="op" id="7831535">||</span>&nbsp;<span class="ident" id="7831538">e</span><span class="op" id="7831539">.</span><span class="ident" id="7831540">Err</span>&nbsp;<span class="op" id="7831544">!=</span>&nbsp;<span class="builtintype" id="7831547">error</span><span class="op" id="7831552">(</span><span class="ident" id="7831553">alertUnknownCA</span><span class="op" id="7831567">)</span>&nbsp;<span class="op" id="7831569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831573">t</span><span class="op" id="7831574">.</span><span class="ident" id="7831575">Errorf</span><span class="op" id="7831581">(</span><span class="string" id="7831582">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7831611">,</span>&nbsp;<span class="ident" id="7831613">err</span><span class="op" id="7831616">,</span>&nbsp;<span class="builtintype" id="7831618">error</span><span class="op" id="7831623">(</span><span class="ident" id="7831624">alertUnknownCA</span><span class="op" id="7831638">)</span><span class="op" id="7831639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831642">}</span><br>
<span class="lineno">165</span><span class="op" id="7831644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7831647">func</span>&nbsp;<span class="ident" id="7831652">TestClose</span><span class="op" id="7831661">(</span><span class="ident" id="7831662">t</span>&nbsp;<span class="op" id="7831664">*</span><span class="ident" id="7831665">testing</span><span class="op" id="7831672">.</span><span class="ident" id="7831673">T</span><span class="op" id="7831674">)</span>&nbsp;<span class="op" id="7831676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831679">c</span><span class="op" id="7831680">,</span>&nbsp;<span class="ident" id="7831682">s</span>&nbsp;<span class="op" id="7831684">:=</span>&nbsp;<span class="ident" id="7831687">net</span><span class="op" id="7831690">.</span><span class="ident" id="7831691">Pipe</span><span class="op" id="7831695">(</span><span class="op" id="7831696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7831699">go</span>&nbsp;<span class="ident" id="7831702">c</span><span class="op" id="7831703">.</span><span class="ident" id="7831704">Close</span><span class="op" id="7831709">(</span><span class="op" id="7831710">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831714">err</span>&nbsp;<span class="op" id="7831718">:=</span>&nbsp;<span class="ident" id="7831721">Server</span><span class="op" id="7831727">(</span><span class="ident" id="7831728">s</span><span class="op" id="7831729">,</span>&nbsp;<span class="ident" id="7831731">testConfig</span><span class="op" id="7831741">)</span><span class="op" id="7831742">.</span><span class="ident" id="7831743">Handshake</span><span class="op" id="7831752">(</span><span class="op" id="7831753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831756">s</span><span class="op" id="7831757">.</span><span class="ident" id="7831758">Close</span><span class="op" id="7831763">(</span><span class="op" id="7831764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7831767">if</span>&nbsp;<span class="ident" id="7831770">err</span>&nbsp;<span class="op" id="7831774">!=</span>&nbsp;<span class="ident" id="7831777">io</span><span class="op" id="7831779">.</span><span class="ident" id="7831780">EOF</span>&nbsp;<span class="op" id="7831784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831788">t</span><span class="op" id="7831789">.</span><span class="ident" id="7831790">Errorf</span><span class="op" id="7831796">(</span><span class="string" id="7831797">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7831826">,</span>&nbsp;<span class="ident" id="7831828">err</span><span class="op" id="7831831">,</span>&nbsp;<span class="ident" id="7831833">io</span><span class="op" id="7831835">.</span><span class="ident" id="7831836">EOF</span><span class="op" id="7831839">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7831842">}</span><br>
<span class="lineno"></span><span class="op" id="7831844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7831847">func</span>&nbsp;<span class="ident" id="7831852">testHandshake</span><span class="op" id="7831865">(</span><span class="ident" id="7831866">clientConfig</span><span class="op" id="7831878">,</span>&nbsp;<span class="ident" id="7831880">serverConfig</span>&nbsp;<span class="op" id="7831893">*</span><span class="ident" id="7831894">Config</span><span class="op" id="7831900">)</span>&nbsp;<span class="op" id="7831902">(</span><span class="ident" id="7831903">state</span>&nbsp;<span class="ident" id="7831909">ConnectionState</span><span class="op" id="7831924">,</span>&nbsp;<span class="ident" id="7831926">err</span>&nbsp;<span class="builtintype" id="7831930">error</span><span class="op" id="7831935">)</span>&nbsp;<span class="op" id="7831937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831940">c</span><span class="op" id="7831941">,</span>&nbsp;<span class="ident" id="7831943">s</span>&nbsp;<span class="op" id="7831945">:=</span>&nbsp;<span class="ident" id="7831948">net</span><span class="op" id="7831951">.</span><span class="ident" id="7831952">Pipe</span><span class="op" id="7831956">(</span><span class="op" id="7831957">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831960">done</span>&nbsp;<span class="op" id="7831965">:=</span>&nbsp;<span class="builtinfunc" id="7831968">make</span><span class="op" id="7831972">(</span><span class="keyword" id="7831973">chan</span>&nbsp;<span class="builtintype" id="7831978">bool</span><span class="op" id="7831982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7831985">go</span>&nbsp;<span class="keyword" id="7831988">func</span><span class="op" id="7831992">(</span><span class="op" id="7831993">)</span>&nbsp;<span class="op" id="7831995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7831999">cli</span>&nbsp;<span class="op" id="7832003">:=</span>&nbsp;<span class="ident" id="7832006">Client</span><span class="op" id="7832012">(</span><span class="ident" id="7832013">c</span><span class="op" id="7832014">,</span>&nbsp;<span class="ident" id="7832016">clientConfig</span><span class="op" id="7832028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832032">cli</span><span class="op" id="7832035">.</span><span class="ident" id="7832036">Handshake</span><span class="op" id="7832045">(</span><span class="op" id="7832046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832050">c</span><span class="op" id="7832051">.</span><span class="ident" id="7832052">Close</span><span class="op" id="7832057">(</span><span class="op" id="7832058">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832062">done</span>&nbsp;<span class="op" id="7832067">&lt;-</span>&nbsp;<span class="ident" id="7832070">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832076">}</span><span class="op" id="7832077">(</span><span class="op" id="7832078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832081">server</span>&nbsp;<span class="op" id="7832088">:=</span>&nbsp;<span class="ident" id="7832091">Server</span><span class="op" id="7832097">(</span><span class="ident" id="7832098">s</span><span class="op" id="7832099">,</span>&nbsp;<span class="ident" id="7832101">serverConfig</span><span class="op" id="7832113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832116">err</span>&nbsp;<span class="op" id="7832120">=</span>&nbsp;<span class="ident" id="7832122">server</span><span class="op" id="7832128">.</span><span class="ident" id="7832129">Handshake</span><span class="op" id="7832138">(</span><span class="op" id="7832139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7832142">if</span>&nbsp;<span class="ident" id="7832145">err</span>&nbsp;<span class="op" id="7832149">==</span>&nbsp;<span class="ident" id="7832152">nil</span>&nbsp;<span class="op" id="7832156">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832160">state</span>&nbsp;<span class="op" id="7832166">=</span>&nbsp;<span class="ident" id="7832168">server</span><span class="op" id="7832174">.</span><span class="ident" id="7832175">ConnectionState</span><span class="op" id="7832190">(</span><span class="op" id="7832191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832197">s</span><span class="op" id="7832198">.</span><span class="ident" id="7832199">Close</span><span class="op" id="7832204">(</span><span class="op" id="7832205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832208">&lt;-</span><span class="ident" id="7832210">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7832216">return</span><br>
<span class="lineno">195</span><span class="op" id="7832223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7832226">func</span>&nbsp;<span class="ident" id="7832231">TestVersion</span><span class="op" id="7832242">(</span><span class="ident" id="7832243">t</span>&nbsp;<span class="op" id="7832245">*</span><span class="ident" id="7832246">testing</span><span class="op" id="7832253">.</span><span class="ident" id="7832254">T</span><span class="op" id="7832255">)</span>&nbsp;<span class="op" id="7832257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832260">serverConfig</span>&nbsp;<span class="op" id="7832273">:=</span>&nbsp;<span class="op" id="7832276">&amp;</span><span class="ident" id="7832277">Config</span><span class="op" id="7832283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832287">Certificates</span><span class="op" id="7832299">:</span>&nbsp;<span class="ident" id="7832301">testConfig</span><span class="op" id="7832311">.</span><span class="ident" id="7832312">Certificates</span><span class="op" id="7832324">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832328">MaxVersion</span><span class="op" id="7832338">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7832342">VersionTLS11</span><span class="op" id="7832354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832360">clientConfig</span>&nbsp;<span class="op" id="7832373">:=</span>&nbsp;<span class="op" id="7832376">&amp;</span><span class="ident" id="7832377">Config</span><span class="op" id="7832383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832387">InsecureSkipVerify</span><span class="op" id="7832405">:</span>&nbsp;<span class="ident" id="7832407">true</span><span class="op" id="7832411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832414">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832417">state</span><span class="op" id="7832422">,</span>&nbsp;<span class="ident" id="7832424">err</span>&nbsp;<span class="op" id="7832428">:=</span>&nbsp;<span class="ident" id="7832431">testHandshake</span><span class="op" id="7832444">(</span><span class="ident" id="7832445">clientConfig</span><span class="op" id="7832457">,</span>&nbsp;<span class="ident" id="7832459">serverConfig</span><span class="op" id="7832471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7832474">if</span>&nbsp;<span class="ident" id="7832477">err</span>&nbsp;<span class="op" id="7832481">!=</span>&nbsp;<span class="ident" id="7832484">nil</span>&nbsp;<span class="op" id="7832488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832492">t</span><span class="op" id="7832493">.</span><span class="ident" id="7832494">Fatalf</span><span class="op" id="7832500">(</span><span class="string" id="7832501">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7832523">,</span>&nbsp;<span class="ident" id="7832525">err</span><span class="op" id="7832528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7832534">if</span>&nbsp;<span class="ident" id="7832537">state</span><span class="op" id="7832542">.</span><span class="ident" id="7832543">Version</span>&nbsp;<span class="op" id="7832551">!=</span>&nbsp;<span class="ident" id="7832554">VersionTLS11</span>&nbsp;<span class="op" id="7832567">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832571">t</span><span class="op" id="7832572">.</span><span class="ident" id="7832573">Fatalf</span><span class="op" id="7832579">(</span><span class="string" id="7832580">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="7832616">,</span>&nbsp;<span class="ident" id="7832618">state</span><span class="op" id="7832623">.</span><span class="ident" id="7832624">Version</span><span class="op" id="7832631">,</span>&nbsp;<span class="ident" id="7832633">VersionTLS11</span><span class="op" id="7832645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832648">}</span><br>
<span class="lineno"></span><span class="op" id="7832650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7832653">func</span>&nbsp;<span class="ident" id="7832658">TestCipherSuitePreference</span><span class="op" id="7832683">(</span><span class="ident" id="7832684">t</span>&nbsp;<span class="op" id="7832686">*</span><span class="ident" id="7832687">testing</span><span class="op" id="7832694">.</span><span class="ident" id="7832695">T</span><span class="op" id="7832696">)</span>&nbsp;<span class="op" id="7832698">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832701">serverConfig</span>&nbsp;<span class="op" id="7832714">:=</span>&nbsp;<span class="op" id="7832717">&amp;</span><span class="ident" id="7832718">Config</span><span class="op" id="7832724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832728">CipherSuites</span><span class="op" id="7832740">:</span>&nbsp;<span class="op" id="7832742">[</span><span class="op" id="7832743">]</span><span class="builtintype" id="7832744">uint16</span><span class="op" id="7832750">{</span><span class="ident" id="7832751">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7832775">,</span>&nbsp;<span class="ident" id="7832777">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7832805">,</span>&nbsp;<span class="ident" id="7832807">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7832837">}</span><span class="op" id="7832838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832842">Certificates</span><span class="op" id="7832854">:</span>&nbsp;<span class="ident" id="7832856">testConfig</span><span class="op" id="7832866">.</span><span class="ident" id="7832867">Certificates</span><span class="op" id="7832879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832883">MaxVersion</span><span class="op" id="7832893">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7832897">VersionTLS11</span><span class="op" id="7832909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7832912">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832915">clientConfig</span>&nbsp;<span class="op" id="7832928">:=</span>&nbsp;<span class="op" id="7832931">&amp;</span><span class="ident" id="7832932">Config</span><span class="op" id="7832938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7832942">CipherSuites</span><span class="op" id="7832954">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7832962">[</span><span class="op" id="7832963">]</span><span class="builtintype" id="7832964">uint16</span><span class="op" id="7832970">{</span><span class="ident" id="7832971">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7832999">,</span>&nbsp;<span class="ident" id="7833001">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7833025">}</span><span class="op" id="7833026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833030">InsecureSkipVerify</span><span class="op" id="7833048">:</span>&nbsp;<span class="ident" id="7833050">true</span><span class="op" id="7833054">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833060">state</span><span class="op" id="7833065">,</span>&nbsp;<span class="ident" id="7833067">err</span>&nbsp;<span class="op" id="7833071">:=</span>&nbsp;<span class="ident" id="7833074">testHandshake</span><span class="op" id="7833087">(</span><span class="ident" id="7833088">clientConfig</span><span class="op" id="7833100">,</span>&nbsp;<span class="ident" id="7833102">serverConfig</span><span class="op" id="7833114">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833117">if</span>&nbsp;<span class="ident" id="7833120">err</span>&nbsp;<span class="op" id="7833124">!=</span>&nbsp;<span class="ident" id="7833127">nil</span>&nbsp;<span class="op" id="7833131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833135">t</span><span class="op" id="7833136">.</span><span class="ident" id="7833137">Fatalf</span><span class="op" id="7833143">(</span><span class="string" id="7833144">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7833166">,</span>&nbsp;<span class="ident" id="7833168">err</span><span class="op" id="7833171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833177">if</span>&nbsp;<span class="ident" id="7833180">state</span><span class="op" id="7833185">.</span><span class="ident" id="7833186">CipherSuite</span>&nbsp;<span class="op" id="7833198">!=</span>&nbsp;<span class="ident" id="7833201">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="7833230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7833234">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833297">t</span><span class="op" id="7833298">.</span><span class="ident" id="7833299">Fatalf</span><span class="op" id="7833305">(</span><span class="string" id="7833306">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7833348">,</span>&nbsp;<span class="ident" id="7833350">state</span><span class="op" id="7833355">.</span><span class="ident" id="7833356">CipherSuite</span><span class="op" id="7833367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833374">serverConfig</span><span class="op" id="7833386">.</span><span class="ident" id="7833387">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7833412">=</span>&nbsp;<span class="ident" id="7833414">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833420">state</span><span class="op" id="7833425">,</span>&nbsp;<span class="ident" id="7833427">err</span>&nbsp;<span class="op" id="7833431">=</span>&nbsp;<span class="ident" id="7833433">testHandshake</span><span class="op" id="7833446">(</span><span class="ident" id="7833447">clientConfig</span><span class="op" id="7833459">,</span>&nbsp;<span class="ident" id="7833461">serverConfig</span><span class="op" id="7833473">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833476">if</span>&nbsp;<span class="ident" id="7833479">err</span>&nbsp;<span class="op" id="7833483">!=</span>&nbsp;<span class="ident" id="7833486">nil</span>&nbsp;<span class="op" id="7833490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833494">t</span><span class="op" id="7833495">.</span><span class="ident" id="7833496">Fatalf</span><span class="op" id="7833502">(</span><span class="string" id="7833503">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7833525">,</span>&nbsp;<span class="ident" id="7833527">err</span><span class="op" id="7833530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7833536">if</span>&nbsp;<span class="ident" id="7833539">state</span><span class="op" id="7833544">.</span><span class="ident" id="7833545">CipherSuite</span>&nbsp;<span class="op" id="7833557">!=</span>&nbsp;<span class="ident" id="7833560">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7833585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833589">t</span><span class="op" id="7833590">.</span><span class="ident" id="7833591">Fatalf</span><span class="op" id="7833597">(</span><span class="string" id="7833598">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7833640">,</span>&nbsp;<span class="ident" id="7833642">state</span><span class="op" id="7833647">.</span><span class="ident" id="7833648">CipherSuite</span><span class="op" id="7833659">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7833662">}</span><br>
<span class="lineno"></span><span class="op" id="7833664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7833667">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7833742">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7833758">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7833838">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7833857">type</span>&nbsp;<span class="ident" id="7833862">serverTest</span>&nbsp;<span class="keyword" id="7833873">struct</span>&nbsp;<span class="op" id="7833880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7833883">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7833956">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7833997">name</span>&nbsp;<span class="builtintype" id="7834002">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834010">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834076">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834121">command</span>&nbsp;<span class="op" id="7834129">[</span><span class="op" id="7834130">]</span><span class="builtintype" id="7834131">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834139">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834203">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834237">expectedPeerCerts</span>&nbsp;<span class="op" id="7834255">[</span><span class="op" id="7834256">]</span><span class="builtintype" id="7834257">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834265">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834336">config</span>&nbsp;<span class="op" id="7834343">*</span><span class="ident" id="7834344">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834352">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834426">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834464">expectAlert</span>&nbsp;<span class="builtintype" id="7834476">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834482">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834551">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834623">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="7834653">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834661">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834730">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7834803">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7834840">validate</span>&nbsp;<span class="keyword" id="7834849">func</span><span class="op" id="7834853">(</span><span class="ident" id="7834854">ConnectionState</span><span class="op" id="7834869">)</span>&nbsp;<span class="builtintype" id="7834871">error</span><br>
<span class="lineno">270</span><span class="op" id="7834877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7834880">var</span>&nbsp;<span class="ident" id="7834884">defaultClientCommand</span>&nbsp;<span class="op" id="7834905">=</span>&nbsp;<span class="op" id="7834907">[</span><span class="op" id="7834908">]</span><span class="builtintype" id="7834909">string</span><span class="op" id="7834915">{</span><span class="string" id="7834916">&#34;openssl&#34;</span><span class="op" id="7834925">,</span>&nbsp;<span class="string" id="7834927">&#34;s_client&#34;</span><span class="op" id="7834937">,</span>&nbsp;<span class="string" id="7834939">&#34;-no_ticket&#34;</span><span class="op" id="7834951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7834954">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="7835030">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7835110">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="7835125">func</span>&nbsp;<span class="op" id="7835130">(</span><span class="ident" id="7835131">test</span>&nbsp;<span class="op" id="7835136">*</span><span class="ident" id="7835137">serverTest</span><span class="op" id="7835147">)</span>&nbsp;<span class="ident" id="7835149">connFromCommand</span><span class="op" id="7835164">(</span><span class="op" id="7835165">)</span>&nbsp;<span class="op" id="7835167">(</span><span class="ident" id="7835168">conn</span>&nbsp;<span class="op" id="7835173">*</span><span class="ident" id="7835174">recordingConn</span><span class="op" id="7835187">,</span>&nbsp;<span class="ident" id="7835189">child</span>&nbsp;<span class="op" id="7835195">*</span><span class="ident" id="7835196">exec</span><span class="op" id="7835200">.</span><span class="ident" id="7835201">Cmd</span><span class="op" id="7835204">,</span>&nbsp;<span class="ident" id="7835206">err</span>&nbsp;<span class="builtintype" id="7835210">error</span><span class="op" id="7835215">)</span>&nbsp;<span class="op" id="7835217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835220">l</span><span class="op" id="7835221">,</span>&nbsp;<span class="ident" id="7835223">err</span>&nbsp;<span class="op" id="7835227">:=</span>&nbsp;<span class="ident" id="7835230">net</span><span class="op" id="7835233">.</span><span class="ident" id="7835234">ListenTCP</span><span class="op" id="7835243">(</span><span class="string" id="7835244">&#34;tcp&#34;</span><span class="op" id="7835249">,</span>&nbsp;<span class="op" id="7835251">&amp;</span><span class="ident" id="7835252">net</span><span class="op" id="7835255">.</span><span class="ident" id="7835256">TCPAddr</span><span class="op" id="7835263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835267">IP</span><span class="op" id="7835269">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7835273">net</span><span class="op" id="7835276">.</span><span class="ident" id="7835277">IPv4</span><span class="op" id="7835281">(</span><span class="num" id="7835282">127</span><span class="op" id="7835285">,</span>&nbsp;<span class="num" id="7835287">0</span><span class="op" id="7835288">,</span>&nbsp;<span class="num" id="7835290">0</span><span class="op" id="7835291">,</span>&nbsp;<span class="num" id="7835293">1</span><span class="op" id="7835294">)</span><span class="op" id="7835295">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835299">Port</span><span class="op" id="7835303">:</span>&nbsp;<span class="num" id="7835305">0</span><span class="op" id="7835306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835309">}</span><span class="op" id="7835310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835313">if</span>&nbsp;<span class="ident" id="7835316">err</span>&nbsp;<span class="op" id="7835320">!=</span>&nbsp;<span class="ident" id="7835323">nil</span>&nbsp;<span class="op" id="7835327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835331">return</span>&nbsp;<span class="ident" id="7835338">nil</span><span class="op" id="7835341">,</span>&nbsp;<span class="ident" id="7835343">nil</span><span class="op" id="7835346">,</span>&nbsp;<span class="ident" id="7835348">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835353">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835356">defer</span>&nbsp;<span class="ident" id="7835362">l</span><span class="op" id="7835363">.</span><span class="ident" id="7835364">Close</span><span class="op" id="7835369">(</span><span class="op" id="7835370">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835374">port</span>&nbsp;<span class="op" id="7835379">:=</span>&nbsp;<span class="ident" id="7835382">l</span><span class="op" id="7835383">.</span><span class="ident" id="7835384">Addr</span><span class="op" id="7835388">(</span><span class="op" id="7835389">)</span><span class="op" id="7835390">.</span><span class="op" id="7835391">(</span><span class="op" id="7835392">*</span><span class="ident" id="7835393">net</span><span class="op" id="7835396">.</span><span class="ident" id="7835397">TCPAddr</span><span class="op" id="7835404">)</span><span class="op" id="7835405">.</span><span class="ident" id="7835406">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835413">var</span>&nbsp;<span class="ident" id="7835417">command</span>&nbsp;<span class="op" id="7835425">[</span><span class="op" id="7835426">]</span><span class="builtintype" id="7835427">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835435">command</span>&nbsp;<span class="op" id="7835443">=</span>&nbsp;<span class="builtinfunc" id="7835445">append</span><span class="op" id="7835451">(</span><span class="ident" id="7835452">command</span><span class="op" id="7835459">,</span>&nbsp;<span class="ident" id="7835461">test</span><span class="op" id="7835465">.</span><span class="ident" id="7835466">command</span><span class="op" id="7835473">...</span><span class="op" id="7835476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835479">if</span>&nbsp;<span class="builtinfunc" id="7835482">len</span><span class="op" id="7835485">(</span><span class="ident" id="7835486">command</span><span class="op" id="7835493">)</span>&nbsp;<span class="op" id="7835495">==</span>&nbsp;<span class="num" id="7835498">0</span>&nbsp;<span class="op" id="7835500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835504">command</span>&nbsp;<span class="op" id="7835512">=</span>&nbsp;<span class="ident" id="7835514">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835539">command</span>&nbsp;<span class="op" id="7835547">=</span>&nbsp;<span class="builtinfunc" id="7835549">append</span><span class="op" id="7835555">(</span><span class="ident" id="7835556">command</span><span class="op" id="7835563">,</span>&nbsp;<span class="string" id="7835565">&#34;-connect&#34;</span><span class="op" id="7835575">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835578">command</span>&nbsp;<span class="op" id="7835586">=</span>&nbsp;<span class="builtinfunc" id="7835588">append</span><span class="op" id="7835594">(</span><span class="ident" id="7835595">command</span><span class="op" id="7835602">,</span>&nbsp;<span class="ident" id="7835604">fmt</span><span class="op" id="7835607">.</span><span class="ident" id="7835608">Sprintf</span><span class="op" id="7835615">(</span><span class="string" id="7835616">&#34;127.0.0.1:%d&#34;</span><span class="op" id="7835630">,</span>&nbsp;<span class="ident" id="7835632">port</span><span class="op" id="7835636">)</span><span class="op" id="7835637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835640">cmd</span>&nbsp;<span class="op" id="7835644">:=</span>&nbsp;<span class="ident" id="7835647">exec</span><span class="op" id="7835651">.</span><span class="ident" id="7835652">Command</span><span class="op" id="7835659">(</span><span class="ident" id="7835660">command</span><span class="op" id="7835667">[</span><span class="num" id="7835668">0</span><span class="op" id="7835669">]</span><span class="op" id="7835670">,</span>&nbsp;<span class="ident" id="7835672">command</span><span class="op" id="7835679">[</span><span class="num" id="7835680">1</span><span class="op" id="7835681">:</span><span class="op" id="7835682">]</span><span class="op" id="7835683">...</span><span class="op" id="7835686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835689">cmd</span><span class="op" id="7835692">.</span><span class="ident" id="7835693">Stdin</span>&nbsp;<span class="op" id="7835699">=</span>&nbsp;<span class="ident" id="7835701">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835706">var</span>&nbsp;<span class="ident" id="7835710">output</span>&nbsp;<span class="ident" id="7835717">bytes</span><span class="op" id="7835722">.</span><span class="ident" id="7835723">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835731">cmd</span><span class="op" id="7835734">.</span><span class="ident" id="7835735">Stdout</span>&nbsp;<span class="op" id="7835742">=</span>&nbsp;<span class="op" id="7835744">&amp;</span><span class="ident" id="7835745">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835753">cmd</span><span class="op" id="7835756">.</span><span class="ident" id="7835757">Stderr</span>&nbsp;<span class="op" id="7835764">=</span>&nbsp;<span class="op" id="7835766">&amp;</span><span class="ident" id="7835767">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835775">if</span>&nbsp;<span class="ident" id="7835778">err</span>&nbsp;<span class="op" id="7835782">:=</span>&nbsp;<span class="ident" id="7835785">cmd</span><span class="op" id="7835788">.</span><span class="ident" id="7835789">Start</span><span class="op" id="7835794">(</span><span class="op" id="7835795">)</span><span class="op" id="7835796">;</span>&nbsp;<span class="ident" id="7835798">err</span>&nbsp;<span class="op" id="7835802">!=</span>&nbsp;<span class="ident" id="7835805">nil</span>&nbsp;<span class="op" id="7835809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835813">return</span>&nbsp;<span class="ident" id="7835820">nil</span><span class="op" id="7835823">,</span>&nbsp;<span class="ident" id="7835825">nil</span><span class="op" id="7835828">,</span>&nbsp;<span class="ident" id="7835830">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835839">connChan</span>&nbsp;<span class="op" id="7835848">:=</span>&nbsp;<span class="builtinfunc" id="7835851">make</span><span class="op" id="7835855">(</span><span class="keyword" id="7835856">chan</span>&nbsp;<span class="keyword" id="7835861">interface</span><span class="op" id="7835870">{</span><span class="op" id="7835871">}</span><span class="op" id="7835872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835875">go</span>&nbsp;<span class="keyword" id="7835878">func</span><span class="op" id="7835882">(</span><span class="op" id="7835883">)</span>&nbsp;<span class="op" id="7835885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835889">tcpConn</span><span class="op" id="7835896">,</span>&nbsp;<span class="ident" id="7835898">err</span>&nbsp;<span class="op" id="7835902">:=</span>&nbsp;<span class="ident" id="7835905">l</span><span class="op" id="7835906">.</span><span class="ident" id="7835907">Accept</span><span class="op" id="7835913">(</span><span class="op" id="7835914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835918">if</span>&nbsp;<span class="ident" id="7835921">err</span>&nbsp;<span class="op" id="7835925">!=</span>&nbsp;<span class="ident" id="7835928">nil</span>&nbsp;<span class="op" id="7835932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835937">connChan</span>&nbsp;<span class="op" id="7835946">&lt;-</span>&nbsp;<span class="ident" id="7835949">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7835959">connChan</span>&nbsp;<span class="op" id="7835968">&lt;-</span>&nbsp;<span class="ident" id="7835971">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7835980">}</span><span class="op" id="7835981">(</span><span class="op" id="7835982">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7835986">var</span>&nbsp;<span class="ident" id="7835990">tcpConn</span>&nbsp;<span class="ident" id="7835998">net</span><span class="op" id="7836001">.</span><span class="ident" id="7836002">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836008">select</span>&nbsp;<span class="op" id="7836015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836018">case</span>&nbsp;<span class="ident" id="7836023">connOrError</span>&nbsp;<span class="op" id="7836035">:=</span>&nbsp;<span class="op" id="7836038">&lt;-</span><span class="ident" id="7836040">connChan</span><span class="op" id="7836048">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836052">if</span>&nbsp;<span class="ident" id="7836055">err</span><span class="op" id="7836058">,</span>&nbsp;<span class="ident" id="7836060">ok</span>&nbsp;<span class="op" id="7836063">:=</span>&nbsp;<span class="ident" id="7836066">connOrError</span><span class="op" id="7836077">.</span><span class="op" id="7836078">(</span><span class="builtintype" id="7836079">error</span><span class="op" id="7836084">)</span><span class="op" id="7836085">;</span>&nbsp;<span class="ident" id="7836087">ok</span>&nbsp;<span class="op" id="7836090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836095">return</span>&nbsp;<span class="ident" id="7836102">nil</span><span class="op" id="7836105">,</span>&nbsp;<span class="ident" id="7836107">nil</span><span class="op" id="7836110">,</span>&nbsp;<span class="ident" id="7836112">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836118">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836122">tcpConn</span>&nbsp;<span class="op" id="7836130">=</span>&nbsp;<span class="ident" id="7836132">connOrError</span><span class="op" id="7836143">.</span><span class="op" id="7836144">(</span><span class="ident" id="7836145">net</span><span class="op" id="7836148">.</span><span class="ident" id="7836149">Conn</span><span class="op" id="7836153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836156">case</span>&nbsp;<span class="op" id="7836161">&lt;-</span><span class="ident" id="7836163">time</span><span class="op" id="7836167">.</span><span class="ident" id="7836168">After</span><span class="op" id="7836173">(</span><span class="num" id="7836174">2</span>&nbsp;<span class="op" id="7836176">*</span>&nbsp;<span class="ident" id="7836178">time</span><span class="op" id="7836182">.</span><span class="ident" id="7836183">Second</span><span class="op" id="7836189">)</span><span class="op" id="7836190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836194">output</span><span class="op" id="7836200">.</span><span class="ident" id="7836201">WriteTo</span><span class="op" id="7836208">(</span><span class="ident" id="7836209">os</span><span class="op" id="7836211">.</span><span class="ident" id="7836212">Stdout</span><span class="op" id="7836218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836222">return</span>&nbsp;<span class="ident" id="7836229">nil</span><span class="op" id="7836232">,</span>&nbsp;<span class="ident" id="7836234">nil</span><span class="op" id="7836237">,</span>&nbsp;<span class="ident" id="7836239">errors</span><span class="op" id="7836245">.</span><span class="ident" id="7836246">New</span><span class="op" id="7836249">(</span><span class="string" id="7836250">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="7836303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836306">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836310">record</span>&nbsp;<span class="op" id="7836317">:=</span>&nbsp;<span class="op" id="7836320">&amp;</span><span class="ident" id="7836321">recordingConn</span><span class="op" id="7836334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836338">Conn</span><span class="op" id="7836342">:</span>&nbsp;<span class="ident" id="7836344">tcpConn</span><span class="op" id="7836351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836358">return</span>&nbsp;<span class="ident" id="7836365">record</span><span class="op" id="7836371">,</span>&nbsp;<span class="ident" id="7836373">cmd</span><span class="op" id="7836376">,</span>&nbsp;<span class="ident" id="7836378">nil</span><br>
<span class="lineno"></span><span class="op" id="7836382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7836385">func</span>&nbsp;<span class="op" id="7836390">(</span><span class="ident" id="7836391">test</span>&nbsp;<span class="op" id="7836396">*</span><span class="ident" id="7836397">serverTest</span><span class="op" id="7836407">)</span>&nbsp;<span class="ident" id="7836409">dataPath</span><span class="op" id="7836417">(</span><span class="op" id="7836418">)</span>&nbsp;<span class="builtintype" id="7836420">string</span>&nbsp;<span class="op" id="7836427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836430">return</span>&nbsp;<span class="ident" id="7836437">filepath</span><span class="op" id="7836445">.</span><span class="ident" id="7836446">Join</span><span class="op" id="7836450">(</span><span class="string" id="7836451">&#34;testdata&#34;</span><span class="op" id="7836461">,</span>&nbsp;<span class="string" id="7836463">&#34;Server-&#34;</span><span class="op" id="7836472">+</span><span class="ident" id="7836473">test</span><span class="op" id="7836477">.</span><span class="ident" id="7836478">name</span><span class="op" id="7836482">)</span><br>
<span class="lineno">335</span><span class="op" id="7836484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7836487">func</span>&nbsp;<span class="op" id="7836492">(</span><span class="ident" id="7836493">test</span>&nbsp;<span class="op" id="7836498">*</span><span class="ident" id="7836499">serverTest</span><span class="op" id="7836509">)</span>&nbsp;<span class="ident" id="7836511">loadData</span><span class="op" id="7836519">(</span><span class="op" id="7836520">)</span>&nbsp;<span class="op" id="7836522">(</span><span class="ident" id="7836523">flows</span>&nbsp;<span class="op" id="7836529">[</span><span class="op" id="7836530">]</span><span class="op" id="7836531">[</span><span class="op" id="7836532">]</span><span class="builtintype" id="7836533">byte</span><span class="op" id="7836537">,</span>&nbsp;<span class="ident" id="7836539">err</span>&nbsp;<span class="builtintype" id="7836543">error</span><span class="op" id="7836548">)</span>&nbsp;<span class="op" id="7836550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836553">in</span><span class="op" id="7836555">,</span>&nbsp;<span class="ident" id="7836557">err</span>&nbsp;<span class="op" id="7836561">:=</span>&nbsp;<span class="ident" id="7836564">os</span><span class="op" id="7836566">.</span><span class="ident" id="7836567">Open</span><span class="op" id="7836571">(</span><span class="ident" id="7836572">test</span><span class="op" id="7836576">.</span><span class="ident" id="7836577">dataPath</span><span class="op" id="7836585">(</span><span class="op" id="7836586">)</span><span class="op" id="7836587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836590">if</span>&nbsp;<span class="ident" id="7836593">err</span>&nbsp;<span class="op" id="7836597">!=</span>&nbsp;<span class="ident" id="7836600">nil</span>&nbsp;<span class="op" id="7836604">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836608">return</span>&nbsp;<span class="ident" id="7836615">nil</span><span class="op" id="7836618">,</span>&nbsp;<span class="ident" id="7836620">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836628">defer</span>&nbsp;<span class="ident" id="7836634">in</span><span class="op" id="7836636">.</span><span class="ident" id="7836637">Close</span><span class="op" id="7836642">(</span><span class="op" id="7836643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836646">return</span>&nbsp;<span class="ident" id="7836653">parseTestData</span><span class="op" id="7836666">(</span><span class="ident" id="7836667">in</span><span class="op" id="7836669">)</span><br>
<span class="lineno"></span><span class="op" id="7836671">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7836674">func</span>&nbsp;<span class="op" id="7836679">(</span><span class="ident" id="7836680">test</span>&nbsp;<span class="op" id="7836685">*</span><span class="ident" id="7836686">serverTest</span><span class="op" id="7836696">)</span>&nbsp;<span class="ident" id="7836698">run</span><span class="op" id="7836701">(</span><span class="ident" id="7836702">t</span>&nbsp;<span class="op" id="7836704">*</span><span class="ident" id="7836705">testing</span><span class="op" id="7836712">.</span><span class="ident" id="7836713">T</span><span class="op" id="7836714">,</span>&nbsp;<span class="ident" id="7836716">write</span>&nbsp;<span class="builtintype" id="7836722">bool</span><span class="op" id="7836726">)</span>&nbsp;<span class="op" id="7836728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836731">var</span>&nbsp;<span class="ident" id="7836735">clientConn</span><span class="op" id="7836745">,</span>&nbsp;<span class="ident" id="7836747">serverConn</span>&nbsp;<span class="ident" id="7836758">net</span><span class="op" id="7836761">.</span><span class="ident" id="7836762">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836768">var</span>&nbsp;<span class="ident" id="7836772">recordingConn</span>&nbsp;<span class="op" id="7836786">*</span><span class="ident" id="7836787">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836802">var</span>&nbsp;<span class="ident" id="7836806">childProcess</span>&nbsp;<span class="op" id="7836819">*</span><span class="ident" id="7836820">exec</span><span class="op" id="7836824">.</span><span class="ident" id="7836825">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836831">if</span>&nbsp;<span class="ident" id="7836834">write</span>&nbsp;<span class="op" id="7836840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836844">var</span>&nbsp;<span class="ident" id="7836848">err</span>&nbsp;<span class="builtintype" id="7836852">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836860">recordingConn</span><span class="op" id="7836873">,</span>&nbsp;<span class="ident" id="7836875">childProcess</span><span class="op" id="7836887">,</span>&nbsp;<span class="ident" id="7836889">err</span>&nbsp;<span class="op" id="7836893">=</span>&nbsp;<span class="ident" id="7836895">test</span><span class="op" id="7836899">.</span><span class="ident" id="7836900">connFromCommand</span><span class="op" id="7836915">(</span><span class="op" id="7836916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7836920">if</span>&nbsp;<span class="ident" id="7836923">err</span>&nbsp;<span class="op" id="7836927">!=</span>&nbsp;<span class="ident" id="7836930">nil</span>&nbsp;<span class="op" id="7836934">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836939">t</span><span class="op" id="7836940">.</span><span class="ident" id="7836941">Fatalf</span><span class="op" id="7836947">(</span><span class="string" id="7836948">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7836980">,</span>&nbsp;<span class="ident" id="7836982">err</span><span class="op" id="7836985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7836989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7836993">serverConn</span>&nbsp;<span class="op" id="7837004">=</span>&nbsp;<span class="ident" id="7837006">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837021">}</span>&nbsp;<span class="keyword" id="7837023">else</span>&nbsp;<span class="op" id="7837028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837032">clientConn</span><span class="op" id="7837042">,</span>&nbsp;<span class="ident" id="7837044">serverConn</span>&nbsp;<span class="op" id="7837055">=</span>&nbsp;<span class="ident" id="7837057">net</span><span class="op" id="7837060">.</span><span class="ident" id="7837061">Pipe</span><span class="op" id="7837065">(</span><span class="op" id="7837066">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837072">config</span>&nbsp;<span class="op" id="7837079">:=</span>&nbsp;<span class="ident" id="7837082">test</span><span class="op" id="7837086">.</span><span class="ident" id="7837087">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837095">if</span>&nbsp;<span class="ident" id="7837098">config</span>&nbsp;<span class="op" id="7837105">==</span>&nbsp;<span class="ident" id="7837108">nil</span>&nbsp;<span class="op" id="7837112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837116">config</span>&nbsp;<span class="op" id="7837123">=</span>&nbsp;<span class="ident" id="7837125">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837137">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837140">server</span>&nbsp;<span class="op" id="7837147">:=</span>&nbsp;<span class="ident" id="7837150">Server</span><span class="op" id="7837156">(</span><span class="ident" id="7837157">serverConn</span><span class="op" id="7837167">,</span>&nbsp;<span class="ident" id="7837169">config</span><span class="op" id="7837175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837178">connStateChan</span>&nbsp;<span class="op" id="7837192">:=</span>&nbsp;<span class="builtinfunc" id="7837195">make</span><span class="op" id="7837199">(</span><span class="keyword" id="7837200">chan</span>&nbsp;<span class="ident" id="7837205">ConnectionState</span><span class="op" id="7837220">,</span>&nbsp;<span class="num" id="7837222">1</span><span class="op" id="7837223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837226">go</span>&nbsp;<span class="keyword" id="7837229">func</span><span class="op" id="7837233">(</span><span class="op" id="7837234">)</span>&nbsp;<span class="op" id="7837236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837240">var</span>&nbsp;<span class="ident" id="7837244">err</span>&nbsp;<span class="builtintype" id="7837248">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837256">if</span>&nbsp;<span class="ident" id="7837259">_</span><span class="op" id="7837260">,</span>&nbsp;<span class="ident" id="7837262">err</span>&nbsp;<span class="op" id="7837266">=</span>&nbsp;<span class="ident" id="7837268">server</span><span class="op" id="7837274">.</span><span class="ident" id="7837275">Write</span><span class="op" id="7837280">(</span><span class="op" id="7837281">[</span><span class="op" id="7837282">]</span><span class="builtintype" id="7837283">byte</span><span class="op" id="7837287">(</span><span class="string" id="7837288">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="7837304">)</span><span class="op" id="7837305">)</span><span class="op" id="7837306">;</span>&nbsp;<span class="ident" id="7837308">err</span>&nbsp;<span class="op" id="7837312">!=</span>&nbsp;<span class="ident" id="7837315">nil</span>&nbsp;<span class="op" id="7837319">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837324">t</span><span class="op" id="7837325">.</span><span class="ident" id="7837326">Logf</span><span class="op" id="7837330">(</span><span class="string" id="7837331">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="7837360">,</span>&nbsp;<span class="ident" id="7837362">err</span><span class="op" id="7837365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837373">if</span>&nbsp;<span class="builtinfunc" id="7837376">len</span><span class="op" id="7837379">(</span><span class="ident" id="7837380">test</span><span class="op" id="7837384">.</span><span class="ident" id="7837385">expectHandshakeErrorIncluding</span><span class="op" id="7837414">)</span>&nbsp;<span class="op" id="7837416">&gt;</span>&nbsp;<span class="num" id="7837418">0</span>&nbsp;<span class="op" id="7837420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837425">if</span>&nbsp;<span class="ident" id="7837428">err</span>&nbsp;<span class="op" id="7837432">==</span>&nbsp;<span class="ident" id="7837435">nil</span>&nbsp;<span class="op" id="7837439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837445">t</span><span class="op" id="7837446">.</span><span class="ident" id="7837447">Errorf</span><span class="op" id="7837453">(</span><span class="string" id="7837454">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="7837493">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837498">}</span>&nbsp;<span class="keyword" id="7837500">else</span>&nbsp;<span class="keyword" id="7837505">if</span>&nbsp;<span class="ident" id="7837508">s</span>&nbsp;<span class="op" id="7837510">:=</span>&nbsp;<span class="ident" id="7837513">err</span><span class="op" id="7837516">.</span><span class="ident" id="7837517">Error</span><span class="op" id="7837522">(</span><span class="op" id="7837523">)</span><span class="op" id="7837524">;</span>&nbsp;<span class="op" id="7837526">!</span><span class="ident" id="7837527">strings</span><span class="op" id="7837534">.</span><span class="ident" id="7837535">Contains</span><span class="op" id="7837543">(</span><span class="ident" id="7837544">s</span><span class="op" id="7837545">,</span>&nbsp;<span class="ident" id="7837547">test</span><span class="op" id="7837551">.</span><span class="ident" id="7837552">expectHandshakeErrorIncluding</span><span class="op" id="7837581">)</span>&nbsp;<span class="op" id="7837583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837589">t</span><span class="op" id="7837590">.</span><span class="ident" id="7837591">Errorf</span><span class="op" id="7837597">(</span><span class="string" id="7837598">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7837643">,</span>&nbsp;<span class="ident" id="7837645">test</span><span class="op" id="7837649">.</span><span class="ident" id="7837650">expectHandshakeErrorIncluding</span><span class="op" id="7837679">,</span>&nbsp;<span class="ident" id="7837681">s</span><span class="op" id="7837682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837695">server</span><span class="op" id="7837701">.</span><span class="ident" id="7837702">Close</span><span class="op" id="7837707">(</span><span class="op" id="7837708">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837712">serverConn</span><span class="op" id="7837722">.</span><span class="ident" id="7837723">Close</span><span class="op" id="7837728">(</span><span class="op" id="7837729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837733">connStateChan</span>&nbsp;<span class="op" id="7837747">&lt;-</span>&nbsp;<span class="ident" id="7837750">server</span><span class="op" id="7837756">.</span><span class="ident" id="7837757">ConnectionState</span><span class="op" id="7837772">(</span><span class="op" id="7837773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837776">}</span><span class="op" id="7837777">(</span><span class="op" id="7837778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837782">if</span>&nbsp;<span class="op" id="7837785">!</span><span class="ident" id="7837786">write</span>&nbsp;<span class="op" id="7837792">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837796">flows</span><span class="op" id="7837801">,</span>&nbsp;<span class="ident" id="7837803">err</span>&nbsp;<span class="op" id="7837807">:=</span>&nbsp;<span class="ident" id="7837810">test</span><span class="op" id="7837814">.</span><span class="ident" id="7837815">loadData</span><span class="op" id="7837823">(</span><span class="op" id="7837824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837828">if</span>&nbsp;<span class="ident" id="7837831">err</span>&nbsp;<span class="op" id="7837835">!=</span>&nbsp;<span class="ident" id="7837838">nil</span>&nbsp;<span class="op" id="7837842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837847">if</span>&nbsp;<span class="op" id="7837850">!</span><span class="ident" id="7837851">test</span><span class="op" id="7837855">.</span><span class="ident" id="7837856">expectAlert</span>&nbsp;<span class="op" id="7837868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7837874">t</span><span class="op" id="7837875">.</span><span class="ident" id="7837876">Fatalf</span><span class="op" id="7837882">(</span><span class="string" id="7837883">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="7837916">,</span>&nbsp;<span class="ident" id="7837918">test</span><span class="op" id="7837922">.</span><span class="ident" id="7837923">name</span><span class="op" id="7837927">,</span>&nbsp;<span class="ident" id="7837929">test</span><span class="op" id="7837933">.</span><span class="ident" id="7837934">dataPath</span><span class="op" id="7837942">(</span><span class="op" id="7837943">)</span><span class="op" id="7837944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837949">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7837953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837957">for</span>&nbsp;<span class="ident" id="7837961">i</span><span class="op" id="7837962">,</span>&nbsp;<span class="ident" id="7837964">b</span>&nbsp;<span class="op" id="7837966">:=</span>&nbsp;<span class="keyword" id="7837969">range</span>&nbsp;<span class="ident" id="7837975">flows</span>&nbsp;<span class="op" id="7837981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7837986">if</span>&nbsp;<span class="ident" id="7837989">i</span><span class="op" id="7837990">%</span><span class="num" id="7837991">2</span>&nbsp;<span class="op" id="7837993">==</span>&nbsp;<span class="num" id="7837996">0</span>&nbsp;<span class="op" id="7837998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838004">clientConn</span><span class="op" id="7838014">.</span><span class="ident" id="7838015">Write</span><span class="op" id="7838020">(</span><span class="ident" id="7838021">b</span><span class="op" id="7838022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838028">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838045">bb</span>&nbsp;<span class="op" id="7838048">:=</span>&nbsp;<span class="builtinfunc" id="7838051">make</span><span class="op" id="7838055">(</span><span class="op" id="7838056">[</span><span class="op" id="7838057">]</span><span class="builtintype" id="7838058">byte</span><span class="op" id="7838062">,</span>&nbsp;<span class="builtinfunc" id="7838064">len</span><span class="op" id="7838067">(</span><span class="ident" id="7838068">b</span><span class="op" id="7838069">)</span><span class="op" id="7838070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838075">n</span><span class="op" id="7838076">,</span>&nbsp;<span class="ident" id="7838078">err</span>&nbsp;<span class="op" id="7838082">:=</span>&nbsp;<span class="ident" id="7838085">io</span><span class="op" id="7838087">.</span><span class="ident" id="7838088">ReadFull</span><span class="op" id="7838096">(</span><span class="ident" id="7838097">clientConn</span><span class="op" id="7838107">,</span>&nbsp;<span class="ident" id="7838109">bb</span><span class="op" id="7838111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838116">if</span>&nbsp;<span class="ident" id="7838119">test</span><span class="op" id="7838123">.</span><span class="ident" id="7838124">expectAlert</span>&nbsp;<span class="op" id="7838136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838142">if</span>&nbsp;<span class="ident" id="7838145">err</span>&nbsp;<span class="op" id="7838149">==</span>&nbsp;<span class="ident" id="7838152">nil</span>&nbsp;<span class="op" id="7838156">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838163">t</span><span class="op" id="7838164">.</span><span class="ident" id="7838165">Fatal</span><span class="op" id="7838170">(</span><span class="string" id="7838171">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="7838213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838224">}</span>&nbsp;<span class="keyword" id="7838226">else</span>&nbsp;<span class="op" id="7838231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838237">if</span>&nbsp;<span class="ident" id="7838240">err</span>&nbsp;<span class="op" id="7838244">!=</span>&nbsp;<span class="ident" id="7838247">nil</span>&nbsp;<span class="op" id="7838251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838258">t</span><span class="op" id="7838259">.</span><span class="ident" id="7838260">Fatalf</span><span class="op" id="7838266">(</span><span class="string" id="7838267">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="7838320">,</span>&nbsp;<span class="ident" id="7838322">test</span><span class="op" id="7838326">.</span><span class="ident" id="7838327">name</span><span class="op" id="7838331">,</span>&nbsp;<span class="ident" id="7838333">i</span><span class="op" id="7838334">+</span><span class="num" id="7838335">1</span><span class="op" id="7838336">,</span>&nbsp;<span class="ident" id="7838338">err</span><span class="op" id="7838341">,</span>&nbsp;<span class="ident" id="7838343">n</span><span class="op" id="7838344">,</span>&nbsp;<span class="builtinfunc" id="7838346">len</span><span class="op" id="7838349">(</span><span class="ident" id="7838350">bb</span><span class="op" id="7838352">)</span><span class="op" id="7838353">,</span>&nbsp;<span class="ident" id="7838355">bb</span><span class="op" id="7838357">[</span><span class="op" id="7838358">:</span><span class="ident" id="7838359">n</span><span class="op" id="7838360">]</span><span class="op" id="7838361">,</span>&nbsp;<span class="ident" id="7838363">b</span><span class="op" id="7838364">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838376">if</span>&nbsp;<span class="op" id="7838379">!</span><span class="ident" id="7838380">bytes</span><span class="op" id="7838385">.</span><span class="ident" id="7838386">Equal</span><span class="op" id="7838391">(</span><span class="ident" id="7838392">b</span><span class="op" id="7838393">,</span>&nbsp;<span class="ident" id="7838395">bb</span><span class="op" id="7838397">)</span>&nbsp;<span class="op" id="7838399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838406">t</span><span class="op" id="7838407">.</span><span class="ident" id="7838408">Fatalf</span><span class="op" id="7838414">(</span><span class="string" id="7838415">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7838457">,</span>&nbsp;<span class="ident" id="7838459">test</span><span class="op" id="7838463">.</span><span class="ident" id="7838464">name</span><span class="op" id="7838468">,</span>&nbsp;<span class="ident" id="7838470">i</span><span class="op" id="7838471">+</span><span class="num" id="7838472">1</span><span class="op" id="7838473">,</span>&nbsp;<span class="ident" id="7838475">bb</span><span class="op" id="7838477">,</span>&nbsp;<span class="ident" id="7838479">b</span><span class="op" id="7838480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838491">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838499">clientConn</span><span class="op" id="7838509">.</span><span class="ident" id="7838510">Close</span><span class="op" id="7838515">(</span><span class="op" id="7838516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838523">connState</span>&nbsp;<span class="op" id="7838533">:=</span>&nbsp;<span class="op" id="7838536">&lt;-</span><span class="ident" id="7838538">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838553">peerCerts</span>&nbsp;<span class="op" id="7838563">:=</span>&nbsp;<span class="ident" id="7838566">connState</span><span class="op" id="7838575">.</span><span class="ident" id="7838576">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838594">if</span>&nbsp;<span class="builtinfunc" id="7838597">len</span><span class="op" id="7838600">(</span><span class="ident" id="7838601">peerCerts</span><span class="op" id="7838610">)</span>&nbsp;<span class="op" id="7838612">==</span>&nbsp;<span class="builtinfunc" id="7838615">len</span><span class="op" id="7838618">(</span><span class="ident" id="7838619">test</span><span class="op" id="7838623">.</span><span class="ident" id="7838624">expectedPeerCerts</span><span class="op" id="7838641">)</span>&nbsp;<span class="op" id="7838643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838647">for</span>&nbsp;<span class="ident" id="7838651">i</span><span class="op" id="7838652">,</span>&nbsp;<span class="ident" id="7838654">peerCert</span>&nbsp;<span class="op" id="7838663">:=</span>&nbsp;<span class="keyword" id="7838666">range</span>&nbsp;<span class="ident" id="7838672">peerCerts</span>&nbsp;<span class="op" id="7838682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838687">block</span><span class="op" id="7838692">,</span>&nbsp;<span class="ident" id="7838694">_</span>&nbsp;<span class="op" id="7838696">:=</span>&nbsp;<span class="ident" id="7838699">pem</span><span class="op" id="7838702">.</span><span class="ident" id="7838703">Decode</span><span class="op" id="7838709">(</span><span class="op" id="7838710">[</span><span class="op" id="7838711">]</span><span class="builtintype" id="7838712">byte</span><span class="op" id="7838716">(</span><span class="ident" id="7838717">test</span><span class="op" id="7838721">.</span><span class="ident" id="7838722">expectedPeerCerts</span><span class="op" id="7838739">[</span><span class="ident" id="7838740">i</span><span class="op" id="7838741">]</span><span class="op" id="7838742">)</span><span class="op" id="7838743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7838748">if</span>&nbsp;<span class="op" id="7838751">!</span><span class="ident" id="7838752">bytes</span><span class="op" id="7838757">.</span><span class="ident" id="7838758">Equal</span><span class="op" id="7838763">(</span><span class="ident" id="7838764">block</span><span class="op" id="7838769">.</span><span class="ident" id="7838770">Bytes</span><span class="op" id="7838775">,</span>&nbsp;<span class="ident" id="7838777">peerCert</span><span class="op" id="7838785">.</span><span class="ident" id="7838786">Raw</span><span class="op" id="7838789">)</span>&nbsp;<span class="op" id="7838791">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838797">t</span><span class="op" id="7838798">.</span><span class="ident" id="7838799">Fatalf</span><span class="op" id="7838805">(</span><span class="string" id="7838806">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="7838836">,</span>&nbsp;<span class="ident" id="7838838">test</span><span class="op" id="7838842">.</span><span class="ident" id="7838843">name</span><span class="op" id="7838847">,</span>&nbsp;<span class="ident" id="7838849">i</span><span class="op" id="7838850">+</span><span class="num" id="7838851">1</span><span class="op" id="7838852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7838864">}</span>&nbsp;<span class="keyword" id="7838866">else</span>&nbsp;<span class="op" id="7838871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7838875">t</span><span class="op" id="7838876">.</span><span class="ident" id="7838877">Fatalf</span><span class="op" id="7838883">(</span><span class="string" id="7838884">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="7838943">,</span>&nbsp;<span class="ident" id="7838945">test</span><span class="op" id="7838949">.</span><span class="ident" id="7838950">name</span><span class="op" id="7838954">,</span>&nbsp;<span class="builtinfunc" id="7838956">len</span><span class="op" id="7838959">(</span><span class="ident" id="7838960">test</span><span class="op" id="7838964">.</span><span class="ident" id="7838965">expectedPeerCerts</span><span class="op" id="7838982">)</span><span class="op" id="7838983">,</span>&nbsp;<span class="builtinfunc" id="7838985">len</span><span class="op" id="7838988">(</span><span class="ident" id="7838989">peerCerts</span><span class="op" id="7838998">)</span><span class="op" id="7838999">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839006">if</span>&nbsp;<span class="ident" id="7839009">test</span><span class="op" id="7839013">.</span><span class="ident" id="7839014">validate</span>&nbsp;<span class="op" id="7839023">!=</span>&nbsp;<span class="ident" id="7839026">nil</span>&nbsp;<span class="op" id="7839030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839034">if</span>&nbsp;<span class="ident" id="7839037">err</span>&nbsp;<span class="op" id="7839041">:=</span>&nbsp;<span class="ident" id="7839044">test</span><span class="op" id="7839048">.</span><span class="ident" id="7839049">validate</span><span class="op" id="7839057">(</span><span class="ident" id="7839058">connState</span><span class="op" id="7839067">)</span><span class="op" id="7839068">;</span>&nbsp;<span class="ident" id="7839070">err</span>&nbsp;<span class="op" id="7839074">!=</span>&nbsp;<span class="ident" id="7839077">nil</span>&nbsp;<span class="op" id="7839081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839086">t</span><span class="op" id="7839087">.</span><span class="ident" id="7839088">Fatalf</span><span class="op" id="7839094">(</span><span class="string" id="7839095">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7839133">,</span>&nbsp;<span class="ident" id="7839135">err</span><span class="op" id="7839138">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839149">if</span>&nbsp;<span class="ident" id="7839152">write</span>&nbsp;<span class="op" id="7839158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839162">path</span>&nbsp;<span class="op" id="7839167">:=</span>&nbsp;<span class="ident" id="7839170">test</span><span class="op" id="7839174">.</span><span class="ident" id="7839175">dataPath</span><span class="op" id="7839183">(</span><span class="op" id="7839184">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839188">out</span><span class="op" id="7839191">,</span>&nbsp;<span class="ident" id="7839193">err</span>&nbsp;<span class="op" id="7839197">:=</span>&nbsp;<span class="ident" id="7839200">os</span><span class="op" id="7839202">.</span><span class="ident" id="7839203">OpenFile</span><span class="op" id="7839211">(</span><span class="ident" id="7839212">path</span><span class="op" id="7839216">,</span>&nbsp;<span class="ident" id="7839218">os</span><span class="op" id="7839220">.</span><span class="ident" id="7839221">O_WRONLY</span><span class="op" id="7839229">|</span><span class="ident" id="7839230">os</span><span class="op" id="7839232">.</span><span class="ident" id="7839233">O_CREATE</span><span class="op" id="7839241">|</span><span class="ident" id="7839242">os</span><span class="op" id="7839244">.</span><span class="ident" id="7839245">O_TRUNC</span><span class="op" id="7839252">,</span>&nbsp;<span class="num" id="7839254">0644</span><span class="op" id="7839258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839262">if</span>&nbsp;<span class="ident" id="7839265">err</span>&nbsp;<span class="op" id="7839269">!=</span>&nbsp;<span class="ident" id="7839272">nil</span>&nbsp;<span class="op" id="7839276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839281">t</span><span class="op" id="7839282">.</span><span class="ident" id="7839283">Fatalf</span><span class="op" id="7839289">(</span><span class="string" id="7839290">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7839324">,</span>&nbsp;<span class="ident" id="7839326">err</span><span class="op" id="7839329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839337">defer</span>&nbsp;<span class="ident" id="7839343">out</span><span class="op" id="7839346">.</span><span class="ident" id="7839347">Close</span><span class="op" id="7839352">(</span><span class="op" id="7839353">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839357">recordingConn</span><span class="op" id="7839370">.</span><span class="ident" id="7839371">Close</span><span class="op" id="7839376">(</span><span class="op" id="7839377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839381">if</span>&nbsp;<span class="builtinfunc" id="7839384">len</span><span class="op" id="7839387">(</span><span class="ident" id="7839388">recordingConn</span><span class="op" id="7839401">.</span><span class="ident" id="7839402">flows</span><span class="op" id="7839407">)</span>&nbsp;<span class="op" id="7839409">&lt;</span>&nbsp;<span class="num" id="7839411">3</span>&nbsp;<span class="op" id="7839413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839418">childProcess</span><span class="op" id="7839430">.</span><span class="ident" id="7839431">Stdout</span><span class="op" id="7839437">.</span><span class="op" id="7839438">(</span><span class="op" id="7839439">*</span><span class="ident" id="7839440">bytes</span><span class="op" id="7839445">.</span><span class="ident" id="7839446">Buffer</span><span class="op" id="7839452">)</span><span class="op" id="7839453">.</span><span class="ident" id="7839454">WriteTo</span><span class="op" id="7839461">(</span><span class="ident" id="7839462">os</span><span class="op" id="7839464">.</span><span class="ident" id="7839465">Stdout</span><span class="op" id="7839471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839476">if</span>&nbsp;<span class="builtinfunc" id="7839479">len</span><span class="op" id="7839482">(</span><span class="ident" id="7839483">test</span><span class="op" id="7839487">.</span><span class="ident" id="7839488">expectHandshakeErrorIncluding</span><span class="op" id="7839517">)</span>&nbsp;<span class="op" id="7839519">==</span>&nbsp;<span class="num" id="7839522">0</span>&nbsp;<span class="op" id="7839524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839530">t</span><span class="op" id="7839531">.</span><span class="ident" id="7839532">Fatalf</span><span class="op" id="7839538">(</span><span class="string" id="7839539">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="7839557">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839570">recordingConn</span><span class="op" id="7839583">.</span><span class="ident" id="7839584">WriteTo</span><span class="op" id="7839591">(</span><span class="ident" id="7839592">out</span><span class="op" id="7839595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839599">fmt</span><span class="op" id="7839602">.</span><span class="ident" id="7839603">Printf</span><span class="op" id="7839609">(</span><span class="string" id="7839610">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7839622">,</span>&nbsp;<span class="ident" id="7839624">path</span><span class="op" id="7839628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839632">childProcess</span><span class="op" id="7839644">.</span><span class="ident" id="7839645">Wait</span><span class="op" id="7839649">(</span><span class="op" id="7839650">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839653">}</span><br>
<span class="lineno"></span><span class="op" id="7839655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7839658">func</span>&nbsp;<span class="ident" id="7839663">runServerTestForVersion</span><span class="op" id="7839686">(</span><span class="ident" id="7839687">t</span>&nbsp;<span class="op" id="7839689">*</span><span class="ident" id="7839690">testing</span><span class="op" id="7839697">.</span><span class="ident" id="7839698">T</span><span class="op" id="7839699">,</span>&nbsp;<span class="ident" id="7839701">template</span>&nbsp;<span class="op" id="7839710">*</span><span class="ident" id="7839711">serverTest</span><span class="op" id="7839721">,</span>&nbsp;<span class="ident" id="7839723">prefix</span><span class="op" id="7839729">,</span>&nbsp;<span class="ident" id="7839731">option</span>&nbsp;<span class="builtintype" id="7839738">string</span><span class="op" id="7839744">)</span>&nbsp;<span class="op" id="7839746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839749">test</span>&nbsp;<span class="op" id="7839754">:=</span>&nbsp;<span class="op" id="7839757">*</span><span class="ident" id="7839758">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839768">test</span><span class="op" id="7839772">.</span><span class="ident" id="7839773">name</span>&nbsp;<span class="op" id="7839778">=</span>&nbsp;<span class="ident" id="7839780">prefix</span>&nbsp;<span class="op" id="7839787">+</span>&nbsp;<span class="ident" id="7839789">test</span><span class="op" id="7839793">.</span><span class="ident" id="7839794">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7839800">if</span>&nbsp;<span class="builtinfunc" id="7839803">len</span><span class="op" id="7839806">(</span><span class="ident" id="7839807">test</span><span class="op" id="7839811">.</span><span class="ident" id="7839812">command</span><span class="op" id="7839819">)</span>&nbsp;<span class="op" id="7839821">==</span>&nbsp;<span class="num" id="7839824">0</span>&nbsp;<span class="op" id="7839826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839830">test</span><span class="op" id="7839834">.</span><span class="ident" id="7839835">command</span>&nbsp;<span class="op" id="7839843">=</span>&nbsp;<span class="ident" id="7839845">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7839867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839870">test</span><span class="op" id="7839874">.</span><span class="ident" id="7839875">command</span>&nbsp;<span class="op" id="7839883">=</span>&nbsp;<span class="builtinfunc" id="7839885">append</span><span class="op" id="7839891">(</span><span class="op" id="7839892">[</span><span class="op" id="7839893">]</span><span class="builtintype" id="7839894">string</span><span class="op" id="7839900">(</span><span class="ident" id="7839901">nil</span><span class="op" id="7839904">)</span><span class="op" id="7839905">,</span>&nbsp;<span class="ident" id="7839907">test</span><span class="op" id="7839911">.</span><span class="ident" id="7839912">command</span><span class="op" id="7839919">...</span><span class="op" id="7839922">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839925">test</span><span class="op" id="7839929">.</span><span class="ident" id="7839930">command</span>&nbsp;<span class="op" id="7839938">=</span>&nbsp;<span class="builtinfunc" id="7839940">append</span><span class="op" id="7839946">(</span><span class="ident" id="7839947">test</span><span class="op" id="7839951">.</span><span class="ident" id="7839952">command</span><span class="op" id="7839959">,</span>&nbsp;<span class="ident" id="7839961">option</span><span class="op" id="7839967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7839970">test</span><span class="op" id="7839974">.</span><span class="ident" id="7839975">run</span><span class="op" id="7839978">(</span><span class="ident" id="7839979">t</span><span class="op" id="7839980">,</span>&nbsp;<span class="op" id="7839982">*</span><span class="ident" id="7839983">update</span><span class="op" id="7839989">)</span><br>
<span class="lineno"></span><span class="op" id="7839991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7839994">func</span>&nbsp;<span class="ident" id="7839999">runServerTestSSLv3</span><span class="op" id="7840017">(</span><span class="ident" id="7840018">t</span>&nbsp;<span class="op" id="7840020">*</span><span class="ident" id="7840021">testing</span><span class="op" id="7840028">.</span><span class="ident" id="7840029">T</span><span class="op" id="7840030">,</span>&nbsp;<span class="ident" id="7840032">template</span>&nbsp;<span class="op" id="7840041">*</span><span class="ident" id="7840042">serverTest</span><span class="op" id="7840052">)</span>&nbsp;<span class="op" id="7840054">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840057">runServerTestForVersion</span><span class="op" id="7840080">(</span><span class="ident" id="7840081">t</span><span class="op" id="7840082">,</span>&nbsp;<span class="ident" id="7840084">template</span><span class="op" id="7840092">,</span>&nbsp;<span class="string" id="7840094">&#34;SSLv3-&#34;</span><span class="op" id="7840102">,</span>&nbsp;<span class="string" id="7840104">&#34;-ssl3&#34;</span><span class="op" id="7840111">)</span><br>
<span class="lineno"></span><span class="op" id="7840113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7840116">func</span>&nbsp;<span class="ident" id="7840121">runServerTestTLS10</span><span class="op" id="7840139">(</span><span class="ident" id="7840140">t</span>&nbsp;<span class="op" id="7840142">*</span><span class="ident" id="7840143">testing</span><span class="op" id="7840150">.</span><span class="ident" id="7840151">T</span><span class="op" id="7840152">,</span>&nbsp;<span class="ident" id="7840154">template</span>&nbsp;<span class="op" id="7840163">*</span><span class="ident" id="7840164">serverTest</span><span class="op" id="7840174">)</span>&nbsp;<span class="op" id="7840176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840179">runServerTestForVersion</span><span class="op" id="7840202">(</span><span class="ident" id="7840203">t</span><span class="op" id="7840204">,</span>&nbsp;<span class="ident" id="7840206">template</span><span class="op" id="7840214">,</span>&nbsp;<span class="string" id="7840216">&#34;TLSv10-&#34;</span><span class="op" id="7840225">,</span>&nbsp;<span class="string" id="7840227">&#34;-tls1&#34;</span><span class="op" id="7840234">)</span><br>
<span class="lineno">470</span><span class="op" id="7840236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7840239">func</span>&nbsp;<span class="ident" id="7840244">runServerTestTLS11</span><span class="op" id="7840262">(</span><span class="ident" id="7840263">t</span>&nbsp;<span class="op" id="7840265">*</span><span class="ident" id="7840266">testing</span><span class="op" id="7840273">.</span><span class="ident" id="7840274">T</span><span class="op" id="7840275">,</span>&nbsp;<span class="ident" id="7840277">template</span>&nbsp;<span class="op" id="7840286">*</span><span class="ident" id="7840287">serverTest</span><span class="op" id="7840297">)</span>&nbsp;<span class="op" id="7840299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840302">runServerTestForVersion</span><span class="op" id="7840325">(</span><span class="ident" id="7840326">t</span><span class="op" id="7840327">,</span>&nbsp;<span class="ident" id="7840329">template</span><span class="op" id="7840337">,</span>&nbsp;<span class="string" id="7840339">&#34;TLSv11-&#34;</span><span class="op" id="7840348">,</span>&nbsp;<span class="string" id="7840350">&#34;-tls1_1&#34;</span><span class="op" id="7840359">)</span><br>
<span class="lineno"></span><span class="op" id="7840361">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7840364">func</span>&nbsp;<span class="ident" id="7840369">runServerTestTLS12</span><span class="op" id="7840387">(</span><span class="ident" id="7840388">t</span>&nbsp;<span class="op" id="7840390">*</span><span class="ident" id="7840391">testing</span><span class="op" id="7840398">.</span><span class="ident" id="7840399">T</span><span class="op" id="7840400">,</span>&nbsp;<span class="ident" id="7840402">template</span>&nbsp;<span class="op" id="7840411">*</span><span class="ident" id="7840412">serverTest</span><span class="op" id="7840422">)</span>&nbsp;<span class="op" id="7840424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840427">runServerTestForVersion</span><span class="op" id="7840450">(</span><span class="ident" id="7840451">t</span><span class="op" id="7840452">,</span>&nbsp;<span class="ident" id="7840454">template</span><span class="op" id="7840462">,</span>&nbsp;<span class="string" id="7840464">&#34;TLSv12-&#34;</span><span class="op" id="7840473">,</span>&nbsp;<span class="string" id="7840475">&#34;-tls1_2&#34;</span><span class="op" id="7840484">)</span><br>
<span class="lineno"></span><span class="op" id="7840486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7840489">func</span>&nbsp;<span class="ident" id="7840494">TestHandshakeServerRSARC4</span><span class="op" id="7840519">(</span><span class="ident" id="7840520">t</span>&nbsp;<span class="op" id="7840522">*</span><span class="ident" id="7840523">testing</span><span class="op" id="7840530">.</span><span class="ident" id="7840531">T</span><span class="op" id="7840532">)</span>&nbsp;<span class="op" id="7840534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840537">test</span>&nbsp;<span class="op" id="7840542">:=</span>&nbsp;<span class="op" id="7840545">&amp;</span><span class="ident" id="7840546">serverTest</span><span class="op" id="7840556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840560">name</span><span class="op" id="7840564">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7840569">&#34;RSA-RC4&#34;</span><span class="op" id="7840578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840582">command</span><span class="op" id="7840589">:</span>&nbsp;<span class="op" id="7840591">[</span><span class="op" id="7840592">]</span><span class="builtintype" id="7840593">string</span><span class="op" id="7840599">{</span><span class="string" id="7840600">&#34;openssl&#34;</span><span class="op" id="7840609">,</span>&nbsp;<span class="string" id="7840611">&#34;s_client&#34;</span><span class="op" id="7840621">,</span>&nbsp;<span class="string" id="7840623">&#34;-no_ticket&#34;</span><span class="op" id="7840635">,</span>&nbsp;<span class="string" id="7840637">&#34;-cipher&#34;</span><span class="op" id="7840646">,</span>&nbsp;<span class="string" id="7840648">&#34;RC4-SHA&#34;</span><span class="op" id="7840657">}</span><span class="op" id="7840658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840661">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840664">runServerTestSSLv3</span><span class="op" id="7840682">(</span><span class="ident" id="7840683">t</span><span class="op" id="7840684">,</span>&nbsp;<span class="ident" id="7840686">test</span><span class="op" id="7840690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840693">runServerTestTLS10</span><span class="op" id="7840711">(</span><span class="ident" id="7840712">t</span><span class="op" id="7840713">,</span>&nbsp;<span class="ident" id="7840715">test</span><span class="op" id="7840719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840722">runServerTestTLS11</span><span class="op" id="7840740">(</span><span class="ident" id="7840741">t</span><span class="op" id="7840742">,</span>&nbsp;<span class="ident" id="7840744">test</span><span class="op" id="7840748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840751">runServerTestTLS12</span><span class="op" id="7840769">(</span><span class="ident" id="7840770">t</span><span class="op" id="7840771">,</span>&nbsp;<span class="ident" id="7840773">test</span><span class="op" id="7840777">)</span><br>
<span class="lineno"></span><span class="op" id="7840779">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="7840782">func</span>&nbsp;<span class="ident" id="7840787">TestHandshakeServerRSA3DES</span><span class="op" id="7840813">(</span><span class="ident" id="7840814">t</span>&nbsp;<span class="op" id="7840816">*</span><span class="ident" id="7840817">testing</span><span class="op" id="7840824">.</span><span class="ident" id="7840825">T</span><span class="op" id="7840826">)</span>&nbsp;<span class="op" id="7840828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840831">test</span>&nbsp;<span class="op" id="7840836">:=</span>&nbsp;<span class="op" id="7840839">&amp;</span><span class="ident" id="7840840">serverTest</span><span class="op" id="7840850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840854">name</span><span class="op" id="7840858">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7840863">&#34;RSA-3DES&#34;</span><span class="op" id="7840873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840877">command</span><span class="op" id="7840884">:</span>&nbsp;<span class="op" id="7840886">[</span><span class="op" id="7840887">]</span><span class="builtintype" id="7840888">string</span><span class="op" id="7840894">{</span><span class="string" id="7840895">&#34;openssl&#34;</span><span class="op" id="7840904">,</span>&nbsp;<span class="string" id="7840906">&#34;s_client&#34;</span><span class="op" id="7840916">,</span>&nbsp;<span class="string" id="7840918">&#34;-no_ticket&#34;</span><span class="op" id="7840930">,</span>&nbsp;<span class="string" id="7840932">&#34;-cipher&#34;</span><span class="op" id="7840941">,</span>&nbsp;<span class="string" id="7840943">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="7840957">}</span><span class="op" id="7840958">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7840961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840964">runServerTestSSLv3</span><span class="op" id="7840982">(</span><span class="ident" id="7840983">t</span><span class="op" id="7840984">,</span>&nbsp;<span class="ident" id="7840986">test</span><span class="op" id="7840990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7840993">runServerTestTLS10</span><span class="op" id="7841011">(</span><span class="ident" id="7841012">t</span><span class="op" id="7841013">,</span>&nbsp;<span class="ident" id="7841015">test</span><span class="op" id="7841019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841022">runServerTestTLS12</span><span class="op" id="7841040">(</span><span class="ident" id="7841041">t</span><span class="op" id="7841042">,</span>&nbsp;<span class="ident" id="7841044">test</span><span class="op" id="7841048">)</span><br>
<span class="lineno"></span><span class="op" id="7841050">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="7841053">func</span>&nbsp;<span class="ident" id="7841058">TestHandshakeServerRSAAES</span><span class="op" id="7841083">(</span><span class="ident" id="7841084">t</span>&nbsp;<span class="op" id="7841086">*</span><span class="ident" id="7841087">testing</span><span class="op" id="7841094">.</span><span class="ident" id="7841095">T</span><span class="op" id="7841096">)</span>&nbsp;<span class="op" id="7841098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841101">test</span>&nbsp;<span class="op" id="7841106">:=</span>&nbsp;<span class="op" id="7841109">&amp;</span><span class="ident" id="7841110">serverTest</span><span class="op" id="7841120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841124">name</span><span class="op" id="7841128">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841133">&#34;RSA-AES&#34;</span><span class="op" id="7841142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841146">command</span><span class="op" id="7841153">:</span>&nbsp;<span class="op" id="7841155">[</span><span class="op" id="7841156">]</span><span class="builtintype" id="7841157">string</span><span class="op" id="7841163">{</span><span class="string" id="7841164">&#34;openssl&#34;</span><span class="op" id="7841173">,</span>&nbsp;<span class="string" id="7841175">&#34;s_client&#34;</span><span class="op" id="7841185">,</span>&nbsp;<span class="string" id="7841187">&#34;-no_ticket&#34;</span><span class="op" id="7841199">,</span>&nbsp;<span class="string" id="7841201">&#34;-cipher&#34;</span><span class="op" id="7841210">,</span>&nbsp;<span class="string" id="7841212">&#34;AES128-SHA&#34;</span><span class="op" id="7841224">}</span><span class="op" id="7841225">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7841228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841231">runServerTestSSLv3</span><span class="op" id="7841249">(</span><span class="ident" id="7841250">t</span><span class="op" id="7841251">,</span>&nbsp;<span class="ident" id="7841253">test</span><span class="op" id="7841257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841260">runServerTestTLS10</span><span class="op" id="7841278">(</span><span class="ident" id="7841279">t</span><span class="op" id="7841280">,</span>&nbsp;<span class="ident" id="7841282">test</span><span class="op" id="7841286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841289">runServerTestTLS12</span><span class="op" id="7841307">(</span><span class="ident" id="7841308">t</span><span class="op" id="7841309">,</span>&nbsp;<span class="ident" id="7841311">test</span><span class="op" id="7841315">)</span><br>
<span class="lineno"></span><span class="op" id="7841317">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="7841320">func</span>&nbsp;<span class="ident" id="7841325">TestHandshakeServerAESGCM</span><span class="op" id="7841350">(</span><span class="ident" id="7841351">t</span>&nbsp;<span class="op" id="7841353">*</span><span class="ident" id="7841354">testing</span><span class="op" id="7841361">.</span><span class="ident" id="7841362">T</span><span class="op" id="7841363">)</span>&nbsp;<span class="op" id="7841365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841368">test</span>&nbsp;<span class="op" id="7841373">:=</span>&nbsp;<span class="op" id="7841376">&amp;</span><span class="ident" id="7841377">serverTest</span><span class="op" id="7841387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841391">name</span><span class="op" id="7841395">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841400">&#34;RSA-AES-GCM&#34;</span><span class="op" id="7841413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841417">command</span><span class="op" id="7841424">:</span>&nbsp;<span class="op" id="7841426">[</span><span class="op" id="7841427">]</span><span class="builtintype" id="7841428">string</span><span class="op" id="7841434">{</span><span class="string" id="7841435">&#34;openssl&#34;</span><span class="op" id="7841444">,</span>&nbsp;<span class="string" id="7841446">&#34;s_client&#34;</span><span class="op" id="7841456">,</span>&nbsp;<span class="string" id="7841458">&#34;-no_ticket&#34;</span><span class="op" id="7841470">,</span>&nbsp;<span class="string" id="7841472">&#34;-cipher&#34;</span><span class="op" id="7841481">,</span>&nbsp;<span class="string" id="7841483">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7841512">}</span><span class="op" id="7841513">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7841516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841519">runServerTestTLS12</span><span class="op" id="7841537">(</span><span class="ident" id="7841538">t</span><span class="op" id="7841539">,</span>&nbsp;<span class="ident" id="7841541">test</span><span class="op" id="7841545">)</span><br>
<span class="lineno"></span><span class="op" id="7841547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7841550">func</span>&nbsp;<span class="ident" id="7841555">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="7841587">(</span><span class="ident" id="7841588">t</span>&nbsp;<span class="op" id="7841590">*</span><span class="ident" id="7841591">testing</span><span class="op" id="7841598">.</span><span class="ident" id="7841599">T</span><span class="op" id="7841600">)</span>&nbsp;<span class="op" id="7841602">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841605">config</span>&nbsp;<span class="op" id="7841612">:=</span>&nbsp;<span class="op" id="7841615">*</span><span class="ident" id="7841616">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841628">config</span><span class="op" id="7841634">.</span><span class="ident" id="7841635">Certificates</span>&nbsp;<span class="op" id="7841648">=</span>&nbsp;<span class="builtinfunc" id="7841650">make</span><span class="op" id="7841654">(</span><span class="op" id="7841655">[</span><span class="op" id="7841656">]</span><span class="ident" id="7841657">Certificate</span><span class="op" id="7841668">,</span>&nbsp;<span class="num" id="7841670">1</span><span class="op" id="7841671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841674">config</span><span class="op" id="7841680">.</span><span class="ident" id="7841681">Certificates</span><span class="op" id="7841693">[</span><span class="num" id="7841694">0</span><span class="op" id="7841695">]</span><span class="op" id="7841696">.</span><span class="ident" id="7841697">Certificate</span>&nbsp;<span class="op" id="7841709">=</span>&nbsp;<span class="op" id="7841711">[</span><span class="op" id="7841712">]</span><span class="op" id="7841713">[</span><span class="op" id="7841714">]</span><span class="builtintype" id="7841715">byte</span><span class="op" id="7841719">{</span><span class="ident" id="7841720">testECDSACertificate</span><span class="op" id="7841740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841743">config</span><span class="op" id="7841749">.</span><span class="ident" id="7841750">Certificates</span><span class="op" id="7841762">[</span><span class="num" id="7841763">0</span><span class="op" id="7841764">]</span><span class="op" id="7841765">.</span><span class="ident" id="7841766">PrivateKey</span>&nbsp;<span class="op" id="7841777">=</span>&nbsp;<span class="ident" id="7841779">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841800">config</span><span class="op" id="7841806">.</span><span class="ident" id="7841807">BuildNameToCertificate</span><span class="op" id="7841829">(</span><span class="op" id="7841830">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841834">test</span>&nbsp;<span class="op" id="7841839">:=</span>&nbsp;<span class="op" id="7841842">&amp;</span><span class="ident" id="7841843">serverTest</span><span class="op" id="7841853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841857">name</span><span class="op" id="7841861">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841866">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7841883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841887">command</span><span class="op" id="7841894">:</span>&nbsp;<span class="op" id="7841896">[</span><span class="op" id="7841897">]</span><span class="builtintype" id="7841898">string</span><span class="op" id="7841904">{</span><span class="string" id="7841905">&#34;openssl&#34;</span><span class="op" id="7841914">,</span>&nbsp;<span class="string" id="7841916">&#34;s_client&#34;</span><span class="op" id="7841926">,</span>&nbsp;<span class="string" id="7841928">&#34;-no_ticket&#34;</span><span class="op" id="7841940">,</span>&nbsp;<span class="string" id="7841942">&#34;-cipher&#34;</span><span class="op" id="7841951">,</span>&nbsp;<span class="string" id="7841953">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="7841977">}</span><span class="op" id="7841978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7841982">config</span><span class="op" id="7841988">:</span>&nbsp;&nbsp;<span class="op" id="7841991">&amp;</span><span class="ident" id="7841992">config</span><span class="op" id="7841998">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842004">runServerTestTLS10</span><span class="op" id="7842022">(</span><span class="ident" id="7842023">t</span><span class="op" id="7842024">,</span>&nbsp;<span class="ident" id="7842026">test</span><span class="op" id="7842030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842033">runServerTestTLS12</span><span class="op" id="7842051">(</span><span class="ident" id="7842052">t</span><span class="op" id="7842053">,</span>&nbsp;<span class="ident" id="7842055">test</span><span class="op" id="7842059">)</span><br>
<span class="lineno"></span><span class="op" id="7842061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7842064">func</span>&nbsp;<span class="ident" id="7842069">TestHandshakeServerALPN</span><span class="op" id="7842092">(</span><span class="ident" id="7842093">t</span>&nbsp;<span class="op" id="7842095">*</span><span class="ident" id="7842096">testing</span><span class="op" id="7842103">.</span><span class="ident" id="7842104">T</span><span class="op" id="7842105">)</span>&nbsp;<span class="op" id="7842107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842110">config</span>&nbsp;<span class="op" id="7842117">:=</span>&nbsp;<span class="op" id="7842120">*</span><span class="ident" id="7842121">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842133">config</span><span class="op" id="7842139">.</span><span class="ident" id="7842140">NextProtos</span>&nbsp;<span class="op" id="7842151">=</span>&nbsp;<span class="op" id="7842153">[</span><span class="op" id="7842154">]</span><span class="builtintype" id="7842155">string</span><span class="op" id="7842161">{</span><span class="string" id="7842162">&#34;proto1&#34;</span><span class="op" id="7842170">,</span>&nbsp;<span class="string" id="7842172">&#34;proto2&#34;</span><span class="op" id="7842180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842184">test</span>&nbsp;<span class="op" id="7842189">:=</span>&nbsp;<span class="op" id="7842192">&amp;</span><span class="ident" id="7842193">serverTest</span><span class="op" id="7842203">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842207">name</span><span class="op" id="7842211">:</span>&nbsp;<span class="string" id="7842213">&#34;ALPN&#34;</span><span class="op" id="7842219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7842223">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7842289">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842332">command</span><span class="op" id="7842339">:</span>&nbsp;<span class="op" id="7842341">[</span><span class="op" id="7842342">]</span><span class="builtintype" id="7842343">string</span><span class="op" id="7842349">{</span><span class="string" id="7842350">&#34;openssl&#34;</span><span class="op" id="7842359">,</span>&nbsp;<span class="string" id="7842361">&#34;s_client&#34;</span><span class="op" id="7842371">,</span>&nbsp;<span class="string" id="7842373">&#34;-alpn&#34;</span><span class="op" id="7842380">,</span>&nbsp;<span class="string" id="7842382">&#34;proto2,proto1&#34;</span><span class="op" id="7842397">}</span><span class="op" id="7842398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842402">config</span><span class="op" id="7842408">:</span>&nbsp;&nbsp;<span class="op" id="7842411">&amp;</span><span class="ident" id="7842412">config</span><span class="op" id="7842418">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842422">validate</span><span class="op" id="7842430">:</span>&nbsp;<span class="keyword" id="7842432">func</span><span class="op" id="7842436">(</span><span class="ident" id="7842437">state</span>&nbsp;<span class="ident" id="7842443">ConnectionState</span><span class="op" id="7842458">)</span>&nbsp;<span class="builtintype" id="7842460">error</span>&nbsp;<span class="op" id="7842466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7842471">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842530">if</span>&nbsp;<span class="ident" id="7842533">state</span><span class="op" id="7842538">.</span><span class="ident" id="7842539">NegotiatedProtocol</span>&nbsp;<span class="op" id="7842558">!=</span>&nbsp;<span class="string" id="7842561">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7842570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842576">return</span>&nbsp;<span class="ident" id="7842583">fmt</span><span class="op" id="7842586">.</span><span class="ident" id="7842587">Errorf</span><span class="op" id="7842593">(</span><span class="string" id="7842594">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7842626">,</span>&nbsp;<span class="ident" id="7842628">state</span><span class="op" id="7842633">.</span><span class="ident" id="7842634">NegotiatedProtocol</span><span class="op" id="7842652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842657">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842662">return</span>&nbsp;<span class="ident" id="7842669">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842675">}</span><span class="op" id="7842676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842682">runServerTestTLS12</span><span class="op" id="7842700">(</span><span class="ident" id="7842701">t</span><span class="op" id="7842702">,</span>&nbsp;<span class="ident" id="7842704">test</span><span class="op" id="7842708">)</span><br>
<span class="lineno"></span><span class="op" id="7842710">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="7842713">func</span>&nbsp;<span class="ident" id="7842718">TestHandshakeServerALPNNoMatch</span><span class="op" id="7842748">(</span><span class="ident" id="7842749">t</span>&nbsp;<span class="op" id="7842751">*</span><span class="ident" id="7842752">testing</span><span class="op" id="7842759">.</span><span class="ident" id="7842760">T</span><span class="op" id="7842761">)</span>&nbsp;<span class="op" id="7842763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842766">config</span>&nbsp;<span class="op" id="7842773">:=</span>&nbsp;<span class="op" id="7842776">*</span><span class="ident" id="7842777">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842789">config</span><span class="op" id="7842795">.</span><span class="ident" id="7842796">NextProtos</span>&nbsp;<span class="op" id="7842807">=</span>&nbsp;<span class="op" id="7842809">[</span><span class="op" id="7842810">]</span><span class="builtintype" id="7842811">string</span><span class="op" id="7842817">{</span><span class="string" id="7842818">&#34;proto3&#34;</span><span class="op" id="7842826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842830">test</span>&nbsp;<span class="op" id="7842835">:=</span>&nbsp;<span class="op" id="7842838">&amp;</span><span class="ident" id="7842839">serverTest</span><span class="op" id="7842849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842853">name</span><span class="op" id="7842857">:</span>&nbsp;<span class="string" id="7842859">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7842873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7842877">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7842943">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842986">command</span><span class="op" id="7842993">:</span>&nbsp;<span class="op" id="7842995">[</span><span class="op" id="7842996">]</span><span class="builtintype" id="7842997">string</span><span class="op" id="7843003">{</span><span class="string" id="7843004">&#34;openssl&#34;</span><span class="op" id="7843013">,</span>&nbsp;<span class="string" id="7843015">&#34;s_client&#34;</span><span class="op" id="7843025">,</span>&nbsp;<span class="string" id="7843027">&#34;-alpn&#34;</span><span class="op" id="7843034">,</span>&nbsp;<span class="string" id="7843036">&#34;proto2,proto1&#34;</span><span class="op" id="7843051">}</span><span class="op" id="7843052">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843056">config</span><span class="op" id="7843062">:</span>&nbsp;&nbsp;<span class="op" id="7843065">&amp;</span><span class="ident" id="7843066">config</span><span class="op" id="7843072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843076">validate</span><span class="op" id="7843084">:</span>&nbsp;<span class="keyword" id="7843086">func</span><span class="op" id="7843090">(</span><span class="ident" id="7843091">state</span>&nbsp;<span class="ident" id="7843097">ConnectionState</span><span class="op" id="7843112">)</span>&nbsp;<span class="builtintype" id="7843114">error</span>&nbsp;<span class="op" id="7843120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7843125">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7843184">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843227">if</span>&nbsp;<span class="ident" id="7843230">state</span><span class="op" id="7843235">.</span><span class="ident" id="7843236">NegotiatedProtocol</span>&nbsp;<span class="op" id="7843255">!=</span>&nbsp;<span class="string" id="7843258">&#34;&#34;</span>&nbsp;<span class="op" id="7843261">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843267">return</span>&nbsp;<span class="ident" id="7843274">fmt</span><span class="op" id="7843277">.</span><span class="ident" id="7843278">Errorf</span><span class="op" id="7843284">(</span><span class="string" id="7843285">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7843313">,</span>&nbsp;<span class="ident" id="7843315">state</span><span class="op" id="7843320">.</span><span class="ident" id="7843321">NegotiatedProtocol</span><span class="op" id="7843339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843349">return</span>&nbsp;<span class="ident" id="7843356">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843362">}</span><span class="op" id="7843363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843366">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843369">runServerTestTLS12</span><span class="op" id="7843387">(</span><span class="ident" id="7843388">t</span><span class="op" id="7843389">,</span>&nbsp;<span class="ident" id="7843391">test</span><span class="op" id="7843395">)</span><br>
<span class="lineno"></span><span class="op" id="7843397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7843400">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7843472">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="7843552">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7843616">func</span>&nbsp;<span class="ident" id="7843621">TestHandshakeServerSNI</span><span class="op" id="7843643">(</span><span class="ident" id="7843644">t</span>&nbsp;<span class="op" id="7843646">*</span><span class="ident" id="7843647">testing</span><span class="op" id="7843654">.</span><span class="ident" id="7843655">T</span><span class="op" id="7843656">)</span>&nbsp;<span class="op" id="7843658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843661">test</span>&nbsp;<span class="op" id="7843666">:=</span>&nbsp;<span class="op" id="7843669">&amp;</span><span class="ident" id="7843670">serverTest</span><span class="op" id="7843680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843684">name</span><span class="op" id="7843688">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7843693">&#34;SNI&#34;</span><span class="op" id="7843698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843702">command</span><span class="op" id="7843709">:</span>&nbsp;<span class="op" id="7843711">[</span><span class="op" id="7843712">]</span><span class="builtintype" id="7843713">string</span><span class="op" id="7843719">{</span><span class="string" id="7843720">&#34;openssl&#34;</span><span class="op" id="7843729">,</span>&nbsp;<span class="string" id="7843731">&#34;s_client&#34;</span><span class="op" id="7843741">,</span>&nbsp;<span class="string" id="7843743">&#34;-no_ticket&#34;</span><span class="op" id="7843755">,</span>&nbsp;<span class="string" id="7843757">&#34;-cipher&#34;</span><span class="op" id="7843766">,</span>&nbsp;<span class="string" id="7843768">&#34;AES128-SHA&#34;</span><span class="op" id="7843780">,</span>&nbsp;<span class="string" id="7843782">&#34;-servername&#34;</span><span class="op" id="7843795">,</span>&nbsp;<span class="string" id="7843797">&#34;snitest.com&#34;</span><span class="op" id="7843810">}</span><span class="op" id="7843811">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843817">runServerTestTLS12</span><span class="op" id="7843835">(</span><span class="ident" id="7843836">t</span><span class="op" id="7843837">,</span>&nbsp;<span class="ident" id="7843839">test</span><span class="op" id="7843843">)</span><br>
<span class="lineno"></span><span class="op" id="7843845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7843848">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="7843927">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="7843970">func</span>&nbsp;<span class="ident" id="7843975">TestHandshakeServerSNIGetCertificate</span><span class="op" id="7844011">(</span><span class="ident" id="7844012">t</span>&nbsp;<span class="op" id="7844014">*</span><span class="ident" id="7844015">testing</span><span class="op" id="7844022">.</span><span class="ident" id="7844023">T</span><span class="op" id="7844024">)</span>&nbsp;<span class="op" id="7844026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844029">config</span>&nbsp;<span class="op" id="7844036">:=</span>&nbsp;<span class="op" id="7844039">*</span><span class="ident" id="7844040">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7844053">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844122">nameToCert</span>&nbsp;<span class="op" id="7844133">:=</span>&nbsp;<span class="ident" id="7844136">config</span><span class="op" id="7844142">.</span><span class="ident" id="7844143">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844162">config</span><span class="op" id="7844168">.</span><span class="ident" id="7844169">NameToCertificate</span>&nbsp;<span class="op" id="7844187">=</span>&nbsp;<span class="ident" id="7844189">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844194">config</span><span class="op" id="7844200">.</span><span class="ident" id="7844201">GetCertificate</span>&nbsp;<span class="op" id="7844216">=</span>&nbsp;<span class="keyword" id="7844218">func</span><span class="op" id="7844222">(</span><span class="ident" id="7844223">clientHello</span>&nbsp;<span class="op" id="7844235">*</span><span class="ident" id="7844236">ClientHelloInfo</span><span class="op" id="7844251">)</span>&nbsp;<span class="op" id="7844253">(</span><span class="op" id="7844254">*</span><span class="ident" id="7844255">Certificate</span><span class="op" id="7844266">,</span>&nbsp;<span class="builtintype" id="7844268">error</span><span class="op" id="7844273">)</span>&nbsp;<span class="op" id="7844275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844279">cert</span><span class="op" id="7844283">,</span>&nbsp;<span class="ident" id="7844285">_</span>&nbsp;<span class="op" id="7844287">:=</span>&nbsp;<span class="ident" id="7844290">nameToCert</span><span class="op" id="7844300">[</span><span class="ident" id="7844301">clientHello</span><span class="op" id="7844312">.</span><span class="ident" id="7844313">ServerName</span><span class="op" id="7844323">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7844327">return</span>&nbsp;<span class="ident" id="7844334">cert</span><span class="op" id="7844338">,</span>&nbsp;<span class="ident" id="7844340">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7844345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844348">test</span>&nbsp;<span class="op" id="7844353">:=</span>&nbsp;<span class="op" id="7844356">&amp;</span><span class="ident" id="7844357">serverTest</span><span class="op" id="7844367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844371">name</span><span class="op" id="7844375">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7844380">&#34;SNI&#34;</span><span class="op" id="7844385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844389">command</span><span class="op" id="7844396">:</span>&nbsp;<span class="op" id="7844398">[</span><span class="op" id="7844399">]</span><span class="builtintype" id="7844400">string</span><span class="op" id="7844406">{</span><span class="string" id="7844407">&#34;openssl&#34;</span><span class="op" id="7844416">,</span>&nbsp;<span class="string" id="7844418">&#34;s_client&#34;</span><span class="op" id="7844428">,</span>&nbsp;<span class="string" id="7844430">&#34;-no_ticket&#34;</span><span class="op" id="7844442">,</span>&nbsp;<span class="string" id="7844444">&#34;-cipher&#34;</span><span class="op" id="7844453">,</span>&nbsp;<span class="string" id="7844455">&#34;AES128-SHA&#34;</span><span class="op" id="7844467">,</span>&nbsp;<span class="string" id="7844469">&#34;-servername&#34;</span><span class="op" id="7844482">,</span>&nbsp;<span class="string" id="7844484">&#34;snitest.com&#34;</span><span class="op" id="7844497">}</span><span class="op" id="7844498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844502">config</span><span class="op" id="7844508">:</span>&nbsp;&nbsp;<span class="op" id="7844511">&amp;</span><span class="ident" id="7844512">config</span><span class="op" id="7844518">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7844521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844524">runServerTestTLS12</span><span class="op" id="7844542">(</span><span class="ident" id="7844543">t</span><span class="op" id="7844544">,</span>&nbsp;<span class="ident" id="7844546">test</span><span class="op" id="7844550">)</span><br>
<span class="lineno"></span><span class="op" id="7844552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7844555">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="7844614">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7844689">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7844763">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="7844793">func</span>&nbsp;<span class="ident" id="7844798">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="7844842">(</span><span class="ident" id="7844843">t</span>&nbsp;<span class="op" id="7844845">*</span><span class="ident" id="7844846">testing</span><span class="op" id="7844853">.</span><span class="ident" id="7844854">T</span><span class="op" id="7844855">)</span>&nbsp;<span class="op" id="7844857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844860">config</span>&nbsp;<span class="op" id="7844867">:=</span>&nbsp;<span class="op" id="7844870">*</span><span class="ident" id="7844871">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844884">config</span><span class="op" id="7844890">.</span><span class="ident" id="7844891">GetCertificate</span>&nbsp;<span class="op" id="7844906">=</span>&nbsp;<span class="keyword" id="7844908">func</span><span class="op" id="7844912">(</span><span class="ident" id="7844913">clientHello</span>&nbsp;<span class="op" id="7844925">*</span><span class="ident" id="7844926">ClientHelloInfo</span><span class="op" id="7844941">)</span>&nbsp;<span class="op" id="7844943">(</span><span class="op" id="7844944">*</span><span class="ident" id="7844945">Certificate</span><span class="op" id="7844956">,</span>&nbsp;<span class="builtintype" id="7844958">error</span><span class="op" id="7844963">)</span>&nbsp;<span class="op" id="7844965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7844969">return</span>&nbsp;<span class="ident" id="7844976">nil</span><span class="op" id="7844979">,</span>&nbsp;<span class="ident" id="7844981">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7844986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7844989">test</span>&nbsp;<span class="op" id="7844994">:=</span>&nbsp;<span class="op" id="7844997">&amp;</span><span class="ident" id="7844998">serverTest</span><span class="op" id="7845008">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845012">name</span><span class="op" id="7845016">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7845021">&#34;SNI&#34;</span><span class="op" id="7845026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845030">command</span><span class="op" id="7845037">:</span>&nbsp;<span class="op" id="7845039">[</span><span class="op" id="7845040">]</span><span class="builtintype" id="7845041">string</span><span class="op" id="7845047">{</span><span class="string" id="7845048">&#34;openssl&#34;</span><span class="op" id="7845057">,</span>&nbsp;<span class="string" id="7845059">&#34;s_client&#34;</span><span class="op" id="7845069">,</span>&nbsp;<span class="string" id="7845071">&#34;-no_ticket&#34;</span><span class="op" id="7845083">,</span>&nbsp;<span class="string" id="7845085">&#34;-cipher&#34;</span><span class="op" id="7845094">,</span>&nbsp;<span class="string" id="7845096">&#34;AES128-SHA&#34;</span><span class="op" id="7845108">,</span>&nbsp;<span class="string" id="7845110">&#34;-servername&#34;</span><span class="op" id="7845123">,</span>&nbsp;<span class="string" id="7845125">&#34;snitest.com&#34;</span><span class="op" id="7845138">}</span><span class="op" id="7845139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845143">config</span><span class="op" id="7845149">:</span>&nbsp;&nbsp;<span class="op" id="7845152">&amp;</span><span class="ident" id="7845153">config</span><span class="op" id="7845159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7845162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845165">runServerTestTLS12</span><span class="op" id="7845183">(</span><span class="ident" id="7845184">t</span><span class="op" id="7845185">,</span>&nbsp;<span class="ident" id="7845187">test</span><span class="op" id="7845191">)</span><br>
<span class="lineno">625</span><span class="op" id="7845193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7845196">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7845272">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="7845313">func</span>&nbsp;<span class="ident" id="7845318">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="7845359">(</span><span class="ident" id="7845360">t</span>&nbsp;<span class="op" id="7845362">*</span><span class="ident" id="7845363">testing</span><span class="op" id="7845370">.</span><span class="ident" id="7845371">T</span><span class="op" id="7845372">)</span>&nbsp;<span class="op" id="7845374">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845377">config</span>&nbsp;<span class="op" id="7845384">:=</span>&nbsp;<span class="op" id="7845387">*</span><span class="ident" id="7845388">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845401">config</span><span class="op" id="7845407">.</span><span class="ident" id="7845408">GetCertificate</span>&nbsp;<span class="op" id="7845423">=</span>&nbsp;<span class="keyword" id="7845425">func</span><span class="op" id="7845429">(</span><span class="ident" id="7845430">clientHello</span>&nbsp;<span class="op" id="7845442">*</span><span class="ident" id="7845443">ClientHelloInfo</span><span class="op" id="7845458">)</span>&nbsp;<span class="op" id="7845460">(</span><span class="op" id="7845461">*</span><span class="ident" id="7845462">Certificate</span><span class="op" id="7845473">,</span>&nbsp;<span class="builtintype" id="7845475">error</span><span class="op" id="7845480">)</span>&nbsp;<span class="op" id="7845482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7845486">return</span>&nbsp;<span class="ident" id="7845493">nil</span><span class="op" id="7845496">,</span>&nbsp;<span class="ident" id="7845498">fmt</span><span class="op" id="7845501">.</span><span class="ident" id="7845502">Errorf</span><span class="op" id="7845508">(</span><span class="string" id="7845509">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="7845539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7845542">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845545">test</span>&nbsp;<span class="op" id="7845550">:=</span>&nbsp;<span class="op" id="7845553">&amp;</span><span class="ident" id="7845554">serverTest</span><span class="op" id="7845564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845568">name</span><span class="op" id="7845572">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7845581">&#34;SNI&#34;</span><span class="op" id="7845586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845590">command</span><span class="op" id="7845597">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845603">[</span><span class="op" id="7845604">]</span><span class="builtintype" id="7845605">string</span><span class="op" id="7845611">{</span><span class="string" id="7845612">&#34;openssl&#34;</span><span class="op" id="7845621">,</span>&nbsp;<span class="string" id="7845623">&#34;s_client&#34;</span><span class="op" id="7845633">,</span>&nbsp;<span class="string" id="7845635">&#34;-no_ticket&#34;</span><span class="op" id="7845647">,</span>&nbsp;<span class="string" id="7845649">&#34;-cipher&#34;</span><span class="op" id="7845658">,</span>&nbsp;<span class="string" id="7845660">&#34;AES128-SHA&#34;</span><span class="op" id="7845672">,</span>&nbsp;<span class="string" id="7845674">&#34;-servername&#34;</span><span class="op" id="7845687">,</span>&nbsp;<span class="string" id="7845689">&#34;snitest.com&#34;</span><span class="op" id="7845702">}</span><span class="op" id="7845703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845707">config</span><span class="op" id="7845713">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845720">&amp;</span><span class="ident" id="7845721">config</span><span class="op" id="7845727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845731">expectAlert</span><span class="op" id="7845742">:</span>&nbsp;<span class="ident" id="7845744">true</span><span class="op" id="7845748">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7845751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845754">runServerTestTLS12</span><span class="op" id="7845772">(</span><span class="ident" id="7845773">t</span><span class="op" id="7845774">,</span>&nbsp;<span class="ident" id="7845776">test</span><span class="op" id="7845780">)</span><br>
<span class="lineno"></span><span class="op" id="7845782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7845785">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="7845865">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7845939">func</span>&nbsp;<span class="ident" id="7845944">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="7845978">(</span><span class="ident" id="7845979">t</span>&nbsp;<span class="op" id="7845981">*</span><span class="ident" id="7845982">testing</span><span class="op" id="7845989">.</span><span class="ident" id="7845990">T</span><span class="op" id="7845991">)</span>&nbsp;<span class="op" id="7845993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7845996">config</span>&nbsp;<span class="op" id="7846003">:=</span>&nbsp;<span class="op" id="7846006">*</span><span class="ident" id="7846007">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846019">config</span><span class="op" id="7846025">.</span><span class="ident" id="7846026">CipherSuites</span>&nbsp;<span class="op" id="7846039">=</span>&nbsp;<span class="op" id="7846041">[</span><span class="op" id="7846042">]</span><span class="builtintype" id="7846043">uint16</span><span class="op" id="7846049">{</span><span class="ident" id="7846050">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7846086">,</span>&nbsp;<span class="ident" id="7846088">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7846122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846125">config</span><span class="op" id="7846131">.</span><span class="ident" id="7846132">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7846157">=</span>&nbsp;<span class="ident" id="7846159">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846166">test</span>&nbsp;<span class="op" id="7846171">:=</span>&nbsp;<span class="op" id="7846174">&amp;</span><span class="ident" id="7846175">serverTest</span><span class="op" id="7846185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846189">name</span><span class="op" id="7846193">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7846197">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="7846227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846231">config</span><span class="op" id="7846237">:</span>&nbsp;<span class="op" id="7846239">&amp;</span><span class="ident" id="7846240">config</span><span class="op" id="7846246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846249">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846252">runServerTestTLS12</span><span class="op" id="7846270">(</span><span class="ident" id="7846271">t</span><span class="op" id="7846272">,</span>&nbsp;<span class="ident" id="7846274">test</span><span class="op" id="7846278">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846282">config</span>&nbsp;<span class="op" id="7846289">=</span>&nbsp;<span class="op" id="7846291">*</span><span class="ident" id="7846292">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846304">config</span><span class="op" id="7846310">.</span><span class="ident" id="7846311">CipherSuites</span>&nbsp;<span class="op" id="7846324">=</span>&nbsp;<span class="op" id="7846326">[</span><span class="op" id="7846327">]</span><span class="builtintype" id="7846328">uint16</span><span class="op" id="7846334">{</span><span class="ident" id="7846335">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7846369">,</span>&nbsp;<span class="ident" id="7846371">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7846407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846410">config</span><span class="op" id="7846416">.</span><span class="ident" id="7846417">Certificates</span>&nbsp;<span class="op" id="7846430">=</span>&nbsp;<span class="op" id="7846432">[</span><span class="op" id="7846433">]</span><span class="ident" id="7846434">Certificate</span><span class="op" id="7846445">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846454">Certificate</span><span class="op" id="7846465">:</span>&nbsp;<span class="op" id="7846467">[</span><span class="op" id="7846468">]</span><span class="op" id="7846469">[</span><span class="op" id="7846470">]</span><span class="builtintype" id="7846471">byte</span><span class="op" id="7846475">{</span><span class="ident" id="7846476">testECDSACertificate</span><span class="op" id="7846496">}</span><span class="op" id="7846497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846502">PrivateKey</span><span class="op" id="7846512">:</span>&nbsp;&nbsp;<span class="ident" id="7846515">testECDSAPrivateKey</span><span class="op" id="7846534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846538">}</span><span class="op" id="7846539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846542">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846545">config</span><span class="op" id="7846551">.</span><span class="ident" id="7846552">BuildNameToCertificate</span><span class="op" id="7846574">(</span><span class="op" id="7846575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846578">config</span><span class="op" id="7846584">.</span><span class="ident" id="7846585">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7846610">=</span>&nbsp;<span class="ident" id="7846612">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846619">test</span>&nbsp;<span class="op" id="7846624">=</span>&nbsp;<span class="op" id="7846626">&amp;</span><span class="ident" id="7846627">serverTest</span><span class="op" id="7846637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846641">name</span><span class="op" id="7846645">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7846649">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="7846681">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846685">config</span><span class="op" id="7846691">:</span>&nbsp;<span class="op" id="7846693">&amp;</span><span class="ident" id="7846694">config</span><span class="op" id="7846700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846706">runServerTestTLS12</span><span class="op" id="7846724">(</span><span class="ident" id="7846725">t</span><span class="op" id="7846726">,</span>&nbsp;<span class="ident" id="7846728">test</span><span class="op" id="7846732">)</span><br>
<span class="lineno"></span><span class="op" id="7846734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="7846737">func</span>&nbsp;<span class="ident" id="7846742">TestResumption</span><span class="op" id="7846756">(</span><span class="ident" id="7846757">t</span>&nbsp;<span class="op" id="7846759">*</span><span class="ident" id="7846760">testing</span><span class="op" id="7846767">.</span><span class="ident" id="7846768">T</span><span class="op" id="7846769">)</span>&nbsp;<span class="op" id="7846771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846774">sessionFilePath</span>&nbsp;<span class="op" id="7846790">:=</span>&nbsp;<span class="ident" id="7846793">tempFile</span><span class="op" id="7846801">(</span><span class="string" id="7846802">&#34;&#34;</span><span class="op" id="7846804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7846807">defer</span>&nbsp;<span class="ident" id="7846813">os</span><span class="op" id="7846815">.</span><span class="ident" id="7846816">Remove</span><span class="op" id="7846822">(</span><span class="ident" id="7846823">sessionFilePath</span><span class="op" id="7846838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846842">test</span>&nbsp;<span class="op" id="7846847">:=</span>&nbsp;<span class="op" id="7846850">&amp;</span><span class="ident" id="7846851">serverTest</span><span class="op" id="7846861">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846865">name</span><span class="op" id="7846869">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7846874">&#34;IssueTicket&#34;</span><span class="op" id="7846887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846891">command</span><span class="op" id="7846898">:</span>&nbsp;<span class="op" id="7846900">[</span><span class="op" id="7846901">]</span><span class="builtintype" id="7846902">string</span><span class="op" id="7846908">{</span><span class="string" id="7846909">&#34;openssl&#34;</span><span class="op" id="7846918">,</span>&nbsp;<span class="string" id="7846920">&#34;s_client&#34;</span><span class="op" id="7846930">,</span>&nbsp;<span class="string" id="7846932">&#34;-cipher&#34;</span><span class="op" id="7846941">,</span>&nbsp;<span class="string" id="7846943">&#34;RC4-SHA&#34;</span><span class="op" id="7846952">,</span>&nbsp;<span class="string" id="7846954">&#34;-sess_out&#34;</span><span class="op" id="7846965">,</span>&nbsp;<span class="ident" id="7846967">sessionFilePath</span><span class="op" id="7846982">}</span><span class="op" id="7846983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7846986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7846989">runServerTestTLS12</span><span class="op" id="7847007">(</span><span class="ident" id="7847008">t</span><span class="op" id="7847009">,</span>&nbsp;<span class="ident" id="7847011">test</span><span class="op" id="7847015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847019">test</span>&nbsp;<span class="op" id="7847024">=</span>&nbsp;<span class="op" id="7847026">&amp;</span><span class="ident" id="7847027">serverTest</span><span class="op" id="7847037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847041">name</span><span class="op" id="7847045">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7847050">&#34;Resume&#34;</span><span class="op" id="7847058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847062">command</span><span class="op" id="7847069">:</span>&nbsp;<span class="op" id="7847071">[</span><span class="op" id="7847072">]</span><span class="builtintype" id="7847073">string</span><span class="op" id="7847079">{</span><span class="string" id="7847080">&#34;openssl&#34;</span><span class="op" id="7847089">,</span>&nbsp;<span class="string" id="7847091">&#34;s_client&#34;</span><span class="op" id="7847101">,</span>&nbsp;<span class="string" id="7847103">&#34;-cipher&#34;</span><span class="op" id="7847112">,</span>&nbsp;<span class="string" id="7847114">&#34;RC4-SHA&#34;</span><span class="op" id="7847123">,</span>&nbsp;<span class="string" id="7847125">&#34;-sess_in&#34;</span><span class="op" id="7847135">,</span>&nbsp;<span class="ident" id="7847137">sessionFilePath</span><span class="op" id="7847152">}</span><span class="op" id="7847153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7847156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847159">runServerTestTLS12</span><span class="op" id="7847177">(</span><span class="ident" id="7847178">t</span><span class="op" id="7847179">,</span>&nbsp;<span class="ident" id="7847181">test</span><span class="op" id="7847185">)</span><br>
<span class="lineno">690</span><span class="op" id="7847187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7847190">func</span>&nbsp;<span class="ident" id="7847195">TestResumptionDisabled</span><span class="op" id="7847217">(</span><span class="ident" id="7847218">t</span>&nbsp;<span class="op" id="7847220">*</span><span class="ident" id="7847221">testing</span><span class="op" id="7847228">.</span><span class="ident" id="7847229">T</span><span class="op" id="7847230">)</span>&nbsp;<span class="op" id="7847232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847235">sessionFilePath</span>&nbsp;<span class="op" id="7847251">:=</span>&nbsp;<span class="ident" id="7847254">tempFile</span><span class="op" id="7847262">(</span><span class="string" id="7847263">&#34;&#34;</span><span class="op" id="7847265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7847268">defer</span>&nbsp;<span class="ident" id="7847274">os</span><span class="op" id="7847276">.</span><span class="ident" id="7847277">Remove</span><span class="op" id="7847283">(</span><span class="ident" id="7847284">sessionFilePath</span><span class="op" id="7847299">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847303">config</span>&nbsp;<span class="op" id="7847310">:=</span>&nbsp;<span class="op" id="7847313">*</span><span class="ident" id="7847314">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847327">test</span>&nbsp;<span class="op" id="7847332">:=</span>&nbsp;<span class="op" id="7847335">&amp;</span><span class="ident" id="7847336">serverTest</span><span class="op" id="7847346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847350">name</span><span class="op" id="7847354">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7847359">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="7847382">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847386">command</span><span class="op" id="7847393">:</span>&nbsp;<span class="op" id="7847395">[</span><span class="op" id="7847396">]</span><span class="builtintype" id="7847397">string</span><span class="op" id="7847403">{</span><span class="string" id="7847404">&#34;openssl&#34;</span><span class="op" id="7847413">,</span>&nbsp;<span class="string" id="7847415">&#34;s_client&#34;</span><span class="op" id="7847425">,</span>&nbsp;<span class="string" id="7847427">&#34;-cipher&#34;</span><span class="op" id="7847436">,</span>&nbsp;<span class="string" id="7847438">&#34;RC4-SHA&#34;</span><span class="op" id="7847447">,</span>&nbsp;<span class="string" id="7847449">&#34;-sess_out&#34;</span><span class="op" id="7847460">,</span>&nbsp;<span class="ident" id="7847462">sessionFilePath</span><span class="op" id="7847477">}</span><span class="op" id="7847478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847482">config</span><span class="op" id="7847488">:</span>&nbsp;&nbsp;<span class="op" id="7847491">&amp;</span><span class="ident" id="7847492">config</span><span class="op" id="7847498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7847501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847504">runServerTestTLS12</span><span class="op" id="7847522">(</span><span class="ident" id="7847523">t</span><span class="op" id="7847524">,</span>&nbsp;<span class="ident" id="7847526">test</span><span class="op" id="7847530">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847534">config</span><span class="op" id="7847540">.</span><span class="ident" id="7847541">SessionTicketsDisabled</span>&nbsp;<span class="op" id="7847564">=</span>&nbsp;<span class="ident" id="7847566">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847573">test</span>&nbsp;<span class="op" id="7847578">=</span>&nbsp;<span class="op" id="7847580">&amp;</span><span class="ident" id="7847581">serverTest</span><span class="op" id="7847591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847595">name</span><span class="op" id="7847599">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7847604">&#34;ResumeDisabled&#34;</span><span class="op" id="7847620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847624">command</span><span class="op" id="7847631">:</span>&nbsp;<span class="op" id="7847633">[</span><span class="op" id="7847634">]</span><span class="builtintype" id="7847635">string</span><span class="op" id="7847641">{</span><span class="string" id="7847642">&#34;openssl&#34;</span><span class="op" id="7847651">,</span>&nbsp;<span class="string" id="7847653">&#34;s_client&#34;</span><span class="op" id="7847663">,</span>&nbsp;<span class="string" id="7847665">&#34;-cipher&#34;</span><span class="op" id="7847674">,</span>&nbsp;<span class="string" id="7847676">&#34;RC4-SHA&#34;</span><span class="op" id="7847685">,</span>&nbsp;<span class="string" id="7847687">&#34;-sess_in&#34;</span><span class="op" id="7847697">,</span>&nbsp;<span class="ident" id="7847699">sessionFilePath</span><span class="op" id="7847714">}</span><span class="op" id="7847715">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847719">config</span><span class="op" id="7847725">:</span>&nbsp;&nbsp;<span class="op" id="7847728">&amp;</span><span class="ident" id="7847729">config</span><span class="op" id="7847735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7847738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847741">runServerTestTLS12</span><span class="op" id="7847759">(</span><span class="ident" id="7847760">t</span><span class="op" id="7847761">,</span>&nbsp;<span class="ident" id="7847763">test</span><span class="op" id="7847767">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7847771">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7847843">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="7847911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7847914">func</span>&nbsp;<span class="ident" id="7847919">TestFallbackSCSV</span><span class="op" id="7847935">(</span><span class="ident" id="7847936">t</span>&nbsp;<span class="op" id="7847938">*</span><span class="ident" id="7847939">testing</span><span class="op" id="7847946">.</span><span class="ident" id="7847947">T</span><span class="op" id="7847948">)</span>&nbsp;<span class="op" id="7847950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847953">test</span>&nbsp;<span class="op" id="7847958">:=</span>&nbsp;<span class="op" id="7847961">&amp;</span><span class="ident" id="7847962">serverTest</span><span class="op" id="7847972">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7847976">name</span><span class="op" id="7847980">:</span>&nbsp;<span class="string" id="7847982">&#34;FallbackSCSV&#34;</span><span class="op" id="7847996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7848000">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848061">command</span><span class="op" id="7848068">:</span>&nbsp;<span class="op" id="7848070">[</span><span class="op" id="7848071">]</span><span class="builtintype" id="7848072">string</span><span class="op" id="7848078">{</span><span class="string" id="7848079">&#34;openssl&#34;</span><span class="op" id="7848088">,</span>&nbsp;<span class="string" id="7848090">&#34;s_client&#34;</span><span class="op" id="7848100">,</span>&nbsp;<span class="string" id="7848102">&#34;-fallback_scsv&#34;</span><span class="op" id="7848118">}</span><span class="op" id="7848119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848123">expectHandshakeErrorIncluding</span><span class="op" id="7848152">:</span>&nbsp;<span class="string" id="7848154">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="7848186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7848189">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848192">runServerTestTLS11</span><span class="op" id="7848210">(</span><span class="ident" id="7848211">t</span><span class="op" id="7848212">,</span>&nbsp;<span class="ident" id="7848214">test</span><span class="op" id="7848218">)</span><br>
<span class="lineno"></span><span class="op" id="7848220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7848223">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="7848284">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="7848346">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7848382">const</span>&nbsp;<span class="ident" id="7848388">clientCertificatePEM</span>&nbsp;<span class="op" id="7848409">=</span>&nbsp;<span class="string" id="7848411">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7849144">const</span>&nbsp;<span class="ident" id="7849150">clientKeyPEM</span>&nbsp;<span class="op" id="7849163">=</span>&nbsp;<span class="string" id="7849165">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7850052">const</span>&nbsp;<span class="ident" id="7850058">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="7850084">=</span>&nbsp;<span class="string" id="7850086">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7850839">const</span>&nbsp;<span class="ident" id="7850845">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="7850863">=</span>&nbsp;<span class="string" id="7850865">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="7851305">func</span>&nbsp;<span class="ident" id="7851310">TestClientAuth</span><span class="op" id="7851324">(</span><span class="ident" id="7851325">t</span>&nbsp;<span class="op" id="7851327">*</span><span class="ident" id="7851328">testing</span><span class="op" id="7851335">.</span><span class="ident" id="7851336">T</span><span class="op" id="7851337">)</span>&nbsp;<span class="op" id="7851339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851342">var</span>&nbsp;<span class="ident" id="7851346">certPath</span><span class="op" id="7851354">,</span>&nbsp;<span class="ident" id="7851356">keyPath</span><span class="op" id="7851363">,</span>&nbsp;<span class="ident" id="7851365">ecdsaCertPath</span><span class="op" id="7851378">,</span>&nbsp;<span class="ident" id="7851380">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="7851393">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851402">if</span>&nbsp;<span class="op" id="7851405">*</span><span class="ident" id="7851406">update</span>&nbsp;<span class="op" id="7851413">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851417">certPath</span>&nbsp;<span class="op" id="7851426">=</span>&nbsp;<span class="ident" id="7851428">tempFile</span><span class="op" id="7851436">(</span><span class="ident" id="7851437">clientCertificatePEM</span><span class="op" id="7851457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851461">defer</span>&nbsp;<span class="ident" id="7851467">os</span><span class="op" id="7851469">.</span><span class="ident" id="7851470">Remove</span><span class="op" id="7851476">(</span><span class="ident" id="7851477">certPath</span><span class="op" id="7851485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851489">keyPath</span>&nbsp;<span class="op" id="7851497">=</span>&nbsp;<span class="ident" id="7851499">tempFile</span><span class="op" id="7851507">(</span><span class="ident" id="7851508">clientKeyPEM</span><span class="op" id="7851520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851524">defer</span>&nbsp;<span class="ident" id="7851530">os</span><span class="op" id="7851532">.</span><span class="ident" id="7851533">Remove</span><span class="op" id="7851539">(</span><span class="ident" id="7851540">keyPath</span><span class="op" id="7851547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851551">ecdsaCertPath</span>&nbsp;<span class="op" id="7851565">=</span>&nbsp;<span class="ident" id="7851567">tempFile</span><span class="op" id="7851575">(</span><span class="ident" id="7851576">clientECDSACertificatePEM</span><span class="op" id="7851601">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851605">defer</span>&nbsp;<span class="ident" id="7851611">os</span><span class="op" id="7851613">.</span><span class="ident" id="7851614">Remove</span><span class="op" id="7851620">(</span><span class="ident" id="7851621">ecdsaCertPath</span><span class="op" id="7851634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851638">ecdsaKeyPath</span>&nbsp;<span class="op" id="7851651">=</span>&nbsp;<span class="ident" id="7851653">tempFile</span><span class="op" id="7851661">(</span><span class="ident" id="7851662">clientECDSAKeyPEM</span><span class="op" id="7851679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851683">defer</span>&nbsp;<span class="ident" id="7851689">os</span><span class="op" id="7851691">.</span><span class="ident" id="7851692">Remove</span><span class="op" id="7851698">(</span><span class="ident" id="7851699">ecdsaKeyPath</span><span class="op" id="7851711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7851714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851718">config</span>&nbsp;<span class="op" id="7851725">:=</span>&nbsp;<span class="op" id="7851728">*</span><span class="ident" id="7851729">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851741">config</span><span class="op" id="7851747">.</span><span class="ident" id="7851748">ClientAuth</span>&nbsp;<span class="op" id="7851759">=</span>&nbsp;<span class="ident" id="7851761">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851781">test</span>&nbsp;<span class="op" id="7851786">:=</span>&nbsp;<span class="op" id="7851789">&amp;</span><span class="ident" id="7851790">serverTest</span><span class="op" id="7851800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851804">name</span><span class="op" id="7851808">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7851813">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="7851842">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851846">command</span><span class="op" id="7851853">:</span>&nbsp;<span class="op" id="7851855">[</span><span class="op" id="7851856">]</span><span class="builtintype" id="7851857">string</span><span class="op" id="7851863">{</span><span class="string" id="7851864">&#34;openssl&#34;</span><span class="op" id="7851873">,</span>&nbsp;<span class="string" id="7851875">&#34;s_client&#34;</span><span class="op" id="7851885">,</span>&nbsp;<span class="string" id="7851887">&#34;-no_ticket&#34;</span><span class="op" id="7851899">,</span>&nbsp;<span class="string" id="7851901">&#34;-cipher&#34;</span><span class="op" id="7851910">,</span>&nbsp;<span class="string" id="7851912">&#34;RC4-SHA&#34;</span><span class="op" id="7851921">}</span><span class="op" id="7851922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851926">config</span><span class="op" id="7851932">:</span>&nbsp;&nbsp;<span class="op" id="7851935">&amp;</span><span class="ident" id="7851936">config</span><span class="op" id="7851942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7851945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851948">runServerTestTLS12</span><span class="op" id="7851966">(</span><span class="ident" id="7851967">t</span><span class="op" id="7851968">,</span>&nbsp;<span class="ident" id="7851970">test</span><span class="op" id="7851974">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851978">test</span>&nbsp;<span class="op" id="7851983">=</span>&nbsp;<span class="op" id="7851985">&amp;</span><span class="ident" id="7851986">serverTest</span><span class="op" id="7851996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852000">name</span><span class="op" id="7852004">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7852019">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="7852048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852052">command</span><span class="op" id="7852059">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7852071">[</span><span class="op" id="7852072">]</span><span class="builtintype" id="7852073">string</span><span class="op" id="7852079">{</span><span class="string" id="7852080">&#34;openssl&#34;</span><span class="op" id="7852089">,</span>&nbsp;<span class="string" id="7852091">&#34;s_client&#34;</span><span class="op" id="7852101">,</span>&nbsp;<span class="string" id="7852103">&#34;-no_ticket&#34;</span><span class="op" id="7852115">,</span>&nbsp;<span class="string" id="7852117">&#34;-cipher&#34;</span><span class="op" id="7852126">,</span>&nbsp;<span class="string" id="7852128">&#34;RC4-SHA&#34;</span><span class="op" id="7852137">,</span>&nbsp;<span class="string" id="7852139">&#34;-cert&#34;</span><span class="op" id="7852146">,</span>&nbsp;<span class="ident" id="7852148">certPath</span><span class="op" id="7852156">,</span>&nbsp;<span class="string" id="7852158">&#34;-key&#34;</span><span class="op" id="7852164">,</span>&nbsp;<span class="ident" id="7852166">keyPath</span><span class="op" id="7852173">}</span><span class="op" id="7852174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852178">config</span><span class="op" id="7852184">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7852197">&amp;</span><span class="ident" id="7852198">config</span><span class="op" id="7852204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852208">expectedPeerCerts</span><span class="op" id="7852225">:</span>&nbsp;<span class="op" id="7852227">[</span><span class="op" id="7852228">]</span><span class="builtintype" id="7852229">string</span><span class="op" id="7852235">{</span><span class="ident" id="7852236">clientCertificatePEM</span><span class="op" id="7852256">}</span><span class="op" id="7852257">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7852260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852263">runServerTestTLS12</span><span class="op" id="7852281">(</span><span class="ident" id="7852282">t</span><span class="op" id="7852283">,</span>&nbsp;<span class="ident" id="7852285">test</span><span class="op" id="7852289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852293">test</span>&nbsp;<span class="op" id="7852298">=</span>&nbsp;<span class="op" id="7852300">&amp;</span><span class="ident" id="7852301">serverTest</span><span class="op" id="7852311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852315">name</span><span class="op" id="7852319">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7852334">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="7852368">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852372">command</span><span class="op" id="7852379">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7852391">[</span><span class="op" id="7852392">]</span><span class="builtintype" id="7852393">string</span><span class="op" id="7852399">{</span><span class="string" id="7852400">&#34;openssl&#34;</span><span class="op" id="7852409">,</span>&nbsp;<span class="string" id="7852411">&#34;s_client&#34;</span><span class="op" id="7852421">,</span>&nbsp;<span class="string" id="7852423">&#34;-no_ticket&#34;</span><span class="op" id="7852435">,</span>&nbsp;<span class="string" id="7852437">&#34;-cipher&#34;</span><span class="op" id="7852446">,</span>&nbsp;<span class="string" id="7852448">&#34;RC4-SHA&#34;</span><span class="op" id="7852457">,</span>&nbsp;<span class="string" id="7852459">&#34;-cert&#34;</span><span class="op" id="7852466">,</span>&nbsp;<span class="ident" id="7852468">ecdsaCertPath</span><span class="op" id="7852481">,</span>&nbsp;<span class="string" id="7852483">&#34;-key&#34;</span><span class="op" id="7852489">,</span>&nbsp;<span class="ident" id="7852491">ecdsaKeyPath</span><span class="op" id="7852503">}</span><span class="op" id="7852504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852508">config</span><span class="op" id="7852514">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7852527">&amp;</span><span class="ident" id="7852528">config</span><span class="op" id="7852534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852538">expectedPeerCerts</span><span class="op" id="7852555">:</span>&nbsp;<span class="op" id="7852557">[</span><span class="op" id="7852558">]</span><span class="builtintype" id="7852559">string</span><span class="op" id="7852565">{</span><span class="ident" id="7852566">clientECDSACertificatePEM</span><span class="op" id="7852591">}</span><span class="op" id="7852592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7852595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852598">runServerTestTLS12</span><span class="op" id="7852616">(</span><span class="ident" id="7852617">t</span><span class="op" id="7852618">,</span>&nbsp;<span class="ident" id="7852620">test</span><span class="op" id="7852624">)</span><br>
<span class="lineno">830</span><span class="op" id="7852626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7852629">func</span>&nbsp;<span class="ident" id="7852634">bigFromString</span><span class="op" id="7852647">(</span><span class="ident" id="7852648">s</span>&nbsp;<span class="builtintype" id="7852650">string</span><span class="op" id="7852656">)</span>&nbsp;<span class="op" id="7852658">*</span><span class="ident" id="7852659">big</span><span class="op" id="7852662">.</span><span class="ident" id="7852663">Int</span>&nbsp;<span class="op" id="7852667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852670">ret</span>&nbsp;<span class="op" id="7852674">:=</span>&nbsp;<span class="builtinfunc" id="7852677">new</span><span class="op" id="7852680">(</span><span class="ident" id="7852681">big</span><span class="op" id="7852684">.</span><span class="ident" id="7852685">Int</span><span class="op" id="7852688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852691">ret</span><span class="op" id="7852694">.</span><span class="ident" id="7852695">SetString</span><span class="op" id="7852704">(</span><span class="ident" id="7852705">s</span><span class="op" id="7852706">,</span>&nbsp;<span class="num" id="7852708">10</span><span class="op" id="7852710">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7852713">return</span>&nbsp;<span class="ident" id="7852720">ret</span><br>
<span class="lineno"></span><span class="op" id="7852724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7852727">func</span>&nbsp;<span class="ident" id="7852732">fromHex</span><span class="op" id="7852739">(</span><span class="ident" id="7852740">s</span>&nbsp;<span class="builtintype" id="7852742">string</span><span class="op" id="7852748">)</span>&nbsp;<span class="op" id="7852750">[</span><span class="op" id="7852751">]</span><span class="builtintype" id="7852752">byte</span>&nbsp;<span class="op" id="7852757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852760">b</span><span class="op" id="7852761">,</span>&nbsp;<span class="ident" id="7852763">_</span>&nbsp;<span class="op" id="7852765">:=</span>&nbsp;<span class="ident" id="7852768">hex</span><span class="op" id="7852771">.</span><span class="ident" id="7852772">DecodeString</span><span class="op" id="7852784">(</span><span class="ident" id="7852785">s</span><span class="op" id="7852786">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7852789">return</span>&nbsp;<span class="ident" id="7852796">b</span><br>
<span class="lineno"></span><span class="op" id="7852798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7852801">var</span>&nbsp;<span class="ident" id="7852805">testRSACertificate</span>&nbsp;<span class="op" id="7852824">=</span>&nbsp;<span class="ident" id="7852826">fromHex</span><span class="op" id="7852833">(</span><span class="string" id="7852834">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="7854220">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="7854223">var</span>&nbsp;<span class="ident" id="7854227">testECDSACertificate</span>&nbsp;<span class="op" id="7854248">=</span>&nbsp;<span class="ident" id="7854250">fromHex</span><span class="op" id="7854257">(</span><span class="string" id="7854258">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="7855292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7855295">var</span>&nbsp;<span class="ident" id="7855299">testSNICertificate</span>&nbsp;<span class="op" id="7855318">=</span>&nbsp;<span class="ident" id="7855320">fromHex</span><span class="op" id="7855327">(</span><span class="string" id="7855328">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="7856334">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7856337">var</span>&nbsp;<span class="ident" id="7856341">testRSAPrivateKey</span>&nbsp;<span class="op" id="7856359">=</span>&nbsp;<span class="op" id="7856361">&amp;</span><span class="ident" id="7856362">rsa</span><span class="op" id="7856365">.</span><span class="ident" id="7856366">PrivateKey</span><span class="op" id="7856376">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7856379">PublicKey</span><span class="op" id="7856388">:</span>&nbsp;<span class="ident" id="7856390">rsa</span><span class="op" id="7856393">.</span><span class="ident" id="7856394">PublicKey</span><span class="op" id="7856403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7856407">N</span><span class="op" id="7856408">:</span>&nbsp;<span class="ident" id="7856410">bigFromString</span><span class="op" id="7856423">(</span><span class="string" id="7856424">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="7856735">)</span><span class="op" id="7856736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7856740">E</span><span class="op" id="7856741">:</span>&nbsp;<span class="num" id="7856743">65537</span><span class="op" id="7856748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7856751">}</span><span class="op" id="7856752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7856755">D</span><span class="op" id="7856756">:</span>&nbsp;<span class="ident" id="7856758">bigFromString</span><span class="op" id="7856771">(</span><span class="string" id="7856772">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="7857082">)</span><span class="op" id="7857083">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7857086">Primes</span><span class="op" id="7857092">:</span>&nbsp;<span class="op" id="7857094">[</span><span class="op" id="7857095">]</span><span class="op" id="7857096">*</span><span class="ident" id="7857097">big</span><span class="op" id="7857100">.</span><span class="ident" id="7857101">Int</span><span class="op" id="7857104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7857108">bigFromString</span><span class="op" id="7857121">(</span><span class="string" id="7857122">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="7857279">)</span><span class="op" id="7857280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7857284">bigFromString</span><span class="op" id="7857297">(</span><span class="string" id="7857298">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="7857455">)</span><span class="op" id="7857456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7857459">}</span><span class="op" id="7857460">,</span><br>
<span class="lineno"></span><span class="op" id="7857462">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="7857465">var</span>&nbsp;<span class="ident" id="7857469">testECDSAPrivateKey</span>&nbsp;<span class="op" id="7857489">=</span>&nbsp;<span class="op" id="7857491">&amp;</span><span class="ident" id="7857492">ecdsa</span><span class="op" id="7857497">.</span><span class="ident" id="7857498">PrivateKey</span><span class="op" id="7857508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7857511">PublicKey</span><span class="op" id="7857520">:</span>&nbsp;<span class="ident" id="7857522">ecdsa</span><span class="op" id="7857527">.</span><span class="ident" id="7857528">PublicKey</span><span class="op" id="7857537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7857541">Curve</span><span class="op" id="7857546">:</span>&nbsp;<span class="ident" id="7857548">elliptic</span><span class="op" id="7857556">.</span><span class="ident" id="7857557">P521</span><span class="op" id="7857561">(</span><span class="op" id="7857562">)</span><span class="op" id="7857563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7857567">X</span><span class="op" id="7857568">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857574">bigFromString</span><span class="op" id="7857587">(</span><span class="string" id="7857588">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="7857747">)</span><span class="op" id="7857748">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7857752">Y</span><span class="op" id="7857753">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7857759">bigFromString</span><span class="op" id="7857772">(</span><span class="string" id="7857773">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="7857932">)</span><span class="op" id="7857933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7857936">}</span><span class="op" id="7857937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7857940">D</span><span class="op" id="7857941">:</span>&nbsp;<span class="ident" id="7857943">bigFromString</span><span class="op" id="7857956">(</span><span class="string" id="7857957">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="7858116">)</span><span class="op" id="7858117">,</span><br>
<span class="lineno"></span><span class="op" id="7858119">}</span>
</div>
</body>
</html>
