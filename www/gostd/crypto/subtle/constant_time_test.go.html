<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7231126">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7231181">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7231235">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7231286">package</span>&nbsp;<span class="ident" id="7231294">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7231302">import</span>&nbsp;<span class="op" id="7231309">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7231312">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7231323">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="7231339">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7231342">type</span>&nbsp;<span class="ident" id="7231347">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="7231377">struct</span>&nbsp;<span class="op" id="7231384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7231387">a</span><span class="op" id="7231388">,</span>&nbsp;<span class="ident" id="7231390">b</span>&nbsp;<span class="op" id="7231392">[</span><span class="op" id="7231393">]</span><span class="builtintype" id="7231394">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7231400">out</span>&nbsp;&nbsp;<span class="builtintype" id="7231405">int</span><br>
<span class="lineno">15</span><span class="op" id="7231409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7231412">var</span>&nbsp;<span class="ident" id="7231416">testConstantTimeCompareData</span>&nbsp;<span class="op" id="7231444">=</span>&nbsp;<span class="op" id="7231446">[</span><span class="op" id="7231447">]</span><span class="ident" id="7231448">TestConstantTimeCompareStruct</span><span class="op" id="7231477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7231480">{</span><span class="op" id="7231481">[</span><span class="op" id="7231482">]</span><span class="builtintype" id="7231483">byte</span><span class="op" id="7231487">{</span><span class="op" id="7231488">}</span><span class="op" id="7231489">,</span>&nbsp;<span class="op" id="7231491">[</span><span class="op" id="7231492">]</span><span class="builtintype" id="7231493">byte</span><span class="op" id="7231497">{</span><span class="op" id="7231498">}</span><span class="op" id="7231499">,</span>&nbsp;<span class="num" id="7231501">1</span><span class="op" id="7231502">}</span><span class="op" id="7231503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7231506">{</span><span class="op" id="7231507">[</span><span class="op" id="7231508">]</span><span class="builtintype" id="7231509">byte</span><span class="op" id="7231513">{</span><span class="num" id="7231514">0x11</span><span class="op" id="7231518">}</span><span class="op" id="7231519">,</span>&nbsp;<span class="op" id="7231521">[</span><span class="op" id="7231522">]</span><span class="builtintype" id="7231523">byte</span><span class="op" id="7231527">{</span><span class="num" id="7231528">0x11</span><span class="op" id="7231532">}</span><span class="op" id="7231533">,</span>&nbsp;<span class="num" id="7231535">1</span><span class="op" id="7231536">}</span><span class="op" id="7231537">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7231540">{</span><span class="op" id="7231541">[</span><span class="op" id="7231542">]</span><span class="builtintype" id="7231543">byte</span><span class="op" id="7231547">{</span><span class="num" id="7231548">0x12</span><span class="op" id="7231552">}</span><span class="op" id="7231553">,</span>&nbsp;<span class="op" id="7231555">[</span><span class="op" id="7231556">]</span><span class="builtintype" id="7231557">byte</span><span class="op" id="7231561">{</span><span class="num" id="7231562">0x11</span><span class="op" id="7231566">}</span><span class="op" id="7231567">,</span>&nbsp;<span class="num" id="7231569">0</span><span class="op" id="7231570">}</span><span class="op" id="7231571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7231574">{</span><span class="op" id="7231575">[</span><span class="op" id="7231576">]</span><span class="builtintype" id="7231577">byte</span><span class="op" id="7231581">{</span><span class="num" id="7231582">0x11</span><span class="op" id="7231586">}</span><span class="op" id="7231587">,</span>&nbsp;<span class="op" id="7231589">[</span><span class="op" id="7231590">]</span><span class="builtintype" id="7231591">byte</span><span class="op" id="7231595">{</span><span class="num" id="7231596">0x11</span><span class="op" id="7231600">,</span>&nbsp;<span class="num" id="7231602">0x12</span><span class="op" id="7231606">}</span><span class="op" id="7231607">,</span>&nbsp;<span class="num" id="7231609">0</span><span class="op" id="7231610">}</span><span class="op" id="7231611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7231614">{</span><span class="op" id="7231615">[</span><span class="op" id="7231616">]</span><span class="builtintype" id="7231617">byte</span><span class="op" id="7231621">{</span><span class="num" id="7231622">0x11</span><span class="op" id="7231626">,</span>&nbsp;<span class="num" id="7231628">0x12</span><span class="op" id="7231632">}</span><span class="op" id="7231633">,</span>&nbsp;<span class="op" id="7231635">[</span><span class="op" id="7231636">]</span><span class="builtintype" id="7231637">byte</span><span class="op" id="7231641">{</span><span class="num" id="7231642">0x11</span><span class="op" id="7231646">}</span><span class="op" id="7231647">,</span>&nbsp;<span class="num" id="7231649">0</span><span class="op" id="7231650">}</span><span class="op" id="7231651">,</span><br>
<span class="lineno"></span><span class="op" id="7231653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7231656">func</span>&nbsp;<span class="ident" id="7231661">TestConstantTimeCompare</span><span class="op" id="7231684">(</span><span class="ident" id="7231685">t</span>&nbsp;<span class="op" id="7231687">*</span><span class="ident" id="7231688">testing</span><span class="op" id="7231695">.</span><span class="ident" id="7231696">T</span><span class="op" id="7231697">)</span>&nbsp;<span class="op" id="7231699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7231702">for</span>&nbsp;<span class="ident" id="7231706">i</span><span class="op" id="7231707">,</span>&nbsp;<span class="ident" id="7231709">test</span>&nbsp;<span class="op" id="7231714">:=</span>&nbsp;<span class="keyword" id="7231717">range</span>&nbsp;<span class="ident" id="7231723">testConstantTimeCompareData</span>&nbsp;<span class="op" id="7231751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7231755">if</span>&nbsp;<span class="ident" id="7231758">r</span>&nbsp;<span class="op" id="7231760">:=</span>&nbsp;<span class="ident" id="7231763">ConstantTimeCompare</span><span class="op" id="7231782">(</span><span class="ident" id="7231783">test</span><span class="op" id="7231787">.</span><span class="ident" id="7231788">a</span><span class="op" id="7231789">,</span>&nbsp;<span class="ident" id="7231791">test</span><span class="op" id="7231795">.</span><span class="ident" id="7231796">b</span><span class="op" id="7231797">)</span><span class="op" id="7231798">;</span>&nbsp;<span class="ident" id="7231800">r</span>&nbsp;<span class="op" id="7231802">!=</span>&nbsp;<span class="ident" id="7231805">test</span><span class="op" id="7231809">.</span><span class="ident" id="7231810">out</span>&nbsp;<span class="op" id="7231814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7231819">t</span><span class="op" id="7231820">.</span><span class="ident" id="7231821">Errorf</span><span class="op" id="7231827">(</span><span class="string" id="7231828">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="7231862">,</span>&nbsp;<span class="ident" id="7231864">i</span><span class="op" id="7231865">,</span>&nbsp;<span class="ident" id="7231867">r</span><span class="op" id="7231868">,</span>&nbsp;<span class="ident" id="7231870">test</span><span class="op" id="7231874">.</span><span class="ident" id="7231875">out</span><span class="op" id="7231878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7231882">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7231885">}</span><br>
<span class="lineno"></span><span class="op" id="7231887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7231890">type</span>&nbsp;<span class="ident" id="7231895">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="7231924">struct</span>&nbsp;<span class="op" id="7231931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7231934">a</span><span class="op" id="7231935">,</span>&nbsp;<span class="ident" id="7231937">b</span>&nbsp;<span class="builtintype" id="7231939">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7231946">out</span>&nbsp;&nbsp;<span class="builtintype" id="7231951">int</span><br>
<span class="lineno"></span><span class="op" id="7231955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7231958">var</span>&nbsp;<span class="ident" id="7231962">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="7231989">=</span>&nbsp;<span class="op" id="7231991">[</span><span class="op" id="7231992">]</span><span class="ident" id="7231993">TestConstantTimeByteEqStruct</span><span class="op" id="7232021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232024">{</span><span class="num" id="7232025">0</span><span class="op" id="7232026">,</span>&nbsp;<span class="num" id="7232028">0</span><span class="op" id="7232029">,</span>&nbsp;<span class="num" id="7232031">1</span><span class="op" id="7232032">}</span><span class="op" id="7232033">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232036">{</span><span class="num" id="7232037">0</span><span class="op" id="7232038">,</span>&nbsp;<span class="num" id="7232040">1</span><span class="op" id="7232041">,</span>&nbsp;<span class="num" id="7232043">0</span><span class="op" id="7232044">}</span><span class="op" id="7232045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232048">{</span><span class="num" id="7232049">1</span><span class="op" id="7232050">,</span>&nbsp;<span class="num" id="7232052">0</span><span class="op" id="7232053">,</span>&nbsp;<span class="num" id="7232055">0</span><span class="op" id="7232056">}</span><span class="op" id="7232057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232060">{</span><span class="num" id="7232061">0xff</span><span class="op" id="7232065">,</span>&nbsp;<span class="num" id="7232067">0xff</span><span class="op" id="7232071">,</span>&nbsp;<span class="num" id="7232073">1</span><span class="op" id="7232074">}</span><span class="op" id="7232075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232078">{</span><span class="num" id="7232079">0xff</span><span class="op" id="7232083">,</span>&nbsp;<span class="num" id="7232085">0xfe</span><span class="op" id="7232089">,</span>&nbsp;<span class="num" id="7232091">0</span><span class="op" id="7232092">}</span><span class="op" id="7232093">,</span><br>
<span class="lineno"></span><span class="op" id="7232095">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7232098">func</span>&nbsp;<span class="ident" id="7232103">byteEq</span><span class="op" id="7232109">(</span><span class="ident" id="7232110">a</span><span class="op" id="7232111">,</span>&nbsp;<span class="ident" id="7232113">b</span>&nbsp;<span class="builtintype" id="7232115">uint8</span><span class="op" id="7232120">)</span>&nbsp;<span class="builtintype" id="7232122">int</span>&nbsp;<span class="op" id="7232126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232129">if</span>&nbsp;<span class="ident" id="7232132">a</span>&nbsp;<span class="op" id="7232134">==</span>&nbsp;<span class="ident" id="7232137">b</span>&nbsp;<span class="op" id="7232139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232143">return</span>&nbsp;<span class="num" id="7232150">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232153">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232156">return</span>&nbsp;<span class="num" id="7232163">0</span><br>
<span class="lineno"></span><span class="op" id="7232165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7232168">func</span>&nbsp;<span class="ident" id="7232173">TestConstantTimeByteEq</span><span class="op" id="7232195">(</span><span class="ident" id="7232196">t</span>&nbsp;<span class="op" id="7232198">*</span><span class="ident" id="7232199">testing</span><span class="op" id="7232206">.</span><span class="ident" id="7232207">T</span><span class="op" id="7232208">)</span>&nbsp;<span class="op" id="7232210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232213">for</span>&nbsp;<span class="ident" id="7232217">i</span><span class="op" id="7232218">,</span>&nbsp;<span class="ident" id="7232220">test</span>&nbsp;<span class="op" id="7232225">:=</span>&nbsp;<span class="keyword" id="7232228">range</span>&nbsp;<span class="ident" id="7232234">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="7232261">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232265">if</span>&nbsp;<span class="ident" id="7232268">r</span>&nbsp;<span class="op" id="7232270">:=</span>&nbsp;<span class="ident" id="7232273">ConstantTimeByteEq</span><span class="op" id="7232291">(</span><span class="ident" id="7232292">test</span><span class="op" id="7232296">.</span><span class="ident" id="7232297">a</span><span class="op" id="7232298">,</span>&nbsp;<span class="ident" id="7232300">test</span><span class="op" id="7232304">.</span><span class="ident" id="7232305">b</span><span class="op" id="7232306">)</span><span class="op" id="7232307">;</span>&nbsp;<span class="ident" id="7232309">r</span>&nbsp;<span class="op" id="7232311">!=</span>&nbsp;<span class="ident" id="7232314">test</span><span class="op" id="7232318">.</span><span class="ident" id="7232319">out</span>&nbsp;<span class="op" id="7232323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7232328">t</span><span class="op" id="7232329">.</span><span class="ident" id="7232330">Errorf</span><span class="op" id="7232336">(</span><span class="string" id="7232337">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="7232371">,</span>&nbsp;<span class="ident" id="7232373">i</span><span class="op" id="7232374">,</span>&nbsp;<span class="ident" id="7232376">r</span><span class="op" id="7232377">,</span>&nbsp;<span class="ident" id="7232379">test</span><span class="op" id="7232383">.</span><span class="ident" id="7232384">out</span><span class="op" id="7232387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7232397">err</span>&nbsp;<span class="op" id="7232401">:=</span>&nbsp;<span class="ident" id="7232404">quick</span><span class="op" id="7232409">.</span><span class="ident" id="7232410">CheckEqual</span><span class="op" id="7232420">(</span><span class="ident" id="7232421">ConstantTimeByteEq</span><span class="op" id="7232439">,</span>&nbsp;<span class="ident" id="7232441">byteEq</span><span class="op" id="7232447">,</span>&nbsp;<span class="ident" id="7232449">nil</span><span class="op" id="7232452">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232455">if</span>&nbsp;<span class="ident" id="7232458">err</span>&nbsp;<span class="op" id="7232462">!=</span>&nbsp;<span class="ident" id="7232465">nil</span>&nbsp;<span class="op" id="7232469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7232473">t</span><span class="op" id="7232474">.</span><span class="ident" id="7232475">Error</span><span class="op" id="7232480">(</span><span class="ident" id="7232481">err</span><span class="op" id="7232484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232487">}</span><br>
<span class="lineno"></span><span class="op" id="7232489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7232492">func</span>&nbsp;<span class="ident" id="7232497">eq</span><span class="op" id="7232499">(</span><span class="ident" id="7232500">a</span><span class="op" id="7232501">,</span>&nbsp;<span class="ident" id="7232503">b</span>&nbsp;<span class="builtintype" id="7232505">int32</span><span class="op" id="7232510">)</span>&nbsp;<span class="builtintype" id="7232512">int</span>&nbsp;<span class="op" id="7232516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232519">if</span>&nbsp;<span class="ident" id="7232522">a</span>&nbsp;<span class="op" id="7232524">==</span>&nbsp;<span class="ident" id="7232527">b</span>&nbsp;<span class="op" id="7232529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232533">return</span>&nbsp;<span class="num" id="7232540">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232546">return</span>&nbsp;<span class="num" id="7232553">0</span><br>
<span class="lineno">70</span><span class="op" id="7232555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7232558">func</span>&nbsp;<span class="ident" id="7232563">TestConstantTimeEq</span><span class="op" id="7232581">(</span><span class="ident" id="7232582">t</span>&nbsp;<span class="op" id="7232584">*</span><span class="ident" id="7232585">testing</span><span class="op" id="7232592">.</span><span class="ident" id="7232593">T</span><span class="op" id="7232594">)</span>&nbsp;<span class="op" id="7232596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7232599">err</span>&nbsp;<span class="op" id="7232603">:=</span>&nbsp;<span class="ident" id="7232606">quick</span><span class="op" id="7232611">.</span><span class="ident" id="7232612">CheckEqual</span><span class="op" id="7232622">(</span><span class="ident" id="7232623">ConstantTimeEq</span><span class="op" id="7232637">,</span>&nbsp;<span class="ident" id="7232639">eq</span><span class="op" id="7232641">,</span>&nbsp;<span class="ident" id="7232643">nil</span><span class="op" id="7232646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232649">if</span>&nbsp;<span class="ident" id="7232652">err</span>&nbsp;<span class="op" id="7232656">!=</span>&nbsp;<span class="ident" id="7232659">nil</span>&nbsp;<span class="op" id="7232663">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7232667">t</span><span class="op" id="7232668">.</span><span class="ident" id="7232669">Error</span><span class="op" id="7232674">(</span><span class="ident" id="7232675">err</span><span class="op" id="7232678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232681">}</span><br>
<span class="lineno"></span><span class="op" id="7232683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7232686">func</span>&nbsp;<span class="ident" id="7232691">makeCopy</span><span class="op" id="7232699">(</span><span class="ident" id="7232700">v</span>&nbsp;<span class="builtintype" id="7232702">int</span><span class="op" id="7232705">,</span>&nbsp;<span class="ident" id="7232707">x</span><span class="op" id="7232708">,</span>&nbsp;<span class="ident" id="7232710">y</span>&nbsp;<span class="op" id="7232712">[</span><span class="op" id="7232713">]</span><span class="builtintype" id="7232714">byte</span><span class="op" id="7232718">)</span>&nbsp;<span class="op" id="7232720">[</span><span class="op" id="7232721">]</span><span class="builtintype" id="7232722">byte</span>&nbsp;<span class="op" id="7232727">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232730">if</span>&nbsp;<span class="builtinfunc" id="7232733">len</span><span class="op" id="7232736">(</span><span class="ident" id="7232737">x</span><span class="op" id="7232738">)</span>&nbsp;<span class="op" id="7232740">&gt;</span>&nbsp;<span class="builtinfunc" id="7232742">len</span><span class="op" id="7232745">(</span><span class="ident" id="7232746">y</span><span class="op" id="7232747">)</span>&nbsp;<span class="op" id="7232749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7232753">x</span>&nbsp;<span class="op" id="7232755">=</span>&nbsp;<span class="ident" id="7232757">x</span><span class="op" id="7232758">[</span><span class="num" id="7232759">0</span><span class="op" id="7232760">:</span><span class="builtinfunc" id="7232761">len</span><span class="op" id="7232764">(</span><span class="ident" id="7232765">y</span><span class="op" id="7232766">)</span><span class="op" id="7232767">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232770">}</span>&nbsp;<span class="keyword" id="7232772">else</span>&nbsp;<span class="op" id="7232777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7232781">y</span>&nbsp;<span class="op" id="7232783">=</span>&nbsp;<span class="ident" id="7232785">y</span><span class="op" id="7232786">[</span><span class="num" id="7232787">0</span><span class="op" id="7232788">:</span><span class="builtinfunc" id="7232789">len</span><span class="op" id="7232792">(</span><span class="ident" id="7232793">x</span><span class="op" id="7232794">)</span><span class="op" id="7232795">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232798">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232801">if</span>&nbsp;<span class="ident" id="7232804">v</span>&nbsp;<span class="op" id="7232806">==</span>&nbsp;<span class="num" id="7232809">1</span>&nbsp;<span class="op" id="7232811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7232815">copy</span><span class="op" id="7232819">(</span><span class="ident" id="7232820">x</span><span class="op" id="7232821">,</span>&nbsp;<span class="ident" id="7232823">y</span><span class="op" id="7232824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232830">return</span>&nbsp;<span class="ident" id="7232837">x</span><br>
<span class="lineno"></span><span class="op" id="7232839">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="7232842">func</span>&nbsp;<span class="ident" id="7232847">constantTimeCopyWrapper</span><span class="op" id="7232870">(</span><span class="ident" id="7232871">v</span>&nbsp;<span class="builtintype" id="7232873">int</span><span class="op" id="7232876">,</span>&nbsp;<span class="ident" id="7232878">x</span><span class="op" id="7232879">,</span>&nbsp;<span class="ident" id="7232881">y</span>&nbsp;<span class="op" id="7232883">[</span><span class="op" id="7232884">]</span><span class="builtintype" id="7232885">byte</span><span class="op" id="7232889">)</span>&nbsp;<span class="op" id="7232891">[</span><span class="op" id="7232892">]</span><span class="builtintype" id="7232893">byte</span>&nbsp;<span class="op" id="7232898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7232901">if</span>&nbsp;<span class="builtinfunc" id="7232904">len</span><span class="op" id="7232907">(</span><span class="ident" id="7232908">x</span><span class="op" id="7232909">)</span>&nbsp;<span class="op" id="7232911">&gt;</span>&nbsp;<span class="builtinfunc" id="7232913">len</span><span class="op" id="7232916">(</span><span class="ident" id="7232917">y</span><span class="op" id="7232918">)</span>&nbsp;<span class="op" id="7232920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7232924">x</span>&nbsp;<span class="op" id="7232926">=</span>&nbsp;<span class="ident" id="7232928">x</span><span class="op" id="7232929">[</span><span class="num" id="7232930">0</span><span class="op" id="7232931">:</span><span class="builtinfunc" id="7232932">len</span><span class="op" id="7232935">(</span><span class="ident" id="7232936">y</span><span class="op" id="7232937">)</span><span class="op" id="7232938">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232941">}</span>&nbsp;<span class="keyword" id="7232943">else</span>&nbsp;<span class="op" id="7232948">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7232952">y</span>&nbsp;<span class="op" id="7232954">=</span>&nbsp;<span class="ident" id="7232956">y</span><span class="op" id="7232957">[</span><span class="num" id="7232958">0</span><span class="op" id="7232959">:</span><span class="builtinfunc" id="7232960">len</span><span class="op" id="7232963">(</span><span class="ident" id="7232964">x</span><span class="op" id="7232965">)</span><span class="op" id="7232966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7232969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7232972">v</span>&nbsp;<span class="op" id="7232974">&amp;=</span>&nbsp;<span class="num" id="7232977">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7232980">ConstantTimeCopy</span><span class="op" id="7232996">(</span><span class="ident" id="7232997">v</span><span class="op" id="7232998">,</span>&nbsp;<span class="ident" id="7233000">x</span><span class="op" id="7233001">,</span>&nbsp;<span class="ident" id="7233003">y</span><span class="op" id="7233004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7233007">return</span>&nbsp;<span class="ident" id="7233014">x</span><br>
<span class="lineno">100</span><span class="op" id="7233016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7233019">func</span>&nbsp;<span class="ident" id="7233024">TestConstantTimeCopy</span><span class="op" id="7233044">(</span><span class="ident" id="7233045">t</span>&nbsp;<span class="op" id="7233047">*</span><span class="ident" id="7233048">testing</span><span class="op" id="7233055">.</span><span class="ident" id="7233056">T</span><span class="op" id="7233057">)</span>&nbsp;<span class="op" id="7233059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7233062">err</span>&nbsp;<span class="op" id="7233066">:=</span>&nbsp;<span class="ident" id="7233069">quick</span><span class="op" id="7233074">.</span><span class="ident" id="7233075">CheckEqual</span><span class="op" id="7233085">(</span><span class="ident" id="7233086">constantTimeCopyWrapper</span><span class="op" id="7233109">,</span>&nbsp;<span class="ident" id="7233111">makeCopy</span><span class="op" id="7233119">,</span>&nbsp;<span class="ident" id="7233121">nil</span><span class="op" id="7233124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7233127">if</span>&nbsp;<span class="ident" id="7233130">err</span>&nbsp;<span class="op" id="7233134">!=</span>&nbsp;<span class="ident" id="7233137">nil</span>&nbsp;<span class="op" id="7233141">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7233145">t</span><span class="op" id="7233146">.</span><span class="ident" id="7233147">Error</span><span class="op" id="7233152">(</span><span class="ident" id="7233153">err</span><span class="op" id="7233156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233159">}</span><br>
<span class="lineno"></span><span class="op" id="7233161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7233164">var</span>&nbsp;<span class="ident" id="7233168">lessOrEqTests</span>&nbsp;<span class="op" id="7233182">=</span>&nbsp;<span class="op" id="7233184">[</span><span class="op" id="7233185">]</span><span class="keyword" id="7233186">struct</span>&nbsp;<span class="op" id="7233193">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7233196">x</span><span class="op" id="7233197">,</span>&nbsp;<span class="ident" id="7233199">y</span><span class="op" id="7233200">,</span>&nbsp;<span class="ident" id="7233202">result</span>&nbsp;<span class="builtintype" id="7233209">int</span><br>
<span class="lineno"></span><span class="op" id="7233213">}</span><span class="op" id="7233214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233217">{</span><span class="num" id="7233218">0</span><span class="op" id="7233219">,</span>&nbsp;<span class="num" id="7233221">0</span><span class="op" id="7233222">,</span>&nbsp;<span class="num" id="7233224">1</span><span class="op" id="7233225">}</span><span class="op" id="7233226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233229">{</span><span class="num" id="7233230">1</span><span class="op" id="7233231">,</span>&nbsp;<span class="num" id="7233233">0</span><span class="op" id="7233234">,</span>&nbsp;<span class="num" id="7233236">0</span><span class="op" id="7233237">}</span><span class="op" id="7233238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233241">{</span><span class="num" id="7233242">0</span><span class="op" id="7233243">,</span>&nbsp;<span class="num" id="7233245">1</span><span class="op" id="7233246">,</span>&nbsp;<span class="num" id="7233248">1</span><span class="op" id="7233249">}</span><span class="op" id="7233250">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233253">{</span><span class="num" id="7233254">10</span><span class="op" id="7233256">,</span>&nbsp;<span class="num" id="7233258">20</span><span class="op" id="7233260">,</span>&nbsp;<span class="num" id="7233262">1</span><span class="op" id="7233263">}</span><span class="op" id="7233264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233267">{</span><span class="num" id="7233268">20</span><span class="op" id="7233270">,</span>&nbsp;<span class="num" id="7233272">10</span><span class="op" id="7233274">,</span>&nbsp;<span class="num" id="7233276">0</span><span class="op" id="7233277">}</span><span class="op" id="7233278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233281">{</span><span class="num" id="7233282">10</span><span class="op" id="7233284">,</span>&nbsp;<span class="num" id="7233286">10</span><span class="op" id="7233288">,</span>&nbsp;<span class="num" id="7233290">1</span><span class="op" id="7233291">}</span><span class="op" id="7233292">,</span><br>
<span class="lineno"></span><span class="op" id="7233294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7233297">func</span>&nbsp;<span class="ident" id="7233302">TestConstantTimeLessOrEq</span><span class="op" id="7233326">(</span><span class="ident" id="7233327">t</span>&nbsp;<span class="op" id="7233329">*</span><span class="ident" id="7233330">testing</span><span class="op" id="7233337">.</span><span class="ident" id="7233338">T</span><span class="op" id="7233339">)</span>&nbsp;<span class="op" id="7233341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7233344">for</span>&nbsp;<span class="ident" id="7233348">i</span><span class="op" id="7233349">,</span>&nbsp;<span class="ident" id="7233351">test</span>&nbsp;<span class="op" id="7233356">:=</span>&nbsp;<span class="keyword" id="7233359">range</span>&nbsp;<span class="ident" id="7233365">lessOrEqTests</span>&nbsp;<span class="op" id="7233379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7233383">result</span>&nbsp;<span class="op" id="7233390">:=</span>&nbsp;<span class="ident" id="7233393">ConstantTimeLessOrEq</span><span class="op" id="7233413">(</span><span class="ident" id="7233414">test</span><span class="op" id="7233418">.</span><span class="ident" id="7233419">x</span><span class="op" id="7233420">,</span>&nbsp;<span class="ident" id="7233422">test</span><span class="op" id="7233426">.</span><span class="ident" id="7233427">y</span><span class="op" id="7233428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7233432">if</span>&nbsp;<span class="ident" id="7233435">result</span>&nbsp;<span class="op" id="7233442">!=</span>&nbsp;<span class="ident" id="7233445">test</span><span class="op" id="7233449">.</span><span class="ident" id="7233450">result</span>&nbsp;<span class="op" id="7233457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7233462">t</span><span class="op" id="7233463">.</span><span class="ident" id="7233464">Errorf</span><span class="op" id="7233470">(</span><span class="string" id="7233471">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7233507">,</span>&nbsp;<span class="ident" id="7233509">i</span><span class="op" id="7233510">,</span>&nbsp;<span class="ident" id="7233512">test</span><span class="op" id="7233516">.</span><span class="ident" id="7233517">x</span><span class="op" id="7233518">,</span>&nbsp;<span class="ident" id="7233520">test</span><span class="op" id="7233524">.</span><span class="ident" id="7233525">y</span><span class="op" id="7233526">,</span>&nbsp;<span class="ident" id="7233528">result</span><span class="op" id="7233534">,</span>&nbsp;<span class="ident" id="7233536">test</span><span class="op" id="7233540">.</span><span class="ident" id="7233541">result</span><span class="op" id="7233547">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7233554">}</span><br>
<span class="lineno"></span><span class="op" id="7233556">}</span>
</div>
</body>
</html>
