<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5954167">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5954222">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5954276">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5954327">package</span>&nbsp;<span class="ident" id="5954335">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5954340">import</span>&nbsp;<span class="op" id="5954347">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5954350">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5954368">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5954378">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5954384">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5954397">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5954404">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5954407">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5954468">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5954534">type</span>&nbsp;<span class="ident" id="5954539">Compressor</span>&nbsp;<span class="keyword" id="5954550">func</span><span class="op" id="5954554">(</span><span class="ident" id="5954555">io</span><span class="op" id="5954557">.</span><span class="ident" id="5954558">Writer</span><span class="op" id="5954564">)</span>&nbsp;<span class="op" id="5954566">(</span><span class="ident" id="5954567">io</span><span class="op" id="5954569">.</span><span class="ident" id="5954570">WriteCloser</span><span class="op" id="5954581">,</span>&nbsp;<span class="builtintype" id="5954583">error</span><span class="op" id="5954588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5954591">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="5954670">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5954744">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="5954822">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="5954856">type</span>&nbsp;<span class="ident" id="5954861">Decompressor</span>&nbsp;<span class="keyword" id="5954874">func</span><span class="op" id="5954878">(</span><span class="ident" id="5954879">io</span><span class="op" id="5954881">.</span><span class="ident" id="5954882">Reader</span><span class="op" id="5954888">)</span>&nbsp;<span class="ident" id="5954890">io</span><span class="op" id="5954892">.</span><span class="ident" id="5954893">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5954905">var</span>&nbsp;<span class="ident" id="5954909">flateWriterPool</span>&nbsp;<span class="ident" id="5954925">sync</span><span class="op" id="5954929">.</span><span class="ident" id="5954930">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5954936">func</span>&nbsp;<span class="ident" id="5954941">newFlateWriter</span><span class="op" id="5954955">(</span><span class="ident" id="5954956">w</span>&nbsp;<span class="ident" id="5954958">io</span><span class="op" id="5954960">.</span><span class="ident" id="5954961">Writer</span><span class="op" id="5954967">)</span>&nbsp;<span class="ident" id="5954969">io</span><span class="op" id="5954971">.</span><span class="ident" id="5954972">WriteCloser</span>&nbsp;<span class="op" id="5954984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954987">fw</span><span class="op" id="5954989">,</span>&nbsp;<span class="ident" id="5954991">ok</span>&nbsp;<span class="op" id="5954994">:=</span>&nbsp;<span class="ident" id="5954997">flateWriterPool</span><span class="op" id="5955012">.</span><span class="ident" id="5955013">Get</span><span class="op" id="5955016">(</span><span class="op" id="5955017">)</span><span class="op" id="5955018">.</span><span class="op" id="5955019">(</span><span class="op" id="5955020">*</span><span class="ident" id="5955021">flate</span><span class="op" id="5955026">.</span><span class="ident" id="5955027">Writer</span><span class="op" id="5955033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955036">if</span>&nbsp;<span class="ident" id="5955039">ok</span>&nbsp;<span class="op" id="5955042">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955046">fw</span><span class="op" id="5955048">.</span><span class="ident" id="5955049">Reset</span><span class="op" id="5955054">(</span><span class="ident" id="5955055">w</span><span class="op" id="5955056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955059">}</span>&nbsp;<span class="keyword" id="5955061">else</span>&nbsp;<span class="op" id="5955066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955070">fw</span><span class="op" id="5955072">,</span>&nbsp;<span class="ident" id="5955074">_</span>&nbsp;<span class="op" id="5955076">=</span>&nbsp;<span class="ident" id="5955078">flate</span><span class="op" id="5955083">.</span><span class="ident" id="5955084">NewWriter</span><span class="op" id="5955093">(</span><span class="ident" id="5955094">w</span><span class="op" id="5955095">,</span>&nbsp;<span class="num" id="5955097">5</span><span class="op" id="5955098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955104">return</span>&nbsp;<span class="op" id="5955111">&amp;</span><span class="ident" id="5955112">pooledFlateWriter</span><span class="op" id="5955129">{</span><span class="ident" id="5955130">fw</span><span class="op" id="5955132">:</span>&nbsp;<span class="ident" id="5955134">fw</span><span class="op" id="5955136">}</span><br>
<span class="lineno">35</span><span class="op" id="5955138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5955141">type</span>&nbsp;<span class="ident" id="5955146">pooledFlateWriter</span>&nbsp;<span class="keyword" id="5955164">struct</span>&nbsp;<span class="op" id="5955171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955174">mu</span>&nbsp;<span class="ident" id="5955177">sync</span><span class="op" id="5955181">.</span><span class="ident" id="5955182">Mutex</span>&nbsp;<span class="comment" id="5955188">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955215">fw</span>&nbsp;<span class="op" id="5955218">*</span><span class="ident" id="5955219">flate</span><span class="op" id="5955224">.</span><span class="ident" id="5955225">Writer</span><br>
<span class="lineno">40</span><span class="op" id="5955232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5955235">func</span>&nbsp;<span class="op" id="5955240">(</span><span class="ident" id="5955241">w</span>&nbsp;<span class="op" id="5955243">*</span><span class="ident" id="5955244">pooledFlateWriter</span><span class="op" id="5955261">)</span>&nbsp;<span class="ident" id="5955263">Write</span><span class="op" id="5955268">(</span><span class="ident" id="5955269">p</span>&nbsp;<span class="op" id="5955271">[</span><span class="op" id="5955272">]</span><span class="builtintype" id="5955273">byte</span><span class="op" id="5955277">)</span>&nbsp;<span class="op" id="5955279">(</span><span class="ident" id="5955280">n</span>&nbsp;<span class="builtintype" id="5955282">int</span><span class="op" id="5955285">,</span>&nbsp;<span class="ident" id="5955287">err</span>&nbsp;<span class="builtintype" id="5955291">error</span><span class="op" id="5955296">)</span>&nbsp;<span class="op" id="5955298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955301">w</span><span class="op" id="5955302">.</span><span class="ident" id="5955303">mu</span><span class="op" id="5955305">.</span><span class="ident" id="5955306">Lock</span><span class="op" id="5955310">(</span><span class="op" id="5955311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955314">defer</span>&nbsp;<span class="ident" id="5955320">w</span><span class="op" id="5955321">.</span><span class="ident" id="5955322">mu</span><span class="op" id="5955324">.</span><span class="ident" id="5955325">Unlock</span><span class="op" id="5955331">(</span><span class="op" id="5955332">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955335">if</span>&nbsp;<span class="ident" id="5955338">w</span><span class="op" id="5955339">.</span><span class="ident" id="5955340">fw</span>&nbsp;<span class="op" id="5955343">==</span>&nbsp;<span class="ident" id="5955346">nil</span>&nbsp;<span class="op" id="5955350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955354">return</span>&nbsp;<span class="num" id="5955361">0</span><span class="op" id="5955362">,</span>&nbsp;<span class="ident" id="5955364">errors</span><span class="op" id="5955370">.</span><span class="ident" id="5955371">New</span><span class="op" id="5955374">(</span><span class="string" id="5955375">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="5955394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955400">return</span>&nbsp;<span class="ident" id="5955407">w</span><span class="op" id="5955408">.</span><span class="ident" id="5955409">fw</span><span class="op" id="5955411">.</span><span class="ident" id="5955412">Write</span><span class="op" id="5955417">(</span><span class="ident" id="5955418">p</span><span class="op" id="5955419">)</span><br>
<span class="lineno"></span><span class="op" id="5955421">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5955424">func</span>&nbsp;<span class="op" id="5955429">(</span><span class="ident" id="5955430">w</span>&nbsp;<span class="op" id="5955432">*</span><span class="ident" id="5955433">pooledFlateWriter</span><span class="op" id="5955450">)</span>&nbsp;<span class="ident" id="5955452">Close</span><span class="op" id="5955457">(</span><span class="op" id="5955458">)</span>&nbsp;<span class="builtintype" id="5955460">error</span>&nbsp;<span class="op" id="5955466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955469">w</span><span class="op" id="5955470">.</span><span class="ident" id="5955471">mu</span><span class="op" id="5955473">.</span><span class="ident" id="5955474">Lock</span><span class="op" id="5955478">(</span><span class="op" id="5955479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955482">defer</span>&nbsp;<span class="ident" id="5955488">w</span><span class="op" id="5955489">.</span><span class="ident" id="5955490">mu</span><span class="op" id="5955492">.</span><span class="ident" id="5955493">Unlock</span><span class="op" id="5955499">(</span><span class="op" id="5955500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955503">var</span>&nbsp;<span class="ident" id="5955507">err</span>&nbsp;<span class="builtintype" id="5955511">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955518">if</span>&nbsp;<span class="ident" id="5955521">w</span><span class="op" id="5955522">.</span><span class="ident" id="5955523">fw</span>&nbsp;<span class="op" id="5955526">!=</span>&nbsp;<span class="ident" id="5955529">nil</span>&nbsp;<span class="op" id="5955533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955537">err</span>&nbsp;<span class="op" id="5955541">=</span>&nbsp;<span class="ident" id="5955543">w</span><span class="op" id="5955544">.</span><span class="ident" id="5955545">fw</span><span class="op" id="5955547">.</span><span class="ident" id="5955548">Close</span><span class="op" id="5955553">(</span><span class="op" id="5955554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955558">flateWriterPool</span><span class="op" id="5955573">.</span><span class="ident" id="5955574">Put</span><span class="op" id="5955577">(</span><span class="ident" id="5955578">w</span><span class="op" id="5955579">.</span><span class="ident" id="5955580">fw</span><span class="op" id="5955582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955586">w</span><span class="op" id="5955587">.</span><span class="ident" id="5955588">fw</span>&nbsp;<span class="op" id="5955591">=</span>&nbsp;<span class="ident" id="5955593">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955598">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955601">return</span>&nbsp;<span class="ident" id="5955608">err</span><br>
<span class="lineno"></span><span class="op" id="5955612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5955615">var</span>&nbsp;<span class="op" id="5955619">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955622">mu</span>&nbsp;<span class="ident" id="5955625">sync</span><span class="op" id="5955629">.</span><span class="ident" id="5955630">RWMutex</span>&nbsp;<span class="comment" id="5955638">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955683">compressors</span>&nbsp;<span class="op" id="5955695">=</span>&nbsp;<span class="keyword" id="5955697">map</span><span class="op" id="5955700">[</span><span class="builtintype" id="5955701">uint16</span><span class="op" id="5955707">]</span><span class="ident" id="5955708">Compressor</span><span class="op" id="5955718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955722">Store</span><span class="op" id="5955727">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955731">func</span><span class="op" id="5955735">(</span><span class="ident" id="5955736">w</span>&nbsp;<span class="ident" id="5955738">io</span><span class="op" id="5955740">.</span><span class="ident" id="5955741">Writer</span><span class="op" id="5955747">)</span>&nbsp;<span class="op" id="5955749">(</span><span class="ident" id="5955750">io</span><span class="op" id="5955752">.</span><span class="ident" id="5955753">WriteCloser</span><span class="op" id="5955764">,</span>&nbsp;<span class="builtintype" id="5955766">error</span><span class="op" id="5955771">)</span>&nbsp;<span class="op" id="5955773">{</span>&nbsp;<span class="keyword" id="5955775">return</span>&nbsp;<span class="op" id="5955782">&amp;</span><span class="ident" id="5955783">nopCloser</span><span class="op" id="5955792">{</span><span class="ident" id="5955793">w</span><span class="op" id="5955794">}</span><span class="op" id="5955795">,</span>&nbsp;<span class="ident" id="5955797">nil</span>&nbsp;<span class="op" id="5955801">}</span><span class="op" id="5955802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955806">Deflate</span><span class="op" id="5955813">:</span>&nbsp;<span class="keyword" id="5955815">func</span><span class="op" id="5955819">(</span><span class="ident" id="5955820">w</span>&nbsp;<span class="ident" id="5955822">io</span><span class="op" id="5955824">.</span><span class="ident" id="5955825">Writer</span><span class="op" id="5955831">)</span>&nbsp;<span class="op" id="5955833">(</span><span class="ident" id="5955834">io</span><span class="op" id="5955836">.</span><span class="ident" id="5955837">WriteCloser</span><span class="op" id="5955848">,</span>&nbsp;<span class="builtintype" id="5955850">error</span><span class="op" id="5955855">)</span>&nbsp;<span class="op" id="5955857">{</span>&nbsp;<span class="keyword" id="5955859">return</span>&nbsp;<span class="ident" id="5955866">newFlateWriter</span><span class="op" id="5955880">(</span><span class="ident" id="5955881">w</span><span class="op" id="5955882">)</span><span class="op" id="5955883">,</span>&nbsp;<span class="ident" id="5955885">nil</span>&nbsp;<span class="op" id="5955889">}</span><span class="op" id="5955890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955893">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955897">decompressors</span>&nbsp;<span class="op" id="5955911">=</span>&nbsp;<span class="keyword" id="5955913">map</span><span class="op" id="5955916">[</span><span class="builtintype" id="5955917">uint16</span><span class="op" id="5955923">]</span><span class="ident" id="5955924">Decompressor</span><span class="op" id="5955936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955940">Store</span><span class="op" id="5955945">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5955949">ioutil</span><span class="op" id="5955955">.</span><span class="ident" id="5955956">NopCloser</span><span class="op" id="5955965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955969">Deflate</span><span class="op" id="5955976">:</span>&nbsp;<span class="ident" id="5955978">flate</span><span class="op" id="5955983">.</span><span class="ident" id="5955984">NewReader</span><span class="op" id="5955993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955996">}</span><br>
<span class="lineno">75</span><span class="op" id="5955998">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5956001">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="5956080">func</span>&nbsp;<span class="ident" id="5956085">RegisterDecompressor</span><span class="op" id="5956105">(</span><span class="ident" id="5956106">method</span>&nbsp;<span class="builtintype" id="5956113">uint16</span><span class="op" id="5956119">,</span>&nbsp;<span class="ident" id="5956121">d</span>&nbsp;<span class="ident" id="5956123">Decompressor</span><span class="op" id="5956135">)</span>&nbsp;<span class="op" id="5956137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956140">mu</span><span class="op" id="5956142">.</span><span class="ident" id="5956143">Lock</span><span class="op" id="5956147">(</span><span class="op" id="5956148">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956151">defer</span>&nbsp;<span class="ident" id="5956157">mu</span><span class="op" id="5956159">.</span><span class="ident" id="5956160">Unlock</span><span class="op" id="5956166">(</span><span class="op" id="5956167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956171">if</span>&nbsp;<span class="ident" id="5956174">_</span><span class="op" id="5956175">,</span>&nbsp;<span class="ident" id="5956177">ok</span>&nbsp;<span class="op" id="5956180">:=</span>&nbsp;<span class="ident" id="5956183">decompressors</span><span class="op" id="5956196">[</span><span class="ident" id="5956197">method</span><span class="op" id="5956203">]</span><span class="op" id="5956204">;</span>&nbsp;<span class="ident" id="5956206">ok</span>&nbsp;<span class="op" id="5956209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5956213">panic</span><span class="op" id="5956218">(</span><span class="string" id="5956219">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="5956252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956255">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956258">decompressors</span><span class="op" id="5956271">[</span><span class="ident" id="5956272">method</span><span class="op" id="5956278">]</span>&nbsp;<span class="op" id="5956280">=</span>&nbsp;<span class="ident" id="5956282">d</span><br>
<span class="lineno"></span><span class="op" id="5956284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5956287">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="5956365">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="5956419">func</span>&nbsp;<span class="ident" id="5956424">RegisterCompressor</span><span class="op" id="5956442">(</span><span class="ident" id="5956443">method</span>&nbsp;<span class="builtintype" id="5956450">uint16</span><span class="op" id="5956456">,</span>&nbsp;<span class="ident" id="5956458">comp</span>&nbsp;<span class="ident" id="5956463">Compressor</span><span class="op" id="5956473">)</span>&nbsp;<span class="op" id="5956475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956478">mu</span><span class="op" id="5956480">.</span><span class="ident" id="5956481">Lock</span><span class="op" id="5956485">(</span><span class="op" id="5956486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956489">defer</span>&nbsp;<span class="ident" id="5956495">mu</span><span class="op" id="5956497">.</span><span class="ident" id="5956498">Unlock</span><span class="op" id="5956504">(</span><span class="op" id="5956505">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956509">if</span>&nbsp;<span class="ident" id="5956512">_</span><span class="op" id="5956513">,</span>&nbsp;<span class="ident" id="5956515">ok</span>&nbsp;<span class="op" id="5956518">:=</span>&nbsp;<span class="ident" id="5956521">compressors</span><span class="op" id="5956532">[</span><span class="ident" id="5956533">method</span><span class="op" id="5956539">]</span><span class="op" id="5956540">;</span>&nbsp;<span class="ident" id="5956542">ok</span>&nbsp;<span class="op" id="5956545">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5956549">panic</span><span class="op" id="5956554">(</span><span class="string" id="5956555">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="5956586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956592">compressors</span><span class="op" id="5956603">[</span><span class="ident" id="5956604">method</span><span class="op" id="5956610">]</span>&nbsp;<span class="op" id="5956612">=</span>&nbsp;<span class="ident" id="5956614">comp</span><br>
<span class="lineno"></span><span class="op" id="5956619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5956622">func</span>&nbsp;<span class="ident" id="5956627">compressor</span><span class="op" id="5956637">(</span><span class="ident" id="5956638">method</span>&nbsp;<span class="builtintype" id="5956645">uint16</span><span class="op" id="5956651">)</span>&nbsp;<span class="ident" id="5956653">Compressor</span>&nbsp;<span class="op" id="5956664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956667">mu</span><span class="op" id="5956669">.</span><span class="ident" id="5956670">RLock</span><span class="op" id="5956675">(</span><span class="op" id="5956676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956679">defer</span>&nbsp;<span class="ident" id="5956685">mu</span><span class="op" id="5956687">.</span><span class="ident" id="5956688">RUnlock</span><span class="op" id="5956695">(</span><span class="op" id="5956696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956699">return</span>&nbsp;<span class="ident" id="5956706">compressors</span><span class="op" id="5956717">[</span><span class="ident" id="5956718">method</span><span class="op" id="5956724">]</span><br>
<span class="lineno"></span><span class="op" id="5956726">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5956729">func</span>&nbsp;<span class="ident" id="5956734">decompressor</span><span class="op" id="5956746">(</span><span class="ident" id="5956747">method</span>&nbsp;<span class="builtintype" id="5956754">uint16</span><span class="op" id="5956760">)</span>&nbsp;<span class="ident" id="5956762">Decompressor</span>&nbsp;<span class="op" id="5956775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956778">mu</span><span class="op" id="5956780">.</span><span class="ident" id="5956781">RLock</span><span class="op" id="5956786">(</span><span class="op" id="5956787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956790">defer</span>&nbsp;<span class="ident" id="5956796">mu</span><span class="op" id="5956798">.</span><span class="ident" id="5956799">RUnlock</span><span class="op" id="5956806">(</span><span class="op" id="5956807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956810">return</span>&nbsp;<span class="ident" id="5956817">decompressors</span><span class="op" id="5956830">[</span><span class="ident" id="5956831">method</span><span class="op" id="5956837">]</span><br>
<span class="lineno">110</span><span class="op" id="5956839">}</span>
</div>
</body>
</html>
