<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7173482">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7173537">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7173591">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7173642">package</span>&nbsp;<span class="ident" id="7173650">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7173656">import</span>&nbsp;<span class="op" id="7173663">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173666">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173675">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173682">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173691">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173706">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173719">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173732">&#34;math/rand&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173745">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173751">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7173761">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7173764">//&nbsp;zigzag&nbsp;maps&nbsp;from&nbsp;the&nbsp;natural&nbsp;ordering&nbsp;to&nbsp;the&nbsp;zig-zag&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno">20</span><span class="comment" id="7173843">//&nbsp;zigzag[0*8&nbsp;+&nbsp;3]&nbsp;is&nbsp;the&nbsp;zig-zag&nbsp;sequence&nbsp;number&nbsp;of&nbsp;the&nbsp;element&nbsp;in&nbsp;the&nbsp;fourth</span><br>
<span class="lineno"></span><span class="comment" id="7173922">//&nbsp;column&nbsp;and&nbsp;first&nbsp;row.</span><br>
<span class="lineno"></span><span class="keyword" id="7173947">var</span>&nbsp;<span class="ident" id="7173951">zigzag</span>&nbsp;<span class="op" id="7173958">=</span>&nbsp;<span class="op" id="7173960">[</span><span class="ident" id="7173961">blockSize</span><span class="op" id="7173970">]</span><span class="builtintype" id="7173971">int</span><span class="op" id="7173974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7173977">0</span><span class="op" id="7173978">,</span>&nbsp;<span class="num" id="7173980">1</span><span class="op" id="7173981">,</span>&nbsp;<span class="num" id="7173983">5</span><span class="op" id="7173984">,</span>&nbsp;<span class="num" id="7173986">6</span><span class="op" id="7173987">,</span>&nbsp;<span class="num" id="7173989">14</span><span class="op" id="7173991">,</span>&nbsp;<span class="num" id="7173993">15</span><span class="op" id="7173995">,</span>&nbsp;<span class="num" id="7173997">27</span><span class="op" id="7173999">,</span>&nbsp;<span class="num" id="7174001">28</span><span class="op" id="7174003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174006">2</span><span class="op" id="7174007">,</span>&nbsp;<span class="num" id="7174009">4</span><span class="op" id="7174010">,</span>&nbsp;<span class="num" id="7174012">7</span><span class="op" id="7174013">,</span>&nbsp;<span class="num" id="7174015">13</span><span class="op" id="7174017">,</span>&nbsp;<span class="num" id="7174019">16</span><span class="op" id="7174021">,</span>&nbsp;<span class="num" id="7174023">26</span><span class="op" id="7174025">,</span>&nbsp;<span class="num" id="7174027">29</span><span class="op" id="7174029">,</span>&nbsp;<span class="num" id="7174031">42</span><span class="op" id="7174033">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174036">3</span><span class="op" id="7174037">,</span>&nbsp;<span class="num" id="7174039">8</span><span class="op" id="7174040">,</span>&nbsp;<span class="num" id="7174042">12</span><span class="op" id="7174044">,</span>&nbsp;<span class="num" id="7174046">17</span><span class="op" id="7174048">,</span>&nbsp;<span class="num" id="7174050">25</span><span class="op" id="7174052">,</span>&nbsp;<span class="num" id="7174054">30</span><span class="op" id="7174056">,</span>&nbsp;<span class="num" id="7174058">41</span><span class="op" id="7174060">,</span>&nbsp;<span class="num" id="7174062">43</span><span class="op" id="7174064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174067">9</span><span class="op" id="7174068">,</span>&nbsp;<span class="num" id="7174070">11</span><span class="op" id="7174072">,</span>&nbsp;<span class="num" id="7174074">18</span><span class="op" id="7174076">,</span>&nbsp;<span class="num" id="7174078">24</span><span class="op" id="7174080">,</span>&nbsp;<span class="num" id="7174082">31</span><span class="op" id="7174084">,</span>&nbsp;<span class="num" id="7174086">40</span><span class="op" id="7174088">,</span>&nbsp;<span class="num" id="7174090">44</span><span class="op" id="7174092">,</span>&nbsp;<span class="num" id="7174094">53</span><span class="op" id="7174096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174099">10</span><span class="op" id="7174101">,</span>&nbsp;<span class="num" id="7174103">19</span><span class="op" id="7174105">,</span>&nbsp;<span class="num" id="7174107">23</span><span class="op" id="7174109">,</span>&nbsp;<span class="num" id="7174111">32</span><span class="op" id="7174113">,</span>&nbsp;<span class="num" id="7174115">39</span><span class="op" id="7174117">,</span>&nbsp;<span class="num" id="7174119">45</span><span class="op" id="7174121">,</span>&nbsp;<span class="num" id="7174123">52</span><span class="op" id="7174125">,</span>&nbsp;<span class="num" id="7174127">54</span><span class="op" id="7174129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174132">20</span><span class="op" id="7174134">,</span>&nbsp;<span class="num" id="7174136">22</span><span class="op" id="7174138">,</span>&nbsp;<span class="num" id="7174140">33</span><span class="op" id="7174142">,</span>&nbsp;<span class="num" id="7174144">38</span><span class="op" id="7174146">,</span>&nbsp;<span class="num" id="7174148">46</span><span class="op" id="7174150">,</span>&nbsp;<span class="num" id="7174152">51</span><span class="op" id="7174154">,</span>&nbsp;<span class="num" id="7174156">55</span><span class="op" id="7174158">,</span>&nbsp;<span class="num" id="7174160">60</span><span class="op" id="7174162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174165">21</span><span class="op" id="7174167">,</span>&nbsp;<span class="num" id="7174169">34</span><span class="op" id="7174171">,</span>&nbsp;<span class="num" id="7174173">37</span><span class="op" id="7174175">,</span>&nbsp;<span class="num" id="7174177">47</span><span class="op" id="7174179">,</span>&nbsp;<span class="num" id="7174181">50</span><span class="op" id="7174183">,</span>&nbsp;<span class="num" id="7174185">56</span><span class="op" id="7174187">,</span>&nbsp;<span class="num" id="7174189">59</span><span class="op" id="7174191">,</span>&nbsp;<span class="num" id="7174193">61</span><span class="op" id="7174195">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174198">35</span><span class="op" id="7174200">,</span>&nbsp;<span class="num" id="7174202">36</span><span class="op" id="7174204">,</span>&nbsp;<span class="num" id="7174206">48</span><span class="op" id="7174208">,</span>&nbsp;<span class="num" id="7174210">49</span><span class="op" id="7174212">,</span>&nbsp;<span class="num" id="7174214">57</span><span class="op" id="7174216">,</span>&nbsp;<span class="num" id="7174218">58</span><span class="op" id="7174220">,</span>&nbsp;<span class="num" id="7174222">62</span><span class="op" id="7174224">,</span>&nbsp;<span class="num" id="7174226">63</span><span class="op" id="7174228">,</span><br>
<span class="lineno"></span><span class="op" id="7174230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7174233">func</span>&nbsp;<span class="ident" id="7174238">TestZigUnzig</span><span class="op" id="7174250">(</span><span class="ident" id="7174251">t</span>&nbsp;<span class="op" id="7174253">*</span><span class="ident" id="7174254">testing</span><span class="op" id="7174261">.</span><span class="ident" id="7174262">T</span><span class="op" id="7174263">)</span>&nbsp;<span class="op" id="7174265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174268">for</span>&nbsp;<span class="ident" id="7174272">i</span>&nbsp;<span class="op" id="7174274">:=</span>&nbsp;<span class="num" id="7174277">0</span><span class="op" id="7174278">;</span>&nbsp;<span class="ident" id="7174280">i</span>&nbsp;<span class="op" id="7174282">&lt;</span>&nbsp;<span class="ident" id="7174284">blockSize</span><span class="op" id="7174293">;</span>&nbsp;<span class="ident" id="7174295">i</span><span class="op" id="7174296">++</span>&nbsp;<span class="op" id="7174299">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174303">if</span>&nbsp;<span class="ident" id="7174306">unzig</span><span class="op" id="7174311">[</span><span class="ident" id="7174312">zigzag</span><span class="op" id="7174318">[</span><span class="ident" id="7174319">i</span><span class="op" id="7174320">]</span><span class="op" id="7174321">]</span>&nbsp;<span class="op" id="7174323">!=</span>&nbsp;<span class="ident" id="7174326">i</span>&nbsp;<span class="op" id="7174328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174333">t</span><span class="op" id="7174334">.</span><span class="ident" id="7174335">Errorf</span><span class="op" id="7174341">(</span><span class="string" id="7174342">&#34;unzig[zigzag[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="7174367">,</span>&nbsp;<span class="ident" id="7174369">i</span><span class="op" id="7174370">,</span>&nbsp;<span class="ident" id="7174372">unzig</span><span class="op" id="7174377">[</span><span class="ident" id="7174378">zigzag</span><span class="op" id="7174384">[</span><span class="ident" id="7174385">i</span><span class="op" id="7174386">]</span><span class="op" id="7174387">]</span><span class="op" id="7174388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174396">if</span>&nbsp;<span class="ident" id="7174399">zigzag</span><span class="op" id="7174405">[</span><span class="ident" id="7174406">unzig</span><span class="op" id="7174411">[</span><span class="ident" id="7174412">i</span><span class="op" id="7174413">]</span><span class="op" id="7174414">]</span>&nbsp;<span class="op" id="7174416">!=</span>&nbsp;<span class="ident" id="7174419">i</span>&nbsp;<span class="op" id="7174421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174426">t</span><span class="op" id="7174427">.</span><span class="ident" id="7174428">Errorf</span><span class="op" id="7174434">(</span><span class="string" id="7174435">&#34;zigzag[unzig[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="7174460">,</span>&nbsp;<span class="ident" id="7174462">i</span><span class="op" id="7174463">,</span>&nbsp;<span class="ident" id="7174465">zigzag</span><span class="op" id="7174471">[</span><span class="ident" id="7174472">unzig</span><span class="op" id="7174477">[</span><span class="ident" id="7174478">i</span><span class="op" id="7174479">]</span><span class="op" id="7174480">]</span><span class="op" id="7174481">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174488">}</span><br>
<span class="lineno"></span><span class="op" id="7174490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7174493">//&nbsp;unscaledQuantInNaturalOrder&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in</span><br>
<span class="lineno">45</span><span class="comment" id="7174564">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;K.1.</span><br>
<span class="lineno"></span><span class="keyword" id="7174625">var</span>&nbsp;<span class="ident" id="7174629">unscaledQuantInNaturalOrder</span>&nbsp;<span class="op" id="7174657">=</span>&nbsp;<span class="op" id="7174659">[</span><span class="ident" id="7174660">nQuantIndex</span><span class="op" id="7174671">]</span><span class="op" id="7174672">[</span><span class="ident" id="7174673">blockSize</span><span class="op" id="7174682">]</span><span class="builtintype" id="7174683">byte</span><span class="op" id="7174687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7174690">//&nbsp;Luminance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174709">16</span><span class="op" id="7174711">,</span>&nbsp;<span class="num" id="7174713">11</span><span class="op" id="7174715">,</span>&nbsp;<span class="num" id="7174717">10</span><span class="op" id="7174719">,</span>&nbsp;<span class="num" id="7174721">16</span><span class="op" id="7174723">,</span>&nbsp;<span class="num" id="7174725">24</span><span class="op" id="7174727">,</span>&nbsp;<span class="num" id="7174729">40</span><span class="op" id="7174731">,</span>&nbsp;<span class="num" id="7174733">51</span><span class="op" id="7174735">,</span>&nbsp;<span class="num" id="7174737">61</span><span class="op" id="7174739">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174743">12</span><span class="op" id="7174745">,</span>&nbsp;<span class="num" id="7174747">12</span><span class="op" id="7174749">,</span>&nbsp;<span class="num" id="7174751">14</span><span class="op" id="7174753">,</span>&nbsp;<span class="num" id="7174755">19</span><span class="op" id="7174757">,</span>&nbsp;<span class="num" id="7174759">26</span><span class="op" id="7174761">,</span>&nbsp;<span class="num" id="7174763">58</span><span class="op" id="7174765">,</span>&nbsp;<span class="num" id="7174767">60</span><span class="op" id="7174769">,</span>&nbsp;<span class="num" id="7174771">55</span><span class="op" id="7174773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174777">14</span><span class="op" id="7174779">,</span>&nbsp;<span class="num" id="7174781">13</span><span class="op" id="7174783">,</span>&nbsp;<span class="num" id="7174785">16</span><span class="op" id="7174787">,</span>&nbsp;<span class="num" id="7174789">24</span><span class="op" id="7174791">,</span>&nbsp;<span class="num" id="7174793">40</span><span class="op" id="7174795">,</span>&nbsp;<span class="num" id="7174797">57</span><span class="op" id="7174799">,</span>&nbsp;<span class="num" id="7174801">69</span><span class="op" id="7174803">,</span>&nbsp;<span class="num" id="7174805">56</span><span class="op" id="7174807">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174811">14</span><span class="op" id="7174813">,</span>&nbsp;<span class="num" id="7174815">17</span><span class="op" id="7174817">,</span>&nbsp;<span class="num" id="7174819">22</span><span class="op" id="7174821">,</span>&nbsp;<span class="num" id="7174823">29</span><span class="op" id="7174825">,</span>&nbsp;<span class="num" id="7174827">51</span><span class="op" id="7174829">,</span>&nbsp;<span class="num" id="7174831">87</span><span class="op" id="7174833">,</span>&nbsp;<span class="num" id="7174835">80</span><span class="op" id="7174837">,</span>&nbsp;<span class="num" id="7174839">62</span><span class="op" id="7174841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174845">18</span><span class="op" id="7174847">,</span>&nbsp;<span class="num" id="7174849">22</span><span class="op" id="7174851">,</span>&nbsp;<span class="num" id="7174853">37</span><span class="op" id="7174855">,</span>&nbsp;<span class="num" id="7174857">56</span><span class="op" id="7174859">,</span>&nbsp;<span class="num" id="7174861">68</span><span class="op" id="7174863">,</span>&nbsp;<span class="num" id="7174865">109</span><span class="op" id="7174868">,</span>&nbsp;<span class="num" id="7174870">103</span><span class="op" id="7174873">,</span>&nbsp;<span class="num" id="7174875">77</span><span class="op" id="7174877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174881">24</span><span class="op" id="7174883">,</span>&nbsp;<span class="num" id="7174885">35</span><span class="op" id="7174887">,</span>&nbsp;<span class="num" id="7174889">55</span><span class="op" id="7174891">,</span>&nbsp;<span class="num" id="7174893">64</span><span class="op" id="7174895">,</span>&nbsp;<span class="num" id="7174897">81</span><span class="op" id="7174899">,</span>&nbsp;<span class="num" id="7174901">104</span><span class="op" id="7174904">,</span>&nbsp;<span class="num" id="7174906">113</span><span class="op" id="7174909">,</span>&nbsp;<span class="num" id="7174911">92</span><span class="op" id="7174913">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174917">49</span><span class="op" id="7174919">,</span>&nbsp;<span class="num" id="7174921">64</span><span class="op" id="7174923">,</span>&nbsp;<span class="num" id="7174925">78</span><span class="op" id="7174927">,</span>&nbsp;<span class="num" id="7174929">87</span><span class="op" id="7174931">,</span>&nbsp;<span class="num" id="7174933">103</span><span class="op" id="7174936">,</span>&nbsp;<span class="num" id="7174938">121</span><span class="op" id="7174941">,</span>&nbsp;<span class="num" id="7174943">120</span><span class="op" id="7174946">,</span>&nbsp;<span class="num" id="7174948">101</span><span class="op" id="7174951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7174955">72</span><span class="op" id="7174957">,</span>&nbsp;<span class="num" id="7174959">92</span><span class="op" id="7174961">,</span>&nbsp;<span class="num" id="7174963">95</span><span class="op" id="7174965">,</span>&nbsp;<span class="num" id="7174967">98</span><span class="op" id="7174969">,</span>&nbsp;<span class="num" id="7174971">112</span><span class="op" id="7174974">,</span>&nbsp;<span class="num" id="7174976">100</span><span class="op" id="7174979">,</span>&nbsp;<span class="num" id="7174981">103</span><span class="op" id="7174984">,</span>&nbsp;<span class="num" id="7174986">99</span><span class="op" id="7174988">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174991">}</span><span class="op" id="7174992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7174995">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175012">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7175016">17</span><span class="op" id="7175018">,</span>&nbsp;<span class="num" id="7175020">18</span><span class="op" id="7175022">,</span>&nbsp;<span class="num" id="7175024">24</span><span class="op" id="7175026">,</span>&nbsp;<span class="num" id="7175028">47</span><span class="op" id="7175030">,</span>&nbsp;<span class="num" id="7175032">99</span><span class="op" id="7175034">,</span>&nbsp;<span class="num" id="7175036">99</span><span class="op" id="7175038">,</span>&nbsp;<span class="num" id="7175040">99</span><span class="op" id="7175042">,</span>&nbsp;<span class="num" id="7175044">99</span><span class="op" id="7175046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7175050">18</span><span class="op" id="7175052">,</span>&nbsp;<span class="num" id="7175054">21</span><span class="op" id="7175056">,</span>&nbsp;<span class="num" id="7175058">26</span><span class="op" id="7175060">,</span>&nbsp;<span class="num" id="7175062">66</span><span class="op" id="7175064">,</span>&nbsp;<span class="num" id="7175066">99</span><span class="op" id="7175068">,</span>&nbsp;<span class="num" id="7175070">99</span><span class="op" id="7175072">,</span>&nbsp;<span class="num" id="7175074">99</span><span class="op" id="7175076">,</span>&nbsp;<span class="num" id="7175078">99</span><span class="op" id="7175080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7175084">24</span><span class="op" id="7175086">,</span>&nbsp;<span class="num" id="7175088">26</span><span class="op" id="7175090">,</span>&nbsp;<span class="num" id="7175092">56</span><span class="op" id="7175094">,</span>&nbsp;<span class="num" id="7175096">99</span><span class="op" id="7175098">,</span>&nbsp;<span class="num" id="7175100">99</span><span class="op" id="7175102">,</span>&nbsp;<span class="num" id="7175104">99</span><span class="op" id="7175106">,</span>&nbsp;<span class="num" id="7175108">99</span><span class="op" id="7175110">,</span>&nbsp;<span class="num" id="7175112">99</span><span class="op" id="7175114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7175118">47</span><span class="op" id="7175120">,</span>&nbsp;<span class="num" id="7175122">66</span><span class="op" id="7175124">,</span>&nbsp;<span class="num" id="7175126">99</span><span class="op" id="7175128">,</span>&nbsp;<span class="num" id="7175130">99</span><span class="op" id="7175132">,</span>&nbsp;<span class="num" id="7175134">99</span><span class="op" id="7175136">,</span>&nbsp;<span class="num" id="7175138">99</span><span class="op" id="7175140">,</span>&nbsp;<span class="num" id="7175142">99</span><span class="op" id="7175144">,</span>&nbsp;<span class="num" id="7175146">99</span><span class="op" id="7175148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7175152">99</span><span class="op" id="7175154">,</span>&nbsp;<span class="num" id="7175156">99</span><span class="op" id="7175158">,</span>&nbsp;<span class="num" id="7175160">99</span><span class="op" id="7175162">,</span>&nbsp;<span class="num" id="7175164">99</span><span class="op" id="7175166">,</span>&nbsp;<span class="num" id="7175168">99</span><span class="op" id="7175170">,</span>&nbsp;<span class="num" id="7175172">99</span><span class="op" id="7175174">,</span>&nbsp;<span class="num" id="7175176">99</span><span class="op" id="7175178">,</span>&nbsp;<span class="num" id="7175180">99</span><span class="op" id="7175182">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7175186">99</span><span class="op" id="7175188">,</span>&nbsp;<span class="num" id="7175190">99</span><span class="op" id="7175192">,</span>&nbsp;<span class="num" id="7175194">99</span><span class="op" id="7175196">,</span>&nbsp;<span class="num" id="7175198">99</span><span class="op" id="7175200">,</span>&nbsp;<span class="num" id="7175202">99</span><span class="op" id="7175204">,</span>&nbsp;<span class="num" id="7175206">99</span><span class="op" id="7175208">,</span>&nbsp;<span class="num" id="7175210">99</span><span class="op" id="7175212">,</span>&nbsp;<span class="num" id="7175214">99</span><span class="op" id="7175216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7175220">99</span><span class="op" id="7175222">,</span>&nbsp;<span class="num" id="7175224">99</span><span class="op" id="7175226">,</span>&nbsp;<span class="num" id="7175228">99</span><span class="op" id="7175230">,</span>&nbsp;<span class="num" id="7175232">99</span><span class="op" id="7175234">,</span>&nbsp;<span class="num" id="7175236">99</span><span class="op" id="7175238">,</span>&nbsp;<span class="num" id="7175240">99</span><span class="op" id="7175242">,</span>&nbsp;<span class="num" id="7175244">99</span><span class="op" id="7175246">,</span>&nbsp;<span class="num" id="7175248">99</span><span class="op" id="7175250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7175254">99</span><span class="op" id="7175256">,</span>&nbsp;<span class="num" id="7175258">99</span><span class="op" id="7175260">,</span>&nbsp;<span class="num" id="7175262">99</span><span class="op" id="7175264">,</span>&nbsp;<span class="num" id="7175266">99</span><span class="op" id="7175268">,</span>&nbsp;<span class="num" id="7175270">99</span><span class="op" id="7175272">,</span>&nbsp;<span class="num" id="7175274">99</span><span class="op" id="7175276">,</span>&nbsp;<span class="num" id="7175278">99</span><span class="op" id="7175280">,</span>&nbsp;<span class="num" id="7175282">99</span><span class="op" id="7175284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175287">}</span><span class="op" id="7175288">,</span><br>
<span class="lineno"></span><span class="op" id="7175290">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7175293">func</span>&nbsp;<span class="ident" id="7175298">TestUnscaledQuant</span><span class="op" id="7175315">(</span><span class="ident" id="7175316">t</span>&nbsp;<span class="op" id="7175318">*</span><span class="ident" id="7175319">testing</span><span class="op" id="7175326">.</span><span class="ident" id="7175327">T</span><span class="op" id="7175328">)</span>&nbsp;<span class="op" id="7175330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175333">bad</span>&nbsp;<span class="op" id="7175337">:=</span>&nbsp;<span class="builtintype" id="7175340">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175347">for</span>&nbsp;<span class="ident" id="7175351">i</span>&nbsp;<span class="op" id="7175353">:=</span>&nbsp;<span class="ident" id="7175356">quantIndex</span><span class="op" id="7175366">(</span><span class="num" id="7175367">0</span><span class="op" id="7175368">)</span><span class="op" id="7175369">;</span>&nbsp;<span class="ident" id="7175371">i</span>&nbsp;<span class="op" id="7175373">&lt;</span>&nbsp;<span class="ident" id="7175375">nQuantIndex</span><span class="op" id="7175386">;</span>&nbsp;<span class="ident" id="7175388">i</span><span class="op" id="7175389">++</span>&nbsp;<span class="op" id="7175392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175396">for</span>&nbsp;<span class="ident" id="7175400">zig</span>&nbsp;<span class="op" id="7175404">:=</span>&nbsp;<span class="num" id="7175407">0</span><span class="op" id="7175408">;</span>&nbsp;<span class="ident" id="7175410">zig</span>&nbsp;<span class="op" id="7175414">&lt;</span>&nbsp;<span class="ident" id="7175416">blockSize</span><span class="op" id="7175425">;</span>&nbsp;<span class="ident" id="7175427">zig</span><span class="op" id="7175430">++</span>&nbsp;<span class="op" id="7175433">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175438">got</span>&nbsp;<span class="op" id="7175442">:=</span>&nbsp;<span class="ident" id="7175445">unscaledQuant</span><span class="op" id="7175458">[</span><span class="ident" id="7175459">i</span><span class="op" id="7175460">]</span><span class="op" id="7175461">[</span><span class="ident" id="7175462">zig</span><span class="op" id="7175465">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175470">want</span>&nbsp;<span class="op" id="7175475">:=</span>&nbsp;<span class="ident" id="7175478">unscaledQuantInNaturalOrder</span><span class="op" id="7175505">[</span><span class="ident" id="7175506">i</span><span class="op" id="7175507">]</span><span class="op" id="7175508">[</span><span class="ident" id="7175509">unzig</span><span class="op" id="7175514">[</span><span class="ident" id="7175515">zig</span><span class="op" id="7175518">]</span><span class="op" id="7175519">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175524">if</span>&nbsp;<span class="ident" id="7175527">got</span>&nbsp;<span class="op" id="7175531">!=</span>&nbsp;<span class="ident" id="7175534">want</span>&nbsp;<span class="op" id="7175539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175545">t</span><span class="op" id="7175546">.</span><span class="ident" id="7175547">Errorf</span><span class="op" id="7175553">(</span><span class="string" id="7175554">&#34;i=%d,&nbsp;zig=%d:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7175585">,</span>&nbsp;<span class="ident" id="7175587">i</span><span class="op" id="7175588">,</span>&nbsp;<span class="ident" id="7175590">zig</span><span class="op" id="7175593">,</span>&nbsp;<span class="ident" id="7175595">got</span><span class="op" id="7175598">,</span>&nbsp;<span class="ident" id="7175600">want</span><span class="op" id="7175604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175610">bad</span>&nbsp;<span class="op" id="7175614">=</span>&nbsp;<span class="builtintype" id="7175616">true</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175634">if</span>&nbsp;<span class="ident" id="7175637">bad</span>&nbsp;<span class="op" id="7175641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175645">names</span>&nbsp;<span class="op" id="7175651">:=</span>&nbsp;<span class="op" id="7175654">[</span><span class="ident" id="7175655">nQuantIndex</span><span class="op" id="7175666">]</span><span class="builtintype" id="7175667">string</span><span class="op" id="7175673">{</span><span class="string" id="7175674">&#34;Luminance&#34;</span><span class="op" id="7175685">,</span>&nbsp;<span class="string" id="7175687">&#34;Chrominance&#34;</span><span class="op" id="7175700">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175704">buf</span>&nbsp;<span class="op" id="7175708">:=</span>&nbsp;<span class="op" id="7175711">&amp;</span><span class="ident" id="7175712">bytes</span><span class="op" id="7175717">.</span><span class="ident" id="7175718">Buffer</span><span class="op" id="7175724">{</span><span class="op" id="7175725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175729">for</span>&nbsp;<span class="ident" id="7175733">i</span><span class="op" id="7175734">,</span>&nbsp;<span class="ident" id="7175736">name</span>&nbsp;<span class="op" id="7175741">:=</span>&nbsp;<span class="keyword" id="7175744">range</span>&nbsp;<span class="ident" id="7175750">names</span>&nbsp;<span class="op" id="7175756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175761">fmt</span><span class="op" id="7175764">.</span><span class="ident" id="7175765">Fprintf</span><span class="op" id="7175772">(</span><span class="ident" id="7175773">buf</span><span class="op" id="7175776">,</span>&nbsp;<span class="string" id="7175778">&#34;//&nbsp;%s.\n{\n&#34;</span><span class="op" id="7175791">,</span>&nbsp;<span class="ident" id="7175793">name</span><span class="op" id="7175797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175802">for</span>&nbsp;<span class="ident" id="7175806">zig</span>&nbsp;<span class="op" id="7175810">:=</span>&nbsp;<span class="num" id="7175813">0</span><span class="op" id="7175814">;</span>&nbsp;<span class="ident" id="7175816">zig</span>&nbsp;<span class="op" id="7175820">&lt;</span>&nbsp;<span class="ident" id="7175822">blockSize</span><span class="op" id="7175831">;</span>&nbsp;<span class="ident" id="7175833">zig</span><span class="op" id="7175836">++</span>&nbsp;<span class="op" id="7175839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175845">fmt</span><span class="op" id="7175848">.</span><span class="ident" id="7175849">Fprintf</span><span class="op" id="7175856">(</span><span class="ident" id="7175857">buf</span><span class="op" id="7175860">,</span>&nbsp;<span class="string" id="7175862">&#34;%d,&nbsp;&#34;</span><span class="op" id="7175868">,</span>&nbsp;<span class="ident" id="7175870">unscaledQuantInNaturalOrder</span><span class="op" id="7175897">[</span><span class="ident" id="7175898">i</span><span class="op" id="7175899">]</span><span class="op" id="7175900">[</span><span class="ident" id="7175901">unzig</span><span class="op" id="7175906">[</span><span class="ident" id="7175907">zig</span><span class="op" id="7175910">]</span><span class="op" id="7175911">]</span><span class="op" id="7175912">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175918">if</span>&nbsp;<span class="ident" id="7175921">zig</span><span class="op" id="7175924">%</span><span class="num" id="7175925">8</span>&nbsp;<span class="op" id="7175927">==</span>&nbsp;<span class="num" id="7175930">7</span>&nbsp;<span class="op" id="7175932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175939">buf</span><span class="op" id="7175942">.</span><span class="ident" id="7175943">WriteString</span><span class="op" id="7175954">(</span><span class="string" id="7175955">&#34;\n&#34;</span><span class="op" id="7175959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175975">buf</span><span class="op" id="7175978">.</span><span class="ident" id="7175979">WriteString</span><span class="op" id="7175990">(</span><span class="string" id="7175991">&#34;},\n&#34;</span><span class="op" id="7175997">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176005">t</span><span class="op" id="7176006">.</span><span class="ident" id="7176007">Logf</span><span class="op" id="7176011">(</span><span class="string" id="7176012">&#34;expected&nbsp;unscaledQuant&nbsp;values:\n%s&#34;</span><span class="op" id="7176048">,</span>&nbsp;<span class="ident" id="7176050">buf</span><span class="op" id="7176053">.</span><span class="ident" id="7176054">String</span><span class="op" id="7176060">(</span><span class="op" id="7176061">)</span><span class="op" id="7176062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176065">}</span><br>
<span class="lineno"></span><span class="op" id="7176067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7176070">var</span>&nbsp;<span class="ident" id="7176074">testCase</span>&nbsp;<span class="op" id="7176083">=</span>&nbsp;<span class="op" id="7176085">[</span><span class="op" id="7176086">]</span><span class="keyword" id="7176087">struct</span>&nbsp;<span class="op" id="7176094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176097">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7176107">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176115">quality</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7176125">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176130">tolerance</span>&nbsp;<span class="ident" id="7176140">int64</span><br>
<span class="lineno"></span><span class="op" id="7176146">}</span><span class="op" id="7176147">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176150">{</span><span class="string" id="7176151">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7176178">,</span>&nbsp;<span class="num" id="7176180">1</span><span class="op" id="7176181">,</span>&nbsp;<span class="num" id="7176183">24</span>&nbsp;<span class="op" id="7176186">&lt;&lt;</span>&nbsp;<span class="num" id="7176189">8</span><span class="op" id="7176190">}</span><span class="op" id="7176191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176194">{</span><span class="string" id="7176195">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7176222">,</span>&nbsp;<span class="num" id="7176224">20</span><span class="op" id="7176226">,</span>&nbsp;<span class="num" id="7176228">12</span>&nbsp;<span class="op" id="7176231">&lt;&lt;</span>&nbsp;<span class="num" id="7176234">8</span><span class="op" id="7176235">}</span><span class="op" id="7176236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176239">{</span><span class="string" id="7176240">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7176267">,</span>&nbsp;<span class="num" id="7176269">60</span><span class="op" id="7176271">,</span>&nbsp;<span class="num" id="7176273">8</span>&nbsp;<span class="op" id="7176275">&lt;&lt;</span>&nbsp;<span class="num" id="7176278">8</span><span class="op" id="7176279">}</span><span class="op" id="7176280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176283">{</span><span class="string" id="7176284">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7176311">,</span>&nbsp;<span class="num" id="7176313">80</span><span class="op" id="7176315">,</span>&nbsp;<span class="num" id="7176317">6</span>&nbsp;<span class="op" id="7176319">&lt;&lt;</span>&nbsp;<span class="num" id="7176322">8</span><span class="op" id="7176323">}</span><span class="op" id="7176324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176327">{</span><span class="string" id="7176328">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7176355">,</span>&nbsp;<span class="num" id="7176357">90</span><span class="op" id="7176359">,</span>&nbsp;<span class="num" id="7176361">4</span>&nbsp;<span class="op" id="7176363">&lt;&lt;</span>&nbsp;<span class="num" id="7176366">8</span><span class="op" id="7176367">}</span><span class="op" id="7176368">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176371">{</span><span class="string" id="7176372">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7176399">,</span>&nbsp;<span class="num" id="7176401">100</span><span class="op" id="7176404">,</span>&nbsp;<span class="num" id="7176406">2</span>&nbsp;<span class="op" id="7176408">&lt;&lt;</span>&nbsp;<span class="num" id="7176411">8</span><span class="op" id="7176412">}</span><span class="op" id="7176413">,</span><br>
<span class="lineno"></span><span class="op" id="7176415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7176418">func</span>&nbsp;<span class="ident" id="7176423">delta</span><span class="op" id="7176428">(</span><span class="ident" id="7176429">u0</span><span class="op" id="7176431">,</span>&nbsp;<span class="ident" id="7176433">u1</span>&nbsp;<span class="builtintype" id="7176436">uint32</span><span class="op" id="7176442">)</span>&nbsp;<span class="ident" id="7176444">int64</span>&nbsp;<span class="op" id="7176450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176453">d</span>&nbsp;<span class="op" id="7176455">:=</span>&nbsp;<span class="ident" id="7176458">int64</span><span class="op" id="7176463">(</span><span class="ident" id="7176464">u0</span><span class="op" id="7176466">)</span>&nbsp;<span class="op" id="7176468">-</span>&nbsp;<span class="ident" id="7176470">int64</span><span class="op" id="7176475">(</span><span class="ident" id="7176476">u1</span><span class="op" id="7176478">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176481">if</span>&nbsp;<span class="ident" id="7176484">d</span>&nbsp;<span class="op" id="7176486">&lt;</span>&nbsp;<span class="num" id="7176488">0</span>&nbsp;<span class="op" id="7176490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176494">return</span>&nbsp;<span class="op" id="7176501">-</span><span class="ident" id="7176502">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176508">return</span>&nbsp;<span class="ident" id="7176515">d</span><br>
<span class="lineno"></span><span class="op" id="7176517">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="7176520">func</span>&nbsp;<span class="ident" id="7176525">readPng</span><span class="op" id="7176532">(</span><span class="ident" id="7176533">filename</span>&nbsp;<span class="builtintype" id="7176542">string</span><span class="op" id="7176548">)</span>&nbsp;<span class="op" id="7176550">(</span><span class="ident" id="7176551">image</span><span class="op" id="7176556">.</span><span class="ident" id="7176557">Image</span><span class="op" id="7176562">,</span>&nbsp;<span class="builtintype" id="7176564">error</span><span class="op" id="7176569">)</span>&nbsp;<span class="op" id="7176571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176574">f</span><span class="op" id="7176575">,</span>&nbsp;<span class="ident" id="7176577">err</span>&nbsp;<span class="op" id="7176581">:=</span>&nbsp;<span class="ident" id="7176584">os</span><span class="op" id="7176586">.</span><span class="ident" id="7176587">Open</span><span class="op" id="7176591">(</span><span class="ident" id="7176592">filename</span><span class="op" id="7176600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176603">if</span>&nbsp;<span class="ident" id="7176606">err</span>&nbsp;<span class="op" id="7176610">!=</span>&nbsp;<span class="ident" id="7176613">nil</span>&nbsp;<span class="op" id="7176617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176621">return</span>&nbsp;<span class="ident" id="7176628">nil</span><span class="op" id="7176631">,</span>&nbsp;<span class="ident" id="7176633">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176641">defer</span>&nbsp;<span class="ident" id="7176647">f</span><span class="op" id="7176648">.</span><span class="ident" id="7176649">Close</span><span class="op" id="7176654">(</span><span class="op" id="7176655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176658">return</span>&nbsp;<span class="ident" id="7176665">png</span><span class="op" id="7176668">.</span><span class="ident" id="7176669">Decode</span><span class="op" id="7176675">(</span><span class="ident" id="7176676">f</span><span class="op" id="7176677">)</span><br>
<span class="lineno"></span><span class="op" id="7176679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="7176682">func</span>&nbsp;<span class="ident" id="7176687">TestWriter</span><span class="op" id="7176697">(</span><span class="ident" id="7176698">t</span>&nbsp;<span class="op" id="7176700">*</span><span class="ident" id="7176701">testing</span><span class="op" id="7176708">.</span><span class="ident" id="7176709">T</span><span class="op" id="7176710">)</span>&nbsp;<span class="op" id="7176712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176715">for</span>&nbsp;<span class="ident" id="7176719">_</span><span class="op" id="7176720">,</span>&nbsp;<span class="ident" id="7176722">tc</span>&nbsp;<span class="op" id="7176725">:=</span>&nbsp;<span class="keyword" id="7176728">range</span>&nbsp;<span class="ident" id="7176734">testCase</span>&nbsp;<span class="op" id="7176743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7176747">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176768">m0</span><span class="op" id="7176770">,</span>&nbsp;<span class="ident" id="7176772">err</span>&nbsp;<span class="op" id="7176776">:=</span>&nbsp;<span class="ident" id="7176779">readPng</span><span class="op" id="7176786">(</span><span class="ident" id="7176787">tc</span><span class="op" id="7176789">.</span><span class="ident" id="7176790">filename</span><span class="op" id="7176798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176802">if</span>&nbsp;<span class="ident" id="7176805">err</span>&nbsp;<span class="op" id="7176809">!=</span>&nbsp;<span class="ident" id="7176812">nil</span>&nbsp;<span class="op" id="7176816">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176821">t</span><span class="op" id="7176822">.</span><span class="ident" id="7176823">Error</span><span class="op" id="7176828">(</span><span class="ident" id="7176829">tc</span><span class="op" id="7176831">.</span><span class="ident" id="7176832">filename</span><span class="op" id="7176840">,</span>&nbsp;<span class="ident" id="7176842">err</span><span class="op" id="7176845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176850">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7176865">//&nbsp;Encode&nbsp;that&nbsp;image&nbsp;as&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176897">var</span>&nbsp;<span class="ident" id="7176901">buf</span>&nbsp;<span class="ident" id="7176905">bytes</span><span class="op" id="7176910">.</span><span class="ident" id="7176911">Buffer</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176920">err</span>&nbsp;<span class="op" id="7176924">=</span>&nbsp;<span class="ident" id="7176926">Encode</span><span class="op" id="7176932">(</span><span class="op" id="7176933">&amp;</span><span class="ident" id="7176934">buf</span><span class="op" id="7176937">,</span>&nbsp;<span class="ident" id="7176939">m0</span><span class="op" id="7176941">,</span>&nbsp;<span class="op" id="7176943">&amp;</span><span class="ident" id="7176944">Options</span><span class="op" id="7176951">{</span><span class="ident" id="7176952">Quality</span><span class="op" id="7176959">:</span>&nbsp;<span class="ident" id="7176961">tc</span><span class="op" id="7176963">.</span><span class="ident" id="7176964">quality</span><span class="op" id="7176971">}</span><span class="op" id="7176972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176976">if</span>&nbsp;<span class="ident" id="7176979">err</span>&nbsp;<span class="op" id="7176983">!=</span>&nbsp;<span class="ident" id="7176986">nil</span>&nbsp;<span class="op" id="7176990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176995">t</span><span class="op" id="7176996">.</span><span class="ident" id="7176997">Error</span><span class="op" id="7177002">(</span><span class="ident" id="7177003">tc</span><span class="op" id="7177005">.</span><span class="ident" id="7177006">filename</span><span class="op" id="7177014">,</span>&nbsp;<span class="ident" id="7177016">err</span><span class="op" id="7177019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177024">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177035">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177039">//&nbsp;Decode&nbsp;that&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177062">m1</span><span class="op" id="7177064">,</span>&nbsp;<span class="ident" id="7177066">err</span>&nbsp;<span class="op" id="7177070">:=</span>&nbsp;<span class="ident" id="7177073">Decode</span><span class="op" id="7177079">(</span><span class="op" id="7177080">&amp;</span><span class="ident" id="7177081">buf</span><span class="op" id="7177084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177088">if</span>&nbsp;<span class="ident" id="7177091">err</span>&nbsp;<span class="op" id="7177095">!=</span>&nbsp;<span class="ident" id="7177098">nil</span>&nbsp;<span class="op" id="7177102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177107">t</span><span class="op" id="7177108">.</span><span class="ident" id="7177109">Error</span><span class="op" id="7177114">(</span><span class="ident" id="7177115">tc</span><span class="op" id="7177117">.</span><span class="ident" id="7177118">filename</span><span class="op" id="7177126">,</span>&nbsp;<span class="ident" id="7177128">err</span><span class="op" id="7177131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177136">continue</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177151">if</span>&nbsp;<span class="ident" id="7177154">m0</span><span class="op" id="7177156">.</span><span class="ident" id="7177157">Bounds</span><span class="op" id="7177163">(</span><span class="op" id="7177164">)</span>&nbsp;<span class="op" id="7177166">!=</span>&nbsp;<span class="ident" id="7177169">m1</span><span class="op" id="7177171">.</span><span class="ident" id="7177172">Bounds</span><span class="op" id="7177178">(</span><span class="op" id="7177179">)</span>&nbsp;<span class="op" id="7177181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177186">t</span><span class="op" id="7177187">.</span><span class="ident" id="7177188">Errorf</span><span class="op" id="7177194">(</span><span class="string" id="7177195">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7177225">,</span>&nbsp;<span class="ident" id="7177227">tc</span><span class="op" id="7177229">.</span><span class="ident" id="7177230">filename</span><span class="op" id="7177238">,</span>&nbsp;<span class="ident" id="7177240">m0</span><span class="op" id="7177242">.</span><span class="ident" id="7177243">Bounds</span><span class="op" id="7177249">(</span><span class="op" id="7177250">)</span><span class="op" id="7177251">,</span>&nbsp;<span class="ident" id="7177253">m1</span><span class="op" id="7177255">.</span><span class="ident" id="7177256">Bounds</span><span class="op" id="7177262">(</span><span class="op" id="7177263">)</span><span class="op" id="7177264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177269">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177280">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177284">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177339">if</span>&nbsp;<span class="ident" id="7177342">averageDelta</span><span class="op" id="7177354">(</span><span class="ident" id="7177355">m0</span><span class="op" id="7177357">,</span>&nbsp;<span class="ident" id="7177359">m1</span><span class="op" id="7177361">)</span>&nbsp;<span class="op" id="7177363">&gt;</span>&nbsp;<span class="ident" id="7177365">tc</span><span class="op" id="7177367">.</span><span class="ident" id="7177368">tolerance</span>&nbsp;<span class="op" id="7177378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177383">t</span><span class="op" id="7177384">.</span><span class="ident" id="7177385">Errorf</span><span class="op" id="7177391">(</span><span class="string" id="7177392">&#34;%s,&nbsp;quality=%d:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high&#34;</span><span class="op" id="7177435">,</span>&nbsp;<span class="ident" id="7177437">tc</span><span class="op" id="7177439">.</span><span class="ident" id="7177440">filename</span><span class="op" id="7177448">,</span>&nbsp;<span class="ident" id="7177450">tc</span><span class="op" id="7177452">.</span><span class="ident" id="7177453">quality</span><span class="op" id="7177460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177465">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177476">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177479">}</span><br>
<span class="lineno"></span><span class="op" id="7177481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7177484">//&nbsp;TestWriteGrayscale&nbsp;tests&nbsp;that&nbsp;a&nbsp;grayscale&nbsp;images&nbsp;survives&nbsp;a&nbsp;round-trip</span><br>
<span class="lineno"></span><span class="comment" id="7177558">//&nbsp;through&nbsp;encode/decode&nbsp;cycle.</span><br>
<span class="lineno">165</span><span class="keyword" id="7177590">func</span>&nbsp;<span class="ident" id="7177595">TestWriteGrayscale</span><span class="op" id="7177613">(</span><span class="ident" id="7177614">t</span>&nbsp;<span class="op" id="7177616">*</span><span class="ident" id="7177617">testing</span><span class="op" id="7177624">.</span><span class="ident" id="7177625">T</span><span class="op" id="7177626">)</span>&nbsp;<span class="op" id="7177628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177631">m0</span>&nbsp;<span class="op" id="7177634">:=</span>&nbsp;<span class="ident" id="7177637">image</span><span class="op" id="7177642">.</span><span class="ident" id="7177643">NewGray</span><span class="op" id="7177650">(</span><span class="ident" id="7177651">image</span><span class="op" id="7177656">.</span><span class="ident" id="7177657">Rect</span><span class="op" id="7177661">(</span><span class="num" id="7177662">0</span><span class="op" id="7177663">,</span>&nbsp;<span class="num" id="7177665">0</span><span class="op" id="7177666">,</span>&nbsp;<span class="num" id="7177668">32</span><span class="op" id="7177670">,</span>&nbsp;<span class="num" id="7177672">32</span><span class="op" id="7177674">)</span><span class="op" id="7177675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177678">for</span>&nbsp;<span class="ident" id="7177682">i</span>&nbsp;<span class="op" id="7177684">:=</span>&nbsp;<span class="keyword" id="7177687">range</span>&nbsp;<span class="ident" id="7177693">m0</span><span class="op" id="7177695">.</span><span class="ident" id="7177696">Pix</span>&nbsp;<span class="op" id="7177700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177704">m0</span><span class="op" id="7177706">.</span><span class="ident" id="7177707">Pix</span><span class="op" id="7177710">[</span><span class="ident" id="7177711">i</span><span class="op" id="7177712">]</span>&nbsp;<span class="op" id="7177714">=</span>&nbsp;<span class="builtintype" id="7177716">uint8</span><span class="op" id="7177721">(</span><span class="ident" id="7177722">i</span><span class="op" id="7177723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177726">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177729">var</span>&nbsp;<span class="ident" id="7177733">buf</span>&nbsp;<span class="ident" id="7177737">bytes</span><span class="op" id="7177742">.</span><span class="ident" id="7177743">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177751">if</span>&nbsp;<span class="ident" id="7177754">err</span>&nbsp;<span class="op" id="7177758">:=</span>&nbsp;<span class="ident" id="7177761">Encode</span><span class="op" id="7177767">(</span><span class="op" id="7177768">&amp;</span><span class="ident" id="7177769">buf</span><span class="op" id="7177772">,</span>&nbsp;<span class="ident" id="7177774">m0</span><span class="op" id="7177776">,</span>&nbsp;<span class="ident" id="7177778">nil</span><span class="op" id="7177781">)</span><span class="op" id="7177782">;</span>&nbsp;<span class="ident" id="7177784">err</span>&nbsp;<span class="op" id="7177788">!=</span>&nbsp;<span class="ident" id="7177791">nil</span>&nbsp;<span class="op" id="7177795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177799">t</span><span class="op" id="7177800">.</span><span class="ident" id="7177801">Fatal</span><span class="op" id="7177806">(</span><span class="ident" id="7177807">err</span><span class="op" id="7177810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177816">m1</span><span class="op" id="7177818">,</span>&nbsp;<span class="ident" id="7177820">err</span>&nbsp;<span class="op" id="7177824">:=</span>&nbsp;<span class="ident" id="7177827">Decode</span><span class="op" id="7177833">(</span><span class="op" id="7177834">&amp;</span><span class="ident" id="7177835">buf</span><span class="op" id="7177838">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177841">if</span>&nbsp;<span class="ident" id="7177844">err</span>&nbsp;<span class="op" id="7177848">!=</span>&nbsp;<span class="ident" id="7177851">nil</span>&nbsp;<span class="op" id="7177855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177859">t</span><span class="op" id="7177860">.</span><span class="ident" id="7177861">Fatal</span><span class="op" id="7177866">(</span><span class="ident" id="7177867">err</span><span class="op" id="7177870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177876">if</span>&nbsp;<span class="ident" id="7177879">m0</span><span class="op" id="7177881">.</span><span class="ident" id="7177882">Bounds</span><span class="op" id="7177888">(</span><span class="op" id="7177889">)</span>&nbsp;<span class="op" id="7177891">!=</span>&nbsp;<span class="ident" id="7177894">m1</span><span class="op" id="7177896">.</span><span class="ident" id="7177897">Bounds</span><span class="op" id="7177903">(</span><span class="op" id="7177904">)</span>&nbsp;<span class="op" id="7177906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177910">t</span><span class="op" id="7177911">.</span><span class="ident" id="7177912">Fatalf</span><span class="op" id="7177918">(</span><span class="string" id="7177919">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7177945">,</span>&nbsp;<span class="ident" id="7177947">m0</span><span class="op" id="7177949">.</span><span class="ident" id="7177950">Bounds</span><span class="op" id="7177956">(</span><span class="op" id="7177957">)</span><span class="op" id="7177958">,</span>&nbsp;<span class="ident" id="7177960">m1</span><span class="op" id="7177962">.</span><span class="ident" id="7177963">Bounds</span><span class="op" id="7177969">(</span><span class="op" id="7177970">)</span><span class="op" id="7177971">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177977">if</span>&nbsp;<span class="ident" id="7177980">_</span><span class="op" id="7177981">,</span>&nbsp;<span class="ident" id="7177983">ok</span>&nbsp;<span class="op" id="7177986">:=</span>&nbsp;<span class="ident" id="7177989">m1</span><span class="op" id="7177991">.</span><span class="op" id="7177992">(</span><span class="op" id="7177993">*</span><span class="ident" id="7177994">image</span><span class="op" id="7177999">.</span><span class="ident" id="7178000">Gray</span><span class="op" id="7178004">)</span><span class="op" id="7178005">;</span>&nbsp;<span class="op" id="7178007">!</span><span class="ident" id="7178008">ok</span>&nbsp;<span class="op" id="7178011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178015">t</span><span class="op" id="7178016">.</span><span class="ident" id="7178017">Errorf</span><span class="op" id="7178023">(</span><span class="string" id="7178024">&#34;got&nbsp;%T,&nbsp;want&nbsp;*image.Gray&#34;</span><span class="op" id="7178050">,</span>&nbsp;<span class="ident" id="7178052">m1</span><span class="op" id="7178054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7178060">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178114">want</span>&nbsp;<span class="op" id="7178119">:=</span>&nbsp;<span class="ident" id="7178122">int64</span><span class="op" id="7178127">(</span><span class="num" id="7178128">2</span>&nbsp;<span class="op" id="7178130">&lt;&lt;</span>&nbsp;<span class="num" id="7178133">8</span><span class="op" id="7178134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178137">if</span>&nbsp;<span class="ident" id="7178140">got</span>&nbsp;<span class="op" id="7178144">:=</span>&nbsp;<span class="ident" id="7178147">averageDelta</span><span class="op" id="7178159">(</span><span class="ident" id="7178160">m0</span><span class="op" id="7178162">,</span>&nbsp;<span class="ident" id="7178164">m1</span><span class="op" id="7178166">)</span><span class="op" id="7178167">;</span>&nbsp;<span class="ident" id="7178169">got</span>&nbsp;<span class="op" id="7178173">&gt;</span>&nbsp;<span class="ident" id="7178175">want</span>&nbsp;<span class="op" id="7178180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178184">t</span><span class="op" id="7178185">.</span><span class="ident" id="7178186">Errorf</span><span class="op" id="7178192">(</span><span class="string" id="7178193">&#34;average&nbsp;delta&nbsp;too&nbsp;high;&nbsp;got&nbsp;%d,&nbsp;want&nbsp;&lt;=&nbsp;%d&#34;</span><span class="op" id="7178237">,</span>&nbsp;<span class="ident" id="7178239">got</span><span class="op" id="7178242">,</span>&nbsp;<span class="ident" id="7178244">want</span><span class="op" id="7178248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178251">}</span><br>
<span class="lineno"></span><span class="op" id="7178253">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7178256">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7178332">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7178357">func</span>&nbsp;<span class="ident" id="7178362">averageDelta</span><span class="op" id="7178374">(</span><span class="ident" id="7178375">m0</span><span class="op" id="7178377">,</span>&nbsp;<span class="ident" id="7178379">m1</span>&nbsp;<span class="ident" id="7178382">image</span><span class="op" id="7178387">.</span><span class="ident" id="7178388">Image</span><span class="op" id="7178393">)</span>&nbsp;<span class="ident" id="7178395">int64</span>&nbsp;<span class="op" id="7178401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178404">b</span>&nbsp;<span class="op" id="7178406">:=</span>&nbsp;<span class="ident" id="7178409">m0</span><span class="op" id="7178411">.</span><span class="ident" id="7178412">Bounds</span><span class="op" id="7178418">(</span><span class="op" id="7178419">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178422">var</span>&nbsp;<span class="ident" id="7178426">sum</span><span class="op" id="7178429">,</span>&nbsp;<span class="ident" id="7178431">n</span>&nbsp;<span class="ident" id="7178433">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178440">for</span>&nbsp;<span class="ident" id="7178444">y</span>&nbsp;<span class="op" id="7178446">:=</span>&nbsp;<span class="ident" id="7178449">b</span><span class="op" id="7178450">.</span><span class="ident" id="7178451">Min</span><span class="op" id="7178454">.</span><span class="ident" id="7178455">Y</span><span class="op" id="7178456">;</span>&nbsp;<span class="ident" id="7178458">y</span>&nbsp;<span class="op" id="7178460">&lt;</span>&nbsp;<span class="ident" id="7178462">b</span><span class="op" id="7178463">.</span><span class="ident" id="7178464">Max</span><span class="op" id="7178467">.</span><span class="ident" id="7178468">Y</span><span class="op" id="7178469">;</span>&nbsp;<span class="ident" id="7178471">y</span><span class="op" id="7178472">++</span>&nbsp;<span class="op" id="7178475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178479">for</span>&nbsp;<span class="ident" id="7178483">x</span>&nbsp;<span class="op" id="7178485">:=</span>&nbsp;<span class="ident" id="7178488">b</span><span class="op" id="7178489">.</span><span class="ident" id="7178490">Min</span><span class="op" id="7178493">.</span><span class="ident" id="7178494">X</span><span class="op" id="7178495">;</span>&nbsp;<span class="ident" id="7178497">x</span>&nbsp;<span class="op" id="7178499">&lt;</span>&nbsp;<span class="ident" id="7178501">b</span><span class="op" id="7178502">.</span><span class="ident" id="7178503">Max</span><span class="op" id="7178506">.</span><span class="ident" id="7178507">X</span><span class="op" id="7178508">;</span>&nbsp;<span class="ident" id="7178510">x</span><span class="op" id="7178511">++</span>&nbsp;<span class="op" id="7178514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178519">c0</span>&nbsp;<span class="op" id="7178522">:=</span>&nbsp;<span class="ident" id="7178525">m0</span><span class="op" id="7178527">.</span><span class="ident" id="7178528">At</span><span class="op" id="7178530">(</span><span class="ident" id="7178531">x</span><span class="op" id="7178532">,</span>&nbsp;<span class="ident" id="7178534">y</span><span class="op" id="7178535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178540">c1</span>&nbsp;<span class="op" id="7178543">:=</span>&nbsp;<span class="ident" id="7178546">m1</span><span class="op" id="7178548">.</span><span class="ident" id="7178549">At</span><span class="op" id="7178551">(</span><span class="ident" id="7178552">x</span><span class="op" id="7178553">,</span>&nbsp;<span class="ident" id="7178555">y</span><span class="op" id="7178556">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178561">r0</span><span class="op" id="7178563">,</span>&nbsp;<span class="ident" id="7178565">g0</span><span class="op" id="7178567">,</span>&nbsp;<span class="ident" id="7178569">b0</span><span class="op" id="7178571">,</span>&nbsp;<span class="ident" id="7178573">_</span>&nbsp;<span class="op" id="7178575">:=</span>&nbsp;<span class="ident" id="7178578">c0</span><span class="op" id="7178580">.</span><span class="ident" id="7178581">RGBA</span><span class="op" id="7178585">(</span><span class="op" id="7178586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178591">r1</span><span class="op" id="7178593">,</span>&nbsp;<span class="ident" id="7178595">g1</span><span class="op" id="7178597">,</span>&nbsp;<span class="ident" id="7178599">b1</span><span class="op" id="7178601">,</span>&nbsp;<span class="ident" id="7178603">_</span>&nbsp;<span class="op" id="7178605">:=</span>&nbsp;<span class="ident" id="7178608">c1</span><span class="op" id="7178610">.</span><span class="ident" id="7178611">RGBA</span><span class="op" id="7178615">(</span><span class="op" id="7178616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178621">sum</span>&nbsp;<span class="op" id="7178625">+=</span>&nbsp;<span class="ident" id="7178628">delta</span><span class="op" id="7178633">(</span><span class="ident" id="7178634">r0</span><span class="op" id="7178636">,</span>&nbsp;<span class="ident" id="7178638">r1</span><span class="op" id="7178640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178645">sum</span>&nbsp;<span class="op" id="7178649">+=</span>&nbsp;<span class="ident" id="7178652">delta</span><span class="op" id="7178657">(</span><span class="ident" id="7178658">g0</span><span class="op" id="7178660">,</span>&nbsp;<span class="ident" id="7178662">g1</span><span class="op" id="7178664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178669">sum</span>&nbsp;<span class="op" id="7178673">+=</span>&nbsp;<span class="ident" id="7178676">delta</span><span class="op" id="7178681">(</span><span class="ident" id="7178682">b0</span><span class="op" id="7178684">,</span>&nbsp;<span class="ident" id="7178686">b1</span><span class="op" id="7178688">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178693">n</span>&nbsp;<span class="op" id="7178695">+=</span>&nbsp;<span class="num" id="7178698">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178708">return</span>&nbsp;<span class="ident" id="7178715">sum</span>&nbsp;<span class="op" id="7178719">/</span>&nbsp;<span class="ident" id="7178721">n</span><br>
<span class="lineno"></span><span class="op" id="7178723">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="7178726">func</span>&nbsp;<span class="ident" id="7178731">BenchmarkEncode</span><span class="op" id="7178746">(</span><span class="ident" id="7178747">b</span>&nbsp;<span class="op" id="7178749">*</span><span class="ident" id="7178750">testing</span><span class="op" id="7178757">.</span><span class="ident" id="7178758">B</span><span class="op" id="7178759">)</span>&nbsp;<span class="op" id="7178761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178764">b</span><span class="op" id="7178765">.</span><span class="ident" id="7178766">StopTimer</span><span class="op" id="7178775">(</span><span class="op" id="7178776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178779">img</span>&nbsp;<span class="op" id="7178783">:=</span>&nbsp;<span class="ident" id="7178786">image</span><span class="op" id="7178791">.</span><span class="ident" id="7178792">NewRGBA</span><span class="op" id="7178799">(</span><span class="ident" id="7178800">image</span><span class="op" id="7178805">.</span><span class="ident" id="7178806">Rect</span><span class="op" id="7178810">(</span><span class="num" id="7178811">0</span><span class="op" id="7178812">,</span>&nbsp;<span class="num" id="7178814">0</span><span class="op" id="7178815">,</span>&nbsp;<span class="num" id="7178817">640</span><span class="op" id="7178820">,</span>&nbsp;<span class="num" id="7178822">480</span><span class="op" id="7178825">)</span><span class="op" id="7178826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178829">bo</span>&nbsp;<span class="op" id="7178832">:=</span>&nbsp;<span class="ident" id="7178835">img</span><span class="op" id="7178838">.</span><span class="ident" id="7178839">Bounds</span><span class="op" id="7178845">(</span><span class="op" id="7178846">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178849">rnd</span>&nbsp;<span class="op" id="7178853">:=</span>&nbsp;<span class="ident" id="7178856">rand</span><span class="op" id="7178860">.</span><span class="ident" id="7178861">New</span><span class="op" id="7178864">(</span><span class="ident" id="7178865">rand</span><span class="op" id="7178869">.</span><span class="ident" id="7178870">NewSource</span><span class="op" id="7178879">(</span><span class="num" id="7178880">123</span><span class="op" id="7178883">)</span><span class="op" id="7178884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178887">for</span>&nbsp;<span class="ident" id="7178891">y</span>&nbsp;<span class="op" id="7178893">:=</span>&nbsp;<span class="ident" id="7178896">bo</span><span class="op" id="7178898">.</span><span class="ident" id="7178899">Min</span><span class="op" id="7178902">.</span><span class="ident" id="7178903">Y</span><span class="op" id="7178904">;</span>&nbsp;<span class="ident" id="7178906">y</span>&nbsp;<span class="op" id="7178908">&lt;</span>&nbsp;<span class="ident" id="7178910">bo</span><span class="op" id="7178912">.</span><span class="ident" id="7178913">Max</span><span class="op" id="7178916">.</span><span class="ident" id="7178917">Y</span><span class="op" id="7178918">;</span>&nbsp;<span class="ident" id="7178920">y</span><span class="op" id="7178921">++</span>&nbsp;<span class="op" id="7178924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178928">for</span>&nbsp;<span class="ident" id="7178932">x</span>&nbsp;<span class="op" id="7178934">:=</span>&nbsp;<span class="ident" id="7178937">bo</span><span class="op" id="7178939">.</span><span class="ident" id="7178940">Min</span><span class="op" id="7178943">.</span><span class="ident" id="7178944">X</span><span class="op" id="7178945">;</span>&nbsp;<span class="ident" id="7178947">x</span>&nbsp;<span class="op" id="7178949">&lt;</span>&nbsp;<span class="ident" id="7178951">bo</span><span class="op" id="7178953">.</span><span class="ident" id="7178954">Max</span><span class="op" id="7178957">.</span><span class="ident" id="7178958">X</span><span class="op" id="7178959">;</span>&nbsp;<span class="ident" id="7178961">x</span><span class="op" id="7178962">++</span>&nbsp;<span class="op" id="7178965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178970">img</span><span class="op" id="7178973">.</span><span class="ident" id="7178974">SetRGBA</span><span class="op" id="7178981">(</span><span class="ident" id="7178982">x</span><span class="op" id="7178983">,</span>&nbsp;<span class="ident" id="7178985">y</span><span class="op" id="7178986">,</span>&nbsp;<span class="ident" id="7178988">color</span><span class="op" id="7178993">.</span><span class="ident" id="7178994">RGBA</span><span class="op" id="7178998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7179004">uint8</span><span class="op" id="7179009">(</span><span class="ident" id="7179010">rnd</span><span class="op" id="7179013">.</span><span class="ident" id="7179014">Intn</span><span class="op" id="7179018">(</span><span class="num" id="7179019">256</span><span class="op" id="7179022">)</span><span class="op" id="7179023">)</span><span class="op" id="7179024">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7179030">uint8</span><span class="op" id="7179035">(</span><span class="ident" id="7179036">rnd</span><span class="op" id="7179039">.</span><span class="ident" id="7179040">Intn</span><span class="op" id="7179044">(</span><span class="num" id="7179045">256</span><span class="op" id="7179048">)</span><span class="op" id="7179049">)</span><span class="op" id="7179050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7179056">uint8</span><span class="op" id="7179061">(</span><span class="ident" id="7179062">rnd</span><span class="op" id="7179065">.</span><span class="ident" id="7179066">Intn</span><span class="op" id="7179070">(</span><span class="num" id="7179071">256</span><span class="op" id="7179074">)</span><span class="op" id="7179075">)</span><span class="op" id="7179076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7179082">255</span><span class="op" id="7179085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179090">}</span><span class="op" id="7179091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179095">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179101">b</span><span class="op" id="7179102">.</span><span class="ident" id="7179103">SetBytes</span><span class="op" id="7179111">(</span><span class="num" id="7179112">640</span>&nbsp;<span class="op" id="7179116">*</span>&nbsp;<span class="num" id="7179118">480</span>&nbsp;<span class="op" id="7179122">*</span>&nbsp;<span class="num" id="7179124">4</span><span class="op" id="7179125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179128">b</span><span class="op" id="7179129">.</span><span class="ident" id="7179130">StartTimer</span><span class="op" id="7179140">(</span><span class="op" id="7179141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179144">options</span>&nbsp;<span class="op" id="7179152">:=</span>&nbsp;<span class="op" id="7179155">&amp;</span><span class="ident" id="7179156">Options</span><span class="op" id="7179163">{</span><span class="ident" id="7179164">Quality</span><span class="op" id="7179171">:</span>&nbsp;<span class="num" id="7179173">90</span><span class="op" id="7179175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179178">for</span>&nbsp;<span class="ident" id="7179182">i</span>&nbsp;<span class="op" id="7179184">:=</span>&nbsp;<span class="num" id="7179187">0</span><span class="op" id="7179188">;</span>&nbsp;<span class="ident" id="7179190">i</span>&nbsp;<span class="op" id="7179192">&lt;</span>&nbsp;<span class="ident" id="7179194">b</span><span class="op" id="7179195">.</span><span class="ident" id="7179196">N</span><span class="op" id="7179197">;</span>&nbsp;<span class="ident" id="7179199">i</span><span class="op" id="7179200">++</span>&nbsp;<span class="op" id="7179203">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179207">Encode</span><span class="op" id="7179213">(</span><span class="ident" id="7179214">ioutil</span><span class="op" id="7179220">.</span><span class="ident" id="7179221">Discard</span><span class="op" id="7179228">,</span>&nbsp;<span class="ident" id="7179230">img</span><span class="op" id="7179233">,</span>&nbsp;<span class="ident" id="7179235">options</span><span class="op" id="7179242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179245">}</span><br>
<span class="lineno"></span><span class="op" id="7179247">}</span>
</div>
</body>
</html>
