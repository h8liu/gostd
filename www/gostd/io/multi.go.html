<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html" class="current">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1431190">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1431245">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1431299">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1431350">package</span>&nbsp;<span class="ident" id="1431358">io</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1431362">type</span>&nbsp;<span class="ident" id="1431367">multiReader</span>&nbsp;<span class="keyword" id="1431379">struct</span>&nbsp;<span class="op" id="1431386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1431389">readers</span>&nbsp;<span class="op" id="1431397">[</span><span class="op" id="1431398">]</span><span class="ident" id="1431399">Reader</span><br>
<span class="lineno"></span><span class="op" id="1431406">}</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1431409">func</span>&nbsp;<span class="op" id="1431414">(</span><span class="ident" id="1431415">mr</span>&nbsp;<span class="op" id="1431418">*</span><span class="ident" id="1431419">multiReader</span><span class="op" id="1431430">)</span>&nbsp;<span class="ident" id="1431432">Read</span><span class="op" id="1431436">(</span><span class="ident" id="1431437">p</span>&nbsp;<span class="op" id="1431439">[</span><span class="op" id="1431440">]</span><span class="builtintype" id="1431441">byte</span><span class="op" id="1431445">)</span>&nbsp;<span class="op" id="1431447">(</span><span class="ident" id="1431448">n</span>&nbsp;<span class="builtintype" id="1431450">int</span><span class="op" id="1431453">,</span>&nbsp;<span class="ident" id="1431455">err</span>&nbsp;<span class="builtintype" id="1431459">error</span><span class="op" id="1431464">)</span>&nbsp;<span class="op" id="1431466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1431469">for</span>&nbsp;<span class="builtinfunc" id="1431473">len</span><span class="op" id="1431476">(</span><span class="ident" id="1431477">mr</span><span class="op" id="1431479">.</span><span class="ident" id="1431480">readers</span><span class="op" id="1431487">)</span>&nbsp;<span class="op" id="1431489">&gt;</span>&nbsp;<span class="num" id="1431491">0</span>&nbsp;<span class="op" id="1431493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1431497">n</span><span class="op" id="1431498">,</span>&nbsp;<span class="ident" id="1431500">err</span>&nbsp;<span class="op" id="1431504">=</span>&nbsp;<span class="ident" id="1431506">mr</span><span class="op" id="1431508">.</span><span class="ident" id="1431509">readers</span><span class="op" id="1431516">[</span><span class="num" id="1431517">0</span><span class="op" id="1431518">]</span><span class="op" id="1431519">.</span><span class="ident" id="1431520">Read</span><span class="op" id="1431524">(</span><span class="ident" id="1431525">p</span><span class="op" id="1431526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1431530">if</span>&nbsp;<span class="ident" id="1431533">n</span>&nbsp;<span class="op" id="1431535">&gt;</span>&nbsp;<span class="num" id="1431537">0</span>&nbsp;<span class="op" id="1431539">||</span>&nbsp;<span class="ident" id="1431542">err</span>&nbsp;<span class="op" id="1431546">!=</span>&nbsp;<span class="ident" id="1431549">EOF</span>&nbsp;<span class="op" id="1431553">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1431558">if</span>&nbsp;<span class="ident" id="1431561">err</span>&nbsp;<span class="op" id="1431565">==</span>&nbsp;<span class="ident" id="1431568">EOF</span>&nbsp;<span class="op" id="1431572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1431578">//&nbsp;Don&#39;t&nbsp;return&nbsp;EOF&nbsp;yet.&nbsp;There&nbsp;may&nbsp;be&nbsp;more&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1431631">//&nbsp;in&nbsp;the&nbsp;remaining&nbsp;readers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1431664">err</span>&nbsp;<span class="op" id="1431668">=</span>&nbsp;<span class="ident" id="1431670">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1431677">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1431682">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1431691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1431695">mr</span><span class="op" id="1431697">.</span><span class="ident" id="1431698">readers</span>&nbsp;<span class="op" id="1431706">=</span>&nbsp;<span class="ident" id="1431708">mr</span><span class="op" id="1431710">.</span><span class="ident" id="1431711">readers</span><span class="op" id="1431718">[</span><span class="num" id="1431719">1</span><span class="op" id="1431720">:</span><span class="op" id="1431721">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1431724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1431727">return</span>&nbsp;<span class="num" id="1431734">0</span><span class="op" id="1431735">,</span>&nbsp;<span class="ident" id="1431737">EOF</span><br>
<span class="lineno">25</span><span class="op" id="1431741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1431744">//&nbsp;MultiReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&#39;s&nbsp;the&nbsp;logical&nbsp;concatenation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1431812">//&nbsp;the&nbsp;provided&nbsp;input&nbsp;readers.&nbsp;&nbsp;They&#39;re&nbsp;read&nbsp;sequentially.&nbsp;&nbsp;Once&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1431881">//&nbsp;inputs&nbsp;have&nbsp;returned&nbsp;EOF,&nbsp;Read&nbsp;will&nbsp;return&nbsp;EOF.&nbsp;&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;readers</span><br>
<span class="lineno">30</span><span class="comment" id="1431955">//&nbsp;return&nbsp;a&nbsp;non-nil,&nbsp;non-EOF&nbsp;error,&nbsp;Read&nbsp;will&nbsp;return&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="1432020">func</span>&nbsp;<span class="ident" id="1432025">MultiReader</span><span class="op" id="1432036">(</span><span class="ident" id="1432037">readers</span>&nbsp;<span class="op" id="1432045">...</span><span class="ident" id="1432048">Reader</span><span class="op" id="1432054">)</span>&nbsp;<span class="ident" id="1432056">Reader</span>&nbsp;<span class="op" id="1432063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1432066">r</span>&nbsp;<span class="op" id="1432068">:=</span>&nbsp;<span class="builtinfunc" id="1432071">make</span><span class="op" id="1432075">(</span><span class="op" id="1432076">[</span><span class="op" id="1432077">]</span><span class="ident" id="1432078">Reader</span><span class="op" id="1432084">,</span>&nbsp;<span class="builtinfunc" id="1432086">len</span><span class="op" id="1432089">(</span><span class="ident" id="1432090">readers</span><span class="op" id="1432097">)</span><span class="op" id="1432098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1432101">copy</span><span class="op" id="1432105">(</span><span class="ident" id="1432106">r</span><span class="op" id="1432107">,</span>&nbsp;<span class="ident" id="1432109">readers</span><span class="op" id="1432116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1432119">return</span>&nbsp;<span class="op" id="1432126">&amp;</span><span class="ident" id="1432127">multiReader</span><span class="op" id="1432138">{</span><span class="ident" id="1432139">r</span><span class="op" id="1432140">}</span><br>
<span class="lineno">35</span><span class="op" id="1432142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1432145">type</span>&nbsp;<span class="ident" id="1432150">multiWriter</span>&nbsp;<span class="keyword" id="1432162">struct</span>&nbsp;<span class="op" id="1432169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1432172">writers</span>&nbsp;<span class="op" id="1432180">[</span><span class="op" id="1432181">]</span><span class="ident" id="1432182">Writer</span><br>
<span class="lineno"></span><span class="op" id="1432189">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1432192">func</span>&nbsp;<span class="op" id="1432197">(</span><span class="ident" id="1432198">t</span>&nbsp;<span class="op" id="1432200">*</span><span class="ident" id="1432201">multiWriter</span><span class="op" id="1432212">)</span>&nbsp;<span class="ident" id="1432214">Write</span><span class="op" id="1432219">(</span><span class="ident" id="1432220">p</span>&nbsp;<span class="op" id="1432222">[</span><span class="op" id="1432223">]</span><span class="builtintype" id="1432224">byte</span><span class="op" id="1432228">)</span>&nbsp;<span class="op" id="1432230">(</span><span class="ident" id="1432231">n</span>&nbsp;<span class="builtintype" id="1432233">int</span><span class="op" id="1432236">,</span>&nbsp;<span class="ident" id="1432238">err</span>&nbsp;<span class="builtintype" id="1432242">error</span><span class="op" id="1432247">)</span>&nbsp;<span class="op" id="1432249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1432252">for</span>&nbsp;<span class="ident" id="1432256">_</span><span class="op" id="1432257">,</span>&nbsp;<span class="ident" id="1432259">w</span>&nbsp;<span class="op" id="1432261">:=</span>&nbsp;<span class="keyword" id="1432264">range</span>&nbsp;<span class="ident" id="1432270">t</span><span class="op" id="1432271">.</span><span class="ident" id="1432272">writers</span>&nbsp;<span class="op" id="1432280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1432284">n</span><span class="op" id="1432285">,</span>&nbsp;<span class="ident" id="1432287">err</span>&nbsp;<span class="op" id="1432291">=</span>&nbsp;<span class="ident" id="1432293">w</span><span class="op" id="1432294">.</span><span class="ident" id="1432295">Write</span><span class="op" id="1432300">(</span><span class="ident" id="1432301">p</span><span class="op" id="1432302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1432306">if</span>&nbsp;<span class="ident" id="1432309">err</span>&nbsp;<span class="op" id="1432313">!=</span>&nbsp;<span class="ident" id="1432316">nil</span>&nbsp;<span class="op" id="1432320">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1432325">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1432334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1432338">if</span>&nbsp;<span class="ident" id="1432341">n</span>&nbsp;<span class="op" id="1432343">!=</span>&nbsp;<span class="builtinfunc" id="1432346">len</span><span class="op" id="1432349">(</span><span class="ident" id="1432350">p</span><span class="op" id="1432351">)</span>&nbsp;<span class="op" id="1432353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1432358">err</span>&nbsp;<span class="op" id="1432362">=</span>&nbsp;<span class="ident" id="1432364">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1432381">return</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1432390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1432393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1432396">return</span>&nbsp;<span class="builtinfunc" id="1432403">len</span><span class="op" id="1432406">(</span><span class="ident" id="1432407">p</span><span class="op" id="1432408">)</span><span class="op" id="1432409">,</span>&nbsp;<span class="ident" id="1432411">nil</span><br>
<span class="lineno"></span><span class="op" id="1432415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1432418">//&nbsp;MultiWriter&nbsp;creates&nbsp;a&nbsp;writer&nbsp;that&nbsp;duplicates&nbsp;its&nbsp;writes&nbsp;to&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1432488">//&nbsp;provided&nbsp;writers,&nbsp;similar&nbsp;to&nbsp;the&nbsp;Unix&nbsp;tee(1)&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="1432545">func</span>&nbsp;<span class="ident" id="1432550">MultiWriter</span><span class="op" id="1432561">(</span><span class="ident" id="1432562">writers</span>&nbsp;<span class="op" id="1432570">...</span><span class="ident" id="1432573">Writer</span><span class="op" id="1432579">)</span>&nbsp;<span class="ident" id="1432581">Writer</span>&nbsp;<span class="op" id="1432588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1432591">w</span>&nbsp;<span class="op" id="1432593">:=</span>&nbsp;<span class="builtinfunc" id="1432596">make</span><span class="op" id="1432600">(</span><span class="op" id="1432601">[</span><span class="op" id="1432602">]</span><span class="ident" id="1432603">Writer</span><span class="op" id="1432609">,</span>&nbsp;<span class="builtinfunc" id="1432611">len</span><span class="op" id="1432614">(</span><span class="ident" id="1432615">writers</span><span class="op" id="1432622">)</span><span class="op" id="1432623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1432626">copy</span><span class="op" id="1432630">(</span><span class="ident" id="1432631">w</span><span class="op" id="1432632">,</span>&nbsp;<span class="ident" id="1432634">writers</span><span class="op" id="1432641">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1432644">return</span>&nbsp;<span class="op" id="1432651">&amp;</span><span class="ident" id="1432652">multiWriter</span><span class="op" id="1432663">{</span><span class="ident" id="1432664">w</span><span class="op" id="1432665">}</span><br>
<span class="lineno"></span><span class="op" id="1432667">}</span>
</div>
</body>
</html>
