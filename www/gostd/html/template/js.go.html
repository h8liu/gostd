<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5175603">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5175658">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5175712">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5175763">package</span>&nbsp;<span class="ident" id="5175771">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5175781">import</span>&nbsp;<span class="op" id="5175788">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5175791">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5175800">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5175817">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5175824">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5175835">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5175846">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5175861">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5175864">//&nbsp;nextJSCtx&nbsp;returns&nbsp;the&nbsp;context&nbsp;that&nbsp;determines&nbsp;whether&nbsp;a&nbsp;slash&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5175939">//&nbsp;given&nbsp;run&nbsp;of&nbsp;tokens&nbsp;starts&nbsp;a&nbsp;regular&nbsp;expression&nbsp;instead&nbsp;of&nbsp;a&nbsp;division</span><br>
<span class="lineno"></span><span class="comment" id="5176012">//&nbsp;operator:&nbsp;/&nbsp;or&nbsp;/=.</span><br>
<span class="lineno"></span><span class="comment" id="5176034">//</span><br>
<span class="lineno">20</span><span class="comment" id="5176037">//&nbsp;This&nbsp;assumes&nbsp;that&nbsp;the&nbsp;token&nbsp;run&nbsp;does&nbsp;not&nbsp;include&nbsp;any&nbsp;string&nbsp;tokens,&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5176116">//&nbsp;tokens,&nbsp;regular&nbsp;expression&nbsp;literal&nbsp;tokens,&nbsp;or&nbsp;division&nbsp;operators.</span><br>
<span class="lineno"></span><span class="comment" id="5176185">//</span><br>
<span class="lineno"></span><span class="comment" id="5176188">//&nbsp;This&nbsp;fails&nbsp;on&nbsp;some&nbsp;valid&nbsp;but&nbsp;nonsensical&nbsp;JavaScript&nbsp;programs&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="5176257">//&nbsp;&#34;x&nbsp;=&nbsp;++/foo/i&#34;&nbsp;which&nbsp;is&nbsp;quite&nbsp;different&nbsp;than&nbsp;&#34;x++/foo/i&#34;,&nbsp;but&nbsp;is&nbsp;not&nbsp;known&nbsp;to</span><br>
<span class="lineno">25</span><span class="comment" id="5176338">//&nbsp;fail&nbsp;on&nbsp;any&nbsp;known&nbsp;useful&nbsp;programs.&nbsp;It&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;draft</span><br>
<span class="lineno"></span><span class="comment" id="5176401">//&nbsp;JavaScript&nbsp;2.0&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;requires&nbsp;one&nbsp;token&nbsp;of&nbsp;lookbehind:</span><br>
<span class="lineno"></span><span class="comment" id="5176473">//&nbsp;http://www.mozilla.org/js/language/js20-2000-07/rationale/syntax.html</span><br>
<span class="lineno"></span><span class="keyword" id="5176546">func</span>&nbsp;<span class="ident" id="5176551">nextJSCtx</span><span class="op" id="5176560">(</span><span class="ident" id="5176561">s</span>&nbsp;<span class="op" id="5176563">[</span><span class="op" id="5176564">]</span><span class="builtintype" id="5176565">byte</span><span class="op" id="5176569">,</span>&nbsp;<span class="ident" id="5176571">preceding</span>&nbsp;<span class="ident" id="5176581">jsCtx</span><span class="op" id="5176586">)</span>&nbsp;<span class="ident" id="5176588">jsCtx</span>&nbsp;<span class="op" id="5176594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5176597">s</span>&nbsp;<span class="op" id="5176599">=</span>&nbsp;<span class="ident" id="5176601">bytes</span><span class="op" id="5176606">.</span><span class="ident" id="5176607">TrimRight</span><span class="op" id="5176616">(</span><span class="ident" id="5176617">s</span><span class="op" id="5176618">,</span>&nbsp;<span class="string" id="5176620">&#34;\t\n\f\r&nbsp;\u2028\u2029&#34;</span><span class="op" id="5176643">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5176646">if</span>&nbsp;<span class="builtinfunc" id="5176649">len</span><span class="op" id="5176652">(</span><span class="ident" id="5176653">s</span><span class="op" id="5176654">)</span>&nbsp;<span class="op" id="5176656">==</span>&nbsp;<span class="num" id="5176659">0</span>&nbsp;<span class="op" id="5176661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5176665">return</span>&nbsp;<span class="ident" id="5176672">preceding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5176683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5176687">//&nbsp;All&nbsp;cases&nbsp;below&nbsp;are&nbsp;in&nbsp;the&nbsp;single-byte&nbsp;UTF-8&nbsp;group.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5176743">switch</span>&nbsp;<span class="ident" id="5176750">c</span><span class="op" id="5176751">,</span>&nbsp;<span class="ident" id="5176753">n</span>&nbsp;<span class="op" id="5176755">:=</span>&nbsp;<span class="ident" id="5176758">s</span><span class="op" id="5176759">[</span><span class="builtinfunc" id="5176760">len</span><span class="op" id="5176763">(</span><span class="ident" id="5176764">s</span><span class="op" id="5176765">)</span><span class="op" id="5176766">-</span><span class="num" id="5176767">1</span><span class="op" id="5176768">]</span><span class="op" id="5176769">,</span>&nbsp;<span class="builtinfunc" id="5176771">len</span><span class="op" id="5176774">(</span><span class="ident" id="5176775">s</span><span class="op" id="5176776">)</span><span class="op" id="5176777">;</span>&nbsp;<span class="ident" id="5176779">c</span>&nbsp;<span class="op" id="5176781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5176784">case</span>&nbsp;<span class="string" id="5176789">&#39;+&#39;</span><span class="op" id="5176792">,</span>&nbsp;<span class="string" id="5176794">&#39;-&#39;</span><span class="op" id="5176797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5176801">//&nbsp;++&nbsp;and&nbsp;--&nbsp;are&nbsp;not&nbsp;regexp&nbsp;preceders,&nbsp;but&nbsp;+&nbsp;and&nbsp;-&nbsp;are&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5176866">//&nbsp;they&nbsp;are&nbsp;used&nbsp;as&nbsp;infix&nbsp;or&nbsp;prefix&nbsp;operators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5176915">start</span>&nbsp;<span class="op" id="5176921">:=</span>&nbsp;<span class="ident" id="5176924">n</span>&nbsp;<span class="op" id="5176926">-</span>&nbsp;<span class="num" id="5176928">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5176932">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;adjacent&nbsp;dashes&nbsp;or&nbsp;pluses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5176984">for</span>&nbsp;<span class="ident" id="5176988">start</span>&nbsp;<span class="op" id="5176994">&gt;</span>&nbsp;<span class="num" id="5176996">0</span>&nbsp;<span class="op" id="5176998">&amp;&amp;</span>&nbsp;<span class="ident" id="5177001">s</span><span class="op" id="5177002">[</span><span class="ident" id="5177003">start</span><span class="op" id="5177008">-</span><span class="num" id="5177009">1</span><span class="op" id="5177010">]</span>&nbsp;<span class="op" id="5177012">==</span>&nbsp;<span class="ident" id="5177015">c</span>&nbsp;<span class="op" id="5177017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177022">start</span><span class="op" id="5177027">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5177032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177036">if</span>&nbsp;<span class="op" id="5177039">(</span><span class="ident" id="5177040">n</span><span class="op" id="5177041">-</span><span class="ident" id="5177042">start</span><span class="op" id="5177047">)</span><span class="op" id="5177048">&amp;</span><span class="num" id="5177049">1</span>&nbsp;<span class="op" id="5177051">==</span>&nbsp;<span class="num" id="5177054">1</span>&nbsp;<span class="op" id="5177056">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177061">//&nbsp;Reached&nbsp;for&nbsp;trailing&nbsp;minus&nbsp;signs&nbsp;since&nbsp;&#34;---&#34;&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177119">//&nbsp;same&nbsp;as&nbsp;&#34;--&nbsp;-&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177141">return</span>&nbsp;<span class="ident" id="5177148">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5177162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177166">return</span>&nbsp;<span class="ident" id="5177173">jsCtxDivOp</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177185">case</span>&nbsp;<span class="string" id="5177190">&#39;.&#39;</span><span class="op" id="5177193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177197">//&nbsp;Handle&nbsp;&#34;42.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177215">if</span>&nbsp;<span class="ident" id="5177218">n</span>&nbsp;<span class="op" id="5177220">!=</span>&nbsp;<span class="num" id="5177223">1</span>&nbsp;<span class="op" id="5177225">&amp;&amp;</span>&nbsp;<span class="string" id="5177228">&#39;0&#39;</span>&nbsp;<span class="op" id="5177232">&lt;=</span>&nbsp;<span class="ident" id="5177235">s</span><span class="op" id="5177236">[</span><span class="ident" id="5177237">n</span><span class="op" id="5177238">-</span><span class="num" id="5177239">2</span><span class="op" id="5177240">]</span>&nbsp;<span class="op" id="5177242">&amp;&amp;</span>&nbsp;<span class="ident" id="5177245">s</span><span class="op" id="5177246">[</span><span class="ident" id="5177247">n</span><span class="op" id="5177248">-</span><span class="num" id="5177249">2</span><span class="op" id="5177250">]</span>&nbsp;<span class="op" id="5177252">&lt;=</span>&nbsp;<span class="string" id="5177255">&#39;9&#39;</span>&nbsp;<span class="op" id="5177259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177264">return</span>&nbsp;<span class="ident" id="5177271">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5177284">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177288">return</span>&nbsp;<span class="ident" id="5177295">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177308">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177379">//&nbsp;that&nbsp;only&nbsp;end&nbsp;binary&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177433">case</span>&nbsp;<span class="string" id="5177438">&#39;,&#39;</span><span class="op" id="5177441">,</span>&nbsp;<span class="string" id="5177443">&#39;&lt;&#39;</span><span class="op" id="5177446">,</span>&nbsp;<span class="string" id="5177448">&#39;&gt;&#39;</span><span class="op" id="5177451">,</span>&nbsp;<span class="string" id="5177453">&#39;=&#39;</span><span class="op" id="5177456">,</span>&nbsp;<span class="string" id="5177458">&#39;*&#39;</span><span class="op" id="5177461">,</span>&nbsp;<span class="string" id="5177463">&#39;%&#39;</span><span class="op" id="5177466">,</span>&nbsp;<span class="string" id="5177468">&#39;&amp;&#39;</span><span class="op" id="5177471">,</span>&nbsp;<span class="string" id="5177473">&#39;|&#39;</span><span class="op" id="5177476">,</span>&nbsp;<span class="string" id="5177478">&#39;^&#39;</span><span class="op" id="5177481">,</span>&nbsp;<span class="string" id="5177483">&#39;?&#39;</span><span class="op" id="5177486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177490">return</span>&nbsp;<span class="ident" id="5177497">jsCtxRegexp</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177510">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177581">//&nbsp;that&nbsp;are&nbsp;prefix&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177630">case</span>&nbsp;<span class="string" id="5177635">&#39;!&#39;</span><span class="op" id="5177638">,</span>&nbsp;<span class="string" id="5177640">&#39;~&#39;</span><span class="op" id="5177643">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177647">return</span>&nbsp;<span class="ident" id="5177654">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177667">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177737">//&nbsp;that&nbsp;are&nbsp;open&nbsp;brackets&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177783">case</span>&nbsp;<span class="string" id="5177788">&#39;(&#39;</span><span class="op" id="5177791">,</span>&nbsp;<span class="string" id="5177793">&#39;[&#39;</span><span class="op" id="5177796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177800">return</span>&nbsp;<span class="ident" id="5177807">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177820">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177890">//&nbsp;that&nbsp;precede&nbsp;expression&nbsp;starts.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177926">case</span>&nbsp;<span class="string" id="5177931">&#39;:&#39;</span><span class="op" id="5177934">,</span>&nbsp;<span class="string" id="5177936">&#39;;&#39;</span><span class="op" id="5177939">,</span>&nbsp;<span class="string" id="5177941">&#39;{&#39;</span><span class="op" id="5177944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177948">return</span>&nbsp;<span class="ident" id="5177955">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177968">//&nbsp;CAVEAT:&nbsp;the&nbsp;close&nbsp;punctuators&nbsp;(&#39;}&#39;,&nbsp;&#39;]&#39;,&nbsp;&#39;)&#39;)&nbsp;precede&nbsp;div&nbsp;ops&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178038">//&nbsp;are&nbsp;handled&nbsp;in&nbsp;the&nbsp;default&nbsp;except&nbsp;for&nbsp;&#39;}&#39;&nbsp;which&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178104">//&nbsp;division&nbsp;op&nbsp;as&nbsp;in</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178126">//&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;valueOf:&nbsp;function&nbsp;()&nbsp;{&nbsp;return&nbsp;42&nbsp;}&nbsp;}&nbsp;/&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178177">//&nbsp;which&nbsp;is&nbsp;valid,&nbsp;but,&nbsp;in&nbsp;practice,&nbsp;developers&nbsp;don&#39;t&nbsp;divide&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178246">//&nbsp;literals,&nbsp;so&nbsp;our&nbsp;heuristic&nbsp;works&nbsp;well&nbsp;for&nbsp;code&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178302">//&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;()&nbsp;{&nbsp;...&nbsp;}&nbsp;&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;sideEffect();</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178361">//&nbsp;The&nbsp;&#39;)&#39;&nbsp;punctuator&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression&nbsp;as&nbsp;in</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178423">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(b)&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178459">//&nbsp;but&nbsp;this&nbsp;is&nbsp;much&nbsp;less&nbsp;likely&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178497">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a&nbsp;+&nbsp;b)&nbsp;/&nbsp;c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5178517">case</span>&nbsp;<span class="string" id="5178522">&#39;}&#39;</span><span class="op" id="5178525">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5178529">return</span>&nbsp;<span class="ident" id="5178536">jsCtxRegexp</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5178549">default</span><span class="op" id="5178556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178560">//&nbsp;Look&nbsp;for&nbsp;an&nbsp;IdentifierName&nbsp;and&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;a&nbsp;keyword&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178624">//&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5178663">j</span>&nbsp;<span class="op" id="5178665">:=</span>&nbsp;<span class="ident" id="5178668">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5178672">for</span>&nbsp;<span class="ident" id="5178676">j</span>&nbsp;<span class="op" id="5178678">&gt;</span>&nbsp;<span class="num" id="5178680">0</span>&nbsp;<span class="op" id="5178682">&amp;&amp;</span>&nbsp;<span class="ident" id="5178685">isJSIdentPart</span><span class="op" id="5178698">(</span><span class="builtintype" id="5178699">rune</span><span class="op" id="5178703">(</span><span class="ident" id="5178704">s</span><span class="op" id="5178705">[</span><span class="ident" id="5178706">j</span><span class="op" id="5178707">-</span><span class="num" id="5178708">1</span><span class="op" id="5178709">]</span><span class="op" id="5178710">)</span><span class="op" id="5178711">)</span>&nbsp;<span class="op" id="5178713">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5178718">j</span><span class="op" id="5178719">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5178724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5178728">if</span>&nbsp;<span class="ident" id="5178731">regexpPrecederKeywords</span><span class="op" id="5178753">[</span><span class="builtintype" id="5178754">string</span><span class="op" id="5178760">(</span><span class="ident" id="5178761">s</span><span class="op" id="5178762">[</span><span class="ident" id="5178763">j</span><span class="op" id="5178764">:</span><span class="op" id="5178765">]</span><span class="op" id="5178766">)</span><span class="op" id="5178767">]</span>&nbsp;<span class="op" id="5178769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5178774">return</span>&nbsp;<span class="ident" id="5178781">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5178795">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5178798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178801">//&nbsp;Otherwise&nbsp;is&nbsp;a&nbsp;punctuator&nbsp;not&nbsp;listed&nbsp;above,&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178852">//&nbsp;a&nbsp;string&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op,&nbsp;or&nbsp;an&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178907">//&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5178936">return</span>&nbsp;<span class="ident" id="5178943">jsCtxDivOp</span><br>
<span class="lineno">100</span><span class="op" id="5178954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5178957">//&nbsp;regexpPrecederKeywords&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;reserved&nbsp;JS&nbsp;keywords&nbsp;that&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5179035">//&nbsp;regular&nbsp;expression&nbsp;in&nbsp;JS&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="5179071">var</span>&nbsp;<span class="ident" id="5179075">regexpPrecederKeywords</span>&nbsp;<span class="op" id="5179098">=</span>&nbsp;<span class="keyword" id="5179100">map</span><span class="op" id="5179103">[</span><span class="builtintype" id="5179104">string</span><span class="op" id="5179110">]</span><span class="builtintype" id="5179111">bool</span><span class="op" id="5179115">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179118">&#34;break&#34;</span><span class="op" id="5179125">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179132">true</span><span class="op" id="5179136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179139">&#34;case&#34;</span><span class="op" id="5179145">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179153">true</span><span class="op" id="5179157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179160">&#34;continue&#34;</span><span class="op" id="5179170">:</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179174">true</span><span class="op" id="5179178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179181">&#34;delete&#34;</span><span class="op" id="5179189">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179195">true</span><span class="op" id="5179199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179202">&#34;do&#34;</span><span class="op" id="5179206">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179216">true</span><span class="op" id="5179220">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179223">&#34;else&#34;</span><span class="op" id="5179229">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179237">true</span><span class="op" id="5179241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179244">&#34;finally&#34;</span><span class="op" id="5179253">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179258">true</span><span class="op" id="5179262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179265">&#34;in&#34;</span><span class="op" id="5179269">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179279">true</span><span class="op" id="5179283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179286">&#34;instanceof&#34;</span><span class="op" id="5179298">:</span>&nbsp;<span class="builtintype" id="5179300">true</span><span class="op" id="5179304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179307">&#34;return&#34;</span><span class="op" id="5179315">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179321">true</span><span class="op" id="5179325">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179328">&#34;throw&#34;</span><span class="op" id="5179335">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179342">true</span><span class="op" id="5179346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179349">&#34;try&#34;</span><span class="op" id="5179354">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179363">true</span><span class="op" id="5179367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179370">&#34;typeof&#34;</span><span class="op" id="5179378">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179384">true</span><span class="op" id="5179388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5179391">&#34;void&#34;</span><span class="op" id="5179397">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5179405">true</span><span class="op" id="5179409">,</span><br>
<span class="lineno"></span><span class="op" id="5179411">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="5179414">var</span>&nbsp;<span class="ident" id="5179418">jsonMarshalType</span>&nbsp;<span class="op" id="5179434">=</span>&nbsp;<span class="ident" id="5179436">reflect</span><span class="op" id="5179443">.</span><span class="ident" id="5179444">TypeOf</span><span class="op" id="5179450">(</span><span class="op" id="5179451">(</span><span class="op" id="5179452">*</span><span class="ident" id="5179453">json</span><span class="op" id="5179457">.</span><span class="ident" id="5179458">Marshaler</span><span class="op" id="5179467">)</span><span class="op" id="5179468">(</span><span class="ident" id="5179469">nil</span><span class="op" id="5179472">)</span><span class="op" id="5179473">)</span><span class="op" id="5179474">.</span><span class="ident" id="5179475">Elem</span><span class="op" id="5179479">(</span><span class="op" id="5179480">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5179483">//&nbsp;indirectToJSONMarshaler&nbsp;returns&nbsp;the&nbsp;value,&nbsp;after&nbsp;dereferencing&nbsp;as&nbsp;many&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="5179563">//&nbsp;as&nbsp;necessary&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type&nbsp;(or&nbsp;nil)&nbsp;or&nbsp;an&nbsp;implementation&nbsp;of&nbsp;json.Marshal.</span><br>
<span class="lineno">125</span><span class="keyword" id="5179649">func</span>&nbsp;<span class="ident" id="5179654">indirectToJSONMarshaler</span><span class="op" id="5179677">(</span><span class="ident" id="5179678">a</span>&nbsp;<span class="keyword" id="5179680">interface</span><span class="op" id="5179689">{</span><span class="op" id="5179690">}</span><span class="op" id="5179691">)</span>&nbsp;<span class="keyword" id="5179693">interface</span><span class="op" id="5179702">{</span><span class="op" id="5179703">}</span>&nbsp;<span class="op" id="5179705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5179708">v</span>&nbsp;<span class="op" id="5179710">:=</span>&nbsp;<span class="ident" id="5179713">reflect</span><span class="op" id="5179720">.</span><span class="ident" id="5179721">ValueOf</span><span class="op" id="5179728">(</span><span class="ident" id="5179729">a</span><span class="op" id="5179730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5179733">for</span>&nbsp;<span class="op" id="5179737">!</span><span class="ident" id="5179738">v</span><span class="op" id="5179739">.</span><span class="ident" id="5179740">Type</span><span class="op" id="5179744">(</span><span class="op" id="5179745">)</span><span class="op" id="5179746">.</span><span class="ident" id="5179747">Implements</span><span class="op" id="5179757">(</span><span class="ident" id="5179758">jsonMarshalType</span><span class="op" id="5179773">)</span>&nbsp;<span class="op" id="5179775">&amp;&amp;</span>&nbsp;<span class="ident" id="5179778">v</span><span class="op" id="5179779">.</span><span class="ident" id="5179780">Kind</span><span class="op" id="5179784">(</span><span class="op" id="5179785">)</span>&nbsp;<span class="op" id="5179787">==</span>&nbsp;<span class="ident" id="5179790">reflect</span><span class="op" id="5179797">.</span><span class="ident" id="5179798">Ptr</span>&nbsp;<span class="op" id="5179802">&amp;&amp;</span>&nbsp;<span class="op" id="5179805">!</span><span class="ident" id="5179806">v</span><span class="op" id="5179807">.</span><span class="ident" id="5179808">IsNil</span><span class="op" id="5179813">(</span><span class="op" id="5179814">)</span>&nbsp;<span class="op" id="5179816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5179820">v</span>&nbsp;<span class="op" id="5179822">=</span>&nbsp;<span class="ident" id="5179824">v</span><span class="op" id="5179825">.</span><span class="ident" id="5179826">Elem</span><span class="op" id="5179830">(</span><span class="op" id="5179831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5179834">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5179837">return</span>&nbsp;<span class="ident" id="5179844">v</span><span class="op" id="5179845">.</span><span class="ident" id="5179846">Interface</span><span class="op" id="5179855">(</span><span class="op" id="5179856">)</span><br>
<span class="lineno"></span><span class="op" id="5179858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5179861">//&nbsp;jsValEscaper&nbsp;escapes&nbsp;its&nbsp;inputs&nbsp;to&nbsp;a&nbsp;JS&nbsp;Expression&nbsp;(section&nbsp;11.14)&nbsp;that&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5179940">//&nbsp;neither&nbsp;side-effects&nbsp;nor&nbsp;free&nbsp;variables&nbsp;outside&nbsp;(NaN,&nbsp;Infinity).</span><br>
<span class="lineno">135</span><span class="keyword" id="5180008">func</span>&nbsp;<span class="ident" id="5180013">jsValEscaper</span><span class="op" id="5180025">(</span><span class="ident" id="5180026">args</span>&nbsp;<span class="op" id="5180031">...</span><span class="keyword" id="5180034">interface</span><span class="op" id="5180043">{</span><span class="op" id="5180044">}</span><span class="op" id="5180045">)</span>&nbsp;<span class="builtintype" id="5180047">string</span>&nbsp;<span class="op" id="5180054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180057">var</span>&nbsp;<span class="ident" id="5180061">a</span>&nbsp;<span class="keyword" id="5180063">interface</span><span class="op" id="5180072">{</span><span class="op" id="5180073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180076">if</span>&nbsp;<span class="builtinfunc" id="5180079">len</span><span class="op" id="5180082">(</span><span class="ident" id="5180083">args</span><span class="op" id="5180087">)</span>&nbsp;<span class="op" id="5180089">==</span>&nbsp;<span class="num" id="5180092">1</span>&nbsp;<span class="op" id="5180094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180098">a</span>&nbsp;<span class="op" id="5180100">=</span>&nbsp;<span class="ident" id="5180102">indirectToJSONMarshaler</span><span class="op" id="5180125">(</span><span class="ident" id="5180126">args</span><span class="op" id="5180130">[</span><span class="num" id="5180131">0</span><span class="op" id="5180132">]</span><span class="op" id="5180133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180137">switch</span>&nbsp;<span class="ident" id="5180144">t</span>&nbsp;<span class="op" id="5180146">:=</span>&nbsp;<span class="ident" id="5180149">a</span><span class="op" id="5180150">.</span><span class="op" id="5180151">(</span><span class="keyword" id="5180152">type</span><span class="op" id="5180156">)</span>&nbsp;<span class="op" id="5180158">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180162">case</span>&nbsp;<span class="ident" id="5180167">JS</span><span class="op" id="5180169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180174">return</span>&nbsp;<span class="builtintype" id="5180181">string</span><span class="op" id="5180187">(</span><span class="ident" id="5180188">t</span><span class="op" id="5180189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180193">case</span>&nbsp;<span class="ident" id="5180198">JSStr</span><span class="op" id="5180203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180208">//&nbsp;TODO:&nbsp;normalize&nbsp;quotes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180238">return</span>&nbsp;<span class="string" id="5180245">`&#34;`</span>&nbsp;<span class="op" id="5180249">+</span>&nbsp;<span class="builtintype" id="5180251">string</span><span class="op" id="5180257">(</span><span class="ident" id="5180258">t</span><span class="op" id="5180259">)</span>&nbsp;<span class="op" id="5180261">+</span>&nbsp;<span class="string" id="5180263">`&#34;`</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180269">case</span>&nbsp;<span class="ident" id="5180274">json</span><span class="op" id="5180278">.</span><span class="ident" id="5180279">Marshaler</span><span class="op" id="5180288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180293">//&nbsp;Do&nbsp;not&nbsp;treat&nbsp;as&nbsp;a&nbsp;Stringer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180326">case</span>&nbsp;<span class="ident" id="5180331">fmt</span><span class="op" id="5180334">.</span><span class="ident" id="5180335">Stringer</span><span class="op" id="5180343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180348">a</span>&nbsp;<span class="op" id="5180350">=</span>&nbsp;<span class="ident" id="5180352">t</span><span class="op" id="5180353">.</span><span class="ident" id="5180354">String</span><span class="op" id="5180360">(</span><span class="op" id="5180361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5180365">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5180368">}</span>&nbsp;<span class="keyword" id="5180370">else</span>&nbsp;<span class="op" id="5180375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180379">for</span>&nbsp;<span class="ident" id="5180383">i</span><span class="op" id="5180384">,</span>&nbsp;<span class="ident" id="5180386">arg</span>&nbsp;<span class="op" id="5180390">:=</span>&nbsp;<span class="keyword" id="5180393">range</span>&nbsp;<span class="ident" id="5180399">args</span>&nbsp;<span class="op" id="5180404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180409">args</span><span class="op" id="5180413">[</span><span class="ident" id="5180414">i</span><span class="op" id="5180415">]</span>&nbsp;<span class="op" id="5180417">=</span>&nbsp;<span class="ident" id="5180419">indirectToJSONMarshaler</span><span class="op" id="5180442">(</span><span class="ident" id="5180443">arg</span><span class="op" id="5180446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5180450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180454">a</span>&nbsp;<span class="op" id="5180456">=</span>&nbsp;<span class="ident" id="5180458">fmt</span><span class="op" id="5180461">.</span><span class="ident" id="5180462">Sprint</span><span class="op" id="5180468">(</span><span class="ident" id="5180469">args</span><span class="op" id="5180473">...</span><span class="op" id="5180476">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5180479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180482">//&nbsp;TODO:&nbsp;detect&nbsp;cycles&nbsp;before&nbsp;calling&nbsp;Marshal&nbsp;which&nbsp;loops&nbsp;infinitely&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180555">//&nbsp;cyclic&nbsp;data.&nbsp;This&nbsp;may&nbsp;be&nbsp;an&nbsp;unacceptable&nbsp;DoS&nbsp;risk.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180611">b</span><span class="op" id="5180612">,</span>&nbsp;<span class="ident" id="5180614">err</span>&nbsp;<span class="op" id="5180618">:=</span>&nbsp;<span class="ident" id="5180621">json</span><span class="op" id="5180625">.</span><span class="ident" id="5180626">Marshal</span><span class="op" id="5180633">(</span><span class="ident" id="5180634">a</span><span class="op" id="5180635">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180638">if</span>&nbsp;<span class="ident" id="5180641">err</span>&nbsp;<span class="op" id="5180645">!=</span>&nbsp;<span class="ident" id="5180648">nil</span>&nbsp;<span class="op" id="5180652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180656">//&nbsp;Put&nbsp;a&nbsp;space&nbsp;before&nbsp;comment&nbsp;so&nbsp;that&nbsp;if&nbsp;it&nbsp;is&nbsp;flush&nbsp;against</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180719">//&nbsp;a&nbsp;division&nbsp;operator&nbsp;it&nbsp;is&nbsp;not&nbsp;turned&nbsp;into&nbsp;a&nbsp;line&nbsp;comment:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180782">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x/{{y}}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180799">//&nbsp;turning&nbsp;into</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180817">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x//*&nbsp;error&nbsp;marshalling&nbsp;y:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180852">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;second&nbsp;line&nbsp;of&nbsp;error&nbsp;message&nbsp;*/null</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180902">return</span>&nbsp;<span class="ident" id="5180909">fmt</span><span class="op" id="5180912">.</span><span class="ident" id="5180913">Sprintf</span><span class="op" id="5180920">(</span><span class="string" id="5180921">&#34;&nbsp;/*&nbsp;%s&nbsp;*/null&nbsp;&#34;</span><span class="op" id="5180937">,</span>&nbsp;<span class="ident" id="5180939">strings</span><span class="op" id="5180946">.</span><span class="ident" id="5180947">Replace</span><span class="op" id="5180954">(</span><span class="ident" id="5180955">err</span><span class="op" id="5180958">.</span><span class="ident" id="5180959">Error</span><span class="op" id="5180964">(</span><span class="op" id="5180965">)</span><span class="op" id="5180966">,</span>&nbsp;<span class="string" id="5180968">&#34;*/&#34;</span><span class="op" id="5180972">,</span>&nbsp;<span class="string" id="5180974">&#34;*&nbsp;/&#34;</span><span class="op" id="5180979">,</span>&nbsp;<span class="op" id="5180981">-</span><span class="num" id="5180982">1</span><span class="op" id="5180983">)</span><span class="op" id="5180984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5180987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180991">//&nbsp;TODO:&nbsp;maybe&nbsp;post-process&nbsp;output&nbsp;to&nbsp;prevent&nbsp;it&nbsp;from&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5181057">//&nbsp;&#34;&lt;!--&#34;,&nbsp;&#34;--&gt;&#34;,&nbsp;&#34;&lt;![CDATA[&#34;,&nbsp;&#34;]]&gt;&#34;,&nbsp;or&nbsp;&#34;&lt;/script&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5181110">//&nbsp;in&nbsp;case&nbsp;custom&nbsp;marshallers&nbsp;produce&nbsp;output&nbsp;containing&nbsp;those.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5181175">//&nbsp;TODO:&nbsp;Maybe&nbsp;abbreviate&nbsp;\u00ab&nbsp;to&nbsp;\xab&nbsp;to&nbsp;produce&nbsp;more&nbsp;compact&nbsp;output.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5181249">if</span>&nbsp;<span class="builtinfunc" id="5181252">len</span><span class="op" id="5181255">(</span><span class="ident" id="5181256">b</span><span class="op" id="5181257">)</span>&nbsp;<span class="op" id="5181259">==</span>&nbsp;<span class="num" id="5181262">0</span>&nbsp;<span class="op" id="5181264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5181268">//&nbsp;In,&nbsp;`x=y/{{.}}*z`&nbsp;a&nbsp;json.Marshaler&nbsp;that&nbsp;produces&nbsp;&#34;&#34;&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5181332">//&nbsp;not&nbsp;cause&nbsp;the&nbsp;output&nbsp;`x=y/*z`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5181368">return</span>&nbsp;<span class="string" id="5181375">&#34;&nbsp;null&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5181385">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181388">first</span><span class="op" id="5181393">,</span>&nbsp;<span class="ident" id="5181395">_</span>&nbsp;<span class="op" id="5181397">:=</span>&nbsp;<span class="ident" id="5181400">utf8</span><span class="op" id="5181404">.</span><span class="ident" id="5181405">DecodeRune</span><span class="op" id="5181415">(</span><span class="ident" id="5181416">b</span><span class="op" id="5181417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181420">last</span><span class="op" id="5181424">,</span>&nbsp;<span class="ident" id="5181426">_</span>&nbsp;<span class="op" id="5181428">:=</span>&nbsp;<span class="ident" id="5181431">utf8</span><span class="op" id="5181435">.</span><span class="ident" id="5181436">DecodeLastRune</span><span class="op" id="5181450">(</span><span class="ident" id="5181451">b</span><span class="op" id="5181452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5181455">var</span>&nbsp;<span class="ident" id="5181459">buf</span>&nbsp;<span class="ident" id="5181463">bytes</span><span class="op" id="5181468">.</span><span class="ident" id="5181469">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5181477">//&nbsp;Prevent&nbsp;IdentifierNames&nbsp;and&nbsp;NumericLiterals&nbsp;from&nbsp;running&nbsp;into</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5181543">//&nbsp;keywords:&nbsp;in,&nbsp;instanceof,&nbsp;typeof,&nbsp;void</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181586">pad</span>&nbsp;<span class="op" id="5181590">:=</span>&nbsp;<span class="ident" id="5181593">isJSIdentPart</span><span class="op" id="5181606">(</span><span class="ident" id="5181607">first</span><span class="op" id="5181612">)</span>&nbsp;<span class="op" id="5181614">||</span>&nbsp;<span class="ident" id="5181617">isJSIdentPart</span><span class="op" id="5181630">(</span><span class="ident" id="5181631">last</span><span class="op" id="5181635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5181638">if</span>&nbsp;<span class="ident" id="5181641">pad</span>&nbsp;<span class="op" id="5181645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181649">buf</span><span class="op" id="5181652">.</span><span class="ident" id="5181653">WriteByte</span><span class="op" id="5181662">(</span><span class="string" id="5181663">&#39;&nbsp;&#39;</span><span class="op" id="5181666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5181669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181672">written</span>&nbsp;<span class="op" id="5181680">:=</span>&nbsp;<span class="num" id="5181683">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5181686">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;json.Marshal&nbsp;escapes&nbsp;codepoints&nbsp;U+2028&nbsp;&amp;&nbsp;U+2029</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5181753">//&nbsp;so&nbsp;it&nbsp;falls&nbsp;within&nbsp;the&nbsp;subset&nbsp;of&nbsp;JSON&nbsp;which&nbsp;is&nbsp;valid&nbsp;JS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5181814">for</span>&nbsp;<span class="ident" id="5181818">i</span>&nbsp;<span class="op" id="5181820">:=</span>&nbsp;<span class="num" id="5181823">0</span><span class="op" id="5181824">;</span>&nbsp;<span class="ident" id="5181826">i</span>&nbsp;<span class="op" id="5181828">&lt;</span>&nbsp;<span class="builtinfunc" id="5181830">len</span><span class="op" id="5181833">(</span><span class="ident" id="5181834">b</span><span class="op" id="5181835">)</span><span class="op" id="5181836">;</span>&nbsp;<span class="op" id="5181838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5181842">rune</span><span class="op" id="5181846">,</span>&nbsp;<span class="ident" id="5181848">n</span>&nbsp;<span class="op" id="5181850">:=</span>&nbsp;<span class="ident" id="5181853">utf8</span><span class="op" id="5181857">.</span><span class="ident" id="5181858">DecodeRune</span><span class="op" id="5181868">(</span><span class="ident" id="5181869">b</span><span class="op" id="5181870">[</span><span class="ident" id="5181871">i</span><span class="op" id="5181872">:</span><span class="op" id="5181873">]</span><span class="op" id="5181874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181878">repl</span>&nbsp;<span class="op" id="5181883">:=</span>&nbsp;<span class="string" id="5181886">&#34;&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5181891">if</span>&nbsp;<span class="builtintype" id="5181894">rune</span>&nbsp;<span class="op" id="5181899">==</span>&nbsp;<span class="num" id="5181902">0x2028</span>&nbsp;<span class="op" id="5181909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181914">repl</span>&nbsp;<span class="op" id="5181919">=</span>&nbsp;<span class="string" id="5181921">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5181932">}</span>&nbsp;<span class="keyword" id="5181934">else</span>&nbsp;<span class="keyword" id="5181939">if</span>&nbsp;<span class="builtintype" id="5181942">rune</span>&nbsp;<span class="op" id="5181947">==</span>&nbsp;<span class="num" id="5181950">0x2029</span>&nbsp;<span class="op" id="5181957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181962">repl</span>&nbsp;<span class="op" id="5181967">=</span>&nbsp;<span class="string" id="5181969">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5181980">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5181984">if</span>&nbsp;<span class="ident" id="5181987">repl</span>&nbsp;<span class="op" id="5181992">!=</span>&nbsp;<span class="string" id="5181995">&#34;&#34;</span>&nbsp;<span class="op" id="5181998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182003">buf</span><span class="op" id="5182006">.</span><span class="ident" id="5182007">Write</span><span class="op" id="5182012">(</span><span class="ident" id="5182013">b</span><span class="op" id="5182014">[</span><span class="ident" id="5182015">written</span><span class="op" id="5182022">:</span><span class="ident" id="5182023">i</span><span class="op" id="5182024">]</span><span class="op" id="5182025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182030">buf</span><span class="op" id="5182033">.</span><span class="ident" id="5182034">WriteString</span><span class="op" id="5182045">(</span><span class="ident" id="5182046">repl</span><span class="op" id="5182050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182055">written</span>&nbsp;<span class="op" id="5182063">=</span>&nbsp;<span class="ident" id="5182065">i</span>&nbsp;<span class="op" id="5182067">+</span>&nbsp;<span class="ident" id="5182069">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5182073">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182077">i</span>&nbsp;<span class="op" id="5182079">+=</span>&nbsp;<span class="ident" id="5182082">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5182085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5182088">if</span>&nbsp;<span class="ident" id="5182091">buf</span><span class="op" id="5182094">.</span><span class="ident" id="5182095">Len</span><span class="op" id="5182098">(</span><span class="op" id="5182099">)</span>&nbsp;<span class="op" id="5182101">!=</span>&nbsp;<span class="num" id="5182104">0</span>&nbsp;<span class="op" id="5182106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182110">buf</span><span class="op" id="5182113">.</span><span class="ident" id="5182114">Write</span><span class="op" id="5182119">(</span><span class="ident" id="5182120">b</span><span class="op" id="5182121">[</span><span class="ident" id="5182122">written</span><span class="op" id="5182129">:</span><span class="op" id="5182130">]</span><span class="op" id="5182131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5182135">if</span>&nbsp;<span class="ident" id="5182138">pad</span>&nbsp;<span class="op" id="5182142">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182147">buf</span><span class="op" id="5182150">.</span><span class="ident" id="5182151">WriteByte</span><span class="op" id="5182160">(</span><span class="string" id="5182161">&#39;&nbsp;&#39;</span><span class="op" id="5182164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5182168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182172">b</span>&nbsp;<span class="op" id="5182174">=</span>&nbsp;<span class="ident" id="5182176">buf</span><span class="op" id="5182179">.</span><span class="ident" id="5182180">Bytes</span><span class="op" id="5182185">(</span><span class="op" id="5182186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5182189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5182192">return</span>&nbsp;<span class="builtintype" id="5182199">string</span><span class="op" id="5182205">(</span><span class="ident" id="5182206">b</span><span class="op" id="5182207">)</span><br>
<span class="lineno">215</span><span class="op" id="5182209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5182212">//&nbsp;jsStrEscaper&nbsp;produces&nbsp;a&nbsp;string&nbsp;that&nbsp;can&nbsp;be&nbsp;included&nbsp;between&nbsp;quotes&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5182285">//&nbsp;JavaScript&nbsp;source,&nbsp;in&nbsp;JavaScript&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;&lt;script&gt;&nbsp;element,</span><br>
<span class="lineno"></span><span class="comment" id="5182360">//&nbsp;or&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;event&nbsp;handler&nbsp;attribute&nbsp;such&nbsp;as&nbsp;onclick.</span><br>
<span class="lineno">220</span><span class="keyword" id="5182419">func</span>&nbsp;<span class="ident" id="5182424">jsStrEscaper</span><span class="op" id="5182436">(</span><span class="ident" id="5182437">args</span>&nbsp;<span class="op" id="5182442">...</span><span class="keyword" id="5182445">interface</span><span class="op" id="5182454">{</span><span class="op" id="5182455">}</span><span class="op" id="5182456">)</span>&nbsp;<span class="builtintype" id="5182458">string</span>&nbsp;<span class="op" id="5182465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182468">s</span><span class="op" id="5182469">,</span>&nbsp;<span class="ident" id="5182471">t</span>&nbsp;<span class="op" id="5182473">:=</span>&nbsp;<span class="ident" id="5182476">stringify</span><span class="op" id="5182485">(</span><span class="ident" id="5182486">args</span><span class="op" id="5182490">...</span><span class="op" id="5182493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5182496">if</span>&nbsp;<span class="ident" id="5182499">t</span>&nbsp;<span class="op" id="5182501">==</span>&nbsp;<span class="ident" id="5182504">contentTypeJSStr</span>&nbsp;<span class="op" id="5182521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5182525">return</span>&nbsp;<span class="ident" id="5182532">replace</span><span class="op" id="5182539">(</span><span class="ident" id="5182540">s</span><span class="op" id="5182541">,</span>&nbsp;<span class="ident" id="5182543">jsStrNormReplacementTable</span><span class="op" id="5182568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5182571">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5182574">return</span>&nbsp;<span class="ident" id="5182581">replace</span><span class="op" id="5182588">(</span><span class="ident" id="5182589">s</span><span class="op" id="5182590">,</span>&nbsp;<span class="ident" id="5182592">jsStrReplacementTable</span><span class="op" id="5182613">)</span><br>
<span class="lineno"></span><span class="op" id="5182615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5182618">//&nbsp;jsRegexpEscaper&nbsp;behaves&nbsp;like&nbsp;jsStrEscaper&nbsp;but&nbsp;escapes&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5182694">//&nbsp;specials&nbsp;so&nbsp;the&nbsp;result&nbsp;is&nbsp;treated&nbsp;literally&nbsp;when&nbsp;included&nbsp;in&nbsp;a&nbsp;regular</span><br>
<span class="lineno">230</span><span class="comment" id="5182768">//&nbsp;expression&nbsp;literal.&nbsp;/foo{{.X}}bar/&nbsp;matches&nbsp;the&nbsp;string&nbsp;&#34;foo&#34;&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5182843">//&nbsp;the&nbsp;literal&nbsp;text&nbsp;of&nbsp;{{.X}}&nbsp;followed&nbsp;by&nbsp;the&nbsp;string&nbsp;&#34;bar&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5182903">func</span>&nbsp;<span class="ident" id="5182908">jsRegexpEscaper</span><span class="op" id="5182923">(</span><span class="ident" id="5182924">args</span>&nbsp;<span class="op" id="5182929">...</span><span class="keyword" id="5182932">interface</span><span class="op" id="5182941">{</span><span class="op" id="5182942">}</span><span class="op" id="5182943">)</span>&nbsp;<span class="builtintype" id="5182945">string</span>&nbsp;<span class="op" id="5182952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182955">s</span><span class="op" id="5182956">,</span>&nbsp;<span class="ident" id="5182958">_</span>&nbsp;<span class="op" id="5182960">:=</span>&nbsp;<span class="ident" id="5182963">stringify</span><span class="op" id="5182972">(</span><span class="ident" id="5182973">args</span><span class="op" id="5182977">...</span><span class="op" id="5182980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182983">s</span>&nbsp;<span class="op" id="5182985">=</span>&nbsp;<span class="ident" id="5182987">replace</span><span class="op" id="5182994">(</span><span class="ident" id="5182995">s</span><span class="op" id="5182996">,</span>&nbsp;<span class="ident" id="5182998">jsRegexpReplacementTable</span><span class="op" id="5183022">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183025">if</span>&nbsp;<span class="ident" id="5183028">s</span>&nbsp;<span class="op" id="5183030">==</span>&nbsp;<span class="string" id="5183033">&#34;&#34;</span>&nbsp;<span class="op" id="5183036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183040">//&nbsp;/{{.X}}/&nbsp;should&nbsp;not&nbsp;produce&nbsp;a&nbsp;line&nbsp;comment&nbsp;when&nbsp;.X&nbsp;==&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183103">return</span>&nbsp;<span class="string" id="5183110">&#34;(?:)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5183118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183121">return</span>&nbsp;<span class="ident" id="5183128">s</span><br>
<span class="lineno">240</span><span class="op" id="5183130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5183133">//&nbsp;replace&nbsp;replaces&nbsp;each&nbsp;rune&nbsp;r&nbsp;of&nbsp;s&nbsp;with&nbsp;replacementTable[r],&nbsp;provided&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5183210">//&nbsp;r&nbsp;&lt;&nbsp;len(replacementTable).&nbsp;If&nbsp;replacementTable[r]&nbsp;is&nbsp;the&nbsp;empty&nbsp;string&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5183288">//&nbsp;no&nbsp;replacement&nbsp;is&nbsp;made.</span><br>
<span class="lineno">245</span><span class="comment" id="5183315">//&nbsp;It&nbsp;also&nbsp;replaces&nbsp;runes&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;with&nbsp;the&nbsp;raw&nbsp;strings&nbsp;`\u2028`&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5183393">//&nbsp;`\u2029`.</span><br>
<span class="lineno"></span><span class="keyword" id="5183406">func</span>&nbsp;<span class="ident" id="5183411">replace</span><span class="op" id="5183418">(</span><span class="ident" id="5183419">s</span>&nbsp;<span class="builtintype" id="5183421">string</span><span class="op" id="5183427">,</span>&nbsp;<span class="ident" id="5183429">replacementTable</span>&nbsp;<span class="op" id="5183446">[</span><span class="op" id="5183447">]</span><span class="builtintype" id="5183448">string</span><span class="op" id="5183454">)</span>&nbsp;<span class="builtintype" id="5183456">string</span>&nbsp;<span class="op" id="5183463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183466">var</span>&nbsp;<span class="ident" id="5183470">b</span>&nbsp;<span class="ident" id="5183472">bytes</span><span class="op" id="5183477">.</span><span class="ident" id="5183478">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183486">written</span>&nbsp;<span class="op" id="5183494">:=</span>&nbsp;<span class="num" id="5183497">0</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183500">for</span>&nbsp;<span class="ident" id="5183504">i</span><span class="op" id="5183505">,</span>&nbsp;<span class="ident" id="5183507">r</span>&nbsp;<span class="op" id="5183509">:=</span>&nbsp;<span class="keyword" id="5183512">range</span>&nbsp;<span class="ident" id="5183518">s</span>&nbsp;<span class="op" id="5183520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183524">var</span>&nbsp;<span class="ident" id="5183528">repl</span>&nbsp;<span class="builtintype" id="5183533">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183542">switch</span>&nbsp;<span class="op" id="5183549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183553">case</span>&nbsp;<span class="builtintype" id="5183558">int</span><span class="op" id="5183561">(</span><span class="ident" id="5183562">r</span><span class="op" id="5183563">)</span>&nbsp;<span class="op" id="5183565">&lt;</span>&nbsp;<span class="builtinfunc" id="5183567">len</span><span class="op" id="5183570">(</span><span class="ident" id="5183571">replacementTable</span><span class="op" id="5183587">)</span>&nbsp;<span class="op" id="5183589">&amp;&amp;</span>&nbsp;<span class="ident" id="5183592">replacementTable</span><span class="op" id="5183608">[</span><span class="ident" id="5183609">r</span><span class="op" id="5183610">]</span>&nbsp;<span class="op" id="5183612">!=</span>&nbsp;<span class="string" id="5183615">&#34;&#34;</span><span class="op" id="5183617">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183622">repl</span>&nbsp;<span class="op" id="5183627">=</span>&nbsp;<span class="ident" id="5183629">replacementTable</span><span class="op" id="5183645">[</span><span class="ident" id="5183646">r</span><span class="op" id="5183647">]</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183651">case</span>&nbsp;<span class="ident" id="5183656">r</span>&nbsp;<span class="op" id="5183658">==</span>&nbsp;<span class="string" id="5183661">&#39;\u2028&#39;</span><span class="op" id="5183669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183674">repl</span>&nbsp;<span class="op" id="5183679">=</span>&nbsp;<span class="string" id="5183681">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183692">case</span>&nbsp;<span class="ident" id="5183697">r</span>&nbsp;<span class="op" id="5183699">==</span>&nbsp;<span class="string" id="5183702">&#39;\u2029&#39;</span><span class="op" id="5183710">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183715">repl</span>&nbsp;<span class="op" id="5183720">=</span>&nbsp;<span class="string" id="5183722">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183733">default</span><span class="op" id="5183740">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183745">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5183756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183760">b</span><span class="op" id="5183761">.</span><span class="ident" id="5183762">WriteString</span><span class="op" id="5183773">(</span><span class="ident" id="5183774">s</span><span class="op" id="5183775">[</span><span class="ident" id="5183776">written</span><span class="op" id="5183783">:</span><span class="ident" id="5183784">i</span><span class="op" id="5183785">]</span><span class="op" id="5183786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183790">b</span><span class="op" id="5183791">.</span><span class="ident" id="5183792">WriteString</span><span class="op" id="5183803">(</span><span class="ident" id="5183804">repl</span><span class="op" id="5183808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183812">written</span>&nbsp;<span class="op" id="5183820">=</span>&nbsp;<span class="ident" id="5183822">i</span>&nbsp;<span class="op" id="5183824">+</span>&nbsp;<span class="ident" id="5183826">utf8</span><span class="op" id="5183830">.</span><span class="ident" id="5183831">RuneLen</span><span class="op" id="5183838">(</span><span class="ident" id="5183839">r</span><span class="op" id="5183840">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5183843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183846">if</span>&nbsp;<span class="ident" id="5183849">written</span>&nbsp;<span class="op" id="5183857">==</span>&nbsp;<span class="num" id="5183860">0</span>&nbsp;<span class="op" id="5183862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183866">return</span>&nbsp;<span class="ident" id="5183873">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5183876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183879">b</span><span class="op" id="5183880">.</span><span class="ident" id="5183881">WriteString</span><span class="op" id="5183892">(</span><span class="ident" id="5183893">s</span><span class="op" id="5183894">[</span><span class="ident" id="5183895">written</span><span class="op" id="5183902">:</span><span class="op" id="5183903">]</span><span class="op" id="5183904">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183907">return</span>&nbsp;<span class="ident" id="5183914">b</span><span class="op" id="5183915">.</span><span class="ident" id="5183916">String</span><span class="op" id="5183922">(</span><span class="op" id="5183923">)</span><br>
<span class="lineno"></span><span class="op" id="5183925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5183928">var</span>&nbsp;<span class="ident" id="5183932">jsStrReplacementTable</span>&nbsp;<span class="op" id="5183954">=</span>&nbsp;<span class="op" id="5183956">[</span><span class="op" id="5183957">]</span><span class="builtintype" id="5183958">string</span><span class="op" id="5183964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5183967">0</span><span class="op" id="5183968">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5183973">`\0`</span><span class="op" id="5183977">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5183980">&#39;\t&#39;</span><span class="op" id="5183984">:</span>&nbsp;<span class="string" id="5183986">`\t`</span><span class="op" id="5183990">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5183993">&#39;\n&#39;</span><span class="op" id="5183997">:</span>&nbsp;<span class="string" id="5183999">`\n`</span><span class="op" id="5184003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184006">&#39;\v&#39;</span><span class="op" id="5184010">:</span>&nbsp;<span class="string" id="5184012">`\x0b`</span><span class="op" id="5184018">,</span>&nbsp;<span class="comment" id="5184020">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184045">&#39;\f&#39;</span><span class="op" id="5184049">:</span>&nbsp;<span class="string" id="5184051">`\f`</span><span class="op" id="5184055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184058">&#39;\r&#39;</span><span class="op" id="5184062">:</span>&nbsp;<span class="string" id="5184064">`\r`</span><span class="op" id="5184068">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5184071">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5184133">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184182">&#39;&#34;&#39;</span><span class="op" id="5184185">:</span>&nbsp;&nbsp;<span class="string" id="5184188">`\x22`</span><span class="op" id="5184194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184197">&#39;&amp;&#39;</span><span class="op" id="5184200">:</span>&nbsp;&nbsp;<span class="string" id="5184203">`\x26`</span><span class="op" id="5184209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184212">&#39;\&#39;&#39;</span><span class="op" id="5184216">:</span>&nbsp;<span class="string" id="5184218">`\x27`</span><span class="op" id="5184224">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184227">&#39;+&#39;</span><span class="op" id="5184230">:</span>&nbsp;&nbsp;<span class="string" id="5184233">`\x2b`</span><span class="op" id="5184239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184242">&#39;/&#39;</span><span class="op" id="5184245">:</span>&nbsp;&nbsp;<span class="string" id="5184248">`\/`</span><span class="op" id="5184252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184255">&#39;&lt;&#39;</span><span class="op" id="5184258">:</span>&nbsp;&nbsp;<span class="string" id="5184261">`\x3c`</span><span class="op" id="5184267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184270">&#39;&gt;&#39;</span><span class="op" id="5184273">:</span>&nbsp;&nbsp;<span class="string" id="5184276">`\x3e`</span><span class="op" id="5184282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184285">&#39;\\&#39;</span><span class="op" id="5184289">:</span>&nbsp;<span class="string" id="5184291">`\\`</span><span class="op" id="5184295">,</span><br>
<span class="lineno">290</span><span class="op" id="5184297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5184300">//&nbsp;jsStrNormReplacementTable&nbsp;is&nbsp;like&nbsp;jsStrReplacementTable&nbsp;but&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5184372">//&nbsp;overencode&nbsp;existing&nbsp;escapes&nbsp;since&nbsp;this&nbsp;table&nbsp;has&nbsp;no&nbsp;entry&nbsp;for&nbsp;`\`.</span><br>
<span class="lineno"></span><span class="keyword" id="5184442">var</span>&nbsp;<span class="ident" id="5184446">jsStrNormReplacementTable</span>&nbsp;<span class="op" id="5184472">=</span>&nbsp;<span class="op" id="5184474">[</span><span class="op" id="5184475">]</span><span class="builtintype" id="5184476">string</span><span class="op" id="5184482">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5184485">0</span><span class="op" id="5184486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5184491">`\0`</span><span class="op" id="5184495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184498">&#39;\t&#39;</span><span class="op" id="5184502">:</span>&nbsp;<span class="string" id="5184504">`\t`</span><span class="op" id="5184508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184511">&#39;\n&#39;</span><span class="op" id="5184515">:</span>&nbsp;<span class="string" id="5184517">`\n`</span><span class="op" id="5184521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184524">&#39;\v&#39;</span><span class="op" id="5184528">:</span>&nbsp;<span class="string" id="5184530">`\x0b`</span><span class="op" id="5184536">,</span>&nbsp;<span class="comment" id="5184538">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184563">&#39;\f&#39;</span><span class="op" id="5184567">:</span>&nbsp;<span class="string" id="5184569">`\f`</span><span class="op" id="5184573">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184576">&#39;\r&#39;</span><span class="op" id="5184580">:</span>&nbsp;<span class="string" id="5184582">`\r`</span><span class="op" id="5184586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5184589">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5184651">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184700">&#39;&#34;&#39;</span><span class="op" id="5184703">:</span>&nbsp;&nbsp;<span class="string" id="5184706">`\x22`</span><span class="op" id="5184712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184715">&#39;&amp;&#39;</span><span class="op" id="5184718">:</span>&nbsp;&nbsp;<span class="string" id="5184721">`\x26`</span><span class="op" id="5184727">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184730">&#39;\&#39;&#39;</span><span class="op" id="5184734">:</span>&nbsp;<span class="string" id="5184736">`\x27`</span><span class="op" id="5184742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184745">&#39;+&#39;</span><span class="op" id="5184748">:</span>&nbsp;&nbsp;<span class="string" id="5184751">`\x2b`</span><span class="op" id="5184757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184760">&#39;/&#39;</span><span class="op" id="5184763">:</span>&nbsp;&nbsp;<span class="string" id="5184766">`\/`</span><span class="op" id="5184770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184773">&#39;&lt;&#39;</span><span class="op" id="5184776">:</span>&nbsp;&nbsp;<span class="string" id="5184779">`\x3c`</span><span class="op" id="5184785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184788">&#39;&gt;&#39;</span><span class="op" id="5184791">:</span>&nbsp;&nbsp;<span class="string" id="5184794">`\x3e`</span><span class="op" id="5184800">,</span><br>
<span class="lineno">310</span><span class="op" id="5184802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5184805">var</span>&nbsp;<span class="ident" id="5184809">jsRegexpReplacementTable</span>&nbsp;<span class="op" id="5184834">=</span>&nbsp;<span class="op" id="5184836">[</span><span class="op" id="5184837">]</span><span class="builtintype" id="5184838">string</span><span class="op" id="5184844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5184847">0</span><span class="op" id="5184848">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5184853">`\0`</span><span class="op" id="5184857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184860">&#39;\t&#39;</span><span class="op" id="5184864">:</span>&nbsp;<span class="string" id="5184866">`\t`</span><span class="op" id="5184870">,</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184873">&#39;\n&#39;</span><span class="op" id="5184877">:</span>&nbsp;<span class="string" id="5184879">`\n`</span><span class="op" id="5184883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184886">&#39;\v&#39;</span><span class="op" id="5184890">:</span>&nbsp;<span class="string" id="5184892">`\x0b`</span><span class="op" id="5184898">,</span>&nbsp;<span class="comment" id="5184900">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184925">&#39;\f&#39;</span><span class="op" id="5184929">:</span>&nbsp;<span class="string" id="5184931">`\f`</span><span class="op" id="5184935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5184938">&#39;\r&#39;</span><span class="op" id="5184942">:</span>&nbsp;<span class="string" id="5184944">`\r`</span><span class="op" id="5184948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5184951">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185013">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185062">&#39;&#34;&#39;</span><span class="op" id="5185065">:</span>&nbsp;&nbsp;<span class="string" id="5185068">`\x22`</span><span class="op" id="5185074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185077">&#39;$&#39;</span><span class="op" id="5185080">:</span>&nbsp;&nbsp;<span class="string" id="5185083">`\$`</span><span class="op" id="5185087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185090">&#39;&amp;&#39;</span><span class="op" id="5185093">:</span>&nbsp;&nbsp;<span class="string" id="5185096">`\x26`</span><span class="op" id="5185102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185105">&#39;\&#39;&#39;</span><span class="op" id="5185109">:</span>&nbsp;<span class="string" id="5185111">`\x27`</span><span class="op" id="5185117">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185120">&#39;(&#39;</span><span class="op" id="5185123">:</span>&nbsp;&nbsp;<span class="string" id="5185126">`\(`</span><span class="op" id="5185130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185133">&#39;)&#39;</span><span class="op" id="5185136">:</span>&nbsp;&nbsp;<span class="string" id="5185139">`\)`</span><span class="op" id="5185143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185146">&#39;*&#39;</span><span class="op" id="5185149">:</span>&nbsp;&nbsp;<span class="string" id="5185152">`\*`</span><span class="op" id="5185156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185159">&#39;+&#39;</span><span class="op" id="5185162">:</span>&nbsp;&nbsp;<span class="string" id="5185165">`\x2b`</span><span class="op" id="5185171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185174">&#39;-&#39;</span><span class="op" id="5185177">:</span>&nbsp;&nbsp;<span class="string" id="5185180">`\-`</span><span class="op" id="5185184">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185187">&#39;.&#39;</span><span class="op" id="5185190">:</span>&nbsp;&nbsp;<span class="string" id="5185193">`\.`</span><span class="op" id="5185197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185200">&#39;/&#39;</span><span class="op" id="5185203">:</span>&nbsp;&nbsp;<span class="string" id="5185206">`\/`</span><span class="op" id="5185210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185213">&#39;&lt;&#39;</span><span class="op" id="5185216">:</span>&nbsp;&nbsp;<span class="string" id="5185219">`\x3c`</span><span class="op" id="5185225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185228">&#39;&gt;&#39;</span><span class="op" id="5185231">:</span>&nbsp;&nbsp;<span class="string" id="5185234">`\x3e`</span><span class="op" id="5185240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185243">&#39;?&#39;</span><span class="op" id="5185246">:</span>&nbsp;&nbsp;<span class="string" id="5185249">`\?`</span><span class="op" id="5185253">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185256">&#39;[&#39;</span><span class="op" id="5185259">:</span>&nbsp;&nbsp;<span class="string" id="5185262">`\[`</span><span class="op" id="5185266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185269">&#39;\\&#39;</span><span class="op" id="5185273">:</span>&nbsp;<span class="string" id="5185275">`\\`</span><span class="op" id="5185279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185282">&#39;]&#39;</span><span class="op" id="5185285">:</span>&nbsp;&nbsp;<span class="string" id="5185288">`\]`</span><span class="op" id="5185292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185295">&#39;^&#39;</span><span class="op" id="5185298">:</span>&nbsp;&nbsp;<span class="string" id="5185301">`\^`</span><span class="op" id="5185305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185308">&#39;{&#39;</span><span class="op" id="5185311">:</span>&nbsp;&nbsp;<span class="string" id="5185314">`\{`</span><span class="op" id="5185318">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185321">&#39;|&#39;</span><span class="op" id="5185324">:</span>&nbsp;&nbsp;<span class="string" id="5185327">`\|`</span><span class="op" id="5185331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5185334">&#39;}&#39;</span><span class="op" id="5185337">:</span>&nbsp;&nbsp;<span class="string" id="5185340">`\}`</span><span class="op" id="5185344">,</span><br>
<span class="lineno"></span><span class="op" id="5185346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5185349">//&nbsp;isJSIdentPart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;given&nbsp;rune&nbsp;is&nbsp;a&nbsp;JS&nbsp;identifier&nbsp;part.</span><br>
<span class="lineno">345</span><span class="comment" id="5185422">//&nbsp;It&nbsp;does&nbsp;not&nbsp;handle&nbsp;all&nbsp;the&nbsp;non-Latin&nbsp;letters,&nbsp;joiners,&nbsp;and&nbsp;combining&nbsp;marks,</span><br>
<span class="lineno"></span><span class="comment" id="5185501">//&nbsp;but&nbsp;it&nbsp;does&nbsp;handle&nbsp;every&nbsp;codepoint&nbsp;that&nbsp;can&nbsp;occur&nbsp;in&nbsp;a&nbsp;numeric&nbsp;literal&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5185578">//&nbsp;a&nbsp;keyword.</span><br>
<span class="lineno"></span><span class="keyword" id="5185592">func</span>&nbsp;<span class="ident" id="5185597">isJSIdentPart</span><span class="op" id="5185610">(</span><span class="ident" id="5185611">r</span>&nbsp;<span class="builtintype" id="5185613">rune</span><span class="op" id="5185617">)</span>&nbsp;<span class="builtintype" id="5185619">bool</span>&nbsp;<span class="op" id="5185624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185627">switch</span>&nbsp;<span class="op" id="5185634">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185637">case</span>&nbsp;<span class="ident" id="5185642">r</span>&nbsp;<span class="op" id="5185644">==</span>&nbsp;<span class="string" id="5185647">&#39;$&#39;</span><span class="op" id="5185650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185654">return</span>&nbsp;<span class="builtintype" id="5185661">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185667">case</span>&nbsp;<span class="string" id="5185672">&#39;0&#39;</span>&nbsp;<span class="op" id="5185676">&lt;=</span>&nbsp;<span class="ident" id="5185679">r</span>&nbsp;<span class="op" id="5185681">&amp;&amp;</span>&nbsp;<span class="ident" id="5185684">r</span>&nbsp;<span class="op" id="5185686">&lt;=</span>&nbsp;<span class="string" id="5185689">&#39;9&#39;</span><span class="op" id="5185692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185696">return</span>&nbsp;<span class="builtintype" id="5185703">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185709">case</span>&nbsp;<span class="string" id="5185714">&#39;A&#39;</span>&nbsp;<span class="op" id="5185718">&lt;=</span>&nbsp;<span class="ident" id="5185721">r</span>&nbsp;<span class="op" id="5185723">&amp;&amp;</span>&nbsp;<span class="ident" id="5185726">r</span>&nbsp;<span class="op" id="5185728">&lt;=</span>&nbsp;<span class="string" id="5185731">&#39;Z&#39;</span><span class="op" id="5185734">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185738">return</span>&nbsp;<span class="builtintype" id="5185745">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185751">case</span>&nbsp;<span class="ident" id="5185756">r</span>&nbsp;<span class="op" id="5185758">==</span>&nbsp;<span class="string" id="5185761">&#39;_&#39;</span><span class="op" id="5185764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185768">return</span>&nbsp;<span class="builtintype" id="5185775">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185781">case</span>&nbsp;<span class="string" id="5185786">&#39;a&#39;</span>&nbsp;<span class="op" id="5185790">&lt;=</span>&nbsp;<span class="ident" id="5185793">r</span>&nbsp;<span class="op" id="5185795">&amp;&amp;</span>&nbsp;<span class="ident" id="5185798">r</span>&nbsp;<span class="op" id="5185800">&lt;=</span>&nbsp;<span class="string" id="5185803">&#39;z&#39;</span><span class="op" id="5185806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185810">return</span>&nbsp;<span class="builtintype" id="5185817">true</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5185823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185826">return</span>&nbsp;<span class="builtintype" id="5185833">false</span><br>
<span class="lineno"></span><span class="op" id="5185839">}</span>
</div>
</body>
</html>
