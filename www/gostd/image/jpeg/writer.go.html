<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1763163">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1763218">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1763272">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1763323">package</span>&nbsp;<span class="ident" id="1763331">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1763337">import</span>&nbsp;<span class="op" id="1763344">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1763347">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1763356">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1763366">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1763375">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1763390">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="1763395">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1763398">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="1763442">func</span>&nbsp;<span class="ident" id="1763447">min</span><span class="op" id="1763450">(</span><span class="ident" id="1763451">x</span><span class="op" id="1763452">,</span>&nbsp;<span class="ident" id="1763454">y</span>&nbsp;<span class="builtintype" id="1763456">int</span><span class="op" id="1763459">)</span>&nbsp;<span class="builtintype" id="1763461">int</span>&nbsp;<span class="op" id="1763465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763468">if</span>&nbsp;<span class="ident" id="1763471">x</span>&nbsp;<span class="op" id="1763473">&lt;</span>&nbsp;<span class="ident" id="1763475">y</span>&nbsp;<span class="op" id="1763477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763481">return</span>&nbsp;<span class="ident" id="1763488">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1763491">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763494">return</span>&nbsp;<span class="ident" id="1763501">y</span><br>
<span class="lineno"></span><span class="op" id="1763503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1763506">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="1763585">func</span>&nbsp;<span class="ident" id="1763590">div</span><span class="op" id="1763593">(</span><span class="ident" id="1763594">a</span><span class="op" id="1763595">,</span>&nbsp;<span class="ident" id="1763597">b</span>&nbsp;<span class="builtintype" id="1763599">int32</span><span class="op" id="1763604">)</span>&nbsp;<span class="builtintype" id="1763606">int32</span>&nbsp;<span class="op" id="1763612">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763615">if</span>&nbsp;<span class="ident" id="1763618">a</span>&nbsp;<span class="op" id="1763620">&gt;=</span>&nbsp;<span class="num" id="1763623">0</span>&nbsp;<span class="op" id="1763625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763629">return</span>&nbsp;<span class="op" id="1763636">(</span><span class="ident" id="1763637">a</span>&nbsp;<span class="op" id="1763639">+</span>&nbsp;<span class="op" id="1763641">(</span><span class="ident" id="1763642">b</span>&nbsp;<span class="op" id="1763644">&gt;&gt;</span>&nbsp;<span class="num" id="1763647">1</span><span class="op" id="1763648">)</span><span class="op" id="1763649">)</span>&nbsp;<span class="op" id="1763651">/</span>&nbsp;<span class="ident" id="1763653">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1763656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763659">return</span>&nbsp;<span class="op" id="1763666">-</span><span class="op" id="1763667">(</span><span class="op" id="1763668">(</span><span class="op" id="1763669">-</span><span class="ident" id="1763670">a</span>&nbsp;<span class="op" id="1763672">+</span>&nbsp;<span class="op" id="1763674">(</span><span class="ident" id="1763675">b</span>&nbsp;<span class="op" id="1763677">&gt;&gt;</span>&nbsp;<span class="num" id="1763680">1</span><span class="op" id="1763681">)</span><span class="op" id="1763682">)</span>&nbsp;<span class="op" id="1763684">/</span>&nbsp;<span class="ident" id="1763686">b</span><span class="op" id="1763687">)</span><br>
<span class="lineno"></span><span class="op" id="1763689">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="1763692">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="1763757">var</span>&nbsp;<span class="ident" id="1763761">bitCount</span>&nbsp;<span class="op" id="1763770">=</span>&nbsp;<span class="op" id="1763772">[</span><span class="num" id="1763773">256</span><span class="op" id="1763776">]</span><span class="builtintype" id="1763777">byte</span><span class="op" id="1763781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1763784">0</span><span class="op" id="1763785">,</span>&nbsp;<span class="num" id="1763787">1</span><span class="op" id="1763788">,</span>&nbsp;<span class="num" id="1763790">2</span><span class="op" id="1763791">,</span>&nbsp;<span class="num" id="1763793">2</span><span class="op" id="1763794">,</span>&nbsp;<span class="num" id="1763796">3</span><span class="op" id="1763797">,</span>&nbsp;<span class="num" id="1763799">3</span><span class="op" id="1763800">,</span>&nbsp;<span class="num" id="1763802">3</span><span class="op" id="1763803">,</span>&nbsp;<span class="num" id="1763805">3</span><span class="op" id="1763806">,</span>&nbsp;<span class="num" id="1763808">4</span><span class="op" id="1763809">,</span>&nbsp;<span class="num" id="1763811">4</span><span class="op" id="1763812">,</span>&nbsp;<span class="num" id="1763814">4</span><span class="op" id="1763815">,</span>&nbsp;<span class="num" id="1763817">4</span><span class="op" id="1763818">,</span>&nbsp;<span class="num" id="1763820">4</span><span class="op" id="1763821">,</span>&nbsp;<span class="num" id="1763823">4</span><span class="op" id="1763824">,</span>&nbsp;<span class="num" id="1763826">4</span><span class="op" id="1763827">,</span>&nbsp;<span class="num" id="1763829">4</span><span class="op" id="1763830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1763833">5</span><span class="op" id="1763834">,</span>&nbsp;<span class="num" id="1763836">5</span><span class="op" id="1763837">,</span>&nbsp;<span class="num" id="1763839">5</span><span class="op" id="1763840">,</span>&nbsp;<span class="num" id="1763842">5</span><span class="op" id="1763843">,</span>&nbsp;<span class="num" id="1763845">5</span><span class="op" id="1763846">,</span>&nbsp;<span class="num" id="1763848">5</span><span class="op" id="1763849">,</span>&nbsp;<span class="num" id="1763851">5</span><span class="op" id="1763852">,</span>&nbsp;<span class="num" id="1763854">5</span><span class="op" id="1763855">,</span>&nbsp;<span class="num" id="1763857">5</span><span class="op" id="1763858">,</span>&nbsp;<span class="num" id="1763860">5</span><span class="op" id="1763861">,</span>&nbsp;<span class="num" id="1763863">5</span><span class="op" id="1763864">,</span>&nbsp;<span class="num" id="1763866">5</span><span class="op" id="1763867">,</span>&nbsp;<span class="num" id="1763869">5</span><span class="op" id="1763870">,</span>&nbsp;<span class="num" id="1763872">5</span><span class="op" id="1763873">,</span>&nbsp;<span class="num" id="1763875">5</span><span class="op" id="1763876">,</span>&nbsp;<span class="num" id="1763878">5</span><span class="op" id="1763879">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1763882">6</span><span class="op" id="1763883">,</span>&nbsp;<span class="num" id="1763885">6</span><span class="op" id="1763886">,</span>&nbsp;<span class="num" id="1763888">6</span><span class="op" id="1763889">,</span>&nbsp;<span class="num" id="1763891">6</span><span class="op" id="1763892">,</span>&nbsp;<span class="num" id="1763894">6</span><span class="op" id="1763895">,</span>&nbsp;<span class="num" id="1763897">6</span><span class="op" id="1763898">,</span>&nbsp;<span class="num" id="1763900">6</span><span class="op" id="1763901">,</span>&nbsp;<span class="num" id="1763903">6</span><span class="op" id="1763904">,</span>&nbsp;<span class="num" id="1763906">6</span><span class="op" id="1763907">,</span>&nbsp;<span class="num" id="1763909">6</span><span class="op" id="1763910">,</span>&nbsp;<span class="num" id="1763912">6</span><span class="op" id="1763913">,</span>&nbsp;<span class="num" id="1763915">6</span><span class="op" id="1763916">,</span>&nbsp;<span class="num" id="1763918">6</span><span class="op" id="1763919">,</span>&nbsp;<span class="num" id="1763921">6</span><span class="op" id="1763922">,</span>&nbsp;<span class="num" id="1763924">6</span><span class="op" id="1763925">,</span>&nbsp;<span class="num" id="1763927">6</span><span class="op" id="1763928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1763931">6</span><span class="op" id="1763932">,</span>&nbsp;<span class="num" id="1763934">6</span><span class="op" id="1763935">,</span>&nbsp;<span class="num" id="1763937">6</span><span class="op" id="1763938">,</span>&nbsp;<span class="num" id="1763940">6</span><span class="op" id="1763941">,</span>&nbsp;<span class="num" id="1763943">6</span><span class="op" id="1763944">,</span>&nbsp;<span class="num" id="1763946">6</span><span class="op" id="1763947">,</span>&nbsp;<span class="num" id="1763949">6</span><span class="op" id="1763950">,</span>&nbsp;<span class="num" id="1763952">6</span><span class="op" id="1763953">,</span>&nbsp;<span class="num" id="1763955">6</span><span class="op" id="1763956">,</span>&nbsp;<span class="num" id="1763958">6</span><span class="op" id="1763959">,</span>&nbsp;<span class="num" id="1763961">6</span><span class="op" id="1763962">,</span>&nbsp;<span class="num" id="1763964">6</span><span class="op" id="1763965">,</span>&nbsp;<span class="num" id="1763967">6</span><span class="op" id="1763968">,</span>&nbsp;<span class="num" id="1763970">6</span><span class="op" id="1763971">,</span>&nbsp;<span class="num" id="1763973">6</span><span class="op" id="1763974">,</span>&nbsp;<span class="num" id="1763976">6</span><span class="op" id="1763977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1763980">7</span><span class="op" id="1763981">,</span>&nbsp;<span class="num" id="1763983">7</span><span class="op" id="1763984">,</span>&nbsp;<span class="num" id="1763986">7</span><span class="op" id="1763987">,</span>&nbsp;<span class="num" id="1763989">7</span><span class="op" id="1763990">,</span>&nbsp;<span class="num" id="1763992">7</span><span class="op" id="1763993">,</span>&nbsp;<span class="num" id="1763995">7</span><span class="op" id="1763996">,</span>&nbsp;<span class="num" id="1763998">7</span><span class="op" id="1763999">,</span>&nbsp;<span class="num" id="1764001">7</span><span class="op" id="1764002">,</span>&nbsp;<span class="num" id="1764004">7</span><span class="op" id="1764005">,</span>&nbsp;<span class="num" id="1764007">7</span><span class="op" id="1764008">,</span>&nbsp;<span class="num" id="1764010">7</span><span class="op" id="1764011">,</span>&nbsp;<span class="num" id="1764013">7</span><span class="op" id="1764014">,</span>&nbsp;<span class="num" id="1764016">7</span><span class="op" id="1764017">,</span>&nbsp;<span class="num" id="1764019">7</span><span class="op" id="1764020">,</span>&nbsp;<span class="num" id="1764022">7</span><span class="op" id="1764023">,</span>&nbsp;<span class="num" id="1764025">7</span><span class="op" id="1764026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764029">7</span><span class="op" id="1764030">,</span>&nbsp;<span class="num" id="1764032">7</span><span class="op" id="1764033">,</span>&nbsp;<span class="num" id="1764035">7</span><span class="op" id="1764036">,</span>&nbsp;<span class="num" id="1764038">7</span><span class="op" id="1764039">,</span>&nbsp;<span class="num" id="1764041">7</span><span class="op" id="1764042">,</span>&nbsp;<span class="num" id="1764044">7</span><span class="op" id="1764045">,</span>&nbsp;<span class="num" id="1764047">7</span><span class="op" id="1764048">,</span>&nbsp;<span class="num" id="1764050">7</span><span class="op" id="1764051">,</span>&nbsp;<span class="num" id="1764053">7</span><span class="op" id="1764054">,</span>&nbsp;<span class="num" id="1764056">7</span><span class="op" id="1764057">,</span>&nbsp;<span class="num" id="1764059">7</span><span class="op" id="1764060">,</span>&nbsp;<span class="num" id="1764062">7</span><span class="op" id="1764063">,</span>&nbsp;<span class="num" id="1764065">7</span><span class="op" id="1764066">,</span>&nbsp;<span class="num" id="1764068">7</span><span class="op" id="1764069">,</span>&nbsp;<span class="num" id="1764071">7</span><span class="op" id="1764072">,</span>&nbsp;<span class="num" id="1764074">7</span><span class="op" id="1764075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764078">7</span><span class="op" id="1764079">,</span>&nbsp;<span class="num" id="1764081">7</span><span class="op" id="1764082">,</span>&nbsp;<span class="num" id="1764084">7</span><span class="op" id="1764085">,</span>&nbsp;<span class="num" id="1764087">7</span><span class="op" id="1764088">,</span>&nbsp;<span class="num" id="1764090">7</span><span class="op" id="1764091">,</span>&nbsp;<span class="num" id="1764093">7</span><span class="op" id="1764094">,</span>&nbsp;<span class="num" id="1764096">7</span><span class="op" id="1764097">,</span>&nbsp;<span class="num" id="1764099">7</span><span class="op" id="1764100">,</span>&nbsp;<span class="num" id="1764102">7</span><span class="op" id="1764103">,</span>&nbsp;<span class="num" id="1764105">7</span><span class="op" id="1764106">,</span>&nbsp;<span class="num" id="1764108">7</span><span class="op" id="1764109">,</span>&nbsp;<span class="num" id="1764111">7</span><span class="op" id="1764112">,</span>&nbsp;<span class="num" id="1764114">7</span><span class="op" id="1764115">,</span>&nbsp;<span class="num" id="1764117">7</span><span class="op" id="1764118">,</span>&nbsp;<span class="num" id="1764120">7</span><span class="op" id="1764121">,</span>&nbsp;<span class="num" id="1764123">7</span><span class="op" id="1764124">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764127">7</span><span class="op" id="1764128">,</span>&nbsp;<span class="num" id="1764130">7</span><span class="op" id="1764131">,</span>&nbsp;<span class="num" id="1764133">7</span><span class="op" id="1764134">,</span>&nbsp;<span class="num" id="1764136">7</span><span class="op" id="1764137">,</span>&nbsp;<span class="num" id="1764139">7</span><span class="op" id="1764140">,</span>&nbsp;<span class="num" id="1764142">7</span><span class="op" id="1764143">,</span>&nbsp;<span class="num" id="1764145">7</span><span class="op" id="1764146">,</span>&nbsp;<span class="num" id="1764148">7</span><span class="op" id="1764149">,</span>&nbsp;<span class="num" id="1764151">7</span><span class="op" id="1764152">,</span>&nbsp;<span class="num" id="1764154">7</span><span class="op" id="1764155">,</span>&nbsp;<span class="num" id="1764157">7</span><span class="op" id="1764158">,</span>&nbsp;<span class="num" id="1764160">7</span><span class="op" id="1764161">,</span>&nbsp;<span class="num" id="1764163">7</span><span class="op" id="1764164">,</span>&nbsp;<span class="num" id="1764166">7</span><span class="op" id="1764167">,</span>&nbsp;<span class="num" id="1764169">7</span><span class="op" id="1764170">,</span>&nbsp;<span class="num" id="1764172">7</span><span class="op" id="1764173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764176">8</span><span class="op" id="1764177">,</span>&nbsp;<span class="num" id="1764179">8</span><span class="op" id="1764180">,</span>&nbsp;<span class="num" id="1764182">8</span><span class="op" id="1764183">,</span>&nbsp;<span class="num" id="1764185">8</span><span class="op" id="1764186">,</span>&nbsp;<span class="num" id="1764188">8</span><span class="op" id="1764189">,</span>&nbsp;<span class="num" id="1764191">8</span><span class="op" id="1764192">,</span>&nbsp;<span class="num" id="1764194">8</span><span class="op" id="1764195">,</span>&nbsp;<span class="num" id="1764197">8</span><span class="op" id="1764198">,</span>&nbsp;<span class="num" id="1764200">8</span><span class="op" id="1764201">,</span>&nbsp;<span class="num" id="1764203">8</span><span class="op" id="1764204">,</span>&nbsp;<span class="num" id="1764206">8</span><span class="op" id="1764207">,</span>&nbsp;<span class="num" id="1764209">8</span><span class="op" id="1764210">,</span>&nbsp;<span class="num" id="1764212">8</span><span class="op" id="1764213">,</span>&nbsp;<span class="num" id="1764215">8</span><span class="op" id="1764216">,</span>&nbsp;<span class="num" id="1764218">8</span><span class="op" id="1764219">,</span>&nbsp;<span class="num" id="1764221">8</span><span class="op" id="1764222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764225">8</span><span class="op" id="1764226">,</span>&nbsp;<span class="num" id="1764228">8</span><span class="op" id="1764229">,</span>&nbsp;<span class="num" id="1764231">8</span><span class="op" id="1764232">,</span>&nbsp;<span class="num" id="1764234">8</span><span class="op" id="1764235">,</span>&nbsp;<span class="num" id="1764237">8</span><span class="op" id="1764238">,</span>&nbsp;<span class="num" id="1764240">8</span><span class="op" id="1764241">,</span>&nbsp;<span class="num" id="1764243">8</span><span class="op" id="1764244">,</span>&nbsp;<span class="num" id="1764246">8</span><span class="op" id="1764247">,</span>&nbsp;<span class="num" id="1764249">8</span><span class="op" id="1764250">,</span>&nbsp;<span class="num" id="1764252">8</span><span class="op" id="1764253">,</span>&nbsp;<span class="num" id="1764255">8</span><span class="op" id="1764256">,</span>&nbsp;<span class="num" id="1764258">8</span><span class="op" id="1764259">,</span>&nbsp;<span class="num" id="1764261">8</span><span class="op" id="1764262">,</span>&nbsp;<span class="num" id="1764264">8</span><span class="op" id="1764265">,</span>&nbsp;<span class="num" id="1764267">8</span><span class="op" id="1764268">,</span>&nbsp;<span class="num" id="1764270">8</span><span class="op" id="1764271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764274">8</span><span class="op" id="1764275">,</span>&nbsp;<span class="num" id="1764277">8</span><span class="op" id="1764278">,</span>&nbsp;<span class="num" id="1764280">8</span><span class="op" id="1764281">,</span>&nbsp;<span class="num" id="1764283">8</span><span class="op" id="1764284">,</span>&nbsp;<span class="num" id="1764286">8</span><span class="op" id="1764287">,</span>&nbsp;<span class="num" id="1764289">8</span><span class="op" id="1764290">,</span>&nbsp;<span class="num" id="1764292">8</span><span class="op" id="1764293">,</span>&nbsp;<span class="num" id="1764295">8</span><span class="op" id="1764296">,</span>&nbsp;<span class="num" id="1764298">8</span><span class="op" id="1764299">,</span>&nbsp;<span class="num" id="1764301">8</span><span class="op" id="1764302">,</span>&nbsp;<span class="num" id="1764304">8</span><span class="op" id="1764305">,</span>&nbsp;<span class="num" id="1764307">8</span><span class="op" id="1764308">,</span>&nbsp;<span class="num" id="1764310">8</span><span class="op" id="1764311">,</span>&nbsp;<span class="num" id="1764313">8</span><span class="op" id="1764314">,</span>&nbsp;<span class="num" id="1764316">8</span><span class="op" id="1764317">,</span>&nbsp;<span class="num" id="1764319">8</span><span class="op" id="1764320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764323">8</span><span class="op" id="1764324">,</span>&nbsp;<span class="num" id="1764326">8</span><span class="op" id="1764327">,</span>&nbsp;<span class="num" id="1764329">8</span><span class="op" id="1764330">,</span>&nbsp;<span class="num" id="1764332">8</span><span class="op" id="1764333">,</span>&nbsp;<span class="num" id="1764335">8</span><span class="op" id="1764336">,</span>&nbsp;<span class="num" id="1764338">8</span><span class="op" id="1764339">,</span>&nbsp;<span class="num" id="1764341">8</span><span class="op" id="1764342">,</span>&nbsp;<span class="num" id="1764344">8</span><span class="op" id="1764345">,</span>&nbsp;<span class="num" id="1764347">8</span><span class="op" id="1764348">,</span>&nbsp;<span class="num" id="1764350">8</span><span class="op" id="1764351">,</span>&nbsp;<span class="num" id="1764353">8</span><span class="op" id="1764354">,</span>&nbsp;<span class="num" id="1764356">8</span><span class="op" id="1764357">,</span>&nbsp;<span class="num" id="1764359">8</span><span class="op" id="1764360">,</span>&nbsp;<span class="num" id="1764362">8</span><span class="op" id="1764363">,</span>&nbsp;<span class="num" id="1764365">8</span><span class="op" id="1764366">,</span>&nbsp;<span class="num" id="1764368">8</span><span class="op" id="1764369">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764372">8</span><span class="op" id="1764373">,</span>&nbsp;<span class="num" id="1764375">8</span><span class="op" id="1764376">,</span>&nbsp;<span class="num" id="1764378">8</span><span class="op" id="1764379">,</span>&nbsp;<span class="num" id="1764381">8</span><span class="op" id="1764382">,</span>&nbsp;<span class="num" id="1764384">8</span><span class="op" id="1764385">,</span>&nbsp;<span class="num" id="1764387">8</span><span class="op" id="1764388">,</span>&nbsp;<span class="num" id="1764390">8</span><span class="op" id="1764391">,</span>&nbsp;<span class="num" id="1764393">8</span><span class="op" id="1764394">,</span>&nbsp;<span class="num" id="1764396">8</span><span class="op" id="1764397">,</span>&nbsp;<span class="num" id="1764399">8</span><span class="op" id="1764400">,</span>&nbsp;<span class="num" id="1764402">8</span><span class="op" id="1764403">,</span>&nbsp;<span class="num" id="1764405">8</span><span class="op" id="1764406">,</span>&nbsp;<span class="num" id="1764408">8</span><span class="op" id="1764409">,</span>&nbsp;<span class="num" id="1764411">8</span><span class="op" id="1764412">,</span>&nbsp;<span class="num" id="1764414">8</span><span class="op" id="1764415">,</span>&nbsp;<span class="num" id="1764417">8</span><span class="op" id="1764418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764421">8</span><span class="op" id="1764422">,</span>&nbsp;<span class="num" id="1764424">8</span><span class="op" id="1764425">,</span>&nbsp;<span class="num" id="1764427">8</span><span class="op" id="1764428">,</span>&nbsp;<span class="num" id="1764430">8</span><span class="op" id="1764431">,</span>&nbsp;<span class="num" id="1764433">8</span><span class="op" id="1764434">,</span>&nbsp;<span class="num" id="1764436">8</span><span class="op" id="1764437">,</span>&nbsp;<span class="num" id="1764439">8</span><span class="op" id="1764440">,</span>&nbsp;<span class="num" id="1764442">8</span><span class="op" id="1764443">,</span>&nbsp;<span class="num" id="1764445">8</span><span class="op" id="1764446">,</span>&nbsp;<span class="num" id="1764448">8</span><span class="op" id="1764449">,</span>&nbsp;<span class="num" id="1764451">8</span><span class="op" id="1764452">,</span>&nbsp;<span class="num" id="1764454">8</span><span class="op" id="1764455">,</span>&nbsp;<span class="num" id="1764457">8</span><span class="op" id="1764458">,</span>&nbsp;<span class="num" id="1764460">8</span><span class="op" id="1764461">,</span>&nbsp;<span class="num" id="1764463">8</span><span class="op" id="1764464">,</span>&nbsp;<span class="num" id="1764466">8</span><span class="op" id="1764467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764470">8</span><span class="op" id="1764471">,</span>&nbsp;<span class="num" id="1764473">8</span><span class="op" id="1764474">,</span>&nbsp;<span class="num" id="1764476">8</span><span class="op" id="1764477">,</span>&nbsp;<span class="num" id="1764479">8</span><span class="op" id="1764480">,</span>&nbsp;<span class="num" id="1764482">8</span><span class="op" id="1764483">,</span>&nbsp;<span class="num" id="1764485">8</span><span class="op" id="1764486">,</span>&nbsp;<span class="num" id="1764488">8</span><span class="op" id="1764489">,</span>&nbsp;<span class="num" id="1764491">8</span><span class="op" id="1764492">,</span>&nbsp;<span class="num" id="1764494">8</span><span class="op" id="1764495">,</span>&nbsp;<span class="num" id="1764497">8</span><span class="op" id="1764498">,</span>&nbsp;<span class="num" id="1764500">8</span><span class="op" id="1764501">,</span>&nbsp;<span class="num" id="1764503">8</span><span class="op" id="1764504">,</span>&nbsp;<span class="num" id="1764506">8</span><span class="op" id="1764507">,</span>&nbsp;<span class="num" id="1764509">8</span><span class="op" id="1764510">,</span>&nbsp;<span class="num" id="1764512">8</span><span class="op" id="1764513">,</span>&nbsp;<span class="num" id="1764515">8</span><span class="op" id="1764516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764519">8</span><span class="op" id="1764520">,</span>&nbsp;<span class="num" id="1764522">8</span><span class="op" id="1764523">,</span>&nbsp;<span class="num" id="1764525">8</span><span class="op" id="1764526">,</span>&nbsp;<span class="num" id="1764528">8</span><span class="op" id="1764529">,</span>&nbsp;<span class="num" id="1764531">8</span><span class="op" id="1764532">,</span>&nbsp;<span class="num" id="1764534">8</span><span class="op" id="1764535">,</span>&nbsp;<span class="num" id="1764537">8</span><span class="op" id="1764538">,</span>&nbsp;<span class="num" id="1764540">8</span><span class="op" id="1764541">,</span>&nbsp;<span class="num" id="1764543">8</span><span class="op" id="1764544">,</span>&nbsp;<span class="num" id="1764546">8</span><span class="op" id="1764547">,</span>&nbsp;<span class="num" id="1764549">8</span><span class="op" id="1764550">,</span>&nbsp;<span class="num" id="1764552">8</span><span class="op" id="1764553">,</span>&nbsp;<span class="num" id="1764555">8</span><span class="op" id="1764556">,</span>&nbsp;<span class="num" id="1764558">8</span><span class="op" id="1764559">,</span>&nbsp;<span class="num" id="1764561">8</span><span class="op" id="1764562">,</span>&nbsp;<span class="num" id="1764564">8</span><span class="op" id="1764565">,</span><br>
<span class="lineno"></span><span class="op" id="1764567">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="1764570">type</span>&nbsp;<span class="ident" id="1764575">quantIndex</span>&nbsp;<span class="builtintype" id="1764586">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1764591">const</span>&nbsp;<span class="op" id="1764597">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1764600">quantIndexLuminance</span>&nbsp;<span class="ident" id="1764620">quantIndex</span>&nbsp;<span class="op" id="1764631">=</span>&nbsp;<span class="ident" id="1764633">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1764639">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1764662">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="1764674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1764677">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="1764754">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="1764830">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1764906">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="1764924">var</span>&nbsp;<span class="ident" id="1764928">unscaledQuant</span>&nbsp;<span class="op" id="1764942">=</span>&nbsp;<span class="op" id="1764944">[</span><span class="ident" id="1764945">nQuantIndex</span><span class="op" id="1764956">]</span><span class="op" id="1764957">[</span><span class="ident" id="1764958">blockSize</span><span class="op" id="1764967">]</span><span class="builtintype" id="1764968">byte</span><span class="op" id="1764972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1764975">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1764990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1764994">16</span><span class="op" id="1764996">,</span>&nbsp;<span class="num" id="1764998">11</span><span class="op" id="1765000">,</span>&nbsp;<span class="num" id="1765002">12</span><span class="op" id="1765004">,</span>&nbsp;<span class="num" id="1765006">14</span><span class="op" id="1765008">,</span>&nbsp;<span class="num" id="1765010">12</span><span class="op" id="1765012">,</span>&nbsp;<span class="num" id="1765014">10</span><span class="op" id="1765016">,</span>&nbsp;<span class="num" id="1765018">16</span><span class="op" id="1765020">,</span>&nbsp;<span class="num" id="1765022">14</span><span class="op" id="1765024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765028">13</span><span class="op" id="1765030">,</span>&nbsp;<span class="num" id="1765032">14</span><span class="op" id="1765034">,</span>&nbsp;<span class="num" id="1765036">18</span><span class="op" id="1765038">,</span>&nbsp;<span class="num" id="1765040">17</span><span class="op" id="1765042">,</span>&nbsp;<span class="num" id="1765044">16</span><span class="op" id="1765046">,</span>&nbsp;<span class="num" id="1765048">19</span><span class="op" id="1765050">,</span>&nbsp;<span class="num" id="1765052">24</span><span class="op" id="1765054">,</span>&nbsp;<span class="num" id="1765056">40</span><span class="op" id="1765058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765062">26</span><span class="op" id="1765064">,</span>&nbsp;<span class="num" id="1765066">24</span><span class="op" id="1765068">,</span>&nbsp;<span class="num" id="1765070">22</span><span class="op" id="1765072">,</span>&nbsp;<span class="num" id="1765074">22</span><span class="op" id="1765076">,</span>&nbsp;<span class="num" id="1765078">24</span><span class="op" id="1765080">,</span>&nbsp;<span class="num" id="1765082">49</span><span class="op" id="1765084">,</span>&nbsp;<span class="num" id="1765086">35</span><span class="op" id="1765088">,</span>&nbsp;<span class="num" id="1765090">37</span><span class="op" id="1765092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765096">29</span><span class="op" id="1765098">,</span>&nbsp;<span class="num" id="1765100">40</span><span class="op" id="1765102">,</span>&nbsp;<span class="num" id="1765104">58</span><span class="op" id="1765106">,</span>&nbsp;<span class="num" id="1765108">51</span><span class="op" id="1765110">,</span>&nbsp;<span class="num" id="1765112">61</span><span class="op" id="1765114">,</span>&nbsp;<span class="num" id="1765116">60</span><span class="op" id="1765118">,</span>&nbsp;<span class="num" id="1765120">57</span><span class="op" id="1765122">,</span>&nbsp;<span class="num" id="1765124">51</span><span class="op" id="1765126">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765130">56</span><span class="op" id="1765132">,</span>&nbsp;<span class="num" id="1765134">55</span><span class="op" id="1765136">,</span>&nbsp;<span class="num" id="1765138">64</span><span class="op" id="1765140">,</span>&nbsp;<span class="num" id="1765142">72</span><span class="op" id="1765144">,</span>&nbsp;<span class="num" id="1765146">92</span><span class="op" id="1765148">,</span>&nbsp;<span class="num" id="1765150">78</span><span class="op" id="1765152">,</span>&nbsp;<span class="num" id="1765154">64</span><span class="op" id="1765156">,</span>&nbsp;<span class="num" id="1765158">68</span><span class="op" id="1765160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765164">87</span><span class="op" id="1765166">,</span>&nbsp;<span class="num" id="1765168">69</span><span class="op" id="1765170">,</span>&nbsp;<span class="num" id="1765172">55</span><span class="op" id="1765174">,</span>&nbsp;<span class="num" id="1765176">56</span><span class="op" id="1765178">,</span>&nbsp;<span class="num" id="1765180">80</span><span class="op" id="1765182">,</span>&nbsp;<span class="num" id="1765184">109</span><span class="op" id="1765187">,</span>&nbsp;<span class="num" id="1765189">81</span><span class="op" id="1765191">,</span>&nbsp;<span class="num" id="1765193">87</span><span class="op" id="1765195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765199">95</span><span class="op" id="1765201">,</span>&nbsp;<span class="num" id="1765203">98</span><span class="op" id="1765205">,</span>&nbsp;<span class="num" id="1765207">103</span><span class="op" id="1765210">,</span>&nbsp;<span class="num" id="1765212">104</span><span class="op" id="1765215">,</span>&nbsp;<span class="num" id="1765217">103</span><span class="op" id="1765220">,</span>&nbsp;<span class="num" id="1765222">62</span><span class="op" id="1765224">,</span>&nbsp;<span class="num" id="1765226">77</span><span class="op" id="1765228">,</span>&nbsp;<span class="num" id="1765230">113</span><span class="op" id="1765233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765237">121</span><span class="op" id="1765240">,</span>&nbsp;<span class="num" id="1765242">112</span><span class="op" id="1765245">,</span>&nbsp;<span class="num" id="1765247">100</span><span class="op" id="1765250">,</span>&nbsp;<span class="num" id="1765252">120</span><span class="op" id="1765255">,</span>&nbsp;<span class="num" id="1765257">92</span><span class="op" id="1765259">,</span>&nbsp;<span class="num" id="1765261">101</span><span class="op" id="1765264">,</span>&nbsp;<span class="num" id="1765266">103</span><span class="op" id="1765269">,</span>&nbsp;<span class="num" id="1765271">99</span><span class="op" id="1765273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1765276">}</span><span class="op" id="1765277">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1765280">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1765297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765301">17</span><span class="op" id="1765303">,</span>&nbsp;<span class="num" id="1765305">18</span><span class="op" id="1765307">,</span>&nbsp;<span class="num" id="1765309">18</span><span class="op" id="1765311">,</span>&nbsp;<span class="num" id="1765313">24</span><span class="op" id="1765315">,</span>&nbsp;<span class="num" id="1765317">21</span><span class="op" id="1765319">,</span>&nbsp;<span class="num" id="1765321">24</span><span class="op" id="1765323">,</span>&nbsp;<span class="num" id="1765325">47</span><span class="op" id="1765327">,</span>&nbsp;<span class="num" id="1765329">26</span><span class="op" id="1765331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765335">26</span><span class="op" id="1765337">,</span>&nbsp;<span class="num" id="1765339">47</span><span class="op" id="1765341">,</span>&nbsp;<span class="num" id="1765343">99</span><span class="op" id="1765345">,</span>&nbsp;<span class="num" id="1765347">66</span><span class="op" id="1765349">,</span>&nbsp;<span class="num" id="1765351">56</span><span class="op" id="1765353">,</span>&nbsp;<span class="num" id="1765355">66</span><span class="op" id="1765357">,</span>&nbsp;<span class="num" id="1765359">99</span><span class="op" id="1765361">,</span>&nbsp;<span class="num" id="1765363">99</span><span class="op" id="1765365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765369">99</span><span class="op" id="1765371">,</span>&nbsp;<span class="num" id="1765373">99</span><span class="op" id="1765375">,</span>&nbsp;<span class="num" id="1765377">99</span><span class="op" id="1765379">,</span>&nbsp;<span class="num" id="1765381">99</span><span class="op" id="1765383">,</span>&nbsp;<span class="num" id="1765385">99</span><span class="op" id="1765387">,</span>&nbsp;<span class="num" id="1765389">99</span><span class="op" id="1765391">,</span>&nbsp;<span class="num" id="1765393">99</span><span class="op" id="1765395">,</span>&nbsp;<span class="num" id="1765397">99</span><span class="op" id="1765399">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765403">99</span><span class="op" id="1765405">,</span>&nbsp;<span class="num" id="1765407">99</span><span class="op" id="1765409">,</span>&nbsp;<span class="num" id="1765411">99</span><span class="op" id="1765413">,</span>&nbsp;<span class="num" id="1765415">99</span><span class="op" id="1765417">,</span>&nbsp;<span class="num" id="1765419">99</span><span class="op" id="1765421">,</span>&nbsp;<span class="num" id="1765423">99</span><span class="op" id="1765425">,</span>&nbsp;<span class="num" id="1765427">99</span><span class="op" id="1765429">,</span>&nbsp;<span class="num" id="1765431">99</span><span class="op" id="1765433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765437">99</span><span class="op" id="1765439">,</span>&nbsp;<span class="num" id="1765441">99</span><span class="op" id="1765443">,</span>&nbsp;<span class="num" id="1765445">99</span><span class="op" id="1765447">,</span>&nbsp;<span class="num" id="1765449">99</span><span class="op" id="1765451">,</span>&nbsp;<span class="num" id="1765453">99</span><span class="op" id="1765455">,</span>&nbsp;<span class="num" id="1765457">99</span><span class="op" id="1765459">,</span>&nbsp;<span class="num" id="1765461">99</span><span class="op" id="1765463">,</span>&nbsp;<span class="num" id="1765465">99</span><span class="op" id="1765467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765471">99</span><span class="op" id="1765473">,</span>&nbsp;<span class="num" id="1765475">99</span><span class="op" id="1765477">,</span>&nbsp;<span class="num" id="1765479">99</span><span class="op" id="1765481">,</span>&nbsp;<span class="num" id="1765483">99</span><span class="op" id="1765485">,</span>&nbsp;<span class="num" id="1765487">99</span><span class="op" id="1765489">,</span>&nbsp;<span class="num" id="1765491">99</span><span class="op" id="1765493">,</span>&nbsp;<span class="num" id="1765495">99</span><span class="op" id="1765497">,</span>&nbsp;<span class="num" id="1765499">99</span><span class="op" id="1765501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765505">99</span><span class="op" id="1765507">,</span>&nbsp;<span class="num" id="1765509">99</span><span class="op" id="1765511">,</span>&nbsp;<span class="num" id="1765513">99</span><span class="op" id="1765515">,</span>&nbsp;<span class="num" id="1765517">99</span><span class="op" id="1765519">,</span>&nbsp;<span class="num" id="1765521">99</span><span class="op" id="1765523">,</span>&nbsp;<span class="num" id="1765525">99</span><span class="op" id="1765527">,</span>&nbsp;<span class="num" id="1765529">99</span><span class="op" id="1765531">,</span>&nbsp;<span class="num" id="1765533">99</span><span class="op" id="1765535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1765539">99</span><span class="op" id="1765541">,</span>&nbsp;<span class="num" id="1765543">99</span><span class="op" id="1765545">,</span>&nbsp;<span class="num" id="1765547">99</span><span class="op" id="1765549">,</span>&nbsp;<span class="num" id="1765551">99</span><span class="op" id="1765553">,</span>&nbsp;<span class="num" id="1765555">99</span><span class="op" id="1765557">,</span>&nbsp;<span class="num" id="1765559">99</span><span class="op" id="1765561">,</span>&nbsp;<span class="num" id="1765563">99</span><span class="op" id="1765565">,</span>&nbsp;<span class="num" id="1765567">99</span><span class="op" id="1765569">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1765572">}</span><span class="op" id="1765573">,</span><br>
<span class="lineno"></span><span class="op" id="1765575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1765578">type</span>&nbsp;<span class="ident" id="1765583">huffIndex</span>&nbsp;<span class="builtintype" id="1765593">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="1765598">const</span>&nbsp;<span class="op" id="1765604">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765607">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="1765628">huffIndex</span>&nbsp;<span class="op" id="1765638">=</span>&nbsp;<span class="ident" id="1765640">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765646">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765668">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765692">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765716">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="1765727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1765730">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1765775">type</span>&nbsp;<span class="ident" id="1765780">huffmanSpec</span>&nbsp;<span class="keyword" id="1765792">struct</span>&nbsp;<span class="op" id="1765799">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1765802">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765856">count</span>&nbsp;<span class="op" id="1765862">[</span><span class="num" id="1765863">16</span><span class="op" id="1765865">]</span><span class="builtintype" id="1765866">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1765872">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765928">value</span>&nbsp;<span class="op" id="1765934">[</span><span class="op" id="1765935">]</span><span class="builtintype" id="1765936">byte</span><br>
<span class="lineno"></span><span class="op" id="1765941">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="1765944">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="1766002">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="1766065">var</span>&nbsp;<span class="ident" id="1766069">theHuffmanSpec</span>&nbsp;<span class="op" id="1766084">=</span>&nbsp;<span class="op" id="1766086">[</span><span class="ident" id="1766087">nHuffIndex</span><span class="op" id="1766097">]</span><span class="ident" id="1766098">huffmanSpec</span><span class="op" id="1766109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1766112">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766134">[</span><span class="num" id="1766135">16</span><span class="op" id="1766137">]</span><span class="builtintype" id="1766138">byte</span><span class="op" id="1766142">{</span><span class="num" id="1766143">0</span><span class="op" id="1766144">,</span>&nbsp;<span class="num" id="1766146">1</span><span class="op" id="1766147">,</span>&nbsp;<span class="num" id="1766149">5</span><span class="op" id="1766150">,</span>&nbsp;<span class="num" id="1766152">1</span><span class="op" id="1766153">,</span>&nbsp;<span class="num" id="1766155">1</span><span class="op" id="1766156">,</span>&nbsp;<span class="num" id="1766158">1</span><span class="op" id="1766159">,</span>&nbsp;<span class="num" id="1766161">1</span><span class="op" id="1766162">,</span>&nbsp;<span class="num" id="1766164">1</span><span class="op" id="1766165">,</span>&nbsp;<span class="num" id="1766167">1</span><span class="op" id="1766168">,</span>&nbsp;<span class="num" id="1766170">0</span><span class="op" id="1766171">,</span>&nbsp;<span class="num" id="1766173">0</span><span class="op" id="1766174">,</span>&nbsp;<span class="num" id="1766176">0</span><span class="op" id="1766177">,</span>&nbsp;<span class="num" id="1766179">0</span><span class="op" id="1766180">,</span>&nbsp;<span class="num" id="1766182">0</span><span class="op" id="1766183">,</span>&nbsp;<span class="num" id="1766185">0</span><span class="op" id="1766186">,</span>&nbsp;<span class="num" id="1766188">0</span><span class="op" id="1766189">}</span><span class="op" id="1766190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766194">[</span><span class="op" id="1766195">]</span><span class="builtintype" id="1766196">byte</span><span class="op" id="1766200">{</span><span class="num" id="1766201">0</span><span class="op" id="1766202">,</span>&nbsp;<span class="num" id="1766204">1</span><span class="op" id="1766205">,</span>&nbsp;<span class="num" id="1766207">2</span><span class="op" id="1766208">,</span>&nbsp;<span class="num" id="1766210">3</span><span class="op" id="1766211">,</span>&nbsp;<span class="num" id="1766213">4</span><span class="op" id="1766214">,</span>&nbsp;<span class="num" id="1766216">5</span><span class="op" id="1766217">,</span>&nbsp;<span class="num" id="1766219">6</span><span class="op" id="1766220">,</span>&nbsp;<span class="num" id="1766222">7</span><span class="op" id="1766223">,</span>&nbsp;<span class="num" id="1766225">8</span><span class="op" id="1766226">,</span>&nbsp;<span class="num" id="1766228">9</span><span class="op" id="1766229">,</span>&nbsp;<span class="num" id="1766231">10</span><span class="op" id="1766233">,</span>&nbsp;<span class="num" id="1766235">11</span><span class="op" id="1766237">}</span><span class="op" id="1766238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766241">}</span><span class="op" id="1766242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1766245">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766267">[</span><span class="num" id="1766268">16</span><span class="op" id="1766270">]</span><span class="builtintype" id="1766271">byte</span><span class="op" id="1766275">{</span><span class="num" id="1766276">0</span><span class="op" id="1766277">,</span>&nbsp;<span class="num" id="1766279">2</span><span class="op" id="1766280">,</span>&nbsp;<span class="num" id="1766282">1</span><span class="op" id="1766283">,</span>&nbsp;<span class="num" id="1766285">3</span><span class="op" id="1766286">,</span>&nbsp;<span class="num" id="1766288">3</span><span class="op" id="1766289">,</span>&nbsp;<span class="num" id="1766291">2</span><span class="op" id="1766292">,</span>&nbsp;<span class="num" id="1766294">4</span><span class="op" id="1766295">,</span>&nbsp;<span class="num" id="1766297">3</span><span class="op" id="1766298">,</span>&nbsp;<span class="num" id="1766300">5</span><span class="op" id="1766301">,</span>&nbsp;<span class="num" id="1766303">5</span><span class="op" id="1766304">,</span>&nbsp;<span class="num" id="1766306">4</span><span class="op" id="1766307">,</span>&nbsp;<span class="num" id="1766309">4</span><span class="op" id="1766310">,</span>&nbsp;<span class="num" id="1766312">0</span><span class="op" id="1766313">,</span>&nbsp;<span class="num" id="1766315">0</span><span class="op" id="1766316">,</span>&nbsp;<span class="num" id="1766318">1</span><span class="op" id="1766319">,</span>&nbsp;<span class="num" id="1766321">125</span><span class="op" id="1766324">}</span><span class="op" id="1766325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766329">[</span><span class="op" id="1766330">]</span><span class="builtintype" id="1766331">byte</span><span class="op" id="1766335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766340">0x01</span><span class="op" id="1766344">,</span>&nbsp;<span class="num" id="1766346">0x02</span><span class="op" id="1766350">,</span>&nbsp;<span class="num" id="1766352">0x03</span><span class="op" id="1766356">,</span>&nbsp;<span class="num" id="1766358">0x00</span><span class="op" id="1766362">,</span>&nbsp;<span class="num" id="1766364">0x04</span><span class="op" id="1766368">,</span>&nbsp;<span class="num" id="1766370">0x11</span><span class="op" id="1766374">,</span>&nbsp;<span class="num" id="1766376">0x05</span><span class="op" id="1766380">,</span>&nbsp;<span class="num" id="1766382">0x12</span><span class="op" id="1766386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766391">0x21</span><span class="op" id="1766395">,</span>&nbsp;<span class="num" id="1766397">0x31</span><span class="op" id="1766401">,</span>&nbsp;<span class="num" id="1766403">0x41</span><span class="op" id="1766407">,</span>&nbsp;<span class="num" id="1766409">0x06</span><span class="op" id="1766413">,</span>&nbsp;<span class="num" id="1766415">0x13</span><span class="op" id="1766419">,</span>&nbsp;<span class="num" id="1766421">0x51</span><span class="op" id="1766425">,</span>&nbsp;<span class="num" id="1766427">0x61</span><span class="op" id="1766431">,</span>&nbsp;<span class="num" id="1766433">0x07</span><span class="op" id="1766437">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766442">0x22</span><span class="op" id="1766446">,</span>&nbsp;<span class="num" id="1766448">0x71</span><span class="op" id="1766452">,</span>&nbsp;<span class="num" id="1766454">0x14</span><span class="op" id="1766458">,</span>&nbsp;<span class="num" id="1766460">0x32</span><span class="op" id="1766464">,</span>&nbsp;<span class="num" id="1766466">0x81</span><span class="op" id="1766470">,</span>&nbsp;<span class="num" id="1766472">0x91</span><span class="op" id="1766476">,</span>&nbsp;<span class="num" id="1766478">0xa1</span><span class="op" id="1766482">,</span>&nbsp;<span class="num" id="1766484">0x08</span><span class="op" id="1766488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766493">0x23</span><span class="op" id="1766497">,</span>&nbsp;<span class="num" id="1766499">0x42</span><span class="op" id="1766503">,</span>&nbsp;<span class="num" id="1766505">0xb1</span><span class="op" id="1766509">,</span>&nbsp;<span class="num" id="1766511">0xc1</span><span class="op" id="1766515">,</span>&nbsp;<span class="num" id="1766517">0x15</span><span class="op" id="1766521">,</span>&nbsp;<span class="num" id="1766523">0x52</span><span class="op" id="1766527">,</span>&nbsp;<span class="num" id="1766529">0xd1</span><span class="op" id="1766533">,</span>&nbsp;<span class="num" id="1766535">0xf0</span><span class="op" id="1766539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766544">0x24</span><span class="op" id="1766548">,</span>&nbsp;<span class="num" id="1766550">0x33</span><span class="op" id="1766554">,</span>&nbsp;<span class="num" id="1766556">0x62</span><span class="op" id="1766560">,</span>&nbsp;<span class="num" id="1766562">0x72</span><span class="op" id="1766566">,</span>&nbsp;<span class="num" id="1766568">0x82</span><span class="op" id="1766572">,</span>&nbsp;<span class="num" id="1766574">0x09</span><span class="op" id="1766578">,</span>&nbsp;<span class="num" id="1766580">0x0a</span><span class="op" id="1766584">,</span>&nbsp;<span class="num" id="1766586">0x16</span><span class="op" id="1766590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766595">0x17</span><span class="op" id="1766599">,</span>&nbsp;<span class="num" id="1766601">0x18</span><span class="op" id="1766605">,</span>&nbsp;<span class="num" id="1766607">0x19</span><span class="op" id="1766611">,</span>&nbsp;<span class="num" id="1766613">0x1a</span><span class="op" id="1766617">,</span>&nbsp;<span class="num" id="1766619">0x25</span><span class="op" id="1766623">,</span>&nbsp;<span class="num" id="1766625">0x26</span><span class="op" id="1766629">,</span>&nbsp;<span class="num" id="1766631">0x27</span><span class="op" id="1766635">,</span>&nbsp;<span class="num" id="1766637">0x28</span><span class="op" id="1766641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766646">0x29</span><span class="op" id="1766650">,</span>&nbsp;<span class="num" id="1766652">0x2a</span><span class="op" id="1766656">,</span>&nbsp;<span class="num" id="1766658">0x34</span><span class="op" id="1766662">,</span>&nbsp;<span class="num" id="1766664">0x35</span><span class="op" id="1766668">,</span>&nbsp;<span class="num" id="1766670">0x36</span><span class="op" id="1766674">,</span>&nbsp;<span class="num" id="1766676">0x37</span><span class="op" id="1766680">,</span>&nbsp;<span class="num" id="1766682">0x38</span><span class="op" id="1766686">,</span>&nbsp;<span class="num" id="1766688">0x39</span><span class="op" id="1766692">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766697">0x3a</span><span class="op" id="1766701">,</span>&nbsp;<span class="num" id="1766703">0x43</span><span class="op" id="1766707">,</span>&nbsp;<span class="num" id="1766709">0x44</span><span class="op" id="1766713">,</span>&nbsp;<span class="num" id="1766715">0x45</span><span class="op" id="1766719">,</span>&nbsp;<span class="num" id="1766721">0x46</span><span class="op" id="1766725">,</span>&nbsp;<span class="num" id="1766727">0x47</span><span class="op" id="1766731">,</span>&nbsp;<span class="num" id="1766733">0x48</span><span class="op" id="1766737">,</span>&nbsp;<span class="num" id="1766739">0x49</span><span class="op" id="1766743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766748">0x4a</span><span class="op" id="1766752">,</span>&nbsp;<span class="num" id="1766754">0x53</span><span class="op" id="1766758">,</span>&nbsp;<span class="num" id="1766760">0x54</span><span class="op" id="1766764">,</span>&nbsp;<span class="num" id="1766766">0x55</span><span class="op" id="1766770">,</span>&nbsp;<span class="num" id="1766772">0x56</span><span class="op" id="1766776">,</span>&nbsp;<span class="num" id="1766778">0x57</span><span class="op" id="1766782">,</span>&nbsp;<span class="num" id="1766784">0x58</span><span class="op" id="1766788">,</span>&nbsp;<span class="num" id="1766790">0x59</span><span class="op" id="1766794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766799">0x5a</span><span class="op" id="1766803">,</span>&nbsp;<span class="num" id="1766805">0x63</span><span class="op" id="1766809">,</span>&nbsp;<span class="num" id="1766811">0x64</span><span class="op" id="1766815">,</span>&nbsp;<span class="num" id="1766817">0x65</span><span class="op" id="1766821">,</span>&nbsp;<span class="num" id="1766823">0x66</span><span class="op" id="1766827">,</span>&nbsp;<span class="num" id="1766829">0x67</span><span class="op" id="1766833">,</span>&nbsp;<span class="num" id="1766835">0x68</span><span class="op" id="1766839">,</span>&nbsp;<span class="num" id="1766841">0x69</span><span class="op" id="1766845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766850">0x6a</span><span class="op" id="1766854">,</span>&nbsp;<span class="num" id="1766856">0x73</span><span class="op" id="1766860">,</span>&nbsp;<span class="num" id="1766862">0x74</span><span class="op" id="1766866">,</span>&nbsp;<span class="num" id="1766868">0x75</span><span class="op" id="1766872">,</span>&nbsp;<span class="num" id="1766874">0x76</span><span class="op" id="1766878">,</span>&nbsp;<span class="num" id="1766880">0x77</span><span class="op" id="1766884">,</span>&nbsp;<span class="num" id="1766886">0x78</span><span class="op" id="1766890">,</span>&nbsp;<span class="num" id="1766892">0x79</span><span class="op" id="1766896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766901">0x7a</span><span class="op" id="1766905">,</span>&nbsp;<span class="num" id="1766907">0x83</span><span class="op" id="1766911">,</span>&nbsp;<span class="num" id="1766913">0x84</span><span class="op" id="1766917">,</span>&nbsp;<span class="num" id="1766919">0x85</span><span class="op" id="1766923">,</span>&nbsp;<span class="num" id="1766925">0x86</span><span class="op" id="1766929">,</span>&nbsp;<span class="num" id="1766931">0x87</span><span class="op" id="1766935">,</span>&nbsp;<span class="num" id="1766937">0x88</span><span class="op" id="1766941">,</span>&nbsp;<span class="num" id="1766943">0x89</span><span class="op" id="1766947">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1766952">0x8a</span><span class="op" id="1766956">,</span>&nbsp;<span class="num" id="1766958">0x92</span><span class="op" id="1766962">,</span>&nbsp;<span class="num" id="1766964">0x93</span><span class="op" id="1766968">,</span>&nbsp;<span class="num" id="1766970">0x94</span><span class="op" id="1766974">,</span>&nbsp;<span class="num" id="1766976">0x95</span><span class="op" id="1766980">,</span>&nbsp;<span class="num" id="1766982">0x96</span><span class="op" id="1766986">,</span>&nbsp;<span class="num" id="1766988">0x97</span><span class="op" id="1766992">,</span>&nbsp;<span class="num" id="1766994">0x98</span><span class="op" id="1766998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767003">0x99</span><span class="op" id="1767007">,</span>&nbsp;<span class="num" id="1767009">0x9a</span><span class="op" id="1767013">,</span>&nbsp;<span class="num" id="1767015">0xa2</span><span class="op" id="1767019">,</span>&nbsp;<span class="num" id="1767021">0xa3</span><span class="op" id="1767025">,</span>&nbsp;<span class="num" id="1767027">0xa4</span><span class="op" id="1767031">,</span>&nbsp;<span class="num" id="1767033">0xa5</span><span class="op" id="1767037">,</span>&nbsp;<span class="num" id="1767039">0xa6</span><span class="op" id="1767043">,</span>&nbsp;<span class="num" id="1767045">0xa7</span><span class="op" id="1767049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767054">0xa8</span><span class="op" id="1767058">,</span>&nbsp;<span class="num" id="1767060">0xa9</span><span class="op" id="1767064">,</span>&nbsp;<span class="num" id="1767066">0xaa</span><span class="op" id="1767070">,</span>&nbsp;<span class="num" id="1767072">0xb2</span><span class="op" id="1767076">,</span>&nbsp;<span class="num" id="1767078">0xb3</span><span class="op" id="1767082">,</span>&nbsp;<span class="num" id="1767084">0xb4</span><span class="op" id="1767088">,</span>&nbsp;<span class="num" id="1767090">0xb5</span><span class="op" id="1767094">,</span>&nbsp;<span class="num" id="1767096">0xb6</span><span class="op" id="1767100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767105">0xb7</span><span class="op" id="1767109">,</span>&nbsp;<span class="num" id="1767111">0xb8</span><span class="op" id="1767115">,</span>&nbsp;<span class="num" id="1767117">0xb9</span><span class="op" id="1767121">,</span>&nbsp;<span class="num" id="1767123">0xba</span><span class="op" id="1767127">,</span>&nbsp;<span class="num" id="1767129">0xc2</span><span class="op" id="1767133">,</span>&nbsp;<span class="num" id="1767135">0xc3</span><span class="op" id="1767139">,</span>&nbsp;<span class="num" id="1767141">0xc4</span><span class="op" id="1767145">,</span>&nbsp;<span class="num" id="1767147">0xc5</span><span class="op" id="1767151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767156">0xc6</span><span class="op" id="1767160">,</span>&nbsp;<span class="num" id="1767162">0xc7</span><span class="op" id="1767166">,</span>&nbsp;<span class="num" id="1767168">0xc8</span><span class="op" id="1767172">,</span>&nbsp;<span class="num" id="1767174">0xc9</span><span class="op" id="1767178">,</span>&nbsp;<span class="num" id="1767180">0xca</span><span class="op" id="1767184">,</span>&nbsp;<span class="num" id="1767186">0xd2</span><span class="op" id="1767190">,</span>&nbsp;<span class="num" id="1767192">0xd3</span><span class="op" id="1767196">,</span>&nbsp;<span class="num" id="1767198">0xd4</span><span class="op" id="1767202">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767207">0xd5</span><span class="op" id="1767211">,</span>&nbsp;<span class="num" id="1767213">0xd6</span><span class="op" id="1767217">,</span>&nbsp;<span class="num" id="1767219">0xd7</span><span class="op" id="1767223">,</span>&nbsp;<span class="num" id="1767225">0xd8</span><span class="op" id="1767229">,</span>&nbsp;<span class="num" id="1767231">0xd9</span><span class="op" id="1767235">,</span>&nbsp;<span class="num" id="1767237">0xda</span><span class="op" id="1767241">,</span>&nbsp;<span class="num" id="1767243">0xe1</span><span class="op" id="1767247">,</span>&nbsp;<span class="num" id="1767249">0xe2</span><span class="op" id="1767253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767258">0xe3</span><span class="op" id="1767262">,</span>&nbsp;<span class="num" id="1767264">0xe4</span><span class="op" id="1767268">,</span>&nbsp;<span class="num" id="1767270">0xe5</span><span class="op" id="1767274">,</span>&nbsp;<span class="num" id="1767276">0xe6</span><span class="op" id="1767280">,</span>&nbsp;<span class="num" id="1767282">0xe7</span><span class="op" id="1767286">,</span>&nbsp;<span class="num" id="1767288">0xe8</span><span class="op" id="1767292">,</span>&nbsp;<span class="num" id="1767294">0xe9</span><span class="op" id="1767298">,</span>&nbsp;<span class="num" id="1767300">0xea</span><span class="op" id="1767304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767309">0xf1</span><span class="op" id="1767313">,</span>&nbsp;<span class="num" id="1767315">0xf2</span><span class="op" id="1767319">,</span>&nbsp;<span class="num" id="1767321">0xf3</span><span class="op" id="1767325">,</span>&nbsp;<span class="num" id="1767327">0xf4</span><span class="op" id="1767331">,</span>&nbsp;<span class="num" id="1767333">0xf5</span><span class="op" id="1767337">,</span>&nbsp;<span class="num" id="1767339">0xf6</span><span class="op" id="1767343">,</span>&nbsp;<span class="num" id="1767345">0xf7</span><span class="op" id="1767349">,</span>&nbsp;<span class="num" id="1767351">0xf8</span><span class="op" id="1767355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767360">0xf9</span><span class="op" id="1767364">,</span>&nbsp;<span class="num" id="1767366">0xfa</span><span class="op" id="1767370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767374">}</span><span class="op" id="1767375">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767378">}</span><span class="op" id="1767379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1767382">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767406">[</span><span class="num" id="1767407">16</span><span class="op" id="1767409">]</span><span class="builtintype" id="1767410">byte</span><span class="op" id="1767414">{</span><span class="num" id="1767415">0</span><span class="op" id="1767416">,</span>&nbsp;<span class="num" id="1767418">3</span><span class="op" id="1767419">,</span>&nbsp;<span class="num" id="1767421">1</span><span class="op" id="1767422">,</span>&nbsp;<span class="num" id="1767424">1</span><span class="op" id="1767425">,</span>&nbsp;<span class="num" id="1767427">1</span><span class="op" id="1767428">,</span>&nbsp;<span class="num" id="1767430">1</span><span class="op" id="1767431">,</span>&nbsp;<span class="num" id="1767433">1</span><span class="op" id="1767434">,</span>&nbsp;<span class="num" id="1767436">1</span><span class="op" id="1767437">,</span>&nbsp;<span class="num" id="1767439">1</span><span class="op" id="1767440">,</span>&nbsp;<span class="num" id="1767442">1</span><span class="op" id="1767443">,</span>&nbsp;<span class="num" id="1767445">1</span><span class="op" id="1767446">,</span>&nbsp;<span class="num" id="1767448">0</span><span class="op" id="1767449">,</span>&nbsp;<span class="num" id="1767451">0</span><span class="op" id="1767452">,</span>&nbsp;<span class="num" id="1767454">0</span><span class="op" id="1767455">,</span>&nbsp;<span class="num" id="1767457">0</span><span class="op" id="1767458">,</span>&nbsp;<span class="num" id="1767460">0</span><span class="op" id="1767461">}</span><span class="op" id="1767462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767466">[</span><span class="op" id="1767467">]</span><span class="builtintype" id="1767468">byte</span><span class="op" id="1767472">{</span><span class="num" id="1767473">0</span><span class="op" id="1767474">,</span>&nbsp;<span class="num" id="1767476">1</span><span class="op" id="1767477">,</span>&nbsp;<span class="num" id="1767479">2</span><span class="op" id="1767480">,</span>&nbsp;<span class="num" id="1767482">3</span><span class="op" id="1767483">,</span>&nbsp;<span class="num" id="1767485">4</span><span class="op" id="1767486">,</span>&nbsp;<span class="num" id="1767488">5</span><span class="op" id="1767489">,</span>&nbsp;<span class="num" id="1767491">6</span><span class="op" id="1767492">,</span>&nbsp;<span class="num" id="1767494">7</span><span class="op" id="1767495">,</span>&nbsp;<span class="num" id="1767497">8</span><span class="op" id="1767498">,</span>&nbsp;<span class="num" id="1767500">9</span><span class="op" id="1767501">,</span>&nbsp;<span class="num" id="1767503">10</span><span class="op" id="1767505">,</span>&nbsp;<span class="num" id="1767507">11</span><span class="op" id="1767509">}</span><span class="op" id="1767510">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767513">}</span><span class="op" id="1767514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1767517">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767541">[</span><span class="num" id="1767542">16</span><span class="op" id="1767544">]</span><span class="builtintype" id="1767545">byte</span><span class="op" id="1767549">{</span><span class="num" id="1767550">0</span><span class="op" id="1767551">,</span>&nbsp;<span class="num" id="1767553">2</span><span class="op" id="1767554">,</span>&nbsp;<span class="num" id="1767556">1</span><span class="op" id="1767557">,</span>&nbsp;<span class="num" id="1767559">2</span><span class="op" id="1767560">,</span>&nbsp;<span class="num" id="1767562">4</span><span class="op" id="1767563">,</span>&nbsp;<span class="num" id="1767565">4</span><span class="op" id="1767566">,</span>&nbsp;<span class="num" id="1767568">3</span><span class="op" id="1767569">,</span>&nbsp;<span class="num" id="1767571">4</span><span class="op" id="1767572">,</span>&nbsp;<span class="num" id="1767574">7</span><span class="op" id="1767575">,</span>&nbsp;<span class="num" id="1767577">5</span><span class="op" id="1767578">,</span>&nbsp;<span class="num" id="1767580">4</span><span class="op" id="1767581">,</span>&nbsp;<span class="num" id="1767583">4</span><span class="op" id="1767584">,</span>&nbsp;<span class="num" id="1767586">0</span><span class="op" id="1767587">,</span>&nbsp;<span class="num" id="1767589">1</span><span class="op" id="1767590">,</span>&nbsp;<span class="num" id="1767592">2</span><span class="op" id="1767593">,</span>&nbsp;<span class="num" id="1767595">119</span><span class="op" id="1767598">}</span><span class="op" id="1767599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767603">[</span><span class="op" id="1767604">]</span><span class="builtintype" id="1767605">byte</span><span class="op" id="1767609">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767614">0x00</span><span class="op" id="1767618">,</span>&nbsp;<span class="num" id="1767620">0x01</span><span class="op" id="1767624">,</span>&nbsp;<span class="num" id="1767626">0x02</span><span class="op" id="1767630">,</span>&nbsp;<span class="num" id="1767632">0x03</span><span class="op" id="1767636">,</span>&nbsp;<span class="num" id="1767638">0x11</span><span class="op" id="1767642">,</span>&nbsp;<span class="num" id="1767644">0x04</span><span class="op" id="1767648">,</span>&nbsp;<span class="num" id="1767650">0x05</span><span class="op" id="1767654">,</span>&nbsp;<span class="num" id="1767656">0x21</span><span class="op" id="1767660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767665">0x31</span><span class="op" id="1767669">,</span>&nbsp;<span class="num" id="1767671">0x06</span><span class="op" id="1767675">,</span>&nbsp;<span class="num" id="1767677">0x12</span><span class="op" id="1767681">,</span>&nbsp;<span class="num" id="1767683">0x41</span><span class="op" id="1767687">,</span>&nbsp;<span class="num" id="1767689">0x51</span><span class="op" id="1767693">,</span>&nbsp;<span class="num" id="1767695">0x07</span><span class="op" id="1767699">,</span>&nbsp;<span class="num" id="1767701">0x61</span><span class="op" id="1767705">,</span>&nbsp;<span class="num" id="1767707">0x71</span><span class="op" id="1767711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767716">0x13</span><span class="op" id="1767720">,</span>&nbsp;<span class="num" id="1767722">0x22</span><span class="op" id="1767726">,</span>&nbsp;<span class="num" id="1767728">0x32</span><span class="op" id="1767732">,</span>&nbsp;<span class="num" id="1767734">0x81</span><span class="op" id="1767738">,</span>&nbsp;<span class="num" id="1767740">0x08</span><span class="op" id="1767744">,</span>&nbsp;<span class="num" id="1767746">0x14</span><span class="op" id="1767750">,</span>&nbsp;<span class="num" id="1767752">0x42</span><span class="op" id="1767756">,</span>&nbsp;<span class="num" id="1767758">0x91</span><span class="op" id="1767762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767767">0xa1</span><span class="op" id="1767771">,</span>&nbsp;<span class="num" id="1767773">0xb1</span><span class="op" id="1767777">,</span>&nbsp;<span class="num" id="1767779">0xc1</span><span class="op" id="1767783">,</span>&nbsp;<span class="num" id="1767785">0x09</span><span class="op" id="1767789">,</span>&nbsp;<span class="num" id="1767791">0x23</span><span class="op" id="1767795">,</span>&nbsp;<span class="num" id="1767797">0x33</span><span class="op" id="1767801">,</span>&nbsp;<span class="num" id="1767803">0x52</span><span class="op" id="1767807">,</span>&nbsp;<span class="num" id="1767809">0xf0</span><span class="op" id="1767813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767818">0x15</span><span class="op" id="1767822">,</span>&nbsp;<span class="num" id="1767824">0x62</span><span class="op" id="1767828">,</span>&nbsp;<span class="num" id="1767830">0x72</span><span class="op" id="1767834">,</span>&nbsp;<span class="num" id="1767836">0xd1</span><span class="op" id="1767840">,</span>&nbsp;<span class="num" id="1767842">0x0a</span><span class="op" id="1767846">,</span>&nbsp;<span class="num" id="1767848">0x16</span><span class="op" id="1767852">,</span>&nbsp;<span class="num" id="1767854">0x24</span><span class="op" id="1767858">,</span>&nbsp;<span class="num" id="1767860">0x34</span><span class="op" id="1767864">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767869">0xe1</span><span class="op" id="1767873">,</span>&nbsp;<span class="num" id="1767875">0x25</span><span class="op" id="1767879">,</span>&nbsp;<span class="num" id="1767881">0xf1</span><span class="op" id="1767885">,</span>&nbsp;<span class="num" id="1767887">0x17</span><span class="op" id="1767891">,</span>&nbsp;<span class="num" id="1767893">0x18</span><span class="op" id="1767897">,</span>&nbsp;<span class="num" id="1767899">0x19</span><span class="op" id="1767903">,</span>&nbsp;<span class="num" id="1767905">0x1a</span><span class="op" id="1767909">,</span>&nbsp;<span class="num" id="1767911">0x26</span><span class="op" id="1767915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767920">0x27</span><span class="op" id="1767924">,</span>&nbsp;<span class="num" id="1767926">0x28</span><span class="op" id="1767930">,</span>&nbsp;<span class="num" id="1767932">0x29</span><span class="op" id="1767936">,</span>&nbsp;<span class="num" id="1767938">0x2a</span><span class="op" id="1767942">,</span>&nbsp;<span class="num" id="1767944">0x35</span><span class="op" id="1767948">,</span>&nbsp;<span class="num" id="1767950">0x36</span><span class="op" id="1767954">,</span>&nbsp;<span class="num" id="1767956">0x37</span><span class="op" id="1767960">,</span>&nbsp;<span class="num" id="1767962">0x38</span><span class="op" id="1767966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1767971">0x39</span><span class="op" id="1767975">,</span>&nbsp;<span class="num" id="1767977">0x3a</span><span class="op" id="1767981">,</span>&nbsp;<span class="num" id="1767983">0x43</span><span class="op" id="1767987">,</span>&nbsp;<span class="num" id="1767989">0x44</span><span class="op" id="1767993">,</span>&nbsp;<span class="num" id="1767995">0x45</span><span class="op" id="1767999">,</span>&nbsp;<span class="num" id="1768001">0x46</span><span class="op" id="1768005">,</span>&nbsp;<span class="num" id="1768007">0x47</span><span class="op" id="1768011">,</span>&nbsp;<span class="num" id="1768013">0x48</span><span class="op" id="1768017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768022">0x49</span><span class="op" id="1768026">,</span>&nbsp;<span class="num" id="1768028">0x4a</span><span class="op" id="1768032">,</span>&nbsp;<span class="num" id="1768034">0x53</span><span class="op" id="1768038">,</span>&nbsp;<span class="num" id="1768040">0x54</span><span class="op" id="1768044">,</span>&nbsp;<span class="num" id="1768046">0x55</span><span class="op" id="1768050">,</span>&nbsp;<span class="num" id="1768052">0x56</span><span class="op" id="1768056">,</span>&nbsp;<span class="num" id="1768058">0x57</span><span class="op" id="1768062">,</span>&nbsp;<span class="num" id="1768064">0x58</span><span class="op" id="1768068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768073">0x59</span><span class="op" id="1768077">,</span>&nbsp;<span class="num" id="1768079">0x5a</span><span class="op" id="1768083">,</span>&nbsp;<span class="num" id="1768085">0x63</span><span class="op" id="1768089">,</span>&nbsp;<span class="num" id="1768091">0x64</span><span class="op" id="1768095">,</span>&nbsp;<span class="num" id="1768097">0x65</span><span class="op" id="1768101">,</span>&nbsp;<span class="num" id="1768103">0x66</span><span class="op" id="1768107">,</span>&nbsp;<span class="num" id="1768109">0x67</span><span class="op" id="1768113">,</span>&nbsp;<span class="num" id="1768115">0x68</span><span class="op" id="1768119">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768124">0x69</span><span class="op" id="1768128">,</span>&nbsp;<span class="num" id="1768130">0x6a</span><span class="op" id="1768134">,</span>&nbsp;<span class="num" id="1768136">0x73</span><span class="op" id="1768140">,</span>&nbsp;<span class="num" id="1768142">0x74</span><span class="op" id="1768146">,</span>&nbsp;<span class="num" id="1768148">0x75</span><span class="op" id="1768152">,</span>&nbsp;<span class="num" id="1768154">0x76</span><span class="op" id="1768158">,</span>&nbsp;<span class="num" id="1768160">0x77</span><span class="op" id="1768164">,</span>&nbsp;<span class="num" id="1768166">0x78</span><span class="op" id="1768170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768175">0x79</span><span class="op" id="1768179">,</span>&nbsp;<span class="num" id="1768181">0x7a</span><span class="op" id="1768185">,</span>&nbsp;<span class="num" id="1768187">0x82</span><span class="op" id="1768191">,</span>&nbsp;<span class="num" id="1768193">0x83</span><span class="op" id="1768197">,</span>&nbsp;<span class="num" id="1768199">0x84</span><span class="op" id="1768203">,</span>&nbsp;<span class="num" id="1768205">0x85</span><span class="op" id="1768209">,</span>&nbsp;<span class="num" id="1768211">0x86</span><span class="op" id="1768215">,</span>&nbsp;<span class="num" id="1768217">0x87</span><span class="op" id="1768221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768226">0x88</span><span class="op" id="1768230">,</span>&nbsp;<span class="num" id="1768232">0x89</span><span class="op" id="1768236">,</span>&nbsp;<span class="num" id="1768238">0x8a</span><span class="op" id="1768242">,</span>&nbsp;<span class="num" id="1768244">0x92</span><span class="op" id="1768248">,</span>&nbsp;<span class="num" id="1768250">0x93</span><span class="op" id="1768254">,</span>&nbsp;<span class="num" id="1768256">0x94</span><span class="op" id="1768260">,</span>&nbsp;<span class="num" id="1768262">0x95</span><span class="op" id="1768266">,</span>&nbsp;<span class="num" id="1768268">0x96</span><span class="op" id="1768272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768277">0x97</span><span class="op" id="1768281">,</span>&nbsp;<span class="num" id="1768283">0x98</span><span class="op" id="1768287">,</span>&nbsp;<span class="num" id="1768289">0x99</span><span class="op" id="1768293">,</span>&nbsp;<span class="num" id="1768295">0x9a</span><span class="op" id="1768299">,</span>&nbsp;<span class="num" id="1768301">0xa2</span><span class="op" id="1768305">,</span>&nbsp;<span class="num" id="1768307">0xa3</span><span class="op" id="1768311">,</span>&nbsp;<span class="num" id="1768313">0xa4</span><span class="op" id="1768317">,</span>&nbsp;<span class="num" id="1768319">0xa5</span><span class="op" id="1768323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768328">0xa6</span><span class="op" id="1768332">,</span>&nbsp;<span class="num" id="1768334">0xa7</span><span class="op" id="1768338">,</span>&nbsp;<span class="num" id="1768340">0xa8</span><span class="op" id="1768344">,</span>&nbsp;<span class="num" id="1768346">0xa9</span><span class="op" id="1768350">,</span>&nbsp;<span class="num" id="1768352">0xaa</span><span class="op" id="1768356">,</span>&nbsp;<span class="num" id="1768358">0xb2</span><span class="op" id="1768362">,</span>&nbsp;<span class="num" id="1768364">0xb3</span><span class="op" id="1768368">,</span>&nbsp;<span class="num" id="1768370">0xb4</span><span class="op" id="1768374">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768379">0xb5</span><span class="op" id="1768383">,</span>&nbsp;<span class="num" id="1768385">0xb6</span><span class="op" id="1768389">,</span>&nbsp;<span class="num" id="1768391">0xb7</span><span class="op" id="1768395">,</span>&nbsp;<span class="num" id="1768397">0xb8</span><span class="op" id="1768401">,</span>&nbsp;<span class="num" id="1768403">0xb9</span><span class="op" id="1768407">,</span>&nbsp;<span class="num" id="1768409">0xba</span><span class="op" id="1768413">,</span>&nbsp;<span class="num" id="1768415">0xc2</span><span class="op" id="1768419">,</span>&nbsp;<span class="num" id="1768421">0xc3</span><span class="op" id="1768425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768430">0xc4</span><span class="op" id="1768434">,</span>&nbsp;<span class="num" id="1768436">0xc5</span><span class="op" id="1768440">,</span>&nbsp;<span class="num" id="1768442">0xc6</span><span class="op" id="1768446">,</span>&nbsp;<span class="num" id="1768448">0xc7</span><span class="op" id="1768452">,</span>&nbsp;<span class="num" id="1768454">0xc8</span><span class="op" id="1768458">,</span>&nbsp;<span class="num" id="1768460">0xc9</span><span class="op" id="1768464">,</span>&nbsp;<span class="num" id="1768466">0xca</span><span class="op" id="1768470">,</span>&nbsp;<span class="num" id="1768472">0xd2</span><span class="op" id="1768476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768481">0xd3</span><span class="op" id="1768485">,</span>&nbsp;<span class="num" id="1768487">0xd4</span><span class="op" id="1768491">,</span>&nbsp;<span class="num" id="1768493">0xd5</span><span class="op" id="1768497">,</span>&nbsp;<span class="num" id="1768499">0xd6</span><span class="op" id="1768503">,</span>&nbsp;<span class="num" id="1768505">0xd7</span><span class="op" id="1768509">,</span>&nbsp;<span class="num" id="1768511">0xd8</span><span class="op" id="1768515">,</span>&nbsp;<span class="num" id="1768517">0xd9</span><span class="op" id="1768521">,</span>&nbsp;<span class="num" id="1768523">0xda</span><span class="op" id="1768527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768532">0xe2</span><span class="op" id="1768536">,</span>&nbsp;<span class="num" id="1768538">0xe3</span><span class="op" id="1768542">,</span>&nbsp;<span class="num" id="1768544">0xe4</span><span class="op" id="1768548">,</span>&nbsp;<span class="num" id="1768550">0xe5</span><span class="op" id="1768554">,</span>&nbsp;<span class="num" id="1768556">0xe6</span><span class="op" id="1768560">,</span>&nbsp;<span class="num" id="1768562">0xe7</span><span class="op" id="1768566">,</span>&nbsp;<span class="num" id="1768568">0xe8</span><span class="op" id="1768572">,</span>&nbsp;<span class="num" id="1768574">0xe9</span><span class="op" id="1768578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768583">0xea</span><span class="op" id="1768587">,</span>&nbsp;<span class="num" id="1768589">0xf2</span><span class="op" id="1768593">,</span>&nbsp;<span class="num" id="1768595">0xf3</span><span class="op" id="1768599">,</span>&nbsp;<span class="num" id="1768601">0xf4</span><span class="op" id="1768605">,</span>&nbsp;<span class="num" id="1768607">0xf5</span><span class="op" id="1768611">,</span>&nbsp;<span class="num" id="1768613">0xf6</span><span class="op" id="1768617">,</span>&nbsp;<span class="num" id="1768619">0xf7</span><span class="op" id="1768623">,</span>&nbsp;<span class="num" id="1768625">0xf8</span><span class="op" id="1768629">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1768634">0xf9</span><span class="op" id="1768638">,</span>&nbsp;<span class="num" id="1768640">0xfa</span><span class="op" id="1768644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1768648">}</span><span class="op" id="1768649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1768652">}</span><span class="op" id="1768653">,</span><br>
<span class="lineno"></span><span class="op" id="1768655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="1768658">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="1768733">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1768810">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="1768888">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="1768929">type</span>&nbsp;<span class="ident" id="1768934">huffmanLUT</span>&nbsp;<span class="op" id="1768945">[</span><span class="op" id="1768946">]</span><span class="builtintype" id="1768947">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="1768955">func</span>&nbsp;<span class="op" id="1768960">(</span><span class="ident" id="1768961">h</span>&nbsp;<span class="op" id="1768963">*</span><span class="ident" id="1768964">huffmanLUT</span><span class="op" id="1768974">)</span>&nbsp;<span class="ident" id="1768976">init</span><span class="op" id="1768980">(</span><span class="ident" id="1768981">s</span>&nbsp;<span class="ident" id="1768983">huffmanSpec</span><span class="op" id="1768994">)</span>&nbsp;<span class="op" id="1768996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1768999">maxValue</span>&nbsp;<span class="op" id="1769008">:=</span>&nbsp;<span class="num" id="1769011">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1769014">for</span>&nbsp;<span class="ident" id="1769018">_</span><span class="op" id="1769019">,</span>&nbsp;<span class="ident" id="1769021">v</span>&nbsp;<span class="op" id="1769023">:=</span>&nbsp;<span class="keyword" id="1769026">range</span>&nbsp;<span class="ident" id="1769032">s</span><span class="op" id="1769033">.</span><span class="ident" id="1769034">value</span>&nbsp;<span class="op" id="1769040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1769044">if</span>&nbsp;<span class="builtintype" id="1769047">int</span><span class="op" id="1769050">(</span><span class="ident" id="1769051">v</span><span class="op" id="1769052">)</span>&nbsp;<span class="op" id="1769054">&gt;</span>&nbsp;<span class="ident" id="1769056">maxValue</span>&nbsp;<span class="op" id="1769065">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769070">maxValue</span>&nbsp;<span class="op" id="1769079">=</span>&nbsp;<span class="builtintype" id="1769081">int</span><span class="op" id="1769084">(</span><span class="ident" id="1769085">v</span><span class="op" id="1769086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1769090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1769093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1769096">*</span><span class="ident" id="1769097">h</span>&nbsp;<span class="op" id="1769099">=</span>&nbsp;<span class="builtinfunc" id="1769101">make</span><span class="op" id="1769105">(</span><span class="op" id="1769106">[</span><span class="op" id="1769107">]</span><span class="builtintype" id="1769108">uint32</span><span class="op" id="1769114">,</span>&nbsp;<span class="ident" id="1769116">maxValue</span><span class="op" id="1769124">+</span><span class="num" id="1769125">1</span><span class="op" id="1769126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769129">code</span><span class="op" id="1769133">,</span>&nbsp;<span class="ident" id="1769135">k</span>&nbsp;<span class="op" id="1769137">:=</span>&nbsp;<span class="builtintype" id="1769140">uint32</span><span class="op" id="1769146">(</span><span class="num" id="1769147">0</span><span class="op" id="1769148">)</span><span class="op" id="1769149">,</span>&nbsp;<span class="num" id="1769151">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1769154">for</span>&nbsp;<span class="ident" id="1769158">i</span>&nbsp;<span class="op" id="1769160">:=</span>&nbsp;<span class="num" id="1769163">0</span><span class="op" id="1769164">;</span>&nbsp;<span class="ident" id="1769166">i</span>&nbsp;<span class="op" id="1769168">&lt;</span>&nbsp;<span class="builtinfunc" id="1769170">len</span><span class="op" id="1769173">(</span><span class="ident" id="1769174">s</span><span class="op" id="1769175">.</span><span class="ident" id="1769176">count</span><span class="op" id="1769181">)</span><span class="op" id="1769182">;</span>&nbsp;<span class="ident" id="1769184">i</span><span class="op" id="1769185">++</span>&nbsp;<span class="op" id="1769188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769192">nBits</span>&nbsp;<span class="op" id="1769198">:=</span>&nbsp;<span class="builtintype" id="1769201">uint32</span><span class="op" id="1769207">(</span><span class="ident" id="1769208">i</span><span class="op" id="1769209">+</span><span class="num" id="1769210">1</span><span class="op" id="1769211">)</span>&nbsp;<span class="op" id="1769213">&lt;&lt;</span>&nbsp;<span class="num" id="1769216">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1769221">for</span>&nbsp;<span class="ident" id="1769225">j</span>&nbsp;<span class="op" id="1769227">:=</span>&nbsp;<span class="builtintype" id="1769230">uint8</span><span class="op" id="1769235">(</span><span class="num" id="1769236">0</span><span class="op" id="1769237">)</span><span class="op" id="1769238">;</span>&nbsp;<span class="ident" id="1769240">j</span>&nbsp;<span class="op" id="1769242">&lt;</span>&nbsp;<span class="ident" id="1769244">s</span><span class="op" id="1769245">.</span><span class="ident" id="1769246">count</span><span class="op" id="1769251">[</span><span class="ident" id="1769252">i</span><span class="op" id="1769253">]</span><span class="op" id="1769254">;</span>&nbsp;<span class="ident" id="1769256">j</span><span class="op" id="1769257">++</span>&nbsp;<span class="op" id="1769260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1769265">(</span><span class="op" id="1769266">*</span><span class="ident" id="1769267">h</span><span class="op" id="1769268">)</span><span class="op" id="1769269">[</span><span class="ident" id="1769270">s</span><span class="op" id="1769271">.</span><span class="ident" id="1769272">value</span><span class="op" id="1769277">[</span><span class="ident" id="1769278">k</span><span class="op" id="1769279">]</span><span class="op" id="1769280">]</span>&nbsp;<span class="op" id="1769282">=</span>&nbsp;<span class="ident" id="1769284">nBits</span>&nbsp;<span class="op" id="1769290">|</span>&nbsp;<span class="ident" id="1769292">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769300">code</span><span class="op" id="1769304">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769310">k</span><span class="op" id="1769311">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1769316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769320">code</span>&nbsp;<span class="op" id="1769325">&lt;&lt;=</span>&nbsp;<span class="num" id="1769329">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1769332">}</span><br>
<span class="lineno"></span><span class="op" id="1769334">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="1769337">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="1769402">var</span>&nbsp;<span class="ident" id="1769406">theHuffmanLUT</span>&nbsp;<span class="op" id="1769420">[</span><span class="num" id="1769421">4</span><span class="op" id="1769422">]</span><span class="ident" id="1769423">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1769435">func</span>&nbsp;<span class="ident" id="1769440">init</span><span class="op" id="1769444">(</span><span class="op" id="1769445">)</span>&nbsp;<span class="op" id="1769447">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1769450">for</span>&nbsp;<span class="ident" id="1769454">i</span><span class="op" id="1769455">,</span>&nbsp;<span class="ident" id="1769457">s</span>&nbsp;<span class="op" id="1769459">:=</span>&nbsp;<span class="keyword" id="1769462">range</span>&nbsp;<span class="ident" id="1769468">theHuffmanSpec</span>&nbsp;<span class="op" id="1769483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769487">theHuffmanLUT</span><span class="op" id="1769500">[</span><span class="ident" id="1769501">i</span><span class="op" id="1769502">]</span><span class="op" id="1769503">.</span><span class="ident" id="1769504">init</span><span class="op" id="1769508">(</span><span class="ident" id="1769509">s</span><span class="op" id="1769510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1769513">}</span><br>
<span class="lineno"></span><span class="op" id="1769515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="1769518">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="1769550">type</span>&nbsp;<span class="ident" id="1769555">writer</span>&nbsp;<span class="keyword" id="1769562">interface</span>&nbsp;<span class="op" id="1769572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769575">Flush</span><span class="op" id="1769580">(</span><span class="op" id="1769581">)</span>&nbsp;<span class="builtintype" id="1769583">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769590">io</span><span class="op" id="1769592">.</span><span class="ident" id="1769593">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769601">io</span><span class="op" id="1769603">.</span><span class="ident" id="1769604">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="1769615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1769618">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="1769666">type</span>&nbsp;<span class="ident" id="1769671">encoder</span>&nbsp;<span class="keyword" id="1769679">struct</span>&nbsp;<span class="op" id="1769686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1769689">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1769764">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769835">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1769839">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769847">err</span>&nbsp;<span class="builtintype" id="1769851">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1769858">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769887">buf</span>&nbsp;<span class="op" id="1769891">[</span><span class="num" id="1769892">16</span><span class="op" id="1769894">]</span><span class="builtintype" id="1769895">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1769901">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769956">bits</span><span class="op" id="1769960">,</span>&nbsp;<span class="ident" id="1769962">nBits</span>&nbsp;<span class="builtintype" id="1769968">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1769976">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770039">quant</span>&nbsp;<span class="op" id="1770045">[</span><span class="ident" id="1770046">nQuantIndex</span><span class="op" id="1770057">]</span><span class="op" id="1770058">[</span><span class="ident" id="1770059">blockSize</span><span class="op" id="1770068">]</span><span class="builtintype" id="1770069">byte</span><br>
<span class="lineno"></span><span class="op" id="1770074">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="1770077">func</span>&nbsp;<span class="op" id="1770082">(</span><span class="ident" id="1770083">e</span>&nbsp;<span class="op" id="1770085">*</span><span class="ident" id="1770086">encoder</span><span class="op" id="1770093">)</span>&nbsp;<span class="ident" id="1770095">flush</span><span class="op" id="1770100">(</span><span class="op" id="1770101">)</span>&nbsp;<span class="op" id="1770103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770106">if</span>&nbsp;<span class="ident" id="1770109">e</span><span class="op" id="1770110">.</span><span class="ident" id="1770111">err</span>&nbsp;<span class="op" id="1770115">!=</span>&nbsp;<span class="builtintype" id="1770118">nil</span>&nbsp;<span class="op" id="1770122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770126">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770134">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770137">e</span><span class="op" id="1770138">.</span><span class="ident" id="1770139">err</span>&nbsp;<span class="op" id="1770143">=</span>&nbsp;<span class="ident" id="1770145">e</span><span class="op" id="1770146">.</span><span class="ident" id="1770147">w</span><span class="op" id="1770148">.</span><span class="ident" id="1770149">Flush</span><span class="op" id="1770154">(</span><span class="op" id="1770155">)</span><br>
<span class="lineno"></span><span class="op" id="1770157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1770160">func</span>&nbsp;<span class="op" id="1770165">(</span><span class="ident" id="1770166">e</span>&nbsp;<span class="op" id="1770168">*</span><span class="ident" id="1770169">encoder</span><span class="op" id="1770176">)</span>&nbsp;<span class="ident" id="1770178">write</span><span class="op" id="1770183">(</span><span class="ident" id="1770184">p</span>&nbsp;<span class="op" id="1770186">[</span><span class="op" id="1770187">]</span><span class="builtintype" id="1770188">byte</span><span class="op" id="1770192">)</span>&nbsp;<span class="op" id="1770194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770197">if</span>&nbsp;<span class="ident" id="1770200">e</span><span class="op" id="1770201">.</span><span class="ident" id="1770202">err</span>&nbsp;<span class="op" id="1770206">!=</span>&nbsp;<span class="builtintype" id="1770209">nil</span>&nbsp;<span class="op" id="1770213">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770217">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770228">_</span><span class="op" id="1770229">,</span>&nbsp;<span class="ident" id="1770231">e</span><span class="op" id="1770232">.</span><span class="ident" id="1770233">err</span>&nbsp;<span class="op" id="1770237">=</span>&nbsp;<span class="ident" id="1770239">e</span><span class="op" id="1770240">.</span><span class="ident" id="1770241">w</span><span class="op" id="1770242">.</span><span class="ident" id="1770243">Write</span><span class="op" id="1770248">(</span><span class="ident" id="1770249">p</span><span class="op" id="1770250">)</span><br>
<span class="lineno"></span><span class="op" id="1770252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="1770255">func</span>&nbsp;<span class="op" id="1770260">(</span><span class="ident" id="1770261">e</span>&nbsp;<span class="op" id="1770263">*</span><span class="ident" id="1770264">encoder</span><span class="op" id="1770271">)</span>&nbsp;<span class="ident" id="1770273">writeByte</span><span class="op" id="1770282">(</span><span class="ident" id="1770283">b</span>&nbsp;<span class="builtintype" id="1770285">byte</span><span class="op" id="1770289">)</span>&nbsp;<span class="op" id="1770291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770294">if</span>&nbsp;<span class="ident" id="1770297">e</span><span class="op" id="1770298">.</span><span class="ident" id="1770299">err</span>&nbsp;<span class="op" id="1770303">!=</span>&nbsp;<span class="builtintype" id="1770306">nil</span>&nbsp;<span class="op" id="1770310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770314">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770325">e</span><span class="op" id="1770326">.</span><span class="ident" id="1770327">err</span>&nbsp;<span class="op" id="1770331">=</span>&nbsp;<span class="ident" id="1770333">e</span><span class="op" id="1770334">.</span><span class="ident" id="1770335">w</span><span class="op" id="1770336">.</span><span class="ident" id="1770337">WriteByte</span><span class="op" id="1770346">(</span><span class="ident" id="1770347">b</span><span class="op" id="1770348">)</span><br>
<span class="lineno">250</span><span class="op" id="1770350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1770353">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="1770427">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="1770482">func</span>&nbsp;<span class="op" id="1770487">(</span><span class="ident" id="1770488">e</span>&nbsp;<span class="op" id="1770490">*</span><span class="ident" id="1770491">encoder</span><span class="op" id="1770498">)</span>&nbsp;<span class="ident" id="1770500">emit</span><span class="op" id="1770504">(</span><span class="ident" id="1770505">bits</span><span class="op" id="1770509">,</span>&nbsp;<span class="ident" id="1770511">nBits</span>&nbsp;<span class="builtintype" id="1770517">uint32</span><span class="op" id="1770523">)</span>&nbsp;<span class="op" id="1770525">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770528">nBits</span>&nbsp;<span class="op" id="1770534">+=</span>&nbsp;<span class="ident" id="1770537">e</span><span class="op" id="1770538">.</span><span class="ident" id="1770539">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770546">bits</span>&nbsp;<span class="op" id="1770551">&lt;&lt;=</span>&nbsp;<span class="num" id="1770555">32</span>&nbsp;<span class="op" id="1770558">-</span>&nbsp;<span class="ident" id="1770560">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770567">bits</span>&nbsp;<span class="op" id="1770572">|=</span>&nbsp;<span class="ident" id="1770575">e</span><span class="op" id="1770576">.</span><span class="ident" id="1770577">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770583">for</span>&nbsp;<span class="ident" id="1770587">nBits</span>&nbsp;<span class="op" id="1770593">&gt;=</span>&nbsp;<span class="num" id="1770596">8</span>&nbsp;<span class="op" id="1770598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770602">b</span>&nbsp;<span class="op" id="1770604">:=</span>&nbsp;<span class="builtintype" id="1770607">uint8</span><span class="op" id="1770612">(</span><span class="ident" id="1770613">bits</span>&nbsp;<span class="op" id="1770618">&gt;&gt;</span>&nbsp;<span class="num" id="1770621">24</span><span class="op" id="1770623">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770627">e</span><span class="op" id="1770628">.</span><span class="ident" id="1770629">writeByte</span><span class="op" id="1770638">(</span><span class="ident" id="1770639">b</span><span class="op" id="1770640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770644">if</span>&nbsp;<span class="ident" id="1770647">b</span>&nbsp;<span class="op" id="1770649">==</span>&nbsp;<span class="num" id="1770652">0xff</span>&nbsp;<span class="op" id="1770657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770662">e</span><span class="op" id="1770663">.</span><span class="ident" id="1770664">writeByte</span><span class="op" id="1770673">(</span><span class="num" id="1770674">0x00</span><span class="op" id="1770678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770686">bits</span>&nbsp;<span class="op" id="1770691">&lt;&lt;=</span>&nbsp;<span class="num" id="1770695">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770699">nBits</span>&nbsp;<span class="op" id="1770705">-=</span>&nbsp;<span class="num" id="1770708">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770714">e</span><span class="op" id="1770715">.</span><span class="ident" id="1770716">bits</span><span class="op" id="1770720">,</span>&nbsp;<span class="ident" id="1770722">e</span><span class="op" id="1770723">.</span><span class="ident" id="1770724">nBits</span>&nbsp;<span class="op" id="1770730">=</span>&nbsp;<span class="ident" id="1770732">bits</span><span class="op" id="1770736">,</span>&nbsp;<span class="ident" id="1770738">nBits</span><br>
<span class="lineno"></span><span class="op" id="1770744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="1770747">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="1770813">func</span>&nbsp;<span class="op" id="1770818">(</span><span class="ident" id="1770819">e</span>&nbsp;<span class="op" id="1770821">*</span><span class="ident" id="1770822">encoder</span><span class="op" id="1770829">)</span>&nbsp;<span class="ident" id="1770831">emitHuff</span><span class="op" id="1770839">(</span><span class="ident" id="1770840">h</span>&nbsp;<span class="ident" id="1770842">huffIndex</span><span class="op" id="1770851">,</span>&nbsp;<span class="ident" id="1770853">value</span>&nbsp;<span class="builtintype" id="1770859">int32</span><span class="op" id="1770864">)</span>&nbsp;<span class="op" id="1770866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770869">x</span>&nbsp;<span class="op" id="1770871">:=</span>&nbsp;<span class="ident" id="1770874">theHuffmanLUT</span><span class="op" id="1770887">[</span><span class="ident" id="1770888">h</span><span class="op" id="1770889">]</span><span class="op" id="1770890">[</span><span class="ident" id="1770891">value</span><span class="op" id="1770896">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770899">e</span><span class="op" id="1770900">.</span><span class="ident" id="1770901">emit</span><span class="op" id="1770905">(</span><span class="ident" id="1770906">x</span><span class="op" id="1770907">&amp;</span><span class="op" id="1770908">(</span><span class="num" id="1770909">1</span><span class="op" id="1770910">&lt;&lt;</span><span class="num" id="1770912">24</span><span class="op" id="1770914">-</span><span class="num" id="1770915">1</span><span class="op" id="1770916">)</span><span class="op" id="1770917">,</span>&nbsp;<span class="ident" id="1770919">x</span><span class="op" id="1770920">&gt;&gt;</span><span class="num" id="1770922">24</span><span class="op" id="1770924">)</span><br>
<span class="lineno"></span><span class="op" id="1770926">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="1770929">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="1771008">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="1771028">func</span>&nbsp;<span class="op" id="1771033">(</span><span class="ident" id="1771034">e</span>&nbsp;<span class="op" id="1771036">*</span><span class="ident" id="1771037">encoder</span><span class="op" id="1771044">)</span>&nbsp;<span class="ident" id="1771046">emitHuffRLE</span><span class="op" id="1771057">(</span><span class="ident" id="1771058">h</span>&nbsp;<span class="ident" id="1771060">huffIndex</span><span class="op" id="1771069">,</span>&nbsp;<span class="ident" id="1771071">runLength</span><span class="op" id="1771080">,</span>&nbsp;<span class="ident" id="1771082">value</span>&nbsp;<span class="builtintype" id="1771088">int32</span><span class="op" id="1771093">)</span>&nbsp;<span class="op" id="1771095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771098">a</span><span class="op" id="1771099">,</span>&nbsp;<span class="ident" id="1771101">b</span>&nbsp;<span class="op" id="1771103">:=</span>&nbsp;<span class="ident" id="1771106">value</span><span class="op" id="1771111">,</span>&nbsp;<span class="ident" id="1771113">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771120">if</span>&nbsp;<span class="ident" id="1771123">a</span>&nbsp;<span class="op" id="1771125">&lt;</span>&nbsp;<span class="num" id="1771127">0</span>&nbsp;<span class="op" id="1771129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771133">a</span><span class="op" id="1771134">,</span>&nbsp;<span class="ident" id="1771136">b</span>&nbsp;<span class="op" id="1771138">=</span>&nbsp;<span class="op" id="1771140">-</span><span class="ident" id="1771141">value</span><span class="op" id="1771146">,</span>&nbsp;<span class="ident" id="1771148">value</span><span class="op" id="1771153">-</span><span class="num" id="1771154">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771160">var</span>&nbsp;<span class="ident" id="1771164">nBits</span>&nbsp;<span class="builtintype" id="1771170">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771178">if</span>&nbsp;<span class="ident" id="1771181">a</span>&nbsp;<span class="op" id="1771183">&lt;</span>&nbsp;<span class="num" id="1771185">0x100</span>&nbsp;<span class="op" id="1771191">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771195">nBits</span>&nbsp;<span class="op" id="1771201">=</span>&nbsp;<span class="builtintype" id="1771203">uint32</span><span class="op" id="1771209">(</span><span class="ident" id="1771210">bitCount</span><span class="op" id="1771218">[</span><span class="ident" id="1771219">a</span><span class="op" id="1771220">]</span><span class="op" id="1771221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771224">}</span>&nbsp;<span class="keyword" id="1771226">else</span>&nbsp;<span class="op" id="1771231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771235">nBits</span>&nbsp;<span class="op" id="1771241">=</span>&nbsp;<span class="num" id="1771243">8</span>&nbsp;<span class="op" id="1771245">+</span>&nbsp;<span class="builtintype" id="1771247">uint32</span><span class="op" id="1771253">(</span><span class="ident" id="1771254">bitCount</span><span class="op" id="1771262">[</span><span class="ident" id="1771263">a</span><span class="op" id="1771264">&gt;&gt;</span><span class="num" id="1771266">8</span><span class="op" id="1771267">]</span><span class="op" id="1771268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771274">e</span><span class="op" id="1771275">.</span><span class="ident" id="1771276">emitHuff</span><span class="op" id="1771284">(</span><span class="ident" id="1771285">h</span><span class="op" id="1771286">,</span>&nbsp;<span class="ident" id="1771288">runLength</span><span class="op" id="1771297">&lt;&lt;</span><span class="num" id="1771299">4</span><span class="op" id="1771300">|</span><span class="builtintype" id="1771301">int32</span><span class="op" id="1771306">(</span><span class="ident" id="1771307">nBits</span><span class="op" id="1771312">)</span><span class="op" id="1771313">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771316">if</span>&nbsp;<span class="ident" id="1771319">nBits</span>&nbsp;<span class="op" id="1771325">&gt;</span>&nbsp;<span class="num" id="1771327">0</span>&nbsp;<span class="op" id="1771329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771333">e</span><span class="op" id="1771334">.</span><span class="ident" id="1771335">emit</span><span class="op" id="1771339">(</span><span class="builtintype" id="1771340">uint32</span><span class="op" id="1771346">(</span><span class="ident" id="1771347">b</span><span class="op" id="1771348">)</span><span class="op" id="1771349">&amp;</span><span class="op" id="1771350">(</span><span class="num" id="1771351">1</span><span class="op" id="1771352">&lt;&lt;</span><span class="ident" id="1771354">nBits</span><span class="op" id="1771359">-</span><span class="num" id="1771360">1</span><span class="op" id="1771361">)</span><span class="op" id="1771362">,</span>&nbsp;<span class="ident" id="1771364">nBits</span><span class="op" id="1771369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771372">}</span><br>
<span class="lineno"></span><span class="op" id="1771374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="1771377">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="1771452">func</span>&nbsp;<span class="op" id="1771457">(</span><span class="ident" id="1771458">e</span>&nbsp;<span class="op" id="1771460">*</span><span class="ident" id="1771461">encoder</span><span class="op" id="1771468">)</span>&nbsp;<span class="ident" id="1771470">writeMarkerHeader</span><span class="op" id="1771487">(</span><span class="ident" id="1771488">marker</span>&nbsp;<span class="builtintype" id="1771495">uint8</span><span class="op" id="1771500">,</span>&nbsp;<span class="ident" id="1771502">markerlen</span>&nbsp;<span class="builtintype" id="1771512">int</span><span class="op" id="1771515">)</span>&nbsp;<span class="op" id="1771517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771520">e</span><span class="op" id="1771521">.</span><span class="ident" id="1771522">buf</span><span class="op" id="1771525">[</span><span class="num" id="1771526">0</span><span class="op" id="1771527">]</span>&nbsp;<span class="op" id="1771529">=</span>&nbsp;<span class="num" id="1771531">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771537">e</span><span class="op" id="1771538">.</span><span class="ident" id="1771539">buf</span><span class="op" id="1771542">[</span><span class="num" id="1771543">1</span><span class="op" id="1771544">]</span>&nbsp;<span class="op" id="1771546">=</span>&nbsp;<span class="ident" id="1771548">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771556">e</span><span class="op" id="1771557">.</span><span class="ident" id="1771558">buf</span><span class="op" id="1771561">[</span><span class="num" id="1771562">2</span><span class="op" id="1771563">]</span>&nbsp;<span class="op" id="1771565">=</span>&nbsp;<span class="builtintype" id="1771567">uint8</span><span class="op" id="1771572">(</span><span class="ident" id="1771573">markerlen</span>&nbsp;<span class="op" id="1771583">&gt;&gt;</span>&nbsp;<span class="num" id="1771586">8</span><span class="op" id="1771587">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771590">e</span><span class="op" id="1771591">.</span><span class="ident" id="1771592">buf</span><span class="op" id="1771595">[</span><span class="num" id="1771596">3</span><span class="op" id="1771597">]</span>&nbsp;<span class="op" id="1771599">=</span>&nbsp;<span class="builtintype" id="1771601">uint8</span><span class="op" id="1771606">(</span><span class="ident" id="1771607">markerlen</span>&nbsp;<span class="op" id="1771617">&amp;</span>&nbsp;<span class="num" id="1771619">0xff</span><span class="op" id="1771623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771626">e</span><span class="op" id="1771627">.</span><span class="ident" id="1771628">write</span><span class="op" id="1771633">(</span><span class="ident" id="1771634">e</span><span class="op" id="1771635">.</span><span class="ident" id="1771636">buf</span><span class="op" id="1771639">[</span><span class="op" id="1771640">:</span><span class="num" id="1771641">4</span><span class="op" id="1771642">]</span><span class="op" id="1771643">)</span><br>
<span class="lineno"></span><span class="op" id="1771645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1771648">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="1771705">func</span>&nbsp;<span class="op" id="1771710">(</span><span class="ident" id="1771711">e</span>&nbsp;<span class="op" id="1771713">*</span><span class="ident" id="1771714">encoder</span><span class="op" id="1771721">)</span>&nbsp;<span class="ident" id="1771723">writeDQT</span><span class="op" id="1771731">(</span><span class="op" id="1771732">)</span>&nbsp;<span class="op" id="1771734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771737">const</span>&nbsp;<span class="ident" id="1771743">markerlen</span>&nbsp;<span class="op" id="1771753">=</span>&nbsp;<span class="num" id="1771755">2</span>&nbsp;<span class="op" id="1771757">+</span>&nbsp;<span class="builtintype" id="1771759">int</span><span class="op" id="1771762">(</span><span class="ident" id="1771763">nQuantIndex</span><span class="op" id="1771774">)</span><span class="op" id="1771775">*</span><span class="op" id="1771776">(</span><span class="num" id="1771777">1</span><span class="op" id="1771778">+</span><span class="ident" id="1771779">blockSize</span><span class="op" id="1771788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771791">e</span><span class="op" id="1771792">.</span><span class="ident" id="1771793">writeMarkerHeader</span><span class="op" id="1771810">(</span><span class="ident" id="1771811">dqtMarker</span><span class="op" id="1771820">,</span>&nbsp;<span class="ident" id="1771822">markerlen</span><span class="op" id="1771831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771834">for</span>&nbsp;<span class="ident" id="1771838">i</span>&nbsp;<span class="op" id="1771840">:=</span>&nbsp;<span class="keyword" id="1771843">range</span>&nbsp;<span class="ident" id="1771849">e</span><span class="op" id="1771850">.</span><span class="ident" id="1771851">quant</span>&nbsp;<span class="op" id="1771857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771861">e</span><span class="op" id="1771862">.</span><span class="ident" id="1771863">writeByte</span><span class="op" id="1771872">(</span><span class="builtintype" id="1771873">uint8</span><span class="op" id="1771878">(</span><span class="ident" id="1771879">i</span><span class="op" id="1771880">)</span><span class="op" id="1771881">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771885">e</span><span class="op" id="1771886">.</span><span class="ident" id="1771887">write</span><span class="op" id="1771892">(</span><span class="ident" id="1771893">e</span><span class="op" id="1771894">.</span><span class="ident" id="1771895">quant</span><span class="op" id="1771900">[</span><span class="ident" id="1771901">i</span><span class="op" id="1771902">]</span><span class="op" id="1771903">[</span><span class="op" id="1771904">:</span><span class="op" id="1771905">]</span><span class="op" id="1771906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771909">}</span><br>
<span class="lineno"></span><span class="op" id="1771911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1771914">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="1771972">func</span>&nbsp;<span class="op" id="1771977">(</span><span class="ident" id="1771978">e</span>&nbsp;<span class="op" id="1771980">*</span><span class="ident" id="1771981">encoder</span><span class="op" id="1771988">)</span>&nbsp;<span class="ident" id="1771990">writeSOF0</span><span class="op" id="1771999">(</span><span class="ident" id="1772000">size</span>&nbsp;<span class="ident" id="1772005">image</span><span class="op" id="1772010">.</span><span class="ident" id="1772011">Point</span><span class="op" id="1772016">,</span>&nbsp;<span class="ident" id="1772018">nComponent</span>&nbsp;<span class="builtintype" id="1772029">int</span><span class="op" id="1772032">)</span>&nbsp;<span class="op" id="1772034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772037">markerlen</span>&nbsp;<span class="op" id="1772047">:=</span>&nbsp;<span class="num" id="1772050">8</span>&nbsp;<span class="op" id="1772052">+</span>&nbsp;<span class="num" id="1772054">3</span><span class="op" id="1772055">*</span><span class="ident" id="1772056">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772068">e</span><span class="op" id="1772069">.</span><span class="ident" id="1772070">writeMarkerHeader</span><span class="op" id="1772087">(</span><span class="ident" id="1772088">sof0Marker</span><span class="op" id="1772098">,</span>&nbsp;<span class="ident" id="1772100">markerlen</span><span class="op" id="1772109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772112">e</span><span class="op" id="1772113">.</span><span class="ident" id="1772114">buf</span><span class="op" id="1772117">[</span><span class="num" id="1772118">0</span><span class="op" id="1772119">]</span>&nbsp;<span class="op" id="1772121">=</span>&nbsp;<span class="num" id="1772123">8</span>&nbsp;<span class="comment" id="1772125">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772142">e</span><span class="op" id="1772143">.</span><span class="ident" id="1772144">buf</span><span class="op" id="1772147">[</span><span class="num" id="1772148">1</span><span class="op" id="1772149">]</span>&nbsp;<span class="op" id="1772151">=</span>&nbsp;<span class="builtintype" id="1772153">uint8</span><span class="op" id="1772158">(</span><span class="ident" id="1772159">size</span><span class="op" id="1772163">.</span><span class="ident" id="1772164">Y</span>&nbsp;<span class="op" id="1772166">&gt;&gt;</span>&nbsp;<span class="num" id="1772169">8</span><span class="op" id="1772170">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772173">e</span><span class="op" id="1772174">.</span><span class="ident" id="1772175">buf</span><span class="op" id="1772178">[</span><span class="num" id="1772179">2</span><span class="op" id="1772180">]</span>&nbsp;<span class="op" id="1772182">=</span>&nbsp;<span class="builtintype" id="1772184">uint8</span><span class="op" id="1772189">(</span><span class="ident" id="1772190">size</span><span class="op" id="1772194">.</span><span class="ident" id="1772195">Y</span>&nbsp;<span class="op" id="1772197">&amp;</span>&nbsp;<span class="num" id="1772199">0xff</span><span class="op" id="1772203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772206">e</span><span class="op" id="1772207">.</span><span class="ident" id="1772208">buf</span><span class="op" id="1772211">[</span><span class="num" id="1772212">3</span><span class="op" id="1772213">]</span>&nbsp;<span class="op" id="1772215">=</span>&nbsp;<span class="builtintype" id="1772217">uint8</span><span class="op" id="1772222">(</span><span class="ident" id="1772223">size</span><span class="op" id="1772227">.</span><span class="ident" id="1772228">X</span>&nbsp;<span class="op" id="1772230">&gt;&gt;</span>&nbsp;<span class="num" id="1772233">8</span><span class="op" id="1772234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772237">e</span><span class="op" id="1772238">.</span><span class="ident" id="1772239">buf</span><span class="op" id="1772242">[</span><span class="num" id="1772243">4</span><span class="op" id="1772244">]</span>&nbsp;<span class="op" id="1772246">=</span>&nbsp;<span class="builtintype" id="1772248">uint8</span><span class="op" id="1772253">(</span><span class="ident" id="1772254">size</span><span class="op" id="1772258">.</span><span class="ident" id="1772259">X</span>&nbsp;<span class="op" id="1772261">&amp;</span>&nbsp;<span class="num" id="1772263">0xff</span><span class="op" id="1772267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772270">e</span><span class="op" id="1772271">.</span><span class="ident" id="1772272">buf</span><span class="op" id="1772275">[</span><span class="num" id="1772276">5</span><span class="op" id="1772277">]</span>&nbsp;<span class="op" id="1772279">=</span>&nbsp;<span class="builtintype" id="1772281">uint8</span><span class="op" id="1772286">(</span><span class="ident" id="1772287">nComponent</span><span class="op" id="1772297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772300">if</span>&nbsp;<span class="ident" id="1772303">nComponent</span>&nbsp;<span class="op" id="1772314">==</span>&nbsp;<span class="num" id="1772317">1</span>&nbsp;<span class="op" id="1772319">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772323">e</span><span class="op" id="1772324">.</span><span class="ident" id="1772325">buf</span><span class="op" id="1772328">[</span><span class="num" id="1772329">6</span><span class="op" id="1772330">]</span>&nbsp;<span class="op" id="1772332">=</span>&nbsp;<span class="num" id="1772334">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1772338">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772379">e</span><span class="op" id="1772380">.</span><span class="ident" id="1772381">buf</span><span class="op" id="1772384">[</span><span class="num" id="1772385">7</span><span class="op" id="1772386">]</span>&nbsp;<span class="op" id="1772388">=</span>&nbsp;<span class="num" id="1772390">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772397">e</span><span class="op" id="1772398">.</span><span class="ident" id="1772399">buf</span><span class="op" id="1772402">[</span><span class="num" id="1772403">8</span><span class="op" id="1772404">]</span>&nbsp;<span class="op" id="1772406">=</span>&nbsp;<span class="num" id="1772408">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772414">}</span>&nbsp;<span class="keyword" id="1772416">else</span>&nbsp;<span class="op" id="1772421">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772425">for</span>&nbsp;<span class="ident" id="1772429">i</span>&nbsp;<span class="op" id="1772431">:=</span>&nbsp;<span class="num" id="1772434">0</span><span class="op" id="1772435">;</span>&nbsp;<span class="ident" id="1772437">i</span>&nbsp;<span class="op" id="1772439">&lt;</span>&nbsp;<span class="ident" id="1772441">nComponent</span><span class="op" id="1772451">;</span>&nbsp;<span class="ident" id="1772453">i</span><span class="op" id="1772454">++</span>&nbsp;<span class="op" id="1772457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772462">e</span><span class="op" id="1772463">.</span><span class="ident" id="1772464">buf</span><span class="op" id="1772467">[</span><span class="num" id="1772468">3</span><span class="op" id="1772469">*</span><span class="ident" id="1772470">i</span><span class="op" id="1772471">+</span><span class="num" id="1772472">6</span><span class="op" id="1772473">]</span>&nbsp;<span class="op" id="1772475">=</span>&nbsp;<span class="builtintype" id="1772477">uint8</span><span class="op" id="1772482">(</span><span class="ident" id="1772483">i</span>&nbsp;<span class="op" id="1772485">+</span>&nbsp;<span class="num" id="1772487">1</span><span class="op" id="1772488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1772493">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772532">e</span><span class="op" id="1772533">.</span><span class="ident" id="1772534">buf</span><span class="op" id="1772537">[</span><span class="num" id="1772538">3</span><span class="op" id="1772539">*</span><span class="ident" id="1772540">i</span><span class="op" id="1772541">+</span><span class="num" id="1772542">7</span><span class="op" id="1772543">]</span>&nbsp;<span class="op" id="1772545">=</span>&nbsp;<span class="string" id="1772547">&#34;\x22\x11\x11&#34;</span><span class="op" id="1772561">[</span><span class="ident" id="1772562">i</span><span class="op" id="1772563">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772568">e</span><span class="op" id="1772569">.</span><span class="ident" id="1772570">buf</span><span class="op" id="1772573">[</span><span class="num" id="1772574">3</span><span class="op" id="1772575">*</span><span class="ident" id="1772576">i</span><span class="op" id="1772577">+</span><span class="num" id="1772578">8</span><span class="op" id="1772579">]</span>&nbsp;<span class="op" id="1772581">=</span>&nbsp;<span class="string" id="1772583">&#34;\x00\x01\x01&#34;</span><span class="op" id="1772597">[</span><span class="ident" id="1772598">i</span><span class="op" id="1772599">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772609">e</span><span class="op" id="1772610">.</span><span class="ident" id="1772611">write</span><span class="op" id="1772616">(</span><span class="ident" id="1772617">e</span><span class="op" id="1772618">.</span><span class="ident" id="1772619">buf</span><span class="op" id="1772622">[</span><span class="op" id="1772623">:</span><span class="num" id="1772624">3</span><span class="op" id="1772625">*</span><span class="op" id="1772626">(</span><span class="ident" id="1772627">nComponent</span><span class="op" id="1772637">-</span><span class="num" id="1772638">1</span><span class="op" id="1772639">)</span><span class="op" id="1772640">+</span><span class="num" id="1772641">9</span><span class="op" id="1772642">]</span><span class="op" id="1772643">)</span><br>
<span class="lineno"></span><span class="op" id="1772645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="1772648">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="1772700">func</span>&nbsp;<span class="op" id="1772705">(</span><span class="ident" id="1772706">e</span>&nbsp;<span class="op" id="1772708">*</span><span class="ident" id="1772709">encoder</span><span class="op" id="1772716">)</span>&nbsp;<span class="ident" id="1772718">writeDHT</span><span class="op" id="1772726">(</span><span class="ident" id="1772727">nComponent</span>&nbsp;<span class="builtintype" id="1772738">int</span><span class="op" id="1772741">)</span>&nbsp;<span class="op" id="1772743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772746">markerlen</span>&nbsp;<span class="op" id="1772756">:=</span>&nbsp;<span class="num" id="1772759">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772762">specs</span>&nbsp;<span class="op" id="1772768">:=</span>&nbsp;<span class="ident" id="1772771">theHuffmanSpec</span><span class="op" id="1772785">[</span><span class="op" id="1772786">:</span><span class="op" id="1772787">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772790">if</span>&nbsp;<span class="ident" id="1772793">nComponent</span>&nbsp;<span class="op" id="1772804">==</span>&nbsp;<span class="num" id="1772807">1</span>&nbsp;<span class="op" id="1772809">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1772813">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772847">specs</span>&nbsp;<span class="op" id="1772853">=</span>&nbsp;<span class="ident" id="1772855">specs</span><span class="op" id="1772860">[</span><span class="op" id="1772861">:</span><span class="num" id="1772862">2</span><span class="op" id="1772863">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772869">for</span>&nbsp;<span class="ident" id="1772873">_</span><span class="op" id="1772874">,</span>&nbsp;<span class="ident" id="1772876">s</span>&nbsp;<span class="op" id="1772878">:=</span>&nbsp;<span class="keyword" id="1772881">range</span>&nbsp;<span class="ident" id="1772887">specs</span>&nbsp;<span class="op" id="1772893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772897">markerlen</span>&nbsp;<span class="op" id="1772907">+=</span>&nbsp;<span class="num" id="1772910">1</span>&nbsp;<span class="op" id="1772912">+</span>&nbsp;<span class="num" id="1772914">16</span>&nbsp;<span class="op" id="1772917">+</span>&nbsp;<span class="builtinfunc" id="1772919">len</span><span class="op" id="1772922">(</span><span class="ident" id="1772923">s</span><span class="op" id="1772924">.</span><span class="ident" id="1772925">value</span><span class="op" id="1772930">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772936">e</span><span class="op" id="1772937">.</span><span class="ident" id="1772938">writeMarkerHeader</span><span class="op" id="1772955">(</span><span class="ident" id="1772956">dhtMarker</span><span class="op" id="1772965">,</span>&nbsp;<span class="ident" id="1772967">markerlen</span><span class="op" id="1772976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772979">for</span>&nbsp;<span class="ident" id="1772983">i</span><span class="op" id="1772984">,</span>&nbsp;<span class="ident" id="1772986">s</span>&nbsp;<span class="op" id="1772988">:=</span>&nbsp;<span class="keyword" id="1772991">range</span>&nbsp;<span class="ident" id="1772997">specs</span>&nbsp;<span class="op" id="1773003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773007">e</span><span class="op" id="1773008">.</span><span class="ident" id="1773009">writeByte</span><span class="op" id="1773018">(</span><span class="string" id="1773019">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="1773037">[</span><span class="ident" id="1773038">i</span><span class="op" id="1773039">]</span><span class="op" id="1773040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773044">e</span><span class="op" id="1773045">.</span><span class="ident" id="1773046">write</span><span class="op" id="1773051">(</span><span class="ident" id="1773052">s</span><span class="op" id="1773053">.</span><span class="ident" id="1773054">count</span><span class="op" id="1773059">[</span><span class="op" id="1773060">:</span><span class="op" id="1773061">]</span><span class="op" id="1773062">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773066">e</span><span class="op" id="1773067">.</span><span class="ident" id="1773068">write</span><span class="op" id="1773073">(</span><span class="ident" id="1773074">s</span><span class="op" id="1773075">.</span><span class="ident" id="1773076">value</span><span class="op" id="1773081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773084">}</span><br>
<span class="lineno"></span><span class="op" id="1773086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1773089">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="1773168">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1773247">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="1773279">func</span>&nbsp;<span class="op" id="1773284">(</span><span class="ident" id="1773285">e</span>&nbsp;<span class="op" id="1773287">*</span><span class="ident" id="1773288">encoder</span><span class="op" id="1773295">)</span>&nbsp;<span class="ident" id="1773297">writeBlock</span><span class="op" id="1773307">(</span><span class="ident" id="1773308">b</span>&nbsp;<span class="op" id="1773310">*</span><span class="ident" id="1773311">block</span><span class="op" id="1773316">,</span>&nbsp;<span class="ident" id="1773318">q</span>&nbsp;<span class="ident" id="1773320">quantIndex</span><span class="op" id="1773330">,</span>&nbsp;<span class="ident" id="1773332">prevDC</span>&nbsp;<span class="builtintype" id="1773339">int32</span><span class="op" id="1773344">)</span>&nbsp;<span class="builtintype" id="1773346">int32</span>&nbsp;<span class="op" id="1773352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773355">fdct</span><span class="op" id="1773359">(</span><span class="ident" id="1773360">b</span><span class="op" id="1773361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1773364">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773387">dc</span>&nbsp;<span class="op" id="1773390">:=</span>&nbsp;<span class="ident" id="1773393">div</span><span class="op" id="1773396">(</span><span class="ident" id="1773397">b</span><span class="op" id="1773398">[</span><span class="num" id="1773399">0</span><span class="op" id="1773400">]</span><span class="op" id="1773401">,</span>&nbsp;<span class="num" id="1773403">8</span><span class="op" id="1773404">*</span><span class="builtintype" id="1773405">int32</span><span class="op" id="1773410">(</span><span class="ident" id="1773411">e</span><span class="op" id="1773412">.</span><span class="ident" id="1773413">quant</span><span class="op" id="1773418">[</span><span class="ident" id="1773419">q</span><span class="op" id="1773420">]</span><span class="op" id="1773421">[</span><span class="num" id="1773422">0</span><span class="op" id="1773423">]</span><span class="op" id="1773424">)</span><span class="op" id="1773425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773428">e</span><span class="op" id="1773429">.</span><span class="ident" id="1773430">emitHuffRLE</span><span class="op" id="1773441">(</span><span class="ident" id="1773442">huffIndex</span><span class="op" id="1773451">(</span><span class="num" id="1773452">2</span><span class="op" id="1773453">*</span><span class="ident" id="1773454">q</span><span class="op" id="1773455">+</span><span class="num" id="1773456">0</span><span class="op" id="1773457">)</span><span class="op" id="1773458">,</span>&nbsp;<span class="num" id="1773460">0</span><span class="op" id="1773461">,</span>&nbsp;<span class="ident" id="1773463">dc</span><span class="op" id="1773465">-</span><span class="ident" id="1773466">prevDC</span><span class="op" id="1773472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1773475">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773503">h</span><span class="op" id="1773504">,</span>&nbsp;<span class="ident" id="1773506">runLength</span>&nbsp;<span class="op" id="1773516">:=</span>&nbsp;<span class="ident" id="1773519">huffIndex</span><span class="op" id="1773528">(</span><span class="num" id="1773529">2</span><span class="op" id="1773530">*</span><span class="ident" id="1773531">q</span><span class="op" id="1773532">+</span><span class="num" id="1773533">1</span><span class="op" id="1773534">)</span><span class="op" id="1773535">,</span>&nbsp;<span class="builtintype" id="1773537">int32</span><span class="op" id="1773542">(</span><span class="num" id="1773543">0</span><span class="op" id="1773544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773547">for</span>&nbsp;<span class="ident" id="1773551">zig</span>&nbsp;<span class="op" id="1773555">:=</span>&nbsp;<span class="num" id="1773558">1</span><span class="op" id="1773559">;</span>&nbsp;<span class="ident" id="1773561">zig</span>&nbsp;<span class="op" id="1773565">&lt;</span>&nbsp;<span class="ident" id="1773567">blockSize</span><span class="op" id="1773576">;</span>&nbsp;<span class="ident" id="1773578">zig</span><span class="op" id="1773581">++</span>&nbsp;<span class="op" id="1773584">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773588">ac</span>&nbsp;<span class="op" id="1773591">:=</span>&nbsp;<span class="ident" id="1773594">div</span><span class="op" id="1773597">(</span><span class="ident" id="1773598">b</span><span class="op" id="1773599">[</span><span class="ident" id="1773600">unzig</span><span class="op" id="1773605">[</span><span class="ident" id="1773606">zig</span><span class="op" id="1773609">]</span><span class="op" id="1773610">]</span><span class="op" id="1773611">,</span>&nbsp;<span class="num" id="1773613">8</span><span class="op" id="1773614">*</span><span class="builtintype" id="1773615">int32</span><span class="op" id="1773620">(</span><span class="ident" id="1773621">e</span><span class="op" id="1773622">.</span><span class="ident" id="1773623">quant</span><span class="op" id="1773628">[</span><span class="ident" id="1773629">q</span><span class="op" id="1773630">]</span><span class="op" id="1773631">[</span><span class="ident" id="1773632">zig</span><span class="op" id="1773635">]</span><span class="op" id="1773636">)</span><span class="op" id="1773637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773641">if</span>&nbsp;<span class="ident" id="1773644">ac</span>&nbsp;<span class="op" id="1773647">==</span>&nbsp;<span class="num" id="1773650">0</span>&nbsp;<span class="op" id="1773652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773657">runLength</span><span class="op" id="1773666">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773671">}</span>&nbsp;<span class="keyword" id="1773673">else</span>&nbsp;<span class="op" id="1773678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773683">for</span>&nbsp;<span class="ident" id="1773687">runLength</span>&nbsp;<span class="op" id="1773697">&gt;</span>&nbsp;<span class="num" id="1773699">15</span>&nbsp;<span class="op" id="1773702">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773708">e</span><span class="op" id="1773709">.</span><span class="ident" id="1773710">emitHuff</span><span class="op" id="1773718">(</span><span class="ident" id="1773719">h</span><span class="op" id="1773720">,</span>&nbsp;<span class="num" id="1773722">0xf0</span><span class="op" id="1773726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773732">runLength</span>&nbsp;<span class="op" id="1773742">-=</span>&nbsp;<span class="num" id="1773745">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773756">e</span><span class="op" id="1773757">.</span><span class="ident" id="1773758">emitHuffRLE</span><span class="op" id="1773769">(</span><span class="ident" id="1773770">h</span><span class="op" id="1773771">,</span>&nbsp;<span class="ident" id="1773773">runLength</span><span class="op" id="1773782">,</span>&nbsp;<span class="ident" id="1773784">ac</span><span class="op" id="1773786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773791">runLength</span>&nbsp;<span class="op" id="1773801">=</span>&nbsp;<span class="num" id="1773803">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773813">if</span>&nbsp;<span class="ident" id="1773816">runLength</span>&nbsp;<span class="op" id="1773826">&gt;</span>&nbsp;<span class="num" id="1773828">0</span>&nbsp;<span class="op" id="1773830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773834">e</span><span class="op" id="1773835">.</span><span class="ident" id="1773836">emitHuff</span><span class="op" id="1773844">(</span><span class="ident" id="1773845">h</span><span class="op" id="1773846">,</span>&nbsp;<span class="num" id="1773848">0x00</span><span class="op" id="1773852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773855">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773858">return</span>&nbsp;<span class="ident" id="1773865">dc</span><br>
<span class="lineno"></span><span class="op" id="1773868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1773871">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="1773945">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="1773962">func</span>&nbsp;<span class="ident" id="1773967">toYCbCr</span><span class="op" id="1773974">(</span><span class="ident" id="1773975">m</span>&nbsp;<span class="ident" id="1773977">image</span><span class="op" id="1773982">.</span><span class="ident" id="1773983">Image</span><span class="op" id="1773988">,</span>&nbsp;<span class="ident" id="1773990">p</span>&nbsp;<span class="ident" id="1773992">image</span><span class="op" id="1773997">.</span><span class="ident" id="1773998">Point</span><span class="op" id="1774003">,</span>&nbsp;<span class="ident" id="1774005">yBlock</span><span class="op" id="1774011">,</span>&nbsp;<span class="ident" id="1774013">cbBlock</span><span class="op" id="1774020">,</span>&nbsp;<span class="ident" id="1774022">crBlock</span>&nbsp;<span class="op" id="1774030">*</span><span class="ident" id="1774031">block</span><span class="op" id="1774036">)</span>&nbsp;<span class="op" id="1774038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774041">b</span>&nbsp;<span class="op" id="1774043">:=</span>&nbsp;<span class="ident" id="1774046">m</span><span class="op" id="1774047">.</span><span class="ident" id="1774048">Bounds</span><span class="op" id="1774054">(</span><span class="op" id="1774055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774058">xmax</span>&nbsp;<span class="op" id="1774063">:=</span>&nbsp;<span class="ident" id="1774066">b</span><span class="op" id="1774067">.</span><span class="ident" id="1774068">Max</span><span class="op" id="1774071">.</span><span class="ident" id="1774072">X</span>&nbsp;<span class="op" id="1774074">-</span>&nbsp;<span class="num" id="1774076">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774079">ymax</span>&nbsp;<span class="op" id="1774084">:=</span>&nbsp;<span class="ident" id="1774087">b</span><span class="op" id="1774088">.</span><span class="ident" id="1774089">Max</span><span class="op" id="1774092">.</span><span class="ident" id="1774093">Y</span>&nbsp;<span class="op" id="1774095">-</span>&nbsp;<span class="num" id="1774097">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774100">for</span>&nbsp;<span class="ident" id="1774104">j</span>&nbsp;<span class="op" id="1774106">:=</span>&nbsp;<span class="num" id="1774109">0</span><span class="op" id="1774110">;</span>&nbsp;<span class="ident" id="1774112">j</span>&nbsp;<span class="op" id="1774114">&lt;</span>&nbsp;<span class="num" id="1774116">8</span><span class="op" id="1774117">;</span>&nbsp;<span class="ident" id="1774119">j</span><span class="op" id="1774120">++</span>&nbsp;<span class="op" id="1774123">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774127">for</span>&nbsp;<span class="ident" id="1774131">i</span>&nbsp;<span class="op" id="1774133">:=</span>&nbsp;<span class="num" id="1774136">0</span><span class="op" id="1774137">;</span>&nbsp;<span class="ident" id="1774139">i</span>&nbsp;<span class="op" id="1774141">&lt;</span>&nbsp;<span class="num" id="1774143">8</span><span class="op" id="1774144">;</span>&nbsp;<span class="ident" id="1774146">i</span><span class="op" id="1774147">++</span>&nbsp;<span class="op" id="1774150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774155">r</span><span class="op" id="1774156">,</span>&nbsp;<span class="ident" id="1774158">g</span><span class="op" id="1774159">,</span>&nbsp;<span class="ident" id="1774161">b</span><span class="op" id="1774162">,</span>&nbsp;<span class="ident" id="1774164">_</span>&nbsp;<span class="op" id="1774166">:=</span>&nbsp;<span class="ident" id="1774169">m</span><span class="op" id="1774170">.</span><span class="ident" id="1774171">At</span><span class="op" id="1774173">(</span><span class="ident" id="1774174">min</span><span class="op" id="1774177">(</span><span class="ident" id="1774178">p</span><span class="op" id="1774179">.</span><span class="ident" id="1774180">X</span><span class="op" id="1774181">+</span><span class="ident" id="1774182">i</span><span class="op" id="1774183">,</span>&nbsp;<span class="ident" id="1774185">xmax</span><span class="op" id="1774189">)</span><span class="op" id="1774190">,</span>&nbsp;<span class="ident" id="1774192">min</span><span class="op" id="1774195">(</span><span class="ident" id="1774196">p</span><span class="op" id="1774197">.</span><span class="ident" id="1774198">Y</span><span class="op" id="1774199">+</span><span class="ident" id="1774200">j</span><span class="op" id="1774201">,</span>&nbsp;<span class="ident" id="1774203">ymax</span><span class="op" id="1774207">)</span><span class="op" id="1774208">)</span><span class="op" id="1774209">.</span><span class="ident" id="1774210">RGBA</span><span class="op" id="1774214">(</span><span class="op" id="1774215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774220">yy</span><span class="op" id="1774222">,</span>&nbsp;<span class="ident" id="1774224">cb</span><span class="op" id="1774226">,</span>&nbsp;<span class="ident" id="1774228">cr</span>&nbsp;<span class="op" id="1774231">:=</span>&nbsp;<span class="ident" id="1774234">color</span><span class="op" id="1774239">.</span><span class="ident" id="1774240">RGBToYCbCr</span><span class="op" id="1774250">(</span><span class="builtintype" id="1774251">uint8</span><span class="op" id="1774256">(</span><span class="ident" id="1774257">r</span><span class="op" id="1774258">&gt;&gt;</span><span class="num" id="1774260">8</span><span class="op" id="1774261">)</span><span class="op" id="1774262">,</span>&nbsp;<span class="builtintype" id="1774264">uint8</span><span class="op" id="1774269">(</span><span class="ident" id="1774270">g</span><span class="op" id="1774271">&gt;&gt;</span><span class="num" id="1774273">8</span><span class="op" id="1774274">)</span><span class="op" id="1774275">,</span>&nbsp;<span class="builtintype" id="1774277">uint8</span><span class="op" id="1774282">(</span><span class="ident" id="1774283">b</span><span class="op" id="1774284">&gt;&gt;</span><span class="num" id="1774286">8</span><span class="op" id="1774287">)</span><span class="op" id="1774288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774293">yBlock</span><span class="op" id="1774299">[</span><span class="num" id="1774300">8</span><span class="op" id="1774301">*</span><span class="ident" id="1774302">j</span><span class="op" id="1774303">+</span><span class="ident" id="1774304">i</span><span class="op" id="1774305">]</span>&nbsp;<span class="op" id="1774307">=</span>&nbsp;<span class="builtintype" id="1774309">int32</span><span class="op" id="1774314">(</span><span class="ident" id="1774315">yy</span><span class="op" id="1774317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774322">cbBlock</span><span class="op" id="1774329">[</span><span class="num" id="1774330">8</span><span class="op" id="1774331">*</span><span class="ident" id="1774332">j</span><span class="op" id="1774333">+</span><span class="ident" id="1774334">i</span><span class="op" id="1774335">]</span>&nbsp;<span class="op" id="1774337">=</span>&nbsp;<span class="builtintype" id="1774339">int32</span><span class="op" id="1774344">(</span><span class="ident" id="1774345">cb</span><span class="op" id="1774347">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774352">crBlock</span><span class="op" id="1774359">[</span><span class="num" id="1774360">8</span><span class="op" id="1774361">*</span><span class="ident" id="1774362">j</span><span class="op" id="1774363">+</span><span class="ident" id="1774364">i</span><span class="op" id="1774365">]</span>&nbsp;<span class="op" id="1774367">=</span>&nbsp;<span class="builtintype" id="1774369">int32</span><span class="op" id="1774374">(</span><span class="ident" id="1774375">cr</span><span class="op" id="1774377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774384">}</span><br>
<span class="lineno"></span><span class="op" id="1774386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="1774389">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="1774465">func</span>&nbsp;<span class="ident" id="1774470">grayToY</span><span class="op" id="1774477">(</span><span class="ident" id="1774478">m</span>&nbsp;<span class="op" id="1774480">*</span><span class="ident" id="1774481">image</span><span class="op" id="1774486">.</span><span class="ident" id="1774487">Gray</span><span class="op" id="1774491">,</span>&nbsp;<span class="ident" id="1774493">p</span>&nbsp;<span class="ident" id="1774495">image</span><span class="op" id="1774500">.</span><span class="ident" id="1774501">Point</span><span class="op" id="1774506">,</span>&nbsp;<span class="ident" id="1774508">yBlock</span>&nbsp;<span class="op" id="1774515">*</span><span class="ident" id="1774516">block</span><span class="op" id="1774521">)</span>&nbsp;<span class="op" id="1774523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774526">b</span>&nbsp;<span class="op" id="1774528">:=</span>&nbsp;<span class="ident" id="1774531">m</span><span class="op" id="1774532">.</span><span class="ident" id="1774533">Bounds</span><span class="op" id="1774539">(</span><span class="op" id="1774540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774543">xmax</span>&nbsp;<span class="op" id="1774548">:=</span>&nbsp;<span class="ident" id="1774551">b</span><span class="op" id="1774552">.</span><span class="ident" id="1774553">Max</span><span class="op" id="1774556">.</span><span class="ident" id="1774557">X</span>&nbsp;<span class="op" id="1774559">-</span>&nbsp;<span class="num" id="1774561">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774564">ymax</span>&nbsp;<span class="op" id="1774569">:=</span>&nbsp;<span class="ident" id="1774572">b</span><span class="op" id="1774573">.</span><span class="ident" id="1774574">Max</span><span class="op" id="1774577">.</span><span class="ident" id="1774578">Y</span>&nbsp;<span class="op" id="1774580">-</span>&nbsp;<span class="num" id="1774582">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774585">pix</span>&nbsp;<span class="op" id="1774589">:=</span>&nbsp;<span class="ident" id="1774592">m</span><span class="op" id="1774593">.</span><span class="ident" id="1774594">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774599">for</span>&nbsp;<span class="ident" id="1774603">j</span>&nbsp;<span class="op" id="1774605">:=</span>&nbsp;<span class="num" id="1774608">0</span><span class="op" id="1774609">;</span>&nbsp;<span class="ident" id="1774611">j</span>&nbsp;<span class="op" id="1774613">&lt;</span>&nbsp;<span class="num" id="1774615">8</span><span class="op" id="1774616">;</span>&nbsp;<span class="ident" id="1774618">j</span><span class="op" id="1774619">++</span>&nbsp;<span class="op" id="1774622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774626">for</span>&nbsp;<span class="ident" id="1774630">i</span>&nbsp;<span class="op" id="1774632">:=</span>&nbsp;<span class="num" id="1774635">0</span><span class="op" id="1774636">;</span>&nbsp;<span class="ident" id="1774638">i</span>&nbsp;<span class="op" id="1774640">&lt;</span>&nbsp;<span class="num" id="1774642">8</span><span class="op" id="1774643">;</span>&nbsp;<span class="ident" id="1774645">i</span><span class="op" id="1774646">++</span>&nbsp;<span class="op" id="1774649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774654">idx</span>&nbsp;<span class="op" id="1774658">:=</span>&nbsp;<span class="ident" id="1774661">m</span><span class="op" id="1774662">.</span><span class="ident" id="1774663">PixOffset</span><span class="op" id="1774672">(</span><span class="ident" id="1774673">min</span><span class="op" id="1774676">(</span><span class="ident" id="1774677">p</span><span class="op" id="1774678">.</span><span class="ident" id="1774679">X</span><span class="op" id="1774680">+</span><span class="ident" id="1774681">i</span><span class="op" id="1774682">,</span>&nbsp;<span class="ident" id="1774684">xmax</span><span class="op" id="1774688">)</span><span class="op" id="1774689">,</span>&nbsp;<span class="ident" id="1774691">min</span><span class="op" id="1774694">(</span><span class="ident" id="1774695">p</span><span class="op" id="1774696">.</span><span class="ident" id="1774697">Y</span><span class="op" id="1774698">+</span><span class="ident" id="1774699">j</span><span class="op" id="1774700">,</span>&nbsp;<span class="ident" id="1774702">ymax</span><span class="op" id="1774706">)</span><span class="op" id="1774707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774712">yBlock</span><span class="op" id="1774718">[</span><span class="num" id="1774719">8</span><span class="op" id="1774720">*</span><span class="ident" id="1774721">j</span><span class="op" id="1774722">+</span><span class="ident" id="1774723">i</span><span class="op" id="1774724">]</span>&nbsp;<span class="op" id="1774726">=</span>&nbsp;<span class="builtintype" id="1774728">int32</span><span class="op" id="1774733">(</span><span class="ident" id="1774734">pix</span><span class="op" id="1774737">[</span><span class="ident" id="1774738">idx</span><span class="op" id="1774741">]</span><span class="op" id="1774742">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774749">}</span><br>
<span class="lineno"></span><span class="op" id="1774751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1774754">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="1774828">func</span>&nbsp;<span class="ident" id="1774833">rgbaToYCbCr</span><span class="op" id="1774844">(</span><span class="ident" id="1774845">m</span>&nbsp;<span class="op" id="1774847">*</span><span class="ident" id="1774848">image</span><span class="op" id="1774853">.</span><span class="ident" id="1774854">RGBA</span><span class="op" id="1774858">,</span>&nbsp;<span class="ident" id="1774860">p</span>&nbsp;<span class="ident" id="1774862">image</span><span class="op" id="1774867">.</span><span class="ident" id="1774868">Point</span><span class="op" id="1774873">,</span>&nbsp;<span class="ident" id="1774875">yBlock</span><span class="op" id="1774881">,</span>&nbsp;<span class="ident" id="1774883">cbBlock</span><span class="op" id="1774890">,</span>&nbsp;<span class="ident" id="1774892">crBlock</span>&nbsp;<span class="op" id="1774900">*</span><span class="ident" id="1774901">block</span><span class="op" id="1774906">)</span>&nbsp;<span class="op" id="1774908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774911">b</span>&nbsp;<span class="op" id="1774913">:=</span>&nbsp;<span class="ident" id="1774916">m</span><span class="op" id="1774917">.</span><span class="ident" id="1774918">Bounds</span><span class="op" id="1774924">(</span><span class="op" id="1774925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774928">xmax</span>&nbsp;<span class="op" id="1774933">:=</span>&nbsp;<span class="ident" id="1774936">b</span><span class="op" id="1774937">.</span><span class="ident" id="1774938">Max</span><span class="op" id="1774941">.</span><span class="ident" id="1774942">X</span>&nbsp;<span class="op" id="1774944">-</span>&nbsp;<span class="num" id="1774946">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774949">ymax</span>&nbsp;<span class="op" id="1774954">:=</span>&nbsp;<span class="ident" id="1774957">b</span><span class="op" id="1774958">.</span><span class="ident" id="1774959">Max</span><span class="op" id="1774962">.</span><span class="ident" id="1774963">Y</span>&nbsp;<span class="op" id="1774965">-</span>&nbsp;<span class="num" id="1774967">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774970">for</span>&nbsp;<span class="ident" id="1774974">j</span>&nbsp;<span class="op" id="1774976">:=</span>&nbsp;<span class="num" id="1774979">0</span><span class="op" id="1774980">;</span>&nbsp;<span class="ident" id="1774982">j</span>&nbsp;<span class="op" id="1774984">&lt;</span>&nbsp;<span class="num" id="1774986">8</span><span class="op" id="1774987">;</span>&nbsp;<span class="ident" id="1774989">j</span><span class="op" id="1774990">++</span>&nbsp;<span class="op" id="1774993">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774997">sj</span>&nbsp;<span class="op" id="1775000">:=</span>&nbsp;<span class="ident" id="1775003">p</span><span class="op" id="1775004">.</span><span class="ident" id="1775005">Y</span>&nbsp;<span class="op" id="1775007">+</span>&nbsp;<span class="ident" id="1775009">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1775013">if</span>&nbsp;<span class="ident" id="1775016">sj</span>&nbsp;<span class="op" id="1775019">&gt;</span>&nbsp;<span class="ident" id="1775021">ymax</span>&nbsp;<span class="op" id="1775026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775031">sj</span>&nbsp;<span class="op" id="1775034">=</span>&nbsp;<span class="ident" id="1775036">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1775043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775047">offset</span>&nbsp;<span class="op" id="1775054">:=</span>&nbsp;<span class="op" id="1775057">(</span><span class="ident" id="1775058">sj</span><span class="op" id="1775060">-</span><span class="ident" id="1775061">b</span><span class="op" id="1775062">.</span><span class="ident" id="1775063">Min</span><span class="op" id="1775066">.</span><span class="ident" id="1775067">Y</span><span class="op" id="1775068">)</span><span class="op" id="1775069">*</span><span class="ident" id="1775070">m</span><span class="op" id="1775071">.</span><span class="ident" id="1775072">Stride</span>&nbsp;<span class="op" id="1775079">-</span>&nbsp;<span class="ident" id="1775081">b</span><span class="op" id="1775082">.</span><span class="ident" id="1775083">Min</span><span class="op" id="1775086">.</span><span class="ident" id="1775087">X</span><span class="op" id="1775088">*</span><span class="num" id="1775089">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1775093">for</span>&nbsp;<span class="ident" id="1775097">i</span>&nbsp;<span class="op" id="1775099">:=</span>&nbsp;<span class="num" id="1775102">0</span><span class="op" id="1775103">;</span>&nbsp;<span class="ident" id="1775105">i</span>&nbsp;<span class="op" id="1775107">&lt;</span>&nbsp;<span class="num" id="1775109">8</span><span class="op" id="1775110">;</span>&nbsp;<span class="ident" id="1775112">i</span><span class="op" id="1775113">++</span>&nbsp;<span class="op" id="1775116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775121">sx</span>&nbsp;<span class="op" id="1775124">:=</span>&nbsp;<span class="ident" id="1775127">p</span><span class="op" id="1775128">.</span><span class="ident" id="1775129">X</span>&nbsp;<span class="op" id="1775131">+</span>&nbsp;<span class="ident" id="1775133">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1775138">if</span>&nbsp;<span class="ident" id="1775141">sx</span>&nbsp;<span class="op" id="1775144">&gt;</span>&nbsp;<span class="ident" id="1775146">xmax</span>&nbsp;<span class="op" id="1775151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775157">sx</span>&nbsp;<span class="op" id="1775160">=</span>&nbsp;<span class="ident" id="1775162">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1775170">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775175">pix</span>&nbsp;<span class="op" id="1775179">:=</span>&nbsp;<span class="ident" id="1775182">m</span><span class="op" id="1775183">.</span><span class="ident" id="1775184">Pix</span><span class="op" id="1775187">[</span><span class="ident" id="1775188">offset</span><span class="op" id="1775194">+</span><span class="ident" id="1775195">sx</span><span class="op" id="1775197">*</span><span class="num" id="1775198">4</span><span class="op" id="1775199">:</span><span class="op" id="1775200">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775205">yy</span><span class="op" id="1775207">,</span>&nbsp;<span class="ident" id="1775209">cb</span><span class="op" id="1775211">,</span>&nbsp;<span class="ident" id="1775213">cr</span>&nbsp;<span class="op" id="1775216">:=</span>&nbsp;<span class="ident" id="1775219">color</span><span class="op" id="1775224">.</span><span class="ident" id="1775225">RGBToYCbCr</span><span class="op" id="1775235">(</span><span class="ident" id="1775236">pix</span><span class="op" id="1775239">[</span><span class="num" id="1775240">0</span><span class="op" id="1775241">]</span><span class="op" id="1775242">,</span>&nbsp;<span class="ident" id="1775244">pix</span><span class="op" id="1775247">[</span><span class="num" id="1775248">1</span><span class="op" id="1775249">]</span><span class="op" id="1775250">,</span>&nbsp;<span class="ident" id="1775252">pix</span><span class="op" id="1775255">[</span><span class="num" id="1775256">2</span><span class="op" id="1775257">]</span><span class="op" id="1775258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775263">yBlock</span><span class="op" id="1775269">[</span><span class="num" id="1775270">8</span><span class="op" id="1775271">*</span><span class="ident" id="1775272">j</span><span class="op" id="1775273">+</span><span class="ident" id="1775274">i</span><span class="op" id="1775275">]</span>&nbsp;<span class="op" id="1775277">=</span>&nbsp;<span class="builtintype" id="1775279">int32</span><span class="op" id="1775284">(</span><span class="ident" id="1775285">yy</span><span class="op" id="1775287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775292">cbBlock</span><span class="op" id="1775299">[</span><span class="num" id="1775300">8</span><span class="op" id="1775301">*</span><span class="ident" id="1775302">j</span><span class="op" id="1775303">+</span><span class="ident" id="1775304">i</span><span class="op" id="1775305">]</span>&nbsp;<span class="op" id="1775307">=</span>&nbsp;<span class="builtintype" id="1775309">int32</span><span class="op" id="1775314">(</span><span class="ident" id="1775315">cb</span><span class="op" id="1775317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775322">crBlock</span><span class="op" id="1775329">[</span><span class="num" id="1775330">8</span><span class="op" id="1775331">*</span><span class="ident" id="1775332">j</span><span class="op" id="1775333">+</span><span class="ident" id="1775334">i</span><span class="op" id="1775335">]</span>&nbsp;<span class="op" id="1775337">=</span>&nbsp;<span class="builtintype" id="1775339">int32</span><span class="op" id="1775344">(</span><span class="ident" id="1775345">cr</span><span class="op" id="1775347">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1775351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1775354">}</span><br>
<span class="lineno"></span><span class="op" id="1775356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1775359">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="1775435">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="1775449">func</span>&nbsp;<span class="ident" id="1775454">scale</span><span class="op" id="1775459">(</span><span class="ident" id="1775460">dst</span>&nbsp;<span class="op" id="1775464">*</span><span class="ident" id="1775465">block</span><span class="op" id="1775470">,</span>&nbsp;<span class="ident" id="1775472">src</span>&nbsp;<span class="op" id="1775476">*</span><span class="op" id="1775477">[</span><span class="num" id="1775478">4</span><span class="op" id="1775479">]</span><span class="ident" id="1775480">block</span><span class="op" id="1775485">)</span>&nbsp;<span class="op" id="1775487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1775490">for</span>&nbsp;<span class="ident" id="1775494">i</span>&nbsp;<span class="op" id="1775496">:=</span>&nbsp;<span class="num" id="1775499">0</span><span class="op" id="1775500">;</span>&nbsp;<span class="ident" id="1775502">i</span>&nbsp;<span class="op" id="1775504">&lt;</span>&nbsp;<span class="num" id="1775506">4</span><span class="op" id="1775507">;</span>&nbsp;<span class="ident" id="1775509">i</span><span class="op" id="1775510">++</span>&nbsp;<span class="op" id="1775513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775517">dstOff</span>&nbsp;<span class="op" id="1775524">:=</span>&nbsp;<span class="op" id="1775527">(</span><span class="ident" id="1775528">i</span><span class="op" id="1775529">&amp;</span><span class="num" id="1775530">2</span><span class="op" id="1775531">)</span><span class="op" id="1775532">&lt;&lt;</span><span class="num" id="1775534">4</span>&nbsp;<span class="op" id="1775536">|</span>&nbsp;<span class="op" id="1775538">(</span><span class="ident" id="1775539">i</span><span class="op" id="1775540">&amp;</span><span class="num" id="1775541">1</span><span class="op" id="1775542">)</span><span class="op" id="1775543">&lt;&lt;</span><span class="num" id="1775545">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1775549">for</span>&nbsp;<span class="ident" id="1775553">y</span>&nbsp;<span class="op" id="1775555">:=</span>&nbsp;<span class="num" id="1775558">0</span><span class="op" id="1775559">;</span>&nbsp;<span class="ident" id="1775561">y</span>&nbsp;<span class="op" id="1775563">&lt;</span>&nbsp;<span class="num" id="1775565">4</span><span class="op" id="1775566">;</span>&nbsp;<span class="ident" id="1775568">y</span><span class="op" id="1775569">++</span>&nbsp;<span class="op" id="1775572">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1775577">for</span>&nbsp;<span class="ident" id="1775581">x</span>&nbsp;<span class="op" id="1775583">:=</span>&nbsp;<span class="num" id="1775586">0</span><span class="op" id="1775587">;</span>&nbsp;<span class="ident" id="1775589">x</span>&nbsp;<span class="op" id="1775591">&lt;</span>&nbsp;<span class="num" id="1775593">4</span><span class="op" id="1775594">;</span>&nbsp;<span class="ident" id="1775596">x</span><span class="op" id="1775597">++</span>&nbsp;<span class="op" id="1775600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775606">j</span>&nbsp;<span class="op" id="1775608">:=</span>&nbsp;<span class="num" id="1775611">16</span><span class="op" id="1775613">*</span><span class="ident" id="1775614">y</span>&nbsp;<span class="op" id="1775616">+</span>&nbsp;<span class="num" id="1775618">2</span><span class="op" id="1775619">*</span><span class="ident" id="1775620">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775626">sum</span>&nbsp;<span class="op" id="1775630">:=</span>&nbsp;<span class="ident" id="1775633">src</span><span class="op" id="1775636">[</span><span class="ident" id="1775637">i</span><span class="op" id="1775638">]</span><span class="op" id="1775639">[</span><span class="ident" id="1775640">j</span><span class="op" id="1775641">]</span>&nbsp;<span class="op" id="1775643">+</span>&nbsp;<span class="ident" id="1775645">src</span><span class="op" id="1775648">[</span><span class="ident" id="1775649">i</span><span class="op" id="1775650">]</span><span class="op" id="1775651">[</span><span class="ident" id="1775652">j</span><span class="op" id="1775653">+</span><span class="num" id="1775654">1</span><span class="op" id="1775655">]</span>&nbsp;<span class="op" id="1775657">+</span>&nbsp;<span class="ident" id="1775659">src</span><span class="op" id="1775662">[</span><span class="ident" id="1775663">i</span><span class="op" id="1775664">]</span><span class="op" id="1775665">[</span><span class="ident" id="1775666">j</span><span class="op" id="1775667">+</span><span class="num" id="1775668">8</span><span class="op" id="1775669">]</span>&nbsp;<span class="op" id="1775671">+</span>&nbsp;<span class="ident" id="1775673">src</span><span class="op" id="1775676">[</span><span class="ident" id="1775677">i</span><span class="op" id="1775678">]</span><span class="op" id="1775679">[</span><span class="ident" id="1775680">j</span><span class="op" id="1775681">+</span><span class="num" id="1775682">9</span><span class="op" id="1775683">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775689">dst</span><span class="op" id="1775692">[</span><span class="num" id="1775693">8</span><span class="op" id="1775694">*</span><span class="ident" id="1775695">y</span><span class="op" id="1775696">+</span><span class="ident" id="1775697">x</span><span class="op" id="1775698">+</span><span class="ident" id="1775699">dstOff</span><span class="op" id="1775705">]</span>&nbsp;<span class="op" id="1775707">=</span>&nbsp;<span class="op" id="1775709">(</span><span class="ident" id="1775710">sum</span>&nbsp;<span class="op" id="1775714">+</span>&nbsp;<span class="num" id="1775716">2</span><span class="op" id="1775717">)</span>&nbsp;<span class="op" id="1775719">&gt;&gt;</span>&nbsp;<span class="num" id="1775722">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1775727">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1775731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1775734">}</span><br>
<span class="lineno"></span><span class="op" id="1775736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1775739">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="1775803">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="1775838">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="1775876">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="1775936">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1776007">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="1776082">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="1776125">var</span>&nbsp;<span class="ident" id="1776129">sosHeaderY</span>&nbsp;<span class="op" id="1776140">=</span>&nbsp;<span class="op" id="1776142">[</span><span class="op" id="1776143">]</span><span class="builtintype" id="1776144">byte</span><span class="op" id="1776148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1776151">0xff</span><span class="op" id="1776155">,</span>&nbsp;<span class="num" id="1776157">0xda</span><span class="op" id="1776161">,</span>&nbsp;<span class="num" id="1776163">0x00</span><span class="op" id="1776167">,</span>&nbsp;<span class="num" id="1776169">0x08</span><span class="op" id="1776173">,</span>&nbsp;<span class="num" id="1776175">0x01</span><span class="op" id="1776179">,</span>&nbsp;<span class="num" id="1776181">0x01</span><span class="op" id="1776185">,</span>&nbsp;<span class="num" id="1776187">0x00</span><span class="op" id="1776191">,</span>&nbsp;<span class="num" id="1776193">0x00</span><span class="op" id="1776197">,</span>&nbsp;<span class="num" id="1776199">0x3f</span><span class="op" id="1776203">,</span>&nbsp;<span class="num" id="1776205">0x00</span><span class="op" id="1776209">,</span><br>
<span class="lineno"></span><span class="op" id="1776211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="1776214">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="1776283">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="1776318">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="1776356">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="1776416">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="1776476">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="1776536">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1776607">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="1776682">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="1776725">var</span>&nbsp;<span class="ident" id="1776729">sosHeaderYCbCr</span>&nbsp;<span class="op" id="1776744">=</span>&nbsp;<span class="op" id="1776746">[</span><span class="op" id="1776747">]</span><span class="builtintype" id="1776748">byte</span><span class="op" id="1776752">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1776755">0xff</span><span class="op" id="1776759">,</span>&nbsp;<span class="num" id="1776761">0xda</span><span class="op" id="1776765">,</span>&nbsp;<span class="num" id="1776767">0x00</span><span class="op" id="1776771">,</span>&nbsp;<span class="num" id="1776773">0x0c</span><span class="op" id="1776777">,</span>&nbsp;<span class="num" id="1776779">0x03</span><span class="op" id="1776783">,</span>&nbsp;<span class="num" id="1776785">0x01</span><span class="op" id="1776789">,</span>&nbsp;<span class="num" id="1776791">0x00</span><span class="op" id="1776795">,</span>&nbsp;<span class="num" id="1776797">0x02</span><span class="op" id="1776801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1776804">0x11</span><span class="op" id="1776808">,</span>&nbsp;<span class="num" id="1776810">0x03</span><span class="op" id="1776814">,</span>&nbsp;<span class="num" id="1776816">0x11</span><span class="op" id="1776820">,</span>&nbsp;<span class="num" id="1776822">0x00</span><span class="op" id="1776826">,</span>&nbsp;<span class="num" id="1776828">0x3f</span><span class="op" id="1776832">,</span>&nbsp;<span class="num" id="1776834">0x00</span><span class="op" id="1776838">,</span><br>
<span class="lineno"></span><span class="op" id="1776840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1776843">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="1776886">func</span>&nbsp;<span class="op" id="1776891">(</span><span class="ident" id="1776892">e</span>&nbsp;<span class="op" id="1776894">*</span><span class="ident" id="1776895">encoder</span><span class="op" id="1776902">)</span>&nbsp;<span class="ident" id="1776904">writeSOS</span><span class="op" id="1776912">(</span><span class="ident" id="1776913">m</span>&nbsp;<span class="ident" id="1776915">image</span><span class="op" id="1776920">.</span><span class="ident" id="1776921">Image</span><span class="op" id="1776926">)</span>&nbsp;<span class="op" id="1776928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776931">switch</span>&nbsp;<span class="ident" id="1776938">m</span><span class="op" id="1776939">.</span><span class="op" id="1776940">(</span><span class="keyword" id="1776941">type</span><span class="op" id="1776945">)</span>&nbsp;<span class="op" id="1776947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776950">case</span>&nbsp;<span class="op" id="1776955">*</span><span class="ident" id="1776956">image</span><span class="op" id="1776961">.</span><span class="ident" id="1776962">Gray</span><span class="op" id="1776966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1776970">e</span><span class="op" id="1776971">.</span><span class="ident" id="1776972">write</span><span class="op" id="1776977">(</span><span class="ident" id="1776978">sosHeaderY</span><span class="op" id="1776988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776991">default</span><span class="op" id="1776998">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777002">e</span><span class="op" id="1777003">.</span><span class="ident" id="1777004">write</span><span class="op" id="1777009">(</span><span class="ident" id="1777010">sosHeaderYCbCr</span><span class="op" id="1777024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777030">var</span>&nbsp;<span class="op" id="1777034">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1777038">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1777085">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777137">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777144">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777152">cb</span><span class="op" id="1777154">,</span>&nbsp;<span class="ident" id="1777156">cr</span>&nbsp;<span class="op" id="1777159">[</span><span class="num" id="1777160">4</span><span class="op" id="1777161">]</span><span class="ident" id="1777162">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1777170">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777208">prevDCY</span><span class="op" id="1777215">,</span>&nbsp;<span class="ident" id="1777217">prevDCCb</span><span class="op" id="1777225">,</span>&nbsp;<span class="ident" id="1777227">prevDCCr</span>&nbsp;<span class="builtintype" id="1777236">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777243">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777246">bounds</span>&nbsp;<span class="op" id="1777253">:=</span>&nbsp;<span class="ident" id="1777256">m</span><span class="op" id="1777257">.</span><span class="ident" id="1777258">Bounds</span><span class="op" id="1777264">(</span><span class="op" id="1777265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777268">switch</span>&nbsp;<span class="ident" id="1777275">m</span>&nbsp;<span class="op" id="1777277">:=</span>&nbsp;<span class="ident" id="1777280">m</span><span class="op" id="1777281">.</span><span class="op" id="1777282">(</span><span class="keyword" id="1777283">type</span><span class="op" id="1777287">)</span>&nbsp;<span class="op" id="1777289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1777292">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777354">case</span>&nbsp;<span class="op" id="1777359">*</span><span class="ident" id="1777360">image</span><span class="op" id="1777365">.</span><span class="ident" id="1777366">Gray</span><span class="op" id="1777370">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777374">for</span>&nbsp;<span class="ident" id="1777378">y</span>&nbsp;<span class="op" id="1777380">:=</span>&nbsp;<span class="ident" id="1777383">bounds</span><span class="op" id="1777389">.</span><span class="ident" id="1777390">Min</span><span class="op" id="1777393">.</span><span class="ident" id="1777394">Y</span><span class="op" id="1777395">;</span>&nbsp;<span class="ident" id="1777397">y</span>&nbsp;<span class="op" id="1777399">&lt;</span>&nbsp;<span class="ident" id="1777401">bounds</span><span class="op" id="1777407">.</span><span class="ident" id="1777408">Max</span><span class="op" id="1777411">.</span><span class="ident" id="1777412">Y</span><span class="op" id="1777413">;</span>&nbsp;<span class="ident" id="1777415">y</span>&nbsp;<span class="op" id="1777417">+=</span>&nbsp;<span class="num" id="1777420">8</span>&nbsp;<span class="op" id="1777422">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777427">for</span>&nbsp;<span class="ident" id="1777431">x</span>&nbsp;<span class="op" id="1777433">:=</span>&nbsp;<span class="ident" id="1777436">bounds</span><span class="op" id="1777442">.</span><span class="ident" id="1777443">Min</span><span class="op" id="1777446">.</span><span class="ident" id="1777447">X</span><span class="op" id="1777448">;</span>&nbsp;<span class="ident" id="1777450">x</span>&nbsp;<span class="op" id="1777452">&lt;</span>&nbsp;<span class="ident" id="1777454">bounds</span><span class="op" id="1777460">.</span><span class="ident" id="1777461">Max</span><span class="op" id="1777464">.</span><span class="ident" id="1777465">X</span><span class="op" id="1777466">;</span>&nbsp;<span class="ident" id="1777468">x</span>&nbsp;<span class="op" id="1777470">+=</span>&nbsp;<span class="num" id="1777473">8</span>&nbsp;<span class="op" id="1777475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777481">p</span>&nbsp;<span class="op" id="1777483">:=</span>&nbsp;<span class="ident" id="1777486">image</span><span class="op" id="1777491">.</span><span class="ident" id="1777492">Pt</span><span class="op" id="1777494">(</span><span class="ident" id="1777495">x</span><span class="op" id="1777496">,</span>&nbsp;<span class="ident" id="1777498">y</span><span class="op" id="1777499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777505">grayToY</span><span class="op" id="1777512">(</span><span class="ident" id="1777513">m</span><span class="op" id="1777514">,</span>&nbsp;<span class="ident" id="1777516">p</span><span class="op" id="1777517">,</span>&nbsp;<span class="op" id="1777519">&amp;</span><span class="ident" id="1777520">b</span><span class="op" id="1777521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777527">prevDCY</span>&nbsp;<span class="op" id="1777535">=</span>&nbsp;<span class="ident" id="1777537">e</span><span class="op" id="1777538">.</span><span class="ident" id="1777539">writeBlock</span><span class="op" id="1777549">(</span><span class="op" id="1777550">&amp;</span><span class="ident" id="1777551">b</span><span class="op" id="1777552">,</span>&nbsp;<span class="num" id="1777554">0</span><span class="op" id="1777555">,</span>&nbsp;<span class="ident" id="1777557">prevDCY</span><span class="op" id="1777564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777569">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777576">default</span><span class="op" id="1777583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777587">rgba</span><span class="op" id="1777591">,</span>&nbsp;<span class="ident" id="1777593">_</span>&nbsp;<span class="op" id="1777595">:=</span>&nbsp;<span class="ident" id="1777598">m</span><span class="op" id="1777599">.</span><span class="op" id="1777600">(</span><span class="op" id="1777601">*</span><span class="ident" id="1777602">image</span><span class="op" id="1777607">.</span><span class="ident" id="1777608">RGBA</span><span class="op" id="1777612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777616">for</span>&nbsp;<span class="ident" id="1777620">y</span>&nbsp;<span class="op" id="1777622">:=</span>&nbsp;<span class="ident" id="1777625">bounds</span><span class="op" id="1777631">.</span><span class="ident" id="1777632">Min</span><span class="op" id="1777635">.</span><span class="ident" id="1777636">Y</span><span class="op" id="1777637">;</span>&nbsp;<span class="ident" id="1777639">y</span>&nbsp;<span class="op" id="1777641">&lt;</span>&nbsp;<span class="ident" id="1777643">bounds</span><span class="op" id="1777649">.</span><span class="ident" id="1777650">Max</span><span class="op" id="1777653">.</span><span class="ident" id="1777654">Y</span><span class="op" id="1777655">;</span>&nbsp;<span class="ident" id="1777657">y</span>&nbsp;<span class="op" id="1777659">+=</span>&nbsp;<span class="num" id="1777662">16</span>&nbsp;<span class="op" id="1777665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777670">for</span>&nbsp;<span class="ident" id="1777674">x</span>&nbsp;<span class="op" id="1777676">:=</span>&nbsp;<span class="ident" id="1777679">bounds</span><span class="op" id="1777685">.</span><span class="ident" id="1777686">Min</span><span class="op" id="1777689">.</span><span class="ident" id="1777690">X</span><span class="op" id="1777691">;</span>&nbsp;<span class="ident" id="1777693">x</span>&nbsp;<span class="op" id="1777695">&lt;</span>&nbsp;<span class="ident" id="1777697">bounds</span><span class="op" id="1777703">.</span><span class="ident" id="1777704">Max</span><span class="op" id="1777707">.</span><span class="ident" id="1777708">X</span><span class="op" id="1777709">;</span>&nbsp;<span class="ident" id="1777711">x</span>&nbsp;<span class="op" id="1777713">+=</span>&nbsp;<span class="num" id="1777716">16</span>&nbsp;<span class="op" id="1777719">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777725">for</span>&nbsp;<span class="ident" id="1777729">i</span>&nbsp;<span class="op" id="1777731">:=</span>&nbsp;<span class="num" id="1777734">0</span><span class="op" id="1777735">;</span>&nbsp;<span class="ident" id="1777737">i</span>&nbsp;<span class="op" id="1777739">&lt;</span>&nbsp;<span class="num" id="1777741">4</span><span class="op" id="1777742">;</span>&nbsp;<span class="ident" id="1777744">i</span><span class="op" id="1777745">++</span>&nbsp;<span class="op" id="1777748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777755">xOff</span>&nbsp;<span class="op" id="1777760">:=</span>&nbsp;<span class="op" id="1777763">(</span><span class="ident" id="1777764">i</span>&nbsp;<span class="op" id="1777766">&amp;</span>&nbsp;<span class="num" id="1777768">1</span><span class="op" id="1777769">)</span>&nbsp;<span class="op" id="1777771">*</span>&nbsp;<span class="num" id="1777773">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777780">yOff</span>&nbsp;<span class="op" id="1777785">:=</span>&nbsp;<span class="op" id="1777788">(</span><span class="ident" id="1777789">i</span>&nbsp;<span class="op" id="1777791">&amp;</span>&nbsp;<span class="num" id="1777793">2</span><span class="op" id="1777794">)</span>&nbsp;<span class="op" id="1777796">*</span>&nbsp;<span class="num" id="1777798">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777805">p</span>&nbsp;<span class="op" id="1777807">:=</span>&nbsp;<span class="ident" id="1777810">image</span><span class="op" id="1777815">.</span><span class="ident" id="1777816">Pt</span><span class="op" id="1777818">(</span><span class="ident" id="1777819">x</span><span class="op" id="1777820">+</span><span class="ident" id="1777821">xOff</span><span class="op" id="1777825">,</span>&nbsp;<span class="ident" id="1777827">y</span><span class="op" id="1777828">+</span><span class="ident" id="1777829">yOff</span><span class="op" id="1777833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777840">if</span>&nbsp;<span class="ident" id="1777843">rgba</span>&nbsp;<span class="op" id="1777848">!=</span>&nbsp;<span class="builtintype" id="1777851">nil</span>&nbsp;<span class="op" id="1777855">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777863">rgbaToYCbCr</span><span class="op" id="1777874">(</span><span class="ident" id="1777875">rgba</span><span class="op" id="1777879">,</span>&nbsp;<span class="ident" id="1777881">p</span><span class="op" id="1777882">,</span>&nbsp;<span class="op" id="1777884">&amp;</span><span class="ident" id="1777885">b</span><span class="op" id="1777886">,</span>&nbsp;<span class="op" id="1777888">&amp;</span><span class="ident" id="1777889">cb</span><span class="op" id="1777891">[</span><span class="ident" id="1777892">i</span><span class="op" id="1777893">]</span><span class="op" id="1777894">,</span>&nbsp;<span class="op" id="1777896">&amp;</span><span class="ident" id="1777897">cr</span><span class="op" id="1777899">[</span><span class="ident" id="1777900">i</span><span class="op" id="1777901">]</span><span class="op" id="1777902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777909">}</span>&nbsp;<span class="keyword" id="1777911">else</span>&nbsp;<span class="op" id="1777916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777924">toYCbCr</span><span class="op" id="1777931">(</span><span class="ident" id="1777932">m</span><span class="op" id="1777933">,</span>&nbsp;<span class="ident" id="1777935">p</span><span class="op" id="1777936">,</span>&nbsp;<span class="op" id="1777938">&amp;</span><span class="ident" id="1777939">b</span><span class="op" id="1777940">,</span>&nbsp;<span class="op" id="1777942">&amp;</span><span class="ident" id="1777943">cb</span><span class="op" id="1777945">[</span><span class="ident" id="1777946">i</span><span class="op" id="1777947">]</span><span class="op" id="1777948">,</span>&nbsp;<span class="op" id="1777950">&amp;</span><span class="ident" id="1777951">cr</span><span class="op" id="1777953">[</span><span class="ident" id="1777954">i</span><span class="op" id="1777955">]</span><span class="op" id="1777956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777970">prevDCY</span>&nbsp;<span class="op" id="1777978">=</span>&nbsp;<span class="ident" id="1777980">e</span><span class="op" id="1777981">.</span><span class="ident" id="1777982">writeBlock</span><span class="op" id="1777992">(</span><span class="op" id="1777993">&amp;</span><span class="ident" id="1777994">b</span><span class="op" id="1777995">,</span>&nbsp;<span class="num" id="1777997">0</span><span class="op" id="1777998">,</span>&nbsp;<span class="ident" id="1778000">prevDCY</span><span class="op" id="1778007">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1778013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778019">scale</span><span class="op" id="1778024">(</span><span class="op" id="1778025">&amp;</span><span class="ident" id="1778026">b</span><span class="op" id="1778027">,</span>&nbsp;<span class="op" id="1778029">&amp;</span><span class="ident" id="1778030">cb</span><span class="op" id="1778032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778038">prevDCCb</span>&nbsp;<span class="op" id="1778047">=</span>&nbsp;<span class="ident" id="1778049">e</span><span class="op" id="1778050">.</span><span class="ident" id="1778051">writeBlock</span><span class="op" id="1778061">(</span><span class="op" id="1778062">&amp;</span><span class="ident" id="1778063">b</span><span class="op" id="1778064">,</span>&nbsp;<span class="num" id="1778066">1</span><span class="op" id="1778067">,</span>&nbsp;<span class="ident" id="1778069">prevDCCb</span><span class="op" id="1778077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778083">scale</span><span class="op" id="1778088">(</span><span class="op" id="1778089">&amp;</span><span class="ident" id="1778090">b</span><span class="op" id="1778091">,</span>&nbsp;<span class="op" id="1778093">&amp;</span><span class="ident" id="1778094">cr</span><span class="op" id="1778096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778102">prevDCCr</span>&nbsp;<span class="op" id="1778111">=</span>&nbsp;<span class="ident" id="1778113">e</span><span class="op" id="1778114">.</span><span class="ident" id="1778115">writeBlock</span><span class="op" id="1778125">(</span><span class="op" id="1778126">&amp;</span><span class="ident" id="1778127">b</span><span class="op" id="1778128">,</span>&nbsp;<span class="num" id="1778130">1</span><span class="op" id="1778131">,</span>&nbsp;<span class="ident" id="1778133">prevDCCr</span><span class="op" id="1778141">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1778146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1778150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1778153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1778156">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778188">e</span><span class="op" id="1778189">.</span><span class="ident" id="1778190">emit</span><span class="op" id="1778194">(</span><span class="num" id="1778195">0x7f</span><span class="op" id="1778199">,</span>&nbsp;<span class="num" id="1778201">7</span><span class="op" id="1778202">)</span><br>
<span class="lineno">535</span><span class="op" id="1778204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1778207">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="1778268">const</span>&nbsp;<span class="ident" id="1778274">DefaultQuality</span>&nbsp;<span class="op" id="1778289">=</span>&nbsp;<span class="num" id="1778291">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="1778295">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="1778335">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="1778396">type</span>&nbsp;<span class="ident" id="1778401">Options</span>&nbsp;<span class="keyword" id="1778409">struct</span>&nbsp;<span class="op" id="1778416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778419">Quality</span>&nbsp;<span class="builtintype" id="1778427">int</span><br>
<span class="lineno"></span><span class="op" id="1778431">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="1778434">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="1778513">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="1778582">func</span>&nbsp;<span class="ident" id="1778587">Encode</span><span class="op" id="1778593">(</span><span class="ident" id="1778594">w</span>&nbsp;<span class="ident" id="1778596">io</span><span class="op" id="1778598">.</span><span class="ident" id="1778599">Writer</span><span class="op" id="1778605">,</span>&nbsp;<span class="ident" id="1778607">m</span>&nbsp;<span class="ident" id="1778609">image</span><span class="op" id="1778614">.</span><span class="ident" id="1778615">Image</span><span class="op" id="1778620">,</span>&nbsp;<span class="ident" id="1778622">o</span>&nbsp;<span class="op" id="1778624">*</span><span class="ident" id="1778625">Options</span><span class="op" id="1778632">)</span>&nbsp;<span class="builtintype" id="1778634">error</span>&nbsp;<span class="op" id="1778640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778643">b</span>&nbsp;<span class="op" id="1778645">:=</span>&nbsp;<span class="ident" id="1778648">m</span><span class="op" id="1778649">.</span><span class="ident" id="1778650">Bounds</span><span class="op" id="1778656">(</span><span class="op" id="1778657">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778660">if</span>&nbsp;<span class="ident" id="1778663">b</span><span class="op" id="1778664">.</span><span class="ident" id="1778665">Dx</span><span class="op" id="1778667">(</span><span class="op" id="1778668">)</span>&nbsp;<span class="op" id="1778670">&gt;=</span>&nbsp;<span class="num" id="1778673">1</span><span class="op" id="1778674">&lt;&lt;</span><span class="num" id="1778676">16</span>&nbsp;<span class="op" id="1778679">||</span>&nbsp;<span class="ident" id="1778682">b</span><span class="op" id="1778683">.</span><span class="ident" id="1778684">Dy</span><span class="op" id="1778686">(</span><span class="op" id="1778687">)</span>&nbsp;<span class="op" id="1778689">&gt;=</span>&nbsp;<span class="num" id="1778692">1</span><span class="op" id="1778693">&lt;&lt;</span><span class="num" id="1778695">16</span>&nbsp;<span class="op" id="1778698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778702">return</span>&nbsp;<span class="ident" id="1778709">errors</span><span class="op" id="1778715">.</span><span class="ident" id="1778716">New</span><span class="op" id="1778719">(</span><span class="string" id="1778720">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="1778756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1778759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778762">var</span>&nbsp;<span class="ident" id="1778766">e</span>&nbsp;<span class="ident" id="1778768">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778777">if</span>&nbsp;<span class="ident" id="1778780">ww</span><span class="op" id="1778782">,</span>&nbsp;<span class="ident" id="1778784">ok</span>&nbsp;<span class="op" id="1778787">:=</span>&nbsp;<span class="ident" id="1778790">w</span><span class="op" id="1778791">.</span><span class="op" id="1778792">(</span><span class="ident" id="1778793">writer</span><span class="op" id="1778799">)</span><span class="op" id="1778800">;</span>&nbsp;<span class="ident" id="1778802">ok</span>&nbsp;<span class="op" id="1778805">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778809">e</span><span class="op" id="1778810">.</span><span class="ident" id="1778811">w</span>&nbsp;<span class="op" id="1778813">=</span>&nbsp;<span class="ident" id="1778815">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1778819">}</span>&nbsp;<span class="keyword" id="1778821">else</span>&nbsp;<span class="op" id="1778826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778830">e</span><span class="op" id="1778831">.</span><span class="ident" id="1778832">w</span>&nbsp;<span class="op" id="1778834">=</span>&nbsp;<span class="ident" id="1778836">bufio</span><span class="op" id="1778841">.</span><span class="ident" id="1778842">NewWriter</span><span class="op" id="1778851">(</span><span class="ident" id="1778852">w</span><span class="op" id="1778853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1778856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1778859">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778889">quality</span>&nbsp;<span class="op" id="1778897">:=</span>&nbsp;<span class="ident" id="1778900">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778916">if</span>&nbsp;<span class="ident" id="1778919">o</span>&nbsp;<span class="op" id="1778921">!=</span>&nbsp;<span class="builtintype" id="1778924">nil</span>&nbsp;<span class="op" id="1778928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778932">quality</span>&nbsp;<span class="op" id="1778940">=</span>&nbsp;<span class="ident" id="1778942">o</span><span class="op" id="1778943">.</span><span class="ident" id="1778944">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778954">if</span>&nbsp;<span class="ident" id="1778957">quality</span>&nbsp;<span class="op" id="1778965">&lt;</span>&nbsp;<span class="num" id="1778967">1</span>&nbsp;<span class="op" id="1778969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778974">quality</span>&nbsp;<span class="op" id="1778982">=</span>&nbsp;<span class="num" id="1778984">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1778988">}</span>&nbsp;<span class="keyword" id="1778990">else</span>&nbsp;<span class="keyword" id="1778995">if</span>&nbsp;<span class="ident" id="1778998">quality</span>&nbsp;<span class="op" id="1779006">&gt;</span>&nbsp;<span class="num" id="1779008">100</span>&nbsp;<span class="op" id="1779012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779017">quality</span>&nbsp;<span class="op" id="1779025">=</span>&nbsp;<span class="num" id="1779027">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779039">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779094">var</span>&nbsp;<span class="ident" id="1779098">scale</span>&nbsp;<span class="builtintype" id="1779104">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779109">if</span>&nbsp;<span class="ident" id="1779112">quality</span>&nbsp;<span class="op" id="1779120">&lt;</span>&nbsp;<span class="num" id="1779122">50</span>&nbsp;<span class="op" id="1779125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779129">scale</span>&nbsp;<span class="op" id="1779135">=</span>&nbsp;<span class="num" id="1779137">5000</span>&nbsp;<span class="op" id="1779142">/</span>&nbsp;<span class="ident" id="1779144">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779153">}</span>&nbsp;<span class="keyword" id="1779155">else</span>&nbsp;<span class="op" id="1779160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779164">scale</span>&nbsp;<span class="op" id="1779170">=</span>&nbsp;<span class="num" id="1779172">200</span>&nbsp;<span class="op" id="1779176">-</span>&nbsp;<span class="ident" id="1779178">quality</span><span class="op" id="1779185">*</span><span class="num" id="1779186">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779192">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779232">for</span>&nbsp;<span class="ident" id="1779236">i</span>&nbsp;<span class="op" id="1779238">:=</span>&nbsp;<span class="keyword" id="1779241">range</span>&nbsp;<span class="ident" id="1779247">e</span><span class="op" id="1779248">.</span><span class="ident" id="1779249">quant</span>&nbsp;<span class="op" id="1779255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779259">for</span>&nbsp;<span class="ident" id="1779263">j</span>&nbsp;<span class="op" id="1779265">:=</span>&nbsp;<span class="keyword" id="1779268">range</span>&nbsp;<span class="ident" id="1779274">e</span><span class="op" id="1779275">.</span><span class="ident" id="1779276">quant</span><span class="op" id="1779281">[</span><span class="ident" id="1779282">i</span><span class="op" id="1779283">]</span>&nbsp;<span class="op" id="1779285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779290">x</span>&nbsp;<span class="op" id="1779292">:=</span>&nbsp;<span class="builtintype" id="1779295">int</span><span class="op" id="1779298">(</span><span class="ident" id="1779299">unscaledQuant</span><span class="op" id="1779312">[</span><span class="ident" id="1779313">i</span><span class="op" id="1779314">]</span><span class="op" id="1779315">[</span><span class="ident" id="1779316">j</span><span class="op" id="1779317">]</span><span class="op" id="1779318">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779323">x</span>&nbsp;<span class="op" id="1779325">=</span>&nbsp;<span class="op" id="1779327">(</span><span class="ident" id="1779328">x</span><span class="op" id="1779329">*</span><span class="ident" id="1779330">scale</span>&nbsp;<span class="op" id="1779336">+</span>&nbsp;<span class="num" id="1779338">50</span><span class="op" id="1779340">)</span>&nbsp;<span class="op" id="1779342">/</span>&nbsp;<span class="num" id="1779344">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779351">if</span>&nbsp;<span class="ident" id="1779354">x</span>&nbsp;<span class="op" id="1779356">&lt;</span>&nbsp;<span class="num" id="1779358">1</span>&nbsp;<span class="op" id="1779360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779366">x</span>&nbsp;<span class="op" id="1779368">=</span>&nbsp;<span class="num" id="1779370">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779375">}</span>&nbsp;<span class="keyword" id="1779377">else</span>&nbsp;<span class="keyword" id="1779382">if</span>&nbsp;<span class="ident" id="1779385">x</span>&nbsp;<span class="op" id="1779387">&gt;</span>&nbsp;<span class="num" id="1779389">255</span>&nbsp;<span class="op" id="1779393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779399">x</span>&nbsp;<span class="op" id="1779401">=</span>&nbsp;<span class="num" id="1779403">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779415">e</span><span class="op" id="1779416">.</span><span class="ident" id="1779417">quant</span><span class="op" id="1779422">[</span><span class="ident" id="1779423">i</span><span class="op" id="1779424">]</span><span class="op" id="1779425">[</span><span class="ident" id="1779426">j</span><span class="op" id="1779427">]</span>&nbsp;<span class="op" id="1779429">=</span>&nbsp;<span class="builtintype" id="1779431">uint8</span><span class="op" id="1779436">(</span><span class="ident" id="1779437">x</span><span class="op" id="1779438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779448">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779508">nComponent</span>&nbsp;<span class="op" id="1779519">:=</span>&nbsp;<span class="num" id="1779522">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779525">switch</span>&nbsp;<span class="ident" id="1779532">m</span><span class="op" id="1779533">.</span><span class="op" id="1779534">(</span><span class="keyword" id="1779535">type</span><span class="op" id="1779539">)</span>&nbsp;<span class="op" id="1779541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779544">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779606">case</span>&nbsp;<span class="op" id="1779611">*</span><span class="ident" id="1779612">image</span><span class="op" id="1779617">.</span><span class="ident" id="1779618">Gray</span><span class="op" id="1779622">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779626">nComponent</span>&nbsp;<span class="op" id="1779637">=</span>&nbsp;<span class="num" id="1779639">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779645">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779682">e</span><span class="op" id="1779683">.</span><span class="ident" id="1779684">buf</span><span class="op" id="1779687">[</span><span class="num" id="1779688">0</span><span class="op" id="1779689">]</span>&nbsp;<span class="op" id="1779691">=</span>&nbsp;<span class="num" id="1779693">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779699">e</span><span class="op" id="1779700">.</span><span class="ident" id="1779701">buf</span><span class="op" id="1779704">[</span><span class="num" id="1779705">1</span><span class="op" id="1779706">]</span>&nbsp;<span class="op" id="1779708">=</span>&nbsp;<span class="num" id="1779710">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779716">e</span><span class="op" id="1779717">.</span><span class="ident" id="1779718">write</span><span class="op" id="1779723">(</span><span class="ident" id="1779724">e</span><span class="op" id="1779725">.</span><span class="ident" id="1779726">buf</span><span class="op" id="1779729">[</span><span class="op" id="1779730">:</span><span class="num" id="1779731">2</span><span class="op" id="1779732">]</span><span class="op" id="1779733">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779736">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779771">e</span><span class="op" id="1779772">.</span><span class="ident" id="1779773">writeDQT</span><span class="op" id="1779781">(</span><span class="op" id="1779782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779785">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779817">e</span><span class="op" id="1779818">.</span><span class="ident" id="1779819">writeSOF0</span><span class="op" id="1779828">(</span><span class="ident" id="1779829">b</span><span class="op" id="1779830">.</span><span class="ident" id="1779831">Size</span><span class="op" id="1779835">(</span><span class="op" id="1779836">)</span><span class="op" id="1779837">,</span>&nbsp;<span class="ident" id="1779839">nComponent</span><span class="op" id="1779849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779852">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779882">e</span><span class="op" id="1779883">.</span><span class="ident" id="1779884">writeDHT</span><span class="op" id="1779892">(</span><span class="ident" id="1779893">nComponent</span><span class="op" id="1779903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779906">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779932">e</span><span class="op" id="1779933">.</span><span class="ident" id="1779934">writeSOS</span><span class="op" id="1779942">(</span><span class="ident" id="1779943">m</span><span class="op" id="1779944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779947">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779982">e</span><span class="op" id="1779983">.</span><span class="ident" id="1779984">buf</span><span class="op" id="1779987">[</span><span class="num" id="1779988">0</span><span class="op" id="1779989">]</span>&nbsp;<span class="op" id="1779991">=</span>&nbsp;<span class="num" id="1779993">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779999">e</span><span class="op" id="1780000">.</span><span class="ident" id="1780001">buf</span><span class="op" id="1780004">[</span><span class="num" id="1780005">1</span><span class="op" id="1780006">]</span>&nbsp;<span class="op" id="1780008">=</span>&nbsp;<span class="num" id="1780010">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1780016">e</span><span class="op" id="1780017">.</span><span class="ident" id="1780018">write</span><span class="op" id="1780023">(</span><span class="ident" id="1780024">e</span><span class="op" id="1780025">.</span><span class="ident" id="1780026">buf</span><span class="op" id="1780029">[</span><span class="op" id="1780030">:</span><span class="num" id="1780031">2</span><span class="op" id="1780032">]</span><span class="op" id="1780033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1780036">e</span><span class="op" id="1780037">.</span><span class="ident" id="1780038">flush</span><span class="op" id="1780043">(</span><span class="op" id="1780044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780047">return</span>&nbsp;<span class="ident" id="1780054">e</span><span class="op" id="1780055">.</span><span class="ident" id="1780056">err</span><br>
<span class="lineno"></span><span class="op" id="1780060">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
